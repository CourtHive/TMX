var QCe=Object.defineProperty;var ePe=(t,e,i)=>e in t?QCe(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i;var Je=(t,e,i)=>(ePe(t,typeof e!="symbol"?e+"":e,i),i);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const a of r)if(a.type==="childList")for(const o of a.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&n(o)}).observe(document,{childList:!0,subtree:!0});function i(r){const a={};return r.integrity&&(a.integrity=r.integrity),r.referrerPolicy&&(a.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?a.credentials="include":r.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function n(r){if(r.ep)return;r.ep=!0;const a=i(r);fetch(r.href,a)}})();const Bo=function(){let t={},e={},i="gbr";t.define=({ioc:r,idiom:a})=>{e[r]=a},t.set=r=>{if(!r)return i;if(e[r])return i=r,e[r]},t.options=()=>Object.keys(e),t.current=()=>e[i];function n(r){if(!r)return"";let a=e[i],o=r.split(".");for(;o.length;){let s=o.shift();a=(a==null?void 0:a[s])||""}return a}return t.tr=r=>{if(!r)return"";if(n(r))return n(r);let a=e.default,o=r.split(".");for(;o.length;){let s=o.shift();a=(a==null?void 0:a[s])||""}return a},t.obj=r=>{var a;return r?(a=e==null?void 0:e[i])!=null&&a[r]?e[i][r]:e.default[r]?e.default[r]:{}:""},e.default={open:"Open",zoom:"Zoom",addcourts:"Add Courts",login:"Login",logout:"Logout",passwd:"Password",lang:"Language",menu:"Menu",main:"Main Menu",local:"Local Data",save:"Save",side:"Side",bye:"BYE",select:"Select",selected:"Selectd",group:"GROUP",administrator:"Administrator",revoke:"Revoke",tour:"Tour",noresults:"No Results",delete:"Delete",continue:"Do you wish to continue?",notes:"Notes",social:"Social Media",stats:"Statistics",merge:"Merge",week:"Week",warn:"WARNING",add:"Add",remove:"Remove",ptz:"Penalties",replace:"Replace",dl:"Download",or:"or",arp:"All Ranking Points",rlp:"Points - Ranking Lists",trn:"Tournament",tnz:"Tournaments",enable:"Enable",disable:"Disable",rnd:"Round",dt:"Date",fmt:"Format",cat:"Category",cta:"Cat.",team:"Team",tmz:"Teams",rnk:"Rank",rnkz:"Rankings",rtg:"Rating",rtz:"Ratings",prnk:"Rank",trnk:"Rank",rl:"Rank List",rlo:"Rank Order",alpha:"Alphabetical",opnt:"Opponent",ply:"Player",pyr:"Players",sgi:"Sign-In",sgo:"Sign-Out",scr:"Score",pts:"Points",allmatches:"All Matches",allteams:"All Teams",mts:"Matches",emts:"Matches",ests:"Sets",egms:"Games",epts:"Points",mtc:"Match",drw:"Draw",drz:"Draws",ent:"Event",evt:"Events",sch:"Schedule",rename:"Rename",crt:"Courts",ct:"Court",on:"On",off:"Off",id:"ID",nm:"Name",fnm:"First Name",lnm:"Last Name",nnm:"Nickname",attr:"Attribute",bd:"Birthday",yr:"Year",byr:"Birth Year",tot:"Total",sgl:"Singles",dbl:"Doubles",pyo:"Playoff",adh:"Ad-Hoc",snr:"Senior",unk:"Unknown",dup:"Duplicate",stt:"Status",ord:"Order",clb:"Club",scl:"School",cty:"City",state:"State",cnt:"Country",kwn:"Known",ioc:"IOC",act:"Action",agd:"Assigned",igr:"Ignore",igd:"Ignored",edt:"Edit Player",idp:"Identify Player",dlp:"Delete Player",sbt:"Submit",ccl:"Cancel",clr:"Clear",und:"Undo",apt:"Accept",dss:"Dismiss",frm:"From",to:"To",h2h:"Head-to-Head",reg:"Registered",gdr:"Gender",dtp:"Draw Type",drp:"Draw Position",manual:"Manual Draw",adr:"Automated Draw",mdo:"Draw Order",phn:"Phone",view:"View",email:"Email",asn:"Association",start:"Start",end:"End",dates:"Dates",ref:"Referee",time:"Time",duration:"Duration",qualifier:"Qualifier",qualifiers:"Qualifiers",none:"None",keys:"Keys",pos:"Position",seeding:"Seeding",home:"Home",new:"New",inout:"In/Out",indoors:"Indoors",outdoors:"Outdoors",existing:"Existing",success:"Success",loading:"Loading",set:"Settings",version:"Version",messages:"Messages",support:"Support",datastorage:"Data Storage",releasenotes:"Release Notes",documentation:"Documentation",importexport:"Import / Export",newversion:"New Version Available",latitude:"Latitude",longitude:"Longitude",i18n:{previousMonth:"Previous Month",nextMonth:"Next Month",months:["January","February","March","April","May","June","July","August","September","October","November","December"],monthsShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],weekdays:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],weekdaysShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"]},settings:{help:"Help",pagesize:"Page Size",schedule:"Schedule",calendar:"Calendar",search:"Search",documentation:"Documentation Links",hoverhelp:"Hover Hints",diacritics:"Diacritics",lastfirst:"Last name, First name",organization:"Organization",general:"General",categories:"Categories",points:"Points",draws:"Draws",data:"Data",sheetdata:"Sheet Data",publishing:"Publishing",printing:"Printing",savepdfs:"Save PDF",opentabs:"Open in Browser Tabs",compresseddraws:"Compressed Draw Formats",teams:"Teams Displayed",countryflags:"Country Flags Displayed",requireconfirm:"Require Confirmation",publishonscore:"Publish when score entered",publishdrawcreation:"Publish as draw created",matchesbefore:"Matches Before Count",automatedbyes:"Automatic Bye Placement",llallrounds:"LL from All Qualifying Rounds",rrh2hpriority:"RR Head-to-Head priority",qualconsolation:"Qualifying Consolation",consolationalts:"Consolation Alternates",consolationseeds:"Consolation Seeding",gemseeding:"GEM Seeding",adhocelo:"Adhoc ELO Ratings",restrictseedplacement:"Restrict Seed Placement",separate_by_team:"Auto Separate Players by Team",separate_by_ioc:"Auto Separate Players by Country",separate_by_club:"Auto Separate Players by Club",separate_by_school:"Auto Separate Players by School",clear_separation:"Clear Auto Separation",courtdetail:"Court Details",matchtimes:"Match Times",matchdates:"Match Dates",firstday:"Week Starts Monday",time24:"24 Hour Clock",draworderscores:"Scores in Draw Order",schedulecompleted:"Schedule Completed Matches",courtidentifiers:"court identifiers"},round_names:{F:"Final",SF:"Semifinal",QF:"Quarterfinal"},search:{filterplayers:"Filter Players",players:"Search Players",tournaments:"Search Tournaments",clubs:"Search Clubs",approve:"Approve Player",add2team:"Add Team Player",lastfirst:"LAST First",firstlast:"First Last"},formats:{singles:"Singles",doubles:"Doubles",team:"Team"},scoring_format:{set:"Set",sets:"Sets",timedset:"Timed Set",timedsets:"Timed Sets",tiebreak:"Tiebreak",tiebreaks:"Tiebreaks",winby:"Win By",custom:"Custom",bestof:"Best of",tbat:"TB at",finalset:"Final Set",setsto:"Sets to",tbto:"TB to",superto:"To"},scoring:{label:"Scoring",retire:"Retire",default:"Default",walkover:"Walkover",supertiebreak:"Match Tiebreak",normal:"Normal",winloss_abbreviation:"W/L",cancelled:"Cancelled",abandoned:"Abandoned"},draws:{seedlimit:"Seed Limit",blockthreshold:"Block Threshold",generating:"Generating... Please be patient...",generateround:"Generate Round",deleteround:"Delete Round",adhoc:"Adhoc",gemseeding:"GEM Seeding",playerfilter:"Ratings Filter",compass:"Compass",north:"North",south:"South",east:"East",west:"West",northeast:"Northeast",northwest:"Northwest",southeast:"Southeast",southwest:"Southwest",feedin:"Feed-in",staggered:"Staggered",standard:"Standard",elective:"Elective",backdraw:"Backdraw",roundlimit:"Round Limit",structure:"Structure",skiprounds:"Skip Rounds",feedrounds:"Feed Rounds",sequential:"Sequential",brackets:"Brackets",bracketsize:"Bracket Size",roundrobin:"Round Robin",elimination:"Elimination",consolation:"Consolation",qualification:"Qualification",preround:"Pre-Round",incidentals:"Incidentals",remove:"Remove",changestatus:"Change Status",penalty:"Assess penalty",umpire:"Select Referee",matchumpire:"Match Referee",matchtime:"Match Time",starttime:"Start Time",endtime:"Finish Time",resttime:"Rest Time",duration:"Duration",timeheader:"Time Heading",maindraw:"Main Draw",unscheduled:"Unscheduled Matches",scheduled:"Scheduled Matches",completed:"Completed",unpublished:"Unpublished",publisheduptodate:"Up to Date",publishedoutofdate:"Out of Date",published:"Published",publish:"Publish",publishQ:"Publish Draw?",organizers:"Organizers",playerrep:"Representative",playerreps:"Representatives",substitutes:"Substitutes (LL/Alts)",allindraw:"all in draw",lastdirectaccept:"Last Direct Acceptance",clear:"Clear Draw",swap:"Swap Position",alternate:"Alternate",alternatepair:"Alternate Pair",alternateplayer:"Alternate Player",luckyloser:"Lucky Loser",first:"First",last:"Last",seedrange:"Seeds",modifyseeding:"Modify Seeding",playerrange:"All Players",unpublish:"Unpublish Draw",unpublishall:"Unpublish All Events"},print:{publishpdf:"Publish PDF",schedule:"Schedule",draw:"Print",signin:"Sign-In Sheet",ranklist:"Rank List",playerlist:"Player List",matchlist:"Print Match List",matchesbytime:"Matches by Time",pendingmatches:"Pending Matches",matchesbycourt:"Matches by Court",completedmatches:"Completed Matches"},teams:{code:"Code (3 letters)",name:"Name",share:"Share Team",rankings:"Team Rankings",members:"Members",matches:"Matches",winloss:"Won/Lost",newteam:"New Team",createnew:"Create New",submitkey:"Submit Key",nameorkey:"Team Name or Import Key",club:"Club",coaches:"Coaches",school:"School",ioc:"Country",abbreviation:"Abbreviation"},tournament:{organizer_email:"Organizer Email",organizer_phone:"Organizer Phone",judge_email:"Referee Email",judge_phone:"Referee Phone",sponsor:"Sponsor(s)",logo:"Tournament Logo",images:"Tournament Images"},tournaments:{type:"Type",standard:"Standard",dual:"Dual Matches",register:"Register",registration:"Registration Link",team:"Team Tournament",new:"New Tournament",add:"Add Tournament",id:"Tournament ID",loadbyid:"Load by ID",edit:"Edit",copy:"Copy",close:"Close",done:"Finish",import:"Import Record",removeall:"Remove All",addall:"Add All",destroyall:"Destroy All",key:"Authorization",noauth:"Not Authorized",unofficial:"Unofficial",auth:"Authorized",fetch:"Download",fetchtournament:"Download Tournament Record",convert:"Convert to TODS / Save",send:"Upload Tournament Record",export:"Export Tournament Record",renewlist:"Renew List",natlassoc:"National Association",tennisclub:"Tennis Club",received:"Received Tournament Record",existing:"Existing Tournament Record",publishtime:"Publish Time",replacelocal:"Replace Local Copy?",unpublish:"Unpublish Tournament?"},ddlb:{singles:"Singles Tournament Rank:",doubles:"Doubles Tournament Rank:",category:"Tournament Category:",draws:"Select Event:",direction:"Select Draw:"},phrases:{remember_me:"Remember Me",forgot_passwd:"Forgot Password",no_account:"No account? Sign Up",selectlanguage:"Select Language",setupcourts:"Set up your courts",courtsmsg:"Before you can schedule matches we need to know more about your courts. To get started, add some court details.",sortorder:"Sort Order",eventcorrupted:"Event is Corrupted: Development Notified",singlesrankings:"Singles Rankings",doublesrankings:"Doubles Rankings",sectionscroll:"Section Scrolling",dynamicrating:"Dynamic Rating",recalcdynamic:"Re-Calculate Dynamic Rating",comingsoon:"New Feature: Coming Soon!",finalrounds:"Final Rounds",sendplayerdb:"Send Player Database",prerelease:"Pre-release version of TMX",feedback:"Please send all feedback and support requests to",improperauth:"Improper Authorization Credentials",noexportformats:"No Export Formats Enabled",verifyranking:"Please Verify Player Ranking!",nomatches2schedule:"No Matches to Schedule!",addimage:"Enter full website address for an image",addgooglemap:'Enter full URL, not "Link to Share"',retrieveFromServer:"Retrieve from CourtHive Server?",mainmenu:"Main Menu",rankbyrating:"Rank by Rating",dblsrankisrating:"Use Rating as Doubles Ranking?",sheetdataurls:"Enter Google Sheet URLs for Synchronizing Data",playerimport:"Player Import",entersheeturl:"Enter Sheet URL",entergooglemapsurl:"Enter Google Maps link",invalidurl:"Invalid URL(s)",invalidsheeturl:"Invalid Sheet URL",invalidgooglemapsurl:"Invalid Google Maps Link",geolocationdenied:"Geolocation has been denied",unblockgeo:"Unblock in browser settings",usecurrentlocation:"Use your current position?",updatelatlng:"Update Latitude/Longitude?",cleardraw:"Existing Draw will be cleared!",clearselection:"Clear Selection",selectplayer:"Select Player",matches2clear:"Matches to be cleared from the schedule",changeapproved:"Changing Approved will reset the draw and clear the schedule.",qualincomplete:"Qualifying Draw is Incomplete",delegate:"Delegate",delegate2mobile:"Delegate to Mobile",revokedelegation:"Revoke Delegation",delegationrevoked:"Delegation has been revoked",qrcode:"QR Code",scanQRcode:"Scan QR Code with Mobile",ranklists:"Rank Lists for",reset:"Database will be reset",action:"Players requiring some action...",search:"Use the search field above to find players, or click player to edit",assign:"Assign this profile by clicking a player below, or ...",accept:"Accept all players",trnyz:"Loading Tournaments ...",loadplayers:"Load Players",badfile:"File Not Recognized",invalid:"Invalid file type",fileerror:"Error reading file",servererror:"Error Message from Server",notfound:"Not Found",pointcalc:"Point calculation requires tournament category and rank",drawcreated:"Draw Created",drawactive:"Active Draw",notcreated:"Not Created",importdata:"Import Data",exportdata:"Export Data",importtemplate:"Import Template",draganddrop:"Drag and Drop files into this zone",schedulematches:"Schedule Matches",notconfigured:"Not Configured",cannotsignout:"Cannot Sign Out",cannotchangerank:"Cannot Change Rank",cannotchangewinner:"Cannot Change Winner",matchmustbecomplete:"Match Must Be Complete!",approvedplayer:"Player Approved for an Event",locallycreated:"Locally Created Tournament",noremote:"No Remote Registrations to Update",calculateranking:"Calculate Ranking Points",generateranklist:"Generate Rank List",generatekey:"Generate Key",norankingdata:"No Ranking Data",oop_system:"Order of Play",schedulepublished:"Publishing Time:",timestamp:"Date/Time: ",rankedplayers:"Ranked Players",judgesignature:"Signature of Head Umpire:",nopointcalcs:"No Point Calculations for given date",downloadtemplate:"Download Import Template",add2database:"Add Players, Tournaments, Rankings to Database",noconnection:"No Connection",schedulepriority:"Match Scheduling Priority",send:"Send",sendTODS:"Send TODS Tournament Record",export:"Export",pointsvalidfrom:"Points Valid From",linkcopied:"Link Copied to Clipboard",keycopied:"Key Copied to Clipboard",submitkey:"Enter New Key",selectkey:"Select Key",deletereplace:"Delete / Replace",weblink:"Web Link",nomatches:"No Matches",updatedioc:"Update Language File",revokeauth:"Revoke Authorization?",clearalldays:"Clear All Days?",cantdelqual:"Cannot Delete: Qualified Player Active in Main Draw",cantrefresh:"Offline: Cannot Refresh",blocked:"Pop-Up Windows are blocked by your browser",enablepopups:"Please enable Pop-Ups for PDF printing",nopersist:"Data Persistence not guaranteed"},events:{name:"Name",newevent:"New Event",customname:"Custom Name",enableeligibility:"Enable Eligibility Filter",disableeligibility:"Disable Eligibility Filter",teamevent:"Team Event",opponents:"Opponents",matchprofile:"Match Profile",teams:"Teams",draw_type:"Draw Type",draw_size:"Draw Size",created:"Created",category:"Category",rank:"Rank",surface:"Surface",approveteam:"Approve",destroyteam:"Destroy",entered:"Entered",approved:"Approved",eligible:"Eligible",ineligible:"Ineligible",unavailable:"Unavailable",wildcard:"Wildcard",received:"Received Event(s)",toggle:"Toggle Publish State?",modifyranking:"Modify Ranking"},locations:{newlocation:"New Location",abbreviation:"Abbreviation",name:"Name",address:"Address",courts:"Courts",identifiers:"Court IDs"},genders:{male:"Male",male_abbr:"M",female:"Female",female_abbr:"W",mixed:"Mixed"},surfaces:{clay:"Clay",hard:"Hard",grass:"Grass",carpet:"Carpet"},actions:{ok:"OK",actions:"Actions",add_event:"Add Event",save_event:"Save Event",save_team:"Save Team",save_location:"Save Location",done:"Done",cancel:"Cancel",refresh:"Refresh",remakedraw:"Remake Draw",delete_event:"Delete Event",delete_team:"Delete Team",delete_match:"Delete Match",add_player:"Add Player",add_team:"Add Team",create_team:"Create team",generate_team:"Generate Team",publish:"Publish",unpublish:"Unpublish",manage_players:"Manage Players",manage_teams:"Manage Teams",add_location:"Add Location",delete_location:"Delete Location",delete_tournament:"Delete tournament",edit_tournament:"Edit Tournament",copy_tournament:"Copy Tournament",createteambyattr:"Create team",add2localdb:"Add Players to Local Database",signoutunapproved:"Sign Out players not approved for Events"},requests:{syncClubs:"Synchronize Clubs",syncTournaments:"Synchronize Tournaments",syncPlayers:"Synchronize players"},signin:{tournament_date:"Start Date",organization:"Organization",place:"Location",id:"Tournament ID",rank:"Tournament Rank",judge:"Head Umpire",doc_name:"SIGN-IN SHEET",doc_subname:" ",signature:"Signature",registered:"Registered Players",notsignedin:"Not Signed In",signedin:"Signed In",withdrawn:"Withdrawn",medical:"Medical",registration:"Registration",medical_issues:"Medical Expired",create_new_player:"Create New",modifyrankings:"Modify Rankings",acceptrankings:"Accept Rankings",reglink:"Set Link"},schedule:{column:"Column",rows:"Schedule Rows",startrow:"Start Row",alldraws:"All Draws",allevents:"All Events",allrounds:"All Rounds",allcourts:"All Courts",alldual:"All Dual Matches",autoschedule:"Auto Schedule",highlightteam:"Highlight Team",limit:"Limit",clearschedule:"Clear Schedule",clearcompleted:"Clear Completed Matches",orderofplay:"ORDER OF PLAY",matchestime:"Matches => Time",notbefore:"Not Before",nb:"NB",followedby:"Followed By",afterrest:"After Rest",raindelay:"Rain Delay",tba:"TBA",nextavailable:"Next Available",called:"Called",oncourt:"On Court",warmingup:"Warming Up",suspended:"Suspended",abandoned:"Abandoned",clear:"Clear",publish:"Publish Schedule",view:"View Schedule",unpublish:"Unpublish Schedule",timing:"Timing",vs:"vs.",umpirenotes:"Umpire Notes",notice:"Schedule Notice",opponentname:"Opponent Name",scheduled:"Scheduled"},penalties:{fail2signout:"Failed to Sign Out",illegalcoaching:"Illegal Coaching",ballabuse:"Ball Abuse",racquetabuse:"Racquet Abuse",equipmentabuse:"Equipment Abuse",cursing:"Swearing",rudegestures:"Rude Gestures",foullanguage:"Foul Language",timeviolation:"Time Violation",latearrival:"Late Arrival",unsporting:"Unsporting Behavior"},datelocalization:"en-EN"},t}();function Nt(t){return typeof t=="function"}function tPe(t){return typeof t=="string"}function lp(t){return typeof t=="object"&&!Array.isArray(t)}function iPe(t,e=0){let i=e,n,r;const a=()=>{i-=new Date-r,window.clearTimeout(n)},o=()=>i=e,s=()=>{r=new Date,n=window.setTimeout(function(){i=e,t()},i)};return s(),{pause:a,resume:s,reset:o}}var nPe=Object.defineProperty,$i=(t,e)=>{for(var i in e)nPe(t,i,{get:e[i],enumerable:!0})};function gT(){return"2.1.4"}var _k={};$i(_k,{competitionGovernor:()=>DH,drawsGovernor:()=>Ez,entriesGovernor:()=>X3,eventGovernor:()=>eW,generationGovernor:()=>uW,matchUpFormatGovernor:()=>_f,matchUpGovernor:()=>hW,mocksGovernor:()=>EO,participantGovernor:()=>BW,policyGovernor:()=>w3,publishingGovernor:()=>_O,queryGovernor:()=>iP,reportGovernor:()=>VW,scheduleGovernor:()=>jW,scoreGovernor:()=>Mv,tieFormatGovernor:()=>HW,tournamentGovernor:()=>KW,venueGovernor:()=>ZW});var DH={};$i(DH,{getLinkedTournamentIds:()=>fC,getTournamentIds:()=>pC,linkTournaments:()=>Xre,mutate:()=>Yie,query:()=>eae,unlinkTournament:()=>Qre,unlinkTournaments:()=>Jre});var Yie={};$i(Yie,{linkTournaments:()=>Xre,unlinkTournament:()=>Qre,unlinkTournaments:()=>Jre});var B0={};$i(B0,{addNotice:()=>wi,callListener:()=>TD,createInstanceState:()=>gre,cycleMutationStatus:()=>iz,deepCopyEnabled:()=>tz,deleteNotice:()=>az,deleteNotices:()=>_I,disableNotifications:()=>yre,enableNotifications:()=>gN,getDevContext:()=>Jl,getMethods:()=>nz,getNotices:()=>rz,getProvider:()=>$2,getTopics:()=>rc,getTournamentId:()=>kI,getTournamentRecord:()=>oz,getTournamentRecords:()=>Sg,globalLog:()=>Tre,handleCaughtError:()=>Yk,hasTopic:()=>Wk,removeTournamentRecord:()=>Sre,setDeepCopy:()=>SD,setDevContext:()=>wD,setGlobalLog:()=>vre,setGlobalMethods:()=>bre,setGlobalSubscriptions:()=>XPe,setMethods:()=>Ire,setStateMethods:()=>Ure,setStateProvider:()=>YPe,setSubscriptions:()=>JPe,setTournamentId:()=>UD,setTournamentRecord:()=>wre,setTournamentRecords:()=>Kk,timeKeeper:()=>ZPe});function Gs(t){return typeof t=="function"}function $r(t){return typeof t=="string"}function Xi(t){return t!==null&&typeof t=="object"&&!Array.isArray(t)}function rPe(t,e){if(!Xi(t)||!Xi(e))return!1;let i=Object.keys(t),n=Object.keys(e);if(i.length!==n.length)return!1;for(let r of i)if(t[r]!==e[r])return!1;return!0}function Zie(t,e){return Array.isArray(t)?Object.assign({},...(t??[]).filter(Xi).map(i=>i[e]&&{[i[e]]:i}).filter(Boolean)):{}}var aPe=t=>e=>Object.keys(t).every(i=>e[i]===t[i]);function P2(t,e){if(t===void 0)return null;if(!Xi(t)||t===null)return t;let i=Object.keys(t),n=r=>r===void 0?null:r;return Object.assign({},...i.map(r=>Array.isArray(t[r])?{[r]:e?t[r]:t[r].map(a=>P2(a))}:{[r]:e?n(t[r]):P2(t[r])}))}function R2(t){return Array.isArray(t)?t.length+t.map(R2).reduce((e,i)=>e+i,0):Xi(t)&&t!==null?Object.keys(t).length+Object.keys(t).map(e=>R2(t[e])).reduce((e,i)=>e+i,0):0}function oPe(t){if(t===null||typeof t!="object")return;let e=JSON.stringify(t),i=R2(t),n=e.split("").reduce((r,a)=>r+a.charCodeAt(0),0);return[e.length,i,n].map(r=>r.toString(36)).join("")}var ce={success:!0},Xie="error",Jie={SUCCESS:ce,ERROR:Xie},M2={message:"Chronological error; time violation.",code:"ANACHRONISM"},bD={message:"Duplicate entry",code:"DUPLICATE_ENTRY"},Qie={message:"Cannot remove main structure",code:"ERR_CANNOT_REMOVE_MAIN_STRUCTURE"},N2={message:"records must be an object with tournamentId keys",code:"ERR_INVALID_TOURNAMENTS"},Sr={message:"Missing tournamentRecords",code:"ERR_MISSING_TOURNAMENTS"},ut={message:"Missing tournamentRecord",code:"ERR_MISSING_TOURNAMENT"},eC={message:"Invalid tournamentRecord",code:"ERR_INVALID_TOURNAMENT"},J0={message:"Missing tournamentId",code:"ERR_MISSING_TOURNAMENT_ID"},Ib={message:"Invalid drawDefinition",code:"ERR_INVALID_DRAWDEF"},Vt={message:"Missing drawDefinition",code:"ERR_MISSING_DRAWDEF"},ene={message:"Existing drawDefinition(s)",code:"ERR_EXISTING_DRAWDEFS"},Zl={message:"drawDefinition not found",code:"ERR_NOT_FOUND_DRAWDEF"},my={message:"Invalid structure",code:"ERR_INVALID_STRUCTURE"},EH={message:"Incomplete source structure",code:"ERR_INCOMPLETE_STRUCTURE"},CH={message:"Invalid drawPosition for seedAssignment",code:"ERR_INVALID_SEEDING_POSITION"},Q0={message:"drawPosition already assigned",code:"ERR_EXISTING_POSITION_ASSIGNMENT"},tne={message:"Schedule not cleared",code:"ERR_UNCHANGED_SCHEDULE_NOT_CLEARED"},ine={message:"drawPosition not cleared",code:"ERR_FAILURE_POSITION_NOT_CLEARED"},sPe={message:"drawPosition not found",code:"ERR_NOT_FOUND_DRAW_POSITION"},PH={message:"Unrecognized drawType",code:"ERR_UNRECOGNIZED_DRAW_TYPE"},tC={message:"Missing drawPositions",code:"ERR_MISSING_DRAW_POSITIONS"},kk={message:"drawPosition is active",code:"ERR_ACTIVE_DRAW_POSITION"},lPe={message:"drawPosition is occupied",code:"ERR_OCCUPIED_DRAW_POSITION"},vT={message:"Invlid drawPosition",code:"ERR_INVALID_DRAW_POSITION"},yT={message:"Missing drawPosition",code:"ERR_MISSING_DRAW_POSITION"},RH={message:"Invalid drawType",code:"ERR_INVALID_DRAW_TYPE"},xk={message:"Invalid drawSize",code:"ERR_INVALID_DRAW_SIZE"},MH={message:"Cannot set drawSize to be less than existing entries",code:"ERR_INVALID_DRAW_SIZE_MISMATCH"},iC={message:"Missing drawSize",code:"ERR_MISSING_DRAW_SIZE"},Pd={message:"Missing drawId",code:"ERR_MISSING_DRAW_ID"},nne={message:"drawId exists",code:"ERR_EXISTING_DRAW_ID"},rne={message:"participantId cannot be assigned to multiple seedNumbers",code:"INVALID_PARTICIPANT_SEEDING"},ane={message:"seedsCount greater than drawSize",code:"ERR_INVALID_SEED_COUNT"},one={message:"Missing seedCountThresholds",code:"ERR_MISSING_SEED_COUNT_THRESHOLD"},sne={message:"Invalid action",code:"ERR_INVALID_ACTION"},A2={message:"Invalid assignment",code:"ERR_INVALID_ASSIGNMENT"},lne={message:"Missing seedAssignments",code:"ERR_MISSING_SEED_ASSIGNMENTS"},cne={message:"Invalid seedNumber",code:"ERR_INVALID_SEED_NUMBER"},une={message:"Invalid seedPosition",code:"ERR_INVALID_SEED_POSITION"},NH={message:"Missing targetLink",code:"ERR_MISSING_LINK_TARGET"},dne={message:"Existing round",code:"ERR_EXISTING_ROUND"},cPe={message:"Missing roundNumber",code:"ERR_MISSING_ROUND_NUMBER"},nc={message:"Missing structureId",code:"ERR_MISSING_STRUCTURE_ID"},wr={message:"structure not found",code:"ERR_NOT_FOUND_STRUCTURE"},AH={message:"Missing structures",code:"ERR_MISSING_STRUCTURES"},gy={message:"Missing structure",code:"ERR_MISSING_STRUCTURE"},pne={message:"drawDefinition contains unlinked structures",code:"ERR_MISSING_STRUCTURE_LINKS"},ph={message:"Invalid eventType",code:"ERR_INVALID_EVENT_TYPE"},Qn={message:"Missing event / eventId",code:"ERR_MISSING_EVENT_ID"},Xl={message:"Event not found",code:"ERR_NOT_FOUND_EVENT"},hne={message:"Event exists",code:"ERR_EXISTING_EVENT"},fne={message:"Missing entries",code:"ERR_MISSING_ENTRIES"},mne={message:"Invalid entries",code:"ERR_INVALID_ENTRIES"},_H={message:"Missing assignments",code:"ERR_MISSING_ASSIGNMENTS"},gne={message:"Missing stage",code:"ERR_MISSING_STAGE"},vy={message:"Invalid stage",code:"ERR_INVALID_STAGE"},vne={message:"stageSequence limit",code:"ERR_LIMIT_STAGE_SEQUENCE"},yne={message:"Missing positionAssignments",code:"ERR_MISSING_POSITION_ASSIGNMENTS"},bne={message:"Cannot Assign BYE status if no assignment: { bye: true }",code:"ERR_UNCHANGED_CANNOT_ASSIGN_BYE"},_2={message:"Unrecognized matchUpStatus",code:"ERR_UNRECOGNIZED_MATCHUP_STATUS"},nC={message:"Unrecognized matchUpFormat",code:"ERR_UNRECOGNIZED_MATCHUP_FORMAT"},fN={message:"Incompatible matchUpStatus",code:"ERR_INCOMPATIBLE_MATCHUP_STATUS"},bT={message:"Invalid matchUpStatus",code:"ERR_INVALID_MATCHUP_STATUS"},mf={message:"Invalid tieFormat",code:"ERR_INVALID_TIE_FORMAT"},kH={message:"Invalid matchUpFormat",code:"ERR_INVALID_MATCHUP_FORMAT"},xH={message:"Missing matchUpFormat",code:"ERR_MISSING_MATCHUP_FORMAT"},Ine={message:"Missing collectionDefinition",code:"ERR_MISSING_COLLECTION_DEFINITION"},IT={message:"Missing tieFormat",code:"ERR_MISSING_TIE_FORMAT"},ss={message:"Missing matchUpId",code:"ERR_MISSING_MATCHUP_ID"},PI={message:"Missing matchUpIds",code:"ERR_MISSING_MATCHUP_IDS"},Ho={message:"matchUp not found",code:"ERR_NOT_FOUND_MATCHUP"},Xf={message:"Missing matchUps",code:"ERR_MISSING_MATCHUPS"},rl={message:"Missing matchUp",code:"ERR_MISSING_MATCHUP"},al={message:"Invalid matchUp",code:"ERR_INVALID_MATCHUP"},OH={message:"Missing policyType",code:"ERR_MISSING_POLICY_TYPE"},Ok={message:"Missing policyDefinitions",code:"ERR_MISSING_POLICY_DEFINITIONS"},uPe={message:"Missing seeding policy",code:"ERR_MISSING_POLICY_SEEDING"},wne={message:"Missing avoidance policy",code:"ERR_MISSING_POLICY_AVOIDANCE"},LH={message:"Missing policy attributes",code:"ERR_MISSING_POLICY_ATTRIBUTES"},Sne={message:"Invalid policyDefinitions",code:"ERR_INVALID_POLICY_DEFINITIONS"},FH={message:"existing policyType",code:"ERR_EXISTING_POLICY_TYPE"},dPe={message:"Policy not attached",code:"ERR_FAILURE_POLICY_NOT_ATTACHED"},wb={message:"Policy not found",code:"ERR_NOT_FOUND_POLICY"},pPe={message:"Missing scoring policy / matchUpFormats",code:"ERR_MISSING_POLICY_SCORING_MATCHUP_FORMATS"},BH={message:"Invalid sideNumber",code:"ERR_INVALID_SIDE_NUMBER"},hPe={message:"Invalid setNumber",code:"ERR_INVALID_SET_NUMBER"},Lk={message:"Missing setObject",code:"ERR_MISSING_SET_ATTRIBUTE"},fPe={message:"Missing setNumber",code:"ERR_MISSING_SET_NUMBER"},mPe={message:"Missing sideNumber",code:"ERR_MISSING_SIDE_NUMBER"},RI={message:"Missing courtId",code:"ERR_MISSING_COURT_ID"},Yt={message:"Missing value",code:"ERR_MISSING_VALUE"},Tne={message:"Missing birthdate",code:"ERR_MISSING_BIRTH_DATE"},Une={message:"Missing date",code:"ERR_MISSING_DATE"},Dne={message:"No valid dates",code:"ERR_NO_VALID_DATES"},fA={message:"Invalid bookings",code:"ERR_INVALID_BOOKINGS"},mN={message:"Invalid dateAvailability",code:"ERR_INVALID_DATE_AVAILABILITY"},Ene={message:"Missing dateAvailability",code:"ERR_MISSING_DATE_AVAILABILITY"},Xa={message:"Invalid Date",code:"ERR_INVALID_DATE"},su={message:"Invalid time",code:"ERR_INVALID_TIME"},Cne={message:"Invalid tournament dates",code:"ERR_INVALID_DATES_TOURNAMENT"},k2={message:"Invalid game scores",code:"ERR_INVALID_SCORES_GAME"},Pne={message:"Invalid score",code:"ERR_INVALID_SCORE"},Fk={message:"Invalid winningSide",code:"ERR_INVALID_WINNING_SIDE"},gPe={message:"No participants generated",code:"ERR_NO_PARTICIPANTS_GENERATED"},$H={message:"Cannot modify tieFormat",code:"ERR_UNCHANGED_CANNOT_MODIFY_TIEFORMAT"},Rne={message:"Cannot modify participantType",code:"ERR_UNCHANGED_CANNOT_MODIFY_PARTICIPANT_TYPE"},Bk={message:"Cannot remove participants",code:"ERR_UNCHANGED_CANNOT_REMOVE_PARTICIPANTS"},x2={message:"Participant category mismatch",code:"ERR_CATEGORY_MISMATCH"},VH={message:"Cannot change winningSide",code:"ERR_UNCHANGED_CANNOT_CHANGE_WINNING_SIDE"},MI={message:"Invalid participant",code:"ERR_INVALID_PARTICIPANT"},vd={message:"Invalid participantId",code:"ERR_INVALID_PARTICIPANT_ID"},Ul={message:"Invalid participantIds",code:"ERR_INVALID_PARTICIPANT_IDS"},Mne={message:"Invalid participantRole",code:"ERR_INVALID_PARTICIPANT_ROLE"},yd={message:"Invalid participantType",code:"ERR_INVALID_PARTICIPANT_TYPE"},Nne={message:"Missing participantRole",code:"ERR_MISSING_PARTICIPANT_ROLE"},NI={message:"Missing participant",code:"ERR_MISSING_PARTICIPANT"},rC={message:"Missing participants",code:"ERR_MISSING_PARTICIPANTS"},ya={message:"Missing participantId",code:"ERR_MISSING_PARTICIPANT_ID"},Vr={message:"Participant Not Found",code:"ERR_NOT_FOUND_PARTICIPANT"},Ane={message:"participantId exists",code:"ERR_EXISTING_PARTICIPANT_ID"},vPe={message:"participant pair exists",code:"ERR_EXISTING_PARTICIPANT_PAIR"},_ne={message:"No participant removed",code:"ERR_UNCHANGED_NO_PARTICIPANT_REMOVED"},Ig={message:"Missing participantIds",code:"ERR_MISSING_PARTICIPANT_IDS"},kne={message:"Missing participantsCount",code:"ERR_MISSING_PARTICIPANT_COUNT"},xne={message:"Participant not checked in",code:"ERR_UNCHANGED_PARTICIPANT_NOT_CHECKED_IN"},One={message:"Missing person details",code:"ERR_MISSING_PERSON_DETAILS"},wT={message:"Existing participant drawPosition assignment",code:"ERR_EXISTING_PARTICIPANT_DRAW_POSITION_ASSIGNMENT"},$k={message:"Existing participant",code:"ERR_EXISTING_PARTICIPANT"},jH={message:"participantsCount exceeds drawSize",code:"ERR_INVALID_PARTICIPANT_COUNT"},O2={message:"Invalid entry status",code:"ERR_INVALID_ENTRY_STATUS"},Lne={message:"Participant Entry Not Found",code:"ERR_NOT_FOUND_PARTICIPANT_ENTRY"},yPe={message:"Participant not entered in stage",code:"ERR_UNCHANGED_PARTICIPANT_NOT_ENTERED"},bPe={message:"Participant not found in stageSequence",code:"ERR_NOT_FOUND_PARTICIPANT_IN_STAGE"},Fne={message:"entryStatus not allowed in stage",code:"ERR_INVALID_ENTRY_STATUS_IN_STAGE"},Bne={message:"entryStatus not allowed for event",code:"ERR_INVALID_ENTRY_STATUS_IN_EVENT"},L2={message:"No stage space available for entryStatus",code:"ERR_UNCHANGED_NO_AVAILABLE_STAGE_SPACE"},$ne={message:"Insufficient drawPositions to accommodate qualifiers",code:"ERR_UNCHANGED_NO_DRAW_POSITIONS_FOR_QUALIFIERS"},GH={message:"Insufficient drawPositions to accommodate entries",code:"ERR_INSUFFICIENT_DRAW_POSITIONS"},Vne={message:"Missing penaltyType",code:"ERR_MISSING_PENALTY_TYPE"},HH={message:"Missing penaltyId",code:"ERR_MISSING_PENALTY_ID"},eS={message:"Penalty not found",code:"ERR_NOT_FOUND_PENALTY"},jne={message:"Missing courtsCount/courtNames",code:"ERR_MISSING_COURTS_INFO"},ST={message:"Court not found",code:"ERR_NOT_FOUND_COURT"},Gne={message:"Court exists",code:"ERR_EXISTING_COURT"},Hne={message:"Venue exists",code:"ERR_EXISTING_VENUE"},AI={message:"Venue not found",code:"ERR_NOT_FOUND_VENUE"},wg={message:"Missing venueId",code:"ERR_MISSING_VENUE_ID"},zne={message:"Invalid endTime",code:"ERR_INVALID_END_TIME"},zH={message:"Existing endTime",code:"ERR_EXISTING_END_TIME"},qne={message:"Invalid stopTime",code:"ERR_INVALID_STOP_TIME"},Wne={message:"Invalid startTime",code:"ERR_INVALID_START_TIME"},IPe={message:"Invalid resumeTime",code:"ERR_INVALID_RESUME_TIME"},qH={message:"Invalid timeItem",code:"ERR_INVALID_TIME_ITEMS"},Kne={message:"Missing async state provider",code:"ERR_MISSING_ASYNC_STATE_PROVIDER"},WH={message:"Missing timeItem",code:"ERR_MISSING_TIME_ITEM"},KH={message:"Missing timeItems",code:"ERR_MISSING_TIME_ITEMS"},Vk={message:"Missing context",code:"ERR_MISSING_CONTEXT"},Yne={message:"Missing schedule",code:"ERR_MISSING_SCHEDULE"},aC={message:"Invalid scaleItem",code:"ERR_INVALID_SCALE_ITEM"},Zne={message:"Modifications failed",code:"ERR_FAILURE_MODIFICATIONS"},TT={message:"No modifications applied",code:"ERR_UNCHANGED_NO_MODIFICATIONS_APPLIED"},Xne={message:"Unable to assign court",code:"ERR_UNCHANGED_COURT_NOT_ASSIGNED"},jk={message:"No Candidates",code:"ERR_UNCHANGED_NO_CANDIDATES"},Jne={message:"Invalid configuration",code:"ERR_INVALID_CONFIG"},Qne={message:"Invalid collectionDefinition",code:"ERR_INVALID_COLLECTION_DEFINITION"},Jf={message:"Invalid object",code:"ERR_INVALID_OBJECT"},A1={message:"Invalid gender",code:"ERR_INVALID_GENDER"},ID={message:"Invalid category",code:"ERR_INVALID_CATEGORY"},Re={message:"Invalid values",code:"ERR_INVALID_VALUES"},ere={message:"Duplicate value",code:"ERR_DUPLICATE_VALUE"},YH={message:"Team not found",code:"ERR_NOT_FOUND_TEAM"},tre={message:"No valid actions",code:"ERR_NO_VALID_ACTIONS"},Gk={message:"No valid attributes",code:"ERR_NO_VALID_ATTRIBUTES"},ZH={message:"Value unchanged",code:"ABORT_UNCHANGED"},no={message:"Not found",code:"ERR_NOT_FOUND"},Hk={message:"Not implemented",code:"ERR_NOT_IMPLEMENTED"},ire={message:"Existing flight",code:"ERR_EXISTING_FLIGHT"},XH={message:"Existing flight profile",code:"ERR_EXISTING_FLIGHT_PROFILE"},nre={message:"Existing outcome",code:"ERR_EXISTING_OUTCOME"},rre={message:"Existing matchUpId",code:"ERR_EXISTING_MATCHUP_ID"},F2={message:"Existing stage",code:"ERR_EXISTING_STAGE"},JH={message:"Existing structure",code:"ERR_EXISTING_STRUCTURE"},oC={message:"Method not found",code:"ERR_NOT_FOUND_METHOD"},are={message:"Scheduled matchUps",code:"ERR_SCHEDULED_MATCHUPS"},zk={message:"Scores present",code:"ERR_SCORES_PRESENT"},ore={ANACHRONISM:M2,CANNOT_CHANGE_WINNING_SIDE:VH,CANNOT_MODIFY_TIEFORMAT:$H,CANNOT_MODIFY_PARTICIPANT_TYPE:Rne,CANNOT_REMOVE_MAIN_STRUCTURE:Qie,CANNOT_REMOVE_PARTICIPANTS:Bk,CATEGORY_MISMATCH:x2,COURT_EXISTS:Gne,COURT_NOT_FOUND:ST,DRAW_DEFINITION_NOT_FOUND:Zl,DRAW_ID_EXISTS:nne,DRAW_POSITION_ACTIVE:kk,DRAW_POSITION_ASSIGNED:Q0,DRAW_POSITION_NOT_CLEARED:ine,DRAW_POSITION_NOT_FOUND:sPe,DRAW_SIZE_MISMATCH:MH,DUPLICATE_ENTRY:bD,DUPLICATE_VALUE:ere,ENTRY_STATUS_NOT_ALLOWED_FOR_EVENT:Bne,ENTRY_STATUS_NOT_ALLOWED_IN_STAGE:Fne,EVENT_EXISTS:hne,EVENT_NOT_FOUND:Xl,EXISTING_DRAW_DEFINITIONS:ene,EXISTING_END_TIME:zH,EXISTING_FLIGHT:ire,EXISTING_MATCHUP_ID:rre,EXISTING_OUTCOME:nre,EXISTING_PARTICIPANT_DRAW_POSITION_ASSIGNMENT:wT,EXISTING_PARTICIPANT:$k,EXISTING_POLICY_TYPE:FH,EXISTING_PROFILE:XH,EXISTING_ROUND:dne,EXISTING_STAGE:F2,EXISTING_STRUCTURE:JH,INCOMPATIBLE_MATCHUP_STATUS:fN,INCOMPLETE_SOURCE_STRUCTURE:EH,INSUFFICIENT_DRAW_POSITIONS:GH,INVALID_ACTION:sne,INVALID_ASSIGNMENT:A2,INVALID_BOOKINGS:fA,INVALID_CATEGORY:ID,INVALID_COLLECTION_DEFINITION:Qne,INVALID_CONFIGURATION:Jne,INVALID_DATE_AVAILABILITY:mN,INVALID_DATE:Xa,INVALID_DRAW_DEFINITION:Ib,INVALID_DRAW_POSITION_FOR_SEEDING:CH,INVALID_DRAW_POSITION:vT,INVALID_DRAW_SIZE:xk,INVALID_END_TIME:zne,INVALID_ENTRIES:mne,INVALID_EVENT_TYPE:ph,INVALID_GAME_SCORES:k2,INVALID_GENDER:A1,INVALID_MATCHUP_FORMAT:kH,INVALID_MATCHUP_STATUS:bT,INVALID_MATCHUP_STATUS_BYE:bne,INVALID_MATCHUP:al,INVALID_OBJECT:Jf,INVALID_PARTICIPANT_ID:vd,INVALID_PARTICIPANT_IDS:Ul,INVALID_PARTICIPANT_ROLE:Mne,INVALID_PARTICIPANT_SEEDING:rne,INVALID_PARTICIPANT_TYPE:yd,INVALID_PARTICIPANT:MI,INVALID_POLICY_DEFINITION:Sne,INVALID_RECORDS:N2,INVALID_SCALE_ITEM:aC,INVALID_SEED_NUMBER:cne,INVALID_SEED_POSITION:une,INVALID_SET_NUMBER:hPe,INVALID_SIDE_NUMBER:BH,INVALID_SCORE:Pne,INVALID_STAGE:vy,INVALID_START_TIME:Wne,INVALID_STRUCTURE:my,INVALID_STOP_TIME:qne,INVALID_TIE_FORMAT:mf,INVALID_TIME:su,INVALID_TIME_ITEM:qH,INVALID_TOURNAMENT_DATES:Cne,INVALID_TOURNAMENT_RECORD:eC,INVALID_VALUES:Re,INVALID_WINNING_SIDE:Fk,MATCHUP_NOT_FOUND:Ho,METHOD_NOT_FOUND:oC,MISSING_ASSIGNMENTS:_H,MISSING_ASYNC_STATE_PROVIDER:Kne,MISSING_AVOIDANCE_POLICY:wne,MISSING_BIRTH_DATE:Tne,MISSING_COLLECTION_DEFINITION:Ine,MISSING_COURT_ID:RI,MISSING_COURTS_INFO:jne,MISSING_DATE_AVAILABILITY:Ene,MISSING_DATE:Une,MISSING_DRAW_DEFINITION:Vt,MISSING_DRAW_ID:Pd,MISSING_DRAW_POSITION:yT,MISSING_DRAW_POSITIONS:tC,MISSING_DRAW_SIZE:iC,MISSING_ENTRIES:fne,MISSING_EVENT:Qn,MISSING_MATCHUP_FORMAT:xH,MISSING_MATCHUP_ID:ss,MISSING_MATCHUP_IDS:PI,MISSING_MATCHUP:rl,MISSING_MATCHUPS:Xf,MISSING_PARTICIPANT_COUNT:kne,MISSING_PARTICIPANT_ID:ya,MISSING_PARTICIPANT_IDS:Ig,MISSING_PARTICIPANT_ROLE:Nne,MISSING_PARTICIPANT:NI,MISSING_PARTICIPANTS:rC,MISSING_PENALTY_ID:HH,MISSING_PENALTY_TYPE:Vne,MISSING_PERSON_DETAILS:One,MISSING_POLICY_ATTRIBUTES:LH,MISSING_POLICY_DEFINITION:Ok,MISSING_POLICY_TYPE:OH,MISSING_POSITION_ASSIGNMENTS:yne,MISSING_ROUND_NUMBER:cPe,MISSING_SCHEDULE:Yne,MISSING_SCORING_POLICY:pPe,MISSING_SEED_ASSIGNMENTS:lne,MISSING_SEEDCOUNT_THRESHOLDS:one,MISSING_SEEDING_POLICY:uPe,MISSING_SET_NUMBER:fPe,MISSING_SET_OBJECT:Lk,MISSING_SIDE_NUMBER:mPe,MISSING_STAGE:gne,MISSING_STRUCTURE_ID:nc,MISSING_STRUCTURE:gy,MISSING_STRUCTURES:AH,MISSING_TARGET_LINK:NH,MISSING_TIE_FORMAT:IT,MISSING_TIME_ITEM:WH,MISSING_TIME_ITEMS:KH,MISSING_TOURNAMENT_ID:J0,MISSING_TOURNAMENT_RECORD:ut,MISSING_TOURNAMENT_RECORDS:Sr,MISSING_VALUE:Yt,MISSING_VENUE_ID:wg,MODIFICATIONS_FAILED:Zne,NO_CANDIDATES:jk,NO_DRAW_POSITIONS_AVAILABLE_FOR_QUALIFIERS:$ne,NO_MODIFICATIONS_APPLIED:TT,NO_STAGE_SPACE_AVAILABLE_FOR_ENTRY_STATUS:L2,NO_PARTICIPANT_REMOVED:_ne,NO_VALID_ACTIONS:tre,NO_VALID_ATTRIBUTES:Gk,NO_VALID_DATES:Dne,NOT_FOUND:no,NOT_IMPLEMENTED:Hk,PARTICIPANT_COUNT_EXCEEDS_DRAW_SIZE:jH,PARTICIPANT_ID_EXISTS:Ane,PARTICIPANT_NOT_CHECKED_IN:xne,PARTICIPANT_NOT_FOUND:Vr,PARTICIPANT_PAIR_EXISTS:vPe,PENALTY_NOT_FOUND:eS,POLICY_NOT_ATTACHED:dPe,POLICY_NOT_FOUND:wb,SCHEDULE_NOT_CLEARED:tne,SCHEDULED_MATCHUPS:are,SCORES_PRESENT:zk,SEEDSCOUNT_GREATER_THAN_DRAW_SIZE:ane,STAGE_SEQUENCE_LIMIT:vne,STRUCTURE_NOT_FOUND:wr,TEAM_NOT_FOUND:YH,UNABLE_TO_ASSIGN_COURT:Xne,UNLINKED_STRUCTURES:pne,UNRECOGNIZED_DRAW_TYPE:PH,UNRECOGNIZED_MATCHUP_FORMAT:nC,UNRECOGNIZED_MATCHUP_STATUS:_2,VALUE_UNCHANGED:ZH,VENUE_EXISTS:Hne},pr={disableNotifications:!1,tournamentId:void 0,tournamentRecords:{},subscriptions:{},modified:!1,methods:{},notices:[]},sre={addNotice:APe,callListener:LPe,cycleMutationStatus:NPe,deleteNotice:xPe,deleteNotices:kPe,disableNotifications:wPe,enableNotifications:SPe,getMethods:qk,getNotices:_Pe,getTopics:OPe,getTournamentId:lre,getTournamentRecord:TPe,getTournamentRecords:UPe,removeTournamentRecord:PPe,setMethods:MPe,setSubscriptions:RPe,setTournamentId:EPe,setTournamentRecord:DPe,setTournamentRecords:CPe,handleCaughtError:FPe};function wPe(){pr.disableNotifications=!0}function SPe(){pr.disableNotifications=!1}function lre(){return pr.tournamentId}function TPe(t){return pr.tournamentRecords[t]}function UPe(){return pr.tournamentRecords}function DPe(t){let e=t==null?void 0:t.tournamentId;return e?(pr.tournamentRecords[e]=t,{success:!0}):{error:eC}}function EPe(t){return t?pr.tournamentRecords[t]?(pr.tournamentId=t,{success:!0}):{error:ut}:(pr.tournamentId=void 0,{success:!0})}function CPe(t){pr.tournamentRecords=t;let e=Object.keys(t);e.length===1?pr.tournamentId=e[0]:e.length||(pr.tournamentId=void 0)}function PPe(t){if(typeof t!="string")return{error:Re};if(!pr.tournamentRecords[t])return{error:no};delete pr.tournamentRecords[t];let e=Object.keys(pr.tournamentRecords);return e.length===1?pr.tournamentId=e[0]:e.length||(pr.tournamentId=void 0),{success:!0}}function RPe(t){return typeof t.subscriptions!="object"?{error:Re}:(Object.keys(t.subscriptions).forEach(e=>{typeof t.subscriptions[e]=="function"?pr.subscriptions[e]=t.subscriptions[e]:delete pr.subscriptions[e]}),{...ce})}function MPe(t){return typeof t!="object"?{error:Re}:(Object.keys(t).forEach(e=>{typeof t[e]=="function"&&(pr.methods[e]=t[e])}),{...ce})}function NPe(){let t=pr.modified;return pr.modified=!1,t}function APe({topic:t,payload:e,key:i},n){if(!(typeof t!="string"||typeof e!="object")&&(pr.disableNotifications||(pr.modified=!0),!(pr.disableNotifications||!pr.subscriptions[t]&&!n)))return i&&(pr.notices=pr.notices.filter(r=>!(r.topic===t&&r.key===i))),pr.notices.push({topic:t,payload:e,key:i}),{...ce}}function qk(){return pr.methods??{}}function _Pe({topic:t}){return pr.notices.filter(e=>e.topic===t).map(e=>e.payload)}function kPe(){pr.notices=[]}function xPe({topic:t,key:e}){pr.notices=pr.notices.filter(i=>(!t||i.topic===t)&&i.key!==e)}function OPe(){return{topics:Object.keys(pr.subscriptions)}}function LPe({topic:t,notices:e},i){let n=pr.subscriptions[t];n&&typeof n=="function"&&n(e);let r=i==null?void 0:i[t];r&&typeof r=="function"&&r(e)}function FPe({engineName:t,methodName:e,params:i,err:n}){let r;return typeof n=="string"?r=n.toUpperCase():n instanceof Error&&(r=n.message),console.log("ERROR",{tournamentId:lre(),params:JSON.stringify(i),engine:t,methodName:e,error:r}),{error:r}}function ma(t,e){return(t??0)-(e??0)}function ri(t){return typeof t=="number"?parseInt(t.toString()):typeof t=="string"?parseInt(t):0}function bd(t){return isNaN(t)?!1:t&&(t&t-1)===0}function LK(t){if(!t.length)return;let e=[...t].sort(ma),i=Math.floor(e.length/2);return e.length%2?e[i]:(e[i-1]+e[i])/2}function BPe(t){if(!bd(t))return!1;let e=t,i=1;for(;e!==2;)i+=1,e=e/2;return i}function QH(t){return isNaN(t)?0:t%2&&t+1||t}function ez(t){return Math.pow(2,Math.round(Math.log(t)/Math.log(2)))}function Rr(t){return!isNaN(parseFloat(t))}function cre(t){let e=ri(t);if(!isNaN(e))return e===0?!1:(e&-e)===1}function UT(t){if(isNaN(t))return!1;for(;!bd(t);)t++;return t}function yc(t,e){return t=Math.ceil(t),e=Math.floor(e),Math.floor(Math.random()*(e-t+1))+t}function yi(t){return Number.isSafeInteger(typeof t=="string"?+t:t)}function $Pe(t=1,e=3,i=!0){let n=0;for(let r=0;r<e;r++)n+=Math.random()*(t/e);return i&&t>1?Math.round(n):n}function VPe(t,e){e||(e=1);let i=1/e;return Math.round(t*i)/i}function ure(t,e,i,n,r=2){let a=1-Math.random(),o=1-Math.random(),s=Math.sqrt(-2*Math.log(a))*Math.cos(2*Math.PI*o);return s=s/10+.5,s>1||s<0?s=ure(t,e,i):(s=Math.pow(s,i),s*=e-t,s+=t),n&&(s=VPe(s,n)),parseFloat(s.toFixed(r))}function mA(t,e=2){return parseFloat(Number(Math.round(t*1e3)/1e3).toFixed(e))}function Pi(t){return Array.isArray(t)?t==null?void 0:t.filter((e,i,n)=>n.lastIndexOf(e)===i):[]}function jPe(t){return Array.isArray(t)?t==null?void 0:t.map(e=>e===null?void 0:e):t}function bs(t){return Array.isArray(t)?t.map(e=>[Math.random(),e]).sort((e,i)=>e[0]-i[0]).map(e=>e[1]):[]}function tS(t){return yi(t)?t:1/0}function Pl(t){return Array.isArray(t)?t.reduce((e,i)=>(e[i]||(e[i]=0),e[i]++,e),{}):{}}function GPe(t){return dre(Pl(t))}function dre(t){return Object.keys(t).reduce((e,i)=>{let n=t[i];return e[n]?e[n].push(i):e[n]=[i],e},{})}function HPe(t,e,i){return i.indexOf(t)===e}function pre(t){return t.filter(HPe)}function Sl(t){return Array.isArray(t)&&t.length?t.splice(Math.floor(Math.random()*t.length),1)[0]:void 0}function Il(t){let e=Math.floor(Math.random()*t.length);return t[e]}function Et(t,e){return Array.from({length:e-t},(i,n)=>n+t)}function Qd(t,e){return e.reduce((i,n,r)=>(n===t&&i.push(r),i),[])}function zr(t,e){return!Array.isArray(t)||!Array.isArray(e)?[]:t.filter(i=>e.indexOf(i)!==-1).filter((i,n,r)=>r.indexOf(i)===n)}function FK(t,e){return!Array.isArray(t)||!Array.isArray(e)?[]:t.filter(i=>!e.includes(i))}function Ts(t,e){return!Array.isArray(t)||!Array.isArray(e)?!1:t.some(i=>e.includes(i))}function zPe(t,e){return Array.isArray(e)&&e.reduce((i,n)=>(i[n]=1+i[n]||1,i),{})[t]||0}function qPe(t,e,i,n){return Array.isArray(t)?[].concat(...t.slice(0,e),...t.slice(e,e+i).sort(n),...t.slice(e+i,t.length)):[]}function ro(t,e){return Array.isArray(t)?t.reduce((i,n,r)=>{let a=Math.floor(r/e);return i[a]=[].concat(i[a]||[],n),i},[]):[]}function hre(t,[e,...i]){return t.length?[t.slice(0,e),...hre(t.slice(e),[...i,e])]:[]}function WPe(t){return t.reduce((e,i)=>{let n=e[e.length-1];return(!n||n[n.length-1]!==i-1)&&e.push([]),e[e.length-1].push(i),e},[])}function fre(t){return Array.isArray(t)?t.reduce((e,i)=>!isNaN(parseInt(i))&&e,!0):!1}function mre(t){return Array.isArray(t)?t.reduce((e,i)=>isNaN(parseInt(i))&&e,!0):!1}function B2(t,e,i){return Array.isArray(t)?t.reduce((n,r,a)=>{let o=i?!!(Math.floor(a/e)%2):!1,s=a%e,l=o?e-1-s:s;return n[l]||(n[l]=[]),n[l].push(r),n},[]):[]}function KPe(t,e=1){if(!Array.isArray(t)||!t.every(yi))return[];let i=Math.min(...t,e),n=Math.max(...t);return Et(i,n+1).filter(r=>!t.includes(r))}var Bn={timers:{default:{elapsedTime:0}},globalSubscriptions:{},deepCopyAttributes:{stringify:[],ignore:[],toJSON:[]},globalMethods:[],deepCopy:!0},ao=sre,BK=["addNotice","callListener","cycleMutationStatus","deleteNotice","deleteNotices","disableNotifications","enableNotifications","getMethods","getNotices","getTopics","getTournamentId","getTournamentRecord","getTournamentRecords","removeTournamentRecord","setSubscriptions","setTournamentId","setTournamentRecord","setTournamentRecords"];function YPe(t){if(typeof t!="object")throw new Error("Global state provider can not be undefined or null");if(zr(Object.keys(t),BK).length!==BK.length)throw new Error("Global state provider is missing required methods");return ao=t,{success:!0}}function gre(){if(ao.createInstanceState){try{ao.createInstanceState()}catch(t){return{error:t}}return{success:!0}}else return{error:Kne}}function Jl(t){return!t||typeof t!="object"?Bn.devContext??!1:typeof Bn.devContext!="object"?!1:Object.keys(t).every(e=>{var i;return((i=Bn.devContext)==null?void 0:i[e])===t[e]})&&Bn.devContext}function ZPe(t="reset",e="default"){var n,r;let i=Date.now();if(t==="report"){if(e==="allTimers")return Object.keys(Bn.timers).filter(a=>a!=="default"||Bn.timers[a].startTime).map(a=>{let o=Bn.timers[a],s=o.state==="stopped"?0:(i-((o==null?void 0:o.startTime)??0))/1e3,l=o.elapsedTime+s;return{state:Bn.timers[a].state,elapsedTime:l.toFixed(2),timer:a}});{let a=Bn.timers[e].state==="stopped"?0:(i-(((n=Bn.timers[e])==null?void 0:n.startTime)??0))/1e3,o=Bn.timers[e].elapsedTime+a;return{state:Bn.timers[e].state,elapsedTime:o.toFixed(2),timer:e}}}if(!Bn.timers[e]||t==="reset"){if(e==="allTimers")return Bn.timers={default:{elapsedTime:0}},!0;Bn.timers[e]={startTime:i,state:"active",elapsedTime:0}}return Bn.timers[e].elapsedTime||(Bn.timers[e].elapsedTime=0),t==="stop"&&Bn.timers[e].state!=="stopped"&&(Bn.timers[e].state="stopped")&&(Bn.timers[e].elapsedTime+=(i-(((r=Bn.timers[e])==null?void 0:r.startTime)??0))/1e3),t==="start"&&(Bn.timers[e].startTime=i)&&(Bn.timers[e].state="active"),Bn.timers[e]}function vre(t){Gs(t)?Bn.globalLog=t:delete Bn.globalLog}function wD(t){Bn.devContext=t}function yre(){ao.disableNotifications()}function gN(){ao.enableNotifications()}function SD(t,e){typeof t=="boolean"&&(Bn.deepCopy=t),typeof e=="object"&&(Array.isArray(e.ignore)&&(Bn.deepCopyAttributes.ignore=e.ignore),Array.isArray(e.toJSON)&&(Bn.deepCopyAttributes.toJSON=e.toJSON),Array.isArray(e.stringify)&&(Bn.deepCopyAttributes.stringify=e.stringify),e.threshold&&(Bn.deepCopyAttributes.threshold=e.threshold))}function tz(){return{enabled:Bn.deepCopy,...Bn.deepCopyAttributes}}function XPe(t){return t!=null&&t.subscriptions?(Object.keys(t.subscriptions).forEach(e=>{Bn.globalSubscriptions[e]=t.subscriptions[e]}),{...ce}):{error:Yt,info:"missing subscriptions"}}function JPe(t){return t!=null&&t.subscriptions?ao.setSubscriptions({subscriptions:t.subscriptions}):{error:Yt,info:"missing subscriptions"}}function bre(t){return t?typeof t!="object"?{error:Re}:(Object.keys(t).forEach(e=>{Gs(t[e])&&(Bn.globalMethods[e]=t[e])}),{...ce}):{error:Yt,info:"missing method declarations"}}function Ire(t){return t?typeof t!="object"?{error:Re}:ao.setMethods(t):{error:Yt,info:"missing method declarations"}}function iz(){return ao.cycleMutationStatus()}function wi(t){if(typeof(t==null?void 0:t.topic)!="string")return;let e=Bn.globalSubscriptions[t.topic];return ao.addNotice(t,e)}function nz(){return{...Bn.globalMethods,...ao.getMethods()}}function rz(t){return ao.getNotices(t)}function az({key:t,topic:e}){return ao.deleteNotice({key:t,topic:e})}function _I(){return ao.deleteNotices()}function rc(){return ao.getTopics()}function Wk(t){var e,i;return(i=(e=rc())==null?void 0:e.topics)==null?void 0:i.includes(t)}async function TD(t){return ao.callListener(t,Bn.globalSubscriptions)}function kI(){return ao.getTournamentId()}function oz(t){return ao.getTournamentRecord(t)}function Sg(){return ao.getTournamentRecords()}function wre(t){return ao.setTournamentRecord(t)}function Kk(t){return ao.setTournamentRecords(t)}function UD(t){return ao.setTournamentId(t)}function Sre(t){return ao.removeTournamentRecord(t)}function $2(){return ao}function Yk({engineName:t,methodName:e,params:i,err:n}){return(Gs(ao.handleCaughtError)&&ao.handleCaughtError||sre.handleCaughtError)({engineName:t,methodName:e,params:i,err:n})}function Tre(t,e){if(Bn.globalLog)try{Bn.globalLog({log:t,engine:e})}catch(i){console.log("globalLog error",i),console.log(e,t),vre()}else console.log(e,t)}function Ure(t,e,i,n){if(!Xi(t))return{error:Re};Rr||(i=1);let r=Array.isArray(e)?e:[],a={},o=(s,l=0)=>{Object.keys(s).forEach(c=>{Gs(s[c])?a[c]=s[c]:Xi(s[c])&&(e===!0||r!=null&&r.includes(c))&&(i===void 0||l<i)&&o(s[c],l+1)})};return o(t),n?bre(a):Ire(a),{methods:a}}function QPe(t,e,i){return Object.keys(t).filter(n=>!e.includes(t[n])&&(!i||(Array.isArray(t[n])?t[n].length:!0)))}function zt(t,e,i,n){var o;if(typeof t!="object"||t===null)return t;(o=tz())!=null&&o.enabled||(n=!0);let r=["",void 0,null];e&&r.push(!1);let a=QPe(t,r,i);return Object.assign({},...a.map(s=>Array.isArray(t[s])?{[s]:n?t[s]:t[s].map(l=>zt(l))}:{[s]:n?t[s]:zt(t[s])}))}function pe({context:t,result:e,stack:i,info:n}){return e&&!Array.isArray(e==null?void 0:e.stack)&&(e.stack=[]),e&&Array.isArray(e==null?void 0:e.stack)&&typeof i=="string"&&e.stack.push(i),e&&n&&(e.info=n),e&&typeof t=="object"&&Object.keys(t).length&&Object.assign(e,zt(t)),e&&!(e!=null&&e.error)&&!(e!=null&&e.success)&&Object.assign(e,{...ce}),e??{success:!0}}var iS="resourceSubType",nS="resourceType",rS="identifier",Dre={RESOURCE_SUB_TYPE:iS,RESOURCE_TYPE:nS,IDENTIFIER:rS},cp="SINGLES",qb="SINGLES",Oc="DOUBLES",Gm="DOUBLES",ga="TEAM",Lc="TEAM",eRe="AGE",tRe="RATING",iRe="BOTH",pl={AGE:eRe,BOTH:iRe,DOUBLES:Oc,DOUBLES_EVENT:Gm,RATING:tRe,SINGLES:cp,SINGLES_EVENT:qb,TEAM_EVENT:Lc,TEAM:ga},xt="MAIN",Zt="QUALIFYING",Po="CONSOLATION",Ja="VOLUNTARY_CONSOLATION",Fr="PLAY_OFF",Zk=[xt,Zt,Po,Fr,Ja],Wb={[Zt]:1,[xt]:2,[Fr]:3,[Po]:3,[Ja]:4},Ere="finishingPositions",Cre="aggregateEventStructures",Pre={[xt]:1,[Fr]:2,[Po]:3,[Zt]:4,[Ja]:5},nRe={[Fr]:1,[xt]:2,[Po]:3,[Zt]:4,[Ja]:5},Xk="CLUSTER",rRe="SEPARATE",Lv="WATERFALL",Jk="ITEM",As="CONTAINER",pu="DRAW",Qk="RANDOM",fu="TOP_DOWN",Fv="BOTTOM_UP",Uf="POSITION",Df="WINNER",hh="LOSER",fh="FIRST_MATCHUP",Fc="AD_HOC",aRe="AD_HOC",DT="FEED_IN",aS="COMPASS",oS="OLYMPIC",oRe="SINGLE_ELIMINATION",ep="SINGLE_ELIMINATION",sC="DOUBLE_ELIMINATION",sS="FIRST_MATCH_LOSER_CONSOLATION",lC="FIRST_ROUND_LOSER_CONSOLATION",yy="LUCKY_DRAW",ex="CURTIS_CONSOLATION",sRe="CURTIS_CONSOLATION",sz="FEED_IN_CHAMPIONSHIP_TO_SF",DD="FEED_IN_CHAMPIONSHIP_TO_SF",lz="FEED_IN_CHAMPIONSHIP_TO_QF",ED="FEED_IN_CHAMPIONSHIP_TO_QF",cz="FEED_IN_CHAMPIONSHIP_TO_R16",CD="FEED_IN_CHAMPIONSHIP_TO_R16",Rre="MODIFIED_FEED_IN_CHAMPIONSHIP",PD="MODIFIED_FEED_IN_CHAMPIONSHIP",cC="FEED_IN_CHAMPIONSHIP",lRe="DOUBLE_ROUND_ROBIN",Cu="ROUND_ROBIN",mh="ROUND_ROBIN_WITH_PLAYOFF",Mre="DECIDER",Nre="BACKDRAW",uz={0:{name:"East",abbreviation:"E"},"0-1":{name:"West",abbreviation:"W"},"0-2":{name:"North",abbreviation:"N"},"0-3":{name:"Northeast",abbreviation:"NE"},"0-1-1":{name:"South",abbreviation:"S"},"0-1-2":{name:"Southwest",abbreviation:"SW"},"0-2-1":{name:"Northwest",abbreviation:"NW"},"0-1-1-1":{name:"Southeast",abbreviation:"SE"}},dz={0:{name:"East",abbreviation:"E"},"0-1":{name:"West",abbreviation:"W"},"0-2":{name:"North",abbreviation:"N"},"0-1-1":{name:"South",abbreviation:"S"}},ET="WIN_RATIO",xI="ROUND_OUTCOME",Are=[aS,ex,ED,CD,DD,cC,lz,cz,sz,sS,lC,yy,PD,oS,Fr,mh],cRe=[Fc,aS,ex,sC,ED,CD,DD,cC,DT,sS,lC,yy,PD,oS,Fr,Cu,mh,ep],pa={MAIN:xt,QUALIFYING:Zt,CONSOLATION:Po,ITEM:Jk,CONTAINER:As,FIRST_MATCHUP:fh,WINNER:Df,LOSER:hh,AD_HOC:Fc,FEED_IN:DT,FLEX_ROUNDS:aRe,COMPASS:aS,PLAY_OFF:Fr,OLYMPIC:oS,KNOCKOUT:oRe,SINGLE_ELIMINATION:ep,DOUBLE_ELIMINATION:sC,CURTIS:ex,FICSF:sz,FICQF:lz,FICR16:cz,MFIC:Rre,VOLUNTARY_CONSOLATION:Ja,FIRST_MATCH_LOSER_CONSOLATION:sS,FIRST_ROUND_LOSER_CONSOLATION:lC,MODIFIED_FEED_IN_CHAMPIONSHIP:PD,FEED_IN_CHAMPIONSHIP_TO_R16:CD,FEED_IN_CHAMPIONSHIP_TO_QF:ED,FEED_IN_CHAMPIONSHIP_TO_SF:DD,FEED_IN_CHAMPIONSHIP:cC,LUCKY_DRAW:yy,ROUND_ROBIN_WITH_PLAYOFF:mh,ROUND_ROBIN:Cu,DECIDER:Mre,BACKDRAW:Nre,COMPASS_ATTRIBUTES:uz,OLYMPIC_ATTRIBUTES:dz,DRAW:pu,RANDOM:Qk,TOP_DOWN:fu,BOTTOM_UP:Fv,WATERFALL:Lv,WIN_RATIO:ET,ROUND_OUTCOME:xI,MULTI_STRUCTURE_DRAWS:Are,generatedDrawTypes:cRe,stageOrder:Wb,finishOrder:Pre,AGGREGATE_EVENT_STRUCTURES:Cre,FINISHING_POSITIONS:Ere},uRe=pa,zo="tournamentRecords",pz="policyDefinitions",ls="tournamentRecord",hz="onlineResource",_s="drawDefinition",fz="matchUpFormat",gh="participantId",_re="scheduleDates",dRe="tournamentId",pRe="scheduleDate",hRe="roundNumber",tx="structureId",mz="participant",uC="matchUpIds",kre="entryStage",fRe="policyType",xre="structures",Cp="matchUpId",gz="eventType",ix="inContext",nx="structure",rx="courtIds",mRe="personId",ax="venueIds",Ore="matchUps",Lre="courtId",Fre="eventId",_h="matchUp",Bre="drawId",Jp="error",by="event",CT="param",gRe="uuids",vRe="averageMatchUpMinutes",yRe="recoveryMinutes",bRe="periodLength",IRe="number",vl="object",gs="array",$o="_validate",$re="_message",Ql="_invalid",$l="_ofType",Vre="_anyOf",RD="_oneOf",$K={[gz]:t=>[cp,Oc,ga].includes(t),[hz]:t=>zr(Object.keys(t),[iS,nS,rS]).length===3,[kre]:t=>Zk.includes(t)},wRe={[zo]:Sr,[ls]:ut,[pz]:Ok,[_s]:Vt,[gh]:ya,[fz]:xH,[dRe]:J0,[tx]:nc,[uC]:PI,[mz]:NI,[hz]:Jf,[gz]:ph,[xre]:AH,[Cp]:ss,[nx]:gy,[Lre]:RI,[Ore]:Xf,[Fre]:Xl,[_h]:rl,[rx]:Yt,[ax]:Yt,[Bre]:Pd,[by]:Qn},SRe={[zo]:vl,[pz]:vl,[ls]:vl,[_s]:vl,[hz]:vl,[_re]:gs,[mz]:vl,[uC]:gs,[xre]:gs,[nx]:vl,[rx]:gs,[ax]:gs,[Ore]:gs,[_h]:vl,[by]:vl,[gRe]:gs};function di(t,e,i){if(!t&&!Xi(t))return{error:Re};if(!(e!=null&&e.length)||t!=null&&t._bypassParamCheck)return{valid:!0};if(!Array.isArray(e))return{error:Re};let{paramError:n,errorParam:r}=DRe(t,e);if(!n)return{valid:!0};let a=(t==null?void 0:t[r])===void 0?wRe[r]||n[Jp]||n[Ql]||Re:n[$o]&&(n[Jp]||n[Ql])||Re,o=r??(n[RD]&&Object.keys(n[RD]).join(", "));return pe({info:{param:o,message:n[$re]},result:{error:a},stack:i})}function jre(t,e){let i=Object.keys(t),n=Object.keys(e);return zr(i,n)}function TRe(t,e){if(!e)return;let i=jre(t,e);return i.length!==1?{error:Re}:i.reduce((n,r)=>({...n,[r]:!0}),{})}function URe(t,e){if(!e)return;let i=jre(t,e).filter(n=>t[n]);return i.length<1?{error:Re}:i.reduce((n,r)=>({...n,[r]:!0}),{})}function DRe(t,e){let i,n;return{paramError:e.find(({_ofType:r,_oneOf:a,_anyOf:o,_validate:s,_info:l,...c})=>{let u=a&&TRe(t,a);if(u!=null&&u.error)return u.error;u&&Object.assign(c,u);let d=o&&URe(t,o);if(d!=null&&d.error)return d.error;d&&Object.assign(c,d);let p=Object.keys(c).filter(f=>typeof c[f]=="boolean"),h=p.find(f=>{let m=s&&!Gs(s),g=t[f]!==void 0&&!s&&ERe(t,f,r),v=c[f]&&[void 0,null].includes(t[f]),y=m||g||v||s&&t[f]!==void 0&&!CRe(t[f],s)||$K[f]&&!$K[f](t[f]);return y&&(i=f,n=l),y});return!p.length||h}),errorParam:i,paramInfo:n}}function ERe(t,e,i){return i=i||SRe[e]||"string",i==="array"?!Array.isArray(t[e]):typeof t[e]!==i}function CRe(t,e){return Gs(e)?e(t):!0}var vz="DYNAMIC",Hm="RANKING",Lm="RATING",Bv="SCALE",Qp="SEEDING",PT={RANKING:Hm,RATING:Lm,SCALE:Bv,SEEDING:Qp};function RT(t){var r;let e=di(t,[{[mz]:!0}]);if(e.error)return e;let i=(r=t.participant.timeItems)==null?void 0:r.filter(({itemType:a})=>(a==null?void 0:a.startsWith(Bv))&&[Hm,Lm,Qp].includes(a.split(".")[1])),n={ratings:{},rankings:{},seedings:{}};if(i!=null&&i.length){let a=s=>i.filter(l=>(l==null?void 0:l.itemType)===s).sort((l,c)=>new Date(l.createdAt||void 0).getTime()-new Date(c.createdAt||void 0).getTime()).pop(),o=Pi(i.map(({itemType:s})=>s));for(let s of o){let l=a(s);if(l){let[,c,u,d,p]=l.itemType.split("."),h=p?`${d}.${p}`:d,f=c===Qp&&"seedings"||c===Hm&&"rankings"||"ratings";n[f][u]||(n[f][u]=[]),n[f][u].push({scaleValue:l.itemValue,scaleDate:l.itemDate,scaleName:h})}}}return{...ce,...n}}function Kb(t){if(t===null)return{};let{source:e,template:i}=t||{};if(!i)return e;let n={};return r(e,i,n),n;function r(a,o,s){if(!a||!o)return;let l=Object.keys(a),c=Object.keys(o),u=Object.assign({},...c.filter(h=>h.indexOf("||")).map(h=>h.split("||").map(f=>({[f]:h}))).flat()),d=c.concat(...Object.keys(u)),p=d.includes("*");for(let h of l)if(d.indexOf(h)>=0||p){let f=u[h]||h,m=o[f]||p,g=a[h];if(typeof m=="object"&&typeof g!="function"&&!Array.isArray(m))if(Array.isArray(g)){let v=g.map(y=>{let b={};return r(y,m,b)!==!1?b:void 0}).filter(Boolean);s[h]=v}else g&&(s[h]={},r(g,m,s[h]));else{let v=a[h];if(Array.isArray(m)&&!m.includes(v))return!1;(o[h]||p&&o[h]!==!1)&&(s[h]=v)}}}}var gA=/^[\d]{4}-(0[1-9]|1[0-2])-(0[1-9]|[1-2][\d]|3[0-1])$/,Gre=/^((0[\d]|1[\d]|2[0-3]):[0-5][\d](:[0-5][\d])?)([.,][0-9]{3})?$/,up=/^([\d]{4}-(0[1-9]|1[0-2])-(0[1-9]|[1-2][\d]|3[0-1]))([ T](0[\d]|1[\d]|2[0-3]):[0-5][\d](:[0-5][\d])?)?([.,][\d]{3})?Z?$/,wv=/^([\d]{4}-(0[1-9]|1[0-2])-(0[1-9]|[1-2][\d]|3[0-1]))?([ T]?(0[\d]|1[\d]|2[0-3]):[0-5][\d](:[0-5][\d])?)?([.,][\d]{3})?Z?$/;function vA(t){let{scheduledDate:e}=t;if(!e&&t.scheduledTime&&(e=Ei(t.scheduledTime)),!e)return;let i=ir(t.scheduledTime),n=Ei(e);return n&&i&&(n+=`T${i}`),n}function PRe(t){return typeof t!="object"||Array.isArray(t)?!1:Object.prototype.toString.call(t)==="[object Date]"}function MT(t){let e=typeof t=="string"?t==null?void 0:t.split(" "):[];return t&&(e==null?void 0:e.length)>1&&!["AM","PM"].includes(e[1].toUpperCase())?!1:!!(!t||wv.test(OI(t,!0,!0)))}function Dl(t){return $v(t)||gA.test(t)}function RRe(t){let e=new Date(t),i=e.getSeconds()+60*e.getMinutes()+60*60*e.getHours();return MRe(i,{displaySeconds:!1})}function MRe(t,e){let i=parseInt(t,10),n=Math.floor(i/3600),r=Math.floor((i-n*3600)/60),a=i-n*3600-r*60;return(!e||e!=null&&e.displaySeconds?n+":"+r+":"+a:n+":"+r).split(":").map(Tc).join(":")}var yz=t=>{let e=MD(t)||$v(t)?new Date(t):new Date,i=e.getUTCMonth()+1,n=i<10?`0${i}`:`${i}`;return`${e.getUTCFullYear()}-${Tc(n)}-${Tc(e.getUTCDate())}`};function NRe(t){let e=MD(t)||$v(t)?new Date(t):new Date;return Date.UTC(e.getFullYear(),e.getMonth(),e.getDate())}function dd(t,e="-",i="YMD"){if(!t)return"";typeof t=="string"&&t.indexOf("T")<0&&(t=t+"T00:00");let n=new Date(t),r=""+(n.getMonth()+1),a=""+n.getDate(),o=n.getFullYear();return r.length<2&&(r="0"+r),a.length<2&&(a="0"+a),i==="DMY"?[a,r,o].join(e):i==="MDY"?[r,a,o].join(e):i==="YDM"?[o,a,r].join(e):i==="DYM"?[a,o,r].join(e):i==="MYD"?[r,o,a].join(e):[o,r,a].join(e)}function yA(t){let e=t?new Date(t):new Date,i=e.getTimezoneOffset();return new Date(e.getTime()-i*60*1e3)}function ARe(t){return yA(t).getTime()}function MD(t){if(typeof t=="boolean")return!1;let e=t instanceof Date&&t||!isNaN(t)&&new Date(t)||!1;return e&&!isNaN(e.valueOf())}function lS(t,e){if(!Dl(t)||!Dl(e))return[];let i=Ei(t)+"T00:00",n=Ei(e)+"T00:00",r=new Date(i),a=new Date(n),o=MD(a)&&MD(r)&&c(r,a),s=[],l=0;if(o){let u=r,d=u.getTime();for(;d<=a.getTime()&&l<300;)l+=1,s.push(new Date(u)),d=u.setDate(u.getDate()+1)}return s.map(u=>dd(u));function c(u,d){return u<=d}}var _Re=/^([+-]?\d{4}(?!\d{2}\b))((-?)((0[1-9]|1[0-2])(\3([12]\d|0[1-9]|3[01]))?|W([0-4]\d|5[0-2])(-?[1-7])?|(00[1-9]|0[1-9]\d|[12]\d{2}|3([0-5]\d|6[1-6])))([T\s]((([01]\d|2[0-3])((:?)[0-5]\d)?|24:?00)([.,]\d+(?!:))?)?(\17[0-5]\d([.,]\d+)?)?([zZ]|([+-])([01]\d|2[0-3]):?([0-5]\d)?)?)?)?$/;function $v(t){return typeof t!="string"?!1:_Re.test(t)}function bz(t){if(typeof t!="string")return!1;let e=t.split("Z")[0].split(":"),i=e.every(n=>!isNaN(parseInt(n)));return!(e.length<2||!i||parseInt(e[0])>23||parseInt(e[1])>60)}function an(t){let e=ir(t);if(!e)return 0;let[i,n]=e.split(":").map(r=>parseInt(r));return i*60+n}function kRe(t){let e=Math.floor(t/60),i=t-e*60;return e>23&&(e=e%24),[Tc(e),Tc(i)].join(":")}function bA(t){return bz(t)?t.split(":").slice(0,2).map(Tc).join(":"):void 0}function ir(t){return $v(t)&&t.indexOf("T")>0?bA(t.split("T").reverse()[0]):bA(t)}function Ei(t){return $v(t)||up.test(t)?t.split("T")[0]:void 0}function v1(t,e){let i=new Date(t);return i.setDate(i.getDate()+e),Ei(i.toISOString())}function IA(t){t=typeof t!="string"?"00:00":t;let e={},i={};return{0:e.time,1:e.ampm}=t.split(" ")||[],{0:i.hours,1:i.minutes}=e.time.split(":")||[],i.ampm=e.ampm,isNaN(i.hours)||isNaN(i.minutes)||i.ampm&&!["AM","PM"].includes(i.ampm.toUpperCase())?{}:i}function xRe(t){let e=IA(t);return e.ampm&&e.hours&&(e.ampm.toLowerCase()==="pm"&&parseInt(e.hours)<12&&(e.hours=(e.hours&&parseInt(e.hours)||0)+12),e.ampm.toLowerCase()==="am"&&e.hours==="12"&&(e.hours="00")),`${e.hours||"12"}:${e.minutes||"00"}`.split(":").map(Tc).join(":")}function ORe(t){var i;let e=IA(t);if(!(typeof e=="object"&&!Object.keys(e).length))return e.ampm?t:(e.hours>12?(e.hours-=12,e.ampm="PM"):e.hours==="12"?e.ampm="PM":(e.hours==="00"&&(e.hours="12"),e.ampm="AM"),((i=e.hours)==null?void 0:i[0])==="0"&&(e.hours=e.hours.slice(1)),`${e.hours||"12"}:${e.minutes||"00"} ${e.ampm}`)}function OI(t,e,i){let n=Ei(t),r=ir(t),a=n?r:t;return t?e&&(n&&i&&t||xRe(a))||ORe(a):void 0}function Hre(t,e){let i=IA(t),n=IA(e);if(parseInt(i.hours)<parseInt(n.hours))return-1;if(parseInt(i.hours)>parseInt(n.hours))return 1;if(i.hours===n.hours){if(parseInt(i.minutes)<parseInt(n.minutes))return-1;if(parseInt(i.minutes)>parseInt(n.minutes))return 1}return 0}function zre(t,e=7){let i=Ei(t)+"T00:00",n=new Date(i),r=new Date(n.setDate(n.getDate()+e));return dd(r)}function LRe(t){return zre(t)}function FRe(t,e,i,n=!1){let r=new Date(e,0,1+(t-1)*7),a=n?0:1;return r.setDate(r.getDate()+(a-r.getDay())),dd(r,i)}function BRe(t,e,i){let n=new Date(t,0);return dd(new Date(n.setDate(e)),i)}function la(t,e=void 0){let[i,n]=(t||"00:00").split(":").map(Tc),r=yA(e).setHours(i,n,0,0);return yA(r)}function dC(t,e,i=!0){let n=new Date(t),r=(new Date(e).getTime()-n.getTime())/1e3/60;return i?Math.abs(Math.round(r)):Math.round(r)}function tl(t,e){let i=ir(t);if(!i)return"00:00";let n=isNaN(e)?0:e;return ir(Iz(la(i),n).toISOString())}function Iz(t,e){let i=new Date(t);return new Date(i.getTime()+e*6e4)}function Tc(t){return t.toString()[1]?t:"0"+t}function vh(t,e){let i=new Date(t),n=new Date(e);return i.getFullYear()===n.getFullYear()&&i.getMonth()===n.getMonth()&&i.getDate()===n.getDate()}var qre={addDays:zre,addWeek:LRe,addMinutesToTimeString:tl,convertTime:OI,getIsoDateString:vA,getUTCdateString:yz,DateHHMM:RRe,extractDate:Ei,extractTime:ir,formatDate:dd,getDateByWeek:FRe,isISODateString:$v,isDate:MD,isTimeString:bz,offsetDate:yA,offsetTime:ARe,sameDay:vh,timeStringMinutes:an,timeToDate:la,timeUTC:NRe,validTimeValue:MT,validDateString:gA,timeValidation:wv,dateValidation:up};function Ot(t,e,i,n,r=0){if($2().makeDeepCopy)return $2().makeDeepCopy(t,e,i,n);let a=tz(),{stringify:o,toJSON:s,ignore:l,modulate:c}=a||{};if(!(a!=null&&a.enabled)&&!i||typeof t!="object"||Gs(t)||t===null||typeof(a==null?void 0:a.threshold)=="number"&&r>=a.threshold)return t;let u=Array.isArray(t)?[]:{},d=Object.keys(t).filter(h=>!i||!l||Array.isArray(l)&&!l.includes(h)||Gs(l)&&!l(h)),p=(h,f)=>{u[h]=Gs(f==null?void 0:f.toString)?f.toString():JSON.stringify(f)};for(let h of d){let f=t[h],m=Gs(c)?c(f):void 0;if(m!==void 0)u[h]=m;else if(e&&h==="extensions"&&Array.isArray(f)){let g=wz(f);Object.assign(u,...g)}else n&&h==="extensions"?u[h]=[]:Array.isArray(o)&&o.includes(h)?p(h,f):Array.isArray(s)&&s.includes(h)&&Gs(f==null?void 0:f.toJSON)?u[h]=f.toJSON():f===null?u[h]=void 0:PRe(f)?u[h]=new Date(f).toISOString():u[h]=Ot(f,e,i,n,r+1)}return u}function wz(t){return t==null?void 0:t.map(e=>{let{name:i,value:n}=e;return i&&n&&{[`_${i}`]:n}}).filter(Boolean)}var V2="voluntaryConsolation",of="competitiveBands",Sz="roundRobinTally",Ef="positionActions",Qa="matchUpActions",vN="rankingPoints",cS="roundNaming",NT="participant",ND="progression",Tg="scheduling",AD="avoidance",$Re="participant",VRe="display",Bc="scoring",uu="seeding",uS="feedIn",jRe="audit",wA="draws",Iy={POLICY_TYPE_VOLUNTARY_CONSOLATION:V2,POLICY_TYPE_COMPETITIVE_BANDS:of,POLICY_TYPE_ROUND_ROBIN_TALLY:Sz,POLICY_TYPE_POSITION_ACTIONS:Ef,POLICY_TYPE_MATCHUP_ACTIONS:Qa,POLICY_TYPE_RANKING_POINTS:vN,POLICY_TYPE_ROUND_NAMING:cS,POLICY_TYPE_PARTICIPANT:NT,POLICY_TYPE_PROGRESSION:ND,POLICY_TYPE_SCHEDULING:Tg,POLICY_TYPE_AVOIDANCE:AD,POLICY_TYPE_DISPLAY:VRe,POLICY_TYPE_PRIVACY:$Re,POLICY_TYPE_FEED_IN:uS,POLICY_TYPE_SCORING:Bc,POLICY_TYPE_SEEDING:uu,POLICY_TYPE_AUDIT:jRe,POLICY_TYPE_DRAWS:wA};function zm({tournamentParticipants:t=[],policyDefinitions:e={},contextProfile:i,participantId:n,internalUse:r,personId:a}){let o=t.find(l=>n&&l.participantId===n||a&&l.person&&l.person.personId===a),s=Ot(o,!1,r);if(s){let l=e==null?void 0:e[NT];if(i!=null&&i.withScaleValues){let{ratings:c,rankings:u}=RT({participant:s});s.rankings=u,s.ratings=c}if(l!=null&&l.participant)return Kb({template:l.participant,source:s})}return s}var GRe="element required",HRe="missing name";function Is(t){if(!t||typeof t!="object")return{error:Yt};if(t.element&&typeof(t==null?void 0:t.element)!="object")return{error:Re};if(!(t!=null&&t.name))return{error:Yt,info:HRe};if(!(t!=null&&t.element)){if(t.discover&&t.tournamentRecords){for(let e of Object.keys(t.tournamentRecords)){let i=t.tournamentRecords[e],n=Is({element:i,name:t.name});if(n.error)return pe({result:n,stack:"removeExtension"})}return{...ce}}return{error:Yt,info:GRe}}return t!=null&&t.element.extensions?(t.element.extensions=t.element.extensions.filter(e=>(e==null?void 0:e.name)!==t.name),{...ce}):{...ce,info:no}}function dp({requiredAttributes:t=["name","value"],extension:e}){if(!e||typeof e!="object"||typeof e.name!="string")return!1;let i=Object.keys(e);return t.filter(n=>i.includes(n)).length===t.length}function cn(t){if(typeof t!="object")return{error:Yt};let e="addExtension";if(t!=null&&t.element&&typeof t.element!="object")return pe({result:{error:Re},stack:e});if(!dp({extension:t.extension}))return pe({result:{error:Re,info:"invalid extension"},stack:e});if(!t.element)if(t.discover&&!t.tournamentId&&t.tournamentRecords){for(let n of Object.values(t.tournamentRecords)){let r=cn({extension:t.extension,element:n});if(r.error)return pe({result:r,stack:e})}return{...ce}}else return pe({result:{error:Yt},stack:e});if(t.element.extensions||(t.element.extensions=[]),(t==null?void 0:t.creationTime)??!0){let n=new Date().toISOString();Object.assign(t.extension,{createdAt:n})}let i=t.element.extensions.find(({name:n})=>n===t.extension.name);return i?i.value=t.extension.value:t.extension.value&&t.element.extensions.push(t.extension),{...ce}}function Tz(t){return!t||typeof t!="object"?{error:Yt}:t.tournamentRecord?cn({creationTime:t.creationTime,element:t.tournamentRecord,extension:t.extension}):{error:ut}}function ox(t){return!t||typeof t!="object"?{error:Yt}:t.drawDefinition?cn({creationTime:t.creationTime,element:t.drawDefinition,extension:t.extension}):{error:Zl}}function Ug(t){return!t||typeof t!="object"?{error:Yt}:t.event?cn({creationTime:t.creationTime,extension:t.extension,element:t.event}):{error:Xl}}function Wre(t){var n;if(!t||typeof t!="object")return{error:Yt};if(!t.participantId)return{error:ya};let e=((n=t.tournamentRecord)==null?void 0:n.participants)||[],i=zm({participantId:t.participantId,tournamentParticipants:e});return i?cn({creationTime:t.creationTime,extension:t.extension,element:i}):{error:Vr}}function Uz(t){return!t||typeof t!="object"?{error:Yt}:t.tournamentRecord?Is({element:t.tournamentRecord,name:t.name}):{error:ut}}function Kre(t){return!t||typeof t!="object"?{error:Yt}:t.drawDefinition?Is({element:t.drawDefinition,name:t.name}):{error:Zl}}function sx(t){return!t||typeof t!="object"?{error:Yt}:t!=null&&t.event?Is({element:t.event,name:t.name}):{error:Xl}}function Yre(t){var n;if(!t||typeof t!="object")return{error:Yt};if(!t.participantId)return{error:ya};let e=((n=t.tournamentRecord)==null?void 0:n.participants)||[],i=zm({participantId:t.participantId,tournamentParticipants:e});return i?Is({element:i,name:t.name}):{error:Vr}}function pC({tournamentRecords:t}){return{tournamentIds:Xi(t)?Object.keys(t):[],...ce}}var zRe="extensionQueries";function Ri({discover:t,element:e,name:i,...n}){var a;if(!e||!i){if(t&&n){let o=Object.keys(n).filter(c=>typeof t=="boolean"||Array.isArray(t)&&t.includes(c)).find(c=>{var u;return Array.isArray((u=n[c])==null?void 0:u.extensions)?n[c].extensions.find(d=>(d==null?void 0:d.name)===i):!1}),s=o&&n[o];!s&&n.tournamentRecords&&(s=Object.values(n.tournamentRecords).find(c=>{var u;return(u=c.extensions)==null?void 0:u.length}));let l=(a=s==null?void 0:s.extensions)==null?void 0:a.find(c=>(c==null?void 0:c.name)===i);return{extension:l,info:l?void 0:no}}return pe({result:{error:Yt},stack:zRe})}if(!Array.isArray(e.extensions))return{info:"no extensions"};let r=e.extensions.find(o=>(o==null?void 0:o.name)===i);return{extension:r,info:r?void 0:no}}var qRe="activeSuspension",_D="appliedPolicies",Zre="context",lx="delegatedOutcome",pd="disabled",Yb="disableAutoCalc",cx="disableLinks",SA="display",Cv="drawDeletions",WRe="drawProfile",TA="entryProfile",KRe="eventProfile",YRe="eventWithdrawalRequests",ZRe="factory",Pu="flightProfile",j2="groupingAttribute",Cf="lineUps",Vv="linkedTournamentsIds",ux="matchUpHistory",Dz="participantRepresentatives",AT="personRequests",_1="positionActions",XRe="rankingPoints",JRe="registration",Pp="roundTarget",hC="scheduleLimits",Pf="scheduleTiming",Zb="schedulingProfile",QRe="statusDetail",dS="subOrder",qm="tally",k1="tieFormatModification",Pv={ACTIVE_SUSPENSION:qRe,APPLIED_POLICIES:_D,CONTEXT:Zre,DELEGATED_OUTCOME:lx,DISABLED:pd,DISABLE_LINKS:cx,DISABLE_AUTO_CALC:Yb,DISPLAY:SA,DRAW_DELETIONS:Cv,DRAW_PROFILE:WRe,ENTRY_PROFILE:TA,EVENT_PROFILE:KRe,EVENT_WITHDRAWAL_REQUESTS:YRe,FLIGHT_PROFILE:Pu,GROUPING_ATTRIBUTE:j2,LINEUPS:Cf,LINKED_TOURNAMENTS:Vv,MATCHUP_HISTORY:ux,PARTICIPANT_REPRESENTATIVES:Dz,PERSON_REQUESTS:AT,POSITION_ACTIONS:_1,RANKING_POINTS:XRe,REGISTRATION:JRe,ROUND_TARGET:Pp,SCHEDULE_LIMITS:hC,SCHEDULE_TIMING:Pf,SCHEDULING_PROFILE:Zb,STATUS_DETAIL:QRe,SUB_ORDER:dS,TALLY:qm,TIE_FORMAT_MODIFICATIONS:k1,FACTORY:ZRe},VK=[lx,pd,Yb,cx,Pu,Cf,Vv,ux,Dz,AT,Pp,hC,Pf,Zb,dS,qm,k1];function Xre({tournamentRecords:t}){if(typeof t!="object"||!Object.keys(t).length)return{error:Sr};let e=pC({tournamentRecords:t}),{tournamentIds:i}=e;return(i==null?void 0:i.length)>1?cn({tournamentRecords:t,discover:!0,extension:{name:Vv,value:{tournamentIds:i}}}):{...ce}}function Jre({tournamentRecords:t}){if(typeof t!="object"||!Object.keys(t).length)return{error:Sr};let e=Is({name:Vv,tournamentRecords:t,discover:!0});return pe({result:e,stack:"unlinkTournaments"})}function Qre({tournamentRecords:t,tournamentId:e}){if(typeof t!="object")return{error:Re};if(!e)return{error:J0};let i=pC({tournamentRecords:t}),{tournamentIds:n}=i;if(!n.includes(e))return{error:J0};let r;return n.every(a=>{var d;let o=t[a],{extension:s}=Ri({element:o,name:Vv});if(!s)return!0;let l=((d=s==null?void 0:s.value)==null?void 0:d.tournamentIds)||[];if(!(l!=null&&l.length)||l.length===1&&l.includes(e)||a===e){let p=Uz({name:Vv,tournamentRecord:o});return p.error&&(r=p.error),p.success}let c=l.filter(p=>p!==e);s.value={tournamentIds:c};let u=Tz({tournamentRecord:o,extension:s});return u.error&&(r=u.error),u.success}),r?{error:r}:{...ce}}var eae={};$i(eae,{getLinkedTournamentIds:()=>fC,getTournamentIds:()=>pC});function fC({tournamentRecords:t}){return typeof t!="object"||!Object.keys(t).length?{error:Sr}:{linkedTournamentIds:Object.assign({},...Object.keys(t).map(e=>{var o;let i=t[e],n=i==null?void 0:i.tournamentId,{extension:r}=Ri({element:i,name:Vv}),a=(((o=r==null?void 0:r.value)==null?void 0:o.tournamentIds)||[]).filter(s=>s!==n);return{[e]:a}}))}}var Ez={};$i(Ez,{adHocPositionSwap:()=>Yoe,addAdHocMatchUps:()=>jx,addDrawDefinitionTimeItem:()=>Aq,addFinishingRounds:()=>MC,addGoesTo:()=>Wv,addPlayoffStructures:()=>Vx,addQualifyingStructure:()=>Koe,addVoluntaryConsolationStage:()=>joe,addVoluntaryConsolationStructure:()=>Iq,allPlayoffPositionsFilled:()=>Mq,alternateDrawPositionAssignment:()=>Doe,assignDrawPosition:()=>Dse,assignDrawPositionBye:()=>sc,attachConsolationStructures:()=>wse,attachPlayoffStructures:()=>Yq,attachQualifyingStructure:()=>Nq,attachStructures:()=>$x,autoSeeding:()=>rOe,automatedPlayoffPositioning:()=>VC,automatedPositioning:()=>$C,checkValidEntries:()=>zx,deleteAdHocMatchUps:()=>Cse,drawMatic:()=>b3,findDrawDefinition:()=>e3,generateAdHocMatchUps:()=>qx,generateAdHocRounds:()=>y3,generateAndPopulatePlayoffStructures:()=>Wq,generateDrawDefinition:()=>lP,generateDrawMaticRound:()=>l3,generateDrawStructuresAndLinks:()=>a3,generateDrawTypeAndModifyDrawDefinition:()=>o3,generateQualifyingStructure:()=>Fq,generateVoluntaryConsolation:()=>Jse,getAssignedParticipantIds:()=>Ey,getAvailableMatchUpsCount:()=>Gx,getAvailablePlayoffProfiles:()=>GC,getDrawDefinitionTimeItem:()=>Qz,getDrawParticipantRepresentativeIds:()=>Jq,getDrawStructures:()=>Ru,getDrawTypeCoercion:()=>QC,getEligibleVoluntaryConsolationParticipants:()=>Xq,getMatchUpsMap:()=>Ao,getParticipantIdFinishingPositions:()=>Qq,getPositionAssignments:()=>GD,getPositionsPlayedOff:()=>GT,getSeedingThresholds:()=>Uq,getSeedsCount:()=>eP,getStructureSeedAssignments:()=>Vc,getTeamLineUp:()=>qv,getValidGroupSizes:()=>FC,isAdHoc:()=>sl,isCompletedStructure:()=>Xm,isValidForQualifying:()=>r3,luckyLoserDrawPositionAssignment:()=>Uoe,modifyDrawDefinition:()=>Sse,modifyDrawName:()=>Zq,modifySeedAssignment:()=>Aoe,mutate:()=>tae,positionActions:()=>n3,pruneDrawDefinition:()=>Use,qualifierDrawPositionAssignment:()=>Noe,query:()=>Mse,removeDrawPositionAssignment:()=>BD,removeRoundMatchUps:()=>Pse,removeSeededParticipant:()=>Woe,removeStructure:()=>$oe,renameStructures:()=>Boe,resetDrawDefinition:()=>Tse,resetVoluntaryConsolationStructure:()=>pae,setDrawParticipantRepresentativeIds:()=>iae,setPositionAssignments:()=>Roe,setStructureOrder:()=>Loe,setSubOrder:()=>Rse,shiftAdHocRounds:()=>Poe,swapAdHocRounds:()=>Moe,swapDrawPositionAssignments:()=>zoe,updateTeamLineUp:()=>WI,withdrawParticipantAtDrawPosition:()=>goe});var tae={};$i(tae,{adHocPositionSwap:()=>Yoe,addAdHocMatchUps:()=>jx,addDrawDefinitionTimeItem:()=>Aq,addPlayoffStructures:()=>Vx,addQualifyingStructure:()=>Koe,addVoluntaryConsolationStage:()=>joe,addVoluntaryConsolationStructure:()=>Iq,alternateDrawPositionAssignment:()=>Doe,assignDrawPosition:()=>Dse,assignDrawPositionBye:()=>sc,attachConsolationStructures:()=>wse,attachPlayoffStructures:()=>Yq,attachQualifyingStructure:()=>Nq,attachStructures:()=>$x,automatedPlayoffPositioning:()=>VC,automatedPositioning:()=>$C,deleteAdHocMatchUps:()=>Cse,luckyLoserDrawPositionAssignment:()=>Uoe,modifyDrawDefinition:()=>Sse,modifyDrawName:()=>Zq,modifySeedAssignment:()=>Aoe,pruneDrawDefinition:()=>Use,qualifierDrawPositionAssignment:()=>Noe,removeDrawPositionAssignment:()=>BD,removeRoundMatchUps:()=>Pse,removeSeededParticipant:()=>Woe,removeStructure:()=>$oe,renameStructures:()=>Boe,resetDrawDefinition:()=>Tse,resetVoluntaryConsolationStructure:()=>pae,setDrawParticipantRepresentativeIds:()=>iae,setPositionAssignments:()=>Roe,setStructureOrder:()=>Loe,setSubOrder:()=>Rse,shiftAdHocRounds:()=>Poe,swapAdHocRounds:()=>Moe,swapDrawPositionAssignments:()=>zoe,updateTeamLineUp:()=>WI,withdrawParticipantAtDrawPosition:()=>goe});var Cz=t=>e=>t[e],Pz=(t=[])=>t.map($a).filter(Boolean),G2=(t=[])=>t.map(Gi).filter(Boolean),Gi=(t={})=>Cz(t)("participantId"),$a=(t={})=>Cz(t)("matchUpId"),kD=(t={})=>Cz(t)("drawId");function iae({representativeParticipantIds:t,drawDefinition:e}){if(!e)return{error:Zl};if(!Array.isArray(t))return{error:Re};let i=G2((e==null?void 0:e.entries)||[]);return t.length&&zr(t,i).length<t.length?{error:Re}:ox({drawDefinition:e,extension:{name:Dz,value:t}})}var ol="ABANDONED",LI="AWAITING_RESULT",vn="BYE",Rp="CANCELLED",jr="COMPLETED",_T="DEAD_RUBBER",Zi="DEFAULTED",Ea="DOUBLE_DEFAULT",ua="DOUBLE_WALKOVER",Lu="IN_PROGRESS",$c="INCOMPLETE",Rz="NOT_PLAYED",go="RETIRED",Dg="SUSPENDED",qr="TO_BE_PLAYED",hn="WALKOVER",nae=[LI,jr,Zi,Lu,$c,go,Dg],Mz=[LI,jr,Zi,ua,Ea,Lu,$c,go,Dg,hn],Nz=[ol,LI,vn,Rp,jr,_T,Zi,ua,Ea,Lu,$c,Rz,go,Dg,qr,hn],Az=[vn,ua,Ea,jr,Zi,go,hn],_z=[ol,LI,Rp,_T,Lu,$c,Rz,Dg,qr,void 0],ba=[Rp,ol,jr,_T,Zi,ua,Ea,go,hn],dx=[ol,jr,Zi,ua,Ea,Lu,go,hn],kz=[Lu,$c,Dg,qr],xz={ABANDONED:ol,AWAITING_RESULT:LI,BYE:vn,CANCELLED:Rp,COMPLETED:jr,DEAD_RUBBER:_T,DEFAULTED:Zi,DOUBLE_WALKOVER:ua,DOUBLE_DEFAULT:Ea,IN_PROGRESS:Lu,INCOMPLETE:$c,NOT_PLAYED:Rz,RETIRED:go,SUSPENDED:Dg,TO_BE_PLAYED:qr,WALKOVER:hn};function FI(t,e,i){var d,p;let n=h=>{var f,m;return(m=(f=Ri({element:h,name:Pp}))==null?void 0:f.extension)==null?void 0:m.value},r=i==null?void 0:i.deprioritizeCompleted,a=(i==null?void 0:i.mode)===Cre&&nRe,o=(i==null?void 0:i.mode)===Ere&&Pre,s=o||a||Wb,l=h=>(h==null?void 0:h.stage)===xt&&(h==null?void 0:h.stageSequence)===1,c=h=>l(h)?-1:s[h==null?void 0:h.stage],u=h=>h==null?void 0:h.matchUps.every(({matchUpStatus:f})=>ba.includes(f)?1:-1);return r&&u(t)-u(e)||a&&c(t)-c(e)||((t==null?void 0:t.stage)&&s[t.stage]||0)-((e==null?void 0:e.stage)&&s[e.stage]||0)||(n(t)||0)-(n(e)||0)||!o&&!a&&(((d=e==null?void 0:e.positionAssignments)==null?void 0:d.length)??1/0)-(((p=t==null?void 0:t.positionAssignments)==null?void 0:p.length)??1/0)||((t==null?void 0:t.stageSequence)??0)-((e==null?void 0:e.stageSequence)??0)||(UA(t)||0)-(UA(e)||0)}function UA(t){return((t==null?void 0:t.matchUps)||[]).reduce((e,i)=>{var r;let n=(((r=i.finishingPositionRange)==null?void 0:r.winner)||[]).reduce((a,o)=>a+o,0);return!e||n<e?n:e},void 0)}function ui(t){let e=di(t,[{[_s]:!0,[tx]:!0}]);if(e.error)return e;let{drawDefinition:i,structureId:n}=t,{structures:r}=Ru({drawDefinition:i}),a=r==null?void 0:r.map(l=>l.structures?[...l.structures].concat(l):l).flat(),o=a==null?void 0:a.find(l=>l.structureId===n);if(!o)return{error:wr};let s=o.structureType===Jk?a==null?void 0:a.find(l=>{var c;return(c=l.structures)==null?void 0:c.some(u=>u.structureId===n)}):void 0;return{structure:o,containingStructure:s}}function Ru({withStageGrouping:t,drawDefinition:e,stageSequences:i,stageSequence:n,roundTarget:r,sortConfig:a,stages:o,stage:s}){var f;let l=!e&&Vt||!(e!=null&&e.structures)&&AH||void 0;if(l)return{error:l,structures:[],stageStructures:{}};let c=m=>{var v,y;let g=(y=(v=Ri({element:m,name:Pp}))==null?void 0:v.extension)==null?void 0:y.value;return!r||r===g},u=((f=e==null?void 0:e.structures)==null?void 0:f.filter(p).filter(h).filter(c).sort((m,g)=>FI(m,g,a)))??[],d=t?Object.assign({},...Zk.map(m=>{let g=u==null?void 0:u.filter(v=>v.stage===m);return(g==null?void 0:g.length)&&{[m]:g}}).filter(Boolean)):{};return{structures:u,stageStructures:d};function p(m){return!s&&!Array.isArray(o)||s&&m.stage===s||Array.isArray(o)&&o.includes(m.stage)}function h(m){return!n&&!Array.isArray(i)||n&&m.stageSequence===n||Array.isArray(i)&&i.includes(m.stageSequence)}}function rae({drawDefinition:t}){if(!t)return{error:Vt};let e={};return{allPositionedParticipantIds:(t.structures||[]).map(i=>{let n=i.stage;e[n]||(e[n]=[]);let{positionAssignments:r}=Vn({structure:i}),a=(r==null?void 0:r.map(Gi).filter(Boolean))??[];return e[n].push(...a),a}).flat(),stagePositionedParticipantIds:e}}function Vn({drawDefinition:t,structureId:e,structure:i}){let n,r=[];if(!i){if(!t)return{positionAssignments:r,error:Vt};if({structure:i,error:n}=ui({drawDefinition:t,structureId:e}),n)return{positionAssignments:r,error:n}}return i.structures?r=[].concat(...i.structures.map(a=>Vn({structure:a}).positionAssignments)):i.positionAssignments?r=i.positionAssignments:n=yne,{positionAssignments:r,error:n}}function ja({drawDefinition:t,structureId:e,structure:i}){var c;let n=((c=Vn({drawDefinition:t,structureId:e,structure:i}))==null?void 0:c.positionAssignments)||[],r=n==null?void 0:n.filter(u=>u.participantId??u.bye??u.qualifier),a=n&&(n==null?void 0:n.length)===(r==null?void 0:r.length),o=n==null?void 0:n.filter(u=>!u.participantId&&!u.bye&&!u.qualifier),s=n==null?void 0:n.filter(u=>!u.participantId&&u.bye),l=n==null?void 0:n.filter(u=>!u.participantId&&u.qualifier);return{allPositionsAssigned:a,positionAssignments:n,unassignedPositions:o,assignedPositions:r,qualifierPositions:l,byePositions:s}}var Oz="addDrawDefinition",px="addMatchUps",Wm="addParticipants",Lz="addScaleItems",Fz="addVenue",gf="audit",Bz="dataIssue",$z="deleteParticipants",Vz="deleteVenue",jz="deletedDrawIds",Gz="deletedMatchUpIds",Hz="modifyDrawDefinition",aae="modifyDrawEntries",oae="modifyEventEntries",zz="modifyMatchUp",Ro="modifyParticipants",qz="modifyPositionAssignments",Wz="modifySeedAssignments",wy="modifyTournamentDetail",Sy="modifyVenue",xD="mutations",H2="publishEvent",sae="publishEventSeeding",lae="publishOrderOfPlay",cae="publishParticipants",Kz="unPublishEvent",Yz="unPublishEventSeeding",Zz="unPublishOrderOfPlay",eMe="unPublishParticipants",hx="updateInContextMatchUp",uae={ADD_DRAW_DEFINITION:Oz,ADD_MATCHUPS:px,ADD_PARTICIPANTS:Wm,ADD_SCALE_ITEMS:Lz,ADD_VENUE:Fz,AUDIT:gf,DATA_ISSUE:Bz,DELETE_PARTICIPANTS:$z,DELETE_VENUE:Vz,DELETED_DRAW_IDS:jz,DELETED_MATCHUP_IDS:Gz,MODIFY_DRAW_DEFINITION:Hz,MODIFY_DRAW_ENTRIES:aae,MODIFY_EVENT_ENTRIES:oae,MODIFY_MATCHUP:zz,MODIFY_PARTICIPANTS:Ro,MODIFY_POSITION_ASSIGNMENTS:qz,MODIFY_SEED_ASSIGNMENTS:Wz,MODIFY_TOURNAMENT_DETAIL:wy,MODIFY_VENUE:Sy,MUTATIONS:xD,PUBLISH_EVENT_SEEDING:sae,PUBLISH_EVENT:H2,PUBLISH_ORDER_OF_PLAY:lae,PUBLISH_PARTICIPANTS:cae,UNPUBLISH_EVENT_SEEDING:Yz,UNPUBLISH_EVENT:Kz,UNPUBLISH_ORDER_OF_PLAY:Zz,UPDATE_INCONTEXT_MATCHUP:hx};function fx(t,e){var a;if(!t)return{error:Vt};let i=Date.now();t.updatedAt&&i===new Date(t.updatedAt).getTime()&&(i+=1);let n=new Date(i).toISOString(),r=e==null?void 0:e.filter(Boolean);return t.updatedAt=n,(a=t.structures)==null||a.filter(Boolean).forEach(o=>{(!(r!=null&&r.length)||r!=null&&r.includes(o.structureId))&&(o.updatedAt=n)}),{...ce}}function Km({drawDefinition:t,tournamentId:e,matchUps:i,eventId:n}){return t&&fx(t),wi({payload:{matchUps:i,tournamentId:e,eventId:n},topic:px}),{...ce}}function Qf({drawDefinition:t,tournamentId:e,matchUpIds:i,eventId:n,action:r}){t&&fx(t),wi({topic:Gz,payload:{tournamentId:e,matchUpIds:i,eventId:n,action:r}});for(let a of i)az({key:a});return{...ce}}function en({drawDefinition:t,tournamentId:e,structureId:i,context:n,eventId:r,matchUp:a}){return a?(t&&qn({drawDefinition:t,structureIds:i?[i]:void 0,tournamentId:e,eventId:r}),wi({topic:zz,payload:{matchUp:a,tournamentId:e,context:n},key:a.matchUpId}),{...ce}):(console.log(rl),{error:rl})}function tMe({tournamentId:t,inContextMatchUp:e}){return e?(wi({payload:{inContextMatchUp:e,tournamentId:t},topic:hx,key:e.matchUpId}),{...ce}):{error:rl}}function mC({tournamentId:t,eventId:e,drawDefinition:i}){return i?(fx(i),wi({payload:{drawDefinition:i,tournamentId:t,eventId:e},topic:Oz,key:i.drawId}),{...ce}):(console.log(Vt),{error:Vt})}function iMe({tournamentId:t,eventId:e,drawId:i}){return wi({payload:{drawId:i,tournamentId:t,eventId:e},topic:jz,key:i}),az({key:i}),{...ce}}function qn({drawDefinition:t,tournamentId:e,structureIds:i,eventId:n}){return t?(fx(t,i),wi({payload:{tournamentId:e,eventId:n,drawDefinition:t},topic:Hz,key:t.drawId}),{...ce}):{error:Vt}}function dae({drawDefinition:t,tournamentId:e,structure:i,eventId:n}){if(!t)return{error:Vt};if(!i)return{error:gy};let r=i.seedAssignments,a=i.structureId,o=t.drawId;return wi({payload:{tournamentId:e,eventId:n,drawId:o,structureId:a,seedAssignments:r},topic:Wz,key:t.drawId}),qn({structureIds:[a],drawDefinition:t,tournamentId:e,eventId:n}),{...ce}}function Ym({drawDefinition:t,tournamentId:e,structure:i,event:n}){if(!t)return{error:Vt};if(!i)return{error:gy};let r=Vn({structure:i}),a=i.structureId,o=t.drawId,s=n==null?void 0:n.eventId;return wi({topic:qz,payload:{positionAssignments:r,tournamentId:e,structureId:a,eventId:s,drawId:o},key:a}),qn({structureIds:[a],drawDefinition:t,tournamentId:e,eventId:s}),{...ce}}function pae({tournamentRecord:t,drawDefinition:e,resetEntries:i,event:n}){var o,s;if(!e)return{error:Vt};let r=(o=e.structures)==null?void 0:o.find(l=>l.stage===Ja);if(!r)return{error:wr};let a=((s=r.matchUps)==null?void 0:s.map(({matchUpId:l})=>l))||[];return r.positionAssignments=[],r.seedAssignments=[],r.matchUps=[],Qf({tournamentId:t==null?void 0:t.tournamentId,action:"resetVoluntaryConsolationStructure",matchUpIds:a,drawDefinition:e}),i&&(e.entries=e.entries.filter(l=>l.entryStage!==Ja)),qn({tournamentId:t==null?void 0:t.tournamentId,eventId:n==null?void 0:n.eventId,drawDefinition:e,structureIds:[r.structureId]}),{...ce}}function Xz({drawPositions:t,structure:e}){var n;if([Zt,xt].includes(e.stage)&&e.stageSequence===1)return;let{positionAssignments:i}=Vn({structure:e});(n=i==null?void 0:i.filter(({drawPosition:r})=>t==null?void 0:t.includes(r)))==null||n.forEach(r=>{cn({element:r,extension:{name:cx,value:!0}})})}function mx(t){var s,l;let{appliedPolicies:e,positionAction:i,drawDefinition:n}=t;if(((s=e==null?void 0:e.audit)==null?void 0:s[_1])===!1)return;let{extension:r}=Ri({name:_1,element:n}),a=Array.isArray(r==null?void 0:r.value)?(r==null?void 0:r.value)??[]:[];if(!(a!=null&&a.length)){let c=n.structures.find(u=>u.stage===xt);if(c){let u=(l=Vn({structure:c}).positionAssignments)==null?void 0:l.map(({drawPosition:d,participantId:p,bye:h,qualifier:f})=>({drawPosition:d,participantId:p,qualifier:f,bye:h}));a.push({name:"initialMainAssignments",initialAssignments:u})}}let o={value:a.concat(i),name:_1};cn({element:n,extension:o})}function kT({tournamentRecord:t,drawDefinition:e,event:i}){var s;let n=((s=(t==null?void 0:t.events)||i&&[i])==null?void 0:s.map(l=>l==null?void 0:l.drawDefinitions).flat().filter(Boolean))||e&&[e]||[],r={},a={},o=n.map(l=>{var c;return(c=l==null?void 0:l.structures)==null?void 0:c.filter(u=>u==null?void 0:u.structures)}).flat().filter(Boolean);for(let l of o){let{structures:c,structureId:u}=l??{};c&&u&&(r[u]=c==null?void 0:c.map(d=>d.structureId))&&c.forEach(d=>a[d.structureId]=l==null?void 0:l.structureId)}return{containedStructures:r,containerStructures:a}}var Sb="SINGLES",or="SINGLES",jv="DOUBLES",zn="DOUBLES",pp="TEAM",Xn="TEAM",hae={SINGLES_MATCHUP:Sb,SINGLES:or,DOUBLES_MATCHUP:jv,DOUBLES:zn,TEAM_MATCHUP:pp,TEAM:Xn};function gx(t){var a;let{sides:e,matchUpType:i}=t||{},n=(a=t.potentialParticipants)!=null&&a.length?t.potentialParticipants.flat().map(o=>i===zn?(o==null?void 0:o.individualParticipantIds)||[]:o.participantId).flat():[],r=(e||[]).map(o=>{var s;return i===zn&&(((s=o==null?void 0:o.participant)==null?void 0:s.individualParticipantIds)||[])||(o==null?void 0:o.participantId)&&[o.participantId]||[]}).flat();return{individualParticipantIds:r.concat(n).flat(),enteredIndividualParticipantIds:r,potentialIndividualParticipantIds:n}}function qc(t){return(t==null?void 0:t.tournamentRecords)??((t==null?void 0:t.tournamentRecord)&&{[t.tournamentRecord.tournamentId]:t.tournamentRecord})??{}}var gC="SIGN_IN_STATUS",fae="SIGNED_OUT",OD="SIGNED_IN",Nc="TEAM",Hi="INDIVIDUAL",ac="GROUP",Ti="PAIR",On="TEAM",$0={TEAM_PARTICIPANT:Nc,INDIVIDUAL:Hi,GROUP:ac,TEAM:On,PAIR:Ti},Yo={INDIVIDUAL:Hi,GROUP:ac,PAIR:Ti,TEAM:On,SIGN_IN_STATUS:gC,SIGNED_OUT:fae,SIGNED_IN:OD};function Jz({participantsProfile:t,participants:e=[],deepCopy:i}){let n=new Map,r=i!==!1?Ot(e,t==null?void 0:t.convertExtensions,!0):e,a=r.filter(l=>l.participantType===On),o=r.filter(l=>l.participantType===ac),s=r.filter(l=>l.participantType===Ti);return r.forEach(l=>{if(l.participantType===Hi){let{participantId:c}=l;l.groupParticipantIds=[],l.teamParticipantIds=[],l.pairParticipantIds=[],l.groups=[],l.teams=[],a.forEach(u=>{((u==null?void 0:u.individualParticipantIds)||[]).forEach(d=>{var p;d===c&&!((p=l.teamParticipantIds)!=null&&p.includes(u.participantId))&&(l.teamParticipantIds.push(u.participantId),n.get(u.participantId)||n.set(u.participantId,{participantName:u.participantName,participantId:u.participantId}),l.teams.push({participantRoleResponsibilities:u.participantRoleResponsibilities,participantOtherName:u.participantOtherName,participantName:u.participantName,participantId:u.participantId,teamId:u.teamId}))})}),s.forEach(u=>{((u==null?void 0:u.individualParticipantIds)||[]).forEach(d=>{d===c&&!l.pairParticipantIds.includes(u.participantId)&&l.pairParticipantIds.push(u.participantId)})}),o.forEach(u=>{((u==null?void 0:u.individualParticipantIds)||[]).forEach(d=>{d===c&&!l.groupParticipantIds.includes(u.participantId)&&(l.groupParticipantIds.push(u.participantId),l.groups.push({participantRoleResponsibilities:u.participantRoleResponsibilities,participantOtherName:u.participantOtherName,participantName:u.participantName,participantId:u.participantId}))})})}}),{participantsWithGroupings:r,groupInfo:Object.fromEntries(n)}}function mae(t){return t&&typeof String.fromCodePoint<"u"?t.toUpperCase().replace(/./g,e=>String.fromCodePoint(e.charCodeAt(0)+127397)):t}function nMe(t){let e=Object.assign({},...Fm.filter(i=>i.ioc).map(i=>({[i.ioc]:i.iso})));return mae(e[t])}var Fm=[{ioc:"",iso2:"",iso:"",label:"NONE",phone:""},{ioc:"AND",iso2:"AD",iso:"AND",label:"Andorra",phone:"376"},{ioc:"UAE",iso2:"AE",iso:"ARE",label:"United Arab Emirates",phone:"971"},{ioc:"AFG",iso2:"AF",iso:"AFG",label:"Afghanistan",phone:"93"},{ioc:"ANT",iso2:"AG",iso:"ATG",label:"Antigua and Barbuda",phone:"1-268"},{ioc:"AIA",iso2:"AI",iso:"AIA",label:"Anguilla",phone:"1-264"},{ioc:"ALB",iso2:"AL",iso:"ALB",label:"Albania",phone:"355"},{ioc:"ARM",iso2:"AM",iso:"ARM",label:"Armenia",phone:"374"},{ioc:"ANG",iso2:"AO",iso:"AGO",label:"Angola",phone:"244"},{ioc:"",iso2:"AQ",iso:"ATA",label:"Antarctica",phone:"672"},{ioc:"ARG",iso2:"AR",iso:"ARG",label:"Argentina",phone:"54"},{ioc:"ASA",iso2:"AS",iso:"ASM",label:"American Samoa",phone:"1-684"},{ioc:"AUT",iso2:"AT",iso:"AUT",label:"Austria",phone:"43"},{ioc:"AUS",iso2:"AU",iso:"AUS",label:"Australia",phone:"61",suggested:!0},{ioc:"ARU",iso2:"AW",iso:"ABW",label:"Aruba",phone:"297"},{ioc:"AZE",iso2:"AZ",iso:"AZE",label:"Azerbaijan",phone:"994"},{ioc:"BIH",iso2:"BA",iso:"BIH",label:"Bosnia and Herzegovina",phone:"387"},{ioc:"BAR",iso2:"BB",iso:"BRB",label:"Barbados",phone:"1-246"},{ioc:"BAN",iso2:"BD",iso:"BGD",label:"Bangladesh",phone:"880"},{ioc:"BEL",iso2:"BE",iso:"BEL",label:"Belgium",phone:"32"},{ioc:"BUR",iso2:"BF",iso:"BFA",label:"Burkina Faso",phone:"226"},{ioc:"BUL",iso2:"BG",iso:"BGR",label:"Bulgaria",phone:"359"},{ioc:"BRN",iso2:"BH",iso:"BHR",label:"Bahrain",phone:"973"},{ioc:"BDI",iso2:"BI",iso:"BDI",label:"Burundi",phone:"257"},{ioc:"BEN",iso2:"BJ",iso:"BEN",label:"Benin",phone:"229"},{ioc:"",iso2:"BL",iso:"BLM",label:"Saint Barthelemy",phone:"590"},{ioc:"BER",iso2:"BM",iso:"BMU",label:"Bermuda",phone:"1-441"},{ioc:"BRU",iso2:"BN",iso:"BRN",label:"Brunei Darussalam",phone:"673"},{ioc:"BOL",iso2:"BO",iso:"BOL",label:"Bolivia",phone:"591"},{ioc:"BRA",iso2:"BR",iso:"BRA",label:"Brazil",phone:"55"},{ioc:"BAH",iso2:"BS",iso:"BHS",label:"Bahamas",phone:"1-242"},{ioc:"BHU",iso2:"BT",iso:"BTN",label:"Bhutan",phone:"975"},{ioc:"",iso2:"BV",iso:"BVT",label:"Bouvet Island",phone:"47"},{ioc:"BOT",iso2:"BW",iso:"BWA",label:"Botswana",phone:"267"},{ioc:"BLR",iso2:"BY",iso:"BLR",label:"Belarus",phone:"375"},{ioc:"BIZ",iso2:"BZ",iso:"BLZ",label:"Belize",phone:"501"},{ioc:"CAN",iso2:"CA",iso:"CAN",label:"Canada",phone:"1",suggested:!0},{ioc:"",iso2:"CC",iso:"CCK",label:"Cocos (Keeling) Islands",phone:"61"},{ioc:"CGO",iso2:"CD",iso:"COG",label:"Congo, Republic of the",phone:"242"},{ioc:"CAF",iso2:"CF",iso:"CAF",label:"Central African Republic",phone:"236"},{ioc:"COD",iso2:"CG",iso:"CGD",label:"Congo, Democratic Republic of the",phone:"243"},{ioc:"SUI",iso2:"CH",iso:"CHE",label:"Switzerland",phone:"41"},{ioc:"CIV",iso2:"CI",iso:"CIV",label:"Cote d'Ivoire",phone:"225"},{ioc:"COK",iso2:"CK",iso:"COK",label:"Cook Islands",phone:"682"},{ioc:"CHI",iso2:"CL",iso:"CHL",label:"Chile",phone:"56"},{ioc:"CMR",iso2:"CM",iso:"CMR",label:"Cameroon",phone:"237"},{ioc:"CHN",iso2:"CN",iso:"CHN",label:"China",phone:"86"},{ioc:"COL",iso2:"CO",iso:"COL",label:"Colombia",phone:"57"},{ioc:"CRC",iso2:"CR",iso:"CRI",label:"Costa Rica",phone:"506"},{ioc:"CUB",iso2:"CU",iso:"CUB",label:"Cuba",phone:"53"},{ioc:"CPV",iso2:"CV",iso:"CPV",label:"Cape Verde",phone:"238"},{ioc:"CUW",iso2:"CW",iso:"CUW",label:"Curacao",phone:"599"},{ioc:"CXR",iso2:"CX",iso:"CXR",label:"Christmas Island",phone:"61"},{ioc:"CYP",iso2:"CY",iso:"CYP",label:"Cyprus",phone:"357"},{ioc:"CZE",iso2:"CZ",iso:"CZE",label:"Czech Republic",phone:"420"},{ioc:"GER",iso2:"DE",iso:"DEU",label:"Germany",phone:"49",suggested:!0},{ioc:"DJI",iso2:"DJ",iso:"DJI",label:"Djibouti",phone:"253"},{ioc:"DEN",iso2:"DK",iso:"DNK",label:"Denmark",phone:"45"},{ioc:"DMA",iso2:"DM",iso:"DMA",label:"Dominica",phone:"1-767"},{ioc:"DOM",iso2:"DO",iso:"DOM",label:"Dominican Republic",phone:"1-809"},{ioc:"ALG",iso2:"DZ",iso:"DZA",label:"Algeria",phone:"213"},{ioc:"ECU",iso2:"EC",iso:"ECU",label:"Ecuador",phone:"593"},{ioc:"EST",iso2:"EE",iso:"ESE",label:"Estonia",phone:"372"},{ioc:"EGY",iso2:"EG",iso:"EGY",label:"Egypt",phone:"20"},{ioc:"",iso2:"EH",iso:"ESH",label:"Western Sahara",phone:"212"},{ioc:"ERI",iso2:"ER",iso:"ERI",label:"Eritrea",phone:"291"},{ioc:"ESP",iso2:"ES",iso:"ESP",label:"Spain",phone:"34"},{ioc:"ETH",iso2:"ET",iso:"ETH",label:"Ethiopia",phone:"251"},{ioc:"FIN",iso2:"FI",iso:"FIN",label:"Finland",phone:"358"},{ioc:"FIJ",iso2:"FJ",iso:"FJI",label:"Fiji",phone:"679"},{ioc:"FLK",iso2:"FK",iso:"FLK",label:"Falkland Islands (Malvinas)",phone:"500"},{ioc:"FSM",iso2:"FM",iso:"FSM",label:"Micronesia, Federated States of",phone:"691"},{ioc:"FAR",iso2:"FO",iso:"FRO",label:"Faroe Islands",phone:"298"},{ioc:"FRA",iso2:"FR",iso:"FRA",label:"France",phone:"33",suggested:!0},{ioc:"GAB",iso2:"GA",iso:"GAB",label:"Gabon",phone:"241"},{ioc:"GBR",iso2:"GB",iso:"GBR",label:"United Kingdom",phone:"44"},{ioc:"GRN",iso2:"GD",iso:"GRD",label:"Grenada",phone:"1-473"},{ioc:"GEO",iso2:"GE",iso:"GEO",label:"Georgia",phone:"995"},{ioc:"FGU",iso2:"GF",iso:"GUF",label:"French Guiana",phone:"594"},{ioc:"",iso2:"GG",iso:"GGY",label:"Guernsey",phone:"44"},{ioc:"",iso2:"GH",iso:"GHA",label:"Ghana",phone:"233"},{ioc:"GIB",iso2:"GI",iso:"GIB",label:"Gibraltar",phone:"350"},{ioc:"GRL",iso2:"GL",iso:"GRL",label:"Greenland",phone:"299"},{ioc:"GAM",iso2:"GM",iso:"GMB",label:"Gambia",phone:"220"},{ioc:"GUI",iso2:"GN",iso:"GIN",label:"Guinea",phone:"224"},{ioc:"GUD",iso2:"GP",iso:"GLP",label:"Guadeloupe",phone:"590"},{ioc:"GEQ",iso2:"GQ",iso:"GNQ",label:"Equatorial Guinea",phone:"240"},{ioc:"GRE",iso2:"GR",iso:"GRC",label:"Greece",phone:"30"},{ioc:"",iso2:"GS",iso:"SGS",label:"South Georgia and the South Sandwich Islands",phone:"500"},{ioc:"GUA",iso2:"GT",iso:"GTM",label:"Guatemala",phone:"502"},{ioc:"GUM",iso2:"GU",iso:"GUM",label:"Guam",phone:"1-671"},{ioc:"GBS",iso2:"GW",iso:"GNB",label:"Guinea-Bissau",phone:"245"},{ioc:"GUY",iso2:"GY",iso:"GUY",label:"Guyana",phone:"592"},{ioc:"HKG",iso2:"HK",iso:"HKG",label:"Hong Kong",phone:"852"},{ioc:"",iso2:"HM",iso:"HMD",label:"Heard Island and McDonald Islands",phone:"672"},{ioc:"HON",iso2:"HN",iso:"HND",label:"Honduras",phone:"504"},{ioc:"CRO",iso2:"HR",iso:"HRV",label:"Croatia",phone:"385"},{ioc:"HAI",iso2:"HT",iso:"HTI",label:"Haiti",phone:"509"},{ioc:"HUN",iso2:"HU",iso:"HUN",label:"Hungary",phone:"36"},{ioc:"INA",iso2:"ID",iso:"IDN",label:"Indonesia",phone:"62"},{ioc:"IRL",iso2:"IE",iso:"IRL",label:"Ireland",phone:"353"},{ioc:"ISR",iso2:"IL",iso:"ISR",label:"Israel",phone:"972"},{ioc:"",iso2:"IM",iso:"IMN",label:"Isle of Man",phone:"44"},{ioc:"IND",iso2:"IN",iso:"IND",label:"India",phone:"91"},{ioc:"",iso2:"IO",iso:"IOT",label:"British Indian Ocean Territory",phone:"246"},{ioc:"IRQ",iso2:"IQ",iso:"IRQ",label:"Iraq",phone:"964"},{ioc:"IRI",iso2:"IR",iso:"IRN",label:"Iran, Islamic Republic of",phone:"98"},{ioc:"ISL",iso2:"IS",iso:"ISL",label:"Iceland",phone:"354"},{ioc:"ITA",iso2:"IT",iso:"ITA",label:"Italy",phone:"39"},{ioc:"",iso2:"JE",iso:"JEY",label:"Jersey",phone:"44"},{ioc:"JAM",iso2:"JM",iso:"JAM",label:"Jamaica",phone:"1-876"},{ioc:"JOR",iso2:"JO",iso:"JOR",label:"Jordan",phone:"962"},{ioc:"JPN",iso2:"JP",iso:"JPN",label:"Japan",phone:"81",suggested:!0},{ioc:"KEN",iso2:"KE",iso:"KEN",label:"Kenya",phone:"254"},{ioc:"KGZ",iso2:"KG",iso:"KGZ",label:"Kyrgyzstan",phone:"996"},{ioc:"CAM",iso2:"KH",iso:"KHM",label:"Cambodia",phone:"855"},{ioc:"KIR",iso2:"KI",iso:"KIR",label:"Kiribati",phone:"686"},{ioc:"COM",iso2:"KM",iso:"COM",label:"Comoros",phone:"269"},{ioc:"SKN",iso2:"KN",iso:"KNA",label:"Saint Kitts and Nevis",phone:"1-869"},{ioc:"KOR",iso2:"KP",iso:"KOR",label:"Korea, Democratic People's Republic of",phone:"850"},{ioc:"PRK",iso2:"KR",iso:"PRK",label:"Korea, Republic of",phone:"82"},{ioc:"KUW",iso2:"KW",iso:"KWT",label:"Kuwait",phone:"965"},{ioc:"CAY",iso2:"KY",iso:"CYM",label:"Cayman Islands",phone:"1-345"},{ioc:"KAZ",iso2:"KZ",iso:"KAZ",label:"Kazakhstan",phone:"7"},{ioc:"LAO",iso2:"LA",iso:"LAO",label:"Lao People's Democratic Republic",phone:"856"},{ioc:"LIB",iso2:"LB",iso:"LBN",label:"Lebanon",phone:"961"},{ioc:"LCA",iso2:"LC",iso:"LCA",label:"Saint Lucia",phone:"1-758"},{ioc:"LIE",iso2:"LI",iso:"LIE",label:"Liechtenstein",phone:"423"},{ioc:"SRI",iso2:"LK",iso:"LKA",label:"Sri Lanka",phone:"94"},{ioc:"LBR",iso2:"LR",iso:"LBR",label:"Liberia",phone:"231"},{ioc:"LES",iso2:"LS",iso:"LSO",label:"Lesotho",phone:"266"},{ioc:"LTU",iso2:"LT",iso:"LTU",label:"Lithuania",phone:"370"},{ioc:"LUX",iso2:"LU",iso:"LUX",label:"Luxembourg",phone:"352"},{ioc:"LAT",iso2:"LV",iso:"LVA",label:"Latvia",phone:"371"},{ioc:"LBA",iso2:"LY",iso:"LBY",label:"Libya",phone:"218"},{ioc:"MAR",iso2:"MA",iso:"MAR",label:"Morocco",phone:"212"},{ioc:"MON",iso2:"MC",iso:"MCO",label:"Monaco",phone:"377"},{ioc:"MDA",iso2:"MD",iso:"MDA",label:"Moldova, Republic of",phone:"373"},{ioc:"MNE",iso2:"ME",iso:"MNE",label:"Montenegro",phone:"382"},{ioc:"",iso2:"MF",iso:"MAF",label:"Saint Martin (French part)",phone:"590"},{ioc:"MAD",iso2:"MG",iso:"MDG",label:"Madagascar",phone:"261"},{ioc:"MSH",iso2:"MH",iso:"MHL",label:"Marshall Islands",phone:"692"},{ioc:"MKD",iso2:"MK",iso:"MKD",label:"Macedonia, the Former Yugoslav Republic of",phone:"389"},{ioc:"MLI",iso2:"ML",iso:"MLI",label:"Mali",phone:"223"},{ioc:"MYA",iso2:"MM",iso:"MMR",label:"Myanmar",phone:"95"},{ioc:"MGL",iso2:"MN",iso:"MNG",label:"Mongolia",phone:"976"},{ioc:"MAC",iso2:"MO",iso:"MAC",label:"Macao",phone:"853"},{ioc:"NMA",iso2:"MP",iso:"NMP",label:"Northern Mariana Islands",phone:"1-670"},{ioc:"MRT",iso2:"MQ",iso:"MTQ",label:"Martinique",phone:"596"},{ioc:"MTN",iso2:"MR",iso:"MRT",label:"Mauritania",phone:"222"},{ioc:"MNT",iso2:"MS",iso:"MSR",label:"Montserrat",phone:"1-664"},{ioc:"MLT",iso2:"MT",iso:"MLT",label:"Malta",phone:"356"},{ioc:"MRI",iso2:"MU",iso:"MUS",label:"Mauritius",phone:"230"},{ioc:"MDV",iso2:"MV",iso:"MDV",label:"Maldives",phone:"960"},{ioc:"MAW",iso2:"MW",iso:"MWI",label:"Malawi",phone:"265"},{ioc:"MEX",iso2:"MX",iso:"MEX",label:"Mexico",phone:"52"},{ioc:"MAS",iso2:"MY",iso:"MYS",label:"Malaysia",phone:"60"},{ioc:"MOZ",iso2:"MZ",iso:"MOZ",label:"Mozambique",phone:"258"},{ioc:"NAM",iso2:"NA",iso:"NAM",label:"Namibia",phone:"264"},{ioc:"NCL",iso2:"NC",iso:"NCL",label:"New Caledonia",phone:"687"},{ioc:"NIG",iso2:"NE",iso:"NER",label:"Niger",phone:"227"},{ioc:"NFI",iso2:"NF",iso:"NFK",label:"Norfolk Island",phone:"672"},{ioc:"NGR",iso2:"NG",iso:"NGA",label:"Nigeria",phone:"234"},{ioc:"NCA",iso2:"NI",iso:"NIC",label:"Nicaragua",phone:"505"},{ioc:"NED",iso2:"NL",iso:"NLD",label:"Netherlands",phone:"31"},{ioc:"NOR",iso2:"NO",iso:"NOR",label:"Norway",phone:"47"},{ioc:"NEP",iso2:"NP",iso:"NPL",label:"Nepal",phone:"977"},{ioc:"NRU",iso2:"NR",iso:"NRU",label:"Nauru",phone:"674"},{ioc:"NIU",iso2:"NU",iso:"NIU",label:"Niue",phone:"683"},{ioc:"NZL",iso2:"NZ",iso:"NZL",label:"New Zealand",phone:"64"},{ioc:"OMA",iso2:"OM",iso:"OMN",label:"Oman",phone:"968"},{ioc:"PAN",iso2:"PA",iso:"PAN",label:"Panama",phone:"507"},{ioc:"PER",iso2:"PE",iso:"PER",label:"Peru",phone:"51"},{ioc:"FPO",iso2:"PF",iso:"PYF",label:"French Polynesia",phone:"689"},{ioc:"PNG",iso2:"PG",iso:"PNG",label:"Papua New Guinea",phone:"675"},{ioc:"PHI",iso2:"PH",iso:"PHL",label:"Philippines",phone:"63"},{ioc:"PAK",iso2:"PK",iso:"PAK",label:"Pakistan",phone:"92"},{ioc:"POL",iso2:"PL",iso:"POL",label:"Poland",phone:"48"},{ioc:"SPM",iso2:"PM",iso:"SPM",label:"Saint Pierre and Miquelon",phone:"508"},{ioc:"",iso2:"PN",iso:"PCN",label:"Pitcairn",phone:"870"},{ioc:"PUR",iso2:"PR",iso:"PRI",label:"Puerto Rico",phone:"1"},{ioc:"PLE",iso2:"PS",iso:"PSE",label:"Palestine, State of",phone:"970"},{ioc:"POR",iso2:"PT",iso:"PRT",label:"Portugal",phone:"351"},{ioc:"PLW",iso2:"PW",iso:"PLW",label:"Palau",phone:"680"},{ioc:"PAR",iso2:"PY",iso:"PRY",label:"Paraguay",phone:"595"},{ioc:"QAT",iso2:"QA",iso:"QAT",label:"Qatar",phone:"974"},{ioc:"REU",iso2:"RE",iso:"REU",label:"Reunion",phone:"262"},{ioc:"ROU",iso2:"RO",iso:"ROU",label:"Romania",phone:"40"},{ioc:"SRB",iso2:"RS",iso:"SRB",label:"Serbia",phone:"381"},{ioc:"RUS",iso2:"RU",iso:"RUS",label:"Russia",phone:"7"},{ioc:"RWA",iso2:"RW",iso:"RWA",label:"Rwanda",phone:"250"},{ioc:"KSA",iso2:"SA",iso:"SAU",label:"Saudi Arabia",phone:"966"},{ioc:"SOL",iso2:"SB",iso:"SLB",label:"Solomon Islands",phone:"677"},{ioc:"SEY",iso2:"SC",iso:"SYC",label:"Seychelles",phone:"248"},{ioc:"SUD",iso2:"SD",iso:"SDN",label:"Sudan",phone:"249"},{ioc:"SWE",iso2:"SE",iso:"SWE",label:"Sweden",phone:"46"},{ioc:"SIN",iso2:"SG",iso:"SGP",label:"Singapore",phone:"65"},{ioc:"HEL",iso2:"SH",iso:"SHN",label:"Saint Helena",phone:"290"},{ioc:"SLO",iso2:"SI",iso:"SVN",label:"Slovenia",phone:"386"},{ioc:"",iso2:"SJ",iso:"SJM",label:"Svalbard and Jan Mayen",phone:"47"},{ioc:"SVK",iso2:"SK",iso:"SVK",label:"Slovakia",phone:"421"},{ioc:"SLE",iso2:"SL",iso:"SLE",label:"Sierra Leone",phone:"232"},{ioc:"SMR",iso2:"SM",iso:"SMR",label:"San Marino",phone:"378"},{ioc:"SEN",iso2:"SN",iso:"SEN",label:"Senegal",phone:"221"},{ioc:"SOM",iso2:"SO",iso:"SOM",label:"Somalia",phone:"252"},{ioc:"SUR",iso2:"SR",iso:"SUR",label:"Suriname",phone:"597"},{ioc:"",iso2:"SS",iso:"SSD",label:"South Sudan",phone:"211"},{ioc:"STP",iso2:"ST",iso:"STP",label:"Sao Tome and Principe",phone:"239"},{ioc:"ESA",iso2:"SV",iso:"SLV",label:"El Salvador",phone:"503"},{ioc:"",iso2:"SX",iso:"SMX",label:"Sint Maarten",phone:"1-721"},{ioc:"SYR",iso2:"SY",iso:"SYR",label:"Syria",phone:"963"},{ioc:"",iso2:"SZ",iso:"SWZ",label:"Swaziland",phone:"268"},{ioc:"TKS",iso2:"TC",iso:"TCA",label:"Turks and Caicos Islands",phone:"1-649"},{ioc:"CHA",iso2:"TD",iso:"TCD",label:"Chad",phone:"235"},{ioc:"",iso2:"TF",iso:"ATF",label:"French Southern Territories",phone:"262"},{ioc:"TOG",iso2:"TG",iso:"TGO",label:"Togo",phone:"228"},{ioc:"THA",iso2:"TH",iso:"THA",label:"Thailand",phone:"66"},{ioc:"TJK",iso2:"TJ",iso:"TJK",label:"Tajikistan",phone:"992"},{ioc:"",iso2:"TK",iso:"TKL",label:"Tokelau",phone:"690"},{ioc:"TLS",iso2:"TL",iso:"TLS",label:"Timor-Leste",phone:"670"},{ioc:"TKM",iso2:"TM",iso:"TKM",label:"Turkmenistan",phone:"993"},{ioc:"TUN",iso2:"TN",iso:"TUN",label:"Tunisia",phone:"216"},{ioc:"TGA",iso2:"TO",iso:"TON",label:"Tonga",phone:"676"},{ioc:"TUR",iso2:"TR",iso:"TUR",label:"Turkey",phone:"90"},{ioc:"TTO",iso2:"TT",iso:"TTO",label:"Trinidad and Tobago",phone:"1-868"},{ioc:"TUV",iso2:"TV",iso:"TUV",label:"Tuvalu",phone:"688"},{ioc:"TPE",iso2:"TW",iso:"TWN",label:"Taiwan",phone:"886"},{ioc:"TAN",iso2:"TZ",iso:"TZA",label:"United Republic of Tanzania",phone:"255"},{ioc:"UKR",iso2:"UA",iso:"UKR",label:"Ukraine",phone:"380"},{ioc:"UGA",iso2:"UG",iso:"UGA",label:"Uganda",phone:"256"},{ioc:"USA",iso2:"US",label:"United States",phone:"1",suggested:!0,iso:"USA"},{ioc:"URU",iso2:"UY",iso:"URY",label:"Uruguay",phone:"598"},{ioc:"UZB",iso2:"UZ",iso:"UZB",label:"Uzbekistan",phone:"998"},{ioc:"",iso2:"VA",iso:"VAT",label:"Holy See (Vatican City State)",phone:"379"},{ioc:"VIN",iso2:"VC",iso:"VCT",label:"Saint Vincent and the Grenadines",phone:"1-784"},{ioc:"VEN",iso2:"VE",iso:"VEN",label:"Venezuela",phone:"58"},{ioc:"IVB",iso2:"VG",iso:"VGB",label:"British Virgin Islands",phone:"1-284"},{ioc:"ISV",iso2:"VI",iso:"VIR",label:"US Virgin Islands",phone:"1-340"},{ioc:"VIE",iso2:"VN",iso:"VNM",label:"Vietnam",phone:"84"},{ioc:"VAN",iso2:"VU",iso:"VUT",label:"Vanuatu",phone:"678"},{ioc:"WAF",iso2:"WF",iso:"WLF",label:"Wallis and Futuna",phone:"681"},{ioc:"SAM",iso2:"WS",iso:"WSM",label:"Samoa",phone:"685"},{ioc:"KOS",iso2:"XK",iso:"KOS",label:"Kosovo",phone:"383"},{ioc:"YEM",iso2:"YE",iso:"YEM",label:"Yemen",phone:"967"},{ioc:"MAY",iso2:"YT",iso:"MYT",label:"Mayotte",phone:"262"},{ioc:"RSA",iso2:"ZA",iso:"ZAF",label:"South Africa",phone:"27"},{ioc:"ZAM",iso2:"ZM",iso:"ZMB",label:"Zambia",phone:"260"},{ioc:"ZIM",iso2:"ZW",iso:"ZWE",label:"Zimbabwe",phone:"263"}];function gae({participant:t,withISO2:e,withIOC:i}){let{person:n,individualParticipants:r}=t,a=[n,r==null?void 0:r.map(({person:s})=>s)].flat().filter(Boolean);function o(s){let{nationalityCode:l}=s||{};if(l){let c=Fm.find(({iso:u})=>u===l);i&&(c!=null&&c.ioc)&&!s.iocNationalityCode&&(s.iocNationalityCode=c.ioc),e&&(c!=null&&c.iso2)&&!s.iso2NationalityCode&&(s.iso2NationalityCode=c.iso2),c!=null&&c.label&&!s.countryName&&(s.countryName=c.label)}}a.forEach(o)}function rMe({participantMap:t,template:e}){var n;let i=Object.values(t);for(let r of i){let a=r.participant;if((n=a.individualParticipantIds)!=null&&n.length){a.individualParticipants=[];for(let o of a.individualParticipantIds){let s=t[o].participant;a.individualParticipants.push(e?Kb({template:e,source:s}):s)}}}}function Eg(t){var r;let{tournamentRecord:e,participantId:i}=t,n=t.tournamentRecords||e&&{[e.tournamentId]:e}||{};for(let a of Object.values(n)){let o=(r=a.participants)==null?void 0:r.find(s=>s.participantId===i);if(o)return{participant:o,tournamentId:a.tournamentId}}return{error:Vr}}function vae(t){let{tournamentRecord:e,participantId:i}=t;if(i){let r=Eg({tournamentRecord:e,participantId:i});return r.participant??r}return t.element||t.drawDefinition||t.event||t.tournamentRecord||{error:Yt}}function Wc(t){let{returnPreviousValues:e,itemSubTypes:i,itemType:n}=t,r=vae(t);if(r.error)return r;if(i&&!Array.isArray(i))return{error:Re,context:{itemSubTypes:i}};if(!Array.isArray(r.timeItems))return{error:KH};let a=r.timeItems.filter(s=>(s==null?void 0:s.itemType)===n).filter(s=>!(i!=null&&i.length)||i.some(l=>{var c;return(c=s==null?void 0:s.itemSubTypes)==null?void 0:c.includes(l)})).sort((s,l)=>{let c=new Date(s.createdAt||void 0).getTime(),u=new Date(l.createdAt||void 0).getTime();return c-u}),o=Ot(a.pop(),!1,!0);if(o){let s={timeItem:o,...ce};return e&&Object.assign(s,{previousItems:a}),s}else return{info:no}}function Qz({returnPreviousValues:t,drawDefinition:e,itemSubTypes:i,itemType:n}){if(!e)return{error:Pd};if(!e.timeItems)return{info:no};let{timeItem:r,previousItems:a,info:o}=Wc({element:e,returnPreviousValues:t,itemSubTypes:i,itemType:n});return r&&{timeItem:r,previousItems:a}||{info:o}}function vC({returnPreviousValues:t,itemSubTypes:e,itemType:i,event:n}){if(!n)return{error:Qn};if(!n.timeItems)return{info:no};let{timeItem:r,previousItems:a,info:o}=Wc({returnPreviousValues:t,element:n,itemSubTypes:e,itemType:i});return r&&{timeItem:r,previousItems:a}||{info:o}}function vx({returnPreviousValues:t,tournamentRecord:e,itemSubTypes:i,itemType:n}){if(!e)return{error:ut};if(!e.timeItems)return{info:no};let{timeItem:r,previousItems:a,info:o}=Wc({element:e,returnPreviousValues:t,itemSubTypes:i,itemType:n});return r&&{timeItem:r,previousItems:a}||{info:o}}function eq({returnPreviousValues:t,tournamentRecord:e,participantId:i,itemSubTypes:n,itemType:r}){if(!e)return{error:ut};if(!i)return{error:ya};let a=Eg({tournamentRecord:e,participantId:i});if(a.error)return a;let{participant:o}=a;if(!(o!=null&&o.timeItems))return{info:no};let{timeItem:s,previousItems:l,info:c}=Wc({element:a.participant,returnPreviousValues:t,itemSubTypes:n,itemType:r});return s&&{timeItem:s,previousItems:l}||{info:c}}var aMe={[ac]:"groupParticipantIds",[Ti]:"pairParticipantIds",[On]:"teamParticipantIds"},oMe={[ac]:"groups",[On]:"teams"};function yae({withIndividualParticipants:t,convertExtensions:e,tournamentRecord:i,withSignInStatus:n,withScaleValues:r,internalUse:a,withISO2:o,withIOC:s}){let l=[],c={};for(let u of i.participants??[]){let d=u==null?void 0:u.participantId;d&&cMe({participantMap:c,participantId:d})}for(let u of i.participants??[]){let d=Ot(u,e,a),{participantId:p,individualParticipantIds:h,participantType:f}=d;if(Object.assign(c[p].participant,d),h){let m=lMe({individualParticipantIds:h,participantCopy:d,participantMap:c,participantType:f,participantId:p});m.missingParticipantIds.length&&l.push(...m.missingParticipantIds)}if(n&&(c[p].participant.signedIn=sMe(d)),r){let{ratings:m,rankings:g,seedings:v}=RT({participant:d});c[p].participant.seedings=v,c[p].participant.rankings=g,c[p].participant.ratings=m}(s||o)&&gae({participant:c[p].participant,withISO2:o,withIOC:s})}if(t){let u=Xi(t)?t:void 0;rMe({participantMap:c,template:u})}return{missingParticipantIds:l,participantMap:c}}function sMe(t){let{timeItem:e}=Wc({itemType:gC,element:t});return(e==null?void 0:e.itemValue)===OD}function lMe({individualParticipantIds:t,participantCopy:e,participantMap:i,participantType:n,participantId:r}){var o;let a=[];for(let s of t){let l=(o=i[s])==null?void 0:o.participant;if(!l){a.push(s);continue}if(l[aMe[n]].push(r),[On,ac].includes(n)){let{participantRoleResponsibilities:c,participantOtherName:u,participantName:d,participantId:p,teamId:h}=e,f=oMe[n];l[f].push({participantRoleResponsibilities:c,participantOtherName:u,participantName:d,participantId:p,teamId:h})}if(n===Ti){let c=t.find(u=>u!==s);i[s].pairIdMap[r]=c,i[s].pairIdMap[c]=r}}return{missingParticipantIds:a}}function cMe({participantMap:t,participantId:e}){if(t[e])return;let i={walkoverWins:0,defaultWins:0,walkovers:0,defaults:0,losses:0,wins:0};t[e]={structureParticipation:{},potentialMatchUps:{},scheduleConflicts:{},scheduleItems:[],participant:{groupParticipantIds:[],pairParticipantIds:[],teamParticipantIds:[],seedings:{},rankings:{},ratings:{},groups:[],teams:[]},statistics:{},opponents:{},pairIdMap:{},matchUps:{},events:{},draws:{},counters:{[or]:{...i},[zn]:{...i},[On]:{...i},...i}}}function BI({participantsProfile:t,useParticipantMap:e,tournamentRecord:i,contextProfile:n,inContext:r}){var s;if(e)return{participantMap:(s=yae({...t,...n,tournamentRecord:i}))==null?void 0:s.participantMap};let a=Ot(i.participants,!1,!0)||[];(t!=null&&t.withIOC||t!=null&&t.withISO2)&&a.forEach(l=>gae({participant:l,...t}));let o;if((r||t!=null&&t.withGroupings)&&(a!=null&&a.length)&&({participantsWithGroupings:a,groupInfo:o}=Jz({participantsProfile:t,deepCopy:!1,participants:a})),(t==null?void 0:t.withScaleValues)&&(a==null?void 0:a.length))for(let l of a){let{ratings:c,rankings:u}=RT({participant:l});l.rankings=u,l.ratings=c}return{participants:a,groupInfo:o}}function dn({onlySpecifiedPolicyTypes:t=!1,policyTypes:e=[],tournamentRecord:i,drawDefinition:n,structure:r,event:a}){if(!Array.isArray(e))return{error:OH};let o={};return i&&s(i),a&&s(a),n&&s(n),r&&s(r),{appliedPolicies:o,...ce};function s(l){var u,d;let c=(d=(u=l==null?void 0:l.extensions)==null?void 0:u.find(p=>p.name===_D))==null?void 0:d.value;if(c)for(let p of Object.keys(c))(t?e.includes(p):!e.length||e.includes(p))&&(o[p]=Ot(c[p],!1,!0))}}function em({policyTypes:t=[],tournamentRecord:e,drawDefinition:i,structure:n,event:r}){if(!Array.isArray(t))return{error:OH};let{appliedPolicies:a}=dn({tournamentRecord:e,drawDefinition:i,structure:n,event:r}),o={};for(let s of t){let l=a==null?void 0:a[s];l&&(o[s]=l)}return Object.keys(o).length?{policyDefinitions:o}:{info:wb.message}}var bae="WALKOVER",jK="RETIRED",tq="COMPETITIVE",LD="ROUTINE",FD="DECISIVE",yN="winRatio",uMe={[of]:{policyName:"Competitive Bands Default",profileBands:{[FD]:20,[LD]:50}}},iq=uMe;function tm({policyDefinitions:t,tournamentRecord:e,contextProfile:i,drawDefinition:n,event:r}){let a={policies:{}};if(!i)return a;let o=em({tournamentRecord:e,drawDefinition:n,event:r}).policyDefinitions;if(i.withCompetitiveness){let s=(t==null?void 0:t[of])??(o==null?void 0:o[of])??iq[of];a.policies[of]=s}return a}function Ty({tournamentRecord:t,drawDefinition:e,policyType:i,structure:n,event:r}){if(!t)return{error:ut};let{appliedPolicies:a}=dn({tournamentRecord:t,drawDefinition:e,structure:n,event:r});return a!=null&&a[i]?{policy:a[i]}:{info:wb==null?void 0:wb.message}}function yC({tournamentRecord:t,categoryName:e,categoryType:i,event:n}){var s,l,c,u,d,p;e=e??((s=n==null?void 0:n.category)==null?void 0:s.categoryName)??((l=n==null?void 0:n.category)==null?void 0:l.ageCategoryCode),i=i??((c=n==null?void 0:n.category)==null?void 0:c.categoryType)??((u=n==null?void 0:n.category)==null?void 0:u.subType);let{policy:r}=Ty({policyType:Tg,tournamentRecord:t,event:n}),a=(d=t?Ri({element:t,name:Pf}).extension:void 0)==null?void 0:d.value,o=(p=n&&Ri({name:Pf,element:n}).extension)==null?void 0:p.value;return{scheduleTiming:{tournamentScheduling:a,eventScheduling:o,categoryName:e,categoryType:i,policy:r}}}function nq({drawDefinition:t,attributes:e}){let{extension:i}=Ri({element:t,name:TA}),n=(i==null?void 0:i.value)||{};return e.forEach(r=>{Object.keys(r).forEach(a=>{n[a]?Object.assign(n[a],r[a]):n[a]=r[a]})}),i={name:TA,value:n},ox({drawDefinition:t,extension:i}),{entryProfile:n}}function bC({drawDefinition:t}){let{extension:e}=Ri({element:t,name:TA});return{entryProfile:(e==null?void 0:e.value)||{}}}var yu="ALTERNATE",IC="CONFIRMED",Rl="DIRECT_ACCEPTANCE",wC="FEED_IN",SC="JUNIOR_EXEMPT",Rf="LUCKY_LOSER",TC="ORGANISER_ACCEPTANCE",UC="QUALIFIER",dMe="REGISTERED",DC="SPECIAL_EXEMPT",Fu="UNGROUPED",Uy="UNPAIRED",pS="WILDCARD",yh="WITHDRAWN",bN=[IC,Rl,SC,TC,DC],Iae=[wC,Rf,UC],Dy=[IC,Rl,wC,SC,TC,DC,pS],Bu=[IC,Rl,SC,Rf,UC,TC,DC,pS],wae=[yu,IC,Rl,wC,SC,Rf,TC,UC,dMe,DC,Fu,Uy,pS,yh],$u={ALTERNATE:yu,CONFIRMED:IC,DIRECT_ACCEPTANCE:Rl,DIRECT_ENTRY_STATUSES:Dy,DRAW_SPECIFIC_STATUSES:Iae,EQUIVALENT_ACCEPTANCE_STATUSES:bN,FEED_IN:wC,JUNIOR_EXEMPT:SC,LUCKY_LOSER:Rf,ORGANISER_ACCEPTANCE:TC,QUALIFIER:UC,SPECIAL_EXEMPT:DC,STRUCTURE_SELECTED_STATUSES:Bu,UNGROUPED:Fu,UNPAIRED:Uy,VALID_ENTRY_STATUSES:wae,WILDCARD:pS,WITHDRAWN:yh};function rq({stage:t,drawDefinition:e}){let{entryProfile:i}=bC({drawDefinition:e}),n=Object.keys(i).includes(t);if(!n&&Zk.includes(t)){let r=[{[t]:{drawSize:void 0,alternates:!0}}];return nq({drawDefinition:e,attributes:r}),!0}return n}function pMe({stage:t,drawDefinition:e}){var n;let{entryProfile:i}=bC({drawDefinition:e});return((n=i[t])==null?void 0:n.alternates)||0}function hMe({stage:t,drawDefinition:e}){var n;let{entryProfile:i}=bC({drawDefinition:e});return((n=i[t])==null?void 0:n.wildcardsCount)||0}function z2({stage:t,drawDefinition:e,entryStatus:i}){return e.entries.reduce((n,r)=>r.entryStage===t&&r.entryStatus===i?n+1:n,0)}function $I({provisionalPositioning:t,placementGroup:e,drawDefinition:i,stageSequence:n,entryStatuses:r,structureId:a,roundTarget:o,stages:s,stage:l}){var u;let c=((u=i.entries)==null?void 0:u.reduce((d,p)=>{var v,y;let h=(y=(v=Ri({name:Pp,element:p}))==null?void 0:v.extension)==null?void 0:y.value,f=l&&p.entryStage===l||(s==null?void 0:s.length)&&p.entryStage&&s.includes(p.entryStage),m=!r||p.entryStatus&&r.includes(p.entryStatus),g=p.entryStageSequence??1;return f&&(!n||g===n)&&m&&(!o||!h||o===h)?d.concat(p):d},[]))??[];if(a&&l===Fr){let{playoffEntries:d,error:p}=fMe({provisionalPositioning:t,drawDefinition:i,structureId:a});return p&&console.log("playoff entries error"),(d!=null&&d.length?d:c).filter(h=>!e||h.placementGroup===e)}return c}function fMe({provisionalPositioning:t,drawDefinition:e,structureId:i}){let n=[],r=(e.links??[]).find(a=>a.linkType===Uf&&a.target.structureId===i);if(r){let{finishingPositions:a,structureId:o}=r.source,{structure:s}=ui({drawDefinition:e,structureId:o});(s==null?void 0:s.structureType)===As&&(s.structures??[]).forEach(l=>{let c=l.positionAssignments??[],{structureId:u}=l,d=u,p=Object.assign({},...c.map(m=>{var y;let{participantId:g}=m,v=(y=Ri({element:m,name:qm}).extension)==null?void 0:y.value;return v&&g?{[g]:v}:void 0}).filter(Boolean)),h=Object.keys(p).reduce((m,g)=>{let v=p[g],y=v.groupOrder||t&&v.provisionalOrder;return m.includes(y)||m.push(y),m},[]).length===Object.keys(p).length,f=Object.keys(p).filter(m=>{let g=p[m],v=g.groupOrder||t&&g.provisionalOrder;return a==null?void 0:a.includes(v)});(!t||h)&&f.forEach(m=>{let g=p[m],{groupOrder:v,provisionalOrder:y,GEMscore:b}=g,I=v||t&&y,T=[...a??[]].sort(ma).indexOf(I)+1;n.push({entryStage:Fr,entryStatus:wC,placementGroup:T,groupingValue:d,participantId:m,GEMscore:b})})})}return{playoffEntries:n}}function mMe({stage:t,drawDefinition:e}){return Dy.reduce((i,n)=>(z2({drawDefinition:e,entryStatus:n,stage:t})||0)+i,0)}function Vc({provisionalPositioning:t,returnAllProxies:e,drawDefinition:i,structureId:n,structure:r}){var f;let a,o=[];r||({structure:r,error:a}=ui({drawDefinition:i,structureId:n}));let s=Vn({structure:r}).positionAssignments;if(a||!r)return{seedAssignments:[],error:wr};n||(n=r.structureId);let{stage:l,stageSequence:c}=r,u=l===Fr&&i&&$I({provisionalPositioning:t,drawDefinition:i,stageSequence:c,structureId:n,stage:l}),d=u?u.filter(m=>m.placementGroup===1).sort((m,g)=>m.GEMscore<g.GEMscore&&1||m.GEMscore>g.GEMscore&&-1||0).map((m,g)=>{let v=g+1;return{participantId:m.participantId,seedValue:v,seedProxy:!0,seedNumber:v}}):[],p=d==null?void 0:d.slice(0,e?d.length:s.length/2);p.length?o=p:r.seedAssignments?o=r.seedAssignments:a=lne;let h=r.seedLimit??((f=r==null?void 0:r.positionAssignments)==null?void 0:f.length);return{seedAssignments:o,stageSequence:c,seedLimit:h,stage:l,error:a}}var gMe=(t,e)=>(t||0)+(e||0);function Sae(t,e){let i=Array.isArray(t)?t[0]:t;return isNaN(i)&&bae||i<=e[FD]&&FD||i<=e[LD]&&LD||tq}function Tae({score:t}){let e=(t==null?void 0:t.sets)||[],i=e.reduce((r,a)=>(r[0]+=a.side1Score||0,r[1]+=a.side2Score||0,r),[0,0]),n=e.reduce((r,a)=>(r[0]+=a.side1TiebreakScore||0,r[1]+=a.side2TiebreakScore||0,r),[0,0]);return n.reduce(gMe)&&(i[n[0]>n[1]?0:1]+=1),{sets:e,games:i,score:t}}function vMe(t){let e=Math.min(...t.games),i=Math.max(...t.games);return Math.round(e/i*100)}function Uae(t){return t.map(vMe).sort().map(e=>parseFloat(e.toFixed(2)))}function EC({tournamentRecord:t,profileBands:e,matchUp:i}){if(!i)return{error:rl};let{score:n,winningSide:r}=i;if(!r)return{error:Re};let a=!e&&t&&Ty({policyType:of,tournamentRecord:t}).policy,o=e||(a==null?void 0:a.profileBands)||iq[of].profileBands,s=Tae({score:n}),l=Uae([s]),c=Sae(l,o),u=Array.isArray(l)?l[0]:l;return{...ce,competitiveness:c,pctSpread:u}}function Dae({matchUp:t}){var o,s,l;if(!t)return{error:rl};if(t&&!t.sides)return{error:al};if(t&&!t.hasContext)return{error:Vk};let e=(o=t.sides??[])==null?void 0:o.map(c=>c==null?void 0:c.participantId).filter(Boolean),i=((s=t.sides)==null?void 0:s.filter(c=>{var u;return((u=c.participant)==null?void 0:u.participantType)===Hi}).map(c=>c.participantId).filter(Boolean))??[],n=(((l=t.sides??[])==null?void 0:l.map(c=>{var u;return(u=c.participant)==null?void 0:u.individualParticipants}).filter(Boolean))??[]).map(c=>(c??[]).map(u=>u==null?void 0:u.participantId).filter(Boolean)),r=[...i,...n.flat()].filter(Boolean)??[],a=Pi(r.concat(e)).filter(Boolean)??[];return{nestedIndividualParticipantIds:n,allRelevantParticipantIds:a,individualParticipantIds:r,sideParticipantIds:e,...ce}}var DA="CHECK_IN",EA="CHECK_OUT",yMe="SCHEDULE",xT="SCHEDULE.ASSIGNMENT.VENUE",Mf="SCHEDULE.ALLOCATION.COURTS",Gv="SCHEDULE.ASSIGNMENT.COURT",yx="SCHEDULE.COURT.ORDER",OT="SCHEDULE.DATE",bMe="COMPLETED.DATE",Eae="HOME_PARTICIPANT_ID",Cae="SCHEDULE.ASSIGN.OFFICIAL",LT="SCHEDULE.TIME.SCHEDULED",id="SCHEDULE.TIME.START",vf="SCHEDULE.TIME.STOP",eh="SCHEDULE.TIME.RESUME",Nf="SCHEDULE.TIME.END",aq="SCHEDULE.TIME.MODIFIERS",Pae="TO_BE_ANNOUNCED",Rae="NEXT_AVAILABLE",Mae="FOLLOWED_BY",Nae="AFTER_REST",Aae="RAIN_DELAY",IMe="NOT_BEFORE",q2=[Pae,Rae,Mae,Nae,Aae],wMe="ELIGIBILITY",SMe="REGISTRATION",TMe="SUSPENSION",UMe="MEDICAL",DMe="PENALTY",_ae="SCALE",kae="RATING",xae="RANKING",oq="SEEDING",Cg="PUBLISH",oc="PUBLIC",Pg="STATUS",EMe="MODIFICATION",CMe="RETRIEVAL",PMe="other",bx={MUTUALLY_EXCLUSIVE_TIME_MODIFIERS:q2,AFTER_REST:Nae,ALLOCATE_COURTS:Mf,ASSIGN_COURT:Gv,ASSIGN_OFFICIAL:Cae,ASSIGN_VENUE:xT,CHECK_IN:DA,CHECK_OUT:EA,COMPLETED_DATE:bMe,COURT_ORDER:yx,ELIGIBILITY:wMe,END_TIME:Nf,FOLLOWED_BY:Mae,MEDICAL:UMe,MODIFICATION:EMe,NEXT_AVAILABLE:Rae,NOT_BEFORE:IMe,OTHER:PMe,PENALTY:DMe,PUBLIC:oc,PUBLISH:Cg,RANKING:xae,RATING:kae,RAIN_DELAY:Aae,REGISTRATION:SMe,RESUME_TIME:eh,RETRIEVAL:CMe,SCALE:_ae,SCHEDULE:yMe,SCHEDULED_DATE:OT,SCHEDULED_TIME:LT,SEEDING:oq,START_TIME:id,STATUS:Pg,STOP_TIME:vf,SUSPENSION:TMe,TIME_MODIFIERS:aq,TO_BE_ANNOUNCED:Pae};function VI({matchUp:t}){if(!t)return{error:rl};if(!t.hasContext)return{error:Vk};if(!t.sides||t.sides.filter(Boolean).length!==2)return{error:al};let{nestedIndividualParticipantIds:e,allRelevantParticipantIds:i,sideParticipantIds:n}=Dae({matchUp:t}),r=(t.timeItems??[]).filter(s=>(s==null?void 0:s.itemType)&&[DA,EA].includes(s.itemType)).sort((s,l)=>(s.createdAt?new Date(s.createdAt).getTime():0)-(l.createdAt?new Date(l.createdAt).getTime():0)),a=r.map(s=>s.itemValue).filter(s=>r.filter(l=>(l==null?void 0:l.itemValue)===s).reverse()[0].itemType===DA);e==null||e.forEach((s,l)=>{let c=n==null?void 0:n[l],u=(s==null?void 0:s.length)&&s.every(d=>a.includes(d));c&&u&&!a.includes(c)&&a.push(c)}),n==null||n.forEach((s,l)=>{a.includes(s)&&((e==null?void 0:e[l])??[]).forEach(c=>{c&&!a.includes(c)&&a.push(c)})});let o=n==null?void 0:n.reduce((s,l)=>a.includes(l)&&s,!0);return{allRelevantParticipantIds:i,allParticipantsCheckedIn:o,checkedInParticipantIds:a,...ce}}var Oae={[or]:[or,"S"],[zn]:[zn,"D"],[Xn]:[Xn,"T"],S:[or,"S"],D:[zn,"D"],T:[Xn,"T"]},Gr=t=>e=>{let i=Xi(e)&&(e==null?void 0:e.matchUpType)||$r(e)&&e;return i&&Oae[t].includes(i)};function x1(t){var a;let{matchUpAverageTimes:e,matchUpFormat:i}=t||{},n=(e==null?void 0:e.map(({matchUpFormatCodes:o})=>o==null?void 0:o.filter(s=>s===i)).flat().filter(Boolean).sort((o,s)=>((o==null?void 0:o.length)||0)-((s==null?void 0:s.length)||0)))||[],r=n.includes(i)?i:n[0];return(a=e==null?void 0:e.find(({matchUpFormatCodes:o,averageTimes:s})=>(o==null?void 0:o.find(l=>r===l))&&s))==null?void 0:a.averageTimes}function O1(t){var r;let{matchUpRecoveryTimes:e,averageMinutes:i,matchUpFormat:n}=t||{};return(r=e==null?void 0:e.find(({matchUpFormatCodes:a,averageTimes:o,recoveryTimes:s})=>{if(o&&i){let{greaterThan:l=0,lessThan:c=360}=o;if(i>l&&i<c)return!0}return(a==null?void 0:a.find(l=>l===n))&&s}))==null?void 0:r.recoveryTimes}function Lae({timesBlockArray:t,categoryName:e,categoryType:i}){return t.filter(n=>Array.isArray(n)).map(n=>n.sort((r,a)=>{var o,s;return(((o=a.categoryNames)==null?void 0:o.length)||0)-(((s=r.categoryNames)==null?void 0:s.length)||0)}).find(({categoryTypes:r,categoryNames:a})=>!(a!=null&&a.length)&&!(r!=null&&r.length)||(a==null?void 0:a.includes(e))||(r==null?void 0:r.includes(i)))).find(Boolean)}function RMe({tournamentScheduling:t,eventScheduling:e,averageMinutes:i,defaultTiming:n,matchUpFormat:r,categoryName:a,categoryType:o,policy:s}){var p;let l=(e==null?void 0:e.matchUpRecoveryTimes)&&O1({...e,averageMinutes:i,matchUpFormat:r}),c=(t==null?void 0:t.matchUpRecoveryTimes)&&O1({...t,averageMinutes:i,matchUpFormat:r}),u=(s==null?void 0:s.matchUpRecoveryTimes)&&O1({...s,averageMinutes:i,matchUpFormat:r}),d=[l,c,u,(p=s==null?void 0:s.defaultTimes)==null?void 0:p.recoveryTimes,n==null?void 0:n.recoveryTimes];return Lae({categoryName:a,categoryType:o,timesBlockArray:d})}function MMe({matchUpFormat:t,categoryName:e,categoryType:i,defaultTiming:n,tournamentScheduling:r,eventScheduling:a,policy:o}){var d;let s=(a==null?void 0:a.matchUpAverageTimes)&&x1({...a,matchUpFormat:t}),l=(r==null?void 0:r.matchUpAverageTimes)&&x1({...r,matchUpFormat:t}),c=(o==null?void 0:o.matchUpAverageTimes)&&x1({...o,matchUpFormat:t}),u=[s,l,c,(d=o==null?void 0:o.defaultTimes)==null?void 0:d.averageTimes,n==null?void 0:n.averageTimes];return Lae({categoryName:e,categoryType:i,timesBlockArray:u})}var Fae="DOUBLES_SINGLES",Bae="SINGLES_DOUBLES",bu="total",W2="participantConflict",Cm="matchUpConflict",$ae="ISSUE_IDS",ov="CONFLICT",sv="WARNING",K2="ERROR",Y2="ISSUE",IN="STATE",Vae={SINGLES_DOUBLES:Bae,DOUBLES_SINGLES:Fae,TOTAL:bu,CONFLICT_MATCHUP_ORDER:Cm,CONFLICT_PARTICIPANTS:W2,SCHEDULE_ISSUE_IDS:$ae,SCHEDULE_CONFLICT:ov,SCHEDULE_WARNING:sv,SCHEDULE_ERROR:K2,SCHEDULE_ISSUE:Y2,SCHEDULE_STATE:IN};function CC({defaultAverageMinutes:t=90,defaultRecoveryMinutes:e=0,tournamentRecord:i,matchUpFormat:n,categoryName:r,categoryType:a,eventType:o,event:s}){if(!i)return{error:ut};o=o??(s==null?void 0:s.eventType)??qb;let l={averageTimes:[{minutes:{default:t}}],recoveryTimes:[{minutes:{default:e}}]},{scheduleTiming:c}=yC({tournamentRecord:i,categoryName:r,categoryType:a,event:s}),u={...c,matchUpFormat:n,categoryType:a,defaultTiming:l};return Ix({eventType:o,timingDetails:u})}function Ix({timingDetails:t,eventType:e}){let i=MMe(t),n=Object.keys((i==null?void 0:i.minutes)||{}),r=(i==null?void 0:i.minutes)&&((n==null?void 0:n.includes(e))&&i.minutes[e]||i.minutes.default),a=RMe({...t,averageMinutes:r}),o=Object.keys((a==null?void 0:a.minutes)||{}),s=(a==null?void 0:a.minutes)&&((o==null?void 0:o.includes(e))&&a.minutes[e]||a.minutes.default),l=Gr(qb)(e)?Bae:Fae,c=(a==null?void 0:a.minutes)&&((o==null?void 0:o.includes(l))&&a.minutes[l]||s);return{averageMinutes:r,recoveryMinutes:s,typeChangeRecoveryMinutes:c}}function gM(t){return t.createdAt?new Date(t.createdAt).getTime():0}function Rg({visibilityThreshold:t,timeItems:e,itemType:i}){let n=e.filter(a=>a&&a.itemType===i&&(!t||gM(a)<new Date(t).getTime())).sort((a,o)=>gM(a)-gM(o)).pop(),r=n&&gM(n);return{itemValue:n==null?void 0:n.itemValue,timeStamp:r}}function Z2({visibilityThreshold:t,timeStamp:e,schedule:i,matchUp:n}){let{itemValue:r,timeStamp:a}=Rg({timeItems:(n==null?void 0:n.timeItems)||[],itemType:LT,visibilityThreshold:t});return!i||a&&e&&new Date(a).getTime()>new Date(e).getTime()?{scheduledTime:r}:i}function Hv({visibilityThreshold:t,timeStamp:e,schedule:i,matchUp:n}){let{itemValue:r,timeStamp:a}=Rg({timeItems:(n==null?void 0:n.timeItems)||[],itemType:OT,visibilityThreshold:t});return!i||a&&e&&new Date(a).getTime()>new Date(e).getTime()?{scheduledDate:r}:i}function jae({visibilityThreshold:t,timeStamp:e,schedule:i,matchUp:n}){let{itemValue:r,timeStamp:a}=Rg({timeItems:(n==null?void 0:n.timeItems)||[],itemType:Mf,visibilityThreshold:t});return!i||a&&e&&new Date(a).getTime()>new Date(e).getTime()?{allocatedCourts:Ot(r,!1,!0)}:i}function Gae({visibilityThreshold:t,timeStamp:e,schedule:i,matchUp:n}){let{itemValue:r,timeStamp:a}=Rg({timeItems:(n==null?void 0:n.timeItems)||[],itemType:Gv,visibilityThreshold:t});return!i||a&&e&&new Date(a).getTime()>new Date(e).getTime()?{courtId:r}:i}function Hae({visibilityThreshold:t,timeStamp:e,schedule:i,matchUp:n}){let{itemValue:r,timeStamp:a}=Rg({timeItems:(n==null?void 0:n.timeItems)||[],itemType:xT,visibilityThreshold:t});return!i||a&&e&&new Date(a).getTime()>new Date(e).getTime()?{venueId:r}:i}function sq({visibilityThreshold:t,timeStamp:e,schedule:i,matchUp:n}){let{itemValue:r,timeStamp:a}=Rg({timeItems:(n==null?void 0:n.timeItems)||[],itemType:aq,visibilityThreshold:t});return!i||a&&e&&new Date(a).getTime()>new Date(e).getTime()?{timeModifiers:r}:i}function Xy(t){if(Gre.test(t)){let e=yz();return new Date(`${e}T${t}`)}else return new Date(t)}function NMe({matchUp:t}){if(!t)return{error:rl};if(!t.timeItems)return{error:KH};let e=t.timeItems.filter(n=>[id,vf,eh,Nf].includes(n==null?void 0:n.itemType)).sort((n,r)=>Xy(n.itemValue).getTime()-Xy(r.itemValue).getTime()),i=e.reduce((n,r)=>{var l,c;let a,o=(l=r==null?void 0:r.itemType)==null?void 0:l.split("."),s=`SCHEDULE.TIME.${((c=r==null?void 0:r.itemType)==null?void 0:c.startsWith("SCHEDULE.TIME"))&&o[2]}`;switch(s){case id:a=0;break;case Nf:if(n.lastValue&&[id,eh].includes(n.lastType)){let u=Xy(r.itemValue).getTime()-Xy(n.lastValue).getTime();a=n.milliseconds+u}else a=n.milliseconds;break;case vf:if([id,"SCHECULE.TIME.RESUME"].includes(n.lastType)){let u=Xy(r.itemValue).getTime()-Xy(n.lastValue).getTime();a=n.milliseconds+u}else a=n.milliseconds;break;default:a=n.milliseconds;break}return{milliseconds:a,lastType:s,lastValue:r.itemValue}},{milliseconds:0,lastType:void 0,lastValue:void 0});if([id,eh].includes(i.lastType)){let n=new Date().getTime()-Xy(i.lastValue).getTime();i.milliseconds+=n}return{milliseconds:i.milliseconds,time:AMe(i.milliseconds),relevantTimeItems:e}}function AMe(t){let e=(i,n=2)=>("00"+i).slice(-n);return e(t/36e5|0)+":"+e(t%36e5/6e4|0)+":"+e(t%6e4/1e3|0)}function _Me({visibilityThreshold:t,timeStamp:e,schedule:i,matchUp:n}){let{itemValue:r,timeStamp:a}=Rg({timeItems:(n==null?void 0:n.timeItems)||[],itemType:yx,visibilityThreshold:t});return!i||a&&e&&new Date(a).getTime()>new Date(e).getTime()?{courtOrder:r}:i}function kMe({matchUp:t}){var n;let e=(t==null?void 0:t.timeItems)||[],i=r=>r.createdAt?new Date(r.createdAt).getTime():0;return{startTime:(n=e.reduce((r,a)=>{let o=a.itemType===id&&a;return o&&(!r||i(o)<i(r))?o:r},void 0))==null?void 0:n.itemValue}}function xMe(t=1){return Et(0,t).map(Pn)}function Pn(){let t=[];for(let a=0;a<256;a++)t[a]=(a<16?"0":"")+a.toString(16);let e=Math.random()*4294967295|0,i=Math.random()*4294967295|0,n=Math.random()*4294967295|0,r=Math.random()*4294967295|0;return t[e&255]+t[e>>8&255]+t[e>>16&255]+t[e>>24&255]+"-"+t[i&255]+t[i>>8&255]+"-"+t[i>>16&15|64]+t[i>>24&255]+"-"+t[n&63|128]+t[n>>8&255]+"-"+t[n>>16&255]+t[n>>24&255]+t[r&255]+t[r>>8&255]+t[r>>16&255]+t[r>>24&255]}function PC(t){let{disableNotice:e,venue:i,context:n}=t;if(typeof i!="object")return{error:Re};let r=qc(t);i.venueId||(i.venueId=Pn());let a;for(let o of Object.values(r)){let s=OMe({disableNotice:!0,tournamentRecord:o,context:n,venue:i});if(s!=null&&s.error)return s;a=s.venue}return e||wi({topic:Fz,payload:{venue:i}}),zt({...ce,venue:a})}function OMe({tournamentRecord:t,disableNotice:e,context:i,venue:n}){return t?n?(t.venues||(t.venues=[]),n.venueId||(n.venueId=Pn()),t.venues.reduce((r,a)=>r||a.venueId===n.venueId,void 0)?{error:Hne}:(i&&cn({element:n,extension:{value:i,name:Zre}}),t.venues.push(n),e||wi({payload:{venue:n,tournamentId:t.tournamentId},topic:Fz}),{...ce,venue:Ot(n)})):{error:Yt,info:"missing venue"}:{error:ut}}function kh({tournamentRecords:t,tournamentRecord:e,venueId:i}){if(!e)return{error:ut};if(!i)return{error:wg};let n=(e.venues??[]).reduce((r,a)=>a.venueId===i?a:r,void 0);if(!n&&t){let r=(fC({tournamentRecords:t}).linkedTournamentIds??[])[e.tournamentId];for(let a of r){let o=t[a],s=kh({tournamentRecord:o,venueId:i});if(s.success&&s.venue)return PC({tournamentRecord:e,venue:s.venue}),{...ce,venue:n}}}return n?{...ce,venue:n}:{error:AI}}function lq({convertExtensions:t,...e}){let{tournamentRecords:i,tournamentRecord:n,venueId:r}=e,a=kh({tournamentRecords:i,tournamentRecord:n,venueId:r});return Ot(a,t,!0)}function jI({tournamentRecords:t,tournamentRecord:e,courtId:i}){if(!e)return{error:ut};if(!i)return{error:RI};let n="findCourt",r,a;if((e.venues??[]).forEach(o=>{(o.courts??[]).forEach(s=>{s.courtId===i&&(r=s,a=o)})}),r)return{...ce,court:r,venue:a};if(t){let o=(fC({tournamentRecords:t}).linkedTournamentIds??[])[e.tournamentId];for(let s of o){let l=t[s],c=jI({tournamentRecord:l,courtId:i});if(c.success)return c.venue&&PC({tournamentRecord:e,venue:c.venue}),{...ce,court:r,venue:a}}}return pe({result:{error:ST},stack:n})}function cq(t){return Ot(jI(t),!1,!0)}function wx({tournamentRecord:t,internalUse:e,courtId:i}){if(!t)return{error:ut};if(!i)return{error:RI};let n=jI({tournamentRecord:t,courtId:i});if(n.error)return n;let r=n.court&&(({altitude:a,courtId:o,courtName:s,courtDimensions:l,latitude:c,longitude:u,surfaceCategory:d,surfaceType:p,surfacedDate:h,pace:f,notes:m})=>({altitude:a,courtId:o,courtName:s,courtDimensions:l,latitude:c,longitude:u,surfaceCategory:d,surfaceType:p,surfacedDate:h,pace:f,notes:m}))(n.court);return{...ce,courtInfo:Ot(r,!1,e)}}function hS({tournamentRecord:t,venueId:e}){var o;if(!t)return{error:ut};if(!e)return{error:wg};let i=kh({tournamentRecord:t,venueId:e});if(i.error)return i;let n=(((o=i.venue)==null?void 0:o.courts)??[]).map(s=>(({courtInfo:l})=>({...l}))(wx({courtId:s.courtId,internalUse:!0,tournamentRecord:t}))),r=i.venue&&(({venueId:s,venueName:l,venueAbbreviation:c})=>({venueAbbreviation:c,venueName:l,venueId:s}))(i.venue),a=r&&{...r,courtsInfo:n};return{...ce,venueData:Ot(a,!1,!0)}}function LMe({matchUp:t}){var n;let e=(t==null?void 0:t.timeItems)||[],i=r=>r.createdAt?new Date(r.createdAt).getTime():0;return{endTime:(n=e.reduce((r,a)=>{let o=a.itemType===Nf&&a;return o&&(!r||i(o)>i(r))?o:r},void 0))==null?void 0:n.itemValue}}function Zr({event:t,eventId:e}){var r,a;if(!t)return{error:Qn};let i=(r=Ri({name:Pu,element:t}))==null?void 0:r.extension,n=e?Ot(i==null?void 0:i.value,!1,!0):i==null?void 0:i.value;return e&&((a=t.drawDefinitions)==null||a.forEach(o=>{var s;(s=n==null?void 0:n.flights)==null||s.forEach(l=>{l.drawId===o.drawId&&Object.assign(l,{drawDefinition:o})})})),{flightProfile:n}}function zs(t){let{tournamentRecord:e,eventId:i,drawId:n}=t,r="findEvent",a={},o=t.tournamentRecords??(e&&{[e.tournamentId]:e})??{},s=Object.values(o).map(({events:c,tournamentId:u})=>(c&&c.forEach(d=>{a[d.eventId]={tournamentId:u}}),c??[])).flat(),l;if(n){let c,u=s.find(d=>{var h,f,m;let p=((d==null?void 0:d.drawDefinitions)??[]).find(g=>g.drawId===n);if(p)c=p,l=a[d.eventId].tournamentId;else{let g=(m=(f=d&&((h=Zr({event:d}))==null?void 0:h.flightProfile))==null?void 0:f.flights)==null?void 0:m.find(v=>v.drawId===n);if(g)return l=a[d.eventId].tournamentId,{entries:g.drawEntries,drawName:g.drawName,tournamentId:l,drawId:n}}return p});if(u)return{event:u,drawDefinition:c,tournamentId:l}}if(i){let c=s.find(u=>(u==null?void 0:u.eventId)===i);if(c)l=a[c.eventId].tournamentId;else return{event:void 0,drawDefinition:void 0,...pe({result:{error:Xl},stack:r})};return{event:c,drawDefinition:void 0,tournamentId:l}}return{event:void 0,drawDefinition:void 0,...pe({result:{error:Zl},context:{drawId:n,eventId:i},stack:r})}}function Sx(t){let{visibilityThreshold:e,timeStamp:i,schedule:n,matchUp:r}=t,a=di(t,[{[_h]:!0}]);if(a.error)return a;let{itemValue:o,timeStamp:s}=Rg({timeItems:(r==null?void 0:r.timeItems)||[],itemType:Eae,visibilityThreshold:e});return!n||s&&i&&new Date(s).getTime()>new Date(i).getTime()?{homeParticipantId:o}:n}function Tx(t){var w,S,D,E,C,P,R,N,M;let e=t.event,i=t.matchUpType,{scheduleVisibilityFilters:n,afterRecoveryTimes:r,tournamentRecord:a,usePublishState:o,scheduleTiming:s,matchUpFormat:l,publishStatus:c,matchUp:u}=t;if(!u)return{error:rl};if(r&&!u.matchUpType&&!t.matchUpType&&(e||a)&&u.drawId){let A=(w=e==null?void 0:e.drawDefinitions)==null?void 0:w.find(x=>x.drawId===u.drawId);!A&&a&&({drawDefinition:A,event:e}=zs({tournamentRecord:a,drawId:u.drawId}));let _=u.structureId&&((S=A==null?void 0:A.structures)==null?void 0:S.find(({structureId:x})=>x===u.structureId));i=t.matchUpType||(_==null?void 0:_.matchUpType)||(A==null?void 0:A.matchUpType)||(e==null?void 0:e.eventType)!==ga&&(e==null?void 0:e.eventType)}let{milliseconds:d,time:p}=NMe({matchUp:u}),{startTime:h}=kMe({matchUp:u}),{endTime:f}=LMe({matchUp:u}),m,{visibilityThreshold:g,eventIds:v,drawIds:y}=n??{};if((!v||v.includes(u.eventId))&&(!y||y.includes(u.drawId))){let A={matchUp:u,visibilityThreshold:g},{allocatedCourts:_}=jae(A),{homeParticipantId:x}=Sx(A),{scheduledTime:O}=Z2(A),{timeModifiers:B}=sq(A),{scheduledDate:F}=Hv(A),{venueId:G}=Hae(A),{courtId:H}=Gae(A),{courtOrder:$}=_Me(A),q,z,Z,Y,Q,X=u.matchUpType??i;if(s&&O&&r&&X){let de={matchUpFormat:u.matchUpFormat??l,...s};({averageMinutes:z=0,recoveryMinutes:Z=0,typeChangeRecoveryMinutes:Y=0}=Ix({timingDetails:de,eventType:X})),(z||Z)&&(q=f?tl(ir(f),Z):tl(O,z+Z)),Y&&(Q=f?tl(ir(f),Y):tl(O,z+Y))}!F&&O&&(F=Ei(O));let oe=vA({scheduledDate:F,scheduledTime:O}),re={},me=((D=a&&G&&hS({tournamentRecord:a,venueId:G}))==null?void 0:D.venueData)||{};G&&(re[G]=me);let{venueName:se,venueAbbreviation:te,courtsInfo:he}=me,ae=(E=H&&(he==null?void 0:he.find(de=>de.courtId===H)))==null?void 0:E.courtName;for(let de of _||[]){if(!a)break;de.venueId&&!re[de.venueid]&&(re[de.venueId]=(C=hS({venueId:de.venueId,tournamentRecord:a}))==null?void 0:C.venueData);let Ie=re[de.venueId];de.venueName=Ie==null?void 0:Ie.venueName;let De=(P=Ie==null?void 0:Ie.courtsInfo)==null?void 0:P.find(Te=>Te.courtId===de.courtId);de.courtName=De==null?void 0:De.courtName}m=zt({typeChangeTimeAfterRecovery:Q,timeAfterRecovery:q,scheduledDate:F,scheduledTime:O,isoDateString:oe,allocatedCourts:_,homeParticipantId:x,timeModifiers:B,venueAbbreviation:te,venueName:se,venueId:G,courtOrder:$,courtName:ae,courtId:H,typeChangeRecoveryMinutes:Y,recoveryMinutes:Z,averageMinutes:z,milliseconds:d,startTime:h,endTime:f,time:p})}else m=zt({milliseconds:d,startTime:h,endTime:f,time:p});let{scheduledDate:b}=Hv({matchUp:u}),{scheduledTime:I}=Z2({matchUp:u});if(o&&((R=c==null?void 0:c.displaySettings)!=null&&R.draws)){let A=c.displaySettings.draws,_=(N=(A==null?void 0:A[u.drawId])??(A==null?void 0:A.default))==null?void 0:N.scheduleDetails;if(_){let x=(M=_.find(O=>{var B;return b&&((B=O.dates)==null?void 0:B.includes(b))})??_.find(O=>{var B;return!((B=O.dates)!=null&&B.length)}))==null?void 0:M.attributes;if(x){let O=Object.assign({},...Object.keys(m).map(B=>({[B]:!0})),x);m=Kb({source:m,template:O})}}}let T=u.matchUpStatus&&ba.includes(u.matchUpStatus)&&(Ei(f)||Ei(b)||Ei(I))||void 0;return{schedule:m,endDate:T}}function Hd(t){if(!t)return;let{tieFormatId:e,tieFormats:i}=t;if(t.tieFormat)return t.tieFormat;if(e&&Array.isArray(i))return i.find(n=>n.tieFormatId===e)}function L1({item:t,drawDefinition:e,structure:i,event:n}){var r,a,o;if(t){if(t.tieFormat)return t.tieFormat;if(t.tieFormatId)return e.tieFormat?e.tieFormat:((r=e.tieFormats)==null?void 0:r.find(l=>t.tieFormatId===l.tieFormatId))||(n.tieFormat?n.tieFormat:(a=n.tieFormats)==null?void 0:a.find(l=>t.tieFormatId===l.tieFormatId));if(i.tieFormat)return i.tieFormat;if(i.tieFormatId){let s=(o=e.tieFormats)==null?void 0:o.find(l=>i.tieFormatId===l.tieFormatId);if(s)return s}}}function is({drawDefinition:t,structure:e,matchUp:i,event:n}){return{tieFormat:L1({item:i,drawDefinition:t,structure:e,event:n})||L1({item:e,drawDefinition:t,structure:e,event:n})||Hd(t)||Hd(n)}}function FMe({matchUps:t}){let e=t.reduce((i,n)=>!n.collectionPosition||i.includes(n.collectionPosition)?i:i.concat(n.collectionPosition),[]).map(i=>({[i]:t.filter(n=>n.collectionPosition===i)}));return{collectionPositionMatchUps:Object.assign({},...e)}}function Ao({drawDefinition:t,structure:e}){let i={},n=[];return((t==null?void 0:t.structures)??[e]).filter(r=>r&&typeof r=="object").forEach(r=>{if(!r)return;let{structureId:a,matchUps:o,structures:s}=r,l=Array.isArray(s);if(l)l&&s.forEach(c=>{let{structureName:u}=c,d=c.matchUps;i[c.structureId]={matchUps:d,itemStructureIds:[],structureName:u},d&&(n.push(...d),d.forEach(p=>{p.tieMatchUps&&n.push(...p.tieMatchUps)})),i[a]||(i[a]={itemStructureIds:[],matchUps:[]}),i[a].itemStructureIds||(i[a].itemStructureIds=[]),i[a].itemStructureIds.push(c.structureId)});else{let c=o;i[a]={matchUps:c,itemStructureIds:[]},c==null||c.forEach(u=>{n.push(u),u.tieMatchUps&&n.push(...u.tieMatchUps)})}}),{mappedMatchUps:i,drawMatchUps:n}}function zv({mappedMatchUps:t,matchUpsMap:e,structureId:i,inContext:n}){t=(e==null?void 0:e.mappedMatchUps)??t;let r=t[i],a=((r==null?void 0:r.itemStructureIds)||[]).map(o=>{let{matchUps:s,structureName:l}=t[o];return n?s.map(c=>Object.assign(Ot(c,!0,!0),{containerStructureId:i,structureId:o,structureName:l})):s}).flat();return((r==null?void 0:r.matchUps)||[]).concat(...a)}function zae({groupedOrder:t,roundPositionsCount:e}){if(!t||(t==null?void 0:t.length)<=e)return t;let i=ro(t,t.length/e).map(r=>r.reduce((a,o)=>a+o)),n=i.slice().sort(ma);return i.map(r=>n.indexOf(r)+1)}function Ux(t){if(!Xi(t))return!1;let{matchUpId:e,drawPositions:i}=t,n=typeof e=="string",r=!i||Array.isArray(i)&&i.length<=2&&i.every(a=>yi(a)||a===void 0||a===null);return n&&r}function Kc(t){return Array.isArray(t)?t.every(Ux):!1}function Us({matchUps:t=[],interpolate:e}){var d;if(!Kc(t))return{roundMatchUps:[],error:Re};let i=t.reduce((p,h)=>{let f=typeof h.roundNumber=="string"?ri(h.roundNumber):h.roundNumber;return!h.roundNumber||p.includes(f)?p:p.concat(f)},[]).sort(ma).map(p=>{let h=t.filter(g=>g.roundNumber===p),f=h.find(({matchUpType:g})=>g===Xn)?h.filter(({matchUpType:g})=>g===Xn):h,m=g=>g.sort((v,y)=>ma(v.roundPosition,y.roundPosition));return{[p]:m(f)}}),n=t.reduce((p,h)=>{let f=typeof h.roundNumber=="string"?ri(h.roundNumber):h.roundNumber;return p[f]||(p[f]=zt({abbreviatedRoundName:h.abbreviatedRoundName,finishingRound:h.finishingRound,roundName:h.roundName})),p},{}),r=Object.assign({},...i);if(e){let p=Math.max(...Object.keys(r).map(f=>ri(f)).filter(f=>!isNaN(f))),h=(d=r[p])==null?void 0:d.length;if(h>1&&bd(h)){let f=p+1,m=f+h/2;Et(f,m).forEach((g,v)=>{r[g]=Et(0,h/(2+v*2)).map(()=>({}))})}}let a=0,o=Object.assign({},...Object.keys(r).map(p=>{var g,v,y;let h=(g=r[p])==null?void 0:g.length,f=(y=(v=r[p])==null?void 0:v.filter(b=>{var I;return!ba.includes(b.matchUpStatus)&&!((I=b.score)!=null&&I.scoreStringSide1)}))==null?void 0:y.length,m=h&&h===f;return a=Math.max(a,h),{[p]:{matchUpsCount:h,inactiveCount:f,inactiveRound:m}}})),s=0,l=0,c=Object.keys(r).map(p=>ri(p)).filter(p=>!isNaN(p));c.forEach(p=>{var m,g,v,y,b;let h=r[p].sort((I,T)=>I.roundPosition-T.roundPosition),f=h.map(I=>(I==null?void 0:I.drawPositions)||[]).flat();if(o[p].roundNumber=p,o[p].roundFactor=o[p].matchUpsCount?a/o[p].matchUpsCount:1,o[p].finishingRound=(m=n[p])==null?void 0:m.finishingRound,o[p].roundName=(g=n[p])==null?void 0:g.roundName,o[p].abbreviatedRoundName=(v=n[p])==null?void 0:v.abbreviatedRoundName,o[p].finishingPositionRange=(b=(y=r[p])==null?void 0:y[0])==null?void 0:b.finishingPositionRange,p===1||!o[p-1]){let I=f.sort(ma),T=ro(I,2);o[p].drawPositions=I,o[p].pairedDrawPositions=T}else{let I=o[p-1],T=I.drawPositions,w=I.matchUpsCount/o[p].matchUpsCount,S=ro(T,w),D=h.map(E=>{let{roundPosition:C}=E,P=[...E.drawPositions||[],void 0,void 0].slice(0,2);if(!C)return P;let R=(P==null?void 0:P.filter(Boolean))||[];if(!(R!=null&&R.length))return[void 0,void 0];if(p<3&&(R==null?void 0:R.length)===2)return P==null?void 0:P.slice().sort(ma);let N=zr(T,R).length!==(R==null?void 0:R.length);if(R!=null&&R.length&&N)return(R==null?void 0:R.length)===1?[R[0],void 0]:P==null?void 0:P.slice().sort(ma);let M=(C-1)*2;return S.slice(M,M+2).map(A=>R==null?void 0:R.find(_=>A.includes(_)))});o[p].drawPositions=D==null?void 0:D.flat(),o[p].pairedDrawPositions=D}o[p+1]&&o[p+1].matchUpsCount===o[p].matchUpsCount&&(o[p+1].feedRound=!0,o[p+1].feedRoundIndex=l,o[p].preFeedRound=!0,l+=1),o[p]&&!o[p].feedRound&&(o[p].roundIndex=s,s+=1)});let u=!!Object.values(o).find(({matchUpsCount:p})=>!bd(p));return{hasNoRoundPositions:t.some(p=>!p.roundPosition),roundsNotPowerOf2:u,maxMatchUpsCount:a,roundMatchUps:r,roundNumbers:c,roundProfile:o,...ce}}function wN(t){if(!Array.isArray(t))return"";let e=t.filter(Rr);return e.length?Pi([Math.min(...e),Math.max(...e)]).join("-"):""}function BMe({drawDefinition:t,structureId:e,matchUpsMap:i}){if(!t)return{error:Vt};if(!e)return{error:nc};let{structure:n}=ui({drawDefinition:t,structureId:e});if((n==null?void 0:n.stage)!==Po)return{error:vy,info:"Structure is not CONSOLATION stage"};let{links:r}=t,a=(r==null?void 0:r.filter(d=>d.target.structureId===e))||[],o=(a==null?void 0:a.reduce((d,p)=>{let{structureId:h}=p.source;return d.includes(h)?d:d.concat(h)},[]))||[],s=Object.assign({},...o.map(d=>{let p=zv({structureId:d,matchUpsMap:i}),h=Us({matchUps:p}).roundProfile;return{[d]:h}})),l=zv({matchUpsMap:i,structureId:e}),{roundProfile:c}=Us({matchUps:l}),u={};return a==null||a.forEach(d=>{var R,N,M;let{structureId:p,roundNumber:h}=d.source,{feedProfile:f,groupedOrder:m,positionInterleave:g,roundNumber:v}=d.target,y=s[p],b=(R=y[1])==null?void 0:R.drawPositions,I=(N=y[h])==null?void 0:N.matchUpsCount;if(!I)return;let T=I?b.length/I:0,w=b.length/T,S=b.slice(),D=zae({roundPositionsCount:w,groupedOrder:m}),E=(D==null?void 0:D.length)||1;if(E<=w){let A=b.length/E,_=ro(S,A);f===Fv&&_.forEach(x=>x.reverse()),S=(D==null?void 0:D.length)&&(D==null?void 0:D.map(x=>_[x-1]).flat())||S}let C=ro(S,T);if(g){let A=Et(0,g.interleave).map(()=>{}),_=Et(0,g.offset).map(()=>{});C=C.map(O=>[O,...A]),C.unshift(_),C=C.flat(1);let x=C.length-g.offset;C=C.slice(0,x)}u[v]||(u[v]={});let P=(M=c==null?void 0:c[v])!=null&&M.feedRound?2:1;C.forEach((A,_)=>{let x=1+_*P;u[v][x]||(u[v][x]=wN(A))})}),{sourceDrawPositionRanges:u}}function $Me({drawPositions:t,roundProfile:e,roundNumber:i}){var s;let n=[void 0,void 0];if(mre(t))return{orderedDrawPositions:n,displayOrder:n};let r=e==null?void 0:e[i],a=((s=r==null?void 0:r.pairedDrawPositions)==null?void 0:s.find(l=>Ts(l||[],t.filter(Boolean))))??n,o=r==null?void 0:r.feedRound;if(fre(t)){let l=[...t].sort(ma);return{orderedDrawPositions:l.length===2?l:a,displayOrder:o?l:a}}if(o){let l=[t.find(c=>!isNaN(ri(c))),void 0];return{orderedDrawPositions:l,displayOrder:l}}return{orderedDrawPositions:a,displayOrder:a}}function CA({collectionPosition:t,collectionId:e,lineUp:i}){let n=[],r=[];if(i){let a=s=>s===void 0?-1:s,o=i.map(s=>{let{collectionAssignments:l,participantId:c}=s,u=l==null?void 0:l.find(d=>d.collectionPosition===t&&d.collectionId===e);return u&&{participantId:c,...u}}).filter(Boolean).sort((s,l)=>a(s.substitutionOrder)-a(l.substitutionOrder));for(let s of o){let{participantId:l,previousParticipantId:c,substitutionOrder:u}=s;n.includes(l)||(c&&r.push({previousParticipantId:c,substitutionOrder:u,participantId:l}),n=n.filter(d=>d!==c),n.push(l))}}return{assignedParticipantIds:n,substitutions:r}}function Mu({tournamentParticipants:t,tournamentRecord:e,participantIds:i}){let n="getPairedParticipant";if(!t&&!e)return{error:ut};if(!Array.isArray(i)||i.length>2)return{error:Ul};if(!i.length)return pe({result:{error:Ig},stack:n});t=t??(e==null?void 0:e.participants)??[];let r=t.filter(s=>s.participantType===Ti&&zr(i,s.individualParticipantIds).length===i.length&&s.individualParticipantIds.length===i.length),a=r[0];if(!a)return pe({result:{error:Vr},stack:n});let o=Ot(r.slice(1),!1,!0);return{participant:Ot(a),duplicatedPairParticipants:o,...ce}}function qv({drawDefinition:t,participantId:e}){if(typeof t!="object")return{error:Vt};if(typeof e!="string")return{error:ya};let{extension:i}=Ri({element:t,name:Cf});return{lineUp:((i==null?void 0:i.value)||{})[e]}}function VMe({tournamentParticipants:t,positionAssignments:e,collectionPosition:i,drawPositions:n=[],participantMap:r,drawDefinition:a,collectionId:o,sideLineUps:s,matchUpType:l}){if(!o||!i)return{};let c=({attribute:d,lineUp:p,teamParticipant:h})=>{var g,v,y,b;let{assignedParticipantIds:f,substitutions:m}=CA({collectionPosition:i,collectionId:o,lineUp:p});if(l===zn){if((f==null?void 0:f.length)<=2){let I=(v=(g=r==null?void 0:r[f[0]])==null?void 0:g.pairIdMap)==null?void 0:v[f[1]],T=(b=I&&((y=r[I])==null?void 0:y.participant)||Mu({participantIds:f,tournamentParticipants:t}).participant)==null?void 0:b.participantId;return{[d]:{participantId:T,teamParticipant:h,substitutions:m}}}else if((f==null?void 0:f.length)>2)return{[d]:{teamParticipant:h,substitutions:m}}}else{let I=f==null?void 0:f[0];return I&&{[d]:{participantId:I,teamParticipant:h,substitutions:m}}}};if(!(n!=null&&n.length)){let d=(s==null?void 0:s.map(p=>{var g;let{teamParticipant:h,sideNumber:f}=p,m=p.lineUp||((g=qv({participantId:h.teamParticipantId,drawDefinition:a}))==null?void 0:g.lineUp);return c({attribute:f,lineUp:m,teamParticipant:h})}).filter(Boolean))||{};return{sideNumberCollectionAssignment:Object.assign({},...d)}}let u=(n==null?void 0:n.map(d=>{var g,v,y;let p=(g=e.find(b=>b.drawPosition===d))==null?void 0:g.participantId,h=s==null?void 0:s.find(b=>(b==null?void 0:b.drawPosition)===d),f=(h==null?void 0:h.teamParticipant)||p&&((v=r==null?void 0:r[p])==null?void 0:v.participant)||(t==null?void 0:t.find(({participantId:b})=>b===p)),m=(h==null?void 0:h.lineUp)||((y=qv({participantId:p,drawDefinition:a}))==null?void 0:y.lineUp);return c({attribute:d,lineUp:m,teamParticipant:f})}).filter(Boolean))||{};return{drawPositionCollectionAssignment:Object.assign({},...u)}}function qae({drawDefinition:t}){if(typeof t!="object")return{error:Ib};let e={},{structures:i=[],links:n=[]}=t||{},r=i.reduce((o,s)=>{let{stage:l}=s;return o[l]?o[l].push(s):o[l]=[s],o},{});for(let o of Object.keys(r)){let s=r[o].find(({stageSequence:c})=>c===1);if(!s)continue;let{structureId:l}=s;a({aggregator:{},targetRound:0,exitProfiles:e,exitProfile:"0",structureId:l,stage:o})}return{exitProfiles:e};function a({exitProfiles:o,exitProfile:s,structureId:l,targetRound:c,aggregator:u,stage:d}){o[l]||(o[l]=[]),s==="0"&&[Po,Fr].includes(d)||o[l].push(s);let p=n.filter(h=>h.source.structureId===l&&h.source.roundNumber>=c);for(let h of p){let f=h.source.roundNumber,m=h.target.roundNumber,g=h.target.structureId,v=i.find(b=>b.structureId===g).stage,y=[v,g,m,f].join("|");if(u[y])return;u[y]=!0,a({exitProfile:`${s}-${f}`,structureId:g,exitProfiles:o,targetRound:m,aggregator:u,stage:v})}}}function jMe({drawDefinition:t,roundProfile:e,structureId:i,matchUpsMap:n}){var o;if(!t)return{error:Vt};if(!i)return{error:nc};if(!e){let s=zv({matchUpsMap:n,structureId:i});if({roundProfile:e}=Us({matchUps:s}),!e)return{error:Yt}}let r=(Math.min(...((o=e==null?void 0:e[1])==null?void 0:o.drawPositions)??[])||1)-1,a=Object.keys(e);return{drawPositionsRanges:Object.assign({},...(a||[]).map(s=>{var v,y;let l=(v=e==null?void 0:e[s])==null?void 0:v.matchUpsCount,c=((y=e==null?void 0:e[1])==null?void 0:y.drawPositions)??[],u=ro(c,c.length/l),d=u.map(wN),p=u.map(b=>b.map(I=>I-r)).map(wN),h=a.map(b=>{var T;if(b>s)return;let I=((T=e==null?void 0:e[b])==null?void 0:T.drawPositions)??[];return ro(I,I.length/l)}).filter(Boolean),f=Et(0,l).map(b=>h.map(I=>I[b]).flat().filter(Boolean).sort(ma)).map(b=>Pi(b)),m=f.map(b=>WPe(b).map(wN).join(", ")),g=Object.assign({},...Et(0,l).map(b=>({[b+1]:{firstRoundDrawPositionsRange:d[b],firstRoundOffsetDrawPositionsRange:p[b],possibleDrawPositions:f[b],drawPositionsRange:m[b]}})));return{[s]:g}}))}}function uq({roundsNotPowerOf2:t,drawDefinition:e,structure:i,matchUps:n}){var a;if(!i)return!1;n=n??i.matchUps??[],t=t??Us({matchUps:n}).roundsNotPowerOf2;let r=!!((a=i.positionAssignments)!=null&&a.find(({drawPosition:o})=>o))||!!(n!=null&&n.find(({drawPositions:o})=>o==null?void 0:o.length));return(!(e!=null&&e.drawType)||e.drawType!==yy)&&!(i!=null&&i.structures)&&t&&r}function sl({structure:t}){if(!t)return!1;let e=t.matchUps||t.roundMatchUps&&Object.values(t.roundMatchUps).flat(),i=!!(e!=null&&e.find(r=>r==null?void 0:r.roundPosition)),n=!!(e!=null&&e.find(r=>{var a;return(a=r==null?void 0:r.drawPositions)==null?void 0:a.length}));return!(t!=null&&t.structures)&&(t==null?void 0:t.stage)!==Ja&&(!e.length||!i&&!n)}var dq={[cS]:{policyName:"Round Naming Default",namingConventions:{round:"Round",pre:"Pre"},qualifyingFinishMap:{1:"Final"},abbreviatedRoundNamingMap:{1:"F",2:"SF",4:"QF"},roundNamingMap:{1:"Final",2:"Semifinal",4:"Quarterfinal"},affixes:{roundNumber:"R",preFeedRound:"Q",preQualifying:"P"},stageConstants:{[xt]:"",[Fr]:"P",[Zt]:"Q",[Po]:"C"}}},GMe=dq;function HMe({roundNamingPolicy:t,drawDefinition:e,structure:i,matchUps:n}){var R,N,M;let{roundProfile:r,roundMatchUps:a}=Us({matchUps:n}),{structureAbbreviation:o,stage:s}=i,l=sl({structure:i}),c=uq({structure:i}),u=i.structures,d={},p=dq[cS],h=i.stage===Zt,f=h?Math.max(...((e==null?void 0:e.structures)??[]).filter(A=>A.stage===Zt).map(({stageSequence:A})=>A??1),0):0,m=(i.stageSequence??1)<f?i.stageSequence??1:"",g=m&&(((R=t==null?void 0:t.affixes)==null?void 0:R.preQualifying)||p.affixes.preQualifying)||"",v=(t==null?void 0:t.roundNamingMap)||p.roundNamingMap||{},y=(t==null?void 0:t.abbreviatedRoundNamingMap)||p.abbreviatedRoundNamingMap||{},b=((N=t==null?void 0:t.affixes)==null?void 0:N.preFeedRound)||p.affixes.preFeedRound,I=((M=t==null?void 0:t.affixes)==null?void 0:M.roundNumber)||p.affixes.roundNumber,T=((t==null?void 0:t.namingConventions)||p.namingConventions).round,w=s&&s!==xt?s[0]:"",S=(t==null?void 0:t.stageConstants)||p.stageConstants,D=s&&(S==null?void 0:S[s])||w,E=`${g}${D}${m}`,C=r?Object.keys(r):[],P=h&&(S!=null&&S[Zt])?`${S==null?void 0:S[Zt]}-`:"";if(u||l||c)Object.assign(d,...C.map(A=>{let _=`${P}${T} ${A}`,x=`${I}${A}`;return{[A]:{roundName:_,abbreviatedRoundName:x}}}));else{let A=h&&((t==null?void 0:t.qualifyingFinishMap)||(p==null?void 0:p.qualifyingFinishMap)||{});Object.assign(d,...C.map(_=>{if(!(r!=null&&r[_]))return;let{matchUpsCount:x,preFeedRound:O}=r[_],B=x*2,F=(A==null?void 0:A[r==null?void 0:r[_].finishingRound])||A&&`${I}${B}`||v[x]||`${I}${B}`,G=O?`-${b}`:"",H=`${F}${G}`,$=[E,o,H].filter(Boolean).join("-"),q=`${y[x]||`${I}${B}`}${G}`,z=[E,o,q].filter(Boolean).join("-");return{[_]:{abbreviatedRoundName:z,roundName:$}}}))}return{roundNamingProfile:d,roundProfile:r,roundMatchUps:a}}function Dx(t){var r,a,o;let e=di(t,[{[_h]:!0}]);if(e.error)return e;let i=t==null?void 0:t.matchUp,n=i==null?void 0:i.matchUpType;if(!n&&((r=i==null?void 0:i.sides)!=null&&r.length)){let s=(o=(a=i.sides.find(({participant:l})=>l))==null?void 0:a.participant)==null?void 0:o.participantType;n=s===Hi&&or||s===Ti&&zn||s===On&&On||void 0}return{matchUpType:n}}var zMe="normal",GK="timed",qMe="final",pq="NOAD",SN="SET",WMe={S:zMe,F:qMe};function Ys(t){if(typeof t=="string"){let e=t.startsWith("T")&&GK||t.startsWith(SN)&&SN||"";if(e===GK){let i=Kae(t),n={simplified:!0,setFormat:i,bestOf:1};if(i)return n}if(e===SN)return KMe(t)}}function KMe(t){let e=t.split("-"),i=RC(e[0].slice(3)),n=i===1||i%2!==0?i:void 0,r=i!==1&&i%2===0?i:void 0,a=e&&HK(e[1]),o=e&&HK(e[2]),s=a&&a.timed||o&&o.timed,l=n&&n<6||s&&r,c=!e[2]||o,u=a,d=zt({setFormat:a,exactly:r,bestOf:n});if(o&&(d.finalSetFormat=o),l&&u&&c)return d}function HK(t){if((t==null?void 0:t[1])===":"){let e=t.split(":"),i=WMe[e[0]],n=e[1];if(i&&n){if(n.startsWith("TB")){let f=zK(n);return f===!1?!1:typeof f=="object"?{tiebreakSet:f}:void 0}if(n.startsWith("T"))return Kae(n);let r=t.match(/^[FS]:(\d+)([A-Za-z]*)/),a=r&&Yae(r[2])||!1,o=!(r!=null&&r[2])||a,s=r?RC(r[1]):void 0,l=Wae(n),c=l!==!1,u=c&&l||s,d=zK(n.split("/")[1]),p=d!==!1,h={setTo:s};return a&&(h.NoAD=!0),d?(h.tiebreakFormat=d,h.tiebreakAt=u):h.noTiebreak=!0,s&&o&&p&&c&&h||!1}}}function Wae(t,e=!0){let i=(t==null?void 0:t.indexOf("@"))>0&&t.split("@");if(i)return(e?RC(i[1]):i[1])||!1}function zK(t){if(t)if(t.startsWith("TB")){let e=Wae(t,!1),i=t.match(/^TB(\d+)([A-Za-z]*)/),n=i==null?void 0:i[1],r=i&&Yae(i[2]),a=!(i!=null&&i[2])||r,o=RC(n);if(o&&a){let s={tiebreakTo:o};return e&&typeof e=="string"&&!yi(e)&&(s.modifier=e),r&&(s.NoAD=!0),s}else return!1}else return!1}function Kae(t){var s;let e=t.slice(1),i=e.match(/^(\d+)(@?[A-Za-z]*)/),n=RC(i==null?void 0:i[1]);if(!n)return;let r={timed:!0,minutes:n},a=i==null?void 0:i[2],o=[void 0,"P","G"].includes(a);if(a&&!o){let l=(s=e.match(/^(\d+)(@)([A-Za-z]+)$/))==null?void 0:s[3];return l?(r.modifier=l,r):void 0}return a&&(r.based=i[2]),r}function Yae(t){return t&&t.indexOf(pq)>=0}function RC(t){return isNaN(Number(t))?0:Number(t)}function Ex(t,e){return!Array.isArray(t)||!$r(e)?!1:zr(t,Oae[e]).length}function sf(t){if(!Array.isArray(t.matchUps))return[];let{matchUps:e,excludeMatchUpStatuses:i,hasParticipantsCount:n,isCollectionMatchUp:r,matchUpStatuses:a,hasWinningSide:o,matchUpFormats:s,roundPositions:l,matchUpFormat:c,collectionIds:u,isMatchUpTie:d,roundNumbers:p,matchUpIds:h,roundNames:f,filterMatchUpTypes:m=!0,filterMatchUpIds:g=!0,stageSequences:v,scheduledDates:y,scheduledDate:b,participantIds:I,processContext:T,tournamentIds:w,matchUpTypes:S,structureIds:D,readyToScore:E,courtIds:C,eventIds:P,venueIds:R,drawIds:N,stages:M}=t,A=Array.isArray(I)?I.filter(Boolean):[],_=Array.isArray(a)?a.filter(Boolean):[],x=Array.isArray(i)?i.filter(Boolean):[],O=Array.isArray(M)?M.filter(Boolean):[],B=Array.isArray(v)?v.filter(Boolean):[],F=Array.isArray(u)?u.filter(Boolean):[],G=Array.isArray(f)?f.filter(Boolean):[],H=Array.isArray(p)?p.filter(Boolean):[],$=Array.isArray(l)?l.filter(Boolean):[],q=Array.isArray(h)&&g?h.filter(Boolean):[],z=Array.isArray(S)&&m?S.filter(Boolean):[],Z=Array.isArray(C)?C.filter(Boolean):[],Y=Array.isArray(R)?R.filter(Boolean):[],Q=Array.isArray(s)&&s.filter(Boolean)||typeof c=="string"&&[c]||[],X=Array.isArray(y)&&y.filter(Boolean)||typeof b=="string"&&b.length&&[b]||[],oe=Array.isArray(w)?w.filter(Boolean):[],re=Array.isArray(P)?P.filter(Boolean):[],me=Array.isArray(N)?N.filter(Boolean):[],se=Array.isArray(D)?D.filter(Boolean):[];return e.filter(te=>{var he;if(E&&!Gr(pp)(te)&&!te.readyToScore||te.winningSide&&o&&![1,2].includes(te.winningSide)||d!==void 0&&(d&&!te.tieMatchUps||!d&&te.tieMatchUps)||r!==void 0&&(r&&!te.collectionId||!r&&te.collectionId)||O.length&&!O.includes(te.stage)||B.length&&!B.includes(te.stageSequence)||F.length&&(!te.collectionId||!F.includes(te.collectionId))||G.length&&(!te.roundName||!G.includes(te.roundName))||H.length&&(!te.roundNumber||!H.includes(te.roundNumber))||$.length&&(!te.roundPosition||!$.includes(te.roundPosition))||_.length&&(!te.matchUpStatus||!_.includes(te.matchUpStatus))||x.length&&te.matchUpStatus&&x.includes(te.matchUpStatus)||q.length&&!q.includes(te.matchUpId)||z.length&&(!te.matchUpType||!Ex(z,te.matchUpType))||Q.length&&(!te.matchUpFormat||!Q.includes(te.matchUpFormat)))return!1;if(X!=null&&X.length){let{scheduledTime:ae}=Z2({matchUp:te}),{scheduledDate:de}=Hv({matchUp:te}),Ie=Ei(ae)||de;if(!X.find(De=>vh(De,Ie)))return!1}if(Z.length){let{courtId:ae}=Gae({matchUp:te}),{allocatedCourts:de}=jae({matchUp:te}),Ie=de==null?void 0:de.map(({courtId:De})=>De);if(!Z.filter(Boolean).includes(ae)||Ie!=null&&Ie.includes(ae))return!1}if(Y.length){let{venueId:ae}=Hae({matchUp:te});if(!Y.filter(Boolean).includes(ae))return!1}if(T){if(oe.length&&!oe.includes(te.tournamentId)||re.length&&!re.includes(te.eventId)||me.length&&!me.includes(te.drawId)||se.length&&!se.includes(te.structureId))return!1;let ae=((he=te.sides)==null?void 0:he.map(({participantId:de})=>de).filter(Boolean))??[];if(n&&ae.length<n||A.length&&!A.some(de=>ae.includes(de)))return!1}return!0})}function YMe({drawPositionCollectionAssignment:t,sideNumberCollectionAssignment:e,positionAssignments:i,displaySideNumber:n,seedAssignments:r,drawPosition:a,isFeedRound:o,sideNumber:s}){var h,f,m,g;let l=i.find(v=>v.drawPosition&&v.drawPosition===a),c=a&&t,u=s&&e,d=c?(h=c[a])==null?void 0:h.participantId:l==null?void 0:l.participantId,p=l?ZMe({displaySideNumber:n,seedAssignments:r,participantId:d,assignment:l,sideNumber:s}):{...u==null?void 0:u[s]};if(o&&(s===1?Object.assign(p,{participantFed:!0}):Object.assign(p,{participantAdvanced:!0})),a&&c){let v=(f=c[a])==null?void 0:f.teamParticipant,y=(m=c[a])==null?void 0:m.participant,b=(g=c[a])==null?void 0:g.substitutions;y&&(p.participant=y),b&&(p.substitutions=b),v&&(p.teamParticipant=v)}return p}function ZMe({displaySideNumber:t,seedAssignments:e,participantId:i,assignment:n,sideNumber:r}){let a={drawPosition:n.drawPosition,displaySideNumber:t,sideNumber:r};if(i){let o=XMe({seedAssignments:e,participantId:i});Object.assign(a,o,{participantId:i})}else n.bye&&Object.assign(a,{bye:!0});return n.qualifier&&Object.assign(a,{qualifier:!0}),a}function XMe({seedAssignments:t,participantId:e}){return t==null?void 0:t.find(i=>!i.seedProxy&&i.participantId===e)}var Id="ANY",Gn="MALE",nl="MIXED",Sv="OTHER",hr="FEMALE",Mp={ANY:Id,MALE:Gn,FEMALE:hr,MIXED:nl,OTHER:Sv};function wn({scheduleVisibilityFilters:t,tournamentAppliedPolicies:e,provisionalPositioning:i,tournamentParticipants:n,afterRecoveryTimes:r,policyDefinitions:a,tournamentRecord:o,seedAssignments:s,usePublishState:l,contextFilters:c,contextContent:u,matchUpFilters:d,participantMap:p,scheduleTiming:h,contextProfile:f,drawDefinition:m,publishStatus:g,context:v={},exitProfiles:y,matchUpsMap:b,structure:I,inContext:T,event:w}){var Ve,ot,St,nt,Bt;let S={},D={};if(n=n??(o==null?void 0:o.participants),!I)return{collectionPositionMatchUps:S,error:gy,roundMatchUps:D,matchUps:[]};let E=Array.isArray(d==null?void 0:d.eventIds)?d==null?void 0:d.eventIds.filter(Boolean):[],C=Array.isArray(d==null?void 0:d.structureIds)?d==null?void 0:d.structureIds.filter(Boolean):[],P=Array.isArray(d==null?void 0:d.drawIds)?d==null?void 0:d.drawIds.filter(Boolean):[],R=!(v!=null&&v.eventId)||!(E!=null&&E.length)&&!((Ve=c==null?void 0:c.eventIds)!=null&&Ve.filter(Boolean).length)||(E==null?void 0:E.includes(v.eventId))||((ot=c==null?void 0:c.eventIds)==null?void 0:ot.includes(v.eventId)),N=!(C!=null&&C.length)||C.includes(I.structureId),M=!m||!(P!=null&&P.length)||P.includes(m.drawId);if(!R||!N||!M)return{collectionPositionMatchUps:S,roundMatchUps:D,matchUps:[]};f&&!u&&(u=tm({tournamentRecord:o,contextProfile:f,drawDefinition:m}));let{appliedPolicies:A}=dn({drawDefinition:m}),_={...e,...A,...a},x=(St=_==null?void 0:_.scoring)==null?void 0:St.structures,O=I.stage&&(x==null?void 0:x.stage)&&(x==null?void 0:x.stage[I.stage]),B=I.stageSequence&&(O==null?void 0:O.stageSequence)&&O.stageSequence[I.stageSequence],F=((nt=_==null?void 0:_.scoring)==null?void 0:nt.requireAllPositionsAssigned)||(O==null?void 0:O.requireAllPositionsAssigned)||(B==null?void 0:B.requireAllPositionsAssigned);b||(b=Ao({drawDefinition:m,structure:I}));let{positionAssignments:G,allPositionsAssigned:H}=ja({structure:I}),$=!F||H,{seedAssignments:q}=Vc({provisionalPositioning:i,drawDefinition:m,structure:I});s=s??q;let{roundOffset:z,structureId:Z,structureName:Y,stage:Q,stageSequence:X}=I,{drawId:oe,drawName:re,drawType:me}=m??{};y=y||m&&qae({drawDefinition:m}).exitProfiles;let se=y==null?void 0:y[Z],te=(se==null?void 0:se.length)&&(se[0].split("-").map(Pe=>parseInt(Pe)).reduce((Pe,et)=>Pe+et)||0),he=!!I.structures,ae=zv({matchUpsMap:b,structureId:Z,inContext:T}),de=_==null?void 0:_[cS],Ie=HMe({roundNamingPolicy:de,drawDefinition:m,structure:I,matchUps:ae}),{roundNamingProfile:De,roundProfile:Te}=Ie;if(D=(Ie==null?void 0:Ie.roundMatchUps)??[],d&&(ae=sf({matchUps:ae,...d,filterMatchUpTypes:!1,filterMatchUpIds:!1})),T){let{sourceDrawPositionRanges:Pe}=BMe({drawDefinition:m,matchUpsMap:b,structureId:Z}),et=m?jMe({drawDefinition:m,roundProfile:Te,matchUpsMap:b,structureId:Z}).drawPositionsRanges:void 0;ae=ae.map(Ee=>_e({scheduleVisibilityFilters:t,sourceDrawPositionRanges:Pe,drawPositionsRanges:et,roundNamingProfile:De,initialRoundOfPlay:te,appliedPolicies:_,usePublishState:l,publishStatus:g,isRoundRobin:he,roundProfile:Te,matchUp:Ee,event:w})),(ae==null?void 0:ae.filter(Ee=>Array.isArray(Ee.tieMatchUps))).forEach(Ee=>{let lt=Ee.tieMatchUps;ae=ae.concat(...lt)}),c&&(ae=sf({processContext:!0,...c,matchUps:ae}))}else(ae==null?void 0:ae.filter(Pe=>Array.isArray(Pe.tieMatchUps))).forEach(Pe=>{let et=Pe.tieMatchUps;ae=ae.concat(...et)});return d&&(ae=sf({matchUps:ae,...d,filterMatchUpTypes:!1,filterMatchUpIds:!1})),(d!=null&&d.matchUpTypes||d!=null&&d.matchUpIds)&&(ae=sf({matchUpTypes:d.matchUpTypes,matchUpIds:d.matchUpIds,matchUps:ae})),(d!=null&&d.matchUpTypes||d!=null&&d.matchUpIds||T)&&(D=Us({matchUps:ae}).roundMatchUps??[]),(Bt=is({drawDefinition:m,structure:I,event:w}))!=null&&Bt.tieFormat&&({collectionPositionMatchUps:S}=FMe({matchUps:ae})),{collectionPositionMatchUps:S,roundMatchUps:D,isRoundRobin:he,roundProfile:Te,matchUpsMap:b,matchUps:ae};function _e({scheduleVisibilityFilters:Pe,sourceDrawPositionRanges:et,drawPositionsRanges:Ee,initialRoundOfPlay:lt,additionalContext:Ke,roundNamingProfile:bt,tieDrawPositions:gt,appliedPolicies:Ue,isCollectionBye:xe,usePublishState:We,publishStatus:st,matchUpTieId:vt,isRoundRobin:ge,roundProfile:Se,sideLineUps:qe,matchUp:$e,event:ke}){var Fs,mt,hi,Nn,xr,cs,pn,Un,mr,Vl,Dn,Na,Yi,Di,gr;Ke=Ke??{};let Ut=(Fs=is({drawDefinition:m,structure:I,matchUp:$e,event:ke}))==null?void 0:Fs.tieFormat,pt=Ut==null?void 0:Ut.collectionDefinitions,tt=$e.collectionId&&(pt==null?void 0:pt.find(xi=>xi.collectionId===$e.collectionId)),At=$e.collectionId?tt==null?void 0:tt.matchUpFormat:$e.matchUpFormat??(I==null?void 0:I.matchUpFormat)??(m==null?void 0:m.matchUpFormat)??(ke==null?void 0:ke.matchUpFormat),ei=$e.matchUpType||(tt==null?void 0:tt.matchUpType)||(I==null?void 0:I.matchUpType)||(m==null?void 0:m.matchUpType)||!Gr(ga)(ke==null?void 0:ke.eventType)&&(ke==null?void 0:ke.eventType),vi=xe?vn:$e.matchUpStatus,{schedule:Ln,endDate:gn}=Tx({scheduleVisibilityFilters:Pe,afterRecoveryTimes:r,tournamentRecord:o,usePublishState:We,scheduleTiming:h,matchUpFormat:At,publishStatus:st,matchUpType:ei,matchUp:$e,event:ke}),Jt=gt??$e.drawPositions??[],{collectionPosition:kr,collectionId:Kn,roundPosition:Gt}=$e,Ji=$e.roundNumber??Ke.roundNumber,xo=Kn?VMe({tournamentParticipants:n,positionAssignments:G,collectionPosition:kr,drawDefinition:m,participantMap:p,drawPositions:Jt,collectionId:Kn,sideLineUps:qe,matchUpType:ei}):void 0,na=((mt=bt==null?void 0:bt[Ji])==null?void 0:mt.roundName)||Ke.roundName,ra=((hi=bt==null?void 0:bt[Ji])==null?void 0:hi.abbreviatedRoundName)||Ke.abbreviatedRoundName,vo=(Nn=Se==null?void 0:Se[Ji])==null?void 0:Nn.feedRound,aa=(xr=Se==null?void 0:Se[Ji])==null?void 0:xr.preFeedRound,fr=(cs=Se==null?void 0:Se[Ji])==null?void 0:cs.roundFactor,Ma=Ee==null?void 0:Ee[Ji],tu=Gt?Ma==null?void 0:Ma[Gt]:void 0,Zo=et==null?void 0:et[Ji],Xs=tt!=null&&tt.category?{...(v==null?void 0:v.category)||{},...tt.category}:(v==null?void 0:v.category)??(ke==null?void 0:ke.category),Os=((pn=$e.processCodes)==null?void 0:pn.length)&&$e.processCodes||((Un=tt==null?void 0:tt.processCodes)==null?void 0:Un.length)&&(tt==null?void 0:tt.processCodes)||((mr=I==null?void 0:I.processCodes)==null?void 0:mr.length)&&(I==null?void 0:I.processCodes)||((Vl=m==null?void 0:m.processCodes)==null?void 0:Vl.length)&&(m==null?void 0:m.processCodes)||((Dn=ke==null?void 0:ke.processCodes)==null?void 0:Dn.length)&&(ke==null?void 0:ke.processCodes)||(o==null?void 0:o.processCodes),Qi=(f==null?void 0:f.withCompetitiveness)&&EC({...u,matchUp:$e}),za=$e.finishingPositionRange??Ke.finishingPositionRange,Pr=xi=>zt(xi,void 0,!0),Vi={...Pr(v),...Pr({matchUpFormat:$e.matchUpType===ga?void 0:At,tieFormat:$e.matchUpType!==ga?void 0:Ut,gender:(tt==null?void 0:tt.gender)??(ke==null?void 0:ke.gender),roundOfPlay:Q!==Zt&&yi(lt)&&lt+(Ji||0),endDate:$e.endDate??gn,discipline:ke==null?void 0:ke.discipline,category:Xs,finishingPositionRange:za,abbreviatedRoundName:ra,drawPositionsRange:tu,competitiveProfile:Qi,structureName:Y,stageSequence:X,drawPositions:Jt,matchUpStatus:vi,processCodes:Os,isRoundRobin:ge,matchUpTieId:vt,preFeedRound:aa,matchUpType:ei,roundFactor:fr,roundOffset:z,structureId:Z,roundNumber:Ji,feedRound:vo,roundName:na,drawName:re,drawType:me,schedule:Ln,drawId:oe,stage:Q}),...Ot(Pr($e),!0,!0)};if(At&&((Na=$e.score)!=null&&Na.scoreStringSide1)){let xi=Ys(At),{bestOf:vr,finalSetFormat:_t,setFormat:oi}=xi??{};(_t!=null&&_t.tiebreakSet||oi!=null&&oi.tiebreakSet||oi!=null&&oi.timed)&&(Vi.score.sets=Vi.score.sets.sort((Oi,nn)=>Oi.setNumber-nn.setNumber).map((Oi,nn)=>(nn+1===vr?(_t!=null&&_t.tiebreakSet||_t!=null&&_t.timed)&&(Oi.tiebreakSet=!0):(oi!=null&&oi.tiebreakSet||oi!=null&&oi.timed)&&(Oi.tiebreakSet=!0),Oi)))}if(Array.isArray(Jt)){let{orderedDrawPositions:xi,displayOrder:vr}=$Me({drawPositions:Jt,roundProfile:Se,roundNumber:Ji}),_t=(Yi=Se==null?void 0:Se[Ji])==null?void 0:Yi.feedRound,oi=vr[0]!==xi[0],Oi=xi.concat(void 0,void 0).slice(0,2).map((nn,si)=>{var Aa;let ji=si+1,ur=oi?3-ji:ji,Mi=YMe({...xo,positionAssignments:G,displaySideNumber:ur,seedAssignments:s,drawPosition:nn,isFeedRound:_t,sideNumber:ji}),Sa=(Aa=$e.sides)==null?void 0:Aa.find(Bs=>Bs.sideNumber===ji),jl=Gt?(Gt-1)*2+si+1:void 0,Xo=jl?Zo==null?void 0:Zo[jl]:void 0;return Pr({sourceDrawPositionRange:Xo,...Sa,...Mi})});Object.assign(Vi,Ot({sides:Oi},!0,!0))}if(n&&Vi.sides){let xi=Ue==null?void 0:Ue[NT],vr=_t=>{var Oi;let oi=(Oi=p==null?void 0:p[_t])==null?void 0:Oi.participant;return oi&&Kb({template:xi==null?void 0:xi.participant,source:oi})};if(Vi.sides.filter(Boolean).forEach(_t=>{var oi,Oi,nn;if(_t.participantId){let si=Ot(vr(_t.participantId)||n&&zm({policyDefinitions:Ue,participantId:_t.participantId,tournamentParticipants:n,internalUse:!0,contextProfile:f}),void 0,!0);if(si){if(m!=null&&m.entries){let ji=m.entries.find(ur=>ur.participantId===_t.participantId);ji!=null&&ji.entryStatus&&(si.entryStatus=ji.entryStatus),ji!=null&&ji.entryStage&&(si.entryStage=ji.entryStage)}Object.assign(_t,{participant:si})}}if((Oi=(oi=_t==null?void 0:_t.participant)==null?void 0:oi.individualParticipantIds)!=null&&Oi.length&&!((nn=_t.participant.individualParticipants)!=null&&nn.length)){let si=_t.participant.individualParticipantIds.map(ji=>vr(ji)||n&&zm({policyDefinitions:Ue,tournamentParticipants:n,internalUse:!0,contextProfile:f,participantId:ji}));Object.assign(_t.participant,{individualParticipants:si})}}),!Vi.matchUpType){let{matchUpType:_t}=Dx({matchUp:Vi});_t&&Object.assign(Vi,{matchUpType:_t})}if(f!=null&&f.inferGender&&(!Vi.gender||Vi.gender===nl)&&((Di=Vi.sides)==null?void 0:Di.length)===2&&Vi.matchUpType!==ga){let _t=Vi.sides.map(oi=>{var Oi,nn,si,ji;if(Gr(or)(Vi.matchUpType))return(nn=(Oi=oi.participant)==null?void 0:Oi.person)==null?void 0:nn.sex;if(((ji=(si=oi.participant)==null?void 0:si.individualParticipants)==null?void 0:ji.length)===2){let ur=Pi(oi.participant.individualParticipants.map(Mi=>{var Sa;return(Sa=Mi.person)==null?void 0:Sa.sex})).filter(Boolean);if(ur.length===1)return ur[0]}});if(_t.filter(Boolean).length===2&&Pi(_t).length===1){let oi=_t[0];Vi.inferredGender=oi}}}if(Vi.tieMatchUps){let xi=Vi.matchUpStatus===vn,vr=(gr=Vi.sides)==null?void 0:gr.map(({participant:_t,drawPosition:oi,sideNumber:Oi,lineUp:nn})=>{let si=(_t==null?void 0:_t.participantType)===ga&&_t;return{teamParticipant:si&&zt({participantRoleResponsibilities:si.participantRoleResponsibilities,participantOtherName:si.participanOthertName,participantName:si.participantName,participantId:si.participantId,teamId:si.teamId}),drawPosition:oi,sideNumber:Oi,lineUp:nn}});Vi.tieMatchUps=Vi.tieMatchUps.map(_t=>{let oi=Vi.matchUpId,Oi={finishingPositionRange:Vi.finishingPositionRange,abbreviatedRoundName:ra,roundNumber:Ji,roundName:na};return _e({tieDrawPositions:Jt,scheduleVisibilityFilters:Pe,sourceDrawPositionRanges:et,sideLineUps:vr,drawPositionsRanges:Ee,initialRoundOfPlay:lt,roundNamingProfile:bt,additionalContext:Oi,appliedPolicies:Ue,isCollectionBye:xi,usePublishState:We,publishStatus:st,matchUpTieId:oi,isRoundRobin:ge,roundProfile:Se,matchUp:_t,event:ke})})}let Ls=Vi.sides&&Vi.sides.filter(xi=>xi==null?void 0:xi.participantId).length===2,hl=!Vi.winningSide;if(Object.assign(Vi,{readyToScore:$&&Ls&&hl,hasContext:!0}),Ls){let{allParticipantsCheckedIn:xi,checkedInParticipantIds:vr}=VI({matchUp:Vi});Object.assign(Vi,{allParticipantsCheckedIn:xi,checkedInParticipantIds:vr})}return Array.isArray(f==null?void 0:f.exclude)&&(f==null||f.exclude.forEach(xi=>delete Vi[xi])),Vi}}function Rv({matchUp:t}){return t?ba.includes(t==null?void 0:t.matchUpStatus)||(t==null?void 0:t.winningSide):!1}function Cx({requireParticipants:t=!0,scheduleVisibilityFilters:e,tournamentAppliedPolicies:i,tournamentParticipants:n,afterRecoveryTimes:r,policyDefinitions:a,tournamentRecord:o,usePublishState:s,matchUpFilters:l,contextFilters:c,contextContent:u,participantMap:d,scheduleTiming:p,publishStatus:h,contextProfile:f,drawDefinition:m,exitProfiles:g,matchUpsMap:v,structureId:y,inContext:b,structure:I,context:T,event:w}){!I&&y&&({structure:I}=ui({drawDefinition:m,structureId:y}));let S=wn({tournamentAppliedPolicies:i,scheduleVisibilityFilters:e,tournamentParticipants:n,afterRecoveryTimes:r,policyDefinitions:a,tournamentRecord:o,usePublishState:s,matchUpFilters:l,contextFilters:c,contextContent:u,participantMap:d,scheduleTiming:p,publishStatus:h,contextProfile:f,drawDefinition:m,exitProfiles:g,matchUpsMap:v,structure:I,inContext:b,context:T,event:w}),D=[],E=[],C=[],P=[],R=[];if(S.error)return S;let{matchUps:N}=S,{assignedPositions:M}=ja({structure:I}),A=M==null?void 0:M.filter(x=>x.participantId).map(x=>x.drawPosition),_;return N.filter(x=>{var B;let O=((B=l==null?void 0:l.matchUpTypes)==null?void 0:B.length)===1&&l.matchUpTypes[0]===Xn;return!(x.matchUpType!==Xn&&O)}).forEach(x=>{var z,Z,Y,Q;if(x.matchUpStatus===ol){D.push(x);return}x.matchUpType===Xn&&(_=!0);let O=x.collectionId,B=O&&((z=x.sides)==null?void 0:z.every(X=>X.participantId)),F=!O&&((Z=x.drawPositions)==null?void 0:Z.filter(Boolean).length)===2,G=!O&&((Y=x.drawPositions)==null?void 0:Y.every(X=>A==null?void 0:A.includes(X))),H=M==null?void 0:M.filter(X=>X.bye).map(X=>X.drawPosition),$=!O&&((Q=x.drawPositions)==null?void 0:Q.find(X=>H==null?void 0:H.includes(X))),q=kz.includes(x.matchUpStatus)&&(B||F&&(!t||G));return $?R.push(x):Rv({matchUp:x})?E.push(x):q?C.push(x):P.push(x)}),{includesTeamMatchUps:_,abandonedMatchUps:D,completedMatchUps:E,upcomingMatchUps:C,pendingMatchUps:P,byeMatchUps:R,structure:I}}function JMe({drawDefinition:t,roundNumber:e,structureId:i}){if(!t)return{error:Vt};if(!i)return{error:nc};let{links:n}=FT({drawDefinition:t,structureId:i}),r=n.source.reduce((o,s)=>!s.source.roundNumber||s.source.roundNumber===e?o.concat(s):o,[]),a=n.target.reduce((o,s)=>!s.target.roundNumber||s.target.roundNumber===e?o.concat(s):o,[]);return{links:{source:r,target:a}}}function MB({finishingPositions:t,linkCondition:e,linkType:i,source:n}){var a;let r=n.find(o=>{var l,c;let s=!((l=o.source)!=null&&l.finishingPositions)||!t||Ts(t,(c=o.source)==null?void 0:c.finishingPositions);return e===o.linkCondition&&s&&o.linkType===i});return[Df,hh].includes(r==null?void 0:r.linkType)&&!((a=r==null?void 0:r.source)!=null&&a.roundNumber)?pe({result:{error:Re},stack:"getTargetLink",context:r}):r}function FT({drawDefinition:t,structureId:e,roundNumber:i}){return t?e?{links:(t.links||[]).filter(Boolean).reduce((n,r)=>{var a,o;return((a=r.source)==null?void 0:a.structureId)===e&&(!i||r.source.roundNumber===i)&&(n.source=n.source.concat(r)),((o=r.target)==null?void 0:o.structureId)===e&&(!i||r.target.roundNumber===i)&&(n.target=n.target.concat(r)),n},{source:[],target:[]})}:{error:nc}:{error:Vt}}function QMe({structureMatchUps:t,matchUp:e}){let{roundNumber:i,roundPosition:n}=e,r=t.filter(o=>o.roundNumber===i&&!o.matchUpTieId),a=t.filter(o=>o.roundNumber===i+1&&!o.matchUpTieId);if(a.length){let o;return a.length===r.length?o=a.find(s=>s.roundPosition===n):a.length===r.length/2&&(o=a.find(s=>s.roundPosition===Math.ceil(n/2))),{matchUp:o}}return{message:"no progression found"}}function NB({sourceRoundMatchUpCount:t,inContextDrawMatchUps:e,sourceRoundPosition:i,drawDefinition:n,targetLink:r}){var E;if(!r)return{error:NH};let{target:{structureId:a,feedProfile:o,groupedOrder:s,roundNumber:l,positionInterleave:c}}=r,{structure:u}=ui({drawDefinition:n,structureId:a}),{positionAssignments:d}=Vn({structure:u}),p=(e==null?void 0:e.filter(C=>C.structureId===(u==null?void 0:u.structureId))).filter(C=>C.roundNumber===l&&!C.matchUpTieId),h=p.length,f=Et(1,h+1),m=h/t,g=Math.ceil(m*i),v=1-i%2;if(c!=null&&c.interleave&&m!==.5){let C=c.offset+(i-1)*c.interleave,P=i+C;g=Math.ceil(P/2),v=1-P%2}let y=f,b=f[g-1],I=zae({roundPositionsCount:f.length,groupedOrder:s}),T=(I==null?void 0:I.length)||1;if(T<=f.length){let C=h/T,P=ro(f,C);o===Fv&&P.forEach(R=>R.reverse()),y=(I==null?void 0:I.length)&&(I==null?void 0:I.map(R=>P[R-1]).flat())||y}o===fu?b=y[g-1]:o===Fv?((!(I!=null&&I.length)||T>f.length)&&(g=p.length+1-g),b=y[g-1]):o===Qk&&Jl()&&console.log(Hk,{feedProfile:o});let w=b&&p.reduce((C,P)=>P.roundPosition===b?P:C,void 0),S;w!=null&&w.feedRound?(v=0,S=Math.min(...(w.drawPositions||[]).filter(Boolean))):S=((E=w==null?void 0:w.drawPositions)==null?void 0:E.length)===2&&(w==null?void 0:w.drawPositions[v]);let D=d==null?void 0:d.find(({drawPosition:C})=>C===S);if(D){let{extension:C}=Ri({element:D,name:cx});if(C!=null&&C.value)return{disabledDrawPosition:S}}return{matchUp:w,targetDrawPosition:S,matchUpDrawPositionIndex:v}}function Ds({inContextDrawMatchUps:t=[],useTargetMatchUpIds:e,inContextMatchUp:i,drawDefinition:n,matchUpId:r}){let a=i;t.length&&!a&&(a=t.find(s=>s.matchUpId===r));let{structure:o}=ui({structureId:a==null?void 0:a.structureId,drawDefinition:n});return(o==null?void 0:o.finishingPosition)===xI?eNe({inContextDrawMatchUps:t,useTargetMatchUpIds:e,drawDefinition:n,structure:o,matchUp:a}):tNe({matchUp:a})}function eNe({inContextDrawMatchUps:t,useTargetMatchUpIds:e,drawDefinition:i,structure:n,matchUp:r}){var R,N,M;let{winnerMatchUpId:a,loserMatchUpId:o}=r,{links:s}=JMe({roundNumber:r.roundNumber,structureId:n.structureId,drawDefinition:i}),l=s==null?void 0:s.source,c=MB({source:l,linkType:Df}),u=MB({linkCondition:fh,linkType:hh,source:l}),d=MB({source:l,linkType:hh}),p=u&&d;d||(d=u);let h=(R=c==null?void 0:c.target)==null?void 0:R.feedProfile,f=(N=d==null?void 0:d.target)==null?void 0:N.feedProfile,m=(M=u==null?void 0:u.target)==null?void 0:M.feedProfile,g,v,y,b,I,T,w,S,D,E;if(e&&(a||o)&&(w=a&&h!==pu&&t.find(({matchUpId:A})=>A===a),b=o&&f!==pu&&t.find(({matchUpId:A})=>A===o),w||b))return{matchUp:r,targetLinks:{loserTargetLink:d,winnerTargetLink:c},targetMatchUps:{loserMatchUp:b,winnerMatchUp:w}};let{roundPosition:C}=r;E=E||t.filter(A=>A.structureId===n.structureId);let P=E.reduce((A,_)=>_.roundNumber===r.roundNumber&&!_.matchUpTieId?A+1:A,0);return d&&!b&&f!==pu&&({matchUpDrawPositionIndex:T,targetDrawPosition:I,matchUp:b}=NB({targetLink:d,sourceRoundMatchUpCount:P,inContextDrawMatchUps:t,sourceRoundPosition:C,drawDefinition:i})),p&&m!==pu&&({matchUpDrawPositionIndex:y,targetDrawPosition:v,matchUp:g}=NB({targetLink:u,sourceRoundMatchUpCount:P,inContextDrawMatchUps:t,sourceRoundPosition:C,drawDefinition:i})),c&&!w&&h!==pu&&({matchUpDrawPositionIndex:D,targetDrawPosition:S,matchUp:w}=NB({targetLink:c,sourceRoundMatchUpCount:P,inContextDrawMatchUps:t,sourceRoundPosition:C,drawDefinition:i})),w||(E=E||t.filter(A=>A.structureId===n.structureId),{matchUp:w}=QMe({structureMatchUps:E,matchUp:r})),zt({matchUp:r,targetLinks:{loserTargetLink:d,winnerTargetLink:c,byeTargetLink:u},targetMatchUps:{winnerMatchUpDrawPositionIndex:D,loserMatchUpDrawPositionIndex:T,byeMatchUpDrawPositionIndex:y,winnerTargetDrawPosition:S,loserTargetDrawPosition:I,byeTargetDrawPosition:v,winnerMatchUp:w,loserMatchUp:b,byeMatchUp:g},targetMatchUpIds:!!(a||o)})}function tNe({matchUp:t}){return{targetLinks:{loserTargetLink:void 0,winnerTargetLink:void 0},targetMatchUps:{loserMatchUp:void 0,winnerMatchUp:void 0},matchUp:t}}function iNe({drawDefinition:t,inContextDrawMatchUps:e}){let i={};return e.forEach(n=>{var l,c,u,d,p,h;let{matchUpId:r,structureId:a,drawPositions:o=[]}=n,{structure:s}=ui({drawDefinition:t,structureId:a});if((s==null?void 0:s.finishingPosition)===ET){let{roundNumber:f}=n,m=f&&ri(f)+1,g=s.matchUps??[],{roundMatchUps:v}=Us({matchUps:g});if(m&&(v!=null&&v[m])){let y=[...o].sort(ma).map((b,I)=>{let T=v[m].find(w=>{var S;return(S=w.drawPositions)==null?void 0:S.includes(b)});return{matchUpId:T==null?void 0:T.matchUpId,roundNumber:m,schedule:T==null?void 0:T.schedule,sideNumber:I+1,structureName:s.structureName}});Object.assign(n,{sidesTo:y})}}else{let f=Ds({useTargetMatchUpIds:!0,inContextDrawMatchUps:e,inContextMatchUp:n,drawDefinition:t,matchUpId:r}),{winnerMatchUp:m}=f.targetMatchUps,{loserMatchUp:g}=f.targetMatchUps;!n.winnerMatchUpId&&m&&(n.winnerMatchUpId=m.matchUpId),!n.loserMatchUpId&&g&&(n.loserMatchUpId=g.matchUpId);let v=AB({upcomingMatchUp:m}),y=AB({upcomingMatchUp:g});if(n.matchUpStatus!==vn&&(g==null?void 0:g.matchUpStatus)===vn){let{matchUp:I}=Zae({matchUp:g,drawDefinition:t,inContextDrawMatchUps:e})||{};y=I&&AB({upcomingMatchUp:I})||y}let b=(l=n.schedule)==null?void 0:l.timeAfterRecovery;if(b&&((c=v==null?void 0:v.schedule)!=null&&c.scheduledTime&&an(v.schedule.scheduledTime)<an(b)&&(i[v.matchUpId]=n.matchUpId,v.schedule.scheduleConflict=n.matchUpId),(u=y==null?void 0:y.schedule)!=null&&u.scheduledTime&&an(y.schedule.scheduledTime)<an(b)&&(i[y.matchUpId]=n.matchUpId,y.schedule.scheduleConflict=n.matchUpId)),Object.assign(n,{winnerTo:v,loserTo:y}),(d=n.drawPositions)==null?void 0:d.filter(Boolean).length){let I=((h=(p=f.targetLinks)==null?void 0:p.loserTargetLink)==null?void 0:h.linkCondition)===fh,T=nNe(n);if(T.length){let w=G2(m==null?void 0:m.sides),S=G2(g==null?void 0:g.sides),D=T.find(({participantId:C})=>w.includes(C))?[]:T,E=T.find(({participantId:C})=>S.includes(C))?[]:T;g&&I&&E.length<2&&E.push({bye:!0,tbd:!0}),D!=null&&D.length&&m&&(!f.targetMatchUpIds&&m&&(m=e.find(({matchUpId:C})=>C===m.matchUpId)),m.potentialParticipants||(m.potentialParticipants=[]),m.potentialParticipants.push(D)),E!=null&&E.length&&g&&(f.targetMatchUpIds||(m=e.find(({matchUpId:C})=>C===g.matchUpId)),g.potentialParticipants||(g.potentialParticipants=[]),g.potentialParticipants.push(E))}}}}),Object.keys(i).length&&e.forEach(n=>{Object.keys(i).includes(n.matchUpId)&&(n.schedule.scheduleConflict=i[n.matchUpId])}),{scheduleConflictMatchUpIds:i}}function nNe(t){var e;return((e=t==null?void 0:t.sides)==null?void 0:e.map(({participant:i,participantId:n,qualifier:r})=>i||n&&{participantId:n}||r&&{qualifier:r}).filter(Boolean))||[]}function Zae({matchUp:t,drawDefinition:e,inContextDrawMatchUps:i}){var o;let{matchUpId:n,matchUpStatus:r,structureId:a}=t||{};if(!t||!a||(t==null?void 0:t.matchUpStatus)===qr)return{matchUp:t};if(r===vn){let s;return t.winnerMatchUpId?s=i.find(({matchUpId:l})=>l===t.winnerMatchUpId):{winnerMatchUp:s}=((o=Ds({inContextDrawMatchUps:i,drawDefinition:e,matchUpId:n}))==null?void 0:o.targetMatchUps)||{},Zae({matchUp:s,drawDefinition:e,inContextDrawMatchUps:i})}return{matchUp:void 0}}function AB(t){if(t!=null&&t.upcomingMatchUp)return(({matchUpId:e,structureId:i,schedule:n,roundNumber:r,roundPosition:a,structureName:o})=>({matchUpId:e,structureId:i,schedule:n,roundNumber:r,roundPosition:a,structureName:o}))(t.upcomingMatchUp)}function Ia(t){let e="getAllDrawMatchUps";Object.assign(t,{requireParticipants:!1});let i=BT(t);if(i.error)return pe({result:i,stack:e});let{abandonedMatchUps:n,completedMatchUps:r,upcomingMatchUps:a,pendingMatchUps:o,byeMatchUps:s,matchUpsMap:l}=i;return{matchUps:(n??[]).concat(...r??[],...a??[],...o??[],...s??[]),matchUpsMap:l}}function BT(t){if(!(t!=null&&t.drawDefinition))return{error:Vt};let{tournamentParticipants:e,contextContent:i,matchUpsMap:n}=t,{scheduleVisibilityFilters:r,tournamentAppliedPolicies:a,requireParticipants:o,participantsProfile:s,afterRecoveryTimes:l,policyDefinitions:c,tournamentRecord:u,usePublishState:d,contextFilters:p,matchUpFilters:h,scheduleTiming:f,participantMap:m,publishStatus:g,contextProfile:v,drawDefinition:y,nextMatchUps:b,inContext:I,context:T,event:w}=t,S=[],D=[],E=[],C=[],P=[];v&&!i&&(i=tm({policyDefinitions:c,tournamentRecord:u,contextProfile:v,event:w}));let R;!(e!=null&&e.length)&&u&&(e=u==null?void 0:u.participants,(I||s!=null&&s.withGroupings)&&(e!=null&&e.length)&&({participantsWithGroupings:e,groupInfo:R}=Jz({participants:e,participantsProfile:s})));let{structures:N}=Ru({drawDefinition:y});if(!N)return{error:wr};n||(n=Ao({drawDefinition:y}));let M=y&&qae({drawDefinition:y}).exitProfiles;N.forEach(x=>{let{byeMatchUps:O=[],pendingMatchUps:B=[],upcomingMatchUps:F=[],completedMatchUps:G=[],abandonedMatchUps:H=[]}=Cx({matchUpFilters:b?void 0:h,contextFilters:b?void 0:p,inContext:I||b||p,tournamentAppliedPolicies:a,scheduleVisibilityFilters:r,tournamentParticipants:e,requireParticipants:o,afterRecoveryTimes:l,policyDefinitions:c,tournamentRecord:u,usePublishState:d,contextContent:i,participantMap:m,scheduleTiming:f,publishStatus:g,contextProfile:v,drawDefinition:y,exitProfiles:M,matchUpsMap:n,structure:x,context:T,event:w});S=S.concat(...H),D=D.concat(...G),E=E.concat(...F),C=C.concat(...B),P=P.concat(...O)});let A=x=>(!h&&!b&&!p||(h&&(x=sf({matchUps:x,...h})),p&&(x=sf({matchUps:x,...p,processContext:!0}))),x),_={abandonedMatchUps:A(S),completedMatchUps:A(D),upcomingMatchUps:A(E),pendingMatchUps:A(C),byeMatchUps:A(P),matchUpsMap:n,...ce,groupInfo:R};if(b){let x=typeof b=="object"||{abandoned:!0,completed:!0,upcoming:!0,pending:!0,bye:!0},{abandoned:O,completed:B,upcoming:F,pending:G,bye:H}=x,$=[].concat(...O&&S||[],...B&&D||[],...F&&E||[],...G&&C||[],...H&&P||[]);iNe({inContextDrawMatchUps:$,drawDefinition:y})}return _}function xh(t){let{participants:e=[],contextContent:i,participantMap:n}=t,{scheduleVisibilityFilters:r,tournamentAppliedPolicies:a,participantsProfile:o,afterRecoveryTimes:s,policyDefinitions:l,useParticipantMap:c,tournamentRecord:u,contextFilters:d,contextProfile:p,matchUpFilters:h,nextMatchUps:f,inContext:m,context:g,event:v}=t;if(!v)return{error:Qn};let{eventId:y,eventName:b,endDate:I,eventType:T,category:w,gender:S,matchUpFormat:D}=v??{},E={...g,...zt({indoorOutDoor:v.indoorOutdoor??(u==null?void 0:u.indoorOutdoor),surfaceCategory:v.surfaceCategory??(u==null?void 0:u.surfaceCategory),endDate:v.endDate??(u==null?void 0:u.endDate),tournamentId:u==null?void 0:u.tournamentId,matchUpFormat:D,eventName:b,eventType:T,category:w,eventId:y,gender:S})};I&&(E.endDate=I),p&&!i&&(i=tm({policyDefinitions:l,tournamentRecord:u,contextProfile:p,event:v}));let C;if(!(e!=null&&e.length)&&!n&&u){let N=BI({participantsProfile:o,useParticipantMap:c,policyDefinitions:l,tournamentRecord:u,contextProfile:p,inContext:m});n=N.participantMap,e=N.participants??[],C=N.groupInfo}let P=v.drawDefinitions??[],R=yC({tournamentRecord:u,event:v}).scheduleTiming;return{matchUps:P.flatMap(N=>{let{matchUps:M}=Ia({tournamentParticipants:e,tournamentAppliedPolicies:a,scheduleVisibilityFilters:r,context:E,participantsProfile:o,afterRecoveryTimes:s,policyDefinitions:l,tournamentRecord:u,contextFilters:d,contextProfile:p,drawDefinition:N,contextContent:i,matchUpFilters:h,participantMap:n,scheduleTiming:R,nextMatchUps:f,inContext:m,event:v});return M??[]}),groupInfo:C}}function oo(t){let e=di(t,[{tournamentRecord:!0}]);if(e.error)return e;if(!(t!=null&&t.tournamentRecord))return{error:ut};let{participantMap:i,participants:n}=t,{scheduleVisibilityFilters:r,participantsProfile:a,afterRecoveryTimes:o,useParticipantMap:s,policyDefinitions:l,tournamentRecord:c,inContext:u=!0,contextProfile:d,matchUpFilters:p,contextFilters:h,nextMatchUps:f,context:m}=t,g=t.tournamentId??c.tournamentId,v=(c==null?void 0:c.events)??[];n||({participants:n,participantMap:i}=BI({participantsProfile:a,useParticipantMap:s,policyDefinitions:l,tournamentRecord:c,contextProfile:d,inContext:u}));let{appliedPolicies:y}=dn({tournamentRecord:c}),b={...m,tournamentId:g,indoorOutDoor:c.indoorOutdoor,surfaceCategory:c.surfaceCategory,endDate:c.endDate},I=tm({policyDefinitions:l,tournamentRecord:c,contextProfile:d});return{matchUps:v.flatMap(T=>{var w;return b.eventDrawsCount=((w=T.drawDefinitions)==null?void 0:w.length)??0,xh({context:b,scheduleVisibilityFilters:r,tournamentAppliedPolicies:y,participantsProfile:a,afterRecoveryTimes:o,policyDefinitions:l,tournamentRecord:c,contextContent:I,contextFilters:h,contextProfile:d,matchUpFilters:p,participantMap:i,nextMatchUps:f,participants:n,inContext:u,event:T}).matchUps??[]}).concat(...c.matchUps??[])}}function wd({scheduleVisibilityFilters:t,afterRecoveryTimes:e,participantsProfile:i,tournamentRecords:n,policyDefinitions:r,matchUpFilters:a,contextFilters:o,nextMatchUps:s,inContext:l}){if(typeof n!="object"||!Object.keys(n).length)return{error:Sr};let c=Object.keys(n).map(u=>{let d=n[u];return oo({scheduleVisibilityFilters:t,afterRecoveryTimes:e,participantsProfile:i,policyDefinitions:r,tournamentRecord:d,matchUpFilters:a,contextFilters:o,nextMatchUps:s,inContext:l}).matchUps??[]}).flat();return{...ce,matchUps:c}}function GI(t,e){return rNe(t,e)||((t==null?void 0:t.stageSequence)||0)-((e==null?void 0:e.stageSequence)||0)||(t==null?void 0:t.roundNumber)&&e.roundNumber&&(t==null?void 0:t.roundNumber)-(e==null?void 0:e.roundNumber)||((t==null?void 0:t.roundPosition)??0)-((e==null?void 0:e.roundPosition)??0)}function rNe(t,e){return(Wb[t==null?void 0:t.stage]||0)-(Wb[e==null?void 0:e.stage]||0)}function ws(t){let{participants:e,participantMap:i,contextContent:n}=t,{scheduleVisibilityFilters:r,tournamentAppliedPolicies:a,participantsProfile:o,afterRecoveryTimes:s,policyDefinitions:l,useParticipantMap:c,tournamentRecord:u,matchUpFilters:d,contextFilters:p,contextProfile:h,drawDefinition:f,nextMatchUps:m,inContext:g,context:v,event:y}=t,{eventId:b,eventName:I,endDate:T,eventType:w,category:S,gender:D,matchUpFormat:E}=y??{},C={...v,surfaceCategory:(y==null?void 0:y.surfaceCategory)??(u==null?void 0:u.surfaceCategory),indoorOutDoor:(y==null?void 0:y.indoorOutdoor)??(u==null?void 0:u.indoorOutdoor),matchUpFormat:E,eventType:w,eventName:I,category:S,eventId:b,endDate:T,gender:D},P;return!(e!=null&&e.length)&&!i&&u&&({participants:e=[],participantMap:i,groupInfo:P}=BI({participantsProfile:o,useParticipantMap:c,policyDefinitions:l,tournamentRecord:u,contextProfile:h,inContext:g})),h&&!n&&(n=tm({policyDefinitions:l,tournamentRecord:u,contextProfile:h,drawDefinition:f,event:y})),{...Ia({context:C,tournamentAppliedPolicies:a,scheduleVisibilityFilters:r,tournamentParticipants:e,participantsProfile:o,afterRecoveryTimes:s,policyDefinitions:l,tournamentRecord:u,drawDefinition:f,contextContent:n,contextFilters:p,contextProfile:h,matchUpFilters:d,participantMap:i,nextMatchUps:m,inContext:g,event:y}),groupInfo:P}}function Tb({element:t,accessor:e}){if(typeof e!="string")return{values:[]};let i=Ot(t),n=e.split("."),r=[],a;s({targetElement:i,attributes:n});let o={value:a};return r.length&&(o.values=r),o;function s({targetElement:l,attributes:c=[],significantCharacters:u}){for(let[p,h]of c.entries())if(l!=null&&l[h]){let f=c.slice(p+1);f.length?Array.isArray(l[h])?l[h].forEach(m=>s({targetElement:m,attributes:f})):(l=l[h],d({targetElement:l,index:p})):(a||(a=l[h]),r.includes(l[h])||r.push(l[h]))}function d({targetElement:p,index:h}){if(p&&h===c.length-1&&["string","number"].includes(typeof p)){let f=u?p.slice(0,u):p;a?r.includes(f)||r.push(f):(a=f,r.push(f))}}}}var Xae=t=>e=>{var i;return!t||typeof e!="object"?void 0:Array.isArray(t)&&t.map(n=>{var r;return{[n]:(r=Tb({element:e,accessor:n}))==null?void 0:r.value}})||typeof t=="object"&&Object.keys(t).map(n=>{var r;return{[n]:(r=Tb({element:e,accessor:n}))==null?void 0:r.value}})||((i=typeof t=="string"&&Tb({element:e,accessor:t}))==null?void 0:i.value)},Ml=Xae;function MC({finishingPositionOffset:t=0,finishingPositionLimit:e,positionsFed:i,roundsCount:n,roundLimit:r,matchUps:a,lucky:o,fmlc:s}){var g;if(!Kc(a))return[];let{roundProfile:l,roundNumbers:c=[]}=Us({interpolate:!0,matchUps:a});n=n??Math.max(...c,0);let u=r?n-r:0,d=u&&((g=l==null?void 0:l[n-u])==null?void 0:g.matchUpsCount),p=l&&Object.values(l).map(Ml("matchUpsCount")),h=(v,y)=>{let b=Math.min(...v);d&&y&&b===1&&(b=d);let I=Math.max(...v);return e&&I>e&&(I=e),[b,I]},f=l&&Object.assign({},...c.map(v=>{let y=(n??0)+1-v-u,b=l[v].matchUpsCount,I={finishingPositionRange:{},finishingRound:y},T=p==null?void 0:p.slice(v-1).reduce((N,M)=>N+(M||0),0),w=s&&v!==1,S=1+t+(w?i??0:0),D=1,E=Et(S,o?S+b*2:T+S+D),C=T+D-b,P=h(E.slice(C)),R=h(E.slice(0,C),!0);return I.finishingPositionRange={loser:P,winner:R},{[v]:I}})),m=Jl({finishingRound:!0});return a.filter(Boolean).forEach(v=>{let y=v.roundNumber&&f[v.roundNumber];m&&!y&&console.log({roundFinishingData:f,matchUp:v}),v.finishingRound=y==null?void 0:y.finishingRound,v.finishingPositionRange=y==null?void 0:y.finishingPositionRange}),a}function Wv({inContextDrawMatchUps:t,drawDefinition:e,matchUpsMap:i}){var r;if(!e)return{error:Vt};let n={loserMatchUpIds:{},winnerMatchUpIds:{}};if(t||({matchUps:t,matchUpsMap:i}=Ia({inContext:!0,drawDefinition:e,matchUpsMap:i})),!(i!=null&&i.drawMatchUps.some(a=>a.finishingPositionRange))&&((r=e==null?void 0:e.structures)==null?void 0:r.length)===1&&!(e!=null&&e.structures[0].structures)){let a=(i==null?void 0:i.drawMatchUps)??[];MC({matchUps:a})}return(t??[]).filter(({collectionId:a})=>!a).forEach(a=>{let{matchUpId:o,structureId:s}=a,l=Ds({inContextDrawMatchUps:t,drawDefinition:e,matchUpId:o}),{winnerMatchUp:c,loserMatchUp:u}=l.targetMatchUps,d=c==null?void 0:c.matchUpId,p=u==null?void 0:u.matchUpId,h=zv({matchUpsMap:i,structureId:s}).find(f=>f.matchUpId===o);if(h&&(d&&(n.winnerMatchUpIds[h.matchUpId]=d,Object.assign(h,{winnerMatchUpId:d}),Object.assign(a,{winnerMatchUpId:d})),p&&(n.loserMatchUpIds[h.matchUpId]=p,a.loserMatchUpId=p,h.loserMatchUpId=p,a.finishingPositionRange))){let f=u.finishingPositionRange&&[...a.finishingPositionRange.loser,...u.finishingPositionRange.loser],m=f&&[Math.min(...f),Math.max(...f)];a.finishingPositionRange.loser=m,h.finishingPositionRange.loser=m}}),{inContextDrawMatchUps:t,goesToMap:n}}function Vu(t){var y;let e=qc(t),i=t.matchUps??[],n=t.drawIds??[],{includeParticipantDependencies:r,tournamentRecord:a,drawDefinition:o}=t;if(!Array.isArray(i))return{error:Xf};if(!Array.isArray(n))return{error:Pd};let s=(y=t.matchUpIds)!=null&&y.length?t.matchUpIds:i.map(b=>b.matchUpId);if(!Array.isArray(s))return{error:PI};let l={},c={},u={},d={};a&&!Object.keys(e).length&&(e={[a.tournamentId]:a});let p=Object.values(e),h=p.reduce((b,I)=>b.concat(I.events??[]).map(T=>(T.drawDefinitions||[]).map(w=>w.links||[])).flat(1/0),[]).filter(({linkType:b})=>b===Uf),f=i;if(h.length){f=wd({nextMatchUps:!0,tournamentRecords:e}).matchUps;let b=h.reduce((I,T)=>{var D,E;let w=(D=T.source)==null?void 0:D.structureId,S=(E=T.target)==null?void 0:E.structureId;return w&&S&&(u[S]=w),w&&!I.includes(w)&&I.push(w),I},[]);for(let I of b)l[I]=[];for(let I of f??[]){let T=I.containerStructureId||I.structureId;b.includes(T)&&l[T].push(I.matchUpId)}}let m=b=>{c[b]||(c[b]={dependentMatchUpIds:[],participantIds:[],matchUpIds:[],sources:[]},d[b]=[])},g=(b,I)=>{c[b].matchUpIds.forEach(T=>{c[I].matchUpIds.push(T)}),c[I].matchUpIds.push(b),c[b].dependentMatchUpIds.push(I),r&&c[b].participantIds.forEach(T=>c[I].participantIds.push(T))},v=b=>{let I=Object.keys(l).length;for(let T of b||[]){let{matchUpId:w,winnerMatchUpId:S,loserMatchUpId:D}=T;if(!s.length||s.includes(w)){if(m(w),r){let{individualParticipantIds:P}=gx(T);c[w].participantIds=P}S&&(m(S),g(w,S),d[S].push(w)),D&&(m(D),g(w,D),d[D].push(w)),c[w].sources.push(d[w]);let E=d[w].map(P=>c[P].sources[0]).flat(),C=d[w].map(P=>c[P].sources[1]).flat();if(c[w].sources.push(E,C),I){let P=T.containerStructureId||T.structureId,R=u[P];if(l[R])for(let N of l[R])m(N),g(N,w),d[N].push(w)}}}};if(o)Wv({drawDefinition:o}),f!=null&&f.length||(f=ws({drawDefinition:o}).matchUps),v(f);else{if(f!=null&&f.length||(f=wd({nextMatchUps:!0,tournamentRecords:e}).matchUps),!n.length){let b=p!=null&&p.length?p.map(({events:I=[]})=>I.map(({drawDefinitions:T=[]})=>T.map(({drawId:w})=>w))).flat(1/0):[];b&&(n=b)}for(let b of n){let I=f==null?void 0:f.filter(T=>T.drawId===b).sort(GI);if(!(I!=null&&I.find(({roundPosition:T})=>!T))){let T=I==null?void 0:I.find(({tournamentId:S})=>S),{drawDefinition:w}=zs({tournamentRecord:e[T==null?void 0:T.tournamentId],drawId:b});w&&Wv({drawDefinition:w})}v(I)}}return{positionDependencies:l,matchUpDependencies:c,sourceMatchUpIds:d,matchUps:f,...ce}}function Pa(t){var d,p;let e=t==null?void 0:t.matchUp,i=(t==null?void 0:t.score)||(e==null?void 0:e.score),n=(d=i==null?void 0:i.sets)==null?void 0:d[0],{side1Score:r,side2Score:a,side1TiebreakScore:o,side2TiebreakScore:s,side1PointScore:l,side2PointScore:c}=n||{},u=r||a||o||s||l||c;return!!(((p=i==null?void 0:i.sets)==null?void 0:p.length)>1||u)}function NC({matchUpStatus:t}){return Az.includes(t)}function aNe({matchUpStatus:t}){return dx.includes(t)}function X2({matchUpStatus:t}){return _z.includes(t)}function hq({matchUpStatus:t,winningSide:e,tieMatchUps:i,sides:n,score:r}){var s;let a=n==null?void 0:n.find(({participantId:l})=>l),o=(s=i==null?void 0:i.filter(hq))==null?void 0:s.length;return Pa({score:r})||o||e&&a||t&&aNe({matchUpStatus:t})&&![Zi,hn,Lu].includes(t)}function AC(t){var S;let{drawDefinition:e,findContainer:i,structureId:n,event:r}=t,a=t.structure,o={isCollectionMatchUp:!1},{containedStructures:s}=kT({drawDefinition:e}),l=n?s[n]||[]:[];if(!a){let D=ui({drawDefinition:e,structureId:n});if(D.error)return D;a=i?D.containingStructure??D.structure:D.structure}if(sl({structure:a}))return{structure:a,isAdHoc:!0,error:vT};let{matchUps:c}=Ia({inContext:!0,matchUpFilters:o,drawDefinition:e,event:r}),u=c==null?void 0:c.filter(D=>D.structureId===n||l.includes(D.structureId)),{matchUpDependencies:d}=Vu({drawIds:[e.drawId],matchUps:c,drawDefinition:e}),p=[],h=[],f={},m=[];for(let D of c??[]){if(D.structureId===n||l.includes(D.structureId)){h.push(...D.drawPositions??[]);let E=D.roundNumber;for(let C of(D.drawPositions??[]).filter(Boolean))(!f[C]||E&&f[C]>E)&&(f[C]=E)}hq(D)&&(m.push(D),p.push(D.matchUpId,...((S=d==null?void 0:d[D==null?void 0:D.matchUpId])==null?void 0:S.matchUpIds)||[]))}let g=Pi(h.filter(Boolean)).sort(ma),v=Pi(p),y=Pi(u==null?void 0:u.map(({matchUpId:D,drawPositions:E})=>v.includes(D)?E:[]).flat().filter(Boolean)).sort(ma),{positionAssignments:b}=Vn({drawDefinition:e,structure:a}),I=b==null?void 0:b.filter(D=>D.bye).map(D=>D.drawPosition),T=b==null?void 0:b.filter(D=>D.qualifier).map(D=>D.drawPosition),w=(g==null?void 0:g.filter(D=>!y.includes(D)))||[];return{allDrawPositions:g,inContextStructureMatchUps:u,drawPositionInitialRounds:f,activeDependentMatchUpIds:v,qualifyingDrawPositions:T,inactiveDrawPositions:w,positionAssignments:b,activeDrawPositions:y,byeDrawPositions:I,activeMatchUps:m,structure:a}}function Xb({drawPosition:t,matchUps:e=[]}){return{initialRoundNumber:e.filter(({drawPositions:i})=>t&&(i==null?void 0:i.includes(t))).map(({roundNumber:i})=>i).sort(ma)[0]}}var Sm={reset:"\x1B[0m",bright:"\x1B[1m",dim:"\x1B[2m",red:"\x1B[31m",brightred:"\x1B[91m",green:"\x1B[32m",brightgreen:"\x1B[92m",yellow:"\x1B[33m",brightyellow:"\x1B[93m",blue:"\x1B[34m",brightblue:"\x1B[94m",lightblue:"\x1B[105m",magenta:"\x1B[35m",brightmagenta:"\x1B[95m",cyan:"\x1B[36m",brightcyan:"\x1B[96m",white:"\x1B[37m",brightwhite:"\x1B[97m"},PA=[];function Ac(t,e){typeof t=="string"&&(t={method:t}),(e||Jl())&&PA.push(t)}function oNe(t){let e=PA.slice();return t&&(PA.length=0),e}function sNe(t){let e=oNe(t).map(i=>{let{color:n,keyColors:r,method:a,newline:o}=i,s=Object.keys(Sm).includes(n)?Sm[n]:Sm.cyan,l=Object.keys(i).filter(u=>!["color","keyColors","method","newline"].includes(u)).map(u=>{let d=r&&Object.keys(r).includes(u)&&Sm[r[u]]?Sm[r[u]]:Sm.brightwhite;return`${Sm.white}${u}: ${d}${i[u]}`}).join(", "),c=(a==null?void 0:a.length)<15?"		":"	";return[o?`
`:"",s,a,c,Sm.white,l,Sm.reset,`
`].join("")});e!=null&&e.length&&console.log(...e)}function lNe(){PA.length=0}function sc({provisionalPositioning:t,isPositionAction:e,tournamentRecord:i,drawDefinition:n,drawPosition:r,matchUpsMap:a,structureId:o,structure:s,event:l}){var E,C,P;if(!n)return{error:Vt};if(s||({structure:s}=ui({drawDefinition:n,structureId:o})),!s)return{error:wr};o||({structureId:o}=s);let c="assignDrawPositionBye";Ac({method:c,color:"cyan",drawPosition:r}),a||(a=Ao({drawDefinition:n}));let{positionAssignments:u}=Vn({structure:s}),{activeDrawPositions:d}=AC({drawDefinition:n,structureId:o});if((E=u==null?void 0:u.find(R=>R.drawPosition===r))!=null&&E.bye)return{...ce};if(d!=null&&d.includes(r))return{error:kk};let p=u==null?void 0:u.find(R=>R.drawPosition===r);if(!p)return{error:vT};let{filled:h,containsBye:f,assignedParticipantId:m}=cNe(p);if(f)return{...ce};if(h&&!f)return pe({result:{error:Q0},stack:c});let g=dn({tournamentRecord:i,drawDefinition:n,event:l}).appliedPolicies??{},v=Ia({inContext:!0,drawDefinition:n,matchUpsMap:a}).matchUps??[],y={isCollectionMatchUp:!1},{matchUps:b}=wn({provisionalPositioning:t,drawDefinition:n,matchUpFilters:y,matchUpsMap:a,structure:s});if(u==null||u.forEach(R=>{R.drawPosition===r&&(R.bye=!0)}),s.structureType===As)return uNe({tournamentRecord:i,drawDefinition:n,drawPosition:r,matchUps:b}),Ym({tournamentId:i==null?void 0:i.tournamentId,drawDefinition:n,structure:s,event:l}),qK({assignedParticipantId:m,isPositionAction:e,appliedPolicies:g,drawDefinition:n,drawPosition:r,structureId:o,stack:c});let{roundProfile:I,roundMatchUps:T}=Us({matchUps:b}),w=(C=I&&Object.keys(I).map(R=>parseInt(R)).reverse())==null?void 0:C.find(R=>{var N;return(N=I==null?void 0:I[R].drawPositions)==null?void 0:N.includes(r)}),S=w?T==null?void 0:T[w].find(({drawPositions:R})=>R==null?void 0:R.includes(r)):void 0;S&&Jae({tournamentRecord:i,drawDefinition:n,matchUp:S,event:l});let D=(P=S==null?void 0:S.drawPositions)==null?void 0:P.find(R=>R!==r);if(S&&D){let R=fq({sourceDrawPositions:S.drawPositions,matchUpId:S.matchUpId,inContextDrawMatchUps:v,drawPositionToAdvance:D,tournamentRecord:i,drawDefinition:n,matchUpsMap:a});if(R.error)return R}return Ym({tournamentId:i==null?void 0:i.tournamentId,drawDefinition:n,structure:s,event:l}),qK({assignedParticipantId:m,isPositionAction:e,appliedPolicies:g,drawDefinition:n,drawPosition:r,structureId:o,stack:c})}function qK({assignedParticipantId:t,isPositionAction:e,appliedPolicies:i,drawDefinition:n,drawPosition:r,structureId:a,stack:o}){return e&&mx({appliedPolicies:i,drawDefinition:n,positionAction:{removedParticipantId:t,drawPosition:r,structureId:a,name:o}}),pe({result:{...ce},stack:o})}function cNe(t){let e=t.bye,i=t.qualifier,n=t.participantId;return{containsBye:e,containsQualifier:i,assignedParticipantId:n,filled:e||i||n}}function Jae({tournamentRecord:t,drawDefinition:e,eventId:i,matchUp:n,event:r}){Object.assign(n,{matchUpStatus:vn,score:void 0,winningSide:void 0}),en({tournamentId:t==null?void 0:t.tournamentId,eventId:i??(r==null?void 0:r.eventId),context:"setMatchUpStatusBye",drawDefinition:e,matchUp:n})}function uNe({tournamentRecord:t,drawDefinition:e,drawPosition:i,matchUps:n,event:r}){n.forEach(a=>{var o;(o=a.drawPositions)!=null&&o.includes(i)&&Jae({eventId:r==null?void 0:r.eventId,tournamentRecord:t,drawDefinition:e,matchUp:a})})}function fq({drawPositionToAdvance:t,inContextDrawMatchUps:e,sourceDrawPositions:i,tournamentRecord:n,drawDefinition:r,matchUpsMap:a,matchUpId:o,event:s}){var b,I;Ac({method:"advanceDrawPosition",color:"cyan",drawPositionToAdvance:t});let l=a.drawMatchUps.find(T=>T.matchUpId===o),c=(b=e.find(T=>T.matchUpId===o))==null?void 0:b.structureId,{structure:u}=ui({drawDefinition:r,structureId:c}),{positionAssignments:d}=Vn({structure:u}),p=d==null?void 0:d.filter(T=>T.bye).map(T=>T.drawPosition),h=(I=l==null?void 0:l.drawPositions)==null?void 0:I.find(T=>T!==t),f=h&&(p==null?void 0:p.includes(h)),{targetLinks:{loserTargetLink:m},targetMatchUps:{loserMatchUp:g,winnerMatchUp:v,loserTargetDrawPosition:y}}=Ds({inContextDrawMatchUps:e,drawDefinition:r,matchUpId:o});if(v&&v.structureId===(u==null?void 0:u.structureId)&&dNe({drawPositionToAdvance:t,inContextDrawMatchUps:e,sourceDrawPositions:i,tournamentRecord:n,drawDefinition:r,winnerMatchUp:v,matchUpsMap:a,event:s}),g&&f&&g.structureId!==(u==null?void 0:u.structureId)){let{roundNumber:T}=g;if(T===1){let w=sc({structureId:m.target.structureId,drawPosition:y,tournamentRecord:n,drawDefinition:r,event:s});if(w.error)return w}else Qae({loserTargetDrawPosition:y,tournamentRecord:n,loserTargetLink:m,drawDefinition:r,loserMatchUp:g,matchUpsMap:a,event:s})}return{...ce}}function dNe({drawPositionToAdvance:t,inContextDrawMatchUps:e,sourceDrawPositions:i,tournamentRecord:n,drawDefinition:r,winnerMatchUp:a,matchUpsMap:o,event:s}){var M,A,_,x,O,B;let l="advanceWinner",c=o.drawMatchUps.find(F=>F.matchUpId===a.matchUpId),u=(M=e.find(F=>F.matchUpId===a.matchUpId))==null?void 0:M.structureId,{structure:d}=ui({drawDefinition:r,structureId:u}),{positionAssignments:p}=Vn({structure:d}),h=(A=p==null?void 0:p.find(({drawPosition:F})=>F===t))==null?void 0:A.bye,f=(_=c.drawPositions)==null?void 0:_.filter(Boolean),m=p==null?void 0:p.filter(F=>f==null?void 0:f.includes(F.drawPosition)),g=p==null?void 0:p.find(({drawPosition:F})=>F===t),v=i==null?void 0:i.find(F=>F!==t),y=(x=v&&(m==null?void 0:m.find(({drawPosition:F})=>F===v)))==null?void 0:x.bye,b=h&&y;if(b&&console.log({isByeAdvancedBye:b}),(f==null?void 0:f.length)>1&&h&&!y)return pe({result:{error:Q0},stack:l});let I=f==null?void 0:f.find(F=>F!==t),T=b,w=[...(c.drawPositions||[]).filter(Boolean),void 0,void 0].slice(0,2),S=w.map(F=>!F&&!T||F===t?(T=!0,t):F).sort(ma);if(!T)return console.log("@@@@@@@",{advancingAssignmentIsBye:g,drawPositionToAdvance:t,existingAssignments:m}),pe({result:{error:Q0},stack:l});let D=(O=p==null?void 0:p.find(({drawPosition:F})=>F===I))==null?void 0:O.bye,E=(B=p==null?void 0:p.find(({drawPosition:F})=>F===t))==null?void 0:B.bye;Object.assign(c,{matchUpStatus:E||D?vn:qr,score:void 0,winningSide:void 0,drawPositions:S});let C=c.drawPositions.find(F=>!w.includes(F));Ac({method:l,color:"brightyellow",changedDrawPosition:C,pairedDrawPositionIsBye:D,drawPositionIsBye:E}),en({tournamentId:n==null?void 0:n.tournamentId,matchUp:c,eventId:s==null?void 0:s.eventId,context:l,drawDefinition:r});let{targetLinks:{loserTargetLink:P},targetMatchUps:{loserMatchUp:R,loserTargetDrawPosition:N}}=Ds({matchUpId:a.matchUpId,inContextDrawMatchUps:e,drawDefinition:r});if(D||E){let F=D?t:I;if(F)fq({drawPositionToAdvance:F,matchUpId:a.matchUpId,inContextDrawMatchUps:e,tournamentRecord:n,drawDefinition:r,matchUpsMap:o});else if(E&&P&&R)if(R.feedRound)Qae({loserTargetDrawPosition:N,tournamentRecord:n,loserTargetLink:P,drawDefinition:r,loserMatchUp:R,matchUpsMap:o});else{let G=1-a.roundPosition%2,H=R.drawPositions[G],$=sc({structureId:P.target.structureId,drawPosition:H,tournamentRecord:n,drawDefinition:r,event:s});if($.error)return $}}}function Qae({loserTargetDrawPosition:t,tournamentRecord:e,loserTargetLink:i,drawDefinition:n,loserMatchUp:r,matchUpsMap:a,event:o}){let{roundNumber:s}=r;Ac({method:"assignFedDrawPositionBye",color:"cyan",loserTargetDrawPosition:t});let l=((a==null?void 0:a.mappedMatchUps)||{})[r.structureId].matchUps,{initialRoundNumber:c}=Xb({drawPosition:t,matchUps:l});if(c===s){let u=sc({structureId:i.target.structureId,drawPosition:t,tournamentRecord:e,drawDefinition:n,event:o});if(u.error)return u}}function eoe({positionAssignments:t,tournamentRecord:e,drawDefinition:i,matchUpsMap:n,structure:r,event:a}){let{matchUps:o}=wn({drawDefinition:i,matchUpsMap:n,structure:r,event:a});o.forEach(s=>{let l=t.filter(({drawPosition:c})=>{var u;return(u=s.drawPositions)==null?void 0:u.includes(c)}).filter(c=>c.bye).length;s.winningSide||(Object.assign(s,{matchUpStatus:l?vn:qr}),en({tournamentId:e==null?void 0:e.tournamentId,context:"modifyRoundRobinMatchUpsStatus",eventId:a==null?void 0:a.eventId,drawDefinition:i,matchUp:s}))})}function _C(t){let{inContextDrawMatchUps:e,participantId:i,drawPosition:n}=t,{tournamentRecord:r,drawDefinition:a,structureId:o,matchUpsMap:s,event:l}=t,{structure:c}=ui({drawDefinition:a,structureId:o}),u=(ja({drawDefinition:a,structure:c}).positionAssignments||[]).find(p=>i&&p.participantId===i||n&&p.drawPosition===n);if(u&&i&&!n&&(n=u==null?void 0:u.drawPosition),!n)return{error:yT};i||(i=u==null?void 0:u.participantId);let{activeDrawPositions:d}=AC({drawDefinition:a,structureId:o});return d.includes(n)?{error:kk}:(e||({matchUps:e}=Ia({inContext:!0,drawDefinition:a,matchUpsMap:s})),J2({inContextDrawMatchUps:e,tournamentRecord:r,drawDefinition:a,structureId:o,drawPosition:n,matchUpsMap:s,event:l}).drawPositionCleared?(Ym({tournamentId:r==null?void 0:r.tournamentId,drawDefinition:a,structure:c,event:l}),{...ce,participantId:i}):{error:ine})}function J2({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,drawPosition:n,matchUpsMap:r,structureId:a,event:o}){var v,y;let{structure:s}=ui({drawDefinition:i,structureId:a});if(!s)return{error:wr};let l=ja({drawDefinition:i,structure:s}).positionAssignments||[],c=l.some(b=>{if(b.drawPosition===n)return delete b.participantId,delete b.qualifier,delete b.bye,!0});if(s.structureType===As)return eoe({positionAssignments:l,tournamentRecord:e,drawDefinition:i,matchUpsMap:r,structure:s}),{drawPositionCleared:c,...ce};let u={isCollectionMatchUp:!1},{matchUps:d}=wn({drawDefinition:i,matchUpFilters:u,matchUpsMap:r,structure:s,event:o}),{roundProfile:p,roundMatchUps:h}=Us({matchUps:d}),f=(v=p&&Object.keys(p))==null?void 0:v.map(b=>ri(b)),m=n,g=(y=f==null?void 0:f.map(b=>{var R,N,M,A;let I=(N=(R=p==null?void 0:p[b])==null?void 0:R.pairedDrawPositions)==null?void 0:N.find(_=>_.includes(m)),T=I==null?void 0:I.find(_=>_!==m),w=l.find(_=>_.drawPosition===T),S=p==null?void 0:p[b+1],D=w==null?void 0:w.bye,E=(M=S==null?void 0:S.pairedDrawPositions)==null?void 0:M.find(_=>_.includes(T)),C=D&&E&&S&&((A=S.drawPositions)==null?void 0:A.includes(T)),P=I&&{pairedDrawPositionByeAdvancedPair:!C&&E,pairedDrawPosition:T,targetDrawPosition:m,relevantPair:I,roundNumber:b};return C&&(m=T),P}).filter(b=>b==null?void 0:b.targetDrawPosition))==null?void 0:y.reduce((b,I)=>{let{roundNumber:T,relevantPair:w,targetDrawPosition:S,pairedDrawPosition:D,pairedDrawPositionByeAdvancedPair:E}=I,C={roundNumber:T,targetDrawPosition:S,relevantPair:w},P=E&&{roundNumber:T+1,targetDrawPosition:D,relevantPair:E,subsequentRoundRemoval:!0},R=[C,P].filter(Boolean);return b.concat(...R)},[]);return g==null||g.forEach(({roundNumber:b,targetDrawPosition:I,relevantPair:T})=>{let w=h==null?void 0:h[b].find(S=>{var D;return Ts((D=S.drawPositions)==null?void 0:D.filter(Boolean),T.filter(Boolean))});w&&(pNe({inContextDrawMatchUps:t,targetDrawPosition:I,tournamentRecord:e,drawDefinition:i,structureId:a,roundNumber:b,matchUpsMap:r}),toe({inContextDrawMatchUps:t,positionAssignments:l,tournamentRecord:e,drawDefinition:i,targetMatchUp:w,drawPosition:n,matchUpsMap:r,structure:s,event:o}))}),{tasks:g,drawPositionCleared:c,positionAssignments:l}}function pNe({inContextDrawMatchUps:t,targetDrawPosition:e,tournamentRecord:i,drawDefinition:n,matchUpsMap:r,roundNumber:a,structureId:o}){let{structure:s}=ui({drawDefinition:n,structureId:o});if(!s)return{error:wr};if(s.structureType===As)return;r=r||Ao({drawDefinition:n});let l=((r==null?void 0:r.mappedMatchUps)||{})[o].matchUps,{initialRoundNumber:c}=Xb({drawPosition:e,matchUps:l}),u=l==null?void 0:l.filter(p=>{var h;return p.roundNumber>=a&&p.roundNumber!==c&&((h=p.drawPositions)==null?void 0:h.includes(e))}),d=Vn({drawDefinition:n,structureId:o}).positionAssignments??[];return u==null||u.forEach(p=>toe({drawPosition:e,targetMatchUp:p,inContextDrawMatchUps:t,positionAssignments:d,tournamentRecord:i,drawDefinition:n,matchUpsMap:r,structure:s})),{...ce}}function toe({inContextDrawMatchUps:t,positionAssignments:e,tournamentRecord:i,drawDefinition:n,targetMatchUp:r,drawPosition:a,matchUpsMap:o,structure:s,event:l}){var S,D,E,C,P,R;let c="removeDrawPosition",u=(S=r.drawPositions)==null?void 0:S.slice(),d=r.matchUpStatus,p=r.winningSide;o=o??Ao({drawDefinition:n});let h=o.mappedMatchUps[s.structureId].matchUps,{initialRoundNumber:f}=Xb({drawPosition:a,matchUps:h});if(r.roundNumber&&f&&r.roundNumber>f){let N=(r.drawPositions??[]).map(M=>M===a?void 0:M);r.drawPositions=N}if(r.matchUpType===Xn){let N=(((D=t==null?void 0:t.find(M=>M.matchUpId===r.matchUpId))==null?void 0:D.sides)??[]).reduce((M,A,_)=>A.drawPosition===a?_:M,void 0);N!==void 0&&((C=(E=r.sides)==null?void 0:E[N])!=null&&C.lineUp)&&((P=r.sides)==null||delete P[N].lineUp,en({tournamentId:i==null?void 0:i.tournamentId,context:`${c}-TEAM`,eventId:l==null?void 0:l.eventId,matchUp:r,drawDefinition:n}))}let m=Ds({matchUpId:r.matchUpId,inContextDrawMatchUps:t,drawDefinition:n}),{targetLinks:{winnerTargetLink:g},targetMatchUps:{loserMatchUp:v,winnerMatchUp:y,loserMatchUpDrawPositionIndex:b}}=m,I=e.filter(({drawPosition:N})=>{var M;return(M=r.drawPositions)==null?void 0:M.includes(N)}).filter(N=>N.bye).length,T=I&&vn||r.matchUpStatus&&[Zi,hn].includes(r.matchUpStatus)&&r.matcHUpStatus||((R=r.drawPositions)==null?void 0:R.length)===2&&qr||void 0;r.matchUpStatus=T,r.matchUpStatus&&[hn,Zi].includes(r.matchUpStatus)&&(r.winningSide=void 0);let w=u==null?void 0:u.find(N=>{var M;return!((M=r.drawPositions)!=null&&M.includes(N))});if(u!=null&&u.includes(a)&&d===r.matchUpStatus&&p===r.winningSide||(w&&Ac({method:c,color:"brightyellow",removedDrawPosition:w}),en({tournamentId:i==null?void 0:i.tournamentId,eventId:l==null?void 0:l.eventId,matchUp:r,context:`${c}-${a}`,drawDefinition:n})),v&&v.structureId!==m.matchUp.structureId&&!I){let{drawPositions:N,roundNumber:M}=v;if(M===1){let A=N[b];J2({structureId:v.structureId,drawPosition:A,inContextDrawMatchUps:t,tournamentRecord:i,drawDefinition:n,matchUpsMap:o})}else{let A=Math.min(...N.filter(Boolean)),_=hNe({loserMatchUpDrawPosition:A,inContextDrawMatchUps:t,tournamentRecord:i,drawDefinition:n,loserMatchUp:v,matchUpsMap:o,event:l});if(_.error)return pe({result:_,stack:c});let x=((o==null?void 0:o.mappedMatchUps)||{})[v.structureId].matchUps,{initialRoundNumber:O}=Xb({drawPosition:A,matchUps:x});O===1&&(Ac({method:c,color:"brightyellow",loserMatchUpDrawPosition:A}),J2({structureId:v.structureId,drawPosition:A,inContextDrawMatchUps:t,tournamentRecord:i,drawDefinition:n,matchUpsMap:o}))}}return y&&y.structureId!==m.matchUp.structureId&&g.target.feedProfile,{...ce}}function hNe({loserMatchUpDrawPosition:t,inContextDrawMatchUps:e,tournamentRecord:i,drawDefinition:n,loserMatchUp:r,matchUpsMap:a,event:o}){var c;let{structure:s}=ui({structureId:r.structureId,drawDefinition:n}),{positionAssignments:l}=Vn({structure:s});if((c=l==null?void 0:l.find(u=>u.drawPosition===t))!=null&&c.bye){let u=_C({drawPosition:t,structureId:r.structureId,inContextDrawMatchUps:e,tournamentRecord:i,drawDefinition:n,matchUpsMap:a,event:o});if(u.error)return u}return{...ce}}function Ey({drawDefinition:t,stages:e}){if(!t)return{error:Vt};let i=((t==null?void 0:t.structures)??[]).filter(r=>!(e!=null&&e.length)||r.stage&&e.includes(r.stage)),n=Pi(i.map(r=>{let{positionAssignments:a}=Vn({structure:r});return a?a.map(Gi):[]}).flat().filter(Boolean));return{...ce,assignedParticipantIds:n}}function hd(t){let e=((t==null?void 0:t.entries)??[]).filter(Boolean).reduce((n,r)=>{let{entryStage:a,entryStatus:o}=r,s=`_${a||xt}${o||""}`;return n[s]||(n[s]=[]),n[s].push(r),n},{}),i=n=>isNaN(n)?1/0:n;return Object.keys(e).map(n=>e[n].sort((r,a)=>i(r.entryPosition)-i(a.entryPosition)).map((r,a)=>{let o=a+1;return{...r,entryPosition:o}})).flat()}function dv(t){return[Uy,Fu].includes(t)}function RA({autoEntryPositions:t=!0,ignoreAssignment:e,tournamentRecord:i,drawDefinition:n,participantIds:r,entryStatus:a,entryStage:o,extension:s,eventSync:l,drawId:c,stage:u,event:d}){var E,C,P,R,N,M,A,_,x,O,B,F;if(!r||!Array.isArray(r))return{error:vd,method:"modifyEntriesStatus",participantIds:r};if(!n&&!d)return{error:Qn};if(a&&!wae.includes(a))return{error:O2};if(o&&!Zk.includes(o))return{error:vy};let p="modifyEntriesStatus",h=[];if(!a&&!s)return pe({result:{error:Yt},info:"Missing entryStatus",stack:p});if(s&&!dp({extension:s,requiredAttributes:["name"]}))return pe({result:{error:Re},info:"Invalid extension",context:{extension:s},stack:p});let f=[];(E=d==null?void 0:d.drawDefinitions)==null||E.forEach(G=>{let H=Ey({stages:u&&[u],drawDefinition:G}).assignedParticipantIds??[];f.push(...H)});let m=(i==null?void 0:i.participants)??[];if(!r.every(G=>{var $;let H=($=zm({tournamentParticipants:m,participantId:G}))==null?void 0:$.participantType;return!(H&&[Ti,Nc].includes(H)&&dv(a))&&!(a&&(d!=null&&d.eventType)&&H===Hi&&[Oc,Lc].includes(d.eventType)&&[yu,...bN].includes(a))}))return{error:O2};let g=d&&Zr({event:d}).flightProfile,v=(C=g==null?void 0:g.flights)==null?void 0:C.find(G=>G.drawId===c),y=G=>{let H=(G||[]).filter(q=>!u||!q.entryStage||u===q.entryStage).filter(({participantId:q})=>r.includes(q)),$=q=>a&&f.includes(q.participantId)&&!(bN.includes(q.entryStatus)&&bN.includes(a));return H.every(q=>$(q)&&!e?!1:(a&&(q.entryStatus=a,delete q.entryPosition),o&&(q.entryStage=o,delete q.entryPosition),s&&(s.value?cn({element:q,extension:s}):Is({element:q,name:s.name})),!0))?{...ce}:{error:wT}},b=({flight:G,drawDefinition:H})=>{d&&(d.entries=hd({entries:d.entries??[]})),G&&(G.drawEntries=hd({entries:G.drawEntries})),H&&(H.entries=hd({entries:H.entries}))},I=G=>{let{flight:H,drawDefinition:$}=G,q="updateDrawEntries";if(H){let z=y(H.drawEntries);if(z.error)return pe({result:z,stack:q})}if($){let z=y($.entries);if(z.error)return pe({result:z,stack:q});h.includes($.drawId)||h.push($.drawId)}return{...ce}},T=((P=d==null?void 0:d.entries)==null?void 0:P.find(({entryPosition:G})=>G))??(((R=v==null?void 0:v.drawEntries)==null?void 0:R.find(({entryPosition:G})=>G))||((N=n==null?void 0:n.entries)==null?void 0:N.find(({entryPosition:G})=>G)));if(t&&!T&&b({flight:v,drawDefinition:n}),v||n){let G=I({flight:v,drawDefinition:n});if(G.error)return pe({result:G,stack:p})}let w=((M=d==null?void 0:d.drawDefinitions)==null?void 0:M.map(({drawId:G})=>G))??[],S=((A=g==null?void 0:g.flights)==null?void 0:A.filter(G=>!w.includes(G.drawId)))||[];for(let G of S){let H=G&&I({flight:G});if(H!=null&&H.error)return pe({result:H,stack:p})}let D=((_=g==null?void 0:g.flights)==null?void 0:_.length)===1&&(((x=d==null?void 0:d.drawDefinitions)==null?void 0:x.length)??0)<=((O=g==null?void 0:g.flights)==null?void 0:O.length);if(!v&&!n&&a&&Iae.includes(a))return{error:Bne};if(!v&&!n||a===yh||l&&D){let G=y(d==null?void 0:d.entries);if(G!=null&&G.error)return pe({result:G,stack:p});let H;if(a===yh&&((B=g==null?void 0:g.flights)==null||B.every($=>{let q=y($.drawEntries);return q.error?(H=q.error,!1):($.drawEntries=$.drawEntries.filter(({participantId:z})=>!r.includes(z)),!0)}),(F=d==null?void 0:d.drawDefinitions)==null||F.every($=>{var z;let q=y($.entries);return q.error?(H=q.error,!1):($.entries=(z=$.entries)==null?void 0:z.filter(({participantId:Z})=>!r.includes(Z)),!0)})),H)return pe({result:{error:H},stack:p})}t&&b({flight:v,drawDefinition:n});for(let G of(d==null?void 0:d.drawDefinitions)??[])h.length&&!h.includes(G.drawId)||qn({tournamentId:i.tournamentId,eventId:d==null?void 0:d.eventId,drawDefinition:G});return{...ce}}function th({requireTimeStamp:t,scaleAttributes:e,participant:i}){var n,r;if(!i)return{error:NI};if(!Xi(e))return{error:Re};if(i.timeItems||(i.timeItems=[]),Array.isArray(i.timeItems)){let{accessor:a,scaleType:o,eventType:s,scaleName:l}=e,c=[Bv,o,s,l].join("."),u=i.timeItems.filter(d=>(d==null?void 0:d.itemType)===c).filter(d=>!t||(d==null?void 0:d.itemDate)).sort((d,p)=>(d.createdAt?new Date(d.createdAt).getTime():0)-(p.createdAt?new Date(p.createdAt).getTime():0)).pop();if(u){let[d,p,h,f]=((n=u.itemType)==null?void 0:n.split("."))??[];if(d!==Bv)return{error:aC};let m=((r=a&&Tb({element:u.itemValue,accessor:a}))==null?void 0:r.value)||u.itemValue,g={eventType:h,scaleDate:u.itemDate,scaleValue:m,scaleName:f,scaleType:p};return{...ce,scaleItem:g}}}return{...ce,scaleItem:void 0}}function fNe({publishedSeeding:t,usePublishState:e,withSeeding:i,participant:n,event:r}){var u,d,p;let a={},o=h=>[Bv,Qp,r.eventType,h].join("."),s=Object.assign({},...(n.timeItems||[]).filter(({itemType:h})=>h.split(".")[1]===Qp).map(({itemType:h,itemValue:f})=>({[h]:f}))),l=((t==null?void 0:t.stageSeedingScaleNames)&&Object.values(t==null?void 0:t.stageSeedingScaleNames)||Array.isArray(t==null?void 0:t.seedingScaleNames)&&t.seedingScaleNames||[]).map(o),c=zr(Object.keys(s),l);if((!e||!Object.keys(s).length&&!((u=t==null?void 0:t.drawIds)!=null&&u.length)||c.length)&&c.length){if(t!=null&&t.stageSeedingScaleNames){let h=Object.keys(t.stageSeedingScaleNames).map(m=>{let g=o(t.stageSeedingScaleNames[m]),v=s[g];return[m,v]}).filter(m=>m[1]).map(m=>({[m[0]]:{seedValue:m[1]}})),f=Object.assign({},...h);a.seedAssignments=f}else if(c){let h=c.map(f=>s[f]);a.seedValue=h.pop()}}else if(!e&&typeof i=="object"){let h=Object.keys(i).map(m=>{let g=o(i[m]),v=s[g];return[m,v]}).filter(m=>m[1]).map(m=>({[m[0]]:{seedValue:m[1]}})),f=Object.assign({},...h);a.seedAssignments=f}else{let{categoryName:h,ageCategoryCode:f}=r.category||{},m=[f,r.eventId,h].filter(Boolean),g;for(let v of m){let y={eventType:r.eventType,scaleType:Qp,scaleName:v},b=th({scaleAttributes:y,participant:n});if(b.scaleItem){g=b.scaleItem;break}}if(g&&(!e||t!=null&&t.published&&!((p=(d=t==null?void 0:t.published)==null?void 0:d.drawIds)!=null&&p.length))){let v=g.scaleValue;a.seedValue=v}}return a}function mNe({convertExtensions:t,seedAssignments:e,participant:i,withSeeding:n,seedValue:r,eventId:a,ranking:o,entry:s}){let{entryStatus:l,entryStage:c,entryPosition:u,extensions:d}=s,p=d!=null&&d.length&&t?Object.assign({},...wz(d??[])):{},h=Object.assign(p,{entryPosition:u,entryStatus:l,entryStage:c,ranking:o,eventId:a});i.events[a]=zt(h,!1,!1,!0),n&&(e&&(i.events[a].seedAssignments=e),r&&(i.events[a].seedValue=r))}function ioe(t){let{participantMap:e,participantId:i,matchUpStatus:n,roundPosition:r,structureId:a,matchUpType:o,roundNumber:s,matchUpId:l,potential:c,schedule:u,drawId:d,score:p}=t;!u||!Object.keys(u).length||n===vn||e[i].scheduleItems.push({...u,scheduledDate:Ei(u==null?void 0:u.scheduledDate),scheduledTime:ir(u==null?void 0:u.scheduledTime),checkScoreHasValue:Pa({score:p}),matchUpStatus:n,roundPosition:r,structureId:a,matchUpType:o,roundNumber:s,matchUpId:l,potential:c,drawId:d})}function kC(t){var a,o,s;let e=di(t,[{[ls]:!0}]);if(e.error)return e;let{tournamentRecord:i,status:n=oc}=t,r=`${Cg}.${Pg}`;return Ot((s=(o=(a=vx({tournamentRecord:i,itemType:r}))==null?void 0:a.timeItem)==null?void 0:o.itemValue)==null?void 0:s[n],!1,!0)}function gNe(t){let{tournamentId:e}=t??{};return!!e}function Yc({event:t,status:e=oc}){var n,r,a;let i=`${Cg}.${Pg}`;return(a=(r=(n=vC({itemType:i,event:t}))==null?void 0:n.timeItem)==null?void 0:r.itemValue)==null?void 0:a[e]}function mq({drawDetails:t,drawId:e}){var i,n;return(n=(i=t==null?void 0:t[e])==null?void 0:i.publishingDetail)==null?void 0:n.published}function HI(t){var d,p,h,f,m,g,v,y,b;let{tournamentRecord:e,drawDefinition:i,eventIds:n,eventId:r,drawIds:a,drawId:o,event:s}=t??{};if(e&&!gNe(e))return{error:Re};if(r&&!s)return{error:Xl};if(Array.isArray(n)&&(n!=null&&n.length)){let I={};for(let T of n){if(!$r(T))return{error:Re};let w=(d=zs({tournamentRecord:e,eventId:T}))==null?void 0:d.event;if(!w)return{error:Xl};let S=_B({event:w});I[T]=S}return{...ce,publishState:I}}if(s){let I=_B({event:s}),T={};if(o)return i?{publishState:{status:{published:!!((p=I.status.publishedDrawIds)!=null&&p.includes(o)),drawDetail:(h=I.status.drawDetails)==null?void 0:h[o]},...ce}}:{error:Zl};if(Array.isArray(a)&&(a!=null&&a.length)){let w=((f=s.drawDefinitions)==null?void 0:f.map(kD))??[];for(let S of a){if(!$r(S))return{error:Re};if(!w.includes(S))return{error:Zl};T[S]={status:{published:!!I.status.publishedDrawIds.includes(S),drawDetail:(m=I.status.drawDetails)==null?void 0:m[S]}}}}else T=I;return{...ce,publishState:T}}let l=[],c=!1,u={};for(let I of(e==null?void 0:e.events)??[]){let T=_B({event:I});u[I.eventId]=T,T.status.published&&(l.push(I.eventId),c=!0);for(let{drawId:w}of I.drawDefinitions??[]){let S=(v=(g=T.status)==null?void 0:g.publishedDrawIds)==null?void 0:v.includes(w);S&&(u[w]={status:{published:S}})}}if(e){let I=kC({tournamentRecord:e});u.tournament=I??{},((y=I==null?void 0:I.orderOfPlay)!=null&&y.published||(b=I==null?void 0:I.participants)!=null&&b.published)&&(c=!0),u.tournament.status={published:c,publishedEventIds:l}}return{...ce,publishState:u}}function _B({event:t}){var a;let e=Yc({event:t});if(!e)return{status:{published:!1}};let i={published:void 0,seedingScaleNames:[],drawIds:[]};e.seeding&&Object.assign(i,e.seeding);let n=e.drawDetails??{};for(let o of((a=t.drawDefinitions)==null?void 0:a.map(kD))||[])n[o]||(n[o]={publishingDetail:{published:!1}});let r=n&&Object.keys(n).length&&Object.keys(n).filter(o=>mq({drawDetails:n,drawId:o}))||e.drawIds;return{status:{published:r&&r.length>0,publishedDrawIds:r,publishedSeeding:i,drawDetails:n}}}function Px(t,e){return(t||"").localeCompare(e||"")}function vNe({finishingPositionRange:t={},participantMap:e,finishingRound:i,participantWon:n,matchUpStatus:r,participantId:a,stageSequence:o,roundNumber:s,structureId:l,matchUpId:c,drawId:u,stage:d}){let p=e[a],h=y=>Math.abs(y[0]-y[1]);p.structureParticipation[l]||(p.structureParticipation[l]={rankingStage:d,walkoverWinCount:0,defaultWinCount:0,stageSequence:o,winCount:0,structureId:l,drawId:u});let f=p.structureParticipation[l],{winner:m,loser:g}=t,v=n?m:g;n&&(f.winCount+=1,r===hn&&(f.walkoverWinCount+=1),r===Zi&&(f.defaultWinCount+=1)),v&&(!f.finishingPositionRange||h(v)<h(f.finishingPositionRange))&&(f.finishingPositionRange=v),i&&((!f.finishingRound||i<f.finishingRound)&&(f.finishingMatchUpId=c,f.finishingRound=i,f.roundNumber=s),i===1&&(f.participantWon=n))}function WK(t){var A,_,x,O,B,F,G,H,$,q;let{withScheduleItems:e,scheduleAnalysis:i,withTeamMatchUps:n,participantMap:r,withOpponents:a,withMatchUps:o,withEvents:s,withDraws:l,finishingPositionRange:c,finishingRound:u,matchUpStatus:d,stageSequence:p,roundNumber:h,structureId:f,score:m,stage:g,withRankingProfile:v,tieWinningSide:y,roundPosition:b,matchUpTieId:I,matchUpSides:T,collectionId:w,matchUpType:S,winningSide:D,matchUpId:E,schedule:C,eventId:P,drawId:R,sides:N}=t,M=a&&(N==null?void 0:N.length)===2&&Object.assign({},...N.map(({sideNumber:z},Z)=>{let Y=N[1-Z].participantId;return z&&{[z]:Y}}).filter(Boolean));for(let z of N){let{participantId:Z,sideNumber:Y,bye:Q}=z;if(Q)continue;let X=D===Y,oe=se=>{var de,Ie;let te=(de=r[se])==null?void 0:de.participant,he=te==null?void 0:te.participantType,ae=[{participantId:se,participantType:he}];if(he!==Nc)for(let De of(te==null?void 0:te.individualParticipantIds)||[]){let Te=(Ie=r[De])==null?void 0:Ie.participant;ae.push({participantType:Te==null?void 0:Te.participantType,participantId:De})}return ae},re=(se,te)=>{if(o){if(r[se].matchUps[E]={participantWon:X,matchUpType:S,structureId:f,sideNumber:Y,matchUpId:E,eventId:P,drawId:R,stage:g},a){let he=oe(te);r[se].matchUps[E].opponentParticipantInfo=he}w&&(r[se].matchUps[E].collectionId=w)}a&&te&&(r[se].opponents[te]={participantId:te,matchUpId:E,eventId:P,drawId:R}),v&&vNe({finishingPositionRange:c,participantMap:r,participantWon:X,finishingRound:u,matchUpStatus:d,participantId:se,stageSequence:p,roundNumber:h,structureId:f,matchUpId:E,drawId:R,stage:g}),(i||e)&&ioe({participantMap:r,participantId:se,matchUpStatus:d,roundPosition:b,matchUpType:S,roundNumber:h,structureId:f,matchUpId:E,schedule:C,drawId:R,score:m})},me=({participant:se,partnerParticipantId:te})=>{var ae,de,Ie;let he=(De,Te)=>{De&&(De.partnerParticipantIds||(De.partnerParticipantIds=[]),De.partnerParticipantIds.includes(Te)||De.partnerParticipantIds.push(Te))};l&&he((ae=se==null?void 0:se.draws)==null?void 0:ae[R],te),s&&he((de=se==null?void 0:se.events)==null?void 0:de[P],te),o&&he((Ie=se==null?void 0:se.matchUps)==null?void 0:Ie[E],te)};if(Z&&r[Z]){let se=M==null?void 0:M[Y];re(Z,se);let te=((A=r[Z])==null?void 0:A.participant.participantType)===Ti,he=((_=r[Z])==null?void 0:_.participant.individualParticipantIds)||[];if(I){if(n){let ae=de=>r[de].matchUps[I]={participantWon:y===Y,matchUpId:I,matchUpType:Xn,sideNumber:Y};ae(Z),he.forEach(ae)}if(l&&!r[Z].draws[R]){let ae=(O=(x=T.find(De=>De.sideNumber===Y))==null?void 0:x.participant)==null?void 0:O.participantId,de=(G=(F=(B=r[ae])==null?void 0:B.draws)==null?void 0:F[R])==null?void 0:G.entryStatus,Ie=De=>r[De].draws[R]={entryStatus:de,eventId:P,drawId:R};Ie(Z),he.forEach(Ie)}}if(te&&(he.forEach(ae=>r[ae]&&re(ae,se)),he.forEach((ae,de)=>{let Ie=he[1-de],De=r[ae];De&&me({participant:De,partnerParticipantId:Ie})}),s&&T)){let ae=($=(H=T.find(de=>de.sideNumber===Y))==null?void 0:H.participant)==null?void 0:$.participantId;if(ae){let de=(q=r[ae])==null?void 0:q.events[P];de?(r[Z].events[P]={...de},he.forEach(Ie=>r[Ie].events[P]={...de})):console.log("Missing teamEntry",{eventId:P,teamParticipantId:ae})}}if(D){let ae=de=>{X?(r[de].counters[S].wins+=1,r[de].counters.wins+=1,d===hn&&(r[de].counters[S].walkoverWins+=1,r[de].counters.walkoverWins+=1),d===Zi&&(r[de].counters[S].defaultWins+=1,r[de].counters.defaultWins+=1)):(r[de].counters[S].losses+=1,r[de].counters.losses+=1,d===hn&&(r[de].counters[S].walkovers+=1,r[de].counters.walkovers+=1),d===Zi&&(r[de].counters[S].defaults+=1,r[de].counters.defaults+=1))};ae(Z),he.forEach(ae)}}}}function yNe(t){var N,M,A,_,x,O,B;let{participantFilters:e,convertExtensions:i,policyDefinitions:n,tournamentRecord:r,usePublishState:a,contextProfile:o,participantMap:s,withPotentialMatchUps:l,withRankingProfile:c,withScheduleItems:u,scheduleAnalysis:d,withTeamMatchUps:p,withStatistics:h,withOpponents:f,withMatchUps:m,withSeeding:g,withEvents:v,withDraws:y}=t,b=e==null?void 0:e.participantIds,I=F=>{var H,$;let G=[F];return($=(H=s[F])==null?void 0:H.participant.individualParticipantIds)==null||$.forEach(q=>G.push(q)),G.some(q=>!(b!=null&&b.length)||b.includes(q))?G:[]},T={withMatchUps:m||c,withEvents:v||c,withDraws:y||c,withPotentialMatchUps:l,withRankingProfile:c,withScheduleItems:u,scheduleAnalysis:d,withTeamMatchUps:p,withStatistics:h,participantMap:s,withOpponents:f,withSeeding:g},w=[],S={},D=[],E={},C={},P={},R=({eventType:F,scaleNames:G,participantId:H})=>{var $,q,z,Z,Y;return(Y=(Z=(z=(q=($=s[H])==null?void 0:$.participant)==null?void 0:q.rankings)==null?void 0:z[F])==null?void 0:Z.find(Q=>G.includes(Q.scaleName)))==null?void 0:Y.scaleValue};for(let F of(r==null?void 0:r.events)||[]){if(e!=null&&e.eventIds&&!e.eventIds.includes(F.eventId))continue;let{drawDefinitions:G=[],extensions:H=[],eventType:$,eventName:q,category:z,entries:Z,eventId:Y,gender:Q}=F,{flightProfile:X}=Zr({event:F}),oe=(X==null?void 0:X.flights)??[],re=HI({event:F}).publishState;re&&(E[Y]=re);let me=(N=re==null?void 0:re.status)==null?void 0:N.publishedSeeding;if(v||g||c){let te=i?Object.assign({},...wz(H??[])):{};C[Y]={...te,eventName:q,eventType:$,category:z,eventId:Y,gender:Q};let he=[z==null?void 0:z.categoryName,z==null?void 0:z.ageCategoryCode].filter(Boolean);for(let ae of Z){let{participantId:de}=ae;if(!de||!s[de])continue;let Ie=R({eventType:$,scaleNames:he,participantId:de}),De,Te;if(g){let Ve=s[de].participant;({seedAssignments:De,seedValue:Te}=fNe({publishedSeeding:me,usePublishState:a,withSeeding:g,participant:Ve,event:F}))}let _e=Ve=>{var St,nt;if((nt=(St=s[Ve])==null?void 0:St.events)!=null&&nt[Y])return;let ot=s[Ve];mNe({convertExtensions:i,seedAssignments:De,participant:ot,withSeeding:g,seedValue:Te,eventId:Y,ranking:Ie,entry:ae})};_e(de),(s[de].participant.individualParticipantIds||[]).forEach(_e)}}let se=(M=E==null?void 0:E[Y])==null?void 0:M.publishedSeeding;if(y||c||g){let te=ae=>ae?Object.assign({},...ae.map(({participantId:de,seedValue:Ie,seedNumber:De})=>({[de]:{seedValue:Ie,seedNumber:De}}))):void 0,he=Pi([...G.map(kD),...oe.map(kD)]);for(let ae of he){let de=G.find(ge=>ge.drawId===ae),Ie=oe==null?void 0:oe.find(ge=>ge.drawId===ae),De=(de==null?void 0:de.entries)||(Ie==null?void 0:Ie.drawEntries),{structures:Te=[],drawOrder:_e,drawName:Ve,drawType:ot}=de??{},St=Ie==null?void 0:Ie.flightNumber,nt=[z==null?void 0:z.categoryName,z==null?void 0:z.ageCategoryCode].filter(Boolean),Bt=((de==null?void 0:de.structures)||[]).sort((ge,Se)=>FI(ge,Se)).map(({structureId:ge,structures:Se})=>[ge,...(Se||[]).map(({structureId:qe})=>qe)]).flat(1/0),Pe,et,Ee,lt,Ke=0,bt=Te.filter(({stage:ge,stageSequence:Se})=>ge===xt&&Se===1||ge===Zt).flatMap(ge=>{let{seedAssignments:Se,stageSequence:qe,stage:$e}=ge,{positionAssignments:ke}=Vn({structure:ge});return $e===xt?(Ke=(ke==null?void 0:ke.length)??0,Ee=ke,lt=Se):qe===1&&(Pe=ke,et=Se),ke}).map(({participantId:ge})=>ge).filter(Boolean),gt=te(lt),Ue=te(et),xe=de?De.filter(({participantId:ge})=>bt.includes(ge)):De,We=!a||(se==null?void 0:se.published)&&(((A=se==null?void 0:se.drawIds)==null?void 0:A.length)===0||((_=se==null?void 0:se.drawIds)==null?void 0:_.includes(ae)));for(let ge of xe){if(!s[ge.participantId])continue;let{entryStatus:Se,entryStage:qe,entryPosition:$e,participantId:ke}=ge,Ut=R({participantId:ke,scaleNames:nt,eventType:$}),pt=tt=>{var Kn,Gt,Ji,xo,na;if(!s[tt]||(Kn=s[tt].draws)!=null&&Kn[ae])return;let At=g&&We,ei=At?{}:void 0,vi=At?((Gt=gt==null?void 0:gt[ke])==null?void 0:Gt.seedValue)||((Ji=gt==null?void 0:gt[ke])==null?void 0:Ji.seedNumber):void 0,Ln=vi?gt==null?void 0:gt[ke]:void 0,gn=At?((xo=Ue==null?void 0:Ue[ke])==null?void 0:xo.seedValue)||((na=Ue==null?void 0:Ue[ke])==null?void 0:na.seedNumber):void 0,Jt=gn?Ue==null?void 0:Ue[ke]:void 0;ei&&vi&&(ei[xt]=Ln),ei&&gn&&(ei[Zt]=Jt);let kr=vi||gn;kr&&(s[tt].participant.seedings[$]||(s[tt].participant.seedings[$]=[]),Ln&&s[tt].participant.seedings[$].push({...Ln,scaleName:ae}),Jt&&s[tt].participant.seedings[$].push({...Jt,scaleName:ae}),ei&&(s[tt].events[Y].seedAssignments||(s[tt].events[Y].seedAssignments={}),Object.keys(ei).forEach(ra=>s[tt].events[Y].seedAssignments[ra]=ei[ra]))),(y||c)&&(s[tt].draws[ae]=zt({seedAssignments:ei,entryPosition:$e,entryStatus:Se,entryStage:qe,seedValue:kr,eventId:Y,ranking:Ut,drawId:ae},!1,!1,!0))};[Fu,Uy].includes(Se)||(pt(ke),(x=s[ke].participant.individualParticipantIds||[])==null||x.forEach(pt))}let st=((de==null?void 0:de.structures)??[]).reduce((ge,Se)=>(ge.includes(Se.stage)||ge.push(Se.stage),ge),[]),vt=((de==null?void 0:de.links)??[]).length;P[ae]={qualifyingPositionAssignments:Pe,qualifyingSeedAssignments:et,mainPositionAssignments:Ee,qualifyingSeedingMap:Ue,mainSeedAssignments:lt,orderedStructureIds:Bt,mainSeedingMap:gt,flightNumber:St,linksCount:vt,drawOrder:_e,drawName:Ve,drawType:ot,drawSize:Ke,drawId:ae,stages:st}}}if(c||d||p||h||f||m||y){let te=!!d||l,he=((O=xh({afterRecoveryTimes:!!d,policyDefinitions:n,tournamentRecord:r,inContext:!0,contextProfile:o,participantMap:s,nextMatchUps:te,event:F}))==null?void 0:O.matchUps)??[];for(let ae of he){let{finishingPositionRange:de,potentialParticipants:Ie,tieMatchUps:De=[],sides:Te=[],winningSide:_e,matchUpType:Ve,matchUpId:ot,eventId:St,drawId:nt,collectionId:Bt,stageSequence:Pe,finishingRound:et,matchUpStatus:Ee,roundPosition:lt,roundNumber:Ke,structureId:bt,schedule:gt,score:Ue,stage:xe}=ae;S[ot]=ae;let We={finishingPositionRange:de,finishingRound:et,stageSequence:Pe,roundPosition:lt,collectionId:Bt,roundNumber:Ke,structureId:bt,schedule:gt,eventId:St,drawId:nt,score:Ue,stage:xe};WK({...We,...T,matchUpStatus:Ee,winningSide:_e,matchUpType:Ve,matchUpId:ot,sides:Te});for(let st of De){let{winningSide:vt,sides:ge=[],matchUpId:Se,matchUpStatus:qe,matchUpType:$e}=st;WK({...We,...T,winningSide:vt,tieWinningSide:_e,matchUpTieId:ot,matchUpId:Se,sides:ge,matchUpSides:Te,matchUpStatus:qe,matchUpType:$e})}Array.isArray(Ie)&&(te||d||u)&&((B=Ie.flat().map(Gi).filter(Boolean))==null||B.forEach(st=>{var vt;(vt=I(st))==null||vt.forEach(ge=>{s[ge]&&(s[ge].potentialMatchUps[ot]=zt({tournamentId:r==null?void 0:r.tournamentId,matchUpId:ot,eventId:St,drawId:nt}))}),(d||u)&&ioe({potential:!0,participantMap:s,participantId:st,matchUpStatus:Ee,roundPosition:lt,structureId:bt,matchUpType:Ve,roundNumber:Ke,matchUpId:ot,schedule:gt,drawId:nt,score:Ue})}))}D.push(...he)}}if(h||c||d){let F=Object.values(s);for(let G of F){let{wins:H,losses:$,[or]:{wins:q,losses:z},[zn]:{wins:Z,losses:Y}}=G.counters,Q=(X,oe,re)=>{let me=oe+re,se=oe,te=me&&se/me;G.statistics[X]={denominator:me,numerator:se,statValue:te,statCode:X}};if(h&&(Q(yN,H,$),Q(`${yN}.${or}`,q,z),Q(`${yN}.${zn}`,Z,Y)),c){let X=(oe=[])=>Math.abs(oe[0]-oe[1]);for(let oe of Object.keys(G.draws)){let{orderedStructureIds:re=[],flightNumber:me}=P[oe]||{};if(G.structureParticipation&&re.length){let se,te=0,he=re.map(ae=>{let de=G.structureParticipation[ae];if(!de)return;se||(se=de==null?void 0:de.finishingPositionRange),X(se)>X(de==null?void 0:de.finishingPositionRange)&&(se=de==null?void 0:de.finishingPositionRange);let Ie=de.stage!==Zt;return Ie&&(te+=1),zt({...de,participationOrder:Ie?te:void 0,flightNumber:me})}).filter(Boolean);G.draws[oe]&&(G.draws[oe].finishingPositionRange=se,G.draws[oe].structureParticipation=he)}}}if(d){let X=Xi(d)?d.scheduledMinutesDifference:0,oe=G.scheduleItems||[],re=G.potentialMatchUps||{},me=oe.reduce((te,he)=>{let{scheduledDate:ae,scheduledTime:de}=he;return te[ae]||(te[ae]=[]),de&&te[ae].push(he),te},{});Object.values(me).forEach(te=>te.sort(Hre));for(let te of oe){let{typeChangeTimeAfterRecovery:he,timeAfterRecovery:ae,scheduledDate:de,scheduledTime:Ie}=te,De=me[de],Te=an(Ie);for(let _e of De){if(_e.matchUpId===te.matchUpId||[hn,Zi].includes(_e.matchUpStatus)&&!_e.checkScoreHasValue)continue;let Ve=te.matchUpType!==_e.matchUpType&&he||ae,ot=te.drawId===_e.drawId,St=re[te.matchUpId]&&re[_e.matchUpId],nt=an(_e.scheduledTime),Bt=Math.abs(nt-Te),Pe=nt>=Te;if((X&&!isNaN(X)?Bt<=X:Pe&&an(_e.scheduledTime)<an(Ve))&&!(St&&ot)&&Pe){let et=[te.matchUpId,_e.matchUpId].sort(Px).join("|");G.scheduleConflicts[et]={priorScheduledMatchUpId:te.matchUpId,matchUpIdWithConflict:_e.matchUpId}}}}let se=G.participant.participantId;Object.keys(G.scheduleConflicts).length&&w.push(se),s[se].scheduleConflicts=G.scheduleConflicts}}}return{participantIdsWithConflicts:w,eventsPublishStatuses:E,derivedEventInfo:C,derivedDrawInfo:P,mappedMatchUps:S,participantMap:s,matchUps:D}}function xC({participantFilters:t={},tournamentRecord:e,participants:i=[]}){var I;if(!Object.keys(t).length)return i;let{accessorValues:n,drawEntryStatuses:r,positionedParticipants:a,eventEntryStatuses:o,participantRoles:s,participantRoleResponsibilities:l,participantTypes:c,participantIds:u,signInStatus:d,enableOrFiltering:p,eventIds:h,genders:f}=t,m=Fp(h)&&((I=e==null?void 0:e.events)==null?void 0:I.filter(T=>h==null?void 0:h.includes(T.eventId)))||(e==null?void 0:e.events)||[],g=r&&bNe({drawEntryStatuses:r,tournamentEvents:m}),v=o&&INe({eventEntryStatuses:o,tournamentEvents:m}),y=a!==void 0&&[!0,!1].includes(a)&&m.reduce((T,w)=>T.concat(...(w.drawDefinitions||[]).map(S=>rae({drawDefinition:S}).allPositionedParticipantIds).filter(Boolean)),[]),b=T=>n==null?void 0:n.reduce((w,S)=>{let{accessor:D,value:E}=S,{values:C}=Tb({element:T,accessor:D});return w&&(C==null?void 0:C.includes(E))},!0);if(i=i==null?void 0:i.filter(T=>{var N,M;let w=(M=(N=Wc({element:T,itemType:gC}))==null?void 0:N.timeItem)==null?void 0:M.itemValue,{participantRoleResponsibilities:S,participantType:D,participantRole:E,participantId:C,person:P}=T,R=Array.isArray(f)&&(f==null?void 0:f.length)&&(P==null?void 0:P.sex)&&f.includes(P.sex);return p?f&&R||a&&y.includes(C)||a===!1&&!y.includes(C)||(g==null?void 0:g.includes(C))||(v==null?void 0:v.includes(C))||(u==null?void 0:u.includes(C))||d&&w===d||c&&D&&Fp(c)&&c.includes(D)||s&&E&&Fp(s)&&s.includes(E)||l&&Fp(S)&&Fp(l)&&l.find(A=>S==null?void 0:S.includes(A))||(n==null?void 0:n.length)&&Fp(n)&&b(T):(!f||R)&&(a===void 0||a&&y.includes(C)||a===!1&&!y.includes(C))&&(!g||g.includes(C))&&(!v||v.includes(C))&&(!u||u.includes(C))&&(!d||w===d)&&(!c||D&&Fp(c)&&c.includes(D))&&(!s||E&&Fp(s)&&s.includes(E))&&(!l||Fp(S)&&Fp(l)&&l.find(A=>S==null?void 0:S.includes(A)))&&(!(n!=null&&n.length)||Fp(n)&&b(T))}),m.length&&h){let T=m.filter(w=>h.includes(w.eventId)).map(w=>{let S=(w.entries||[]).map(E=>E.participantId);if(Gr(cp)(w.eventType))return S;let D=((e==null?void 0:e.participants)??[]).filter(E=>S.includes(E.participantId)).map(E=>E.individualParticipantIds).flat(1);return S.concat(...D)}).flat(1);i=i==null?void 0:i.filter(w=>T.includes(w.participantId))}return i}function Fp(t){return t&&Array.isArray(t)&&t.length}function bNe({drawEntryStatuses:t,tournamentEvents:e}){let i=({entryStatus:n})=>Array.isArray(t)?t.includes(n):!0;return Pi(e.reduce((n,r)=>{var l,c;let{flightProfile:a}=Zr({event:r}),o=((l=a==null?void 0:a.flights)==null?void 0:l.map(({drawEntries:u})=>Array.isArray(u)?u.filter(i).map(Gi):[]).flat())||[],s=((c=r.drawDefinitions)==null?void 0:c.map(({entries:u})=>u?u.filter(i).map(Gi):[]))||[];return n.concat(...o,...s)},[]))}function INe({eventEntryStatuses:t,tournamentEvents:e}){return Pi(e.reduce((i,n)=>{let r=(n.entries||[]).filter(({entryStatus:a})=>Array.isArray(t)?t.includes(a):!0).map(Gi);return i.concat(...r)},[]))}function Nr(t){var q;let{withIndividualParticipants:e,participantFilters:i={},withPotentialMatchUps:n,withRankingProfile:r,convertExtensions:a,policyDefinitions:o,withScheduleItems:s,tournamentRecord:l,scheduleAnalysis:c,withSignInStatus:u,withTeamMatchUps:d,withScaleValues:p,usePublishState:h,contextProfile:f,withStatistics:m,withOpponents:g,withMatchUps:v,internalUse:y,withSeeding:b,withEvents:I,withDraws:T,withISO2:w,withIOC:S}=t;if(!l)return{error:ut};(v||r)&&Vu({tournamentRecord:l});let D=yae({convertExtensions:a,tournamentRecord:l,withSignInStatus:u,withScaleValues:p,internalUse:y,withISO2:w,withIOC:S}),{participantMap:E}=D,C=yNe({withMatchUps:v??r,withEvents:I??r,withDraws:T??r,withPotentialMatchUps:n,participantFilters:i,withRankingProfile:r,convertExtensions:a,withScheduleItems:s,policyDefinitions:o,tournamentRecord:l,scheduleAnalysis:c,withTeamMatchUps:d,usePublishState:h,withStatistics:m,participantMap:E,withOpponents:g,contextProfile:f,withSeeding:b}),{participantIdsWithConflicts:P,eventsPublishStatuses:R,derivedEventInfo:N,derivedDrawInfo:M,mappedMatchUps:A}=C,_=C.matchUps;E=C.participantMap;let x=c??n,O=({potentialMatchUps:z,scheduleConflicts:Z,scheduleItems:Y,participant:Q,statistics:X,opponents:oe,matchUps:re,events:me,draws:se})=>{let te=Object.values(se),he=Object.values(oe);return g&&(te==null||te.forEach(ae=>{ae.opponents=he.filter(de=>de.drawId===ae.drawId)})),zt({...Q,scheduleConflicts:c?Object.values(Z):void 0,draws:T||r?te:void 0,events:I||r?Object.values(me):void 0,matchUps:v||r?Object.values(re):void 0,opponents:g?he:void 0,potentialMatchUps:x?Object.values(z):void 0,statistics:m?Object.values(X):void 0,scheduleItems:s?Y:void 0},!1,!1,!0)},B=new Map;for(let z of Object.keys(E))B.set(z,O(E[z]));let F=[...B.values()],G=(q=o==null?void 0:o[NT])==null?void 0:q.participant,H=xC({participants:F,participantFilters:i,tournamentRecord:l});if(e){let z=Xi(e)?e:void 0;for(let Z of H)for(let Y of Z.individualParticipantIds??[]){Z.individualParticipants||(Z.individualParticipants=[]);let Q=B.get(Y);Z.individualParticipants.push(z?Kb({template:z,source:Q}):Q)}}let $=G?H.map(z=>Kb({source:z,template:G})):H;return{participantMap:t.returnParticipantMap!==!1?E:void 0,mappedMatchUps:t.returnMatchUps!==!1?A:void 0,matchUps:t.returnMatchUps!==!1?_:void 0,missingParticipantIds:D.missingParticipantIds,participantIdsWithConflicts:P,eventsPublishStatuses:R,derivedEventInfo:N,derivedDrawInfo:M,participants:$,...ce}}function Ub({participantId:t,drawDefinition:e,entryStatus:i,entryStage:n}){var a;if(!e)return{error:Vt};let r=(a=e.entries)==null?void 0:a.find(o=>o.participantId===t&&(!i||i===o.entryStatus)&&(!n||n===o.entryStage));return t&&r}function $T(t){var h,f,m,g,v,y,b,I,T;let{provisionalPositioning:e,drawDefinition:i,stageSequence:n,structureId:r,stage:a}=t;if(!i)return{error:Vt};let{entryProfile:o}=bC({drawDefinition:i}),s=a&&n&&((m=(f=(h=o==null?void 0:o[a])==null?void 0:h.stageSequence)==null?void 0:f[n])==null?void 0:m.qualifiersCount)||a&&((g=o==null?void 0:o[a])==null?void 0:g.qualifiersCount)||0,l={};if(!r)return{qualifiersCount:s,roundQualifiersCounts:l};let{structure:c}=ui({drawDefinition:i,structureId:r}),u=(v=i.links)==null?void 0:v.filter(w=>{var S;return((S=w==null?void 0:w.target)==null?void 0:S.structureId)===(c==null?void 0:c.structureId)}),d=0;if(u!=null&&u.length)for(let w of u){let S=(y=ui({structureId:w.source.structureId,drawDefinition:i}))==null?void 0:y.structure;if((S==null?void 0:S.stage)===Zt){let D=w.source.roundNumber,E=w.target.roundNumber,C=0;if(S.structureType===As){let P=((b=S.structures)==null?void 0:b.length)??0,R=((I=w.source.finishingPositions)==null?void 0:I.length)??0;C=P*R}else C=((T=wn({matchUpFilters:{roundNumbers:[D]},structure:S,afterRecoveryTimes:!1,provisionalPositioning:e,inContext:!1}).matchUps)==null?void 0:T.length)||0;l[E]||(l[E]=0),l[E]+=C,d+=C}}let p=Object.keys(l);if(p.length<=1){let w=p[0]||1;l[w]=Math.max(l[w]||0,s)}return d=Math.max(d,s),{qualifiersCount:d,roundQualifiersCounts:l}}function MA({stage:t,drawDefinition:e}){var n;let{entryProfile:i}=bC({drawDefinition:e});return((n=i==null?void 0:i[t])==null?void 0:n.drawSize)||0}function wNe(t){let{provisionalPositioning:e,drawDefinition:i,stageSequence:n,stage:r}=t,a=MA({stage:r,drawDefinition:i}),{qualifiersCount:o}=$T({provisionalPositioning:e,drawDefinition:i,stageSequence:n,stage:r});return a&&a-o}function noe({stage:t,drawDefinition:e}){return!!(t===Ja||rq({stage:t,drawDefinition:e})&&MA({stage:t,drawDefinition:e}))}function roe({entryStatus:t=Rl,drawDefinition:e,stageSequence:i,stage:n}){if(t===yu)return pMe({stage:n,drawDefinition:e})?{positionsAvailable:1/0,...ce}:{error:Fne};let r=wNe({drawDefinition:e,stageSequence:i,stage:n}),a=hMe({drawDefinition:e,stage:n}),o=z2({entryStatus:pS,drawDefinition:e,stage:n}),s=z2({entryStatus:Rl,drawDefinition:e,stage:n}),l=o+s,c=l>=r,u=r-l;return n!==Ja&&c?{error:L2}:t===pS?o<a?{...ce}:{error:L2}:{positionsAvailable:u,...ce}}function aoe(t){let e=di(t,[{[_s]:!0,[kre]:!0}]);if(e.error)return e;let{suppressDuplicateEntries:i=!0,entryStatus:n=Rl,entryStageSequence:r,entryStage:a=xt,ignoreStageSpace:o,drawDefinition:s,entryPosition:l,participant:c,roundTarget:u,extensions:d,extension:p,drawType:h,event:f}=t,m="addDrawEntry";if(h!==Fc&&!noe({stage:a,drawDefinition:s}))return pe({result:{error:vy},stack:m});let g=roe({stageSequence:r,stage:a,drawDefinition:s,entryStatus:n});if(!o&&!g.success&&(!h||h!==Fc))return{error:g.error};if(p&&!dp({extension:p}))return pe({result:{error:Re},info:"Invalid extension",context:{extension:p},stack:m});let v=t.participantId||(c==null?void 0:c.participantId);if(!v)return pe({result:{error:ya},stack:m});let y=n===Rf&&Ub({participantId:v,drawDefinition:s,entryStatus:n}),b=a===Ja&&Ub({participantId:v,drawDefinition:s,entryStage:a}),I=Ub({participantId:v,drawDefinition:s}),T=n!==Rf&&a!==Ja&&I;if(T)return i?(wi({payload:{drawId:s.drawId,eventId:f==null?void 0:f.eventId,error:bD,participantId:v},topic:Bz}),{...ce}):pe({result:{error:bD},context:{participantId:v},stack:m});if(y||b)return pe({context:{invalidEntry:T,invalidLuckyLoser:y,invalidVoluntaryConsolation:b},result:{error:$k},stack:m});let w=zt({entryStageSequence:r,participantId:v,entryPosition:l,entryStatus:n,entryStage:a,extensions:d});return p&&cn({element:w,extension:p}),u&&cn({extension:{name:"roundEntry",value:u},element:w}),s.entries||(s.entries=[]),s.entries.push(w),qn({drawDefinition:s}),{...ce}}function SNe(t){let e="addDrawEntries",{suppressDuplicateEntries:i=!0,entryStatus:n=Rl,autoEntryPositions:r=!0,ignoreStageSpace:a,participantIds:o,drawDefinition:s,stageSequence:l,stage:c=xt,roundTarget:u,extension:d,event:p}=t;if(!c)return{error:gne};if(!s)return{error:Vt};if(!Array.isArray(o))return{error:Ul};if(!noe({stage:c,drawDefinition:s}))return{error:vy};if(d&&!dp({extension:d}))return pe({result:{error:Re},info:"Invalid extension",context:{extension:d},stack:e});let h=roe({drawDefinition:s,stageSequence:l,entryStatus:n,stage:c});if(!a&&!h.success)return{error:h.error};let f=h.positionsAvailable??0;if(!a&&c!==Ja&&f<o.length)return{error:jH};let m=[],g=s.drawId,v=p==null?void 0:p.eventId,y=o.reduce((b,I)=>{let T=n===Rf&&Ub({participantId:I,drawDefinition:s,entryStatus:n}),w=c===Ja&&Ub({entryStage:c,drawDefinition:s,participantId:I}),S=Ub({participantId:I,drawDefinition:s});return n!==Rf&&c!==Ja&&S&&(m.push(I),i&&wi({payload:{error:bD,participantId:I,eventId:v,drawId:g},topic:Bz})),T||w?b.concat(I):b},[]);return m.length&&i?pe({context:{eventId:v,drawId:g,duplicateEntries:m},result:{error:bD},stack:e}):(o.filter(b=>b&&!y.includes(b)).forEach(b=>{let I={entryStageSequence:l,entryStage:c,participantId:b,entryStatus:n};d&&cn({element:I,extension:d}),u&&cn({extension:{name:Pp,value:u},element:I}),s.entries||(s.entries=[]),s.entries.push(I)}),r&&(s.entries=hd({entries:s.entries})),qn({drawDefinition:s}),y!=null&&y.length||m!=null&&m.length?{info:"some participantIds could not be added",participantIdsNotAdded:y,duplicateEntries:m,...ce}:{...ce})}function gq({suppressDuplicateEntries:t=!0,autoEntryPositions:e=!0,entryStageSequence:i,ignoreStageSpace:n,drawDefinition:r,participantIds:a,entryStatus:o,roundTarget:s,entryStage:l,extension:c,drawId:u,event:d}){if(!(a!=null&&a.length))return{error:Ig};if(!d)return{error:Xl};if(!u)return{error:Pd};let p=(d.entries||[]).map(Gi);if(a.filter(m=>!p.includes(m)).length)return{error:fne};if(r){let m=SNe({stageSequence:i,suppressDuplicateEntries:t,autoEntryPositions:e,stage:l,ignoreStageSpace:n,drawDefinition:r,participantIds:a,entryStatus:o,roundTarget:s,extension:c});if(m.error)return m}let{flightProfile:h}=Zr({event:d}),f=h==null?void 0:h.flights.find(m=>m.drawId===u);return f!=null&&f.drawEntries&&(a.forEach(m=>{let g=o===Rf&&kB({participantId:m,entryStatus:o,flight:f}),v=l===Ja&&kB({participantId:m,entryStage:l,flight:f});!(o!==Rf&&l!==Ja&&kB({flight:f,participantId:m}))&&!g&&!v&&f.drawEntries.push({participantId:m,entryStatus:o,entryStage:l})}),e&&(f.drawEntries=hd({entries:f.drawEntries}))),{...ce}}function kB({participantId:t,entryStatus:e,entryStage:i,flight:n}){var a;let r=(a=n.drawEntries)==null?void 0:a.find(o=>o.participantId===t&&(!e||e===o.entryStatus)&&(!i||i===o.entryStage));return t&&r}function OC({autoEntryPositions:t=!0,participantIds:e=[],entryStatuses:i,stage:n,event:r}){var d,p,h,f;let a="removeEventEntries";if(!(r!=null&&r.eventId))return{error:Qn};if(!Array.isArray(e)||e.some(m=>!$r(m)))return pe({result:{error:vd},stack:a});let o=(r.drawDefinitions??[]).flatMap(m=>Ey({drawDefinition:m}).assignedParticipantIds??[]),s=((i==null?void 0:i.length)&&((d=r.entries)==null?void 0:d.filter(m=>m.entryStatus&&i.includes(m.entryStatus)))||[]).map(Gi).filter(m=>!o.includes(m)),l=(n&&((p=r.entries)==null?void 0:p.filter(m=>m.entryStage&&m.entryStage===n))||[]).map(Gi).filter(m=>!o.includes(m));if(e.length?e=e.filter(m=>(!(i!=null&&i.length)||s.includes(m))&&(!n||l.includes(m))):s.length&&l.length?e=zr(s,l):s.length?e=s:l.length&&(e=l),(e==null?void 0:e.length)&&o.some(m=>e.includes(m)))return pe({result:{error:wT},stack:a});if(!(e!=null&&e.length))return{...ce,participantIdsRemoved:[]};let c=[];r.entries=(r.entries??[]).filter(m=>{let g=!e.includes(m==null?void 0:m.participantId);return g||c.push(m.participantId),g}),t&&(r.entries=hd({entries:r.entries}));let{flightProfile:u}=Zr({event:r});return(h=u==null?void 0:u.flights)==null||h.forEach(m=>{m.drawEntries=(m.drawEntries||[]).filter(g=>!e.includes(g.participantId))}),(f=r.drawDefinitions)==null||f.forEach(m=>{m.entries=(m.entries??[]).filter(g=>!e.includes(g.participantId))}),{...ce,participantIdsRemoved:c}}var ooe={[Qa]:{policyName:"matchUpActionsDefault",enabledStructures:[{stages:[],stageSequences:[],enabledActions:[],disabledActions:[]}],participants:{enforceCategory:!0,enforceGender:!0},processCodes:{substitution:["RANKING.IGNORE","RATING.IGNORE"]},substituteAfterCompleted:!1,substituteWithoutScore:!1}},VT=ooe;function ih(t){var A,_;let{suppressDuplicateEntries:e=!0,entryStatus:i=Rl,autoEntryPositions:n=!0,enforceGender:r=!0,entryStageSequence:a,policyDefinitions:o,entryStage:s=xt,tournamentRecord:l,ignoreStageSpace:c,drawDefinition:u,roundTarget:d,extensions:p,extension:h,drawId:f,event:m}=t,g="addEventEntries";if(!Array.isArray(t.participantIds))return pe({result:{error:Ul},stack:g});let v=Pi(t.participantIds??[]);if(!m)return{error:Qn};if(!(v!=null&&v.length))return pe({result:{error:Ig},stack:g});if(!(m!=null&&m.eventId))return{error:Xl};let y=dn({tournamentRecord:l,event:m}).appliedPolicies??{},b=(o==null?void 0:o[Qa])??(y==null?void 0:y[Qa])??VT[Qa],I=(r??((A=b==null?void 0:b.participants)==null?void 0:A.enforceGender))!==!1,T=[],w=[];if(p&&(!Array.isArray(p)||!p.every(x=>dp({extension:x})))||h&&!dp({extension:h}))return pe({context:zt({extension:h,extensions:p}),result:{error:Re},info:"Invalid extension(s)",stack:g});let S=!!l,D=[],E,C=((_=l==null?void 0:l.participants)==null?void 0:_.filter(x=>{var F,G,H;if(!v.includes(x.participantId))return!1;let O=Gr(or)(m.eventType)&&x.participantType===Hi&&!dv(i),B=m.eventType===zn&&x.participantType===Ti;return O&&(!m.gender||!I||[nl,Id].includes(m.gender)||m.gender===((F=x.person)==null?void 0:F.sex))||B&&!dv(i)||m.eventType===zn&&x.participantType===Hi&&dv(i)?!0:O&&m.gender&&I&&![nl,Id].includes(m.gender)&&m.gender!==((G=x.person)==null?void 0:G.sex)?(D.push({participantId:x.participantId,sex:(H=x.person)==null?void 0:H.sex}),!1):m.eventType===On&&(x.participantType===On||dv(i)&&x.participantType===Hi)}).map(x=>x.participantId))??[],P=v.filter(x=>!S||C.includes(x));m.entries||(m.entries=[]);let R=m.entries.map(x=>{var O;return x.participantId||((O=x.participant)==null?void 0:O.participantId)});if(P.forEach(x=>{var O;if(!R.includes(x)){let B=zt({participantId:x,entryStatus:i,entryStage:s,extensions:p});h&&cn({element:B,extension:h}),d&&cn({extension:{name:Pp,value:d},element:B}),a&&(B.entryStageSequence=a),T.push(B.participantId),(O=m.entries)==null||O.push(B)}}),f&&!dv(s)){let x=gq({participantIds:P,suppressDuplicateEntries:e,autoEntryPositions:n,entryStageSequence:a,ignoreStageSpace:c,drawDefinition:u,entryStatus:i,roundTarget:d,entryStage:s,extension:h,drawId:f,event:m});x.error&&(E=x.error)}if(m.eventType&&[Gm,Lc].includes(m.eventType)){let x=(m.entries||[]).map(G=>G.participantId),O=(m.entries||[]).filter(G=>dv(G.entryStatus)).map(G=>G.participantId),B=((l==null?void 0:l.participants)??[]).filter(G=>x.includes(G.participantId)&&G.participantType&&[Ti,On].includes(G.participantType)).map(G=>G.individualParticipantIds).flat(1/0),F=O.filter(G=>B.includes(G));F.length&&(w.push(...F),OC({participantIds:F,autoEntryPositions:!1,event:m}))}if(P.length!==v.length)return pe({context:{mismatchedGender:D,gender:m.gender},result:{error:Ul},stack:g});n&&(m.entries=hd({entries:m.entries||[]}));let N=T.length,M=w.length;return pe({result:{...ce,addedEntriesCount:N,removedEntriesCount:M},stack:g,info:E})}var soe="ADMINISTRATION",TNe="CAPTAIN",UNe="COACH",Do="COMPETITOR",loe="MEDIA",coe="MEDICAL",vq="OFFICIAL",uoe="OTHER",doe="SECURITY",Mg={ADMINISTRATION:soe,CAPTAIN:TNe,COACH:UNe,COMPETITOR:Do,MEDIA:loe,MEDICAL:coe,OFFICIAL:vq,OTHER:uoe,SECURITY:doe};function yq({addIndividualParticipantsToEvents:t,individualParticipantIds:e,groupingParticipantId:i,tournamentRecord:n,suppressErrors:r}){let a="removeIndividualParticipantIds";if(!n)return pe({result:{error:ut},stack:a});if(!i||!e)return pe({result:{error:Yt},stack:a});let o=(n.participants??[]).find(u=>u.participantId===i);if(!o)return pe({result:{error:Vr},stack:a});if(![On,ac].includes(o.participantType))return pe({result:{participantType:o.participantType,error:yd},stack:a});let s=poe({individualParticipantIds:e,groupingParticipant:o,tournamentRecord:n,suppressErrors:r}),{removed:l,error:c}=s;if(c)return pe({result:s,stack:a});if(t)for(let u of n.events??[]){let d=(u.entries??[]).map(({participantId:p})=>p).filter(Boolean);if(d.includes(i)){let p=l==null?void 0:l.filter(h=>!d.includes(h));ih({participantIds:p,entryStatus:Fu,tournamentRecord:n,event:u})}}return l&&wi({topic:Ro,payload:{tournamentId:n.tournamentId,participants:[o]}}),{...ce,...s}}function poe({individualParticipantIds:t=[],groupingParticipant:e,tournamentRecord:i,suppressErrors:n,mappedMatchUps:r,participants:a}){var p,h;let o=[];if(!e)return{removed:o};let s=[],l=[];a||({participants:a,mappedMatchUps:r}=Nr({withMatchUps:!0,tournamentRecord:i,withEvents:!0}));let c=(h=(p=a==null?void 0:a.find(({participantId:f})=>f===e.participantId))==null?void 0:p.events)==null?void 0:h.map(({eventId:f})=>f),u=(e.individualParticipantIds??[]).filter(f=>{var y;let m=t==null?void 0:t.includes(f),g=m&&((y=a==null?void 0:a.find(b=>b.participantId===f))==null?void 0:y.matchUps.filter(({eventId:b})=>c.includes(b)).map(({matchUpId:b})=>r==null?void 0:r[b]).filter(({winningSide:b,score:I})=>b||Pa({score:I}))),v=m&&!(g!=null&&g.length);if(m&&!v&&l.push(f),v){o.push(f);for(let b of i.events??[])for(let I of b.drawDefinitions??[]){let{extension:T}=Ri({element:I,name:Cf}),w=T==null?void 0:T.value[e.participantId];T&&w&&(T.value[e.participantId]=w.filter(D=>D.participantId!==f),cn({element:I,extension:T}),mC({drawDefinition:I}));let S=ws({drawDefinition:I,inContext:!1}).matchUps??[];for(let D of S){let E=D.sides??[];for(let C of E){let P=C.lineUp??[];P.find(R=>R.participantId===f)&&(C.lineUp=P.filter(R=>R.participantId!==f),en({tournamentId:i==null?void 0:i.tournamentId,drawDefinition:I,matchUp:D}))}}}}else s.push(f);return!v});e.individualParticipantIds=u;let d={groupingParticipantId:e.participantId,cannotRemove:l,notRemoved:s,removed:o};return l.length&&!n&&{...d,cannotRemove:l,error:Bk}||d}function Rx({participantRole:t=Do,individualParticipantIds:e=[],groupingTypes:i=[Nc,ac],tournamentRecord:n}){if(!n)return{error:ut};let r=n.participants??[],{participants:a,mappedMatchUps:o}=Nr({withMatchUps:!0,tournamentRecord:n,withEvents:!0}),s=0;return r.filter(l=>(l.participantRole===t||!l.participantRole)&&l.participantType&&i.includes(l.participantType)).forEach(l=>{let{removed:c}=poe({groupingParticipant:l,individualParticipantIds:e,tournamentRecord:n,mappedMatchUps:o,participants:a});c&&s++}),s?ce:{error:_ne}}function zI(t){var h,f,m;if(!(t!=null&&t.tournamentRecord))return{error:ut};if(!((h=t==null?void 0:t.participantIds)!=null&&h.length))return{error:Ig};let{addIndividualParticipantsToEvents:e,tournamentRecord:i,participantIds:n}=t,r=((f=i.participants)==null?void 0:f.length)||0;if(!r)return{...ce};let a=(m=i.events||[])==null?void 0:m.filter(({eventType:g})=>g===ga).map(g=>{var v;return(v=g==null?void 0:g.drawDefinitions)==null?void 0:v.map(({drawId:y})=>y)}).flat(1/0),o=Nr({participantFilters:{participantIds:n},tournamentRecord:i,withDraws:!0}).participants??[],s=()=>{let g=(oo({matchUpFilters:{drawIds:a,matchUpTypes:[zn]},tournamentRecord:i}).matchUps??[]).map(({sides:v})=>v==null?void 0:v.map(({participantId:y})=>y)).flat().filter(Boolean);return zr(g,n)},l=(a==null?void 0:a.length)&&s(),c=o.filter(g=>{var v;return(v=g.draws)==null?void 0:v.filter(y=>(!(a!=null&&a.length)||!(a!=null&&a.includes(y.drawId)))&&y.positionAssignments).length});if(l!=null&&l.length||c.length)return{error:wT};let u={},d={};for(let g of i.events||[]){let v=OC({participantIds:n,event:g});if(v.error)return v;u[g.eventId]=v.participantIdsRemoved}i.participants=i.participants.filter(g=>{let v=n.includes(g.participantId)||g.participantType===Ti&&g.individualParticipantIds.some(y=>n.includes(y));if(!v&&g.participantType===ga&&g.individualParticipantIds.some(y=>n.includes(y))&&(g.individualParticipantIds=g.individualParticipantIds.filter(y=>!n.includes(y))),v&&e&&[Ti,On].includes(g.participantType))for(let y of g.individualParticipantIds||[])n.includes(y)||(d[g.participantId]||(d[g.participantId]=[]),d[g.participantId].push(y));return!v});let p=r-i.participants.length;if(Rx({individualParticipantIds:n,tournamentRecord:i}),e)for(let g of i.events||[]){let v=u[g.eventId].map(y=>d[y]||[]).flat();ih({participantIds:v,entryStatus:Fu,tournamentRecord:i,event:g})}return p&&wi({payload:{participantIds:n,tournamentId:i.tournamentId},topic:$z}),p?{...ce,participantsRemovedCount:p}:{error:Bk}}function hoe({selected:t=!0,drawDefinition:e,entryStatuses:i,drawId:n,event:r,stage:a}){var l;let o=r.entries??[];if(n){let{flightProfile:c}=Zr({event:r}),u=(l=c==null?void 0:c.flights)==null?void 0:l.find(d=>d.drawId===n);u?o=u.drawEntries:e.entries&&(o=e==null?void 0:e.entries)}let s=o.filter(c=>(!(i!=null&&i.length)||!c.entryStatus||i.includes(c.entryStatus))&&(!a||!c.entryStage||c.entryStage===a)&&(!t||c.entryStatus&&Bu.includes(c.entryStatus)));return{entries:o,stageEntries:s}}function foe({removeGroupParticipant:t,tournamentRecord:e,drawDefinition:i,participantId:n,drawId:r,stage:a,event:o}){var v;let s="destroyGroupEntry";if(!e)return{error:ut};if(!n)return pe({result:{error:ya},stack:s});if(!o)return{error:Qn};if(!o.eventType||![Gm,Lc].includes(o.eventType))return pe({result:{error:ph},stack:s});let l=e.participants??[],c=l.find(y=>y.participantId===n);if(!c)return pe({result:{error:Vr},stack:s});if(!c.participantType||![Ti,Nc].includes(c.participantType)||c.participantType===Nc&&o.eventType!==Lc||c.participantType===Ti&&o.eventType!==Gm)return{error:yd};let u=(o.entries??[]).find(y=>y.participantId===n);if(!u)return{error:Lne};let{stageEntries:d}=hoe({selected:!1,drawDefinition:i,drawId:r,event:o,stage:a}),p=d.map(Gi),h=l.filter(({participantId:y})=>p.includes(y)).map(({individualParticipantIds:y})=>y).flat().filter(Boolean),f=(v=c.individualParticipantIds)==null?void 0:v.filter(y=>Qd(y,h).length===1),m=OC({participantIds:[n],event:o});if(m.error||f!=null&&f.length&&(m=ih({participantIds:f,entryStatus:Fu,entryStage:u.entryStage,tournamentRecord:e,drawDefinition:i,drawId:r,event:o}),m.error))return m;let g;return t&&zI({participantIds:[n],tournamentRecord:e}).success&&(g=!0),{...ce,participantRemoved:g}}function bq({removeGroupParticipant:t,tournamentRecord:e,drawDefinition:i,participantId:n,drawId:r,event:a}){return foe({removeGroupParticipant:t,tournamentRecord:e,drawDefinition:i,participantId:n,drawId:r,event:a})}function moe(t){if(!t.tournamentRecord)return{error:ut};let{participantIds:e,...i}=t,n=0,r=[];for(let a of e){let o=foe({participantId:a,...i});o.success&&(n+=1),o.error&&r.push(o.error)}return n?{destroyedCount:n,...ce}:{error:r}}function BD(t){let{tournamentRecord:e,replaceWithBye:i,drawDefinition:n,destroyPair:r,entryStatus:a,matchUpsMap:o,drawId:s}=t,l="removeDrawPositionAssignment",c=_C(t);if(c.error)return pe({result:c,stack:l});let{participantId:u}=c,{drawPosition:d,event:p,structureId:h}=t,f=dn({tournamentRecord:e,drawDefinition:n,event:p}).appliedPolicies??{};if([yu,yh].includes(a)&&u){let{tournamentRecord:g}=t,{participant:v}=Eg({tournamentRecord:g,participantId:u}),{participantType:y,individualParticipantIds:b}=v??{};if(r&&y===Ti){let I=bq({tournamentRecord:g,drawDefinition:n,participantId:u,event:p});if(I.error)return pe({result:I,stack:l});b&&RA({participantIds:b,tournamentRecord:g,drawDefinition:n,entryStatus:a,drawId:s,event:p})}else RA({participantIds:[u],tournamentRecord:g,drawDefinition:n,entryStatus:a,drawId:s,event:p})}if(i){let g=sc({tournamentRecord:e,drawDefinition:n,drawPosition:d,structureId:h,matchUpsMap:o,event:p});if(g.error)return pe({result:g,stack:l})}let{structure:m}=ui({drawDefinition:n,structureId:h});return Xz({structure:m,drawPositions:[d]}),mx({appliedPolicies:f,drawDefinition:n,positionAction:{name:"removeDrawPositionAssignment",replaceWithBye:i,drawPosition:d,entryStatus:a,structureId:h}}),c}function goe(t){return Object.assign(t,{entryStatus:yh}),BD(t)}function Q2(t){return $r(t)?t.split(" ").map(e=>e.split("").map((i,n)=>n?i.toLowerCase():i.toUpperCase()).join("")).join(" "):t}function Eo(t){return $r(t)?Q2(t.replace(/_/g," ")):""}var Bm=({finishingPosition:t=xI,qualifyingRoundNumber:e,structureAbbreviation:i,seedAssignments:n=[],stageSequence:r=1,structureOrder:a,seedingProfile:o,matchUpFormat:s,structureType:l,structureName:c,matchUpType:u,matchUps:d=[],structureId:p,roundOffset:h,roundLimit:f,stageOrder:m,structures:g,stage:v})=>{let y={structureId:p??Pn(),structureAbbreviation:i,finishingPosition:t,seedAssignments:n,matchUpFormat:s,stageSequence:r,structureName:c};a&&(y.structureOrder=a),l&&(y.structureType=l),o&&(typeof o=="string"?y.seedingProfile=o:typeof o=="object"&&typeof o.positioning=="string"&&(y.seedingProfile=o.positioning)),u&&(y.matchUpType=u),h&&(y.roundOffset=h),m&&(y.stageOrder=m),f&&(y.roundLimit=f),v&&(y.stage=v),e&&(y.qualifyingRoundNumber=e);let b=d.flatMap(({drawPositions:I})=>I).filter(Boolean);return g?y.structures=g:(y.matchUps=d,y.positionAssignments=Pi(b).sort((I,T)=>I-T).map(I=>({drawPosition:I}))),y},Uc=Bm;function Iq({structureName:t=Eo(Ja),structureAbbreviation:e,drawDefinition:i,matchUpType:n,structureId:r}){if(!i)return{error:Vt};let a=Uc({stage:Ja,structureAbbreviation:e,structureName:t,matchUps:[],structureId:r,matchUpType:n});return i.structures||(i.structures=[]),i.structures.push(a),qn({drawDefinition:i,structureIds:[a.structureId]}),{...ce}}function wq({drawPositions:t}){if(!(t!=null&&t.length))return{error:tC};let e=r=>t.filter(a=>a!==r).map(a=>[r,a]),i=[].concat(...(t??[]).map(e)),n=Pi(i.map(Mx)).map(r=>r.split("|").map(a=>+a));return{groupMatchUps:i,uniqueMatchUpGroupings:n}}function Mx(t=[]){return!Array.isArray(t)||!t.length?"":[...t].sort(ma).join("|")}function voe({groupSize:t,drawPositionOffset:e}){if(!t)return[];let i=d=>[...Array(d)].map((p,h)=>h),n=i(2*Math.round(t/2)+1).slice(1),r=i(n.length-1).map(()=>[]),a=n.slice(0,n.length/2),o=n.slice(n.length/2);n.slice(1).forEach((d,p)=>{a.forEach((g,v)=>{r[p].push([a[v],o[v]])});let h=a.shift(),f=a.pop(),m=o.shift();a=[h,m,...a].filter(Boolean),o=[...o,f].filter(Boolean)});let s=a.shift(),l=a.pop(),c=o.shift();a=[s,c,...a].filter(Boolean),o=[...o,l].filter(Boolean);let u=d=>d[0].reduce((p,h)=>p+h);return[...r].reverse().sort((d,p)=>u(d)-u(p)).map(d=>d.filter(p=>p.every(h=>h<=t)).map(p=>{let h=p.map(f=>f+e);return Mx(h)}))}function DNe({rounds:t,hash:e}){return t!=null&&t.length?t==null?void 0:t.reduce((i,n,r)=>n.includes(e)?r+1:i,void 0):{error:Yt}}var ENe={getRoundRobinGroupMatchUps:wq,determineRoundNumber:DNe,drawPositionsHash:Mx,groupRounds:voe};function LC(t){var S;let{groupNameBase:e="Group",playoffAttributes:i,stageSequence:n=1,structureOptions:r,appliedPolicies:a,seedingProfile:o,stage:s=xt,matchUpType:l,roundTarget:c,structureId:u,groupNames:d,drawSize:p,idPrefix:h,isMock:f,uuids:m}=t,g=t.structureName??((S=i==null?void 0:i["0"])==null?void 0:S.name)??Eo(xt),{groupCount:v,groupSize:y}=CNe({structureOptions:r,appliedPolicies:a,drawSize:p}),b=ET,I,T=Et(1,v+1).map(D=>{let E=PNe({groupSize:y,structureOrder:D,matchUpType:l,drawSize:p,idPrefix:h,isMock:f});I=Array.isArray(E)?Math.max(...E.map(({roundNumber:P})=>P??0)):0;let C=(d==null?void 0:d[D-1])??`${e} ${D}`;return Bm({structureId:m==null?void 0:m.pop(),structureType:Jk,finishingPosition:b,structureOrder:D,structureName:C,matchUps:E})}),w=Bm({structureId:u??(m==null?void 0:m.pop()),structureType:As,finishingPosition:b,seedingProfile:o,structureName:g,stageSequence:n,structures:T,stage:s});return c&&cn({extension:{name:Pp,value:c},element:w}),{structures:[w],maxRoundNumber:I,groupCount:v,links:[],groupSize:y,...ce}}function CNe({appliedPolicies:t,structureOptions:e,drawSize:i}){let n=e==null?void 0:e.groupSize,r=(e==null?void 0:e.groupSizeLimit)||8,{validGroupSizes:a}=FC({groupSizeLimit:r,drawSize:i}),o=a&&Math.max(...a);n&&(a!=null&&a.includes(n))||(n&&n>4||!(a!=null&&a.includes(4))?n=o:n=4);let s=Math.ceil(i/n);return{groupSize:n,groupCount:s}}function FC(t){let{groupSizeLimit:e=10,drawSize:i=0}=t??{},n=Et(3,e+1).filter(r=>{let a=Math.ceil(i/r),o=a*r-i,s=Math.ceil(i/a),l=Math.ceil(o/a);return(!o||o<r)&&s===r&&s>=3&&l<2});return{...ce,validGroupSizes:n}}function PNe({structureOrder:t,matchUpType:e,groupSize:i,drawSize:n,idPrefix:r,isMock:a,uuids:o}){let s=(t-1)*i,l=Et(1+s,i+1+s),c=wq({drawPositions:l}).uniqueMatchUpGroupings??[],u=voe({groupSize:i,drawPositionOffset:s});return c.map(p).sort((h,f)=>(h.roundNumber??1/0)-(f.roundNumber??1/0));function d(h){return u.reduce((f,m,g)=>m.includes(h)?g+1:f,void 0)}function p(h){let f=Mx(h),m=d(f),g=[1,n],v=RNe({structureOrder:t,drawPositions:h,roundNumber:m,idPrefix:r,uuids:o}),y={matchUpStatus:m?qr:vn,matchUpType:e,finishingPositionRange:{winner:g,loser:g},drawPositions:h,roundNumber:m,matchUpId:v};return a&&(y.isMock=!0),y}}function RNe({structureOrder:t,drawPositions:e,roundNumber:i,idPrefix:n,uuids:r}){return n?`${n}-${t}-${i}-DP-${e.join("-")}`:(r==null?void 0:r.pop())||Pn()}function Sq(t){let{roundRobinGroupsCount:e,participantsCount:i,cluster:n}=t;if(!yi(i))return{seedBlocks:void 0,...pe({result:{error:Re},context:{participantsCount:i},stack:"getSeedBlocks"})};let r=UT(i);if(e){let h=Math.min(e,r),f=[],m=1;for(Et(0,h).forEach(()=>{f.push([m]),m++});m<r;){let g=Et(m,m+h);m+=h,f.push(g)}return{...ce,seedBlocks:f}}let a=Et(1,r+1),o=[],s=r/2;for(;s>1;){let h=ro(a,s),f=h.length;h.forEach((m,g)=>{let v,y=g<f/2,b=g%2===0,I=m[0],T=m[m.length-1];n&&f>4?f===8?v=y?T:I:v=b?I:T:v=y?I:T,Ts(m,o)||o.push(v)}),s=s/2}let l=a.filter(h=>!o.includes(h));for(;l.length;)l.length%2===0?o.push(l.pop()):o.push(l.shift());let c=Et(0,20).map(h=>Math.pow(2,h));c.unshift(1);let u=c.indexOf(r),d=0,p=[];return Et(0,u).forEach(h=>{p.push(o.slice(d,d+c[h])),d+=c[h]}),{...ce,seedBlocks:p}}function Tq({roundRobinGroupsCount:t,drawSize:e}){let i="getSeedGroups";if(!yi(e))return{seedGroups:void 0,...pe({result:{error:Re},context:{drawSize:e},stack:i})};if(t){if(!yi(t))return{seedGroups:void 0,...pe({context:{roundRobinGroupsCount:t},result:{error:Re},stack:i})};let n=1,r=Math.floor(e/t);return{seedGroups:Et(0,r).map(()=>{let a=Et(n,n+t);return n+=t,a})}}else{let{seedBlocks:n}=Sq({participantsCount:e,roundRobinGroupsCount:t}),r=0;return{seedGroups:(n||[]).map(a=>(a||[]).map(()=>(r+=1,r)))}}}function Uq({roundRobinGroupsCount:t,participantsCount:e}){var r;if(t){let{validGroupSizes:a}=FC({drawSize:e});if(!((r=a==null?void 0:a.map(o=>Math.ceil(e/o)))!=null&&r.includes(t)))return pe({context:{roundRobinGroupsCount:t},result:{error:Re}})}let{seedGroups:i}=Tq({drawSize:e,roundRobinGroupsCount:t}),n=(i==null?void 0:i.map(a=>Math.min(...a)))||[];return{...ce,seedingThresholds:n}}function fS(t){if(!t)return 1/0;if(yi(t))return ri(t);let e=t.split("-")[0];return yi(e)?ri(e):1/0}function MNe({size:t}){let e=[t],i=t;for(;i/2===Math.floor(i/2);)i=i/2,e.push(i);return e.includes(1)||e.push(1),e.sort(ma),e.reverse(),e}function NNe({blockPattern:t,index:e}){let i=0;for(let n of t){if(i===e)return n;let r=0;for(;r<n.length;){if(i===e)return n;i+=1,r++}}}function ANe({positioning:t,size:e}){let i=MNe({size:e}),n=[],r=[],a=p=>p[0],o=p=>p[p.length-1],s=(p,h)=>(t&&[Xk,Lv].includes(t)&&h%2?o(p):a(p))||a(p),l=(p,h)=>{if(p.every(f=>!r.includes(f))){let f=s(p,h);return r.push(f),f}},c=p=>{let h=p.filter(f=>!r.includes(f));if(h.length)return r.push(...h),h},u=(p,h)=>{let f=s(p,h);if(!r.includes(f))return r.push(f),f},d=Et(1,e+1);for(let p of i)if(p===1){let h=ro(d,2),f=h.map(l).filter(Boolean);f.length&&n.push(f);let m=h.flatMap(c).filter(Boolean);m.length&&n.push(m)}else{let h=ro(d,p).map(u).filter(Boolean);h.length&&n.push(h)}return{divisions:i,divisionGroupings:n}}function qI({provisionalPositioning:t,returnAllProxies:e,appliedPolicies:i,seedingProfile:n,drawDefinition:r,allPositions:a,structure:o}){var _;let s=[];if(!o)return{error:gy};let{matchUps:l,roundMatchUps:c}=wn({matchUpFilters:{roundNumbers:[1]},provisionalPositioning:t,structure:o}),{seedAssignments:u}=Vc({provisionalPositioning:t,returnAllProxies:e,drawDefinition:r,structure:o}),{positionAssignments:d}=ja({structure:o}),p=d==null?void 0:d.length,h=(u==null?void 0:u.length)??0,f=[],m=Object.keys(c).map(x=>parseInt(x)).sort((x,O)=>x-O).map(x=>{let O=c[x].map(F=>F.drawPositions).flat(1/0).filter(Boolean),B=O.filter(F=>!f.includes(F));return f=f.concat(...O),B}).filter(x=>x.length).reverse(),g=m.pop()??[],v=g&&Math.min(...g)-1||0;n=n??((_=i==null?void 0:i.seeding)==null?void 0:_.seedingProfile);let y=(g==null?void 0:g.length)||0,b=m.filter(x=>x.filter(O=>O<=h).length),{stage:I,structureType:T,roundLimit:w}=o,S=T===As,D=!S&&(m==null?void 0:m.length),E=!S&&I===Zt&&w,C=b.flat(1/0),P=D?C==null?void 0:C.length:0,R=a?p:h,N=uq({drawDefinition:r,structure:o,matchUps:l}),M=N?0:!D&&R||R&&C.length<R&&R-C.length||0;if(E){let x=o!=null&&o.matchUps?o.matchUps.filter(({roundNumber:B})=>B===o.roundLimit).length:0,O=g.length/x;if(!D){let B=BC(n),F=ro(g,O),G=1,H=Et(0,F[0].length).map(()=>{let $=Et(G,G+F.length);return G+=F.length,$});({validSeedBlocks:s}=yoe({drawPositionBlocks:F,nonRandom:n==null?void 0:n.nonRandom,positioning:B,seedGroups:H}))}}else S?{validSeedBlocks:s}=_Ne({nonRandom:n==null?void 0:n.nonRandom,seedingProfile:n,structure:o}):D?s=b.map(x=>({seedNumbers:x,drawPositions:x})):N&&ro(g,2).map((x,O)=>({drawPositions:[x[0]],seedNumbers:[O+1]})).forEach(x=>s.push(x));if(!S&&!N&&!E){let{blocks:x}=kNe({drawPositionOffset:v,seedNumberOffset:P,seedCountGoal:M,seedingProfile:n,baseDrawSize:y});x.forEach(O=>s.push(O))}let A=s.flatMap(x=>x.drawPositions).reduce((x,O)=>(g==null?void 0:g.includes(O))&&x,!0);return!N&&!D&&!S&&!A?{error:une,validSeedBlocks:[],isContainer:S,isFeedIn:D}:{isLuckyStructure:N,validSeedBlocks:s,isContainer:S,isFeedIn:D}}function _Ne({seedingProfile:t,structure:e,nonRandom:i}){var u;let n=e.structures||[],r=n.length,a=(u=Vn({structure:e}))==null?void 0:u.positionAssignments,o=BC(t),s=(a==null?void 0:a.length)??0,{seedGroups:l}=Tq({roundRobinGroupsCount:r,drawSize:s}),c=n.map(d=>{var p;return(p=Vn({structure:d}).positionAssignments)==null?void 0:p.map(h=>h.drawPosition)});return yoe({drawPositionBlocks:c,positioning:o,seedGroups:l,nonRandom:i})}function yoe({drawPositionBlocks:t,positioning:e,seedGroups:i,nonRandom:n}){let r=[],{divisionGroupings:a}=ANe({size:i.length,positioning:e}),o=[];return i.forEach((s,l)=>{let c=NNe({blockPattern:a,index:l});s.forEach((u,d)=>{let p=l%2?t.length-d-1:d,h=t[p].slice().filter((m,g)=>c.includes(g+1)&&m);e!==Lv?h=n?h:bs(h):l%2&&h.reverse();let f=h.find(m=>!o.includes(m));f&&(o.push(f),r.push({drawPositions:[f],seedNumbers:[u]}))})}),{validSeedBlocks:r}}function kNe(t){let{drawPositionOffset:e=0,roundRobinGroupsCount:i,seedNumberOffset:n=0,seedingProfile:r,seedCountGoal:a,baseDrawSize:o}=t,s=1,l=[],{seedBlocks:c}=Sq({cluster:BC(r)===Xk,participantsCount:o,roundRobinGroupsCount:i});s=0;for(let d of c){if(s+1>a)break;let p=d.map(f=>f+e),h=u(s+1,d.length).map(f=>+f+n);s+=d.length,l.push({drawPositions:p,seedNumbers:h})}return{blocks:l};function u(d,p){return Array.from(new Array(p),(h,f)=>f+d)}}function NA({appliedPolicies:t,drawDefinition:e,seedBlockInfo:i,drawPosition:n,structureId:r,seedNumber:a}){var l,c,u,d,p,h;let{structure:o}=ui({drawDefinition:e,structureId:r});t||(t=dn({drawDefinition:e}).appliedPolicies);let s=i==null?void 0:i.validSeedBlocks;return!s&&o&&(s=(l=qI({appliedPolicies:t,drawDefinition:e,structure:o}))==null?void 0:l.validSeedBlocks),(u=(c=t==null?void 0:t.seeding)==null?void 0:c.validSeedPositions)!=null&&u.ignore?!0:(p=(d=t==null?void 0:t.seeding)==null?void 0:d.validSeedPositions)!=null&&p.strict?(((h=s.find(f=>f.seedNumbers.includes(a)))==null?void 0:h.drawPositions)||[]).includes(n):[].concat(...s.map(f=>f.drawPositions)).includes(n)}function boe(t){var R,N,M;let{provisionalPositioning:e,drawDefinition:i,seedingProfile:n,seedBlockInfo:r,structureId:a,randomize:o}=t,{structure:s}=ui({drawDefinition:i,structureId:a}),{seedAssignments:l}=Vc({returnAllProxies:t.returnAllProxies,provisionalPositioning:e,drawDefinition:i,structure:s}),{positionAssignments:c}=ja({structure:s}),u=(R=c==null?void 0:c.filter(A=>A.participantId??A.bye??A.qualifier))==null?void 0:R.map(A=>A.drawPosition).filter(Boolean),{appliedPolicies:d}=dn({drawDefinition:i}),p=((r==null?void 0:r.validSeedBlocks)||s&&((N=qI({returnAllProxies:t.returnAllProxies,provisionalPositioning:e,appliedPolicies:d,drawDefinition:i,seedingProfile:n,structure:s}))==null?void 0:N.validSeedBlocks)||[]).filter(A=>A.drawPositions.filter(_=>!(u!=null&&u.includes(_))).length)[0],h=l==null?void 0:l.map(A=>A.participantId).filter(Boolean),f=c==null?void 0:c.map(A=>A.participantId).filter(Boolean),m=h==null?void 0:h.filter(A=>f==null?void 0:f.includes(A)),g=h==null?void 0:h.filter(A=>!(f!=null&&f.includes(A))),v=l==null?void 0:l.filter(A=>g==null?void 0:g.includes(A.participantId)),y=l==null?void 0:l.filter(A=>!A.participantId),b=(v!=null&&v.length&&v.length>0?v.length:(y==null?void 0:y.length)??0)&&(p==null?void 0:p.drawPositions.filter(A=>!(u!=null&&u.includes(A))))||[],I=o?bs(b):b,T=[],w=I.map(()=>{var _;let A=(_=P(v,T))==null?void 0:_.participantId;return A&&T.push(A),A}).filter(Boolean),S=l==null?void 0:l.filter(A=>m==null?void 0:m.includes(A.participantId)).map(A=>A.seedNumber),D=((p==null?void 0:p.seedNumbers)||[]).filter(A=>!(S!=null&&S.includes(A))),E=l==null?void 0:l.filter(A=>D.includes(A.seedNumber)).map(A=>A.participantId),C=(M=d==null?void 0:d.seeding)==null?void 0:M.duplicateSeedNumbers;return{nextSeedBlock:p,unplacedSeedParticipantIds:C===void 0||C?w:E,unplacedSeedNumbers:D,unfilledPositions:I,unplacedSeedAssignments:v};function P(A,_){let x=A.filter(F=>!_.includes(F.participantId)),O=Math.min(...x.map(F=>fS(F.seedValue))),B=x.filter(F=>fS(F.seedValue)===O);return bs(B).pop()}}function BC(t){if(typeof t=="string")return t;if(typeof t=="object")return t.positioning}function jT({provisionalPositioning:t,tournamentRecord:e,drawDefinition:i,seedingProfile:n,participantId:r,seedBlockInfo:a,structureId:o,seedNumber:s,seedValue:l,eventId:c,event:u}){var T,w,S;let d="assignSeed",{structure:p}=ui({drawDefinition:i,structureId:o}),{positionAssignments:h}=ja({structure:p}),f=Vc({provisionalPositioning:t,drawDefinition:i,structure:p}).seedAssignments,m=f.map(D=>D.seedNumber),g=Ub({drawDefinition:i,participantId:r});if(r&&!g)return pe({result:{error:vd},context:{participantId:r},stack:d});let v=u?(w=(T=Zr({event:u}).flightProfile)==null?void 0:T.flights)==null?void 0:w.length:0,y=v&&v>1,b=(S=h==null?void 0:h.find(D=>D.participantId===r))==null?void 0:S.drawPosition;if(b&&!NA({drawPosition:b,drawDefinition:i,seedBlockInfo:a,structureId:o,seedNumber:s}))return pe({result:{error:CH},context:{assignedDrawPosition:b},info:"invalid seed position",stack:d});m.includes(s)||f.push({seedNumber:s,seedValue:l});let I;return f.forEach(D=>{D.participantId===r&&D.seedNumber!==s&&(D.participantId=void 0),D.seedNumber===s&&(D.participantId=r,!(n!=null&&n.groupSeedingThreshold)&&!y&&(D.seedValue=l??s),I=!0)}),I?(dae({tournamentId:e==null?void 0:e.tournamentId,drawDefinition:i,structure:p,eventId:c}),{...ce}):pe({result:{error:cne},stack:d})}function Dq({inContextTargetMatchUp:t,drawPositionSideIndex:e,teamParticipantId:i,tournamentRecord:n,drawDefinition:r,matchUp:a,event:o}){var p,h,f,m;let s=(h=(p=t==null?void 0:t.sides)==null?void 0:p[e])==null?void 0:h.sideNumber,l=s&&((f=a.sides)==null?void 0:f.find(g=>g.sideNumber===s)),{extension:c}=Ri({element:r,name:Cf}),u=(c==null?void 0:c.value)||{},d=Ot(u[i],!1,!0);if(l)(m=a==null?void 0:a.sides)==null||m.forEach(g=>{g.sideNumber===s&&(g.lineUp=d)});else{a.sides=[1,2].map(v=>{var y;return{...((y=a.sides)==null?void 0:y.find(b=>b.sideNumber===v))??{},sideNumber:v}});let g=a.sides.find(v=>v.sideNumber===s);g&&(g.lineUp=d)}en({tournamentId:n==null?void 0:n.tournamentId,context:"updateSidLineUp",eventId:o==null?void 0:o.eventId,drawDefinition:r,matchUp:a})}function Ioe(t){let{sourceMatchUp:e}=t,{targetMatchUp:i,structure:n,matchUpsMap:r,drawPosition:a}=t,o=i.roundNumber>1&&i.roundNumber-1,s=zv({structureId:n.structureId,matchUpsMap:r});!e&&a&&(e=s.find(({drawPositions:f,roundNumber:m})=>m===o&&(f==null?void 0:f.includes(a))));let l=e==null?void 0:e.roundPosition,c=l%2?1:-1,u=l+c,d=o&&s.find(({roundNumber:f,roundPosition:m})=>f===o&&m===u),p=d==null?void 0:d.matchUpStatus,h=[ua,Ea].includes(p);return{pairedPreviousMatchUp:d,pairedPreviousMatchUpIsDoubleExit:h}}function xNe({drawPosition:t,drawPositions:e}){let i=!1,n=!!(e!=null&&e.includes(t));return{updatedDrawPositions:n?e||[]:[...e,void 0,void 0].slice(0,2).map(r=>!r&&!n?(n=!0,i=!0,t):r).sort(ma).filter(Boolean),positionAdded:i,positionAssigned:n}}function woe({structureId:t,matchUpsMap:e,matchUp:i}){let n=i==null?void 0:i.roundPosition,r=n%2?1:-1,a=n+r;return{pairedPreviousMatchUp:zv({matchUpsMap:e,structureId:t}).find(({roundNumber:o,roundPosition:s})=>o===(i==null?void 0:i.roundNumber)&&s===a)}}function Soe({inContextDrawMatchUps:t,sourceMatchUpStatus:e,sourceMatchUpId:i,matchUpsMap:n,matchUp:r}){let a=t.find(s=>s.matchUpId===i),{pairedPreviousMatchUp:o}=woe({structureId:a==null?void 0:a.structureId,matchUp:a,matchUpsMap:n});if(a&&o){let s=o==null?void 0:o.matchUpId,l=t.find(u=>u.matchUpId===s),c=(a==null?void 0:a.structureId)===(l==null?void 0:l.structureId)?(a==null?void 0:a.roundPosition)<(l==null?void 0:l.roundPosition)&&1||2:a.structureId===(l==null?void 0:l.structureId)&&2||1;r.matchUpStatusCodes=(r.matchUpStatusCodes??[]).map(u=>{let d=$r(u)||!isNaN(u)?{code:u}:u;return d.sideNumber===c?{...d,previousMatchUpStatus:e}:d})}}function TN({inContextDrawMatchUps:t,drawPosition:e,matchUpId:i}){let n=t.filter(({winnerMatchUpId:r,loserMatchUpId:a})=>a===i||r===i).sort((r,a)=>r.roundPosition-a.roundPosition);return t.find(r=>r.matchUpId===i).feedRound?1:n.reduce((r,a,o)=>{var s;return(s=a.drawPositions)!=null&&s.includes(e)?o+1:r},void 0)}function mS({inContextDrawMatchUps:t,sourceMatchUpStatus:e,tournamentRecord:i,sourceMatchUpId:n,drawDefinition:r,matchUpStatus:a,drawPosition:o,matchUpsMap:s,matchUpId:l,event:c}){var R,N,M,A;let u="assignMatchUpDrawPosition";s||(s=Ao({drawDefinition:r})),t||(t=Ia({inContext:!0,drawDefinition:r,matchUpsMap:s}).matchUps??[]);let d=t.find(_=>_.matchUpId===l),p=d==null?void 0:d.structureId,h=(R=r==null?void 0:r.structures)==null?void 0:R.find(_=>_.structureId===p);if(!h)return{error:wr};let f=(N=s==null?void 0:s.drawMatchUps)==null?void 0:N.find(_=>_.matchUpId===l),m=(f==null?void 0:f.drawPositions)??[],{positionAdded:g,positionAssigned:v,updatedDrawPositions:y}=xNe({drawPosition:o,drawPositions:m}),{positionAssignments:b}=Vn({drawDefinition:r,structure:h}),I=(M=b==null?void 0:b.filter(_=>y.includes(_.drawPosition)))==null?void 0:M.find(({bye:_})=>_),T=(f==null?void 0:f.matchUpStatus)&&[hn,Zi].includes(f.matchUpStatus)&&y.filter(Boolean).length<2;if(a=I&&vn||a||T&&f.matchUpStatus||(f==null?void 0:f.matchUpStatus)&&[ua,Ea].includes(f.matchUpStatus)&&f.matchUpStatus||qr,f&&g){t=Ia({inContext:!0,drawDefinition:r,matchUpsMap:s}).matchUps??[];let _=T&&TN({inContextDrawMatchUps:t,drawPosition:o,matchUpId:l})||void 0;f!=null&&f.matchUpStatusCodes&&Soe({inContextDrawMatchUps:t,sourceMatchUpStatus:e,sourceMatchUpId:n,matchUpsMap:s,matchUp:f}),Object.assign(f,{drawPositions:y,winningSide:_,matchUpStatus:a}),en({tournamentId:i==null?void 0:i.tournamentId,eventId:d==null?void 0:d.eventId,context:u,drawDefinition:r,matchUp:f})}let w=Ds({inContextDrawMatchUps:t,inContextMatchUp:d,drawDefinition:r,matchUpId:l}),{targetMatchUps:{winnerMatchUp:S,loserMatchUp:D,loserTargetDrawPosition:E},targetLinks:{loserTargetLink:C}}=w,P=zv({structureId:h.structureId,matchUpsMap:s});if(v&&I){if(S)if([vn,ua,Ea].includes(a)){let _=mS({matchUpId:S.matchUpId,inContextDrawMatchUps:t,tournamentRecord:i,drawDefinition:r,drawPosition:o,matchUpsMap:s});if(_.error)return _}else{let{structureId:_}=S;_!==h.structureId&&console.log("winnerMatchUp in different structure... participant is in different targetDrawPosition")}}else if(S&&d&&!d.feedRound){let{pairedPreviousMatchUpIsDoubleExit:_}=Ioe({targetMatchUp:f,drawPosition:o,matchUpsMap:s,structure:h});if(_){let x=mS({matchUpId:S.matchUpId,inContextDrawMatchUps:t,tournamentRecord:i,drawDefinition:r,drawPosition:o,matchUpsMap:s});if(x.error)return x}}if((f==null?void 0:f.matchUpType)===Xn){let _=t==null?void 0:t.find(({matchUpId:B})=>B===f.matchUpId),x=((_==null?void 0:_.sides)??[]).reduce((B,F,G)=>F.drawPosition===o?G:B,void 0),O=(A=b==null?void 0:b.find(B=>B.drawPosition===o))==null?void 0:A.participantId;O&&x!==void 0&&Dq({inContextTargetMatchUp:_,drawPositionSideIndex:x,teamParticipantId:O,tournamentRecord:i,drawDefinition:r,matchUp:f})}if((C==null?void 0:C.linkCondition)===fh&&y.filter(Boolean).length===2&&!I&&P.filter(({drawPositions:_,roundNumber:x})=>x===1&&Ts(_,y)).every(({matchUpStatus:_})=>[jr,go].includes(_))&&D){let{structureId:_}=D,x=sc({drawPosition:E,tournamentRecord:i,drawDefinition:r,structureId:_,matchUpsMap:s,event:c});if(x.error)return x}return v?{...ce}:pe({result:{error:Q0},context:{drawPosition:o},stack:u})}function Toe({inContextDrawMatchUps:t,drawDefinition:e,assignments:i,matchUpsMap:n,structure:r}){var u,d,p,h;let a=((p=(d=(u=kT({drawDefinition:e}))==null?void 0:u.containedStructures)==null?void 0:d[r.structureId])==null?void 0:p.map(({structureId:f})=>f))||[];a.push(r==null?void 0:r.structureId);let o=(i==null?void 0:i.map(({drawPosition:f})=>f))||[],s=(t==null?void 0:t.filter(f=>a.includes(f.structureId)&&zr(f.drawPositions??[],o).length))??[],l=s.map(({matchUpId:f})=>f),c=((h=n==null?void 0:n.drawMatchUps)==null?void 0:h.filter(f=>l.includes(f.matchUpId)))??[];return{drawPositions:o,matchUps:c,targetMatchUps:s}}function Eq({lineUp:t}){if(!Array.isArray(t))return;let e={};return Pi(t.flatMap(({collectionAssignments:i})=>i==null?void 0:i.map(({collectionId:n,collectionPosition:r})=>[n,r].join("|"))).filter(Boolean)).forEach(i=>{let[n,r]=i.split("|"),a=parseInt(r),{assignedParticipantIds:o}=CA({collectionPosition:a,collectionId:n,lineUp:t});o.forEach(s=>{e[s]||(e[s]=[]),e[s].push({collectionId:n,collectionPosition:a})})}),Object.keys(e).map(i=>({participantId:i,collectionAssignments:e[i]}))}function Zm(t){return`${t} must be an array`}function Nx({lineUp:t,tieFormat:e}){let i=[];if(!Array.isArray(t))return i.push(Zm("lineUp")),{valid:!1,errors:i,error:Re};let n=t.every(a=>{if(typeof a!="object")return i.push("lineUp entries must be objects"),!1;let{participantId:o,collectionAssignments:s}=a;return o?typeof o!="string"?(i.push("participantIds must be strings"),!1):Array.isArray(s)?s.every(l=>{if(typeof l!="object")return i.push("collectionAssignments must be objects"),!1;let{collectionPosition:c}=l;return typeof c!="number"?(i.push("collectionPosition must be a number"),!1):!0}):(i.push(Zm("collectionAssignments")),!1):(i.push("Missing participantId"),!1)}),r=Pi(t.map(Gi)).length===t.length;return r||i.push("Duplicated participantId(s)"),{valid:n&&r,errors:i,error:i.length?Re:void 0}}function WI({drawDefinition:t,participantId:e,tieFormat:i,lineUp:n}){if(typeof t!="object")return{error:Vt};if(typeof e!="string")return{error:ya};let r=Nx({lineUp:n,tieFormat:i});if(!r.valid)return r;let{extension:a}=Ri({element:t,name:Cf}),o=(a==null?void 0:a.value)||{};return o[e]=Eq({lineUp:n}),cn({element:t,extension:{name:Cf,value:o}}),mC({drawDefinition:t}),{...ce}}function Cq({inContextDrawMatchUps:t,inheritance:e=!0,tournamentRecord:i,drawDefinition:n,matchUpsMap:r,assignments:a,structure:o,event:s}){if(!n)return{error:Vt};let{drawPositions:l,matchUps:c,targetMatchUps:u}=Toe({inContextDrawMatchUps:t,matchUpsMap:r,assignments:a,structure:o});for(let d of u)d.matchUpType===pp&&(d.sides??[]).forEach((p,h)=>{var f;if(p!=null&&p.drawPosition&&(l!=null&&l.includes(p.drawPosition))){let m=c.find(({matchUpId:g})=>g===d.matchUpId);if((f=m==null?void 0:m.sides)!=null&&f[h]){if(delete m.sides[h].lineUp,e===!1){let g=d.tieFormat,v=p.participantId;g&&v&&WI({drawDefinition:n,participantId:v,lineUp:[],tieFormat:g})}en({tournamentId:i==null?void 0:i.tournamentId,context:"resetLineUps",eventId:s==null?void 0:s.eventId,drawDefinition:n,matchUp:m})}}});return{...ce}}function hp({provisionalPositioning:t,inContextDrawMatchUps:e,isQualifierPosition:i,sourceMatchUpStatus:n,tournamentRecord:r,drawDefinition:a,seedingProfile:o,participantId:s,seedBlockInfo:l,drawPosition:c,matchUpsMap:u,structureId:d,event:p}){var D,E,C;let h="assignDrawPosition";if(!s&&!i)return pe({result:{error:ya},stack:h});u=u??Ao({drawDefinition:a}),e||({matchUps:e}=Ia({inContext:!0,drawDefinition:a,matchUpsMap:u}));let f=ui({drawDefinition:a,structureId:d});if(f.error)return pe({result:f,stack:h});let{structure:m}=f;if(!m)return{error:wr};if(sl({structure:m}))return pe({result:{error:al},stack:h});let{seedAssignments:g}=Vc({provisionalPositioning:t,drawDefinition:a,structure:m}),v=(D=g==null?void 0:g.find(P=>P.participantId===s))==null?void 0:D.seedNumber,{appliedPolicies:y}=dn({tournamentRecord:r,drawDefinition:a,structure:m,event:p});if(v&&!NA({seedNumber:v,appliedPolicies:y,drawDefinition:a,seedBlockInfo:l,drawPosition:c,structureId:d}))return pe({result:{error:CH},context:{drawPosition:c},stack:h});let b=ja({structure:m}).positionAssignments||[],I=b==null?void 0:b.find(P=>P.drawPosition===c);if(!I)return pe({result:{error:vT},context:{drawPosition:c},stack:h});if(b!=null&&b.map(Gi).includes(s))return pe({result:{error:wT},context:{drawPosition:c},stack:h});let{containsParticipant:T,containsBye:w}=S(I);if(w){let P=_C({inContextDrawMatchUps:e,tournamentRecord:r,drawDefinition:a,drawPosition:c,structureId:d,matchUpsMap:u,event:p});if(P.error)return pe({result:P,stack:h})}if(T&&I.participantId!==s){let{activeDrawPositions:P}=AC({drawDefinition:a,structureId:d});if(P.includes(c))return pe({result:{error:kk},stack:h});Cq({assignments:[I],inContextDrawMatchUps:e,tournamentRecord:r,drawDefinition:a,matchUpsMap:u,structure:m})}if(I.participantId=s,i&&(I.qualifier=!0),((m==null?void 0:m.stageSequence)||0)>1||m.stage&&[Po,Fr].includes(m.stage)){let P=m.stage===Zt?Zt:xt,R=(((C=(E=a.structures)==null?void 0:E.find(N=>(N==null?void 0:N.stage)===P&&(N==null?void 0:N.stageSequence)===1))==null?void 0:C.seedAssignments)??[]).find(N=>N.participantId===s);if(R!=null&&R.participantId){let{participantId:N,seedNumber:M,seedValue:A}=R;jT({eventId:p==null?void 0:p.eventId,provisionalPositioning:t,tournamentRecord:r,drawDefinition:a,seedingProfile:o,participantId:N,seedNumber:M,seedValue:A,structureId:d,event:p})}}if(m.structureType!==As)ONe({provisionalPositioning:t,inContextDrawMatchUps:e,sourceMatchUpStatus:n,tournamentRecord:r,drawDefinition:a,drawPosition:c,matchUpsMap:u,structure:m,event:p});else{eoe({positionAssignments:b,tournamentRecord:r,drawDefinition:a,matchUpsMap:u,structure:m});let{drawPositions:P,matchUps:R,targetMatchUps:N}=Toe({assignments:[I],inContextDrawMatchUps:e,drawDefinition:a,matchUpsMap:u,structure:m});if(P&&(R==null?void 0:R.length)===1&&R[0].matchUpType===Xn){let M=((N==null?void 0:N[0].sides)??[]).reduce((A,_,x)=>P!=null&&P.includes(_.drawPosition)?x:A,void 0);Dq({inContextTargetMatchUp:N[0],teamParticipantId:s,matchUp:R[0],drawPositionSideIndex:M,tournamentRecord:r,drawDefinition:a})}}return Ym({tournamentId:r==null?void 0:r.tournamentId,drawDefinition:a,structure:m,event:p}),{positionAssignments:b,...ce};function S(P){let R=P.bye,N=P.qualifier,M=P.participantId;return{containsBye:R,containsQualifier:N,containsParticipant:M,filled:R||N||M}}}function ONe({provisionalPositioning:t,inContextDrawMatchUps:e,sourceMatchUpStatus:i,tournamentRecord:n,drawDefinition:r,drawPosition:a,matchUpsMap:o,structure:s,event:l}){let c={isCollectionMatchUp:!1},{matchUps:u}=wn({provisionalPositioning:t,matchUpFilters:c,drawDefinition:r,matchUpsMap:o,structure:s,event:l}),{roundMatchUps:d}=Us({matchUps:u}),{initialRoundNumber:p}=Xb({drawPosition:a,matchUps:u}),h=p&&(d==null?void 0:d[p].find(f=>{var m;return(m=f.drawPositions)==null?void 0:m.includes(a)}));if(h){let f=mS({matchUpId:h.matchUpId,inContextDrawMatchUps:e,sourceMatchUpStatus:i,tournamentRecord:n,drawDefinition:r,drawPosition:a,matchUpsMap:o});if(f.error)return pe({stack:"assignDrawPositionToMatchUps",context:{drawPosition:a},result:f})}return{...ce}}function Pq(t){let{participantIdAttributeName:e="participantId",isQualifierPosition:i,positionActionName:n,tournamentRecord:r,drawDefinition:a,participantId:o,drawPosition:s,structureId:l,event:c}=t,u="positionParticipantAction";if(!a)return{error:Vt};let d=dn({tournamentRecord:r,drawDefinition:a,event:c}).appliedPolicies??{},{inContextDrawMatchUps:p,matchUpsMap:h}=t;h||(h=Ao({drawDefinition:a}),Object.assign(t,{matchUpsMap:h})),p||({matchUps:p}=Ia({inContext:!0,drawDefinition:a,matchUpsMap:h}),Object.assign(t,{inContextDrawMatchUps:p}));let{positionAssignments:f}=Vn({drawDefinition:a,structureId:l}),m=f==null?void 0:f.find(I=>I.drawPosition===s);if(m!=null&&m.participantId){let I=m.participantId,T=hp({inContextDrawMatchUps:p,tournamentRecord:r,drawDefinition:a,participantId:o,drawPosition:s,structureId:l,matchUpsMap:h,event:c});return T.success?b({appliedPolicies:d,removedParticipantId:I}):pe({result:T,stack:u})}let g=_C({inContextDrawMatchUps:p,tournamentRecord:r,drawDefinition:a,drawPosition:s,structureId:l,matchUpsMap:h,event:c});if(g.error)return pe({result:g,stack:u});let v=g.participantId,y=hp({inContextDrawMatchUps:p,isQualifierPosition:i,tournamentRecord:r,drawDefinition:a,participantId:o,drawPosition:s,structureId:l,matchUpsMap:h,event:c});if(!y.success)return pe({result:y,stack:u});return b({appliedPolicies:d,removedParticipantId:v});function b({appliedPolicies:I,removedParticipantId:T}){let{structure:w}=ui({drawDefinition:a,structureId:l});Xz({drawPositions:[s],structure:w});let S={[e]:o,name:n,drawPosition:s,structureId:l};return mx({appliedPolicies:I,drawDefinition:a,positionAction:S}),pe({context:{removedParticipantId:T},result:{...ce},stack:u})}}function LNe({luckyLoserParticipantId:t,tournamentRecord:e,drawDefinition:i,drawPosition:n,structureId:r}){return Pq({positionActionName:"luckyLoserDrawPositionAssignment",participantId:t,tournamentRecord:e,drawDefinition:i,drawPosition:n,structureId:r})}function Uoe(t){return LNe(t)}function FNe({alternateParticipantId:t,tournamentRecord:e,drawDefinition:i,drawPosition:n,structureId:r}){return Pq({positionActionName:"alternateDrawPositionAssignment",participantIdAttributeName:"alternateParticipantid",participantId:t,tournamentRecord:e,drawDefinition:i,drawPosition:n,structureId:r})}function Doe(t){return FNe(t)}function Eoe({params:t,modMap:e,structure:i}){let{tournamentRecord:n,drawDefinition:r,event:a}=t;for(let o of i.matchUps)e[o.matchUpId]&&(o.roundNumber=e[o.matchUpId],en({tournamentId:n==null?void 0:n.tournamentId,eventId:a==null?void 0:a.eventId,drawDefinition:r,matchUp:o}))}function Coe(t,e){let i=[{drawDefinition:!0,structureId:!0}];Array.isArray(e)&&i.push(...e);let n=di(t,i);if(n.error)return n;let r=ui(t);if(r.error)return r;let a=r.structure;if(!sl({structure:a}))return pe({result:{error:my,message:"structure must be adHoc"}});let{roundMatchUps:o=[],roundNumbers:s}=Us({matchUps:a==null?void 0:a.matchUps});return s!=null&&s.length?{valid:!0,structure:a,roundMatchUps:o,roundNumbers:s}:{error:Xf}}function Poe(t){var u;let e=Coe(t,[{targetRoundNumber:!0,roundNumber:!0,[$l]:IRe}]);if(e.error)return e;let{structure:i,roundMatchUps:n,roundNumbers:r}=e,{targetRoundNumber:a,roundNumber:o}=t;if(!(r!=null&&r.includes(o))||!(r!=null&&r.includes(a)))return pe({result:{error:Re},info:"roundNumbers must be valid rounds"});let s=a>o,l=s?Et(o+1,a+1):Et(a,o),c={};return l.forEach(d=>((n==null?void 0:n[d])??[]).forEach(({matchUpId:p})=>{c[p]=d-(s?1:-1)})),(u=n==null?void 0:n[o])==null||u.forEach(({matchUpId:d})=>c[d]=a),Eoe({params:t,modMap:c,structure:i}),{...ce}}function Roe({structurePositionAssignments:t,provisionalPositioning:e,tournamentRecord:i,drawDefinition:n,event:r}){var s;if(!n)return{error:Vt};if(!Array.isArray(t))return{error:Re};let a="setPositionAssignments";for(let l of t){let{structureId:c,positionAssignments:u}=l;if(!u)continue;let d=ui({drawDefinition:n,structureId:c});if(d.error)return d;let p=d.structure;if(!p)return{error:wr};let h=(s=Vn({structure:p}).positionAssignments)==null?void 0:s.map(({drawPosition:v})=>v),f=u==null?void 0:u.map(({drawPosition:v})=>v);if(zr(h,f).length!==(h==null?void 0:h.length))return pe({result:{error:Re},info:"drawPositions do not match",stack:a});let m=Ao({drawDefinition:n}),{matchUps:g}=Ia({inContext:!0,drawDefinition:n,matchUpsMap:m});for(let v of u||[]){let{drawPosition:y,participantId:b,bye:I,qualifier:T}=v;if(I){let w=sc({tournamentRecord:i,drawDefinition:n,drawPosition:y,matchUpsMap:m,structureId:c,structure:p,event:r});if(w!=null&&w.error)return w}else if(T)u.forEach(w=>{w.drawPosition===y&&(w.qualifier=!0,delete w.participantId,delete w.bye)});else if(b){let w=hp({provisionalPositioning:e,inContextDrawMatchUps:g,tournamentRecord:i,drawDefinition:n,participantId:b,drawPosition:y,matchUpsMap:m,structureId:c,event:r});if(w!=null&&w.error)return w}}Ym({tournamentId:i==null?void 0:i.tournamentId,drawDefinition:n,structure:p,event:r})}let o=t.map(({structureId:l})=>l);return qn({tournamentId:i==null?void 0:i.tournamentId,eventId:r==null?void 0:r.eventId,drawDefinition:n,structureIds:o}),{...ce}}function Moe(t){let e=Coe(t,[{roundNumbers:!0,[$l]:gs,[$o]:o=>o.length===2&&o.every(Rr)}]);if(e.error)return e;let{structure:i,roundMatchUps:n,roundNumbers:r}=e;if(!t.roundNumbers.every(o=>r==null?void 0:r.includes(o)))return pe({result:{error:Re,message:"roundNumbers must be valid rounds"}});let a={};return t.roundNumbers.forEach((o,s)=>((n==null?void 0:n[o])??[]).forEach(({matchUpId:l})=>{a[l]=t.roundNumbers[1-s]})),Eoe({params:t,modMap:a,structure:i}),{...ce}}function BNe({qualifyingParticipantId:t,tournamentRecord:e,drawDefinition:i,drawPosition:n,structureId:r}){return Pq({positionActionName:"qualifierDrawPositionAssignment",participantId:t,isQualifierPosition:!0,tournamentRecord:e,drawDefinition:i,drawPosition:n,structureId:r})}function Noe(t){return BNe(t)}function Aoe({validation:t=!0,tournamentRecord:e,drawDefinition:i,participantId:n,structureId:r,seedValue:a,event:o}){if(!i)return{error:Vt};if(!r)return{error:nc};let s=((e==null?void 0:e.participants)??[]).find(p=>p.participantId===n);if(e&&!s)return{error:vd};let{structure:l}=ui({drawDefinition:i,structureId:r});if(!l)return{error:wr};if(!(!t||Rr(a)||a===void 0||a===""||typeof a=="string"&&a.split("-").every(p=>Rr(p)&&ri(p)>0)))return{error:Re};let{seedAssignments:c}=Vc({drawDefinition:i,structure:l}),u=c==null?void 0:c.map(p=>p.seedNumber),d=c==null?void 0:c.find(p=>p.participantId===n);if(d){let p=typeof a=="string"?a.includes("-")&&a.split("-").map(h=>parseInt(h)).join("-")||parseInt(a)>0&&parseInt(a)||"":a&&a>0&&a||"";d.seedValue=p}else{let p={seedNumber:Math.max(0,...u||[])+1,participantId:n};a&&(p.seedValue=a),l.seedAssignments||(l.seedAssignments=[]),l.seedAssignments.push(p)}return dae({tournamentId:e==null?void 0:e.tournamentId,eventId:o==null?void 0:o.eventId,drawDefinition:i,structure:l}),{...ce}}function _oe({drawDefinition:t,structureId:e}){if(!t)return{error:Vt};let{structure:i}=ui({drawDefinition:t,structureId:e}),n=((t==null?void 0:t.links)||[]).filter(r=>{var a;return((a=r.source)==null?void 0:a.structureId)===e}).map(r=>{var a;return(a=r.target)==null?void 0:a.structureId});return{playoffStructures:((t==null?void 0:t.structures)||[]).filter(r=>n.includes(r.structureId)),structure:i}}function Ax({withStageGrouping:t,stageSequences:e,stageSequence:i,roundTarget:n,stages:r,event:a,stage:o}){if(!a)return{error:Qn};let s={},l=[];for(let c of a.drawDefinitions||[]){let{structures:u,stageStructures:d}=Ru({withStageGrouping:t,stageSequences:e,drawDefinition:c,stageSequence:i,roundTarget:n,stages:r,stage:o});if(l.push(...u),d)for(let p of Object.keys(d))s[p]||(s[p]=[]),s[p].push(...d[p])}return{structures:l,stageStructures:s}}function Rq({withStageGrouping:t,tournamentRecord:e,stageSequences:i,stageSequence:n,roundTarget:r,stages:a,stage:o}){if(!e)return{error:ut};let s={},l=[];for(let c of e.events||[]){let{structures:u,stageStructures:d}=Ax({withStageGrouping:t,stageSequences:i,stageSequence:n,roundTarget:r,stages:a,event:c,stage:o});if(u&&l.push(...u),d)for(let p of Object.keys(d))s[p]||(s[p]=[]),s[p].push(...d[p])}return{structures:l,stageStructures:s}}function Xm(t){if(!(t!=null&&t.drawDefinition))return!1;let e=Cx(t),i=e==null?void 0:e.includesTeamMatchUps,{completedMatchUps:n,pendingMatchUps:r,upcomingMatchUps:a}=e||{};return i&&(n=n==null?void 0:n.filter(({matchUpType:o})=>o===Xn),r=r==null?void 0:r.filter(({matchUpType:o})=>o===Xn),a=a==null?void 0:a.filter(({matchUpType:o})=>o===Xn)),!!(n!=null&&n.length&&!(r!=null&&r.length)&&!(a!=null&&a.length))}function Mq(t){var o,s;let{drawDefinition:e,structureId:i}=t;if(!e)return{error:Vt};let{playoffStructures:n}=_oe({drawDefinition:e,structureId:i});if(!(n!=null&&n.length))return!1;let r=((s=(o=e==null?void 0:e.entries)==null?void 0:o.filter(l=>(l==null?void 0:l.entryStatus)&&Bu.includes(l.entryStatus)))==null?void 0:s.length)??0,a=0;return(n||[]).reduce((l,c)=>{var u;return!!((u=Vn({structure:c}).positionAssignments??[])!=null&&u.filter(d=>(d.participantId&&a++,(d==null?void 0:d.bye)??(d==null?void 0:d.participantId))).length&&l)},!!n.length)||a===r}function eV({significantCharacters:t,accessors:e=[],value:i}){let n=[],r=e[0];if(i!=null&&i[r]){let o=e.slice(1);if(Array.isArray(i[r]))i[r].forEach(s=>{let l=eV({accessors:o,significantCharacters:t,value:s});n.push(...l)});else if(i=i[r],o.length){let s=eV({accessors:o,significantCharacters:t,value:i});n.push(...s)}else a({value:i})}function a({value:o}){if(o&&["string","number"].includes(typeof o)){let s=t?o.slice(0,t):o;n.push(s)}}return n}function $Ne({targetParticipantIds:t,policyAttributes:e,idCollections:i,participants:n}){if(!Array.isArray(e))return{error:LH};if(!Array.isArray(n))return{error:rC};let r={};return t.forEach(a=>{let o=n.find(l=>l.participantId===a),{values:s}=koe({policyAttributes:e,idCollections:i,participants:n,participant:o});s&&s.forEach(l=>{r[l]||(r[l]=[]),r[l].includes(a)||r[l].push(a)})}),r}function koe({policyAttributes:t,idCollections:e,participants:i,participant:n}){if(!Array.isArray(t))return{error:LH};if(!n)return{error:NI};let r=[];return t.forEach(a=>{let{directive:o,groupings:s,key:l,significantCharacters:c}=a||{};if(l){let u=l.split(".");r.push(...eV({significantCharacters:c,value:n,accessors:u}))}else if(o){let u=a==null?void 0:a.includeIds,d=((e==null?void 0:e[o])||[]).filter(p=>!u||u.includes(p));d!=null&&d.length&&(i!=null&&i.length)&&d.forEach(p=>{var f;let h=i.find(m=>m.participantId===p);if((f=h==null?void 0:h.individualParticipantIds)!=null&&f.includes(n.participantId)){let m=h==null?void 0:h.participantId;r.push(m)}})}else s&&Object.keys(s).forEach(u=>{s[u].includes(n.participantId)&&r.push(u)})}),{values:Pi(r)}}function KK({candidatePositionAssignments:t,participantsWithGroupings:e,policyAttributes:i,idCollections:n}){let r=Object.assign({},...e.map(a=>({[a.participantId]:a})));return t.map(a=>{let o=r[a.participantId],{values:s}=koe({participants:e,policyAttributes:i,idCollections:n,participant:o});return{...a,values:s}})}function xoe({participantIdGroups:t,positionAssignments:e,groupsToAvoid:i}){return Object.assign({},...e.filter(n=>n==null?void 0:n.participantId).map(n=>{let{drawPosition:r,participantId:a}=n,o=t?t[a]||[]:[],s=!!i.some(l=>o.includes(l));return{[r]:{participantGroups:o,includesGroupsToAvoid:s}}}))}function VNe(t){let{unfilledPositions:e,chunkedDrawPositions:i}=t,n=xoe(t);return i.map(a=>{let o=e.filter(c=>a.includes(c)),s=r(o),l=o.filter(c=>!s.includes(c)).filter(c=>{var d;let u=YK(c);return!((d=n[u])!=null&&d.includesGroupsToAvoid)});return{unassigned:o,unpaired:s,pairedNoConflict:l}});function r(a){return a.filter(s=>!o(s));function o(s){let l=YK(s);return!a.includes(l)}}}function jNe(t){let{unfilledPositions:e,chunkedDrawPositions:i}=t,n=xoe(t);return i.map(r=>{let a=e.filter(l=>r.includes(l)),o=a.length===r.length?a:[],s=r.filter(l=>{var c;return(c=n[l])==null?void 0:c.includesGroupsToAvoid}).length;return{unassigned:a,unpaired:o,pairedNoConflict:s?[]:a,conflictsCount:s}})}function YK(t){return Number(t%2?t+1:t-1)}function GNe({allGroups:t,participantId:e}){return Object.keys(t).filter(i=>t[i].includes(e))}function HNe({selectedParticipantGroups:t,participantIdGroups:e,positionAssignments:i,drawPositionChunks:n,unfilledPositions:r,isRoundRobin:a}){let o=n.map(s=>a?jNe({groupsToAvoid:t,chunkedDrawPositions:s,participantIdGroups:e,positionAssignments:i,unfilledPositions:r}):VNe({groupsToAvoid:t,chunkedDrawPositions:s,participantIdGroups:e,positionAssignments:i,unfilledPositions:r}));if(a){let s=o.map(u=>u.map(d=>d.unassigned).filter(d=>d==null?void 0:d.length)).filter(u=>u==null?void 0:u.length).sort((u,d)=>(d.length||0)-(u.length||0)),l=o.map(u=>u.map(d=>d.unpaired).filter(d=>d==null?void 0:d.length)).filter(u=>u==null?void 0:u.length),c=o.map(u=>u.map(d=>d.pairedNoConflict).filter(d=>d==null?void 0:d.length)).filter(u=>u==null?void 0:u.length).sort((u,d)=>(d.length||0)-(u.length||0));return{unassigned:s,unpaired:l,pairedNoConflict:c}}else{let s=o.map(u=>u.map(d=>d.unassigned).filter(d=>d==null?void 0:d.length)).filter(u=>u==null?void 0:u.length),l=o.map(u=>u.map(d=>d.unpaired).filter(d=>d==null?void 0:d.length)).filter(u=>u==null?void 0:u.length),c=o.map(u=>u.map(d=>d.pairedNoConflict).filter(d=>d==null?void 0:d.length)).filter(u=>u==null?void 0:u.length);return{unassigned:s,unpaired:l,pairedNoConflict:c}}}function Ooe({positionAssignments:t,participantIds:e}){let i=t.map(n=>n.participantId);return e.filter(n=>!i.includes(n))}function zNe({useSpecifiedGroupKey:t=!1,targetParticipantIds:e,largestFirst:i=!0,allGroups:n,groupKey:r}){var c;let a=Object.assign({},...Object.keys(n).map(u=>[u,n[u].filter(d=>e.includes(d))]).filter(u=>u[1].length).map(([u,d])=>({[u]:d}))),o=Object.keys(a).reduce((u,d)=>a[d].length>u?a[d].length:u,0),s=Object.keys(a).filter(u=>a[u].length===o),l=Il(i?s:Object.keys(a));return r=t&&((c=a[r])!=null&&c.length)?r:l,{participantId:r&&a[r]?Il(a[r]):Il(e),groupKey:r}}function qNe({drawPositionGroups:t,positionAssignments:e}){let i=Object.assign({},...e.map(n=>({[n.drawPosition]:n})));return t.map(n=>n.filter(Boolean).map(r=>i[r]).filter(Boolean).filter(r=>!r.participantId&&!r.bye).map(r=>r.drawPosition)).flat().filter(Boolean)}function WNe({candidatePositionAssignments:t,unseededParticipantIds:e,participantIdGroups:i,drawPositionChunks:n,drawPositionGroups:r,pairedPriority:a,allGroups:o,groupKey:s}){let l=r.reduce((D,E)=>E.length>D?E.length:D,0)<=2,c=Ooe({positionAssignments:t,participantIds:e}),u=qNe({positionAssignments:t,drawPositionGroups:r}),{participantId:d,groupKey:p}=zNe({targetParticipantIds:c,useSpecifiedGroupKey:l,allGroups:o,groupKey:s}),h=GNe({participantId:d,allGroups:o}),f=HNe({positionAssignments:t,isRoundRobin:l,selectedParticipantGroups:h,participantIdGroups:i,drawPositionChunks:n,unfilledPositions:u}),{unassigned:m,unpaired:g,pairedNoConflict:v}=f,y=(v==null?void 0:v.length)&&v[0],b=(g==null?void 0:g.length)&&g[0],I=a&&y?y:b,T=a?b:y,w=(I==null?void 0:I.length)&&I||(T==null?void 0:T.length)&&T,S;if(w!=null&&w.length){let D=Sl(w);S=Sl(D)}else{let D=Sl(m[0]);S=Sl(D)}return{newGroupKey:p,selectedParticipantId:d,targetDrawPosition:S}}function AA({isRoundRobin:t,groupedParticipants:e}){let i=[];return t?e.forEach(n=>{let r=n.map(s=>s.drawPosition),a=wq({drawPositions:r}).uniqueMatchUpGroupings??[],o=Object.assign({},...n.map(s=>({[s.drawPosition]:s})));a.forEach(s=>{Ts(o[s[0]].values||[],o[s[1]].values||[])&&(i.push(s),n.conflict=!0)})}):e.forEach(n=>{var r,a;Ts(((r=n[0])==null?void 0:r.values)||[],((a=n[1])==null?void 0:a.values)||[])&&(i.push(n),n.conflict=!0)}),i}function KNe({positionedParticipants:t,potentialDrawPositions:e,drawPositionGroups:i,avoidanceConflicts:n,isRoundRobin:r}){return n.map(a=>{let o=a.map(s=>s.drawPosition);return a.filter(s=>e.includes(s.drawPosition)).map(s=>{let l=e.filter(c=>!(o!=null&&o.includes(c))).filter(c=>{let u=i.find(m=>m.includes(c)).find(m=>m!==c),d=t.find(m=>m.drawPosition===u),p=AA({isRoundRobin:r,groupedParticipants:[[s,d]]}),h=[t.find(m=>m.drawPosition===c),d],f=AA({isRoundRobin:r,groupedParticipants:[h]});return!p.length&&!f.length});if(l.length)return{drawPosition:s.drawPosition,possibleDrawPositions:l}}).filter(Boolean)}).flat(1)}function ZK(t){let{initialPositionAssignments:e,participantsWithGroupings:i,opponentsToPlaceCount:n,unseededByePositions:r,drawPositionGroups:a,policyAttributes:o,idCollections:s,allGroups:l}=t,c=[],u,d=Math.min(...(a||[]).map(b=>b==null?void 0:b.length).filter(Boolean)),p=d>2,h=Ot(e,!1,!0).filter(b=>!b.qualifier),f=e.filter(b=>!b.participantId&&(!b.bye||(r==null?void 0:r.includes(b.drawPosition)))).map(b=>b.drawPosition);Et(0,n).forEach(()=>{let{newGroupKey:b,selectedParticipantId:I,targetDrawPosition:T}=WNe({...t,candidatePositionAssignments:h,allGroups:l,groupKey:u});u=b,h.forEach(w=>{w.drawPosition===T&&(w.participantId=I)})});let m=KK({candidatePositionAssignments:h,participantsWithGroupings:i,policyAttributes:o,idCollections:s}),g=ro(m,d),v=AA({groupedParticipants:g,isRoundRobin:p}),y=0;for(;y<20&&v.length;){let b=KNe({positionedParticipants:m,potentialDrawPositions:f,avoidanceConflicts:v,drawPositionGroups:a,isRoundRobin:p});if(b.length){let I=YNe({candidatePositionAssignments:h,swapOptions:b});I.error&&console.log({result:I}),m=KK({candidatePositionAssignments:h,participantsWithGroupings:i,policyAttributes:o,idCollections:s}),g=ro(m,d),v=AA({groupedParticipants:g,isRoundRobin:p}),y++}else y=20}return h.forEach(b=>{if(b.bye&&b.participantId){let I=A2;c.push(I)}if(b.qualifier&&b.participantId){let I=A2;c.push(I)}}),{positionAssignments:h,conflicts:v.length,groupedParticipants:g,errors:c}}function YNe({candidatePositionAssignments:t,swapOptions:e}){let i=Sl(e);if(!i)return{error:{message:"No swap options"}};let n=i.drawPosition,r=Sl(i.possibleDrawPositions),a=t.find(c=>c.drawPosition===n),o=t.find(c=>c.drawPosition===r)??{},s={participantId:o==null?void 0:o.participantId,qualifier:o==null?void 0:o.qualifier,bye:o==null?void 0:o.bye},l={participantId:a.participantId,qualifier:a.qualifier,bye:a.bye};return Object.assign(a,s),Object.assign(o,l),{...ce}}function ZNe({provisionalPositioning:t,unseededParticipantIds:e,inContextDrawMatchUps:i,unseededByePositions:n,tournamentRecord:r,drawDefinition:a,seedBlockInfo:o,participants:s,matchUpsMap:l,structureId:c,avoidance:u,drawSize:d,event:p}){var G;if(!u)return{error:wne};let{candidatesCount:h=1,policyAttributes:f,targetDivisions:m}=u,{roundsToSeparate:g}=u,v="randomUnseededSeparation",{structure:y}=ui({drawDefinition:a,structureId:c}),{matchUps:b}=wn({provisionalPositioning:t,matchUpsMap:l,structure:y,event:p});if(m&&bd(m)&&!g){let H=BPe(m)||0,$=b.reduce((q,z)=>z.roundNumber>q?z.roundNumber:q,0);g=$<H?1:$-H+1}let{positionAssignments:I}=ja({structure:y}),T=Jz({participantsProfile:{convertExtensions:!0},deepCopy:!1,participants:s}).participantsWithGroupings,w=I==null?void 0:I.filter(H=>!H.participantId),S=I==null?void 0:I.map(H=>H.drawPosition),D=(y==null?void 0:y.structureType)===As,E=D?{structure:y,matchUps:b,allDrawPositions:S,roundsToSeparate:g}:{matchUps:b,allDrawPositions:S,roundsToSeparate:g},{drawPositionGroups:C,drawPositionChunks:P}=D?XNe(E):JNe(E),R={groupParticipants:s.filter(H=>H.participantType===ac).map(H=>H.participantId),teamParticipants:s.filter(H=>H.participantType===On).map(H=>H.participantId),pairParticipants:s.filter(H=>H.participantType===Ti).map(H=>H.participantId)},N=$Ne({targetParticipantIds:e,policyAttributes:f,idCollections:R,participants:s});if(N.error)return pe({result:N,stack:v});let M=Object.assign({},...e.map(H=>{let $=Object.keys(N).filter(q=>(N[q]??[]).includes(H));return{[H]:$}})),A=Ooe({participantIds:e,positionAssignments:I});if(A.length>((w==null?void 0:w.length)||0))return{error:GH};let _,x=A.length,O=Et(0,h).map(()=>ZK({initialPositionAssignments:I,participantsWithGroupings:T,unseededParticipantIds:e,opponentsToPlaceCount:x,pairedPriority:!1,unseededByePositions:n,participantIdGroups:M,drawPositionChunks:P,drawPositionGroups:C,policyAttributes:f,idCollections:R,allGroups:N,drawSize:d}));if(_=O.reduce((H,$)=>!H||($.conflicts||0)<(H.conflicts||0)?$:H,void 0),!_||_.conflicts){let H=Et(0,h).map(()=>ZK({initialPositionAssignments:I,participantsWithGroupings:T,unseededParticipantIds:e,opponentsToPlaceCount:x,pairedPriority:!0,unseededByePositions:n,participantIdGroups:M,drawPositionChunks:P,drawPositionGroups:C,policyAttributes:f,idCollections:R,allGroups:N,drawSize:d}));_=O.concat(...H).filter($=>{var q;return!((q=$.errors)!=null&&q.length)}).reduce(($,q)=>!$||(q.conflicts||0)<($.conflicts||0)?q:$,void 0)}if(!_)return{error:jk};let B=(((G=Vn({structure:y}))==null?void 0:G.positionAssignments)??[]).filter(H=>H.participantId).map(H=>H.participantId),F=_.positionAssignments.filter(H=>!B.includes(H.participantId));for(let H of F)if(H.bye){let $=sc({tournamentRecord:r,drawDefinition:a,seedBlockInfo:o,structureId:c,matchUpsMap:l,event:p,...H});if($.error)return pe({result:$,stack:v})}else if(H.participantId){let $=hp({automaticPlacement:!0,inContextDrawMatchUps:i,tournamentRecord:r,drawDefinition:a,seedBlockInfo:o,structureId:c,matchUpsMap:l,event:p,...H});if($.error)return pe({result:$,stack:v,context:{assignment:H}})}return{...ce}}function XNe(t){let{structure:{structures:e}}=t,i=e.map(n=>n.positionAssignments.map(r=>r.drawPosition));return{drawPositionGroups:i,drawPositionChunks:[i]}}function JNe({allDrawPositions:t,roundsToSeparate:e,matchUps:i}){let n=i.filter(u=>u.roundNumber===1).map(u=>u.drawPositions),r=n.flat().sort(ma),a=Math.max(...r),o=t.filter(u=>u>a),s=r.length,l=Et(s===2?1:2,s).filter(u=>u===ez(u)),c=l.slice(0,e||l.length).reverse().map(u=>ro(r,u));return o.length&&console.log({fedDrawPositions:o}),{drawPositionGroups:n,drawPositionChunks:c}}function QNe({provisionalPositioning:t,inContextDrawMatchUps:e,unseededByePositions:i,multipleStructures:n,tournamentRecord:r,drawDefinition:a,seedBlockInfo:o,participants:s,matchUpsMap:l,structureId:c,structure:u,drawSize:d,event:p}){var E,C;let h="positionUnseededParticipants";u||({structure:u}=ui({drawDefinition:a,structureId:c})),c||({structureId:c}=u);let{positionAssignments:f}=ja({structure:u}),{seedAssignments:m}=Vc({provisionalPositioning:t,drawDefinition:a,structure:u}),g=m==null?void 0:m.map(P=>P.participantId).filter(Boolean),{stage:v,stageSequence:y}=u,b=v===Zt?(C=(E=Ri({element:u,name:Pp}))==null?void 0:E.extension)==null?void 0:C.value:void 0,I=$I({provisionalPositioning:t,drawDefinition:a,stageSequence:y,entryStatuses:Dy,structureId:c,roundTarget:b,stage:v}),T=I.filter(P=>!(g!=null&&g.includes(P.participantId))).map(P=>P.participantId),w=f==null?void 0:f.filter(P=>!P.participantId&&!P.bye&&!P.qualifier).map(P=>P.drawPosition);if(!n&&T.length>((w==null?void 0:w.length)||0))return pe({result:{error:GH},context:{unseededParticipantsCount:T.length,unfilledDrawPositionsCount:w==null?void 0:w.length},stack:h});let{appliedPolicies:S}=dn({tournamentRecord:r,drawDefinition:a,event:p}),D=S==null?void 0:S[AD];if(u.stage===Fr){let P=I.reduce((R,N)=>(R[N.groupingValue]||(R[N.groupingValue]=[]),R[N.groupingValue].push(N.participantId),R),{});Object.keys(P).length&&(D||(D={policyName:"Playoff Avoidance"}),D.policyAttributes||(D.policyAttributes=[]),D.policyAttributes.push({groupings:P}))}return D&&s?ZNe({provisionalPositioning:t,unseededParticipantIds:T,inContextDrawMatchUps:e,unseededByePositions:i,tournamentRecord:r,drawDefinition:a,seedBlockInfo:o,participants:s,matchUpsMap:l,structureId:c,avoidance:D,drawSize:d,entries:I}):eAe({provisionalPositioning:t,unseededParticipantIds:T,inContextDrawMatchUps:e,unfilledDrawPositions:w,multipleStructures:n,tournamentRecord:r,drawDefinition:a,seedBlockInfo:o,structureId:c,matchUpsMap:l,drawSize:d,event:p})}function eAe({provisionalPositioning:t,unseededParticipantIds:e,inContextDrawMatchUps:i,unfilledDrawPositions:n,multipleStructures:r,tournamentRecord:a,drawDefinition:o,seedBlockInfo:s,matchUpsMap:l,structureId:c,drawSize:u,event:d}){let p=u>2?bs(n):n.reverse();for(let h of e){let f=p.pop();if(!r||f){let m=hp({provisionalPositioning:t,inContextDrawMatchUps:i,tournamentRecord:a,drawDefinition:o,seedBlockInfo:s,participantId:h,drawPosition:f,matchUpsMap:l,structureId:c,event:d});if(m!=null&&m.error&&console.log("!!!!!",{result:m}),m==null?void 0:m.error)return pe({result:m,stack:"randomUnseededDistribution"})}}return{...ce}}function tAe(t){let e=t.structure??ui(t).structure,i="positionQualifiers",n=[];if(e.stage===Po)return pe({result:{error:vy},stack:i});let{unplacedRoundQualifierCounts:r,positionAssignments:a,roundDrawPositions:o}=iAe(t);for(let s of Object.keys(r)){let l=a==null?void 0:a.filter(c=>o[s].includes(c.drawPosition)&&!c.participantId&&!c.qualifier&&!c.bye).map(c=>c.drawPosition);if(r[s]>(l||0))return pe({result:{error:$ne},context:{unfilledDrawPositions:l},stack:i});Et(0,r[s]).forEach(()=>{let c=Sl(l);n.push(c),a==null||a.forEach(u=>{u.drawPosition===c&&(u.qualifier=!0,delete u.participantId,delete u.bye)})})}return{...ce,qualifierDrawPositions:n}}function iAe({drawDefinition:t,structure:e,structureId:i}){e||({structure:e}=ui({drawDefinition:t,structureId:i})),i||({structureId:i}=e);let{positionAssignments:n}=ja({structure:e}),{stage:r,stageSequence:a}=e,{qualifiersCount:o,roundQualifiersCounts:s}=$T({drawDefinition:t,stageSequence:a,structureId:i,stage:r}),l=(s?Object.keys(s):[]).map(m=>ri(m)),{matchUps:c}=wn({structure:e}),{roundProfile:u}=Us({matchUps:c}),d=Object.assign({},...l.filter(m=>u==null?void 0:u[m]).map(m=>{var g,v;return{[m]:((v=(g=u==null?void 0:u[m])==null?void 0:g.drawPositions)==null?void 0:v.filter(Boolean))??[]}})),p=n==null?void 0:n.filter(m=>m.qualifier).map(m=>m.drawPosition),h=o-((p==null?void 0:p.length)??0),f=p==null?void 0:p.length;return{unplacedRoundQualifierCounts:Object.assign({},...l.map(m=>{let g=n==null?void 0:n.filter(v=>{var y,b;return v.qualifier&&((b=(y=d[m])==null?void 0:y.drawPositions)==null?void 0:b.includes(v.drawPosition))}).map(v=>v.drawPosition);return{[m]:((s==null?void 0:s[m])??0)-((g==null?void 0:g.length)??0)}})),unplacedQualifiersCount:h,placedQualifiersCount:f,roundQualifiersCounts:s,positionAssignments:n,roundDrawPositions:d,qualifiersCount:o}}function XK({provisionalPositioning:t,inContextDrawMatchUps:e,tournamentRecord:i,appliedPolicies:n,validSeedBlocks:r,drawDefinition:a,seedingProfile:o,seedBlockInfo:s,participants:l,groupsCount:c,structureId:u,matchUpsMap:d,structure:p,event:h}){let f=[],m=[],g=0;if(p||({structure:p}=ui({drawDefinition:a,structureId:u})),u||(u=p==null?void 0:p.structureId),n||(n=dn({drawDefinition:a}).appliedPolicies),!r){let v=p&&qI({provisionalPositioning:t,appliedPolicies:n,drawDefinition:a,seedingProfile:o,structure:p});v!=null&&v.error&&m.push(v.error),r=v==null?void 0:v.validSeedBlocks}return c=c??(r==null?void 0:r.length)??0,Et(0,c).forEach(()=>{if(g<(c||0)){let v=nAe({provisionalPositioning:t,inContextDrawMatchUps:e,tournamentRecord:i,drawDefinition:a,seedingProfile:o,seedBlockInfo:s,participants:l,structureId:u,matchUpsMap:d,event:h});v!=null&&v.success&&(g++,f.push(...v.seedPositions??[])),v.error&&m.push({seedPositionError:v.error})}}),m.length?{error:m}:{...ce,seedPositions:f}}function nAe({provisionalPositioning:t,inContextDrawMatchUps:e,tournamentRecord:i,drawDefinition:n,seedingProfile:r,seedBlockInfo:a,participants:o,structureId:s,matchUpsMap:l,event:c}){let{unplacedSeedParticipantIds:u,unfilledPositions:d}=boe({provisionalPositioning:t,randomize:!0,drawDefinition:n,seedingProfile:r,seedBlockInfo:a,structureId:s,event:c}),{appliedPolicies:p}=dn({drawDefinition:n}),{avoidance:h}=p??{};h&&o&&(u==null?void 0:u.length)>2;let f=[];for(let m of u){let g=d.pop();if(!g)return{error:yT};f.push(g);let v=hp({provisionalPositioning:t,inContextDrawMatchUps:e,tournamentRecord:i,drawDefinition:n,seedingProfile:r,participantId:m,seedBlockInfo:a,drawPosition:g,matchUpsMap:l,structureId:s,event:c});if(!v.success)return v}return{...ce,seedPositions:f}}function rAe({provisionalPositioning:t,drawDefinition:e,structure:i}){let{positionAssignments:n}=ja({structure:i}),{seedAssignments:r}=Vc({provisionalPositioning:t,drawDefinition:e,structure:i}),a=Object.assign({},...(r||[]).filter(o=>o.participantId).map(o=>({[o.participantId]:o})));return n==null?void 0:n.map(o=>a[o.participantId]?{...o,seedNumber:a[o.participantId].seedNumber,seedValue:a[o.participantId].seedValue}:"").filter(Boolean)}function aAe({orderedSortedFirstRoundSeededDrawPositions:t,validSeedBlocks:e,byesToPlace:i}){let n=[];e.forEach(a=>{if(i-n.length>a.drawPositions.length)n.push(...a.drawPositions);else{let o=tV(ro(a.drawPositions,2)),s,l=t[n.length];for(;s=UN(o,l);)n.push(s),l=t[n.length]}});let r=n.map(a=>Array.isArray(a)?bs(a):a).flat(1/0);return cre(i)&&e.map(a=>a.seedNumbers[0]).includes(i)?t:r}function UN(t,e){if(Array.isArray(t)&&t.length!==2)return t.pop();if(!Array.isArray(t[0]))return t.includes(e)?t.indexOf(e)?t.pop():t.shift():Math.round(Math.random())?t.pop():t.shift();let i=t[0].flat(1/0).length,n=t[1].flat(1/0).length;if(i===n){let r=t[0].flat(1/0).includes(e)?t[0]:t[1];return UN(e?r:t[Math.round(Math.random())],e)}return i<n?UN(t[1],e):UN(t[0],e)}function tV(t){let e=Math.floor(t.length/2);return t.length>2?[tV(t.slice(0,e)),tV(t.slice(e))]:t}function oAe({provisionalPositioning:t,relevantMatchUps:e,appliedPolicies:i,drawDefinition:n,seedingProfile:r,seedBlockInfo:a,byesToPlace:o,structure:s}){var I;a||(a=qI({provisionalPositioning:t,appliedPolicies:i,drawDefinition:n,seedingProfile:r,structure:s}));let{isFeedIn:l,isLuckyStructure:c,isContainer:u}=a,{validSeedBlocks:d}=a;(I=i==null?void 0:i.seeding)!=null&&I.containerByesIgnoreSeeding&&(d=[]);let p=rAe({provisionalPositioning:t,drawDefinition:n,structure:s})??[],h=Pi([].concat(...e.map(T=>T.drawPositions))),f=p.filter(T=>h.includes(T.drawPosition)),m=(T,w)=>fS(T.seedValue)-fS(w.seedValue),g=d.reduce((T,w)=>{let S=f.filter(D=>{var E;return(E=w.drawPositions)==null?void 0:E.includes(D.drawPosition)}).sort(m);return T.concat(...S)},[]).map(T=>T.drawPosition),v=aAe({orderedSortedFirstRoundSeededDrawPositions:g,validSeedBlocks:d,byesToPlace:o}),y=JK({orderedSeedDrawPositions:g,relevantMatchUps:e}).slice(0,o),b=JK({orderedSeedDrawPositions:v,relevantMatchUps:e}).slice(0,o);return{strictSeedOrderByePositions:y,blockSeedOrderByePositions:b,isLuckyStructure:c,positionedSeeds:p,isContainer:u,isFeedIn:l}}function JK({orderedSeedDrawPositions:t,relevantMatchUps:e}){let i=e.map(n=>n.drawPositions).map(n=>n==null?void 0:n.sort((r,a)=>r-a)).filter(n=>(n==null?void 0:n[0])+1===(n==null?void 0:n[1]));return t.map(n=>i.find(r=>r==null?void 0:r.includes(n))).filter(Boolean).map(n=>n==null?void 0:n.reduce((r,a)=>t.includes(a)?r:a,void 0)).filter(Boolean)}function sAe({provisionalPositioning:t,seedOrderByePositions:e,isLuckyStructure:i,appliedPolicies:n,drawDefinition:r,seedLimit:a,structure:o,isFeedIn:s}){var A,_;let l=(A=n==null?void 0:n.seeding)==null?void 0:A.seedingProfile,c=o.stage===Zt,{positionAssignments:u}=ja({structure:o}),d=u==null?void 0:u.filter(x=>x.participantId).map(x=>x.drawPosition),p={isCollectionMatchUp:!1},{matchUps:h,roundMatchUps:f}=wn({provisionalPositioning:t,matchUpFilters:p,structure:o}),m=(f==null?void 0:f[1])||[],g=o.structureType===As?h:m,v=Pi([].concat(...g.map(x=>x.drawPositions))),y=Math.min(...v)-1,b=d==null?void 0:d.filter(x=>v.includes(x)),I=x=>{let O=Math.ceil(x.length/2),B=[x.slice(0,O),x.slice(O)],F=B.map(Q=>[].concat(...Q.flat(1/0)).length),G=Math.min(...F.flat(1/0)),H=Math.max(...F.flat(1/0)),$=F.indexOf(H),q=G!==H,z=bs(B),[Z,Y]=!G||q?[B[$],B[1-$]]:[z[0],z[1]];return{greaterHalf:Z,lesserHalf:Y}},T=x=>{let{greaterHalf:O,lesserHalf:B}=I(x),{greaterHalf:F,lesserHalf:G}=I(O),H=bs(F.flat(1/0)).pop(),$=F.flat().filter(q=>q!==H);return{newlyFilteredChunks:[...B,...G,$],drawPosition:H}},w=x=>!e.includes(x),S=x=>!(b!=null&&b.includes(x)),D=x=>{let O=ro(x.sort(ma),Math.ceil(x.length/4)).map(G=>G.filter(S)),B=[].concat(...O.flat(1/0)).length,F=[];for(let G=0;G<B;G++){let{newlyFilteredChunks:H,drawPosition:$}=T(O);F.push($),O=H}return F},{validSeedBlocks:E}=qI({provisionalPositioning:t,allPositions:!0,appliedPolicies:n,drawDefinition:r,structure:o}),C=E==null?void 0:E.map(x=>{var O;return(O=x.drawPositions)==null?void 0:O.map(B=>B+y)}),P;if(s){let x=v.length,{seedBlocks:O}=Sq({cluster:BC(l)===Xk,participantsCount:x});P=O.map(B=>B.map(F=>F+y)).map(D).filter(B=>B.length)}else c?P=C==null?void 0:C.map(x=>x.filter(S)):P=C==null?void 0:C.map(D).filter(x=>x.length);let R=g.map(x=>x.drawPositions).map(x=>x==null?void 0:x.sort((O,B)=>O-B)).filter(x=>(x==null?void 0:x[0])+1===(x==null?void 0:x[1])),N=x=>R.reduce((O,B)=>B.includes(x)?B.reduce((F,G)=>G!==x?G:F,void 0):O,void 0),M=P.map(x=>x.map(N)).flat(1/0).filter(S).filter(w).filter(Boolean);if(c&&!o.structures){let x=a%4,O=M.slice(0,x),B=(_=f[o.roundLimit])==null?void 0:_.length,F=ro(M.slice(x),B).map(bs).flat();M=O.concat(F)}return{unseededByePositions:M}}function lAe({provisionalPositioning:t,drawDefinition:e,matchUpsMap:i,structure:n,event:r}){var C;let a={isCollectionMatchUp:!1},{matchUps:o,roundMatchUps:s}=wn({afterRecoveryTimes:!1,provisionalPositioning:t,drawDefinition:e,matchUpFilters:a,matchUpsMap:i,structure:n,event:r}),l=(s==null?void 0:s[1])||[],c=(n==null?void 0:n.structureType)===As,u=c?o:l,d=c?((C=n==null?void 0:n.structures)==null?void 0:C.length)||0:o.length,{structureId:p,stage:h,stageSequence:f}=n,m=$I({entryStatuses:Bu,provisionalPositioning:t,drawDefinition:e,stageSequence:f,structureId:p,stage:h}),{qualifiersCount:g}=$T({provisionalPositioning:t,drawDefinition:e,stageSequence:f,structureId:p,stage:h}),v=m.length+g,{positionAssignments:y,unassignedPositions:b}=ja({structure:n}),I=b==null?void 0:b.map(P=>P.drawPosition),T=y==null?void 0:y.filter(P=>P.bye).length,w=y==null?void 0:y.filter(P=>P.bye).map(P=>P.drawPosition),S=u.map(P=>P.drawPositions).filter(P=>P==null?void 0:P.reduce((R,N)=>!(w!=null&&w.includes(N))&&R,!0)).flat(1/0).filter(P=>I==null?void 0:I.includes(P)),D=y==null?void 0:y.length,E=D?D-v:0;return E>d&&n.stageSequence===1&&n.stage!==Po&&(E=d),{placedByes:T,byesCount:E,relevantMatchUps:u,placedByePositions:w,roundMatchUps:s,positionsToAvoidDoubleBye:S}}function QK({provisionalPositioning:t,tournamentRecord:e,appliedPolicies:i,drawDefinition:n,seedBlockInfo:r,seedingProfile:a,matchUpsMap:o,structureId:s,structure:l,seedLimit:c,seedsOnly:u,event:d}){var R;l||({structure:l}=ui({drawDefinition:n,structureId:s})),s||(s=l==null?void 0:l.structureId);let p=!((l==null?void 0:l.structures)??(l==null?void 0:l.stage)===Zt),{byesCount:h,placedByes:f,relevantMatchUps:m}=lAe({provisionalPositioning:t,drawDefinition:n,matchUpsMap:o,structure:l,event:d}),g=h-(f||0);if(g<=0)return{...ce};let{strictSeedOrderByePositions:v,blockSeedOrderByePositions:y,isLuckyStructure:b,isFeedIn:I}=oAe({provisionalPositioning:t,relevantMatchUps:m,appliedPolicies:i,drawDefinition:n,seedingProfile:a,seedBlockInfo:r,byesToPlace:g,structure:l}),T=(l==null?void 0:l.structureType)&&[As,Jk].includes(l.structureType)&&((R=i==null?void 0:i.seeding)==null?void 0:R.containerByesIgnoreSeeding),w=p&&(y!=null&&y.length)?y:v,{unseededByePositions:S}=sAe({provisionalPositioning:t,seedOrderByePositions:w,isLuckyStructure:b,appliedPolicies:i,drawDefinition:n,seedLimit:c,structure:l,isFeedIn:I}),D=N=>N%2,E=(N,M)=>(N||[]).every(A=>D(A)?M!==A+1:M!==A-1),C=[].concat(...w);if(!u)for(;S.length;){let N=S.find(M=>E(C,M));N?(C.push(N),S=S.filter(M=>M!==N)):(C.push(...S),S=[])}T&&(C=bs(C),Jl({ignoreSeededByes:T})&&console.log({byePositions:C}));let P=C.slice(0,g);for(let N of P){let M=sc({provisionalPositioning:t,tournamentRecord:e,drawDefinition:n,drawPosition:N,matchUpsMap:o,structureId:s,structure:l,event:d});if(M!=null&&M.error)return M}return{...ce,unseededByePositions:S,byeDrawPositions:P}}function $C(t){var A,_,x,O;let{drawDefinition:e}=t,{applyPositioning:i=!0,provisionalPositioning:n,multipleStructures:r,placeByes:a=!0,tournamentRecord:o,placementGroup:s,seedingProfile:l,structureId:c,seedLimit:u,seedsOnly:d,drawType:p,drawSize:h,event:f}=t,m=[];i||(yre(),e=Ot(e,!1,!0));let g=B=>(i||gN(),pe({result:B,stack:"automatedPositioning"})),v=B=>(i||gN(),B),y=ui({drawDefinition:e,structureId:c});if(y.error)return g(y);let b=y.structure;if(!b)return{error:wr};let I=t.appliedPolicies||((A=dn({drawDefinition:e,structure:b,event:f}))==null?void 0:A.appliedPolicies),{qualifiersCount:T}=$T({stageSequence:b.stageSequence,provisionalPositioning:n,stage:b.stage,drawDefinition:e,structureId:c}),w=Dy;if(!((_=$I({stageSequence:b.stageSequence,provisionalPositioning:n,stage:b.stage,placementGroup:s,drawDefinition:e,entryStatuses:w,structureId:c}))!=null&&_.length)&&!T)return v({...ce});let S=t.matchUpsMap??Ao({drawDefinition:e}),D=t.inContextDrawMatchUps??((x=Ia({inContext:!0,drawDefinition:e,matchUpsMap:S}))==null?void 0:x.matchUps),E=[],C=qI({provisionalPositioning:n,appliedPolicies:I,drawDefinition:e,seedingProfile:l,structure:b});if(C.error)return C;let{validSeedBlocks:P}=C;m.push({validSeedBlocks:P});let R=t.participants||(o?(O=Nr({withIndividualParticipants:!0,convertExtensions:!0,tournamentRecord:o}))==null?void 0:O.participants:[]);if(BC(b.seedingProfile||l)===Lv){let B=a?QK({provisionalPositioning:n,tournamentRecord:o,appliedPolicies:I,drawDefinition:e,seedBlockInfo:C,matchUpsMap:S,structure:b,seedLimit:u,seedsOnly:d,event:f}):void 0;if(B!=null&&B.error)return g(B);E=B.unseededByePositions,m.push({action:"positionByes",unseededByePositions:E});let F=b.seedingProfile?{positioning:b.seedingProfile}:l;if(B=XK({seedingProfile:F,provisionalPositioning:n,inContextDrawMatchUps:D,tournamentRecord:o,appliedPolicies:I,validSeedBlocks:P,drawDefinition:e,seedBlockInfo:C,participants:R,matchUpsMap:S,structure:b,event:f}),B.error)return g(B);m.push({seedPositions:B.seedPositions,action:"positionSeedBlocks"})}else{if(p!==yy){let F=b.seedingProfile?{positioning:b.seedingProfile}:l,G=XK({seedingProfile:F,provisionalPositioning:n,inContextDrawMatchUps:D,tournamentRecord:o,appliedPolicies:I,validSeedBlocks:P,drawDefinition:e,seedBlockInfo:C,participants:R,matchUpsMap:S,structure:b,event:f});if(G.error)return g(G);m.push({action:"positionSeedBlocks",seedPositions:G.seedPositions})}let B=a?QK({provisionalPositioning:n,tournamentRecord:o,appliedPolicies:I,drawDefinition:e,seedBlockInfo:C,matchUpsMap:S,structure:b,seedLimit:u,seedsOnly:d,event:f}):void 0;if(B!=null&&B.error)return g(B);E=B==null?void 0:B.unseededByePositions,m.push({action:"positionByes",byeDrawPositions:B==null?void 0:B.byeDrawPositions,unseededByePositions:E})}let N={};if(!d){let B=tAe({inContextDrawMatchUps:D,tournamentRecord:o,appliedPolicies:I,validSeedBlocks:P,drawDefinition:e,seedBlockInfo:C,participants:R,matchUpsMap:S,structure:b});if(B.error||(B.conflicts&&(N.qualifierConflicts=B.conflicts),m.push({action:"positionQualifiers",qualifierDrawPositions:B.qualifierDrawPositions}),B=QNe({provisionalPositioning:n,inContextDrawMatchUps:D,unseededByePositions:E,multipleStructures:r,tournamentRecord:o,drawDefinition:e,seedBlockInfo:C,participants:R,matchUpsMap:S,structureId:c,structure:b,drawSize:h,event:f}),B.error))return g(B);B.conflicts&&(N.unseededConflicts=B.conflicts),m.push({action:"positionUnseededParticipants"})}let{positionAssignments:M}=Vn({drawDefinition:e,structure:b});return qn({drawDefinition:e,structureIds:[c]}),i||gN(),{positionAssignments:M,conflicts:N,...ce,positioningReport:m}}function VC(t){var h;let{applyPositioning:e=!0,provisionalPositioning:i,tournamentRecord:n,drawDefinition:r,seedingProfile:a,structureId:o,placeByes:s,seedsOnly:l,event:c}=t;if(!c)return{error:Xl};if(!r)return{error:Zl};if(!Xm({drawDefinition:r,structureId:o})&&!i)return{error:EH};let u=(h=_oe({drawDefinition:r,structureId:o}).playoffStructures)==null?void 0:h.sort((f,m)=>UA(f)-UA(m)),d=[],p=[];if(u)for(let f of u){let{structureId:m}=f,g=$C({structureId:m,provisionalPositioning:i,applyPositioning:e,tournamentRecord:n,drawDefinition:r,seedingProfile:a,placeByes:s,seedsOnly:l});if(g.error)return g;g.positionAssignments&&d.push({positionAssignments:g.positionAssignments,structureId:m}),g.positioningReport&&p.push(g.positioningReport)}return{...ce,structurePositionAssignments:d,positioningReports:p}}function Loe({drawDefinition:t,orderMap:e}){return t?((typeof e!="object"||!Object.values(e).every(i=>yi(i)))&&pe({result:{error:Re},context:{orderMap:e}}),t.structures||(t.structures=[]),t.structures.forEach(i=>{let n=e[i.structureId];n&&(i.structureOrder=n)}),t.structures.sort((i,n)=>tS(i.structureOrder)-tS(n.structureOrder)),{...ce}):{error:Vt}}function _x({drawDefinition:t}){var g,v,y,b,I,T,w;let e=t.structures??[],i=t.links??[],n=new Map,r=S=>{let D=n.get(S)||n.set(S,{drawSources:[],drawTargets:[],progeny:[],sources:[],targets:[]})&&n.get(S);if(D&&!(D!=null&&D.stage)){let E=e.find(C=>C.structureId===S);D.stage=E==null?void 0:E.stage}return D},a={},o={},s=i.map(S=>{let D=S.source.structureId,E=S.target.structureId,C=r(D),P=r(E);return[Fv,fu,Qk,Lv].includes(S.target.feedProfile)?(C==null||C.targets.push(E),P==null||P.sources.push(D)):S.target.feedProfile===pu&&(P==null||P.drawSources.push(D),C==null||C.drawTargets.push(E)),o[E]=o[E]||S.target.feedProfile===pu,a[E]=Pi([...a[E]||[],D]).filter(Boolean),[S.source.structureId,S.target.structureId]});for(let S of n.keys()){let D=n.get(S);if(D){let E=D.targets??[];for(;E.length;){let C=E.pop(),P=C&&n[C];(g=P==null?void 0:P.targets)!=null&&g.length?E.push(...P.targets):P&&(D.rootStage=P.stage)}if(D.rootStage||(D.rootStage=D.stage),!((v=D.targets)!=null&&v.length)){let C=D.sources??[];for(;C.length;){let P=C.pop(),R=P&&n[P];if((y=R==null?void 0:R.sources)!=null&&y.length){for(let N of R.sources)(b=D.progeny)!=null&&b.includes(N)||((I=D.progeny)==null||I.push(N));C.push(...R.sources)}}}}}let l=0;for(let S of n.keys()){let D=n.get(S);if(D&&D.rootStage===Zt){let E=[(T=D.drawTargets)==null?void 0:T[0]],C=0;for(;E.length;){C+=1;let P=E.pop(),R=P?n.get(P):void 0;(w=R==null?void 0:R.drawTargets)!=null&&w.length&&E.push(R.drawTargets[0])}D.distanceFromMain=C,C>l&&(l=C)}}let c=s.length;Et(0,Math.ceil(c/2)).forEach(()=>{s=Et(0,c).map(S=>{let D=s[S],E=s.reduce((C,P)=>Ts(D,P)?C.concat(...P):C,[])||[];return Pi(D.concat(...E))})});let u=s[0],d=(S,D)=>zr(S,D).length===S.length,p=s.slice(1).reduce((S,D)=>S&&d(D,u),!0),h=[u].filter(Boolean),f=[u].filter(Boolean);e.forEach(S=>{let{structureId:D,stage:E}=S;h.find(C=>C.includes(D))||(h.push([D]),E!==Ja&&f.push([D]))});let m=p&&f.length===1;return!(i!=null&&i.length)&&e.length===1&&r(e[0].structureId),{structureProfiles:Object.fromEntries(n),allStructuresLinked:m,maxQualifyingDepth:l,sourceStructureIds:a,hasDrawFeedProfile:o,structureGroups:h}}function Foe({drawDefinition:t}){let{maxQualifyingDepth:e,structureProfiles:i}=_x({drawDefinition:t});for(let n of t.structures){let r=i[n.structureId];r.distanceFromMain&&(n.stageSequence=e+1-r.distanceFromMain)}return{...ce}}function Nq(t){let e=di(t,[{[ls]:!0,[_s]:!0}]);if(e.error)return e;let{tournamentRecord:i,drawDefinition:n,structure:r,link:a}=t;return cAe({tournamentId:i.tournamentId,drawDefinition:n,structure:r,link:a})}function cAe(t){var u;let e=di(t,[{[_s]:!0,[nx]:!0},{link:!0,[$l]:vl,[Xie]:NH}]);if(e.error)return e;let{drawDefinition:i,tournamentId:n,structure:r,eventId:a,link:o}=t,s=o.target.structureId,l=ui({drawDefinition:i,structureId:s});if(l.error)return pe({stack:"attachQualifyingStructure",context:{targetStructureId:s},result:l});i.structures||(i.structures=[]),i.links||(i.links=[]),i.structures.push(r),i.links.push(o),Foe({drawDefinition:i});let c=((u=wn({structure:r}))==null?void 0:u.matchUps)||[];return Km({drawDefinition:i,tournamentId:n,matchUps:c,eventId:a}),qn({drawDefinition:i,structureIds:[r.structureId]}),{...ce}}function Boe({drawDefinition:t,structureDetails:e}){if(!Array.isArray(e))return{error:Re};if(!t)return{error:Vt};let i=Object.assign({},...e.map(n=>{if(!Xi(n))return;let{structureId:r,structureName:a}=n||{};if(!(!r||!a))return{[r]:a}}).filter(Boolean));if(!Object.values(i).length)return{error:Yt};for(let n of t.structures||[]){let r=i[n.structureId];if(r&&(n.structureName=r),n.structures)for(let a of n.structures){let o=i[a.structureId];o&&(a.structureName=o)}}return{...ce}}function Aq({drawDefinition:t,timeItem:e}){if(!t)return{error:Zl};if(!e)return{error:WH};let i=e&&Object.keys(e),n=["itemType","itemValue"];if(n.filter(a=>i.includes(a)).length!==n.length)return{error:qH};t.timeItems||(t.timeItems=[]);let r=new Date().toISOString();return Object.assign(e,{createdAt:r}),t.timeItems.push(e),mC({drawDefinition:t}),{...ce}}function $oe(t){var v;let{tournamentRecord:e,drawDefinition:i,structureId:n,event:r}=t,a=di(t,[{drawDefinition:!0,structureId:!0}]);if(a.error)return a;let o=i.structures??[],s=o.find(y=>y.structureId===n);if(!s)return{error:wr};let l=o.find(({stage:y,stageSequence:b})=>y===xt&&b===1),c=n===(l==null?void 0:l.structureId),u=o.filter(({stage:y})=>y===Zt).map(Ml("structureId"));if(c&&!u.length)return{error:Qie};let d=u.includes(n),p=uAe({isQualifyingStructure:d,structure:s,...t});if(p!=null&&p.error)return p;let{structureIdsToRemove:h,relatedStructureIdsMap:f}=pAe({qualifyingStructureIds:u,isQualifyingStructure:d,isMainStageSequence1:c,mainStageSequence1:l,drawDefinition:i,structureId:n}),{removedMatchUpIds:m,removedStructureIds:g}=hAe({relatedStructureIdsMap:f,qualifyingStructureIds:u,isMainStageSequence1:c,mainStageSequence1:l,drawDefinition:i,structureIdsToRemove:h,structureId:n});if(dAe({removedMatchUpIds:m,drawDefinition:i}),c){let y=(v=l.matchUps??[])==null?void 0:v.map(Ml("matchUpId"));m.push(...y),l.positionAssignments=[],l.seedAssignments=[],l.matchUps=[],l.extensions&&(l.extensions=[])}return d&&Foe({drawDefinition:i}),Qf({tournamentId:e==null?void 0:e.tournamentId,matchUpIds:m,action:"removeStructure",eventId:r==null?void 0:r.eventId,drawDefinition:i}),qn({drawDefinition:i,eventId:r==null?void 0:r.eventId}),{...ce,removedMatchUpIds:m,removedStructureIds:g}}function uAe({isQualifyingStructure:t,tournamentRecord:e,drawDefinition:i,structureId:n,structure:r,event:a,force:o}){var l,c,u,d,p,h;let s=[n];if(t){let f=g=>{var v;return(v=i.links)==null?void 0:v.find(y=>y.target.structureId===g)},m=(l=f(n))==null?void 0:l.source.structureId;for(;m;)s.push(m),m=(c=f(m))==null?void 0:c.source.structureId}if((u=Ia({matchUpFilters:{structureIds:s},drawDefinition:i}).matchUps)!=null&&u.some(({score:f})=>Pa({score:f}))){let f=(d=dn({tournamentRecord:e,drawDefinition:i,structure:r,event:a}))==null?void 0:d.appliedPolicies;if(!(o??((h=(p=f==null?void 0:f[Bc])==null?void 0:p.allowDeletionWithScoresPresent)==null?void 0:h.structures)))return{error:zk}}return{...ce}}function dAe({removedMatchUpIds:t,drawDefinition:e}){let{matchUps:i}=Ia({drawDefinition:e});i==null||i.forEach(n=>{n.winnerMatchUpId&&t.includes(n.winnerMatchUpId)&&delete n.winnerMatchUpId,n.loserMatchUpId&&t.includes(n.loserMatchUpId)&&delete n.loserMatchUpId})}function pAe({qualifyingStructureIds:t,isQualifyingStructure:e,isMainStageSequence1:i,mainStageSequence1:n,drawDefinition:r,structureId:a}){let o=(r.structures??[]).map(Ml("structureId")),s=u=>{var d;return((d=r.links)==null?void 0:d.map(p=>p.source.structureId===u&&p.target.structureId!==(n==null?void 0:n.structureId)&&p.target.structureId).filter(Boolean))??[]},l=u=>{var d;return((d=r.links)==null?void 0:d.map(p=>t.includes(p.source.structureId)&&p.target.structureId===u&&p.source.structureId).filter(Boolean))??[]},c=new Map;return o.forEach(u=>c.set(u,e?l(u):s(u))),{structureIdsToRemove:i?c.get(a):[a],relatedStructureIdsMap:c}}function hAe({relatedStructureIdsMap:t,qualifyingStructureIds:e,isMainStageSequence1:i,mainStageSequence1:n,drawDefinition:r,structureIdsToRemove:a,structureId:o}){let s=[],l=[];for(;a!=null&&a.length;){let c=a.pop();l.push(...gAe({idBeingRemoved:c,drawDefinition:r}));let u=mAe({qualifyingStructureIds:e,isMainStageSequence1:i,idBeingRemoved:c,drawDefinition:r,structureId:o});s.push(...u.removedStructureIds);let d=fAe({relatedStructureIdsMap:t,mainStageSequence1:n,idBeingRemoved:c,structureId:o});d!=null&&d.length&&a.push(...d)}return{removedMatchUpIds:l,removedStructureIds:s}}function fAe({idBeingRemoved:t,relatedStructureIdsMap:e,mainStageSequence1:i,structureId:n}){var r;return t&&((r=e.get(t))==null?void 0:r.filter(a=>a!==(i==null?void 0:i.structureId)||n===i.structureId))}function mAe({qualifyingStructureIds:t,isMainStageSequence1:e,idBeingRemoved:i,drawDefinition:n,structureId:r}){var o;let a=[];return n.links=((o=n.links)==null?void 0:o.filter(s=>s.source.structureId!==i&&s.target.structureId!==i))??[],(!e||e&&t.length||i!==r)&&(n.structures=(n.structures??[]).filter(s=>(i&&i===s.structureId&&a.push(i),s.structureId!==i))),{removedStructureIds:a}}function gAe({idBeingRemoved:t,drawDefinition:e}){let{structure:i}=ui({structureId:t,drawDefinition:e}),n=wn({structure:i}).matchUps;return Pz(n)}function _A({stageSequence:t=1,drawDefinition:e,drawSize:i,stage:n}){if(!e)return{error:Vt};if(!rq({drawDefinition:e,stage:n}))return{error:vy};let r=mMe({drawDefinition:e,stage:n}),{qualifiersCount:a}=$T({drawDefinition:e,stageSequence:t,stage:n}),o=r+a;if(i<o)return{error:MH};let{entryProfile:s}=nq({attributes:[{[n]:{drawSize:i}}],drawDefinition:e});return qn({drawDefinition:e}),{...ce,entryProfile:s}}function Voe({qualifiersCount:t=0,drawDefinition:e,stage:i}){return e?rq({drawDefinition:e,stage:i})?i!==xt?{error:MH,info:"qualifiersCount can only be set for main stage"}:(nq({attributes:[{[i]:{qualifiersCount:t}}],drawDefinition:e}),qn({drawDefinition:e}),{...ce}):{error:vy}:{error:Vt}}function vAe({drawDefinition:t,drawSize:e}){if(!t)return{error:Vt};let i=_A({stage:Ja,stageSequence:1,drawDefinition:t,drawSize:e});return i.error?i:(qn({drawDefinition:t}),{...ce})}function joe(t){return vAe(t)}var yAe="qualifierDrawPositionAssignment",bAe="withdrawParticipantAtDrawPosition",IAe="alternateDrawPositionAssignment",wAe="luckyLoserDrawPositionAssignment",eY="removeDrawPositionAssignment",Goe="swapDrawPositionAssignments",SAe="modifyPairAssignment",TAe="adHocPositionSwap",UAe="modifyParticipantOtherName",tY="assignDrawPosition",DAe="removeSeededParticipant",EAe="assignDrawPositionBye",CAe="modifySeedAssignment",Hoe="addPenalty",_q="MODIFY_PAIR",kx="QUALIFIER",kq="ALTERNATE",xq="WITHDRAW",Jb="ASSIGN",iV="REMOVE",Oq="LUCKY",F1="REMOVE_SEED",xx="SWAP",$D="NICKNAME",Db="SEED_VALUE",Qb="PENALTY",kA="BYE",KI={MODIFY_PAIR_ASSIGNMENT:_q,QUALIFYING_PARTICIPANT:kx,ALTERNATE_PARTICIPANT:kq,WITHDRAW_PARTICIPANT:xq,ASSIGN_PARTICIPANT:Jb,LUCKY_PARTICIPANT:Oq,REMOVE_ASSIGNMENT:iV,SWAP_PARTICIPANTS:xx,ADD_NICKNAME:$D,REMOVE_SEED:F1,ADD_PENALTY:Qb,ASSIGN_BYE:kA,SEED_VALUE:Db};function zoe({tournamentRecord:t,drawDefinition:e,drawPositions:i,structureId:n,event:r}){if(!e)return{error:Vt};if(!n)return{error:nc};if((i==null?void 0:i.length)!==2)return{error:Re,drawPositions:i};let a=Ao({drawDefinition:e}),{matchUps:o}=Ia({inContext:!0,drawDefinition:e,matchUpsMap:a}),{structure:s}=ui({drawDefinition:e,structureId:n});if(!s)return{error:wr};let l=dn({tournamentRecord:t,drawDefinition:e,event:r}).appliedPolicies??{},c;if(s.structureType===As?c=MAe({inContextDrawMatchUps:o,tournamentRecord:t,drawDefinition:e,drawPositions:i,matchUpsMap:a,structure:s,event:r}):c=PAe({inContextDrawMatchUps:o,tournamentRecord:t,drawDefinition:e,drawPositions:i,matchUpsMap:a,structure:s,event:r}),c.error)return c;if(Xz({structure:s,drawPositions:i}),mx({appliedPolicies:l,drawDefinition:e,positionAction:{name:Goe,drawPositions:i,structureId:n}}),Ym({tournamentId:t==null?void 0:t.tournamentId,drawDefinition:e,structure:s,event:r}),r.eventType===Lc){let u=wn({matchUpFilters:{matchUpTypes:[pp]},inContext:!0,structure:s}).matchUps.filter(p=>{var h;return(h=p.drawPositions)==null?void 0:h.some(f=>i.includes(f))}),d=wn({matchUpFilters:{matchUpTypes:[pp]},structure:s}).matchUps;u.forEach(p=>{(p.sides||[]).forEach(h=>{var m;let f=h==null?void 0:h.drawPosition;if(i.includes(f)){let g=h.participantId,v=d.find(({matchUpId:b})=>b===p.matchUpId),y=(m=p==null?void 0:p.sides)==null?void 0:m.reduce((b,I,T)=>I.drawPosition===f?T:b,void 0);Dq({inContextTargetMatchUp:p,drawPositionSideIndex:y,teamParticipantId:g,tournamentRecord:t,drawDefinition:e,matchUp:v,event:r})}})})}return qn({drawDefinition:e,structureIds:[n]}),{...ce}}function PAe({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,drawPositions:n,matchUpsMap:r,structure:a,event:o}){let s=a==null?void 0:a.positionAssignments.filter(c=>n==null?void 0:n.includes(c.drawPosition));if(!s)return{error:Re,structure:a,info:"Missing positionAssignments"};if(s.filter(({bye:c})=>c).length===2)return{...ce};if(s.filter(({qualifier:c})=>c).length===2)return{...ce};let l=s.some(({qualifier:c})=>c);return s.some(({bye:c})=>c)&&!l?qoe({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,assignments:s,matchUpsMap:r,structure:a,event:o}):RAe({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,assignments:s,matchUpsMap:r,structure:a,event:o})}function qoe({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,assignments:n,matchUpsMap:r,structure:a,event:o}){let s=n.find(({bye:f})=>f),l=n.find(({participantId:f})=>f),c=s.drawPosition,{participantId:u,drawPosition:d}=l,{structureId:p}=a,h=BD({drawPosition:c,inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,structureId:p,matchUpsMap:r});return h.error||(h=BD({drawPosition:d,inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,structureId:p,matchUpsMap:r}),h.error)||(sc({drawPosition:d,tournamentRecord:e,drawDefinition:i,structureId:p,matchUpsMap:r,event:o}),h=hp({drawPosition:c,inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,structureId:p,participantId:u,matchUpsMap:r,event:o}),h.error)?h:{...ce}}function RAe({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,assignments:n,matchUpsMap:r,structure:a,event:o}){let s=Object.assign({},...n.map((l,c)=>{let{drawPosition:u}=l,d={...n[1-c],drawPosition:u};return{[u]:d}}));return a.positionAssignments=a.positionAssignments.map(l=>s[l.drawPosition]||l),Cq({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,matchUpsMap:r,assignments:n,structure:a,event:o}),{...ce}}function MAe({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,drawPositions:n,matchUpsMap:r,structure:a,event:o}){var c;let s=(c=a.structures)==null?void 0:c.reduce((u,d)=>{let p=d==null?void 0:d.positionAssignments.filter(h=>n==null?void 0:n.includes(h.drawPosition));return p&&u.push(...p),u},[]);if(s.filter(({bye:u})=>u).length===2)return{...ce};if(s.filter(({qualifier:u})=>u).length===2)return{...ce};Cq({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,matchUpsMap:r,assignments:s,structure:a,event:o});let l=s.some(({qualifier:u})=>u);if(s.some(({bye:u})=>u)&&!l)qoe({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,assignments:s,matchUpsMap:r,structure:a,event:o});else{let u=Ot(s,!1,!0);s.forEach((d,p)=>{let h=u[1-p].participantId;d.qualifier=u[1-p].qualifier,d.participantId=h})}return{...ce}}function Woe({tournamentRecord:t,drawDefinition:e,participantId:i,structureId:n}){var o;let r="removeSeededParticipant";if(!t)return{error:ut};if(!e)return{error:Vt};let a=(e.structures??[]).find(s=>s.structureId===n);return a?!a.stage||![xt,Zt].includes(a.stage)||a.stage===xt&&a.stageSequence!==1?pe({result:{error:my},stack:r}):(o=a.seedAssignments)!=null&&o.find(s=>s.participantId===i)?{...ce}:pe({info:"participant not seeded",result:{error:no},context:{participantId:i}}):pe({result:{error:wr},stack:r})}function jC({targetEntryRound:t=1,finishingPositions:e,sourceRoundNumber:i,sourceStructureId:n,targetStructureId:r,linkType:a=Df}){return!n||!r?{error:nc}:{link:zt({linkType:a,source:{roundNumber:i,structureId:n,finishingPositions:e},target:{feedProfile:pu,roundNumber:t,structureId:r}})}}function Lq({roundPosition:t,roundNumber:e,idPrefix:i,uuids:n}){return i?`${i}-${e}-${t}`:(n==null?void 0:n.pop())||Pn()}function xA({includeMatchUpType:t,matchUpType:e,roundNumber:i,matchUps:n,idPrefix:r,isMock:a,uuids:o,nodes:s}){let l=0,c=[],u=1,d=i-1,p=s==null?void 0:s.length;for(;l<(p||0);){let h=s==null?void 0:s[l],f=s==null?void 0:s[l+1];d&&(h.roundNumber=d),f&&d&&(f.roundNumber=d);let m=Lq({roundPosition:u,roundNumber:i,idPrefix:r,uuids:o}),g={roundPosition:u,children:[h,f],matchUpId:m};c.push(g);let v={drawPositions:g.children.map(y=>y==null?void 0:y.drawPosition).filter(Boolean),matchUpStatus:qr,matchUpId:g.matchUpId,roundPosition:u,roundNumber:i};t&&e&&(v.matchUpType=e),a&&(v.isMock=!0),n.push(v),u++,l+=2}return{roundNodes:c,matchUps:n}}function fp({finishingPositionOffset:t,finishingPositionLimit:e,qualifyingRoundNumber:i,qualifyingPositions:n,matchUpType:r,roundLimit:a,idPrefix:o,drawSize:s,isMock:l,uuids:c}){if(isNaN(s)||s<2||n&&s<=n)return{matchUps:[],roundsCount:0};if(n&&(!bd(s)||s%n)){let g=n;for(;g<s;)g=2*g;s=g}let u=n&&!(s%2)&&(!isNaN(n)||i&&!isNaN(i))&&(s/n===Math.round(s/n)||i&&s/i===Math.round(s/i));if(!bd(s)&&!u)return{matchUps:[],roundsCount:0};let d=Et(1,s+1).map(g=>({drawPosition:g})),p,h=[],f=1;for({roundNodes:p,matchUps:h}=xA({matchUpType:r,roundNumber:f,idPrefix:o,matchUps:h,isMock:l,nodes:d,uuids:c}),f++,a=a??i;p.length>1;)n&&p.length===n&&(a=f-1),{roundNodes:p,matchUps:h}=xA({nodes:p,matchUpType:r,roundNumber:f,idPrefix:o,matchUps:h,isMock:l,uuids:c}),f++;let m=f-1;return h=MC({finishingPositionOffset:t,finishingPositionLimit:e,roundsCount:m,roundLimit:a,matchUps:h}),a?h=h.filter(g=>a&&(g.roundNumber??0)<=a):a=f-1,{drawSize:s,matchUps:h,roundsCount:m,roundLimit:a}}function Fq(t){var O,B,F,G,H,$;let e="generateQualifyingStructure";if(!t.drawDefinition)return pe({result:{error:Vt},stack:e});if(t.drawSize&&!yi(t.drawSize)||t.participantsCount&&!yi(t.participantsCount)||t.qualifyingPositions&&!yi(t.qualifyingPositions))return pe({result:{error:Re},stack:e});let i=t.drawSize??QH(t.participantsCount),{qualifyingRoundNumber:n,qualifyingPositions:r,targetStructureId:a,structureOptions:o,appliedPolicies:s,drawDefinition:l,matchUpFormat:c,structureName:u,structureId:d,roundTarget:p,drawType:h,idPrefix:f,isMock:m,uuids:g}=t;if(!t.drawSize)return pe({result:{error:iC},context:{drawSize:i},stack:e});if(r&&r>=t.drawSize)return pe({result:{error:Re},context:{drawSize:i,qualifyingPositions:r},stack:e});let v,y,b,I,T=0,w,S=1,{structureProfiles:D}=_x({drawDefinition:l}),E=D[a];if(!E)return pe({result:{error:wr},context:{targetStructureId:a},stack:e});let C=l.matchUpType,P=p?`${p}-`:"",R=E.stage===Zt,N=((B=(O=s==null?void 0:s[cS])==null?void 0:O.namingConventions)==null?void 0:B.pre)??((G=(F=GMe[cS])==null?void 0:F.namingConventions)==null?void 0:G.pre),M=R&&N?`${N}-`:"",A=u??(P?`${M}${Eo(Zt)} ${P}`:`${M}${Eo(Zt)}`);if(h===Cu){let{maxRoundNumber:q,structures:z,groupCount:Z}=LC({structureName:u??A,structureId:d??(g==null?void 0:g.pop()),stage:Zt,structureOptions:o,appliedPolicies:s,stageSequence:S,matchUpType:C,roundTarget:p,idPrefix:f,drawSize:i,isMock:m,uuids:g});T=Z,v=q,b=z[0],w=[1]}else({drawSize:i,matchUps:I,roundLimit:v,roundsCount:y}=fp({qualifyingRoundNumber:n,qualifyingPositions:r,matchUpType:C,idPrefix:f,drawSize:i,isMock:m,uuids:g})),v||(v=y),b=Uc({structureName:u??A,structureId:d??(g==null?void 0:g.pop()),qualifyingRoundNumber:v,stage:Zt,matchUpFormat:c,stageSequence:S,matchUpType:C,roundLimit:v,matchUps:I}),p&&cn({extension:{name:Pp,value:p},element:b}),T=(H=I==null?void 0:I.filter(q=>q.roundNumber===v))==null?void 0:H.length;let _=h===Cu?Uf:Df,x=b&&v&&(($=jC({sourceStructureId:b.structureId,sourceRoundNumber:v,targetStructureId:a,finishingPositions:w,linkType:_}))==null?void 0:$.link);return{qualifyingDrawPositionsCount:i,qualifiersCount:T,...ce,structure:b,link:x}}function Koe(t){if(!t.tournamentRecord)return{error:ut};let e=NAe(t);return e.error,e}function NAe(t){if(!t.drawDefinition)return{error:Vt};if(!t.targetStructureId)return{error:nc};let e=Fq(t);if(e.error)return e;let{structure:i,link:n}=e;return!i||!n?{error:Re}:Nq({tournamentRecord:t.tournamentRecord,drawDefinition:t.drawDefinition,structure:i,link:n})}function Yoe(t){var d;let e=di(t,[{[_s]:!0,[tx]:!0,[Cp]:!0},{[hRe]:!0,[$o]:p=>Number.isInteger(p)&&p>0},{[$o]:p=>Array.isArray(p)&&p.length===2&&p.every($r),[Ql]:Ul,participantIds:!0}]);if(e.error)return e;let{drawDefinition:i,structureId:n,tournamentRecord:r,event:a}=t,{structure:o}=ui({drawDefinition:i,structureId:n});if(!o)return{error:wr};if(!sl({structure:o}))return{error:my};let s=p=>{var h;return(h=p.sides)==null?void 0:h.map(f=>f.participantId).some(f=>t.participantIds.includes(f))},l=p=>p.roundNumber===t.roundNumber,c=p=>!Pa(p),u=((o==null?void 0:o.matchUps)??[]).filter(l).filter(c).filter(s);if(u.length!==2)return{error:Ul};for(let p of u){let h=(d=p==null?void 0:p.sides)==null?void 0:d.find(f=>t.participantIds.includes(f==null?void 0:f.participantId));if(h){let f=t.participantIds.find(m=>m!==(h==null?void 0:h.participantId));h.participantId=f,en({tournamentId:r==null?void 0:r.tournamentId,eventId:a==null?void 0:a.eventId,drawDefinition:i,matchUp:p})}}return qn({drawDefinition:i,structureIds:[n]}),{...ce}}function AAe({includeMatchUpType:t,drawPosition:e,roundNumber:i,matchUpType:n,idPrefix:r,matchUps:a,isMock:o,uuids:s,nodes:l,fed:c}){let u=l.length,d=e?e-u:void 0,p=Et(0,u).map(m=>d?d+m:void 0),h=[];for(let m=0;m<u;m++){let g=p.shift(),v={drawPosition:g,fed:c+1,feed:!0},y=l[m];y.roundNumber=i-1;let b=Lq({roundPosition:y.roundPosition,roundNumber:i,idPrefix:r,uuids:s}),I={roundPosition:y.roundPosition,drawPositions:[g],matchUpStatus:qr,roundNumber:i,matchUpId:b};t&&(I.matchUpType=n),o&&(I.isMock=!0),a.push(I);let T={children:[y,v]};h.push(T)}let f=e?e-u:void 0;return{roundNodes:h,matchUps:a,drawPosition:f}}function Jm(t){let e=t.drawSize,{feedRoundsProfile:i,feedRounds:n=0,skipRounds:r=0,baseDrawSize:a}=t,{linkFedFinishingRoundNumbers:o,finishingPositionOffset:s,linkFedRoundNumbers:l,feedsFromFinal:c,isConsolation:u,matchUpType:d,idPrefix:p,isMock:h,uuids:f,fmlc:m}=t;a=a??M(e);let g=_Ae({drawSize:a}),v=g.length,y=0;if(i!=null&&i.length)y=i.reduce((A,_)=>A+_,0);else if(e){let A=e-a;i=g.filter(_=>_<=A?(A-=_,!0):!1),y=i.reduce((_,x)=>_+x,0),n=i.length}else r>=v?n=0:c&&(n=v-c,r=0),i=g.filter((A,_)=>c&&!n||n&&_>=r+n||_<r?0:A),y=i.reduce((A,_)=>A+_,0),n=i.length;let b=[...g,...i].sort((A,_)=>_-A),I=b.length,T=[...(l??[]).map(A=>A-1),...(o??[]).map(A=>I-A)].map(A=>b[A]).reduce((A,_)=>A+_,0);y=y-T;let w=0,S=[],D,E=1,C=Et(0,a).map((A,_)=>({drawPosition:_+1+y})),P=y+1;for(let A of g){if({roundNodes:D,matchUps:S}=xA({matchUpType:d,roundNumber:E,idPrefix:p,matchUps:S,isMock:h,nodes:C,uuids:f}),E++,i.includes(A)){let _=Pl(i)[A],x=Et(0,_),O=I+1-E,B=(o==null?void 0:o.includes(O))??(l==null?void 0:l.includes(E));x.forEach(()=>{({roundNodes:D,matchUps:S,drawPosition:P}=AAe({drawPosition:!B&&P||void 0,nodes:D,matchUpType:d,roundNumber:E,idPrefix:p,matchUps:S,isMock:h,uuids:f,fed:w})),E++,w+=1})}C=D}I!==E-1&&console.log("ERROR");let R=a-y;S=MC({finishingPositionOffset:u?R:s,positionsFed:y,roundsCount:I,matchUps:S,fmlc:m});let N=D!=null&&D.length?D[0]:D;return N&&(N.roundNumber=E-1,N.matchUps=S),{draw:N,matchUps:S,roundsCount:I};function M(A){let _=ez(A);return _>A?_/2:_}}function _Ae({drawSize:t}){let e=Math.ceil(Math.log(t)/Math.log(2));return Et(0,e).reverse().map(i=>Math.pow(2,i))}function V0(t){let{finishingPositionOffset:e=0,addNameBaseToAttributeName:i,playoffStructureNameBase:n,finishingPositionNaming:r,finishingPositionLimit:a,playoffAttributes:o,stageSequence:s=1,exitProfile:l="0",exitProfileLimit:c,roundOffsetLimit:u,roundOffset:d=0,drawDefinition:p,staggeredEntry:h,sequenceLimit:f,stage:m=xt,drawSize:g,idPrefix:v,isMock:y,uuids:b}=t;if(!(!o||!c||o!=null&&o[l])||g<2||f&&s>f)return{};let I=[],T=[],w=[],S=t.matchUpType??(p==null?void 0:p.matchUpType),D=e+1,E=e+g,C=`${D}-${E}`,P=o==null?void 0:o[l],R=n&&`${n} `||"",N=(o==null?void 0:o[C])??(r==null?void 0:r[C]),M=t.structureName||(N==null?void 0:N.name)||(P==null?void 0:P.name)&&(i?`${R}${P==null?void 0:P.name}`:P.name)||`${R}${C}`,A=(N==null?void 0:N.abbreviation)??(P==null?void 0:P.abbreviation),_=t.structureId??(P==null?void 0:P.structureId)??(b==null?void 0:b.pop()),x={idPrefix:v&&`${v}-${M}-RP`,finishingPositionOffset:e,matchUpType:S,drawSize:g,isMock:y,uuids:b},{matchUps:O}=h?Jm(x):fp(x),B=Uc({structureAbbreviation:A,stageSequence:s,structureName:M,matchUpType:S,roundOffset:d,structureId:_,matchUps:O,stage:m});I.push(...O),T.push(B);let F=Math.ceil(Math.log(g)/Math.log(2)),G=u?Math.min(u-d,F):!a||D<a?F:0;return g>2&&Et(1,G+1).forEach($=>H($)),{structureId:B.structureId,matchUps:I,structureName:M,structures:T,links:w,...ce};function H($){let q=g/Math.pow(2,$);if(q<2)return;let z=g/Math.pow(2,$)+e;if(a&&z+1>a)return;let{structures:Z,structureId:Y,matchUps:Q,links:X}=V0({finishingPositionOffset:z,exitProfile:`${l}-${$}`,roundOffset:d+$,stageSequence:s+1,drawSize:q,addNameBaseToAttributeName:i,playoffStructureNameBase:n,finishingPositionNaming:r,finishingPositionLimit:a,playoffAttributes:o,exitProfileLimit:c,roundOffsetLimit:u,drawDefinition:p,sequenceLimit:f,matchUpType:S,idPrefix:v,uuids:b,stage:m});if(B.structureId&&Y){let oe={linkType:hh,source:{roundNumber:$,structureId:B.structureId},target:{roundNumber:1,feedProfile:fu,structureId:Y}};X&&B&&X.push(oe),X!=null&&X.length&&w.push(...X)}return Z!=null&&Z.length&&T.push(...Z),Q!=null&&Q.length&&I.push(...Q),{structureId:Y,childLinks:X,structures:T}}}function Bq({drawDefinition:t,matchUpsMap:e,structureId:i}){let n=ui({drawDefinition:t,structureId:i});if(n.error)return pe({result:n});let{matchUps:r}=wn({structure:n.structure,matchUpsMap:e});return{...Us({matchUps:r}),matchUps:r,matchUpsMap:e}}function iY({finishingPositions:t,drawDefinition:e,structureId:i}){var r;let{roundProfile:n}=Bq({drawDefinition:e,structureId:i});return(r=n&&Object.keys(n))==null?void 0:r.reduce((a,o)=>(Zoe(n==null?void 0:n[o]).forEach(s=>{t.forEach(l=>{kAe({position:l,rangeDefinition:s})&&(a[l]={roundNumber:o})})}),a),{})}function kAe({position:t,rangeDefinition:e}){if(!Array.isArray(e)||e.reduce((r,a)=>r||isNaN(a),!1))return!1;let[i,n]=e;return Et(i,(n||i)+1).includes(t)}function Zoe(t){var e,i;return[Pi(((e=t==null?void 0:t.finishingPositionRange)==null?void 0:e.loser)||[]),Pi(((i=t==null?void 0:t.finishingPositionRange)==null?void 0:i.winner)||[])]}function xAe(t){return Zoe(t).map(e=>Et(e[0],e[1]&&e[1]+1||e[0]+1))}function GT({drawDefinition:t,structureIds:e,matchUpsMap:i}){if(e&&!Array.isArray(e))return{error:Re,context:{structureIds:e}};if(!t)return{error:Vt};e=e??(t.structures??[]).filter(a=>a.stage!==Zt).map(({structureId:a})=>a);let n=e.map(a=>{var s;let{roundProfile:o}=Bq({drawDefinition:t,matchUpsMap:i,structureId:a});return(s=o&&Object.values(o))==null?void 0:s.map(xAe).flat()}).flat(),r=n.filter(a=>(a==null?void 0:a.length)===1).sort(ma).flat();return{positionsNotPlayedOff:Pi(n.flat()).filter(a=>!r.includes(a)),positionsPlayedOff:r}}function Xoe({excludeRoundNumbers:t=[],playoffPositions:e=[],drawDefinition:i,structureId:n}){if(!i)return{error:Vt};if(!n)return{error:nc};if(!e)return{error:Yt,info:"missing playoffPositions"};let r=GT({drawDefinition:i});if(r.error)return r;let a=r.positionsPlayedOff,o=e.filter(v=>!a.includes(v)),s=iY({finishingPositions:o,drawDefinition:i,structureId:n}),l=Object.values(s).reduce((v,y)=>v.includes(y.roundNumber)?v:v.concat(y.roundNumber),[]).map(v=>ri(v)).filter(v=>!t.includes(v)),c=iY({finishingPositions:a,drawDefinition:i,structureId:n}),u=c?Object.values(c):[],d=c?u.reduce((v,y)=>v.includes(y.roundNumber)?v:v.concat(y.roundNumber),[]).map(v=>ri(v)):[],p=l.filter(v=>!d.includes(v)).sort(ma),{roundProfile:h}=Bq({drawDefinition:i,structureId:n}),f=p.map(v=>{let y=h==null?void 0:h[v].finishingPositionRange.loser,[b,I]=y??[0,0];return Et(b,(I||b)+1)}).flat().sort(ma),{playoffRoundsRanges:m}=OAe({playoffSourceRounds:p,roundProfile:h}),g=[...p,...d];return{playoffPositionsReturned:f,playedOffSourceRounds:d,playoffRoundsRanges:m,playoffSourceRounds:p,sourceRounds:g,roundProfile:h}}function OAe({playoffSourceRounds:t,roundProfile:e}){return{playoffRoundsRanges:t.map(i=>{let n=e[i].finishingPositionRange.loser,[r,a]=n,o=Et(r,(a||r)+1);return{finishingPositionRange:n.join("-"),finishingPositions:o,roundNumber:i}})}}function GC({drawDefinition:t,structureId:e}){if(!t)return{error:Vt};let{matchUps:i,matchUpsMap:n}=ws({inContext:!0,drawDefinition:t}),{positionsNotPlayedOff:r,positionsPlayedOff:a}=GT({drawDefinition:t,matchUpsMap:n}),{structures:o}=Ru({drawDefinition:t}),s=o.filter(c=>!e&&c.stage!==Ja||c.structureId===e),l={};for(let c of s){let u=c==null?void 0:c.structureId,d=LAe({playoffPositions:r,drawDefinition:t,structure:c,matchUps:i}),{error:p,...h}=d;if(p)return d;l[u]={structureId:u,...h}}return e?{positionsPlayedOff:a,...l[e]}:{availablePlayoffProfiles:Object.values(l),availablePlayoffRounds:Object.values(l),positionsPlayedOff:a}}function LAe({playoffPositions:t,drawDefinition:e,structure:i,matchUps:n}){var h,f,m,g,v,y,b,I,T;let r=i==null?void 0:i.structureId,{links:a}=FT({drawDefinition:e,structureId:r});if(i.structureType===As||i.structures){let w=(f=(h=Vn({structure:i}))==null?void 0:h.positionAssignments)==null?void 0:f.length,S=i.structures.length,D=(w??0)/S,E=((m=a.source)==null?void 0:m.flatMap(({source:B})=>(B==null?void 0:B.finishingPositions)||[]))||[],C=Et(1,D+1).filter(B=>!E.includes(B)),P=((v=(g=n.find(B=>B.containerStructureId===r&&B.finishingPositionRange))==null?void 0:g.finishingPositionRange)==null?void 0:v.winner)||[0,1],R=a==null?void 0:a.source.map(({target:B})=>B.structureId),{positionsPlayedOff:N=[],positionsNotPlayedOff:M=[]}=GT({structureIds:R,drawDefinition:e}),A=[...N,...M],_=Et(P[0],P[1]+1).filter(B=>!A.includes(B)),x=ro(_,_.length/C.length),O=C.map((B,F)=>{let G=x[F],H=[Math.min(...G||[]),Math.max(...G||[])].join("-");return{finishingPosition:B,finishingPositions:G,finishingPositionRange:H}});return{positionsNotPlayedOff:_,playoffFinishingPositionRanges:O,finishingPositionsAvailable:C,finishingPositionsPlayedOff:E,positionsPlayedOff:N,groupCount:S,groupSize:D}}let o=((y=a==null?void 0:a.source)==null?void 0:y.filter(w=>w.linkCondition!==fh).map(w=>{var S;return(S=w.source)==null?void 0:S.roundNumber}))||[],s=((b=a==null?void 0:a.source)==null?void 0:b.filter(w=>w.linkCondition===fh).map(w=>{var S;return(S=w.source)==null?void 0:S.roundNumber}))||[],l=Xoe({excludeRoundNumbers:o,playoffPositions:t,drawDefinition:e,structureId:r}),c=l!=null&&l.playoffSourceRounds?[...(l==null?void 0:l.playoffSourceRounds)||[]]:void 0,u=[...(l==null?void 0:l.playoffRoundsRanges)||[]],{roundProfile:d,error:p}=l;for(let w of s){let S=a==null?void 0:a.source.find(R=>R.source.roundNumber===w),D=S==null?void 0:S.target.roundNumber,E=S==null?void 0:S.target.structureId,C=n.filter(({roundNumber:R,structureId:N})=>N===E&&R===D),P=C.filter(({sides:R})=>R.find(N=>N.participantFed&&!N.participantId)).length;if(c&&P===C.length){c.push(w);let R=(T=(I=d==null?void 0:d[w])==null?void 0:I.finishingPositionRange)==null?void 0:T.loser;if(R){let N=Math.min(...R),M=N+P,A=Et(N,M),_={finishingPositionRange:[N,M-1].join("-"),finishingPositions:A,roundNumber:w};u.push(_)}}}return c&&c.sort(ma),u.sort((w,S)=>w.roundNumber-S.roundNumber),{playoffRounds:c,playoffRoundsRanges:u,error:p}}function FAe({playoffGroups:t,drawDefinition:e,structureId:i}){var r,a;if(!e)return{error:Vt};if(typeof i!="string"||!Array.isArray(t))return{error:Re};let n=t.map(({finishingPositions:o})=>o).flat();return{positionRangeMap:(a=(r=GC({drawDefinition:e,structureId:i}).playoffFinishingPositionRanges)==null?void 0:r.filter(o=>n.includes(o.finishingPosition)))==null?void 0:a.reduce((o,s)=>(o[s.finishingPosition]=s,o),{})}}function Joe(t){var y,b;let{finishingPositionOffset:e=0,playoffAttributes:i,stageSequence:n=1,staggeredEntry:r,structureName:a,stage:o=xt,matchUpType:s,structureId:l,idPrefix:c,drawSize:u,isMock:d,uuids:p}=t,h={finishingPositionOffset:e,matchUpType:s,drawSize:u,idPrefix:c,isMock:d,uuids:p},{matchUps:f}=r?Jm(h):fp(h),m=Uc({structureName:a||((y=i==null?void 0:i["0"])==null?void 0:y.name)||Eo(xt),structureId:l||(p==null?void 0:p.pop()),stageSequence:n,matchUpType:s,matchUps:f,stage:o}),g=[m],v=[];if(u>2){let I=u/2,{matchUps:T}=fp({finishingPositionOffset:e+I,idPrefix:c&&`${c}-c`,drawSize:I,matchUpType:s,isMock:d}),w=Eo(Po),S=((b=i==null?void 0:i["0-1"])==null?void 0:b.name)??t.consolationStructureName??(a?`${a} ${w}`:w),D=Uc({structureName:S,matchUps:T,structureId:p==null?void 0:p.pop(),stage:Po,stageSequence:1,matchUpType:s});g.push(D);let E={linkType:hh,source:{roundNumber:1,structureId:m.structureId},target:{roundNumber:1,feedProfile:fu,structureId:D.structureId}};v.push(E)}return{...ce,structures:g,links:v}}function Qoe({consolationStructure:t,roundOffset:e=0,mainStructure:i,roundsCount:n,feedPolicy:r,fmlc:a}){let o=t.matchUps.reduce((c,u)=>(u.drawPositions||[]).filter(Boolean).length&&!c.includes(u.roundNumber)?c.concat(u.roundNumber):c,[]),s=(r==null?void 0:r.roundGroupedOrder)||[],l=r==null?void 0:r.roundFeedProfiles;return Et(1+e,n+1+e).map(c=>{let u=l&&l[c-1]?l[c-1]:c%2?fu:Fv,d=c-e<=2?c-e:(c-e-2)*2+2,p={linkType:hh,source:{roundNumber:c,structureId:i.structureId},target:{feedProfile:u,roundNumber:d,structureId:t.structureId}},h=s[c-1];return h&&(p.target.groupedOrder=h),Jl()&&(p.source.structureName=i.structureName,p.target.structureName=t.structureName),c===2&&a&&(p.linkCondition=fh,p.target.feedProfile=fu),o.includes(d)?p:void 0}).filter(Boolean)}function ese(t){var T,w;let{playoffStructureNameBase:e,finishingPositionOffset:i,stageSequence:n=1,playoffAttributes:r,structureNameMap:a,staggeredEntry:o,stage:s=xt,matchUpType:l,structureId:c,drawSize:u,idPrefix:d,isMock:p,uuids:h}=t,f={finishingPositionOffset:i,matchUpType:l,drawSize:u,idPrefix:d,isMock:p,uuids:h},{matchUps:m,roundsCount:g}=o?Jm(f):fp(f),v=t.structureName??((T=r==null?void 0:r["0"])==null?void 0:T.name)??Eo(xt),y=Bm({structureId:c||(h==null?void 0:h.pop()),structureName:v,stageSequence:n,matchUpType:l,matchUps:m,stage:s}),b=[y],I=[];if(u>2){let S=[0,2].slice(0,u/16).map((D,E)=>{let C=E+1,{consolationStructure:P}=BAe({idPrefix:d&&`${d}-c${E}`,structureId:h==null?void 0:h.pop(),playoffStructureNameBase:e,playoffAttributes:r,structureNameMap:a,stageSequence:C,roundOffset:D,matchUpType:l,drawSize:u,isMock:p,index:E,uuids:h});b.push(P);let R=Qoe({consolationStructure:P,roundsCount:2,mainStructure:y,roundOffset:D});return{consolationStructure:P,links:R}}).map(D=>D.links).flat();if(I.push(...S),u>=4&&u<=16||u>32){let{matchUps:D}=fp({idPrefix:d&&`${d}-p3t4`,finishingPositionOffset:2,drawSize:2,matchUpType:l,isMock:p}),E=((w=r==null?void 0:r["3-4"])==null?void 0:w.name)??Eo(Fr),C=(a==null?void 0:a[E])||E,P=e?`${e} ${C}`:C,R=Bm({structureId:h==null?void 0:h.pop(),matchUps:D,stageSequence:2,stage:Fr,structureName:P,matchUpType:l}),N={linkType:hh,source:{roundNumber:g-1,structureId:y.structureId},target:{structureId:R.structureId,feedProfile:fu,roundNumber:1}};b.push(R),I.push(N)}}return{structures:b,links:I,...ce}}function BAe({playoffStructureNameBase:t,stageSequence:e=1,playoffAttributes:i,structureNameMap:n,roundOffset:r=0,matchUpType:a,structureId:o,idPrefix:s,drawSize:l,isMock:c,index:u,uuids:d}){var y,b;let p=l/(2*Math.pow(2,r)),{matchUps:h,roundsCount:f}=Jm({finishingPositionOffset:p,baseDrawSize:p,isConsolation:!0,feedRounds:1,matchUpType:a,idPrefix:s,isMock:c,uuids:d}),m=u===0&&((y=i==null?void 0:i["0-1"])==null?void 0:y.name)||u===1&&((b=i==null?void 0:i["0-3"])==null?void 0:b.name)||`${Eo(Po)} ${u+1}`,g=(n==null?void 0:n[m])||m,v=t?`${t} ${g}`:g;return{consolationStructure:Bm({matchUps:h,stage:Po,structureName:v,stageSequence:e,matchUpType:a,structureId:o}),consolationRoundsCount:f}}function ab(t){var C,P,R,N;let{finishingPositionOffset:e,stageSequence:i=1,playoffAttributes:n,feedsFromFinal:r,staggeredEntry:a,structureName:o,stage:s=xt,structureId:l,matchUpType:c,skipRounds:u,feedRounds:d,idPrefix:p,drawSize:h,isMock:f,uuids:m,fmlc:g}=t,v=t.feedPolicy||((C=t.policyDefinitions)==null?void 0:C[uS])||((P=t.appliedPolicies)==null?void 0:P[uS]),y={finishingPositionOffset:e,matchUpType:c,skipRounds:u,drawSize:h,idPrefix:p,isMock:f,uuids:m},{matchUps:b}=a?Jm(y):fp(y),I=Uc({structureName:o||((R=n==null?void 0:n["0"])==null?void 0:R.name)||Eo(xt),structureId:l||(m==null?void 0:m.pop()),stageSequence:i,matchUpType:c,matchUps:b,stage:s}),T=[I],w=[],S=h/2,{matchUps:D,roundsCount:E}=Jm({finishingPositionOffset:S,idPrefix:p&&`${p}-c`,isConsolation:!0,feedsFromFinal:r,baseDrawSize:S,matchUpType:c,feedRounds:d,skipRounds:u,isMock:f,uuids:m,fmlc:g});if(h>2){let M=((N=n==null?void 0:n["0-1"])==null?void 0:N.name)??Eo(Po),A=t.playoffStructureNameBase?`${t.playoffStructureNameBase} ${M}`:M,_=Uc({matchUps:D,structureId:m==null?void 0:m.pop(),stage:Po,stageSequence:1,structureName:A,matchUpType:c});T.push(_);let x=Qoe({consolationStructure:_,mainStructure:I,roundsCount:E,feedPolicy:v,fmlc:g});w.push(...x)}return{...ce,structures:T,links:w}}function tse({requireSequential:t=!0,playoffMatchUpFormat:e,playoffAttributes:i,sourceStructureId:n,policyDefinitions:r,stageSequence:a,drawDefinition:o,playoffGroups:s,matchUpType:l,feedPolicy:c,groupCount:u,idPrefix:d,isMock:p,uuids:h}){var T,w,S,D,E,C;c=c||(r==null?void 0:r[uS]);let f="processPlayoffGroups",m=0,g=[],v=[],y=[],{error:b,positionRangeMap:I}=FAe({structureId:n,drawDefinition:o,playoffGroups:s});if(b)return pe({result:{error:b},stack:f});if(!(!I||s!=null&&s.every(P=>{let{finishingPositions:R=[]}=P;if(!R.length)return!1;let N=[...R].sort(ma).map((M,A)=>(R[A+1]||M)-M).every(M=>M<2);return(!t||N)&&R.every(M=>I[M])})))return pe({context:{validFinishingPositions:Object.values(I)},result:{error:Re},stack:f});for(let P of s){let R=P.finishingPositions,N=I&&R.map(G=>{var H;return(H=I[G])==null?void 0:H.finishingPositions}).flat(),M=u*R.length,A=UT(M),_=A===2&&ep||P.drawType||ep;N&&(m=Math.min(...N)-1);let x=N&&`${Math.min(...N)}-${Math.max(...N)}`,O=P.structureName||x&&((w=(T=P.playoffAttributes)==null?void 0:T[x])==null?void 0:w.name)||((D=(S=P.playoffAttributes)==null?void 0:S["0"])==null?void 0:D.name),B={addNameBaseToAttributeName:P.addNameBaseToAttributeName,playoffStructureNameBase:P.playoffStructureNameBase,finishingPositionNaming:P.finishingPositionNaming,finishingPositionLimit:P.finishingPositionLimit,structureId:P.structureId??(h==null?void 0:h.pop()),playoffAttributes:P.playoffAttributes,structureNameMap:P.structureNameMap,sequenceLimit:P.sequenceLimit,structureName:O,idPrefix:d&&`${d}-po`,appliedPolicies:r,finishingPositionOffset:m,stage:Fr,stageSequence:a,matchUpType:l,drawSize:A,isMock:p,uuids:h},F=({playoffStructures:G,playoffLinks:H})=>{let[$]=G,q=vM({playoffStructureId:$.structureId,finishingPositions:R,sourceStructureId:n});y.push(q),y.push(...H),v.push(...G),g.push({structureId:$.structureId,finishingPositions:R}),m+=M};if(_===ep){let{matchUps:G}=fp({finishingPositionLimit:m+M,idPrefix:d&&`${d}-po`,finishingPositionOffset:m,matchUpType:l,drawSize:A,isMock:p,uuids:h}),H=Uc({structureId:P.structureId??(h==null?void 0:h.pop()),matchUpFormat:e,stage:Fr,structureName:O,stageSequence:a,matchUps:G});v.push(H);let $=vM({playoffStructureId:H.structureId,finishingPositions:R,sourceStructureId:n});y.push($),m+=M,g.push({structureId:H.structureId,finishingPositions:R})}else if([aS,oS,Fr].includes(_)){let G={playoffAttributes:P.playoffAttributes??i,playoffStructureNameBase:P.playoffStructureNameBase,structureId:P.structureId??(h==null?void 0:h.pop()),structureName:P.structureName,idPrefix:d&&`${d}-po`,addNameBaseToAttributeName:!0,finishingPositionOffset:m,stage:Fr,roundOffset:0,stageSequence:a,drawSize:A,isMock:p,uuids:h};_===aS?Object.assign(G,{playoffAttributes:(P==null?void 0:P.playoffAttributes)??i??uz,roundOffsetLimit:3}):_===oS&&Object.assign(G,{playoffAttributes:(P==null?void 0:P.playoffAttributes)??i??dz,roundOffsetLimit:2});let H=V0(G);if(H.error)return H;if((E=H.links)!=null&&E.length&&y.push(...H.links),(C=H.structures)!=null&&C.length&&v.push(...H.structures),v.sort(FI),H.structureId){let $=vM({playoffStructureId:H.structureId,finishingPositions:R,sourceStructureId:n});y.push($),g.push({structureId:H.structureId,finishingPositions:R})}m+=M}else if([sS,cC,CD,ED,DD,PD].includes(_)){let G=[h==null?void 0:h.pop(),h==null?void 0:h.pop()],H={playoffStructureNameBase:P.playoffStructureNameBase,structureId:P.structureId??(h==null?void 0:h.pop()),playoffAttributes:P.playoffAttributes,idPrefix:d&&`${d}-po`,finishingPositionOffset:m,uuids:G,stage:Fr,structureName:O,matchUpType:l,feedPolicy:c,drawSize:A,isMock:p},$={[sS]:{fmlc:!0,feedRounds:1},[PD]:{feedRounds:1},[CD]:{feedsFromFinal:3},[ED]:{feedsFromFinal:2},[DD]:{feedsFromFinal:1}};Object.assign(H,$[_]||{});let{structures:q,links:z}=ab(H),[Z]=q,Y=vM({playoffStructureId:Z.structureId,finishingPositions:R,sourceStructureId:n});y.push(Y),y.push(...z),v.push(...q),g.push({structureId:Z.structureId,finishingPositions:R}),m+=M}else if([Cu].includes(_)){let{structures:G,links:H}=LC({...B,structureOptions:P.structureOptions||{groupSize:4}});F({playoffStructures:G,playoffLinks:H})}else if([lC].includes(_)){let{structures:G,links:H}=Joe(B);F({playoffStructures:G,playoffLinks:H})}else if([sRe].includes(_)){let{structures:G,links:H}=ese(B);F({playoffStructures:G,playoffLinks:H})}else if([Fc].includes(_)){let G=Uc({structureId:P.structureId??(h==null?void 0:h.pop()),structureName:P.structureName,finishingPosition:yN,stage:Fr,stageSequence:a,matchUps:[]});F({playoffStructures:[G],playoffLinks:[]})}}return{finishingPositionTargets:g,positionRangeMap:I,structures:v,links:y}}function vM({playoffStructureId:t,finishingPositions:e,sourceStructureId:i}){return{linkType:Uf,source:{structureId:i,finishingPositions:e},target:{structureId:t,feedProfile:pu,roundNumber:1}}}function HC({matchUp:t,tieFormat:e,isMock:i,uuids:n}){let{collectionDefinitions:r}=e??{};return{tieMatchUps:(r??[]).map(a=>zC({matchUp:t,collectionDefinition:a,uuids:n,isMock:i})).filter(Boolean).flat()}}function zC({collectionPositionOffset:t=0,collectionDefinition:e,matchUpsLimit:i,matchUp:n,isMock:r,uuids:a}){let{matchUpCount:o,matchUpType:s,collectionId:l,processCodes:c}=e||{},u=i??o??0,d=p=>{if(!r&&!(n!=null&&n.isMock))return(a==null?void 0:a.pop())??Pn();let h=e==null?void 0:e.collectionId;return(a==null?void 0:a.pop())??`${n==null?void 0:n.matchUpId}-${h}-TMU-${p+1}`};return Et(0,u).map(p=>{let h=t+p+1;return{sides:[{sideNumber:1},{sideNumber:2}],matchUpId:d(p),matchUpStatus:qr,collectionPosition:h,collectionId:l,processCodes:c,matchUpType:s,isMock:r}})}function $Ae(t){var D,E,C;let e="generateAndPopulateRRplayoffStructures";if(!t.playoffGroups)return pe({result:{error:Yt},info:"playoffGroups required",stack:e});let{sourceStructureId:i,requireSequential:n,tournamentRecord:r,drawDefinition:a,playoffGroups:o,groupCount:s,groupSize:l,event:c}=t,{structures:u=[],links:d=[],finishingPositionTargets:p,positionRangeMap:h,error:f}=tse({requireSequential:n,sourceStructureId:i,playoffGroups:o,groupCount:s,groupSize:l,...t});if(f)return{error:f};let m=p==null?void 0:p.map(({finishingPositions:P})=>P).flat().map(P=>h[P].finishingPositions).flat();a.structures.push(...u),a.links.push(...d);let{matchUps:g,matchUpsMap:v}=Ia({inContext:!0,drawDefinition:a}),y=u.map(({structureId:P})=>P),b=g==null?void 0:g.filter(({structureId:P})=>y.includes(P)).map($a),I=(D=v==null?void 0:v.drawMatchUps)==null?void 0:D.filter(({matchUpId:P})=>b==null?void 0:b.includes(P));if(I!=null&&I.length){let P=(E=is({drawDefinition:a,event:c}))==null?void 0:E.tieFormat;P&&I.forEach(R=>{let{tieMatchUps:N}=HC({isMock:t.isMock,tieFormat:P,matchUp:R});Object.assign(R,{tieMatchUps:N,matchUpType:pp})})}let{positionAssignments:T}=Vn({structureId:i,drawDefinition:a}),w={};T==null||T.forEach(P=>{var N,M,A;let R=(A=(M=(N=Ri({element:P,name:qm}))==null?void 0:N.extension)==null?void 0:M.value)==null?void 0:A.groupOrder;R&&(w[R]||(w[R]=[]),w[R].push(P.participantId))});let S=VC({provisionalPositioning:t.provisionalPositioning,structureId:i,applyPositioning:!0,event:t.event,tournamentRecord:r,drawDefinition:a});return S.error&&((C=S.error)==null?void 0:C.code)!==EH.code?pe({result:S,stack:e}):{structures:u,links:d,positionsPlayedOff:m,drawDefinition:a,...ce}}function P0({value:t,sourceRange:e,targetRange:i}){let n=Math.min(...e),r=Math.max(...e),a=Math.min(...i),o=Math.max(...i);return(t-n)*(o-a)/(r-n)+a}var hu="ELO",ise="NTRP",VAe="TRN",nse="UTR",$q="WTN",rse={ELO:hu,NTRP:ise,TRN:VAe,UTR:nse,WTN:$q},jAe={[hu]:{defaultInitialization:1500,decimalsCount:0,range:[0,3e3],ascending:!0},[ise]:{accessors:["ntrpRating","dntrpRatingHundredths"],attributes:{ustaRatingType:""},accessor:"dntrpRatingHundredths",defaultInitialization:3,decimalsCount:1,ascending:!0,range:[1,7]},[nse]:{defaultInitialization:6,accessors:["utrRating"],accessor:"utrRating",decimalsCount:2,ascending:!0,range:[1,16]},[$q]:{attributes:{confidence:{generator:!0,range:[60,100]}},accessors:["wtnRating","confidence"],defaultInitialization:23,accessor:"wtnRating",ascending:!1,decimalsCount:2,range:[40,1]}},La=jAe;function GAe({sourceRatingType:t,sourceRating:e}){let i=La[t].range,n=i[0]>i[1],r=La[hu].range;return P0({value:n?i[0]-e:e,sourceRange:i,targetRange:r})}function HAe({targetRatingType:t,sourceRating:e}){let i=La[t].decimalsCount||0,n=La[t].range,r=n[0]>n[1],a=Math.max(...n),o=La[hu].range,s=P0({targetRange:n,sourceRange:o,value:e}),l=parseFloat(s.toFixed(i));return r?a-l:l}function nY(t){var d;let e=di(t,[{ratings:!0,[$l]:vl}]);if(e.error)return e;let i=t.matchUpType&&[or,zn].includes(t.matchUpType)?t.matchUpType:or,n=Object.keys(La),r=t.targetRatingType&&n.includes(t.targetRatingType)?t.targetRatingType:hu,a=t.ratings[i]?t.ratings[i].reduce((p,h)=>p.includes(h.scaleName)?p:p.concat(h.scaleName),[]):[];if(!a)return{error:no};let o=((d=t.ratings[i])==null?void 0:d.find(p=>p.scaleName===r))??t.ratings[i][0];if(a[0]===r)return o;let s=o.scaleName,l=La[o.scaleName].accessor,c=l?o.scaleValue[l]:o.scaleValue,u=GAe({sourceRatingType:s,sourceRating:c});return{convertedRating:HAe({targetRatingType:r,sourceRating:u}),sourceRating:c}}function zAe({participantResults:t,sides:e,score:i}){var s,l;let n=e.find(({sideNumber:c})=>c===1),r=e.find(({sideNumber:c})=>c===2),a=(s=n==null?void 0:n.participant)==null?void 0:s.ratings,o=(l=r==null?void 0:r.participant)==null?void 0:l.ratings;if(a!=null&&a[or]&&(o!=null&&o[or])){let c=hu,{convertedRating:u}=nY({ratings:a,targetRatingType:c}),{convertedRating:d}=nY({ratings:o,targetRatingType:c}),{side1pressure:p,side2pressure:h}=qAe({side1ConvertedRating:u,side2ConvertedRating:d,score:i});p&&t[n==null?void 0:n.participantId].pressureScores.push(p),h&&t[r==null?void 0:r.participantId].pressureScores.push(h);let f=Math.max(...La[hu].range),m=mA((d-u)/f),g=mA((u-d)/f);t[n==null?void 0:n.participantId].ratingVariation.push(m),t[r==null?void 0:r.participantId].ratingVariation.push(g)}}function qAe({side1ConvertedRating:t,side2ConvertedRating:e,score:i}){var y,b;let n=t>e?t:e,r=t>e?e:t,a=Math.abs(t-e),o=La[hu].range,s=Math.max(...o),l=(s-n)*0,c=(n+l)/s*a,u=(y=i==null?void 0:i.sets)==null?void 0:y.reduce((I,T)=>I+((T==null?void 0:T.side1Score)??0),0),d=(b=i==null?void 0:i.sets)==null?void 0:b.reduce((I,T)=>I+(T.side2Score??0),0),p=t>e?2:1,h=(u||0)*(r+(p===1?c:0)),f=(d||0)*(r+(p===2?c:0)),m=h+f,g=m?mA(h/m):0,v=m?mA(f/m):0;return{side1pressure:g,side2pressure:v}}var Iu="SET3-S:6/TB7",WAe="SET3-S:6NOAD",ase="SET3-S:6/TB7-F:TB10",KAe="SET3-S:4/TB7",YAe="SET3-S:4/TB5@3",ZAe="SET1-S:T20",XAe="SET1-S:8/TB7",JAe="SET1-S:8/TB7@7",QAe={FORMAT_STANDARD:Iu,FORMAT_STANDARD_NOAD:WAe,FORMAT_ATP_DOUBLES:ase,FORMAT_SHORT_SETS:KAe,FORMAT_FAST4:YAe,FORMAT_PRO_SET:XAe,FORMAT_COLLEGE_PRO_SET:JAe,TIMED20:ZAe};function Vq({winningSide:t,matchUpFormat:e=Iu,matchUpStatus:i,tallyPolicy:n,score:r}){let a=[0,0],o=r==null?void 0:r.sets,s=typeof t=="number"&&t-1,l=Ys(e),c=jq((l==null?void 0:l.bestOf)??1);if(typeof s=="number"&&(i===Zi&&(n!=null&&n.setsCreditForDefaults)||i===hn&&(n!=null&&n.setsCreditForWalkovers)))a[s]=c;else for(let u of o||[]){let{winningSide:d}=u;d&&(a[d-1]+=1)}return typeof s=="number"&&i===go&&(+a[1-s]===c&&(a[1-s]-=1),n!=null&&n.setsCreditForRetirements&&(a[s]=c)),a}function ose({matchUpFormat:t=Iu,winningSide:e,matchUpStatus:i,tallyPolicy:n,score:r}){var p,h;let{sets:a}=r||{};if(!a)return[0,0];let o=typeof e=="number"&&e-1,s=Ys(t),l=(s==null?void 0:s.bestOf)??1,c=jq(l),u=((p=s==null?void 0:s.setFormat)==null?void 0:p.tiebreakAt)||0,d=[[],[]];if(typeof o=="number"&&(i===Zi&&(n!=null&&n.gamesCreditForDefaults)||i===hn&&(n!=null&&n.gamesCreditForWalkovers))){let f=((h=s==null?void 0:s.setFormat)==null?void 0:h.setTo)||0,m=c*f;d[o].push(m)}else a.forEach((f,m)=>{var T;let g=(f.setNumber||m+1)>c&&(s!=null&&s.finalSetFormat)?"finalSetFormat":"setFormat",v=(T=s==null?void 0:s[g])==null?void 0:T.based,y=s==null?void 0:s[g].tiebreakSet,{side1Score:b,side2Score:I}=f;rY(v)&&(d[0].push(ri(b||0)),d[1].push(ri(I||0))),y&&f.winningSide&&(n==null?void 0:n.gamesCreditForTiebreakSets)!==!1&&d[f.winningSide-1].push(1)});if(i===go&&typeof o=="number"){let f=a.length>c&&(s!=null&&s.finalSetFormat)?"finalSetFormat":"setFormat",m=s==null?void 0:s[f];if(rY(m.based)){let g=(m==null?void 0:m.setTo)||0,v=b=>{if(!(!s||b===""))return+b===u-1||+b===u?ri(u||0)+1:+b<u?g:u},y=Vq({winningSide:e,score:{sets:a},matchUpStatus:i,matchUpFormat:t,tallyPolicy:n});if(d.map(b=>b[o]<=b[1-o]).reduce((b,I)=>b+(I?1:0),0)>y[1-o]){let b=d[o].length,I=v(d[1-o][b-1]);I&&(d[o][b-1]=I)}c>d[o].length&&(n!=null&&n.gamesCreditForRetirements)&&d[o].push(g)}}return[d[0].reduce((f,m)=>f+m,0),d[1].reduce((f,m)=>f+m,0)]}function sse({matchUpFormat:t,score:e}){var s;let i=t?Ys(t):void 0,n=(i==null?void 0:i.bestOf)??1,r=jq(n),a=[0,0],o=[0,0];return(s=e==null?void 0:e.sets)==null||s.forEach((l,c)=>{var p;let u=(l.setNumber||c+1)>r&&(i!=null&&i.finalSetFormat)?"finalSetFormat":"setFormat",d=(p=i==null?void 0:i[u])==null?void 0:p.based;if(lse(d)){let{side1Score:h,side2Score:f}=l;h&&(o[0]+=ri(h||0)),f&&(o[1]+=ri(f||0))}else l.side1TiebreakScore&&(o[0]+=ri(l.side1TiebreakScore||0)),l.side2TiebreakScore&&(o[1]+=ri(l.side2TiebreakScore||0)),(l.side1TiebreakScore||l.side2TiebreakScore)&&l.winningSide&&(a[l.winningSide-1]+=1)}),{pointsTally:o,tiebreaksTally:a}}function jq(t){return t&&Math.ceil(t/2)||1}function lse(t){return t==="P"}function rY(t){return!lse(t)}function e_e({participantResults:t,matchUpFormat:e,tallyPolicy:i,perPlayer:n,totalSets:r}){var c;let a=e&&Ys(e)||{},o=a.bestOf,s=o&&Math.ceil(o/2)||1,l=(c=a.setFormat)==null?void 0:c.setTo;Object.keys(t).forEach(u=>{let d=t[u].setsWon,p=t[u].setsLost,h=i!=null&&i.groupTotalSetsPlayed?r:n*(s||0)||d+p,f=Math.round(d/h*1e3)/1e3;(f===1/0||isNaN(f))&&(f=h);let m=t[u].tieMatchUpsWon,g=t[u].tieMatchUpsLost,v=m+g,y=Math.round(m/v*1e3)/1e3;(y===1/0||isNaN(y))&&(y=m);let b=t[u].matchUpsWon,I=t[u].matchUpsLost,T=b+I,w=Math.round(b/T*1e3)/1e3;(w===1/0||isNaN(w))&&(w=b);let S=t[u].gamesWon||0,D=t[u].gamesLost||0,E=(n||0)*(s||0)*(l||0),C=Math.max(E,S+D),P=Math.round(S/C*1e3)/1e3;(P===1/0||isNaN(P))&&(P=0);let R=t[u].pointsWon+t[u].pointsLost,N=Math.round(t[u].pointsWon/R*1e3)/1e3;(N===1/0||isNaN(N))&&(N=0),t[u].setsWon=d,t[u].setsLost=p,t[u].setsPct=f,t[u].tieMatchUpsWon=m,t[u].tieMatchUpsPct=y,t[u].matchUpsPct=w,t[u].gamesWon=S,t[u].gamesLost=D,t[u].gamesPct=P,t[u].pointsPct=N,t[u].result=`${t[u].matchUpsWon}/${t[u].matchUpsLost}`})}function qC({participantIds:t,pressureRating:e,matchUpFormat:i,tallyPolicy:n,perPlayer:r,matchUps:a}){var u,d,p,h,f,m,g;let o={},s=(n==null?void 0:n.excludeMatchUpStatuses)||[],l=a==null?void 0:a.filter(v=>(v.tieMatchUps||!s.includes(v.matchUpStatus))&&(!(t!=null&&t.length)||zr(t,[R0(v,0),R0(v,1)]).length===2)),c=(u=l==null?void 0:l.flatMap(({score:v,tieMatchUps:y})=>{var b;return y?y.filter(({matchUpStatus:I})=>!s.includes(I)).flatMap(({score:I})=>{var T;return((T=I==null?void 0:I.sets)==null?void 0:T.length)??0}):((b=v==null?void 0:v.sets)==null?void 0:b.length)??0}))==null?void 0:u.reduce((v,y)=>v+y,0);for(let v of l??[]){let{matchUpStatus:y,tieMatchUps:b,tieFormat:I,score:T,winningSide:w,sides:S}=v,D=I&&v._disableAutoCalc&&I.collectionDefinitions.every(({scoreValue:N})=>N),E=w&&t_e(v),C=w&&i_e(v);if(!E&&!C)if(y&&ba.includes(y)){let N=R0(v,0),M=R0(v,1);N&&(Pm(o,N),o[N].matchUpsCancelled+=1),M&&(Pm(o,M),o[M].matchUpsCancelled+=1)}else if(b!=null&&b.length){r=0;for(let N of b){if(N.winningSide){let M=(d=S==null?void 0:S.find(({sideNumber:_})=>_===N.winningSide))==null?void 0:d.participantId,A=(p=S==null?void 0:S.find(({sideNumber:_})=>_===N.winningSide))==null?void 0:p.participantId;M&&A&&(Pm(o,M),Pm(o,A),o[M].tieMatchUpsWon+=1,o[A].tieMatchUpsLost+=1,Gr(or)(N.matchUpType)?(o[M].tieSinglesWon+=1,o[A].tieSinglesLost+=1):Gr(zn)(N.matchUpType)&&(o[M].tieDoublesWon+=1,o[A].tieDoublesLost+=1))}aY({score:N.score,manualGamesOverride:D,participantResults:o,sides:S})}}else aY({manualGamesOverride:D,participantResults:o,score:T,sides:S});else if(Pm(o,E),Pm(o,C),b==null?void 0:b.length){r=0;for(let N of b){let{matchUpType:M}=N,A=Gr(zn)(M),_=Gr(or)(M);N.winningSide&&(N.winningSide===w?(E&&(o[E].tieMatchUpsWon+=1,_&&(o[E].tieSinglesWon+=1),A&&(o[E].tieDoublesWon+=1)),C&&(o[C].tieMatchUpsLost+=1,_&&(o[C].tieSinglesLost+=1),A&&(o[C].tieDoublesLost+=1))):N.winningSide!==w&&(C&&(o[C].tieMatchUpsWon+=1,_&&(o[C].tieSinglesWon+=1),A&&(o[C].tieDoublesWon+=1)),E&&(o[E].tieMatchUpsLost+=1,_&&(o[E].tieSinglesLost+=1),A&&(o[E].tieDoublesLost+=1)))),oY({matchUpFormat:N.matchUpFormat,matchUpStatus:N.matchUpStatus,matchUpType:N.matchUpType,score:N.score,sides:N.sides,winningParticipantId:E,losingParticipantId:C,manualGamesOverride:D,participantResults:o,isTieMatchUp:!0,pressureRating:e,tallyPolicy:n,winningSide:w})}cse({winningParticipantId:E,losingParticipantId:C,participantResults:o,matchUpStatus:y})}else oY({matchUpFormat:v.matchUpFormat??i,matchUpType:v.matchUpType,isTieMatchUp:void 0,winningParticipantId:E,manualGamesOverride:D,losingParticipantId:C,participantResults:o,pressureRating:e,matchUpStatus:y,tallyPolicy:n,winningSide:w,score:T,sides:S});let P=(h=T==null?void 0:T.sets)==null?void 0:h.reduce((N,M)=>N+((M==null?void 0:M.side1Score)??0),0),R=(f=T==null?void 0:T.sets)==null?void 0:f.reduce((N,M)=>N+(M.side2Score??0),0);if(D){let N=(m=S==null?void 0:S.find(({sideNumber:A})=>A===1))==null?void 0:m.participantId,M=(g=S==null?void 0:S.find(({sideNumber:A})=>A===2))==null?void 0:g.participantId;Pm(o,N),Pm(o,M),N&&(o[N].gamesWon+=P,o[N].gamesLost+=R),M&&(o[M].gamesWon+=R,o[M].gamesLost+=P)}}return e_e({participantResults:o,matchUpFormat:i,tallyPolicy:n,perPlayer:r,totalSets:c}),{participantResults:o}}function t_e(t){let e=t.winningSide-1;return R0(t,e)}function i_e(t){let e=1-(t.winningSide-1);return R0(t,e)}function R0(t,e){if(!(t!=null&&t.sides))return console.log("no sides:",{matchUp:t}),"foo";let i=t.sides[e];return i?i.participantId:(console.log("No Side",{matchUp:t,index:e}),"foo")}function Pm(t,e){e&&!t[e]&&(t[e]={allDefaults:0,defaults:0,defeats:[],gamesLost:0,gamesWon:0,matchUpsCancelled:0,matchUpsLost:0,matchUpsWon:0,pointsLost:0,pointsWon:0,pressureScores:[],ratingVariation:[],retirements:0,setsLost:0,setsWon:0,tieSinglesWon:0,tieSinglesLost:0,tieDoublesWon:0,tieDoublesLost:0,tieMatchUpsLost:0,tieMatchUpsWon:0,victories:[],walkovers:0})}function aY({manualGamesOverride:t,participantResults:e,score:i,sides:n}){let{sets:r}=i||{},a=[[],[]],o=[0,0];for(let l of r||[]){let{winningSide:c,side1Score:u,side2Score:d}=l;c&&(o[c-1]+=1),a[0].push(ri(u||0)),a[1].push(ri(d||0))}let s=[a[0].reduce((l,c)=>l+c,0),a[1].reduce((l,c)=>l+c,0)];n.forEach((l,c)=>{let{participantId:u}=l;u&&(Pm(e,u),e[u].setsWon+=o[c],e[u].setsLost+=o[1-c],t||(e[u].gamesWon+=s[c],e[u].gamesLost+=s[1-c]))})}function oY({winningParticipantId:t,manualGamesOverride:e,losingParticipantId:i,participantResults:n,pressureRating:r,matchUpFormat:a,matchUpStatus:o,isTieMatchUp:s,matchUpType:l,tallyPolicy:c,winningSide:u,score:d,sides:p}){let h=u&&u-1,f=1-h;r&&l===or&&zAe({participantResults:n,sides:p,score:d}),s||cse({winningParticipantId:t,losingParticipantId:i,participantResults:n,matchUpStatus:o});let m=Vq({matchUpStatus:o,matchUpFormat:a,tallyPolicy:c,winningSide:u,score:d}),g=ose({matchUpStatus:o,matchUpFormat:a,tallyPolicy:c,winningSide:u,score:d}),{pointsTally:v}=sse({score:d,matchUpFormat:a});t&&(n[t].setsWon+=m[h],n[t].setsLost+=m[f],e||(n[t].gamesWon+=g[h],n[t].gamesLost+=g[f]),n[t].pointsWon+=v[h],n[t].pointsLost+=v[f]),i&&(n[i].setsWon+=m[f],n[i].setsLost+=m[h],e||(n[i].gamesWon+=g[f],n[i].gamesLost+=g[h]),n[i].pointsWon+=v[f],n[i].pointsLost+=v[h])}function cse({winningParticipantId:t,losingParticipantId:e,participantResults:i,matchUpStatus:n}){e&&(n===hn&&(i[e].walkovers+=1),n===Zi&&(i[e].defaults+=1),n===go&&(i[e].retirements+=1),[Zi,go,hn].includes(n)&&(i[e].allDefaults+=1),i[e].matchUpsLost+=1),t&&(i[t].matchUpsWon+=1),e&&t&&(i[e].defeats.push(t),i[t].victories.push(e))}function n_e({matchUps:t,order:e,report:i}){let n={};t.forEach(({sides:a})=>{a.forEach(o=>{o.participantId&&o.participant&&(n[o.participantId]=o.participant.participantName)})});let r=[];return Array.isArray(i)&&i.forEach((a,o)=>{var s,l;if((s=a.excludedDirectives)!=null&&s.length){let c=a.excludedDirectives.map(({attribute:p})=>p).join(", "),u=`${c.length} directives were excluded due to participants limit}`;r.push(u);let d=`Excluded: ${c}`;r.push(d)}else{let c=(m,g)=>parseFloat(a.reversed?m:g)-parseFloat(a.reversed?g:m),u=a.groups?Object.values(a.groups).flat(1/0).length:((l=a.participantIds)==null?void 0:l.length)??0,d=m=>{m.groups&&Object.keys(m.groups).sort(c).forEach(g=>{let v=m.groups[g].map(b=>n[b]).join(", "),y=`${g} ${m.attribute}: ${v}`;r.push(y)})},p=a.reversed?" in reverse order":"",h=a.groups?"grouped":"separated",f=`Step ${o+1}: ${u} particiants were ${h}${p} by ${a.attribute}`;if(r.push(f),a.idsFilter){let m=`${a.attribute} was calculated considering ONLY TIED PARTICIPANTS`;r.push(m)}d(a)}r.push("----------------------")}),r.push("Final Order:"),e.forEach(a=>{let{participantId:o,resolved:s}=a,l=a.groupOrder||a.provisionalOrder;r.push(`${l}: ${n[o]} => resolved: ${!!s}`)}),r.join(`\r
`)}function use({participantResults:t,participantIds:e,attribute:i}){return dse({participantResults:t,participantIds:e}).reduce((n,r)=>{let{participantId:a,results:o}=r,s=o==null?void 0:o[i];return!isNaN(s)&&a&&(n[s]?n[s].push(a):n[s]=[a]),n},{})}function dse(t){return(t.participantIds||Object.keys(t.participantResults)).reduce((e,i,n)=>(e.push({participantId:i,i:n,results:t.participantResults[i]}),e),[])}var r_e=[{attribute:"matchUpsPct",idsFilter:!1},{attribute:"allDefaults",reversed:!0,idsFilter:!1},{attribute:"defaults",reversed:!0,idsFilter:!1},{attribute:"walkovers",reversed:!0,idsFilter:!1},{attribute:"retirements",reversed:!0,idsFilter:!1},{attribute:"setsPct",idsFilter:!1},{attribute:"gamesPct",idsFilter:!1},{attribute:"pointsPct",idsFilter:!1},{attribute:"matchUpsPct",idsFilter:!0},{attribute:"setsPct",idsFilter:!0},{attribute:"gamesPct",idsFilter:!0},{attribute:"pointsPct",idsFilter:!0}],xB={matchUpsPct:20,tieMatchUpsPct:16,pointsPct:4,gamesPct:8,setsPct:12};function sY(t){let{requireCompletion:e=!0,participantResults:i,subOrderMap:n,tallyPolicy:r}=t,a=[];if(e&&!a_e(t))return{};let o=["tieMatchUpsWon","tieSinglesWon","tieDoublesWon","matchUpsWon","pointsWon","gamesWon","setsWon","gamesPct","setsPct","pointsPct","matchUpsPct"].includes(r==null?void 0:r.groupOrderKey)?r.groupOrderKey:"matchUpsWon",s=use({participantResults:i,attribute:o});a.push({attribute:o,groups:s});let l=Object.keys(s).map(g=>parseFloat(g)).sort((g,v)=>v-g).map(g=>s[g]).map(g=>{let v=pse({participantIds:g,...t});return a.push(...v.report??[]),v.order}).map((g,v)=>g.map(y=>y.resolved?y:{...y,subGroup:[v].concat(...y.subGroup??[])})).flat(),c,u=0,d=1,p;l.forEach((g,v)=>{var b;v&&(g.resolved||p&&!g.resolved)&&(d+=1),p=g.resolved;let y=parseInt(((b=g.subGroup)==null?void 0:b.join(""))||0);g.resolved?(g.position=v+1,d=g.position):(c&&y>c&&(d+=u,u=0),g.position=d,u+=1),c=y});let h=l.map(({position:g})=>g),f=Pl(h);return l.forEach(g=>{let{participantId:v,position:y}=g||{},b=i[v];g.GEMscore=m(b);let I=f[y];(g==null?void 0:g.position)!==void 0&&(I>1&&(g.ties=I,n&&(g.subOrder=n[v])),g.rankOrder=y,g.groupOrder=y+(g.subOrder||1)-1)}),{groupOrder:l,report:a.flat(1/0).filter(Boolean)};function m(g){return(Array.isArray(r==null?void 0:r.GEMscore)?Object.keys(xB).filter(v=>r.GEMscore.includes(v)):Object.keys(xB)).map(v=>(g[v]||0)*Math.pow(10,xB[v].toFixed(3))).reduce((v,y)=>v+y,0)}}function a_e({participantResults:t,participantsCount:e}){let i=dse({participantResults:t}).filter(n=>e-1===n.results.matchUpsWon+n.results.matchUpsLost+n.results.matchUpsCancelled);return e===i.length}function o_e({disableHeadToHead:t,participantIds:e,matchUpFormat:i,tallyPolicy:n,attribute:r,idsFilter:a,matchUps:o,reversed:s}){let{participantResults:l}=qC({participantIds:a&&e,matchUpFormat:i,tallyPolicy:n,matchUps:o}),c=use({participantResults:l,participantIds:e,attribute:r}),u=[{attribute:r,reversed:s,groups:c,idsFilter:a}],d;return Object.keys(c).length>1&&e.length&&(d=Object.keys(c).map(p=>parseFloat(p)).sort((p,h)=>s?p-h:h-p).map(p=>c[p]).map(p=>{let h=pse({participantResults:l,disableHeadToHead:t,participantIds:p,matchUpFormat:i,tallyPolicy:n,matchUps:o});return u.push(...h.report??[]),h.order}).map((p,h)=>p.map(f=>f.resolved?f:{...f,subGroup:[h].concat(...f.subGroup??[])})).flat()),{order:d,report:u}}function pse({participantResults:t,disableHeadToHead:e,participantIds:i,matchUpFormat:n,tallyPolicy:r,matchUps:a}){let o=[],s=[],l;if((i==null?void 0:i.length)===1)return{order:[{resolved:!0,participantId:i[0]}]};if((i==null?void 0:i.length)===2&&(!(r!=null&&r.headToHead)||!r.headToHead.disabled&&!e)){let u=s_e({participantIds:i,participantResults:t});if(u){let d=u[0].participantId;return s.push({attribute:"head2Head",participantIds:i,headToHeadWinner:d}),{order:u,headToHeadWinner:d,report:s}}}let c=((r==null?void 0:r.tallyDirectives)||r_e).filter(u=>{let d=!(Rr(u.maxParticipants)&&(i==null?void 0:i.length)>u.maxParticipants);return d||o.push(u),d});return o.length&&s.push({excludedDirectives:o,participantIds:i}),c.every(({attribute:u,reversed:d,idsFilter:p,disableHeadToHead:h})=>(l=o_e({disableHeadToHead:h,participantIds:i,matchUpFormat:n,tallyPolicy:r,attribute:u,idsFilter:p,matchUps:a,reversed:d}),s.push(l.report),!l.order)),l.order?{order:l.order,report:s}:{order:i==null?void 0:i.map(u=>({participantId:u})),report:s}}function s_e({participantIds:t,participantResults:e}){if(t){if(e[t[0]].victories.includes(t[1]))return t.map(i=>({resolved:!0,participantId:i}));if(e[t[1]].victories.includes(t[0]))return t.reverse().map(i=>({resolved:!0,participantId:i}))}}function HT({policyDefinitions:t,generateReport:e,pressureRating:i,matchUpFormat:n,matchUps:r=[],subOrderMap:a,perPlayer:o}){if(!(r!=null&&r.length)||!Kc(r))return{error:Xf};let s=Pi(r.map(({structureId:I})=>I));if(s.length!==1)return pe({result:{error:Re,info:"Maximum one structureId"},stack:"tallyParticipantResults",context:{structureIds:s}});let l=r.filter(I=>I&&I.matchUpStatus!==vn),c=l.length&&Pi(l.map(({drawPositions:I})=>I).flat()).length,u=l.filter(I=>Rv({matchUp:I})).length===l.length;u||(o=0);let d=r.every(({matchUpType:I,tieMatchUps:T})=>I===Xn&&(T==null?void 0:T.every(w=>Rv({matchUp:w})))),p=t==null?void 0:t[Sz],h=r.filter(I=>Rv({matchUp:I})||I.matchUpType===Xn),{participantResults:f}=qC({matchUps:h,pressureRating:i,matchUpFormat:n,tallyPolicy:p,perPlayer:o}),m,g,{groupOrder:v,report:y}=sY({matchUps:h,participantResults:f,participantsCount:c,matchUpFormat:n,tallyPolicy:p,subOrderMap:a});if(i&&l_e({participantResults:f}),u&&v)m=y,g=v,v.forEach(I=>{let{participantId:T,groupOrder:w,rankOrder:S,subOrder:D,ties:E,GEMscore:C}=I,P=f[T];Object.assign(P,{groupOrder:w,rankOrder:S,GEMscore:C,subOrder:D,ties:E})});else{let{groupOrder:I,report:T}=sY({requireCompletion:!1,participantResults:f,participantsCount:c,matchUpFormat:n,tallyPolicy:p,subOrderMap:a,matchUps:r});m=T,g=I,I&&I.forEach(w=>{let{participantId:S,groupOrder:D,GEMscore:E}=w,C=f[S];Object.assign(C,{provisionalOrder:D,GEMscore:E})})}let b={completedTieMatchUps:d,readableReport:"",participantResults:f,bracketComplete:u,order:[],report:m};if((u||d)&&(b.order=g),e||Jl({tally:!0})){let I=n_e({matchUps:r,report:m,order:g});Jl({tally:!0})&&console.log(I),b.readableReport=I}return b}function l_e({participantResults:t}){let e=r=>r.reduce((a,o)=>a+parseFloat(o),0),i=r=>parseFloat((e(r)/r.length).toFixed(2)),n=Object.keys(t).map(r=>{let a=t[r],{pressureScores:o}=a,s=o!=null&&o.length?i(o):0;return{participantId:r,averagePressure:s}}).sort((r,a)=>(a.averagePressure||0)-(r.averagePressure||0)).map((r,a)=>({...r,order:a+1}));for(let r of n)t[r.participantId].pressureOrder=r.order}function hse({positionAssignments:t}){let e=(t||[]).filter(Ml(gh)).map(r=>{let{extension:a}=Ri({element:r,name:dS}),o=ri(a==null?void 0:a.value),s=!isNaN(o)&&o;return s&&{participantId:r.participantId,subOrder:s}}).filter(Boolean),i=e.map(({subOrder:r})=>r),n=Pl(i);return{subOrderMap:Object.assign({},...e.filter(({subOrder:r})=>n[r]===1).map(({participantId:r,subOrder:a})=>({[r]:a})))}}function Gq({positionAssignments:t,tournamentRecord:e,drawDefinition:i,matchUpFormat:n,matchUps:r,event:a}){if(!Kc(r))return{error:Re};if(!t)return{error:Re};let{policyDefinitions:o}=em({policyTypes:[Sz],tournamentRecord:e,drawDefinition:i,event:a}),{subOrderMap:s}=hse({positionAssignments:t}),l=r.length?HT({policyDefinitions:o,matchUpFormat:n,subOrderMap:s,matchUps:r}):void 0;if(l!=null&&l.error)return l;let{participantResults:c={},bracketComplete:u,report:d}=l??{},p=Object.keys(c);return t.forEach(h=>{let{participantId:f}=h;if(p.includes(f)){let m={value:c[f],name:qm};cn({element:h,extension:m}),c[f].ties||Is({element:h,name:dS})}else Is({element:h,name:qm}),Is({element:h,name:dS})}),qn({drawDefinition:i}),{...ce,participantResults:c,bracketComplete:u,report:d}}function fse({matchUps:t,matchUpId:e}){return{matchUp:(t||[]).find(i=>i.matchUpId===e)}}function nr(t){let e=di(t,[{[_s]:!0,[Cp]:!0}]);if(e.error)return e;let{tournamentParticipants:i,afterRecoveryTimes:n,contextProfile:r,drawDefinition:a,matchUpsMap:o,matchUpId:s,inContext:l,context:c,event:u}=t,{structures:d=[]}=Ru({drawDefinition:a}),p=t.contextContent||r&&tm({contextProfile:r,drawDefinition:a});for(let h of d){let{matchUps:f}=wn({tournamentParticipants:i,afterRecoveryTimes:n,contextContent:p,drawDefinition:a,contextProfile:r,matchUpsMap:o,inContext:l,structure:h,context:c,event:u}),{matchUp:m}=fse({matchUps:f,matchUpId:s});if(m)return{matchUp:m,structure:h}}return{error:Ho}}function Ox(t){var e;return!Xi(t)||!t.notes?{error:Yt}:Xi(t.element)?!$r(t.notes)&&!((e=t.notes)!=null&&e.testing)?{error:Re}:(Object.assign(t.element,{notes:t.notes}),{...ce}):{error:Re}}function Hq(t){return Xi(t)?Xi(t.element)?(t.element.notes&&delete t.element.notes,{...ce}):{error:Re}:{error:Yt}}var Lx={matchUpStatus:qr,matchUpStatusCodes:[],score:{scoreStringSide1:"",scoreStringSide2:"",sets:void 0},matchUpFormat:void 0,winningSide:void 0};function tp(t){var D,E,C,P,R,N,M,A;let e="modifyMatchUpScore",i=t.matchUpFormat,n=t.matchUp,r,{matchUpStatusCodes:a,removeWinningSide:o,tournamentRecord:s,drawDefinition:l,matchUpStatus:c,removeScore:u,winningSide:d,matchUpId:p,event:h,notes:f,score:m}=t,g=t.appliedPolicies&&Object.keys(t.appliedPolicies).length?t.appliedPolicies:(D=dn({policyTypes:[Bc],tournamentRecord:s,drawDefinition:l,structure:r,event:h}))==null?void 0:D.appliedPolicies,v=n.matchUpType===Xn;if(v&&l){if(p&&n.matchUpId!==p){let _=nr({drawDefinition:l,matchUpId:p,event:h});if(!_.matchUp)return{error:Ho};({matchUp:n,structure:r}=_)}}else n.matchUpId!==p&&console.log("!!!!!");c&&[hn,ua].includes(c)||u?Object.assign(n,{...Lx}):m&&(n.score=m);let y=c&&(n==null?void 0:n.matchUpStatus)===Zi&&c!==Zi;c&&(n.matchUpStatus=c),i&&(n.matchUpFormat=i),a&&(n.matchUpStatusCodes=a),d&&(n.winningSide=d),o&&(n.winningSide=void 0),!r&&l&&({structure:r}=nr({drawDefinition:l,matchUpId:p,event:h})),c&&!n.winningSide&&Pa(n)&&!ba.includes(c)&&![LI,Dg].includes(c)&&(n.matchUpStatus=Lu);let b;if((y&&((E=n==null?void 0:n.processCodes)!=null&&E.length)||c===Zi)&&(b=(P=(C=g==null?void 0:g[Bc])==null?void 0:C.processCodes)==null?void 0:P.incompleteAssignmentsOnDefault),!n.collectionId){let _=(r==null?void 0:r.structureType)===As,x=sl({structure:r});if(uq({drawDefinition:l,structure:r})||x||_){let O=G=>{i=v?"SET1-S:T100":i??n.matchUpFormat??(G==null?void 0:G.matchUpFormat)??(l==null?void 0:l.matchUpFormat)??(h==null?void 0:h.matchUpFormat);let H=v?{matchUpTypes:[Xn]}:void 0,{matchUps:$}=wn({afterRecoveryTimes:!1,tournamentRecord:s,inContext:!0,matchUpFilters:H,drawDefinition:l,structure:G,event:h});return x&&(G.positionAssignments=Pi($.flatMap(q=>(q.sides??[]).map(z=>z.participantId)).filter(Boolean)).map(q=>({participantId:q}))),Gq({positionAssignments:G.positionAssignments,tournamentRecord:s,drawDefinition:l,matchUpFormat:i,matchUps:$,event:h})},B=_&&r.structures.find(G=>G==null?void 0:G.matchUps.find(H=>H.matchUpId===p)),F=O(B||r);if(F.error)return pe({result:F,stack:e})}}if(f){let _=Ox({element:n,notes:f});if(_.error)return pe({result:_,stack:e})}let I=s==null?void 0:s.tournamentId,T=rc().topics.includes(hx),w=(T||b)&&Ao({drawDefinition:l}),S=w&&((R=Ia({matchUpFilters:{matchUpIds:[p]},nextMatchUps:!0,tournamentRecord:s,inContext:!0,drawDefinition:l,matchUpsMap:w}).matchUps)==null?void 0:R[0]);if(T&&S&&tMe({tournamentId:I,inContextMatchUp:S}),Array.isArray(b)&&S&&!((N=S.sides)!=null&&N.every(({participantId:_})=>_)))if(c===Zi)n.processCodes=Pi([...n.processCodes??[],...b]);else for(let _ of b||[]){let x=_&&((M=n==null?void 0:n.processCodes)==null?void 0:M.lastIndexOf(_));(A=n==null?void 0:n.processCodes)==null||A.splice(x,1)}return en({eventId:h==null?void 0:h.eventId,context:e,drawDefinition:l,tournamentId:I,matchUp:n}),{...ce}}function zq(t){var h,f,m,g;let{matchUpStatusCodes:e,matchUpStatus:i,structure:n,matchUp:r,dualMatchUp:a,inContextMatchUp:o}=t,s=NC({matchUpStatus:i})||[Rp,ol].includes(i)&&a,l=((h=r==null?void 0:r.sides)==null?void 0:h.map(v=>v.participantId).filter(Boolean).length)||((f=o==null?void 0:o.sides)==null?void 0:f.map(v=>v.participantId).filter(Boolean).length),c="attemptToModifyScore";if(!(sl({structure:n})&&l===1||i===Zi&&l||c_e({structure:n,matchUp:r,inContextMatchUp:o})||((g=(m=t.appliedPolicies)==null?void 0:m[Bc])==null?void 0:g.requireParticipantsForScoring)===!1))return pe({result:{error:_H},stack:c});let u=[hn].includes(i),d=s?i:t.winningSide&&jr||$c,p=tp({...t,matchUpStatusCodes:s&&e||[],matchUpStatus:d,context:c,removeScore:u});return pe({result:p,stack:c})}function c_e({structure:t,matchUp:e,inContextMatchUp:i}){var s;let{drawPositions:n}=e,{positionAssignments:r}=ja({structure:t}),a=r==null?void 0:r.filter(l=>(n==null?void 0:n.includes(l.drawPosition))&&l.participantId),o=(s=i==null?void 0:i.sides)==null?void 0:s.every(l=>l.participantId);return(a==null?void 0:a.length)===2||o}function mse({collectionGroups:t=[]}){let e=Object.assign({},...t.filter(n=>yi(n==null?void 0:n.groupValue)&&(n==null?void 0:n.groupNumber)).map(n=>({[n.groupNumber]:{...n,allGroupMatchUpsCompleted:!0,matchUpsCount:0,sideWins:[0,0],values:[0,0]}}))),i=Object.keys(e).map(n=>ri(n));return{groupValueGroups:e,groupValueNumbers:i}}function u_e({collectionDefinition:t,groupValueNumbers:e,groupValueGroups:i,sideTieValues:n,tieMatchUps:r}){let a=r.filter(y=>y.collectionId===t.collectionId),o=[0,0],s=[0,0],l=a.every(y=>ba.includes(y.matchUpStatus)),{collectionValueProfiles:c,collectionGroupNumber:u,collectionValue:d,matchUpValue:p,winCriteria:h,scoreValue:f,setValue:m}=t,g=u&&e.includes(u),v=[0,0];if(a.forEach(y=>{y.winningSide&&(v[y.winningSide-1]+=1)}),yi(p)?a.forEach(y=>{y.winningSide&&(o[y.winningSide-1]+=p)}):yi(m)?a.forEach(y=>{var b,I;(I=(b=y.score)==null?void 0:b.sets)==null||I.forEach(T=>{T.winningSide&&(o[T.winningSide-1]+=m)})}):yi(f)?a.forEach(y=>{var b,I;(I=(b=y.score)==null?void 0:b.sets)==null||I.forEach(T=>{let{side1TiebreakScore:w=0,side2TiebreakScore:S=0,side1Score:D=0,side2Score:E=0}=T;(y.matchUpStatus===jr||y.winningSide||T.winningSide)&&(D||E?(o[0]+=D,o[1]+=E):(w||S)&&T.winningSide&&(o[T.winningSide-1]+=1))})}):Array.isArray(c)&&a.forEach(y=>{if(y.winningSide){let b=y.collectionPosition,I=d_e({collectionDefinition:t,collectionPosition:b});yi(I)&&(o[y.winningSide-1]+=I)}}),yi(d)){let y;if(h!=null&&h.aggregateValue)l&&(yi(p||m||f)&&o[0]!==o[1]?y=o[0]>o[1]?1:2:v[0]!==v[1]&&(y=v[0]>v[1]?1:2));else if(h!=null&&h.valueGoal)y=o.reduce((b,I,T)=>I>=h.valueGoal?T+1:b,0);else{let b=Math.floor(t.matchUpCount/2)+1;y=v.reduce((I,T,w)=>T>=b?w+1:I,0)}y&&(g?i[u].values[y-1]+=d:s[y-1]+=d)}else g?(i[u].values[0]+=o[0]||0,i[u].values[1]+=o[1]||0):s=o;g?(i[u].sideWins[0]+=v[0]||0,i[u].sideWins[1]+=v[1]||0,i[u].allGroupMatchUpsCompleted=i[u].allGroupMatchUpsCompleted&&l,i[u].matchUpsCount+=a.length):s.forEach((y,b)=>n[b]+=y||0)}function d_e({collectionDefinition:t,collectionPosition:e}){var i,n;return(n=(i=t.collectionValueProfiles||[])==null?void 0:i.find(r=>r.collectionPosition===e))==null?void 0:n.matchUpValue}function gse({collectionValueProfiles:t,matchUpCount:e}){let i=[];if(!Array.isArray(t))return i.push(`collectionValueProfiles is not an array: ${t}`),{errors:i};if(t.length&&t.length!==e)return i.push("collectionValueProfiles do not align with matchUpsCount"),{errors:i};for(let r of t){if(typeof r!="object")return i.push(`valueProfile is not type object: ${r}`),{errors:i};let{matchUpValue:a,collectionPosition:o}=r;if(typeof a!="number"||typeof o!="number"||o>e||o<1)return i.push("Invalid value profile: value and collectionPosition must be numeric. collectionPosition cannot be greater than matchUpCount"),{errors:i}}let n=t.map(r=>r.collectionPosition);return n.length!==Pi(n).length?(i.push("collectionPositions are not unique"),{errors:i}):{...ce}}var p_e="MIXED events can not contain mixed singles or { gender: ANY } collections",h_e="events with { gender: ANY } can not contain MIXED singles collections";function Fx(t){let e="tieFormatGenderValidityCheck",{referenceGender:i,matchUpType:n,gender:r}=t;return i&&r&&[Gn,hr].includes(i)&&i!==r?pe({result:{valid:!1,error:A1},context:{gender:r},stack:e}):i===nl&&(r===Id||r===nl&&n!==zn)?pe({result:{error:A1,valid:!1},info:p_e,stack:e}):i===Id&&r===nl&&n!==zn?pe({result:{error:A1,valid:!1},info:h_e,stack:e}):{valid:!0}}function Bx(t,e){if((t!=null&&t.bestOf||t!=null&&t.exactly)&&(t!=null&&t.setFormat))return f_e(t,e)}function VD(t){return!isNaN(Number(t))&&Number(t)}function vse(t){let e=`T${t.minutes}`;return t.based&&(e+=t.based),t.modifier&&(e+=`@${t.modifier}`),e}function f_e(t,e){var u;let i=VD(t.bestOf)||void 0,n=VD(t.exactly)||void 0,r=i||n;if((u=t.setFormat)!=null&&u.timed&&t.simplified&&r===1)return vse(t.setFormat);let a=r&&`${SN}${r}`||"",o=lY(t.setFormat,e),s=o&&`S:${o}`||"",l=lY(t.finalSetFormat,e),c=r&&r>1&&l&&o!==l&&`F:${l}`||"";if(a&&o)return[a,s,c].filter(d=>d).join("-")}function lY(t,e){if(typeof t=="object"&&Object.keys(t).length){if(t.timed)return vse(t);if(t.tiebreakSet)return cY(t.tiebreakSet);let i=VD(t.setTo);if(i){let n=t.NoAD&&pq||"",r=cY(t.tiebreakFormat),a=r&&`/${r}`||"",o=VD(t.tiebreakAt),s=o&&(o!==i||e)&&`@${o}`||"";if(r!==!1)return`${i}${n}${a}${s}`}}}function cY(t){if(t){if(typeof t=="object"&&!t.tiebreakTo)return"";if(typeof t=="object"&&VD(t.tiebreakTo)){let e=`TB${t.tiebreakTo}${t.NoAD?pq:""}`;return t.modifier&&(e+=`@${t.modifier}`),e}else return!1}}function Nl({matchUpFormat:t}){if(!$r(t)||t==="")return!1;let e=Ys(t),i=t.match(/-S:([1-9])+\/TB([0-9]{1,2})@?([1-9]?)*/),n=i==null?void 0:i[1],r=i==null?void 0:i[2],a=i==null?void 0:i[3],o=t.match(/-F:([1-9])+\/TB([0-9]{1,2})@?([1-9]?)*/),s=o==null?void 0:o[1],l=o==null?void 0:o[2],c=o==null?void 0:o[3];return Bx(e,!!(i&&r&&n===a||o&&l&&s===c))===t}var m_e=(t,e)=>t.filter(Boolean).every(i=>typeof i===e),g_e=t=>t.filter(Boolean).every(Rr);function eI(t){let e=t.category;if(typeof e!="object")return{error:ID};let{ageCategoryCode:i,ageMaxDate:n,ageMinDate:r,ageMax:a,ageMin:o}=e,s=e.categoryName,l;if(!m_e([i,n,r,s],"string")||!g_e([a,o]))return{error:ID};let c=t.consideredDate??Ei(new Date().toLocaleDateString("sv"));if(!Dl(c))return{error:Xa};let[u]=c.split("-").slice(0,3).map(B=>parseInt(B)),d=v1(c,-1),[p,h]=d.split("-").slice(1,3).map(B=>parseInt(B)),f=`${Tc(p)}-${Tc(h)}`,m=v1(c,1),[g,v]=m.split("-").slice(1,3).map(B=>parseInt(B)),y=`${Tc(g)}-${Tc(v)}`,b=o&&v1(c,-1*365*o),I=a&&v1(c,-1*365*a),T=[],w=B=>!T.includes(B)&&T.push(B);i=i??s;let S=/^([UO]?)(\d{1,2})([UO]?)$/,D=/^C(\d{1,2})-(\d{1,2})$/,E=i==null?void 0:i.includes("-"),C=E&&(i==null?void 0:i.match(D)),P=i==null?void 0:i.match(S),R=(B,F)=>`${B}-${F}`,N=B=>{let F=u-B,G=R(F,y);e.ageMinDate&&e.ageMinDate!==G&&w(`Invalid submitted ageMinDate: ${r}`),r=G,i&&(e.ageMax&&e.ageMax!==B-1&&(w(`Invalid submitted ageMax: ${a}`),I=void 0),a=B-1)},M=B=>{let F=u-B-1,G=R(F,y);e.ageMin&&e.ageMin>B&&w(`Invalid submitted ageMin: ${o}`),e.ageMax&&e.ageMax>B&&w(`Invalid submitted ageMax: ${a}`),e.ageMinDate&&e.ageMinDate!==G&&w(`Invalid submitted ageMinDate: ${r}`),r=G,i&&(e.ageMax&&e.ageMax!==B&&(w(`Invalid submitted ageMax: ${a}`),b=void 0),a=B)},A=B=>{let F=u-B,G=R(F,f);e.ageMaxDate&&e.ageMaxDate!==G&&w(`Invalid submitted ageMaxDate: ${n}`),n=G,i&&(e.ageMin&&e.ageMin!==B+1&&(w(`Invalid submitted ageMin: ${o}`),b=void 0),o=B+1)},_=B=>{let F=u-B-1,G=R(F,f);e.ageMaxDate&&e.ageMaxDate!==G&&w(`Invalid submitted ageMaxDate: ${n}`),n=G,i&&(e.ageMin&&e.ageMin!==B&&(w(`Invalid submitted ageMin: ${o}`),b=void 0),o=B)},x=B=>{let[F,G,H]=(B.match(S)||[]).slice(1),$=parseInt(G);F==="U"?(e.ageMaxDate&&e.ageMaxDate!==n&&w(`Invalid submitted ageMaxDate: ${e.ageMaxDate}`),N($)):F==="O"&&A($),H==="U"?(e.ageMaxDate&&e.ageMaxDate!==n&&w(`Invalid submitted ageMaxDate: ${e.ageMaxDate}`),M($)):H==="O"&&_($),n=n??b,r=r??I};if(C){if(n=void 0,r=void 0,a=void 0,o=void 0,e.ageMin){let G=u-e.ageMin;n=R(G,f)}if(e.ageMax){let G=u-e.ageMax-1;r=R(G,y)}let[B,F]=((i==null?void 0:i.match(D))??[]).slice(1).map(G=>parseInt(G));B<=F?(o=B,a=F,l=!0):w(`Invalid combined age range ${i}`)}else E?i==null||i.split("-").forEach(x):P?x(i):(o&&A(o),a&&M(a));a&&e.ageMin&&e.ageMin>a&&(w(`Invalid submitted ageMin: ${e.ageMin}`),o=void 0);let O=zt({consideredDate:c,combinedAge:l,ageMaxDate:n,ageMinDate:r,ageMax:a,ageMin:o});return T.length&&(O.errors=T),O}function jD({category:t}){if(!Xi(t))return{error:Re};let e=eI({category:t});if(e.error)return{error:e};let{ratingMax:i,ratingMin:n}=t;return i&&!Rr(i)?pe({result:{error:Re},context:{ratingMax:i}}):n&&!Rr(n)?pe({result:{error:Re},context:{ratingMin:n}}):{...e}}function WC({childCategory:t,withDetails:e,category:i}){let n=jD({category:i}),r=jD({category:t}),a=r.ageMin&&(n.ageMin&&r.ageMin<n.ageMin||n.ageMax&&r.ageMin>n.ageMax),o=r.ageMax&&(n.ageMax&&r.ageMax>n.ageMax||n.ageMin&&r.ageMax<n.ageMin),s=r.ageMinDate&&n.ageMaxDate&&new Date(r.ageMinDate)>new Date(n.ageMaxDate),l=r.ageMaxDate&&n.ageMinDate&&new Date(r.ageMaxDate)<new Date(n.ageMinDate),c=(i==null?void 0:i.ratingType)&&(t==null?void 0:t.ratingType)&&i.ratingType===t.ratingType&&(i.ratingMin&&t.ratingMin&&t.ratingMin<i.ratingMin||i.ratingMax&&t.ratingMax&&t.ratingMax>i.ratingMax||i.ratingMin&&t.ratingMax&&t.ratingMax<i.ratingMin||i.ratingMax&&t.ratingMin&&t.ratingMin>i.ratingMax),u=(i==null?void 0:i.ballType)&&(t==null?void 0:t.ballType)&&i.ballType!==t.ballType,d=zt({invalidRatingRange:c,invalidAgeMinDate:s,invalidAgeMaxDate:l,invalidBallType:u,invalidAgeMax:o,invalidAgeMin:a,valid:!c&&!s&&!l&&!u&&!o&&!a},!0);return e&&Object.assign(d,{categoryDetails:n,childCategoryDetails:r}),d}function KC({checkCategory:t=!0,collectionDefinition:e,checkCollectionIds:i,checkGender:n=!0,referenceCategory:r,referenceGender:a,event:o}){a=a??(o==null?void 0:o.gender);let s="validateCollectionDefinition",l=[];if(typeof e!="object")return l.push(`collectionDefinition must be an object: ${e}`),pe({result:{errors:l,error:Jf},stack:s});let{collectionValueProfiles:c,collectionGroupNumber:u,collectionValue:d,collectionId:p,matchUpCount:h,matchUpFormat:f,matchUpValue:m,matchUpType:g,scoreValue:v,setValue:y,category:b,gender:I}=e;if(i&&typeof p!="string"&&l.push(`collectionId is not type string: ${p}`),typeof h!="number"&&l.push(`matchUpCount is not type number: ${h}`),g&&!Ex([or,zn],g)&&l.push(`matchUpType must be SINGLES or DOUBLES: ${g}`),[!!(c!=null&&c.length)].concat([m,d,v,y].map(yi)).filter(Boolean).length!==1&&l.push("Missing value definition for matchUps: matchUpValue, collectionValue, or collectionValueProfiles"),m&&typeof m!="number"&&l.push(`matchUpValue is not type number: ${m}`),d&&typeof d!="number"&&l.push(`collectionValue is not type number: ${d}`),c&&h){let T=gse({collectionValueProfiles:c,matchUpCount:h});T.errors&&l.push(...T.errors)}if(u&&typeof u!="number"&&l.push(`collectionGroupNumber is not type number: ${d}`),f&&!Nl({matchUpFormat:f})&&l.push(`Invalid matchUpFormat: ${f}`),n){let T=Fx({referenceGender:a,matchUpType:g,gender:I});if(T.error)return pe({context:{referenceGender:a,gender:I},result:T,stack:s})}if(t&&r&&b){let T=WC({category:r,childCategory:b});if(!T.valid)return pe({result:{error:ID},context:T,stack:s})}return l.length?pe({result:{errors:l,error:Qne},stack:s}):{valid:!0}}function ll(t){var g,v,y,b;let e=!!((t==null?void 0:t.enforceCategory)!==!1&&(t!=null&&t.category)),i=!!((t==null?void 0:t.enforceGender)!==!1&&(t!=null&&t.gender)),n=t==null?void 0:t.checkCollectionIds,r=t==null?void 0:t.tieFormat,a=t==null?void 0:t.event,o="validateTieFormat",s=[],l=v_e({...t,stack:o});if(l!=null&&l.error)return l;let c,u=r.collectionDefinitions.every(I=>{let{setValue:T,scoreValue:w,collectionValue:S}=I;(T||w)&&!S&&(c=!0);let{valid:D,errors:E}=KC({referenceCategory:t.category,referenceGender:t.gender,collectionDefinition:I,checkCollectionIds:n,checkCategory:e,checkGender:i,event:a});return D?!0:(Array.isArray(E)&&s.push(...E),!1)}),d=typeof((g=r.winCriteria)==null?void 0:g.valueGoal)=="number"&&((v=r.winCriteria)==null?void 0:v.valueGoal)>0&&!c||((y=r.winCriteria)==null?void 0:y.aggregateValue);if(!(d||(b=r.winCriteria)!=null&&b.aggregateValue))return c?s.push("aggregateValue is required"):s.push("Either non-zero valueGoal, or { aggregateValue: true } must be specified in winCriteria"),pe({context:{tieFormat:r,errors:s,aggregateValueImperative:c},result:{error:mf},stack:o});let p=r.collectionDefinitions.map(({collectionId:I})=>I),h=!n||p.length===Pi(p).length,f=u&&d&&h;return f?{valid:f,errors:s}:pe({result:{error:mf},context:{tieFormat:r,errors:s},stack:o})}function v_e(t){let{tieFormat:e,stack:i}=t;return!t||!e||!Xi(e)?pe({result:{error:mf},context:{tieFormat:e,message:"tieformat must be an object"},stack:i}):Xi(e.winCriteria)?Array.isArray(e.collectionDefinitions)?{...ce}:pe({result:{error:mf},context:{tieFormat:e,message:"collectionDefinitions must be an array"},stack:i}):pe({result:{error:mf},context:{tieFormat:e,message:"tieformat.winCritiera must be an object"},stack:i})}function YC(t){var I,T,w,S,D;let{sideAdjustments:e=[0,0],separator:i="-",drawDefinition:n,matchUpsMap:r,structure:a,matchUp:o,event:s}=t;if(!Array.isArray(e)||e.length!==2||isNaN(e.reduce((E,C)=>E+C)))return{error:Re};if(!o)return{error:rl};let l=((I=is({matchUp:o,drawDefinition:n,structure:a,event:s}))==null?void 0:I.tieFormat)||(t==null?void 0:t.tieFormat);if(!l)return{error:IT};let c=ll({tieFormat:l});if(c.error)return c;let u=(l==null?void 0:l.collectionDefinitions)||[],d=(o==null?void 0:o.tieMatchUps)??[],p=[0,0],{groupValueGroups:h,groupValueNumbers:f}=mse(l);for(let E of u)u_e({collectionDefinition:E,groupValueNumbers:f,groupValueGroups:h,sideTieValues:p,tieMatchUps:d});for(let E of f){let C=h[E],{allGroupMatchUpsCompleted:P,matchUpCount:R,winCriteria:N,groupValue:M,sideWins:A,values:_}=C,x;if(N!=null&&N.aggregateValue)P&&_[0]!==_[1]&&(x=_[0]>_[1]?1:2);else if(N!=null&&N.valueGoal)x=_.reduce((O,B,F)=>B>=N.valueGoal?F+1:O,void 0);else{let O=Math.floor(R/2)+1;x=A.reduce((B,F,G)=>F>=O?G+1:B,void 0)}x&&(p[x-1]+=M||0)}let m=p.map((E,C)=>(E||0)+e[C]),g={side1Score:m[0],side2Score:m[1],winningSide:void 0},v=m.join(i),y=m.slice().reverse().join(i),b;if(l!=null&&l.winCriteria){let{valueGoal:E,aggregateValue:C,tallyDirectives:P}=l.winCriteria;if(E?b=(T=m.map((R,N)=>({sideNumber:N+1,points:R})).find(({points:R})=>R>=E))==null?void 0:T.sideNumber:C&&d.every(R=>R.matchUpStatus&&ba.includes(R.matchUpStatus)||R.winningSide)&&m[0]!==m[1]&&(b=m[0]>m[1]?1:2),!b&&P){let R=o.matchUpId,N=o.hasContext?o:((w=r==null?void 0:r.drawMatchUps)==null?void 0:w[R])||n&&((S=nr({inContext:!0,drawDefinition:n,matchUpId:R}))==null?void 0:S.matchUp);if(N){let{completedTieMatchUps:M,order:A}=HT({matchUps:[N]});if(M&&(A!=null&&A.length)){let _=A[0].participantId;b=(D=N.sides.find(({participantId:x})=>x===_))==null?void 0:D.sideNumber}}}}return b&&(g.winningSide=b),{scoreStringSide1:v,scoreStringSide2:y,winningSide:b,set:g}}function ZC({inContextDualMatchUp:t,drawDefinition:e,tournamentId:i,dualMatchUp:n,eventId:r}){var a,o;if(n){t||(t=(a=nr({matchUpId:n.matchUpId,inContext:!0,drawDefinition:e}))==null?void 0:a.matchUp);let{extension:s}=Ri({element:e,name:Cf}),l=Ot((s==null?void 0:s.value)||{},!1,!0),c=({displaySideNumber:u,drawPosition:d,sideNumber:p})=>({drawPosition:d,sideNumber:p,displaySideNumber:u});n.sides=(o=t==null?void 0:t.sides)==null?void 0:o.map(u=>{var g;let d=u.participantId,p=d&&l[d]||void 0,{lineUp:h,...f}=((g=n.sides)==null?void 0:g.find(({sideNumber:v})=>v===u.sideNumber))??{},m=h!=null&&h.length?h:p;return{...c(u),...f,lineUp:m}}),en({context:"ensureSidLineUps",matchUp:n,drawDefinition:e,tournamentId:i,eventId:r})}}function wo(t){if(t)return Ot(t,!1,!0)}function qq(t){let e=di(t,[{[zo]:!0}]);return e.error?e:Object.keys(t.tournamentRecords).reduce((i,n)=>{i.tournamentIdMap[n]=[];let r=t.tournamentRecords[n].events??[],a=r.map(({eventId:s})=>s),o=r.map(s=>(s.drawDefinitions??[]).map(({drawId:l})=>l)).flat();return i.tournamentIdMap[n].push(...a,...o),i.eventIds.push(...a),i.drawIds.push(...o),i},{eventIds:[],drawIds:[],tournamentIdMap:{}})}function yse({tournamentRecords:t,eventId:e,drawId:i}){let{tournamentIdMap:n}=qq({tournamentRecords:t});return(n?Object.keys(n):[]).find(r=>e&&(n==null?void 0:n[r].includes(e))||i&&(n==null?void 0:n[r].includes(i)))}function im(t){var R,N,M,A;let{exitWhenNoValues:e,drawDefinition:i,matchUpStatus:n,removeScore:r,matchUpsMap:a,matchUpId:o,event:s}=t,l=t.tournamentRecords||t.tournamentRecord&&{[(R=t.tournamentRecord)==null?void 0:R.tournamentId]:t.tournamentRecord}||{},c=t.tournamentId||((N=t.tournamentRecord)==null?void 0:N.tournamentId);l&&yse({tournamentRecords:l,...t});let u=c&&l[c];if(!u)return{error:ut};let d=nr({drawDefinition:i,event:s,matchUpId:o});if(d.error)return d;if(!d.matchUp)return{error:Ho};let{matchUp:p,structure:h}=d;if(!p.tieMatchUps)return{error:al};ZC({tournamentId:u==null?void 0:u.tournamentId,eventId:s==null?void 0:s.eventId,dualMatchUp:p,drawDefinition:i});let{extension:f}=Ri({name:Yb,element:p});if(f!=null&&f.value)if(r)Is({element:p,name:Yb});else return{...ce,score:p.score};let m=(M=is({drawDefinition:i,structure:h,matchUp:p,event:s}))==null?void 0:M.tieFormat;p.tieFormat=wo(m);let g=YC({drawDefinition:i,matchUpsMap:a,structure:h,matchUp:p,event:s}),{winningSide:v,set:y,scoreStringSide1:b,scoreStringSide2:I}=g,T=(y==null?void 0:y.side1Score)||(y==null?void 0:y.side2Score);if(e&&!p.score&&!T)return{...ce};let w={scoreStringSide1:b,scoreStringSide2:I,sets:y?[y]:[]},S=v&&[1,2].includes(v),D=S&&jr||hq({matchUpStatus:n??p.matchUpStatus,tieMatchUps:p.tieMatchUps,winningSide:p.winningSide,score:w})&&Lu||qr,E=!!(p.winningSide&&!S),C=p.tieMatchUps.find(({score:_,winningSide:x,matchUpStatus:O})=>{var B;return((B=_==null?void 0:_.sets)==null?void 0:B.length)&&(_.sets[0].side1Score||_.sets[0].side2Score)||O&&ba.includes(O)||x}),P;if(p.tieFormat&&!S&&!C){let _=(A=is({drawDefinition:i,structure:h,event:s}))==null?void 0:A.tieFormat;_&&JSON.stringify(m)===JSON.stringify(_)&&(p.tieFormatId=void 0,p.tieFormat=void 0,P=!0)}return tp({appliedPolicies:t.appliedPolicies,matchUpStatus:D,score:w,removeWinningSide:E,tournamentRecord:u,drawDefinition:i,removeScore:r,winningSide:v,matchUpId:o,matchUp:p,event:s}),{...ce,score:w,removeWinningSide:E,tieFormatRemoved:P,winningSide:v}}function y_e({winnerMatchUpDrawPositionIndex:t,inContextDrawMatchUps:e,projectedWinningSide:i,sourceMatchUpStatus:n,winningDrawPosition:r,tournamentRecord:a,winnerTargetLink:o,sourceMatchUpId:s,drawDefinition:l,winnerMatchUp:c,dualMatchUp:u,matchUpsMap:d,event:p}){var f,m,g,v,y;let h="directWinner";if(o){let b=c.drawPositions||[],I=b[t],T=o.source.structureId,w=ui({structureId:T,drawDefinition:l});if(w.error)return w;let{structure:S}=w,{positionAssignments:D}=ja({structureId:T,drawDefinition:l}),E=(f=D==null?void 0:D.find(A=>A.drawPosition===r))==null?void 0:f.participantId,C=o.target.structureId,{positionAssignments:P}=ja({structureId:C,drawDefinition:l}),R=(m=P==null?void 0:P.find(A=>A.participantId===E))==null?void 0:m.drawPosition,N=P==null?void 0:P.filter(A=>{let _=b.includes(A.drawPosition),x=!A.participantId&&!A.bye&&!A.qualifier;return _&&x}).map(A=>A.drawPosition),M=N==null?void 0:N.includes(I);if(E&&o.target.roundNumber===1&&M)hp({drawPosition:I,participantId:E,structureId:C,inContextDrawMatchUps:e,sourceMatchUpStatus:n,tournamentRecord:a,drawDefinition:l,matchUpsMap:d,event:p});else if(E&&(N!=null&&N.length)){let A=N.pop();A&&hp({participantId:E,structureId:C,inContextDrawMatchUps:e,sourceMatchUpStatus:n,tournamentRecord:a,drawDefinition:l,drawPosition:A,matchUpsMap:d,event:p})}else if(R){let A=mS({drawPosition:R,matchUpId:c.matchUpId,inContextDrawMatchUps:e,sourceMatchUpStatus:n,tournamentRecord:a,sourceMatchUpId:s,drawDefinition:l,matchUpsMap:d});if(A.error)return pe({result:A,stack:h})}else if((S==null?void 0:S.stage)!==Zt){let A="winner target position unavaiallble";return console.log(A),{error:A}}if(S!=null&&S.seedAssignments&&S.structureId!==C){let A=S.seedAssignments.find(({participantId:x})=>x===E),_=A==null?void 0:A.participantId;A&&_&&jT({eventId:c==null?void 0:c.eventId,structureId:C,...A,tournamentRecord:a,drawDefinition:l,participantId:_})}}else{let b=mS({matchUpId:c.matchUpId,drawPosition:r,inContextDrawMatchUps:e,sourceMatchUpStatus:n,tournamentRecord:a,sourceMatchUpId:s,drawDefinition:l,matchUpsMap:d});if(b.error)return b}if(u&&i){let b=(g=u.sides)==null?void 0:g.find(I=>I.sideNumber===i);if(b!=null&&b.lineUp){let I=u.roundPosition,T=c.roundPosition,w=I===T&&I!==1||Math.floor(I/2)===T?2:1,S=(v=d==null?void 0:d.drawMatchUps)==null?void 0:v.find(({matchUpId:C})=>C===c.matchUpId),D=[1,2].map(C=>{var P;return{...((P=S.sides)==null?void 0:P.find(R=>R.sideNumber===C))||{},sideNumber:C}});S.sides=D;let E=S.sides.find(C=>C.sideNumber===w);if(E){let C=(y=b.lineUp)==null?void 0:y.filter(P=>P==null?void 0:P.participantId);E.lineUp=Eq({lineUp:C}),en({tournamentId:a==null?void 0:a.tournamentId,eventId:c==null?void 0:c.eventId,matchUp:S,context:h,drawDefinition:l})}}}return{...ce}}function b_e(t){var F,G,H;let{loserMatchUpDrawPositionIndex:e,inContextDrawMatchUps:i,projectedWinningSide:n,sourceMatchUpStatus:r,loserDrawPosition:a,tournamentRecord:o,loserTargetLink:s,drawDefinition:l,loserMatchUp:c,dualMatchUp:u,matchUpsMap:d,event:p}=t,h="directLoser",f=s.linkCondition,m=c.drawPositions||[],g=f===fh&&c.roundNumber===2&&Math.min(...m.filter(Boolean)),v=g||m[e],y=g||m[1-e],b=s.source.structureId,{structure:I}=ui({structureId:b,drawDefinition:l}),{matchUps:T}=wn({afterRecoveryTimes:!1,inContext:!0,drawDefinition:l,structure:I,event:p}),w=T.filter($=>{var q;return(q=$.drawPositions)==null?void 0:q.includes(a)}).filter($=>{let q=$.sides.find(Z=>Z.drawPosition===a),z=$.matchUpStatus===hn||$.matchUpStatus===Zi&&!Pa($);return(q==null?void 0:q.sideNumber)===$.winningSide&&!z}),S=f===fh&&w.length===0,{positionAssignments:D}=ja({structureId:b,drawDefinition:l}),E=(F=D==null?void 0:D.find($=>$.drawPosition===a))==null?void 0:F.participantId,C=s.target.structureId,{positionAssignments:P}=ja({structureId:C,drawDefinition:l}),R=P==null?void 0:P.filter(({drawPosition:$})=>m.includes($));if(R!=null&&R.some($=>$.participantId===E))return{...ce};let N=R==null?void 0:R.filter($=>{let q=m.includes($.drawPosition),z=!$.participantId&&!$.bye&&!$.qualifier;return q&&z}).map($=>$.drawPosition),M=N==null?void 0:N.includes(v),A=s.target.roundNumber>1&&(N==null?void 0:N.length),_=s.target.roundNumber===1&&M;if(g){let $=x();if($.error)return pe({result:$,stack:h})}else if(_){let $=B();if($.error)return pe({result:$,stack:h})}else if(E&&A){N.sort(ma);let $=N[0],q=hp({participantId:E,structureId:C,drawPosition:$,inContextDrawMatchUps:i,sourceMatchUpStatus:r,tournamentRecord:o,drawDefinition:l,matchUpsMap:d,event:p});if(q.error)return pe({result:q,stack:h})}else return pe({context:{loserDrawPosition:a,loserTargetLink:s,targetDrawPositionIsUnfilled:M},result:{error:M?vT:lPe},stack:h});if(I!=null&&I.seedAssignments&&I.structureId!==C){let $=I.seedAssignments.find(({participantId:z})=>z===E),q=$==null?void 0:$.participantId;$&&q&&jT({eventId:c==null?void 0:c.eventId,structureId:C,...$,tournamentRecord:o,drawDefinition:l,participantId:q})}if(u&&n){let $=(G=u.sides)==null?void 0:G.find(q=>q.sideNumber===3-n);if($!=null&&$.lineUp){let{roundNumber:q,eventId:z}=c,{roundPosition:Z}=u,Y=q===1?2-Z%2:1,Q=(H=d==null?void 0:d.drawMatchUps)==null?void 0:H.find(({matchUpId:re})=>re===c.matchUpId),X=[1,2].map(re=>{var me;return{...((me=Q.sides)==null?void 0:me.find(se=>se.sideNumber===re))||{},sideNumber:re}});Q.sides=X;let oe=Q.sides.find(re=>re.sideNumber===Y);oe&&(oe.lineUp=Eq({lineUp:$.lineUp}),en({tournamentId:o==null?void 0:o.tournamentId,matchUp:Q,context:h,drawDefinition:l,eventId:z}))}}return{...ce};function x(){let $="loserLinkFedFMLC";return pe(S?{result:B(),stack:$}:{result:O(),stack:$})}function O(){let $=sc({drawPosition:y,structureId:C,tournamentRecord:o,drawDefinition:l,event:p});return pe({result:$,stack:"assignLoserPositionBye"})}function B(){let $=E?hp({drawPosition:v,participantId:E,structureId:C,inContextDrawMatchUps:i,sourceMatchUpStatus:r,tournamentRecord:o,drawDefinition:l,matchUpsMap:d,event:p}):{error:ya};return pe({result:$,stack:"assignLoserDrawPosition"})}}function bse(t){var w;let e="directParticipants",i=zq(t);if(i.error)return pe({result:i,stack:e});let n=NC({matchUpStatus:t.matchUpStatus}),{dualWinningSideChange:r,projectedWinningSide:a,inContextDrawMatchUps:o,tournamentRecord:s,drawDefinition:l,matchUpStatus:c,dualMatchUp:u,matchUpsMap:d,winningSide:p,targetData:h,matchUpId:f,structure:m,matchUp:g,event:v}=t,y=!!g.collectionId,b=sl({structure:m}),I=g.drawPositions,T;if(y){let{matchUpTieId:S,matchUpsMap:D}=t,E=im({appliedPolicies:t.appliedPolicies,matchUpId:S,tournamentRecord:s,drawDefinition:l,matchUpsMap:D,event:v});if(T=E&&{tieMatchUpResult:E},I=(w=o.find(({matchUpId:C})=>C===S))==null?void 0:w.drawPositions,!r)return pe({result:{...ce,...T},stack:e})}if(b)return pe({result:{...ce,...T},stack:e});if(I){let S=a?a-1:p-1,D=1-S,E=I[S],C=I[D],{targetLinks:{loserTargetLink:P,winnerTargetLink:R,byeTargetLink:N},targetMatchUps:{winnerMatchUpDrawPositionIndex:M,loserMatchUpDrawPositionIndex:A,winnerMatchUp:_,loserMatchUp:x,byeMatchUp:O}}=h;if(_){let B=y_e({sourceMatchUpStatus:n&&c||jr,winnerMatchUpDrawPositionIndex:M,sourceMatchUpId:f,inContextDrawMatchUps:o,projectedWinningSide:a,winningDrawPosition:E,tournamentRecord:s,winnerTargetLink:R,drawDefinition:l,winnerMatchUp:_,dualMatchUp:u,matchUpsMap:d,event:v});if(B.error)return pe({result:B,stack:e})}if(x){let B=b_e({sourceMatchUpStatus:n&&c||jr,loserMatchUpDrawPositionIndex:A,sourceMatchUpId:f,inContextDrawMatchUps:o,projectedWinningSide:a,loserDrawPosition:C,tournamentRecord:s,loserTargetLink:P,drawDefinition:l,loserMatchUp:x,winningSide:p,matchUpsMap:d,dualMatchUp:u,event:v});if(B.error)return pe({result:B,stack:e})}if(O){let B=O.drawPositions||[],F=Math.min(...B.filter(Boolean)),G=N.target.structureId,H=sc({drawPosition:F,structureId:G,tournamentRecord:s,drawDefinition:l,event:v});if(H.error)return pe({result:H,stack:e})}}else return pe({result:{error:tC},stack:e});return pe({result:{...ce,...T},stack:e})}function Wq(t){var Y,Q,X,oe;let e="genPlayoffStructure";if(!t.drawDefinition)return pe({result:{error:Vt},stack:e});let i=GC(t);if(i.error)return pe({result:i,stack:e});let{structureId:n,addNameBaseToAttributeName:r,playoffStructureNameBase:a,finishingPositionNaming:o,finishingPositionLimit:s,playoffAttributes:l,playoffPositions:c,roundOffsetLimit:u,tournamentRecord:d,exitProfileLimit:p,roundProfiles:h,roundNumbers:f,idPrefix:m,isMock:g,event:v,uuids:y}=t,b=Ot(t.drawDefinition,!1,!0),{structure:I}=ui({structureId:n,drawDefinition:b});if(!I)return pe({result:{error:wr},stack:e});if(I.structureType===As||I.structures)return $Ae({sourceStructureId:I.structureId,...t,...i,drawDefinition:b});let{playoffRoundsRanges:T,playoffRounds:w}=i,{playoffPositionsReturned:S,error:D,playoffSourceRounds:E,playoffRoundsRanges:C}=Xoe(t);if(D)return pe({result:{error:D},stack:e});let P=(h==null?void 0:h.length)&&Object.assign({},...h),R=f||typeof h=="object"&&h.map(re=>Object.keys(re)).flat(),N=Array.isArray(R)&&R.map(re=>!isNaN(re)&&ri(re)).filter(Boolean);if(N){if(!Array.isArray(N))return pe({result:{error:Re},context:{validRoundNumbers:N},stack:e});N.forEach(re=>{if(!(w!=null&&w.includes(re)))return pe({result:{error:Re},context:{roundNumber:re},stack:e})})}c&&c.forEach(re=>{if(!(S!=null&&S.includes(re)))return pe({result:{error:Re},context:{playoffPosition:re},stack:e})});let M=N||E,A=N?T:C,_=[],x=[];for(let re of M??[]){let me=A==null?void 0:A.find(Te=>Te.roundNumber===re);if(!me)return pe({result:{error:Re},context:{roundNumber:re},stack:e});let se=me.finishingPositions.length,te=Math.min(...me.finishingPositions)-1,he=2,ae=re&&(P==null?void 0:P[re])&&he+P[re]-1,de=V0({exitProfile:`0-${re}`,addNameBaseToAttributeName:r,playoffStructureNameBase:a,finishingPositionOffset:te,playoffAttributes:l,exitProfileLimit:p,stage:Fr,roundOffset:0,drawDefinition:b,sequenceLimit:ae,stageSequence:he,drawSize:se,idPrefix:m,isMock:g,uuids:y,finishingPositionNaming:o,finishingPositionLimit:s,roundOffsetLimit:u});if(de.error)return pe({result:de,stack:e});let{structures:Ie,links:De}=de;if(Ie!=null&&Ie.length&&_.push(...Ie),De!=null&&De.length&&x.push(...De),de.structureId&&re){let Te={linkType:hh,source:{structureId:n,roundNumber:re},target:{structureId:de.structureId,feedProfile:fu,roundNumber:1}};x.push(Te)}}if(!_.length)return pe({result:{error:Re},info:"No structures generated",stack:e});b.structures.push(..._),b.links.push(...x);let{matchUps:O,matchUpsMap:B}=Ia({inContext:!0,drawDefinition:b}),F=_.map(({structureId:re})=>re),G=O==null?void 0:O.filter(({structureId:re})=>F.includes(re)).map($a),H=(Y=B==null?void 0:B.drawMatchUps)==null?void 0:Y.filter(({matchUpId:re})=>G==null?void 0:G.includes(re));if(H!=null&&H.length){let re=(Q=is({drawDefinition:b,event:v}))==null?void 0:Q.tieFormat;re&&H.forEach(me=>{let{tieMatchUps:se}=HC({matchUp:me,tieFormat:re,isMock:g});Object.assign(me,{tieMatchUps:se,matchUpType:Xn})})}(X=O==null?void 0:O.filter(re=>Rv({matchUp:re})&&re.structureId===n))==null||X.forEach(re=>{let{matchUpId:me,score:se,winningSide:te}=re,he=Ds({inContextDrawMatchUps:O,drawDefinition:b,matchUpId:me}),ae=bse({inContextDrawMatchUps:O,tournamentRecord:d,drawDefinition:b,matchUpsMap:B,winningSide:te,targetData:he,matchUpId:me,structure:I,matchUp:re,score:se,event:v});ae.error&&console.log(ae.error)}),(oe=O==null?void 0:O.filter(re=>re.matchUpStatus===vn&&re.structureId===n))==null||oe.forEach(re=>{let{matchUpId:me}=re,se=Ds({inContextDrawMatchUps:O,drawDefinition:b,matchUpId:me}),{targetLinks:{loserTargetLink:te},targetMatchUps:{loserMatchUpDrawPositionIndex:he,loserMatchUp:ae}}=se;if(te&&ae){let de=te.target.structureId,Ie=ae.drawPositions[he],De=sc({drawPosition:Ie,structureId:de,tournamentRecord:d,drawDefinition:b,event:v});De.error&&console.log(De.error)}});let $=[],q=Wv({inContextDrawMatchUps:O,drawDefinition:b,matchUpsMap:B}).goesToMap,{structure:z}=ui({drawDefinition:t.drawDefinition,structureId:n}),{matchUps:Z}=wn({structure:z});return Z.forEach(re=>{var te,he;let me=q==null?void 0:q.loserMatchUpIds[re.matchUpId];if(me&&re.loserMatchUpId!==me){re.loserMatchUpId=me;let ae={tournamentId:d==null?void 0:d.tournamentId,eventId:(te=t.event)==null?void 0:te.eventId,context:e,matchUp:re};$.push(ae)}let se=q==null?void 0:q.winnerMatchUpIds[re.matchUpId];if(se&&re.winnerMatchUpId!==se){re.winnerMatchUpId=se;let ae={tournamentId:d==null?void 0:d.tournamentId,eventId:(he=t.event)==null?void 0:he.eventId,context:e,matchUp:re};$.push(ae)}}),{structures:_,matchUpModifications:$,links:x,drawDefinition:b,...ce}}function Ise({element:t}){if(!t)return{error:Re};if(!t.timeItems)return{};if(!Array.isArray(t.timeItems))return{error:Re};let e=(i,n)=>(r,a)=>(a[i]&&(r[a[i]]=a[n]),r);return t.timeItems.reduce(e("itemType","itemValue"),{})}function Np(t){let{duplicateValues:e=!0,creationTime:i=!0,removePriorValues:n,timeItem:r}=t;if(!r)return{error:WH};let a=vae(t);if(a.error)return a;if(!(Xi(r)&&$r(r.itemType)&&Object.keys(r).includes("itemValue")))return{error:qH};if(!a.timeItems)a.timeItems=[];else if(I_e({element:a,duplicateValues:e,timeItem:r}))return{...ce};if(r.itemSubTypes&&!r.itemSubTypes.length&&delete r.itemSubTypes,i){let o=new Date().toISOString();Object.assign(r,{createdAt:o})}return n&&(a.timeItems=a.timeItems.filter(({itemType:o})=>r.itemType!==o)),n&&!r.itemValue||a.timeItems.push(r),{...ce}}function I_e({element:t,duplicateValues:e,timeItem:i}){var s;let{itemType:n,itemSubTypes:r,itemValue:a}=i,o=n&&((s=Wc({itemSubTypes:r,itemType:n,element:t}))==null?void 0:s.timeItem);return o&&JSON.stringify(o==null?void 0:o.itemValue)===JSON.stringify(a)&&!e}function Kq({creationTime:t=!0,removePriorValues:e,tournamentRecord:i,duplicateValues:n,participantId:r,timeItem:a}){if(!i)return{error:ut};if(!r)return{error:ya};let o=Eg({tournamentRecord:i,participantId:r});return o.error?o:Np({element:o.participant,removePriorValues:e,duplicateValues:n,creationTime:t,timeItem:a})}function XC(t){let{removePriorValues:e,tournamentRecord:i,duplicateValues:n,creationTime:r,timeItem:a}=t;if(!i)return{error:ut};let o=Np({element:i,removePriorValues:e,duplicateValues:n,creationTime:r,timeItem:a});if(o.error)return o;let s=Ise({element:i});return wi({payload:{parentOrganisation:i.parentOrganisation,tournamentId:i.tournamentId,timeItemValues:s},topic:wy}),o}function YI(t){let{removePriorValues:e,duplicateValues:i,creationTime:n,timeItem:r,event:a}=t;return a?Np({removePriorValues:e,duplicateValues:i,element:a,creationTime:n,timeItem:r}):{error:Xl}}function wse(t){return $x({...t,itemType:"attachConsolationStructures"})}function Yq(t){return $x({...t,itemType:"attachPlayoffStructures"})}function $x({itemType:t="attachStructures",matchUpModifications:e,tournamentRecord:i,drawDefinition:n,structures:r,links:a=[],event:o}){var g,v,y;let s="attachStructures";if(!n)return{error:Vt};if(!Array.isArray(r)||!Array.isArray(a))return pe({result:{error:Re},stack:s});let l=b=>{var I;return[b.source.structureId,b.source.roundNumber||((I=b.source.finishingPositions)==null?void 0:I.join("|")),b.target.roundNumber].join("|")},c=(g=n.links)==null?void 0:g.map(l);if(a.some(b=>{let I=l(b);return c==null?void 0:c.includes(I)}))return pe({result:{error:JH},info:"playoff structure exists",stack:s});a.length&&((v=n.links)==null||v.push(...a));let u=r.map(({structureId:b})=>b),d=(y=n.structures)==null?void 0:y.map(({structureId:b})=>b);n.structures=(n.structures??[]).map(b=>u.includes(b.structureId)?r.find(({structureId:I})=>I===b.structureId):b);let p=r==null?void 0:r.filter(({structureId:b})=>!(d!=null&&d.includes(b)));p.length&&n.structures.push(...p),Wv({drawDefinition:n});let h=r.map(b=>{var I;return((I=wn({structure:b}))==null?void 0:I.matchUps)||[]}).flat();Km({tournamentId:i==null?void 0:i.tournamentId,eventId:o==null?void 0:o.eventId,drawDefinition:n,matchUps:h});let f=r.map(({structureId:b})=>b);if(qn({drawDefinition:n,structureIds:f}),e==null?void 0:e.length){let b={};e.forEach(T=>{var S;let w=(S=T.matchUp)==null?void 0:S.matchUpId;w&&(b[w]=T)});let I=T=>{T.matchUps.forEach(w=>{if(b[w.matchUpId]){let{tieMatchUps:S,...D}=b[w.matchUpId].matchUp;if(Object.assign(w,D),S==null?void 0:S.length){let E={};S.forEach(C=>b[C.matchUpId]=C),w.tieMatchUps.forEach(C=>Object.assign(C,E[C.matchUpId]))}b[w.matchUpId].matchUp=w,en(b[w.matchUpId])}})};n.structures.forEach(T=>{if(d!=null&&d.includes(T.structureId))if(T.structures)for(let w of T.structures)I(w);else I(T)})}let m=p.map(Ml("structureId"));if(i){let b={itemValue:{structureIds:f,drawId:n.drawId},itemType:t};Np({element:i,timeItem:b})}return{...ce,addedStructureIds:m}}function Vx(t){var o,s;let{structures:e,links:i,matchUpModifications:n,error:r}=Wq(t);if(r)return{error:r};let a=t.drawDefinition;return Yq({tournamentId:(o=t.tournamentRecord)==null?void 0:o.tournamentId,eventId:((s=t.event)==null?void 0:s.eventId)||t.eventId,matchUpModifications:n,drawDefinition:a,structures:e,links:i})}function Kv(t){let e=di(t,[{_anyOf:{[zo]:!1,[ls]:!1,[_s]:!1,[by]:!1},[pz]:!0}]);if(e.error)return e;let i=[],n=t.drawDefinition??t.event??((t.tournamentId||!t.tournamentRecords)&&t.tournamentRecord);if(n){let r=uY(t,n);if(r.error)return r;i.push(...(r==null?void 0:r.applied)??[]),t.drawDefinition&&qn({drawDefinition:t.drawDefinition,tournamentId:t.tournamentId})}else if(t.tournamentRecords){let r=Object.keys(t.tournamentRecords);if(!r.length)return{error:ut};for(let a of r){let o=t.tournamentRecords[a],s=uY(t,o);if(s.error)return s;i.push(...(s==null?void 0:s.applied)??[])}}else return{error:ut};return i.length?{...ce,applied:i}:{error:FH}}function uY(t,e){let i=dn(t).appliedPolicies??{};e.extensions||(e.extensions=[]);let n=[],r=Object.keys(t.policyDefinitions);if(!r.length)return{error:Ok};for(let a of r)if(!i[a]||t.allowReplacement){let o=t.policyDefinitions[a];if(!o)continue;if(!Xi(o))return{error:Re};let{policyName:s,...l}=o;if(!l||!Object.keys(l).length||s&&!$r(s))return{error:Re};i[a]=t.policyDefinitions[a],n.push(a)}return n!=null&&n.length?{...cn({element:e,extension:{name:_D,value:i}}),applied:n}:{applied:n,error:FH}}function Zq({tournamentRecord:t,drawDefinition:e,flightProfile:i,drawName:n,drawId:r,event:a}){var s;if(!n||typeof n!="string")return pe({result:{error:Re},context:{drawName:n}});i||(i=Zr({event:a}).flightProfile);let o=(s=i==null?void 0:i.flights)==null?void 0:s.find(l=>l.drawId===r);if(o){o.drawName=n;let l={name:Pu,value:{...i,flights:i.flights}};Ug({event:a,extension:l})}return e&&(e.drawName=n,qn({tournamentId:t==null?void 0:t.tournamentId,drawDefinition:e})),!o&&!e?{error:Vt}:{...ce,flight:o}}function Sse({tournamentRecord:t,drawDefinition:e,drawUpdates:i,drawId:n,event:r}){var l;if(!Xi(i))return{error:Re};let a=Zr({event:r}).flightProfile,o=i.drawName&&Zq({drawName:i.drawName,tournamentRecord:t,drawDefinition:e,flightProfile:a,drawId:n,event:r});if(o!=null&&o.error)return o==null?void 0:o.error;let s=(o==null?void 0:o.flight)||((l=a==null?void 0:a.flights)==null?void 0:l.find(c=>c.drawId===n));if(!s&&!e)return{error:Vt};if(s){let c={name:Pu,value:{...a,flights:a.flights}};Ug({event:r,extension:c})}return e&&(i.policyDefinitions&&Kv({policyDefinitions:i.policyDefinitions,drawDefinition:e}),qn({tournamentId:t==null?void 0:t.tournamentId,drawDefinition:e})),{...ce}}function Tse({tournamentRecord:t,removeScheduling:e,drawDefinition:i}){var o,s;if(!i)return{error:Vt};let n=Ao({drawDefinition:i}),r=l=>{var c;return(c=n==null?void 0:n.drawMatchUps)==null?void 0:c.find(u=>u.matchUpId===l)};for(let l of i.structures||[]){let{positionAssignments:c,stage:u,stageSequence:d}=l;c&&(d!==1||![Zt,xt].includes(u))&&(l.positionAssignments=c.map(f=>(delete f.participantId,f)),l.seedAssignments=[]);let{matchUps:p,isRoundRobin:h}=wn({afterRecoveryTimes:!1,inContext:!0,matchUpsMap:n,structure:l});for(let f of p){let{matchUpId:m,roundNumber:g}=f,v=f.sides||[],y=r(m);if(y){if(delete y.extensions,delete y.notes,y.matchUpStatus!==vn&&Object.assign(y,Lx),g&&g>1&&((o=y.drawPositions)==null?void 0:o.length)&&!h){let b=v==null?void 0:v.map(({drawPosition:T,participantFed:w})=>!w&&T).filter(Boolean),I=y.drawPositions.map(T=>b.includes(T)?void 0:T);y.drawPositions=I}e?delete y.timeItems:(s=y.timeItems)!=null&&s.length&&(y.timeItems=y.timeItems.filter(b=>b.itemType&&![Mf,Gv,xT,Cae,OT,LT].includes(b.itemType))),en({tournamentId:t==null?void 0:t.tournamentId,context:"resetDrawDefiniton",drawDefinition:i,matchUp:y})}}}let a=(i.structures||[]).map(({structureId:l})=>l);return qn({drawDefinition:i,structureIds:a}),{...ce}}function JC({tournamentRecord:t}){var n;if(!t)return{error:ut};let e={positionsNoOutcomes:[],canBePruned:[],matchPlay:[],inactive:[],drawAnalysis:{}},i={};return((n=t.events)==null?void 0:n.map(r=>{let a=r.eventId;return i[a]=r,((r==null?void 0:r.drawDefinitions)||[]).map(o=>({drawDefinition:o,eventId:a}))}).flat().filter(Boolean)).forEach(({drawDefinition:r,eventId:a})=>{let o=0,s=0,l=0,{allStructuresLinked:c}=_x({drawDefinition:r}),u=i[a],d=((r==null?void 0:r.structures)||[]).map(I=>{let{stage:T,stageSequence:w,structureId:S}=I,D=Wb[T],{inContextStructureMatchUps:E}=AC({drawDefinition:r,structure:I,event:u}),C=E==null?void 0:E.filter(({winningSide:$})=>$),P=C.filter(Boolean).length||0;s+=P,l+=E.length-s;let R=Math.max(C.filter(({roundNumber:$})=>$===1).map(({roundPosition:$})=>$)),{positionAssignments:N}=Vn({structure:I}),M=N==null?void 0:N.filter(({participantId:$})=>$);o+=(M==null?void 0:M.length)??0;let A=((N==null?void 0:N.length)??0)-((M==null?void 0:M.length)??0),{roundMatchUps:_,roundProfile:x,roundNumbers:O,maxMatchUpsCount:B}=Us({matchUps:E}),F=x&&Object.keys(x).filter($=>!x[$].inactiveRound).map($=>parseInt($)),G=x&&Object.keys(x).filter($=>x[$].inactiveRound).map($=>parseInt($)),H=x&&Object.values(x).every($=>$.inactiveRound);return{positionsAssignedCount:(M==null?void 0:M.length)??0,maxWinningSideFirstRoundPosition:R,unassignedPositionsCount:A,inactiveStructure:H,maxMatchUpsCount:B,inactiveRounds:G,roundMatchUps:_,activeRounds:F,roundNumbers:O,roundProfile:x,structureId:S,stageSequence:w,orderNumber:D,stage:T}}),p=d.find(I=>I.orderNumber===2&&I.stageSequence===1),h=d.filter(({inactiveStructure:I})=>!I).length,{links:f}=FT({structureId:p.structureId,drawDefinition:r}),m=ri(p.activeRounds[0])===1&&p.activeRounds.length===1&&h===1,g=d==null?void 0:d.every(({inactiveStructure:I})=>I),v=!f.length&&p.activeRounds.length&&(p.roundProfile[1].inactiveCount||p.inactiveRounds.length),y=r.drawId;o&&!s&&e.positionsNoOutcomes.push(y),g&&e.inactive.push(y),m&&e.matchPlay.push(y),v&&e.canBePruned.push(y);let b={matchUpsWithWinningSideCount:s,matchUpsNoOutcomeCount:l,positionsAssignedCount:o,allStructuresLinked:c,structuresData:d,inactiveDraw:g,isMatchPlay:m,drawId:y};e.drawAnalysis[y]=b}),{...ce,drawsAnalysis:e}}function Use({matchPlayDrawPositions:t=!0,tournamentRecord:e,drawDefinition:i,drawId:n}){var o;if(!e)return{error:ut};if(!i)return{error:Vt};let r=[],{drawsAnalysis:a}=JC({tournamentRecord:e});if(a.canBePruned.includes(n)){let s=a.matchPlay.includes(n),l=a.drawAnalysis[n],{structures:[c]}=Ru({stageSequence:1,drawDefinition:i,stage:xt}),u=l.structuresData.find(({structureId:f})=>c.structureId===f),d=(c.matchUps??[]).sort((f,m)=>f.roundPosition-m.roundPosition);r=d.filter(({roundNumber:f})=>!u.inactiveRounds.includes(f));let p=r.map($a),h=d.map($a).filter(f=>!p.includes(f));if(s){let f=r.filter(({roundNumber:b})=>!u.inactiveRounds.includes(b)).filter(({winningSide:b})=>b),m=f.map($a),g=p.filter(b=>!m.includes(b));h.push(...g);let v=f.flatMap(b=>b.drawPositions??[]).filter(Boolean).flat(),y=Object.assign({},...v.map((b,I)=>({[b]:I+1})));if(f.forEach(b=>{t?b.drawPositions=b.drawPositions.map(I=>y[I]):delete b.drawPositions}),t){let b=(o=c==null?void 0:c.positionAssignments)==null?void 0:o.filter(I=>v.includes(I.drawPosition)).map(I=>(I.drawPosition=y[I.drawPosition],I));c.positionAssignments=b}else c.positionAssignments=[];c.matchUps=f,r=f}Qf({tournamentId:e==null?void 0:e.tournamentId,matchUpIds:h,drawDefinition:i}),qn({drawDefinition:i})}return{...ce,matchUps:r}}function Dse({tournamentRecord:t,drawDefinition:e,participantId:i,drawPosition:n,structureId:r,qualifier:a,event:o,bye:s}){if(!e)return{error:Vt};if(!n)return{error:yT};if(!r)return{error:nc};if(s){let l=sc({tournamentRecord:t,drawDefinition:e,drawPosition:n,structureId:r,event:o});if(l.error)return l}else{if(a)return{error:Hk};{let l=hp({tournamentRecord:t,drawDefinition:e,participantId:i,drawPosition:n,structureId:r,event:o});if(l.error)return l}}return{...ce}}function Ese(t){var l,c,u,d,p;let e=t.matchUpIds??[],{drawDefinition:i}=t,n=t.structureId??((c=(l=i==null?void 0:i.structures)==null?void 0:l.find(h=>{var f;return(f=h.matchUps)==null?void 0:f.some(({matchUpId:m})=>e.includes(m))}))==null?void 0:c.structureId)??((d=(u=i==null?void 0:i.structures)==null?void 0:u[0])==null?void 0:d.structureId);if(!n)return{error:wr};let r=(p=i.structures)==null?void 0:p.find(h=>h.structureId===n);if(!r)return{error:wr};let a=r==null?void 0:r.matchUps,o=a==null?void 0:a.find(h=>!!h.roundPosition);if(r.structures||o||r.finishingPosition===xI)return{error:my};let s=a.filter(({roundNumber:h})=>{var f;return(f=t.roundNumbers)==null?void 0:f.includes(h)}).map($a);return e=e.filter(h=>!s.includes(h)),t.roundNumbers&&!e.length&&(e=s),{existingMatchUps:a,matchUpIds:e,structureId:n,structure:r}}function Cse(t){let e=di(t,[{[_s]:!0},{[RD]:{[uC]:!1,roundNumbers:!1},[Ql]:Re,[$l]:gs}]);if(e.error)return e;let{removeIncomplete:i=!1,removeUnAssigned:n=!0,removeCompleted:r=!1,tournamentRecord:a,drawDefinition:o,event:s}=t,l=Ese(t);if(l.error)return l;let{structure:c,structureId:u,existingMatchUps:d,matchUpIds:p}=l,h=[],f=(d==null?void 0:d.filter(({matchUpId:v,score:y,winningSide:b})=>{if(b&&!r)return!1;if(b||Pa({score:y})){if(!b&&!i)return!1;h.push(v)}else if(!n)return!1;return p==null?void 0:p.includes(v)}))??[],m=f.map($a),g=f.map(({tieMatchUps:v})=>v==null?void 0:v.map($a)).filter(Boolean).flat();if(m.length){c.matchUps=(c.matchUps??[]).filter(({matchUpId:b})=>!m.includes(b)),Qf({tournamentId:a==null?void 0:a.tournamentId,matchUpIds:[...g,...m],action:"deleteAdHocMatchUps",eventId:s==null?void 0:s.eventId,drawDefinition:o});let v=Pi(c.matchUps.map(Ml("roundNumber"))),y=KPe(v);if(y.length){y.reverse();for(let b of y)c.matchUps.forEach(I=>{I.roundNumber&&I.roundNumber>b&&(I.roundNumber-=1,en({tournamentId:a==null?void 0:a.tournamentId,context:["adHoc round deletion"],eventId:s==null?void 0:s.eventId,drawDefinition:o,matchUp:I}))})}if(h.length){c.positionAssignments=Pi(c.matchUps.flatMap(w=>(w.sides??[]).map(S=>S.participantId)).filter(Boolean)).map(w=>({participantId:w}));let b=(c==null?void 0:c.matchUpFormat)??(o==null?void 0:o.matchUpFormat)??(s==null?void 0:s.matchUpFormat),{matchUps:I}=wn({afterRecoveryTimes:!1,inContext:!0,structure:c,event:s}),T=Gq({positionAssignments:c.positionAssignments,tournamentRecord:a,drawDefinition:o,matchUpFormat:b,matchUps:I,event:s});T.error&&console.log(T)}qn({structureIds:[u],eventId:s==null?void 0:s.eventId,drawDefinition:o})}return!m.length&&p.length?{error:zk}:{...ce,deletedMatchUpsCount:[...m,...g].length}}function Pse({removeCompletedMatchUps:t,tournamentRecord:e,drawDefinition:i,structureId:n,roundNumber:r,event:a}){if(!e)return{error:ut};if(!i)return{error:Vt};if(!r)return pe({result:{error:Yt},info:"roundNumber required"});let o=ui({drawDefinition:i,structureId:n});if(o.error)return o;let s=o.structure;return s!=null&&s.structures?{error:my}:sl({structure:s})?w_e({tournamentId:e.tournamentId,removeCompletedMatchUps:t,eventId:a.eventId,drawDefinition:i,roundNumber:r,structure:s}):(console.log("not implemented"),{...ce})}function w_e({removeCompletedMatchUps:t,drawDefinition:e,tournamentId:i,roundNumber:n,structure:r,eventId:a}){let o=(r==null?void 0:r.matchUps)??[],s=[],l=[],c=!1;if(o.reduce((u,d)=>{let p=d==null?void 0:d.roundNumber;return p?u.includes(p)?u:u.concat(p):u},[]).sort(ma).includes(n)){let u=o.filter(d=>{let p=d.roundNumber===n&&(!ba.includes(d.matchUpStatus)||t);return p&&(l.push(d.matchUpId),d.tieMatchUps&&s.push(...d.tieMatchUps.map($a))),!p});l.length&&(Qf({matchUpIds:[...s,...l],drawDefinition:e,tournamentId:i,eventId:a}),u.some(d=>d.roundNumber===n)||(u.forEach(d=>{d.roundNumber>n&&(d.roundNumber-=1,en({drawDefinition:e,tournamentId:i,eventId:a,matchUp:d}))}),c=!0),r.matchUps=u)}return{deletedMatchUpsCount:l.length,roundRemoved:c,...ce}}function jx(t){var p,h,f,m,g,v;let{suppressNotifications:e,tournamentRecord:i,drawDefinition:n,matchUps:r,event:a}=t;if(typeof n!="object")return{error:Vt};let o=t==null?void 0:t.structureId;if(!o&&((p=n.structures)==null?void 0:p.length)===1&&(o=(f=(h=n.structures)==null?void 0:h[0])==null?void 0:f.structureId),typeof o!="string")return{error:nc};if(!Kc(r))return{error:Re,info:Zm("matchUps")};let s=(m=n.structures)==null?void 0:m.find(y=>y.structureId===o);if(!s)return{error:wr};let l=(s==null?void 0:s.matchUps).find(y=>!!y.roundPosition);if(s.structures||l||s.finishingPosition===xI)return{error:my};let c=((v=(g=oo({tournamentRecord:i,inContext:!1}))==null?void 0:g.matchUps)==null?void 0:v.map($a))??[],u=r.map($a);if(Ts(c,u))return{error:rre,info:"One or more matchUpIds already present in tournamentRecord"};s.matchUps.push(...r);let d=r.map(({tieMatchUps:y})=>y).filter(Boolean).flat();return e||(Km({tournamentId:i==null?void 0:i.tournamentId,matchUps:[...d,...r],eventId:a==null?void 0:a.eventId,drawDefinition:n}),qn({drawDefinition:n,structureIds:[o]})),{...ce}}function Rse({tournamentRecord:t,drawDefinition:e,drawPosition:i,structureId:n,subOrder:r,event:a}){var h;if(!e)return{error:Vt};if(!n)return{error:nc};if(!i)return{error:yT};let{structure:o}=ui({drawDefinition:e,structureId:n});if(!o)return{error:wr};let s=o;o.structures&&o.structureType===As&&(s=(h=o.structures)==null?void 0:h.find(f=>{var m;return(m=f.positionAssignments)==null?void 0:m.find(g=>g.drawPosition===i)}));let l=s==null?void 0:s.positionAssignments,c=l==null?void 0:l.find(f=>f.drawPosition===i);c&&cn({element:c,extension:{name:dS,value:r}});let u=((a==null?void 0:a.eventType)===Xn||e.matchUpType===Xn||((a==null?void 0:a.tieFormat)??(e==null?void 0:e.tieFormat)??(o==null?void 0:o.tieFormat)))&&{matchUpTypes:[Xn]},{matchUps:d}=wn({structure:s,afterRecoveryTimes:!1,inContext:!0,matchUpFilters:u,event:a}),p=(o==null?void 0:o.matchUpFormat)??e.matchUpFormat;return Gq({positionAssignments:l,tournamentRecord:t,drawDefinition:e,matchUpFormat:p,matchUps:d,event:a}),qn({drawDefinition:e,structureIds:[n]}),{...ce}}var Mse={};$i(Mse,{addGoesTo:()=>Wv,allPlayoffPositionsFilled:()=>Mq,checkValidEntries:()=>zx,findDrawDefinition:()=>e3,getAssignedParticipantIds:()=>Ey,getAvailableMatchUpsCount:()=>Gx,getAvailablePlayoffProfiles:()=>GC,getDrawDefinitionTimeItem:()=>Qz,getDrawParticipantRepresentativeIds:()=>Jq,getDrawStructures:()=>Ru,getDrawTypeCoercion:()=>QC,getEligibleVoluntaryConsolationParticipants:()=>Xq,getMatchUpsMap:()=>Ao,getParticipantIdFinishingPositions:()=>Qq,getPositionAssignments:()=>GD,getPositionsPlayedOff:()=>GT,getSeedingThresholds:()=>Uq,getSeedsCount:()=>eP,getStructureSeedAssignments:()=>Vc,getTeamLineUp:()=>qv,getValidGroupSizes:()=>FC,isAdHoc:()=>sl,isCompletedStructure:()=>Xm,isValidForQualifying:()=>r3,positionActions:()=>n3});function Xq({excludedMatchUpStatuses:t=[],includeEventParticipants:e,includeQualifyingStage:i,finishingRoundLimit:n,policyDefinitions:r,roundNumberLimit:a,tournamentRecord:o,drawDefinition:s,matchUpsLimit:l,requirePlay:c,requireLoss:u,allEntries:d,winsLimit:p,event:h}){var x,O,B,F,G;if(!s)return{error:Vt};let f=[xt,Fr];i&&f.push(Zt);let m=h!=null&&h.eventType?{matchUpTypes:[h.eventType]}:void 0,g=s!=null&&s.matchUpType?{matchUpTypes:[s.matchUpType]}:void 0,v=e&&h?((x=xh({contextFilters:{stages:f},matchUpFilters:m,tournamentRecord:o,inContext:!0,event:h}))==null?void 0:x.matchUps)??[]:((O=ws({contextFilters:{stages:f},matchUpFilters:g,tournamentRecord:o,inContext:!0,drawDefinition:s}))==null?void 0:O.matchUps)??[],y=$I({stage:Ja,drawDefinition:s}).map(({participantId:H})=>H),b={},I={},T={},w={};r||(r=em({policyTypes:[V2],tournamentRecord:o,drawDefinition:s,event:h}).policyDefinitions);let S=r==null?void 0:r[V2];t=t.length&&t||(S==null?void 0:S.excludedMatchUpStatuses)||[],e=e??(S==null?void 0:S.includeEventParticipants),d=d??(S==null?void 0:S.allEntries),n=n??(S==null?void 0:S.finishingRoundLimit),a=a??(S==null?void 0:S.roundNumberLimit),l=l??(S==null?void 0:S.matchUpsLimit),c===void 0&&(c=(S==null?void 0:S.requirePlay)!==void 0?S.requirePlay:!0),u===void 0&&(u=(S==null?void 0:S.requireLoss)!==void 0?S.requireLoss:!0),p=p??(S==null?void 0:S.winsLimit);for(let H of v){if(c&&H.winningSide&&![1,2].includes(H.winningSide)&&H.matchUpStatus!==ua||H.finishingRound&&n&&H.finishingRound>=n||H.finishingRound&&a&&H.finishingRound<=a)continue;let $=(B=H.sides)==null?void 0:B.find(({sideNumber:z})=>H.winningSide&&z===3-H.winningSide),q=(F=H.sides)==null?void 0:F.find(({sideNumber:z})=>H.winningSide&&z===H.winningSide);if((G=H.sides)==null||G.forEach(z=>{var Y;let Z=(Y=z==null?void 0:z.participant)==null?void 0:Y.participantId;Z&&(T[Z]=z.participant,H.matchUpStatus===ua&&!c&&(I[Z]=z.participant,b[Z]||(b[Z]=0),(!H.matchUpStatus||!t.includes(H.matchUpStatus))&&(b[Z]+=1)))}),$==null?void 0:$.participant){let z=$.participant.participantId;I[z]=$.participant,b[z]||(b[z]=0),H.matchUpStatus&&!t.includes(H.matchUpStatus)&&(b[z]+=1)}if(q!=null&&q.participant){let z=q.participant.participantId;w[z]||(w[z]=0),w[z]+=1,b[z]||(b[z]=0),H.matchUpStatus&&!t.includes(H.matchUpStatus)&&(b[z]+=1)}}let D=(o==null?void 0:o.participants)&&!c&&!u&&d,E=D?((e&&h?h.entries:s.entries)??[]).filter(H=>![yh,Fu].includes(H.entryStatus)).map(({participantId:H})=>H):[],C=Object.keys(I),P=D?((o==null?void 0:o.participants)??[]).filter(({participantId:H})=>E.includes(H)):u&&Object.values(I)||Object.values(T),R=H=>!u||C.includes(H),N=H=>!c||(b[H]||0)>=0,M=H=>!p||(w[H]||0)<=p,A=H=>!l||b[H]<=l,_=H=>!y.includes(H);return{eligibleParticipants:P.filter(H=>R(H.participantId)&&N(H.participantId)&&M(H.participantId)&&A(H.participantId)&&_(H.participantId)).map(H=>{var $;return{...H,individualParticipants:($=H.individualParticipantIds)==null?void 0:$.map(q=>{var z;return(z=o==null?void 0:o.participants)==null?void 0:z.find(Z=>Z.participantId===q)})}}),losingParticipantIds:C,...ce}}function Gx(t){var f,m,g,v,y,b,I,T;let e=di(t,[{drawDefinition:!0}]);if(e.error)return e;let{drawDefinition:i,roundNumber:n}=t,r=t.structureId??(((f=i.structures)==null?void 0:f.length)===1&&((g=(m=i.structures)==null?void 0:m[0])==null?void 0:g.structureId));if(typeof r!="string")return{error:nc};let a=(v=i.structures)==null?void 0:v.find(w=>w.structureId===r);if(!a)return{error:wr};let o,s=(y=a.matchUps??[])==null?void 0:y.reduce((w,S)=>(S.roundPosition&&(o=!0),((S==null?void 0:S.roundNumber)||0)>w?S.roundNumber:w),0);if(a.structures||o||a.finishingPosition===xI)return{error:my};let l=((b=i==null?void 0:i.entries)==null?void 0:b.filter(w=>{let S=w.entryStatus;return Bu.includes(S)}))??[],c=Math.floor((l==null?void 0:l.length)/2)||1,u=n??s??1,d=((T=(I=a.matchUps)==null?void 0:I.filter(w=>w.roundNumber===u))==null?void 0:T.length)??0,p=c-d,h=p>0?p:0;return{...ce,availableMatchUpsCount:h,lastRoundNumber:s,roundMatchUpsCount:c}}function Jq({drawDefinition:t}){var i;let e=Ri({name:"participantRepresentatives",element:t});return e.error?e:{representativeParticipantIds:((i=e.extension)==null?void 0:i.value)||[]}}function S_e({tournamentParticipants:t,drawDefinition:e,event:i}){if(!e)return{error:Vt};let n=Ia({tournamentParticipants:t,inContext:!0,drawDefinition:e,event:i}),r=Ot(n.matchUps,!1,!0),a=Pi(r.reduce((s,l)=>s.concat(...l.sides.map(c=>c.participantId).filter(Boolean)),[])),o=Object.assign({},...a.map(s=>{let l=r.filter(c=>c.sides.map(u=>u.participantId).filter(Boolean).includes(s));return{[s]:l}}));return{participantIds:a,participantIdMatchUps:o}}function Qq({byeAdvancements:t=!1,tournamentRecord:e,drawDefinition:i}){if(!i)return{error:Vt};let{participantIds:n,participantIdMatchUps:r}=S_e({tournamentParticipants:e==null?void 0:e.participants,drawDefinition:i}),a=(n==null?void 0:n.map(o=>{let s=r[o].filter(d=>[jr,vn].includes(d.matchUpStatus)||d.winningSide),l=s.map(d=>{let p=d.sides.find(f=>f.bye),h=d.sides.find(f=>f.participantId===o).sideNumber;return(d.winningSide||t&&p&&h)===h?d.finishingPositionRange.winner:d.finishingPositionRange.loser}),c=d=>Math.abs(d[0]-d[1]),u=l.reduce((d,p)=>d&&c(d)<c(p)?d:p,void 0);return{[o]:{relevantMatchUps:s,finishingPositionRanges:l,finishingPositionRange:u}}}))||[];return Object.assign({},...a)}function Ng({tournamentRecords:t,tournamentRecord:e,tournamentId:i,drawId:n}){if(!e&&!t)return{error:ut};if(!n)return{error:Pd};if(!e&&t){if(typeof i!="string"&&(i=yse({tournamentRecords:t,drawId:n}),!i))return{error:J0};if(e=t[i],!e)return{error:ut}}let r=e&&zs({tournamentRecord:e,drawId:n});return r!=null&&r.drawDefinition?{drawDefinition:r.drawDefinition,event:r.event,tournamentRecord:e,...ce}:pe({result:{error:Zl},stack:"findDrawDefinition"})}function e3(t){let{drawDefinition:e,error:i}=Ng(t);return i?{error:i}:{drawDefinition:Ot(e)}}function nV({targetRoundNumber:t,finishingPosition:e,drawDefinition:i,structureId:n,linkType:r}){let{links:a}=FT({drawDefinition:i,structureId:n})||{},o=((a==null?void 0:a.target)||[]).filter(({linkType:s})=>s===r).filter(({target:s})=>!t||t===s.roundNumber).map(s=>{let l=s.source.structureId,{structure:c}=ui({structureId:l,drawDefinition:i});if(!(e&&(c==null?void 0:c.finishingPosition)!==e))return s}).filter(Boolean);return{sourceStructureIds:o.map(({source:s})=>s.structureId),relevantLinks:o}}function T_e({tournamentParticipants:t,returnParticipants:e,drawPosition:i,participant:n,drawId:r,event:a}){var s;let o=((s=a==null?void 0:a.entries)==null?void 0:s.filter(({entryStatus:l})=>[Fu,Uy].includes(l)).map(({participantId:l})=>l))||[];if(o.length){let l=n.individualParticipantIds,c=e?t.filter(({participantId:d})=>o.includes(d)):void 0,u=e?t.filter(({participantId:d})=>l.includes(d)):void 0;return{validModifyAssignedPairAction:zt({payload:{participantId:n.participantId,replacementIndividualParticipantId:void 0,existingIndividualParticipantId:void 0,drawPosition:i,drawId:r},method:SAe,availableIndividualParticipantIds:o,availableIndividualParticipants:c,existingIndividualParticipantIds:l,existingIndividualParticipants:u,type:_q},!1,!1,!0)}}return{}}function Yv(t){var h,f;let{inContextDrawMatchUps:e,targetData:i,drawDefinition:n,relevantLink:r}=t;if((r==null?void 0:r.linkCondition)===fh&&((h=i==null?void 0:i.matchUp)==null?void 0:h.matchUpStatus)===vn)return!1;let{targetMatchUps:{loserMatchUp:a,winnerMatchUp:o},targetLinks:s}=i,l=[Zi,hn].includes(a==null?void 0:a.matchUpStatus),c=((f=o==null?void 0:o.drawPositions)==null?void 0:f.filter(Boolean).length)||0;if(a!=null&&a.winningSide&&!l||o!=null&&o.winningSide&&c===2&&(!o.feedRound||![hn,Zi].includes(o==null?void 0:o.matchUpStatus)))return!0;let u=a&&Ds({matchUpId:a.matchUpId,inContextDrawMatchUps:e,drawDefinition:n}),d=o&&Ds({matchUpId:o.matchUpId,inContextDrawMatchUps:e,drawDefinition:n}),p=u&&Yv({relevantLink:s==null?void 0:s.loserTargetLink,targetData:u,inContextDrawMatchUps:e,drawDefinition:n});return!!(d&&Yv({targetData:d,inContextDrawMatchUps:e,drawDefinition:n})||p)}var Nse={[Ef]:{policyName:"positionActionsDefault",enabledStructures:[{stages:[Zt,xt],stageSequences:[1],enabledActions:[],disabledActions:[]},{stages:[],stageSequences:[],enabledActions:[$D,Qb,kx,Db],disabledActions:[]}],disbledStructures:[],otherFlightEntries:!1,activePositionOverrides:[]}},DN="positionAction",rV="matchUpAction";function Ase({actionType:t=DN,appliedPolicies:e,drawDefinition:i,structure:n}){var d,p;let r=t===DN&&Ef||t===rV&&Qa,a=t===DN&&Nse||t===rV&&ooe,o=r&&((e==null?void 0:e[r])||(a==null?void 0:a[r])),s=((p=(d=i.links)==null?void 0:d.filter(h=>{var f;return((f=h==null?void 0:h.target)==null?void 0:f.structureId)===(n==null?void 0:n.structureId)}))==null?void 0:p.map(({target:h})=>h.feedProfile))??[],{enabledStructures:l,disabledStructures:c}=o||{},u=c==null?void 0:c.find(h=>{let{stages:f,stageSequences:m,structureTypes:g,feedProfiles:v}=h;return(!(v!=null&&v.length)||Array.isArray(v)&&v.some(y=>s.includes(y)))&&(!(f!=null&&f.length)||Array.isArray(f)&&(f==null?void 0:f.includes(n==null?void 0:n.stage)))&&(!(g!=null&&g.length)||Array.isArray(g)&&(g==null?void 0:g.includes(n==null?void 0:n.structureType)))&&(!(m!=null&&m.length)||Array.isArray(m)&&m.includes(n==null?void 0:n.stageSequence))});return{enabledStructures:l,actionsDisabled:u,actionsPolicy:o}}function dY({activePositionOverrides:t,activeDrawPositions:e,action:i}){return i&&t.includes(i)?!0:!e.length}function _se({enabledStructures:t,drawDefinition:e,structure:i}){var s,l;if(t===!1)return{};if(!(t!=null&&t.length))return{policyActions:{enabledActions:[],disabledActions:[]}};let{stage:n,stageSequence:r,structureType:a}=i||{},o=((l=(s=e.links)==null?void 0:s.filter(c=>{var u;return((u=c==null?void 0:c.target)==null?void 0:u.structureId)===(i==null?void 0:i.structureId)}))==null?void 0:l.map(({target:c})=>c.feedProfile))||[];return{policyActions:t.find(c=>{let{stages:u,stageSequences:d,structureTypes:p,feedProfiles:h}=c||{},f=!(u!=null&&u.length)||Array.isArray(u)&&u.includes(n),m=!(d!=null&&d.length)||Array.isArray(d)&&d.includes(r),g=!(p!=null&&p.length)||Array.isArray(p)&&p.includes(a),v=!(h!=null&&h.length)||Array.isArray(h)&&h.some(y=>o.includes(y));return m&&g&&v&&c&&f})}}function Qs({action:t,policyActions:e}){var n;let i=!(e!=null&&e.enabledActions)||((n=e==null?void 0:e.disabledActions)==null?void 0:n.length)&&e.disabledActions.includes(t);return i?!1:((e==null?void 0:e.enabledActions.length)===0||(e==null?void 0:e.enabledActions.includes(t)))&&!i}var kse="replaceTieMatchUpParticipantId",xse="assignTieMatchUpParticipantId",aV="removeTieMatchUpParticipantId",pY="assignMatchUpSideParticipant",U_e="removeMatchUpSideParticipant",Ose="substituteParticipant",oV="REMOVE_SUBSTITUTION",Lse="REPLACE_PARTICIPANT",t3="REMOVE_PARTICIPANT",sV="setMatchUpStatus",lV="SUBSTITUTION",Fse="SCHEDULE",D_e="PENALTY",cV="REFEREE",Bse="STATUS",uV="START",$se="SCORE",dV="END",i3={REPLACE_TEAM_POSITION_METHOD:kse,ASSIGN_TEAM_POSITION_METHOD:xse,REMOVE_TEAM_POSITION_METHOD:aV,REPLACE_PARTICIPANT:Lse,SUBSTITUTION_METHOD:Ose,REMOVE_SUBSTITUTION:oV,REMOVE_PARTICIPANT:t3,SCHEDULE_METHOD:sV,SUBSTITUTION:lV,SCHEDULE:Fse,PENALTY:D_e,REFEREE:cV,STATUS:Bse,SCORE:$se,START:uV,END:dV};function E_e({specifiedPolicyDefinitions:t,inContextDrawMatchUps:e,matchUpParticipantIds:i,matchUpActionsPolicy:n,inContextMatchUp:r,policyActions:a,enforceGender:o,participantId:s,sideNumber:l,matchUpId:c,matchUp:u,drawId:d,side:p}){var M,A,_,x,O,B,F,G,H,$,q,z,Z,Y,Q;let h=[],f=(M=r.sides)==null?void 0:M.find(X=>X.participant),m=r.gender===nl&&r.sideNumber&&((A=r.sides)==null?void 0:A.filter(X=>X.particiapntId).length)===1&&((x=(_=f==null?void 0:f.participant)==null?void 0:_.person)==null?void 0:x.sex),g=r.matchUpType,v=(o??((O=n==null?void 0:n.participants)==null?void 0:O.enforceGender))!==!1?r.gender:void 0,y=(F=(B=r.sides)==null?void 0:B.flatMap(X=>{var oe;return((oe=X.participant)==null?void 0:oe.individualParticipants)||X.participant}).filter(Boolean))==null?void 0:F.map(Gi),b=(G=r.sides)==null?void 0:G.filter(X=>!l||X.sideNumber===l).flatMap(X=>{var oe;return((oe=X.participant)==null?void 0:oe.individualParticipants)||X.participant}).filter(Boolean),I=b==null?void 0:b.map(Gi),T=($=(H=e==null?void 0:e.find(X=>X.matchUpId===r.matchUpTieId))==null?void 0:H.sides)==null?void 0:$.map(X=>{var oe,re;return(re=(oe=X==null?void 0:X.participant)==null?void 0:oe.individualParticipants)==null?void 0:re.filter(({participantId:me,person:se})=>!(I!=null&&I.includes(me))&&(!v||v===Id||se.sex===v||v===nl&&!m||m&&se.sex!==m))}),w=l?T==null?void 0:T[l-1]:T==null?void 0:T.map((X,oe)=>({participants:X,sideNumber:oe+1})),S=l?(q=T==null?void 0:T[l-1])==null?void 0:q.map(Gi):T==null?void 0:T.map((X,oe)=>({participants:X==null?void 0:X.map(Gi),sideNumber:oe+1})),D=l&&(Gr(Sb)(g)&&!(I!=null&&I.length)||Gr(jv)(g)&&((I==null?void 0:I.length)??0)<2)||!l&&(Gr(Sb)(g)&&((I==null?void 0:I.length)??0)<2||Gr(jv)(g)&&((I==null?void 0:I.length)??0)<4),E=S==null?void 0:S.filter(X=>!(y!=null&&y.includes(X))),C=w==null?void 0:w.filter(({participantId:X})=>E.includes(X));if(D&&(E!=null&&E.length)&&h.push({availableParticipantIds:E,method:xse,availableParticipants:C,type:Jb,payload:{participantId:void 0,tieMatchUpId:c,sideNumber:l,drawId:d}}),I!=null&&I.length&&(!Pa(u)||(z=p==null?void 0:p.substitutions)!=null&&z.length)&&h.push({method:aV,type:t3,existingParticipantIds:I,payload:{participantId:void 0,tieMatchUpId:c,drawId:d}}),C!=null&&C.length&&(!l&&(I!=null&&I.length)||l&&(p!=null&&p.participant))&&h.push({availableParticipantIds:E,method:kse,availableParticipants:C,type:Lse,existingParticipantIds:I,payload:{existingParticipantId:void 0,participantId:void 0,tieMatchUpId:c,drawId:d}}),Qs({policyActions:a,action:oV})&&((Z=p==null?void 0:p.substitutions)==null?void 0:Z.length)){let X=((Y=p.participant)==null?void 0:Y.participantType)===Hi&&[p.participantId]||((Q=p.participant)==null?void 0:Q.participantType)===Ti&&p.participant.individualParticipantIds||[],oe=p.substitutions.map(re=>re.participantId).filter(re=>X.includes(re));(!s||oe.includes(s))&&h.push({method:aV,type:oV,substitutedParticipantIds:oe,payload:{participantId:void 0,tieMatchUpId:c,drawId:d}})}let P=t==null?void 0:t[Qa],R=P==null?void 0:P.substituteWithoutScore,N=P==null?void 0:P.substituteAfterCompleted;if(Qs({policyActions:a,action:lV})&&i.length===2&&(!l&&(I!=null&&I.length)||l&&(p!=null&&p.participant))&&(R||Pa(u))&&(N||u.matchUpStatus&&!ba.includes(u.matchUpStatus))&&(b!=null&&b.length)&&w.length){let X=b.map(Gi);h.push({info:"list of team players available for substitution",method:Ose,availableParticipantIds:S,existingParticipantIds:X,availableParticipants:w,existingParticipants:b,type:lV,payload:{substituteParticipantId:void 0,existingParticipantId:void 0,sideNumber:l,matchUpId:c,drawId:d}})}return h}function C_e({tournamentParticipants:t=[],possiblyDisablingAction:e,activeDrawPositions:i,positionAssignments:n,returnParticipants:r,appliedPolicies:a,drawDefinition:o,drawPosition:s,validActions:l,structureId:c,structure:u,drawId:d,event:p}){var S,D,E,C,P;if(i.includes(s))return{};let h=(S=l.find(R=>R.type===Jb))==null?void 0:S.availableParticipantIds,f=(D=a==null?void 0:a[Ef])==null?void 0:D.otherFlightEntries,m=(E=a==null?void 0:a[Ef])==null?void 0:E.restrictQualifyingAlternates,g=(o.entries??[]).filter(({entryStage:R})=>!m||(u.stage===Zt?R===Zt:R!==Zt)).sort((R,N)=>(R.entryPosition??1/0)-(N.entryPosition??1/0)).map(({participantId:R})=>R).filter(Boolean),{allPositionedParticipantIds:v}=rae({drawDefinition:o}),y=n.map(R=>R.participantId).filter(Boolean),b=g.filter(R=>u.stage&&[Zt,xt,Fr].includes(u.stage)?!(v!=null&&v.includes(R)):!y.includes(R)),I=((p==null?void 0:p.entries)??[]).filter(R=>R.entryStatus===yu&&Vse({restrictQualifyingAlternates:m,structure:u,entry:R})&&(u.stage&&[Zt,xt,Fr].includes(u.stage)?!(v!=null&&v.includes(R.participantId)):!y.includes(R.participantId))).sort((R,N)=>(R.entryPosition??1/0)-(N.entryPosition??1/0)).map(R=>R.participantId),T=Pi(b.concat(I));if(f){let R=(P=(C=p?Zr({event:p}).flightProfile:void 0)==null?void 0:C.flights)==null?void 0:P.filter(N=>N.drawId!==d).map(N=>N.drawEntries.filter(M=>M.participantId&&![yh,Fu,Uy].includes(M.entryStatus)&&!g.includes(M.participantId)).map(({participantId:M})=>M)).flat().filter(Boolean);R!=null&&R.length&&T.push(...R)}h!=null&&h.length&&(T=T.filter(R=>!h.includes(R)));let w=r?t==null?void 0:t.filter(R=>T.includes(R.participantId)):void 0;return w==null||w.forEach(R=>{let N=(o.entries??[]).find(M=>M.participantId===R.participantId);R.entryPosition=N==null?void 0:N.entryPosition}),w==null||w.sort((R,N)=>(R.entryPosition||1/0)-(N.entryPosition||1/0)),T.length?{validAlternatesAction:zt({payload:{drawId:d,structureId:c,drawPosition:s},willDisableLinks:e,method:IAe,availableAlternatesParticipantIds:T,type:kq,availableAlternates:w})}:{}}function Vse({restrictQualifyingAlternates:t,structure:e,entry:i}){let{stage:n}=e;if(!i.entryStage||i.entryStage===n||n===Zt&&!t||i.entryStage===xt&&n===Po)return!0}function P_e({eventEntries:t,structure:e}){let i=r=>r.entryStatus===yu&&Vse({structure:e,entry:r}),n=(r,a)=>(r.entryPosition||1/0)-(a.entryPosition||1/0);return t.filter(i).sort(n).map(Gi)}function R_e({restrictAdHocRoundParticipants:t,tournamentParticipants:e,matchUpParticipantIds:i,otherFlightEntries:n,drawDefinition:r,structureId:a,sideNumber:o,matchUpId:s,structure:l,matchUp:c,drawId:u,event:d}){var D,E,C,P,R,N,M;let p=[],h=(l==null?void 0:l.matchUps)??[],f=(E=(D=c.sides)==null?void 0:D.find(A=>A.sideNumber===o))==null?void 0:E.participantId,m=h.filter(({roundNumber:A})=>A===c.roundNumber),g=((C=r==null?void 0:r.entries)==null?void 0:C.filter(({entryStatus:A})=>A&&Dy.includes(A)).map(Gi))??[],v=m.map(A=>(A.sides??[]).flatMap(Gi)).flat().filter(Boolean),y=g.filter(A=>!i.includes(A)&&(!t||!v.includes(A))),b=e==null?void 0:e.filter(A=>y==null?void 0:y.includes(A.participantId)).map(A=>Ot(A,void 0,!0));b==null||b.forEach(A=>{let _=(r.entries??[]).find(x=>x.participantId===A.participantId);A.entryPosition=_==null?void 0:_.entryPosition}),y.length&&p.push({payload:{drawId:u,matchUpId:s,structureId:a,sideNumber:o},method:pY,type:Jb,availableParticipantIds:y,participantsAvailable:b});let I=(d==null?void 0:d.entries)??[],T=P_e({eventEntries:I,structure:l}),w=Pi(g.concat(T));if(n){let A=(R=(P=d?Zr({event:d}):void 0)==null?void 0:P.flights)==null?void 0:R.filter(_=>_.drawId!==u).flatMap(_=>_.drawEntries.filter(x=>x.participantId&&![yh,Fu,Uy].includes(x.entryStatus)).map(({participantId:x})=>x)).filter(Boolean);A!=null&&A.length&&w.push(...A)}w=w.filter(A=>!i.includes(A)&&!y.includes(A)&&(!t||!v.includes(A)));let S=e==null?void 0:e.filter(A=>w.includes(A.participantId)).map(A=>Ot(A,void 0,!0));if(S==null||S.forEach(A=>{let _=(r.entries??[]).find(x=>x.participantId===A.participantId);A.entryPosition=_==null?void 0:_.entryPosition}),S==null||S.sort((A,_)=>(A.entryPosition||1/0)-(_.entryPosition||1/0)),w.length&&p.push({payload:{drawId:u,matchUpId:s,structureId:a,sideNumber:o},availableParticipantIds:w,participantsAvailable:S,method:pY,type:yu}),!Pa(c)&&o&&f){p.push({payload:{drawId:u,matchUpId:s,structureId:a,sideNumber:o},method:U_e,type:t3});let A=$=>$.sides.map(Gi),_=({matchUpId:$})=>$!==c.matchUpId,x=$=>!Pa($),O=(M=(N=c.sides)==null?void 0:N.find($=>$.sideNumber!==o))==null?void 0:M.participantId,B=h.filter(({roundNumber:$})=>$!==c.roundNumber).filter(_).map(A),F=[O,...B.filter($=>$.includes(f)).flat()].filter(Boolean),G=$=>!F.flat().includes($),H=m.filter(x).filter(_).map(A).flat().filter(G);if(H.length){let $=e==null?void 0:e.filter(q=>H.includes(q.participantId)).map(q=>Ot(q,void 0,!0));p.push({payload:{participantIds:[f],roundNumber:c.roundNumber,structureId:a,sideNumber:o,matchUpId:s,drawId:u},swappableParticipantIds:H,method:TAe,type:xx,swappableParticipants:$})}}return p}function Hx(t){var X,oe,re,me,se,te,he,ae,de;if(!t)return{error:Re};let{drawDefinition:e,event:i}=t,{restrictAdHocRoundParticipants:n=!0,policyDefinitions:r,enforceGender:a,participantId:o,sideNumber:s,matchUpId:l}=t,c=t.tournamentRecord??(t.tournamentId&&$r(t.tournamentId)&&((X=t.tournamentRecords)==null?void 0:X[t.tournamentId]));if(!c)return{error:ut};if(!l||!$r(l))return{error:ss};if(s&&![1,2].includes(s))return pe({result:{error:Re},context:{sideNumber:s}});if(!e){let Ie=(oo({tournamentRecord:c}).matchUps??[]).find(Te=>Te.matchUpId===l);i=((c==null?void 0:c.events)??[]).find(Te=>Te.eventId===(Ie==null?void 0:Ie.eventId));let De=((i==null?void 0:i.drawDefinitions)??[]).find(Te=>Te.drawId===(Ie==null?void 0:Ie.drawId));De&&(e=De)}if(!e)return{error:Vt};let u=Nr({withIndividualParticipants:!0,tournamentRecord:c}).participants,{drawId:d}=e,{matchUp:p,structure:h}=nr({drawDefinition:e,matchUpId:l,event:i});if(!p)return{error:Ho};let f=dn({tournamentRecord:c,drawDefinition:e,structure:h,event:i}).appliedPolicies??{};Object.assign(f,r??{});let m=(oe=f==null?void 0:f[Ef])==null?void 0:oe.otherFlightEntries,g=(f==null?void 0:f[Qa])??VT[Qa],{enabledStructures:v}=Ase({actionType:rV,appliedPolicies:f,drawDefinition:e,structure:h}),{policyActions:y}=_se({enabledStructures:v,drawDefinition:e,structure:h}),b=t.matchUpsMap??Ao({drawDefinition:e}),I=t.inContextDrawMatchUps??Ia({tournamentParticipants:u,inContext:!0,drawDefinition:e,matchUpsMap:b,event:i}).matchUps,T=I==null?void 0:I.find(Ie=>Ie.matchUpId===l),w=s&&((re=T==null?void 0:T.sides)==null?void 0:re.find(Ie=>Ie.sideNumber===s)),S=((me=T==null?void 0:T.sides)==null?void 0:me.map(Ie=>{var De;return Ie.participantId||((De=Ie.participant)==null?void 0:De.participantid)}).filter(Boolean))??[],{assignedPositions:D,allPositionsAssigned:E}=ja({structure:h}),{structureId:C}=h??{},P=[];if(!C)return{validActions:P};let R=sl({structure:h}),N=p.collectionId;if(R&&!N){let Ie=R_e({restrictAdHocRoundParticipants:n,tournamentParticipants:u,matchUpParticipantIds:S,otherFlightEntries:m,drawDefinition:e,structureId:C,sideNumber:s,matchUpId:l,structure:h,matchUp:p,drawId:d,event:i});P.push(...Ie)}let M=Xm({drawDefinition:e,structure:h}),A=D==null?void 0:D.filter(Ie=>Ie.participantId).map(Ie=>Ie.drawPosition),_=D==null?void 0:D.filter(Ie=>Ie.bye).map(Ie=>Ie.drawPosition),x=p.matchUpStatus===vn||!N&&((se=p.drawPositions)==null?void 0:se.reduce((Ie,De)=>(_==null?void 0:_.includes(De))||Ie,!1));if(x)return{validActions:P,isByeMatchUp:x};Qs({policyActions:y,action:cV})&&P.push({type:cV,payload:{matchUpId:l}});let O=!NC({matchUpStatus:p.matchUpStatus}),B=(te=f==null?void 0:f.scoring)==null?void 0:te.structures,F=(h==null?void 0:h.stage)&&(B==null?void 0:B.stage)&&(B==null?void 0:B.stage[h.stage]),G=(h==null?void 0:h.stageSequence)&&(F==null?void 0:F.stageSequence)&&F.stageSequence[h.stageSequence],H=!((he=f==null?void 0:f.scoring)!=null&&he.requireAllPositionsAssigned||F!=null&&F.requireAllPositionsAssigned||G!=null&&G.requireAllPositionsAssigned)||E,$=p.sides&&p.sides.filter(Ie=>Ie==null?void 0:Ie.participantId).length===2,q=p.matchUpStatus&&[ua,Ea].includes(p.matchUpStatus),z=Ds({inContextDrawMatchUps:I,drawDefinition:e,matchUpId:l}),Z=Yv({inContextDrawMatchUps:I,drawDefinition:e,targetData:z}),Y=(((ae=T==null?void 0:T.drawPositions)==null?void 0:ae.length)===2&&T.drawPositions.every(Ie=>A==null?void 0:A.includes(Ie))&&((de=T==null?void 0:T.sides)==null?void 0:de.length)===2&&T.sides.every(({participantId:Ie})=>Ie)||$)&&!(q&&Z),Q={method:Hoe,type:Qb,payload:{drawId:d,matchUpId:l,penaltyCode:void 0,penaltyType:void 0,participantIds:[],notes:void 0}};if(O&&P.push({payload:{drawId:d,matchUpId:l,schedule:{}},method:sV,type:Fse}),Qs({policyActions:y,action:Qb})&&(w!=null&&w.participant||!s&&(S!=null&&S.length))&&P.push(Q),O&&Y&&P.push({type:Bse}),H&&Y){let{matchUpId:Ie,matchUpFormat:De}=p,Te={drawId:d,matchUpId:Ie,matchUpFormat:De,outcome:{scoreStringSide1:void 0,scoreStringSide2:void 0,sets:[]},winningSide:void 0};P.push({info:"set outcome and winningSide",method:sV,type:$se,payload:Te}),Qs({policyActions:y,action:uV})&&P.push({type:uV}),Qs({policyActions:y,action:dV})&&P.push({type:dV})}if(N&&T){let Ie=E_e({specifiedPolicyDefinitions:r,inContextDrawMatchUps:I,matchUpParticipantIds:S,matchUpActionsPolicy:g,inContextMatchUp:T,policyActions:y,enforceGender:a,participantId:o,sideNumber:s,matchUpId:l,matchUp:p,drawId:d,side:w});P.push(...Ie)}return{structureIsComplete:M,validActions:P,isDoubleExit:q,...ce}}function M_e({tournamentParticipants:t=[],sourceStructuresComplete:e,possiblyDisablingAction:i,isWinRatioFedStructure:n,activeDrawPositions:r,positionAssignments:a,drawDefinition:o,drawPosition:s,structureId:l,structure:c,drawId:u,event:d}){var v,y,b,I,T,w,S;if(r.includes(s)||n&&!e)return{};let{sourceStructureIds:p,targetStructureIds:h}=((v=o.links)==null?void 0:v.reduce((D,E)=>{var R,N;let C=(R=E.source)==null?void 0:R.structureId,P=(N=E.target)==null?void 0:N.structureId;return D.sourceStructureIds.includes(C)||D.sourceStructureIds.push(C),D.targetStructureIds.includes(P)||D.targetStructureIds.push(P),D},{sourceStructureIds:[],targetStructureIds:[]}))||{},f=[],m=((y=o.links)==null?void 0:y.filter(D=>{var E;return((E=D.target)==null?void 0:E.structureId)===c.structureId}))??[];for(let D of m){let E=(b=D==null?void 0:D.source)==null?void 0:b.structureId,{structure:C}=ui({structureId:E,drawDefinition:o}),P=(C==null?void 0:C.finishingPosition)===xI&&((p==null?void 0:p.length)!==1||(h==null?void 0:h.length)!==1),R={};if(P){let{matchUps:A}=wn({drawDefinition:o,structure:c,event:d}),{initialRoundNumber:_}=Xb({drawPosition:s,matchUps:A}),x=(w=(T=(I=o.links)==null?void 0:I.find(O=>{var B;return((B=O.target)==null?void 0:B.structureId)===(c==null?void 0:c.structureId)&&O.target.roundNumber===_}))==null?void 0:T.source)==null?void 0:w.roundNumber;R.roundNumbers=[x]}let{completedMatchUps:N}=Cx({structureId:E,inContext:!0,matchUpFilters:R,drawDefinition:o}),M=a.map(A=>A.participantId).filter(Boolean);(S=N==null?void 0:N.filter(({matchUpType:A,winningSide:_})=>_&&((d==null?void 0:d.eventType)!==ga||A===ga)).map(({winningSide:A,sides:_})=>A&&(_==null?void 0:_[1-(A-1)])).map(Gi).filter(A=>A&&!M.includes(A)))==null||S.forEach(A=>{f.includes(A)||f.push(A)})}let g=t==null?void 0:t.filter(D=>f==null?void 0:f.includes(D.participantId));return g==null||g.forEach(D=>{let E=(o.entries??[]).find(C=>C.participantId===D.participantId);D.entryPosition=E==null?void 0:E.entryPosition}),f!=null&&f.length?{validLuckyLosersAction:{type:Oq,method:wAe,availableLuckyLosers:g,availableLuckyLoserParticipantIds:f,willDisableLinks:i,payload:{drawId:u,structureId:l,drawPosition:s}}}:{}}function N_e({positionSourceStructureIds:t,unassignedParticipantIds:e,possiblyDisablingAction:i,provisionalPositioning:n,tournamentParticipants:r,isWinRatioFedStructure:a,positionAssignments:o,returnParticipants:s,appliedPolicies:l,drawDefinition:c,seedingProfile:u,isByePosition:d,drawPosition:p,structureId:h,event:f}){var T,w,S;let{drawId:m}=c,g=[],v,y,b=[],I=(w=(T=l==null?void 0:l[uu])==null?void 0:T.validSeedPositions)==null?void 0:w.ignore;if(I||({unplacedSeedParticipantIds:v,unplacedSeedAssignments:y,unfilledPositions:b}=boe({provisionalPositioning:n,returnAllProxies:!0,randomize:!0,drawDefinition:c,seedingProfile:u,structureId:h,event:f})),b!=null&&b.length||(b=o.filter(D=>!D.participantId&&!D.bye&&!D.qualifier).map(D=>D.drawPosition)),d||g.push({payload:{drawId:m,structureId:h,drawPosition:p,isPositionAction:!0},willDisableLinks:i,method:EAe,type:kA}),a&&I){let D=o.map(N=>N.participantId).filter(Boolean),E={structureIds:t},{completedMatchUps:C}=BT({inContext:!0,matchUpFilters:E,drawDefinition:c}),P=Pi((S=(C??[]).filter(({matchUpType:N})=>(f==null?void 0:f.eventType)!==ga||N===ga))==null?void 0:S.map(({sides:N})=>N==null?void 0:N.map(Gi)).flat().filter(N=>N&&!D.includes(N))),R=s?r==null?void 0:r.filter(N=>P==null?void 0:P.includes(N.participantId)).map(N=>Ot(N,void 0,!0)):void 0;return R==null||R.forEach(N=>{let M=(c.entries??[]).find(A=>A.participantId===N.participantId);N.entryPosition=M==null?void 0:M.entryPosition}),R!=null&&R.length&&g.push(zt({payload:{drawId:m,structureId:h,drawPosition:p},willDisableLinks:i,method:tY,type:Jb,availableParticipantIds:P,participantsAvailable:R})),{validAssignmentActions:g}}if(b.includes(p)||d){let D;if(y!=null&&y.length){let C=y.filter(P=>v==null?void 0:v.includes(P.participantId));C.sort(A_e),D=C.map(P=>P.participantId)}else D=e;let E=s?r==null?void 0:r.filter(C=>D.includes(C.participantId)).map(C=>Ot(C,void 0,!0)):void 0;E!=null&&E.length&&g.push(zt({payload:{drawId:m,structureId:h,drawPosition:p},willDisableLinks:i,method:tY,type:Jb,availableParticipantIds:D,participantsAvailable:E}))}return{validAssignmentActions:g}}function A_e(t,e){return t.bye||fS(t.seedValue)<fS(e.seedValue)||t.seedValue&&!e.seedValue?-1:(t.seedNumber||0)-(e.seedNumber||0)}function __e({drawPositionInitialRounds:t,tournamentParticipants:e,positionAssignments:i,returnParticipants:n,appliedPolicies:r,drawDefinition:a,drawPosition:o,structureId:s,drawId:l}){var T,w,S;let c=[],u=[],d=[],p=[],h=i.map(D=>D.participantId).filter(Boolean),f=r==null?void 0:r[Ef],m=!(f!=null&&f.disableRoundRestrictions)&&t[o],g=f==null?void 0:f.requireCompletedStructures,{sourceStructureIds:v,relevantLinks:y}=nV({targetRoundNumber:m,linkType:Df,drawDefinition:a,structureId:s})||{};v!=null&&v.length&&p.push(...v);let{sourceStructureIds:b,relevantLinks:I}=nV({targetRoundNumber:m,linkType:Uf,drawDefinition:a,structureId:s})||{};b!=null&&b.length&&p.push(...b);for(let D of y){let E=(T=a.structures)==null?void 0:T.find(P=>P.structureId===D.source.structureId);if((E==null?void 0:E.stage)!==Zt)continue;let C=Xm({structureId:D.source.structureId,drawDefinition:a});if(!g||C){let P=E.qualifyingRoundNumber,{matchUps:R}=wn({matchUpFilters:{roundNumbers:[P],hasWinningSide:!0},afterRecoveryTimes:!1,tournamentParticipants:e,inContext:!0,structure:E});for(let N of R){let M=N.sides.find(_=>(_==null?void 0:_.sideNumber)===N.winningSide),A=N.matchUpStatus===vn&&((w=N.sides)==null?void 0:w.find(({participantId:_})=>_));if(M||A){let{participantId:_,participant:x}=M||A||{};_&&!h.includes(_)&&(x&&n&&c.push(x),u.push(_))}}}}for(let D of I){let E=(S=a.structures)==null?void 0:S.find(P=>P.structureId===D.source.structureId);if((E==null?void 0:E.stage)!==Zt)continue;let C=Xm({structureId:D.source.structureId,drawDefinition:a});if(!g||C){let{positionAssignments:P}=Vn({structure:E}),R=(P==null?void 0:P.map(N=>{var _;let M=N.participantId,A=(_=Ri({element:N,name:qm}).extension)==null?void 0:_.value;return A?{participantId:M,groupOrder:A==null?void 0:A.groupOrder}:{}}).filter(({groupOrder:N,participantId:M})=>N===1&&!h.includes(M)).map(({participantId:N})=>N))??[];if(R&&u.push(...R),n){let N=e.filter(({participantId:M})=>R.includes(M));c.push(...N)}}}return u.length&&d.push(zt({payload:{qualifyingParticipantId:void 0,drawPosition:o,structureId:s,drawId:l},method:yAe,type:kx,qualifyingParticipantIds:u,qualifyingParticipants:n?c:void 0})),{validAssignmentActions:d,sourceStructureIds:p}}function k_e({onlyAssignedPositions:t=!0,possiblyDisablingAction:e,tournamentParticipants:i,inactiveDrawPositions:n,activeDrawPositions:r,positionAssignments:a,returnParticipants:o,byeDrawPositions:s,drawDefinition:l,isByePosition:c,drawPosition:u,structureId:d,structure:p,drawId:h,event:f}){if(r.includes(u))return{};let m=C=>!t||C.participantId||C.qualifier||C.bye,g=n==null?void 0:n.filter(C=>C!==u&&!(c&&s.includes(C))),v=(a==null?void 0:a.filter(C=>m(C)&&(g==null?void 0:g.includes(C.drawPosition))))??[],y=v.map(({drawPosition:C})=>C),{matchUps:b}=wn({afterRecoveryTimes:!1,inContext:!0,drawDefinition:l,structure:p,event:f}),I=b.filter(({drawPositions:C})=>Ts(C,y)),T=Object.assign({},...I.map(C=>{var P;return(P=C.sides)==null?void 0:P.filter(({sourceDrawPositionRange:R})=>R).map(({drawPosition:R,sourceDrawPositionRange:N})=>({[R]:N}))}).flat()),w=v.map(C=>C.participantId).filter(Boolean),S=(i??[]).filter(C=>w.includes(C.participantId)),D=Object.assign({},...S.map(C=>({[C.participantId]:C}))),E=v.map(C=>{let P=D==null?void 0:D[C.participantId],R=T[C.drawPosition];return zt({...C,participant:o?Ot(P,!1,!0):void 0,sourceDrawPositionRange:R})});return E.length?{validSwapAction:{payload:{drawId:h,structureId:d,drawPositions:[u]},willDisableLinks:e,method:Goe,type:xx,availableAssignments:E}}:{}}function n3(t){var Y;let e=di(t,[{event:!0,drawDefinition:!0,structureId:!0}]);if(e.error)return e;let{policyDefinitions:i,returnParticipants:n=!0,provisionalPositioning:r,tournamentRecord:a,drawDefinition:o,drawPosition:s,event:l}=t,c=t.tournamentParticipants??(a&&Nr({withIndividualParticipants:!0,tournamentRecord:a}).participants)??[],u=ui({structureId:t.structureId,drawDefinition:o});if(u.error)return u;let d=u.containingStructure||u.structure;if(!d)return{error:wr};let p=d.structureId;if(u=AC({drawDefinition:o,structureId:p}),s===void 0&&!u.isAdHoc)return{error:yT};if(u.isAdHoc)return Hx(t);if(u.error)return u;let{drawPositionInitialRounds:h,inactiveDrawPositions:f,activeDrawPositions:m,byeDrawPositions:g}=u,v=dn({tournamentRecord:a,drawDefinition:o,structure:d,event:l}).appliedPolicies??{};Object.assign(v,i??{});let{actionsPolicy:y,enabledStructures:b,actionsDisabled:I}=Ase({actionType:DN,appliedPolicies:v,drawDefinition:o,structure:d}),T=(y==null?void 0:y.activePositionOverrides)||[],{sourceStructureIds:w}=nV({finishingPosition:ET,targetRoundNumber:1,linkType:Uf,drawDefinition:o,structureId:p})||{},S;w!=null&&w.length&&(S=w.reduce((Q,X)=>Xm({structureId:X,drawDefinition:o})&&Q,!0));let D=w.length,E=w.length&&!S,{policyActions:C}=_se({enabledStructures:b,drawDefinition:o,structure:d}),P=![Zt,xt].includes(d.stage)||d.stageSequence!==1,{drawId:R}=o,N=[],{assignedPositions:M,positionAssignments:A}=ja({structure:d}),_=M==null?void 0:M.find(Q=>Q.drawPosition===s);if(!((Y=A==null?void 0:A.map(Q=>Q.drawPosition))!=null&&Y.includes(s)))return{error:vT};let{stage:x,stageSequence:O}=d,B=[x];x===Po&&B.push(xt),x===xt&&B.push(Po);let F=$I({entryStatuses:Dy,provisionalPositioning:r,drawDefinition:o,stageSequence:O,structureId:p,stages:B}),G=Ey({drawDefinition:o,stages:B}).assignedParticipantIds??[],H=F.filter(Q=>!G.includes(Q.participantId)).map(Q=>Q.participantId),$=g.includes(s),q=m.includes(s);if(I)return{hasPositionAssigned:!!_,info:"Actions Disabled for structure",isActiveDrawPosition:q,isDrawPosition:!0,validActions:[],isByePosition:$};if(Qs({policyActions:C,action:Jb})&&!q&&A&&!E&&(!_||$)){let{validAssignmentActions:Q}=N_e({positionSourceStructureIds:w,unassignedParticipantIds:H,possiblyDisablingAction:P,isWinRatioFedStructure:D,tournamentParticipants:c,positionAssignments:A,returnParticipants:n,appliedPolicies:v,drawDefinition:o,isByePosition:$,drawPosition:s,structureId:p,event:l});Q==null||Q.forEach(X=>N.push(X))}if(Qs({policyActions:C,action:kx})){let{validAssignmentActions:Q}=__e({drawPositionInitialRounds:h,tournamentParticipants:c,positionAssignments:A,returnParticipants:n,appliedPolicies:v,drawDefinition:o,drawPosition:s,structureId:p,drawId:R});Q==null||Q.forEach(X=>N.push(X))}let{participantId:z}=_||{},Z=z&&c.find(Q=>Q.participantId===z);if(_){Qs({policyActions:C,action:iV})&&!q&&(N.push({type:iV,method:eY,payload:{drawId:R,structureId:p,drawPosition:s},willDisableLinks:P}),$||N.push({type:xq,method:bAe,payload:{drawId:R,structureId:p,drawPosition:s},willDisableLinks:P}),Qs({policyActions:C,action:kA})&&!$&&N.push({type:kA,method:eY,payload:{drawId:R,structureId:p,drawPosition:s,replaceWithBye:!0},willDisableLinks:P}));let Q=d.stage===Zt||d.stage===xt&&d.stageSequence===1;if(!$&&dY({activePositionOverrides:T,activeDrawPositions:m,action:Db})&&Qs({policyActions:C,action:Db})&&NA({drawDefinition:o,structureId:p,drawPosition:s})&&Q){let{seedAssignments:X}=Vc({returnAllProxies:!0,drawDefinition:o,structure:d}),{seedNumber:oe,seedValue:re}=(X==null?void 0:X.find(me=>me.participantId===z))??{};N.push({type:Db,method:CAe,participant:Z,seedNumber:oe,payload:{drawId:R,structureId:p,participantId:z,seedValue:re}})}if(!$&&dY({activePositionOverrides:T,activeDrawPositions:m,action:F1})&&Qs({policyActions:C,action:F1})&&NA({drawDefinition:o,structureId:p,drawPosition:s})&&Q){let{seedAssignments:X}=Vc({returnAllProxies:!0,drawDefinition:o,structure:d}),{seedNumber:oe}=(X==null?void 0:X.find(re=>re.participantId===z))??{};N.push({method:DAe,type:F1,participant:Z,seedNumber:oe,payload:{participantId:z,structureId:p,drawId:R}})}if(!$&&z){if(Qs({policyActions:C,action:Qb})){let X={type:Qb,method:Hoe,participant:Z,payload:{penaltyCode:void 0,penaltyType:void 0,participantIds:[],notes:void 0,drawId:R}};N.push(X)}if(Qs({policyActions:C,action:$D})){let X={type:$D,method:UAe,participant:Z,payload:{participantId:z,otherName:void 0}};N.push(X)}}if(Qs({policyActions:C,action:xx})){let{validSwapAction:X}=k_e({possiblyDisablingAction:P,tournamentParticipants:c,inactiveDrawPositions:f,activeDrawPositions:m,positionAssignments:A,returnParticipants:n,byeDrawPositions:g,drawDefinition:o,isByePosition:$,drawPosition:s,structureId:p,structure:d,drawId:R});X&&N.push(X)}}if(Qs({policyActions:C,action:kq})&&!E){let{validAlternatesAction:Q}=C_e({possiblyDisablingAction:P,tournamentParticipants:c,positionAssignments:A,activeDrawPositions:m,returnParticipants:n,appliedPolicies:v,drawDefinition:o,drawPosition:s,validActions:N,structureId:p,structure:d,drawId:R,event:l});Q&&N.push(Q)}if(Qs({policyActions:C,action:Oq})&&!E&&A){let{validLuckyLosersAction:Q}=M_e({sourceStructuresComplete:S,possiblyDisablingAction:P,isWinRatioFedStructure:D,tournamentParticipants:c,activeDrawPositions:m,positionAssignments:A,drawDefinition:o,drawPosition:s,structureId:p,structure:d,drawId:R});Q&&N.push(Q)}if((Z==null?void 0:Z.participantType)===Ti&&Qs({policyActions:C,action:_q})){let{validModifyAssignedPairAction:Q}=T_e({tournamentParticipants:c,returnParticipants:n,drawPosition:s,participant:Z,drawId:R,event:l});Q&&N.push(Q)}return{hasPositionAssigned:!!_,isActiveDrawPosition:q,isDrawPosition:!0,isByePosition:$,validActions:N,...ce}}function QC({policyDefinitions:t,appliedPolicies:e,drawType:i}){var a,o;let n=(a=t==null?void 0:t[wA])==null?void 0:a.drawTypeCoercion,r=(o=e==null?void 0:e[wA])==null?void 0:o.drawTypeCoercion;return(typeof n=="boolean"?n:void 0)??(i&&(n==null?void 0:n[i]))??(typeof r=="boolean"?r:void 0)??(i&&(r==null?void 0:r[i]))??!0}function GD({tournamentRecord:t,drawDefinition:e,stage:i=xt,structureId:n,structure:r}){var s;if(!t)return{error:ut};if(!r&&!e)return{error:Vt};if(!r&&!n&&((s=e==null?void 0:e.structures)==null?void 0:s.filter(l=>l.stage===i).length)===1&&(r=e.structures.find(l=>l.stage===i)),!r&&!n)return{error:nc};let{error:a,positionAssignments:o}=Vn({drawDefinition:e,structureId:n,structure:r});return{positionAssignments:o??[],structureId:r==null?void 0:r.structureId,error:a}}function r3({structureId:t,drawDefinition:e}){if(!e)return{error:Vt};if(!$r(t))return{error:Re};let i=FT({drawDefinition:e,structureId:t});if(i.error)return i;let n=i.links.target.flatMap(a=>a.target.feedProfile).filter(Boolean),r=!zr([Fv,fu,Qk,Lv],n).length;return{...ce,valid:r}}function jse({participantsCount:t,participantCount:e}){if(t=t??e,!t)return{error:Re};let i=UT(t);return i?{drawSize:i}:pe({result:{error:Re},stack:"getEliminationDrawSize",context:{participantsCount:t}})}function eP(t){let{drawSizeProgression:e=!1,policyDefinitions:i,drawSize:n}=t||{},{requireParticipantCount:r=!0,tournamentRecord:a,drawDefinition:o,event:s}=t||{},l="getSeedsCount",c=(t==null?void 0:t.participantsCount)??(t==null?void 0:t.participantCount);if(!i){let f=em({tournamentRecord:a,drawDefinition:o,event:s});if(f.error)return pe({result:f,stack:l});i=f.policyDefinitions}let u=yi(c);if(c&&!u)return pe({result:{error:Re},context:{participantsCount:c},stack:l});if(r&&!u)return pe({result:{error:kne},stack:l});if(isNaN(n))if(c)({drawSize:n}=jse({participantsCount:c}));else return pe({result:{error:iC},stack:l});let d=r&&c||n;if(d&&d>n)return{error:jH};let p=i==null?void 0:i[uu];if(!p)return{error:Sne};let h=p.seedsCountThresholds;return h?(p.drawSizeProgression!==void 0&&(e=p.drawSizeProgression),{seedsCount:h.filter(f=>e?f.drawSize<=n:n===f.drawSize).reduce((f,m)=>c&&c>=m.minimumParticipantCount?m.seedsCount:f,0)}):{error:one}}function zx({consideredEntries:t,policyDefinitions:e,tournamentRecord:i,appliedPolicies:n,participantMap:r,enforceGender:a,participants:o,event:s}){var v;if((!o||!r)&&i&&({participants:o,participantMap:r}=Nr({tournamentRecord:i})),!o)return{error:rC};if(!Array.isArray(o))return{error:Re};if(!s)return{error:Qn};let l=(e==null?void 0:e[Qa])??(n==null?void 0:n[Qa])??VT[Qa],c=(a??((v=l==null?void 0:l.participants)==null?void 0:v.enforceGender))!==!1,{eventType:u,gender:d}=s,p=u===Gm,h=u===Lc&&On||p&&Ti||Hi,f=Object.assign({},...(t??s.entries??[]).map(y=>({[y.participantId]:y.entryStatus}))),m=Object.keys(f),g=o.filter(y=>m.includes(y.participantId)).filter(y=>{let b=x_e({participant:y,participantType:h,eventType:u,entryStatusMap:f}),I=O_e({genderEnforced:c,participantMap:r,eventGender:d,participant:y,isDoubles:p,mismatch:b});return b||!I});if(g.length){let y=g.map(b=>b.participantId);return{error:mne,invalidParticipantIds:y}}return{...ce,valid:!0}}function x_e({participant:t,participantType:e,eventType:i,entryStatusMap:n}){let r=n[t.participantId],a=i&&[Gm,Lc].includes(i)&&t.participantType===Hi&&(dv(r)||r===yh);return t.participantType!==e&&!a}function O_e(t){var d,p,h;let{participant:e,participantMap:i,eventGender:n,mismatch:r,isDoubles:a,genderEnforced:o}=t,s=!r&&a&&Pi(((d=e==null?void 0:e.individualParticipantIds)==null?void 0:d.map(f=>{var m,g,v;return(v=(g=(m=i==null?void 0:i[f])==null?void 0:m.participant)==null?void 0:g.person)==null?void 0:v.sex}).filter(Boolean))??[])||[],l=!n||!(s!=null&&s.length)||Id===n||[Gn,hr].includes(n)&&s[0]===n||nl===n&&(s.length==1&&((p=e.individualParticipantIds)==null?void 0:p.length)===1||s.length===2),c=(h=e==null?void 0:e.person)==null?void 0:h.sex,u=!(e!=null&&e.person)||!n||[Id,nl].includes(n)||[Gn,hr].includes(n)&&c===n;return!o||l&&u}function Gse({qualifyingProfiles:t,appliedPolicies:e,idPrefix:i,isMock:n,uuids:r}){var m;let a="generateQualifyingSTructures",o=[],s=[],l=[],c=(g,v)=>g.stageSequence-v.stageSequence,u=(g,v)=>g.roundTarget-v.roundTarget,d=0,p=0,h,f=1;for(let g of t.sort(u)){let v=g.structureProfiles||[];f=g.roundTarget||f;let y=1,b=0,I,T,w;for(let S of(v||[]).sort(c)){let D=QH(S.drawSize||S.participantsCount),{qualifyingRoundNumber:E,structureOptions:C,matchUpFormat:P,structureName:R,structureId:N,drawType:M}=S,A=S.matchUpType,_=S.qualifyingPositions||L_e({drawSize:D,qualifyingRoundNumber:E}),x,O,B;if(!yi(D))return pe({result:{error:iC},stack:a});let F=t.length>1?`${f}-`:"",G=v.length>1||F?y:"",H=R||(F||G?`${Eo(Zt)} ${F}${G}`:Eo(Zt));if(M===Cu){let{structures:$,groupCount:q,maxRoundNumber:z}=LC({structureName:S.structureName||H,structureId:N||(r==null?void 0:r.pop()),stage:Zt,structureOptions:C,appliedPolicies:e,stageSequence:y,matchUpType:A,roundTarget:f,drawSize:D,idPrefix:i,isMock:n,uuids:r});b=q,x=z,O=$[0],h=[1]}else({drawSize:D,matchUps:B,roundLimit:x}=fp({qualifyingRoundNumber:E,qualifyingPositions:_,matchUpType:A,drawSize:D,idPrefix:i,isMock:n,uuids:r})),O=Uc({structureName:S.structureName||H,structureId:N||(r==null?void 0:r.pop()),qualifyingRoundNumber:x,stage:Zt,matchUpFormat:P,stageSequence:y,matchUpType:A,roundLimit:x,matchUps:B}),f&&cn({extension:{name:Pp,value:f},element:O}),b=((m=B==null?void 0:B.filter($=>$.roundNumber===x))==null?void 0:m.length)||0;if(y>1){let{link:$}=jC({sourceStructureId:T,sourceRoundNumber:I,targetStructureId:O.structureId,finishingPositions:w===Uf?[1]:void 0,linkType:w});l.push($),d+=(D||0)-b}else d+=D||0;w=M===Cu?Uf:Df,T=O.structureId,I=x,s.push(O),y+=1}p+=b,o.push({qualifiersCount:b,finalQualifyingRoundNumber:I,finalQualifyingStructureId:T,finishingPositions:h,roundTarget:f,linkType:w}),f+=1}return{qualifiersCount:p,qualifyingDrawPositionsCount:d,qualifyingDetails:o,structures:s,...ce,links:l}}function L_e({drawSize:t,qualifyingRoundNumber:e}){let i=t,n=0;for(;n<e;)i=Math.floor(i/2),n+=1;return i}function Hse(t){let{drawTypeCoercion:e,enforceMinimumDrawSize:i}=t,n=ri(t.drawSize),r=e&&(typeof e=="boolean"||e<=2)&&n===2&&ep||t.drawType||ep,a=Are.includes(r);if(n&&a){if(e&&(typeof e=="boolean"&&n<4||n<=e))r=ep;else if(n<4&&i)return{...pe({context:{enforceMinimumDrawSize:i,drawSize:n,drawType:r},result:{error:xk},stack:"getCoercedDrawType"}),drawType:r}}return{drawType:r}}function F_e(t){let{drawDefinition:e,structureOptions:i,requireSequential:n}=t,r={structureName:Eo(xt),...t,stage:xt},{structures:a,groupCount:o,groupSize:s}=LC(r);if(o<1)return{error:Jne};let l=(i==null?void 0:i.playoffGroups)||[{finishingPositions:[1],structureName:Eo(Fr)}],[c]=a,{structures:u,links:d}=tse({sourceStructureId:c.structureId,requireSequential:n,drawDefinition:e,playoffGroups:l,groupCount:o,groupSize:s,...t});return u&&a.push(...u),{...ce,structures:a,links:d}}function B_e({mainStructure:t,consolationStructure:e,deciderStructure:i}){let n=e.matchUps.reduce((c,u)=>(u.drawPositions||[]).filter(Boolean).length&&!c.includes(u.roundNumber)?c.concat(u.roundNumber):c,[]),r=t.matchUps.reduce((c,u)=>!c||u.roundNumber>c?u.roundNumber:c,void 0),a=e.matchUps.reduce((c,u)=>!c||u.roundNumber>c?u.roundNumber:c,void 0),o=n.map((c,u)=>{let d=n.indexOf(c)%2?fu:Fv,p=1+u;return{linkType:hh,source:{roundNumber:p,structureId:t.structureId},target:{feedProfile:d,roundNumber:c,structureId:e.structureId}}}),s={linkType:Df,source:{roundNumber:a,structureId:e.structureId},target:{feedProfile:fu,roundNumber:r,structureId:t.structureId}},l=[{linkType:Df,source:{roundNumber:r,structureId:t.structureId},target:{feedProfile:fu,roundNumber:1,structureId:i.structureId}},{linkType:hh,source:{roundNumber:r,structureId:t.structureId},target:{feedProfile:fu,roundNumber:1,structureId:i.structureId}}];return[...o,s,...l]}function $_e({structureName:t,matchUpType:e,idPrefix:i,drawSize:n,isMock:r,uuids:a}){let o=[],{matchUps:s}=Jm({linkFedFinishingRoundNumbers:[1],drawSize:n+1,matchUpType:e,idPrefix:i,isMock:r}),l=Bm({structureName:t||Eo(xt),structureId:a==null?void 0:a.pop(),stageSequence:1,stage:xt,matchUpType:e,matchUps:s});o.push(l);let c=n/2,{matchUps:u}=Jm({finishingPositionOffset:c,idPrefix:i&&`${i}-c`,drawSize:n-1,isConsolation:!0,matchUpType:e,isMock:r,uuids:a}),d=Bm({structureName:Eo(Nre),matchUps:u,structureId:a==null?void 0:a.pop(),stage:Po,stageSequence:2,matchUpType:e});o.push(d);let{matchUps:p}=fp({idPrefix:i&&`${i}-p1t2`,drawSize:2,matchUpType:e,isMock:r}),h=Bm({structureName:Eo(Mre),matchUps:p,structureId:a==null?void 0:a.pop(),stageSequence:3,stage:Fr,matchUpType:e});o.push(h);let f=B_e({mainStructure:l,consolationStructure:d,deciderStructure:h});return{structures:o,links:f,...ce}}function V_e(t){let{qualifyingRoundNumber:e,finishingPositionOffset:i,qualifyingPositions:n,matchUpType:r,idPrefix:a,drawSize:o,isMock:s,uuids:l}=t;if(!yi(o)||o<2)return{matchUps:[],roundsCount:0};if(bd(o))return fp(t);let c=j_e(o),u=c.shift(),d=Et(1,((u==null?void 0:u.participantsCount)||0)+1).map(g=>({drawPosition:g})),p=[],h=1;({matchUps:p}=xA({roundNumber:h,matchUpType:r,idPrefix:a,matchUps:p,isMock:s,nodes:d,uuids:l})),h++;let f=t.roundLimit||e;for(let g of c){let v=g.participantsCount/2,y=Et(1,v+1);n&&v===n&&(f=h-1);let b=y.map(I=>{let T=Lq({roundPosition:I,roundNumber:h,idPrefix:a,uuids:l});return{roundPosition:I,roundNumber:h,matchUpId:T}});p.push(...b),h++}let m=h-1;return p=MC({finishingPositionOffset:i,lucky:!0,roundsCount:m,roundLimit:f,matchUps:p}),f&&(p=p.filter(g=>g.roundNumber<=f)),{matchUps:p,roundsCount:m,roundLimit:f}}function j_e(t){let e=ri(t),i=e%2?e+1:e,n=!!(Math.ceil(i/2)%2),r=[{participantsCount:i,preFeedRound:n}];for(;i>2;){let a=Math.ceil(i/2),o=a===1,s=!!(!o&&a%2);i=!o&&s?a+1:a;let l=!!(i!==2&&Math.ceil(i/2)%2);r.push({participantsCount:i,preFeedRound:l,feedRound:s})}return r}function zse(t){var h,f;let{playoffAttributes:e,stageSequence:i=1,stage:n=xt,matchUpType:r,drawSize:a,uuids:o}=t,s=()=>!t.isMock&&!t.idPrefix?void 0:`${t.drawDefinition.drawId}-s-0`,l=t.structureId||s()||(o==null?void 0:o.pop()),c=t.appliedPolicies??dn(t),u=((h=t.policyDefinitions)==null?void 0:h[uS])||(c==null?void 0:c[uS]);t.skipRounds=t.skipRounds||a<=4&&(u!=null&&u.feedFromMainFinal?0:1)||0;let d=t.structureName??((f=e==null?void 0:e["0"])==null?void 0:f.name)??Eo(xt),p=()=>{let{matchUps:m}=fp(t);return{structures:[Uc({stageSequence:i,structureName:d,matchUpType:r,structureId:l,matchUps:m,stage:n})],links:[],...ce}};return{generators:{[Fc]:()=>({structures:[Uc({finishingPosition:ET,stageSequence:i,structureName:d,matchUps:[],matchUpType:r,structureId:l,stage:n})],links:[],...ce}),[yy]:()=>{let{matchUps:m}=V_e(t);return{structures:[Uc({stageSequence:i,structureName:d,matchUpType:r,structureId:l,matchUps:m,stage:n})],links:[],...ce}},[ep]:()=>p(),[sC]:()=>$_e(t),[aS]:()=>V0({...t,roundOffsetLimit:3,playoffAttributes:e??uz}),[oS]:()=>V0({...t,roundOffsetLimit:2,playoffAttributes:e??dz}),[Fr]:()=>V0(t),[DT]:()=>{let{matchUps:m}=Jm({drawSize:a,uuids:o,matchUpType:r});return{structures:[Uc({stageSequence:i,structureName:d,matchUpType:r,structureId:l,stage:xt,matchUps:m})],links:[],...ce}},[lC]:()=>Joe(t),[sS]:()=>ab({...t,feedRounds:1,fmlc:!0}),[Rre]:()=>ab({...t,feedRounds:1}),[sz]:()=>ab({...t,feedsFromFinal:1}),[lz]:()=>ab({...t,feedsFromFinal:2}),[cz]:()=>ab({...t,feedsFromFinal:3}),[cC]:()=>ab(t),[ex]:()=>ese(t),[Cu]:()=>LC(t),[mh]:()=>F_e(t)}}}function a3(t){var H,$,q,z,Z;let{enforceMinimumDrawSize:e=!0,overwriteExisting:i,appliedPolicies:n,staggeredEntry:r,drawDefinition:a,tieFormat:o,isMock:s,uuids:l}=t||{},c=ri(t.drawSize),u=t.drawTypeCoercion??QC({appliedPolicies:n,drawType:t.drawType}),d="generateDrawStructuresAndLinks",p=Hse({drawType:t.drawType,enforceMinimumDrawSize:e,drawTypeCoercion:u,drawSize:c});if(p.error)return p;let h=p.drawType,f=[],m=[],g=(t==null?void 0:t.matchUpType)??or,v=(H=a==null?void 0:a.structures)==null?void 0:H.filter(({stage:Y})=>Y===Zt);v&&f.push(...v);let y=v==null?void 0:v.map(({structureId:Y})=>Y),b=($=a==null?void 0:a.structures)==null?void 0:$.find(({stage:Y,stageSequence:Q})=>Y===xt&&Q===1),I=(q=a==null?void 0:a.links)==null?void 0:q.filter(Y=>Y.target.structureId===(b==null?void 0:b.structureId)&&(y==null?void 0:y.includes(Y.source.structureId))),T=(Y,Q)=>{var X;if(Y.linkType===Uf&&(Q!=null&&Q.structures)){let oe=Y.source.finishingPositions||[];return Q.structures.length*oe.length}else if(Y.linkType===Df&&((X=Q==null?void 0:Q.matchUps)!=null&&X.length)){let oe=Y.source.roundNumber;return Q.matchUps.filter(({roundNumber:re})=>re===oe).length}},w=v==null?void 0:v.map(Y=>{var se,te,he;let Q=I==null?void 0:I.find(ae=>ae.target.structureId===Y.structureId),X=((te=(se=Vn({structure:Y}))==null?void 0:se.positionAssignments)==null?void 0:te.length)??0;if(!Q)return X;let oe=Q==null?void 0:Q.source.structureId,re=(he=a.structures)==null?void 0:he.find(ae=>ae.structureId===oe),me=T(Q,re)||0;return X-me}).filter(Boolean).reduce((Y,Q)=>Y+Q,0),S=I==null?void 0:I.map(Y=>{let Q=Y.source.structureId,X=v==null?void 0:v.find(oe=>oe.structureId===Q);return T(Y,X)}).filter(Boolean).reduce((Y,Q)=>Y+Q,0),D=!!(b&&!((z=b==null?void 0:b.matchUps)!=null&&z.length));if(v!=null&&v.length&&!D)return{error:F2};let E=!(v!=null&&v.length)&&t.qualifyingProfiles,C=(E==null?void 0:E.length)&&Gse({idPrefix:t.idPrefix,qualifyingProfiles:E,appliedPolicies:n,isMock:s,uuids:l});if(C!=null&&C.error)return C;let{qualifyingDrawPositionsCount:P,qualifyingDetails:R,qualifiersCount:N}=C||{qualifyingDrawPositionsCount:w,qualifiersCount:S};P&&(C!=null&&C.structures&&f.push(...C.structures),C!=null&&C.links&&m.push(...C.links)),Object.assign(t,zt({drawSize:c,matchUpType:g,tieFormat:o}));let M=h!==Fc&&(!c||c<2||!r&&![DT,yy].includes(h)&&([mh,Cu].includes(h)&&c<3||![Cu,mh].includes(h)&&!bd(c)));if(M&&!P)return pe({context:{drawSize:c,invalidDrawSize:M},result:{error:xk},stack:d});let{generators:A,error:_}=zse(t);if(_)return{error:_};let x=A[h];if(!x)return{error:PH};let O=x==null?void 0:x();if(O.error)return O;let{structures:B,links:F}=O;if(B!=null&&B.length){let Y=B.find(({stage:Q,stageSequence:X})=>Q===xt&&X===1);if(b&&Y){if(D){let Q=Y.structureId;if(Y.structureId=b.structureId,F==null?void 0:F.length)for(let X of F)X.source.structureId===Q&&(X.source.structureId=b.structureId),X.target.structureId===Q&&(X.target.structureId=b.structureId)}else if(!i)return{error:F2}}f.push(...B)}f.sort(FI),F!=null&&F.length&&m.push(...F);let G=O.structures.find(({stage:Y,stageSequence:Q})=>Y===xt&&Q===1);for(let Y of R||[]){let{finalQualifyingRoundNumber:Q,finalQualifyingStructureId:X,roundTarget:oe,finishingPositions:re,linkType:me}=Y,se=G&&((Z=jC({targetStructureId:G.structureId,sourceStructureId:X,sourceRoundNumber:Q,finishingPositions:re,targetEntryRound:oe,linkType:me}))==null?void 0:Z.link);if(se!=null&&se.error)return se;se&&m.push(se)}return I&&m.push(...I),{...ce,qualifyingResult:{qualifyingDrawPositionsCount:P,qualifiersCount:N},structures:f,links:m}}function o3(t){var b,I;let{modifyOriginal:e=!0,stageSequence:i=1,isMock:n}=t||{},r="generateDrawTypeAndModifyDrawDefinition";if(!t.drawDefinition)return pe({result:{error:Vt},stack:r});let a=e?t.drawDefinition:Ot(t.drawDefinition,!1,!0),{tieFormat:o,matchUpType:s}=t;if(o){let T=ll({tieFormat:o});if(T.error)return T}o=wo(o??((b=is({drawDefinition:a}))==null?void 0:b.tieFormat)),s=s??(a.matchUpType||or),t.tieFormat=o,t.matchUpType=s;let l=MA({drawDefinition:a,stage:xt});t.drawSize=t.drawSize??l,!l&&t.drawSize&&_A({drawSize:t.drawSize,drawDefinition:a,stageSequence:i,stage:xt});let c=Ao({drawDefinition:a}).drawMatchUps.map($a),u=a3(t);if(u.error)return pe({result:u,stack:r});let{structures:d,links:p,qualifyingResult:h}=u;a.structures=d,a.links=p;let f=Math.max(t.qualifiersCount??0,(h==null?void 0:h.qualifiersCount)||0);if(h!=null&&h.qualifyingDrawPositionsCount&&!MA({stage:Zt,drawDefinition:a})){let T=_A({drawSize:h.qualifyingDrawPositionsCount,stage:Zt,drawDefinition:a});if(T.error)return T}if(f){let T=Voe({qualifiersCount:f,drawDefinition:a,stage:xt});if(T.error)return T}let m=t.drawSize??l;Object.assign(t,zt({drawSize:m,matchUpType:s,tieFormat:o}));let{matchUps:g,matchUpsMap:v}=Ia({drawDefinition:a});o&&(g==null||g.forEach(T=>{if(!c.includes(T.matchUpId)){let{tieMatchUps:w}=HC({tieFormat:o,matchUp:T,isMock:n});Object.assign(T,{tieMatchUps:w,matchUpType:s})}}));let{inContextDrawMatchUps:y}=Wv({drawDefinition:a,matchUpsMap:v});return qn({tournamentId:(I=t.tournamentRecord)==null?void 0:I.tournamentId,drawDefinition:a}),{inContextDrawMatchUps:y,drawDefinition:a,matchUpsMap:v,...ce,structures:d,matchUps:g,links:p}}function tP(t){let{removePriorValues:e,tournamentRecord:i,participantId:n,scaleItem:r}=t,a,o;if(!Wse({scaleItem:r}))return{error:aC};if(n&&Array.isArray(i.participants)&&(o=i.participants.find(s=>s.participantId===n),o)){let s=Kse({removePriorValues:e,participant:o,scaleItem:r});if(s.error)return s;a=!s.valueChanged;let{topics:l}=rc();l.includes(Ro)&&wi({topic:Ro,payload:{tournamentId:i.tournamentId,participants:[o]}})}return a&&{...ce,info:ZH,existingValue:r==null?void 0:r.scaleValue}||o&&{...ce,newValue:r==null?void 0:r.scaleValue}||{error:Vr}}function qse(t){var d;let{scaleItemsWithParticipantIds:e=[],removePriorValues:i,tournamentRecord:n,auditData:r,context:a}=t;if(!n)return{error:ut};if(!n.participants)return{error:rC};let o=0,s={},l=[];for(let p of e){let h=p==null?void 0:p.participantId;if(Array.isArray(p==null?void 0:p.scaleItems))for(let f of p.scaleItems)if(Wse({scaleItem:f}))Array.isArray(s[h])||(s[h]=[]),s[h].push(f);else return{error:aC}}n.participants.forEach(p=>{let{participantId:h}=p||{};Array.isArray(s[h])&&s[h].forEach(f=>{Kse({participant:p,scaleItem:f,removePriorValues:i}),l.push(p),o++})});let c=o?void 0:TT,{topics:u}=rc();if(u.includes(Ro)&&o&&wi({topic:Ro,payload:{tournamentId:n.tournamentId,participants:l}}),a){let{eventId:p,drawId:h,...f}=a,m=((d=f.scaleAttributes)==null?void 0:d.scaleType)&&[f.scaleAttributes.scaleType];if(Object.keys(f).length){let g={itemType:Lz,itemValue:f};if(m&&(g.itemSubTypes=m),h||p){let{drawDefinition:v,event:y}=zs({tournamentRecord:n,eventId:p,drawId:h});h&&Aq({drawDefinition:v,timeItem:g}),p&&YI({event:y,timeItem:g})}else XC({tournamentRecord:n,timeItem:g})}}return r&&u.includes(gf)&&wi({topic:gf,payload:r}),zt({...ce,modificationsApplied:o,info:c})}function Wse({scaleItem:t}){let e=t&&Object.keys(t),i=["scaleType","eventType","scaleName"];return i.filter(n=>e==null?void 0:e.includes(n)).length===i.length}function Kse({removePriorValues:t,participant:e,scaleItem:i}){if(!e)return{error:NI};let n=i&&Object.keys(i),r=["scaleType","eventType","scaleName"];if(r.filter(c=>n.includes(c)&&i[c]).length!==r.length)return{error:aC};let a=new Date().toISOString();e.timeItems||(e.timeItems=[]);let{scaleItem:o}=th({scaleAttributes:i,participant:e}),s=c=>[void 0,null,""].includes(c),l=!(s(o==null?void 0:o.scaleValue)&&s(i.scaleValue))&&JSON.stringify(o==null?void 0:o.scaleValue)!==JSON.stringify(i.scaleValue);if(l){let{scaleType:c,eventType:u,scaleName:d}=i,p=[Bv,c,u,d].join("."),h=zt({itemValue:i.scaleValue,itemDate:i.scaleDate,createdAt:a,itemType:p});i.scaleId&&(h.itemSubTypes=[i.scaleId]),t&&(e.timeItems=e.timeItems.filter(f=>f.itemType!==p)),e.timeItems.push(h)}return{...ce,valueChanged:l,newValue:i.scaleValue}}function s3(t){let{tournamentRecord:e,modifiedScaleValues:i,removePriorValues:n}=t,r=di(t,[{[ls]:!0},{modifiedScaleValues:!0,[$l]:vl}]);if(r.error)return r;for(let a in i){let o=tP({scaleItem:i[a],removePriorValues:n,tournamentRecord:e,participantId:a});if(o.error)return o}return{...ce}}function gS(t){let{tournamentRecord:e,scaleAttributes:i,participantId:n}=t,r=t.tournamentRecords||e&&{[e.tournamentId]:e}||{};if(!n)return{error:ya};let{participant:a,tournamentId:o}=Eg({tournamentRecords:r,tournamentRecord:e,participantId:n});return a?{...th({participant:a,scaleAttributes:i}),tournamentId:o}:{error:Vr}}var G_e=(t=0)=>250/Math.pow(t+5,.4),H_e=()=>1;function z_e(t=3,e=2){let i=t/e;return isNaN(i)?h0.kDefault():i}var h0={nSpread:400,diffThreshold:.125,kCalc:G_e,kMultiplier:z_e,kDefault:H_e};function Yse(t){let{winnerRating:e,loserRating:i}=t,{ratings:n=La,winnerCountables:r=1,loserCountables:a=0,ratingType:o=hu,maxCountables:s,countables:l}=t||{},c=n==null?void 0:n[o];if(!c)return{error:Yt};let u=c.range||t.ratingRange;e=e||c.defaultInitialization,i=i||c.defaultInitialization;let d=u[0]>u[1],p=c.decimalsCount||0,h=d?u.slice().reverse():u,f=(_,x)=>parseFloat(x)>=Math.min(..._)&&parseFloat(x)<=Math.max(..._);(!f(u,e)||!f(u,i))&&(f(u,e)||(e=c.defaultInitialization),f(u,i)||(i=c.defaultInitialization));let m=P0({targetRange:La[hu].range,sourceRange:h,value:d?u[0]-e:e}),g=P0({targetRange:La[hu].range,sourceRange:h,value:d?u[0]-i:i}),v=(_,x)=>1/(1+Math.pow(10,(x-_)/h0.nSpread)),y=v(m,g),b=v(g,m),I=h0.kCalc(r),T=h0.kCalc(a),w=h0.kMultiplier(s,l),S=m+w*I*(1-y),D=g+w*T*(0-b),E=P0({sourceRange:La[hu].range,value:S,targetRange:h}),C=P0({sourceRange:La[hu].range,value:D,targetRange:h}),P=d?u[0]-E:E,R=parseFloat(P.toFixed(p)),N=d?u[0]-C:C,M=parseFloat(N.toFixed(p)),A=Math.max(...u)?Math.abs(e-i)/Math.max(...u):0;return(E>C&&A>h0.diffThreshold||R<0||M<0)&&(R=e,M=i),{newWinnerRating:R,newLoserRating:M}}var q_e=t=>(t==null?void 0:t.reduce((e,i)=>(i.winningSide&&(e[i.winningSide-1]+=1),e),[0,0]))||[0,0];function Zse(t){var y,b;let e=di(t,[{[ls]:!0},{matchUpIds:!0,[$l]:gs,[Jp]:PI},{ratingType:!1,[$o]:I=>La[I]}]);if(e.error)return e;let{updateParticipantRatings:i,removePriorValues:n=!0,tournamentRecord:r,ratingType:a=hu,refreshDynamic:o,considerGames:s,drawDefinition:l,matchUpIds:c,asDynamic:u}=t,d=La[a],{accessor:p}=d,h={},f=(t.matchUps||o&&ws({drawDefinition:l,tournamentRecord:r,inContext:!0,matchUpFilters:{matchUpStatuses:ba}}).matchUps||oo({matchUpFilters:{matchUpIds:c,matchUpStatuses:ba},tournamentRecord:r,inContext:!0}).matchUps)??[],m=`${a}.${vz}`,g=u?m:a;f.sort(GI);for(let I of f){let{endDate:T,matchUpFormat:w,score:S,sides:D,winningSide:E}=I,C=I.matchUpType,P={eventType:C,scaleName:a,scaleType:Lm},R={scaleName:m,eventType:C,scaleType:Lm},N=Object.assign({},...(D??[]).map(H=>{let{sideNumber:$,participant:q}=H;return $&&{[$]:[q==null?void 0:q.participantId,...(q==null?void 0:q.individualParticipantIds)??[]].filter(Boolean).flat()}})),M=Object.assign({},...Object.values(N).flat().map(H=>{let $=h[H],q=!o||$?gS({scaleAttributes:R,tournamentRecord:r,participantId:H}).scaleItem:void 0,z=gS({tournamentRecord:r,scaleAttributes:P,participantId:H}).scaleItem,Z=p?{[p]:void 0}:void 0;return H&&{[H]:q??z??{scaleName:g,eventType:C,scaleDate:T,scaleType:Lm,scaleValue:Z}}})),A=w?Ys(w):{},_=(A==null?void 0:A.bestOf)||1,x=(A==null?void 0:A.setsTo)||1,O=s?_&x:_,B=(S==null?void 0:S.sets)&&q_e(S.sets)||E===1&&[1,0]||[0,1],F=E?N[E]:[],G=E?N[3-E]:[];for(let H of F){let $=(y=M[H])==null?void 0:y.scaleValue,q=typeof $=="object"?$[p]:$;for(let z of G){let Z=(b=M[z])==null?void 0:b.scaleValue,Y=typeof Z=="object"?Z[p]:Z,Q=E?B[E]:[0,0],X=E?B[3-E]:[0,0],{newWinnerRating:oe,newLoserRating:re}=Yse({winnerCountables:Q,loserCountables:X,maxCountables:O,winnerRating:q,loserRating:Y,ratingType:a}),me=p?{...$,[p]:oe}:oe,se=p?{...Z,[p]:re}:re;M[H].scaleValue=me,M[z].scaleValue=se,M[H].scaleName=g,M[z].scaleName=g}}Object.assign(h,M),i&&s3({tournamentRecord:r,modifiedScaleValues:h,removePriorValues:n})}let v=f.map(({matchUpId:I})=>I);return{...ce,modifiedScaleValues:h,outputScaleName:g,processedMatchUpIds:v}}function qx(t){var g;let{matchUpIds:e=[],drawDefinition:i,roundNumber:n,newRound:r,isMock:a,event:o}=t;if(typeof i!="object")return{error:Vt};let{participantIdPairings:s,matchUpsCount:l}=t,c=Gx(t);if(c.error)return pe({result:c});let{lastRoundNumber:u,availableMatchUpsCount:d=0,roundMatchUpsCount:p=0}=c;if(!l)r?l=p:d>0&&(l=d);else if(l>p&&t.restrictMatchUpsCount!==!1)return pe({result:{error:Re,info:"matchUpsCount error",context:{roundMatchUpsCount:p}}});if(s&&!Array.isArray(s)||l&&!yi(l)||e&&!Array.isArray(e)||!s&&!l)return{error:Re,info:"matchUpsCount or pairings error"};if(l&&t.restrictMatchUpsCount!==!1&&l>32)return{error:Re,info:"matchUpsCount must be less than 33"};if(n&&!t.ignoreLastRoundNumber&&n-1>(u||0))return{error:Re,info:"roundNumber error"};let h=n??(r&&(u??0)+1||u||1);s=s??Et(0,l).map(()=>({participantIds:[void 0,void 0]}));let f=v=>{if(!t.idPrefix)return;let y=i.drawId,b=t.idPrefix??"ah";return`${y}-${b}-${h}-${v}`},m=s==null?void 0:s.map((v,y)=>{let b=(v==null?void 0:v.participantIds)??[void 0,void 0];b.push(void 0,void 0);let I=b.slice(0,2).map((w,S)=>zt({sideNumber:S+1,participantId:w})),T=e[y]??f(y)??Pn();return{roundNumber:h,matchUpStatus:qr,matchUpId:T,sides:I}});if(m!=null&&m.length){let v=(g=is({drawDefinition:i,event:o}))==null?void 0:g.tieFormat;v&&m.forEach(y=>{let{tieMatchUps:b}=HC({tieFormat:v,matchUp:y,isMock:a});Object.assign(y,{tieMatchUps:b,matchUpType:Xn})})}return{roundNumber:h,matchUpsCount:(m==null?void 0:m.length)??0,matchUps:m,...ce}}function W_e({maxIterations:t=4e3,valueSortedPairings:e,pairingValues:i,valueObjects:n,deltaObjects:r}){let a=Object.assign({},...e.map(y=>({[y.pairing]:y.value}))),o=Object.keys(i),s=[],l=hY({actorsCount:o.length,valueSortedPairings:e,pairingValueMap:a,deltaObjects:r,valueObjects:n}),c=[OB(l)];s.push(l);let u=l.value,d=l,p=0,h=0,f=o.length,m;do f-=1,m=o.length*i[o[0]].length;while(m>t&&f>5);let g=[];o.forEach(y=>{i[y].slice(0,f).forEach(b=>{h+=1;let I=Eb(y,b.opponent);if(!g.includes(I)){let T=hY({stipulated:[[y,b.opponent]],actorsCount:o.length,valueSortedPairings:e,pairingValueMap:a,deltaObjects:r,valueObjects:n});if(!c.includes(OB(T))){c.push(OB(T)),s.push(T);let{maxDelta:w,value:S}=T;w<d.maxDelta&&(d=T),(S<u||S===u&&Math.round(Math.random()))&&(u=S),g.push(I),p+=1}}}),s=s.filter(b=>Math.abs(b.value-u)<5)}),s.sort((y,b)=>y.maxDiff-b.maxDiff);let v=Sl(s);return{candidatesCount:p,deltaCandidate:d,maxIterations:t,iterations:h,candidate:v}}function OB(t){return t.participantIdPairings.map(({participantIds:e})=>e.sort().join("|")).sort().join("/")}function hY({valueSortedPairings:t,stipulated:e=[],pairingValueMap:i,deltaObjects:n,valueObjects:r,actorsCount:a}){let o=[].concat(...e),s=[],l=0;e.filter(Boolean).forEach(d=>{let[p,h]=d,f=Eb(p,h),m=i[f];s.push({participantIds:d,value:m}),l+=i[f]}),ro(t,a).map(d=>bs(d).map(p=>({...p,value:p.value+Math.random()*Math.round(Math.random())}))).flat().forEach(d=>{let p=d.pairing.split("|");if(!p.reduce((h,f)=>o.includes(f)||h,!1)){o.push(...p);let h=d.value;l+=h,s.push({participantIds:p,value:h})}}),s.sort((d,p)=>d.value-p.value);let c=s.reduce((d,p)=>{let[h,f]=p.participantIds,m=Eb(h,f),g=n[m];return g>d?g:d},0),u=s.reduce((d,p)=>{let[h,f]=p.participantIds,m=Eb(h,f),g=r[m];return g>d?g:d},0);return{value:l,participantIdPairings:s,maxDelta:c,maxDiff:u}}function Eb(t,e){return[t,e].sort(Px).join("|")}function Xse({participantIds:t}){let e={},i=[];t.forEach(r=>{e[r]=t.filter(a=>a!==r),e[r].forEach(a=>{let o=Eb(a,r);i.includes(o)||i.push(o)})});let n=Object.assign({},...i.map(r=>({[r]:0})));return{uniquePairings:i,possiblePairings:e,deltaObjects:n}}function K_e({matchUps:t}){let e=[];for(let i of t){let n=i.sides.map(Gi);if(n.length===2){let[r,a]=n,o=Eb(r,a);e.includes(o)||e.push(o)}}return{encounters:e}}function Y_e({possiblePairings:t,valueObjects:e}){let i={};for(let r of Object.keys(t)){let a=t[r].map(o=>n(r,o));i[r]=a.sort((o,s)=>o.value-s.value)}function n(r,a){let o=Eb(r,a);return{opponent:a,value:e[o]}}return{pairingValues:i}}var Z_e=0;function X_e({tournamentParticipants:t,adHocRatings:e,eventType:i,scaleName:n,pairing:r}){var o;let a=((o=La[n])==null?void 0:o.defaultInitialization)??Z_e;return r.split("|").map(s=>{var l;if(i===Oc){let c=(l=t==null?void 0:t.find(u=>u.participantId===s))==null?void 0:l.individualParticipantIds;return c?c==null?void 0:c.map(u=>e[u]||a):a*2}else return e[s]||a})}function J_e(t){let{tournamentParticipants:e,adHocRatings:i={},possiblePairings:n,uniquePairings:r,maxIterations:a,minimizeDelta:o,deltaObjects:s,valueObjects:l,eventType:c,scaleName:u,salted:d}=t;r.forEach(b=>{let I=X_e({tournamentParticipants:e,adHocRatings:i,scaleName:u,eventType:c,pairing:b}),T=typeof d=="number"&&d||.5,w=d&&(Math.round(Math.random())?T:T*-1)||0,S=Math.abs(I[0]-I[1])+w,D=Math.abs(I[0]-I[1]);s[b]=D,l[b]||(l[b]=0),l[b]+=S?Math.pow(S,2):0});let p=r.map(b=>({pairing:b,value:l[b]})).sort((b,I)=>b.value-I.value),{pairingValues:h}=Y_e({possiblePairings:n,valueObjects:l}),{candidate:f,candidatesCount:m,deltaCandidate:g,iterations:v}=W_e({valueSortedPairings:p,maxIterations:a,pairingValues:h,deltaObjects:s,valueObjects:l}),{participantIdPairings:y}=o?g:f;return{participantIdPairings:y,candidatesCount:m,deltaCandidate:g,iterations:v,candidate:f}}var Q_e=100,eke=100,tke=4e3;function l3(t){var Z,Y;let{encounterValue:e=Q_e,sameTeamValue:i=eke,maxIterations:n=tke,updateParticipantRatings:r,generateMatchUps:a=!0,ignoreLastRoundNumber:o,iterationMatchUps:s,tournamentRecord:l,dynamicRatings:c,refreshDynamic:u,participantIds:d,drawDefinition:p,roundNumber:h,structureId:f,matchUpIds:m,eventType:g,scaleName:v,idPrefix:y,isMock:b,salted:I,event:T}=t;if(!p)return{error:Vt};if(!t.structure&&!f)return{error:wr};let w=t.structure||ui({drawDefinition:p,structureId:f}).structure;if(!Xi(w))return{error:gy};if(!(d!=null&&d.length))return{error:Ig};let S=[...s??[],...(w==null?void 0:w.matchUps)??[]],{encounters:D}=K_e({matchUps:S}),E=(l==null?void 0:l.participants)??[],C={};if(c){let Q=Pi(w!=null&&w.matchUps?w.matchUps.map(({roundNumber:oe})=>oe):[]),X=Math.max(...Q,0);if(X){let oe=(Z=w==null?void 0:w.matchUps)==null?void 0:Z.filter(({roundNumber:me})=>me===X).map(({matchUpId:me})=>me),re=Zse({ratingType:v??((Y=T==null?void 0:T.category)==null?void 0:Y.ratingType),updateParticipantRatings:r,tournamentRecord:l,asDynamic:!0,refreshDynamic:u,drawDefinition:p,matchUpIds:oe});if(re.error)return re;re.modifiedScaleValues&&(C=re.modifiedScaleValues)}}let{valueObjects:P}=ike({tournamentParticipants:E,encounterValue:e,sameTeamValue:i,encounters:D}),{uniquePairings:R,possiblePairings:N,deltaObjects:M}=Xse({participantIds:d}),A=Object.values(C).length?C:t.adHocRatings,_={tournamentParticipants:E,possiblePairings:N,participantIds:d,uniquePairings:R,drawDefinition:p,maxIterations:n,adHocRatings:A,deltaObjects:M,valueObjects:P,eventType:g,scaleName:v,structure:w,salted:I},{candidatesCount:x,participantIdPairings:O,deltaCandidate:B,iterations:F,candidate:G}=J_e(_);if(!x)return{error:jk};let H,$;if(a){let Q=qx({structureId:w==null?void 0:w.structureId,ignoreLastRoundNumber:o,participantIdPairings:O,newRound:!0,drawDefinition:p,roundNumber:h,matchUpIds:m,idPrefix:y,isMock:b,event:T});if(Q.error)return Q;H=Q.roundNumber,$=Q.matchUps}let{maxDelta:q,maxDiff:z}=G;return{roundNumber:H,participantIdPairings:O,modifiedScaleValues:C,candidatesCount:x,deltaCandidate:B,...ce,iterations:F,matchUps:$,maxDelta:q,maxDiff:z}}function ike({encounters:t,tournamentParticipants:e,encounterValue:i,sameTeamValue:n}){let r={};for(let o of t)r[o]||(r[o]=0),r[o]+=i;let a=e==null?void 0:e.filter(({participantType:o})=>o===On);if(a)for(let o of a){let s=o.individualParticipantIds??[],{uniquePairings:l}=Xse({participantIds:s});for(let c of l)r[c]||(r[c]=0),r[c]+=n}return{valueObjects:r}}function Jse(t){var P,R,N,M;let{drawType:e=ep,attachConsolation:i=!0,applyPositioning:n=!0,tournamentRecord:r,staggeredEntry:a,automated:o,placeByes:s,isMock:l,event:c}=t,u=t==null?void 0:t.drawDefinition;if(!u)return{error:Vt};let d=Ja,p=$I({stageSequence:1,drawDefinition:u,stage:d}),h=[Cu,sC,mh].includes(e)?p.length:UT(p.length);if(!a&&e===DT&&p.length<2||e===Cu&&p.length<3)return{error:xk};let{tieFormat:f,matchUpType:m}=t;if(f){let A=ll({tieFormat:f});if(A.error)return A}f=wo(f??((P=is({drawDefinition:u}))==null?void 0:P.tieFormat)),m=m??u.matchUpType??or;let{structures:g}=Ru({stageSequence:1,drawDefinition:u,stage:d});if(g.length>1)return{error:vne};if((N=(R=g==null?void 0:g[0])==null?void 0:R.matchUps)!=null&&N.length)return{error:JH};let v=(M=g==null?void 0:g[0])==null?void 0:M.structureId;Object.assign(t,zt({structureName:t.structureName??Eo(Ja),structureId:v,matchUpType:m,tieFormat:f,drawSize:h,stage:d}));let y=zse(t);if(y.error)return y;let b=y.generators[e];if(!b)return{error:PH};let I=b==null?void 0:b();if(I.error)return I;let{structures:T,links:w}=I,S=T.map(A=>wn({structure:A}).matchUps).flat();f&&S.forEach(A=>{let{tieMatchUps:_}=HC({matchUp:A,tieFormat:f,isMock:l});Object.assign(A,{tieMatchUps:_,matchUpType:m})}),(!n||!i)&&(u=Ot(u,!1,!0)),u.links||(u.links=[]),w.length&&u.links.push(...w);let D=T.map(({structureId:A})=>A);u.structures||(u.structures=[]);let E=u.structures.map(({structureId:A})=>A);u.structures=u.structures.map(A=>D.includes(A.structureId)?T.find(({structureId:_})=>_===A.structureId):A);let C=T.filter(({structureId:A})=>!E.includes(A));return C.length&&u.structures.push(...C),o&&$C({seedingProfile:t.seedingProfile,applyPositioning:n,tournamentRecord:r,drawDefinition:u,structureId:v,placeByes:s,drawSize:h,event:c}),i&&qn({drawDefinition:u}),{links:w,structures:T,...ce}}var Mv={};$i(Mv,{addGame:()=>ole,addPoint:()=>ale,addSet:()=>lle,addShot:()=>sle,analyzeScore:()=>m3,analyzeSet:()=>zD,calculateHistoryScore:()=>ile,checkScoreHasValue:()=>Pa,checkSetIsComplete:()=>Yx,clearHistory:()=>rle,generate:()=>Qse,generateScoreString:()=>nh,generateTieMatchUpScore:()=>YC,getSetComplement:()=>v3,getTiebreakComplement:()=>Qx,helpers:()=>ple,isValidMatchUpFormat:()=>Nl,keyValueScore:()=>Lle,mutate:()=>tle,parseMatchUpFormat:()=>Ys,parseScoreString:()=>BA,query:()=>jle,redo:()=>cle,reverseScore:()=>ele,setServingSide:()=>nle,stringifyMatchUpFormat:()=>Bx,tidyScore:()=>Vle,umo:()=>dle,undo:()=>ule,validateScore:()=>g3,validateTieFormat:()=>ll});var Qse={};$i(Qse,{generateScoreString:()=>nh,generateTieMatchUpScore:()=>YC,reverseScore:()=>ele});function nh(t){let{winnerFirst:e=!0,addOutcomeString:i,reversed:n=!1,matchUpStatus:r,matchUpFormat:a,autoComplete:o,winningSide:s,sets:l}=t;if(!l)return{error:Yt,info:"missing sets"};let c=a&&Ys(a),{bestOf:u,finalSetFormat:d,setFormat:p}=c??{},h=n||!(!e||!s||s===1),f=i?nke({matchUpStatus:r}):"",m=(l==null?void 0:l.sort(rke).map(g).filter(Boolean).join(" "))||"";if(!f)return m;if(s===2)return`${f} ${m}`;return`${m} ${f}`;function g(v){let y=u&&v.setNumber===u&&d?d:p,b=x=>Rr(x==null?void 0:x.side1Score)||Rr(x==null?void 0:x.side2Score),I=x=>Rr(x==null?void 0:x.side1TiebreakScore)||Rr(x==null?void 0:x.side2TiebreakScore),T=(y==null?void 0:y.tiebreakSet)||!b(v)&&I(v),{side1Score:w,side2Score:S,side1TiebreakScore:D,side2TiebreakScore:E}=v,C=D||(Rr(D)||o?0:""),P=E||(Rr(E)||o?0:"");if(T)return`[${(h?[P,C]:[C,P]).join("-")}]`;let R=Math.min(C,P),N=R?`(${R})`:"",M=w||(Rr(w)||o?0:""),A=S||(Rr(S)||o?0:""),_=h?`${[A,M].join("-")}${N}`:`${[M,A].join("-")}${N}`;return["-"," "].includes(_)&&(_=""),_}}function nke({matchUpStatus:t}){let e={[go]:"RET",[hn]:"WO",[Ea]:"DF/DF",[ua]:"WO/WO",[Dg]:"SUS",[ol]:"ABN",[Zi]:"DEF",[_T]:"DR"};return t&&e[t]||""}function rke(t,e){return t.setNumber-e.setNumber}function ele(t){if(!(t!=null&&t.score))return{error:Yt};let{sets:e}=t.score,i=e.map(a=>{let{side1TiebreakScore:o,side2TiebreakScore:s,winningSide:l,side1Score:c,side2Score:u,setNumber:d}=a;return zt({winningSide:l?3-l:void 0,side1TiebreakScore:s,side2TiebreakScore:o,side1Score:u,side2Score:c,setNumber:d})}),n=nh({sets:i}),r=nh({sets:i,reversed:!0});return{reversedScore:{sets:i,scoreStringSide1:n,scoreStringSide2:r},...ce}}var tle={};$i(tle,{addGame:()=>ole,addPoint:()=>ale,addSet:()=>lle,addShot:()=>sle,calculateHistoryScore:()=>ile,clearHistory:()=>rle,redo:()=>cle,setServingSide:()=>nle,umo:()=>dle,undo:()=>ule});function Cy({matchUp:t}){let{extension:e}=Ri({name:ux,element:t});if(!e)return{error:no};let{history:i=[],undoHistory:n=[]}=e.value;return{history:i,undoHistory:n,...ce}}function ile(t){var C,P;if(!t)return{error:Yt};let{matchUp:e,updateScore:i}=t;if(!e)return{error:rl};let n=((C=Cy({matchUp:e}))==null?void 0:C.history)||[];if(!Array.isArray(n))return{error:Re,info:"history is not an array"};let{matchUpFormat:r}=e;if(!r)return{error:xH};if(!Nl({matchUpFormat:r}))return{error:kH};let a=Ys(r),{bestOf:o,finalSetFormat:s,setFormat:l}=a,c=["0","15","30","40","A","G"],u={sets:[]},d=[],p,h=[0,0],f=1,m=0,g,v=0,y=R=>[1,2].includes(R),b=()=>(m+=1,{winningSide:void 0,side1Score:0,side2Score:0,setNumber:m,games:[]}),I=()=>({winningSide:void 0,points:[]}),T=()=>({winningSide:void 0,side1Score:"",side2Score:"",shots:[]}),w=T(),S=I(),D=b(),E=0;for(let R of n){E+=1,g=u.sets.length+1===o;let N=g&&s?s:l,{tiebreakAt:M,setTo:A,NoAD:_,tiebbreakFormat:x}=N,O=D.side1Score===M&&D.side1Score===D.side2Score,B=!!N.tiebreakSet,F=B?N.tiebreakSet:x,{tiebreakTo:G,NoAD:H}=F||{},$=()=>{p=void 0,h=[0,0],f=3-f,D.side1TiebreakScore=0,D.side2TiebreakScore=0,D.side1PointScore="",D.side2PointScore="",v=0},q=Y=>{D.winningSide=Y;let{s:Q,...X}=D;u.sets.push(X),w=T(),S=I(),D=b(),$()},z=Y=>{S.winningSide=Y;let{g:Q,...X}=S;D.games.push(X),w=T(),S=I(),$();let oe=`side${Y}Score`;D[oe]+=1},Z=Y=>{w.winningSide=Y;let{p:Q,...X}=w;S.points.push(X),w=T(),v=0;let oe=()=>h.reduce((me,se)=>me+se)%4/4>.5?f:3-f,re=Y-1;if(O||B){h[re]+=1,p=oe(),D[`side${Y}TiebreakScore`]=h[re],D[`side${3-Y}TiebreakScore`]=h[1-re];let me=H?1:2;if(h[re]>=G&&h[re]>=h[1-re]+me)return z(Y),{gameCompleted:!0}}else if(h[1-re]===4&&h[re]===3?h[1-re]-=1:h[re]+=1,D.side1PointScore=c[h[0]],D.side2PointScore=c[h[1]],h[re]===5||h[re]===4&&h[1-re]<3||_&&h[re]===4)return z(Y),{gameCompleted:!0}};if(y(R.srv)&&(f=R.srv),["p","s","g","o"].includes(R.u)&&d.push(R.u),R.shotOutcome&&(w.shots.push(R),R.shotType==="SERVE"&&["OUT","NET"].includes(R.shotOutcome)&&(v+=1),v===2)){let Y=3-f;Z(Y)}if(y(R.p)||yi(R.pointNumber)){let Y=R.winningSide||R.p;if((P=Z(Y))!=null&&P.gameCompleted)continue}if(y(R.g)||yi(R.gameNumber)){let Y=R.winningSide||R.g;S.winningSide=Y;let Q=`side${Y}Score`,X=`side${3-Y}Score`;if(d.length&&(d.includes("p"),d=[]),z(Y),D[Q]===A&&D[Q]-D[X]>=(_?1:2)&&(q(Y),g))break}if(y(R.s)||yi(R.setNumber)){let Y=R.winningSide||R.s;if(q(Y),d.length&&(d.includes("p"),d.includes("g"),d=[]),g)break}}return E!==n.length&&console.log({error:"Match completed with excess history"}),(D.side1Score||D.side2Score||D.games.length||D.side1TiebreakScore||D.side2TiebreakScore)&&u.sets.push(D),u.scoreStringSide1=nh({...u,matchUpFormat:r}),u.scoreStringSide2=nh({...u,matchUpFormat:r,reversed:!0}),f=p||f,i&&(e.score=u),{...ce,servingSide:f,score:u}}function Py({undoHistory:t,history:e,matchUp:i}){return cn({element:i,extension:{value:{history:e,undoHistory:t},name:ux}})}function nle({matchUp:t,sideNumber:e}){if(![1,2].includes(e))return{error:BH};let{history:i=[]}=Cy({matchUp:t});return i.push({srv:e}),Py({matchUp:t,history:i})}function rle({matchUp:t}){return Py({matchUp:t})}function ale({matchUp:t,point:e}){if(!e||!t)return{error:Yt};if(typeof e!="object")return{error:Re,context:{point:e}};let{history:i=[]}=Cy({matchUp:t});return i.push(e),Py({matchUp:t,history:i})}function ole({matchUp:t,game:e}){if(typeof e!="object")return{error:Re,context:{game:e}};let{history:i=[]}=Cy({matchUp:t});return i.push(e),Py({matchUp:t,history:i})}function sle({matchUp:t,shot:e}){if(typeof e!="object")return{error:Yt};let{history:i=[]}=Cy({matchUp:t});return i.push(e),Py({matchUp:t,history:i})}function lle({matchUp:t,set:e}){if(typeof e!="object")return{error:Yt};let{history:i=[]}=Cy({matchUp:t});return i.push(e),Py({matchUp:t,history:i})}function cle({matchUp:t}){let{history:e=[],undoHistory:i=[]}=Cy({matchUp:t});return i.length&&e.push(i.pop()),Py({matchUp:t,history:e,undoHistory:i})}function ule({matchUp:t}){let{history:e=[],undoHistory:i=[]}=Cy({matchUp:t});return i.push(e.pop()),Py({matchUp:t,history:e,undoHistory:i})}var dle={},ple={};$i(ple,{keyValueScore:()=>Lle,parseMatchUpFormat:()=>Ys,stringifyMatchUpFormat:()=>Bx,tidyScore:()=>Vle});var Cb=" ",pV="DEF",ake="COMPLETED",hle="WO",oke="WO/WO",fle="ABN",mle="SUS",gle="RET",vle="INT",yle=[gle,pV,hle,oke,fle,mle,vle],hV="DEFAULTED",ble="WALKOVER",Ile="ABANDONED",wle="SUSPENDED",Sle="RETIRED",Tle="INTERRUPTED",ske=[Sle,hV,ble],lke="Enter Score",tI="()",Zv="[]",c3=["up","left","shift+tab"],u3=["enter","down","tab","right"],OA="backspace",Ule="r",Dle="s",Ele="a",Cle="d",Ple="w",Rle="i",Wx=[Ule,Cle,Ple,Ele,Dle,Rle],Kx="space",LB=["[","("],LA=[...c3,...u3,Kx,"]"],Mle="-",cke="/",Pb=Mle,rh=Mle,Nle=[cke],uke=0,dke=["=","+","num_1","num_2","shift+=","shift+-"],Gp=["0","1","2","3","4","5","6","7","8","9"].concat(Wx),Ale=Gp.map(t=>`shift+${t}`),d3=[Pb,OA].concat(LA,Nle),_le=[Gp,Ale,d3].join(","),pke=[_le,c3,u3,dke].join(",");[].concat(...Gp,...Gp,...d3,...Gp,...Gp,...Gp,...Gp,...Gp,...Gp);var p3={OUTCOMEKEYS:Wx,SIDE1KEYS:Gp,SIDE2KEYS:Ale,MODIFIERS:d3,PROMPT:lke,MOVEUP:c3,MOVEDOWN:u3,HOTKEYS:pke};function Yw({scoreString:t,lowSide:e,outcome:i}){if({scoreString:t}=kle({scoreString:t}),e===2){let n=(t&&t[t.length-1])!==Cb?Cb:"";return t+n+i}else return i+Cb+t}function kle({scoreString:t}){if(!t)return{scoreString:""};let e=!1;for(let i of yle){let n=t==null?void 0:t.indexOf(i);n===0?t=t.slice(i.length+1).trim()+Cb:n>0&&(t=t.slice(0,n)),n>=0&&(e=!0)}return t!=null&&t.trim()||(t=""),{scoreString:t,removed:e}}function fV({analysis:t,scoreString:e,sets:i,lowSide:n}){var m,g,v;let r,a;if(!e)return{scoreString:e,sets:i};let{scoreString:o,removed:s}=kle({scoreString:e});if(e=o,s)return{scoreString:e,sets:i,outcomeRemoved:!0};let l=i[i.length-1]||{},c=Object.values(l).filter(y=>y!==void 0).length;l.setNumber&&c===1&&(i=i.slice(0,i.length-1),l=i[i.length-1]||{});let{tiebreakSet:u}=t.setFormat,{tiebreakTo:d,NoAD:p}=u||{},{isTiebreakEntry:h}=j0({brackets:Zv,scoreString:e}),f=fke(e);if(f>=0){r=e.slice(0,f);let{isTiebreakEntry:y}=j0({brackets:tI,scoreString:r}),{lastOpenBracketIndex:b,isTiebreakEntry:I}=j0({brackets:Zv,scoreString:r}),T=r&&r[r.length-1].trim(),w=r&&!isNaN(T),S=t.isIncompleteSetScore;if(h&&I){let D=r.slice(b+1).split(rh),E=(D==null?void 0:D.length)>0&&D[0]!==void 0&&!isNaN(parseInt(D[0]))&&parseInt(D[0])||void 0,C=(D==null?void 0:D.length)>1&&D[1]!==void 0&&parseInt(D[1])||void 0,P=[E,C];if(C){let R=n===1?1:0;P[R]=((P==null?void 0:P[1-R])||0)+(p?1:2),(P[R]||0)<d&&(P[R]=d),r=e.slice(0,b+1),r+=P.join(rh)}else E!==void 0?(r=e.slice(0,b+1),r+=E):(r=e.slice(0,b),S=!0);l.side1TiebreakScore=P[0]||0,l.side2TiebreakScore=P[1]||0}if(r.length||(r=void 0),S){let D=(m=l.side1Score)==null?void 0:m.toString();if(D){let E=D==null?void 0:D.slice(0,D.length-1);l.side1Score=!isNaN(E)&&parseInt(E)||void 0,l.side1Score===void 0&&(l.side2Score=void 0)}t.isTimedSet?(a=l.side1Score?i:(i==null?void 0:i.slice(0,i.length-1))||[],a[i.length-1]=l):a=(i==null?void 0:i.slice(0,i.length-1))||[]}else if(w){let D=(g=l.side2Score)==null?void 0:g.toString(),E=(v=l.side1Score)==null?void 0:v.toString();if(!t.isTiebreakEntry&&!t.isMatchTiebreak)if(l.side2Score){let C=D==null?void 0:D.slice(0,D.length-1);l.side2Score=!isNaN(C)&&parseInt(C)||void 0}else{let C=E==null?void 0:E.slice(0,E.length-1);l.side1Score=!isNaN(C)&&parseInt(C)||void 0}t.isTimedSet?l.side1Score?(a=i||[],a[i.length-1]=l):a=(i==null?void 0:i.slice(0,i.length-1))||[]:(a=i||[],a[i.length-1]=l),a[a.length-1]&&Object.assign(a[a.length-1],{winningSide:void 0})}else y?(a=i||[],Object.assign(a[a.length-1]||{},{winningSide:void 0,side1TiebreakScore:void 0,side2TiebreakScore:void 0})):(h&&!I?a=(i==null?void 0:i.slice(0,i.length-1))||[]:(a=i,a[i.length-1]=l),h||(a[a.length-1].side2Score=0,a[a.length-1].winningSide=void 0));return{scoreString:r,sets:a}}return{scoreString:e,sets:i}}function j0({brackets:t=tI,scoreString:e}){if(!e)return{};let[i,n]=t.split(""),r=e.split(""),a=Math.max(...Qd(i,r)),o=Math.max(...Qd(n,r));return{isTiebreakEntry:a>o,lastOpenBracketIndex:a}}function hke({scoreString:t}){if(!t)return!1;let e=t&&t[t.length-1].trim(),i=t&&!isNaN(e),[n,r]=Zv.split(""),a=t.split(""),o=Math.max(...Qd(n,a)),s=Math.max(...Qd(r,a)),l=Math.max(...Qd(rh,a));return i&&o>s&&l>o}function fke(t){return t.split("").reduce((e,i,n)=>(i.match(/\d+/g)&&e.push(n),e),[]).pop()}function xle(t){let{lowValue:e=0,NoAD:i=!1,tiebreakTo:n}=t||{},r=i?1:2;return e+1>=n?e+r:parseInt(n)}function fY({matchUpFormat:t,matchUpStatus:e,winningSide:i,sets:n}){var l;let r=Ys(t),{bestOf:a}=r,o=Math.ceil(a/2),s=((l=n==null?void 0:n.reduce((c,u)=>{let{winningSide:d}=u;return d&&c[d-1]++,c},[0,0]))==null?void 0:l.indexOf(o))+1||void 0;return ske.includes(e)&&i&&(s=i),{matchUpWinningSide:s}}function Yx({ignoreTiebreak:t=!1,matchUpScoringFormat:e,matchUpFormat:i,isTiebreakSet:n,isDecidingSet:r,set:a}){var y;if(!a)return{error:Yt,info:"missing set"};e=e||i&&Ys(i);let o=r&&e.finalSetFormat||(e==null?void 0:e.setFormat)||{},{side1Score:s,side2Score:l}=a,{setTo:c,tiebreakAt:u}=o,d=Zx({set:a}),p=Math.abs(s-l),h=s>=c||l>=c,f=n||s>=c&&l>=c||u&&u<c&&(s===u||l===u),m=t||f&&(d===1&&a.side1TiebreakScore>a.side2TiebreakScore||d===2&&a.side2TiebreakScore>a.side1TiebreakScore),g=!f&&o.NoAD||f||n&&((y=o.tiebreakFormat)!=null&&y.NoAD)?1:2,v=p>=g;return!!((h&&(v||f)||n)&&(!f||m))}function Zx({set:t}){if(t.side1Score||t.side2Score){if(t.side1Score>t.side2Score)return 1;if(t.side2Score>t.side1Score)return 2}else if(t.side1TiebreakScore||t.side2TiebreakScore){if(t.side1TiebreakScore>t.side2TiebreakScore)return 1;if(t.side2TiebreakScore>t.side1TiebreakScore)return 2}}function h3({analysis:t,set:e}){let i=Zx({set:e}),{isDecidingSet:n,isTiebreakSet:r,matchUpScoringFormat:a}=t;return Yx({matchUpScoringFormat:a,isDecidingSet:n,isTiebreakSet:r,set:e})&&i}function mke({analysis:t,scoreString:e,sets:i,value:n}){let r;if(!(i!=null&&i.length))return{sets:[]};let a=i[i.length-1];n=ri(n);let{validSide2Score:o,requiresTiebreak:s}=gke({analysis:t,set:a,value:n});if(o){r=!0,e=(e||"")+n,a.side2Score=n;let l=h3({analysis:t,set:i[i.length-1]});if(a.winningSide=l||void 0,s){let c=tI.split("")[0];e+=c}else t.isDecidingSet||(e+=Cb)}return{sets:i,scoreString:e,updated:r}}function gke({analysis:t,set:e={},value:i}){let n=t.isDecidingSet&&t.matchUpScoringFormat.finalSetFormat||t.matchUpScoringFormat.setFormat,{tiebreakAt:r,setTo:a,NoAD:o}=n,{side1Score:s}=e,l,c;return r&&r<a?s===r?l=i<=a:l=i<=r:s===a?o?l=i<a:l=i<=a+1:s===a-1?o?l=i<=a:l=i<=a+1:s===a+1?l=i===a||i===a-1:l=i<=a,l&&(r&&r<a?c=s===a&&i===r||s===r&&i===a:c=s>=a&&i>=a&&s!==i),{validSide2Score:l,requiresTiebreak:c}}function Ole({lowSide:t,value:e,sets:i,scoreString:n,winningSide:r,matchUpStatus:a}){let o;return e===Ule?n?(o=!0,n=Yw({scoreString:n,lowSide:t,outcome:gle}),r=t===2?1:2,a=Sle):(o=!0,n=Yw({scoreString:n,lowSide:t,outcome:pV}),r=t===2?1:2,a=hV):e===Cle?(o=!0,n=Yw({scoreString:n,lowSide:t,outcome:pV}),r=t===2?1:2,a=hV):e===Ple?(o=!0,i=[],n=hle,r=t===2?1:2,a=ble):e===Dle&&n?(o=!0,n=Yw({scoreString:n,lowSide:t,outcome:mle}),a=wle,r=void 0):e===Ele?(o=!0,n=Yw({scoreString:n,lowSide:t,outcome:fle}),a=Ile,r=void 0):e===Rle&&n&&(o=!0,n=Yw({scoreString:n,lowSide:t,outcome:vle}),a=Tle,r=void 0),{updated:o,sets:i,scoreString:n,matchUpStatus:a,winningSide:r}}function vke(t){let{sets:e,info:i,scoreString:n,winningSide:r,matchUpStatus:a}=t,{analysis:o,lowSide:s,value:l}=t,c,u;!(e!=null&&e.length)&&l!==OA&&(e=[{setNumber:1}]);let d=e.length-1;if(Wx.includes(l)){let p=e[e.length-1]||{},{side1Score:h,side2Score:f}=p;h&&!f?i="missing side2Score":o.finalSetIsComplete||r?i="final set is already complete":o.isIncompleteSetScore?i="incomplete set scoreString":o.isIncompleteSetScore||({sets:e,scoreString:n,winningSide:r,matchUpStatus:a,updated:c}=Ole({lowSide:s,value:l,sets:e,scoreString:n,matchUpStatus:a,winningSide:r}))}else if(l===OA){if({scoreString:n,sets:e,outcomeRemoved:u}=fV({analysis:o,scoreString:n,sets:e}),(n==null?void 0:n.trim())===""&&(n=n.trim()),n||(e=[]),u){let p=e[e.length-1]||{},{side1Score:h,side2Score:f}=p;if(h&&f){let m=h>f&&1||f>h&&2||void 0;m&&(p.winningSide=m,e.push({setNumber:e.length+1}))}}a=void 0,r=void 0,c=!0}else if(o.hasOutcome)i="has outcome";else{if(r)return{sets:e,scoreString:n,winningSide:r,matchUpStatus:a,updated:!1,info:"matchUp is complete"};if(l===Kx){let p=e[e.length-1]||{},{side1Score:h,side2Score:f}=p,m=h>f&&1||f>h&&2||void 0;m&&!r&&!o.isIncompleteSetScore&&(e[e.length-1].winningSide=m,e.push({setNumber:e.length+1}),n+=" ",c=!0)}else if(l===Pb&&e[d].side1Score!==void 0&&e[d].side2Score===void 0&&n&&o.isNumericEnding)n+="-",e[d].side2Score=0,a=void 0,r=void 0,c=!0;else if(!isNaN(l)){let p;if(e[d].side2Score===void 0){let h=ri((e[d].side1Score||0).toString()+l).toString().slice(0,2);e[d].side1Score=ri(h),p=e[d].side1Score.toString(),c=!0}else{let h=ri((e[d].side2Score||0).toString()+l).toString().slice(0,2);e[d].side2Score=ri(h),p=[e[d].side1Score,e[d].side2Score].join("-"),c=!0}if(c){let h=(e.slice(0,d)||[]).filter(f=>f).map(f=>{let{side1Score:m,side2Score:g}=f;return[m,g].join("-")}).join(" ");h?n=h+" "+p:n=p}}}return{sets:e,scoreString:n,winningSide:r,matchUpStatus:a,info:i,updated:c}}function yke({analysis:t,auto:e,lowSide:i,scoreString:n="",sets:r,value:a}){var d;let o,s,{tiebreakSet:{tiebreakTo:l,NoAD:c}}=t.setFormat,[u]=Zv.split("");if(t.isMatchTiebreakEntry||(n+=u),r[t.setNumber-1]){let{lastOpenBracketIndex:p}=j0({brackets:Zv,scoreString:n}),h=(n.slice((p??0)+1)+(e?"":a)).split(rh);if((((d=h[i-1])==null?void 0:d.length)||0)>=2)s="tiebreak digit limit";else if(e){i===1&&(h[0]=(h[0]||"")+a),i===2&&(h[1]=(h[1]||"")+a);let f=[h[0]||0,h[1]||0].map(v=>ri(v)),m=i===1?1:0;f[m]=f[1-m]+(c?1:2),f[m]<l&&(f[m]=l);let g=r[r.length-1];g.side1TiebreakScore=f[0],g.side2TiebreakScore=f[1],n=n.slice(0,(p??0)+1),n+=f.join(rh),o=!0}else{let f=[h[0]||0,h[1]||0].map(g=>ri(g)),m=r[r.length-1];m.side1TiebreakScore=f[0],m.side2TiebreakScore=f[1],n+=a,o=!0}}else{let p=xle({lowValue:ri(a||0),tiebreakTo:l,NoAD:c}),h=[ri(a),p];i===2&&h.reverse();let f={side1TiebreakScore:h[0],side2TiebreakScore:h[1],setNumber:(r==null?void 0:r.length)+1||1};r.push(f),n+=h.join(rh),o=!0}return{info:s,scoreString:n,sets:r,updated:o}}function bke({analysis:t,lowSide:e,scoreString:i,value:n}){let{setTo:r,tiebreakAt:a,NoAD:o}=(t==null?void 0:t.setFormat)||{},s=n===parseInt(a||r);if(a&&a<r&&n>a)return{scoreString:i};if(o&&n===r||n>r)return{scoreString:i};let l=f(),c=[n,l];e===2&&c.reverse();let u=tI.split("")[0],d=c.join(Pb)+(s?u:Cb);i=(i||"")+d;let p={side1Score:c[0],side2Score:c[1]},h=h3({analysis:t,set:p});return p.winningSide=h||void 0,{scoreString:i,set:p};function f(){return s?n+1:n+1===r?n+(o?1:2):r}}function Ike({matchUpFormat:t,scoreString:e,winningSide:i,value:n,sets:r}){var B,F,G;let a=(((B=r==null?void 0:r.filter(H=>H==null?void 0:H.winningSide))==null?void 0:B.length)||0)+(i?0:1),o=Ys(t),s=a===(o==null?void 0:o.bestOf),l=s&&(o==null?void 0:o.finalSetFormat)||(o==null?void 0:o.setFormat)||{},c=l==null?void 0:l.timed,u=s&&r[(o==null?void 0:o.bestOf)-1],d=u==null?void 0:u.winningSide,{isTiebreakEntry:p}=j0({brackets:tI,scoreString:e}),{isTiebreakEntry:h}=j0({brackets:Zv,scoreString:e}),f=p||h,m=!!l.tiebreakSet,g=(F=e==null?void 0:e[e.length-1])==null?void 0:F.trim(),v=e&&!isNaN(g),y=!f&&g===Pb,b=p&&LB.includes(g),I=h&&LB.includes(g),T=h&&g===rh,w=e==null?void 0:e.split(""),[S]=Zv.split(""),D=w&&Math.max(...Qd(S,w)),E=w&&Math.max(...Qd(rh,w)),C=w&&E>D,P=(G=r[r.length-1])==null?void 0:G.winningSide,R=(r==null?void 0:r.length)&&!P,N=yle.find(H=>(e==null?void 0:e.indexOf(H))>=0),M=!isNaN(n),A=n===Kx,_=LA.includes(n),x=e==null?void 0:e.split("").find(H=>LB.includes(H)),O=_&&h&&!I&&(T||!hke({scoreString:e}));return{isTiebreakSetValue:m&&M,matchUpScoringFormat:o,setNumber:a,setFormat:l,matchTiebreakHasJoiner:C,isGameScoreEntry:R,isSpace:A,isCloser:_,isTiebreakCloser:_&&x&&f&&v,isDecidingSet:s,isTiebreakSet:m,isTimedSet:c,isNumericEnding:v,isNumericValue:M,hasOpener:x,hasOutcome:N,finalSet:u,finalSetIsComplete:d,lastSetIsComplete:P,isInvalidSetTiebreakValue:A&&f&&b,isInvalidMatchTiebreakValue:O,isTiebreakEntry:f,isSetTiebreakEntry:p,isMatchTiebreakEntry:h,isIncompleteSetScore:y,isIncompleteSetTiebreak:b,isIncompleteMatchTiebreak:I,isPartialMatchTiebreakValue:T}}function Lle(t){let{lowSide:e=1,value:i}=t,{scoreString:n,sets:r,winningSide:a,matchUpStatus:o}=t,{matchUpFormat:s,shiftFirst:l,auto:c=!0}=t,u,d,p=l&&e===2||!l&&e===1;if(!_le.includes(i))return{updated:!1,info:"invalid key"};l&&(e=3-e);let{matchUpWinningSide:h}=fY({sets:r,winningSide:a,matchUpStatus:o,matchUpFormat:s});a=h;let f=Ike({value:i,winningSide:a,scoreString:n,sets:r,matchUpFormat:s});if(Nle.includes(i)&&(i=Pb),f.hasOpener&&f.isTiebreakEntry&&!f.isTiebreakSet&&p&&ri(i)===0&&(f.isTiebreakCloser=!0),LA.includes(i)&&f.hasOpener&&(i=""),LA.includes(i)&&(i=Kx),f.lastSetIsComplete){let m=(n==null?void 0:n.length)&&n[n.length-1];n&&m!==" "&&(n+=" ")}if(f.isTimedSet)({info:d,sets:r,scoreString:n,updated:u,matchUpStatus:o,winningSide:a}=vke({analysis:f,lowSide:e,scoreString:n,sets:r,matchUpStatus:o,winningSide:a,value:i}));else if(Wx.includes(i))f.finalSetIsComplete||a?d="final set is already complete":!f.isTiebreakEntry&&!f.isIncompleteSetScore?{sets:r,scoreString:n,matchUpStatus:o,winningSide:a,updated:u}=Ole({lowSide:e,sets:r,scoreString:n,matchUpStatus:o,winningSide:a,value:i}):f.isTiebreakEntry||f.isIncompleteSetScore?d="incomplete set scoreString or tiebreak entry":console.log("handle case",{value:i});else if(i===OA)u=!0,{scoreString:n,sets:r}=fV({analysis:f,scoreString:n,sets:r,lowSide:e}),n||(r=[]),o=void 0,a=void 0;else if(f.hasOutcome)d="has outcome";else if(i===Pb&&!f.isMatchTiebreakEntry)(!f.isSetTiebreakEntry||f.isSetTiebreakEntry&&!f.isNumericEnding)&&(u=!0,{scoreString:n,sets:r}=fV({analysis:f,scoreString:n,sets:r,lowSide:e}),o=void 0);else if(i===rh&&f.isMatchTiebreakEntry&&!f.isSetTiebreakEntry)f.matchTiebreakHasJoiner?d="existing joiner":f.isNumericEnding&&(u=!0,n+=rh);else if([Pb,rh].includes(i))d="invalid location for joiner";else{if(a)return{updated:!1,info:"matchUp is complete"};if(f.isIncompleteSetScore)f.isNumericValue&&({sets:r,scoreString:n,updated:u}=mke({analysis:f,scoreString:n,sets:r,value:i}));else if(f.isInvalidMatchTiebreakValue)d="invalid matchUp tiebreak character";else if(f.isInvalidSetTiebreakValue)d="invalid set tiebreak character";else if(f.isTiebreakCloser){let m=f.isSetTiebreakEntry?tI:Zv,g=m.split("").reverse()[0],v=m.split("")[0],y=r[r.length-1],{tiebreakFormat:b}=f.setFormat,{tiebreakTo:I,NoAD:T}=b||{},w=Zx({set:y});if(!f.isTiebreakSet){let D=parseInt(n.split(v).reverse()[0]),E=xle({lowValue:D,tiebreakTo:I,NoAD:T});w===1?(y.side1TiebreakScore=E,y.side2TiebreakScore=D):(y.side1TiebreakScore=D,y.side2TiebreakScore=E)}n=(n||"")+g,f.isDecidingSet||(n+=Cb);let S=h3({analysis:f,set:y});y.winningSide=S||void 0,u=!0}else if(f.isTiebreakSetValue)({info:d,scoreString:n,sets:r,updated:u}=yke({analysis:f,auto:c,lowSide:e,scoreString:n,sets:r,value:i}));else if(f.isSetTiebreakEntry){let[m]=tI.split(""),g=Math.max(...Qd(m,n.split(""))),v=n.slice(g+1),y=v&&ri(v)===uke,b=ri(v?v+i:i),{tiebreakFormat:I}=f.setFormat,{tiebreakTo:T,NoAD:w}=I||{};!y&&v.length<2?w&&b>T-1?d="invalid low value for NoAD tiebreak":(u=!0,n=(n||"")+i):d=y?"tiebreak begins with zero":"tiebreak digit limit"}else if(f.isCloser)d=`invalid key: ${i}`;else if(f.isGameScoreEntry)d="game scoreString entry";else if(f.lastSetIsComplete||!r.length){u=!0;let{scoreString:m,set:g}=bke({analysis:f,lowSide:e,scoreString:n,value:ri(i)});g&&(g.setNumber=(r==null?void 0:r.length)+1||1),r=(r==null?void 0:r.concat(g).filter(Boolean))||[g],n=m||void 0}else console.log("error: unknown outcome")}if(u){r=r==null?void 0:r.filter(Boolean);let{matchUpWinningSide:m}=fY({sets:r,winningSide:a,matchUpStatus:o,matchUpFormat:s});return a=m,m&&(!o||[qr,$c].includes(o))?(o=ake,r=r.filter(g=>{let{side1Score:v,side2Score:y,side1TiebreakScore:b,side2TiebreakScore:I}=g;return v||y||b||I})):n&&!a&&![wle,Ile,Tle].includes(o)&&(o=void 0),{updated:u,scoreString:n,sets:r,winningSide:a,matchUpStatus:o,info:d}}return{updated:u,scoreString:n,sets:r,winningSide:a,matchUpStatus:o,info:d}}var Xx="\\d+-\\d+",HD="\\d+-\\d+\\(\\d+\\)",f3="\\[\\d+-\\d+\\]",wke="\\d+-\\d+\\(\\d+-\\d+\\)",Ske=new RegExp(`(${Xx}),`,"g"),Tke=new RegExp(`(${HD}),`,"g"),Uke=[Xx,HD,f3,wke],Dke=["0","1","2","00","01","10","11","002","012","102","112","000","001","010","100","011","101","110","111","002","012","102","112","0002","0012","0102","1002","0112","1012","1102","1112","3","03","13","013","103"],Eke=Dke.map(t=>{let e=t.split("").map(i=>Uke[i]).join(" ");return new RegExp(`^${e}$`)});function mY(t){return!t||Eke.some(e=>e.test(t))}function Cke(t){let e="[];",i="()",n=e+i,r=[e[0],i[0]],a=Object.assign({},...n.split("").map(l=>({[l]:0}))),o="",s=t.split("").map(l=>{let c=n.includes(l)&&l,u=r.includes(c);if(u&&c)return a[c]+=1,o=c,l;if(!u&&c&&o&&c!==o){a[o]-=1;let d=e.includes(o)&&e||i.includes(o)&&i||"",p=d.split("").find(h=>h!==o);if(d.includes(c))a[o]||(o="");else return a[c]||(o=""),p}return l}).join("");return t!==s?s:t}function EN(t){return/^\(\d+\)$/.test(t)||/^\(\d+$/.test(t)}function Pke(t){return/^\(\d+-\d+\)$/.test(t)||/^\[\d+-\d+\]$/.test(t)}function vS(t){let e=(i=>i==null?void 0:i.split("-").join("").split("/").join(""))(t);if(/^\d+$/.test(e)&&e.length===2){let i=e.split("");return Math.abs(i.reduce((n,r)=>+n-+r))===1}return!1}function FA(t,e){let i=[t.slice(e,e+2),e?t.slice(0,1):t.slice(2)].map(r=>parseInt(r.join("")));e&&i.reverse();let n=i;if(Math.abs(n.reduce((r,a)=>+r-+a))>=2)return n.join("-")}function gY(t){return t.length===2?t.split("").join("-"):([", ",",","/"," "].forEach(e=>t=t.split(e).join("-")),t=t.replace(/-{2,}/,"-"),t)}function Rke(t){return t.startsWith("(")&&t.endsWith(")")}function Mke({score:t,applied:e}){t=Cke(t);let i=/\)(\d+)/g;if(i.test(t))for(let w of t.match(i)){let S=w.replace(")",") ");t=t.replace(w,S)}t=t.replace(/\)\//g,") / "),t=t.replace(/\/\)/g,")");let n=/\(([\d- ]+)\)/g,r=/\(([\d- ]+)\)/,a=t.match(n);for(let w of a||[]){let[S]=w.match(r).slice(1),D=S.replace(/ /g,"");t=t.replace(w,`(${D})`)}let o=/\(\(\d-\d\)\)/g;if(o.test(t)){let w=t.match(o);w.length&&w.forEach(S=>{let D=S.match(/\((\(\d-\d\))\)/).slice(1)[0];t=t.replace(S,D)})}if(o=/\(\((\d)\)\)/g,o.test(t)){let w=t.match(o);w.length&&w.forEach(S=>{let D=S.match(/\((\(\d\))\)/).slice(1)[0];t=t.replace(S,D)})}/(^|\s)6-,/.test(t)&&(t=t.replace(/(^|\s)6-,/g,"6-0,"));let s=new RegExp(/[-,]{2,}/g);t=t.replace(s,"-"),["- "," -"].forEach(w=>{let S=new RegExp(`(\\d+)${w}(\\d+)`,"g"),D=t.match(S);D&&D.forEach(E=>t=t.replace(E,E.split(w).join("-")))}),/^[(-/,]+$/.test(t)&&(t=""),/\)[-/,]+$/.test(t)&&(t=t.slice(0,t.length-1)),/\d \/\d/.test(t)&&(t=t.replace(/ \//g,"/")),t.includes(" /")&&(t=t.replace(/ \//g," "));let l=/\(\d+, \)/g;l.test(t)&&t.match(l).forEach(w=>{let[S]=w.match(/\((\d+), \)/).slice(1);S.length===2?t=t.replace(w,`(${S})`):S.length===1&&S==="6"&&(t=t.replace(w,"(6-0)"))});let c=/\((\d+)\/\)/g;c.test(t)&&t.match(c).forEach(w=>{let[S]=w.match(/\((\d+)\/\)/).slice(1);S.length===2?t=t.replace(w,`(${S})`):S.length===1&&S==="6"?t=t.replace(w,"(6-0)"):t=t.replace(w,`(${S})`)});let u=/\d\/\d\/,/g;u.test(t)&&t.match(u).forEach(w=>{let[S]=w.match(/(\d\/\d)\/,/).slice(1);t=t.replace(w,`${S},`),e.push("slashComma")});let d=/\(\/(\d+)\)/g;d.test(t)&&t.match(d).forEach(w=>{let[S]=w.match(/\(\/(\d+)\)/).slice(1);S.length===2?t=t.replace(w,`(${S})`):S.length===1&&parseInt(S)<6?t=t.replace(w,`(6-${S})`):t=t.replace(w,`(${S})`)});let p,h,f,m,g,v=()=>{g=Pl(t.split("")),h=g["("]===(g[")"]||0)+1,p=(g["("]||0)+1===g[")"],f=g["["]===g["]"]+1,m=h&&!f};v();let y=/(\d+-\d+\(\d+)0,/;if(y.test(t)){let[w]=t.match(y).slice(1);t=t.replace(y,w+")")}if(g["("]===g[")"]&&g["("]>1){let w=t.split(")(").join(") (").split(" ");w.every(Rke)?t=w.map(S=>{let D=S.slice(1,S.length-1);return D.length>2?D:S}).join(" "):t=w.join(" ")}v();let b=/[A-Za-z]+/.test(t),I=/\d+/.test(t);if(!b&&!I)return{score:""};if(/^\[.+\]$/.test(t)&&"()/,- ".split("").some(w=>g[w])&&(t=t.slice(1,t.length-1)),/^\(.+\)$/.test(t)&&g["("]===1&&g[")"]===1&&"[]/,".split("").some(w=>g[w]>1)&&(t=t.slice(1,t.length-1)),t.startsWith("(")&&t.endsWith("))")&&(t=t.slice(1,t.length-1)),g["("]>(g[")"]||0)&&t[t.length-1]==="("&&(t=t.slice(0,t.length-1)+")",v()),g["("]===1&&!g[")"]&&t[0]==="("&&(t=t+")",v()),g["("]>(g[")"]||0)&&t.slice(0,2)==="(("&&(t=t.slice(1)),p){if(/^9\d/.test(t))t="("+t.slice(1);else if(t[0]!=="(")t="("+t;else{let w=[],S=0;for(let D of t.split("").reverse())D===")"&&(S?w.push("("):S+=1),D==="("&&(S-=1),w.push(D);w.reverse(),t=w.join("")}v()}if(g[")"]>(g["("]||0)&&t[0]===")"&&(t="("+t.slice(1),v()),m&&(t.endsWith(9)||/\d+0$/.test(t))&&(t=t.slice(0,t.length-1)+")",v()),m&&(!t.endsWith(")")||t.startsWith("(("))&&(t=t+")",v()),m){let w="",S=0;for(let D of t.split(""))D==="("&&(S?w+=")":S+=1),D===")"&&(S-=1),w+=D;t=w}v(),f&&!h&&(t=t+"]"),t.includes("([")&&t.includes("])")&&(t=t.split("([").join("[").split("])").join("]"),v()),/\(\d+0$/.test(t)&&(t=t.slice(0,t.length-1)+")"),v(),g[")"]===1&&!g["("]&&t.endsWith(")")&&(t=t.slice(0,t.length-1)),t.startsWith("(")&&t.endsWith(")")&&g["("]===1&&g[")"]===1&&(t=t.slice(1,t.length-1),v());let T=w=>{let S=w.indexOf("("),D=w.indexOf(")");return S>=0&&D>=0&&S<D};if(/^\([\d ]+.*[\d ]+\)$/.test(t)&&g["("]===g[")"]){let w=t.slice(1,t.length-1);T(w)&&(t=w,v())}return{score:t,applied:e}}function Jx(t){if(!/^[\d-]+(\(\d\))*$/.test(t))return t;let e=Qd("-",t.split(""));if(!e.length)return t;let i=t.split("-"),n=!(i.length%2),r=!!(e.length%2);return n&&r&&e.length>i.length/2&&e.filter((a,o)=>o%2).forEach(a=>{t=t.substring(0,a)+" "+t.substring(a+1)}),t}function Nke({score:t,applied:e}){return t.includes("( ")&&(e.push("removeParenSpacingAfterOpen"),t=t.split("( ").map(i=>i.trim()).join("(")),t.includes(" )")&&(e.push("removeParenSpacingBeforeClose"),t=t.split(" )").map(i=>i.trim()).join(")")),[Ske,Tke].forEach(i=>{let n=t.match(i);n!=null&&n.length&&(n.forEach(r=>{t=t.replace(r,r.slice(0,r.length-1)+" ")}),e.push("setsEndComma"))}),t=t.split(" ").filter(Boolean).map(Jx).join(" "),{score:t,applied:e}}function Ake({score:t}){if(typeof t!="string")return{score:t};let e=p=>p==null?void 0:p.split("-").join("").split("/").join(""),i=p=>p.split("[").join("(").split("]").join(")");t=t.split(", ").join(" ");let n=t.split(" ");t=n.map(p=>{let h=/^-(\d+)$/;if(h.test(p)){let[f]=p.match(h).slice(1);if(f.length===2)return f.split("").join("-")}return p}).join(" "),n=t.split(" ");let r=n.filter(EN),a=0,o="";for(let p of r){let h=Qd(p,n).filter(v=>!a||v>a)[0],f=n.slice(a,h-1),m=n[h-1],g=e(m);if(/^\d+$/.test(g)&&g.length===2){let v=g.split(""),y=Math.abs(v.reduce((b,I)=>+b-+I));if(y===1){let b=[f.join(" "),[m,p].join("")].join(" ");o+=b,a=h+1}else if(y===0){let b=Math.max(...v);if([4,5,6,7,8,9].includes(b)){let I=[6,4].includes(b)?b+1:b-1,T=[b,I].sort().reverse().join("-"),w=[f.join(" "),[T,p].join("")].join(" ");o+=w,a=h+1}}}}if(r.length&&o.length){let p=n.slice(a).join(" ");return o=[o,p].join(" "),{score:o.trim()}}if(n.length===2&&["(","["].some(p=>n[1].includes(p))){let p=e(n[0]).split("");if(Math.abs(p.reduce((h,f)=>+h-+f,0))===1)return n[1]=i(n[1]),{score:n.join("")}}let s=n.map(p=>Pke(p)&&"bracket"||vS(p)&&"set");if(s.includes("set")&&s.includes("bracket")){let p,h="";return n.forEach((f,m)=>{s[m]==="bracket"&&p==="set"?(f=i(f),h+=f):h+=` ${f}`,p=s[m]}),{score:h.trim()}}n=t.split(" ");let l,c=n.map(p=>{let h=new RegExp(/^(\d+)-(\d+)$/);if(h.test(p)){let[f,m]=p.match(h).slice(1),g=Math.abs([f,m].reduce((y,b)=>+y-+b)),v=Math.max(f,m);if(g===1)return l="tiebreakSet",l;if(g>=2&&v>=7&&l==="tiebreakSet")return l="tiebreak",l}}),u=Qd("tiebreak",c);if(u.length){let p="";n.forEach((h,f)=>{u.includes(f)?p+=`(${h}) `:u.includes(f+1)?p+=`${h}`:p+=`${h} `}),t=p.trim()}let d=/(\d+-\d+)\((\d+)-(\d+)\)$/;if(d.test(t)){let[p,h,f]=t.match(d).slice(1),m=Math.max(h,f)>=10;!vS(p)&&m&&(t=t.replace(d,`${p} [${h}-${f}]`))}return c=[],t=t.split(" ").map(p=>{let h=/^\((.*)\)$/,f=h.test(p),m=new RegExp(f3).test(p)&&"super"||new RegExp(HD).test(p)&&"tiebreak"||new RegExp(Xx).test(p)&&"standard"||"unknown";return c.push(m),m==="standard"&&f?p.match(h)[1]:p}).join(" "),{score:t}}function _ke({score:t,applied:e}){for(let D of[".",","," ","/"]){let E=new RegExp(`^(\\d+)\\${D}(\\d+)$`);if(E.test(t)){let C=t.match(E).slice(1).map(R=>parseInt(R)),P=Math.abs(C[0]-C[1]);P<=10&&P>=2&&(t=t.split(D).join("-"),e.push("variedJoinerPattern"))}}t.includes(";")&&(t=t.split(";").join(" "),e.push("semicolon set separation"));let i=/(^|\s)(\d)\/(\d)(\d)\/(\d)(\(|$)/;if(i.test(t)){let[D,E,C,P,R,N]=t.match(i).slice(1);t=t.replace(i,`${D}${E}-${C} ${P}-${R}${N}`),e.push("smashSlashPattern")}/.*\s6[/-]+$/.test(t)&&(t+="0",e.push("incompleteFinalSetPattern"));let n=/\(6,\)/g;n.test(t)&&(t=t.replace(n,"(6, 0)"),e.push("missingZeroPattern1"));let r=/^\d{3,}\(/,a=/\(\d+\)\d+/;[r,a].forEach(()=>{t=t.split(" ").map(D=>(r.test(D)&&(D=D.replace("("," (")),a.test(D)&&(D=D.replace(")",") ")),D)).join(" "),e.push("spaceConsiderationPatterns")});let o=Jx(t);o!==t&&(t=o,e.push("deDashMash"));let s=/^(\d)[-/,]+(\d{2})[-/,]+(\d)$/;if(s.test(t)){let[D,E,C]=t.match(s).slice(1),[P,R]=E.split("");t=`${D}-${P} ${R}-${C}`,e.push("smashSetPattern")}let l=/^(\d+)[ -](\d+)$/,c=/^([\d -]+)\/([\d -]+)$/;if(c.test(t)){let[D,E]=t.match(c).slice(1),C=D.trim(),P=E.trim();if(l.test(C)&&l.test(P)){let R=C.match(l).slice(1,3).join("-"),N=P.match(l).slice(1,3).join("-");t=`${R} ${N}`,e.push("slashSeparationPattern")}}let u=/^([\d -]+),([\d -]+)$/;if(u.test(t)){let[D,E]=t.match(u).slice(1),C=D.trim(),P=E.trim();if(l.test(C)&&l.test(P)){let R=C.match(l).slice(1,3).join("-"),N=P.match(l).slice(1,3).join("-");t=`${R} ${N}`,e.push("commaSeparationPattern")}}let d=/^\d \d,/;if(d.test(t)){let D=t.match(d)[0],E=D.slice(0,D.length-1).split(" ").join("-");t=t.replace(D,E),e.push("singleSetCommaSeparationPattern")}let p=0,h=/(\d+)-(\d{2})-(\d+)/;for(;h.test(t)&&p<3;){let[D,E,C]=t.match(h).slice(1),P=E.split(""),R=`${D}-${P[0]} ${P[1]}-${C}`;t=t.replace(h,R),e.push("noSetSeparationPattern"),p+=1}let f=/(^|\s)7-6\s(\d+)\s/g,m=t.match(f);if(m!=null&&m.length){let D=/(^|\s)7-6\s(\d+)\s/;m.forEach(E=>{let C=E.match(D).slice(2)[0];t=t.replace(E,`7-6(${C}) `),e.push("floatingTiebreakPattern1")})}let g=t.match(/\d \d /);g==null||g.forEach(D=>{let E=D.slice(0,D.length-1).split(" ").join("-");t=t.replace(D,E),e.push("spaceSeparatedSetPattern1")}),g=t.match(/ \d \d$/),g==null||g.forEach(D=>{let E=" "+D.slice(1).split(" ").join("-");t=t.replace(D,E),e.push("spaceSeparatedSetPattern2")});let v=/^\d, *\d\/\d, *\d/;if(v.test(t)){let D=t.match(v)[0],E=D.split("/").map(C=>`(${C})`).join(" ")+" ";t=t.replace(D,E),e.push("slashCommaSetPattern")}let y=/\(6-\)/g;y.test(t)&&(t=t.replace(y,"(6-0)"),e.push("missingZeroPattern2"));let b=new RegExp("(?<!-)(\\d+)\\/(\\d+)(?!-)","g");if(b.test(t)){let D=t.match(b),E=new RegExp("(?<!-)(\\d+)\\/(\\d+)(?!-)"),C=t;D.forEach(P=>{let[R,N]=P.match(E).slice(1),M=`${R}-${N}`;C=C.replace(P,M)}),t=C,e.push("slashSetPattern")}let I=/(.*)\s(1\d)\s(\d+)$/;if(I.test(t)){let[D,E,C]=t.match(I).slice(1);D.replace(/\D/g,"").length>=4&&(t=D+` ${E}${C}`,e.push("spaceSeparatedSuperPattern"))}let T=/(^|\s)(\d+-\d+)\s(\d+)(\s|$)/g;for(let D of t.match(T)||[]){let[E,C,P,R]=D.match(/(^|\s)(\d+-\d+)\s(\d+)(\s|$)/).slice(1),[N,M]=C.split("-").map(A=>parseInt(A));Math.abs(N-M)===1&&(t=t.replace(D,`${E}${C}(${P})${R}`),e.push("spaceSeparatedSetPattern"))}let w=/\d-\d \(\d{1,2}\)(\s|$|,)/g;for(let D of t.match(w)||[]){let E=/(\d-\d) \((\d{1,2})\)(\s|$|,)/,[C,P,R]=D.match(E).slice(1),[N,M]=C.split("-").map(A=>parseInt(A));Math.abs(N-M)===1&&(t=t.replace(D,`${C}(${P})${R}`),e.push("floatingTiebreakPattern2"))}let S=/(^|\s)(\d \d)\(/g;for(let D of t.match(S)||[]){let E=/(^|\s)(\d \d)\(/,[C,P]=D.match(E).slice(1);t=t.replace(D,`${C}${P.split(" ").join("-")}(`),e.push("spacedTiebreakPattern")}return{score:t,applied:e}}function kke({score:t,matchUpStatus:e}){var s;let i=t==null?void 0:t.split(" ");t=i.map(l=>{if(l.endsWith("]")){let c=l.split("[");if(vS(c[0]))return c[0]+`(${c[1].slice(0,c[1].length-1)})`}return l}).join(" ");let n=new RegExp(/(\([\d ]+\))/g);if(n.test(t))for(let l of t.match(n)){let c=(s=l.replace(" ","-").match(/\((.*)\)/))==null?void 0:s[1];if(Rr(c)&&(c==null?void 0:c[0])>2){if([2,4].includes(c.length))c=c.split("").join("-");else if(c.length===3){let u=c.indexOf("1");c=FA(c.split(""),u)}}t=t.replace(l,`(${c})`)}i=t==null?void 0:t.split(" ");let r=new RegExp(/^(\d[-/]+\d)\((\d+)[-/]+(\d+)\)$/),a=i.length-1;t=i.map((l,c)=>{let u=[void 0,"","COMPLETED"].includes(e)||c!==a;if(r.test(l)&&u){let[d,p,h]=Array.from(l.match(r)).slice(1),f=Math.min(p,h);return`${d}(${f})`}return l}).join(" "),i=t==null?void 0:t.split(" "),r=new RegExp(/^(\d{2})\((\d+)\)$/),t=i.map(l=>{if(r.test(l)){let[c,u]=Array.from(l.match(r)).slice(1),d=c.split("");return`${d[0]}-${d[1]}(${u})`}return l}).join(" "),i=t==null?void 0:t.split(" "),r=new RegExp(/^\((\d[-/]+\d)\)(\d+)$/),t=i.map(l=>{if(r.test(l)){let[c,u]=Array.from(l.match(r)).slice(1);return vS(c)?`${c}(${u})`:c}return l}).join(" "),i=t==null?void 0:t.split(" "),r=new RegExp(/^1-0\((\d+)\)$/),t=i.map(l=>{if(r.test(l)){let[c]=l.match(r).slice(1);return`[${c<9?10:parseInt(c)+2}-${c}]`}return l}).join(" ");let o=/\((\d)+0 /;if(o.test(t)){let l=t.match(o)[1];t=t.replace(o,`(${l}) `)}return{score:t}}function xke({score:t,attributes:e,identifier:i}){var u,d,p;if(typeof t!="string")return{score:t,identifier:i};let n=new RegExp(/\([\d,/ ]+\)/g),r=t.match(n);for(let h of r||[]){let f=(d=(u=h.match(/^\((.*)\)$/))==null?void 0:u.slice(1))==null?void 0:d[0],m=t.split(h)[0].split(")").reverse()[0].replace(/\D/g,"");if((f==null?void 0:f.length)===2&&(m==null?void 0:m.length)>=2){let y=m.slice(m.length-2).split("").map(b=>parseInt(b));if(Math.abs(y[0]-y[1])===1)continue}let g=gY(f),v=Jx(g);t=t.replace(h,`(${v})`).trim()}let a=new RegExp(/\[[\d,/ ]+\]/g);(p=t.match(a))==null||p.forEach(h=>{let f=gY(h.match(/^\[(.*)\]$/)[1]);t=t.replace(h,`(${f}) `).trim()});let o=[")","]"],s=[")(","), (",") (",")[",") [","](","] ("];if(t.startsWith("(")&&o.some(h=>t.endsWith(h))&&s.some(h=>t.includes(h))){let h="",f=t.split(/[)\]]/).filter(Boolean).map(b=>(b.startsWith(",")&&(b=b.slice(1)),b.trim())),m=f.every(b=>b.includes(",")||EN(b)),g=f.every(b=>b.includes("/")||EN(b)),v=f.every(b=>b.includes("-")||EN(b)),y=m&&","||v&&"-"||g&&"/";if(y){let b;f.forEach(I=>{if(I.startsWith("("))if(b==="set"&&(h+=" "),I.includes(y))h+=I.slice(1).split(y).map(T=>T.trim()).join("-"),b="set";else{let T=I.slice(1);h+=`(${T}) `,b="tiebreak"}else if(I.startsWith("[")){let T=I.slice(1).split(y).map(S=>parseInt(S.trim())),w=Math.min(...T);b==="set"?h+=`(${w}) `:h+=`[${T.join("-")}] `,b="tiebreak"}}),t=h.trim()}}let l=Pl(t.split(""));l["("]===1&&l[")"]===1&&t.startsWith("(")&&t.endsWith(")")&&(t=t.slice(1,t.length-1),l["-"]===1&&vS(t)&&Rr(e==null?void 0:e.removed)&&(t=t+`(${e.removed})`,e.removed=void 0));let c=/\(\)/g;return c.test(t)&&(t=t.replace(c,"").trim()),{score:t}}function Fle({score:t}){let e=t.split(""),i=[],n,r=()=>n=[void 0,void 0,void 0],a=()=>{let s=`${n[0]}-${n[1]}`;return n[2]&&(s+=` (${n[2]})`),r(),n.push(n),s};r();let o=()=>n[0]!==void 0&&n[1]!==void 0&&Math.abs(parseInt(n[0])-parseInt(n[1]));for(;e.length;){let s=e.shift(),l=Rr(s)&&parseInt(s),c=n[0]!==void 0&&n[1]!==void 0;if(Rr(l)){if(n[0]===void 0){n[0]=l;continue}if(n[1]===void 0&&(n[1]=l,o())){i.push(a()),n=[void 0,void 0];continue}if(c&&e.length===1&&Rr(e[0])){let u=e.pop();n[0]=n[0].toString()+n[1].toString(),n[1]=u,i.push(a()),n=[void 0,void 0]}c&&o()}}return{sets:i}}function mV(t){let e=t.indexOf("1"),i=t.split(""),n=i.every(r=>!isNaN(r));if(n&&t.length===3&&e===0){let r=FA(i,e);if(r)return r}if(n&&t.length===7&&e>3){let r=i.slice(4),a=FA(r,e-4);if(a)return`${i[0]}-${i[1]} ${i[2]}-${i[3]} ${a}`}}function Ble(t){let{score:e}=t,{applied:i,matchUpStatus:n}=t,r=e==null?void 0:e.toString().split(""),a=r==null?void 0:r.every(s=>Rr(s)),o=s=>Math.abs(s[0]-s[1]);if(typeof e=="number"||a){e=e.toString().toLowerCase(),a&&(e=r.join(""));let s=a?r.map(l=>parseInt(l)):e.split("").map(l=>parseInt(l));if(Fle({score:e}),s.length,e.length===3&&o(s.slice(0,2))===1){let[l,c,u]=s;e=`${l}-${c}(${u})`,i.push("numericTiebreakPattern1")}else if(e.length===3&&s[0]===1){let[l,c,u]=s;e=`[${l}${c}-${u}]`,i.push("numericTiebreakPattern2")}else if(e.length===4&&o(s.slice(0,2))===1&&"987654".split("").includes(s[0].toString())){let[l,c,u,d]=s,p=Math.min(u,d);e=`${l}-${c}(${p})`,i.push("numericTiebreakPattern3")}else if(e.length===4&&s[0]===1&&s[2]===1){let[l,c,u,d]=s;e=`[${l}${c}-${u}${d}]`,i.push("bigSuper")}else if(e.length===4){let[l,c,u,d]=s;e=`${l}${c} ${u}${d}`,i.push("split4")}else if(e.length===5&&o(s.slice(0,2))===1){let[l,c,u,d,p]=s;e=`${l}-${c}(${u}) ${d}-${p}`,i.push("numericTiebreakPattern4")}else if(e.length===5&&o(s.slice(3))===1){let[l,c,u,d,p]=s;e=`${l}-${c} ${u}-${d}(${p})`,i.push("numericTiebreakPattern5")}else if(s.length===7)if(o(s.slice(0,2))>1&&o(s.slice(2,4))>1&&s[4]===1){let[l,c,u,d,p,h,f]=s;e=`${l}-${c} ${u}-${d} [${p}${h}-${f}]`,i.push("numericTiebreakPattern6")}else if(o(s.slice(0,2))===1&&o(s.slice(3,5))>1&&o(s.slice(5,7))>1){let[l,c,u,d,p,h,f]=s;e=`${l}-${c}(${u}) ${d}-${p} ${h}-${f}`,i.push("numericTiebreakPattern7")}else if(o(s.slice(0,2))>1&&o(s.slice(2,4))===1&&o(s.slice(5,7))>1){let[l,c,u,d,p,h,f]=s;e=`${l}-${c} ${u}-${d}(${p}) ${h}-${f}`,i.push("numericTiebreakPattern8")}else if(o(s.slice(0,2))>1&&o(s.slice(2,4))>1&&o(s.slice(4,6))===1){let[l,c,u,d,p,h,f]=s;e=`${l}-${c} ${u}-${d} ${p}-${h}(${f})`,i.push("numericTiebreakPattern9")}else e=e.slice(0,2)+" "+e.slice(2,4)+" "+e.slice(4),i.push("numericMatchTiebreakPattern");else if(e.length%2){let l=mV(e);l&&e!==l&&i.push("parsedSuperPattern"),e=l??e}else{let l=ro(e.split(""),2).map(g=>g.join("")),c=l.map(g=>{let[v,y]=g.split("").map(T=>parseInt(T)),b=Math.abs(v-y),I=v>y?1:2;return b>1&&I||I*-1}),u=c.reduce((g,v)=>g>0&&v>0,1),d=Pl(c),p=c.map(g=>Math.abs(g)),h=Pl(p),f=c[0]<0,m=!f&&c[1]<0;if(c[0]>0&&c[1]>0&&c[0]!==c[1])e=[l.slice(0,2).join(" "),l.slice(2).join("-")].join(" "),i.push("numeric3rdSetTiebreakPattern");else if(u)e=l.join(" "),i.push("chunkSplit");else if(s.length==6){if(d[1]==2||d[2]===2)if(!Object.values(h).includes(3))e=l.join(" "),i.push("chunkSplit");else{let[g,v,y,b,I,T]=s,w=c.reduce((S,D,E)=>D<0?E:S,void 0);if(w===0){let S=Math.min(y,b);e=`${g}-${v}(${S}) ${I}-${T}`,i.push("chunkSplitTiebreak1")}else if(w===1){let S=Math.min(I,T);e=`${g}-${v} ${y}-${b}(${S})`,i.push("chunkSplitTiebreak2")}else e=`${g}-${v} ${y}-${b}`,i.push("chunkSplitTrimExtraneous")}}else if(s.length===8){let[g,v,y,b,I,T,w,S]=s;f||m?s[5]===1&&(f?e=`${g}-${v}(${y}) ${b}-${I} [${T}${w}-${S}]`:e=`${g}-${v} ${y}-${b}(${I}) [${T}${w}-${S}]`):(c[0],c[1])}}}return{score:e,applied:i,matchUpStatus:n}}function $le(t){let e=[0,0],i=[],n=t.split(" "),r=/(\d+)-(\d+)/;n.forEach(l=>{if(r.test(l)){let c=l.match(r).slice(1).map(d=>parseInt(d)),u=c[0]>c[1]&&1||c[1]>c[0]&&2;u&&(e[u-1]+=1,i.push(u))}});let a=e[0]>e[1]&&1||e[1]>e[0]&&2,o=e[0]>0&&e[0]===e[1],s=e.reduce((l,c)=>l+c,0);return{setsWon:e,setsTied:o,setWinners:i,totalSets:s,winningSide:a}}function Oke({score:t,matchUpStatus:e,attributes:i}){let n=[],r,a=t.split(" "),o=a.length;t=a.map((u,d)=>{if(new RegExp(HD).test(u)){let h=u.slice(3),f=u.slice(0,3),m=f.split("-");if(!vS(f)&&!e){let g=Math.max(...m),v=f.indexOf(g),y=[g,g-1];return v&&y.reverse(),y.join("-")+h}}else if(u.length===2&&Rr(u))return u.split("").join("-");u=Jx(u);let p=new RegExp(`^${f3}$`).test(u)&&"super"||new RegExp(`^${HD}$`).test(u)&&"tiebreak"||new RegExp(`^${Xx}$`).test(u)&&"standard"||"unknown";if(n.push(p),o>1&&p==="standard"&&d<2){let[h,f]=u.split("-"),m=Math.abs(parseInt(h)-parseInt(f)),g=Math.max(h,f),v=Math.min(h,f),y=[parseInt(h),parseInt(f)].indexOf(v);if(g>9&&m>2){let b=g.toString().split(""),I=b.find(T=>parseInt(T)>v||d&&parseInt(T)<=r)??b[0];I&&(u=y?[I,v].join("-"):[v,I].join("-"))}g>(r||0)&&(r=g)}if(p==="standard"){let[h,f]=u.split("-");if(!Math.abs(parseInt(h)-parseInt(f))&&e!=="RETIRED")return""}return u}).filter(Boolean).join(" ");let{setsWon:s,setWinners:l,totalSets:c}=$le(t);if(c===1&&(i==null?void 0:i.removed)==="6"&&(t+=" 6-0"),t.split(" ").length>2&&Math.max(...s)>=2&&l[0]===l[1]&&(t=t.split(" ").slice(0,2).join(" ")),Math.max(...s)>2){let u=[0,0];t=t.split(" ").map((d,p)=>(u[l[p]]+=1,Math.max(...u)>2?void 0:d)).filter(Boolean).join(" ")}return{score:t,profile:n}}function Lke({score:t}){let{setsTied:e,winningSide:i}=$le(t),n=/\s\((\d+)\)$/;if(!i&&e&&n.test(t)){let s=t.match(n).slice(1)[0],l=s<=8?10:s+2;t=t.replace(n,` [${l}-${s}]`)}let r=t.split(" "),a=r[r.length-1];if(!a.includes("-")||a.indexOf("(")>0)return{score:t};let o=a.split("(").join("").split(")").join("").split("-");if(!o.every(s=>Rr(s)))return{score:t};if(o[0]==="76"){let s=o[1].length===2?Math.min(...o[1].split("").map(l=>parseInt(l))):o[1];t=[...r.slice(0,r.length-1),`7-6(${s})`].join(" ")}else{o=o.map(c=>parseInt(c));let s=Math.max(...o),l=Math.abs(o[0]-o[1]);if(s>=10){if(l>2&&o.every(c=>+c>=10)){let c=o.map(u=>u===s?u-10:10).sort();l=Math.abs(c[0]-c[1]),l>2&&(o=c)}t=[...r.slice(0,r.length-1),`[${o.join("-")}]`].join(" ")}else r.length===3&&s>=7&&l>2&&(t=[...r.slice(0,r.length-1),`[${o.join("-")}]`].join(" "))}return{score:t}}function Fke({score:t}){return t=(t==null?void 0:t.toString().toLowerCase())||"",{score:t}}function Bke({score:t,applied:e}){return typeof t!="string"?{score:t}:(t.toLowerCase().includes("o")&&(t=t.toLowerCase().split(" ").map(i=>i.split("o").join("0")).join(" "),e.push("replaceOh")),{score:t,applied:e})}function $ke({score:t,applied:e}){return typeof t!="string"?{score:t}:(t=t.toLowerCase().split(" ").map(i=>{if(/^\d+$/.test(i)&&i.length>2){let n=i.indexOf("1");if(i.length%2){if(i.length===3&&n===0){let r=FA(i.split(""),n);return e.push("getSuper"),r}}else{let{score:r,applied:a}=Ble({score:i,applied:[]});r!==i&&(i=r,e.push(...a))}}return i}).join(" "),{score:t,applied:e})}function Vke({score:t,applied:e}){return typeof t!="string"?{score:t}:[3,4].includes(t.length)&&mV(t)?{score:mV(t)}:(t=t.toLowerCase().split(" ").map(i=>{if(/^\d+$/.test(i)&&i.length===1){e.push("removeErroneous1");return}return i}).filter(Boolean).join(" "),{score:t,applied:e})}function jke({score:t,applied:e}){return["walkover","wo","w/o","w-o"].includes(t==null?void 0:t.toString().toLowerCase())?(e.push("handleWalkover"),{matchUpStatus:"walkover",score:"",applied:e}):{score:t}}function Gke({score:t,profile:e,applied:i}){var o;t=t==null?void 0:t.toString().toLowerCase();let n=/^(.*\d+.*)(ret|con)+[A-Za-z ]*$/;if(n.test(t)){let[s]=t.match(n).slice(1);return i.push("handleRetired"),{score:s.trim(),matchUpStatus:"retired",applied:i}}let r=(o=e==null?void 0:e.matchUpStatuses)==null?void 0:o.retired,a=["rtd",...Array.isArray(r)?r:[r].filter(Boolean)].find(s=>t==null?void 0:t.endsWith(s));return a?(i.push("handleRetired"),{matchUpStatus:"retired",score:t==null?void 0:t.replace(a,"").trim(),applied:i}):{score:t}}function Hke({score:t,attributes:e}){(t.endsWith(" am")||t.endsWith(" pm"))&&(t=""),t=t.replace(/[A-Za-z]+/g,"").trim(),[".",","].some(r=>t.endsWith(r))&&(t=t.slice(0,t.length-1));let i="()/-".split("").some(r=>t.includes(r));/ \d$/.test(t)&&i&&(e={removed:t.slice(t.length-2).trim()},t=t.slice(0,t.length-2));let n=/(.*)[A-Za-z]+$/;return n.test(t)&&(t=t.match(n).slice(1)[0].trim()),{score:t,attributes:e}}function zke({score:t}){return new RegExp(/-\d+\/\d+-/).test(t)&&(t=t.split("/").join(" ")),{score:t}}function qke({score:t}){let e=new RegExp(/^\d+\/\d+/),i=t.split(" ");i.some(r=>e.test(r))&&(t=i.map(r=>e.test(r)?r.replace("/","-"):r).join(" "));let n=/^(\d+), *(\d+)$/;if(n.test(t)){let[r,a]=t.match(n).slice(1);t=[r,a].join("-")}return{score:t}}function Wke({score:t}){let e=new RegExp(/\(\d+\/\d+\)/g),i=t.match(e);for(let n of i||[]){let r=n.replace("/","-");t=t.replace(n,r)}return{score:t}}function Kke({score:t}){if(t.includes(",")){let e=t.split(",").map(n=>n.trim()),i=n=>/\d \d/.test(n);e.every(i)&&(t=e.map(n=>{let r=/\d+ \d+/g;for(let a of n.match(r)){let[o,s]=a.match(/(\d+) (\d+)/).slice(1);n=n.replace(a,`${o}-${s}`)}return n}).join(" "))}if(t.includes(" ")){let e=t.replace(/[ ,]/g,"");e.split("").every(i=>Rr(i))&&e.length===4&&(t=e)}return{score:t}}function Yke({score:t}){let e=new RegExp(/^\[\d+\](.*)$/);e.test(t)&&(t=t.match(e).slice(1)[0].trim());let i=/\(,/g;return i.test(t)&&(t=t.replace(i,"(")),{score:t}}var Zke={handleTiebreakSlashSeparation:Wke,handleSetSlashSeparation:zke,punctuationAdjustments:Mke,handleGameSeparation:qke,joinFloatingTiebreak:Ake,handleBracketSpacing:Nke,handleSpaceSeparator:Kke,separateScoreBlocks:$ke,matchKnownPatterns:_ke,removeDanglingBits:Hke,removeErroneous:Vke,handleWalkover:jke,properTiebreak:kke,handleNumeric:Ble,handleRetired:Gke,containedSets:xke,sensibleSets:Oke,stringScore:Fke,superSquare:Lke,setBuilder:Fle,excisions:Yke,replaceOh:Bke},FB={},Xke=["handleNumeric","handleWalkover","handleRetired","replaceOh","stringScore","punctuationAdjustments","excisions","handleSpaceSeparator","matchKnownPatterns","removeDanglingBits","handleBracketSpacing","matchKnownPatterns","containedSets","separateScoreBlocks","handleGameSeparation","removeErroneous","joinFloatingTiebreak","handleSetSlashSeparation","handleTiebreakSlashSeparation","properTiebreak","sensibleSets","superSquare"],Jke=["handleNumeric","separateScoreBlocks","sensibleSets","superSquare"];function Vle(t){if(!t.score)return{error:Re};let{score:e,sheetName:i,identifier:n,fileName:r,stepLog:a,fullLog:o,profile:s}=t,l=[],c,u=[],d,p,h=e,f=g=>{g.forEach(v=>{p=Zke[v]({profile:s,identifier:n,matchUpStatus:c,attributes:d,applied:u,score:h});let y=p.score!==h;y&&l.push({method:v,score:p.score}),a&&(o||y||p.matchUpStatus!==c)&&console.log(c?{score:p.score,matchUpStatus:c}:{score:p.score},v),p.matchUpStatus&&(c=p.matchUpStatus),p.attributes&&(d=p.attributes),p.applied&&(u=p.applied),h=p.score})};f(Xke);let m=mY(h);return m||(h=e.toString().replace(/\D/g,""),d!=null&&d.removed&&(d.removed=void 0),f(Jke),m=mY(h),m||(h="")),u.forEach(g=>{FB[g]||(FB[g]=0),FB[g]+=1}),{matchUpStatus:c==null?void 0:c.toUpperCase(),modifications:l,attributes:d,isValid:m,score:h}}var jle={};$i(jle,{analyzeScore:()=>m3,analyzeSet:()=>zD,checkScoreHasValue:()=>Pa,checkSetIsComplete:()=>Yx,getSetComplement:()=>v3,getTiebreakComplement:()=>Qx,isValidMatchUpFormat:()=>Nl,parseScoreString:()=>BA,validateScore:()=>g3,validateTieFormat:()=>ll});function m3({existingMatchUpStatus:t,matchUpFormat:e,matchUpStatus:i,winningSide:n,score:r}){var T,w;let a=(r==null?void 0:r.sets)??[],o=((a==null?void 0:a.filter(S=>S==null?void 0:S.winningSide))||[]).reduce((S,D)=>{let{winningSide:E}=D;if(!E)return S;let C=E-1;return S[C]++,S},[0,0]),s=n?n-1:void 0,l=s!==void 0?1-s:void 0,c=s!==void 0&&o[s],u=l!==void 0&&o[l],d=e?Ys(e):void 0,p=Math.max(...o),h=Pl(o)[p],f=((T=d==null?void 0:d.setFormat)==null?void 0:T.timed)||((w=d==null?void 0:d.finalSetFormat)==null?void 0:w.timed),m=d==null?void 0:d.bestOf,g=m&&Math.ceil(m/2)||1,v=i??t,y=v&&[Zi,go,hn].includes(v),b=!d||!a.length||a.every((S,D)=>{let E=D+1,C=E===m,P=E===a.length,{side1Score:R,side2Score:N,side1TiebreakScore:M,side2TiebreakScore:A,winningSide:_}=S,x=Math.max(R??0,N??0),O=M??A,{finalSetFormat:B,setFormat:F}=d,G=C&&B||F;if(O){let{tiebreakTo:H,NoAD:$}=(G==null?void 0:G.tiebreakFormat)||{},q=Math.max(M??0,A??0);if($&&q>H||q<H&&_&&(P&&!y||!P))return!1}return G.setTo?!(!G.noTiebreak&&x>G.setTo+1):!0}),I=(!e||p===g)&&h===1&&o.indexOf(p)+1||void 0;return{valid:!!(b&&(n&&c>u&&n===I||n&&y||!n&&!I&&(![jr,Zi,go,hn].includes(v)||f&&v===jr)))}}function g3({existingMatchUpStatus:t,matchUpFormat:e,matchUpStatus:i,winningSide:n,score:r}){if(typeof r!="object")return{error:Re};let{sets:a,scoreStringSide1:o,scoreStringSide2:s}=r,l="scoreString must be a string!";if(o!==void 0&&typeof o!="string")return{error:Re,info:l};if(s!==void 0&&typeof s!="string")return{error:Re,info:l};if(a!==void 0&&!Array.isArray(a))return{error:Re,info:Zm("sets")};if(a!=null&&a.length){let c=a.map(d=>d==null?void 0:d.setNumber).filter(Boolean);if(c.length!==Pi(c).length)return{error:Re,info:"setNumbers not unique"};for(let d of a){let{side1Score:p,side2Score:h,side1TiebreakScore:f,side2TiebreakScore:m,side1PointScore:g,side2PointScore:v,winningSide:y,setNumber:b}=d;if(![[p,h],[f,m],[g,v]].filter(I=>I.some(T=>![void 0,null].includes(T))).every(I=>I.every(T=>yi(T))))return{error:Re,info:"non-numeric values"};if(![b,y].filter(I=>![void 0,null].includes(I)).every(I=>yi(I)))return{error:Re,info:"non-numeric values"};if(y&&![1,2].includes(y))return{error:Re,info:"winningSide must be 1 or 2"}}let{valid:u}=m3({existingMatchUpStatus:t,matchUpStatus:i,matchUpFormat:e,winningSide:n,score:r});if(!u)return{error:Pne,info:"score is invalid for matchUpFormat or winningSide does not match calculated winningSide"}}return{valid:!0}}var v3=t=>{let{isSide1:e,lowValue:i,setTo:n,tiebreakAt:r,NoAD:a}=t;if(i===void 0)return!1;let o=ri(i);(o==null?void 0:o.toString().length)>2&&(o=parseInt(o.toString().slice(0,2))),r&&r<n&&o>r&&(o=r);let s;return a&&!r?(o>n&&(s=n),s=o<n?n:n-1):s=o+1<n&&n||r&&r<n&&o===r&&n||!r&&o+2||n+1,[e?o:s,e?s:o]},Qx=t=>{let{isSide1:e,lowValue:i,tiebreakTo:n,tiebreakNoAd:r}=t;if(i===void 0)return!1;let a=typeof i=="string"?parseInt(i):i;(a==null?void 0:a.toString().length)>2&&(a=parseInt(a.toString().slice(0,2))),r&&a>n-1&&(a=n-1);let o=Qke({lowValue:a,NoAD:r,tiebreakTo:n});return[e?a:o,e?o:a]};function Qke(t){let{lowValue:e,NoAD:i,tiebreakTo:n}=t,r=i?1:2;return e+1>=n?e+r:n}function BA({tiebreakTo:t=7,scoreString:e=""}){return e==null?void 0:e.split(" ").filter(Boolean).map((n,r)=>i({set:n,setNumber:r+1}));function i({set:n,setNumber:r}){let a=(n==null?void 0:n.startsWith("["))&&n.split("[")[1].split("]")[0].split("-").map(m=>parseInt(m)),o=n.includes("(")&&n.split("(")[0]||n.includes("[")&&n.split("[")[0]||n,s=!a&&o.split("-").map(m=>parseInt(m)),l=a?a[0]>a[1]&&1||a[0]<a[1]&&2||void 0:s[0]>s[1]&&1||s[0]<s[1]&&2||void 0,c=n.includes("(")?n.split("(")[1].split(")")[0]:void 0,u=(c&&Qx({lowValue:c,isSide1:l===2,tiebreakTo:t}))??[],[d,p]=s||[],[h,f]=a||u||[];return{side1Score:d,side2Score:p,side1TiebreakScore:h,side2TiebreakScore:f,winningSide:l,setNumber:r}}}function exe({matchUpScoringFormat:t,isDecidingSet:e,isTiebreakSet:i,setObject:n}){if(!n)return;let r=Zx({set:n});return Yx({matchUpScoringFormat:t,set:n,isDecidingSet:e,isTiebreakSet:i})&&r||void 0}function zD(t){let{setObject:e,matchUpScoringFormat:i}=t;if(!e)return{error:Lk};let{setNumber:n}=e||{},{bestOf:r}=i||{},a=!!(n&&r&&n===r),o=a&&(i==null?void 0:i.finalSetFormat)||(i==null?void 0:i.setFormat),s=!!(o!=null&&o.tiebreakSet),l=!!(o!=null&&o.timed),c=!s&&!l,u=!!(n&&r&&n<=r),d=[e==null?void 0:e.side1Score,e==null?void 0:e.side2Score],p=[e==null?void 0:e.side1PointScore,e==null?void 0:e.side2PointScore],h=[e==null?void 0:e.side1TiebreakScore,e==null?void 0:e.side2TiebreakScore],f=d.filter(_=>_!==void 0).length,m=p.filter(_=>_!==void 0).length,g=h.filter(_=>_!==void 0).length,v=d==null?void 0:d.filter(_=>!isNaN(_)).length,y=h==null?void 0:h.filter(_=>!isNaN(_)).length,{tiebreakAt:b}=o||{},I=b&&d.filter(_=>_>=b).length===2,T=I&&(d[0]>d[1]&&1||d[1]>d[0]&&2||void 0),w=!!(y&&!v),S=!!(e!=null&&e.winningSide),{error:D,result:E}=txe({setObject:e,setFormat:o,sideGameScores:d,sideTiebreakScores:h}),{error:C,result:P}=ixe({setObject:e,setFormat:o,sideTiebreakScores:h}),R=c&&!w&&E||s&&w&&P,N=u&&!(s&&!w)&&!(c&&w)&&(!S||R),M=exe({isDecidingSet:a,isTiebreakSet:w,matchUpScoringFormat:i,setObject:e}),A={expectTiebreakSet:s,expectTimedSet:l,hasTiebreakCondition:I,isCompletedSet:S,isDecidingSet:a,isTiebreakSet:w,isValidSet:N,isValidSetNumber:u,isValidSetOutcome:R,leadingSide:T,setFormat:o,sideGameScores:d,sideGameScoresCount:f,sidePointScores:p,sidePointScoresCount:m,sideTiebreakScores:h,sideTiebreakScoresCount:g,winningSide:M};return(e==null?void 0:e.winningSide)!==void 0&&(w?(A.isValidTiebreakSetOutcome=P,P||(A.tiebreakSetError=C)):(A.isValidStandardSetOutcome=E,E||(A.standardSetError=D))),A}function txe({setObject:t,setFormat:e,sideGameScores:i,sideTiebreakScores:n}){if(!t)return{result:!1,error:Lk};let r=!!(e!=null&&e.tiebreakSet),a=!!(e!=null&&e.timed);if(!e||r||a)return{result:!1,error:Re};if((i==null?void 0:i.filter(S=>!isNaN(S)).length)!==2)return{result:!1,error:k2};let{setTo:o,tiebreakAt:s,tiebreakFormat:l,NoAD:c}=e||{};if(!(o&&(i!=null&&i.find(S=>S>=o))))return{result:!1,error:k2};let u=[1,2].includes(t==null?void 0:t.winningSide);if(!t||!u)return{result:!1,error:Fk};let d=(t==null?void 0:t.winningSide)-1,p=1-d,h=i[d],f=i[p],m=h-f;if(!(h>f))return{result:!1,error:{message:"winningSide game scoreString is not high"}};let g=s&&l,v=(n==null?void 0:n.filter(S=>!isNaN(S)).length)===2,y=n==null?void 0:n[d],b=n==null?void 0:n[p],I=s&&i.filter(S=>S>=s).length===2;if(g){let{NoAD:S,tiebreakTo:D}=l;if(I){if(m>1)return{result:!1,error:{message:"invalid winning game scoreString (5)"}};if(!v)return{result:!1,error:{message:"invalid tiebreak scores (1)"}};if(isNaN(D))return{result:!1,error:{message:"tiebreakTo error"}};if(!(D&&(n!=null&&n.find(N=>N>=D))))return{result:!1,error:{message:"invalid tiebreak scores (2)"}};let E=s<o?o:o+1;if(h>E)return{result:!1,error:{message:"invalid winning game scoreString (1)"}};if(!y||!b||y<b)return{result:!1,error:{message:"winningSide tiebreak value is not high"}};let C=S?1:2,P=y-b,R=b>=D-1;if(P&&R&&P<C)return{result:!1,error:{message:"invalid tiebreak scores (3)"}}}if(h>o&&!I)return{result:!1,error:{message:"invalid winning game scoreString (2)"}}}let T=c?1:2,w=f>=o-1;return m&&w&&!I&&m<T?{result:!1,error:{message:"invalid winning game scoreString (3)"}}:m>T&&h>o?{result:!1,error:{message:"invalid winning game scoreString (4)"}}:{result:!0}}function ixe({setObject:t,setFormat:e,sideTiebreakScores:i}){if(!t)return{result:!1,error:Lk};let n=!!(e!=null&&e.tiebreakSet),r=!!(e!=null&&e.timed);if(!e||!n||r)return{result:!1,error:{message:"not tiebreak set"}};let a=[1,2].includes(t==null?void 0:t.winningSide);if(!t||!a)return{result:!1,error:Fk};let{tiebreakSet:o}=e||{},{NoAD:s,tiebreakTo:l}=o||{};if((i==null?void 0:i.filter(g=>!isNaN(g)).length)!==2)return{result:!1,error:{message:"invalid tiebreak scores (1)"}};if(isNaN(l))return{result:!1,error:{message:"tiebreakTo error"}};if(!(i!=null&&i.find(g=>g>=l)))return{result:!1,error:{message:"invalid tiebreak scores (2)"}};let c=(t==null?void 0:t.winningSide)-1,u=1-c,d=i[c],p=i[u];if(!d||!p||d<p)return{result:!1,error:{message:"winningSide tiebreak value is not high"}};let h=s?1:2,f=d-p,m=p>=l-1;return f&&m&&f<h?{result:!1,error:{message:"invalid tiebreak scores (3)"}}:{result:!0}}var Gle={collectionDefinitions:[{collectionName:"Male Singles",matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpCount:4,matchUpValue:1,gender:"MALE"},{collectionName:"Female Singles",matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",gender:"FEMALE",matchUpCount:4,matchUpValue:1},{collectionName:"Male Doubles",matchUpFormat:"SET1-S:8/TB7@7",matchUpType:"DOUBLES",matchUpCount:2,matchUpValue:1,gender:"MALE"},{collectionName:"Female Doubles",matchUpFormat:"SET1-S:8/TB7@7",matchUpType:"DOUBLES",gender:"FEMALE",matchUpCount:2,matchUpValue:1},{collectionName:"Mixed Doubles",matchUpFormat:"SET1-S:8/TB7@7",matchUpType:"DOUBLES",matchUpCount:4,matchUpValue:1,gender:"MIXED"}],tieFormatName:"USTA_GOLD_TEAM_CHALLENGE",winCriteria:{valueGoal:9}},Hle={collectionDefinitions:[{collectionName:"Round 1",matchUpCount:3,matchUpFormat:"SET1-S:T20",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Round 2",matchUpCount:3,matchUpFormat:"SET1-S:T20",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Round 3",matchUpCount:3,matchUpFormat:"SET1-S:T20",matchUpType:"DOUBLES",scoreValue:1}],tieFormatName:"Doubles Shuffle",unrestrictedSelections:!0,winCriteria:{aggregateValue:!0}},zle={collectionDefinitions:[{collectionName:"Male Singles",gender:"MALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Female Singles",gender:"FEMALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Mixed Doubles",gender:"MIXED",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1}],tieFormatName:"USTA_SOUTHERN_LEVEL_5",winCriteria:{valueGoal:8}},qle={collectionDefinitions:[{category:{ageCategoryCode:"16U"},collectionName:"16U Singles",matchUpCount:4,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Singles",matchUpCount:4,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1},{category:{ageCategoryCode:"16U"},collectionName:"16U Doubles",matchUpCount:2,matchUpFormat:"SET1-S:6/TB7",matchUpType:"DOUBLES",matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Doubles",matchUpCount:2,matchUpFormat:"SET1-S:6/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Tiebreak Doubles",matchUpCount:1,matchUpFormat:"SET1-S:TB10",matchUpType:"DOUBLES",matchUpValue:1,processCodes:["RANKING.IGNORE"]}],tieFormatName:"USTA_SECTION_BATTLE",winCriteria:{valueGoal:9}},Wle={collectionDefinitions:[{collectionName:"Male Singles",gender:"MALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Female Singles",gender:"FEMALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Male Doubles",gender:"MALE",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Female Doubles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Mixed Doubles",gender:"MIXED",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1}],tieFormatName:"USTA_INTERSECTIONAL",winCriteria:{valueGoal:8}},Kle={collectionDefinitions:[{scoreValue:1,matchUpType:"SINGLES",collectionName:"Men's Singles",matchUpFormat:"SET1-S:T60",gender:"MALE",matchUpCount:1},{scoreValue:1,matchUpType:"SINGLES",collectionName:"Women's Singles",matchUpFormat:"SET1-S:T60",gender:"FEMALE",matchUpCount:1},{matchUpValue:1,matchUpType:"DOUBLES",collectionName:"Mixed Doubles",matchUpFormat:"SET1-S:T60",gender:"MIXED",matchUpCount:1}],tieFormatName:"Time Tennis Pro Circuit",winCriteria:{aggregateValue:!0}},Yle={collectionDefinitions:[{collectionName:"Mixed Doubles",gender:"MIXED",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Male Singles",matchUpCount:1,gender:"MALE",matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Female Singles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"DOMINANT_DUO_MIXED",winCriteria:{valueGoal:2}},Zle={collectionDefinitions:[{scoreValue:1,matchUpType:"SINGLES",collectionName:"Men's Singles",matchUpFormat:"SET1-S:T60",gender:"MALE",matchUpCount:3},{scoreValue:1,matchUpType:"SINGLES",collectionName:"Women's Singles",matchUpFormat:"SET1-S:T60",gender:"FEMALE",matchUpCount:3},{scoreValue:1,matchUpType:"DOUBLES",collectionName:"Men's Doubles",matchUpFormat:"SET1-S:T60",gender:"MALE",matchUpCount:1},{matchUpValue:1,matchUpType:"DOUBLES",collectionName:"Women's Doubles",matchUpFormat:"SET1-S:T60",gender:"FEMALE",matchUpCount:1},{matchUpValue:1,matchUpType:"DOUBLES",collectionName:"Mixed Doubles",matchUpFormat:"SET1-S:T60",gender:"MIXED",matchUpCount:1}],tieFormatName:"Time Tennis Dual",winCriteria:{aggregateValue:!0}},Xle={collectionDefinitions:[{category:{ageCategoryCode:"14U"},collectionName:"14U Singles",matchUpCount:2,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{category:{ageCategoryCode:"16U"},collectionName:"16U Singles",matchUpCount:2,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Singles",matchUpCount:2,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{category:{ageCategoryCode:"14U"},collectionName:"14U Doubles",collectionGroupNumber:1,matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{category:{ageCategoryCode:"16U"},collectionName:"16U Doubles",collectionGroupNumber:1,matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Doubles",collectionGroupNumber:1,matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1}],collectionGroups:[{groupNumber:1,groupName:"Doubles",groupValue:1,winCriteria:{valueGoal:2}}],tieFormatName:"USTA_BREWER_CUP",winCriteria:{valueGoal:4}},Jle={winCriteria:{valueGoal:23},tieFormatName:"USTA_OZAKI_CUP",collectionDefinitions:[{category:{ageCategoryCode:"18U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"18U Boys Singles",matchUpType:"SINGLES",matchUpCount:3,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"18U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"18U Girls Singles",matchUpType:"SINGLES",gender:"FEMALE",matchUpCount:3,matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Boys Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",matchUpCount:1,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"18U"},collectionName:"18U Girls Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"FEMALE",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Mixed Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"MIXED",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"16U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"16U Boys Singles",matchUpType:"SINGLES",matchUpCount:3,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"16U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"16U Girls Singles",matchUpType:"SINGLES",gender:"FEMALE",matchUpCount:3,matchUpValue:1},{category:{ageCategoryCode:"16U"},collectionName:"16U Boys Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",matchUpCount:1,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"16U"},collectionName:"16U Girls Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"FEMALE",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"16U"},collectionName:"16U Mixed Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"MIXED",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"14U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"14U Boys Singles",matchUpType:"SINGLES",matchUpCount:3,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"14U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"14U Girls Singles",matchUpType:"SINGLES",gender:"FEMALE",matchUpCount:3,matchUpValue:1},{category:{ageCategoryCode:"14U"},collectionName:"14U Boys Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",matchUpCount:1,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"14U"},collectionName:"14U Girls Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"FEMALE",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"14U"},collectionName:"14U Mixed Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"MIXED",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"12U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"12U Boys Singles",matchUpType:"SINGLES",matchUpCount:3,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"12U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"12U Girls Singles",matchUpType:"SINGLES",gender:"FEMALE",matchUpCount:3,matchUpValue:1},{category:{ageCategoryCode:"12U"},collectionName:"12U Boys Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",matchUpCount:1,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"12U"},collectionName:"12U Girls Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"FEMALE",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"12U"},collectionName:"12U Mixed Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"MIXED",matchUpCount:1,matchUpValue:1}]},Qle={collectionDefinitions:[{collectionName:"Doubles",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Singles",matchUpCount:2,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"DOMINANT_DUO",winCriteria:{valueGoal:2}},ece={collectionDefinitions:[{collectionName:"Doubles",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7@7",matchUpType:"DOUBLES",collectionValue:1},{collectionName:"Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"USTA_COLLEGE",winCriteria:{valueGoal:4}},tce={collectionDefinitions:[{collectionName:"Male Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Female Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Male Doubles",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Female Doubles",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1}],tieFormatName:"USTA_LEVEL_1",winCriteria:{valueGoal:10}},ice={collectionDefinitions:[{collectionName:"Female Doubles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Male Doubles",gender:"MALE",matchUpCount:1,matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Female Singles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"SINGLES",scoreValue:1},{collectionName:"Male Singles",matchUpCount:1,gender:"MALE",matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"SINGLES",scoreValue:1},{collectionName:"Mixed Doubles",matchUpCount:1,gender:"MIXED",matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Mixed Doubles",matchUpCount:1,gender:"MIXED",matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Overtime",matchUpCount:1,gender:"MIXED",matchUpFormat:"SET1-S:T20",matchUpType:"DOUBLES",scoreValue:1}],tieFormatName:"USTA_WTT_ITT",winCriteria:{aggregateValue:!0}},nce={collectionDefinitions:[{collectionName:"Male Singles",gender:"MALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Female Singles",gender:"FEMALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Male Doubles",gender:"MALE",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Female Doubles",gender:"FEMALE",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Mixed Doubles",gender:"MIXED",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1}],tieFormatName:"USTA_ZONAL",winCriteria:{valueGoal:10}},rce={collectionDefinitions:[{collectionGroupNumber:1,matchUpType:"DOUBLES",matchUpCount:1,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:1},{collectionGroupNumber:1,matchUpType:"SINGLES",matchUpCount:3,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:1},{collectionGroupNumber:2,matchUpType:"DOUBLES",matchUpCount:1,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:2},{collectionGroupNumber:2,matchUpType:"SINGLES",matchUpCount:3,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:2},{collectionGroupNumber:3,matchUpType:"DOUBLES",matchUpCount:1,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:3},{collectionGroupNumber:3,matchUpType:"SINGLES",matchUpCount:3,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:3}],collectionGroups:[{groupNumber:1,groupName:"Day 1"},{groupNumber:2,groupName:"Day 2"},{groupNumber:3,groupName:"Day 3"}],tieFormatName:"LAVER_CUP",winCriteria:{valueGoal:13}},ace={collectionDefinitions:[{collectionName:"Female Doubles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Male Doubles",gender:"MALE",matchUpCount:1,matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Female Singles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"SINGLES",scoreValue:1},{collectionName:"Male Singles",matchUpCount:1,gender:"MALE",matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"SINGLES",scoreValue:1},{collectionName:"Mixed Doubles",matchUpCount:1,gender:"MIXED",matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Overtime",matchUpCount:1,gender:"MIXED",matchUpFormat:"SET1-S:T20",matchUpType:"DOUBLES",scoreValue:1}],tieFormatName:"USTA_TOC",winCriteria:{aggregateValue:!0}},$A="COLLEGE_DEFAULT",gV="COLLEGE_JUCO",vV="COLLEGE_D3",oce="DOMINANT_DUO",sce="DOMINANT_DUO_MIXED",lce="LAVER_CUP",cce="TEAM_DOUBLES_3_AGGREGATION",uce="TIME_TENNIS_DUAL",dce="TIME_TENNIS_PRO_CIRCUIT",pce="USTA_BREWER_CUP",hce="USTA_OZAKI_CUP",fce="USTA_COLLEGE",mce="USTA_GOLD_TEAM_CHALLENGE",gce="USTA_LEVEL_1",vce="USTA_INTERSECTIONAL",yce="USTA_SECTION_BATTLE",bce="USTA_SOUTHERN_LEVEL_5",Ice="USTA_TOC",wce="USTA_WTT_ITT",Sce="USTA_ZONAL",Tce={COLLEGE_D3:vV,COLLEGE_DEFAULT:$A,COLLEGE_JUCO:gV,DOMINANT_DUO:oce,DOMINANT_DUO_MIXED:sce,LAVER_CUP:lce,TEAM_DOUBLES_3_AGGREGATION:cce,TIME_TENNIS_DUAL:uce,TIME_TENNIS_PRO_CIRCUIT:dce,USTA_BREWER_CUP:pce,USTA_OZAKI_CUP:hce,USTA_COLLEGE:fce,USTA_GOLD_TEAM_CHALLENGE:mce,USTA_INTERSECTIONAL:vce,USTA_LEVEL_1:gce,USTA_SECTION_BATTLE:yce,USTA_SOUTHERN_LEVEL_5:bce,USTA_TOC:Ice,USTA_WTT_ITT:wce,USTA_ZONAL:Sce},Uce="STANDARD",vY={[Uce]:{hydrate:!0,doubles:{matchUpCount:3,matchUpValue:1},singles:{matchUpCount:6,matchUpValue:1},valueGoal:5},[vV]:{hydrate:!0,doubles:{matchUpFormat:"SET1-S:8/TB7@7",matchUpCount:3,matchUpValue:1},singles:{matchUpFormat:Iu,matchUpCount:6,matchUpValue:1},tieFormatName:vV,valueGoal:5},[$A]:{hydrate:!0,doubles:{matchUpFormat:"SET1-S:6/TB7",collectionValue:1,matchUpCount:3},singles:{matchUpFormat:Iu,matchUpCount:6,matchUpValue:1},tieFormatName:$A,valueGoal:4},[gV]:{hydrate:!0,doubles:{matchUpFormat:"SET1-S:8/TB7",matchUpCount:3,matchUpValue:1},singles:{matchUpFormat:Iu,matchUpCount:6,matchUpValue:1},tieFormatName:gV,valueGoal:5},[lce]:rce,[oce]:Qle,[sce]:Yle,[cce]:Hle,[uce]:Zle,[dce]:Kle,[pce]:Xle,[hce]:Jle,[fce]:ece,[mce]:Gle,[vce]:Wle,[gce]:tce,[yce]:qle,[bce]:zle,[wce]:ice,[Ice]:ace,[Sce]:nce},nxe=t=>{let e=t!=null&&t.namedFormat&&Object.keys(vY).includes(t.namedFormat)?t.namedFormat:Uce,i=Array.isArray(t==null?void 0:t.uuids)?t==null?void 0:t.uuids:[],n,{category:r,gender:a}=(t==null?void 0:t.event)??{},o=Ot(vY[e],!1,!0),s=l=>{var u,d;if(!(t!=null&&t.isMock)&&!((u=t==null?void 0:t.event)!=null&&u.isMock)||!t.event)return(i==null?void 0:i.pop())??Pn();let c=(d=t==null?void 0:t.event)==null?void 0:d.eventId;return i.pop()??`${c}-COL-${l+1}`};return o.hydrate?(n={winCriteria:{valueGoal:o.valueGoal},collectionDefinitions:[{collectionId:s(0),matchUpFormat:ase,collectionName:"Doubles",matchUpType:zn,...o.doubles},{collectionId:s(1),matchUpFormat:Iu,collectionName:"Singles",matchUpType:or,...o.singles}]},o.tieFormatName&&(n.tieFormatName=o.tieFormatName)):(o.collectionDefinitions.forEach((l,c)=>l.collectionId=s(c)),n=o),t!=null&&t.hydrateCollections&&n.collectionDefinitions.forEach(l=>{r&&!l.category&&(l.category=r),a&&!l.gender&&(l.gender=a)}),n},Xv=nxe;function rxe(t){var d,p,h;let{existingDrawDefinition:e,hydrateCollections:i,enforceGender:n,tieFormatName:r,matchUpType:a,eventType:o,isMock:s,event:l}=t,{tieFormat:c,matchUpFormat:u}=t;if(a===ga&&o===ga){let f=(p=(d=e==null?void 0:e.structures)==null?void 0:d.find(({stage:m})=>m===xt))==null?void 0:p.tieFormat;c=c||f||r&&((h=l==null?void 0:l.tieFormat)==null?void 0:h.tieFormatName)===r&&l.tieFormat||r&&Xv({namedFormat:r,hydrateCollections:i,isMock:s,event:l})||(l==null?void 0:l.tieFormat)||Xv({event:l,isMock:s,hydrateCollections:i}),u=void 0}else u||(c=void 0,l!=null&&l.matchUpFormat||(u=Iu));if(c){let f=ll({gender:l==null?void 0:l.gender,enforceGender:n,tieFormat:c});if(f.error)return f}return{tieFormat:c,matchUpFormat:u}}function axe(t){var b,I,T,w,S;let e=t.drawDefinition,{existingQualifyingPlaceholderStructureId:i,appliedPolicies:n,drawEntries:r,structureId:a,idPrefix:o,isMock:s,event:l}=t,c=t.qualifyingProfiles,u=c!=null&&c.length?Gse({uuids:t.uuids,qualifyingProfiles:c,appliedPolicies:n,idPrefix:o,isMock:s}):void 0;if(u!=null&&u.error)return u;e.structures=(b=e.structures)==null?void 0:b.filter(({structureId:D})=>D!==i),e.links=(I=e.links)==null?void 0:I.filter(({source:D})=>D.structureId!==i);let{qualifiersCount:d,qualifyingDrawPositionsCount:p,qualifyingDetails:h}=u??{};p&&(u!=null&&u.structures&&((T=e.structures)==null||T.push(...u.structures)),u!=null&&u.links&&((w=e.links)==null||w.push(...u.links)));let f=(S=e.structures)==null?void 0:S.find(({stage:D,stageSequence:E})=>D===xt&&E===1),{qualifiersCount:m}=$T({stageSequence:1,drawDefinition:e,structureId:a,stage:xt}),g=Math.max(d??0,m??0),v=Voe({qualifiersCount:g,drawDefinition:e,stage:xt});if(v.error||(v=_A({drawSize:p,stage:Zt,drawDefinition:e}),v.error))return v;oxe({drawDefinition:e,drawEntries:r,event:l});let y=sxe({mainStructure:f,qualifyingDetails:h,drawDefinition:e});return y.error?y:{drawDefinition:e,structureId:a}}function oxe({drawDefinition:t,drawEntries:e,event:i}){for(let n of(e??[]).filter(({entryStage:r})=>r===Zt)){let r={...n,entryStage:n.entryStage??xt,drawDefinition:t,event:i};aoe(r)}}function sxe({mainStructure:t,qualifyingDetails:e,drawDefinition:i}){var n;for(let r of e||[]){let{finalQualifyingRoundNumber:a,finalQualifyingStructureId:o,roundTarget:s,finishingPositions:l,linkType:c}=r,u=t&&((n=jC({targetStructureId:t.structureId,sourceStructureId:o,sourceRoundNumber:a,finishingPositions:l,targetEntryRound:s,linkType:c}))==null?void 0:n.link);if(u!=null&&u.error)return u;u&&(i.links||(i.links=[]),i.links.push(u))}return{error:void 0}}function Dce(t){var n,r;let{participantIds:e}=t,i=((r=(n=t.drawDefinition)==null?void 0:n.entries)==null?void 0:r.filter(a=>{let o=a.entryStatus;return!t.restrictEntryStatus||Bu.includes(o)}).map(Gi))??[];if(e){let a=e.filter(o=>!(i!=null&&i.includes(o)));if(a!=null&&a.length)return pe({result:{error:vd},info:{invalidParticipantIds:a}})}else e=i;return t.roundsCount&&t.restrictRoundsCount!==!1&&t.roundsCount>e.length-1&&(!t.enableDoubleRobin||t.roundsCount>(e.length-1)*2)?{error:Re,info:"Not enough participants for roundsCount"}:t.roundsCount&&t.restrictRoundsCount!==!1&&t.roundsCount>31?{error:Re,info:"roundsCount must be less than 32"}:{participantIds:e}}function y3(t){var d;let e=[],{roundsCount:i=1,drawDefinition:n,matchUpsCount:r,structureId:a,idPrefix:o,isMock:s,event:l}=t,c,u=Dce(t);if(u.error)return u;for(let p of Et(1,i+1)){let h=qx({restrictMatchUpsCount:t.restrictMatchUpsCount,ignoreLastRoundNumber:!!c,newRound:!c,drawDefinition:n,matchUpsCount:r,structureId:a,roundNumber:c,idPrefix:o,isMock:s,event:l});if(h.error)return pe({result:h,info:{iteration:p}});(d=h.matchUps)!=null&&d.length&&e.push(...h.matchUps),c=((h==null?void 0:h.roundNumber)??1)+1}return{matchUps:e}}function lxe(t){var l;let{tournamentRecord:e,participantIds:i,scaleName:n,eventType:r,adHocRatings:a={}}=t,o=t.scaleAccessor??((l=La[n])==null?void 0:l.accessor),s=e.participants??[];for(let c of i??[]){let u=s==null?void 0:s.find(p=>p.participantId===c),d=yY({scaleName:`${n}.${vz}`,participant:u,eventType:r});!d&&n&&(d=yY({scaleAccessor:o,participant:u,scaleName:n,eventType:r})),d&&!a[c]&&(a[c]=d)}return a}function yY({scaleType:t=Lm,scaleAccessor:e,participant:i,scaleName:n,eventType:r}){var o,s;let a=(s=(o=i&&th({scaleAttributes:{eventType:r??qb,scaleType:t,scaleName:n},participant:i}))==null?void 0:o.scaleItem)==null?void 0:s.scaleValue;return e&&Xi(a)?a[e]:a}function b3(t){var u,d;let e=uxe(t);if(e!=null&&e.error)return e;let i=Dce(t);if(i.error)return i;let n=cxe(t);if(n.error)return n;let r=lxe(t),a=((u=t.tournamentRecord)==null?void 0:u.isMock)??t.isMock,o=t.eventType??((d=t.event)==null?void 0:d.eventType),s=[],l=[],c;for(let p of Et(1,(t.roundsCount??1)+1)){let h=l3({...t,participantIds:i.participantIds,structure:n.structure,ignoreLastRoundNumber:!0,iterationMatchUps:s,adHocRatings:r,roundNumber:c,eventType:o,isMock:a});if(h.error)return h;let{matchUps:f,...m}=h;m.modifiedScaleValues&&(r=m.modifiedScaleValues),l.push({...m,iteration:p,matchUpsCount:f==null?void 0:f.length}),c=((m==null?void 0:m.roundNumber)??1)+1,f!=null&&f.length&&s.push(...f)}return{...ce,matchUps:s,roundResults:l}}function cxe(t){var r,a,o;if(t.structureId)return t.structureId;let e=t.drawDefinition,i=(a=(r=e==null?void 0:e.structures)==null?void 0:r.filter(s=>s.stageSequence===1))==null?void 0:a.reduce((s,l)=>{let c=l.stage&&Wb[l.stage];return sl({structure:l})&&c>(Wb[s==null?void 0:s.stage]||1)?l:s},void 0),n=(o=e==null?void 0:e.structures)==null?void 0:o.find(s=>s.structureId===(i==null?void 0:i.structureId));return n?sl({structure:n})?{structure:n}:{error:Ib}:{error:wr}}function uxe(t){var e;return t.roundsCount&&typeof t.roundsCount!="number"?{error:Re,info:"roundsCount must be a number"}:typeof t.drawDefinition!="object"||t.drawDefinition.drawType&&t.drawDefinition.drawType!==Fc?{error:Ib}:!Array.isArray((e=t.drawDefinition)==null?void 0:e.entries)&&t.participantIds&&!Array.isArray(t.participantIds)?{error:Re,info:"Missing Entries"}:{error:void 0}}function dxe(t){var u,d;let{tournamentRecord:e,drawDefinition:i,structureId:n,idPrefix:r,isMock:a,event:o}=t,s=(u=o==null?void 0:o.entries)==null?void 0:u.filter(({entryStage:p,entryStatus:h})=>(!p||p===xt)&&h&&Bu.includes(h)),l=s==null?void 0:s.map(Gi),c=s?Math.floor(s.length/2):0;if(t.automated)return pxe({...t,participantIds:l});{let p=y3({roundsCount:t.roundsCount,drawDefinition:i,matchUpsCount:c,idPrefix:r,isMock:a,event:o});if(p.error)return p;(d=p.matchUps)!=null&&d.length&&jx({matchUps:p.matchUps,suppressNotifications:!0,tournamentRecord:e,drawDefinition:i,structureId:n,event:o})}return{...ce}}function pxe(t){var l,c;let{restrictEntryStatus:e,generateMatchUps:i,structureId:n,matchUpIds:r,scaleName:a,scaleAccessor:o}=t.drawMatic??{},s=b3({...t,eventType:((l=t.drawMatic)==null?void 0:l.eventType)??t.matchUpType,generateMatchUps:i??!0,scaleAccessor:o??t.scaleAccessor,scaleName:a??t.scaleName,participantIds:t.participantIds,roundsCount:t.roundsCount,restrictEntryStatus:e,structureId:n,matchUpIds:r});return s.error?s:((c=s==null?void 0:s.matchUps)!=null&&c.length&&jx({tournamentRecord:t.tournamentRecord,drawDefinition:t.drawDefinition,suppressNotifications:!0,matchUps:s.matchUps,event:t.event,structureId:n}),{...ce})}function hxe({requireParticipantCount:t=!0,enforcePolicyLimits:e=!0,drawSizeProgression:i,participantsCount:n,participantCount:r,appliedPolicies:a,drawDefinition:o,seedingProfile:s,structureId:l,seedsCount:c}){var y,b;n=n??r;let u=ui({drawDefinition:o,structureId:l});if(u.error)return u;let d=u.structure;if(!d)return{error:wr};let{positionAssignments:p}=ja({structure:d}),h=(p==null?void 0:p.length)||0;if(c>h)return{error:ane};let f=(y=d.structures)==null?void 0:y.length,m=yi(s==null?void 0:s.groupSeedingThreshold)&&(s==null?void 0:s.groupSeedingThreshold),g=(b=Tq({roundRobinGroupsCount:f,drawSize:h}))==null?void 0:b.seedGroups,{seedsCount:v}=eP({policyDefinitions:a,requireParticipantCount:t,drawSizeProgression:i,participantsCount:n,drawSize:h});return v&&(a!=null&&a[uu])&&c>v&&e&&(c=v),d.seedLimit=c,d.seedAssignments=Et(1,c+1).map(I=>{let T=g==null?void 0:g.find(D=>D.includes(I)),w=T&&Math.min(...T),S=m&&I>=m?w:I;return{participantId:void 0,seedNumber:I,seedValue:S}}),qn({drawDefinition:o,structureIds:[l]}),{...ce,seedLimit:c}}function ZI({sortDescending:t=!1,tournamentRecord:e,scaleAttributes:i,scaleSortMethod:n,stageSequence:r,entries:a,event:o,stage:s}){if(!e)return{error:ut};return a=a??(o==null?void 0:o.entries)??[],{scaledEntries:a.filter(u=>(!s||!u.entryStage||u.entryStage===s)&&(!r||!u.entryStageSequence||u.entryStageSequence===r)&&Bu.includes(u.entryStatus)).map(u=>{let{participantId:d}=u,{scaleItem:p}=gS({tournamentRecord:e,scaleAttributes:i,participantId:d});return{...u,...p}}).filter(u=>{let d=u.scaleValue;return!n&&(isNaN(d)||!parseFloat(d))?!1:d}).sort(n||l)};function l(u,d){return t?c(d)-c(u):c(u)-c(d)}function c(u){return parseFloat(u.scaleValue||(t?-1:1e5))}}function Ece(t){let e="prepareStage",{drawDefinition:i}=t,{structures:n}=Ru({stageSequence:t.stageSequence||1,roundTarget:t.roundTarget,stage:t.stage,drawDefinition:i}),r=t.preparedStructureIds||[],a=n==null?void 0:n.find(({structureId:h})=>!r.includes(h));if(!a)return pe({result:{error:wr},stack:e});let o=a==null?void 0:a.structureId,{seedsCount:s,stageEntries:l,seedLimit:c}=wxe({...t,structureId:o});(t.seededParticipants||t.event||t.seedingScaleName)&&gxe({...t,seedsCount:s,structure:a,structureId:o});let u=t.automated!==!1&&t.drawType!==Fc&&!(t.qualifyingOnly&&t.stage!==Zt),d=((n==null?void 0:n.length)||0)>1,p=u?mxe({...t,multipleStructures:d,seedLimit:c,structureId:o}):{};return p!=null&&p.error?pe({result:p,stack:e}):{...p,stageEntries:l,structureId:o,seedsCount:s}}function fxe({entries:t,stage:e,stageSequence:i,roundTarget:n}){return t.filter(r=>{var o,s;let a=(s=(o=Ri({name:Pp,element:r}))==null?void 0:o.extension)==null?void 0:s.value;return(!r.entryStage||r.entryStage===e)&&(!i||!r.entryStageSequence||r.entryStageSequence===i)&&(!n||!a||a===n)&&Dy.includes(r.entryStatus)})}function mxe(t){let e=typeof t.automated=="object"&&t.automated.seedsOnly,i=$C({...t,seedsOnly:e});if(i.error)return i;let n=i==null?void 0:i.positionAssignments,r=i==null?void 0:i.positioningReport;return{conflicts:i.conflicts,positionAssignments:n,positioningReport:r}}function gxe(t){let{seededParticipants:e,seedingScaleName:i,entries:n,event:r}=t,a=n.map(Gi);e?vxe({...t,enteredParticipantIds:a}):(r||i)&&yxe({...t,enteredParticipantIds:a})}function vxe(t){let{provisionalPositioning:e,enteredParticipantIds:i,seededParticipants:n,tournamentRecord:r,appliedPolicies:a,drawDefinition:o,seedingProfile:s,structureId:l,structure:c,event:u}=t,d=c?qI({provisionalPositioning:e,appliedPolicies:a,drawDefinition:o,seedingProfile:s,structure:c}):void 0;n.filter(({participantId:p})=>i.includes(p)).filter(p=>!p.seedNumber||p.seedNumber<=n.length).sort((p,h)=>p.seedNumber<h.seedNumber?-1:p.seedNumber<h.seedNumber?1:0).forEach(p=>{let{participantId:h,seedNumber:f,seedValue:m}=p;jT({provisionalPositioning:e,tournamentRecord:r,drawDefinition:o,seedingProfile:s,participantId:h,seedBlockInfo:d,structureId:l,seedNumber:f,seedValue:m,event:u})})}function yxe(t){let e=t.seedsCount,{provisionalPositioning:i,enteredParticipantIds:n,seedAssignmentProfile:r,assignSeedsCount:a,tournamentRecord:o,drawDefinition:s,seedByRanking:l,seedingProfile:c,structureId:u,event:d}=t,{categoryName:p,ageCategoryCode:h}=(d==null?void 0:d.category)||{},f=d==null?void 0:d.eventType,m=bxe({...t,ageCategoryCode:h,categoryName:p,eventType:f})||l&&Ixe({...t,ageCategoryCode:h,categoryName:p,eventType:f}),g=(m==null?void 0:m.length)??0;g<e&&(e=g),m==null||m.filter(({participantId:v})=>n.includes(v)).slice(0,a||e).forEach((v,y)=>{let b=y+1,{participantId:I,scaleValue:T}=v,w=(r==null?void 0:r[b])||T||b;jT({provisionalPositioning:i,tournamentRecord:o,drawDefinition:s,seedingProfile:c,participantId:I,structureId:u,seedNumber:b,seedValue:w,event:d})})}function bxe(t){let{tournamentRecord:e,seedingScaleName:i,stageSequence:n,entries:r,stage:a,event:o}=t,{categoryName:s,ageCategoryCode:l}=(o==null?void 0:o.category)||{},c=o==null?void 0:o.eventType,u={scaleName:i||s||l||o.eventId,scaleType:Qp,eventType:c};return ZI({scaleAttributes:u,tournamentRecord:e,stageSequence:n,entries:r,stage:a}).scaledEntries}function Ixe(t){let{tournamentRecord:e,stageSequence:i,event:n,entries:r,stage:a}=t,{categoryName:o,ageCategoryCode:s}=(n==null?void 0:n.category)||{},l=n==null?void 0:n.eventType;return ZI({scaleAttributes:{scaleName:o||s,scaleType:Hm,eventType:l},tournamentRecord:e,stageSequence:i,entries:r,stage:a}).scaledEntries}function wxe(t){let{seedsCount:e}=t;t.seededParticipants&&(e=t.seededParticipants.length),e>t.drawSize&&(e=t.drawSize);let i=fxe(t);e>i.length&&(e=i.length);let{seedLimit:n}=hxe({enforcePolicyLimits:t.enforcePolicyLimits??!0,appliedPolicies:t.appliedPolicies,participantsCount:i.length,seedingProfile:t.seedingProfile,drawDefinition:t.drawDefinition,structureId:t.structureId,seedsCount:e});return n&&n<e&&(e=n),{seedsCount:e,stageEntries:i,seedLimit:n}}function Sxe(t){var I;let e=o3({...t,modifyOriginal:!1});if(e.error)return e;let i=e.drawDefinition,{suppressDuplicateEntries:n=!0,ignoreStageSpace:r,appliedPolicies:a,qualifyingOnly:o,seedingProfile:s,participants:l,drawEntries:c,placeByes:u,drawSize:d,drawType:p,entries:h}=t,f=[],m=[],g=Txe({suppressDuplicateEntries:n,ignoreStageSpace:r,drawDefinition:i,drawEntries:c,drawType:p,entries:h});if(g.error)return g;let v=p===yy?0:ri(t.seedsCount??0),y=Ece({...t,qualifyingOnly:!d||o,appliedPolicies:a,drawDefinition:i,seedingProfile:s,participants:l,stage:xt,seedsCount:v,placeByes:u,drawSize:d,entries:h});if(y.error&&!y.conflicts)return y;(I=y.positioningReport)!=null&&I.length&&f.push({[xt]:y.positioningReport});let b=y.structureId;return y.conflicts&&(m=y.conflicts),p===Fc&&t.roundsCount&&dxe({...t,drawDefinition:i,structureId:b}),{drawDefinition:i,positioningReports:f,conflicts:m,structureId:b}}function Txe(t){let{ignoreStageSpace:e,drawDefinition:i,drawEntries:n,drawType:r,entries:a}=t;for(let o of a){if(n&&o.entryStage&&o.entryStage!==xt)continue;let s={...o,ignoreStageSpace:e??r===Fc,entryStage:o.entryStage??xt,event:t.event,drawDefinition:i,drawType:r},l=aoe(s);if(n&&l.error)return l}return{error:void 0}}var Uxe=()=>({matchUpType:void 0,drawName:void 0,drawId:void 0,structures:[],entries:[],links:[]}),Dxe=Uxe;function Exe(t){let{drawId:e=Pn(),processCodes:i,matchUpType:n,drawType:r}=t??{},a=Dxe();return Object.assign(a,{processCodes:i,matchUpType:n,drawType:r,drawId:e})}function I3(t){let e=t.structureIds,{tournamentRecord:i,drawDefinition:n,matchUpFormat:r,structureId:a,matchUpId:o,event:s}=t,l=di(t,[{[_s]:!0,[fz]:!0}]);if(l.error)return l;if(!Nl({matchUpFormat:r}))return{error:nC};let c="setMatchUpFormat";if(o){let u=nr({drawDefinition:n,matchUpId:o,event:s});if(u.error)return u;let d=u.matchUp;if((d==null?void 0:d.matchUpType)===ga)return{info:"Cannot set matchUpFormat when { matchUpType: TEAM }",error:al};d&&(d.matchUpFormat=r,en({tournamentId:i==null?void 0:i.tournamentId,eventId:s==null?void 0:s.eventId,context:c,drawDefinition:n,matchUp:d}))}else if(Array.isArray(e)){if((s==null?void 0:s.eventType)===ga)return{error:ph};for(let u of e){let d=ui({drawDefinition:n,structureId:u});if(d.error)return d;d.structure&&(d.structure.matchUpFormat=r)}}else if(a){if((s==null?void 0:s.eventType)===ga)return{error:ph};let u=ui({drawDefinition:n,structureId:a});if(u.error)return u;u.structure&&(u.structure.matchUpFormat=r)}else n&&(n.matchUpFormat=r);return e=e??(a?[a]:void 0),qn({drawDefinition:n,structureIds:e}),{...ce}}function Cxe({tieFormat:t}){let e=ll({checkCollectionIds:!1,tieFormat:t});if(e.error)return e;for(let i of t.collectionDefinitions)i.collectionId||(i.collectionId=Pn());return{tieFormat:t}}function Pxe({tournamentRecord:t,drawDefinition:e,matchUpFormat:i,matchUpType:n,tieFormat:r,event:a}){if((i||r)&&!(i&&(a==null?void 0:a.matchUpFormat)===i||a!=null&&a.tieFormat&&r&&JSON.stringify(a.tieFormat)===JSON.stringify(r))){if(r){let o=Cxe({tieFormat:r});if(o.error)return o;e.tieFormat=o.tieFormat??r}else if(i){let o=I3({tournamentRecord:t,drawDefinition:e,matchUpFormat:i,event:a});if(o.error)return{info:"matchUpFormat or tieFormat error",error:o.error}}n&&(e.matchUpType=n)}return{error:void 0}}var w3={};$i(w3,{attachPolicies:()=>Kv,findPolicy:()=>Ty,getAppliedPolicies:()=>dn,getPolicyDefinitions:()=>em,mutate:()=>Cce,query:()=>Rce,removePolicy:()=>Pce});var Cce={};$i(Cce,{attachPolicies:()=>Kv,removePolicy:()=>Pce});function Pce(t){let e=di(t,[{[fRe]:!0,_anyOf:{[zo]:!1,[ls]:!1,[_s]:!1,[by]:!1}}]);if(e.error)return e;let i,n=t.drawDefinition??t.event??((t.tournamentId||!t.tournamentRecords)&&t.tournamentRecord);if(n)return bY(t,n);if(t.tournamentRecords){let r=Object.keys(t.tournamentRecords);if(!r.length)return{error:ut};for(let a of r){let o=t.tournamentRecords[a],s=bY(t,o);if(s.error)return s;i=!0}}else return{error:ut};return i?{...ce}:{error:wb}}function bY(t,e){let i=dn(t).appliedPolicies??{};return i[t.policyType]?(delete i[t.policyType],Object.keys(i).length?cn({element:e,extension:{name:_D,value:i}}):Is({element:e,name:_D}),{...ce}):{error:wb}}var Rce={};$i(Rce,{findPolicy:()=>Ty,getAppliedPolicies:()=>dn,getPolicyDefinitions:()=>em});var Mce={[uu]:{validSeedPositions:{ignore:!0},duplicateSeedNumbers:!0,drawSizeProgression:!0,seedingProfile:{drawTypes:{[mh]:{positioning:Lv},[Cu]:{positioning:Lv}},positioning:rRe},policyName:"USTA SEEDING",seedsCountThresholds:[{drawSize:4,minimumParticipantCount:3,seedsCount:2},{drawSize:16,minimumParticipantCount:12,seedsCount:4},{drawSize:32,minimumParticipantCount:24,seedsCount:8},{drawSize:64,minimumParticipantCount:48,seedsCount:16},{drawSize:128,minimumParticipantCount:96,seedsCount:32},{drawSize:256,minimumParticipantCount:192,seedsCount:64}]}},yV=Mce;function Rxe({appliedPolicies:t,policyDefinitions:e,drawDefinition:i,stack:n}){if(e&&typeof e!="object")return pe({info:"policyDefinitions must be an object",result:{error:Re},stack:n});let r={[AD]:t==null?void 0:t[AD]};return e?Mxe({policyDefinitions:e,appliedPolicies:t,policiesToAttach:r,drawDefinition:i}):r.avoidance&&Kv({drawDefinition:i,policyDefinitions:r}),!(t!=null&&t[uu])&&!(e!=null&&e[uu])&&(Kv({policyDefinitions:yV,drawDefinition:i}),t&&Object.assign(t,yV)),{error:void 0}}function Mxe({policyDefinitions:t,appliedPolicies:e,policiesToAttach:i,drawDefinition:n}){for(let r of Object.keys(t))JSON.stringify(e==null?void 0:e[r])!==JSON.stringify(t[r])&&(i[r]=t[r]);Object.keys(i).length&&(Kv({policyDefinitions:i,drawDefinition:n}),e&&Object.assign(e,i))}function Nxe(t){var v,y,b,I,T;let{tournamentRecord:e,matchUpFormat:i,appliedPolicies:n,policyDefinitions:r,matchUpType:a,tieFormat:o,drawType:s,stack:l,event:c}=t,u=t.drawId?(v=c==null?void 0:c.drawDefinitions)==null?void 0:v.find(w=>w.drawId===t.drawId):void 0;u&&s!==u.drawType&&(u.drawType=s);let d=u??Exe({processCodes:t.processCodes,drawId:t.drawId,drawType:s}),p=Pxe({tournamentRecord:e,drawDefinition:d,matchUpFormat:i,matchUpType:a,tieFormat:o,event:c});if(p.error)return pe({result:p,stack:l});let h=Rxe({appliedPolicies:n,policyDefinitions:r,drawDefinition:d,stack:l});if(h.error)return h;let f=(b=(y=u==null?void 0:u.structures)==null?void 0:y.find(w=>w.stage===xt&&w.stageSequence===1))==null?void 0:b.structureId,m=u?(I=u.structures)==null?void 0:I.filter(w=>w.stage===Zt):[],g=(m==null?void 0:m.length)===1&&!((T=m[0].matchUps)!=null&&T.length)&&m[0].structureId;return{drawDefinition:d,structureId:f,existingDrawDefinition:u,existingQualifyingPlaceholderStructureId:g}}function Axe(t){var u,d;let e="generateOrGetExisting",i=[],n=[],r=Nxe(t);if(r.error)return pe({result:r,stack:e});let a=r.existingDrawDefinition,o=r.drawDefinition??{},s=r.structureId,l=t.drawEntries??t.eventEntries??[],c=r.existingQualifyingPlaceholderStructureId&&axe({...t,...r})||Sxe({...t,...r,entries:l});return c.error?pe({result:c,stack:e}):((u=c.positioningReports)!=null&&u.length&&i.push(...c.positioningReports??[]),(d=c.conflicts)!=null&&d.length&&n.push(...c.conflicts??[]),o=c.drawDefinition,s=c.structureId,{existingDrawDefinition:a,positioningReports:i,drawDefinition:o,structureId:s,conflicts:n,entries:l})}function _xe(t){var m,g,v;let{qualifyingPlaceholder:e,qualifyingProfiles:i,existingDrawDefinition:n,positioningReports:r,appliedPolicies:a,qualifyingOnly:o,drawDefinition:s,seedingProfile:l,participants:c,structureId:u,entries:d,stack:p}=t,h=e&&!(i!=null&&i.length)&&!n,f=[];if(i){let y=(w,S)=>w.stageSequence-S.stageSequence,b=(w,S)=>w.roundTarget-S.roundTarget,I=[],T=1;i.sort(b);for(let w of i){if(!Array.isArray(w.structureProfiles))return pe({info:Zm("structureProfiles"),result:{error:Yt},stack:p});T=w.roundTarget||T;let S=((m=w.structureProfiles)==null?void 0:m.sort(y))||[],D=1;for(let E of S){let{qualifyingRoundNumber:C,qualifyingPositions:P,seededParticipants:R,seedingScaleName:N,seedsCount:M=0,seedByRanking:A,placeByes:_,drawSize:x}=E,O=Ece({...t,seedingProfile:E.seedingProfile??l,stageSequence:D,qualifyingRoundNumber:C,preparedStructureIds:I,qualifyingPositions:P,seededParticipants:R,stage:Zt,seedingScaleName:N,appliedPolicies:a,drawDefinition:s,qualifyingOnly:o,seedByRanking:A,participants:c,roundTarget:T,seedsCount:M,placeByes:_,drawSize:x,entries:d});if(O.error)return O;O.structureId&&I.push(O.structureId),D+=1,(g=O.conflicts)!=null&&g.length&&f.push(...O.conflicts),(v=O.positioningReport)!=null&&v.length&&r.push({[Zt]:O.positioningReport})}T+=1}}else if(u&&h){let y=Uc({structureName:Eo(Zt),stage:Zt}),{link:b}=jC({sourceStructureId:y.structureId,targetStructureId:u,sourceRoundNumber:0,linkType:Uf});s.structures||(s.structures=[]),s.structures.push(y),s.links||(s.links=[]),s.links.push(b)}return{qualifyingConflicts:f,error:void 0}}var iP={};$i(iP,{addGoesTo:()=>Wv,allCompetitionMatchUps:()=>wd,allDrawMatchUps:()=>ws,allEventMatchUps:()=>xh,allPlayoffPositionsFilled:()=>Mq,allTournamentMatchUps:()=>oo,analyzeDraws:()=>JC,analyzeMatchUp:()=>WD,analyzeTournament:()=>M3,bulkUpdatePublishedEventIds:()=>_3,calculateWinCriteria:()=>JI,categoryCanContain:()=>WC,checkMatchUpIsComplete:()=>Rv,checkValidEntries:()=>zx,compareTieFormats:()=>Af,competitionScheduleMatchUps:()=>sP,courtGridRows:()=>lO,credits:()=>kxe,drawMatchUps:()=>q3,eventMatchUps:()=>dO,filterMatchUps:()=>sf,filterParticipants:()=>xC,findDrawDefinition:()=>e3,findExtension:()=>Ri,findVenue:()=>kh,getAllDrawMatchUps:()=>Ia,getAllEventData:()=>k3,getAllStructureMatchUps:()=>wn,getAllowedDrawTypes:()=>eO,getAllowedMatchUpFormats:()=>C3,getAppliedPolicies:()=>dn,getAssignedParticipantIds:()=>Ey,getAvailableMatchUpsCount:()=>Gx,getAvailablePlayoffProfiles:()=>GC,getCategoryAgeDetails:()=>eI,getCheckedInParticipantIds:()=>VI,getCompetitionDateRange:()=>iO,getCompetitionMatchUps:()=>qD,getCompetitionParticipants:()=>S3,getCompetitionPenalties:()=>P3,getCompetitionVenues:()=>nP,getCourtInfo:()=>wx,getCourts:()=>W3,getDrawData:()=>nO,getDrawDefinitionTimeItem:()=>Qz,getDrawParticipantRepresentativeIds:()=>Jq,getDrawStructures:()=>Ru,getDrawTypeCoercion:()=>QC,getEligibleVoluntaryConsolationParticipants:()=>Xq,getEntriesAndSeedsCount:()=>cO,getEvent:()=>Z3,getEventData:()=>rO,getEventMatchUpFormatTiming:()=>F3,getEventProperties:()=>K3,getEventPublishStatus:()=>Yc,getEventStructures:()=>Ax,getEventTimeItem:()=>vC,getEvents:()=>Y3,getFlightProfile:()=>Zr,getHomeParticipantId:()=>Sx,getLinkedTournamentIds:()=>fC,getMatchUpCompetitiveProfile:()=>EC,getMatchUpContextIds:()=>j3,getMatchUpDailyLimits:()=>hO,getMatchUpDailyLimitsUpdate:()=>B3,getMatchUpDependencies:()=>Vu,getMatchUpFormat:()=>G3,getMatchUpFormatTiming:()=>CC,getMatchUpFormatTimingUpdate:()=>L3,getMatchUpScheduleDetails:()=>Tx,getMatchUpType:()=>Dx,getMatchUpsMap:()=>Ao,getMatchUpsStats:()=>H3,getMaxEntryPosition:()=>O3,getModifiedMatchUpFormatTiming:()=>uO,getPairedParticipant:()=>Mu,getParticipantEventDetails:()=>T3,getParticipantIdFinishingPositions:()=>Qq,getParticipantMembership:()=>U3,getParticipantResults:()=>qC,getParticipantScaleItem:()=>gS,getParticipantSchedules:()=>D3,getParticipantSignInStatus:()=>E3,getParticipantTimeItem:()=>eq,getParticipants:()=>Nr,getPersonRequests:()=>Ry,getPolicyDefinitions:()=>em,getPositionAssignments:()=>GD,getPositionsPlayedOff:()=>GT,getPredictiveAccuracy:()=>V3,getProfileRounds:()=>sO,getPublishState:()=>HI,getRoundMatchUps:()=>Us,getRounds:()=>z3,getScaleValues:()=>RT,getScaledEntries:()=>ZI,getScheduledRoundsDetails:()=>rP,getSchedulingProfile:()=>rm,getSchedulingProfileIssues:()=>x3,getSeedingThresholds:()=>Uq,getSeedsCount:()=>eP,getStructureSeedAssignments:()=>Vc,getTeamLineUp:()=>qv,getTieFormat:()=>A3,getTimeItem:()=>Wc,getTournamentIds:()=>pC,getTournamentInfo:()=>XI,getTournamentPenalties:()=>tO,getTournamentPersons:()=>R3,getTournamentPublishStatus:()=>kC,getTournamentStructures:()=>Rq,getTournamentTimeItem:()=>vx,getValidGroupSizes:()=>FC,getVenueData:()=>hS,getVenuesAndCourts:()=>nm,isAdHoc:()=>sl,isCompletedStructure:()=>Xm,isValidForQualifying:()=>r3,isValidMatchUpFormat:()=>Nl,matchUpActions:()=>Hx,participantScaleItem:()=>th,participantScheduledMatchUps:()=>$3,positionActions:()=>n3,publicFindCourt:()=>cq,publicFindVenue:()=>lq,tallyParticipantResults:()=>HT,tieFormatGenderValidityCheck:()=>Fx,tournamentMatchUps:()=>pO,validMatchUp:()=>Ux,validMatchUps:()=>Kc,validateCollectionDefinition:()=>KC,validateLineUp:()=>Nx});function kxe(){return`
    This project would not have been possible without the generous input and patience
    of tournament organizers and directors who worked with early versions of CourtHive/TMX.

    Thanks to Pavel, Ivan, Mladen, Zdenko, Antonia, Jakov, Kreso, Barry, Jeff, Bobby... to name just a few. 

    The project would not have even begun without the support of Miro, or the introduction by Sretchko.
    The project would not have succeeded without the enthusiasm of Randy and Bruce.
    Thanks to serendipity and Luca and the ensuing TODS conversations with ITF.
    Thanks to Scott and Jake for sanity checks, suggestions, and camaraderie.
    Thanks to Zoran for inspiring the async support and getting into the weeds with subscriptions.
    Thanks to Dave for backing the conversion of TMX 1.x source into the factory repository.
    Thanks to Vuk and Pavle and Rich and Chris and Deepa for the direct engagement with the APIs.
    Thanks to Joe for repeatedly challenging me and the many pointers to useful tooling.
    Thanks to Shannon for the validation of the approach from his deep domain experience.
    Thanks to Nikola for the ongoing camaraderie and explorations of what we can do with TODS.

    And a special thanks to my family for putting up with the long days and weeks and months of coding
    and conversations at all hours.
  `}var Nce={};$i(Nce,{filterParticipants:()=>xC,getCompetitionParticipants:()=>S3,getPairedParticipant:()=>Mu,getParticipantEventDetails:()=>T3,getParticipantMembership:()=>U3,getParticipantScaleItem:()=>gS,getParticipantSchedules:()=>D3,getParticipantSignInStatus:()=>E3,getParticipantTimeItem:()=>eq,getParticipants:()=>Nr,getScaleValues:()=>RT,participantScaleItem:()=>th,validateLineUp:()=>Nx});function S3(t){let{tournamentRecords:e}=t||{};if(typeof e!="object"||!Object.keys(e).length)return{error:Sr};let i=[],n={},r={},a={},o=[],s={},l=[];for(let c of Object.values(e)){let{participantIdsWithConflicts:u,mappedMatchUps:d,participantMap:p,participants:h,matchUps:f,derivedEventInfo:m,derivedDrawInfo:g}=Nr({...t,tournamentRecord:c});Object.assign(s,d),Object.assign(n,p),Object.assign(r,m),Object.assign(a,g),i.push(...h??[]),o.push(...f??[]),u==null||u.forEach(v=>{l.includes(v)||l.push(v)})}return{participantIdsWithConflicts:l,derivedEventInfo:r,derivedDrawInfo:a,participantMap:n,mappedMatchUps:s,participants:i,...ce,matchUps:o}}function T3({tournamentRecord:t,participantId:e}){if(!t)return{error:ut};if(!e)return{error:ya};let i=[e].concat((t.participants??[]).filter(n=>{var r;return(n==null?void 0:n.participantType)&&[On,Ti].includes(n.participantType)&&((r=n.individualParticipantIds)==null?void 0:r.includes(e))}).map(n=>n.participantId));return{eventDetails:(t.events??[]).filter(n=>{let r=((n==null?void 0:n.entries)??[]).map(a=>a.participantId);return Ts(r,i)}).map(n=>({eventName:n.eventName,eventId:n.eventId}))}}function U3({tournamentRecord:t,participantId:e}){if(!t)return{error:ut};if(!e)return{error:ya};let{participants:i}=Nr({participantFilters:{participantTypes:[On,Ti,ac]},tournamentRecord:t});return(i??[]).filter(n=>{var r;return(r=n.individualParticipantIds)==null?void 0:r.includes(e)}).reduce((n,r)=>{let a=r.participantType;return a&&(n[a]||(n[a]=[]),n[a].push(r)),n},{})}function D3({participantFilters:t={},tournamentRecord:e}){if(!e)return{error:ut};if(typeof t!="object")return{error:Jf,context:{participantFilters:t}};let i={eventIds:t.eventIds},n=oo({tournamentRecord:e,contextFilters:i}).matchUps??[],r=Object.assign({},...n.map(l=>({[l.matchUpId]:l}))),a=n.filter(({schedule:l})=>l&&Object.keys(l).length),o=Vu({tournamentRecord:e,matchUps:n}).sourceMatchUpIds??[],s={};for(let l of a){let{sides:c}=l,u,d=(c==null?void 0:c.map(h=>{if(h.participant)return[h.participant].concat(...h.participant.individualParticipants||[]);o[l.matchUpId]&&!u&&(u=(o[l.matchUpId]||[]).map(f=>r[f]).filter(({winningSide:f,bye:m})=>!f&&!m))}).filter(Boolean).flat())??[];for(let h of d){let{participantId:f}=h;s[f]||(s[f]={potentialMatchUps:[],participant:h,matchUps:[]}),s[f].matchUps.push(l)}let p=(u==null?void 0:u.map(({sides:h})=>h).flat().map(({participant:h})=>h&&[h].concat(...h.individualParticipants||[])).filter(Boolean).flat())||[];for(let h of p){let{participantId:f}=h;s[f]||(s[f]={potentialMatchUps:[],participant:h,matchUps:[]}),s[f].potentialMatchUps.push(l)}}return{participantSchedules:Object.values(s).filter(({participant:l})=>!(t.participantIds&&!t.participantIds.includes(l.participantId)||t.participantTypes&&!t.participantTypes.includes(l.participantType))),...ce}}function E3({tournamentRecord:t,participantId:e}){if(!t)return{error:ut};if(!e)return{error:ya};let{participant:i}=Eg({tournamentRecord:t,participantId:e});if(!i)return{error:Vr};let{timeItem:n}=Wc({itemType:gC,element:i});return n&&n.itemValue===OD&&OD}var Ace={};$i(Ace,{analyzeDraws:()=>JC,analyzeTournament:()=>M3,getAllowedDrawTypes:()=>eO,getAllowedMatchUpFormats:()=>C3,getAppliedPolicies:()=>dn,getCompetitionDateRange:()=>iO,getCompetitionPenalties:()=>P3,getPolicyDefinitions:()=>em,getTournamentInfo:()=>XI,getTournamentPenalties:()=>tO,getTournamentPersons:()=>R3,getTournamentStructures:()=>Rq,getTournamentTimeItem:()=>vx});function C3({tournamentRecord:t,categoryName:e,categoryType:i}){var r;if(!t)return{error:ut};let{appliedPolicies:n}=dn({tournamentRecord:t});return(((r=n==null?void 0:n[Bc])==null?void 0:r.matchUpFormats)||[]).filter(({categoryNames:a,categoryTypes:o})=>!e&&!o||e&&(a==null?void 0:a.includes(e))||i&&(o==null?void 0:o.includes(i)))}function eO({tournamentRecord:t,categoryName:e,categoryType:i}){var r;if(!t)return{error:ut};let{appliedPolicies:n}=dn({tournamentRecord:t});return(((r=n==null?void 0:n[wA])==null?void 0:r.allowedDrawTypes)||[]).filter(({categoryNames:a,categoryTypes:o})=>!e&&!o||e&&(a==null?void 0:a.includes(e))||i&&(o==null?void 0:o.includes(i)))}function tO({tournamentRecord:t}){if(!t)return{error:ut};let e=((t==null?void 0:t.participants)??[]).reduce((i,n)=>{let{participantId:r}=n;return(n.penalties??[]).forEach(a=>{let{penaltyId:o}=a||{};i[o]?i[o].participants.push(r):i[o]={...a,participantIds:[r]}}),i},{});return{penalties:Object.values(e)}}function P3({tournamentRecords:t}){if(typeof t!="object"||!Object.keys(t).length)return{error:Sr};let e=[];for(let i of Object.values(t)){let{penalties:n}=tO({tournamentRecord:i});e.push(...n??[])}return{penalties:e}}function _ce({event:t}){return{eventInfo:(({eventId:e,eventName:i,eventType:n,eventLevel:r,surfaceCategory:a,matchUpFormat:o,category:s,gender:l,startDate:c,endDate:u,ballType:d,discipline:p,onlineResources:h,notes:f})=>({eventId:e,eventName:i,eventType:n,eventLevel:r,surfaceCategory:a,matchUpFormat:o,category:s,gender:l,startDate:c,endDate:u,ballType:d,discipline:p,onlineResources:h,notes:f}))(t)}}var xxe={[NT]:{policyName:"Staff Privacy Policy",participant:{contacts:!1,individualParticipants:!1,individualParticipantIds:!1,onlineResources:!1,participantName:!0,participantOtherName:!0,participantId:!0,participantRole:!0,participantRoleResponsibilities:!0,participantStatus:!0,penalties:!1,representing:!0,participantType:!0,person:{addresses:!1,biographicalInformation:!1,birthDate:!1,contacts:!1,nationalityCode:!0,nativeFamilyName:!1,nativeGivenName:!1,onlineResources:!1,otherNames:!0,parentOrganisationId:!1,passportFamilyName:!1,passportGivenName:!1,personId:!1,personOtherIds:!1,previousNames:!1,sex:!1,standardFamilyName:!0,standardGivenName:!0,status:!1,tennisId:!1,wheelchair:!0}}}},Oxe=xxe;function XI(t){var s,l,c,u;let{tournamentRecord:e}=t??{};if(!e)return{error:ut};let i=(({tournamentId:d,tournamentRank:p,tournamentStatus:h,formalName:f,tournamentName:m,promotionalName:g,onlineResources:v,localTimeZone:y,activeDates:b,startDate:I,endDate:T,hostCountryCode:w,venues:S,notes:D,updatedAt:E})=>({tournamentId:d,tournamentRank:p,tournamentStatus:h,formalName:f,tournamentName:m,promotionalName:g,onlineResources:v,localTimeZone:y,activeDates:b,startDate:I,endDate:T,hostCountryCode:w,venues:S,notes:D,updatedAt:E}))(e),n=((s=Nr({participantFilters:{participantRoles:[soe,vq,loe,coe,doe]},policyDefinitions:Oxe,tournamentRecord:e}))==null?void 0:s.participants)??[];n&&(i.tournamentContacts=n);let r=(l=HI({tournamentRecord:e}))==null?void 0:l.publishState,a=((u=(c=r==null?void 0:r.tournament)==null?void 0:c.status)==null?void 0:u.publishedEventIds)||[],o=[];for(let d of e.events??[])if(!(t!=null&&t.usePublishState)||a.includes(d.eventId)){let p=_ce({event:d}).eventInfo;p&&o.push(p)}return i.timeItemValues=Ise({element:e}),i.publishState=r==null?void 0:r.tournament,i.eventInfo=o,{tournamentInfo:Ot(zt(i),!1,!0),...ce}}function iO({tournamentRecords:t}){if(!Xi(t))return{error:Sr};let e=Object.keys(t??{}).reduce((r,a)=>{let o=t[a],{tournamentInfo:{startDate:s,endDate:l}}=XI({tournamentRecord:o}),c=s&&new Date(Ei(s));(!r.startDate||c&&c<r.startDate)&&(r.startDate=c);let u=l&&new Date(Ei(l));return(!r.endDate||u&&u>r.endDate)&&(r.endDate=u),r},{startDate:void 0,endDate:void 0}),i=e.startDate&&Ei(e.startDate.toISOString()),n=e.endDate&&Ei(e.endDate.toISOString());return!i||!n?{error:Une}:{startDate:i,endDate:n}}function R3({tournamentRecord:t,participantFilters:e}){if(!t)return{error:ut};let i=t.participants||[];e&&(i=xC({participants:i,participantFilters:e,tournamentRecord:t}));let n={},r=a=>{if(a.person){let{personId:o}=a.person;n[o]?n[o].participantIds.push(a.participantId):n[o]={...a.person,participantIds:[a.participantId]}}};return i.forEach(a=>{a.person&&r(a)}),{tournamentPersons:Object.values(n)}}function Lxe(t){var a,o,s,l,c,u,d;let e=((o=(a=t.participants)==null?void 0:a.filter(({participantType:p})=>p===On))==null?void 0:o.length)===2,i=((s=t.events)==null?void 0:s.length)===1&&t.events[0],n=((l=i==null?void 0:i.drawDefinitions)==null?void 0:l.length)===1&&i.drawDefinitions[0],r=((d=(u=((c=n==null?void 0:n.structures)==null?void 0:c.length)===1&&n.structures[0])==null?void 0:u.positionAssignments)==null?void 0:d.length)===2;return!!(i.tieFormat&&e&&r)}function M3({tournamentRecord:t}){var r;if(!t)return{error:ut};let{drawsAnalysis:e}=JC({tournamentRecord:t}),i={isDual:Lxe(t),drawsAnalysis:e},n=Nr({tournamentRecord:t});return(r=n.missingParticipantIds)!=null&&r.length&&(i.missingParticipantIds=n.missingParticipantIds),{...ce,analysis:i}}var kce={};$i(kce,{compareTieFormats:()=>Af,getTieFormat:()=>A3,tieFormatGenderValidityCheck:()=>Fx,validateCollectionDefinition:()=>KC});function VA(t){var r;if(!t)return{};let e=[],i=t.tieFormatName,n=(r=t.collectionDefinitions)==null?void 0:r.map(a=>{let{matchUpType:o,matchUpFormat:s,matchUpCount:l,category:c,gender:u}=a;e.includes(s)||e.push(s);let d=c==null?void 0:c.ageCategoryCode;return[l,o===jv?"D":"S",d,s,u].join(";")}).join("|");return{tieFormatName:t&&i||"UNNAMED",matchUpFormats:e,tieFormatDesc:n}}function Af({considerations:t={},descendant:e,ancestor:i}){var T,w;let n={},r={},{matchUpFormats:a,tieFormatDesc:o}=VA(e),{matchUpFormats:s,tieFormatDesc:l}=VA(i),c=Pi((a??[]).filter(S=>!(s??[]).includes(S)).concat((s??[]).filter(S=>!(a??[]).includes(S)))),u=!!(t!=null&&t.collectionName&&e.collectionDefinitions.map(({collectionName:S})=>S).join("|")!==i.collectionDefinitions.map(({collectionName:S})=>S).join("|")),d=!!(t!=null&&t.collectionOrder&&e.collectionDefinitions.map(({collectionOrder:S})=>S).join("|")!==i.collectionDefinitions.map(({collectionOrder:S})=>S).join("|")),p=Object.assign({},...((e==null?void 0:e.collectionDefinitions)||[]).map(S=>({[S.collectionId]:S}))),h=Object.assign({},...((i==null?void 0:i.collectionDefinitions)||[]).map(S=>({[S.collectionId]:S})));n.collectionIds=FK(Object.keys(p),Object.keys(h)),r.collectionIds=FK(Object.keys(h),Object.keys(p)),n.collectionsValue=IY(p),r.collectionsValue=IY(h),n.groupsCount=((T=i==null?void 0:i.collectionGroups)==null?void 0:T.length)??(0-(((w=e==null?void 0:e.collectionGroups)==null?void 0:w.length)??0)||0),r.groupsCount=n.groupsCount?-1*n.groupsCount:0;let f=n.collectionsValue.totalValue-r.collectionsValue.totalValue,m=n.collectionsValue.totalMatchUps-r.collectionsValue.totalMatchUps,g=r.collectionsValue.assignmentValues.length!==n.collectionsValue.assignmentValues.length,v=r.collectionsValue.assignmentValues.some((S,D)=>{let E=n.collectionsValue.assignmentValues[D];return!E||S.valueKey!==E.valueKey||S.value!==E.value?!0:Array.isArray(S.value)?S.value.every((C,P)=>E.value[P]===C):!1}),y=u||d||l!==o||g||v||f!==0,b=[...r.collectionsValue.invalidValues,...n.collectionsValue.invalidValues],I=b.length&&b;return{matchUpFormatDifferences:c,matchUpCountDifference:m,descendantDifferences:n,ancestorDifferences:r,orderDifference:d,valueDifference:f,nameDifference:u,descendantDesc:o,ancestorDesc:l,...ce,different:y,invalid:I}}function IY(t){let e=[],i=[],n=0;return{totalValue:Object.keys(t).sort(Px).reduce((r,a)=>{let o=t[a],{collectionValueProfiles:s,collectionValue:l,matchUpCount:c,matchUpValue:u,scoreValue:d,setValue:p}=o,h={collectionValueProfiles:s,collectionValue:l,matchUpValue:u,scoreValue:d,setValue:p},f=Object.keys(h).filter(g=>![void 0,null].includes(h[g])&&(!Array.isArray(h[g])||h[g].length>0));f.length!==1&&e.push({collectionId:a});let m=f[0];if(m){let g=m==="collectionValueProfiles"?Object.values(s):h[m];i.push({valueKey:m,value:g})}return n+=c,s!=null&&s.length?r+s.reduce((g,v)=>g+v.value,0):c?yi(u)?r+u*c:yi(d)?r+d*c:yi(p)?r+p*c:r+l:r},0),totalMatchUps:n,invalidValues:e,assignmentValues:i}}function N3(t){Object.assign(t,{inContext:!0});let{matchUp:e,error:i}=xce(t);return{matchUp:Ot(e,!0,!0),error:i}}function xce({participantsProfile:t,afterRecoveryTimes:e,tournamentRecord:i,contextContent:n,contextProfile:r,drawDefinition:a,nextMatchUps:o,matchUpId:s,inContext:l,eventId:c,drawId:u,event:d}){var f;if(!i)return{error:ut};if(typeof s!="string")return{error:ss};if(!a||!d){let m=(oo({tournamentRecord:i,nextMatchUps:o}).matchUps??[]).find(g=>g.matchUpId===s);if(!m)return{error:Ho};({eventId:c,drawId:u}=m),{event:d,drawDefinition:a}=zs({tournamentRecord:i,eventId:c,drawId:u})}if(!a)return{error:Zl};r&&!n&&(n=tm({tournamentRecord:i,contextProfile:r}));let p={surfaceCategory:(d==null?void 0:d.surfaceCategory)??i.surfaceCategory,indoorOutDoor:(d==null?void 0:d.indoorOutdoor)??i.indoorOutdoor,endDate:(d==null?void 0:d.endDate)??i.endDate,tournamentId:i.tournamentId,eventId:c??(d==null?void 0:d.eventId),drawId:u},{participants:h=[]}=BI({participantsProfile:t,tournamentRecord:i,contextProfile:r,inContext:l});if(o){let m=(ws({context:l?p:void 0,participants:h,afterRecoveryTimes:e,contextContent:n,contextProfile:r,drawDefinition:a,nextMatchUps:o,inContext:l,event:d}).matchUps??[]).find(v=>v.matchUpId===s);if(!m)return{error:Ho};let g=(f=a==null?void 0:a.structures)==null?void 0:f.find(v=>v.structureId===m.structureId);return{drawDefinition:a,structure:g,matchUp:m}}else{let{matchUp:m,structure:g}=nr({context:l?p:void 0,tournamentParticipants:h,afterRecoveryTimes:e,contextContent:n,drawDefinition:a,contextProfile:r,matchUpId:s,inContext:l,event:d});return{matchUp:m,structure:g,drawDefinition:a}}}function A3({tournamentRecord:t,drawDefinition:e,structureId:i,matchUpId:n,structure:r,eventId:a,drawId:o,event:s}){var h,f,m,g,v;if(!t)return{error:ut};if(!o&&!s&&!i&&!n)return pe({result:{error:Yt},stack:"getTieFormat"});a&&!s&&(s=(h=t.events)==null?void 0:h.find(y=>y.eventId===a));let l=N3({tournamentRecord:t,drawDefinition:e,matchUpId:n,drawId:o,event:s});if(n&&(l!=null&&l.error))return l;if(!e&&(l!=null&&l.drawDefinition)&&(e=l==null?void 0:l.drawDefinition),r=r??(l==null?void 0:l.structure),!r&&i&&!n){if(!e)return{error:Pd};let y=ui({drawDefinition:e,structureId:i});if(y.error)return y;r=y.structure}let c=((r==null?void 0:r.tieFormat)||(r==null?void 0:r.tieFormatId))&&((f=is({structure:r,drawDefinition:e,event:s}))==null?void 0:f.tieFormat),u=((e==null?void 0:e.tieFormat)||(e==null?void 0:e.tieFormatId))&&((m=is({drawDefinition:e,event:s}))==null?void 0:m.tieFormat),d=(g=is({event:s}))==null?void 0:g.tieFormat,p=(v=is({matchUp:l==null?void 0:l.matchUp,drawDefinition:e,structure:r,event:s}))==null?void 0:v.tieFormat;return{...ce,matchUp:l==null?void 0:l.matchUp,structureDefaultTieFormat:wo(c),eventDefaultTieFormat:wo(d),drawDefaultTieFormat:wo(u),tieFormat:wo(p),structure:r}}var Oce={};$i(Oce,{bulkUpdatePublishedEventIds:()=>_3,getAllEventData:()=>k3,getCourtInfo:()=>wx,getDrawData:()=>nO,getEventData:()=>rO,getEventPublishStatus:()=>Yc,getPublishState:()=>HI,getTournamentPublishStatus:()=>kC,getVenueData:()=>hS});function _3({tournamentRecord:t,outcomes:e}){var r;if(!t)return{error:ut};if(!(e!=null&&e.length))return{error:Yt,info:"Missing outcomes"};let i=e.reduce((a,o)=>{let{drawId:s,eventId:l}=o;return l&&s&&(a[l]?a[l].includes(s)||a[l].push(s):a[l]=[s]),a},{}),n=Object.keys(i);return{publishedEventIds:((r=t.events)==null?void 0:r.filter(a=>n.includes(a.eventId))).filter(a=>{let o=Yc({event:a}),{drawDetails:s,drawIds:l}=o??{},{eventId:c}=a;return i[c].filter(u=>{let d=s?Object.keys(o.drawDetails).filter(p=>mq({drawId:p,drawDetails:s})):[];return(l==null?void 0:l.includes(u))||d.includes(u)}).length}).map(a=>a.eventId),eventIdPublishedDrawIdsMap:i}}function Lce({dates:t=[],extension:e}){var n;if(!e)return!1;if(typeof e.value=="boolean"&&e.value)return!0;if(!t.length)return!1;let i=Xi(e.value)?(n=e.value)==null?void 0:n.dates:void 0;if(Array.isArray(i))return i!=null&&i.length?!!i.filter(r=>!t.length||t.includes(r)).length:!1}function Fce({convertExtensions:t,ignoreDisabled:e,venue:i,court:n}){var o;let r={...Ot(n,t,!0),venueId:i.venueId},{extension:a}=Ri({name:pd,element:n});if(e&&a){let s=Xi(a.value)?(o=a.value)==null?void 0:o.dates:void 0,l=(a==null?void 0:a.value)===!0?[]:r.dateAvailability.map(c=>{let u=c.date;if(!(!u||s.includes(u)))return c}).filter(Boolean);r.dateAvailability=l}return{inContextCourt:r}}function nm(t){let{convertExtensions:e,ignoreDisabled:i,venueIds:n=[],dates:r}=t,a=t.tournamentRecords||t.tournamentRecord&&{[t.tournamentRecord.tournamentId]:t.tournamentRecord}||{},o=[],s=[],l=[],c=[];return Object.keys(a).filter(u=>!t.tournamentId||u===t.tournamentId).forEach(u=>{let d=a[u];for(let p of d.venues??[])if(!(n.length&&!n.includes(p.venueId))){if(i){let{extension:h}=Ri({name:pd,element:p});if(h!=null&&h.value)continue}o.includes(p.venueId)||(c.push(Ot(p,e,!0)),o.push(p.venueId));for(let h of p.courts??[])if(!s.includes(h.courtId)){if(i){let{extension:m}=Ri({name:pd,element:h});if(Lce({extension:m,dates:r}))continue}let{inContextCourt:f}=Fce({convertExtensions:e,ignoreDisabled:i,venue:p,court:h});l.push(f),s.push(h.courtId)}}}),{courts:l,venues:c,...ce}}function Fxe({convertExtensions:t,tournamentRecord:e,ignoreDisabled:i,dates:n}){if(!e)return{error:Sr};let r=Ot(e.venues??[],t).filter(o=>{if(!i)return o;let{extension:s}=Ri({name:pd,element:o});return!(s!=null&&s.value)&&o}).filter(Boolean),a=r.reduce((o,s)=>{let l=((s==null?void 0:s.courts)||[]).filter(c=>{if(!i&&!(n!=null&&n.length))return c;let{extension:u}=Ri({name:pd,element:c});return Lce({extension:u,dates:n})}).filter(Boolean).map(c=>{let{inContextCourt:u}=Fce({convertExtensions:t,ignoreDisabled:i,venue:s,court:c});return u});return l.length?o.concat(l):o},[]);return{venues:r,courts:a}}function nP({tournamentRecords:t,requireCourts:e,dates:i}){return typeof t!="object"||!Object.keys(t).length?{error:Sr}:Object.keys(t).reduce((n,r)=>{let a=t[r],{venues:o}=Fxe({tournamentRecord:a,dates:i});return o==null||o.forEach(s=>{let{venueId:l,courts:c}=s;(!e||c!=null&&c.length)&&!n.venueIds.includes(l)&&(n.venues.push(s),n.venueIds.push(l))}),n},{venues:[],venueIds:[]})}function k3({tournamentRecord:t,policyDefinitions:e}){if(!t)return{error:ut};let i=t.events||[],n=(t==null?void 0:t.participants)||[],{tournamentInfo:r}=XI({tournamentRecord:t}),{venues:a}=nm({tournamentRecord:t}),o=i.map(s=>{let{eventId:l}=s,c=_ce({event:s}).eventInfo,u=yC({tournamentRecord:t,event:s}).scheduleTiming,d=(s.drawDefinitions||[]).map(h=>{let f=(({drawId:b,drawName:I,matchUpFormat:T,updatedAt:w})=>({matchUpFormat:T,updatedAt:w,drawName:I,drawId:b}))(h),{abandonedMatchUps:m,completedMatchUps:g,upcomingMatchUps:v,pendingMatchUps:y}=BT({requireParticipants:!0,tournamentParticipants:n,context:{eventId:l},policyDefinitions:e,tournamentRecord:t,inContext:!0,scheduleTiming:u,drawDefinition:h,event:s});return{drawInfo:f,matchUps:{abandonedMatchUps:m,completedMatchUps:g,upcomingMatchUps:v,pendingMatchUps:y}}}),p=Yc({event:s});return Object.assign(c,{drawsData:d,publish:p}),c});return{allEventData:{tournamentInfo:r,venuesData:a,eventsData:o}}}function Bce({publishStatus:t,drawId:e}){var i,n,r;return t!=null&&t.drawDetails?(r=(n=(i=t.drawDetails)==null?void 0:i[e])==null?void 0:n.publishingDetail)==null?void 0:r.published:t!=null&&t.drawIds?t.drawIds.includes(e):!0}var $ce="PUBLIC",Bxe="ADMIN",Vce={PUBLIC_DISPLAY:$ce,ADMIN_DISPLAY:Bxe};function nO(t){var P,R,N;let{tournamentParticipants:e=[],includePositionAssignments:i,policyDefinitions:n,tournamentRecord:r,inContext:a=!0,usePublishState:o,status:s=oc,pressureRating:l,refreshResults:c,drawDefinition:u,noDeepCopy:d,sortConfig:p,context:h,event:f}=t;if(!u)return{error:Vt};let m=(({matchUpFormat:M,updatedAt:A,drawType:_,drawName:x,drawId:O})=>({matchUpFormat:M,updatedAt:A,drawName:x,drawType:_,drawId:O}))(u);m.display=(P=Ri({element:u,name:SA}).extension)==null?void 0:P.value;let g,v,{allStructuresLinked:y,sourceStructureIds:b,hasDrawFeedProfile:I,structureGroups:T}=_x({drawDefinition:u});if(!y)return{error:pne};let w=(t==null?void 0:t.publishStatus)??Yc({event:f,status:s}),S=t.eventPublished??!!((N=(R=HI({event:f}).publishState)==null?void 0:R.status)!=null&&N.published),D=!1,E=!1,C=T.map(M=>{let A={},_=M.map(x=>{let{structure:O}=ui({drawDefinition:u,structureId:x}),{seedAssignments:B}=Vc({drawDefinition:u,structure:O});return(O==null?void 0:O.stage)===xt&&O.stageSequence===1&&(g=B),(O==null?void 0:O.stage)===Zt&&O.stageSequence===1&&(v=B),O}).sort((x,O)=>FI(x,O,p)).map(x=>{var Q,X;if(!x)return;let O=x==null?void 0:x.structureId,B=[];x.stage&&[xt,Po,Fr].includes(x.stage)&&(B=g),(x==null?void 0:x.stage)===Zt&&(B=v);let{matchUps:F,roundMatchUps:G,roundProfile:H}=wn({seedAssignments:(Q=x==null?void 0:x.seedAssignments)!=null&&Q.length?void 0:B,context:{drawId:m.drawId,...h},tournamentParticipants:e,policyDefinitions:n,tournamentRecord:r,usePublishState:o,publishStatus:w,drawDefinition:u,inContext:a,structure:x,event:f}),{positionAssignments:$}=Vn({structure:x}),q=$==null?void 0:$.filter(Ml(gh)).map(oe=>{var te,he;let re=(he=(te=Ri({element:oe,name:qm}))==null?void 0:te.extension)==null?void 0:he.value,{drawPosition:me,participantId:se}=oe;return E=!0,{participantResult:re,participantId:se,drawPosition:me}});if(F.length&&(!(q!=null&&q.length)&&t.allParticipantResults||c&&!x.structures)){let{subOrderMap:oe}=hse({positionAssignments:$}),re=HT({matchUpFormat:x.matchUpFormat,policyDefinitions:n,pressureRating:l,subOrderMap:oe,matchUps:F});q=$==null?void 0:$.filter(Ml(gh)).map(me=>{var he;let{drawPosition:se,participantId:te}=me;return E=!0,{participantResult:te&&((he=re==null?void 0:re.participantResults)==null?void 0:he[te]),participantId:te,drawPosition:se}})}let z=x?(({stageSequence:oe,structureName:re,structureType:me,matchUpFormat:se,stage:te})=>({stageSequence:oe,structureName:re,structureType:me,matchUpFormat:se,stage:te}))(x):{},Z=(X=Ri({element:x,name:SA}).extension)==null?void 0:X.value;z.display=(Z==null?void 0:Z[$ce])??Z,z.sourceStructureIds=b[O],z.hasDrawFeedProfile=I[O],z.positionAssignments=$,z.structureActive=F.reduce((oe,re)=>{var se;let me=[ua,Ea,Lu,jr,Rp,Zi,go,hn].includes(re.matchUpStatus);return oe||me||!!re.winningSide||!!((se=re.score)!=null&&se.scoreStringSide1)},!1);let Y=F.reduce((oe,re)=>oe&&[vn,jr,go,hn,Zi,ol].includes(re.matchUpStatus),!!F.length);return z.structureCompleted=Y,A[O]=Y,z.structureActive&&(D=!0),{...z,participantResults:q,seedAssignments:B,roundMatchUps:G,roundProfile:H,structureId:O}});return _.forEach(x=>{var O;i||delete x.positionAssignments,x.sourceStructuresComplete=(O=x.sourceStructureIds)==null?void 0:O.every(B=>A[B])}),_}).flat();return m.drawActive=D,m.participantPlacements=E,m.drawGenerated=C==null?void 0:C.reduce((M,A)=>M||!!(A!=null&&A.roundMatchUps),!1),m.drawCompleted=C==null?void 0:C.reduce((M,A)=>M&&A.structureCompleted,!0),m.drawPublished=o?S&&Bce({publishStatus:w,drawId:m.drawId}):void 0,{structures:!o||m.drawPublished?d?C:Ot(C,!1,!0):void 0,drawInfo:d?m:Ot(m,!1,!0),...ce}}function rO(t){var R,N,M;let{includePositionAssignments:e,participantsProfile:i,policyDefinitions:n,usePublishState:r,status:a=oc,sortConfig:o}=t,s=di(t,[{tournamentRecord:!0},{[Vre]:{event:!1,eventId:!1}}]);if(s.error)return s;let l=Ot(t.tournamentRecord,!1,!0),c=t.event?void 0:zs({tournamentRecord:l,eventId:t.eventId}).event,u=t.event?Ot(t.event,!1,!0):c&&Ot(c,!1,!0)||void 0;if(!u)return{error:Xl};let{eventId:d}=u,{tournamentId:p,endDate:h}=l,f=Yc({event:u,status:a}),m=HI({event:u}).publishState??{},g=!!((R=m==null?void 0:m.status)!=null&&R.published),{participants:v}=Nr({withGroupings:!0,withEvents:!1,withDraws:!1,policyDefinitions:n,...i,tournamentRecord:l}),y=({stage:A,drawId:_})=>{var O,B,F;if(!r)return!0;let x=(B=(O=f==null?void 0:f.drawDetails)==null?void 0:O[_])==null?void 0:B.stageDetails;return!x||!Object.keys(x).length?!0:(F=x[A])==null?void 0:F.published},b=({structureId:A,drawId:_})=>{var O,B,F;if(!r)return!0;let x=(B=(O=f==null?void 0:f.drawDetails)==null?void 0:O[_])==null?void 0:B.structureDetails;return!x||!Object.keys(x).length?!0:(F=x[A])==null?void 0:F.published},I=({drawId:A})=>r?Bce({publishStatus:f,drawId:A}):!0,T=({drawId:A,structure:_})=>{var O,B,F,G;if(!r)return _;let x=(G=(F=(B=(O=f==null?void 0:f.drawDetails)==null?void 0:O[A])==null?void 0:B.structureDetails)==null?void 0:F[_.structureId])==null?void 0:G.roundLimit;if(yi(x)){let H=Et(1,x+1),$={},q={};for(let z of H)_.roundMatchUps[z]&&($[z]=_.roundMatchUps[z],q[z]=_.roundProfile[z]);_.roundMatchUps=$,_.roundProfile=q}return _},w=u.drawDefinitions||[],S=!r||g?w.filter(I).map(A=>(({drawInfo:_,structures:x})=>({..._,structures:x}))(nO({allParticipantResults:t.allParticipantResults,context:{eventId:d,tournamentId:p,endDate:h},pressureRating:t.pressureRating,refreshResults:t.refreshResults,includePositionAssignments:e,tournamentParticipants:v,noDeepCopy:!0,policyDefinitions:n,tournamentRecord:l,usePublishState:r,drawDefinition:A,publishStatus:f,sortConfig:o,event:u}))).map(({structures:A,..._})=>{let x=A==null?void 0:A.filter(({stage:O,structureId:B})=>b({structureId:B,drawId:_.drawId})&&y({stage:O,drawId:_.drawId})).map(O=>T({drawId:_.drawId,structure:O}));return{..._,structures:x}}).filter(A=>{var _;return(_=A.structures)==null?void 0:_.length}):void 0,{tournamentInfo:D}=XI({tournamentRecord:l}),E=(l.venues||[]).map(A=>(({venueData:_})=>({..._}))(hS({tournamentRecord:l,venueId:A.venueId}))),C=(({eventId:A,eventName:_,eventType:x,eventLevel:O,surfaceCategory:B,matchUpFormat:F,category:G,gender:H,startDate:$,endDate:q,ballType:z,discipline:Z})=>({eventId:A,eventName:_,eventType:x,eventLevel:O,surfaceCategory:B,matchUpFormat:F,category:G,gender:H,startDate:$,endDate:q,ballType:z,discipline:Z}))(u);C.display=(N=Ri({element:u,name:SA}).extension)==null?void 0:N.value;let P={tournamentInfo:D,venuesData:E,eventInfo:C,drawsData:S};return P.eventInfo.publishState=m,P.eventInfo.published=(M=m==null?void 0:m.status)==null?void 0:M.published,{...ce,eventData:P,participants:v}}var jce={};$i(jce,{courtGridRows:()=>lO,findVenue:()=>kh,getPersonRequests:()=>Ry,getProfileRounds:()=>sO,getScheduledRoundsDetails:()=>rP,getSchedulingProfile:()=>rm,getSchedulingProfileIssues:()=>x3,publicFindCourt:()=>cq});function aO({defaultRecoveryMinutes:t=0,defaultAverageMinutes:e,tournamentRecords:i,matchUpFormat:n,categoryName:r,categoryType:a,tournamentId:o,eventType:s,eventId:l}){if(!Nl({matchUpFormat:n}))return{error:nC};let c=Object.keys(i).filter(d=>!o||d===o),u;return c.forEach(d=>{var f;if(u)return;let p=i[d],h=l?(f=zs({tournamentRecord:p,eventId:l}))==null?void 0:f.event:void 0;return u=CC({tournamentRecord:p,matchUpFormat:n,categoryName:r,categoryType:a,eventType:s,event:h}),(u==null?void 0:u.averageMinutes)||(u==null?void 0:u.recoveryMinutes)}),{recoveryMinutes:(u==null?void 0:u.recoveryMinutes)||t,averageMinutes:(u==null?void 0:u.averageMinutes)||e,typeChangeRecoveryMinutes:(u==null?void 0:u.typeChangeRecoveryMinutes)||(u==null?void 0:u.recoveryMinutes)||t}}function rP({scheduleCompletedMatchUps:t,containedStructureIds:e,tournamentRecords:i,periodLength:n=30,matchUps:r,rounds:a}){if(typeof i!="object")return{error:Sr};if(!Array.isArray(a))return{error:Yt,info:Zm("rounds")};let o={},s=[];a.sort((p,h)=>(p.sortOrder??0)-(h.sortOrder??0)),e=e??Object.assign({},...Object.values(i).map(p=>kT({tournamentRecord:p}).containedStructures)),r||({matchUps:r}=wd({nextMatchUps:!0,tournamentRecords:i}));let l=0,c={},u={},d={};return{scheduledRoundsDetails:a.flatMap(p=>{var T;let h=p.periodLength||n,f=[];e!=null&&e[p.structureId]?f.push(...e[p.structureId]):f.push(p.structureId);let m=r?sf({tournamentIds:[p.tournamentId],roundNumbers:[p.roundNumber],matchUpIds:p.matchUpIds,eventIds:[p.eventId],drawIds:[p.drawId],processContext:!0,structureIds:f,matchUps:r}).sort(GI):[],{segmentNumber:g,segmentsCount:v}=p.roundSegment||{};if(yi(g)&&bd(m==null?void 0:m.length)&&bd(v)&&g>0&&g<=v&&v<(m==null?void 0:m.length)&&!((T=p.matchUpIds)!=null&&T.length)){let w=m.length/v,S=w*(g-1);m=m.slice(S,S+w)}let y=i[p.tournamentId],b=zs({drawId:p.drawId,tournamentRecord:y}).event,I=[];for(let w of m){let S=w.matchUpFormat;S&&(o[S]||(o[S]=[],o[S].push(w)),I.push(S))}for(let w of I){let{eventType:S,category:D}=b??{},{categoryName:E,ageCategoryCode:C}=D??{},{typeChangeRecoveryMinutes:P,recoveryMinutes:R,averageMinutes:N,error:M}=aO({categoryName:E??C,categoryType:D==null?void 0:D.categoryType,tournamentId:p.tournamentId,eventId:p.eventId,tournamentRecords:i,matchUpFormat:w,eventType:S});if(M)return{error:M,round:p};let A=m.filter(x=>(t||!ba.includes(x.matchUpStatus))&&x.matchUpStatus!==vn).map($a);A.forEach(x=>{d[x]={typeChangeRecoveryMinutes:P,recoveryMinutes:R,averageMinutes:N},c[x]=R,u[x]=N}),s.push(...A),l=Math.max(N||0,l);let _=`${N}|${h}`;return{roundPeriodLength:h,recoveryMinutes:R,averageMinutes:N,matchUpIds:A,hash:_}}}),greatestAverageMinutes:l,matchUpFormatCohorts:o,recoveryMinutesMap:c,averageMinutesMap:u,orderedMatchUpIds:s,minutesMap:d,...ce}}function Gce({schedulingProfile:t,venueIds:e,eventIds:i,drawIds:n}){let r=[],a=t==null?void 0:t.map(s=>{let l=Ei(s==null?void 0:s.scheduleDate);if(!l){r.push(`Invalid date: ${s==null?void 0:s.scheduledDate}`);return}let c=((s==null?void 0:s.venues)||[]).map(u=>{let{rounds:d,venueId:p}=u;if(!(e!=null&&e.includes(p))){r.push(`Missing venueId: ${p}`);return}let h=d.filter(f=>{let m=i.includes(f.eventId)&&n.includes(f.drawId);return m||r.push(`Invalid eventId: ${f.eventId} or drawId: ${f.drawId}`),m});if(h.length)return{venueId:p,rounds:h}}).filter(Boolean);return c.length&&l&&{...s,venues:c}}).filter(Boolean),o=r.length;return{updatedSchedulingProfile:a,modifications:o,issues:r}}function oO({tournamentRecords:t,schedulingProfile:e}){if(!e)return{valid:!0};if(!Array.isArray(e))return{valid:!1,error:Re};let{venueIds:i,tournamentsMap:n}=Vxe({tournamentRecords:t}),r,a,o=e.every(s=>{let{scheduleDate:l,venues:c}=s;return Dl(l)?c.every(u=>{let{venueId:d,rounds:p}=u;return typeof d!="string"?(a="venueId should be a string",!1):Array.isArray(p)?i.includes(d)?!!p.every(h=>{var D,E,C,P;if(!h)return a="empty round",!1;let{roundSegment:f,tournamentId:m,structureId:g,roundNumber:v,eventId:y,drawId:b}=h,I=(P=(C=(E=(D=n==null?void 0:n[m])==null?void 0:D[y])==null?void 0:E[b])==null?void 0:C[g])==null?void 0:P.includes(v);I||(a="Invalid rounds");let{segmentNumber:T,segmentsCount:w}=f||{},S=!f||yi(T)&&bd(w)&&T<=w;return S||(a="Invalid segment"),I&&S}):(r=AI,!1):(a="rounds should be an array",!1)}):!1});return!o&&!r&&(r=Re),{valid:!!o,error:r,info:a}}function $xe(t){let{tournamentRecord:e={},tournamentMap:i={},requireCourts:n}=t,r=[],a=[],o=[],s=[],l=((e==null?void 0:e.venues)||[]).map(({venueId:u,courts:d})=>(!n||(d==null?void 0:d.length))&&u),c=e==null?void 0:e.tournamentId;return c&&(r.push(c),i[c]={},((e==null?void 0:e.events)||[]).forEach(u=>{let d=u.eventId;o.push(d),i[c][d]={},(u.drawDefinitions||[]).forEach(p=>{let h=p.drawId;s.push(h),i[c][d][h]={};let{structures:f}=Ru({drawDefinition:p});(f||[]).forEach(m=>{var I;let g=m.structureId,{matchUps:v}=wn({structure:m}),{roundMatchUps:y}=Us({matchUps:v}),b=y&&Object.keys(y).map(T=>parseInt(T));i[c][d][h][g]=b,a.push(g),(I=m.structures)!=null&&I.length&&m.structures.forEach(T=>{a.push(T.structureId),i[c][d][h][T.structureId]=b})})})})),{tournamentMap:i,tournamentIds:r,structureIds:a,venueIds:l,eventIds:o,drawIds:s}}function Vxe(t){let e=(t==null?void 0:t.tournamentRecords)&&Object.values(t==null?void 0:t.tournamentRecords)||[],i={},{venueIds:n,eventIds:r,drawIds:a,structureIds:o,tournamentIds:s}=e.reduce((l,c)=>{let{tournamentIds:u,tournamentMap:d,structureIds:p,venueIds:h,eventIds:f,drawIds:m}=$xe({tournamentRecord:c});return h.forEach(g=>{l.venueIds.includes(g)||l.venueIds.push(g)}),l.tournamentIds.push(...u),l.structureIds.push(...p),l.eventIds.push(...f),l.drawIds.push(...m),Object.assign(i,d),l},{tournamentIds:[],structureIds:[],venueIds:[],eventIds:[],drawIds:[]});return{tournamentsMap:i,tournamentIds:s,structureIds:o,venueIds:n,eventIds:r,drawIds:a}}function rm({tournamentRecords:t,tournamentRecord:e}){if(typeof t!="object"||!Object.keys(t).length)return{error:Sr};let{extension:i}=Ri({element:e,name:Zb,tournamentRecords:t,discover:!0}),n=(i==null?void 0:i.value)||[];if(n.length){let{venueIds:r}=nP({requireCourts:!0,tournamentRecords:t}),{eventIds:a,drawIds:o}=qq({tournamentRecords:t}),{updatedSchedulingProfile:s,modifications:l,issues:c}=Gce({schedulingProfile:n,venueIds:r,eventIds:a,drawIds:o});if(l){n=s;let u=zT({tournamentRecords:t,tournamentRecord:e,schedulingProfile:n});return u.error?u:{schedulingProfile:n,modifications:l,issues:c}}}return{schedulingProfile:n,modifications:0}}function zT({tournamentRecords:t,tournamentRecord:e,schedulingProfile:i}){let n=oO({tournamentRecords:t,schedulingProfile:i});return n.error?n:i?cn({tournamentRecords:t,discover:!0,extension:{name:Zb,value:i}}):Is({element:e,name:Zb,tournamentRecords:t,discover:!0})}function aP(t){let{tournamentRecord:e}=t,i=t.tournamentRecords||e&&{[e.tournamentId]:e}||{};if(!t.schedulingProfile){let{modifications:c,issues:u}=rm({tournamentRecords:i,tournamentRecord:e});return{success:!c,modifications:c,issues:u}}let{venueIds:n}=nP({tournamentRecords:i}),{eventIds:r,drawIds:a}=qq({tournamentRecords:i}),{updatedSchedulingProfile:o,modifications:s,issues:l}=Gce({schedulingProfile:t.schedulingProfile,venueIds:n,eventIds:r,drawIds:a});return s?{...zT({schedulingProfile:o,tournamentRecords:i}),modifications:s,issues:l}:{...ce,modifications:s,issues:l}}function x3(t){let{scheduleDates:e=[],tournamentRecords:i,periodLength:n=30}=t??{};if(typeof i!="object")return{error:eC};if(!Array.isArray(e))return{error:Re};if(!e.every(Dl))return{error:Xa};let r=[],a=0,o={},{schedulingProfile:s}=rm({tournamentRecords:i});if(!s)return{issues:r,...ce};let{matchUps:l}=wd({nextMatchUps:!0,tournamentRecords:i});for(let u of s){let{scheduleDate:d,venues:p=[]}=u;if(!(e!=null&&e.length)||e.includes(d)){for(let h of p||[])if(h){let{rounds:f}=h,m=[],{orderedMatchUpIds:g,scheduledRoundsDetails:v}=rP({tournamentRecords:i,periodLength:n,matchUps:l,rounds:f}),{matchUpDependencies:y}=Vu({tournamentRecords:i,matchUps:l}),b=I=>{let T;return v==null||v.find((w,S)=>{let D=w.matchUpIds.includes(I);return D&&(T=S),D}),T};if(g==null||g.forEach((I,T)=>{var D;let w=g.slice(T+1),S=zr(w,((D=y==null?void 0:y[I])==null?void 0:D.matchUpIds)||[]);S.length&&m.push({matchUpId:I,shouldBeAfter:S})}),m.length){a+=m.length;let I=m.map(({matchUpId:T,shouldBeAfter:w})=>{let S=b(T),D=Pi(w.map(b));return o[d]||(o[d]={}),o[d][S]||(o[d][S]=[]),D.forEach(E=>{o[d][S].includes(E)||o[d][S].push(E)}),{matchUpId:T,matchUpRoundIndex:S,earlierRoundIndices:D,shouldBeAfter:w}});r.push(...I)}}}}let c={matchUpIdShouldBeAfter:Object.assign({},...r.map(u=>{let{matchUpId:d,shouldBeAfter:p,earlierRoundIndices:h}=u;return{[d]:{earlierRoundIndices:h,shouldBeAfter:p}}}))};return{issuesCount:a,profileIssues:c,roundIndexShouldBeAfter:o,...ce}}function Ry(t){let{tournamentRecords:e,requestType:i}=t,n=di(t,[{[zo]:!0}]);if(n.error)return n;let r={};for(let a of Object.values(e)){let{extension:o}=Ri({element:a,name:AT}),s=(o==null?void 0:o.value)||[];for(let l of s){let{personId:c,requests:u}=l||{};r[c]||(r[c]=[]);for(let d of u)i&&d.requestType!==i||r[c].push(d)}}return{personRequests:r,...ce}}function bV(t){let{containerStructureId:e,roundSegment:i,isRoundRobin:n,tournamentId:r,roundNumber:a,structureId:o,eventId:s,drawId:l}=t,c=n?e:o,u=[r,s,l,c,a].join("|");return zt({structureId:c,roundSegment:i,tournamentId:r,roundNumber:a,eventId:s,drawId:l,id:u})}function wY({round:t,matchUps:e,events:i,tournamentRecords:n}){let r=i.find(p=>p.eventId===t.eventId),{eventType:a,category:o,categoryType:s}=r||{},{categoryName:l,ageCategoryCode:c}=o||{},u=Pl(e.map(({matchUpFormat:p})=>p)),d=0;return Object.keys(u).forEach(p=>{let h=u[p],f=aO({categoryName:l||c,tournamentId:t.tournamentId,eventId:t.eventId,tournamentRecords:n,matchUpFormat:p,categoryType:s,eventType:a});if(f.error)return f;let m=f.averageMinutes*h;isNaN(d)||(d+=m)}),{roundMinutes:d}}function jxe(t){return(t||[]).reduce((e,i)=>{var a,o;let n=(((a=i.finishingPositionRange)==null?void 0:a.winner)||[]).reduce((s,l)=>s+l,0),r=(((o=i.finishingPositionRange)==null?void 0:o.winner)||[]).join("-")||"";return!e.minFinishingSum||n<e.minFinishingSum?{minFinishingSum:n,winnerFinishingPositionRange:r}:e},{minFinishingSum:0,winnerFinishingPositionRange:""})}function SY(t){let e=t.length,i=t.filter(({sides:c})=>c==null?void 0:c.some(({bye:u})=>u)).length||0,n=t.filter(({winningSide:c,matchUpStatus:u})=>c||ba.includes(u)).length||0,r=t.filter(({schedule:c,matchUpStatus:u})=>(c==null?void 0:c.scheduledDate)&&(c==null?void 0:c.scheduledTime)&&u!==vn).length||0,a=e-i,o=a===n,s=a-r,l=a-r;return{unscheduledCount:s,incompleteCount:l,scheduledCount:r,completedCount:n,matchUpsCount:e,isScheduled:a===r,isComplete:o,byeCount:i}}function sO({tournamentRecords:t,schedulingProfile:e,tournamentRecord:i,withRoundId:n}){if(i&&!t){if(typeof i!="object")return{error:eC};t={[i.tournamentId]:i}}if(e){let a=oO({tournamentRecords:t,schedulingProfile:e});if(a.error)return a}if(!e&&t){let a=rm({tournamentRecords:t});if(a.error)return a;e=a.schedulingProfile}if(!e)return{error:no};let r={};return{profileRounds:e.map(({venues:a,scheduleDate:o})=>a.map(({rounds:s})=>s.map(l=>{var u;let c=bV(l);return(u=c.roundSegment)!=null&&u.segmentsCount&&(r[c.id]=c.roundSegment.segmentsCount),zt({id:n?c.id:void 0,scheduleDate:o,...c})}))).flat(1/0),segmentedRounds:r}}function lO({courtPrefix:t="C|",minRowsCount:e,courtsData:i}){if(!Array.isArray(i))return{error:Re};let n=i==null?void 0:i.reduce((o,s)=>{let l=s.matchUps||[],c=Math.max(0,...l.map(u=>u.schedule.courtOrder||0));return c>o?c:o},1),r=e?Math.max(e,n):n,a=Et(0,r).map(o=>({matchUps:Et(0,i.length).map(s=>{let l=i[s],{courtId:c,venueId:u}=l;return{schedule:{courtOrder:o+1,venueId:u,courtId:c}}})}));return i.forEach((o,s)=>{var l;for(let c of o.matchUps){let u=(l=c.schedule)==null?void 0:l.courtOrder;u&&(a[u-1].matchUps[s]=c)}}),{courtPrefix:t,rows:a.map((o,s)=>Object.assign({rowId:`rowId-${s+1}`},...o.matchUps.map((l,c)=>({[`${t}${c}`]:l}))))}}var Hce={};$i(Hce,{getEntriesAndSeedsCount:()=>cO,getMaxEntryPosition:()=>O3});function cO({policyDefinitions:t,drawDefinition:e,drawSize:i,drawId:n,event:r,stage:a}){if(!r)return{error:Qn};let{entries:o,stageEntries:s}=hoe({drawDefinition:e,drawId:n,stage:a,event:r}),l=s.length,{drawSize:c}=jse({participantsCount:l}),u=eP({drawSize:i??c,participantsCount:l,policyDefinitions:t});if(u.error)return pe({result:u,stack:"getEntriesAndSeedsCount"});let{seedsCount:d}=u;return{entries:o,seedsCount:d,stageEntries:s}}function O3(t){let{entries:e=[],entryStatus:i,stage:n}=t;return Math.max(...e.filter(r=>(!n||n===r.entryStage)&&(!i||r.entryStatus===i)&&!isNaN(r.entryPosition)).map(({entryPosition:r})=>ri(r||0)),0)}var zce={};$i(zce,{allCompetitionMatchUps:()=>wd,allDrawMatchUps:()=>ws,allEventMatchUps:()=>xh,allTournamentMatchUps:()=>oo,analyzeMatchUp:()=>WD,calculateWinCriteria:()=>JI,checkMatchUpIsComplete:()=>Rv,competitionScheduleMatchUps:()=>sP,drawMatchUps:()=>q3,eventMatchUps:()=>dO,filterMatchUps:()=>sf,getAllDrawMatchUps:()=>Ia,getAllStructureMatchUps:()=>wn,getCheckedInParticipantIds:()=>VI,getCompetitionMatchUps:()=>qD,getEventMatchUpFormatTiming:()=>F3,getHomeParticipantId:()=>Sx,getMatchUpCompetitiveProfile:()=>EC,getMatchUpContextIds:()=>j3,getMatchUpDailyLimits:()=>hO,getMatchUpDailyLimitsUpdate:()=>B3,getMatchUpDependencies:()=>Vu,getMatchUpFormat:()=>G3,getMatchUpFormatTiming:()=>CC,getMatchUpFormatTimingUpdate:()=>L3,getMatchUpScheduleDetails:()=>Tx,getMatchUpType:()=>Dx,getMatchUpsStats:()=>H3,getModifiedMatchUpFormatTiming:()=>uO,getParticipantResults:()=>qC,getPredictiveAccuracy:()=>V3,getRoundMatchUps:()=>Us,getRounds:()=>z3,isValidMatchUpFormat:()=>Nl,matchUpActions:()=>Hx,participantScheduledMatchUps:()=>$3,tallyParticipantResults:()=>HT,tournamentMatchUps:()=>pO,validMatchUp:()=>Ux,validMatchUps:()=>Kc});function qce({tournamentRecords:t,extensionName:e}){if(typeof t!="object"||!Object.keys(t).length)return{error:Sr};let i=[],n;for(let r of Object.values(t)){let{extension:a}=Ri({element:r,name:e});a&&!n&&(i.push({params:{extension:a,discover:!0},method:"addExtension"}),n=!0);let o=r.events??[];for(let s of o){let{eventId:l}=s,{extension:c}=Ri({name:e,element:s});c&&i.push({params:{eventId:l,extension:c},method:"addEventExtension"})}}return{methods:i}}function L3({tournamentRecords:t}){return qce({extensionName:Pf,tournamentRecords:t})}var BB="ADULT",$B="JUNIOR",yM="WHEELCHAIR",Wce={[Tg]:{allowModificationWhenMatchUpsScheduled:{courts:!1,venues:!1},defaultTimes:{averageTimes:[{categoryNames:[],minutes:{default:90}}],recoveryTimes:[{minutes:{[zn]:30,default:60}}]},defaultDailyLimits:{[or]:2,[zn]:2,total:3},matchUpAverageTimes:[{matchUpFormatCodes:[Iu],averageTimes:[{categoryNames:[],minutes:{default:90}},{categoryTypes:[yM],minutes:{default:120}}]},{matchUpFormatCodes:["SET3-S:6/TB7-F:TB10"],averageTimes:[{categoryNames:[],minutes:{default:85}}]},{matchUpFormatCodes:["SET3-S:6/TB7-F:TB7"],averageTimes:[{categoryNames:[],minutes:{default:70}}]},{matchUpFormatCodes:["SET3-S:4NOAD-F:TB7"],averageTimes:[{categoryNames:[],minutes:{default:55}}]},{matchUpFormatCodes:["SET3-S:4/TB7"],averageTimes:[{categoryNames:[],minutes:{default:60}}]},{matchUpFormatCodes:["SET3-S:4/TB7-F:TB7"],averageTimes:[{categoryNames:[],minutes:{default:50}}]},{matchUpFormatCodes:["SET3-S:4/TB7-F:TB10"],averageTimes:[{categoryNames:[],minutes:{default:55}}]},{matchUpFormatCodes:["SET3-S:4/TB5@3"],averageTimes:[{categoryNames:[],minutes:{default:45}}]},{matchUpFormatCodes:["SET1-S:8/TB7","SET1-S:8/TB7@7"],averageTimes:[{categoryNames:[],minutes:{default:40}}]},{matchUpFormatCodes:["SET1-S:5/TB9@4"],averageTimes:[{categoryNames:[],minutes:{default:30}}]},{matchUpFormatCodes:["SET1-S:6/TB7"],averageTimes:[{categoryNames:[],minutes:{default:30}}]},{matchUpFormatCodes:["SET1-S:6NOAD"],averageTimes:[{categoryNames:[],minutes:{default:30}}]},{matchUpFormatCodes:["SET1-S:4/TB7","SET1-S:4/TB5@3","SET3-S:TB10","SET1-S:T20"],averageTimes:[{categoryNames:[],minutes:{default:20}}]},{matchUpFormatCodes:["SET1-S:4NOAD"],averageTimes:[{categoryNames:[],minutes:{default:20}}]},{matchUpFormatCodes:["SET1-S:TB10"],averageTimes:[{categoryNames:[],minutes:{default:10}}]}],matchUpRecoveryTimes:[{matchUpFormatCodes:["SET3-S:6/TB7","SET3-S:6/TB7-F:TB10","SET3-S:6/TB7-F:TB7"],recoveryTimes:[{categoryTypes:[BB,yM],minutes:{default:60,[zn]:30}},{categoryTypes:[$B],minutes:{default:60,[zn]:60}}]},{matchUpFormatCodes:["SET3-S:4/TB7-F:TB7","SET3-S:4/TB7-F:TB10","SET3-S:4NOAD-F:TB7","SET3-S:4/TB7","SET3-S:4/TB5@3"],recoveryTimes:[{categoryTypes:[BB,yM],minutes:{default:30}},{categoryTypes:[$B],minutes:{default:60}}]},{matchUpFormatCodes:["SET1-S:8/TB7","SET1-S:8/TB7@7","SET1-S:5/TB9@4","SET1-S:6/TB7","SET1-S:6NOAD","SET1-S:4/TB7","SET1-S:4NOAD","SET3-S:TB10","SET1-S:T20"],recoveryTimes:[{categoryNames:[],minutes:{default:30}}]},{matchUpFormatCodes:["SET1-S:4/TB5@3"],recoveryTimes:[{categoryTypes:[BB,$B],minutes:{default:30}},{categoryTypes:[yM],minutes:{default:15}}]},{matchUpFormatCodes:["SET1-S:TB10"],recoveryTimes:[{categoryNames:[],minutes:{default:15}}]}],matchUpDailyLimits:[]}},Gxe=Wce;function F3({tournamentRecord:t,matchUpFormats:e,categoryType:i,event:n}){if(!n)return{error:Qn};let r=[],a;if(e!=null&&e.length){let d=[];r=e.map(p=>{let h=typeof p=="string"?{matchUpFormat:p}:p;if(!d.includes(h==null?void 0:h.matchUpFormat)&&Nl({matchUpFormat:h==null?void 0:h.matchUpFormat}))return d.push(h.matchUpFormat),h}).filter(Boolean)}else{let{policy:d}=Ty({policyType:Bc,tournamentRecord:t,event:n});if(d!=null&&d.matchUpFormats)r=d==null?void 0:d.matchUpFormats;else{let{extension:p}=Ri({name:Pf,element:n}),h,f;p!=null&&p.value?{matchUpAverageTimes:h,matchUpRecoveryTimes:f}=p.value:{matchUpAverageTimes:h,matchUpRecoveryTimes:f}=Gxe[Tg],r=Pi([...(h||[]).map(m=>m.matchUpFormatCodes),...(f||[]).map(m=>m.matchUpFormatCodes)].flat()).map(m=>({matchUpFormat:m})),a="default scheduling policy in use"}}let{eventType:o,eventId:s,category:l}=n,c=(l==null?void 0:l.categoryName)??(l==null?void 0:l.ageCategoryCode)??s;if(!s)return{error:Qn};let u=r.map(({matchUpFormat:d,description:p})=>{let h=CC({tournamentRecord:t,matchUpFormat:d,categoryName:c,categoryType:i,eventType:o,event:n});return{matchUpFormat:d,description:p,...h}});return zt({eventMatchUpFormatTiming:u,info:a})}function uO(t){let e=di(t,[{[ls]:!0},{[$o]:m=>Nl({matchUpFormat:m}),[Ql]:nC,[fz]:!0}]);if(e.error)return e;let{tournamentRecord:i,matchUpFormat:n,event:r}=t,{extension:a}=Ri({name:Pf,element:r}),o=a==null?void 0:a.value,{extension:s}=Ri({element:i,name:Pf}),l=s==null?void 0:s.value,c=(o==null?void 0:o.matchUpAverageTimes)&&x1({...o,matchUpFormat:n}),u=(l==null?void 0:l.matchUpAverageTimes)&&x1({...l,matchUpFormat:n}),d=[c,u].find(m=>m),p=(o==null?void 0:o.matchUpRecoveryTimes)&&O1({...o,matchUpFormat:n}),h=(l==null?void 0:l.matchUpRecoveryTimes)&&O1({...l,matchUpFormat:n}),f=[p,h].find(m=>m);return{matchUpFormat:n,recoveryTimes:f,averageTimes:d}}function B3({tournamentRecords:t}){return qce({extensionName:hC,tournamentRecords:t})}var oP=({scheduleAttributes:t=["scheduledDate","scheduledTime"],schedule:e={}})=>!!Object.keys(e).filter(i=>t.includes(i)).filter(i=>e[i]).length;function $3({scheduleAttributes:t=["scheduledDate","scheduledTime"],matchUps:e=[]}){if(!Kc(e))return{error:Xf};if(!Array.isArray(t))return{error:Re};let i=e.filter(Boolean).filter(({schedule:n})=>oP({schedule:n,scheduleAttributes:t})).reduce((n,r)=>{let{schedule:a}=r,o=Ei(a==null?void 0:a.scheduledDate),s=ir(a==null?void 0:a.scheduledTime);return o&&s&&(n[o]?n[o].push(r):n[o]=[r]),n},{});return Object.keys(i).forEach(n=>{i[n].sort((r,a)=>{var o,s;return Hre(ir((o=r.schedule)==null?void 0:o.scheduledTime),ir((s=a.schedule)==null?void 0:s.scheduledTime))})}),{...ce,scheduledMatchUps:i}}function Hxe({tournamentRecords:t}){var n;let e=[],i={};for(let r of Object.values(t))for(let a of r.events??[]){let o=Yc({event:a}),s=o==null?void 0:o.drawDetails;Xi(s)?(Object.assign(i,s),e.push(...Object.keys(s).filter(l=>mq({drawId:l,drawDetails:s})))):(n=o==null?void 0:o.drawIds)!=null&&n.length&&e.push(...o.drawIds)}return{drawIds:e,detailsMap:i}}function jA({schedulingProfile:t,matchUps:e=[]}){let i={},n=({eventId:s,drawId:l,structureId:c,roundNumber:u})=>`${s}|${l}|${c}${u}`;t!=null&&t.length&&t.map(({venues:s})=>s.map(({rounds:l})=>l)).flat().forEach(s=>{s.sort((l,c)=>(l.sortOrder||0)-(c.sortOrder||0)).forEach(({eventId:l,drawId:c,structureId:u,roundNumber:d},p)=>{let h=n({eventId:l,drawId:c,structureId:u,roundNumber:d});i[h]=p})});let r=[],a={noScheduledDate:[]};for(let s of e){let l=s.schedule||{},c=l.scheduledDate&&Ei(l.scheduledDate)||l.scheduledTime&&Ei(l.scheduledTime)||"noScheduledDate";a[c]||(a[c]=[]),a[c].push(s)}let o=Object.keys(a).sort();for(let s of o){let l=a[s],c={noScheduledTime:[]};for(let d of l){let p=d.schedule||{},h=p.scheduledTime&&ir(p.scheduledTime)||"noScheduledTime";c[h]||(c[h]=[]),c[h].push(d)}let u=Object.keys(c).sort();for(let d of u){let p=c[d];p.sort((h,f)=>{let m=i[n(h)]||0,g=i[n(f)]||0;return m-g}),r.push(...p)}}return r}function dO(t){let{participants:e,contextContent:i,participantMap:n}=t,{tournamentAppliedPolicies:r,scheduleVisibilityFilters:a,participantsProfile:o,afterRecoveryTimes:s,policyDefinitions:l,useParticipantMap:c,tournamentRecord:u,usePublishState:d,contextFilters:p,matchUpFilters:h,contextProfile:f,nextMatchUps:m,tournamentId:g,inContext:v,context:y,event:b}=t;if(!b)return{error:Qn};let{eventId:I,eventName:T,endDate:w,eventType:S,category:D,gender:E}=b??{},C={...y,...zt({surfaceCategory:b.surfaceCategory??(u==null?void 0:u.surfaceCategory),indoorOutDoor:b.indoorOutdoor??(u==null?void 0:u.indoorOutdoor),tournamentId:g??(u==null?void 0:u.tournamentId),endDate:w??(u==null?void 0:u.endDate),eventName:T,eventType:S,category:D,eventId:I,gender:E})},P;!e&&u&&({participants:e,participantMap:n,groupInfo:P}=BI({participantsProfile:o,policyDefinitions:l,useParticipantMap:c,tournamentRecord:u,contextProfile:f,inContext:v})),f&&!i&&(i=tm({policyDefinitions:l,tournamentRecord:u,contextProfile:f,event:b}));let R=Yc({event:b});return{...(b.drawDefinitions??[]).reduce((N,M)=>{var _;let A=BT({context:C,tournamentAppliedPolicies:r,scheduleVisibilityFilters:a,tournamentParticipants:e,participantsProfile:o,afterRecoveryTimes:s,policyDefinitions:l,tournamentRecord:u,usePublishState:d,contextContent:i,contextFilters:p,matchUpFilters:h,participantMap:n,publishStatus:R,contextProfile:f,drawDefinition:M,nextMatchUps:m,inContext:v,event:b});return(_=Object.keys(A))==null||_.forEach(x=>{Array.isArray(A[x])&&(N[x]||(N[x]=[]),N[x]=N[x].concat(A[x]))}),N},{}),...ce,groupInfo:P}}function pO(t){if(!(t!=null&&t.tournamentRecord))return{error:ut};let e=t.contextContent,{scheduleVisibilityFilters:i,participantsProfile:n,afterRecoveryTimes:r,policyDefinitions:a,useParticipantMap:o,tournamentRecord:s,inContext:l=!0,usePublishState:c,contextFilters:u,matchUpFilters:d,contextProfile:p,nextMatchUps:h,context:f}=t,m=t.tournamentId??s.tournamentId,g=(s==null?void 0:s.events)??[],{participants:v,participantMap:y,groupInfo:b}=BI({participantsProfile:n,policyDefinitions:a,useParticipantMap:o,tournamentRecord:s,contextProfile:p,inContext:l});p&&!e&&(e=tm({policyDefinitions:a,tournamentRecord:s,contextProfile:p}));let{appliedPolicies:I}=dn({tournamentRecord:s}),T=(u==null?void 0:u.eventIds)??[];return{...g.filter(w=>!T.includes(w.eventId)).map(w=>{var D,E,C;let S={eventDrawsCount:((E=(D=Zr({event:w}).flightProfile)==null?void 0:D.flights)==null?void 0:E.length)||((C=w.drawDefinitions)==null?void 0:C.length)||0,...f};return dO({context:S,tournamentAppliedPolicies:I,scheduleVisibilityFilters:i,participantsProfile:n,afterRecoveryTimes:r,policyDefinitions:a,tournamentRecord:s,usePublishState:c,contextFilters:u,contextProfile:p,contextContent:e,matchUpFilters:d,participantMap:y,participants:v,tournamentId:m,nextMatchUps:h,inContext:l,event:w})}).reduce((w,S)=>{var D;return(D=S&&Object.keys(S).filter(E=>!["success","matchUpsMap"].includes(E)))==null||D.forEach(E=>{Array.isArray(S[E])&&(w[E]||(w[E]=[]),w[E]=w[E].concat(S[E]),w.matchUpsCount+=S[E].length)}),w},{matchUpsCount:0}),groupInfo:b}}function qD({scheduleVisibilityFilters:t,participantsProfile:e,tournamentRecords:i,policyDefinitions:n,usePublishState:r,matchUpFilters:a,contextFilters:o,nextMatchUps:s,inContext:l}){if(typeof i!="object"||!Object.keys(i).length)return{error:Sr};let c=Object.keys(i).map(d=>{let p=i[d];return pO({scheduleVisibilityFilters:t,participantsProfile:e,policyDefinitions:n,tournamentRecord:p,usePublishState:r,matchUpFilters:a,contextFilters:o,nextMatchUps:s,inContext:l})}),u={};return{...c.reduce((d,p)=>(Object.keys(p).forEach(h=>{Array.isArray(p[h])&&(d[h]||(d[h]=[]),d[h]=d[h].concat(p[h])),h==="groupInfo"&&Object.assign(u,p[h])}),d),{}),groupInfo:u}}function sP(t){var R,N,M,A,_,x,O;if(typeof(t==null?void 0:t.tournamentRecords)!="object"||!Object.keys(t==null?void 0:t.tournamentRecords).length)return{error:Sr};let{courts:e,venues:i}=nm(t),n=rm(t).schedulingProfile,{sortDateMatchUps:r=!0,courtCompletedMatchUps:a,alwaysReturnCompleted:o,activeTournamentId:s,tournamentRecords:l,withCourtGridRows:c,minCourtGridRows:u,usePublishState:d,status:p=oc,sortCourtsData:h}=t,f=s??kI()??Object.keys(l)[0],m=d?kC({tournamentRecord:l[f],status:p}):void 0,g=o?qD({...t,matchUpFilters:{...t.matchUpFilters,matchUpStatuses:[jr]},contextFilters:t.contextFilters}).completedMatchUps:[];if(d&&!((R=m==null?void 0:m.orderOfPlay)!=null&&R.published))return{completedMatchUps:g,dateMatchUps:[],courtsData:[],venues:i};let v,y;d&&({drawIds:v,detailsMap:y}=Hxe({tournamentRecords:l})),v!=null&&v.length&&(t.contextFilters||(t.contextFilters={}),(N=t.contextFilters)!=null&&N.drawIds?t.contextFilters.drawIds=t.contextFilters.drawIds.filter(B=>v.includes(B)):t.contextFilters.drawIds=v),(M=m==null?void 0:m.eventIds)!=null&&M.length&&(t.matchUpFilters||(t.matchUpFilters={}),(A=t.matchUpFilters)!=null&&A.eventIds&&t.matchUpFilters.eventIds.length?t.matchUpFilters.eventIds=t.matchUpFilters.eventIds.filter(B=>m.eventIds.includes(B)):t.matchUpFilters.eventIds=m.eventIds),(_=m==null?void 0:m.scheduledDates)!=null&&_.length&&(t.matchUpFilters||(t.matchUpFilters={}),t.matchUpFilters.scheduledDates&&t.matchUpFilters.scheduledDates.length?t.matchUpFilters.scheduledDates=t.matchUpFilters.scheduledDates.filter(B=>m.scheduledDates.includes(B)):t.matchUpFilters.scheduledDates=m.scheduledDates),o&&(t.matchUpFilters||(t.matchUpFilters={}),(O=(x=t.matchUpFilters)==null?void 0:x.excludeMatchUpStatuses)!=null&&O.length?t.matchUpFilters.excludeMatchUpStatuses.includes(jr)||t.matchUpFilters.excludeMatchUpStatuses.push(jr):t.matchUpFilters.excludeMatchUpStatuses=[jr]);let{completedMatchUps:b,upcomingMatchUps:I,pendingMatchUps:T,groupInfo:w}=qD({...t,matchUpFilters:t.matchUpFilters,contextFilters:t.contextFilters}),S=[...I??[],...T??[]];y&&Object.keys(y).length&&(S=S.filter(B=>{let{drawId:F,structureId:G,stage:H}=B;if(!y[F])return!1;if(y[F].stageDetails){let $=Object.keys(y[F].stageDetails),q=$.filter(Z=>!y[F].stageDetails[Z].published),z=$.filter(Z=>y[F].stageDetails[Z].published);return q.length&&q.includes(H)?!1:z.length&&z.includes(H)?!0:q.length&&!q.includes(H)&&!z.length}if(y[F].structureDetails){let $=Object.keys(y[F].structureDetails),q=$.filter(Z=>!y[F].structureDetails[Z].published),z=$.filter(Z=>y[F].structureDetails[Z].published);return q.length&&q.includes(G)?!1:z.length&&z.includes(G)?!0:q.length&&!q.includes(G)&&!z.length}return!0}));let D=r?jA({matchUps:S,schedulingProfile:n}):S,E=e==null?void 0:e.map(B=>{let F=P(B);return{surfaceCategory:(B==null?void 0:B.surfaceCategory)??"",matchUps:F,...B}}),C={completedMatchUps:o?g:b,dateMatchUps:D,courtsData:E,groupInfo:w,venues:i};if(c){let{rows:B,courtPrefix:F}=lO({minRowsCount:u,courtsData:E});C.courtPrefix=F,C.rows=B}return{...C,...ce};function P({courtId:B}){let F=(a?D.concat(b??[]):D).filter(G=>{var H,$,q;return((H=G.schedule)==null?void 0:H.courtId)===B||((q=($=G.schedule)==null?void 0:$.allocatedCourts)==null?void 0:q.map(({courtId:z})=>z).includes(B))});return h?jA({matchUps:F,schedulingProfile:n}):F}}function hO({tournamentRecords:t,tournamentId:e}){if(typeof t!="object"||!Object.keys(t).length)return{error:Sr};let i=Object.keys(t).filter(r=>!e||r===e),n;return i.forEach(r=>{let a=t[r],{matchUpDailyLimits:o}=zxe({tournamentRecord:a});n=o}),{matchUpDailyLimits:n}}function zxe(t){var s;let e=di(t,[{[ls]:!0}]);if(e.error)return e;let{tournamentRecord:i}=t,{policy:n}=Ty({policyType:Tg,tournamentRecord:i}),{extension:r}=Ri({element:i,name:hC}),a=(s=r==null?void 0:r.value)==null?void 0:s.dailyLimits,o=n==null?void 0:n.defaultDailyLimits;return{matchUpDailyLimits:a||o}}function V3(t){var M,A,_,x;let{matchUps:e}=t,{singlesForDoubles:i,tournamentRecord:n,drawDefinition:r,excludeMargin:a,exclusionRule:o,zoneDoubling:s,matchUpType:l,scaleName:c,eventId:u,zonePct:d,drawId:p,event:h}=t;if(!n&&!e)return{error:ut};if(l&&![or,zn].includes(l))return{error:Re,info:{matchUpType:l}};if(e&&!Kc(e))return{error:Re,context:{matchUps:e}};let f=La[c],m=(f==null?void 0:f.ascending)??t.ascending??!1,g=(f==null?void 0:f.accessor)??t.valueAccessor,v=Array.isArray(f==null?void 0:f.range)?Math.abs(f.range[0]-f.range[1]):0,y=yi(d)&&v?(d??0/100)*v:t.zoneMargin??v,b={withScaleValues:!0,withCompetitiveness:!0},I={matchUpTypes:l?[l]:[or,zn]},T=n==null?void 0:n.participants;(M=e==null?void 0:e[0])!=null&&M.hasContext?p?e=e.filter(O=>O.drawId===p):u&&(e=e.filter(O=>O.eventId===u)):e===void 0&&(e=p&&!r&&[]||!p&&u&&!h&&[]||p&&((A=ws({inContext:!0,drawDefinition:r,contextFilters:I,contextProfile:b,participants:T}))==null?void 0:A.matchUps)||!p&&u&&((_=xh({inContext:!0,contextFilters:I,contextProfile:b,participants:T,event:h}))==null?void 0:_.matchUps)||((x=oo({tournamentRecord:n,contextFilters:I,contextProfile:b}))==null?void 0:x.matchUps)||[]),l&&(e=e.filter(O=>O.matchUpType===l));let w=e.filter(({winningSide:O,score:B,sides:F,matchUpStatus:G})=>![go,Zi,hn,_T,ol].includes(G??"")&&Pa({score:B})&&(F==null?void 0:F.length)===2&&O),S=Wxe({matchUps:w,excludeMargin:a,exclusionRule:o,valueAccessor:g,ascending:m,scaleName:c}),D=!s||Gr(or)(l)?y:(y||0)*2,E=y?w.map(({competitiveProfile:O,matchUpType:B,score:F,sides:G})=>{let H=Kce({singlesForDoubles:i,valueAccessor:g,matchUpType:B,scaleName:c,sides:G}),$=Math.abs(H[0].value-H[1].value);return{competitiveness:O==null?void 0:O.competitiveness,valuesGap:$,score:F}}).filter(({valuesGap:O})=>O<=D):[],C=qxe({zoneData:E}),P=C&&[].concat(Object.values(C)).flat().length,R=P&&Object.assign({},...Object.keys(C).map(O=>({[O]:Math.round(1e4*C[O].length/P)/100}))),N=w.length-((E==null?void 0:E.length)||0);return{...ce,relevantMatchUps:w,zoneDistribution:R,zoneData:E,accuracy:S,nonZone:N}}function qxe({zoneData:t}){let e={[tq]:[],[LD]:[],[FD]:[]};for(let i of t){let{competitiveness:n,score:r,valuesGap:a}=i;e[n]&&e[n].push({score:r,valuesGap:a})}return e}function Kce({singlesForDoubles:t,exclusionRule:e,valueAccessor:i,matchUpType:n,scaleName:r,sides:a}){let o=e==null?void 0:e.range.sort(),s=l=>{let c=l==null?void 0:l[e==null?void 0:e.valueAccessor];return{exclude:e&&c>=o[0]&&c<=o[1],exclusionValue:c}};return a.sort((l,c)=>l.sideNumber-c.sideNumber).map(({participant:l})=>{let c=[],u=l==null?void 0:l.individualParticipants;if(u!=null&&u.length){let d=[],p=0;for(let h of u){let{scaleValue:f,value:m}=TY({singlesForDoubles:t,valueAccessor:i,participant:h,matchUpType:n,scaleName:r}),{exclude:g,exclusionValue:v}=s(f);g&&c.push(v),d.push(f),m&&!isNaN(p)?p+=m:p=void 0}return{participantName:l.participantName,exclusionValues:c,scaleValues:d,value:p}}else if(l){let{scaleValue:d,value:p}=TY({singlesForDoubles:t,valueAccessor:i,matchUpType:n,participant:l,scaleName:r}),{exclude:h,exclusionValue:f}=s(d);return h&&c.push(f),{participantName:l.participantName,exclusionValues:c,scaleValue:d,value:p}}else return{}})}function TY({singlesForDoubles:t,valueAccessor:e,matchUpType:i,participant:n,scaleName:r}){var c,u,d,p,h;let a=t?or:i,o=(u=(c=n==null?void 0:n.rankings)==null?void 0:c[a])==null?void 0:u.find(f=>f.scaleName===r),s=(h=((p=(d=n==null?void 0:n.ratings)==null?void 0:d[a])==null?void 0:p.find(f=>f.scaleName===r))||o)==null?void 0:h.scaleValue,l=e?s==null?void 0:s[e]:s;return{scaleValue:s,value:l}}function Wxe({excludeMargin:t,exclusionRule:e,valueAccessor:i,ascending:n,scaleName:r,matchUps:a}){let o={affirmative:[],negative:[],excluded:[]};for(let c of a){let{matchUpType:u,sides:d,score:p,winningSide:h}=c;if(!h)continue;if(e&&(!e.valueAccessor||!e.range))return{info:"exclusionRule requires valueAccessor and range",error:Yt};let f=h-1,m=Kce({exclusionRule:e,valueAccessor:i,matchUpType:u,scaleName:r,sides:d});if(e){let T=m.map(({exclusionValues:w})=>w).flat();if(T.length){o.excluded.push({scoreString:p==null?void 0:p.scoreStringSide1,exclusionValues:T,winningSide:h,sideValues:m});continue}}if(m.filter(T=>![void 0,"",null].includes(T.value)).length<2){o.excluded.push({scoreString:p==null?void 0:p.scoreStringSide1,missingValues:!0,winningSide:h,sideValues:m});continue}let g=m[f].value-m[1-f].value,v=parseFloat(t||0),y=v&&Math.abs(g)<v;if(y){o.excluded.push({scoreString:p==null?void 0:p.scoreStringSide1,excludeMargin:t,winningSide:h,excludeGap:y,sideValues:m,valuesGap:g});continue}let b=n?g:g*-1,I=h===1?p==null?void 0:p.scoreStringSide1:p==null?void 0:p.scoreStringSide2;b>0?o.affirmative.push({winningScoreString:I,winningSide:h,sideValues:m,valuesGap:g,score:p}):o.negative.push({winningScoreString:I,winningSide:h,sideValues:m,valuesGap:g,score:p})}let s=o.affirmative.length+o.negative.length,l=s&&o.affirmative.length/s*100;return o.percent=l?Math.round(100*l)/100:0,o}function JI({collectionDefinitions:t=[],collectionGroups:e=[]}){let i=0,{groupValueNumbers:n}=mse({collectionGroups:e}),r;for(let a of t||[]){let{collectionValueProfiles:o,collectionGroupNumber:s,collectionValue:l,matchUpCount:c,matchUpValue:u,scoreValue:d,setValue:p}=a,h=s&&n.includes(s);if(yi(p||d))r=!0;else{if(h)continue;if(typeof l=="number"&&yi(l))i+=l;else if(Array.isArray(o)&&(o!=null&&o.length))for(let f of o)i+=f.matchUpValue;else typeof u=="number"&&yi(u)&&(i+=(c??0)*u)}}for(let a of e)i+=a.groupValue??0;return r||!i?{aggregateValue:!0,...ce}:{valueGoal:Math.floor(i/2)+1,...ce}}function j3({matchUps:t,matchUpId:e}){if(!Kc(t))return{error:Re};let i=t.find(s=>s.matchUpId===e),{drawId:n,eventId:r,structureId:a,tournamentId:o}=i||{};return{matchUpId:e,drawId:n,eventId:r,structureId:a,tournamentId:o}}function qT(t,e){if(!Xi(t))return{error:Re};if(!Array.isArray(e))return{error:Re};let i={};for(let{param:n,error:r,attr:a}of e){let o=Kxe({params:t,param:n,attr:a,error:r});if(o!=null&&o.error)return o;i[n]=o}return i}function Kxe({params:t,param:e,attr:i,error:n}){if(e===nx&&Xi(t.drawDefinition)&&$r(t.structureId)){let r=(t.drawDefinition.structures??[]).find(({structureId:a})=>a===t.structureId);return!r.length&&n?{error:n}:{structure:r}}if(e===_h){let r=xce({...t,...i});return r.error&&n?{...r,error:n}:r}return{error:no,info:{param:e}}}function G3(t){var p,h;let{structureId:e,matchUpId:i,event:n}=t,r=t.drawDefinition,a=di(t,[{[ls]:!0},{[Vre]:{[tx]:!1,[Cp]:!1,[Bre]:!1,[by]:!1}}]);if(a[Jp])return a;let o=(p=qT(t,[{[CT]:_h,[Jp]:Yt}]))==null?void 0:p.matchUp;if(i&&(o!=null&&o.error))return o;!r&&(o!=null&&o.drawDefinition)&&(r=o==null?void 0:o.drawDefinition);let s=o==null?void 0:o.structure;if(!s&&e&&!i){if(!r)return{error:Pd};let f=ui({drawDefinition:r,structureId:e});if(f.error)return f;s=f.structure}let l=s==null?void 0:s.matchUpFormat,c=r==null?void 0:r.matchUpFormat,u=n==null?void 0:n.matchUpFormat,d=((h=o==null?void 0:o.matchUp)==null?void 0:h.matchUpFormat)||l||c||u;return{structureDefaultMatchUpFormat:l,eventDefaultMatchUpFormat:u,drawDefaultMatchUpFormat:c,matchUpFormat:d}}function H3({profileBands:t,tournamentRecord:e,matchUps:i}){if(!Kc(i))return{error:Xf};let n=!t&&Ty({policyType:of,tournamentRecord:e}).policy,r=t||(n==null?void 0:n.profileBands)||iq[of].profileBands,a=i.filter(({winningSide:p})=>p),o=a.map(Tae),s=(p,h)=>{let f=Sae(h,r);return p[f]+=1,p},l=Uae(o).reduce((p,h)=>s(p,h),{[tq]:0,[LD]:0,[FD]:0,[bae]:0}),c=Object.keys(l).reduce((p,h)=>(l[h]||0)+p,0),u=Object.keys(l).map(p=>{let h=parseFloat((l[p]/c).toFixed(4));return{[p]:h*100}}),d=a.filter(({matchUpStatus:p})=>p===jK).length;return u.push({[jK]:parseFloat((d/c).toFixed(4))*100}),{competitiveBands:Object.assign({},...u),...ce}}var{stageOrder:UY}=uRe;function Yxe(t,e){return t.eventName.localeCompare(e.eventName)||t.eventId.localeCompare(e.eventId)||(UY[t==null?void 0:t.stage]||0)-(UY[e==null?void 0:e.stage]||0)||e.matchUpsCount-t.matchUpsCount||`${t.stageSequence}-${t.roundNumber}-${t.minFinishingSum}`.localeCompare(`${e.stageSequence}-${e.roundNumber}-${e.minFinishingSum}`)}function z3({excludeScheduleDateProfileRounds:t,excludeScheduledRounds:e,excludeCompletedRounds:i,inContextMatchUps:n,tournamentRecords:r,schedulingProfile:a,tournamentRecord:o,withSplitRounds:s,matchUpFilters:l,scheduleDate:c,withRoundId:u,venueId:d,context:p}){var w;if(n&&!Array.isArray(n||typeof n[0]!="object"))return{error:Re,inContextMatchUps:n};if(o&&!r){if(typeof o!="object")return{error:eC};r={[o.tournamentId]:o}}let h=typeof r!="object"||!Object.keys(r).length;if((d||c||!n||!a&&(t||i||a||s))&&h)return{error:Sr};let f=Object.assign({},...Object.values(r??{}).map(({venues:S=[],tournamentId:D})=>({[D]:S==null?void 0:S.map(({venueId:E})=>E)}))),m=Object.values(r??{}).map(({events:S=[],tournamentId:D,startDate:E,endDate:C})=>S.map(P=>({...P,validVenueIds:f[D],startDate:P.startDate??E,endDate:P.endDate??C}))).flat(),{segmentedRounds:g,profileRounds:v}=r&&(t||i||a||s)&&sO({tournamentRecords:r,schedulingProfile:a})||{},y=t&&Object.assign({},...v.map(S=>({[S.id]:S}))),b=n||r&&((w=wd({tournamentRecords:r,matchUpFilters:l}))==null?void 0:w.matchUps)||[],I=[],T=b&&Object.values(b.reduce((S,D)=>{var Y;let E=bV(D).id,C=g==null?void 0:g[E],P=[...((Y=S[E])==null?void 0:Y.matchUps)??[],D],{containerStructureId:R,stageSequence:N,structureName:M,tournamentId:A,isRoundRobin:_,matchUpType:x,roundNumber:O,roundOffset:B,structureId:F,eventName:G,roundName:H,drawName:$,eventId:q,drawId:z}=D,Z=_?R:F;return{...S,[E]:{id:u?E:void 0,structureId:Z,stageSequence:N,segmentsCount:C,structureName:M,tournamentId:A,matchUpType:x,roundNumber:O,roundOffset:B,eventName:G,roundName:H,drawName:$,matchUps:P,eventId:q,drawId:z}}},{})).map(S=>{let{minFinishingSum:D,winnerFinishingPositionRange:E}=jxe(S.matchUps),C=S.segmentsCount;if(C){let O=S.matchUps.length/C;return ro(S.matchUps.sort((B,F)=>B.roundPosition-F.roundPosition),O).map((B,F)=>{let{unscheduledCount:G,incompleteCount:H,matchUpsCount:$,isScheduled:q,isComplete:z,byeCount:Z}=SY(B),Y=wY({matchUps:S.matchUps,tournamentRecords:r,events:m,round:S});return zt({...S,...p,roundSegment:{segmentsCount:C,segmentNumber:F+1},winnerFinishingPositionRange:E,unscheduledCount:G,incompleteCount:H,minFinishingSum:D,matchUpsCount:$,isScheduled:q,roundTiming:Y,isComplete:z,byeCount:Z,matchUps:B})})}let{unscheduledCount:P,incompleteCount:R,matchUpsCount:N,isScheduled:M,isComplete:A,byeCount:_}=SY(S.matchUps),x=wY({matchUps:S.matchUps,tournamentRecords:r,events:m,round:S});return zt({...S,...p,winnerFinishingPositionRange:E,unscheduledCount:P,incompleteCount:R,minFinishingSum:D,matchUpsCount:N,isScheduled:M,roundTiming:x,isComplete:A,byeCount:_})}).flat().filter(S=>{if(t){let F=Ei(t),G=u?S.id:bV(S).id;if(F&&y[G]&&Ei(y[G].scheduleDate)===F)return!1}let{isComplete:D,isScheduled:E}=S,C=!i||!D,P=!e||!E,R=d||c?m==null?void 0:m.find(({eventId:F})=>F===S.eventId):void 0,N=(R==null?void 0:R.startDate)??(o==null?void 0:o.startDate),M=(R==null?void 0:R.endDate)??(o==null?void 0:o.endDate),A=!c||!N||new Date(c)>=new Date(N),_=!c||!M||new Date(c)<=new Date(M),x=A&&_,O=!d||(R==null?void 0:R.validVenueIds.includes(d)),B=C&&P&&O&&x;return B||I.push(S),B}).sort(Yxe)||[];return{...ce,rounds:T,excludedRounds:I}}function WD(t){var q;let{matchUp:e,sideNumber:i,setNumber:n,isTiebreakValue:r,isPointValue:a}=t||{},{matchUpFormat:o}=t||{};if(!e)return{error:rl};o=o||(e==null?void 0:e.matchUpFormat);let s=Ys(o),l=!!(e!=null&&e.winningSide),c=(q=e.score)==null?void 0:q.sets,u=c==null?void 0:c.length,d=n&&n-1,p=!!(c!=null&&c.find((z,Z)=>z.setNumber===n&&Z===d)),h=(c==null?void 0:c.filter(z=>z==null?void 0:z.winningSide))||[],f=(h==null?void 0:h.length)||0,m=n&&(c==null?void 0:c.slice(n))||[],g=!!(u&&n&&(m!=null&&m.reduce((z,Z)=>(!Z||!Z.side1Score&&!Z.side2Score&&!Z.side1TiebreakScore&&!Z.side2TiebreakScore&&!Z.side1PointScore&&!Z.side2PointScore)&&z,!0))),v=n<=u&&c.find(z=>z.setNumber===n),y=v&&zD({setObject:v,matchUpScoringFormat:s}),{isCompletedSet:b,sideGameScores:I,sideTiebreakScores:T}=y||{},w=!!(v&&!b&&g||n&&n===u+1&&!l),S=[1,2].includes(i),D=S?i-1:0,E=v&&S&&(!r&&!a&&I[D]!==void 0&&I[D]||r&&T[D]!==void 0&&T[D]),C=!!E,P=h==null?void 0:h.map(z=>zD({setObject:z,matchUpScoringFormat:s}).isValidSetOutcome).reduce((z,Z)=>z&&Z,!0),R=h.reduce((z,Z)=>{let{winningSide:Y}=Z,Q=Y-1;return z[Q]++,z},[0,0]),N=e==null?void 0:e.winningSide,M=N&&N-1,A=1-M,_=R[M],x=R[A],O=Math.max(...R),B=Pl(R)[O],{bestOf:F}=s??{},G=F&&Math.ceil(F/2)||1,H=O===G&&B===1&&R.indexOf(O)+1||void 0,$=_>x&&N===H;return{completedSetsHaveValidOutcomes:P,validMatchUpWinningSide:$,calculatedWinningSide:H,matchUpScoringFormat:s,validMatchUpOutcome:H&&P&&$,isLastSetWithValues:g,completedSetsCount:f,isCompletedMatchUp:l,isValidSideNumber:S,hasExistingValue:C,existingValue:E,isExistingSet:p,isActiveSet:w,...y}}function q3({participants:t,tournamentAppliedPolicies:e,scheduleVisibilityFilters:i,participantsProfile:n,afterRecoveryTimes:r,policyDefinitions:a,useParticipantMap:o,tournamentRecord:s,usePublishState:l,contextFilters:c,contextContent:u,matchUpFilters:d,participantMap:p,publishStatus:h,contextProfile:f,drawDefinition:m,nextMatchUps:g,tournamentId:v,inContext:y,context:b,event:I}){let{eventId:T,eventName:w,endDate:S,eventType:D,category:E,gender:C}=I??{},P={...b,...zt({surfaceCategory:(I==null?void 0:I.surfaceCategory)??(s==null?void 0:s.surfaceCategory),indoorOutDoor:(I==null?void 0:I.indoorOutdoor)??(s==null?void 0:s.indoorOutdoor),endDate:S??(I==null?void 0:I.endDate)??(s==null?void 0:s.endDate),tournamentId:v??(s==null?void 0:s.tournamentId),eventName:w,eventType:D,category:E,eventId:T,gender:C})},R;return!(t!=null&&t.length)&&s&&({participants:t,participantMap:p,groupInfo:R}=BI({participantsProfile:n,policyDefinitions:a,useParticipantMap:o,tournamentRecord:s,contextProfile:f,inContext:y})),I&&f&&!u&&(u=tm({policyDefinitions:a,tournamentRecord:s,contextProfile:f,drawDefinition:m,event:I})),{...BT({context:P,tournamentAppliedPolicies:e,scheduleVisibilityFilters:i,tournamentParticipants:t,participantsProfile:n,afterRecoveryTimes:r,policyDefinitions:a,tournamentRecord:s,usePublishState:l,participantMap:p,contextContent:u,contextFilters:c,matchUpFilters:d,publishStatus:h,contextProfile:f,drawDefinition:m,nextMatchUps:g,inContext:y,event:I}),groupInfo:R}}var Yce={};$i(Yce,{getCompetitionVenues:()=>nP,getCourts:()=>W3,getVenuesAndCourts:()=>nm,publicFindVenue:()=>lq});function W3({tournamentRecord:t,venueId:e,venueIds:i}){return t?{courts:(t.venues||[]).filter(n=>e?n.venueId===e:i?i.includes(n.venueId):!0).map(n=>{let{venueId:r}=n,a=Ot(n.courts||[]);return a.forEach(o=>Object.assign(o,{venueId:r})),a}).flat()}:{error:ut}}var Zce={};$i(Zce,{categoryCanContain:()=>WC,getCategoryAgeDetails:()=>eI,getEvent:()=>Z3,getEventProperties:()=>K3,getEventStructures:()=>Ax,getEventTimeItem:()=>vC,getEvents:()=>Y3,getFlightProfile:()=>Zr,getScaledEntries:()=>ZI});function K3({tournamentRecord:t,event:e}){var d,p;if(!t)return{error:ut};if(!e)return{error:Qn};let i=e.entries||[],n=t.participants||[],r=((d=e.category)==null?void 0:d.categoryName)||((p=e.category)==null?void 0:p.ageCategoryCode),{eventType:a}=e,o=i.map(h=>h.participantId),s=n.filter(h=>o.includes(h.participantId)),l,c,u;return{entryScaleAttributes:s.map(h=>{var T,w,S,D,E,C;let{participantId:f,participantName:m,name:g}=h,v={scaleType:oq,eventType:a,scaleName:r},y=(w=(T=th({participant:h,scaleAttributes:v}))==null?void 0:T.scaleItem)==null?void 0:w.scaleValue;v={scaleType:xae,eventType:a,scaleName:r};let b=(D=(S=th({participant:h,scaleAttributes:v}))==null?void 0:S.scaleItem)==null?void 0:D.scaleValue;v={scaleType:kae,eventType:a,scaleName:r};let I=(C=(E=th({participant:h,scaleAttributes:v}))==null?void 0:E.scaleItem)==null?void 0:C.scaleValue;return l=!!(l||y),c=!!(c||b),u=!!(u||I),{participantId:f,participantName:m||g,seed:y,ranking:b,rating:I}}),hasSeededParticipants:l,hasRankedParticipants:c,hasRatedParticipants:u}}function Y3({tournamentRecord:t,withScaleValues:e,scaleEventType:i,inContext:n,eventIds:r,drawIds:a,context:o}){var u,d,p,h;if(!t)return{error:ut};let{tournamentId:s}=t,l=(t.events??[]).filter(({eventId:f})=>!r||Array.isArray(r)&&r.includes(f)).map(f=>{var v;let m=(v=f.drawDefinitions)==null?void 0:v.map(kD);if(a!=null&&a.length&&!zr(a,m).length)return;let g=Ot(f);return n&&Object.assign(g,{tournamentId:s}),o&&Object.assign(g,o),g}).filter(Boolean),c={};if(e){let f=Nr({withScaleValues:!0,tournamentRecord:t}).participantMap,m=g=>g.reduce((v,y)=>v+parseFloat(y),0);for(let g of l){let v=i??g.eventType,y=g.eventId;c[y]||(c[y]={ratingsStats:{},ratings:{},ranking:{},draws:{}});let b=(g.entries??[]).filter(({entryStatus:C})=>Bu.includes(C)).map(Gi),I=C=>{var P,R,N,M,A,_;if((P=C==null?void 0:C.ratings)!=null&&P[v])for(let x of((R=C==null?void 0:C.ratings)==null?void 0:R[v])??[]){let O=x.scaleName;c[y].ratings[O]||(c[y].ratings[O]=[]);let B=(N=La[O])==null?void 0:N.accessor;if(B){let F=parseFloat((M=x.scaleValue)==null?void 0:M[B]);F&&c[y].ratings[O].push(F)}}if((A=C==null?void 0:C.rankings)!=null&&A[v])for(let x of((_=C==null?void 0:C.rankings)==null?void 0:_[v])??[]){let O=x.scaleName;c[y].ranking[O]||(c[y].ranking[O]=[]),x.scaleValue&&c[y].ranking[O].push(x.scaleValue)}};for(let C of b){let P=(u=f==null?void 0:f[C])==null?void 0:u.participant;if((P==null?void 0:P.participantType)!==Hi)for(let R of(P==null?void 0:P.individualParticipantIds)??[]){let N=(d=f==null?void 0:f[R])==null?void 0:d.participant;I(N)}else I(P)}let T=c[y].ratings;for(let C of Object.keys(T)){let P=T[C];if(!P.length)continue;let R=(p=LK(P))==null?void 0:p.toFixed(2);c[y].ratingsStats[C]={avg:parseFloat((m(P)/P.length).toFixed(2)),median:R?parseFloat(R):void 0,max:Math.max(...P),min:Math.min(...P)}}let w=(C,P)=>{var N,M;let R=A=>{var _,x,O,B,F,G,H,$,q,z;if((_=c[y].draws)!=null&&_[C]&&((x=A==null?void 0:A.ratings)!=null&&x[v]))for(let Z of((O=A==null?void 0:A.ratings)==null?void 0:O[v])??[]){let Y=Z.scaleName;(B=c[y].draws[C])!=null&&B.ratings[Y]||(c[y].draws[C].ratings[Y]=[]);let Q=(F=La[Y])==null?void 0:F.accessor;if(Q){let X=parseFloat((G=Z.scaleValue)==null?void 0:G[Q]);X&&c[y].draws[C].ratings[Y].push(X)}}if((H=c[y].draws)!=null&&H[C]&&(($=A==null?void 0:A.rankings)!=null&&$[v]))for(let Z of((q=A==null?void 0:A.rankings)==null?void 0:q[v])??[]){let Y=Z.scaleName;(z=c[y].draws[C])!=null&&z.ranking[Y]||(c[y].draws[C].ranking[Y]=[]);let Q=Z.scaleValue;Q&&c[y].draws[C].ranking[Y].push(Q)}};for(let A of P.filter(Boolean)){let _=(N=f==null?void 0:f[A])==null?void 0:N.participant;if((_==null?void 0:_.participantType)!==Hi)for(let x of(_==null?void 0:_.individualParticipantIds)??[]){let O=(M=f==null?void 0:f[x])==null?void 0:M.participant;R(O)}else R(_)}},S=[],D=C=>(a==null?void 0:a.length)&&a.includes(C)||S.includes(C);for(let C of g.drawDefinitions??[]){let P=C.drawId;if(D(P))continue;let R=Ey({drawDefinition:C}).assignedParticipantIds??[];c[y].draws[P]||(c[y].draws[P]={ratingsStats:{},ratings:{},ranking:{}}),S.push(P),w(P,R)}let E=Zr({event:g}).flightProfile;for(let C of(E==null?void 0:E.flights)??[]){let P=C.drawId;if(D(P))continue;let R=C.drawEntries.map(Gi);w(P,R)}for(let C of S){let P=c[y].draws[C].ratings;for(let R of Object.keys(P)){let N=P[R];if(!N.length)continue;let M=(h=LK(N))==null?void 0:h.toFixed(2);c[y].draws[C].ratingsStats[R]={avg:parseFloat((m(N)/N.length).toFixed(2)),median:M?parseFloat(M):void 0,max:Math.max(...N),min:Math.min(...N)}}}}}return zt({eventScaleValues:c,events:l,...ce})}function Z3({tournamentRecord:t,drawDefinition:e,context:i,event:n}){var o;if(!t)return{error:ut};if(!n)return{error:Qn};let r=Ot(n);i&&Object.assign(r,i);let a=e&&((o=r.drawDefinitions)==null?void 0:o.find(({drawId:s})=>e.drawId===s));return zt({drawDefinition:a,event:r})}function Zxe(t){var h,f;let e="validateAndDeriveDrawValues",{appliedPolicies:i,policyDefinitions:n}=Qxe(t),r=eOe({...t,policyDefinitions:n,appliedPolicies:i}),a=Jxe(t),o=tOe({...t,consideredEntries:a,appliedPolicies:i});if(o!=null&&o.error)return pe({result:o,stack:e});let s=iOe({...t,consideredEntries:a}),l=Xxe({...t,appliedPolicies:i,policyDefinitions:n,drawSize:s});if(l.error)return pe({result:l,stack:e});let c=l.drawType;if(isNaN(s)&&c!==Fc)return pe({result:{error:iC},stack:e});let u=(n==null?void 0:n[uu])??(i==null?void 0:i[uu]),d=t.seedingProfile??((f=(h=u==null?void 0:u.seedingProfile)==null?void 0:h.drawTypes)==null?void 0:f[c??""])??(u==null?void 0:u.seedingProfile);t.seedingProfile&&(n[uu]||(n[uu]={...yV[uu]}),n[uu].seedingProfile=d);let p=nOe({...t,drawType:c});return p!=null&&p.error?pe({result:p,stack:e}):{drawSize:s,drawType:c,enforceGender:r,seedingProfile:d,appliedPolicies:i,policyDefinitions:n}}function Xxe(t){let{policyDefinitions:e,appliedPolicies:i,enforceMinimumDrawSize:n=!0,drawSize:r}=t,a=t.drawTypeCoercion??QC({drawType:t.drawType,policyDefinitions:e,appliedPolicies:i}),o=Hse({drawType:t.drawType,enforceMinimumDrawSize:n,drawTypeCoercion:a,drawSize:r});return o.error?o:{drawType:o.drawType}}function Xce(t){return t==null?void 0:t.filter(e=>e.entryStatus&&[...Bu,UC].includes(e.entryStatus))}function Jxe({considerEventEntries:t=!0,drawEntries:e,eventEntries:i,qualifyingOnly:n}){return(n&&[]||Xce(e)||(t?i:[])).filter(({entryStage:r})=>!r||r===xt)}function Qxe(t){let{tournamentRecord:e,event:i}=t,n=dn({tournamentRecord:e,event:i}).appliedPolicies??{},r=Ot(t.policyDefinitions??{},!1,!0);return{appliedPolicies:n,policyDefinitions:r}}function eOe({enforceGender:t,policyDefinitions:e,appliedPolicies:i}){var n,r,a,o;return t??((r=(n=e==null?void 0:e[Qa])==null?void 0:n.participants)==null?void 0:r.enforceGender)??((o=(a=i==null?void 0:i[Qa])==null?void 0:a.participants)==null?void 0:o.enforceGender)}function tOe(t){let{consideredEntries:e,appliedPolicies:i,policyDefinitions:n,enforceGender:r,participantMap:a,participants:o,event:s}=t;return s&&o&&zx({consideredEntries:e,policyDefinitions:n,appliedPolicies:i,participantMap:a,enforceGender:r,participants:o,event:s})}function iOe(t){return!t.drawSize&&t.consideredEntries.length&&![Fc,sC,DT,Cu,mh].includes(t.drawType??"")&&UT(t.consideredEntries.length)||t.drawSize&&ri(t.drawSize)||!1}function nOe(t){var o,s;let{tournamentRecord:e,event:i,ignoreAllowedDrawTypes:n,drawType:r}=t,a=!n&&e&&eO({tournamentRecord:e,categoryType:(o=i==null?void 0:i.category)==null?void 0:o.categoryType,categoryName:(s=i==null?void 0:i.category)==null?void 0:s.categoryName});return a!=null&&a.length&&!a.includes(r)?{error:RH}:{...ce}}function lP(t){let{voluntaryConsolation:e,tournamentRecord:i,event:n}=t,r="generateDrawDefinition",{participants:a,participantMap:o}=Nr({withIndividualParticipants:!0,convertExtensions:!0,internalUse:!0,tournamentRecord:i}),s=Xce(n==null?void 0:n.entries)??[],l=Zxe({...t,participantMap:o,participants:a,eventEntries:s});if(l.error)return pe({result:l,stack:r});let{appliedPolicies:c,policyDefinitions:u,drawSize:d,drawType:p,enforceGender:h,seedingProfile:f}=l,m=n==null?void 0:n.eventType,g=t.matchUpType??m,v=rxe({...t,enforceGender:h,eventType:m,matchUpType:g});if(v.error)return pe({result:v,stack:r});let{matchUpFormat:y,tieFormat:b}=v;if(t.drawId&&typeof t.drawId!="string")return pe({result:{error:Re},stack:r});let I=Axe({...t,isMock:t.isMock??!0,policyDefinitions:u,tournamentRecord:i,appliedPolicies:c,matchUpFormat:y,seedingProfile:f,participants:a,eventEntries:s,matchUpType:g,tieFormat:b,drawSize:d,drawType:p,event:n});if(I.error)return pe({result:I,stack:r});let{existingDrawDefinition:T,positioningReports:w,drawDefinition:S,structureId:D,conflicts:E,entries:C}=I;if(!S)return pe({result:{error:Re},stack:r});let P=_xe({...t,existingDrawDefinition:T,positioningReports:w,appliedPolicies:c,drawDefinition:S,seedingProfile:f,participants:a,structureId:D,entries:C,params:t,stack:r});if(P.error)return P;let{qualifyingConflicts:R}=P;return S.drawName=t.drawName??(p&&Eo(p)),d&&typeof e=="object"&&d>=4&&Iq({...e,drawDefinition:S,matchUpType:g}),{existingDrawDefinition:!!T,qualifyingConflicts:R,positioningReports:w,drawDefinition:S,structureId:D,...ce,conflicts:E}}function Jce({scaleAttributes:t,scaledEntries:e,stageEntries:i,seedsCount:n,scaleName:r}){if(!t)return{error:Yt,info:"missing scaleAttributes"};let a=Object.assign({},...(e||[]).slice(0,n).map(({participantId:s},l)=>({[s]:l+1})));r=r||t.scaleName;let o=new Date().toISOString();return{scaleItemsWithParticipantIds:i.map(({participantId:s})=>({scaleItems:[{scaleValue:a[s],eventType:t.eventType,scaleType:Qp,scaleName:r,scaleDate:o}],participantId:s}))}}function rOe({tournamentRecord:t,drawDefinition:e,policyDefinitions:i,scaleAttributes:n,scaleName:r,drawSize:a,drawId:o,event:s,stage:l,sortDescending:c,scaleSortMethod:u}){let d=cO({policyDefinitions:i,drawDefinition:e,drawSize:a,drawId:o,event:s,stage:l});if(d.error)return d;let{entries:p,seedsCount:h,stageEntries:f}=d;if(!f||!h)return{error:Re};let m=ZI({tournamentRecord:t,scaleAttributes:n,scaleSortMethod:u,sortDescending:c,entries:p,stage:l}).scaledEntries??[],{scaleItemsWithParticipantIds:g}=Jce({scaleAttributes:n,scaledEntries:m,stageEntries:f,seedsCount:h,scaleName:r});return{scaleItemsWithParticipantIds:g}}var X3={};$i(X3,{addDrawEntries:()=>gq,addEventEntries:()=>ih,addEventEntryPairs:()=>nue,destroyPairEntries:()=>moe,destroyPairEntry:()=>bq,getEntriesAndSeedsCount:()=>cO,getMaxEntryPosition:()=>O3,modifyEntriesStatus:()=>RA,modifyEventEntries:()=>rue,mutate:()=>Qce,promoteAlternate:()=>tue,promoteAlternates:()=>Q3,query:()=>Hce,removeDrawEntries:()=>iue,removeEventEntries:()=>OC,setEntryPosition:()=>J3,setEntryPositions:()=>eue});var Qce={};$i(Qce,{addDrawEntries:()=>gq,addEventEntries:()=>ih,addEventEntryPairs:()=>nue,destroyPairEntries:()=>moe,destroyPairEntry:()=>bq,modifyEntriesStatus:()=>RA,modifyEventEntries:()=>rue,promoteAlternate:()=>tue,promoteAlternates:()=>Q3,removeDrawEntries:()=>iue,removeEventEntries:()=>OC,setEntryPosition:()=>J3,setEntryPositions:()=>eue});function J3({tournamentRecord:t,drawDefinition:e,participantId:i,entryPosition:n,skipRefresh:r,event:a}){let o="setEntryPositions";if(!t)return{error:ut};if(!i)return pe({result:{error:ya},stack:o});if(n!==void 0&&!Number.isSafeInteger(n))return{error:Re,entryPosition:n};((a==null?void 0:a.entries)||[]).forEach(l=>{l.participantId===i&&(l.entryPosition=n)}),((e==null?void 0:e.entries)||[]).forEach(l=>{l.participantId===i&&(l.entryPosition=n)});let s=l=>{l.entries.forEach(c=>{c.entryPosition===n&&c.participantId!==i&&(c.entryPosition+=.1)})};return r||(a!=null&&a.entries&&(s(a),a.entries=hd({entries:a.entries})),e!=null&&e.entries&&(s(e),e.entries=hd({entries:e.entries}))),{...ce}}function eue({tournamentRecord:t,entryPositions:e,drawDefinition:i,event:n}){if(!t)return{error:ut};if(!Array.isArray(e))return{error:Re};for(let r of e){let{participantId:a,entryPosition:o}=r,s=J3({skipRefresh:!0,tournamentRecord:t,drawDefinition:i,participantId:a,entryPosition:o,event:n});if(s.error)return s}return n!=null&&n.entries&&(n.entries=hd({entries:n.entries})),i!=null&&i.entries&&(i.entries=hd({entries:i.entries})),{...ce}}function tue(t){let{participantId:e}=t;return e&&typeof e!="string"?{error:Re,participantId:e}:Q3({...t,participantIds:[e].filter(Boolean)})}function Q3({tournamentRecord:t,drawDefinition:e,participantIds:i,stageSequence:n,stage:r=xt,eventId:a,event:o}){if(!t)return{error:ut};if(!Array.isArray(i))return{error:Re,participantIds:i};if(!o)return{error:Qn};let s="promoteAlternates";if(o){let l=DY({element:o,participantIds:i,stageSequence:n,stage:r});if(l.error)return l}if(e){let l=DY({element:e,participantIds:i,stageSequence:n,stage:r});if(l.error)return a?pe({context:{drawPromotionError:l.error,drawId:e.drawId},result:{...ce},stack:s}):l}return{...ce}}function DY({participantIds:t,stageSequence:e,element:i,stage:n}){let r=(i.entries||[]).filter(d=>d.entryStatus===yu),a=(i.entries||[]).filter(d=>t.includes(d.participantId)),o=r.reduce((d,p)=>{let{entryPosition:h}=p;return isNaN(h)&&d||(!d||h<d.entryPosition)&&p||d},void 0),s=a.length?a:[o].filter(Boolean);if(!(s!=null&&s.length))return{error:Lne};let l=s.filter(({entryStatus:d})=>d!==yu);if(l.length)return{error:O2,invalidEntryStatus:l};let c=s.filter(({entryStage:d})=>d&&d!==n);if(c.length)return{error:yPe,invalidStage:c};let u=e&&s.filter(d=>d.stageSequence!==e);if(u!=null&&u.length)return{error:bPe,invalidStageSequence:u};for(let d of s){d.entryStatus=Rl;let p=d==null?void 0:d.entryPosition;isNaN(p)||i.entries.forEach(f=>{f.entryStatus===yu&&f.entryPosition>p&&(f.entryPosition=f.entryPosition-1)});let h=Math.max(...i.entries.filter(f=>f.entryStatus===Rl&&!isNaN(f.entryPosition)).map(({entryPosition:f})=>ri(f||0)),0);d.entryPosition=h||0}return{...ce}}function iue({autoEntryPositions:t=!0,participantIds:e,drawDefinition:i,drawId:n,stages:r,event:a}){var u;if(!a)return{error:Qn};if(!n)return{error:Pd};if(!(e!=null&&e.length))return{error:Ig};let o=Ey({drawDefinition:i,stages:r}).assignedParticipantIds??[];if(Ts(o,e))return{error:wT};let s=d=>{let p=d.participantId;return!e.includes(p)},{flightProfile:l}=Zr({event:a}),c=(u=l==null?void 0:l.flights)==null?void 0:u.find(d=>d.drawId===n);return c!=null&&c.drawEntries&&(c.drawEntries=c.drawEntries.filter(s),t&&(c.drawEntries=hd({entries:c.drawEntries}))),i!=null&&i.entries&&(i.entries=i.entries.filter(s),t&&(i.entries=hd({entries:i.entries}))),{...ce}}function mp(t){var m,g,v,y,b;let e="addParticipant",{allowDuplicateParticipantIdPairs:i,returnParticipant:n,disableNotice:r,pairOverride:a,participant:o}=t,s=t.tournamentId?(m=t.tournamentRecords)==null?void 0:m[t.tournamentId]:t.tournamentRecord??(t.activeTournamentId&&((g=t.tournamentRecords)==null?void 0:g[t.activeTournamentId]));if(!s)return{error:ut};if(!o)return pe({result:{error:NI},stack:e});o.participantId||(o.participantId=Pn()),s.participants||(s.participants=[]);let{participantId:l,individualParticipantIds:c}=o;if(s.participants.reduce((I,T)=>T.participantId===l||I,!1))return{error:Ane};let{participantType:u,participantRole:d}=o;if(!u||!Object.keys($0).includes(u))return{error:yd,participantType:u};if(!d)return{error:Nne};let p=s.participants||[],h=p.filter(I=>I.participantType===Hi).map(I=>I.participantId);if(u!==Hi&&o.person)return{error:Re,person:o.person};if(c&&!Array.isArray(c))return{error:Re,individualParticipantIds:c};if(u===Ti){if(o.person)return{error:Re,person:o.person};if(o.individualParticipantIds){if(o.individualParticipantIds.length!==2&&!a)return pe({info:"PAIR must be 2 individualParticipantIds",result:{error:Ul},stack:e});{let w=p.filter(S=>S.participantType===Hi).map(S=>S.participantId);if(!Array.isArray(o.individualParticipantIds))return pe({result:{error:Ul},stack:e});if(!o.individualParticipantIds.reduce((S,D)=>w.includes(D)&&S,!0))return pe({result:{error:Ul},stack:e})}}else return pe({result:{error:Ig},stack:e});let I=p.filter(w=>w.participantType===Ti).map(w=>({individualParticipantIds:w.individualParticipantIds,participant:w})),T=o.participantType===Ti&&I.find(w=>zr(w.individualParticipantIds,o.individualParticipantIds).length===2);if(T&&!i)return{...ce,existingParticipant:!0,participant:n&&Ot(T.participant)};if(!o.participantName){let w=p.filter(D=>{var E;return(E=o.individualParticipantIds)==null?void 0:E.includes(D.participantId)}),S=w.map(D=>{var E;return(E=D.person)==null?void 0:E.standardFamilyName}).filter(Boolean).join("/");w.length===1&&(S+="/Unknown"),o.participantName=S}}else if(u===Hi){if(!((v=o.person)!=null&&v.standardFamilyName)||!((y=o.person)!=null&&y.standardGivenName))return{error:One};if(!o.participantName){let I=`${o.person.standardFamilyName.toUpperCase()}, ${o.person.standardGivenName}`;o.participantName=I}}else if(u&&[On,ac].includes(u)){if(c||(o.individualParticipantIds=[]),(b=o.individualParticipantIds)==null?void 0:b.length)for(let I of o.individualParticipantIds){if(typeof I!="string")return pe({result:{participantId:I,error:Re},stack:e});if(!h.includes(I))return pe({result:{participantId:I,error:Vr},stack:e})}}else return{error:yd};s.participants.push(o),r||wi({payload:{tournamentId:s.tournamentId,participants:[o]},topic:Wm});let f={participant:n&&Ot(o),...ce};return zt(f)}function Nu({allowDuplicateParticipantIdPairs:t,returnParticipants:e,tournamentRecord:i,participants:n=[]}){if(!i)return{error:ut};i.participants||(i.participants=[]);let r=i.participants.map(d=>d.participantId)||[];n.forEach(d=>{d.participantId||(d.participantId=Pn())});let a=n.filter(d=>!r.includes(d.participantId)),o=n.filter(d=>r.includes(d.participantId)),s=a.filter(d=>d.participantType===Hi),l=a.filter(d=>d.participantType!==Hi),c=s.concat(...l),u=[];if(c.length){for(let p of c){let h=mp({allowDuplicateParticipantIdPairs:t,returnParticipant:!0,disableNotice:!0,tournamentRecord:i,participant:p});if(h.error)return h;h.success&&!h.existingParticipant&&u.push(h.participant)}u.length&&wi({topic:Wm,payload:{tournamentId:i.tournamentId,participants:u}});let d={participants:e&&Ot(u),addedCount:u.length,...ce};return o.length&&Object.assign(d,{notAdded:o,info:$k}),zt(d)}else return{info:"No new participants to add",addedCount:0,...ce}}function nue(t){let e=di(t,[{[ls]:!0,[by]:!0}]);if(e.error)return e;let{allowDuplicateParticipantIdPairs:i,entryStatus:n=yu,participantIdPairs:r=[],entryStage:a=xt,tournamentRecord:o,drawDefinition:s,event:l,uuids:c}=t;if(l.eventType!==zn)return{error:ph};let u=[],d=new Map;for(let I of o.participants??[]){let{participantType:T,participantId:w,person:S,individualParticipantIds:D}=I;T===Hi&&(S!=null&&S.sex)?d.set(w,S.sex):T===Ti&&D&&u.push(D)}let p=r.filter(I=>{if(I.length!==2)return!0;if(!l.gender||l.gender===Id)return!1;if(!d.has(I[0])||!d.has(I[1]))return!0;let T=I.map(S=>d.get(S)),w=l.gender===Gn&&(T[0]!==Gn||T[1]!==Gn)||l.gender===hr&&(T[0]!==hr||T[1]!==hr);return l.gender===nl&&(T.sort(Px),(T[0]!==hr||T[1]!==Gn)&&(w=!0)),w});if(p.length)return{error:Ul,invalidParticipantIdPairs:p};let h=r.map(I=>({participantId:(c==null?void 0:c.pop())??Pn(),participantRole:Do,individualParticipantIds:I,participantType:Ti})),f=i?h:h.filter(I=>!u.find(T=>zr(T,I.individualParticipantIds).length===2)),m,g=[];if(f){let I=Nu({allowDuplicateParticipantIdPairs:i,participants:f,returnParticipants:!0,tournamentRecord:o});if(I.error)return I;g=I.participants||[],m=I.info}let v=r.map(I=>{let T=g.find(S=>zr(S.individualParticipantIds,I).length===2);if(T)return T;let{participant:w}=Mu({tournamentRecord:o,participantIds:I});return w}).map(I=>I.participantId),y=ih({participantIds:v,tournamentRecord:o,drawDefinition:s,entryStatus:n,entryStage:a,event:l});f.length&&wi({payload:{participants:f},topic:Wm});let b=f.map(Gi);return{...y,info:m,newParticipantIds:b}}function rue({entryStatus:t=Rl,unpairedParticipantIds:e=[],participantIdPairs:i=[],entryStage:n=xt,tournamentRecord:r,event:a}){if(!r)return{error:ut};if(!a)return{error:Qn};let o=r.participants??[],s=o.filter(m=>m.participantType===Hi).map(m=>m.participantId),l=e.concat(...i).flat(1/0).filter(m=>!s.includes(m));if(l.length)return{error:Ul,invalidParticipantIds:l};let c=i.filter(m=>m.length!==2);if(c.length)return{error:Ul,invalidParticipantIdPairs:c};let u=o.filter(m=>m.participantType===Ti).map(m=>m.individualParticipantIds),d=i.filter(m=>!u.find(g=>zr(g,m).length===2)).map(m=>({participantType:Ti,participantRole:Do,individualParticipantIds:m})),p=Nu({participants:d,tournamentRecord:r});if(p.error)return p;let h=i.map(m=>{let{participant:g}=Mu({tournamentRecord:r,participantIds:m});return g}).map(m=>({participantId:m,entryStatus:t,entryStage:n})),f=e.map(m=>({entryStatus:Fu,participantId:m,entryStage:n}));return a.entries=(a.entries??[]).filter(m=>m.entryStage===n),a.entries=a.entries.concat(...h,...f),{...ce}}var eW={};$i(eW,{addDrawDefinition:()=>cP,addEvent:()=>uP,addFlight:()=>vO,assignSeedPositions:()=>fue,attachFlightProfile:()=>lW,categoryCanContain:()=>WC,deleteDrawDefinitions:()=>fO,deleteEvents:()=>gue,deleteFlightAndFlightDraw:()=>pue,deleteFlightProfileAndFlightDraws:()=>lue,getCategoryAgeDetails:()=>eI,getEvent:()=>Z3,getEventProperties:()=>K3,getEventStructures:()=>Ax,getEventTimeItem:()=>vC,getEvents:()=>Y3,getFlightProfile:()=>Zr,getScaledEntries:()=>ZI,modifyEvent:()=>vue,modifyEventMatchUpFormatTiming:()=>cue,modifyPairAssignment:()=>hue,mutate:()=>aue,query:()=>Zce,refreshEventDrawOrder:()=>sW,removeEventMatchUpFormatTiming:()=>mO,removeScaleValues:()=>cW,removeSeeding:()=>mue,setEventDates:()=>aW,setEventDisplay:()=>gO,setEventEndDate:()=>rW,setEventStartDate:()=>nW,updateDrawIdsOrder:()=>oW,validateCategory:()=>jD});var aue={};$i(aue,{addDrawDefinition:()=>cP,addEvent:()=>uP,addFlight:()=>vO,assignSeedPositions:()=>fue,attachFlightProfile:()=>lW,deleteDrawDefinitions:()=>fO,deleteEvents:()=>gue,deleteFlightAndFlightDraw:()=>pue,deleteFlightProfileAndFlightDraws:()=>lue,modifyEvent:()=>vue,modifyEventMatchUpFormatTiming:()=>cue,modifyPairAssignment:()=>hue,refreshEventDrawOrder:()=>sW,removeEventMatchUpFormatTiming:()=>mO,removeScaleValues:()=>cW,removeSeeding:()=>mue,setEventDates:()=>aW,setEventDisplay:()=>gO,setEventEndDate:()=>rW,setEventStartDate:()=>nW,updateDrawIdsOrder:()=>oW,validateCategory:()=>jD});function WT({removePriorValues:t=!0,status:e=oc,statusObject:i,event:n}){if(!Xi(i))return{error:Re};let r=Yc({event:n,status:e}),a=`${Cg}.${Pg}`,o={itemValue:{[e]:{...r,...i}},itemType:a};return YI({timeItem:o,removePriorValues:t,event:n})}function KT(t){var T,w,S,D,E,C,P;let e=di(t,[{[ls]:!0,[by]:!0},{eventDataParams:!1,[$l]:vl}]);if(e.error)return e;let{includePositionAssignments:i,removePriorValues:n,tournamentRecord:r,status:a=oc,event:o,drawIdsToRemove:s,drawIdsToAdd:l}=t,{appliedPolicies:c}=dn({tournamentRecord:r,event:o}),u={...c,...t.policyDefinitions},d=((T=o==null?void 0:o.drawDefinitions)==null?void 0:T.map(({drawId:R})=>R))??[],p=t.drawDetails?Object.keys(t.drawDetails):[],h=p.length?[]:t.drawIds,f=(l??[]).concat(...s??[],...h??[],...p),m=f.filter(R=>!d.includes(R));if(m.length)return pe({result:{error:Zl},context:{invalidDrawIds:m}});let g=Yc({event:o,status:a}),v=Object.keys((g==null?void 0:g.drawDetails)||{}).filter(R=>d.includes(R)).reduce((R,N)=>(R[N]=g.drawDetails[N],R),{});for(let R of d)if((!f.length||f.includes(R))&&(s!=null&&s.includes(R)||h!=null&&h.length&&!h.includes(R)?v[R]={...v[R],publishingDetail:{published:!1}}:(l!=null&&l.includes(R)||h!=null&&h.includes(R)||!(h!=null&&h.length))&&(v[R]={...v[R],publishingDetail:{published:!0}})),(w=t.drawDetails)==null?void 0:w[R]){let N=t.drawDetails[R],M=N.structureDetails??v[R].structureDetails,A=N.stageDetails??v[R].stageDetails??{},{structureIdsToRemove:_=[],structureIdsToAdd:x=[],publishingDetail:O={},stagesToRemove:B=[],stagesToAdd:F=[]}=N;if((x||F)&&(O.published=!0),v[R]={publishingDetail:O,structureDetails:M,stageDetails:A},x.length||_.length){let H=(((D=(S=o==null?void 0:o.drawDefinitions)==null?void 0:S.find(q=>q.drawId===R))==null?void 0:D.structures)??[]).map(({structureId:q})=>q),$=(x??[]).concat(_??[]).filter(q=>!H.includes(q));if($.length)return pe({result:{error:wr},context:{invalidStructureIds:$}});M=M??{};for(let q of H)_.includes(q)?M[q]={published:!1}:M[q]={published:!0};v[R].structureDetails=M}let G=(((C=(E=o==null?void 0:o.drawDefinitions)==null?void 0:E.find(H=>H.drawId===R))==null?void 0:C.structures)??[]).map(({stage:H})=>H);if(F.length){for(let H of F)A[H]={published:!0};for(let H of G)A[H]||(A[H]={published:!1})}if(F.length||B.length){for(let H of B)A[H]={published:!1};for(let H of G)A[H]||(A[H]={published:!0})}(F.length||B.length)&&(v[R].stageDetails=A)}WT({statusObject:{drawDetails:v},removePriorValues:n,status:a,event:o});let{topics:y}=rc(),b=y.includes(H2),I=b||t.returnEventData?(P=rO({includePositionAssignments:i,...t.eventDataParams,usePublishState:!0,tournamentRecord:r,policyDefinitions:u,event:o}))==null?void 0:P.eventData:void 0;return b&&wi({payload:{eventData:I,tournamentId:r.tournamentId},topic:H2}),{...ce,eventData:I}}var oue="deleteDrawDefinitions",IV="autoSchedulingAudit",CN="deleteEvents",sue={AUTO_SCHEDULING_AUDIT:IV,DELETE_EVENTS:CN,DELETE_DRAW_DEFINITIONS:oue};function fO(t){var D,E,C,P,R;if(!t.tournamentRecord)return{error:ut};let e="deleteDrawDefinitions",i=t.drawIds??[],n=t.event,{autoPublish:r=!0,tournamentRecord:a,auditData:o,eventId:s,force:l}=t,{appliedPolicies:c}=dn({tournamentRecord:a,event:n}),u={...c,...t.policyDefinitions},d=Array.isArray(i)?i[0]:void 0;if(!n){let N=zs({tournamentRecord:a,eventId:s,drawId:d});if(N.error)return N;n=N.event}let p=[],h=[],f=[];if(!(n!=null&&n.drawDefinitions))return pe({info:"event has no drawDefinition",result:{...ce},stack:e});let m=n.drawDefinitions.map(({drawId:N})=>N);if(i.length||(i=m),i=i.filter(N=>m.includes(N)),!i.length)return pe({info:"nothing to do; no matching drawIds in event.",result:{...ce},stack:e});let g=Ot(Zr({event:n}).flightProfile,!1,!0),v=({participantId:N,drawPosition:M,qualifier:A,bye:_})=>({bye:_,qualifier:A,drawPosition:M,participantId:N}),y=l??((E=(D=c==null?void 0:c[Bc])==null?void 0:D.allowDeletionWithScoresPresent)==null?void 0:E.drawDefinitions),b=Yc({event:n})??{},I=b.drawIds??(b.drawDetails&&Object.keys(b.drawDetails))??[],T,w=[],S=n.drawDefinitions.filter(N=>{var M,A,_,x,O,B,F,G;if(i.includes(N.drawId)){let H=((M=ws({event:n,drawDefinition:N}))==null?void 0:M.matchUps)??[];if(H.some(({score:me})=>Pa({score:me}))&&!y)return w.push(N.drawId),!0;let{drawId:$,drawType:q,drawName:z}=N,Z=(A=g==null?void 0:g.flights)==null?void 0:A.find(me=>me.drawId===N.drawId);Z&&(Z.drawEntries=(_=Z.drawEntries)==null?void 0:_.filter(me=>Bu.includes(me.entryStatus))),I.includes($)&&(I=I.filter(me=>me!==$),T=!0);let Y=(O=(x=Ru({stageSequence:1,drawDefinition:N,stage:xt}))==null?void 0:x.structures)==null?void 0:O[0],Q=(F=(B=Y?GD({structureId:Y.structureId,tournamentRecord:a,drawDefinition:N}):void 0)==null?void 0:B.positionAssignments)==null?void 0:F.map(v),X=(G=Ru({stage:Zt,drawDefinition:N}))==null?void 0:G.structures,oe=X!=null&&X.length?X.map(me=>{var te;let se=me.stageSequence;return{positionAssignments:(te=GD({structureId:me.structureId,tournamentRecord:a,drawDefinition:N}))==null?void 0:te.positionAssignments.map(v),stageSequence:se}}):void 0,re={action:oue,payload:{drawDefinitions:[N],eventId:s??(n==null?void 0:n.eventId),auditData:o}};f.push(re),p.push(zt({tournamentId:a.tournamentId,eventId:s??(n==null?void 0:n.eventId),qualifyingPositionAssignments:oe,positionAssignments:Q,auditData:o,drawType:q,drawName:z,drawId:$})),H==null||H.forEach(({matchUpId:me})=>h.push(me))}return!i.includes(N.drawId)});if(w.length&&!l)return pe({context:{drawIdsWithScoresPresent:w},result:{error:zk},stack:e});if(n.drawDefinitions=S,g&&Ug({event:n,extension:{name:Pu,value:g}}),aP({tournamentRecord:a}),T){let N={};for(let A of I)N[A]=((C=b.drawDetails)==null?void 0:C[A])??{published:!0};let M=WT({statusObject:{drawDetails:N},event:n});if(M.error)return{error:M.error}}if(f.length)if(Wk(gf)){let N=a.tournamentId;wi({topic:gf,payload:{tournamentId:N,detail:f}});let M=(((R=(P=Wc({element:n,itemType:Cv}))==null?void 0:P.timeItem)==null?void 0:R.itemValue)||0)+1;Np({element:n,timeItem:{itemType:Cv,itemValue:M},removePriorValues:!0})}else aOe({appliedPolicies:c,event:n,deletedDrawsDetail:p,auditData:o});if(h.length&&Qf({tournamentId:a==null?void 0:a.tournamentId,matchUpIds:h}),i.forEach(N=>iMe({drawId:N})),r&&T){let N=KT({...t.eventDataParams,drawIdsToRemove:i,policyDefinitions:u,tournamentRecord:a,event:n});if(N.error)return{...ce,info:N.error}}return{...ce}}function aOe({appliedPolicies:t,event:e,deletedDrawsDetail:i,auditData:n}){var s;if(((s=t==null?void 0:t.audit)==null?void 0:s[Cv])===!1)return;let{extension:r}=Ri({name:Cv,element:e}),a={...n,deletedDrawsDetail:i},o={value:Array.isArray(r==null?void 0:r.value)?r==null?void 0:r.value.concat(a):[a],name:Cv};cn({element:e,extension:o})}function lue({autoPublish:t=!0,tournamentRecord:e,auditData:i,event:n,force:r}){var o;if(!e)return{error:ut};if(!n)return{error:Qn};let{flightProfile:a}=Zr({event:n});if(a){let s=(o=a.flights)==null?void 0:o.map(({drawId:c})=>c).filter(Boolean),l=fO({eventId:n.eventId,tournamentRecord:e,autoPublish:t,auditData:i,drawIds:s,event:n,force:r});return l.error?l:sx({event:n,name:Pu})}return{...ce}}function tW(t){let{matchUpFormat:e,recoveryTimes:i,averageTimes:n,tournamentId:r,eventId:a}=t,o=(t==null?void 0:t.tournamentRecords)??((t==null?void 0:t.tournamentRecord)&&{[t.tournamentRecord.tournamentId]:t.tournamentRecord})??{};if(!Object.keys(o).length)return{error:Sr};let s=Object.keys(o).filter(c=>!r||r===c);if(r&&!s.includes(r))return{error:Re};let l;for(let c of s){let u=o[c],{event:d}=zs({tournamentRecord:u,eventId:a});a&&d&&(l=!0);let p=oOe({tournamentRecord:u,event:d,matchUpFormat:e,averageTimes:n,recoveryTimes:i});if(p.error)return p}return!a||l?{...ce}:{error:Xl}}function oOe({tournamentRecord:t,recoveryTimes:e,matchUpFormat:i,averageTimes:n,event:r}){if(!t)return{error:ut};if(n&&!Array.isArray(n))return{error:Re};if(e&&!Array.isArray(e))return{error:Re};let a=Pf;if(r){let{extension:o}=Ri({element:r,name:a}),s=(o==null?void 0:o.value)||{},l=EY({...s,matchUpFormat:i,averageTimes:n,recoveryTimes:e});cn({element:r,extension:{name:a,value:l}})}else{let{extension:o}=Ri({element:t,name:a}),s=(o==null?void 0:o.value)||{},l=EY({...s,matchUpFormat:i,averageTimes:n,recoveryTimes:e});cn({extension:{name:a,value:l},element:t})}return{...ce}}function EY(t){let{matchUpRecoveryTimes:e=[],matchUpAverageTimes:i=[],matchUpFormat:n}=t,{averageTimes:r,recoveryTimes:a}=t;r=(r||[]).filter(l=>{var c,u;return((c=l==null?void 0:l.categoryNames)==null?void 0:c.length)||((u=l==null?void 0:l.categoryTypes)==null?void 0:u.length)});let o=(r==null?void 0:r.length)&&i.map(l=>{var c;return l!=null&&l.matchUpFormatCodes.includes(n)?{...l,matchUpFormatCodes:(c=l.matchUpFormatCodes)==null?void 0:c.filter(u=>u!==n)}:l}).filter(({matchUpFormatCodes:l})=>l==null?void 0:l.length).concat({matchUpFormatCodes:[n],averageTimes:r});a=(a||[]).filter(l=>{var c,u;return((c=l==null?void 0:l.categoryNames)==null?void 0:c.length)||((u=l==null?void 0:l.categoryTypes)==null?void 0:u.length)});let s=(a==null?void 0:a.length)&&e.map(l=>{var c;return l!=null&&l.matchUpFormatCodes.includes(n)?{...l,matchUpFormatCodes:(c=l.matchUpFormatCodes)==null?void 0:c.filter(u=>u!==n)}:l}).filter(({matchUpFormatCodes:l,averageTimes:c})=>(l==null?void 0:l.length)||c).concat({matchUpFormatCodes:[n],recoveryTimes:a});return{matchUpAverageTimes:(o==null?void 0:o.length)&&o||i,matchUpRecoveryTimes:(s==null?void 0:s.length)&&s||e}}function cue(t){let{tournamentRecord:e,recoveryMinutes:i,averageMinutes:n,matchUpFormat:r,categoryType:a,eventId:o,event:s}=t;if(!e)return{error:ut};if(!Nl({matchUpFormat:r}))return{error:Re};if(!s)return{error:Qn};let{averageTimes:l=[],recoveryTimes:c=[]}=uO({tournamentRecord:e,matchUpFormat:r,event:s}),u=s.category,d=(u==null?void 0:u.categoryName)||(u==null?void 0:u.ageCategoryCode)||(s==null?void 0:s.eventId),p={categoryNames:[d],minutes:{}},h={categoryNames:[d],minutes:{}},f=b=>{var I,T;if((I=b.categoryTypes)!=null&&I.includes(a)&&console.log("encountered:",{categoryType:a}),!((T=b.categoryNames)!=null&&T.includes(d)&&(b.categoryNames=b.categoryNames.filter(w=>w!==d),p={minutes:b.minutes,categoryNames:[d]},!b.categoryNames.length)))return b},m=n&&!isNaN(ri(n)),g=i&&!isNaN(ri(i)),v=l.map(f).filter(b=>{var I;return(I=b==null?void 0:b.categoryNames)==null?void 0:I.length}),y=c.map(f).filter(b=>{var I;return(I=b==null?void 0:b.categoryNames)==null?void 0:I.length});return m&&(Object.assign(p.minutes,{[(s==null?void 0:s.eventType)||or]:n}),v.push(p)),g&&(Object.assign(h.minutes,{[(s==null?void 0:s.eventType)||or]:i}),y.push(h)),!m&&!g?{error:Re}:tW({averageTimes:m&&v,recoveryTimes:g&&y,tournamentRecord:e,matchUpFormat:r,eventId:o,event:s})}function mO(t){if(t.event)return CY({event:t.event});{t.tournamentRecord&&!t.tournamentRecords&&(t.tournamentRecords={[t.tournamentRecord.tournamentId]:t.tournamentRecord});let e=di(t,[{[zo]:!0,[Fre]:!0}]);if(e.error)return e;let{tournamentRecords:i,eventId:n}=t;for(let r of Object.values(i??{})){let{event:a}=zs({tournamentRecord:r,eventId:n});if(a)return CY({event:a})}}return{error:Xl}}function CY({event:t}){return sx({event:t,name:Pf})}var sOe="MON",lOe="TUE",cOe="WED",uOe="THU",dOe="FRI",pOe="SAT",hOe="SUN",iW={MON:sOe,TUE:lOe,WED:cOe,THU:uOe,FRI:dOe,SAT:pOe,SUN:hOe};function uue(t){return!Array.isArray(t)||Pi(t).length!==t.length?!1:t.every(e=>Object.keys(iW).includes(e))}function nW({tournamentRecord:t,event:e,startDate:i}){if(!t)return{error:ut};if(!e)return{error:Qn};if(!up.test(i))return{error:Xa};let n=due(t);if(n.error)return n;let{tournamentStartDate:r,tournamentEndDate:a}=n,o=new Date(Ei(i)).getTime();if(!r||!a||o<r||o>a)return{error:Xa};let s=e.endDate&&new Date(Ei(e.endDate)).getTime();return s&&o>s&&(e.endDate=i),e.startDate=i,{...ce}}function rW(t){let{tournamentRecord:e,event:i,endDate:n}=t;if(!e)return{error:ut};if(!i)return{error:Qn};if(!up.test(n))return{error:Xa};let r=due(e);if(r.error)return r;let{tournamentStartDate:a,tournamentEndDate:o}=r,s=new Date(Ei(n)).getTime();if(!a||!o||s<a||s>o)return{error:Xa};let l=i.startDate&&new Date(Ei(i.startDate)).getTime();return l&&s<l&&(i.startDate=n),i.endDate=n,{...ce}}function aW(t){let e=di(t,[{tournamentRecord:!0,event:!0},{[$o]:l=>up.test(l),[Ql]:Xa,startDate:!1,endDate:!1},{[$o]:l=>l.every(c=>up.test(c)),[Ql]:Xa,activeDates:!1},{[$o]:uue,weekdays:!1}]);if(e.error)return e;let{tournamentRecord:i,activeDates:n,weekdays:r,event:a,startDate:o,endDate:s}=t;if(o&&s){let l=new Date(Ei(o)).getTime(),c=new Date(Ei(s)).getTime();if(l>c)return{error:Re}}if(n){let l=o||i.startDate,c=s||i.endDate,u=!l||n.every(p=>new Date(p)>=new Date(l)),d=!c||n.every(p=>new Date(p)<=new Date(c));if(!u||!d)return{error:Xa}}if(o){let l=nW({tournamentRecord:i,event:a,startDate:o});if(l.error)return l}if(s){let l=rW({tournamentRecord:i,event:a,endDate:s});if(l.error)return l}return n&&(a.activeDates=n),r&&(a.weekdays=r),{...ce}}function due(t){let{startDate:e,endDate:i}=t;return!up.test(e)||!up.test(i)?pe({result:{error:Cne},context:{startDate:e,endDate:i}}):{tournamentStartDate:new Date(Ei(e)).getTime(),tournamentEndDate:new Date(Ei(i)).getTime()}}function oW({event:t,orderedDrawIdsMap:e}){var r,a;if(typeof t!="object")return{error:Qn};if(!e)return{error:Yt,info:"Missing drawIdsOrderMap"};if(typeof e!="object")return{error:Re,info:"orderedDrawIdsMap must be an object"};let i=Object.values(e);if(!i.every(o=>!isNaN(o)))return{error:Re,info:"drawOrder must be numeric"};if(Pi(i).length!==i.length)return{error:Re,info:"drawOrder values must be unique"};if((r=t.drawDefinitions)!=null&&r.length){let o=(t.drawDefinitions||[]).map(({drawId:l})=>l),s=Object.keys(e);if(s!=null&&s.length&&zr(o,s).length!==o.length)return{error:Re,info:"Missing drawIds"};t.drawDefinitions.forEach(l=>{l.drawOrder=e[l.drawId]})}let{flightProfile:n}=Zr({event:t});return(a=n==null?void 0:n.flights)==null||a.forEach(o=>{o.flightNumber=e[o.drawId]}),{...ce}}function sW({tournamentRecord:t,event:e}){var r;if(!t)return{error:ut};if(!e)return{error:Qn};let{flightProfile:i}=Zr({event:e}),n=(i==null?void 0:i.flights)&&Object.assign({},...i.flights.sort((a,o)=>a.flightNumber-o.flightNumber).map((a,o)=>({[a.drawId]:o+1})))||((r=e.drawDefinitions)==null?void 0:r.length)&&Object.assign({},...e.drawDefinitions.sort((a,o)=>a.drawOrder-o.drawOrder).map((a,o)=>({[a.drawId]:o+1})))||void 0;return n?oW({event:e,orderedDrawIdsMap:n}):{...ce}}function pue({autoPublish:t=!0,tournamentRecord:e,auditData:i,drawId:n,event:r,force:a}){var s,l;if(!e)return{error:ut};if(!n)return{error:Pd};if(!r)return{error:Qn};let{flightProfile:o}=Zr({event:r});if(o&&((s=o.flights)!=null&&s.find(c=>c.drawId===n))){let c=o.flights.filter(d=>d.drawId!==n),u={name:Pu,value:{...o,flights:c}};Ug({event:r,extension:u})}if((l=r.drawDefinitions)!=null&&l.find(c=>c.drawId===n)){let c=fO({drawIds:[n],eventId:r.eventId,tournamentRecord:e,autoPublish:t,auditData:i,event:r,force:a});if(c.error)return c}return sW({tournamentRecord:e,event:r})}function hue({replacementIndividualParticipantId:t,existingIndividualParticipantId:e,tournamentRecord:i,drawDefinition:n,participantId:r,event:a,uuids:o}){var f,m;if(!a)return{error:Qn};if((a==null?void 0:a.eventType)!==Oc)return{error:ph};if(o&&!Array.isArray(o))return{error:Re};if(!i)return{error:ut};if(![t,e,r].every(g=>typeof g=="string"))return{error:ya};if(!(((f=a==null?void 0:a.entries)==null?void 0:f.filter(({entryStatus:g})=>[Fu,Uy].includes(g)).map(({participantId:g})=>g))||[]).includes(t))return{error:vd};let s=(i.participants||[]).find(g=>g.participantId===r);if((s==null?void 0:s.participantType)!==Ti)return{error:MI,participant:s};let l=s.individualParticipantIds,c=[t,...l.filter(g=>g!==e)],{participant:u}=Mu({participantIds:c,tournamentRecord:i}),d;if(u)d=u.participantId;else{let g={participantId:o==null?void 0:o.pop(),participantRole:Do,individualParticipantIds:c,participantType:Ti},v=mp({participant:g,returnParticipant:!0,tournamentRecord:i});if(v.error)return v;d=v.participant.participantId}let{flightProfile:p}=Zr({event:a});if(n){let g=(m=p==null?void 0:p.flights)==null?void 0:m.find(({drawId:v})=>v===n.drawId);g&&(g.drawEntries=g.drawEntries.map(v=>v.participantId===r?{...v,participantId:d}:v)),n.entries=n.entries.map(v=>v.participantId===r?{...v,participantId:d}:v);for(let v of n.structures||[])if(v.positionAssignments)v.positionAssignments=v.positionAssignments.map(y=>y.participantId===r?{...y,participantId:d}:y);else if(v.structures)for(let y of v.structures)y.positionAssignments=y.positionAssignments.map(b=>b.participantId===r?{...b,participantId:d}:b)}a.entries=a.entries.map(g=>g.participantId===r&&{...g,participantId:d}||g.participantId===t&&{...g,participantId:e}||g);let h=i.events.some(({entries:g,eventId:v,drawDefinitions:y})=>a.eventId===v?y.some(({drawId:b,entries:I})=>b===(n==null?void 0:n.drawId)?!1:I==null?void 0:I.find(T=>T.participantId===r)):g==null?void 0:g.find(b=>b.participantId===r));if(!h){let g=zI({addIndividualParticipantsToEvents:!1,participantIds:[r],tournamentRecord:i});if(g.error)return g}return{...ce,participantOtherEntries:h,newPairParticipantId:d}}function cP(t){var R,N,M,A,_,x,O,B,F,G,H,$;let{flight:e,suppressNotifications:i,modifyEventEntries:n,existingDrawCount:r,allowReplacement:a,checkEntryStatus:o,tournamentRecord:s,drawDefinition:l,event:c}=t;if(!l)return{error:Vt};if(!c)return{error:Qn};c.drawDefinitions||(c.drawDefinitions=[]);let{drawId:u,drawName:d,entries:p}=l,{entries:h}=c,f=0;if(r!==void 0&&r!==c.drawDefinitions.length)return{error:Re,info:"drawDefintions count mismatch"};let{flightProfile:m}=Zr({event:c}),g=e&&((R=m==null?void 0:m.flights)==null?void 0:R.find(q=>q.flightNumber===e.flightNumber)),v=(A=(M=(N=m==null?void 0:m.links)==null?void 0:N.find(q=>{var z;return((z=q==null?void 0:q.target)==null?void 0:z.drawId)===u}))==null?void 0:M.source)==null?void 0:A.drawId;if(v&&!c.drawDefinitions.find(q=>q.drawId===v))return pe({result:{error:Vt},info:{sourceDrawId:v}});if(g&&g.drawId!==l.drawId)return pe({result:{error:Ib},info:{relevantFlight:g}});let y=p==null?void 0:p.every(({participantId:q,entryStatus:z})=>{let Z=g==null?void 0:g.drawEntries.find(Y=>Y.participantId===q);return!z||(Z==null?void 0:Z.entryStatus)===z}),b=!o||h&&(p==null?void 0:p.every(({participantId:q,entryStatus:z,entryStage:Z})=>{var Y;return((Y=h.find(Q=>Q.participantId===q&&(!Q.entryStage||Q.entryStage===Z)))==null?void 0:Y.entryStatus)===z}));if(g&&!y)return pe({result:{error:Ib},context:{drawEntriesPresentInFlight:y,matchingEventEntries:b,relevantFlight:g},info:"Draw entries are not present in flight or do not match entryStatuses"});if(n&&(p==null||p.filter(Boolean).forEach(q=>{if(q!=null&&q.entryStatus&&Bu.includes(q==null?void 0:q.entryStatus)){let z=h==null?void 0:h.filter(Boolean).find(Z=>Z.participantId===q.participantId);z&&q.entryStatus&&(z==null?void 0:z.entryStatus)!==q.entryStatus&&(z.entryStatus=q.entryStatus,f+=1)}})),h&&!b)return pe({result:{info:"Draw entries do not match event entryStatuses",context:{matchingEventEntries:b,eventEntries:h},error:Ib}});let I=((x=(_=m==null?void 0:m.flights)==null?void 0:_.map(({flightNumber:q})=>!isNaN(q)&&ri(q)))==null?void 0:x.filter(Boolean))||[],T=((O=c.drawDefinitions.map(({drawOrder:q})=>q&&ri(q)))==null?void 0:O.filter(Boolean))||[],w=Math.max(0,...T,...I)+1,S=(B=m==null?void 0:m.flights)==null?void 0:B.find(q=>q.drawId===u),D;if(S){S.drawName=l.drawName,D={name:Pu,value:{...m,flights:m.flights}};let q=S.flightNumber;q&&!T.includes(q)?w=q:S.flightNumber=w}else{let q=(m==null?void 0:m.flights)||[];q.push({manuallyAdded:!0,flightNumber:w,drawEntries:p,drawName:d,drawId:u}),D={name:Pu,value:{...m||{},flights:q}}}Ug({event:c,extension:D}),Object.assign(l,{drawOrder:w});let E=c.drawDefinitions.find(q=>q.drawId===u),C=s==null?void 0:s.tournamentId,P=c.eventId;if(E){if(!a)return{error:nne};let q=((G=(F=ws({drawDefinition:E}))==null?void 0:F.matchUps)==null?void 0:G.map($a))??[],z=(H=ws({drawDefinition:l}))==null?void 0:H.matchUps;if(!i){q!=null&&q.length&&Qf({matchUpIds:q,action:"modifyDrawDefinition",tournamentId:C,eventId:P}),z!=null&&z.length&&Km({matchUps:z,tournamentId:C,eventId:P}),c.drawDefinitions=c.drawDefinitions.map(Y=>Y.drawId===u?l:Y);let Z=($=l.structures)==null?void 0:$.map(({structureId:Y})=>Y);qn({drawDefinition:l,tournamentId:C,structureIds:Z,eventId:P})}}else if(c.drawDefinitions.push(l),!i){let{matchUps:q}=ws({drawDefinition:l,event:c});q&&Km({tournamentId:s==null?void 0:s.tournamentId,matchUps:q}),mC({drawDefinition:l,tournamentId:C,eventId:P})}return{...ce,modifiedEventEntryStatusCount:f}}function fue(t){let{provisionalPositioning:e,useExistingSeedLimit:i,tournamentRecord:n,drawDefinition:r,seedingProfile:a,structureId:o,assignments:s,drawId:l,event:c}=t,u=0;if(!(s!=null&&s.length))return{error:_H};if(!n)return{error:ut};if(!l)return{error:Pd};let d=Vc({provisionalPositioning:e,drawDefinition:r,structureId:o});if(d.error)return d;let{seedAssignments:p,seedLimit:h}=d,f=Object.assign({},...(p??[]).filter(v=>v.seedNumber).map(v=>({[v.seedNumber]:v})));s.forEach(v=>{let{seedNumber:y}=v;h&&y<=h&&(!i||f[y])&&(f[y]=v)});let m=Object.values(f),g=m.map(v=>v==null?void 0:v.participantId).filter(Boolean);if(g.length!==pre(g).length)return{error:rne};for(let v of m){let y=jT({...v,provisionalPositioning:e,tournamentRecord:n,drawDefinition:r,seedingProfile:a,structureId:o,event:c});if(y!=null&&y.error)return y;y!=null&&y.success&&u++}return u?{...ce,modifications:u}:{error:TT}}function lW({deleteExisting:t,event:e,flightProfile:i}){var a;let n="attachFlightProfile";if(!i)return pe({result:{error:Yt},stack:n});if(!e)return pe({result:{error:Qn},stack:n});let{flightProfile:r}=Zr({event:e});return r&&!t?pe({result:{error:XH},stack:n}):(a=e.drawDefinitions)!=null&&a.length?pe({result:{error:ene},stack:n}):(Ug({event:e,extension:{name:Pu,value:i}}),{flightProfile:Ot(i,!1,!0),...ce})}function fOe({tournamentRecord:t,scaleAttributes:e,participantIds:i}){var s;if(!t)return{error:ut};if(!i)return{error:Ig};if(!e)return{error:Yt,info:"scaleAttributes required"};let{scaleType:n,eventType:r,scaleName:a}=e,o=[_ae,n,r,a].join(".");return(s=t.participants)==null||s.forEach(l=>{i.includes(l.participantId)&&l.timeItems&&(l.timeItems=l.timeItems.filter(c=>c&&(c==null?void 0:c.itemType)!==o))}),{...ce}}function cW({tournamentRecord:t,scaleAttributes:e,drawDefinition:i,entryStatuses:n,drawId:r,event:a,stage:o}){var c;if(!a)return{error:Qn};if(n&&!Array.isArray(n))return pe({result:{error:Re},info:Zm("entryStatus"),stack:"removeScaleValues"});let s=a.entries;if(r){let{flightProfile:u}=Zr({event:a}),d=(c=u==null?void 0:u.flights)==null?void 0:c.find(p=>p.drawId===r);d?s=d.drawEntries:s=i==null?void 0:i.entries}let l=(s||[]).filter(u=>(!o||!u.entryStage||u.entryStage===o)&&(!n||n.includes(u.entryStatus))).map(Gi);return fOe({tournamentRecord:t,scaleAttributes:e,participantIds:l})}function gO({removePriorValues:t,tournamentRecord:e,displaySettings:i,status:n=oc,event:r}){if(!e)return pe({result:{error:ut}});if(!r)return pe({result:{error:Qn}});if(!Xi(i))return pe({result:{error:Yt}});if(Xi(i.draws))for(let o of Object.keys(i.draws)){let s=i.draws[o].scheduleDetails??[];if(s.length){let l=[];for(let c of s){let u=l.find(d=>rPe(d.attributes,c.attributes));u!=null&&u.dates&&c.dates?u.dates.push(...c.dates):l.push(c)}i.draws[o].scheduleDetails=l}}let a=WT({statusObject:{displaySettings:i},removePriorValues:t,status:n,event:r});return a.error?a:{...ce}}function mue({tournamentRecord:t,drawDefinition:e,entryStatuses:i,scaleName:n,drawId:r,event:a,stage:o}){var l,c;if(!t)return{error:ut};if(!a)return{error:Qn};n=n||((l=a.category)==null?void 0:l.categoryName)||((c=a.category)==null?void 0:c.ageCategoryCode);let s={eventType:a.eventType,scaleType:Qp,scaleName:n};return cW({tournamentRecord:t,scaleAttributes:s,drawDefinition:e,entryStatuses:i,drawId:r,event:a,stage:o})}function gue(t){let e=di(t,[{[ls]:!0},{eventIds:!0,[$l]:gs}]);if(e.error)return e;let{removePairParticipants:i,tournamentRecord:n,eventIds:r}=t,a=[],o=[],s=[],l=[];if(n.events=(n.events||[]).filter(c=>{if(r.includes(c.eventId)){let p={action:CN,payload:{events:[c]}};a.push(p),o.push({tournamentId:n.tournamentId,eventName:c.eventName,eventType:c.eventType,category:c.category,eventId:c.eventId,gender:c.gender})}let u=c.eventType===Oc?(c.entries||[]).map(({entryStatus:p,participantId:h})=>p!==Fu&&h).filter(Boolean):[],d=r.includes(c.eventId);return d?l.push(...u):s.push(...u),!d}),i){let c=l.filter(u=>!s.includes(u));n.participants=n.participants.filter(({participantId:u})=>!c.includes(u))}if(aP({tournamentRecord:n}),a.length)if(Wk(gf)){let c=n.tournamentId;wi({topic:gf,payload:{type:CN,tournamentId:c,detail:a}})}else XC({tournamentRecord:n,timeItem:{itemValue:o,itemType:CN}});return{...ce}}function vue(t){let e=di(t,[{tournamentRecord:!0,eventId:!0,event:!0},{eventUpdates:!0,_ofType:vl}]);if(e.error)return e;let{eventUpdates:i,event:n}=t,r="modifyEvent",a=vOe(t),o=yOe({enteredParticipants:a}),{enteredParticipantGenders:s,enteredParticipantTypes:l}=o,c=bOe({enteredParticipantGenders:s,eventUpdates:i,stack:r});if(c.error)return c;let u=IOe({enteredParticipantTypes:l,eventUpdates:i,stack:r});if(u.error)return u;let d=mOe({...t,...o,enteredParticipants:a,stack:r});if(d.error)return d;let p=gOe({...t,stack:r});return p.error?p:(i.eventType&&(n.eventType=i.eventType),i.eventName&&(n.eventName=i.eventName),i.gender&&(n.gender=i.gender),{...ce})}function mOe(t){var n,r,a,o,s,l;let e=(n=t.eventUpdates)==null?void 0:n.category;if(!e)return{...ce};let i=jD({category:e});if(i.error)return i;if(t.event.eventType===ga){let c=((a=(r=t.event)==null?void 0:r.drawDefinitions)==null?void 0:a.map(p=>Hd(p)))??[],u=Hd(t.event),d=(((o=xh(t))==null?void 0:o.matchUps)??[]).map(p=>Hd(p))??[];if(![u,...c,...d].filter(Boolean).every(p=>p.collectionDefinitions.every(h=>!h.category||WC({category:t.eventUpdates.category,childCategory:h.category}))))return pe({result:{error:ID},stack:t.stack})}if((s=t.enteredParticipants)!=null&&s.length){let c=t.eventUpdates.startDate||t.event.startDate||t.tournamentRecord.startDate,u=t.eventUpdates.endDate||t.event.endDate||t.tournamentRecord.endDate,d=t.enteredParticipants.map(f=>f.participantType===Hi?f:f.individualParticpants??[]).flat(),p=eI({category:e,consideredDate:c}),h=eI({category:e,consideredDate:u});if(p!=null&&p.ageMinDate||p!=null&&p.ageMaxDate||h!=null&&h.ageMinDate||h!=null&&h.ageMaxDate)for(let f of d){let m=(l=f.person)==null?void 0:l.birthDate;if(!m)return pe({result:{error:Tne},stack:t.stack});let g=new Date(m).getTime();if(p.ageMinDate||p.ageMaxDate){let v=new Date(p.ageMinDate).getTime(),y=new Date(p.ageMaxDate).getTime();if(g<v||g>y)return pe({result:{error:x2},stack:t.stack})}if(h.ageMin||h.ageMax){let v=new Date(h.ageMinDate).getTime(),y=new Date(h.ageMaxDate).getTime();if(g<v||g>y)return pe({result:{error:x2},stack:t.stack})}}}return{...ce}}function gOe(t){let{tournamentRecord:e,eventUpdates:i,event:n,stack:r}=t;if(i.startDate||i.endDate){let a=aW({startDate:i.startDate,endDate:i.endDate,tournamentRecord:e,event:n});if(a.error)return pe({result:a,stack:r})}return{...ce}}function vOe(t){var r;let{tournamentRecord:e,event:i}=t,n=((r=i==null?void 0:i.entries)==null?void 0:r.filter(({entryStatus:a})=>{let o=a;return[...Bu,yu].includes(o)}).map(({participantId:a})=>a))??[];return n?Nr({participantFilters:{participantIds:n},withIndividualParticipants:!0,tournamentRecord:e}).participants??[]:[]}function yOe({enteredParticipants:t}){let e=[],i=t.reduce((r,a)=>{var s,l;let o=(s=a.person)!=null&&s.sex?[a.person.sex]:((l=a.individualParticpants)==null?void 0:l.map(c=>{var u;return(u=c.person)==null?void 0:u.sex}))||[];return e.push(...o),r.includes(a.participantType)?r:r.concat(a.participantType)},[]),n=Pi(e);return{enteredParticipantTypes:i,enteredParticipantGenders:n}}function bOe({enteredParticipantGenders:t,eventUpdates:e,stack:i}){let n=!t.length||[nl,Id].includes(e.gender??"")||t.length===1&&t[0]===e.gender;return e.gender&&!n?pe({context:{gender:e.gender,validGender:n},result:{error:A1},stack:i}):{...ce}}function IOe({enteredParticipantTypes:t,eventUpdates:e,stack:i}){let n=(t.includes(ga)&&[ga]||t.includes(Hi)&&[cp]||t.includes(Ti)&&[Oc]||[Oc,cp,ga]).includes(e.eventType??"");return e.eventType&&!n?pe({context:{participantType:e.eventType,validEventType:n},result:{error:ph},stack:i}):{...ce}}function vO({qualifyingPositions:t,drawEntries:e=[],drawName:i,drawId:n,event:r,stage:a}){var h,f,m;let o="addFlight";if(!r)return pe({result:{error:Qn},stack:o});if(!i)return pe({result:{error:Yt},stack:o});if(e!=null&&e.length){let g=(r.entries??[]).map(Gi),v=e.map(Gi);if(zr(v,g).length!==v.length)return pe({result:{error:Re},stack:o})}let s=(h=Zr({event:r}))==null?void 0:h.flightProfile,l=((m=(f=s==null?void 0:s.flights)==null?void 0:f.map(({flightNumber:g})=>!isNaN(g)&&ri(g)))==null?void 0:m.filter(Boolean))||[],c=Math.max(0,...l)+1,u={drawId:n||Pn(),flightNumber:c,drawEntries:e,drawName:i};if(a&&(u.stage=a),t&&(u.qualifyingPositions=t),((s==null?void 0:s.flights)||[]).find(({drawId:g})=>g===u.drawId))return pe({result:{error:ire},stack:o});let d=((s==null?void 0:s.flights)||[]).concat(u),p={name:Pu,value:{...s||{},flights:d}};return Ug({event:r,extension:p})}var wOe={collectionDefinitions:[{collectionName:"Doubles",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7@7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"COLLEGE_D3",winCriteria:{valueGoal:5}},SOe={collectionDefinitions:[{collectionName:"Doubles",collectionValue:1,matchUpCount:3,matchUpFormat:"SET1-S:6/TB7",matchUpType:"DOUBLES"},{collectionName:"Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"COLLEGE_DEFAULT",winCriteria:{valueGoal:5}},TOe={collectionDefinitions:[{collectionName:"Doubles",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"COLLEGE_JUCO",winCriteria:{valueGoal:5}},yue={COLLEGE_D3:wOe,COLLEGE_DEFAULT:SOe,COLLEGE_JUCO:TOe,DOMINANT_DUO:Qle,DOMINANT_DUO_MIXED:Yle,LAVER_CUP:rce,TEAM_DOUBLES_3_AGGREGATION:Hle,TIME_TENNIS_DUAL:Zle,TIME_TENNIS_PRO_CIRCUIT:Kle,USTA_BREWER_CUP:Xle,USTA_OZAKI_CUP:Jle,USTA_COLLEGE:ece,USTA_GOLD_TEAM_CHALLENGE:Gle,USTA_INTERSECTIONAL:Wle,USTA_LEVEL_1:tce,USTA_SECTION_BATTLE:qle,USTA_SOUTHERN_LEVEL_5:zle,USTA_TOC:ace,USTA_WTT_ITT:ice,USTA_ZONAL:nce};function uP({suppressNotifications:t,tournamentRecord:e,internalUse:i,event:n}){var s,l,c,u;if(!e)return{error:ut};if(e.events||(e.events=[]),!n)return{error:Qn};let{startDate:r,endDate:a}=e;if(!i&&((s=n.entries)!=null&&s.length||(l=n.drawDefinitions)!=null&&l.length)){let d=zt({drawDefinitions:!!((c=n.drawDefinitions)!=null&&c.length),entries:!!((u=n.entries)!=null&&u.length)});return{info:"entries/drawDefinitions cannot exist",error:Re,context:d}}let o={eventType:qb,drawDefinitions:[],entries:[],startDate:r,endDate:a,...n};if(n.eventType===Lc){if(n.tieFormat){let d=ll({tieFormat:n.tieFormat});if(d.error)return d}else if(n.tieFormatName){if(!yue[n.tieFormatName])return{context:{tieFormatName:n.tieFormatName},error:Re};let d=Xv({isMock:e==null?void 0:e.isMock,namedFormat:n.tieFormatName,event:n});o.tieFormat=d}}if(o.eventId||(o.eventId=Pn()),e.events.reduce((d,p)=>d||p.eventId===o.eventId,void 0))return{error:hne};{let d=o;if(e.events.push(d),!t){let{topics:p}=rc();if(p.includes(px)){let h=xh({event:n}).matchUps??[];Km({tournamentId:e==null?void 0:e.tournamentId,eventId:n.eventId,matchUps:h})}for(let h of n.drawDefinitions||[])mC({drawDefinition:h})}return{...ce,event:o}}}var uW={};$i(uW,{drawMatic:()=>b3,garman:()=>Due,generateAdHocMatchUps:()=>qx,generateAdHocRounds:()=>y3,generateAndPopulatePlayoffStructures:()=>Wq,generateCourts:()=>dW,generateDrawDefinition:()=>lP,generateDrawMaticRound:()=>l3,generateDrawStructuresAndLinks:()=>a3,generateDrawTypeAndModifyDrawDefinition:()=>o3,generateFlightProfile:()=>DOe,generateLineUps:()=>Uue,generateQualifyingStructure:()=>Fq,generateSeedingScaleItems:()=>Jce,generateVoluntaryConsolation:()=>Jse,roundRobinGroups:()=>ENe});var UOe="splitLevelBased",bue="splitWaterfall",Iue="splitShuttle",wue={SPLIT_LEVEL_BASED:UOe,SPLIT_WATERFALL:bue,SPLIT_SHUTTLE:Iue};function DOe(t){let{drawNameRoot:e="Flight",attachFlightProfile:i,tournamentRecord:n,scaleAttributes:r,scaleSortMethod:a,deleteExisting:o,sortDescending:s,drawNames:l=[],flightsCount:c,splitMethod:u,uuids:d=[],event:p,stage:h}=t;if(!p)return{error:Qn};let f=p.entries??[],{flightProfile:m}=Zr({event:p});if(m&&i&&!o)return{error:XH};let g=t.scaledEntries??ZI({tournamentRecord:n,scaleAttributes:r,scaleSortMethod:a,sortDescending:s,event:p,stage:h}).scaledEntries,v=g.map(Gi),y=bs(f.filter(({participantId:C})=>!v.includes(C)).filter(C=>(!h||!C.entryStage||C.entryStage===h)&&(!C.entryStatus||Dy.includes(C.entryStatus)))),b=g.concat(...y),I=b.length,T=Math.ceil(I/c),w=ro(b,T);u===bue?w=B2(b,c):u===Iue&&(w=B2(b,c,!0));function S(C){return(C||[]).map(({participantId:P,scaleValue:R})=>{let N=f.find(M=>M.participantId===P);return N!=null&&N.scaleValue&&R&&(N.scaleValue=R),N}).sort((P,R)=>P.scaleValue-R.scaleValue).map((P,R)=>(P.scaleValue&&(P.seedNumber=R+1),P))}let D=Et(0,c).map(C=>{let P=C+1;return{flightNumber:P,drawId:(d==null?void 0:d.pop())??Pn(),drawEntries:S(w[C]),drawName:(l==null?void 0:l.length)&&l[C]||`${e} ${P}`}}),E={scaleAttributes:r,splitMethod:u,flights:D};if(i){let C=lW({flightProfile:E,deleteExisting:o,event:p});return{splitEntries:Jl()&&w||void 0,...C}}else return{flightProfile:E,...ce}}var EOe="ASC",Sue="ASC",COe="DESC",wV="DESC",Tue={ASC:EOe,ASCENDING:Sue,DESC:COe,DESCENDING:wV};function Uue(t){var P,R,N,M,A;let{tieFormat:e}=t,{useDefaultEventRanking:i,tournamentRecord:n,drawDefinition:r,scaleAccessor:a,singlesOnly:o,attach:s,event:l}=t;if((l==null?void 0:l.eventType)!==Lc)return{error:ph};if(!n)return{error:ut};if(!e&&!r)return{error:Zl};if(e=e??((P=is({drawDefinition:r,event:l}))==null?void 0:P.tieFormat),ll({tieFormat:e}).error)return{error:mf};if(typeof a!="object"&&!i)return{error:Re,context:{scaleAccessor:a}};let c={},u=((r==null?void 0:r.entries)??(l==null?void 0:l.entries)??[]).filter(_=>(_==null?void 0:_.entryStatus)===Rl).map(Gi),{participants:d=[]}=Nr({withIndividualParticipants:!0,withScaleValues:!0,tournamentRecord:n}),p=d.filter(({participantId:_})=>u.includes(_)),h=_=>_===Hm?"rankings":"ratings",f=((R=l==null?void 0:l.category)==null?void 0:R.categoryName)??((N=l==null?void 0:l.category)==null?void 0:N.ageCategoryCode),{scaleName:m=f,scaleType:g=Hm,sortOrder:v,accessor:y}=a||{},b=h(g),I=(_,x)=>{var B,F,G;let O=(B=_[b])==null?void 0:B[x];if(!O&&i&&(O=(F=_[b])==null?void 0:F[Sb]),Array.isArray(O)){let H=(G=O.find($=>$.scaleName===m))==null?void 0:G.scaleValue;if(Rr(H))return H;if(y&&typeof H=="object")return H[y]}return 0},T=(_,x,O)=>{let B=v===wV?x:_,F=v===wV?_:x;return I(B,O)-I(F,O)},w=(_,x)=>T(_,x,Sb),S=(_,x)=>T(_,x,jv),D=[],E=(e==null?void 0:e.collectionDefinitions)??[];for(let _ of p){let x=((M=_.individualParticipants)==null?void 0:M.sort(w))??[],O=o?x:((A=_.individualParticipants)==null?void 0:A.sort(S))??[],B={};for(let G of E){let H=[],{collectionId:$,matchUpCount:q,matchUpType:z,gender:Z}=G,Y=Gr(Sb)(z);Et(0,q).forEach(Q=>{let X=Y?x:O??[],oe=Q+1,re=[];Et(0,Y?1:2).forEach(me=>{var te;let se=(te=X==null?void 0:X.find(he=>{var de;let ae=Z&&([Gn,hr].includes(Z)&&Z||Z===nl&&[Gn,hr][me]);return(!ae||ae===((de=he.person)==null?void 0:de.sex))&&!H.includes(he.participantId)}))==null?void 0:te.participantId;se&&(re.push(se),H.push(se),B[se]||(B[se]=[]),B[se].push({collectionPosition:oe,collectionId:$}))}),Y||D.push(re)})}let F=Object.keys(B).map(G=>({collectionAssignments:B[G],participantId:G}));c[_.participantId]=F}let C=[];for(let _ of D){let{participant:x}=Mu({tournamentParticipants:d,participantIds:_});if(!x){let O={individualParticipantIds:_,participantRole:Do,participantType:Ti};C.push(O)}}if(s){for(;C.length;)mp({participant:C.pop(),tournamentRecord:n});cn({element:r,extension:{name:Cf,value:c}})}return{...ce,lineUps:c,participantsToAdd:C}}function dW(t){if(!t)return{error:Yt};let e=di(t,[{dates:!1,[$o]:o=>Array.isArray(o)&&o.every(Dl)},{uuids:!1,[$o]:o=>Array.isArray(o)&&o.every($r)},{startTime:!1,endTime:!1,[$o]:bz},{idPrefix:!1,namePrefix:!1,[$o]:$r},{count:!0,[$o]:Rr}]);if(e.error)return e;let{startDate:i,endDate:n}=t.tournamentRecord??{},r=t.dates||i&&n&&lS(i,n)||[],a=Et(1,t.count+1).map(o=>{var s,l;return zt({courtId:((s=t.uuids)==null?void 0:s.pop())??(t.idPrefix&&`${t.idPrefix}-${o}`)??Pn(),courtName:((l=t.courtNames)==null?void 0:l.pop())??(t.namePrefix&&`${t.namePrefix} ${o}`),dateAvailability:r.map(c=>({startTime:t.startTime??"08:00",endTime:t.endTime??"20:00",date:c}))})});return{...ce,courts:a}}var Due={};$i(Due,{default:()=>MOe,garman:()=>Pue});function dP({court:t,date:e}){let i=e&&t.dateAvailability.find(r=>vh(r.date,e)),n=t.dateAvailability.find(r=>!r.date);return i||n}function YT(t){let e=di(t,[{courtDate:!0,_ofType:vl}]);if(e.error)return e;let{includeBookingTypes:i=[],courtDate:n}=t,r=[],a=la(n.startTime);(n.bookings||[]).filter(s=>!s.bookingType||!i.includes(s.bookingType)).sort((s,l)=>bA(s.startTime).localeCompare(bA(l.startTime))).forEach(s=>{let l={startTime:ir(a.toISOString()),endTime:s.startTime};la(s.startTime)>a&&r.push(l),la(s.endTime)>a&&(a=la(s.endTime))});let o={startTime:ir(a.toISOString()),endTime:n.endTime};return la(n.endTime)>a&&r.push(o),{timeSlots:r}}function POe({averageMatchUpMinutes:t,includeBookingTypes:e,periodStartTime:i,periodEndTime:n}){let r=o=>{var l;let{timeSlots:s}=YT({includeBookingTypes:e,courtDate:o});return!!((l=s==null?void 0:s.filter(a))!=null&&l.length)};function a(o){let s=la(o.startTime),l=la(o.endTime);return s>i||l<n?!1:dC(i,l)>=t}return{enoughTime:r}}function Eue(t){let e=di(t,[{periodStart:!0,date:!0},{courts:!0,_ofType:gs}]);if(e.error)return e;let{averageMatchUpMinutes:i,includeBookingTypes:n,periodStart:r,date:a}=t,o=t.courts,s=la(r),l=Iz(s,i),{enoughTime:c}=POe({averageMatchUpMinutes:i,includeBookingTypes:n,periodStartTime:s,periodEndTime:l});return{availableToScheduleCount:((o==null?void 0:o.filter(u=>{if(!Array.isArray(u.dateAvailability))return!1;let d=dP({date:a,court:u});return!!(d&&c(d))}))||[]).length,...ce}}function yO(t){var p;let{remainingScheduleTimes:e=[],clearScheduleDates:i,periodLength:n=30,scheduleDate:r,courts:a=[]}=t,{bookings:o=[]}=t;if(!Array.isArray(a)||!a.length)return{error:Re,courts:a};if(!Array.isArray(o))return{error:fA};if(!Dl(r))return{error:Xa};i&&(Array.isArray(i)?i.includes(r)&&(o=[]):o=[]);let{courtBookings:s,unassignedBookings:l}=o.reduce((h,f)=>{let{courtId:m}=f;return m?h.courtBookings[m]?h.courtBookings[m].push(f):h.courtBookings[m]=[f]:h.unassignedBookings.push(f),h},{courtBookings:{},unassignedBookings:[]}),c=a.map((h,f)=>{let{courtId:m,courtName:g}=h,v=s[m]||[],y=dP({date:r,court:h})||{},{bookings:b=[],startTime:I,endTime:T,date:w}=y,S=[e[f]&&{startTime:I,endTime:e[f]},...Ot(b,!1,!0),...v].filter(Boolean);return{courtId:m,courtName:g,dateAvailability:{bookings:S,startTime:I,endTime:T,date:w}}});l.sort((h,f)=>an(h.startTime)-an(f.startTime));let u=()=>c.map(h=>{let f=h.dateAvailability,{timeSlots:m=[]}=YT({courtDate:f});return{courtName:h.courtName,courtId:h.courtId,timeSlots:m}}).flat(),d=[];for(let h of l){let{startTime:f,endTime:m,averageMinutes:g,recoveryMinutes:v,matchUpId:y}=h,b=an(f),I=an(m),T=u().reduce((w,{courtId:S,courtName:D,timeSlots:E})=>{let C;return E.find(({startTime:P,endTime:R})=>{C=an(P)-b;let N=b>=an(P);return I<=an(R)&&w.startDifference!==0&&((C===0||C+n>=0)&&(w.startDifference===void 0||C<w.startDifference)||N)})?{courtName:D,courtId:S,startDifference:C}:w},{});if(T.courtId){let w={averageMinutes:g,recoveryMinutes:v,matchUpId:y,startTime:f,endTime:m};d.push(w),(p=c.find(({courtId:S})=>S===T.courtId))==null||p.dateAvailability.bookings.push(w)}else console.log({unassignedBooking:h})}return{virtualCourts:c.map(({courtId:h,courtName:f,dateAvailability:m})=>({dateAvailability:[m],courtName:f,courtId:h})),assignedBookings:d}}function bO({averageMatchUpMinutes:t,periodLength:e=30,recoveryMinutes:i}){let n=(t||90)+(i||0);return e>n?n:e||30}function Cue(t){let{startTime:e="8:00",endTime:i="20:30",count:n=10,date:r}=t??{};return Et(0,n).map(()=>({dateAvailability:[{date:r,startTime:e,endTime:i}]}))}function yS({scheduleDate:t,startTime:e,endTime:i,courts:n}){let r=e&&"startTime"||i&&"endTime"||void 0;return n.reduce((a,o)=>{let s=dP({date:t,court:o}),l=r&&((s==null?void 0:s[r])||o[r]);return l&&(!a||e&&an(l)<an(a)||i&&an(l)>an(a))?l:a},void 0)}function ROe({averageMinutes:t,startTime:e,endTime:i,courts:n,date:r}){e=e||yS({courts:n,scheduleDate:r,startTime:!0}),i=i||yS({courts:n,scheduleDate:r,endTime:!0});let a;if(e&&i){let o=la(e),s=la(i);for(let l of n||[]){if(!Array.isArray(l.dateAvailability))continue;let c=dP({court:l,date:r}),{timeSlots:u}=YT({courtDate:c});u==null||u.forEach(d=>{let p=la(d.startTime),h=la(d.endTime);if(p>s||p<o||h<o)return!1;if(dC(p,h)>=t){let f=ir(p.toISOString());(!a||f<a)&&(a=f)}})}}return{firstTimeSlotStartTime:a}}function pW(t){let e=di(t,[{courts:!0,_ofType:gs}]);if(e.error)return e;let{date:i=yz(),startTime:n="08:00",endTime:r="19:00",periodLength:a,courts:o}=t,{calculateStartTimeFromCourts:s=!0,remainingScheduleTimes:l,averageMatchUpMinutes:c,clearScheduleDates:u,courtsCount:d,bookings:p}=t;a=a||bO({averageMatchUpMinutes:c}),i=Ei(i),n=ir(n),r=ir(r);let h=0,f=0,m=0,g=0,v=0;!o&&d&&(o=Cue({startTime:n,endTime:r,count:d,date:i}));let{virtualCourts:y}=yO({remainingScheduleTimes:l,clearScheduleDates:u,scheduleDate:i,periodLength:a,bookings:p,courts:o}),{firstTimeSlotStartTime:b}=ROe({averageMinutes:c,courts:y,startTime:n,endTime:r,date:i});s&&b&&(n=b||n);let I=an(n),T=an(r)-I,w=Math.floor(T/a),S=Et(0,w+1).map(D=>{let E=I+D*a,C=kRe(E),P=Eue({courts:y??[],averageMatchUpMinutes:c,periodStart:C,date:i});if(P.error)return{error:P.error};let{availableToScheduleCount:R=0}=P,N=R>f?R-f:0;v+=D?R:0;let M=D?v/D:R,A=a*M/c,_=D?A*(D-1)+M:M,x=R?f&&_-h||N:0;h=_,f=R,m+=x;let O=ri(m)-g;return g+=O,{periodStart:C,add:O,availableToScheduleCount:R,newCourts:N,totalMatchUps:g}});return{scheduleTimes:S.reduce((D,E)=>{let C=Et(0,E.add).map(()=>({scheduleTime:E.periodStart}));return D.concat(...C)},[]).flat(),timingProfile:S,totalMatchUps:g}}var Pue={getCourtsAvailableAtPeriodStart:Eue,generateTimeSlots:YT,getScheduleTimes:pW,courtGenerator:Cue},MOe=Pue,_f={};$i(_f,{isValid:()=>Nl,isValidMatchUpFormat:()=>Nl,parse:()=>Ys,stringify:()=>Bx});var hW={};$i(hW,{allCompetitionMatchUps:()=>wd,allDrawMatchUps:()=>ws,allEventMatchUps:()=>xh,allTournamentMatchUps:()=>oo,analyzeMatchUp:()=>WD,applyLineUps:()=>Zue,assignMatchUpSideParticipant:()=>Mue,assignTieMatchUpParticipantId:()=>GA,bulkMatchUpStatusUpdate:()=>que,calculateWinCriteria:()=>JI,checkInParticipant:()=>mW,checkMatchUpIsComplete:()=>Rv,checkOutParticipant:()=>fW,competitionScheduleMatchUps:()=>sP,disableTieAutoCalc:()=>Gue,drawMatchUps:()=>q3,enableTieAutoCalc:()=>$ue,eventMatchUps:()=>dO,filterMatchUps:()=>sf,findMatchUp:()=>N3,getAllDrawMatchUps:()=>Ia,getAllStructureMatchUps:()=>wn,getCheckedInParticipantIds:()=>VI,getCompetitionMatchUps:()=>qD,getEventMatchUpFormatTiming:()=>F3,getHomeParticipantId:()=>Sx,getMatchUpCompetitiveProfile:()=>EC,getMatchUpContextIds:()=>j3,getMatchUpDailyLimits:()=>hO,getMatchUpDailyLimitsUpdate:()=>B3,getMatchUpDependencies:()=>Vu,getMatchUpFormat:()=>G3,getMatchUpFormatTiming:()=>CC,getMatchUpFormatTimingUpdate:()=>L3,getMatchUpScheduleDetails:()=>Tx,getMatchUpType:()=>Dx,getMatchUpsStats:()=>H3,getModifiedMatchUpFormatTiming:()=>uO,getParticipantResults:()=>qC,getPredictiveAccuracy:()=>V3,getRoundMatchUps:()=>Us,getRounds:()=>z3,isValidMatchUpFormat:()=>Nl,matchUpActions:()=>Hx,mutate:()=>Rue,participantScheduledMatchUps:()=>$3,query:()=>zce,removeDelegatedOutcome:()=>Vue,removeMatchUpSideParticipant:()=>yW,removeTieMatchUpParticipantId:()=>Aue,replaceTieMatchUpParticipantId:()=>vW,resetAdHocMatchUps:()=>Kue,resetMatchUpLineUps:()=>DW,resetScorecard:()=>CW,resetTieFormat:()=>EW,setDelegatedOutcome:()=>Wue,setMatchUpFormat:()=>Hue,setMatchUpStatus:()=>hP,setOrderOfFinish:()=>Yue,substituteParticipant:()=>jue,tallyParticipantResults:()=>HT,toggleParticipantCheckInState:()=>IO,tournamentMatchUps:()=>pO,updateTieMatchUpScore:()=>im,validMatchUp:()=>Ux,validMatchUps:()=>Kc});var Rue={};$i(Rue,{applyLineUps:()=>Zue,assignMatchUpSideParticipant:()=>Mue,assignTieMatchUpParticipantId:()=>GA,bulkMatchUpStatusUpdate:()=>que,checkInParticipant:()=>mW,checkOutParticipant:()=>fW,disableTieAutoCalc:()=>Gue,enableTieAutoCalc:()=>$ue,findMatchUp:()=>N3,removeDelegatedOutcome:()=>Vue,removeMatchUpSideParticipant:()=>yW,removeTieMatchUpParticipantId:()=>Aue,replaceTieMatchUpParticipantId:()=>vW,resetAdHocMatchUps:()=>Kue,resetMatchUpLineUps:()=>DW,resetScorecard:()=>CW,resetTieFormat:()=>EW,setDelegatedOutcome:()=>Wue,setMatchUpFormat:()=>Hue,setMatchUpStatus:()=>hP,setOrderOfFinish:()=>Yue,substituteParticipant:()=>jue,toggleParticipantCheckInState:()=>IO,updateTieMatchUpScore:()=>im});function Mue({tournamentRecord:t,drawDefinition:e,participantId:i,sideNumber:n,matchUpId:r,event:a}){var c,u;if(i&&typeof i!="string")return{error:vd};if(!e)return{error:Vt};if(!r)return{error:ss};let o=n===void 0;if(o&&(n=1),![1,2].includes(n))return pe({result:{error:Re,context:{sideNumber:n}}});let{matchUp:s,structure:l}=nr({drawDefinition:e,matchUpId:r,event:a});if(!s)return{error:Ho};if(!(!(l!=null&&l.structures)&&!(e.drawType&&e.drawType!==Fc)&&!((c=l==null?void 0:l.matchUps)!=null&&c.find(({roundPosition:d})=>!!d))))return{error:RH};if(!i&&((u=s==null?void 0:s.score)!=null&&u.scoreStringSide1||ba.includes(s==null?void 0:s.matchUpstatus)||s!=null&&s.matchUpStatus&&[ua,Ea].includes(s.matchUpStatus)))return{error:Bk,info:"matchUp has completed status or score"};if(s){if(s.sides=[1,2].map(d=>{var h;let p=((h=s.sides)==null?void 0:h.find(f=>f.sideNumber===d))??{sideNumber:d};return n===d?{...p,participantId:i}:p}),o)for(let d of s.sides)d.sideNumber&&(d.sideNumber=3-d.sideNumber);en({tournamentId:t==null?void 0:t.tournamentId,context:"assignSideParticipant",drawDefinition:e,matchUp:s})}return{...ce,sidesSwapped:o}}function Al({removePriorValues:t,tournamentRecord:e,duplicateValues:i,drawDefinition:n,disableNotice:r,matchUpId:a,timeItem:o,event:s}){let{matchUp:l}=nr({drawDefinition:n,event:s,matchUpId:a});if(!l)return{error:Ho};let c=Np({removePriorValues:t,element:l,duplicateValues:i,timeItem:o});return r||en({tournamentId:e==null?void 0:e.tournamentId,eventId:s==null?void 0:s.eventId,context:"addTimeItem",drawDefinition:n,matchUp:l}),c}function fW(t){var y;let e=[{[ls]:!0},{[_s]:!0},{[gh]:!0},{[Cp]:!0}],i=di(t,e);if(i.error)return i;let n=qT(t,[{[CT]:_h,attr:{[ix]:!0}}]);if(n.error)return n;let{tournamentRecord:r,drawDefinition:a,participantId:o,matchUpId:s}=t,l=(y=n==null?void 0:n.matchUp)==null?void 0:y.matchUp,{matchUpStatus:c,score:u}=l??{};if(c&&dx.includes(c)||c&&ba.includes(c)||Pa({score:u}))return{error:sne};let d=VI({matchUp:l});if(d!=null&&d.error)return d;let{checkedInParticipantIds:p,allRelevantParticipantIds:h}=d??{};if(!(h!=null&&h.includes(o)))return{error:vd};if(!(p!=null&&p.includes(o)))return{error:xne};let f=Dae({matchUp:l});if(f!=null&&f.error)return f;let{sideParticipantIds:m,nestedIndividualParticipantIds:g}=f??{},v=m==null?void 0:m.indexOf(o);return v!==void 0&&[0,1].includes(v)&&((g==null?void 0:g[v])??[]).forEach(b=>{Al({drawDefinition:a,matchUpId:s,timeItem:{itemType:EA,itemValue:b}})}),Al({tournamentRecord:r,drawDefinition:a,matchUpId:s,timeItem:{itemValue:o,itemType:EA}}),{...ce,checkedOut:!0}}function mW(t){var p;let e=[{[ls]:!0},{[_s]:!0},{[gh]:!0},{[Cp]:!0}],i=di(t,e);if(i[Jp])return i;let n=qT(t,[{[CT]:_h,attr:{[ix]:!0}}]);if(n[Jp])return n;let{tournamentRecord:r,drawDefinition:a,participantId:o,matchUpId:s}=t,l=VI({matchUp:(p=n==null?void 0:n.matchUp)==null?void 0:p.matchUp});if(l!=null&&l.error)return l;let{checkedInParticipantIds:c,allRelevantParticipantIds:u}=l??{};if(!(u!=null&&u.includes(o)))return{[Jp]:vd};let d={...ce,checkedIn:!0};return c!=null&&c.includes(o)||Al({tournamentRecord:r,drawDefinition:a,matchUpId:s,timeItem:{itemValue:o,itemType:DA}}),d}function IO(t){var c,u;let e=di(t,[{[gh]:!0,[_s]:!0,[Cp]:!0}]);if(e.error)return e;let i=t.tournamentId??t.activeTournamentId,n=t.tournamentRecord??(i&&((c=t.tournamentRecords)==null?void 0:c[i]));if(!n)return{error:ut};let r=(u=qT(t,[{[CT]:_h,attr:{[ix]:!0},[Jp]:Ho}]).matchUp)==null?void 0:u.matchUp;if(!r)return{error:Ho};let{checkedInParticipantIds:a=[]}=VI({matchUp:r}),{participantId:o,matchUpId:s,drawDefinition:l}=t;return o&&a.includes(o)?fW({tournamentRecord:n,drawDefinition:l,participantId:o,matchUpId:s,matchUp:r}):mW({tournamentRecord:n,drawDefinition:l,participantId:o,matchUpId:s,matchUp:r})}function gW({tournamentRecord:t,drawDefinition:e,tieMatchUpId:i,event:n}){var w,S;if(!t)return{error:ut};if(!e)return{error:Pd};if(!n)return{error:Xl};let r=Ao({drawDefinition:e}),{matchUp:a}=nr({matchUpId:i,drawDefinition:e,matchUpsMap:r});if(!a)return{error:Ho};let{matchUp:o,structure:s}=nr({tournamentParticipants:t.participants,matchUpId:i,inContext:!0,drawDefinition:e,matchUpsMap:r,event:n});if(!o)return{error:Ho};let{collectionPosition:l,drawPositions:c,collectionId:u,matchUpTieId:d,matchUpType:p}=o;if(p&&!Ex([or,zn],p))return{error:al};let{positionAssignments:h}=Vn({structure:s}),f=h==null?void 0:h.filter(D=>c==null?void 0:c.includes(D.drawPosition)),{matchUp:m}=nr({matchUpId:d,drawDefinition:e,matchUpsMap:r}),g=((w=m==null?void 0:m.sides)==null?void 0:w.map(Gi))??[],v=(f==null?void 0:f.map(Gi))??[],y=[...g,...v],{participants:b}=Nr({tournamentRecord:t,participantFilters:{participantTypes:[On],participantIds:y}}),{matchUp:I}=nr({matchUpId:d,inContext:!0,drawDefinition:e,matchUpsMap:r}),T=(S=is({matchUp:m,drawDefinition:e,structure:s,event:n}))==null?void 0:S.tieFormat;return{inContextDualMatchUp:I,inContextTieMatchUp:o,relevantAssignments:f,collectionPosition:l,teamParticipants:b,collectionId:u,matchUpType:p,dualMatchUp:m,tieMatchUp:a,tieFormat:T,structure:s,...ce}}function vW(t){var O,B,F,G,H,$,q,z,Z,Y,Q,X,oe,re,me,se;let e=gW(t);if(e.error)return e;let i="replaceTieMatchUpParticipantid",{existingParticipantId:n,tournamentRecord:r,newParticipantId:a,drawDefinition:o,substitution:s,event:l}=t;if(!n||!a)return pe({result:{error:ya},stack:i});if(n===a)return{...ce};let{inContextDualMatchUp:c,inContextTieMatchUp:u,collectionPosition:d,collectionId:p,dualMatchUp:h,tieMatchUp:f,tieFormat:m}=e,g=u==null?void 0:u.matchUpType,v=(O=u==null?void 0:u.sides)==null?void 0:O.find(te=>{var he,ae,de;return((he=te.participant)==null?void 0:he.participantId)===n||((de=(ae=te.participant)==null?void 0:ae.individualParticipantIds)==null?void 0:de.includes(n))});if(!v)return{error:Vr};let y=((B=Nr({tournamentRecord:r,participantFilters:{participantIds:[n,a]}}))==null?void 0:B.participants)??[];if(y.length!==2)return pe({result:{error:ya},stack:i});if(y[0].participantType!==y[1].participantType)return pe({result:{error:yd},stack:i});let{appliedPolicies:b}=dn({tournamentRecord:r,drawDefinition:o,event:l}),I=((F=t.policyDefinitions)==null?void 0:F[Qa])??(b==null?void 0:b[Qa])??VT[Qa],T=y.find(({participantId:te})=>te===a);if((t.enforceGender??((G=I==null?void 0:I.participants)==null?void 0:G.enforceGender))!==!1&&[Gn,hr].includes(u==null?void 0:u.gender)&&(u==null?void 0:u.gender)!==((H=T==null?void 0:T.person)==null?void 0:H.sex))return{error:MI,info:"Gender mismatch"};let w=($=I==null?void 0:I.processCodes)==null?void 0:$.substitution;ZC({tournamentId:r.tournamentId,eventId:l.eventId,inContextDualMatchUp:c,drawDefinition:o,dualMatchUp:h});let S=(q=h==null?void 0:h.sides)==null?void 0:q.find(({sideNumber:te})=>te===v.sideNumber);if(!S)return pe({result:{sideNumber:v.sideNumber,existingParticipantId:n,error:no},stack:i});if((Z=(z=u==null?void 0:u.sides)==null?void 0:z.flatMap(te=>{var he,ae;return((he=te.participant)==null?void 0:he.individualParticipantIds)||((ae=te.participant)==null?void 0:ae.participantId)||[]}))!=null&&Z.includes(a))return pe({result:{error:$k},stack:i});let D=(Q=(Y=c==null?void 0:c.sides)==null?void 0:Y.find(({sideNumber:te})=>te===v.sideNumber))==null?void 0:Q.participantId,E=S.lineUp,C=E==null?void 0:E.find(({participantId:te})=>a===te),P=E==null?void 0:E.reduce((te,he)=>he.substitutionOrder>te?he.substitutionOrder:te,0),R=(E==null?void 0:E.map(te=>{var ae;let he=Ot(te,!1,!0);if(![n,a].includes(he.participantId))return he;if(!s&&[n,a].includes(he.participantId)&&(he.collectionAssignments=(ae=he.collectionAssignments)==null?void 0:ae.filter(de=>!(de.collectionPosition===d&&de.collectionId===p))),s&&n===he.participantId&&(he.collectionAssignments=he.collectionAssignments.map(de=>de.collectionPosition===d&&de.collectionId===p&&de.substitutionOrder===void 0?{...de,substitutionOrder:P}:de)),he.participantId===a){he.collectionAssignments||(he.collectionAssignments=[]);let de={collectionId:p,collectionPosition:d};s&&(de.previousParticipantId=n,de.substitutionOrder=(P??0)+1),he.collectionAssignments.push(de)}return he}))??[];if(!C){let te={collectionId:p,collectionPosition:d};s&&(te.substitutionOrder=(P??0)+1,te.previousParticipantId=n);let he={collectionAssignments:[te],participantId:a};R.push(he)}let N=g===zn,{assignedParticipantIds:M}=CA({lineUp:E,collectionPosition:d,collectionId:p}),{assignedParticipantIds:A}=CA({lineUp:R,collectionPosition:d,collectionId:p});if(S.lineUp=R,D&&m){let te=WI({participantId:D,lineUp:R,drawDefinition:o,tieFormat:m});if(te.error)return pe({result:te,stack:i})}else console.log("team participantId not found");let _,x;if(N){let{tournamentRecord:te}=t,he=Mu({participantIds:A,tournamentRecord:te});if(!he.participant){let de=mp({returnParticipant:!0,pairOverride:!0,tournamentRecord:te,participant:{participantRole:Do,individualParticipantIds:A,participantType:Ti}});if(de.error)return pe({result:de,stack:i});_=(X=de.participant)==null?void 0:X.participantId}he=Mu({participantIds:M,tournamentRecord:te});let ae=(oe=he.participant)==null?void 0:oe.participantId;ae&&zI({participantIds:[ae],tournamentRecord:te}).success&&(x=ae)}if(s||((re=v.substitutions)==null?void 0:re.length)===1){if(s)w&&f&&(f.processCodes=Pi([...(f==null?void 0:f.processCodes)??[],...w]));else for(let te of w||[]){let he=(me=f==null?void 0:f.processCodes)==null?void 0:me.lastIndexOf(te);he!==void 0&&((se=f==null?void 0:f.processCodes)==null||se.splice(he,1))}f&&en({tournamentId:r==null?void 0:r.tournamentId,matchUp:f,context:i,drawDefinition:o})}return h&&en({tournamentId:r==null?void 0:r.tournamentId,matchUp:h,context:i,drawDefinition:o}),{...ce,modifiedLineUp:R,participantRemoved:x,participantAdded:_}}function Nue({collectionPosition:t,teamParticipantId:e,dualMatchUpSide:i,drawDefinition:n,participantIds:r,collectionId:a}){var c;if(!a||!t||!Array.isArray(r))return{modifiedLineUp:(i==null?void 0:i.lineUp)||[],error:Re};let o=(i==null?void 0:i.lineUp)||((c=qv({participantId:e,drawDefinition:n}))==null?void 0:c.lineUp),s=[],l=[];return{modifiedLineUp:(o==null?void 0:o.map(u=>{var p;if(!r.includes(u.participantId))return u;let d=(p=u.collectionAssignments)==null?void 0:p.filter(h=>{let f=h.collectionId===a&&h.collectionPosition===t;return f&&(h.previousParticipantId&&s.push(h.previousParticipantId),l.push({participantId:u.participantId,...h})),!f});return{participantId:u.participantId,collectionAssignments:d}}).filter(Boolean))||[],assignmentsRemoved:l,previousParticipantIds:s}}function NOe({individualParticipantIds:t,groupingParticipantId:e,tournamentRecord:i}){var a,o;let n=(i.events||[]).filter(s=>{var l;return(s==null?void 0:s.eventType)===ga&&((l=s==null?void 0:s.entries)==null?void 0:l.some(c=>c.participantId===e))}),r=s=>!t.includes(s.participantId);for(let s of n){s.entries=(s.entries||[]).filter(r);let{flightProfile:l}=Zr({event:s});(a=l==null?void 0:l.flights)==null||a.forEach(c=>{c.drawEntries=(c.drawEntries||[]).filter(r)}),(o=s==null?void 0:s.drawDefinitions)==null||o.forEach(c=>{c.entries=(c.entries||[]).filter(r)})}return{...ce}}function wO({individualParticipantIds:t,groupingParticipantId:e,removeFromOtherTeams:i,tournamentRecord:n}){let r="addIndividualParticipantIds";if(!n)return pe({result:{error:ut},stack:r});if(!e||!t)return pe({result:{error:Yt},stack:r});let a=n.participants??[],o=a.find(d=>d.participantId===e);if(!o)return pe({result:{error:Vr},stack:r});if(o!=null&&o.participantType&&![On,ac].includes(o.participantType))return pe({context:{participantType:o.participantType},result:{error:yd},stack:r});let s=t.filter(d=>{var p;return((p=a.find(h=>h.participantId===d))==null?void 0:p.participantType)!==Hi});if(s.length)return pe({result:{error:Ul,invalidParticipantIds:s},stack:r});o.individualParticipantIds||(o.individualParticipantIds=[]);let l=o.individualParticipantIds,c=t.filter(d=>!l.includes(d));c.length&&(i&&Rx({individualParticipantIds:c,tournamentRecord:n}),o.individualParticipantIds=o.individualParticipantIds.concat(...c));let{topics:u}=rc();if(u.includes(Ro)){let d=a.find(({participantId:p})=>p===e);wi({topic:Ro,payload:{participants:[d]}})}return NOe({individualParticipantIds:t,groupingParticipantId:e,tournamentRecord:n}),{groupingParticipant:Ot(o,!1,!0),added:c.length,...ce}}function SO(t){let{updateParticipantName:e=!0,groupingParticipantId:i,removeFromOtherTeams:n,tournamentRecord:r,pairOverride:a,participant:o}=t;if(!r)return{error:ut};if(!o)return{error:NI};if(!o.participantId)return mp({tournamentRecord:r,participant:o});let{participant:s}=Eg({participantId:o.participantId,tournamentRecord:r});if(!s)return mp({tournamentRecord:r,participant:o});let{participantRoleResponsibilties:l,individualParticipantIds:c,participantOtherName:u,participantName:d,participantRole:p,participantType:h,onlineResources:f,contacts:m,person:g}=o;if(h&&s.participantType!==h)return{error:Rne};let v={};if(m&&(v.contacts=m),f&&(v.onlineResources=f),u&&$r(u)&&(v.participantOtherName=u),d&&$r(d)&&(v.participantName=d),Array.isArray(c)){let{participants:y}=Nr({participantFilters:{participantTypes:[Hi]},tournamentRecord:r}),b=y==null?void 0:y.map(Gi);if(b){let I=c.filter(T=>$r(T)&&b.includes(T));([ac,Xn].includes(h||s.participantType)||h===Ti&&(I.length===2||a))&&(v.individualParticipantIds=I),s.participantType===$0.PAIR&&e&&(v.participantName=AOe({individualParticipants:y,newValues:v}))}}return Object.keys(Mg).includes(p)&&(v.participantRole=p),Object.keys($0).includes(h)&&(v.participantType=h),Array.isArray(l)&&(v.participantRoleResponsibilties=l),s.participantType===$0.INDIVIDUAL&&g&&_Oe({updateParticipantName:e,existingParticipant:s,newValues:v,person:g}),Object.assign(s,zt(v)),i&&wO({individualParticipantIds:[s.participantId],groupingParticipantId:i,removeFromOtherTeams:n,tournamentRecord:r}),wi({topic:Ro,payload:{tournamentId:r.tournamentId,participants:[s]}}),{participant:Ot(s),...ce}}function AOe({individualParticipants:t,newValues:e}){let i=e.individualParticipantIds,n=t.filter(({participantId:r})=>i.includes(r)).map(({person:r})=>r==null?void 0:r.standardFamilyName).filter(Boolean).sort().join("/");return i.length===1&&(n+="/Unknown"),n}function _Oe({updateParticipantName:t,existingParticipant:e,newValues:i,person:n}){let r={},{standardFamilyName:a,standardGivenName:o,nationalityCode:s,personId:l,birthdate:c,tennisId:u,sex:d}=n;d&&Object.keys(Mp).includes(d)&&(r.sex=d);let p;if($r(l)&&(r.personId=l),s&&$r(s)&&(kOe(s)||s==="")&&(r.nationalityCode=s),a&&typeof $r(a)&&a.length>1&&(r.standardFamilyName=a,p=!0),o&&typeof $r(o)&&o.length>1&&(r.standardGivenName=o,p=!0),p&&t){let h=`${r.standardGivenName} ${r.standardFamilyName}`;i.participantName=h}c&&Dl(c)&&(r.birthdate=c),u&&$r(u)&&(r.tennisId=u),Object.assign(e.person,r)}function kOe(t){return Fm.flatMap(({iso:e,ioc:i})=>[e,i]).filter(Boolean).includes(t)}function GA(t){var F,G,H,$,q,z,Z,Y,Q,X,oe,re,me,se,te,he,ae,de,Ie,De;let e=gW(t);if(e.error)return e;let i="assignTieMatchUpParticipantId",n=t.teamParticipantId,{tournamentRecord:r,drawDefinition:a,participantId:o,event:s}=t;if(!o)return pe({result:{error:ya},stack:i});if(t.sideNumber&&![1,2].includes(t.sideNumber))return pe({result:{error:BH},stack:i});let{inContextDualMatchUp:l,inContextTieMatchUp:c,relevantAssignments:u,collectionPosition:d,teamParticipants:p,collectionId:h,matchUpType:f,dualMatchUp:m,tieFormat:g}=e;if((G=(F=c==null?void 0:c.sides)==null?void 0:F.flatMap(Te=>{var _e,Ve;return((_e=Te.participant)==null?void 0:_e.individualParticipantIds)||((Ve=Te.participant)==null?void 0:Ve.participantId)||[]}))!=null&&G.includes(o))return pe({result:{...ce},stack:i});n=n??(t.sideNumber?($=(H=l==null?void 0:l.sides)==null?void 0:H.find(Te=>Te.sideNumber===t.sideNumber))==null?void 0:$.participantId:void 0);let v=(z=(q=Nr({participantFilters:{participantIds:[o]},tournamentRecord:r}))==null?void 0:q.participants)==null?void 0:z[0];if(!v)return pe({result:{error:Vr},stack:i});let{appliedPolicies:y}=dn({tournamentRecord:r,drawDefinition:a,event:s}),b=((Z=t.policyDefinitions)==null?void 0:Z[Qa])??(y==null?void 0:y[Qa])??VT[Qa];if((t.enforceGender??((Y=b==null?void 0:b.participants)==null?void 0:Y.enforceGender))!==!1&&[Gn,hr].includes(c==null?void 0:c.gender)&&(c==null?void 0:c.gender)!==((Q=v.person)==null?void 0:Q.sex))return{error:MI,info:"Gender mismatch"};let{individualParticipantIds:I,participantType:T}=v;if(Gr(or)(f)&&T!==Hi)return{error:yd};let w=T===Hi?[o]:I,S=n&&(p==null?void 0:p.find(({participantId:Te})=>Te===n))||(p==null?void 0:p.find(({individualParticipantIds:Te})=>Ts(w,Te)));if(!S)return{error:YH};if(n||(n=S.participantId),!n)return{error:Vr};let D=(X=u==null?void 0:u.find(Te=>Te.participantId===(S==null?void 0:S.participantId)))==null?void 0:X.drawPosition,E=(re=(oe=m==null?void 0:m.sides)==null?void 0:oe.find(Te=>Te.participantId===n))==null?void 0:re.sideNumber,C=(se=(me=c==null?void 0:c.sides)==null?void 0:me.find(Te=>D&&Te.drawPosition===D))==null?void 0:se.sideNumber,P=E??C??t.sideNumber;if(!g)return{error:IT};if(!((te=g.collectionDefinitions)!=null&&te.find(Te=>Te.collectionId===h)))return{error:Ine};ZC({tournamentId:r.tournamentId,eventId:s.eventId,inContextDualMatchUp:l,drawDefinition:a,dualMatchUp:m});let R=(he=m==null?void 0:m.sides)==null?void 0:he.find(Te=>Te.sideNumber===P),N=(ae=c==null?void 0:c.sides)==null?void 0:ae.find(Te=>Te.sideNumber===P),M=(De=(Ie=(R==null?void 0:R.lineUp)??((de=qv({participantId:n,drawDefinition:a}))==null?void 0:de.lineUp))==null?void 0:Ie.filter(Te=>{var _e;return(_e=Te.collectionAssignments)==null?void 0:_e.find(Ve=>Ve.collectionPosition===d&&Ve.collectionId===h&&!Ve.previousParticipantId)}))==null?void 0:De.map(Te=>Te==null?void 0:Te.participantId),A=(M==null?void 0:M.length)>1&&M||(T===Ti?v.individualParticipantIds:[o]),_=Nue({collectionPosition:d,teamParticipantId:n,dualMatchUpSide:R,drawDefinition:a,participantIds:A,collectionId:h});if(_.error)return pe({result:_,stack:i});let{modifiedLineUp:x}=_,O;if(f===zn){if(T!==Ti){let Te=VB({collectionPosition:d,teamParticipantId:n,drawDefinition:a,modifiedLineUp:x,participantId:o,collectionId:h,tieFormat:g});if(Te!=null&&Te.error)return pe({result:Te,stack:i});if(Te=B({side:N}),Te.error)return Te;O=Te.deletedParticipantId,R&&(R.lineUp=x),m&&en({tournamentId:r==null?void 0:r.tournamentId,matchUp:m,context:i,drawDefinition:a})}else if(T===Ti)for(let Te of A)VB({collectionPosition:d,teamParticipantId:n,drawDefinition:a,modifiedLineUp:x,participantId:Te,collectionId:h,tieFormat:g})}else{let Te=VB({collectionPosition:d,teamParticipantId:n,drawDefinition:a,modifiedLineUp:x,participantId:o,collectionId:h,tieFormat:g});if(Te!=null&&Te.error)return Te}if(R&&(R.lineUp=x),m&&en({tournamentId:r==null?void 0:r.tournamentId,matchUp:m,context:i,drawDefinition:a}),O){let{error:Te}=zI({participantIds:[O],tournamentRecord:r});Te&&console.log("cleanup")}return{...ce,modifiedLineUp:x};function B({side:Te}){let _e;if(Te.participant){let Ve=Te.participant.individualParticipantIds||[];if(Ve.filter(Boolean).length===1){let{participant:ot}=Mu({participantIds:Ve,tournamentRecord:r});Ve.push(o);let{participant:St}=Mu({participantIds:Ve,tournamentRecord:r});if(!St&&ot){ot.individualParticipantIds=Ve;let nt=SO({pairOverride:!0,tournamentRecord:r,participant:ot});if(nt.error)return nt}else _e=ot==null?void 0:ot.participantId}}else{let Ve=mp({participant:{individualParticipantIds:[o],participantRole:Do,participantType:Ti},pairOverride:!0,tournamentRecord:r});if(Ve.error)return Ve}return{...ce,deletedParticipantId:_e}}}function VB({collectionPosition:t,teamParticipantId:e,drawDefinition:i,modifiedLineUp:n,participantId:r,collectionId:a,tieFormat:o}){var u,d;let s=(u=qv({participantId:e,drawDefinition:i}))==null?void 0:u.lineUp,l=(d=n||s)==null?void 0:d.find(p=>(p==null?void 0:p.participantId)===r),c={collectionId:a,collectionPosition:t};if(l)l.collectionAssignments.push(c);else{let p={collectionAssignments:[c],participantId:r};n.push(p)}return WI({participantId:e,lineUp:n,drawDefinition:i,tieFormat:o})}function Aue(t){var P,R,N,M,A,_,x,O,B,F,G,H,$,q,z,Z,Y,Q,X,oe,re,me,se;let{tournamentRecord:e,drawDefinition:i,participantId:n,event:r}=t,a="removeTieMatchUpParticiapantId";if(!n)return pe({result:{error:ya},stack:a});let o=gW(t);if(o.error)return o;let{appliedPolicies:s}=dn({tournamentRecord:e,drawDefinition:i,event:r}),l=(N=(R=((P=t.policyDefinitions)==null?void 0:P[Qa])??(s==null?void 0:s[Qa])??VT[Qa])==null?void 0:R.processCodes)==null?void 0:N.substitution,{inContextDualMatchUp:c,inContextTieMatchUp:u,relevantAssignments:d,collectionPosition:p,teamParticipants:h,collectionId:f,matchUpType:m,dualMatchUp:g,tieMatchUp:v,tieFormat:y}=o;if(!g)return pe({result:{error:rl},stack:a});let b=(M=u==null?void 0:u.sides)==null?void 0:M.find(te=>{var he,ae,de;return((he=te.participant)==null?void 0:he.participantId)===n||((de=(ae=te.participant)==null?void 0:ae.individualParticipantIds)==null?void 0:de.includes(n))});if(!b)return pe({result:{error:Vr},stack:a});let I=((A=t.policyDefinitions)==null?void 0:A[Bc])??(s==null?void 0:s[Bc]);if(!((_=b.substitutions)!=null&&_.length)&&(Pa({score:u==null?void 0:u.score})||u!=null&&u.winningSide)&&(I==null?void 0:I.requireParticipantsForScoring)!==!1)return pe({result:{error:nre},stack:a});let T=(O=(x=c==null?void 0:c.sides)==null?void 0:x.find(({sideNumber:te})=>te===b.sideNumber))==null?void 0:O.participantId;if(!T)return pe({result:{error:Vr},stack:a});let w=(F=(B=Nr({participantFilters:{participantIds:[n]},tournamentRecord:e}))==null?void 0:B.participants)==null?void 0:F[0];if(!w)return pe({result:{error:Vr},stack:a});if(m===or&&w.participantType===Ti)return pe({result:{error:MI},stack:a});let S=w.participantType===Hi?[n]:w.individualParticipantIds;ZC({tournamentId:e.tournamentId,eventId:r.eventId,inContextDualMatchUp:c,drawDefinition:i,dualMatchUp:g});let D=(G=g.sides)==null?void 0:G.find(({sideNumber:te})=>te===b.sideNumber);if(!D&&(((H=g.sides)==null?void 0:H.filter(({lineUp:te})=>!te).length)||0)<2){let te=h==null?void 0:h.map(({participantId:he})=>{var ae;return{drawPosition:(ae=d==null?void 0:d.find(de=>de.participantId===he))==null?void 0:ae.drawPosition,teamParticipantId:he}});D=($=g.sides)==null?void 0:$.find(he=>{var ae;return((ae=te==null?void 0:te.find(({drawPosition:de})=>de===he.drawPosition))==null?void 0:ae.teamParticipantId)===T})}if(!D)return pe({result:{error:Vr,context:{participantId:n}}});let{modifiedLineUp:E,previousParticipantIds:C}=Nue({collectionPosition:p,teamParticipantId:T,dualMatchUpSide:D,participantIds:S,drawDefinition:i,collectionId:f});if(D.lineUp=E,T&&y&&WI({participantId:T,lineUp:E,drawDefinition:i,tieFormat:y}),m===zn&&w.participantType===Hi){let te=(q=u==null?void 0:u.sides)==null?void 0:q.find(de=>de.sideNumber===(D==null?void 0:D.sideNumber)),{participantId:he}=te??{},ae=he&&((Z=(z=Nr({participantFilters:{participantIds:[he]},tournamentRecord:e,withDraws:!0}))==null?void 0:z.participants)==null?void 0:Z[0]);if(ae){let de=((Y=ae==null?void 0:ae.individualParticipantIds)==null?void 0:Y.filter(Ie=>Ie!==n))??[];if(C&&de.push(...C),de.length>2)return pe({result:{error:Ul},stack:a});if((Q=ae.draws)!=null&&Q.length){if(de.length===1){let{participant:Ie}=Mu({participantIds:de,tournamentRecord:e});if(!Ie){let De=mp({participant:{participantRole:Do,individualParticipantIds:de,participantType:Ti},pairOverride:!0,tournamentRecord:e});if(De.error)return pe({result:De,stack:a})}}}else if(de.length){ae.individualParticipantIds=de;let Ie=SO({participant:ae,pairOverride:!0,tournamentRecord:e});if(Ie.error)return pe({result:Ie,stack:a})}else{let Ie=zI({participantIds:[he],tournamentRecord:e});Ie.error&&console.log("cleanup",{result:Ie})}}else return pe({result:{error:Vr},stack:a})}if(((X=b.substitutions)==null?void 0:X.length)===1&&!((me=(re=(oe=u==null?void 0:u.sides)==null?void 0:oe.find(te=>te.sideNumber!==b.sideNumber))==null?void 0:re.substitutions)!=null&&me.length)&&((se=v==null?void 0:v.processCodes)!=null&&se.length)){for(let te of l||[]){let he=v.processCodes.lastIndexOf(te);v.processCodes.splice(he,1)}en({tournamentId:e==null?void 0:e.tournamentId,matchUp:v,context:a,drawDefinition:i})}return en({tournamentId:e==null?void 0:e.tournamentId,matchUp:g,context:a,drawDefinition:i}),{...ce,modifiedLineUp:E}}function yW(t){var l,c;let e=di(t,[{[ls]:!0,[_s]:!0,[Cp]:!0}]);if(e.error)return e;let{drawDefinition:i,sideNumber:n,matchUpId:r,event:a}=t;if(n&&![1,2].includes(n))return{error:Re,sideNumber:n};let{matchUp:o,structure:s}=nr({drawDefinition:i,matchUpId:r,event:a});return o?sl({structure:s})?((l=o.sides)==null||l.forEach(u=>{(!n||u.sideNumber===n)&&delete u.participantId}),en({tournamentId:(c=t.tournamentRecord)==null?void 0:c.tournamentId,context:"assignSideParticipant",drawDefinition:i,matchUp:o}),{...ce}):{error:RH}:{error:Ho}}function xOe({matchUpStatuses:t=[vn,hn,Zi],drawPositionMatchUps:e,loserDrawPosition:i,sourceMatchUps:n}){var u;let r=e==null?void 0:e.reduce((d,p)=>!d||p.roundNumber>d.roundNumber?p:d,void 0),a=(u=r==null?void 0:r.drawPositions)==null?void 0:u.find(d=>d!==i),o=n.filter(d=>{var p;return(p=d==null?void 0:d.drawPositions)==null?void 0:p.includes(a)}).map(d=>d.matchUpStatus),s=n.filter(d=>{var p;return(p=d==null?void 0:d.drawPositions)==null?void 0:p.includes(i)}).map(d=>d.matchUpStatus),l=Ts(o||[],t),c=Ts(s||[],t);return{sourceMatchUp:r,winnerHadMatchUpStatus:l,winnerMatchUpStatuses:o,loserHadMatchUpStatus:c,loserMatchUpStatuses:s}}function OOe({inContextDrawMatchUps:t,sourceMatchUpStatus:e,targetDrawPosition:i,tournamentRecord:n,sourceMatchUpId:r,drawDefinition:a,structureId:o,dualMatchUp:s,roundNumber:l,matchUpsMap:c,event:u}){let{structure:d}=ui({drawDefinition:a,structureId:o});if((d==null?void 0:d.structureType)===As)return{...ce};c=c??Ao({drawDefinition:a});let p=((c==null?void 0:c.mappedMatchUps)||{})[o].matchUps,{initialRoundNumber:h}=Xb({drawPosition:i,matchUps:p}),f=p==null?void 0:p.filter(g=>{var v;return g.roundNumber>=l&&g.roundNumber!==h&&((v=g.drawPositions)==null?void 0:v.includes(i))}),{positionAssignments:m}=Vn({drawDefinition:a,structureId:o});for(let g of f??[])LOe({inContextDrawMatchUps:t,sourceMatchUpStatus:e,positionAssignments:m,targetDrawPosition:i,tournamentRecord:n,sourceMatchUpId:r,drawDefinition:a,dualMatchUp:s,matchUpsMap:c,matchUp:g,event:u});return{...ce}}function LOe({inContextDrawMatchUps:t,positionAssignments:e,sourceMatchUpStatus:i,targetDrawPosition:n,tournamentRecord:r,sourceMatchUpId:a,drawDefinition:o,dualMatchUp:s,matchUpsMap:l,matchUp:c,event:u}){var h,f,m;let d="removeSubsequentDrawPosition";if(s){let g=(f=(h=t.find(({matchUpId:y})=>c.matchUpId===y).sides)==null?void 0:h.find(y=>y.drawPosition===n))==null?void 0:f.sideNumber,v=(m=c.sides)==null?void 0:m.find(y=>y.sideNumber===g);v&&delete v.lineUp}c.drawPositions=(c.drawPositions||[]).map(g=>g===n?void 0:g).filter(Boolean);let p=e.filter(({drawPosition:g})=>{var v;return(v=c.drawPositions)==null?void 0:v.includes(g)}).filter(g=>g.bye).length;return c.matchUpStatus=p&&vn||[Zi,hn].includes(c.matchUpStatus)&&c.matchUpStatus||qr,[hn,Zi].includes(c.matchUpStatus)&&(c.winningSide=void 0),c.matchUpStatusCodes&&Soe({inContextDrawMatchUps:t,sourceMatchUpStatus:i,sourceMatchUpId:a,matchUpsMap:l,matchUp:c}),en({tournamentId:r==null?void 0:r.tournamentId,eventId:u==null?void 0:u.eventId,context:`${d}-${n}`,drawDefinition:o,matchUp:c}),{...ce}}function ZT(t){let{dualWinningSideChange:e,inContextDrawMatchUps:i,tournamentRecord:n,drawDefinition:r,matchUpStatus:a,matchUpsMap:o,dualMatchUp:s,targetData:l,matchUpId:c,structure:u,event:d}=t,p=!!t.matchUp.collectionId,h=sl({structure:u}),{drawPositions:f,winningSide:m}=l.matchUp||{};if(!h&&!f)return{error:tC};let{targetLinks:{loserTargetLink:g,winnerTargetLink:v,byeTargetLink:y},targetMatchUps:{loserMatchUp:b,winnerMatchUp:I,byeMatchUp:T}}=l,w=tp({...t,matchUpStatus:a||qr,removeWinningSide:!0});if(w.error)return w;let S;if(p){let{matchUpTieId:x,matchUpsMap:O}=t;if(S=im({appliedPolicies:t.appliedPolicies,matchUpId:x,tournamentRecord:n,drawDefinition:r,matchUpsMap:O,event:d}),!e&&!S.removeWinningSide)return{...ce}}if(h)return{...ce};let{matchUps:D}=wn({afterRecoveryTimes:!1,inContext:!0,drawDefinition:r,matchUpsMap:o,structure:u}),{positionAssignments:E}=ja({structure:u}),C=m-1,P=1-C,R=f[C],N=f[P],{winnerParticipantId:M,loserParticipantId:A}=(E==null?void 0:E.reduce((x,O)=>(O.drawPosition===N&&(x.loserParticipantId=O.participantId),O.drawPosition===R&&(x.winnerParticipantId=O.participantId),x),{winnerParticipantId:void 0,loserParticipantId:void 0}))||{},_=D.filter(x=>{var O;return(O=x.drawPositions)==null?void 0:O.includes(N)});if(I&&_ue({sourceMatchUpStatus:a,sourceMatchUpId:c,inContextDrawMatchUps:i,winningDrawPosition:R,winnerParticipantId:M,tournamentRecord:n,winnerTargetLink:v,drawDefinition:r,winnerMatchUp:I,dualMatchUp:s,matchUpsMap:o}),b){let{winnerHadMatchUpStatus:x}=xOe({drawPositionMatchUps:_,loserDrawPosition:N,sourceMatchUps:D}),O=g.linkCondition===fh;if(x&&O){let F=Math.min(...b.drawPositions);SV({targetLink:g,inContextDrawMatchUps:i,drawDefinition:r,drawPosition:F,matchUpsMap:o,event:d})}let B=FOe({sourceMatchUpStatus:a,sourceMatchUpId:c,loserParticipantId:A,tournamentRecord:n,loserTargetLink:g,drawDefinition:r,loserMatchUp:b,dualMatchUp:s,matchUpsMap:o,event:d});if(B.error)return B}if(T){let x=Math.min(...T.drawPositions);SV({sourceMatchUpId:c,targetLink:y,inContextDrawMatchUps:i,drawDefinition:r,drawPosition:x,matchUpsMap:o,event:d})}return{...ce,...S&&{tieMatchUpResult:S}}}function _ue({inContextDrawMatchUps:t,winningDrawPosition:e,sourceMatchUpStatus:i,winnerParticipantId:n,tournamentRecord:r,winnerTargetLink:a,sourceMatchUpId:o,drawDefinition:s,winnerMatchUp:l,matchUpsMap:c,dualMatchUp:u,event:d}){var m,g;let{structureId:p,roundNumber:h}=l,f="removeDirectedWinner";if(a){let v=a.target.structureId,{structure:y}=ui({drawDefinition:s,structureId:v});if(!y)return{error:wr};let{positionAssignments:b}=ja({structure:y});y.seedAssignments=(y.seedAssignments??[]).filter(E=>E.participantId!==n);let I=(m=b==null?void 0:b.find(E=>E.participantId===n))==null?void 0:m.drawPosition,{matchUps:T}=wn({drawDefinition:s,structure:y,event:d}),w=T.map(E=>E.drawPositions).flat(1/0).filter(Boolean),S=Pl(w);if((I?S[I]:void 0)===1)b==null||b.forEach(E=>{E.participantId===n&&delete E.participantId});else{let E=T.filter(({drawPositions:C})=>C.includes(I));console.log("not removing from position assignments since instances > 1",{drawPositionMatchUps:E,winnerTargetLink:a})}let D=(g=c==null?void 0:c.drawMatchUps)==null?void 0:g.find(({matchUpId:E})=>E===l.matchUpId);D&&en({tournamentId:r==null?void 0:r.tournamentId,eventId:d==null?void 0:d.eventId,matchUp:D,context:f,drawDefinition:s})}return h&&OOe({targetDrawPosition:e,inContextDrawMatchUps:t,sourceMatchUpStatus:i,tournamentRecord:r,sourceMatchUpId:o,drawDefinition:s,dualMatchUp:u,matchUpsMap:c,roundNumber:h,structureId:p}),{...ce}}function FOe({sourceMatchUpStatus:t,loserParticipantId:e,tournamentRecord:i,loserTargetLink:n,sourceMatchUpId:r,drawDefinition:a,loserMatchUp:o,matchUpsMap:s,dualMatchUp:l,event:c}){var m,g,v;let u="removeDirectedLoser",d=n.target.structureId,{structure:p}=ui({drawDefinition:a,structureId:d});if(!p)return{error:wr};let{positionAssignments:h}=ja({structure:p}),f=(m=h==null?void 0:h.find(y=>y.participantId===e))==null?void 0:m.drawPosition;if(h==null||h.forEach(y=>{y.participantId===e&&delete y.participantId}),p.seedAssignments=(p.seedAssignments??[]).filter(y=>y.participantId!==e),l){let y=o==null?void 0:o.sides.reduce((T,w,S)=>w.drawPosition===f?S:T,void 0),b=(g=s==null?void 0:s.drawMatchUps)==null?void 0:g.find(({matchUpId:T})=>T===o.matchUpId),I=(v=b==null?void 0:b.sides)==null?void 0:v[y];I&&(delete I.lineUp,en({tournamentId:i==null?void 0:i.tournamentId,eventId:c==null?void 0:c.eventId,matchUp:b,context:u,drawDefinition:a}))}return{...ce}}function SV({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,drawPosition:n,matchUpsMap:r,targetLink:a,event:o}){let s=a.target.structureId;return _C({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,matchUpsMap:r,drawPosition:n,structureId:s,event:o}),{...ce}}function BOe(t){var l,c;let{matchUpFormat:e,score:i}=t,n=(l=i==null?void 0:i.sets)==null?void 0:l.length,r=e&&Ys(e),{setFormat:a,finalSetFormat:o,bestOf:s}=r??{};return((c=s&&n===s&&o||a)==null?void 0:c.timed)||!1}function $Oe({tournamentRecord:t,drawDefinition:e,structure:i,matchUp:n}){var s;let r="attemptToSetMatchUpStatusBYE";if(n!=null&&n.winningSide)return pe({result:{error:bT},context:{matchUpStatus:vn},stack:r});let{positionAssignments:a}=ja({structure:i}),o=a==null?void 0:a.filter(l=>l.bye).map(l=>l.drawPosition);return(s=n.drawPositions)!=null&&s.some(l=>o==null?void 0:o.includes(l))?(n.matchUpStatus=vn,n.matchUpStatusCodes=[],en({tournamentId:t==null?void 0:t.tournamentId,context:r,drawDefinition:e,matchUp:n}),{...ce}):pe({result:{error:bne},info:"matchUp does not include BYE",stack:r})}function B1(t){var m;let{tournamentRecord:e,appliedPolicies:i,drawDefinition:n,matchUpsMap:r,targetData:a,structure:o,event:s}=t,l="doubleExitAdvancement";if(o.structureType===As)return pe({result:{...ce},stack:l});let{matchUp:c,targetMatchUps:u,targetLinks:d}=a,{loserMatchUp:p,winnerMatchUp:h,loserTargetDrawPosition:f}=u;if(p&&p.matchUpStatus!==vn){let{loserTargetLink:g}=d;if((m=i==null?void 0:i.progression)!=null&&m.doubleExitPropagateBye){let v=kue({loserTargetDrawPosition:f,tournamentRecord:e,loserTargetLink:g,drawDefinition:n,loserMatchUp:p,matchUpsMap:r,event:s});if(v.error)return pe({result:v,stack:l})}else{let{feedRound:v,drawPositions:y,matchUpId:b}=p,I=v?2:2-y.indexOf(f),T=PY({...t,targetMatchUp:p,walkoverWinningSide:I,tournamentRecord:e,sourceMatchUp:c,matchUpId:b});if(T.error)return pe({result:T,stack:l})}}if(h){let g=PY({...t,matchUpId:h.matchUpId,targetMatchUp:h,tournamentRecord:e,sourceMatchUp:c});if(g.error)return pe({result:g,stack:l})}return pe({result:{...ce},stack:l})}function PY(t){var z,Z,Y;let{inContextDrawMatchUps:e,tournamentRecord:i,drawDefinition:n,sourceMatchUp:r,targetMatchUp:a,matchUpsMap:o}=t,s=n.structures.find(({structureId:Q})=>Q===a.structureId),l=t.matchUpStatus===Ea?Ea:ua,c=t.matchUpStatus===Ea?Zi:hn,u="conditionallyAdvanceDrawPosition",d=o.drawMatchUps.find(Q=>Q.matchUpId===a.matchUpId);if(!d)return{error:rl};let p=(r==null?void 0:r.drawPositions)||[],h=(z=d.drawPositions)==null?void 0:z.filter(Boolean),f=(r==null?void 0:r.structureId)===a.structureId;if(f&&Ts(p,h)&&(h=h.filter(Q=>!p.includes(Q))),f&&h.length>1)return pe({result:{error:Q0},stack:u});let{pairedPreviousMatchUpIsDoubleExit:m,pairedPreviousMatchUp:g}=Ioe(t),v=Ds({matchUpId:a.matchUpId,inContextDrawMatchUps:e,drawDefinition:n}),{targetMatchUps:y,targetLinks:b}=v,{loserTargetDrawPosition:I,winnerMatchUp:T,loserMatchUp:w}=y;if(w){let{loserTargetLink:Q}=b,X=kue({loserTargetDrawPosition:I,loserMatchUp:w,tournamentRecord:i,loserTargetLink:Q,drawDefinition:n,matchUpsMap:o});if(X.error)return pe({result:X,stack:u})}let S=((Z=d.drawPositions)==null?void 0:Z.filter(Boolean))||[],D=S.length===1,E=t.walkoverWinningSide||D&&TN({drawPosition:S[0],matchUpId:a.matchUpId,inContextDrawMatchUps:e})||void 0,C=[hn,Zi].includes(d.matchUpStatus)&&!S.length,P=d.finishingRound===1,R=C&&!P?l:c,N=e.find(Q=>Q.matchUpId===g.matchUpId),M=[],A;r&&((r==null?void 0:r.structureId)===(N==null?void 0:N.structureId)?r.roundPosition<(g==null?void 0:g.roundPosition)?A=1:A=2:a.feedRound?r.structureId===a.structureId?A=2:A=1:E&&(A=3-E));let _=t.matchUpStatus,x=g==null?void 0:g.matchUpStatus;A===1?M=[{matchUpStatus:bM(_),previousMatchUpStatus:_,sideNumber:1},{matchUpStatus:bM(x),previousMatchUpStatus:x,sideNumber:2}]:A===2&&(M=[{matchUpStatus:bM(x),previousMatchUpStatus:x,sideNumber:1},{matchUpStatus:bM(_),previousMatchUpStatus:_,sideNumber:2}]),M.length&&(M=M.map(Q=>zt(Q)));let O=tp({...t,winningSide:E,matchUp:d,matchUpStatusCodes:M,context:u,matchUpStatus:R});if(O.error)return pe({result:O,stack:u});if(C)return B1({...t,matchUpStatus:R,targetData:v});if(!T)return pe({result:{...ce},stack:u});let B=h.length===2?h[E-1]:h[0],{positionAssignments:F}=Vn({structure:s}),G=F==null?void 0:F.find(Q=>Q.drawPosition===B),H=o.drawMatchUps.find(Q=>Q.matchUpId===T.matchUpId),$=(Y=H==null?void 0:H.drawPositions)==null?void 0:Y.filter(Boolean),q=$.length===1;if(B){if(G!=null&&G.bye){let Q=Ds({matchUpId:H.matchUpId,inContextDrawMatchUps:e,drawDefinition:n});if(q){let X=$.filter(Boolean)[0],oe=TN({drawPosition:X,matchUpId:H.matchUpId,inContextDrawMatchUps:e}),re=tp({appliedPolicies:t.appliedPolicies,matchUpId:H.matchUpId,matchUp:H,matchUpStatus:c,matchUpStatusCodes:[],removeScore:!0,context:u,drawDefinition:n,winningSide:oe});return re.error?pe({result:re,stack:u}):fq({drawPositionToAdvance:X,matchUpId:H.matchUpId,inContextDrawMatchUps:e,drawDefinition:n,matchUpsMap:o})}else if([hn,Zi].includes(T.matchUpStatus)){let X=B1({...t,matchUpId:H.matchUpId,matchUpStatus:R,targetData:Q});if(X.error)return pe({result:X,stack:u})}return pe({result:{...ce},stack:u})}return mS({matchUpId:T.matchUpId,drawPosition:B,inContextDrawMatchUps:e,drawDefinition:n})}else if(m){if(!H)return{error:rl};if(q){let oe=$[0],re=TN({matchUpId:a.matchUpId,inContextDrawMatchUps:e,drawPosition:oe});console.log("existing drawPosition is winningSide",{walkoverWinningSide:re})}let Q=[hn,Zi].includes(H.matchUpStatus)?c:l,X=tp({matchUpId:H.matchUpId,appliedPolicies:t.appliedPolicies,matchUp:H,matchUpStatusCodes:[],removeScore:!0,context:u,drawDefinition:n,matchUpStatus:Q});if(X.error)return pe({result:X,stack:u});if(Q===l){let oe=B1({...t,matchUpId:a.matchUpId,matchUpStatus:Q,targetData:v});if(oe.error)return oe}}return pe({result:{...ce},stack:u})}function kue(t){var c;let{loserTargetDrawPosition:e,tournamentRecord:i,loserTargetLink:n,drawDefinition:r,matchUpsMap:a,event:o}=t,s=(c=n==null?void 0:n.target)==null?void 0:c.structureId,{structure:l}=ui({drawDefinition:r,structureId:s});return l?sc({drawPosition:e,tournamentRecord:i,drawDefinition:r,structureId:s,matchUpsMap:a,event:o}):{error:gy}}function bM(t){return t===ua?hn:t===Ea?Zi:t}function VOe(t){let{tournamentRecord:e,drawDefinition:i,matchUpStatus:n,structure:r,matchUp:a}=t,o=!!(a.tieMatchUps&&!a.rondPosition&&t.inContextDrawMatchUps.find(v=>v.matchUpId===a.matchUpId).containerStructureId),s="attemptToSetMatchUpStatus",l=n===vn,c=a.winningSide,u=[ua,Ea].includes(n),d=NC({matchUpStatus:n}),p=X2({matchUpStatus:n}),h=!d&&!p,f=t.matchUpTieId||c&&d&&!u,m=c&&u,g=()=>tp({...t,removeScore:[Rp,hn].includes(n),matchUpStatus:n||qr});return h&&{error:_2}||f&&TV(t)||m&&jOe(t)||c&&ZT(t)||p&&g()||l&&$Oe({tournamentRecord:e,drawDefinition:i,structure:r,matchUp:a})||!d&&{error:_2}||u&&GOe(t)||o&&TV(t)||pe({result:{error:bT},stack:s})}function jOe(t){let e=ZT(t);return e.error?e:B1(t)}function GOe(t){let e=TV({...t,removeScore:!0});return e.error?e:B1(t)}function TV(t){var r;let e="scoreModification";if(t.isCollectionMatchUp&&((r=t.dualMatchUp)!=null&&r.winningSide)&&!t.projectedWinningSide){let a=ZT(t);if(a.error)return pe({result:a,stack:e})}let i=!!t.matchUp.collectionId,n=tp({...t,context:e});if(i){let{matchUpTieId:a,drawDefinition:o,matchUpsMap:s}=t,l=im({tournamentRecord:t.tournamentRecord,appliedPolicies:t.appliedPolicies,matchUpId:a,event:t.event,drawDefinition:o,matchUpsMap:s});if(l.error)return pe({result:l,stack:e});Object.assign(n,{tieMatchUpResult:l})}return pe({result:n,stack:e})}function HOe({drawDefinition:t,structure:e,matchUp:i}){var l,c,u,d;let{drawPositions:n}=i,{positionAssignments:r}=Vn({drawDefinition:t,structure:e}),a=(l=r==null?void 0:r.filter(({drawPosition:p})=>n==null?void 0:n.includes(p)))==null?void 0:l.map(p=>{var f;let{extension:h}=Ri({element:p,name:qm});return(f=h==null?void 0:h.value)==null?void 0:f.groupOrder}),{containerStructures:o}=kT({drawDefinition:t}),s=o[e.structureId];return{structureIds:(d=(u=(c=FT({drawDefinition:t,structureId:s}))==null?void 0:c.links)==null?void 0:u.source)==null?void 0:d.filter(p=>{var h;return Ts(a,((h=p.source)==null?void 0:h.finishingPositions)||[])}).map(p=>p.source.structureId)}}function xue({drawDefinition:t,structure:e,matchUp:i}){let n=[];if(e.finishingPosition===ET&&Xm({drawDefinition:t,structure:e})){let{structureIds:r}=HOe({drawDefinition:t,structure:e,matchUp:i});r!=null&&r.length&&n.push(...r)}return{connectedStructureIds:n}}function zOe(t){var s,l,c;let e,{inContextDrawMatchUps:i,inContextMatchUp:n,drawDefinition:r,winningSide:a}=t,o=(s=t.targetData.targetLinks)==null?void 0:s.winnerTargetLink;if(o.target.feedProfile===pu){let u=n.sides.find(({sideNumber:p})=>p!==a).participantId,d=i.find(p=>p.structureId===o.target.structureId&&p.roundNumber===o.target.roundNumber&&p.sides.some(({participantId:h})=>h===u));if((d==null?void 0:d.matchUpStatus)===qr){let p=Ds({matchUpId:d.matchUpId,inContextDrawMatchUps:i,drawDefinition:r});if(!Yv({inContextDrawMatchUps:i,drawDefinition:r,targetData:p})){let{structure:h}=ui({structureId:d.structureId,drawDefinition:r}),f=Vn({structure:h}).positionAssignments;for(let m of f||[])if(m.participantId===u){let g=n.sides.find(({sideNumber:v})=>v===a).participantId;if(m.participantId=g,h==null?void 0:h.positionAssignments)h.positionAssignments=f;else if(h!=null&&h.structures){let v=Object.assign({},...(f||[]).map(y=>({[y.drawPosition]:y.participantId})));for(let y of h.structures)(l=y.positionAssignments)==null||l.forEach(b=>b.participantId=v[b.drawPosition])}Ym({tournamentId:(c=t.tournamentRecord)==null?void 0:c.tournamentId,event:t.event,drawDefinition:r,structure:h}),e=!0}}}}return{...ce,qualifierReplaced:e}}function qOe(t){var s,l,c,u,d;let e,{inContextDrawMatchUps:i,inContextMatchUp:n,drawDefinition:r,winningSide:a}=t,o=(s=t.targetData.targetLinks)==null?void 0:s.winnerTargetLink;if(o.target.feedProfile===pu){let p=(l=n.sides.find(({sideNumber:m})=>m===a))==null?void 0:l.participantId,h=i.filter(m=>m.structureId===o.target.structureId&&m.roundNumber===o.target.roundNumber&&m.sides.some(({participantId:g,qualifier:v})=>v&&!g)),f=Il(h);if((f==null?void 0:f.matchUpStatus)===qr){let m=Ds({matchUpId:f.matchUpId,inContextDrawMatchUps:i,drawDefinition:r});if(!Yv({inContextDrawMatchUps:i,drawDefinition:r,targetData:m})){let g=(c=f.sides.find(b=>b.qualifier&&!b.participantId))==null?void 0:c.drawPosition,{structure:v}=ui({structureId:f.structureId,drawDefinition:r});if(!v)return{error:wr};let y=Vn({structure:v}).positionAssignments;for(let b of y||[])if(b.drawPosition===g&&!b.participantId){if(b.participantId=p,v.positionAssignments)v.positionAssignments=y;else if(v.structures){let I=Object.assign({},...(y||[]).map(T=>({[T.drawPosition]:T.participantId})));for(let T of v.structures)(u=T.positionAssignments)==null||u.forEach(w=>w.participantId=I[w.drawPosition])}Ym({tournamentId:(d=t.tournamentRecord)==null?void 0:d.tournamentId,event:t.event,drawDefinition:r,structure:v}),e=!0}}}}return{...ce,qualifierPlaced:e}}function WOe(t){var h,f;let e="attemptToSetWinningSide",i,{appliedPolicies:n,disableAutoCalc:r,drawDefinition:a,dualMatchUp:o,winningSide:s,structure:l,matchUp:c}=t;if(o!=null&&o._disableAutoCalc&&r!==!1)return zq(t);if(c.winningSide&&c.winningSide!==s){let{connectedStructureIds:m}=xue({drawDefinition:a,structure:l,matchUp:c});m.length&&(console.log({connectedStructureIds:m}),i=!0);let g=ZT(t);if(g.error)return g}let u=bse(t);if(u.error)return pe({result:u,stack:e});let d,p;return t.qualifierChanging&&((h=n==null?void 0:n[ND])!=null&&h.autoReplaceQualifiers)&&(d=zOe(t).qualifierReplaced),t.qualifierAdvancing&&((f=n==null?void 0:n[ND])!=null&&f.autoPlaceQualifiers)&&(p=qOe(t).qualifierPlaced),pe({result:zt({...ce,...u,connectedStructures:i,qualifierReplaced:d,qualifierPlaced:p}),stack:e})}var PN={drawPositionToRemove:"green",iteration:"brightred",winner:"green",loser:"brightred"};function Oue(t){var h;let{inContextDrawMatchUps:e,appliedPolicies:i,drawDefinition:n,matchUpsMap:r,targetData:a,matchUp:o}=t,{iteration:s=0}=t;s+=1;let l="removeDoubleExit";Ac({method:l,color:"brightyellow",iteration:s,keyColors:PN});let{targetLinks:{loserTargetLink:c},targetMatchUps:{loserMatchUp:u,winnerMatchUp:d,loserTargetDrawPosition:p}}=a;if(d&&d.matchUpStatus!==vn){let{stage:f,roundNumber:m,roundPosition:g}=d;Ac({winner:"winner",stage:f,roundNumber:m,roundPosition:g,keyColors:PN}),RY({...t,targetMatchUp:d,sourceMatchUp:o,iteration:s})}if(u&&u.matchUpStatus!==vn){let f=e.find(({matchUpId:I})=>I===u.matchUpId),{structure:m}=ui({drawDefinition:n,structureId:f.structureId}),{stage:g,roundNumber:v,roundPosition:y,feedRound:b}=u;if(Ac({loser:"loser",stage:g,roundNumber:v,roundPosition:y,keyColors:PN,feedRound:b}),(h=i==null?void 0:i.progression)==null?void 0:h.doubleExitPropagateBye)SV({drawPosition:p,targetLink:c,inContextDrawMatchUps:e,drawDefinition:n,matchUpsMap:r});else{let I=RY({...t,structure:m,targetMatchUp:u,iteration:s});if(I.error)return pe({result:I,stack:l})}}return pe({result:{...ce},stack:l})}function RY(t){var I,T,w,S,D,E;let{inContextDrawMatchUps:e,appliedPolicies:i,drawDefinition:n,sourceMatchUp:r,targetMatchUp:a,matchUpsMap:o,structure:s,iteration:l}=t,c="conditionallyRemoveDrawPosition";Ac({method:c});let u=Ds({matchUpId:a.matchUpId,inContextDrawMatchUps:e,drawDefinition:n}),{targetMatchUps:{winnerMatchUp:d}}=u,p=o==null?void 0:o.drawMatchUps.find(C=>C.matchUpId===a.matchUpId),h=[],f,m,g;if(a.feedRound)g=(T=(I=d==null?void 0:d.drawPositions)==null?void 0:I.filter(Boolean))==null?void 0:T.find(C=>a.drawPositions.includes(C));else if(!r)g=(w=zr((a==null?void 0:a.drawPositions)||[],(d==null?void 0:d.drawPositions)||[]))==null?void 0:w[0];else if(m=(S=woe({structureId:s.structureId,matchUp:r,matchUpsMap:o}))==null?void 0:S.pairedPreviousMatchUp,f=[ua,Ea].includes(m==null?void 0:m.matchUpStatus),h=((D=m==null?void 0:m.drawPositions)==null?void 0:D.filter(Boolean))||[],[...ba,vn].includes(m==null?void 0:m.matchUpStatus)||(m==null?void 0:m.winningSide)){let C=r.drawPositions||[],P=(E=a.drawPositions)==null?void 0:E.filter(Boolean);Ts(C,P)&&(P=P==null?void 0:P.filter(R=>!C.includes(R))),g=C.concat(h).find(R=>P==null?void 0:P.includes(R))}if(d&&g){let{stage:C,roundNumber:P,roundPosition:R}=d;Ac({method:"removeDirectedWinner",drawPositionToRemove:g,keyColors:PN,color:"brightgreen",stage:C,roundNumber:P,roundPosition:R}),_ue({winningDrawPosition:g,winnerMatchUp:d,inContextDrawMatchUps:e,drawDefinition:n,matchUpsMap:o})}let v=Oue({targetData:u,matchUp:a,inContextDrawMatchUps:e,appliedPolicies:i,drawDefinition:n,matchUpsMap:o,structure:s,iteration:l});if(v.error)return pe({result:v,stack:c});let y=KOe({pairedPreviousDoubleExit:f,noContextTargetMatchUp:p}),b=!f;return v=tp({...t,matchUpId:a.matchUpId,matchUp:p,removeWinningSide:!0,matchUpStatusCodes:[],context:c,matchUpStatus:y,removeScore:b,score:{scoreStringSide1:"",scoreStringSide2:"",sets:void 0}}),v.error?pe({result:v,stack:c}):{...ce}}function KOe({pairedPreviousDoubleExit:t,noContextTargetMatchUp:e}){return e.matchUpStatus===vn?vn:t?[Ea,Zi].includes(e==null?void 0:e.matchUpStatus)?Zi:hn:qr}function YOe(t){var o,s,l,c,u;let e,{inContextDrawMatchUps:i,inContextMatchUp:n,drawDefinition:r}=t,a=(o=t.targetData.targetLinks)==null?void 0:o.winnerTargetLink;if(a.target.feedProfile===pu){let d=(l=(s=n.sides)==null?void 0:s.find(({sideNumber:h})=>h===n.winningSide))==null?void 0:l.participantId,p=i.find(h=>{var f;return h.structureId===a.target.structureId&&h.roundNumber===a.target.roundNumber&&((f=h.sides)==null?void 0:f.some(({participantId:m})=>m===d))});if(p&&p.matchUpStatus===qr){let h=Ds({matchUpId:p.matchUpId,inContextDrawMatchUps:i,drawDefinition:r});if(!Yv({inContextDrawMatchUps:i,drawDefinition:r,targetData:h})){let{structure:f}=ui({structureId:p.structureId,drawDefinition:r}),m=Vn({structure:f}).positionAssignments;for(let g of m||[])if(g.participantId===d){if(g.participantId=void 0,f==null?void 0:f.positionAssignments)f.positionAssignments=m;else if(f!=null&&f.structures){let v=Object.assign({},...(m||[]).map(y=>({[y.drawPosition]:y.participantId})));for(let y of(f==null?void 0:f.structures)||[])(c=y.positionAssignments)==null||c.forEach(b=>b.participantId=v[b.drawPosition])}Ym({tournamentId:(u=t.tournamentRecord)==null?void 0:u.tournamentId,event:t.event,drawDefinition:r,structure:f}),e=!0}}}}return{qualifierRemoved:e}}function ZOe(t){var m;let{matchUp:e,matchUpStatus:i,score:n,winningSide:r}=t,a="noDownStreamDependencies";if([ua,Ea].includes(e==null?void 0:e.matchUpStatus)&&![ua,Ea].includes(i)){let g=Oue(t);if(g.error)return pe({result:g,stack:a})}let o=i===ua,s=Pa({score:n})&&!o&&(t.isCollectionMatchUp&&!t.projectedWinningSide||!r),l=((m=t==null?void 0:t.inContextMatchUp)==null?void 0:m.collectionId)&&BOe(t.inContextMatchUp),c=t.removeScore||!l&&![$c,ol].includes(i||$c),u=t.isCollectionMatchUp&&t.dualMatchUp.winningSide&&!t.projectedWinningSide||e.winningSide&&!r&&!Pa({score:n}),d=i&&i!==qr,p=g=>{var D,E;let v,{structure:y,drawDefinition:b,dualMatchUp:I,disableAutoCalc:T}=t;if(I!=null&&I._disableAutoCalc&&T!==!1)return zq(t);let{connectedStructureIds:w}=xue({drawDefinition:b,structure:y,matchUp:e});w.length&&(console.log({connectedStructureIds:w}),v=!0),Object.assign(t,{removeScore:g});let S=ZT(t);if(S.error)return S;if(t.removingQualifier&&((E=(D=t.appliedPolicies)==null?void 0:D[ND])!=null&&E.autoRemoveQualifiers)){let C=YOe(t);return{...ce,connectedStructures:v,...C}}return{...ce,connectedStructures:v}};if(u&&r&&t.isCollectionMatchUp)return MY(t);let h=[Rp,ol].includes(i)&&t.dualWinningSideChange,f=(r||h)&&WOe(t)||s&&p(c)||d&&VOe(t)||u&&p(c)||e&&MY({...t,removeScore:!0})||{...ce};return pe({result:f,stack:a})}function MY(t){var n;let e="scoreModification";if(t.isCollectionMatchUp&&((n=t.dualMatchUp)!=null&&n.winningSide)&&!t.projectedWinningSide){let r=ZT(t);if(r.error)return r}let i=tp({...t,context:e});if(t.isCollectionMatchUp){let{matchUpTieId:r,drawDefinition:a,event:o,matchUpsMap:s}=t,{removeWinningSide:l}=im({tournamentRecord:t.tournamentRecord,appliedPolicies:t.appliedPolicies,matchUpId:r,drawDefinition:a,matchUpsMap:s,event:o});l&&console.log("REMOVE WINNING SIDE")}return pe({result:i,stack:e})}function bW(t){var u,d,p;let e=di(t,[{[ls]:!0,[_s]:!0,[Cp]:!0},{homeParticipantId:!0,[Jp]:ya}]);if(e.error)return e;let i=qT(t,[{[CT]:_h,attr:{[ix]:!0}}]);if(i.error)return i;let n=(p=(d=(u=i==null?void 0:i.matchUp)==null?void 0:u.matchUp)==null?void 0:d.sides)==null?void 0:p.map(h=>h==null?void 0:h.participantId);if(t.homeParticipantId&&!(n!=null&&n.includes(t.homeParticipantId)))return{error:vd};let{disableNotice:r=!0,homeParticipantId:a,removePriorValues:o,tournamentRecord:s,drawDefinition:l,matchUpId:c}=t;return Al({duplicateValues:!1,removePriorValues:o,tournamentRecord:s,drawDefinition:l,disableNotice:r,matchUpId:c,timeItem:{itemType:Eae,itemValue:a}})}function Ag(t){var h;let e="addMatchUpScheduledTime",i=t.matchUp,{removePriorValues:n,tournamentRecord:r,drawDefinition:a,disableNotice:o,scheduledTime:s,matchUpId:l}=t;if(!l)return pe({result:{error:ss},stack:e});if(!MT(s))return pe({result:{error:su},stack:e});if(!i){let f=nr({drawDefinition:a,matchUpId:l});if(f.error)return pe({result:f,stack:e});i=f.matchUp}let c=Ei(s),u=Hv({matchUp:i}).scheduledDate,d=c&&!u;if((h=sq({matchUp:i}).timeModifiers||[])!=null&&h.length){let f=Lue({disableNotice:!0,removePriorValues:n,tournamentRecord:r,timeModifiers:[],drawDefinition:a,matchUpId:l,matchUp:i});if(f!=null&&f.error)return pe({result:f,stack:e})}let p=OI(s,!0,d);return Al({duplicateValues:!1,removePriorValues:n,tournamentRecord:r,drawDefinition:a,disableNotice:o,matchUpId:l,timeItem:{itemType:LT,itemValue:p}})}function Lue({removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:n,timeModifiers:r,matchUpId:a,matchUp:o}){let s="addMatchUpTimeModifiers";if(!a)return pe({result:{error:ss},stack:s});if(r!==void 0&&!Array.isArray(r))return pe({info:Zm("timeModifiers"),result:{error:Re},stack:s});if(!o){let d=nr({drawDefinition:i,matchUpId:a});if(d.error)return pe({result:d,stack:s});o=d.matchUp}let l=sq({matchUp:o}).timeModifiers||[],c=r.filter(d=>!l.includes(d));if(r.length&&!c.length)return{...ce};if(c.some(d=>q2.includes(d))){l=l.filter(p=>!q2.includes(p));let d=Ag({disableNotice:!0,removePriorValues:t,scheduledTime:"",tournamentRecord:e,drawDefinition:i,matchUpId:a});if(d.error)return pe({result:d,stack:s})}let u=r!=null&&r.length?[...c,...l]:void 0;return Al({duplicateValues:!1,removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:n,matchUpId:a,timeItem:{itemType:aq,itemValue:u}})}function TO({scheduledDate:t,removePriorValues:e,tournamentRecord:i,drawDefinition:n,disableNotice:r,matchUpId:a}){if(!a)return{error:ss};let o=t&&up.test(t);if(t&&!o)return{error:Xa};let s={itemValue:Ei(t),itemType:OT};return Al({duplicateValues:!1,removePriorValues:e,tournamentRecord:i,drawDefinition:n,disableNotice:r,matchUpId:a,timeItem:s})}function UO({removePriorValues:t,tournamentRecords:e,tournamentRecord:i,drawDefinition:n,disableNotice:r,courtDayDate:a,matchUpId:o,courtIds:s}){var u,d;if(!i&&!e)return{error:ut};if(!o)return{error:ss};let l=nr({drawDefinition:n,matchUpId:o});if(l.error)return l;if(((u=l==null?void 0:l.matchUp)==null?void 0:u.matchUpType)!==pp)return{error:al};if(!(s===void 0||Array.isArray(s)&&s.length&&s.every(p=>typeof p=="string")))return{error:Re,context:{courtIds:s}};let c;if(s){let p=e||i&&{[i.tournamentId]:i},h=nm({tournamentRecords:p});if(h.error)return h;let f=(d=h.courts)==null?void 0:d.filter(m=>s.includes(m.courtId));if((f==null?void 0:f.length)!==s.length)return{error:Re,context:{courtIds:s}};c=f==null?void 0:f.map(m=>({venueId:m.venueId,courtId:m.courtId}))}return Al({duplicateValues:!1,removePriorValues:t,tournamentRecord:i,drawDefinition:n,disableNotice:r,matchUpId:o,timeItem:{itemType:Mf,itemDate:a,itemValue:c}})}function XT({removePriorValues:t,tournamentRecords:e,tournamentRecord:i,drawDefinition:n,disableNotice:r,matchUpId:a,venueId:o}){if(!i)return{error:ut};if(!a)return{error:ss};if(o){let s=kh({tournamentRecords:e,tournamentRecord:i,venueId:o});if(s.error)return s}return Al({duplicateValues:!1,removePriorValues:t,tournamentRecord:i,drawDefinition:n,disableNotice:r,matchUpId:a,timeItem:{itemType:xT,itemValue:o}})}function QI({removePriorValues:t,tournamentRecords:e,tournamentRecord:i,drawDefinition:n,disableNotice:r,courtDayDate:a,matchUpId:o,courtId:s}){var l;if(!i&&!e)return{error:ut};if(!o)return{error:ss};if(s){let c=jI({tournamentRecords:e,tournamentRecord:i,courtId:s});if(c.error)return c;let u=(l=c.venue)==null?void 0:l.venueId;XT({tournamentRecords:e,tournamentRecord:i,drawDefinition:n,disableNotice:r,matchUpId:o,venueId:u})}return Al({duplicateValues:!1,removePriorValues:t,tournamentRecord:i,drawDefinition:n,disableNotice:r,matchUpId:o,timeItem:{itemType:Gv,itemDate:a,itemValue:s}})}function Yd(t,e){let i=Gre.test(t)?t:ir(t),n=Ei(t)||Ei(e)||dd(new Date);return new Date(`${n}T${i}`).getTime()}function DO(t){var A;let e="addMatchUpScheduleItems",i=di(t,[{drawDefinition:!0,matchUpId:!0},{schedule:!0,[$l]:vl}],e);if(i.error)return i;let{matchUpDependencies:n,inContextMatchUps:r}=t,{errorOnAnachronism:a=!1,checkChronology:o=!0,removePriorValues:s,tournamentRecords:l,tournamentRecord:c,drawDefinition:u,disableNotice:d,drawMatchUps:p,matchUpId:h,schedule:f,event:m}=t,g,v;if(p)g=p.find(_=>_.matchUpId===h);else{let _=nr({drawDefinition:u,event:m,matchUpId:h});if(_.error)return _;g=_.matchUp}let{endTime:y,courtId:b,courtIds:I,courtOrder:T,resumeTime:w,homeParticipantId:S,scheduledDate:D,scheduledTime:E,startTime:C,stopTime:P,timeModifiers:R,venueId:N}=f;o&&(!n||!r)&&({matchUpDependencies:n,matchUps:r}=Vu({drawDefinition:u}));let M=(A=n==null?void 0:n[h])==null?void 0:A.matchUpIds;if(f.scheduledDate&&o&&M){let _=r==null?void 0:r.filter(x=>{var O,B;return(((O=x.schedule)==null?void 0:O.scheduledDate)||Ei((B=x.schedule)==null?void 0:B.scheduledTime))&&M.includes(x.matchUpId)}).map(({schedule:x})=>{let O=vA(x);return new Date(O).getTime()});if(_!=null&&_.length){let x=vA(f),O=new Date(x).getTime();if(Math.max(..._)>=O){if(a)return pe({result:{error:M2},stack:e});v=M2}}}if(D!==void 0){let _=TO({disableNotice:!0,removePriorValues:s,tournamentRecord:c,drawDefinition:u,scheduledDate:D,matchUpId:h});if(_!=null&&_.error)return pe({result:_,stack:e,context:{scheduledDate:D}})}if(E!==void 0){let _=Ag({disableNotice:!0,removePriorValues:s,tournamentRecord:c,drawDefinition:u,scheduledTime:E,matchUpId:h,matchUp:g});if(_!=null&&_.error)return pe({result:_,stack:e,context:{scheduledTime:E}})}if(C!==void 0){let _=wW({disableNotice:!0,removePriorValues:s,tournamentRecord:c,drawDefinition:u,matchUpId:h,startTime:C,event:m});if(_!=null&&_.error)return pe({result:_,stack:e,context:{startTime:C}})}if(P!==void 0){let _=TW({disableNotice:!0,removePriorValues:s,tournamentRecord:c,drawDefinition:u,matchUpId:h,stopTime:P,event:m});if(_!=null&&_.error)return pe({result:_,stack:e,context:{stopTime:P}})}if(w!==void 0){let _=UW({disableNotice:!0,removePriorValues:s,tournamentRecord:c,drawDefinition:u,resumeTime:w,matchUpId:h,event:m});if(_!=null&&_.error)return pe({result:_,stack:e,context:{resumeTime:w}})}if(y!==void 0){let _=SW({disableNotice:!0,removePriorValues:s,tournamentRecord:c,drawDefinition:u,matchUpId:h,endTime:y,event:m});if(_!=null&&_.error)return pe({result:_,stack:e,context:{endTime:y}})}if(I!==void 0){let _=UO({disableNotice:!0,removePriorValues:s,tournamentRecord:c,drawDefinition:u,matchUpId:h,courtIds:I});if(_!=null&&_.error)return pe({result:_,stack:e,context:{courtIds:I}})}if(b!==void 0&&D!==void 0){let _=QI({courtDayDate:D,disableNotice:!0,removePriorValues:s,tournamentRecords:l,tournamentRecord:c,drawDefinition:u,matchUpId:h,courtId:b});if(_!=null&&_.error)return pe({result:_,stack:e,context:{courtId:b}})}if(N!==void 0){let _=XT({disableNotice:!0,removePriorValues:s,tournamentRecords:l,tournamentRecord:c,drawDefinition:u,matchUpId:h,venueId:N});if(_!=null&&_.error)return pe({result:_,stack:e,context:{venueId:N}})}if(T!==void 0&&yi(T)){let _=IW({disableNotice:!0,removePriorValues:s,tournamentRecord:c,drawDefinition:u,courtOrder:T,matchUpId:h});if(_!=null&&_.error)return pe({result:_,stack:e,context:{courtOrder:T}})}if(R!==void 0){let _=Lue({disableNotice:!0,removePriorValues:s,tournamentRecord:c,drawDefinition:u,timeModifiers:R,matchUpId:h,matchUp:g});if(_!=null&&_.error)return pe({result:_,stack:e,context:{timeModifiers:R}})}return $r(S)&&bW({disableNotice:!0,homeParticipantId:S,removePriorValues:s,tournamentRecord:c,drawDefinition:u,matchUpId:h}),d||en({tournamentId:c==null?void 0:c.tournamentId,eventId:m==null?void 0:m.eventId,context:e,drawDefinition:u,matchUp:g}),v?{...ce,warnings:[v]}:{...ce}}function IW({removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:n,courtOrder:r,matchUpId:a}){if(!a)return{error:ss};if(r&&!yi(r))return{error:Re,info:"courtOrder must be numeric"};let o=r&&ri(r);return Al({duplicateValues:!1,removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:n,matchUpId:a,timeItem:{itemType:yx,itemValue:o}})}function Fue({removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:n,participantId:r,officialType:a,matchUpId:o}){if(!o)return{error:ss};if(!r)return{error:ya};if(e){let l=Nr({tournamentRecord:e,participantFilters:{participantTypes:[Hi],participantRoles:[vq]}}).participants??[];if(!zm({tournamentParticipants:l,participantId:r}))return{error:Vr}}let s={itemType:"SCHEDULE.ASSIGNMENT.OFFICIAL",itemValue:r};return a&&(s.itemSubTypes=[a]),Al({duplicateValues:!1,removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:n,matchUpId:o,timeItem:s})}function wW({removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:n,matchUpId:r,startTime:a,event:o}){if(!r)return{error:ss};if(!MT(a))return{error:su};let{matchUp:s}=nr({drawDefinition:i,event:o,matchUpId:r}),{scheduledDate:l}=Hv({matchUp:s}),c=((s==null?void 0:s.timeItems)??[]).filter(u=>[vf,eh,Nf].includes(u==null?void 0:u.itemType)).map(u=>Yd(u.itemValue,l)).reduce((u,d)=>!u||d<u?d:u,void 0);if(!c||Yd(a,l)<c){s!=null&&s.timeItems&&(s.timeItems=s.timeItems.filter(d=>d.itemType!==id));let u=OI(a,!0,!0);return Al({duplicateValues:!1,removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:n,matchUpId:r,timeItem:{itemType:id,itemValue:u}})}else return{error:Wne}}function SW({validateTimeSeries:t=!0,removePriorValues:e,tournamentRecord:i,drawDefinition:n,disableNotice:r,matchUpId:a,endTime:o,event:s}){if(!a)return{error:ss};if(!MT(o))return{error:su};let{matchUp:l}=nr({drawDefinition:n,event:s,matchUpId:a}),{scheduledDate:c}=Hv({matchUp:l}),u=((l==null?void 0:l.timeItems)??[]).filter(d=>[id,eh,vf].includes(d==null?void 0:d.itemType)).map(d=>Yd(d.itemValue,c)).reduce((d,p)=>!d||p>d?p:d,void 0);if(!t||!u||Yd(o,c)>u){l!=null&&l.timeItems&&(l.timeItems=l.timeItems.filter(p=>p.itemType!==Nf));let d=OI(o,!0,!0);return Al({duplicateValues:!1,removePriorValues:e,tournamentRecord:i,drawDefinition:n,disableNotice:r,matchUpId:a,timeItem:{itemType:Nf,itemValue:d}})}else return{error:zne}}function TW({removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:n,matchUpId:r,stopTime:a,event:o}){if(!r)return{error:ss};if(!MT(a))return{error:su};let{matchUp:s}=nr({drawDefinition:i,event:o,matchUpId:r}),{scheduledDate:l}=Hv({matchUp:s}),c=(s==null?void 0:s.timeItems)??[];if(c.reduce((f,m)=>m.itemType===Nf||f,void 0))return{error:zH};let u=c.filter(f=>[id,eh,vf].includes(f==null?void 0:f.itemType)).sort((f,m)=>Yd(f.itemValue,l)-Yd(m.itemValue,l)),d=u[u.length-1],p=d&&d.itemType===vf,h=u.filter(f=>!p||f.createdAt!==d.createdAt).map(f=>Yd(f.itemValue,l)).reduce((f,m)=>!f||m>f?m:f,void 0);if(Yd(a,l)>h){if(s!=null&&s.timeItems&&p){let m=d.createdAt;s.timeItems=s.timeItems.filter(g=>g.createdAt!==m)}let f={itemValue:OI(a,!0,!0),itemType:vf};return Al({duplicateValues:!0,removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:n,matchUpId:r,timeItem:f})}else return{error:qne}}function UW({removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:n,resumeTime:r,matchUpId:a,event:o}){if(!a)return{error:ss};if(!MT(r))return{error:su};let{matchUp:s}=nr({drawDefinition:i,event:o,matchUpId:a}),{scheduledDate:l}=Hv({matchUp:s}),c=(s==null?void 0:s.timeItems)??[];if(c.reduce((f,m)=>m.itemType===Nf||f,void 0))return{error:zH};let u=c.filter(f=>[id,eh,vf].includes(f==null?void 0:f.itemType)).sort((f,m)=>Yd(f.itemValue,l)-Yd(m.itemValue,l)),d=u[u.length-1],p=d&&d.itemType===eh,h=u.filter(f=>!p||f.createdAt!==d.createdAt).map(f=>Yd(f.itemValue,l)).reduce((f,m)=>!f||m>f?m:f,void 0);if(Yd(r,l)>h){if(s!=null&&s.timeItems&&p){let m=d.createdAt;s.timeItems=s.timeItems.filter(g=>g.createdAt!==m)}let f={itemValue:OI(r,!0,!0),itemType:eh};return Al({duplicateValues:!0,removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:n,matchUpId:a,timeItem:f})}else return{error:IPe}}function XOe({drawDefinition:t,matchUpStatus:e,matchUpsMap:i,winningSide:n,dualMatchUp:r,tieFormat:a,structure:o,matchUp:s,event:l,score:c}){var p;let u=Ot(r,void 0,!0);for(let h of(u==null?void 0:u.tieMatchUps)||[])h.matchUpId===s.matchUpId&&(h.winningSide=n,h.score=c,!Pa({score:c})&&!e?Object.assign(h,{...Lx}):e&&(h.matchUpStatus=e));a=a??((p=is({matchUp:s,structure:o,drawDefinition:t,event:l}))==null?void 0:p.tieFormat);let{winningSide:d}=YC({matchUp:u,drawDefinition:t,matchUpsMap:i,structure:o,tieFormat:a,event:l});return{projectedWinningSide:d}}function JOe(t){var T;let{tournamentRecord:e,inContextMatchUp:i,structure:n,drawDefinition:r}=t,a=i.roundNumber,o=i.sides.find(w=>w.sideNumber===i.winningSide),s=i.sides.find(w=>w.sideNumber!==i.winningSide),{drawPosition:l,participantId:c}=o,{drawPosition:u,participantId:d}=s,p="swapWinnerLoser",{matchUps:h}=wn(t),f=h.filter(({drawPositions:w,roundNumber:S})=>(w==null?void 0:w.includes(l))&&S>a);Jl({changeWinner:!0})&&console.log({existingWinnerSubsequentMatchUps:f}),f.forEach(w=>{var S,D;w.drawPositions=((S=w.drawPositions)==null?void 0:S.map(E=>E===l?u:E))||[],en({tournamentId:e==null?void 0:e.tournamentId,eventId:(D=t.event)==null?void 0:D.eventId,context:p,drawDefinition:r,matchUp:w})});let{stage:m,stageSequence:g}=n,v=r.structures.filter(({stage:w,stageSequence:S})=>w===m&&S>g).map(({structureId:w})=>w),{targetLinks:{loserTargetLink:y,winnerTargetLink:b}}=t.targetData,I=[y==null?void 0:y.target.structureId,(T=b==null?void 0:b.target)==null?void 0:T.structureId].filter(Boolean);return r.structures.filter(({stage:w,structureId:S})=>w!==m&&I.includes(S)).forEach(({stage:w,stageSequence:S,structureId:D})=>{v.includes(D)||v.push(D),r.structures.filter(({stage:E,stageSequence:C})=>E===w&&C>S).forEach(({structureId:E})=>{v.includes(E)||v.push(E)})}),r.structures.filter(({structureId:w})=>v.includes(w)).forEach(w=>{let{positionAssignments:S}=Vn({structure:w}),D=S==null?void 0:S.find(({participantId:C})=>C===c),E=S==null?void 0:S.find(({participantId:C})=>C===d);D&&(D.participantId=d),E&&(E.participantId=c)}),tp({...t,context:p})}function pP(t){var G,H,$;let e="setMatchUpStatus";t.matchUpStatus&&[hn,ua].includes(t.matchUpStatus)&&(t.score=void 0);let{allowChangePropagation:i,disableScoreValidation:n,tournamentRecords:r,tournamentRecord:a,disableAutoCalc:o,enableAutoCalc:s,drawDefinition:l,matchUpStatus:c,winningSide:u,matchUpId:d,event:p,score:h}=t;if(!l)return{error:Vt};if(c&&[Rp,$c,ol,qr].includes(c)&&u)return{error:Re,winningSide:u,matchUpStatus:c};if(![void 0,...Nz].includes(c))return pe({result:{error:bT},info:"matchUpStatus does not exist",stack:"setMatchUpStatus"});let f=Ao({drawDefinition:l}),{matchUps:m}=Ia({nextMatchUps:!0,tournamentRecord:a,inContext:!0,drawDefinition:l,matchUpsMap:f,event:p}),g=f.drawMatchUps.find(q=>q.matchUpId===d),v=m==null?void 0:m.find(q=>q.matchUpId===d);if(!g||!m)return{error:Ho};if((g.winningSide||u)&&c===vn)return{context:"Cannot have Bye with winningSide",error:fN,matchUpStatus:c};let y=v==null?void 0:v.structureId,{structure:b}=ui({drawDefinition:l,structureId:y}),I=Gr(Xn)(g.matchUpType),T=(G=v==null?void 0:v.drawPositions)==null?void 0:G.filter(Boolean),w;if(I){if(o)cn({extension:{name:Yb,value:!0},element:g});else if(s){let q=g.winningSide;Is({name:Yb,element:g});let{winningSide:z,scoreStringSide1:Z,scoreStringSide2:Y,set:Q}=YC({drawDefinition:l,matchUpsMap:f,structure:b,matchUp:g,event:p}),X={scoreStringSide1:Z,scoreStringSide2:Y,sets:Q?[Q]:[]};w=z!==q,Object.assign(t,{winningSide:z,dualWinningSideChange:w,projectedWinningSide:z,score:X})}ZC({tournamentId:a==null?void 0:a.tournamentId,inContextDualMatchUp:v,eventId:p==null?void 0:p.eventId,dualMatchUp:g,drawDefinition:l})}if(I&&c&&[LI].includes(c))return{error:Re,info:"Not supported for matchUpType: TEAM"};let S=v==null?void 0:v.matchUpTieId,D=Ds({matchUpId:S||d,inContextDrawMatchUps:m,drawDefinition:l});if(h&&!I&&!n){let q=g.matchUpFormat??(b==null?void 0:b.matchUpFormat)??(l==null?void 0:l.matchUpFormat)??(p==null?void 0:p.matchUpFormat),z=g3({existingMatchUpStatus:g.matchUpStatus,matchUpFormat:q,matchUpStatus:c,winningSide:u,score:h});if(z.error)return z}let E=((H=dn({policyTypes:[ND,Bc],tournamentRecord:a,drawDefinition:l,event:p}))==null?void 0:H.appliedPolicies)??{};Xi(t.policyDefinitions)&&Object.assign(E,t.policyDefinitions);let C=eLe({assignedDrawPositions:T,inContextMatchUp:v,appliedPolicies:E,drawDefinition:l,matchUpStatus:c,structure:b,matchUp:g});if(C!=null&&C.error)return C;let P=(v==null?void 0:v.stage)===Zt&&v.finishingRound===1,R=P&&u,N=P&&g.winningSide&&!u&&(!t.matchUpStatus||t.matchUpStatus&&X2({matchUpStatus:t.matchUpStatus}))&&(!t.outcome||!Pa({outcome:t.outcome})),M=R&&u!==g.winningSide&&g.winningSide;if(Object.assign(t,{inContextDrawMatchUps:m,qualifierAdvancing:R,qualifierChanging:M,removingQualifier:N,inContextMatchUp:v,appliedPolicies:E,matchUpTieId:S,matchUpsMap:f,targetData:D,structure:b,matchUp:g}),S){let{matchUp:q}=nr({matchUpId:S,inContext:!0,drawDefinition:l,matchUpsMap:f,event:p});if(q){let z=($=is({matchUp:q,drawDefinition:l,structure:b,event:p}))==null?void 0:$.tieFormat,{projectedWinningSide:Z}=XOe({drawDefinition:l,matchUpStatus:c,dualMatchUp:q,matchUpsMap:f,winningSide:u,tieFormat:z,structure:b,matchUp:g,event:p,score:h}),Y=q.winningSide;w=Z!==Y,Object.assign(t,{isCollectionMatchUp:!0,dualWinningSideChange:w,projectedWinningSide:Z,matchUpTieId:S,dualMatchUp:q,tieFormat:z})}}let A=Yv(t),_=NC({matchUpStatus:c});if(!S){if(A&&!u&&(c&&X2({matchUpStatus:c})||c&&[ua,Ea].includes(c)))return{error:fN,activeDownstream:A,winningSide:u};if(u&&u===g.winningSide&&c&&!_)return{context:"winningSide must include directing matchUpStatus",error:fN,directingMatchUpStatus:_,matchUpStatus:c}}let{schedule:x}=t;if(x){let q=DO({disableNotice:!0,tournamentRecords:r,tournamentRecord:a,drawDefinition:l,matchUpId:d,schedule:x});if(q.error)return q}let O=!I&&!w&&u&&g.winningSide&&g.winningSide!==u;if(i&&O&&g.roundPosition)return JOe(t);let B=u&&!S||t.projectedWinningSide;Ac({activeDownstream:A,matchUpWinner:B,method:e,winningSide:u});let F=!A&&ZOe(t)||B&&QOe(t)||_&&Bue(t)||{error:tre};return pe({result:F,stack:e})}function QOe(t){let{matchUp:e,winningSide:i,matchUpTieId:n,dualWinningSideChange:r}=t;return i===e.winningSide||n&&!r?Bue(t):pe({stack:"winningSideWithDownstreamDependencies",result:{error:VH},context:{winningSide:i,matchUp:e}})}function Bue(t){let{tournamentRecord:e,matchUp:i,event:n}=t,r=t.isCollectionMatchUp&&i.winningSide&&!t.winningSide&&!Pa({score:t.score}),a=t.isCollectionMatchUp?t.matchUpStatus||r&&qr||jr:t.matchUpStatus||jr,o=t.removeScore||[Rp,hn].includes(a)&&![$c,ol].includes(a),s=tp({...t,matchUpStatus:a,removeWinningSide:r,context:"sms",removeScore:o});if(s.error)return s;if(t.isCollectionMatchUp){let{matchUpTieId:l,drawDefinition:c,matchUpsMap:u}=t,d=im({appliedPolicies:t.appliedPolicies,matchUpId:l,tournamentRecord:e,drawDefinition:c,matchUpsMap:u,event:n});if(d.error)return d;Object.assign(s,{tieMatchUpResult:d})}return s}function eLe({assignedDrawPositions:t,inContextMatchUp:e,appliedPolicies:i,drawDefinition:n,matchUpStatus:r,structure:a,matchUp:o}){var u,d;if(((u=i==null?void 0:i[Bc])==null?void 0:u.requireParticipantsForScoring)===!1)return{...ce};let s=(d=e==null?void 0:e.sides)==null?void 0:d.map(p=>p.participantId).filter(Boolean).length,l=o!=null&&o.sides?[]:Vn({structureId:a==null?void 0:a.structureId,drawDefinition:n}).positionAssignments,c=s&&s===2||o.collectionId&&sl({structure:a})&&s&&s>=1||(t==null?void 0:t.length)===2&&(l==null?void 0:l.filter(p=>t.includes(p.drawPosition)).every(p=>p.participantId));return r&&Mz.includes(r)&&!c?pe({info:"matchUpStatus requires assigned participants",context:{matchUpStatus:r,requiredParticipants:c},result:{error:bT}}):{...ce}}function $ue({tournamentRecord:t,drawDefinition:e,matchUpId:i,event:n}){if(!e)return{error:Vt};let{matchUp:r}=nr({drawDefinition:e,matchUpId:i,event:n});return(r==null?void 0:r.matchUpType)!==pp?{error:al}:pP({enableAutoCalc:!0,tournamentRecord:t,drawDefinition:e,matchUpId:i,event:n})}function Vue({drawDefinition:t,event:e,matchUpId:i}){if(!t)return{error:Vt};if(!i)return{error:ss};let{matchUp:n}=nr({drawDefinition:t,event:e,matchUpId:i});return n?Is({name:lx,element:n}):{error:Ho}}function tLe({substituteParticipantId:t,existingParticipantId:e,tournamentRecord:i,drawDefinition:n,sideNumber:r,matchUpId:a,event:o}){var h,f,m,g,v;let s="substituteParticipant";if(!n)return{error:Vt};if(!a)return{error:ss};if(!e||!t)return pe({result:{error:ya},stack:s});let{matchUp:l}=nr({drawDefinition:n,matchUpId:a,event:o});if(!l)return{error:Ho};if(!l.collectionId)return pe({result:{error:al},stack:s});let c=Ao({drawDefinition:n}),{matchUps:u}=Ia({tournamentParticipants:i==null?void 0:i.participants,inContext:!0,drawDefinition:n,matchUpsMap:c}),d=u==null?void 0:u.find(y=>y.matchUpId===a),p=(f=(h=u==null?void 0:u.find(y=>y.matchUpId===(d==null?void 0:d.matchUpTieId)))==null?void 0:h.sides)==null?void 0:f.find(y=>y.participant.individualParticipants.some(({participantId:b})=>b===e));return!p||r&&p.sideNumber!==r?{error:vd}:(v=(g=(m=p.participant)==null?void 0:m.individualParticipants)==null?void 0:g.map(Gi).filter(y=>y!==e))!=null&&v.includes(t)?vW({newParticipantId:t,tieMatchUpId:a,existingParticipantId:e,substitution:!0,tournamentRecord:i,drawDefinition:n,event:o}):pe({result:{error:vd},stack:s})}function jue(t){return tLe(t)}function Gue({drawDefinition:t,matchUpId:e,event:i}){if(!t)return{error:Vt};let{matchUp:n}=nr({drawDefinition:t,matchUpId:e,event:i});return cn({extension:{name:Yb,value:!0},element:n})}function Hue(t){let e="setMatchUpFormat",i=di(t,[{tournamentRecord:!0},{[$o]:T=>Nl({matchUpFormat:T}),[Ql]:nC,matchUpFormat:!0}]);if(i.error)return pe({result:i,stack:e});let{tournamentRecord:n,drawDefinition:r,scheduledDates:a,stageSequences:o,matchUpFormat:s,structureId:l,eventType:c,matchUpId:u,eventId:d,stages:p,drawId:h,event:f,force:m}=t;if(a&&!Array.isArray(a))return pe({result:{error:Re,scheduledDates:a},stack:e});if(c&&!Ex([cp,Oc],c))return pe({result:{error:ph},stack:e});let g=0,v=t.structureIds||l&&[l].filter(Boolean)||[],y=t.eventIds||d&&[d].filter(Boolean)||[],b=t.drawIds||h&&[h].filter(Boolean)||[];if((l||v!=null&&v.length)&&!r)return pe({result:{error:Vt},stack:e});if(h&&u&&r){let T=I3({tournamentRecord:n,drawDefinition:r,matchUpFormat:s,structureIds:v,structureId:l,matchUpId:u});if(T.error)return T;g+=1}let I=T=>{let w=[];for(let S of T.structures||[]){if(Array.isArray(p)&&!p.includes(S.stage)||Array.isArray(o)&&!o.includes(S.stageSequence)||v!=null&&v.length&&!v.includes(S.structureId))continue;v!=null&&v.length&&S.matchUpFormat!==s&&(S.matchUpFormat=s,w.push(S.structureId),g+=1);let D=((m||a)&&wn({matchUpFilters:{matchUpStatuses:[qr]},structure:S}).matchUps)??[],E=(a&&wn({matchUpFilters:{matchUpStatuses:[qr]},contextFilters:{scheduledDates:a},afterRecoveryTimes:!1,inContext:!0,structure:S}).matchUps)??[];if(D!=null&&D.length){let C=E?E.map($a):D.map($a);for(let P of D)C.includes(P.matchUpId)&&(P.matchUpFormat=a!=null&&a.length?s:void 0,en({tournamentId:n==null?void 0:n.tournamentId,eventId:f==null?void 0:f.eventId,context:e,drawDefinition:T,matchUp:P}))}}return!w.length&&T.matchUpFormat!==s&&(T.matchUpFormat=s,g+=1),w};for(let T of(n==null?void 0:n.events)||[])if(!(y!=null&&y.length&&!y.includes(T.eventId)||c&&c!==T.eventType||c===ga))if(Array.isArray(o)||Array.isArray(p)||v!=null&&v.length||b!=null&&b.length)for(let w of T.drawDefinitions||[]){if(Array.isArray(b)&&!b.includes(w.drawId))continue;let S=I(w);qn({structureIds:S,drawDefinition:w})}else T.matchUpFormat!==s&&(T.matchUpFormat=s,g+=1);return g?{...ce,modificationsCount:g}:{...ce,info:TT}}function DW({inheritance:t=!0,tournamentRecord:e,drawDefinition:i,matchUpId:n,event:r}){var l,c;if(!i)return{error:Vt};let a=(l=nr({drawDefinition:i,matchUpId:n}))==null?void 0:l.matchUp;if(!(a!=null&&a.tieMatchUps))return{error:al};let o=(c=nr({inContext:!0,drawDefinition:i,matchUpId:n,event:r}))==null?void 0:c.matchUp,s=0;return((a==null?void 0:a.sides)||[]).forEach(u=>{u.lineUp&&delete u.lineUp}),((o==null?void 0:o.sides)||[]).forEach(u=>{if(s+=1,t===!1){let d=o==null?void 0:o.tieFormat,p=u.participantId;d&&p&&WI({drawDefinition:i,participantId:p,lineUp:[],tieFormat:d})}en({tournamentId:e==null?void 0:e.tournamentId,context:"resetMatchUpLineUps",eventId:r==null?void 0:r.eventId,drawDefinition:i,matchUp:a})}),{...ce,modificationsCount:s}}function zue(t){let{matchUpFormat:e,matchUpStatus:i,winningSide:n,score:r}=t;if(!r)return{sets:[]};let a=r.sets||[],o=nh({winnerFirst:!1,matchUpFormat:e,matchUpStatus:i,sets:a}),s=nh({winnerFirst:!1,reversed:!0,matchUpFormat:e,matchUpStatus:i,sets:a}),l=nh({matchUpFormat:e,matchUpStatus:i,winningSide:n,sets:a}),c=o===l?s:o;return n&&(o=n===1?l:c,s=n===2?l:c),{score:{sets:a,scoreStringSide1:o,scoreStringSide2:s}}}function hP(t){var v,y;let e=di(t,[{[Cp]:!0,[_s]:!0}]);if(e.error)return e;let i=qc(t);if(!t.drawDefinition){let b=t.tournamentRecord??(t.tournamentId&&i[t.tournamentId]);t.tournamentRecord||(t.tournamentRecord=b);let I=zs({eventId:t.eventId,drawId:t.drawId,tournamentRecord:b});if(I.error)return I;I.drawDefinition&&(t.drawDefinition=I.drawDefinition),t.event=I.event}let{disableScoreValidation:n,policyDefinitions:r,tournamentRecord:a,disableAutoCalc:o,enableAutoCalc:s,drawDefinition:l,matchUpId:c,schedule:u,event:d,notes:p}=t,h=t.matchUpFormat||((v=t.outcome)==null?void 0:v.matchUpFormat),{policy:f}=Ty({policyType:Bc,tournamentRecord:a,event:d}),m=t.allowChangePropagation!==void 0&&t.allowChangePropagation||(f==null?void 0:f.allowChangePropagation)!==void 0&&f.allowChangePropagation||void 0,{outcome:g}=t;if(g!=null&&g.winningSide&&![1,2].includes(g.winningSide))return{error:Fk};if(h){let b=I3({tournamentRecord:a,drawDefinition:l,matchUpFormat:h,matchUpId:c,event:d});if(b.error)return b}if((y=g==null?void 0:g.score)!=null&&y.sets&&!g.score.scoreStringSide1){let{score:b}=zue(g);g.score=b,g.score.sets=g.score.sets.filter(I=>I.side1Score||I.side2Score||I.side1TiebreakScore||I.side2TiebreakScore)}return pP({matchUpStatusCodes:g==null?void 0:g.matchUpStatusCodes,matchUpStatus:g==null?void 0:g.matchUpStatus,winningSide:g==null?void 0:g.winningSide,allowChangePropagation:m,disableScoreValidation:n,score:g==null?void 0:g.score,tournamentRecords:i,policyDefinitions:r,tournamentRecord:a,disableAutoCalc:o,enableAutoCalc:s,drawDefinition:l,matchUpFormat:h,matchUpId:c,schedule:u,event:d,notes:p})}function que(t){if(!(t!=null&&t.outcomes))return{error:Yt};if(!Array.isArray(t.outcomes))return{error:Yt,info:{outcomes:t.outcomes}};let e=t.tournamentRecords||t.tournamentRecord&&{[t.tournamentRecord.tournamentId]:t.tournamentRecord}||{},i=t.outcomes??[],n=i.reduce((r,a)=>r.includes(a.tournamentId)?r:r.concat(a.tournamentId),[]);for(let r of n){let a=e[r];if(!a)return{error:ut};let o=i.filter(s=>s.tournamentId===r);if(o.length){let s=iLe({outcomes:o,tournamentRecord:a});if(s.error)return s}}return{...ce}}function iLe(t){var o;let{tournamentRecords:e,tournamentRecord:i,outcomes:n,policyDefinitions:r}=t,a={};n.forEach(s=>{let{eventId:l}=s;a[l]||(a[l]=[]),a[l].push(s)});for(let s of Object.keys(a)){let{event:l}=zs({tournamentRecord:i,eventId:s});for(let c of a[s]){let{drawId:u}=c,d=(o=l==null?void 0:l.drawDefinitions)==null?void 0:o.find(p=>p.drawId===u);if(d&&u){let{matchUpFormat:p,matchUpId:h}=c,f=hP({schedule:c==null?void 0:c.schedule,tournamentRecords:e,policyDefinitions:r,tournamentRecord:i,drawDefinition:d,matchUpFormat:p,matchUpId:h,outcome:c,drawId:u,event:l});if(f.error)return f}}}return{...ce}}function nLe({drawDefinition:t,matchUpId:e,outcome:i,matchUp:n}){var r,a;if(!n&&!t)return{error:Vt};if(!i)return{error:Yt,info:"missing outcome"};if(!n&&!e)return{error:rl};if(!n){let o=nr({drawDefinition:t,matchUpId:e});if(o.error)return o;n=o.matchUp}return typeof i!="object"||!((r=i.score)!=null&&r.scoreStringSide1)||!((a=i.score)!=null&&a.scoreStringSide2)?{error:Re}:cn({element:n,extension:{name:lx,value:i}})}function Wue(t){return nLe(t)}function EW(t){var m,g;let e="resetTieFormat",{drawDefinition:i,event:n,uuids:r}=t,a=di(t,[{[ls]:!0,[Cp]:!0}],e);if(a.error)return a;let o=qT(t,[{[CT]:_h}]);if(o[Jp])return o;let s=(m=t.tournamentRecord)==null?void 0:m.tournamentId,{matchUp:l,structure:c}=(o==null?void 0:o.matchUp)??{};if(!(l!=null&&l.tieMatchUps))return pe({result:{error:al},info:"Must be a TEAM matchUp",stack:e});if(!l.tieFormat)return{...ce};let u=(g=is({structure:c,drawDefinition:i,event:n}))==null?void 0:g.tieFormat;if(!u)return pe({result:{error:no},info:"No inherited tieFormat",stack:e});let d=[],p=[],h=[],f=[];for(let v of u.collectionDefinitions){let{matchUpCount:y,collectionId:b}=v;p.push(b);let I=(l.tieMatchUps||[]).filter(T=>T.collectionId===b);if(I.length>y)I.sort((T,w)=>(T.matchUpStatus===qr?1:0)-(w.matchUpStatus===qr?1:0)),h.push(...I.slice(0,y)),d.push(...I.slice(3).map($a));else if(h.push(...I),I.length<y){let T=y-I.length,w=zC({collectionDefinition:v,matchUpsLimit:T,matchUp:l,uuids:r});f.push(...w)}}for(let v of(l==null?void 0:l.tieMatchUps)||[])v.collectionId&&!p.includes(v.collectionId)&&d.push(v.matchUpId);return f.length&&(h.push(...f),Km({eventId:n==null?void 0:n.eventId,matchUps:f,drawDefinition:i,tournamentId:s})),d.length&&Qf({matchUpIds:d,eventId:n==null?void 0:n.eventId,drawDefinition:i,tournamentId:s}),l&&(l.tieMatchUps=h,l.tieFormatId=void 0,l.tieFormat=void 0,en({structureId:c==null?void 0:c.structureId,eventId:n==null?void 0:n.eventId,context:e,drawDefinition:i,tournamentId:s,matchUp:l})),{...ce,newMatchUps:f,deletedMatchUpIds:d}}function CW(t){var m,g,v;let{tournamentRecord:e,drawDefinition:i,matchUpId:n,event:r}=t,a="resetScorecard";if(!i)return pe({result:{error:Vt},stack:a});if(!n)return pe({result:{error:ss},stack:a});if(!$r(n))return pe({result:{error:Re,matchUpId:n},stack:a});let o=Ao({drawDefinition:i}),{matchUps:s}=Ia({nextMatchUps:!0,inContext:!0,drawDefinition:i,matchUpsMap:o}),l=o.drawMatchUps.find(y=>y.matchUpId===n),c=s==null?void 0:s.find(y=>y.matchUpId===n);if(!l||!s)return{error:Ho};if(l.matchUpType!==Lc)return{error:al};let u=Ds({inContextDrawMatchUps:s,drawDefinition:i,matchUpId:n}),d=c==null?void 0:c.structureId,{structure:p}=ui({drawDefinition:i,structureId:d});if(Object.assign(t,{inContextDrawMatchUps:s,inContextMatchUp:c,matchUpsMap:o,targetData:u,structure:p,matchUp:l}),Yv(t))return{error:VH};if((m=l.tieMatchUps)!=null&&m.length)for(let y of l.tieMatchUps){let b=pP({matchUpId:y.matchUpId,matchUpTieId:n,winningSide:void 0,removeScore:!0,tournamentRecord:e,drawDefinition:i,event:r});if(b.error)return pe({result:b,stack:a})}let h=(g=dn({tournamentRecord:e,drawDefinition:i,event:r}))==null?void 0:g.appliedPolicies,f=im({event:t.event,removeScore:!0,tournamentRecord:e,appliedPolicies:h,drawDefinition:i,matchUpsMap:o,matchUpId:n});if(f.error)return pe({result:f,stack:a});if(t.tiebreakReset&&!f.tieFormatRemoved){let y=(v=is({drawDefinition:i,structure:p,event:r}))==null?void 0:v.tieFormat;if(l.tieFormat&&y){let{matchUpCountDifference:b,descendantDifferences:I,ancestorDifferences:T,valueDifference:w}=Af({descendant:l.tieFormat,ancestor:y});if(I.collectionIds.length===1&&!T.collectionIds.length&&!T.groupsCount&&b===1&&w===1){let S=EW({tournamentRecord:e,drawDefinition:i,matchUpId:n,event:r});if(S.error)return S}}}return{...ce}}function Kue(t){let e=di(t,[{[_s]:!0,[by]:!0},{[RD]:{[uC]:!1,roundNumbers:!1},[$re]:"At least one must be provided",[$l]:gs}]);if(e.error)return e;let i=Ese(t);if(i.error)return i;let{matchUpIds:n}=i,r=Gr(Lc)(t.event.eventType),{tournamentRecord:a,drawDefinition:o,event:s}=t;for(let l of n){if(r){let u=CW({tiebreakReset:!0,tournamentRecord:a,drawDefinition:o,matchUpId:l,event:s});if(u.error||t.removeAssignments&&DW({inheritance:!1,drawDefinition:o,matchUpId:l}).error)return u}let c=pP({winningSide:void 0,removeScore:!0,tournamentRecord:a,drawDefinition:o,matchUpId:l,event:s});if(c.error)return c;if(t.removeAssignments){let u=yW({...t,matchUpId:l});if(u.error)return u}}return{...ce}}function rLe({drawDefinition:t,finishingOrder:e}){var v;if(!t)return{error:Vt};let i="setOrderOfFinish";if(!Array.isArray(e))return pe({info:Zm("finishingOrder"),result:{error:Re},stack:i});let{completedMatchUps:n,matchUpsMap:r}=BT({inContext:!0,drawDefinition:t}),a=(n==null?void 0:n.map($a))??[],o=e.map($a),{matchUpTypes:s,roundNumbers:l,structureIds:c,matchUpTieIds:u}=(n??[]).filter(({matchUpId:y})=>o.includes(y)).reduce((y,b)=>{let{matchUpTieId:I,matchUpType:T,roundNumber:w,structureId:S}=b;return y.matchUpTypes.includes(T)||y.matchUpTypes.push(T),y.roundNumbers.includes(w)||y.roundNumbers.push(w),y.structureIds.includes(S)||y.structureIds.push(S),y.matchUpTieIds.includes(I)||y.matchUpTieIds.push(I),y},{matchUpTypes:[],roundNumbers:[],structureIds:[],matchUpTieIds:[]});if(s.length>1||u.length>1||l.length>1||c.length>1)return pe({info:"matchUpType, structureId and roundNumber must be equivalent",result:{error:Re},stack:i});let d,p,h={},f=[],m=[];if(!e.every(({orderOfFinish:y,matchUpId:b})=>(f.push(b),y&&m.push(y),h[b]=y,d=a.includes(b),p=y===void 0||yi(y)&&Math.floor(y)>0,d&&p)))return pe({result:{error:d?Re:bT},info:!d&&"matchUps must be completed"||!p&&"orderOfFinish must be integer > 0 or undefined"||void 0,stack:i});let g=n==null?void 0:n.filter(y=>y.structureId===c[0]&&y.roundNumber===l[0]&&y.matchUpType===s[0]&&y.matchUpTieId===u[0]&&!f.includes(y.matchUpId));for(let y of g??[]){let{orderOfFinish:b}=y||{};if(b){if(!yi(b))return pe({context:{orderOfFinish:b,matchUp:y},result:{error:Re},stack:i});m.push(b)}}if(pre(m).length!==m.length||Math.max(...m)>m.length)return pe({info:"Values not unique or greater than expected number of values",result:{error:Re},stack:i});if(c.length){let y=Cx({matchUpFilters:{matchUpIds:o},structureId:c[0],drawDefinition:t,matchUpsMap:r});if(y.error)return pe({result:y,stack:i});(v=y.completedMatchUps)==null||v.forEach(b=>b.orderOfFinish=h[b.matchUpId])}return{...ce}}function Yue(t){return rLe(t)}function Zue(t){var v,y,b,I;let{tournamentRecord:e,drawDefinition:i,matchUpId:n,lineUps:r,event:a}=t,o="applyLineUps",s=di(t,[{[ls]:!0,[_s]:!0,[Cp]:!0},{lineUps:!0,[$l]:gs}],o);if(s.error)return s;let l=e.participants||[],c=nr({tournamentParticipants:l,inContext:!0,drawDefinition:i,matchUpId:n});if(c.error)return c;if(!c.matchUp)return{error:Ho};let{matchUp:u,structure:d}=c,{drawPositions:p,matchUpType:h}=u;if(h!==Xn)return{error:al};if(!(p!=null&&p.length))return{error:tC};let f=(v=is({matchUp:u,drawDefinition:i,structure:d,event:a}))==null?void 0:v.tieFormat,m={};for(let T of r){if(!Array.isArray(T))return{error:Re,lineUp:T};let w={},S=[];for(let R of T){if(typeof R!="object")return{error:Re,lineUpAssignment:R};let{participantId:N,collectionAssignments:M=[]}=R;if(!Array.isArray(M))return{error:Re,collectionAssignments:M};let A=l.find(x=>x.participantId===N);if(!A)return{error:Vr};if(A.participantType!==Hi)return{error:yd};let _=(b=(y=u.sides)==null?void 0:y.find(x=>{var O,B;return(B=(O=x.participant)==null?void 0:O.individualParticipantIds)==null?void 0:B.includes(N)}))==null?void 0:b.sideNumber;_&&S.push(_);for(let x of M){if(typeof x!="object")return{error:Re,collectionAssignment:x};let{collectionId:O,collectionPosition:B}=x,F=(I=f==null?void 0:f.collectionDefinitions)==null?void 0:I.find($=>$.collectionId===O);if(!F)return{error:Re,collectionId:O};let G=`${O}-${B}`;w[G]||(w[G]=[]);let H=w[G].length;if(Gr(or)(F.matchUpType)&&H||F.matchUpType===zn&&H>1)return{info:"Excessive collectionPosition assignments",error:Re};w[G].push(N)}}let D=Object.values(w);for(let R of D)if(R.length===2){let{participant:N}=Mu({tournamentParticipants:l,participantIds:R});if(!N){let M=mp({participant:{participantType:Ti,participantRole:Do,individualParticipantIds:R},pairOverride:!0,tournamentRecord:e});if(M.error)return M}}let E=Pl(S),C=(E[1]||0)>(E[2]||0)&&1||(E[2]||0)>(E[1]||0)&&2||void 0,P=Object.keys(m).map(R=>parseInt(R));C&&!P.includes(C)&&(m[C]=T)}if(!Object.keys(m).length)return{error:ZH};if(c=nr({drawDefinition:i,matchUpId:n}),c.error)return c;if(!c.matchUp)return{error:Ho};let{matchUp:g}=c;g.sides||(g.sides=[]);for(let T of[1,2]){let w=g.sides.find(D=>D.sideNumber===T),S=m[T];if(S)w?w.lineUp=S:g.sides.push({lineUp:S,sideNumber:T});else continue}return en({tournamentId:e==null?void 0:e.tournamentId,context:o,drawDefinition:i,matchUp:g}),{...ce}}var EO={};$i(EO,{anonymizeTournamentRecord:()=>bde,generate:()=>Xue,generateEventWithDraw:()=>NO,generateOutcome:()=>xW,generateOutcomeFromScoreString:()=>PW,generateParticipants:()=>JT,generateTournamentRecord:()=>vde,modifyTournamentRecord:()=>Ide,mutate:()=>yde});var Xue={};$i(Xue,{generateEventWithDraw:()=>NO,generateOutcome:()=>xW,generateOutcomeFromScoreString:()=>PW,generateParticipants:()=>JT,generateTournamentRecord:()=>vde});function PW(t){let{matchUpFormat:e,matchUpStatus:i,winningSide:n,scoreString:r}=t;if(!r)return{outcome:{...Lx,winningSide:n,matchUpStatus:i}};if(n&&![1,2,void 0].includes(n))return{error:Re,winningSide:n};let a=r&&BA({scoreString:r}),o={},s=nh({sets:a,matchUpFormat:e}),l=nh({sets:a,reversed:!0,matchUpFormat:e});return n===2?(o.scoreStringSide1=l,o.scoreStringSide2=s):(o.scoreStringSide1=s,o.scoreStringSide2=l),o.sets=BA({scoreString:o.scoreStringSide1}),zt({outcome:{matchUpStatus:i,winningSide:n,score:o}})}function RW({matchUpScheduleTimes:t,matchUpDependencies:e,allDateMatchUpIds:i,matchUp:n}){var a;let r=(((a=e==null?void 0:e[n.matchUpId])==null?void 0:a.matchUpIds)||[]).filter(o=>i.includes(o)).filter(o=>!t[o]);return{dependenciesScheduled:!(r!=null&&r.length),remainingDependencies:r}}function bS({matchUpPotentialParticipantIds:t,matchUpNotBeforeTimes:e,timeAfterRecovery:i,matchUp:n}){var c,u,d,p;let{individualParticipantIds:r}=gx(n);i=i??((c=n.schedule)==null?void 0:c.timeAfterRecovery);let a=h=>{t[h]||(t[h]=[]),t[h]=Pi(t[h].concat(...r))},o=h=>{i&&(!e[h]||i>e[h])&&(e[h]=i)},s=((u=n.winnerTo)==null?void 0:u.matchUpId)||n.winnerMatchUpId;s&&(i&&o(s),a(s));let l=((d=n.loserTo)==null?void 0:d.matchUpId)||n.loserMatchUpId;l&&(i&&o(l),a(l)),(p=n.sidesTo)!=null&&p.length&&n.sidesTo.forEach(({matchUpId:h})=>{h&&(i&&o(h),a(h))})}function fP({individualParticipantProfiles:t,participantId:e}){t[e]||(t[e]={typeChangeTimeAfterRecovery:void 0,timeAfterRecovery:void 0,priorMatchUpType:void 0,potentialRecovery:{},potentialCounted:{},potentialBookings:{},bookings:[],counters:{}})}function aLe({individualParticipantProfiles:t,recoveryValue:e,participantId:i,scheduleTime:n,drawId:r}){t[i].potentialRecovery[r]||(t[i].potentialRecovery[r]=[]),t[i].potentialRecovery[r].push(e),t[i].potentialBookings[r]||(t[i].potentialBookings[r]=[]),t[i].potentialBookings[r].push({timeAfterRecovery:e,scheduleTime:n})}function KD({matchUpPotentialParticipantIds:t,individualParticipantProfiles:e,typeChangeRecoveryMinutes:i,averageMatchUpMinutes:n=0,matchUpNotBeforeTimes:r,matchUpDependencies:a,recoveryMinutes:o=0,scheduleTime:s,matchUp:l}){var f,m;let c=ir((f=l==null?void 0:l.schedule)==null?void 0:f.endTime),u=c?tl(c,ri(o)):tl(s,ri(n)+ri(o)),d=i&&(c?tl(ir(c),i):tl(s,ri(n)+ri(i))),p=((m=a==null?void 0:a[l.matchUpId])==null?void 0:m.participantIds)||[],h=(l.roundPosition&&t[l.matchUpId]||[]).flat();p.forEach(g=>{fP({individualParticipantProfiles:e,participantId:g});let v=e[g].priorMatchUpType!==l.matchUpType&&d||u;h.includes(g)?aLe({individualParticipantProfiles:e,drawId:l.drawId,recoveryValue:v,participantId:g,scheduleTime:s}):(e[g].timeAfterRecovery=v,e[g].bookings.push({scheduleTime:s,timeAfterRecovery:v}))}),bS({matchUpPotentialParticipantIds:t,matchUpNotBeforeTimes:r,timeAfterRecovery:u,matchUp:l})}function Jue({matchUpScheduleTimes:t,matchUpDependencies:e,scheduleTime:i,matchUpId:n,details:r}){var u,d,p,h,f;let a,o=(d=(u=r.minutesMap)==null?void 0:u[n])==null?void 0:d.recoveryMinutes,s=(((h=(p=r.minutesMap)==null?void 0:p[n])==null?void 0:h.averageMinutes)||0)+(o||0),l=tl(i,s),c=((f=e==null?void 0:e[n])==null?void 0:f.dependentMatchUpIds)||[];if(c.length){let m=c.reduce((g,v)=>{let y=t[v];if(!y)return g;let b={scheduleTime:y,matchUpId:v};return y&&!g.matchUpId||an(y)<an(g.scheduleTime)?b:g},{});m.scheduleTime&&an(l)>an(m.scheduleTime)&&(a=m)}return{scheduledDependent:a}}function oLe(t){let{sides:e,matchUpType:i}=t||{};return(e||[]).map(n=>{var r;return i===zn&&(((r=n==null?void 0:n.participant)==null?void 0:r.individualParticipants)||[])||(n==null?void 0:n.participant)&&[n.participant]||[]}).flat()}var mP="DO_NOT_SCHEDULE",Que={DO_NOT_SCHEDULE:mP};function MW({averageMatchUpMinutes:t=90,requestConflicts:e={},potentials:i=!0,personRequests:n,scheduleTime:r,scheduleDate:a,matchUp:o}){let s=oLe(o).map(({person:h})=>h==null?void 0:h.personId);if(i){let h=((o==null?void 0:o.potentialParticipants)||[]).flat().map(({person:f})=>f==null?void 0:f.personId);s.push(...h)}let l=s.map(h=>{var f;return(f=n[h])==null?void 0:f.map(m=>({...m,personId:h}))}).filter(Boolean).flat().filter(h=>h.requestType===mP&&vh(a,h.date)),c=[],u=o==null?void 0:o.matchUpId,d=la(ir(r),Ei(a)),p=ir(Iz(d,t).toISOString());for(let h of l){let{requestId:f,startTime:m,endTime:g}=h;(r>m&&r<g||p>m&&p<g)&&(c.push({matchUpId:u,request:h,scheduleTime:r}),e[f]?(e[f].scheduleTimes.includes(r)||e[f].scheduleTimes.push(r),e[f].matchUpIds.includes(u)||e[f].matchUpIds.push(u)):e[f]={request:h,scheduleTimes:[r],matchUpIds:[u]})}return{conflicts:c}}function UV({matchUpPotentialParticipantIds:t,individualParticipantProfiles:e,matchUp:i,value:n}){let{matchUpType:r}=i,{individualParticipantIds:a}=gx(i),o=(t[i.matchUpId]||[]).filter(s=>!Ts(s,a)).flat();[...a,...o].forEach(s=>{if(fP({individualParticipantProfiles:e,participantId:s}),!e[s].potentialCounted[i.drawId]){let l=e[s].counters;l[r]?l[r]+=n:n>0&&(l[r]=n),l[bu]?l[bu]+=n:n>0&&(l[bu]=n),o.includes(s)&&(e[s].potentialCounted[i.drawId]=!0)}})}function sLe({matchUpPotentialParticipantIds:t,individualParticipantProfiles:e,dateScheduledMatchUpIds:i,greatestAverageMinutes:n,dateScheduledMatchUps:r,matchUpNotBeforeTimes:a,matchUpScheduleTimes:o,matchUpDependencies:s,clearScheduleDates:l,scheduleDate:c,minutesMap:u,matchUps:d}){var m,g;let p=[];i||(r=d==null?void 0:d.filter(v=>{let y=v.schedule||{},b=v.matchUpStatus===vn;return b&&p.push({tournamentId:v.tournamentId,matchUpId:v.matchUpId}),!b&&oP({schedule:y})&&(!c||v.schedule.scheduledDate===c)}),i=r.map($a));let h=Array.isArray(l)?l.includes(c):l,f=h?[]:d.filter(({matchUpId:v})=>i.includes(v));for(let v of f){UV({matchUpPotentialParticipantIds:t,individualParticipantProfiles:e,value:1,matchUp:v});let y=(m=v.schedule)==null?void 0:m.scheduledTime;if(y){o[v.matchUpId]=y;let b=(g=u==null?void 0:u[v.matchUpId])==null?void 0:g.recoveryMinutes;KD({individualParticipantProfiles:e,matchUpPotentialParticipantIds:t,matchUpNotBeforeTimes:a,matchUpDependencies:s,averageMatchUpMinutes:n,recoveryMinutes:b,scheduleTime:y,matchUp:v})}}return{dateScheduledMatchUpIds:i,byeScheduledMatchUpDetails:p,dateScheduledMatchUps:r,clearDate:h}}function lLe({matchUpPotentialParticipantIds:t,scheduleCompletedMatchUps:e,dateScheduledMatchUpIds:i,matchUpNotBeforeTimes:n,matchUpScheduleTimes:r,orderedMatchUpIds:a,clearDate:o,matchUps:s}){let l=Object.keys(r),c=a.map(d=>s.find(p=>p.matchUpId===d)).filter(Boolean).filter(d=>{let p=!o&&(i.includes(d.matchUpId)||l.includes(d.matchUpId)),h=[vn,Zi,jr,ol,go,hn,ua,Ea].includes(d==null?void 0:d.matchUpStatus);return e||!p&&!d.winningSide&&!h}),{matchUpMap:u}=c.reduce((d,p)=>{let{drawId:h,tournamentId:f}=p;return d.matchUpMap[f]||(d.matchUpMap[f]={}),d.matchUpMap[f][h]?d.matchUpMap[f][h].push(p):d.matchUpMap[f][h]=[p],bS({matchUpPotentialParticipantIds:t,matchUpNotBeforeTimes:n,matchUp:p}),d},{matchUpMap:{}});return{matchUpsToSchedule:c,matchUpMap:u}}function CO({defaultRecoveryMinutes:t=0,averageMatchUpMinutes:e=90,dateScheduledMatchUps:i,tournamentRecords:n,venueIds:r=[],periodLength:a,scheduleDate:o,matchUps:s}){if(typeof n!="object")return{error:Sr};if(!Kc(s)&&!Array.isArray(i))return{error:Xf};a=a??bO({recoveryMinutes:t,averageMatchUpMinutes:e});let l=Object.assign({},...Object.values(n).map(d=>(d.events??[]).map(p=>{let{scheduleTiming:h}=yC({tournamentRecord:d,event:p});return{[p.eventId]:{event:p,scheduleTiming:h}}})).flat()),c={averageTimes:[{minutes:{default:e}}],recoveryTimes:[{minutes:{default:t}}]};i||(i=s==null?void 0:s.filter(d=>{let p=d.schedule;return oP({schedule:p})&&(!o||d.schedule.scheduledDate===o)}));let u=i==null?void 0:i.filter(d=>(!r.length||r.includes(d.schedule.venueId))&&d.matchUpStatus!==vn);return{bookings:u==null?void 0:u.map(({eventId:d,schedule:p,matchUpFormat:h})=>{let{event:f,scheduleTiming:m}=l[d],g=f==null?void 0:f.eventType,v={...m,defaultTiming:c,matchUpFormat:h},{averageMinutes:y,recoveryMinutes:b}=Ix({timingDetails:v,eventType:g}),{courtId:I,venueId:T}=p,w=ir(p.scheduledTime),S=tl(w,y);return{recoveryMinutes:b,averageMinutes:y,periodLength:a,startTime:w,courtId:I,endTime:S,venueId:T}}).filter(Boolean),relevantMatchUps:u,dateScheduledMatchUps:i}}function cLe({calculateStartTimeFromCourts:t=!0,remainingScheduleTimes:e,defaultRecoveryMinutes:i,averageMatchUpMinutes:n,clearScheduleDates:r,tournamentRecords:a,tournamentRecord:o,periodLength:s,scheduleDate:l,startTime:c,venueIds:u,matchUps:d,endTime:p}){if(o&&!a&&(a={[o.tournamentId]:o}),typeof a!="object"||!Object.keys(a).length)return{error:Sr};s=s??bO({recoveryMinutes:i,averageMatchUpMinutes:n});let{courts:h,venues:f}=nm({dates:[l],ignoreDisabled:!0,tournamentRecords:a}),m=(h==null?void 0:h.filter(T=>!u||u.includes(T.venueId)))??[];c=c??yS({courts:m,scheduleDate:l,startTime:!0}),p=p??yS({courts:m,scheduleDate:l,endTime:!0});let{bookings:g,dateScheduledMatchUps:v}=CO({defaultRecoveryMinutes:i,averageMatchUpMinutes:n,tournamentRecords:a,scheduleDate:l,periodLength:s,venueIds:u,matchUps:d}),y={calculateStartTimeFromCourts:t,remainingScheduleTimes:e,averageMatchUpMinutes:n,clearScheduleDates:r,date:l,periodLength:s,startTime:c,bookings:g,endTime:p,courts:m},{scheduleTimes:b}=pW(y),I=(u==null?void 0:u.length)===1&&u[0]||(f==null?void 0:f.length)===1&&f[0].venueId||void 0;return{dateScheduledMatchUpIds:v==null?void 0:v.map(Ml("matchUpId")),dateScheduledMatchUps:v,scheduleTimes:b,venueId:I}}function uLe({scheduledRoundsDetails:t,greatestAverageMinutes:e,garmanSinglePass:i}){let n=[],r=[],a,o,s,l;for(let c of t.filter(Boolean))l||(l=c.hash),(c.hash===l||i)&&(r=r.concat(c.matchUpIds)),c.hash!==l&&!i&&(l=c.hash,n.push({averageMinutes:s,recoveryMinutes:o,roundPeriodLength:a,matchUpIds:r}),r=c.matchUpIds),s=i?e:c.averageMinutes,o=c.recoveryMinutes,a=c.roundPeriodLength;return r.length&&n.push({matchUpIds:r,roundPeriodLength:a,recoveryMinutes:o,averageMinutes:s}),{groupedRounds:n}}function ede({matchUpPotentialParticipantIds:t,individualParticipantProfiles:e,scheduleCompletedMatchUps:i,containedStructureIds:n,matchUpNotBeforeTimes:r,matchUpScheduleTimes:a,matchUpDependencies:o,clearScheduleDates:s,tournamentRecords:l,periodLength:c,scheduleDate:u,useGarman:d,matchUps:p,courts:h,venues:f}){var b;let m={},g=[],v=[],y=[];for(let I of f){let{rounds:T=[],venueId:w}=I,{scheduledRoundsDetails:S,greatestAverageMinutes:D,orderedMatchUpIds:E,minutesMap:C}=rP({scheduleCompletedMatchUps:i,containedStructureIds:n,tournamentRecords:l,periodLength:c,matchUps:p,rounds:T});y.push(...E??[]);let{groupedRounds:P}=uLe({scheduledRoundsDetails:S,greatestAverageMinutes:D,garmanSinglePass:!0}),R,N,M=[];d&&({scheduleTimes:M,dateScheduledMatchUpIds:R,dateScheduledMatchUps:N}=cLe({averageMatchUpMinutes:(b=P[0])==null?void 0:b.averageMinutes,scheduleDate:Ei(u),venueIds:[I.venueId],clearScheduleDates:s,tournamentRecords:l,periodLength:c,matchUps:p}));let A=sLe({matchUpPotentialParticipantIds:t,individualParticipantProfiles:e,dateScheduledMatchUpIds:R,greatestAverageMinutes:D,matchUpNotBeforeTimes:r,matchUpScheduleTimes:a,matchUpDependencies:o,clearScheduleDates:s,scheduleDate:u,minutesMap:C,matchUps:p});({dateScheduledMatchUpIds:R,dateScheduledMatchUps:N}=A);let{byeScheduledMatchUpDetails:_,clearDate:x}=A;_!=null&&_.length&&v.push(..._);let{matchUpsToSchedule:O,matchUpMap:B}=lLe({matchUpPotentialParticipantIds:t,scheduleCompletedMatchUps:i,dateScheduledMatchUpIds:R,matchUpNotBeforeTimes:r,matchUpScheduleTimes:a,orderedMatchUpIds:E,clearDate:x,matchUps:p}),F=h.filter(G=>G.venueId===w);m[w]={previousRemainingScheduleTimes:[],courtsCount:F.length,greatestAverageMinutes:D,scheduledRoundsDetails:S,dateScheduledMatchUps:N,matchUpsToSchedule:O,scheduleTimes:M,groupedRounds:P,venueCourts:F,minutesMap:C,matchUpMap:B},s||g.push(...R)}return{allDateScheduledByeMatchUpDetails:v,allDateScheduledMatchUpIds:g,venueScheduledRoundDetails:m,allDateMatchUpIds:y}}function dLe(t,e){let i=an(t.scheduleTime),n=an(t.timeAfterRecovery),r=an(e.scheduleTime),a=an(e.timeAfterRecovery),o=i===r||n===a,s=i>r&&i<a,l=r>i&&r<n,c=n>r&&n<a,u=a>i&&a<n;return zt({hasOverlap:o||s||c||l||u,startAisContained:s,endAisContained:c,startBisContained:l,endBisContained:u},!0)}function NW({individualParticipantProfiles:t,matchUpNotBeforeTimes:e,matchUpDependencies:i,scheduleTime:n,matchUp:r,details:a}){var p,h,f,m,g;let o=(((p=i==null?void 0:i[r.matchUpId])==null?void 0:p.participantIds)||[]).flat(),s=((f=(h=a==null?void 0:a.minutesMap)==null?void 0:h[r.matchUpId])==null?void 0:f.averageMinutes)||0,l=((g=(m=a==null?void 0:a.minutesMap)==null?void 0:m[r.matchUpId])==null?void 0:g.recoveryMinutes)||0,c=o.every(v=>{var T;fP({individualParticipantProfiles:t,participantId:v});let y=t[v];if(!y.timeAfterRecovery)return!0;let b=ir((T=r==null?void 0:r.schedule)==null?void 0:T.endTime),I=b?tl(b,ri(l)):tl(n,ri(s)+ri(l));return![...Object.keys(y.potentialBookings).filter(w=>w!==r.drawId).map(w=>y.potentialBookings[w]).flat(),...y.bookings].find(w=>dLe({scheduleTime:n,timeAfterRecovery:I},w).hasOverlap)}),u=e[r.matchUpId],d=(u?dC(la(u),la(n),!1):0)>=0;return{enoughTime:c&&d}}function AW({individualParticipantProfiles:t,matchUpPotentialParticipantIds:e,matchUpDailyLimits:i={},matchUp:n}){let{enteredIndividualParticipantIds:r}=gx(n),{matchUpId:a,matchUpType:o}=n,s=(n.roundPosition&&e[a]||[]).flat(),l=Pi(r.concat(...s));return l.forEach(c=>{fP({individualParticipantProfiles:t,participantId:c})}),{participantIdsAtLimit:l.filter(c=>{let u=t[c];if(u)return[o,bu].find(d=>{var f;let p=((f=u.counters)==null?void 0:f[d])||0,h=i[d]||0;return p&&h&&p>=h})}),relevantParticipantIds:l}}function YD({scheduleCompletedMatchUps:t=!1,scheduleByeMatchUps:e=!1,errorOnAnachronism:i=!1,checkChronology:n=!0,matchUpDependencies:r,removePriorValues:a,tournamentRecords:o,tournamentRecord:s,matchUpDetails:l,matchUpIds:c,schedule:u}){var g,v,y;if(!s)return{error:ut};if(!l&&(!c||!Array.isArray(c)))return{error:PI};if(!l&&(!u||typeof u!="object"))return{error:Yne};let d,p=[],h=0;if(n&&!r){let b=Vu({tournamentRecords:o,tournamentRecord:s});r=b.matchUpDependencies,d=b.matchUps}d||(d=((g=oo({tournamentRecord:s}))==null?void 0:g.matchUps)??[]);let f=d.reduce((b,I)=>{let{matchUpId:T,drawId:w,matchUpStatus:S}=I;return(e||S!==vn)&&(t||!ba.includes(S))&&(b[w]?b[w].push(T):b[w]=[T]),b},{}),m=l==null?void 0:l.map(b=>b.matchUpId);for(let b of Object.keys(f)){let{drawDefinition:I}=Ng({tournamentRecord:s,drawId:b});if(!I)continue;let T=f[b].filter(S=>(c==null?void 0:c.includes(S))??(m==null?void 0:m.includes(S))),w=ws({inContext:!1,drawDefinition:I}).matchUps;for(let S of T){let D=((v=l==null?void 0:l.find(C=>C.matchUpId===S))==null?void 0:v.schedule)||u,E=DO({schedule:D,matchUpDependencies:r,errorOnAnachronism:i,removePriorValues:a,inContextMatchUps:d,tournamentRecords:o,tournamentRecord:s,checkChronology:n,drawDefinition:I,drawMatchUps:w,matchUpId:S});if((y=E==null?void 0:E.warnings)!=null&&y.length&&p.push(...E.warnings),E!=null&&E.success&&(h+=1),E.error)return E}}return p.length?{...ce,scheduled:h,warnings:p}:{...ce,scheduled:h}}function gP(t){var f;let{scheduleCompletedMatchUps:e=!1,scheduleByeMatchUps:i=!1,errorOnAnachronism:n,matchUpContextIds:r,removePriorValues:a,tournamentRecords:o,checkChronology:s,matchUpDetails:l,schedule:c}=t;if(t.matchUpIds&&!r)return YD(t);let u=di(t,[{[zo]:!0},{[RD]:{matchUpContextIds:!1,matchUpDetails:!1},[Ql]:Re,[$l]:gs}]);if(u.error)return u;if((!l||r)&&!c)return{error:Yt,info:"schedule is required"};let d=[],p=0,{matchUpDependencies:h}=Vu({tournamentRecords:o});for(let m of Object.values(o)){let{tournamentId:g}=m,v=r==null?void 0:r.filter(b=>b.tournamentId===g).map($a),y=l==null?void 0:l.filter(b=>(b==null?void 0:b.tournamentId)===g);if(v!=null&&v.length||y!=null&&y.length){let b=YD({matchUpDetails:y,scheduleCompletedMatchUps:e,scheduleByeMatchUps:i,matchUpDependencies:h,errorOnAnachronism:n,removePriorValues:a,tournamentRecords:o,tournamentRecord:m,checkChronology:s,matchUpIds:v,schedule:c});if((f=b.warnings)!=null&&f.length&&d.push(...b.warnings),b.scheduled&&(p+=b.scheduled),b.error)return b}}return d.length?{...ce,scheduled:p,warnings:d}:{...ce,scheduled:p}}function tde({autoSchedulingAudit:t,tournamentRecords:e}){var o;wi({topic:gf,payload:t});let i=s=>s?Object.values(s).reduce((l,c)=>l+c.length||0,0):0,n=((t==null?void 0:t.schedulingProfile)||[]).reduce((s,l)=>s+l.venues.reduce((c,u)=>c+u.rounds.length,0),0),r={scheduledDatesCount:(o=t.scheduledDates)==null?void 0:o.length,noTimeMatchUpIdsCount:i(t==null?void 0:t.noTimeMatchUpIds),scheduledMatchUpIdsCount:i(t==null?void 0:t.scheduledMatchUpIds),overLimitMatchUpIdsCount:i(t==null?void 0:t.overLimitMatchUpIds),requestConflictsCount:i(t==null?void 0:t.requestConflicts),profileRoundsCount:n},a={itemType:IV,itemValue:r};for(let s of Object.values(e)){let l=s.tournamentId;Wk(gf)?wi({payload:{type:IV,tournamentId:l,detail:r},topic:gf}):XC({tournamentRecord:s,timeItem:a})}}function pLe({schedulingProfileModifications:t,checkPotentialRequestConflicts:e,scheduleCompletedMatchUps:i,schedulingProfileIssues:n,dateSchedulingProfiles:r,containedStructureIds:a,matchUpDependencies:o,matchUpDailyLimits:s,clearScheduleDates:l,tournamentRecords:c,schedulingProfile:u,personRequests:d,periodLength:p,matchUps:h,courts:f,dryRun:m}){var R,N,M,A,_,x,O;let g={},v={},y={},b={},I={},T={},w={},S={},D={},E={};for(let B of r){let F=Ei(B==null?void 0:B.scheduleDate),G=(B==null?void 0:B.venues)||[],H={},$={},q=(se,te)=>{se.forEach(he=>{let ae=$[he].counters;ae[te]?ae[te]+=1:ae[te]=1,ae[bu]?ae[bu]+=1:ae[bu]=1})};y[F]={},b[F]={},g[F]={},v[F]={},w[F]=[],S[F]=[],D[F]=[],E[F]=[];let z={};h.forEach(se=>{var te;(te=se.schedule)!=null&&te.scheduledDate&&vh(F,Ei(se.schedule.scheduledDate))&&bS({matchUpPotentialParticipantIds:H,matchUpNotBeforeTimes:z,matchUp:se})});let{allDateScheduledByeMatchUpDetails:Z,venueScheduledRoundDetails:Y,allDateMatchUpIds:Q}=ede({matchUpPotentialParticipantIds:H,individualParticipantProfiles:$,scheduleCompletedMatchUps:i,containedStructureIds:a,matchUpNotBeforeTimes:z,matchUpScheduleTimes:T,matchUpDependencies:o,clearScheduleDates:l,tournamentRecords:c,useGarman:!0,periodLength:p,scheduleDate:F,matchUps:h,courts:f,venues:G}),X=10,oe=0,re,me=10;for(;!re;){for(let{venueId:se}of G){let te=0,he=Y[se];for(;he.courtsCount&&((R=he.scheduleTimes)!=null&&R.length)&&((N=he.matchUpsToSchedule)!=null&&N.length)&&te<=he.courtsCount;){let{scheduleTime:ae,attempts:de=0}=he.scheduleTimes.shift(),Ie=he.matchUpsToSchedule.find(De=>{var Ke,bt;let{matchUpId:Te,matchUpType:_e}=De,{participantIdsAtLimit:Ve,relevantParticipantIds:ot}=AW({matchUpPotentialParticipantIds:H,individualParticipantProfiles:$,matchUpDailyLimits:s,matchUp:De});if(Ve.length)return S[F].includes(Te)||S[F].push(Te),!1;let{scheduledDependent:St}=Jue({matchUpScheduleTimes:T,matchUpDependencies:o,scheduleTime:ae,matchUpId:Te,details:he});if(St)return!1;let{dependenciesScheduled:nt,remainingDependencies:Bt}=RW({matchUpScheduleTimes:T,matchUpDependencies:o,allDateMatchUpIds:Q,matchUp:De});if(!nt)return b[F][Te]||(b[F][Te]=[]),b[F][Te].push({scheduleTime:ae,remainingDependencies:Bt}),!1;let{enoughTime:Pe}=NW({individualParticipantProfiles:$,matchUpNotBeforeTimes:z,matchUpDependencies:o,scheduleTime:ae,details:he,matchUp:De});if(!Pe)return y[F][Te]||(y[F][Te]=[]),y[F][Te].push({scheduleTime:ae}),!1;let et=he.greatestAverageMinutes,{conflicts:Ee}=MW({potentials:e,averageMatchUpMinutes:et,requestConflicts:E,personRequests:d,scheduleTime:ae,scheduleDate:F,matchUp:De});if(Ee!=null&&Ee.length)return I[F]||(I[F]=[]),I[F].push(...Ee),!1;q(ot,_e);let lt=(bt=(Ke=he.minutesMap)==null?void 0:Ke[Te])==null?void 0:bt.recoveryMinutes;return KD({matchUpPotentialParticipantIds:H,individualParticipantProfiles:$,matchUpNotBeforeTimes:z,averageMatchUpMinutes:et,matchUpDependencies:o,recoveryMinutes:lt,scheduleTime:ae,matchUp:De}),T[Te]=ae,!0});he.matchUpsToSchedule=he.matchUpsToSchedule.filter(({matchUpId:De})=>De!==(Ie==null?void 0:Ie.matchUpId)),Ie?te+=1:(v[F][se]||(v[F][se]=[]),v[F][se].push({scheduleTime:ae,attempts:de+1}))}(M=he.matchUpsToSchedule)!=null&&M.length&&(v[F][se]=(A=v[F][se])==null?void 0:A.filter(ae=>{let de=ae.attempts<X;return de&&he.scheduleTimes.push(ae),!de})),(!((_=he.scheduleTimes)!=null&&_.length)||!((x=he.matchUpsToSchedule)!=null&&x.length))&&(he.complete=!0)}oe+=1,re=G.every(({venueId:se})=>Y[se].complete)||oe===me}for(let{venueId:se}of G){let te=Y[se].matchUpMap;Object.keys(te).forEach(he=>{let ae=c[he];ae&&Object.keys(te[he]).forEach(de=>{let{drawDefinition:Ie}=Ng({tournamentRecord:ae,drawId:de});Ie&&te[he][de].forEach(({matchUpId:De})=>{let Te=T[De];if(Te){let _e=Te.split(":").map(Tc).join(":"),Ve=`${Ei(F)}T${_e}`;m?w[F].push(De):(Ag({drawDefinition:Ie,scheduledTime:Ve,matchUpId:De}).success&&w[F].push(De),se&&XT({tournamentRecord:ae,drawDefinition:Ie,matchUpId:De,venueId:se}))}})})}),D[F]=Y[se].matchUpsToSchedule.map($a),g[F][se]=Y[se].scheduleTimes.sort((he,ae)=>an(he.scheduleTime)-an(ae.scheduleTime))}!m&&(Z!=null&&Z.length)&&gP({matchUpDetails:Z,scheduleByeMatchUps:!0,removePriorValues:!0,tournamentRecords:c,schedule:{scheduledDate:"",scheduledTime:"",courtOrder:"",courtId:"",venueId:""}});for(let se of B.venues)for(let te of se.rounds){let he=(((O=te.matchUps)==null?void 0:O.map(({matchUpId:de})=>de))||[]).filter(de=>w[F].includes(de));te.canScheduledMatchUpIds=he;let ae=Math.round(he.length/te.matchUpsCount*1e4)/100;(ae===1/0||isNaN(ae))&&(ae=0),te.possibleToSchedulePct=ae,te.matchUpsCount===he.length&&(te.possibleToSchedule=!0)}}let C=r.map(({scheduleDate:B})=>B),P={timeStamp:Date.now(),overLimitMatchUpIds:S,scheduledMatchUpIds:w,schedulingProfile:u,noTimeMatchUpIds:D,requestConflicts:E,scheduledDates:C};return tde({tournamentRecords:c,autoSchedulingAudit:P}),{...ce,schedulingProfileModifications:t,schedulingProfileIssues:n,scheduleTimesRemaining:g,dateSchedulingProfiles:r,skippedScheduleTimes:v,recoveryTimeDeferredMatchUpIds:y,dependencyDeferredMatchUpIds:b,matchUpScheduleTimes:T,overLimitMatchUpIds:S,scheduledMatchUpIds:w,noTimeMatchUpIds:D,requestConflicts:E,scheduledDates:C}}function NY({averageMinutes:t,startTime:e,endTime:i,court:n,date:r}){if(!Array.isArray(n.dateAvailability))return{error:Yt,stack:"getEarliestCourtTime"};let a=yS({scheduleDate:r,courts:[n],startTime:!0}),o=yS({scheduleDate:r,courts:[n],endTime:!0});e=e||a,i=i||o;let s=dP({court:n,date:r}),{timeSlots:l}=YT({courtDate:s}),c=la(e),u=la(i);return{earliestCourtTime:l==null?void 0:l.reduce((d,p)=>{let h=la(p.startTime),f=la(p.endTime);if(h>u||f<c)return d;let m=c>h?c:h;if(dC(m,f)>=t){let g=ir(m.toISOString());(!d||g<d)&&(d=g)}return d},void 0),courtStartTime:a,courtEndTime:o}}function hLe({schedulingProfileModifications:t,checkPotentialRequestConflicts:e,scheduleCompletedMatchUps:i,schedulingProfileIssues:n,dateSchedulingProfiles:r,containedStructureIds:a,matchUpDependencies:o,matchUpDailyLimits:s,clearScheduleDates:l,tournamentRecords:c,periodLength:u=30,schedulingProfile:d,personRequests:p,matchUps:h=[],courts:f,dryRun:m}){var P,R;let g={},v={},y={},b={},I={},T={},w={},S={},D={};for(let N of r??[]){let M=Ei(N==null?void 0:N.scheduleDate),A=(N==null?void 0:N.venues)||[],_={},x={},O=(se,te)=>{se.forEach(he=>{let ae=x[he].counters;ae[te]?ae[te]+=1:ae[te]=1,ae[bu]?ae[bu]+=1:ae[bu]=1})};g[M]={},v[M]={},T[M]=[],w[M]=[],S[M]=[],D[M]=[];let B={};h==null||h.forEach(se=>{var te;(te=se.schedule)!=null&&te.scheduledDate&&vh(M,Ei(se.schedule.scheduledDate))&&bS({matchUpPotentialParticipantIds:_,matchUpNotBeforeTimes:B,matchUp:se})});let{allDateScheduledByeMatchUpDetails:F,allDateScheduledMatchUpIds:G,venueScheduledRoundDetails:H,allDateMatchUpIds:$}=ede({matchUpPotentialParticipantIds:_,individualParticipantProfiles:x,scheduleCompletedMatchUps:i,containedStructureIds:a,matchUpNotBeforeTimes:B,matchUpScheduleTimes:I,matchUpDependencies:o,clearScheduleDates:l,tournamentRecords:c,periodLength:u,scheduleDate:M,matchUps:h,courts:f,venues:A}),q=h==null?void 0:h.filter(({matchUpId:se})=>G.includes(se)),{bookings:z}=CO({dateScheduledMatchUps:q,tournamentRecords:c,scheduleDate:M,periodLength:u}),{virtualCourts:Z}=yO({scheduleDate:M,periodLength:u,bookings:z,courts:f}),Y=Z==null?void 0:Z.reduce((se,te)=>{let{earliestCourtTime:he,courtEndTime:ae}=NY({date:M,averageMinutes:0,court:te});return(!se.startTime||la(he)<la(se.startTime))&&(se.startTime=he),(!se.endTime||la(ae)>la(se.endTime))&&(se.endTime=ae),se},{}),Q=Y.startTime,X=({courtId:se,booking:te})=>{var he;return(he=Z==null?void 0:Z.find(ae=>ae.courtId===se))==null?void 0:he.dateAvailability[0].bookings.push(te)},oe=10,re=0,me;for(;!me;){for(let{venueId:se}of A){let te=H[se],he=te.matchUpsToSchedule.length,ae=[],de=[],Ie,De=0;for(;!Ie;){for(let Te of te.matchUpsToSchedule){if(de.length===te.courtsCount||ae.length===te.courtsCount){Ie=!0;break}let{matchUpId:_e,matchUpType:Ve}=Te,{participantIdsAtLimit:ot,relevantParticipantIds:St}=AW({matchUpPotentialParticipantIds:_,individualParticipantProfiles:x,matchUpDailyLimits:s,matchUp:Te});if(ot.length){w[M].includes(_e)||w[M].push(_e);continue}let{dependenciesScheduled:nt,remainingDependencies:Bt}=RW({matchUpScheduleTimes:I,matchUpDependencies:o,allDateMatchUpIds:$,matchUp:Te});if(!nt){v[M][_e]||(v[M][_e]=[]),v[M][_e].push({remainingDependencies:Bt});continue}let Pe=[],et=Z==null?void 0:Z.reduce((Ee,lt)=>{var st,vt,ge,Se;if(de.includes(lt.courtId))return Ee;let{earliestCourtTime:Ke}=NY({averageMinutes:te.greatestAverageMinutes,startTime:Q,date:M,court:lt});if(Ee.scheduleTime&&an(Ke)>=an(Ee.scheduleTime))return Ee;let{scheduledDependent:bt}=Jue({matchUpScheduleTimes:I,matchUpDependencies:o,scheduleTime:Ke,matchUpId:_e,details:te});if(bt)return Ee;let{enoughTime:gt}=NW({individualParticipantProfiles:x,matchUpNotBeforeTimes:B,matchUpDependencies:o,scheduleTime:Ke,details:te,matchUp:Te});if(!gt)return g[M][_e]||(g[M][_e]=[]),g[M][_e].includes(Ke)||g[M][_e].push(Ke),Ee;let Ue=((vt=(st=te.minutesMap)==null?void 0:st[_e])==null?void 0:vt.averageMinutes)||te.greatestAverageMinutes,{conflicts:xe}=MW({potentials:e,averageMatchUpMinutes:Ue,requestConflicts:D,personRequests:p,scheduleTime:Ke,scheduleDate:M,matchUp:Te});if(xe!=null&&xe.length)return Pe.push(...xe),!1;O(St,Ve);let We=(Se=(ge=te.minutesMap)==null?void 0:ge[_e])==null?void 0:Se.recoveryMinutes;return KD({matchUpPotentialParticipantIds:_,individualParticipantProfiles:x,matchUpNotBeforeTimes:B,averageMatchUpMinutes:Ue,matchUpDependencies:o,recoveryMinutes:We,scheduleTime:Ke,matchUp:Te}),(!Ee.scheduleTime||an(Ke)<an(Ee.scheduleTime))&&(Ee.averageMatchUpMinutes=Ue,Ee.recoveryMinutes=We,Ee.scheduleTime=Ke,Ee.courtName=lt.courtName,Ee.courtId=lt.courtId),Ee},{});if(et.scheduleTime){let{averageMatchUpMinutes:Ee,recoveryMinutes:lt,scheduleTime:Ke,courtId:bt}=et;I[_e]=Ke,b[_e]=bt,ae.push(_e),de.push(bt);let gt=Ke,Ue=tl(gt,Ee);X({courtId:bt,booking:{averageMatchUpMinutes:Ee,recoveryMinutes:lt,periodLength:u,matchUpId:_e,startTime:gt,courtId:bt,endTime:Ue,venueId:se}}),te.matchUpsToSchedule=te.matchUpsToSchedule.filter(xe=>xe.matchUpId!==_e)}else Pe!=null&&Pe.length&&(y[M]||(y[M]=[]),y[M].push(...Pe))}(de.length===te.courtsCount||ae.length===te.courtsCount||!te.matchUpsToSchedule.length)&&(Ie=!0),te.matchUpsToSchedule.length&&ae<te.courtsCount&&(la(Q)<la(Y.endTime)?Q=tl(Q,u):(Ie=!0,te.complete=!0)),De+=1,!Ie&&De>=he&&(Ie=!0)}(P=te.matchUpsToSchedule)!=null&&P.length||(te.complete=!0)}re+=1,me=A.every(({venueId:se})=>H[se].complete)||re===oe}for(let{venueId:se}of A){let te=H[se].matchUpMap;Object.keys(te).forEach(he=>{let ae=c[he];ae&&Object.keys(te[he]).forEach(de=>{let{drawDefinition:Ie}=Ng({tournamentRecord:ae,drawId:de});Ie&&te[he][de].forEach(({matchUpId:De})=>{let Te=I[De],_e=b[De];if(Te){let Ve=Te.split(":").map(Tc).join(":"),ot=`${Ei(M)}T${Ve}`;m||(Ag({drawDefinition:Ie,scheduledTime:ot,matchUpId:De}),QI({courtDayDate:M,tournamentRecords:c,tournamentRecord:ae,drawDefinition:Ie,matchUpId:De,courtId:_e})),T[M].push(De)}})})}),S[M]=H[se].matchUpsToSchedule.map($a)}!m&&(F!=null&&F.length)&&gP({matchUpDetails:F,scheduleByeMatchUps:!0,removePriorValues:!0,tournamentRecords:c,schedule:{scheduledDate:"",scheduledTime:"",courtOrder:"",courtId:"",venueId:""}});for(let se of N.venues)for(let te of se.rounds){let he=(R=(te.matchUps??[]).map(({matchUpId:de})=>de))==null?void 0:R.filter(de=>T[M].includes(de));te.canScheduledMatchUpIds=he;let ae=Math.round(((he==null?void 0:he.length)||0)/te.matchUpsCount*1e4)/100;(ae===1/0||isNaN(ae))&&(ae=void 0),te.possibleToSchedulePct=ae,te.matchUpsCount===(he==null?void 0:he.length)&&(te.possibleToSchedule=!0)}}let E=(r??[]).map(({scheduleDate:N})=>N),C={timeStamp:Date.now(),overLimitMatchUpIds:w,scheduledMatchUpIds:T,schedulingProfile:d,noTimeMatchUpIds:S,requestConflicts:D,scheduledDates:E};return tde({tournamentRecords:c,autoSchedulingAudit:C}),{...ce,schedulingProfileModifications:t,schedulingProfileIssues:n,dateSchedulingProfiles:r,recoveryTimeDeferredMatchUpIds:g,dependencyDeferredMatchUpIds:v,matchUpScheduleTimes:I,overLimitMatchUpIds:w,scheduledMatchUpIds:T,noTimeMatchUpIds:S,requestConflicts:D,scheduledDates:E}}function PO(t){let{scheduleAttributes:e=["scheduledDate","scheduledTime","courtOrder"],ignoreMatchUpStatuses:i=ba,scheduledDates:n,venueIds:r}=t,a=qc(t),o=Xi(a)?Object.values(a).map(({tournamentId:l})=>l).filter(Boolean):[];if(!(o!=null&&o.length))return{error:Sr};let s=0;for(let l of o){let c=a[l],u=fLe({ignoreMatchUpStatuses:i,scheduleAttributes:e,tournamentRecord:c,scheduledDates:n,venueIds:r});if(u.error)return u;s+=u.clearedScheduleCount??0}return{...ce,clearedScheduleCount:s}}function fLe({scheduleAttributes:t=["scheduledDate","scheduledTime","courtOrder"],ignoreMatchUpStatuses:e=ba,tournamentRecord:i,scheduledDates:n,venueIds:r=[]}){if(typeof i!="object")return{error:ut};if(!Array.isArray(e)||!Array.isArray(r))return{error:Re};r.length&&t.push("venueId");let a=oo({matchUpFilters:{scheduledDates:n},tournamentRecord:i}).matchUps??[],o={};a.forEach(({matchUpStatus:c,schedule:u,drawId:d,matchUpId:p})=>{(!c||!e.includes(c))&&oP({schedule:u,scheduleAttributes:t})&&(!(r!=null&&r.length)||r.includes(u.venueId))&&(o[d]||(o[d]=[]),o[d].push(p))});let s=i.tournamentId,l=0;for(let c in o){let{event:u,drawDefinition:d}=zs({tournamentRecord:i,drawId:c}),p=ws({drawDefinition:d,matchUpFilters:{matchUpIds:o[c]}}).matchUps??[];for(let h of p){let f=!1;h.timeItems=(h.timeItems??[]).filter(m=>{let g=(m==null?void 0:m.itemType)&&![Mf,Gv,xT,yx,OT,LT].includes(m==null?void 0:m.itemType);return g||(f=!0),g}),f&&(en({context:"clear schedules",eventId:u==null?void 0:u.eventId,drawDefinition:d,tournamentId:s,matchUp:h}),l+=1)}}return{...ce,clearedScheduleCount:l}}function RO(t){let{checkPotentialRequestConflicts:e=!0,scheduleCompletedMatchUps:i,clearScheduleDates:n,scheduleDates:r=[],tournamentRecords:a,periodLength:o,useGarman:s,dryRun:l,pro:c}=t,u=di(t,[{[zo]:!0},{[$o]:E=>!E||Array.isArray(E)&&E.every(Dl),[_re]:!1,[$l]:gs}]);if(u.error)return u;let d=rm({tournamentRecords:a});if(d.error)return d;if(!d.schedulingProfile.length)return{...ce};let{modifications:p,issues:h=[],schedulingProfile:f=[]}=d,m=Object.assign({},...Object.values(a).map(E=>kT({tournamentRecord:E}).containedStructures)),g=r.map(E=>{if(Dl(E))return Ei(E)}).filter(Boolean),v=f.map(E=>E.scheduleDate).map(E=>Dl(E)&&Ei(E)).filter(E=>E&&(!r.length||g.includes(E)));if(!v.length)return{error:Dne};if(n&&!l){let E=Array.isArray(n)?n:[];PO({tournamentRecords:a,scheduledDates:E})}let y=nm({ignoreDisabled:!1,tournamentRecords:a}).courts,{matchUps:b}=wd({matchUpFilters:{matchUpTypes:[or,zn]},afterRecoveryTimes:!0,nextMatchUps:!0,tournamentRecords:a}),{matchUpDependencies:I}=Vu({includeParticipantDependencies:!0,tournamentRecords:a,matchUps:b}),{matchUpDailyLimits:T}=hO({tournamentRecords:a}),{personRequests:w}=Ry({requestType:mP,tournamentRecords:a}),S=f.filter(E=>{let C=Ei(E==null?void 0:E.scheduleDate);return v.includes(C)}).sort((E,C)=>new Date(E.scheduleDate).getTime()-new Date(C.scheduleDate).getTime()),D={schedulingProfileModifications:p,checkPotentialRequestConflicts:e,scheduleCompletedMatchUps:i,schedulingProfileIssues:h,dateSchedulingProfiles:S,containedStructureIds:m,matchUpDependencies:I,matchUpDailyLimits:T,clearScheduleDates:n,tournamentRecords:a,schedulingProfile:f,personRequests:w,periodLength:o,useGarman:s,matchUps:b,dryRun:l,courts:y};return c?hLe(D):pLe(D)}function MO(t){let e=t||{};return e.tournamentId||(e.tournamentId=Pn()),e.startDate&&!$v(e.startDate)&&!gA.test(e.startDate)?{error:Xa}:e.endDate&&!$v(e.endDate)&&!gA.test(e.endDate)?{error:Xa}:(e.extensions&&(e.extensions=e.extensions.filter(dp)),{...e})}function _W({addParticipants:t=!0,participantAttribute:e,tournamentRecord:i,personAttribute:n,teamNames:r,accessor:a,uuids:o}){var f,m;if(!i)return{error:ut};let s={},l=(i.participants??[]).filter(({participantType:g,participantRole:v})=>g===Hi&&v===Do),c=0;for(let g of l){let v=a&&((f=Tb({element:g,accessor:a}))==null?void 0:f.value)||n&&((m=g.person)==null?void 0:m[n])||e&&g[e];if(v){if(!Object.keys(s).includes(v)){s[v]={participantName:(r==null?void 0:r[c])??v,participantId:(o==null?void 0:o.pop())??Pn(),individualParticipantIds:[],participantRole:Do,participantType:On};let y={value:n??e,name:j2};cn({element:s[v],extension:y}),c+=1}s[v].individualParticipantIds.push(g.participantId)}}let u=Object.keys(s),d=(i.participants??[]).map(g=>{if(g.participantType!==On||g.participantRole!==Do)return;let{extension:v}=Ri({name:j2,element:g}),y=v==null?void 0:v.value;if(u.includes(y))return g.participantId}).filter(Boolean),p=0,h=[];return Object.keys(s).forEach(g=>{let v=s[g],{participantId:y}=v;d.includes(y)||(i.participants||(i.participants=[]),t&&i.participants.push(v),h.push(v),p++)}),t&&p?(wi({payload:{tournamentId:i.tournamentId,participants:h},topic:Wm}),{...ce,participantsAdded:p}):h.length?{...ce,newParticipants:h}:{error:gPe}}var mLe=[{AA:"Annexia"},{BA:"Bacteria"},{BO:"Borduria"},{BM:"Bensalem"},{BS:"Basenji"},{BI:"Balnibarbi"},{BV:"Bartovia"},{BZ:"Berzerkistan"},{CA:"Caldonia"},{CC:"Concordia"},{CH:"Chula"},{DA:"Deltora"},{DW:"Discworld"},{EA:"Eastasia"},{EP:"Ecotopia"},{ER:"Erewhon"},{FA:"Freedonia"},{FN:"Florin"},{FG:"Fogg"},{FK:"Fourecks"},{GA:"Genovia"},{GL:"Gilead"},{GD:"Gilead"},{GL:"Gondal"},{GO:"Gondor"},{GR:"Gruzinia"},{GT:"Goritania"},{GU:"Guilder"},{HA:"Heldscalla"},{HO:"Hidalgo"},{IL:"Illyria"},{KA:"Kinakuta"},{KG:"Kangan"},{KN:"Kreplachistan"},{KS:"Kallipolis"},{LH:"Lugash"},{LI:"Listenbourg"},{LT:"Lilliput"},{LU:"Luggnagg"},{LV:"Lichtenslava"},{MR:"Moher"},{NA:"Narnia"},{NV:"Novaria"},{OA:"Oceania"},{OS:"Orsinia"},{OV:"Octavia"},{PA:"Palombia"},{PG:"Penguina"},{QA:"Qasha"},{PM:"Panem"},{SA:"Solymbria"},{SD:"Syldavia"},{SG:"San Glucose"},{SL:"San Lorenzo"},{SR:"Sontar"},{SY:"Sylvania"},{TF:"Tralfamadore"},{TH:"Themyscira"},{UA:"Utopia"},{VA:"Vespugia"},{WA:"Wakanda"},{WX:"Wessex"},{ZA:"Zamunda"},{ZK:"Zubrowka"}],gLe=["Amber","Ansul","Atlantis","Braavos","Busytown","Castle Rock","Centralia","Coober Pedy","Chefchaouen","Chronopolis","Damanhur","Diaspar","Dictionopolis","Diomira","El Dorado","Elista","Ephesus","Gotham","Hadleyburg","Hallstatt","Hierusalem","Ilium","Inverness","Kowloon","Laputa","Longyearbyen","Lys","Matmata","Maycomb","Metropolis","Miyake-jima","Monowi","Nagoro","Navarre","New New York","Nimbin","Pemberley","Pseudopolis","Rivendell","Roswell","Shangri-La","Springfield","Supilinn","Thneedville","Trantor","Wobegon","Yonwood","Xanadu","Xylar","Zion"];function ide({count:t=1,participantsCount:e=32}={}){let i=bs(gLe),n=i.slice(0,t);return{cities:Et(0,e).map(r=>r<Math.min(t,i.length)?n[r]:Il(n))}}function nde({count:t=1,participantsCount:e=32}={}){let i=bs(mLe),n=i.slice(0,t).map(r=>Object.keys(r)).flat();return{states:Et(0,e).map(r=>r<Math.min(t,i.length)?n[r]:Il(n))}}function rde({count:t=1,participantsCount:e=32}={}){let i=Et(0,t).map(()=>Et(0,5).map(()=>yc(0,9)).join(""));return{postalCodes:Et(0,e).map(n=>n<t?i[n]:Il(i))}}function HA({idPrefix:t,participantType:e,index:i,uuids:n}){return t?`${t}-${e===Hi?"I":"P"}-${i}`:(n==null?void 0:n.pop())||Pn()}function ade(t){let{cities:e,states:i,postalCodes:n,nationalityCode:r,participantIndex:a}=t;return{postalCode:n==null?void 0:n[a],state:i==null?void 0:i[a],city:e==null?void 0:e[a],countryCode:r}}var vLe={lastNames:["Abbey","Ahern","Ampleforth","Ananiadis","Andelic","Assange","Atreides","Austen","Bach","Banks","Barrington","Batty","Bauers","Beals","Beer","Bennett","Berry","Bonaparte","Brewer","Brockovich","Bukowski","Cassidy","Catton","Calvino","Carson","Chip","Constant","Crane","Crowne","Cummings","Curie","Dallas","Diamond","Deckard","Drazic","Dunbar","Earhart","Eisenstein","Eldritch","Elliot","Escher","Eyre","Faulkner","Fulcher","Fukuoka","Godel","Goldstein","Greer","Hedges","Herbert","Holmgren","Humperdinck","Huxley","Illich","Jeffers","Jensen","Jevons","Johnson","Johnstone","Jovovich","Kingsnorth","Langer","Fernwright","Fuller","Le Guin","Lem","Lovelace","Mander","McLuhan","Midgely","Mond","Montoya","Moore","Murry","Nagle","Nearing","Ogden","Ophuls","Parks","Paz","Peet","Perfect","Pendejo","Pevensie","Postman","Ripley","Rodda","Rumfoord","Runciter","Rugen","Sale","Schumacher","Shaftoe","Shelley","Shepard","Smith","Stratton","Stewart","Swift","Tillich","Turing","Tyrell","Twain","Yeats","Veblen","Yates","Vonnegut","Waterhouse","Watson","Wolin","Wirt","Waschuk","Wormwood"],firstFemale:["Ada","Amelia","Amelie","America","Anne","Antonia","Aravis","Astrid","Beatrice","Brienne","Buttercup","Caitlin","Cimorene","Cordelia","Desdemona","Ellen","Elizabeth","Emily","Emmie","Erin","Eva","Evelyn","Heather","Helen","Hermia","Hypatia","Imogen","Jane","Jasmine","Juliana","Juliet","Katniss","Leeloo","Lenina","Lilith","Linda","Lizzie","Louise","Lucy","Marie","Mary","Martha","Matilda","Milla","Miranda","Meg","Melba","Nicole","Ola","Portia","Pris","Rachael","Rachel","Rebecca","River","Rosa","Rosalind","Scout","Sharn","Susanne","Titania","Uhura","Ursula","Valentina","Viola","Virginia","Xena","Zoe"],firstMale:["Alan","Aldous","August","Axel","Barda","Barry","Bill","Bruce","Charles","Chris","Constantine","Darwin","David","Derrick","Edward","Emmanuel","Ernst","Estlin","Fezzik","Filby","Frank","Frito","George","Glen","Helmholtz","Inigo","Italo","Ivan","James","Jared","Jerry","Joe","Johann","Julian","John Michael","Jonathan","Korben","Kirkpatrick","Kurt","Lief","Malachi","Mark","Marhsall","Masanobu","Maurits","Michael","Mustapha","Neil","Nikola","Octavio","Palmer","Paul","Pierre","Robinson","Rick","Rincewind","Roy","Shannon","Sheldon","Stafford","Stanislaw","Stanley","Syme","Thorstein","Thomas","Tyrone","Vizzini","Walton","Walker","Warren","Wendell","Westley","William","Winston","Zoran"]};function jB(t){let{count:e=100,sex:i}=t||{};if(!e||i&&![Gn,hr].includes(i))return{personData:[],error:Re};let n=Math.ceil(e*1.3),{lastNames:r,firstFemale:a,firstMale:o}=vLe,s=Fm.map(({iso:m})=>m).filter(Boolean),l=Math.ceil(n/r.length),c=Math.ceil(n/a.length),u=Math.ceil(n/o.length),d=Et(0,l).flatMap(()=>{let m=Ot(r,!1,!0);return Et(0,r.length).map(()=>Sl(m))}),p=Et(0,c).flatMap(()=>{let m=Ot(a,!1,!0);return Et(0,a.length).map(()=>Sl(m))}),h=Et(0,u).flatMap(()=>{let m=Ot(o,!1,!0);return Et(0,o.length).map(()=>Sl(m))}),f={};for(let m=0;m<n;m++){let g=d.pop(),v=i||Il([Gn,hr]),y=v===Gn?h.pop():p.pop(),b=Il(s);f[`${y}${g}`]={nationalityCode:b,sex:v,firstName:y,lastName:g}}return{personData:Object.values(f).slice(0,e)}}function ode(t){let e=(t==null?void 0:t.count)||1,{personExtensions:i,consideredDate:n,isMock:r=!0,gendersCount:a,personData:o,category:s,sex:l}=t||{};if(isNaN(e))return{error:Re};let c=(a==null?void 0:a[Gn])||l===Gn&&e||0,u=(a==null?void 0:a[hr])||l===hr&&e||0;e=Math.max(e,c+u);let d=e-(c+u),p=c&&jB({count:c,sex:Gn}).personData||[],h=u&&jB({count:u,sex:hr}).personData||[],f=[...p,...h,...d&&jB({count:d}).personData||[]],m=f.filter(D=>!l||c&&u||D.sex===l),g=[];if(Array.isArray(o)){let D=o.filter(E=>typeof E.firstName!="string"||typeof E.lastName!="string"||E.sex&&![Gn,hr].includes(E.sex)||E.nationalityCode&&(typeof E.nationalityCode!="string"||E.nationalityCode.length>3||!Fm.find(({iso:C,ioc:P})=>[C,P].includes(E.nationalityCode)))?!1:(E.nationalityCode&&g.push(E.nationalityCode),!0));if(D.length)m=D;else return{error:Re}}let v=o?m:bs(m);if(v.length<e){let{maleFirstNames:D,maleLastNames:E,femaleFirstNames:C,femaleLastNames:P,nationalityCodes:R}=f.reduce((N,M)=>{let{firstName:A,lastName:_,nationalityCode:x}=M;return M.sex===Gn?(N.maleFirstNames.includes(A)||N.maleFirstNames.push(A),N.maleLastNames.includes(_)||N.maleLastNames.push(_)):(N.femaleFirstNames.includes(A)||N.femaleFirstNames.push(A),N.femaleLastNames.includes(_)||N.femaleLastNames.push(_)),N.nationalityCodes.includes(x)||N.nationalityCodes.push(x),N},{maleFirstNames:[],maleLastNames:[],femaleFirstNames:[],femaleLastNames:[],nationalityCodes:[]});Et(0,e-v.length).forEach(()=>{let N=l||Il([Gn,hr]),M=Il(R),A=Il(N===Gn?D:C),_=Il(N===Gn?E:P),x={firstName:A,lastName:_,sex:N,nationalityCode:M};v.push(x)})}let{ageMinDate:y,ageMaxDate:b}=eI({consideredDate:n,category:s}),I=ri((y==null?void 0:y.slice(0,4))||0)||ri((b==null?void 0:b.slice(0,4))||0)-3,T=ri((b==null?void 0:b.slice(0,4))||0)||ri((y==null?void 0:y.slice(0,4))||0)+3,w=(y||b)&&[I,T],S=v.slice(0,e).map((D,E)=>{let[C,P]=w||[],R=w&&Sl(Et(C,P)),N=Sl(Et(0,365)),M=R&&BRe(R,N);return Object.assign(zt({extensions:i||[{name:"regionCode",value:E+1}],birthDate:M,isMock:r}),D)});return{persons:S.length&&S||v[0],nationalityCodes:g}}var yLe=["Ace Academy","Avengers","Ball Bouncers","Baseliners","Captivators","Civil Disobedients","Continentals","Court Royal","Court Sharks","Diamond Dogs","Danger Zone","Doubles Dominators","Double Faults","Tricksters","Eliminators","Court Crusaders","Fuzz Busters","Game Changers","Goal Gurus","Good Volley","Green Machine","Hawk Eyes","Inside Outers","Killer Instinct","Line Toers","Masters of Mayhem","Matter Catchers","Cheap Shot","Mean Machines","Mindspace Invaders","Net Centric","Net Positive","Smash Mullet","Over Your Head","Spin Meisters","Aggressors","Racket Machine","Slice Happy","Refs Nightmare","Sandeaters","Sun Seekers","Slicer Dicers","Stacked Deck","Cross Stringers","The Emergence","Total Demolition","Touch and Go","Unreturnables","Upside Downers","Vertically Challenged","Visual Spectacle"];function DV({nameRoot:t="TEAM",count:e=1}={}){let i=bs(yLe).slice(0,e);return i.length<e&&Et(0,e-i.length).forEach(n=>i.push(`${t} ${n+1}`)),{names:i}}function JT(t){let{scaledParticipantsCount:e,rankingRange:i}=t,{ratingsParameters:n=La,valuesInstanceLimit:r,ratingsValues:a=[],consideredDate:o,categories:s,category:l,nationalityCodesCount:c,nationalityCodeType:u,nationalityCodes:d,participantsCount:p=32,participantType:h,personIds:f,idPrefix:m,uuids:g,personExtensions:v,addressProps:y,gendersCount:b,matchUpType:I,personData:T,sex:w,inContext:S,withISO2:D,withIOC:E,scaleAllParticipants:C}=t,P=h===Ti||I===jv,R=h===On||I===On;i&&(!Array.isArray(i)||!i.every(Ve=>Rr(Ve))||i.length!==2)&&(i=void 0),e=C?p:e;let N=1e3,M=e&&e>N?e:N;i=i||[1,M],i[1]+=1;let A=p*(P?2:R?8:1),_=ode({count:A,personExtensions:v,consideredDate:o,gendersCount:b,personData:T,category:l,sex:w});if(_.error)return _;let{nationalityCodes:x,persons:O}=_,B={},F={},G={},H={},$=Ve=>{Object.assign(B,Ve.doublesRankings),Object.assign(F,Ve.singlesRankings),Object.assign(H,Ve.doublesRatings),Object.assign(G,Ve.singlesRatings)};if(Xi(l)){let Ve=AY({scaledParticipantsCount:e,ratingsParameters:n,participantType:h,ratingsValues:a,rankingRange:i,category:l});$(Ve)}Array.isArray(s)&&s.forEach(Ve=>{let ot=AY({scaledParticipantsCount:e,ratingsParameters:n,participantType:h,ratingsValues:a,rankingRange:i,category:Ve});$(ot)});let q=Fm.filter(Ve=>u==="IOC"&&Ve.ioc||Ve.iso);function z(Ve){let ot=Math.ceil(A/Ve);return r&&ot>r?Math.ceil(A/r):Ve}let{postalCodesProfile:Z,postalCodesCount:Y,statesProfile:Q,citiesProfile:X,citiesCount:oe,statesCount:re}=y||{},me=Ve=>Object.keys(Ve).map(ot=>Et(0,Q[ot]).map(()=>ot)).flat(),se=X&&me(X)||(y==null?void 0:y.cities)||ide({count:oe||A,participantsCount:A}).cities,te=Q&&me(Q)||(y==null?void 0:y.states)||nde({count:re||A,participantsCount:A}).states,he=Z&&me(Z)||(y==null?void 0:y.postalCodes)||rde({count:Y||A,participantsCount:A}).postalCodes,ae={cities:se,states:te,postalCodes:he},de=z(c),Ie=de?bs(q).slice(0,c):d?q.filter(Ve=>d.includes(Ve.iso)):q,De=bs(Et(0,Math.ceil(A/(de||1))).map(()=>Ie).flat(1/0)),Te=DV({count:p}).names;return{participants:Et(0,p).map(Ve=>{let ot=P?2:R?8:1,St=Et(0,ot).map(Ee=>{let lt=Ve*ot+Ee;return _e(lt)}),nt=St.map(Ee=>Ee.participantId),Bt=St.map(Ee=>Ee.person.standardFamilyName).join("/"),Pe=P?Ti:On,et={participantId:HA({participantType:Pe,idPrefix:m,index:Ve,uuids:g}),participantRole:Do,participantName:P?Bt:Te[Ve],individualParticipantIds:nt,participantType:Pe};return S&&(et.individualParticipants=St),P||R?[et,...St]:St}).flat(),...ce};function _e(Ve){let ot=O[Ve],{nationalityCode:St,participantExtensions:nt,participantTimeItems:Bt,extensions:Pe,firstName:et,birthDate:Ee,lastName:lt,personId:Ke,sex:bt}=ot||{},gt=et||"GivenName",Ue=lt||"FamilyName",xe=`${gt} ${Ue}`,We=De[Ve],st=(x==null?void 0:x.length)&&St||We&&(u==="IOC"?We.ioc||We.iso:We.iso||We.ioc)||St;De!=null&&De.length&&!st&&!St&&console.log("%c Invalid Nationality Code",{participantIndex:Ve,country:We});let vt=ade({...ae,participantIndex:Ve,nationalityCode:st}),ge=zt({participantId:HA({participantType:Hi,index:Ve,idPrefix:m,uuids:g}),extensions:nt,timeItems:Bt,participantRole:Do,participantType:Hi,participantName:xe,person:{personId:Ke||(f==null?void 0:f.length)&&f[Ve]||Pn(),birthDate:Dl(Ee)?Ee:void 0,addresses:[vt],standardFamilyName:Ue,standardGivenName:gt,nationalityCode:st,extensions:Pe,sex:bt}});if(E&&st){let qe=Fm.find(({iso:$e})=>$e===st);qe!=null&&qe.ioc&&(ge.person.iocNationalityCode=qe.ioc),qe!=null&&qe.label&&(ge.person.countryName=qe.label)}if(D&&st){let qe=Fm.find(({iso:$e})=>$e===st);qe!=null&&qe.iso2&&(ge.person.iso2NationalityCode=qe.iso2),qe!=null&&qe.label&&(ge.person.countryName=qe.label)}let Se=qe=>{var At,ei,vi,Ln;let $e=qe.categoryName||qe.ratingType||qe.ageCategoryCode,ke=(At=F[$e])==null?void 0:At[Ve],Ut=(ei=B[$e])==null?void 0:ei[Ve];IM({scaleValue:ke,eventType:qb,scaleType:Hm,participant:ge,category:qe}),IM({scaleValue:Ut,eventType:Gm,scaleType:Hm,participant:ge,category:qe});let pt=(vi=G[$e])==null?void 0:vi[Ve],tt=(Ln=H[$e])==null?void 0:Ln[Ve];IM({scaleValue:pt,eventType:qb,scaleType:Lm,participant:ge,category:qe}),IM({scaleValue:tt,eventType:Gm,scaleType:Lm,participant:ge,category:qe})};return Array.isArray(s)?s.forEach(qe=>Se(qe)):l&&Se(l),ge}}function IM({scaleValue:t,participant:e,eventType:i,scaleType:n,category:r}){let a=r.categoryName||r.ratingType||r.ageCategoryCode,o=[Bv,n,i,a].join("."),s={itemValue:t,itemType:o};a&&t&&(e.timeItems||(e.timeItems=[]),e.timeItems.push(s))}function AY(t){let{category:e,scaledParticipantsCount:i,ratingsParameters:n,participantType:r,ratingsValues:a=[]}=t,o=e.rankingRange||t.rankingRange||[1,1e3],s={},l={},c={},u={},{categoryName:d,ageCategoryCode:p,ratingType:h}=e,f=e.categoryName||e.ratingType||e.ageCategoryCode;if((d||p)&&!h){let[m,g]=o||[];if(l[f]=bs(Et(m,g)).slice(0,i||yc(20,30)),[Ti,On].includes(r)){let[v,y]=o||[];s[f]=bs(Et(v,y)).slice(0,i||yc(20,30))}}if(h&&n[h]){let{ratingMax:m,ratingMin:g,ratingAttributes:v}=e,y={...n[h],...v||{}},{attributes:b={},decimalsCount:I,accessors:T,range:w,step:S}=y,D=N=>{let M={},A=Object.keys(N||{});for(let _ of A){let x=N[_];if(typeof x=="object"&&x.generator){let{range:O}=x,[B,F]=O.slice().sort();M[_]=yc(B,F)}else M[_]=x}return M},E=w[0]>w[1]?2:.7,[C,P]=w.slice().sort(),R=Et(0,2e3).map(()=>ure(C,P,E,S,I)).filter(N=>(!m||N<=m)&&(!g||N>=g)).slice(0,i||yc(20,30)).map(N=>T?Object.assign({},...T.map(M=>({[M]:N})),D(b)):N);c[f]=[...a,...R],[Ti,On].includes(r)&&(u[f]=[...a,...R])}return{singlesRankings:l,doublesRankings:s,singlesRatings:c,doublesRatings:u}}function kW(t){var h,f;let{alternatesCount:e=0,tieFormatName:i,drawSize:n}=t,r=0,a=0,o=0,s=0,l={},c={[Gn]:0,[hr]:0,[nl]:0,[Sv]:0,[Id]:0};(f=(h=Xi(t.tieFormat)?t.tieFormat:Xv({namedFormat:i}))==null?void 0:h.collectionDefinitions)==null||f.filter(Boolean).forEach(m=>{let{category:g,collectionId:v,matchUpType:y,matchUpCount:b,gender:I}=m;if([Gn,hr].includes(I)){let T=b*(y===zn?2:1);c[I]<T&&(c[I]=T)}else I===nl&&(c[Gn]<b&&(c[Gn]=b),c[hr]<b&&(c[hr]=b));if(g){let T=JSON.stringify(g);l[T]=g}if(v||(m.collectionId=Pn()),Gr(zn)(y)){let T=b;s+=b,r=Math.max(r,T)}if(Gr(or)(y)){let T=b;o+=b,a=Math.max(a,T)}});let u=Object.keys(l).length?Math.max(o,s*2):Math.max(a,r*2),d=r*(n+e),p=a*(n+e);return{maxDoublesDraw:d,maxSinglesDraw:p,teamSize:u,genders:c}}function bLe({participantsProfile:t,eventProfiles:e,drawProfiles:i}){let{participantsCount:n,participantType:r=Hi}=t||{},a=n||0,o={[hr]:0,[nl]:0,[Sv]:0,[Gn]:0,[Id]:0},s=0,l=0,c=0,u=0,d=0,p=({alternatesCount:f=0,uniqueParticipants:m,tieFormatName:g,drawSize:v=0,eventType:y,tieFormat:b,category:I,gender:T,stage:w})=>{let S=y===Oc,D=y===ga,E=!!(m||w===Zt||I||T);if(D){u=Math.max(u,v+f),b=typeof b=="object"?b:Xv({namedFormat:g});let{teamSize:C,maxDoublesDraw:P,maxSinglesDraw:R,genders:N}=kW({alternatesCount:f,tieFormatName:g,tieFormat:b,drawSize:v});c=Math.max(c,C),l=Math.max(l,R),E||(s=Math.max(s,P)),Object.keys(N).forEach(M=>o[M]+=N[M])}else if(S)if(E){let C=(v+f)*2;d+=C,T&&(o[T]+=C)}else v+f&&v+f>s&&(s=v+f);else if(E){let C=v+f;T&&(o[T]+=C),d+=C}else v&&v>l&&(l=v+f)};if(e==null||e.forEach(f=>{let{tieFormatName:m,tieFormat:g,drawProfiles:v,eventType:y,category:b,gender:I}=f;if(v)for(let T of v){let{tieFormatName:w,tieFormat:S}=T;p({...T,tieFormatName:w||m,tieFormat:S||g,eventType:y,category:b,gender:I})}}),Array.isArray(i))for(let f of i)p(f);let h=Math.max(u*c,s*2,l);return s&&(r=Ti),(n||a)<h&&(n=h),n&&s&&[Ti,ga].includes(r)&&(l&&Math.floor(l/2)>s?n=Math.floor(l/2):(!l||s*2>=l)&&(n=Math.ceil(n/2))),n===void 0&&(n=!(e!=null&&e.length)&&!(i!=null&&i.length)?32:0),n<a&&(n=a),{uniqueParticipantsCount:d,participantsCount:n,largestTeamDraw:u,largestTeamSize:c,participantType:r,gendersCount:o}}function sde({participantsProfile:t,tournamentRecord:e,eventProfiles:i,drawProfiles:n,startDate:r,uuids:a}){let{participantsCount:o,participantType:s,largestTeamDraw:l,largestTeamSize:c,gendersCount:u}=bLe({participantsProfile:t,eventProfiles:i,drawProfiles:n}),d=t==null?void 0:t.teamKey,p=JT({consideredDate:r,...t,participantsCount:o,participantType:s,gendersCount:u,uuids:a}).participants,h=0,f=Nu({tournamentRecord:e,participants:p});if(f.error)return f;if(h+=f.addedCount,d){let y=_W({tournamentRecord:e,...d});if(y.error)return y}let m=p.filter(({participantType:y})=>y===Hi).map(Gi),g=t!=null&&t.idPrefix?`${On}-${t.idPrefix}`:void 0,v=Et(0,l).map(y=>{let b=m.slice(y*c,(y+1)*c),I=HA({index:y,participantType:s,idPrefix:g,uuids:a});return{participantName:`Team ${y+1}`,participantRole:Do,individualParticipantIds:b,participantType:On,participantId:I}});return f=Nu({participants:v,tournamentRecord:e}),f.error?f:(h+=f.addedCount,{addedCount:h,...ce})}function lde({drawProfiles:t,category:e,gender:i}){let n={},r=t==null?void 0:t.reduce((o,s)=>{let{qualifyingPositions:l=0,participantsCount:c=0,uniqueParticipants:u,stage:d=xt,drawSize:p=0}=s||{};Object.keys(o).includes(d)||(o[d]=0);let h=(c||p)-l;return u||i||e||d===Zt?(Object.keys(n).includes(d)||(n[d]=0),n[d]+=h):o[d]=Math.max(o[d],h),o},{}),a=Object.keys(n);return a.forEach(o=>r[o]+=n[o]),{stageParticipantsCount:r,uniqueParticipantsCount:n,uniqueParticipantStages:a}}function cde({allUniqueParticipantIds:t,stageParticipantsCount:e,eventParticipantType:i,targetParticipants:n}){let r=e[xt]||0,a=e[Zt]||0;return{stageParticipants:{QUALIFYING:n.filter(({participantType:o})=>o===i).filter(({participantId:o})=>!t.includes(o)).slice(0,a),MAIN:n.filter(({participantType:o})=>o===i).filter(({participantId:o})=>!t.includes(o)).slice(a,a+r)}}}var ILe={[hn]:2,[ua]:1,[Ea]:1,[go]:1,[Zi]:4};function xW(t){let{defaultWithScorePercent:e=2,winningSide:i}=t,{matchUpStatusProfile:n=ILe,matchUpFormat:r=Iu,pointsPerMinute:a=1,sideWeight:o=4}=t;if(!Nl({matchUpFormat:r}))return{error:kH};if(typeof n!="object")return{error:Re};if(e>100&&(e=100),isNaN(e)||isNaN(a)||isNaN(o))return{error:Re};let s=Object.keys(n).filter(D=>Object.keys(xz).includes(D)&&D!==jr);if(Object.keys(s).reduce((D,E)=>D+n[E],0)>100)return{error:Re,matchUpStatusProfile:n};let l=s.reduce((D,E)=>(D.pointer=D.pointer+n[E],D.valueMap.push([D.pointer,E]),D),{pointer:0,valueMap:[]}),c=yc(1,100),u=(l.valueMap.find(D=>c<=D[0])??[100,jr])[1],d={sets:[],scoreStringSide1:"",side2ScoreString:""};if([hn,Zi].includes(u)){i=i||yc(1,2);let D={score:d,winningSide:i,matchUpStatus:u};if(!(u===Zi&&yc(1,100)>100-e))return{outcome:D}}else if([ua,Ea].includes(u))return{outcome:{score:d,matchUpStatus:u}};let p=Ys(r),{bestOf:h,setFormat:f,finalSetFormat:m}=p??{},g=[],v=yc(0,1),y=i?[i-1]:[...Et(0,o).map(()=>v),1-v],b=[go,Zi,$c,Dg].includes(u)&&(Sl(Et(1,h))||1),I;for(let D of Et(1,(h??0)+1)){let E=D===h,{set:C,incomplete:P,winningSideNumber:R}=wLe({incomplete:b===D,matchUpStatus:u,pointsPerMinute:a,setFormat:E&&m||f,setNumber:D,weightedRange:y});if(g.push(C),P){I=R;break}if(WD({matchUp:{score:{sets:g},matchUpFormat:r}}).calculatedWinningSide)break}let T=WD({matchUp:{score:{sets:g},matchUpFormat:r}}),w=I?i||I:T.calculatedWinningSide,{score:S}=zue({score:{sets:g},winningSide:w,matchUpStatus:u});return{outcome:{score:S,winningSide:w,matchUpStatus:u}}}function wLe({weightedRange:t=[0,1],pointsPerMinute:e,matchUpStatus:i,incomplete:n,setFormat:r,setNumber:a}){let o={setNumber:a},{setTo:s,tiebreakFormat:l,tiebreakAt:c,tiebreakSet:u,timed:d,minutes:p}=r,h=yc(0,t.length-1),f=t[h],m;if(d){let g=p*e,v=Math.round(g*.2),y=g+Sl([1,-1])*v,b=$Pe(y,2),I=[b,y-b];f&&I.reverse(),m=t[h]+1;let T=I[0]>I[1]&&1||I[1]>I[0]&&2||0;if(n){let[D,E]=I;return Object.assign(o,{side1Score:D,side2Score:E}),ba.includes(i)?{set:o,incomplete:n,winningSideNumber:m}:{set:o,incomplete:n}}T||(I[yc(0,1)]+=1),T=I[0]>I[1]?1:2,T!==m&&I.reverse();let[w,S]=I;return Object.assign(o,{side1Score:w,side2Score:S,winningSide:m}),{set:o}}else{if(n)return o.side1Score=yc(0,c),o.side2Score=yc(0,c),ba.includes(i)&&(m=t[h]+1),{set:o,incomplete:n,winningSideNumber:m};{let g=Et(1,s+1).map(S=>Et(0,s+2-S).map(()=>S)).flat(),v=g[yc(0,g.length-1)],y=s&&v3({isSide1:!0,tiebreakAt:c,lowValue:v,setTo:s}),b=!y,I=t.length===1&&t[h]+1;if(!b){I?(y[0]>y[1]?1:2)!==I&&y.reverse():f&&y.reverse();let[S,D]=y;Object.assign(o,{side1Score:S,side2Score:D})}let T=zD({matchUpScoringFormat:{setFormat:r},setObject:o}),w;if(T.hasTiebreakCondition||b){let{NoAD:S,tiebreakTo:D}=l||u||{},E=Et(1,D+1).map(R=>Et(0,D+2-R).map(()=>R)).flat(),C=E[yc(0,E.length-1)],P=Qx({isSide1:!0,tiebreakNoAd:S,tiebreakTo:D,lowValue:C});if(P)if(b){let R=P[0]>P[1]?1:2;I?R!==I&&P.reverse():f&&P.reverse(),[o.side1TiebreakScore,o.side2TiebreakScore]=P,w=P[0]>P[1]&&1||P[1]>P[0]&&2||void 0}else T.leadingSide===2?[o.side1TiebreakScore,o.side2TiebreakScore]=P:[o.side2TiebreakScore,o.side1TiebreakScore]=P}o.winningSide=T.winningSide||T.leadingSide||I||w}}return{set:o}}function zA(t){var m,g,v;let{matchUpStatusProfile:e,completeAllMatchUps:i,randomWinningSide:n,tournamentRecord:r,completionGoal:a,drawDefinition:o,event:s}=t;if(!o)return{error:Vt};let l=t.matchUpFormat||o.matchUpFormat||(s==null?void 0:s.matchUpFormat),c=o.structures.slice().sort(FI),u=0,{matchUps:d,matchUpsMap:p}=Ia({contextFilters:{stages:[xt,Zt]},matchUpFilters:{matchUpTypes:[Xn],roundNumbers:[1]},inContext:!0,drawDefinition:o});if(d!=null&&d.length){let y=((m=s==null?void 0:s.category)==null?void 0:m.ageCategoryCode)||((g=s==null?void 0:s.category)==null?void 0:g.categoryName);if(y){let b=Uue({singlesOnly:!0,tournamentRecord:r,drawDefinition:o,scaleAccessor:{scaleName:y,sortOrder:Sue,scaleType:Hm},event:s});if(b.error)return b;let{lineUps:I,participantsToAdd:T}=b;Nu({tournamentRecord:r,participants:T}),cn({element:o,extension:{name:Cf,value:I}})}else{let b=(v=d[0])==null?void 0:v.structureId,{positionAssignments:I}=Vn({drawDefinition:o,structureId:b});if(I!=null&&I.length){let{participants:T}=Nr({participantFilters:{participantTypes:[Xn]},tournamentRecord:r}),w=S=>{let D=S.tieMatchUps.filter(Gr(or)),E=S.tieMatchUps.filter(Gr(zn));D.forEach((C,P)=>{let R=C.matchUpId;C.sides.forEach(N=>{var _;let{drawPosition:M}=N,A=T==null?void 0:T.find(x=>{var B;let{participantId:O}=x;return((B=I.find(F=>F.participantId===O))==null?void 0:B.drawPosition)===M});if(A){let x=(_=A.individualParticipantIds)==null?void 0:_[P];x&&GA({teamParticipantId:A.participantId,participantId:x,tournamentRecord:r,drawDefinition:o,tieMatchUpId:R,event:s})}})}),E.forEach((C,P)=>{let R=C.matchUpId;C.sides.forEach(N=>{var _,x;let{drawPosition:M}=N,A=T==null?void 0:T.find(O=>{var F;let{participantId:B}=O;return((F=I.find(G=>G.participantId===B))==null?void 0:F.drawPosition)===M});A&&((x=(_=A.individualParticipantIds)==null?void 0:_.slice(P*2,P*2+2))==null||x.forEach(O=>{GA({teamParticipantId:A.participantId,participantId:O,tournamentRecord:r,drawDefinition:o,tieMatchUpId:R,event:s})}))})})};d.forEach(w)}}}let h=typeof i=="string"&&i,f=h&&jr;for(let y of c){if(u>=a)break;let{matchUps:b}=wn({matchUpFilters:{matchUpTypes:[zn,or]},afterRecoveryTimes:!1,tournamentRecord:r,inContext:!0,drawDefinition:o,matchUpsMap:p,structure:y,event:s}),I=b.filter(({winningSide:T})=>!T).sort(GI).map($a);for(let T of I){if(!isNaN(a)&&u>=a)break;let{matchUps:w}=wn({matchUpFilters:{matchUpTypes:[zn,or]},afterRecoveryTimes:!1,tournamentRecord:r,inContext:!0,drawDefinition:o,matchUpsMap:p,structure:y,event:s}),S=w.find(E=>E.matchUpId===T),D=[ua,Ea].includes(S.matchUpStatus);if(S!=null&&S.readyToScore&&!D){let E=SLe({winningSide:!n&&1,matchUpStatusProfile:e,tournamentRecord:r,drawDefinition:o,targetMatchUp:S,matchUpFormat:l,matchUpStatus:f,scoreString:h,event:s});if(E!=null&&E.error)return E;u+=1}}}return{...ce,completedCount:u}}function ude(t){let{matchUpStatusCodes:e,policyDefinitions:i,tournamentRecord:n,drawDefinition:r,targetMatchUp:a,matchUpStatus:o,matchUpFormat:s,scoreString:l,winningSide:c,event:u}=t;if(!a||a.matchUpStatus===vn)return;let{matchUpId:d}=a||{},{outcome:p}=PW({matchUpFormat:s,matchUpStatus:o,scoreString:l,winningSide:c});return e&&(p.matchUpStatusCodes=e),hP({tournamentRecord:n,policyDefinitions:i,drawDefinition:r,matchUpFormat:s,matchUpId:d,outcome:p,event:u})}function SLe(t){let{matchUpStatusProfile:e={},tournamentRecord:i,policyDefinitions:n,drawDefinition:r,matchUpStatus:a,matchUpFormat:o,targetMatchUp:s,scoreString:l,winningSide:c,event:u}=t;if(l||a)return ude(t);let{matchUpId:d}=s||{},{outcome:p}=xW({matchUpStatusProfile:e,matchUpFormat:o,winningSide:c});return hP({policyDefinitions:n,tournamentRecord:i,drawDefinition:r,matchUpFormat:o,matchUpId:d,outcome:p,event:u})}function dde({matchUpStatusProfile:t,completeAllMatchUps:e,randomWinningSide:i,tournamentRecord:n,drawProfiles:r,isMock:a,event:o}){var m,g,v,y;let s=Zr({event:o}).flightProfile,{eventName:l,eventType:c,category:u}=o,{startDate:d}=n,p=[],h=(u==null?void 0:u.categoryName)||(u==null?void 0:u.ageCategoryCode)||(u==null?void 0:u.ratingType),f=(m=o.drawDefinitions)==null?void 0:m.map(({drawId:b})=>b);if(Array.isArray(s==null?void 0:s.flights))for(let[b,I]of s.flights.entries()){let{drawId:T,stage:w,drawName:S,drawEntries:D}=I;p.push(I.drawId);let E=r[b],{seedsCount:C,generate:P=!0}=E||{};if(P){let R=D.filter(Ml(gh)).map(Ml(gh)),N=h||l;if(n&&C&&C<=R.length&&Et(1,C+1).forEach((O,B)=>{let F={scaleValue:O,scaleName:N,scaleType:Qp,eventType:c,scaleDate:d},G=R[B];tP({tournamentRecord:n,participantId:G,scaleItem:F})}),f==null?void 0:f.includes(T))break;let M=lP({...E,matchUpType:c,seedingScaleName:N,tournamentRecord:n,drawEntries:D,drawName:S,drawId:T,isMock:a,event:o,stage:w});if(M.error)return{error:M.error,drawIds:[]};let{drawDefinition:A}=M;if(!A)return{error:Zl};let _=(g=r[b])==null?void 0:g.drawExtensions;if(Array.isArray(_)&&_.filter(dp).forEach(O=>cn({element:A,extension:O})),M=cP({suppressNotifications:!0,tournamentRecord:n,drawDefinition:A,event:o}),M.error)return{error:M.error,drawIds:[]};if(E!=null&&E.withPlayoffs){let O=(v=A.structures)==null?void 0:v[0].structureId,B=Vx({idPrefix:E.idPrefix,...E.withPlayoffs,tournamentRecord:n,drawDefinition:A,structureId:O,isMock:a,event:o});if(B!=null&&B.error)return B}let x=E==null?void 0:E.completionGoal;if((E==null?void 0:E.automated)!==!1&&(e||x)){let O=E==null?void 0:E.matchUpFormat,B=zA({completeAllMatchUps:!x&&e,matchUpStatusProfile:t,randomWinningSide:i,tournamentRecord:n,completionGoal:x,drawDefinition:A,matchUpFormat:O,event:o});if(B.error)return{error:B.error,drawIds:[]};let F=B.completedCount;if((E==null?void 0:E.drawType)===mh){let G=(y=A.structures)==null?void 0:y.find(q=>q.stage===xt);if(!G)return{error:wr};let H=VC({structureId:G.structureId,tournamentRecord:n,drawDefinition:A,event:o});if(H.error)return{error:H.error,drawIds:[]};let $=x?x-(F??0):void 0;if(H=zA({completeAllMatchUps:!x&&e,completionGoal:x?$:void 0,matchUpStatusProfile:t,randomWinningSide:i,tournamentRecord:n,drawDefinition:A,matchUpFormat:O,event:o}),H.error)return{error:H.error,drawIds:[]}}}}}return{...ce,drawIds:p}}function pde(t){var w,S;let{participantsProfile:e={},uniqueParticipantsCount:i,ratingsParameters:n,tournamentRecord:r,eventProfile:a,eventIndex:o,event:s,uuids:l}=t,{category:c,gender:u,eventType:d}=s,p=Gr(cp)(d)&&Hi||Gr(Oc)(d)&&Ti||d,h=i[xt]||0,f=i[Zt]||0,m=(w=a.drawProfiles)!=null&&w.length?h+f:((S=a.participantsProfile)==null?void 0:S.participantsCount)??0,g=[Gn,hr].includes(u)?u:void 0,v=e!=null&&e.idPrefix?`E-${o}-${e==null?void 0:e.idPrefix}`:void 0,{participants:y}=JT({uuids:a.uuids||l,...e,scaledParticipantsCount:a.scaledParticipantsCount,consideredDate:r==null?void 0:r.startDate,rankingRange:a.rankingRange,participantType:p,participantsCount:m,ratingsParameters:n,category:c,idPrefix:v,sex:g}),b=Nu({tournamentRecord:r,participants:y});if(b.error)return b;let I=y==null?void 0:y.filter(({participantType:D})=>D===p),T=y==null?void 0:y.map(Gi);return{uniqueDrawParticipants:I,uniqueParticipantIds:T}}function TLe({autoEntryPositions:t,tournamentRecord:e,drawParticipants:i,drawProfile:n,event:r}){let{drawType:a=ep,qualifyingPositions:o=0,stage:s=xt,drawSize:l=0,drawName:c,drawId:u}=n,d=l-o,p=i.slice(0,d).map(Gi);if(p.length){let m=ih({participantIds:p,autoEntryPositions:t,entryStage:s,tournamentRecord:e,event:r});if(m.error)return m}let h=p.map(m=>({entryStatus:Rl,entryStage:s,participantId:m})),f=vO({drawName:c||a,qualifyingPositions:o,drawEntries:h,drawId:u,event:r,stage:s});return f.error?f:{...ce}}function hde({uniqueDrawParticipants:t,autoEntryPositions:e,stageParticipants:i,tournamentRecord:n,drawProfiles:r,category:a,gender:o,event:s}){let l=0;for(let c of r){let{qualifyingPositions:u=0,uniqueParticipants:d,stage:p=xt,drawSize:h=0}=c,f=h-u,m=d||o||a||p===Zt,g=m?t.slice(l,l+f):i[p||xt]||[];m&&(l+=f);let v=TLe({autoEntryPositions:e,drawParticipants:g,tournamentRecord:n,drawProfile:c,event:s});if(v.error)return v}return{...ce}}function fde(t){var X;let{allUniqueParticipantIds:e,matchUpStatusProfile:i,participantsProfile:n,completeAllMatchUps:r,autoEntryPositions:a,hydrateCollections:o,randomWinningSide:s,ratingsParameters:l,tournamentRecord:c,eventProfile:u,eventIndex:d,publish:p,isMock:h,uuids:f}=t,m=u.gender,g=u.eventName,{eventType:v=cp,policyDefinitions:y,drawProfiles:b=[],eventExtensions:I,surfaceCategory:T,tieFormatName:w,processCodes:S,discipline:D,eventLevel:E,timeItems:C,ballType:P,category:R}=u,N=u.eventId||Pn(),M=u.tieFormat||(v===ga?Xv({namedFormat:w,event:{eventId:N,category:R,gender:m},hydrateCollections:o,isMock:h}):void 0),A=c.participants;for(let oe of b)!m&&oe.gender&&(m=oe==null?void 0:oe.gender);let{stageParticipantsCount:_,uniqueParticipantsCount:x,uniqueParticipantStages:O}=lde({drawProfiles:b,category:R,gender:m}),B=Gr(cp)(v)&&Hi||Gr(Oc)(v)&&Ti||v,{uniqueDrawParticipants:F=[],uniqueParticipantIds:G=[]}=O?pde({event:{eventType:v,category:R,gender:m},uniqueParticipantsCount:x,participantsProfile:n,ratingsParameters:l,tournamentRecord:c,eventProfile:u,eventIndex:d,uuids:f}):{},{eventAttributes:H}=u;typeof H!="object"&&(H={});let $=(R==null?void 0:R.categoryName)||(R==null?void 0:R.ageCategoryCode)||(R==null?void 0:R.ratingType);g=g||$||"Generated Event";let q={...H,surfaceCategory:T,processCodes:S,discipline:D,eventLevel:E,eventName:g,eventType:v,tieFormat:M,ballType:P,category:R,eventId:N,gender:m};if(I!=null&&I.length&&Array.isArray(I)){let oe=I.filter(dp);oe!=null&&oe.length&&Object.assign(q,{extensions:oe})}if(Array.isArray(C)&&C.forEach(oe=>YI({event:Y,timeItem:oe})),typeof y=="object")for(let oe of Object.keys(y))Kv({policyDefinitions:{[oe]:y[oe]},event:q});q.category&&(q.category.categoryName=$);let z,Z=uP({suppressNotifications:!1,internalUse:!0,tournamentRecord:c,event:q});if(Z.error)return Z;let Y=Z==null?void 0:Z.event,{stageParticipants:Q}=cde({allUniqueParticipantIds:e,stageParticipantsCount:_,eventParticipantType:B,targetParticipants:A});if(b!=null&&b.length){let oe=hde({uniqueDrawParticipants:F,autoEntryPositions:a,stageParticipants:Q,tournamentRecord:c,drawProfiles:b,category:R,gender:m,event:Y});if(oe.error)return oe;let re=dde({matchUpStatusProfile:i,completeAllMatchUps:r,randomWinningSide:s,tournamentRecord:c,drawProfiles:b,isMock:h,event:Y});if(re.error)return re;z=re.drawIds}else if((X=u==null?void 0:u.participantsProfile)!=null&&X.participantsCount){let oe=F.map(Gi);if(oe.length){let re=ih({participantIds:oe,autoEntryPositions:a,tournamentRecord:c,entryStage:xt,event:Y});if(re.error)return re}}return p&&KT({tournamentRecord:c,event:Y}),{drawIds:z,eventId:N,uniqueParticipantIds:G}}function OW({tournamentRecords:t,scheduleDate:e,venueId:i,round:n}){if(!Dl(e))return{error:Xa};let r="addSchedulingProfileRound",{extension:a}=Ri({name:Zb,tournamentRecords:t,discover:!0}),o=(a==null?void 0:a.value)||[],s=o.find(p=>vh(e,p.scheduleDate));if(!s){let{startDate:p,endDate:h}=iO({tournamentRecords:t}),f=new Date(e);if(p&&f<new Date(p)||h&&f>new Date(h))return{error:Xa};s={scheduleDate:e,venues:[]},o.push(s)}let l=s.venues.find(p=>p.venueId===i);l||(l={venueId:i,rounds:[]},s.venues.push(l));let c=["notBeforeTime"],u=p=>Object.keys(p).filter(h=>!c.includes(h)).sort().map(h=>Xi(p[h])?u(p[h]):p[h]).flat().join("|");if(l.rounds.find(p=>u(p)===u(n)))return pe({result:{error:dne},stack:r});l.rounds.push(n);let d=zT({tournamentRecords:t,schedulingProfile:o});return d.error?d:{...ce}}function ULe({schedulingProfile:t,tournamentRecord:e}){if(typeof t!="object")return{error:Re};let i=kT({tournamentRecord:e}).containedStructures,n=oo({tournamentRecord:e}).matchUps??[],{tournamentId:r}=e,a=[];for(let o of t){let{scheduleDate:s,venues:l=[]}=o;for(let c of l){let{rounds:u,venueId:d}=c;for(let p of u){let{drawId:h,winnerFinishingPositionRange:f,roundSegment:m}=p,g=n.filter(v=>{var I;let y=(f==null?void 0:f.indexOf("-"))>0&&f.split("-").map(T=>+T),b=(I=v.finishingPositionRange)==null?void 0:I.winner;return v.drawId===h&&(!p.roundNumber||v.roundNumber===p.roundNumber)&&(!b||!y||zr(b,y).length===2||Pi(b).length===Pi(y).length&&zr(b,y).length===Pi(b).length)})[0];if(g){let{eventId:v,roundNumber:y,drawName:b,structureName:I,roundName:T}=g,w=g.structureId;y&&!f&&(w=Object.keys(i).find(E=>i[E].includes(w))??w);let S={tournamentId:r,structureId:w,roundNumber:y,roundSegment:m,eventId:v,drawId:h},D=OW({tournamentRecords:{[r]:e},round:S,scheduleDate:s,venueId:d});if(D.error)return D;a.push({structureName:I,roundName:T,drawName:b,...S})}}}}return{scheduledRounds:a}}function NO(t){var St,nt,Bt;let e=di(t,[{drawProfile:!0,_ofType:vl}]);if(e.error)return e;let{allUniqueParticipantIds:i=[],participantsProfile:n={},matchUpStatusProfile:r,completeAllMatchUps:a,autoEntryPositions:o,hydrateCollections:s,randomWinningSide:l,ratingsParameters:c,tournamentRecord:u,isMock:d=!0,drawProfile:p,startDate:h,drawIndex:f,uuids:m}=t,g=Ot(p,!1,!0),{excessParticipantAlternates:v=!0,matchUpFormat:y=Iu,drawType:b=ep,tournamentAlternates:I=0,alternatesCount:T=0,qualifyingPositions:w,qualifyingProfiles:S,generate:D=!0,eventExtensions:E,drawExtensions:C,completionGoal:P,tieFormatName:R,seedsCount:N,timeItems:M,drawName:A,category:_,idPrefix:x,publish:O,gender:B,stage:F}=g,G=g.drawSize||(g.ignoreDefaults?void 0:32),H=g.eventId||Pn(),$=p.eventType||p.matchUpType||cp,q=$===Oc?Ti:Hi,z=Xi(p.tieFormat)&&p.tieFormat||$===On&&Xv({event:{eventId:H,category:_,gender:B},namedFormat:R,hydrateCollections:s,isMock:d})||void 0,Z=(_==null?void 0:_.categoryName)||(_==null?void 0:_.ageCategoryCode)||(_==null?void 0:_.ratingType),Y=p.eventName||Z||`Generated ${$}`,Q=(u==null?void 0:u.participants)||[],X=((S==null?void 0:S.map(Pe=>Pe.structureProfiles||[]).flat().reduce((Pe,et)=>{let Ee=!et.participantsCount||et.participantsCount>et.drawSize?et.drawSize:et.participantsCount||0;return Pe+Ee},0))||0)*(q===Ti?2:1),oe=(!p.participantsCount||p.participantsCount>G?G:p.participantsCount)||0,re={eventName:Y,eventType:$,tieFormat:z,category:_,eventId:H,gender:B};Array.isArray(M)&&M.forEach(Pe=>YI({event:re,timeItem:Pe}));let{eventAttributes:me}=p;if(typeof me!="object"&&(me={}),Object.assign(re,me),(E==null?void 0:E.length)&&Array.isArray(E)){let Pe=E.filter(dp);Pe!=null&&Pe.length&&Object.assign(re,{extensions:Pe})}let se=[];if(X||p.uniqueParticipants||!u||B||_){let Pe=(oe||0)+T+X,et=Pe,Ee={[Gn]:0,[hr]:0},lt,Ke;$===On&&({teamSize:lt,genders:Ke}=kW({alternatesCount:T,tieFormatName:R,tieFormat:z,drawSize:G}),Object.keys(Ke).forEach(Ue=>{[Gn,hr].includes(Ue)&&Ke[Ue]&&(Ee[Ue]=G*Ke[Ue])}),et=lt*((G||0)+X));let bt=n!=null&&n.idPrefix?`D-${f}-${n==null?void 0:n.idPrefix}`:void 0,gt=JT({...n,scaledParticipantsCount:p.scaledParticipantsCount||n.scaledParticipantsCount,participantsCount:et,consideredDate:u==null?void 0:u.startDate,sex:B||(n==null?void 0:n.sex),rankingRange:p.rankingRange,uuids:p.uuids||m,ratingsParameters:c,participantType:q,gendersCount:Ee,idPrefix:bt,category:_}).participants;if(re.category&&(re.category.categoryName=Z),u){let Ue=Nu({participants:gt,tournamentRecord:u});if(Ue.error)return Ue}if(gt.forEach(({participantId:Ue})=>se.push(Ue)),Q=gt,$===On){let Ue=Ke[Gn]?gt.filter(({participantType:ke,person:Ut})=>ke===Hi&&(Ut==null?void 0:Ut.sex)===Gn).map(Gi):[],xe=Ke[hr]?gt.filter(({participantType:ke,person:Ut})=>ke===Hi&&(Ut==null?void 0:Ut.sex)===hr).map(Gi):[],We=gt.filter(({participantType:ke})=>ke===Hi).map(Gi).filter(ke=>!Ue.includes(ke)&&!xe.includes(ke)),st=lt-(Ke[Gn]+Ke[hr]),vt=0,ge=0,Se=0,qe=Et(0,Pe).map(ke=>{let Ut=xe.slice(vt,vt+Ke[hr]),pt=Ue.slice(ge,ge+Ke[Gn]),tt=We.slice(Se,Se+st);return vt+=Ke[hr],ge+=Ke[Gn],Se+=st,{individualParticipantIds:[...Ut,...pt,...tt],participantOtherName:`TM${ke+1}`,participantName:`Team ${ke+1}`,participantRole:Do,participantType:On,participantId:Pn()}}),$e=Nu({participants:qe,tournamentRecord:u});if(!$e.success)return $e;Q=qe}}let te=Pe=>{let{participantType:et}=Pe;return Gr(cp)($)&&et===Hi||Gr(Oc)($)&&et===Ti?!0:$===On&&et===On},he=Pe=>{var et,Ee;return!p.gender||((et=Pe.person)==null?void 0:et.sex)===p.gender?!0:(Ee=Pe.individualParticipantIds)==null?void 0:Ee.some(lt=>{let Ke=Q.find(bt=>bt.participantId===lt);return Ke&&he(Ke)})},ae=Q.filter(te).filter(he).filter(({participantId:Pe})=>!i.includes(Pe)),de=ae.slice(0,oe).map(Pe=>Pe.participantId);if(d&&(de!=null&&de.length)){let Pe=ih({autoEntryPositions:o,entryStage:F,tournamentRecord:u,participantIds:de,event:re});if(Pe.error)return Pe}let Ie=X?ae.slice(oe,oe+X).map(Pe=>Pe.participantId):0;if(d&&(Ie!=null&&Ie.length)){let Pe=0,et=1,Ee=(Ke,bt)=>Ke.stageSequence-bt.stageSequence,lt=(Ke,bt)=>Ke.roundTarget-bt.roundTarget;for(let Ke of S.sort(lt)){et=Ke.roundTarget||et;let bt=1,gt;for(let Ue of Ke.structureProfiles.sort(Ee)){let xe=(Ue.drawSize||QH(Ue.participantsCount))-(gt||0),We=Ie.slice(Pe,Pe+xe),st=ih({entryStage:Zt,entryStageSequence:bt,autoEntryPositions:o,tournamentRecord:u,participantIds:We,roundTarget:et,event:re});if(st.error)return st;gt=Ue.qualifyingPositions,Pe+=xe,bt+=1}et+=1}}let De=v&&((St=u==null?void 0:u.participants)==null?void 0:St.filter(({participantId:Pe})=>!de.includes(Pe)).filter(te).filter(he).slice(0,T||G-oe||I).map(Pe=>Pe.participantId));if(d&&(De!=null&&De.length)){let Pe=ih({participantIds:De,autoEntryPositions:!1,entryStatus:yu,tournamentRecord:u,event:re});if(Pe.error)return Pe.error}let Te=Z||Y;u&&N&&N<=de.length&&Et(1,N+1).forEach((Pe,et)=>{let Ee={scaleName:Te,scaleDate:h,scaleType:oq,scaleValue:Pe,eventType:$},lt=de[et];tP({tournamentRecord:u,participantId:lt,scaleItem:Ee})});let _e=lP({...Ot(p,!1,!0),tournamentRecord:u,seedingScaleName:Te,matchUpFormat:y,eventId:H,isMock:d,event:re});if(_e.error)return _e;if(!_e.drawDefinition)return{error:Zl};let{drawDefinition:Ve}=_e,ot=Ve.drawId;if(Array.isArray(C)&&C.filter(dp).forEach(Pe=>cn({element:Ve,extension:Pe})),D){if(cP({drawDefinition:Ve,event:re,suppressNotifications:!0}),p.withPlayoffs){let et=(nt=Ve.structures)==null?void 0:nt[0].structureId,Ee=Vx({...p.withPlayoffs,tournamentRecord:u,drawDefinition:Ve,structureId:et,idPrefix:x,isMock:d,event:re});if(Ee!=null&&Ee.error)return Ee}let Pe=p.automated===!1;if(d&&!Pe){let et=Ee=>{var bt;let lt=zA({completeAllMatchUps:Ee.completeAllMatchUps,completionGoal:Ee.completionGoal,matchUpStatusProfile:r,randomWinningSide:l,tournamentRecord:u,drawDefinition:Ve,matchUpFormat:y,event:re});if(lt.error)return lt;let Ke=lt.completedCount;if(b===mh){let gt=(bt=Ve.structures)==null?void 0:bt.find(We=>We.stage===xt);if(!gt)return{error:wr};VC({structureId:gt.structureId,tournamentRecord:u,drawDefinition:Ve,event:re});let Ue=P?P-(Ke??0):void 0,xe=zA({completionGoal:P?Ue:void 0,matchUpStatusProfile:r,completeAllMatchUps:a,randomWinningSide:l,tournamentRecord:u,drawDefinition:Ve,matchUpFormat:y,event:re});if(xe.error)return xe}};if(P&&et({completionGoal:P}),p.outcomes){let{matchUps:Ee}=ws({inContext:!0,drawDefinition:Ve,event:re});for(let lt of p.outcomes){let{matchUpStatus:Ke=jr,matchUpStatusCodes:bt,stageSequence:gt=1,matchUpIndex:Ue=0,structureOrder:xe,matchUpFormat:We,drawPositions:st,roundPosition:vt,stage:ge=xt,roundNumber:Se,winningSide:qe,scoreString:$e}=lt,ke=(Ee==null?void 0:Ee.reduce((At,ei)=>{let{structureId:vi,matchUpId:Ln}=ei;return At[vi]?At[vi].push(Ln):At[vi]=[Ln],At},{}))??[],Ut=Object.assign({},...Object.keys(ke).map((At,ei)=>({[At]:ei+1}))),pt=(Bt=Ee==null?void 0:Ee.filter(At=>(!ge||At.stage===ge)&&(!gt||At.stageSequence===gt)&&(!Se||At.roundNumber===Se)&&(!vt||At.roundPosition===vt)&&(!xe||Ut[At.structureId]===xe)&&(!st||zr(st,At.drawPositions).length===2)))==null?void 0:Bt[Ue],tt=ude({matchUpStatusCodes:bt,tournamentRecord:u,drawDefinition:Ve,targetMatchUp:pt,matchUpFormat:We,matchUpStatus:Ke,scoreString:$e,winningSide:qe});if(tt!=null&&tt.error)return tt}}a&&et({completeAllMatchUps:a})}O&&KT({tournamentRecord:u,event:re})}else{let Pe=vO({drawEntries:Ve.entries,drawName:A||b,qualifyingPositions:w,drawId:ot,event:re,stage:F});if(Pe.error)return Pe}return{...ce,event:zt(re),uniqueParticipantIds:se,targetParticipants:Q,drawDefinition:Ve,eventId:H,drawId:ot}}var mde=()=>({altitude:void 0,courtId:void 0,courtName:"",courtDimensions:void 0,latitude:void 0,longitude:void 0,surfaceCategory:void 0,surfaceType:void 0,surfacedDate:void 0,dateAvailability:[],onlineResources:[],pace:void 0,notes:void 0}),DLe=mde;function qA(t){return parseInt(t)}function _Y({startTime:t="",endTime:e=""}={}){if(!t||!e||!wv.test(t)||!wv.test(e))return!1;let[i,n]=t.split(":").map(qA),[r,a]=e.split(":").map(qA);return r<i?!1:!(i===r&&a<n)}function ELe(t,e){let[i,n]=t.startTime.split(":").map(qA),[r,a]=e.startTime.split(":").map(qA);return i<r?-1:i>r?1:n<a?-1:n>a?1:0}function gde({dateAvailability:t}){if(!t)return{error:Ene};if(!Array.isArray(t))return{error:mN};let e="Dates must be formated => YYYY-MM-DD",i="Times must be 24 hour => 00:00";for(let n of t){if(typeof n!="object")return{error:mN};let{date:r,startTime:a,endTime:o,bookings:s=[]}=n;if(!a||!o)return{error:mN};if(r&&!up.test(r))return{error:Xa,dateAvailability:{date:r},info:e};if(!wv.test(a))return{error:su,dateAvailability:{startTime:a},info:i};if(!wv.test(o))return{error:su,dateAvailability:{endTime:o},info:i};if(a===o)return{error:su,dateAvailability:{startTime:a,endTime:o},info:"startTime and endTime are equivalent"};if(!_Y({startTime:a,endTime:o}))return{error:su,dateAvailability:{startTime:a,endTime:o},info:"endTime must be after startTime"};if(s){if(!Array.isArray(s))return{error:fA};for(let l of s){if(typeof l!="object")return{error:fA};let{startTime:c,endTime:u}=l;if(!wv.test(c))return{error:su,booking:{startTime:c},info:i};if(!wv.test(u))return{error:su,booking:{endTime:u},info:i};if(c===u)return{error:su,dateAvailability:{startTime:c,endTime:u},info:"startTime and endTime are equivalent"};if(!_Y({startTime:c,endTime:u}))return{error:su,dateAvailability:{startTime:c,endTime:u},info:"endTime must be after startTime"}}}}return{valid:!0}}function AO({tournamentRecord:t,disableNotice:e,venueId:i,courtId:n,court:r}){let{venue:a}=kh({tournamentRecord:t,venueId:i});if(!a)return{error:AI};a.courts||(a.courts=[]);let o={...mde(),venueId:i,courtId:n};if(o.courtId||(o.courtId=Pn()),a.courts.some(s=>s.courtId===o.courtId))return{error:Gne};{let s=((r==null?void 0:r.dateAvailability)||[]).map(u=>{var d;return{...u,date:Ei(u.date),startTime:ir(u.startTime),endTime:ir(u.endTime),bookings:(d=u.bookings)==null?void 0:d.map(({startTime:p,endTime:h,bookingType:f})=>({startTime:ir(p),endTime:ir(h),bookingType:f}))}}),l=Object.keys(o);for(let u of l)if(r!=null&&r[u])if(u==="dateAvailability"){let d=gde({dateAvailability:s});if(!d.valid&&d.error)return d;o.dateAvailability=s}else o[u]=r[u];let c=o;return a.courts.push(c),e||wi({payload:{venue:a,tournamentId:t.tournamentId},topic:Sy,key:a.venueId}),{...ce,court:Ot(o),venueId:i}}}function LW(t){let{tournamentRecord:e,venueId:i}=t;if(typeof i!="string"||!i)return{error:wg};let n=t.tournamentRecords??(e&&{[e.tournamentId]:e})??{},r=[],a;for(let o of Object.values(n)){let{venue:s}=kh({tournamentRecord:o,venueId:i});if(s){let l=CLe({...t,tournamentRecord:o});for(let c of(l==null?void 0:l.courts)??[])r.push(c==null?void 0:c.courtId);if(l.error)return l;a=!0}}return a?{...ce,courtIds:r}:{error:AI}}function CLe({courtNameRoot:t="Court",dateAvailability:e=[],venueAbbreviationRoot:i,tournamentRecord:n,courtNames:r=[],courtTimings:a,courtsCount:o,startTime:s,courtIds:l,endTime:c,idPrefix:u,venueId:d,dates:p}){if(!d)return{error:wg};let h=kh({tournamentRecord:n,venueId:d});if(h.error)return h;let{venue:f}=h;if(!Rr(o)||!r)return{error:jne};o=o??r.length;let m=Et(0,o).map(g=>{let v=a==null?void 0:a[g],y=v?p.map(b=>({date:dd(b),startTime:s,endTime:c,...v})):e;return v&&s&&c&&y.push({startTime:s,endTime:c}),{courtName:r[g]||i&&(f==null?void 0:f.venueAbbreviation)&&`${f==null?void 0:f.venueAbbreviation} ${g+1}`||`${t} ${g+1}`,dateAvailability:y}}).map((g,v)=>{let y=(l==null?void 0:l.pop())||u&&`${u}-${v+1}`;return AO({disableNotice:!0,tournamentRecord:n,courtId:y,venueId:d,court:g})}).map(g=>g.court).filter(Boolean);return m.length!==o?pe({info:"not all courts could be generated",result:{error:Re}}):(f&&wi({payload:{venue:f,tournamentId:n.tournamentId},topic:Sy,key:f.venueId}),{...ce,courts:Ot(m)})}function FW({tournamentRecord:t,ignoreExistingVenues:e,venueProfiles:i,uuids:n}){let{startDate:r,endDate:a}=t,o=[];for(let[s,l]of i.entries()){let{venueAbbreviation:c,venueId:u=(n==null?void 0:n.pop())??Pn(),dateAvailability:d,startTime:p="07:00",endTime:h="19:00",courtTimings:f,courtsCount:m,courtNames:g,venueName:v,idPrefix:y,courtIds:b}=l,I={venueName:v||`Venue ${s+1}`,venueAbbreviation:c,venueId:u},T=PC({tournamentRecord:t,venue:I});if(T.error){if(e)continue;return T}o.push(u);let w=lS(r,a),S=!Array.isArray(d)&&[{startTime:p,endTime:h}].concat(w.map(D=>({date:dd(D),startTime:p,endTime:h})));if(m||g){let D=LW({dateAvailability:d||S,tournamentRecord:t,courtTimings:f,courtsCount:m,courtNames:g,startTime:p,idPrefix:y,courtIds:b,endTime:h,venueId:u,dates:w});if(D.error)return D}}return o}function PLe(t){var u,d,p;let{tournamentRecord:e,leagueProfiles:i,eventIds:n,venueIds:r,drawIds:a,allUniqueParticipantIds:o,uuids:s}=t,l=0;for(let h of i){let f=[],{tieFormatName:m=$A,teamProfiles:g=[],teamsCount:v=0,category:y,idPrefix:b,gender:I}=h,T=h.leagueName??h.eventName??`League ${l+1}`,w=h.leagueId??h.eventId??(s==null?void 0:s.pop())??Pn();n.push(w);let S=Xi(h.tieFormat)&&h.tieFormat||Xv({event:{eventId:w,category:y,gender:I},namedFormat:m,isMock:t.isMock})||void 0;if(!S)return{error:IT};let D=Math.max(v,g.length),E=Et(0,D),{genders:C,teamSize:P}=kW({tieFormat:S,drawSize:D}),R={[hr]:0,[nl]:0,[Sv]:0,[Gn]:0,[Id]:0};Object.keys(C).forEach(M=>R[M]+=C[M]);for(let M of E){let A=((u=g==null?void 0:g[M])==null?void 0:u.teamName)??`Team ${M+1}`,_=((d=g==null?void 0:g[M])==null?void 0:d.teamId)||(s==null?void 0:s.pop())||Pn(),x=h.startDate??t.startDate,O=JT({...h==null?void 0:h.participantsProfile,participantsCount:P,consideredDate:x,gendersCount:R,category:y,gender:I,uuids:s}).participants,B=O.map(z=>z.participantId),F=On,G=_??HA({participantType:F,idPrefix:b,index:M,uuids:s});f.push({participantId:G,entryStatus:Rl,entryStage:xt});let H=((p=g==null?void 0:g[M])==null?void 0:p.venueIds)??[],$={participantId:G,participantRole:Do,participantName:A,individualParticipantIds:B,participantType:F,homeVenueIds:H};H.forEach(z=>!r.includes(z)&&r.push(z)),o.push(...B),o.push(G);let q=Nu({participants:[$,...O],tournamentRecord:e});if(q.error)return q}let N={eventName:T,entries:f,eventType:On,tieFormat:S,category:y,eventId:w,gender:I};if(e.events||(e.events=[]),e.events.push(N),f.length){let M=Rr(h.roundsCount)?h.roundsCount:h.roundsCount===lRe?(D-1)*2:D-1,A=lP({automated:h.automated,tournamentRecord:e,drawType:Fc,roundsCount:M,drawSize:D,event:N});if(A.error)return A;let{drawDefinition:_}=A;if(_){let x=_==null?void 0:_.drawId;cP({drawDefinition:_,event:N,suppressNotifications:!0}),a.push(x)}}l++}let c=r.map(h=>({venueId:h}));FW({tournamentRecord:e,ignoreExistingVenues:!0,venueProfiles:c,uuids:s})}var RLe=["Generated Tournament","CourtHive Challenge","Replication Crisis","Open Competition","Factory Follies","Mock Tournament","Atomic Culture","Racket Rally","Stats Fail"];function vde(t){var y,b,I;let{startDate:e,endDate:i}=t??{},{tournamentName:n=Sl(RLe),ratingsParameters:r=La,tournamentExtensions:a,policyDefinitions:o,schedulingProfile:s,venueProfiles:l,uuids:c}=t??{},u=(t==null?void 0:t.isMock)===!1?void 0:!0;if(e&&!Dl(e)||i&&!Dl(i))return{error:Xa};if(t.leagueProfiles&&!Array.isArray(t.leagueProfiles)||t.eventProfiles&&!Array.isArray(t.eventProfiles)||t.drawProfiles&&!Array.isArray(t.drawProfiles))return{error:Re};if(!e){let T=new Date;e=dd(i??T),i=dd(T.setDate(T.getDate()+7))}if(!i){let T=new Date(e);i=dd(T.setDate(T.getDate()+7))}let d=MO({...t.tournamentAttributes??{},tournamentName:n,startDate:e,endDate:i,isMock:u}),p=l!=null&&l.length?FW({tournamentRecord:d,venueProfiles:l,uuids:c}):[];if(a!=null&&a.length&&Array.isArray(a)){let T=a.filter(w=>dp({extension:w}));T!=null&&T.length&&Object.assign(d,{extensions:T,isMock:u})}if(typeof o=="object")for(let T of Object.keys(o))Kv({policyDefinitions:{[T]:o[T]},tournamentRecord:d});if(!((y=t==null?void 0:t.leagueProfiles)!=null&&y.length)||(b=t.eventProfiles)!=null&&b.length||(I=t.drawProfiles)!=null&&I.length||t.participantsProfile){let T=sde({tournamentRecord:d,...t});if(!T.success)return T}let h=[],f=[],m=[];if(t.leagueProfiles){let T=PLe({allUniqueParticipantIds:h,tournamentRecord:d,...t,eventIds:f,venueIds:p,drawIds:m});if(T!=null&&T.error)return T}if(t.drawProfiles){let T=MLe({allUniqueParticipantIds:h,ratingsParameters:r,tournamentRecord:d,...t,eventIds:f,drawIds:m});if(T!=null&&T.error)return T}if(t.eventProfiles){let T=NLe({allUniqueParticipantIds:h,ratingsParameters:r,tournamentRecord:d,...t,eventIds:f,drawIds:m});if(T!=null&&T.error)return T}let{scheduledRounds:g=void 0,schedulerResult:v={}}=s?ALe({...t,tournamentRecord:d}):{};return iz(),zt({...ce,tournamentRecord:d,scheduledRounds:g,schedulerResult:v,eventIds:f,venueIds:p,drawIds:m})}function MLe(t){let{tournamentRecord:e,drawProfiles:i,allUniqueParticipantIds:n,eventIds:r,drawIds:a}=t,o=0;for(let s of i){let l=NO({allUniqueParticipantIds:n,tournamentRecord:e,drawProfile:s,drawIndex:o,...t});if(l.error)return l;let{drawId:c,eventId:u,event:d,uniqueParticipantIds:p}=l;if(l=uP({suppressNotifications:!1,internalUse:!0,tournamentRecord:e,event:d}),l.error)return l;c&&a.push(c),r.push(u),p!=null&&p.length&&n.push(...p),o+=1}}function NLe(t){let{eventProfiles:e,allUniqueParticipantIds:i,eventIds:n,drawIds:r}=t,a=0;for(let o of e){let s=fde({...t,eventIndex:a,eventProfile:o});if(s.error)return s;let{eventId:l,drawIds:c,uniqueParticipantIds:u}=s;c&&r.push(...c),n.push(l),u!=null&&u.length&&i.push(...u),a+=1}}function ALe(t){let{schedulingProfile:e,tournamentRecord:i,autoSchedule:n,periodLength:r,scheduleCompletedMatchUps:a}=t,o=ULe({schedulingProfile:e,tournamentRecord:i});if(o.error)return o;let s=o.scheduledRounds;if(n){let{tournamentId:l}=i,c={[l]:i};return{schedulerResult:RO({scheduleCompletedMatchUps:a,tournamentRecords:c,periodLength:r}),scheduledRounds:s}}return{scheduledRounds:s}}var yde={};$i(yde,{anonymizeTournamentRecord:()=>bde,modifyTournamentRecord:()=>Ide});function bde({keepExtensions:t=[],anonymizeParticipantNames:e=!0,tournamentRecord:i,tournamentName:n,personIds:r=[],tournamentId:a}){var O,B,F,G,H;if(!i)return{error:ut};let o=Array.isArray(t)?VK.concat(...t):VK,s=$=>{var q;return Array.isArray(t)?(q=$==null?void 0:$.extensions)==null?void 0:q.filter(z=>o.includes(z.name)):$==null?void 0:$.extensions},l={};i.extensions=s(i);let c=a||Pn();l[i.tournamentId]=c,i.tournamentId=c,i.createdAt=new Date().toISOString(),i.tournamentName=n||`Anonymized: ${dd(new Date)}`,i.isMock=!0,delete i.parentOrganisation;for(let $ of i.participants||[]){let q=Pn();l[$.participantId]=q,$.participantId=q}for(let $ of i.participants||[])Array.isArray($.individualParticipantIds)&&($.individualParticipantIds=$.individualParticipantIds.map(q=>l[q]));let u=0;for(let $ of i.venues||[]){$.extensions=s($),$.venueName=`Venue #${u}`,$.venueAbbreviation=`V${u}`;let q=Pn();l[$.venueId]=q,$.isMock=!0,u+=1}let d=1;for(let $ of i.events||[]){$.extensions=s($),$.isMock=!0;let q=Pn();l[$.eventId]=q,$.eventId=q;let z=((O=$.category)==null?void 0:O.categoryName)||((B=$.category)==null?void 0:B.ageCategoryCode)||((F=$.category)==null?void 0:F.ratingType)||$.gender;if($.eventName=`Event ${d} ${z}`,Array.isArray($.entries))for(let Y of $.entries)Y.participantId=l[Y.participantId];for(let Y of $.drawDefinitions||[]){Y.extensions=s(Y);let Q=Pn();if(l[Y.drawId]=Q,Y.drawId=Q,Y.isMock=!0,Array.isArray(Y.entries))for(let oe of Y.entries)oe.participantId=l[oe.participantId];let X=oe=>{oe.extensions=s(oe);let re=Pn();l[oe.structureId]=re,oe.structureId=re;for(let me of oe.positionAssignments||[])me.participantId&&(me.participantId=l[me.participantId]);for(let me of oe.seedAssignments||[])me.participantId&&(me.participantId=l[me.participantId]);for(let me of oe.matchUps||[]){me.isMock=!0;for(let se of me.sides||[])se.lineUp&&(se.lineUp=se.lineUp.map(({participantId:te,collectionAssignments:he})=>({participantId:l[te],collectionAssignments:he})))}};for(let oe of Y.structures||[])if(X(oe),Array.isArray(oe.structures))for(let re of oe.structures)X(re);for(let oe of Y.links||[])oe.source.structureId=l[oe.source.structureId],oe.target.structureId=l[oe.target.structureId]}let{extension:Z}=Ri({name:Pu,element:$});Array.isArray((G=Z==null?void 0:Z.value)==null?void 0:G.flights)&&((H=Z==null?void 0:Z.value.flights)==null||H.forEach(Y=>{if(Y.drawId=l[Y.drawId],Array.isArray(Y.drawEntries))for(let Q of Y.drawEntries)Q.participantId=l[Q.participantId]})),d+=1}let p=i.startDate||dd(new Date),h=(i.participants||[]).filter(({participantType:$})=>$===Hi),f=h.reduce(($,q)=>{var Z;let z=(Z=q.person)==null?void 0:Z.sex;return[Gn,hr].includes(z)?$[z]+=1:$[Sv]+=1,$},{[Gn]:0,[hr]:0,[Sv]:0}),m=Object.assign({},...Object.keys(f).map($=>{var q;return{[$]:((q=ode({category:{ageCategoryCode:"O18"},count:f[$],addressProps:{citiesCount:10},personExtensions:[],consideredDate:p,sex:$}))==null?void 0:q.persons)||[]}})),g={[Gn]:0,[hr]:0,[Sv]:0},v=h.length,y=h.reduce(($,q)=>{var X,oe;let z=((oe=(X=q.person)==null?void 0:X.addresses)==null?void 0:oe[0])||{},{city:Z,state:Y,postalCode:Q}=z;return $.cities.includes(Z)||$.cities.push(Z),$.states.includes(Y)||$.states.push(Y),$.postalCodes.includes(Q)||$.postalCodes.push(Q),$},{cities:[],postalCodes:[],states:[]}),b=y.postalCodes.length,I=y.cities.length,T=y.states.length,{cities:w}=ide({count:I||v,participantsCount:v}),{states:S}=nde({count:T||v,participantsCount:v}),{postalCodes:D}=rde({count:b||v,participantsCount:v}),E={cities:w,states:S,postalCodes:D};h.forEach(($,q)=>{var oe,re;let z=$==null?void 0:$.person,Z=(z==null?void 0:z.sex)||Sv,Y=(oe=Ei(z==null?void 0:z.birthDate))==null?void 0:oe.split("-")[0],Q=g[Z],X=m[Z][Q];if(g[Z]+=1,Y){let[,me,se]=((re=X==null?void 0:X.birthDate)==null?void 0:re.split("-"))||[],te=[Y,me,se].join("-");X.birthDate=te}if(z!=null&&z.addresses){let me=ade({...E,participantIndex:q,nationalityCode:X.nationalityCode});X.addresses=[me]}X.personId=(r==null?void 0:r[q])||Pn(),e?(X.standardFamilyName=X.lastName,X.standardGivenName=X.firstName,$.participantName=`${X.standardGivenName} ${X.standardFamilyName}`):(X.standardFamilyName=z==null?void 0:z.standardFamilyName,X.standardGivenName=z==null?void 0:z.standardGivenName),delete X.firstName,delete X.lastName,X.extensions=s(z),$.person=X,l[z==null?void 0:z.personId]=X.personId}),(i.participants||[]).filter(({participantType:$})=>$===Ti).forEach($=>{let{individualParticipantIds:q}=$;$.participantName=_Le({individualParticipantIds:q,individualParticipants:h})});let C=(i.participants||[]).filter(({participantType:$})=>$===On),P=C.length,R=DV({count:P}).names;C.forEach(($,q)=>{$.participantName=R[q]});let N=(i.participants||[]).filter(({participantType:$})=>$===ac),M=N.length,A=DV({count:M,nameRoot:"Group"}).names;N.forEach(($,q)=>{$.participantName=A[q]});let{extension:_}=Ri({element:i,name:Zb});Array.isArray(_==null?void 0:_.value)&&(_==null||_.value.forEach($=>{$.tournamentId=l[$.tournamentId],$.structureId=l[$.structureId],$.eventId=l[$.eventId],$.drawId=l[$.drawId]}));let{extension:x}=Ri({element:i,name:AT});return Array.isArray(x==null?void 0:x.value)&&(x==null||x.value.forEach($=>{$.personId=l[$.personId]})),{...ce}}function _Le({individualParticipantIds:t,individualParticipants:e}){let i=e.filter(({participantId:n})=>t.includes(n)).map(({person:n})=>n==null?void 0:n.standardFamilyName).filter(Boolean).sort().join("/");return t.length===1&&(i+="/Unknown"),i}function Ide(t){var E,C,P;let{ratingsParameters:e=La,participantsProfile:i={},matchUpStatusProfile:n,completeAllMatchUps:r,autoEntryPositions:a,hydrateCollections:o,randomWinningSide:s,schedulingProfile:l,tournamentRecord:c,autoSchedule:u,eventProfiles:d,periodLength:p,venueProfiles:h,drawProfiles:f,isMock:m,uuids:g}=t;if(!c)return{error:ut};let v=[],y=[],b=[];d==null||d.forEach(R=>{var M;let N=(M=c.events)==null?void 0:M.find((A,_)=>R.eventIndex!==void 0&&_===R.eventIndex||R.eventName&&A.eventName===R.eventName||R.eventId&&A.eventId===R.eventId);N!=null&&N.gender&&(R.gender=N.gender)});let I=((E=c.participants)==null?void 0:E.length)||void 0;I&&(i!=null&&i.idPrefix)&&(i.idPrefix=`${i.idPrefix}-${I}`);let T=sde({startDate:c.startDate,participantsProfile:i,tournamentRecord:c,eventProfiles:d,drawProfiles:f,uuids:g});if(!T.success)return T;if(d){let R=((C=c.events)==null?void 0:C.length)||0;for(let N of d){let{ratingsParameters:M}=N,A=(P=c.events)==null?void 0:P.find((_,x)=>N.eventIndex!==void 0&&x===N.eventIndex||N.eventName&&_.eventName===N.eventName||N.eventId&&_.eventId===N.eventId);if(A){let{gender:_,category:x,eventType:O}=A,{drawProfiles:B,publish:F}=N,G=Gr(cp)(O)&&Hi||Gr(Oc)(O)&&Ti||O;if(B){let{stageParticipantsCount:H,uniqueParticipantsCount:$,uniqueParticipantStages:q}=lde({drawProfiles:B,category:x,gender:_}),{uniqueDrawParticipants:z=[],uniqueParticipantIds:Z=[]}=q?pde({event:{eventType:O,category:x,gender:_},uniqueParticipantsCount:$,participantsProfile:i,ratingsParameters:M,tournamentRecord:c,eventProfile:N,uuids:g}):{};v.push(...Z);let{stageParticipants:Y}=cde({targetParticipants:c.participants||[],allUniqueParticipantIds:v,stageParticipantsCount:H,eventParticipantType:G}),Q=hde({uniqueDrawParticipants:z,autoEntryPositions:a,stageParticipants:Y,tournamentRecord:c,drawProfiles:B,category:x,gender:_,event:A});if(Q.error||(Q=dde({matchUpStatusProfile:n,completeAllMatchUps:r,randomWinningSide:s,tournamentRecord:c,drawProfiles:B,isMock:m,event:A}),Q.error))return Q;b.push(...Q.drawIds)}F&&KT({tournamentRecord:c,event:A})}else{let _=fde({startDate:c.startDate,allUniqueParticipantIds:v,matchUpStatusProfile:n,participantsProfile:i,completeAllMatchUps:r,autoEntryPositions:a,randomWinningSide:s,ratingsParameters:M,tournamentRecord:c,eventProfile:N,eventIndex:R,uuids:g});if(_.error)return _;let{eventId:x,drawIds:O,uniqueParticipantIds:B}=_;O&&b.push(...O),y.push(x),B!=null&&B.length&&v.push(...B),R+=1}}}if(f){let R=(c.events||[]).map(N=>{var M;return((M=N.drawDefinitions)==null?void 0:M.map(()=>1))||[]}).flat().reduce((N,M)=>N+M,0);for(let N of f){let M=NO({startDate:c.startDate,allUniqueParticipantIds:v,matchUpStatusProfile:n,participantsProfile:i,completeAllMatchUps:r,autoEntryPositions:a,hydrateCollections:o,randomWinningSide:s,ratingsParameters:e,tournamentRecord:c,drawProfile:N,drawIndex:R,uuids:g});if(M.error)return M;let{drawId:A,eventId:_,event:x,uniqueParticipantIds:O}=M;if(M=uP({tournamentRecord:c,event:x,internalUse:!0}),M.error)return M;A&&b.push(A),y.push(_),O!=null&&O.length&&v.push(...O),R+=1}}let w=h!=null&&h.length?FW({tournamentRecord:c,venueProfiles:h}):[],S,D={};if(l!=null&&l.length){let R={[c.tournamentId]:c},N=zT({tournamentRecords:R,schedulingProfile:l});if(N.error)return N;if(u){let{tournamentId:M}=c,A={[M]:c};D=RO({tournamentRecords:A,periodLength:p})}}return{totalParticipantsCount:c.participants.length,scheduledRounds:S,schedulerResult:D,...ce,eventIds:y,venueIds:w,drawIds:b}}var BW={};$i(BW,{addDynamicRatings:()=>s3,addIndividualParticipantIds:()=>wO,addParticipant:()=>mp,addParticipants:()=>Nu,addPenalty:()=>Vde,addPersonRequests:()=>Ede,addPersons:()=>jde,createGroupParticipant:()=>Ade,createTeamsFromParticipantAttributes:()=>_W,deleteParticipants:()=>zI,filterParticipants:()=>xC,findParticipant:()=>Nde,getCompetitionParticipants:()=>S3,getPairedParticipant:()=>Mu,getParticipantEventDetails:()=>T3,getParticipantMembership:()=>U3,getParticipantScaleItem:()=>gS,getParticipantSchedules:()=>D3,getParticipantSignInStatus:()=>E3,getParticipantTimeItem:()=>eq,getParticipants:()=>Nr,getScaleValues:()=>RT,mergeParticipants:()=>$de,modifyIndividualParticipantIds:()=>Cde,modifyParticipant:()=>SO,modifyParticipantName:()=>_de,modifyParticipantOtherName:()=>Rde,modifyParticipantsSignInStatus:()=>Pde,modifyPenalty:()=>Fde,modifyPersonRequests:()=>Ude,mutate:()=>wde,participantScaleItem:()=>th,query:()=>Nce,regenerateParticipantNames:()=>Mde,removeIndividualParticipantIds:()=>yq,removeParticipantIdsFromAllTeams:()=>Rx,removePenalty:()=>Ode,removePersonRequests:()=>Dde,removeRatings:()=>xde,scaledTeamAssignment:()=>kde,setParticipantScaleItem:()=>tP,setParticipantScaleItems:()=>qse,validateLineUp:()=>Nx});var wde={};$i(wde,{addDynamicRatings:()=>s3,addIndividualParticipantIds:()=>wO,addParticipant:()=>mp,addParticipants:()=>Nu,addPenalty:()=>Vde,addPersonRequests:()=>Ede,addPersons:()=>jde,createGroupParticipant:()=>Ade,createTeamsFromParticipantAttributes:()=>_W,deleteParticipants:()=>zI,findParticipant:()=>Nde,mergeParticipants:()=>$de,modifyIndividualParticipantIds:()=>Cde,modifyParticipant:()=>SO,modifyParticipantName:()=>_de,modifyParticipantOtherName:()=>Rde,modifyParticipantsSignInStatus:()=>Pde,modifyPenalty:()=>Fde,modifyPersonRequests:()=>Ude,regenerateParticipantNames:()=>Mde,removeIndividualParticipantIds:()=>yq,removeParticipantIdsFromAllTeams:()=>Rx,removePenalty:()=>Ode,removePersonRequests:()=>Dde,removeRatings:()=>xde,scaledTeamAssignment:()=>kde,setParticipantScaleItem:()=>tP,setParticipantScaleItems:()=>qse});function Sde(t=0){(typeof t!="number"||isNaN(t))&&(t=0);let e=new Date;return e.setHours(e.getHours()+t),e.getTime().toString(36).slice(-6).toUpperCase()}function Tde({personRequests:t,personId:e,requests:i}){t[e]||(t[e]=[]);let n=i.filter(({requestType:r})=>r).map(r=>{let{date:a,startTime:o,endTime:s}=r;return r.requestType===mP&&(a=Ei(a),o=ir(o),s=ir(s),a&&o&&s)?{date:a,startTime:o,endTime:s,requestType:r.requestType}:r}).filter(Boolean);for(let r of n)r.requestId=Sde(),t[e].push(r);return{mergeCount:n.length}}function $W(t){let{tournamentRecords:e,personRequests:i}=t,n=di(t,[{[zo]:!0}]);if(n.error)return n;if(!i)return{...ce};let r=Object.values(e);for(let a of r){let o=a.participants??[],s=[];for(let l of Object.keys(i))if(zm({tournamentParticipants:o,personId:l})){let c=i[l];c.length&&s.push({personId:l,requests:c})}Object.keys(s).length&&cn({element:a,extension:{value:s,name:AT}})}return{...ce}}function Ude(t){let{tournamentRecords:e,requests:i,personId:n}=t,r=di(t,[{[zo]:!0},{requests:!0,[$l]:gs,[Ql]:Re}]);if(r.error)return r;let a=i.map(({requestId:c})=>c).filter(Boolean),{personRequests:o}=Ry({tournamentRecords:e}),s=c=>{o&&(o[c]=o[c].map(u=>{if(!a.includes(u.requestId))return u;let d=i.find(p=>p.requestId===u.requestId);if(d.requestType)return Object.assign(u,d)}).filter(Boolean))};if(n&&(o!=null&&o[n]))s(n);else if(o)for(let c of Object.keys(o))s(c);let l=i.filter(c=>!c.requestId);return l.length&&Tde({personRequests:o,personId:n,requests:l}),$W({tournamentRecords:e,personRequests:o})}function Dde(t){let{tournamentRecords:e,requestType:i,requestId:n,personId:r,date:a}=t,o=di(t,[{[zo]:!0}]);if(o.error)return o;let{personRequests:s}=Ry({tournamentRecords:e}),l=u=>{var d;s&&(s[u]=s[u].filter(p=>(!i||p.requestType!==i)&&(!n||p.requestId!==n)&&(!a||p.date!==a)),(d=s==null?void 0:s[u])!=null&&d.length||delete s[u])},c=!i&&!n&&!r&&!a;if(!c){if(r&&(s!=null&&s[r]))l(r);else if(s)for(let u of Object.keys(s))l(u)}return c||!s||!Object.keys(s).length?Is({name:AT,tournamentRecords:e,discover:!0}):$W({tournamentRecords:e,personRequests:s})}function Ede(t){let{tournamentRecords:e,personId:i,requests:n}=t,r=di(t,[{[zo]:!0,[mRe]:!0},{requests:!0,[$l]:gs,[Ql]:Re}]);if(r.error)return r;let{personRequests:a}=Ry({tournamentRecords:e}),{mergeCount:o}=Tde({personRequests:a,personId:i,requests:n});return o&&a?$W({tournamentRecords:e,personRequests:a}):{error:Re}}function Cde({individualParticipantIds:t,groupingParticipantId:e,tournamentRecord:i}){let n="modifyIndividualParticipantIds";if(!i)return pe({result:{error:ut},stack:n});if(!e||!t)return pe({result:{error:Yt},stack:n});let r=i.participants||[],a=r.find(h=>h.participantId===e);if(!a)return pe({result:{error:Vr},stack:n});if(![On,ac].includes(a.participantType))return pe({result:{error:yd},context:{participantType:a.participantType},stack:n});let o=t.filter(h=>{var f;return((f=r.find(m=>m.participantId===h))==null?void 0:f.participantType)!==Hi});if(o.length)return pe({result:{error:Ul,invalidParticipantIds:o},stack:n});let s=a.individualParticipantIds||[],l=t.filter(h=>!s.includes(h)),c=s.filter(h=>!t.includes(h)),u=wO({individualParticipantIds:l,groupingParticipantId:e,tournamentRecord:i});if(u.error)return pe({result:u,stack:n});let d=yq({individualParticipantIds:c,groupingParticipantId:e,tournamentRecord:i});if(d.error)return pe({result:d,stack:n});let{topics:p}=rc();if(p.includes(Ro)){let h=r.find(({participantId:f})=>f===e);wi({topic:Ro,payload:{tournamentId:i.tournamentId,participants:[h]}})}return{...u,...d}}function Pde({tournamentRecord:t,participantIds:e,signInState:i}){if(!t)return{error:ut};if(!Array.isArray(e))return{error:Yt};if(![OD,fae].includes(i))return{error:Re,signInState:i};let n=t.participants||[];if(!n.length)return{error:rC};let r=n.map(Gi),a=e.filter(c=>!r.includes(c));if(a.length)return{error:Re,context:{invalidParticipantIds:a}};let o=[],s=new Date().toISOString();for(let c of n){let{participantId:u}=c;if(e.includes(u)){let d=Kq({duplicateValues:!1,tournamentRecord:t,participantId:u,timeItem:{itemType:gC,itemValue:i,createdAt:s}});if(d.error)return d;o.push(c)}}let{topics:l}=rc();return o.length&&l.includes(Ro)&&wi({topic:Ro,payload:{tournamentId:t.tournamentId,participants:o}}),{...ce}}function Rde({tournamentRecord:t,participantId:e,participantOtherName:i}){if(!t)return{error:ut};if(!e)return{error:ya};let{participant:n}=Eg({tournamentRecord:t,participantId:e});if(!n)return{error:Vr};n.participantOtherName=i;let{topics:r}=rc();return r.includes(Ro)&&wi({topic:Ro,payload:{tournamentId:t.tournamentId,participants:[n]}}),{...ce}}function kY({personFormat:t,person:e}){let i=m=>m.replace(/\W/g,""),n=m=>/^[a-z]*$/.test(i(m)),r=m=>/^[A-Z]*$/.test(i(m)),a=m=>/^[LAST]{4}/.test(i(m)),o=m=>m.toLowerCase().indexOf("l")<m.toLowerCase().indexOf("f"),s=m=>m.indexOf(",")>=0,l=m=>m.toLowerCase().indexOf("f.")>=0,c=m=>m.toLowerCase().indexOf("f")<0,u=m=>m.indexOf(" ")>0;if(!e)return;let d=u(t)?" ":"",p=Q2((e==null?void 0:e.standardGivenName)??""),h=Q2((e==null?void 0:e.standardFamilyName)??"");if(!t)return`${p}${d}${h}`;l(t)&&!s(t)&&!o(t)&&(p=`${p[0]}.`),n(t)?(p=p.toLowerCase(),h=h.toLowerCase()):r(t)?(p=p.toUpperCase(),h=h.toUpperCase()):a(t)&&(h=h.toUpperCase());let f=`${p}${d}${h}`;return c(t)?f=h:o(t)&&(s(t)?f=`${h},${d}${p}`:f=`${h}${d}${p}`),f}function kLe({participantMap:t,participant:e,formats:i}){let{participantType:n,individualParticipantIds:r,person:a}=e,o=n&&i[n];if(n!==Nc&&o){let{personFormat:s,doublesJoiner:l}=o;n===Hi&&(e.participantName=kY({person:a,personFormat:s})),n===Ti&&(e.participantName=r==null?void 0:r.map(c=>{var d;let u=(d=t[c])==null?void 0:d.person;return kY({person:u,personFormat:s})}).filter(Boolean).join(l??"/"))}}function Mde({tournamentRecord:t,formats:e}){if(!t)return{error:ut};if(!Xi(e))return{error:Yt};let i=t.participants??[],n=Zie(i,"participantId");for(let r of i)kLe({participant:r,participantMap:n,formats:e});return{...ce}}function Nde(t){let{tournamentRecord:e,policyDefinitions:i,contextProfile:n,participantId:r,personId:a}=t,o=t.tournamentRecords||e&&{[e.tournamentId]:e}||{};if(typeof r!="string"&&typeof a!="string")return{error:Yt,stack:"publicFindParticipant"};let s,l;for(let c of Object.values(o)){l=c.tournamentId;let u=c.participants||[];if(s=zm({tournamentParticipants:u,internalUse:!0,policyDefinitions:i,contextProfile:n,participantId:r,personId:a}),s)break}return{participant:s,tournamentId:l,...ce}}function Ade({individualParticipantIds:t=[],participantRoleResponsibilities:e,participantRole:i=uoe,tournamentRecord:n,participantId:r,groupName:a}){if(!n)return{error:ut};if(!a)return{error:Yt,info:"Missing groupName"};if(!Array.isArray(t))return{info:"Invalid individualParticipantIds",error:Re};let o=(Nr({participantFilters:{participantTypes:[Hi]},tournamentRecord:n}).participants??[]).map(u=>u.participantId);for(let u of t)if(!o.includes(u))return{error:yd,participantId:u};let s=zt({participantId:r||Pn(),participantRoleResponsibilities:e,participantName:a,individualParticipantIds:t,participantType:ac,participantRole:i}),l=mp({participant:s,tournamentRecord:n});if(l.error)return l;let{topics:c}=rc();return c.includes(Wm)&&wi({topic:Wm,payload:{tournamentId:n.tournamentId,participants:[s]}}),{...ce,participant:Ot(s)}}function _de({tournamentRecord:t,participantName:e,participantId:i}){if(!t)return{error:ut};if(!i)return{error:ya};if(!e)return{error:Yt,info:"Missing participantName"};let{participant:n}=Eg({tournamentRecord:t,participantId:i});if(!n)return{error:Vr};n.participantName=e;let{topics:r}=rc();return r.includes(Ro)&&wi({topic:Ro,payload:{tournamentId:t.tournamentId,participants:[n]}}),{...ce}}function kde({clearExistingAssignments:t=!0,individualParticipantIds:e,reverseAssignmentOrder:i,initialTeamIndex:n=0,scaledParticipants:r=[],teamParticipantIds:a,tournamentRecord:o,scaleAttributes:s,teamNameBase:l,teamsCount:c,eventId:u,event:d}){var v,y,b,I,T;if(!o)return{error:ut};if(!Array.isArray(a)&&!yi(c)&&!u||!yi(n)||r&&!Array.isArray(r)||s&&(typeof s!="object"||!Object.keys(s).length))return{error:Re};if(!s&&!r.length||!r&&!(e&&s))return{error:Yt,info:"Missing scaling details"};if(u&&!a){if((d==null?void 0:d.eventType)!==Lc)return{error:ph};a=(v=d==null?void 0:d.entries)==null?void 0:v.filter(({entryStatus:w})=>w===Rl).map(Gi)}if(!(a!=null&&a.length)&&!c)return{info:"Missing teamParticipantIds or teamsCount",error:Yt};let p=e??r.map(({participantId:w})=>w);i&&(a==null||a.reverse(),n+=1),n>((a==null?void 0:a.length)||0)-1&&(n=0);let h=(a==null?void 0:a.slice(n).concat(...a.slice(0,n)))??[],f=[];for(let w of o.participants??[]){let{participantId:S,participantType:D}=w;if(h.includes(S)){if(D!==Nc)return{error:yd,participant:w};f.push(w)}}if(c&&f.length<c){let w=c-((f==null?void 0:f.length)||0),S=l??"Team",D=Et(0,w).map(R=>({participantName:`${S} ${R+1}`,participantType:Nc,participantRole:Do})),{participants:E=[]}=Nu({participants:D,returnParticipants:!0,tournamentRecord:o}),C=E.map(Gi),P=((y=o.participants)==null?void 0:y.filter(({participantId:R})=>C.includes(R)))??[];f.push(...P)}if(!f.length)return{error:YH};if(t)for(let w of f)w.individualParticipantIds=[];else{let w=f.map(S=>S).flat();e!=null&&e.length?p=p.filter(S=>!w.includes(S)):r=r==null?void 0:r.filter(({participantId:S})=>!w.includes(S))}if(!(e!=null&&e.length)&&!(r!=null&&r.length))return{error:jk,info:"Nothing to be done"};if(!r.length){for(let w of o.participants??[]){let{participantId:S,participantType:D}=w;if(!p.includes(S))continue;if(D!==Hi)return{error:yd,participant:w};let E=(b=th({scaleAttributes:s,participant:w}))==null?void 0:b.scaleItem,C=s!=null&&s.accessor?(I=E==null?void 0:E.scaleValue)==null?void 0:I[s==null?void 0:s.accessor]:E==null?void 0:E.scaleValue,P={participantId:S,scaleValue:C};r.push(P)}if(!r.length)return{error:Vr}}r.sort((w,S)=>s!=null&&s.sortOrder?((S==null?void 0:S.scaleValue)||0)-((w==null?void 0:w.scaleValue)||0):((w==null?void 0:w.scaleValue)||1/0)-((S==null?void 0:S.scaleValue)||1/0));for(let w of r)if(!w.participantId)return{error:Re,scaledParticipant:w};let m=0;for(;m<r.length;){for(let w of f){if(m+1>r.length)break;let S=r[m];w.individualParticipantIds.push(S.participantId),m++}f.reverse()}let g=f.map(Gi);for(let w of o.events??[]){if(w.eventType!==Lc)continue;let S=(w.entries??[]).filter(D=>g.includes(D.participantId));for(let D of S){let E=D.participantId,C=(T=f.find(R=>R.participantId===E))==null?void 0:T.individualParticipantIds;w.entries=(w.entries??[]).filter(R=>!C.includes(R.participantId)),(w.drawDefinitions??[]).forEach(R=>{R.entries=(R.entries??[]).filter(N=>!C.includes(N.participantId))});let{flightProfile:P}=Zr({event:w});((P==null?void 0:P.flights)||[]).forEach(R=>{R.drawEntries=(R.drawEntries||[]).filter(N=>!C.includes(N.participantId))})}}return{...ce,scaledParticipants:r}}function xde(t){let e=di(t,[{[ls]:!0,[gz]:!0},{ratingType:!1,[$o]:o=>La[o]}]);if(e.error)return e;let i=`${t.ratingType}.${vz}`,n=t.asDynamic?i:t.ratingType,r=[Bv,Lm,t.eventType,n].join("."),a=t.tournamentRecord.participants??[];for(let o of a)o.timeItems&&(o.timeItems=o.timeItems.filter(s=>s.itemType!==r));return{...ce}}function Ode(t){let{tournamentRecords:e}=t;if(typeof e!="object"||!Object.keys(e).length)return{error:Sr};for(let i of Object.values(e)){let n=xLe({...t,tournamentRecord:i});if(n.error&&n.error!==eS)return n}return{...ce}}function xLe({tournamentRecord:t,penaltyId:e}){if(!t)return{error:ut};if(!e)return{error:HH};let i=(t==null?void 0:t.participants)??[],n=[],r=!1,a;return i.forEach(o=>{let s=!1;o.penalties=(o.penalties??[]).filter(l=>(l.penaltyId===e&&(s=!0,r||(a=l,r=!0)),s&&n.push(o),l.penaltyId!==e))}),a&&wi({topic:Ro,payload:{tournamentId:t.tournamentId,participants:n}}),a?{...ce,penalty:a}:{error:eS}}var OLe=({penaltyId:t=Pn()}={})=>({refereeParticipantId:void 0,penaltyCode:void 0,penaltyType:void 0,extensions:void 0,matchUpId:void 0,createdAt:void 0,issuedAt:void 0,notes:void 0,penaltyId:t}),Lde=OLe;function Fde(t){let{tournamentRecords:e}=t;if(typeof e!="object"||!Object.keys(e).length)return{error:Sr};for(let i of Object.values(e)){let n=LLe({...t,tournamentRecord:i});if(n.error&&n.error!==eS||n.success)return n}return{error:eS}}function LLe({tournamentRecord:t,modifications:e,penaltyId:i}){if(!t)return{error:ut};if(!e)return{error:Re,modifications:e};if(!i)return{error:HH};let n=(t==null?void 0:t.participants)??[],r=Object.keys(Lde()).filter(l=>l!=="penaltyId"),a=Object.keys(e).filter(l=>r.includes(l));if(!a.length)return{error:Gk};let o,s=[];return n.forEach(l=>{let c=!1;l.penalties=(l.penalties??[]).map(u=>(u.penaltyId===i&&(c=!0,a.forEach(d=>Object.assign(u,{[d]:e[d]})),o||(o=u)),u)),c&&s.push(l)}),o&&wi({topic:Ro,payload:{tournamentId:t.tournamentId,participants:s}}),o?{...ce,penalty:o}:{error:eS}}function Bde(t,e,i){return!t&&e?e:t&&!e||typeof t!="object"||typeof e!="object"?t:Pi(Object.keys(t).concat(Object.keys(e))).reduce((n,r)=>{if(!e[r])n[r]=t[r];else if(!t[r])n[r]=e[r];else if(typeof t[r]!=typeof e[r])n[r]=e[r];else if(Array.isArray(t[r]))if(i===!0||Array.isArray(i)&&i.includes(r)){let a=Pi(t[r].map(o=>JSON.stringify(o)).concat(e[r].map(o=>JSON.stringify(o)))).map(o=>JSON.parse(o));n[r]=a}else n[r]=e[r];else typeof t[r]=="object"?n[r]=Bde(t[r],e[r],i):n[r]=e[r];return n},{})}function $de({participants:t=[],tournamentRecord:e,arraysToMerge:i}){if(!e)return{error:ut};e.participants||(e.participants=[]);let n=t.filter(Ml(gh)).map(c=>({[c.participantId]:c})),r=Object.assign({},...n),a=[];e.participants=e.participants.map(c=>{if(r[c.participantId]){let u=Bde(c,r[c.participantId],i);return a.push(u),u}return c});let o=e.participants.map(Ml(gh))||[],s=t.filter(({participantId:c})=>!o.includes(c)),{topics:l}=rc();return s.length&&(e.participants=e.participants.concat(...s),l.includes(Wm)&&wi({topic:Wm,payload:{participants:s}})),a.length&&l.includes(Ro)&&wi({topic:Ro,payload:{tournamentId:e.tournamentId,participants:a}}),{modifiedParticipantsCount:a.length,newParticipantsCount:s.length,...ce}}function Vde(t){var a;let{tournamentRecord:e,participantIds:i}=t,n=t.tournamentRecords??(e&&{[e.tournamentId]:e})??{},r;for(let o of Object.values(n)){let s=(a=Nr({tournamentRecord:o}).participants??[])==null?void 0:a.map(Gi).filter(l=>i.includes(l));s.length&&(r=FLe({...t,penaltyId:t.penaltyId??r,tournamentRecord:o,participantIds:s}).penaltyId)}return r?{...ce,penaltyId:r}:{error:Vr}}function FLe({refereeParticipantId:t,tournamentRecord:e,participantIds:i,penaltyCode:n,penaltyType:r,extensions:a,penaltyId:o,matchUpId:s,issuedAt:l,notes:c}){if(!e)return{error:ut};if(!i)return{error:ya};if(!r)return{error:Vne};let u=((e==null?void 0:e.participants)??[]).filter(h=>i.includes(h.participantId));if(!u.length)return{error:Vr};let d=new Date().toISOString(),p=Object.assign(Lde({penaltyId:o}),{refereeParticipantId:t,penaltyCode:n,penaltyType:r,matchUpId:s,createdAt:d,issuedAt:l,notes:c});return Array.isArray(a)&&a.forEach(h=>cn({element:p,extension:h})),u.forEach(h=>{h.penalties||(h.penalties=[]),h.penalties.push(p)}),wi({topic:Ro,payload:{tournamentId:e.tournamentId,participants:u}}),{...ce,penaltyId:p.penaltyId}}function jde({participantRole:t=Do,tournamentRecord:e,persons:i}){var f;if(!e)return{error:ut};if(!Array.isArray(i))return{error:Re};if(!Object.keys(Mg).includes(t))return{error:Mne};let n=(e.participants||[]).map(({person:m})=>m==null?void 0:m.personId).filter(Boolean),r=[],a=i.filter(m=>m&&(!m.personId||!n.includes(m.personId))).map(m=>(m.personId||(m.personId=Pn()),r.push(m.personId),m)),o=(m,g)=>Object.assign({},...Object.keys(m).filter(v=>!g.includes(v)).map(v=>({[v]:m[v]}))),s=a.map(m=>zt({extensions:m.participantExtensions,timeItems:m.participantTimeItems,participantType:Hi,participantRole:t,person:o(m,["participantExtensions","participantTimeItems","pairedPersons"])})),l=0,c=0,u=Nu({participants:s,tournamentRecord:e});if(u.error)return u;c=u.addedCount||0;let d=[],p=((f=Nr({participantFilters:{participantTypes:[Hi]},tournamentRecord:e}))==null?void 0:f.participants)??[];if(t===Do&&i.filter(({pairedPersons:m})=>m).forEach(({personId:m,pairedPersons:g})=>{Array.isArray(g)&&g.forEach(v=>{let y=[m,v.personId].map(b=>zm({tournamentParticipants:p,personId:b})).filter(Boolean);if(y.length===2){let b=y.map(Gi);d.push(zt({extensions:v.participantExtensions,timeItems:v.timeItems,participantRole:Do,individualParticipantIds:b,participantType:Ti}))}})}),d.length){if(u=Nu({participants:d,tournamentRecord:e}),u.error)return u;l=u.addedCount||0}let h=c+l;return{...ce,addedCount:h,newPersonIds:r}}var _O={};$i(_O,{bulkUpdatePublishedEventIds:()=>_3,getAllEventData:()=>k3,getCourtInfo:()=>wx,getDrawData:()=>nO,getEventData:()=>rO,getEventPublishStatus:()=>Yc,getPublishState:()=>HI,getTournamentPublishStatus:()=>kC,getVenueData:()=>hS,mutate:()=>Gde,publishEvent:()=>KT,publishEventSeeding:()=>Hde,publishOrderOfPlay:()=>Yde,publishParticipants:()=>Kde,query:()=>Oce,setEventDisplay:()=>gO,unPublishEvent:()=>Zde,unPublishEventSeeding:()=>zde,unPublishOrderOfPlay:()=>Wde,unPublishParticipants:()=>qde});var Gde={};$i(Gde,{publishEvent:()=>KT,publishEventSeeding:()=>Hde,publishOrderOfPlay:()=>Yde,publishParticipants:()=>Kde,setEventDisplay:()=>gO,unPublishEvent:()=>Zde,unPublishEventSeeding:()=>zde,unPublishOrderOfPlay:()=>Wde,unPublishParticipants:()=>qde});function Hde({removePriorValues:t=!0,stageSeedingScaleNames:e,seedingScaleNames:i,tournamentRecord:n,status:r=oc,drawIds:a=[],event:o}){var d,p,h,f;if(!n)return{error:ut};if(!o)return{error:Qn};let s=Yc({event:o,status:r}),l=(((d=s==null?void 0:s.seeding)==null?void 0:d.seedingScaleNames)||i)&&{...(p=s==null?void 0:s.seeding)==null?void 0:p.seedingScaleNames,...i},c=(((h=s==null?void 0:s.seeding)==null?void 0:h.stageSeedingScaleNames)||e)&&{...(f=s==null?void 0:s.seeding)==null?void 0:f.stageSeedingScaleNames,...e},u=zt({stageSeedingScaleNames:c,seedingScaleNames:l,published:!0,drawIds:a});return WT({statusObject:{seeding:u},removePriorValues:t,status:r,event:o}),wi({topic:sae,payload:{tournamentId:n.tournamentId,eventId:o.eventId,drawIds:a}}),{...ce}}function zde({removePriorValues:t=!0,seedingScaleNames:e,tournamentRecord:i,status:n=oc,drawIds:r,stages:a,event:o}){var l,c;if(!i)return{error:ut};if(!o)return{error:Qn};let s=Yc({event:o});if(s){let u=s.seeding;if(Array.isArray(a)&&u.stageSeedingScaleNames)for(let d of a)u.stageSeedingScaleNames[d]&&delete u.stageSeedingScaleNames[d];Array.isArray(e)&&(u!=null&&u.seedingScaleNames)&&(u.seedingScaleNames=u.seedingScaleNames.filter(d=>!e.includes(d))),Array.isArray(r)&&(u!=null&&u.drawIds)&&(u.drawIds=u.drawIds.filter(d=>!r.includes(d))),(!Object.values(u.stageSeedingScaleNames??{}).length&&!((l=u.seedingScaleNames)!=null&&l.length)&&!((c=u.drawIds)!=null&&c.length)||!a&&!e&&!(r!=null&&r.length))&&(delete u.stageSeedingScaleNames,delete u.seedingScaleNames,delete u.drawIds,u.published=!1),WT({statusObject:{seeding:u},removePriorValues:t,status:n,event:o})}return wi({topic:Yz,payload:{tournamentId:i.tournamentId,eventId:o.eventId}}),{...ce}}function qde(t){let e=qc(t);if(!Object.keys(e).length)return{error:Sr};for(let i of Object.values(e)){let n=BLe({tournamentRecord:i,...t});if(n.error)return n}return{...ce}}function BLe({removePriorValues:t=!0,tournamentRecord:e,status:i=oc}){if(!e)return{error:ut};let n=`${Cg}.${Pg}`,{timeItem:r}=Wc({element:e,itemType:n}),a=(r==null?void 0:r.itemValue)||{[i]:{}};return a[i]&&delete a[i].participants,Np({timeItem:{itemValue:a,itemType:n},element:e,removePriorValues:t}),wi({payload:{tournamentId:e.tournamentId},topic:eMe}),{...ce}}function Wde(t){let e=qc(t);if(!Object.keys(e).length)return{error:Sr};for(let i of Object.values(e)){let n=$Le({tournamentRecord:i,...t});if(n.error)return n}return{...ce}}function $Le({removePriorValues:t=!0,tournamentRecord:e,status:i=oc}){if(!e)return{error:ut};let n=`${Cg}.${Pg}`,{timeItem:r}=Wc({element:e,itemType:n}),a=(r==null?void 0:r.itemValue)||{[i]:{}};return a[i]&&delete a[i].orderOfPlay,Np({timeItem:{itemValue:a,itemType:n},element:e,removePriorValues:t}),wi({topic:Zz,payload:{tournamentId:e.tournamentId}}),{...ce}}function Kde(t){let e=qc(t);if(!Object.keys(e).length)return{error:Sr};for(let i of Object.values(e)){let n=VLe({tournamentRecord:i,...t});if(n.error)return n}return{...ce}}function VLe({removePriorValues:t,tournamentRecord:e,status:i=oc}){if(!e)return{error:ut};let n=`${Cg}.${Pg}`,{timeItem:r}=Wc({element:e,itemType:n}),a=(r==null?void 0:r.itemValue)||{[i]:{}};return a[i].participants={published:!0},Np({timeItem:{itemValue:a,itemType:n},element:e,removePriorValues:t}),wi({payload:{tournamentId:e.tournamentId},topic:cae}),{...ce}}function Yde(t){let e=qc(t);if(!Object.keys(e).length)return{error:Sr};for(let i of Object.values(e)){let n=jLe({tournamentRecord:i,...t});if(n.error)return n}return{...ce}}function jLe({scheduledDates:t=[],removePriorValues:e,tournamentRecord:i,status:n=oc,eventIds:r=[]}){if(!i)return{error:ut};let a=`${Cg}.${Pg}`,{timeItem:o}=Wc({element:i,itemType:a}),s=(o==null?void 0:o.itemValue)||{[n]:{}};return s[n].orderOfPlay={published:!0,scheduledDates:t,eventIds:r},Np({timeItem:{itemValue:s,itemType:a},element:i,removePriorValues:e}),wi({topic:lae,payload:{tournamentId:i.tournamentId,scheduledDates:t,eventIds:r}}),{...ce}}function Zde({removePriorValues:t=!0,tournamentRecord:e,status:i=oc,event:n}){if(!e)return{error:ut};if(!n)return{error:Qn};let r=`${Cg}.${Pg}`,{timeItem:a}=vC({itemType:r,event:n}),o=(a==null?void 0:a.itemValue)||{[i]:{}};return delete o[i].structureIds,delete o[i].drawDetails,delete o[i].drawIds,YI({event:n,timeItem:{itemValue:o,itemType:r},removePriorValues:t}),WT({statusObject:{structureIds:void 0,drawIds:void 0,seeding:void 0},removePriorValues:t,status:i,event:n}),wi({topic:Kz,payload:{tournamentId:e.tournamentId,eventId:n.eventId}}),{eventId:n.eventId,...ce}}var VW={};$i(VW,{getEntryStatusReports:()=>HLe,getParticipantStats:()=>GLe,getStructureReports:()=>qLe,getVenuesReport:()=>KLe});function GLe({withCompetitiveProfiles:t,opponentParticipantId:e,withIndividualStats:i,teamParticipantId:n,tournamentRecord:r,withScaleValues:a,tallyPolicy:o,matchUps:s}){var S,D,E,C,P;if(!r)return{error:ut};if(s&&!Array.isArray(s))return{error:al};if(s=s??oo({tournamentRecord:r,participantsProfile:a?{withScaleValues:a}:void 0}).matchUps,!(s!=null&&s.length))return{error:Xf};let l=[];e&&l.push(e),n&&l.push(n);let c=l.length?{participantIds:l}:{participantTypes:[Nc]},u=Nr({participantFilters:c,tournamentRecord:r}).participants??[];if(!u.every(({participantType:R})=>R===Nc))return{error:Ul};l.length||l.push(...u.map(Gi));let d=new Map,p=new Map,h=new Map,f=new Map,m=(R,N="")=>p.get(R)||p.set(R,{participantName:N,participantId:R,competitorIds:[],competitiveness:{},matchUpStatuses:{},tiebreaks:[0,0],matchUps:[0,0],points:[0,0],games:[0,0],sets:[0,0]})&&p.get(R);for(let R of u){let{participantId:N,individualParticipantIds:M}=R;f.set(N,M??[]),m(N,R.participantName)}if(n&&!f.get(n))return pe({result:{error:Vr},context:{teamParticipantId:n}});if(e&&!f.get(e))return pe({result:{error:Vr},context:{opponentParticipantId:e}});let g=[],v=R=>{let N=[[],[]];for(let A of R){let _=A.participant;if(_!=null&&_.participantName){d.set(_.participantId,{participantName:_.participantName,ratings:_.ratings});let x=p.get(_.participantId);x&&(x.participantName=_.participantName)}}let M=({side:A,individualParticipantIds:_})=>{var x,O,B,F,G;return A.participantId&&(!(_!=null&&_.length)||_.includes(A.participantId))&&[A.participantId]||((O=(x=A.participant)==null?void 0:x.individualParticipantIds)==null?void 0:O.length)&&(!(_!=null&&_.length)||zr(_,(B=A.participant)==null?void 0:B.individualParticipantIds).length===((G=(F=A.participant)==null?void 0:F.individualParticipantIds)==null?void 0:G.length))&&A.participant.individualParticipantIds};if(f.size){let A=(_,x)=>{for(let O of R){if(!O.participant)continue;let B=M({individualParticipantIds:x,side:O});if(B!=null&&B.length){let F=O.sideNumber;if(!F)continue;let G=[_];i&&G.push(...B),N[F-1]=G;let H=p.get(_);for(let $ of B.filter(Boolean))H&&!H.competitorIds.includes($)&&H.competitorIds.push($)}}};if(n)(!e||R.every(_=>_.participant&&(M({individualParticipantIds:f.get(n),side:_})||M({individualParticipantIds:f.get(e),side:_}))))&&A(n,f.get(n));else for(let[_,x]of f)A(_,x)}else if(i)for(let A of R){if(!A.participant)continue;let _=M({individualParticipantIds:[],side:A}),x=A.sideNumber;x&&(N[x-1]=_)}return N};for(let R of s){if(!Xi(R))return{error:al};let{matchUpStatus:N,matchUpFormat:M,matchUpType:A,winningSide:_,score:x,sides:O}=R;if(!O||!x||A===pp||N===vn)continue;let B=v(O);if(!B.filter(Boolean).length)continue;let F=t&&_&&((S=EC({matchUp:R}))==null?void 0:S.competitiveness);g.push(R);let G=Vq({matchUpStatus:N,matchUpFormat:M,tallyPolicy:o,winningSide:_,score:x}),H=ose({matchUpStatus:N,matchUpFormat:M,tallyPolicy:o,winningSide:_,score:x}),{pointsTally:$,tiebreaksTally:q}=sse({matchUpFormat:M,score:x});B.forEach((z,Z)=>{var Y;for(let Q of z){let X=(Y=d.get(Q))==null?void 0:Y.participantName,oe=m(Q,X);if(oe){let re=(ae,de)=>de.forEach((Ie,De)=>oe[ae][De]+=Ie),me=Z?[...q].reverse():q,se=Z?[...$].reverse():$,te=Z?[...H].reverse():H,he=Z?[...G].reverse():G;if(re("tiebreaks",me),re("points",se),re("games",te),re("sets",he),_){let ae=_-1===Z?0:1;oe.matchUps[ae]+=1}if(F){let ae=F.toLowerCase();oe.competitiveness[ae]||(oe.competitiveness[ae]=[0,0]),oe.competitiveness[ae][Z]+=1}if(N){let ae=N.toLowerCase();oe.matchUpStatuses[ae]||(oe.matchUpStatuses[ae]=0),oe.matchUpStatuses[ae]+=1}}}})}let y=["tiebreaks","matchUps","points","games","sets"],b=["competitive","routine","decisive"],I=new Map,T=(R,N)=>(R??0)+(N??0);for(let[R,N]of p.entries()){for(let M of y){let A=N[M].reduce(T);if(A){let _=N[M][0]/A,x=`${M}Ratio`,O=parseFloat(_.toFixed(2));N[x]=O,h.set(R,!0),I.has(x)||I.set(x,[]),(D=I.get(x))==null||D.push(O)}}for(let M of b){let A=(C=(E=N.competitiveness)==null?void 0:E[M])==null?void 0:C.reduce(T);if(A){let _=N.competitiveness[M][0]/A,x=`${M}Ratio`,O=parseFloat(_.toFixed(2));N[x]=O}}}if(!n){let R=(N,M)=>M-N;for(let N of p.values())for(let M of y){let A=`${M}Ratio`;if(typeof N[A]=="number"){let _=(P=I.get(A))==null?void 0:P.sort(R).indexOf(N[A]);if(typeof _=="number"&&_>=0){let x=`${M}Rank`;N[x]=_+1}}}}let w={relevantMatchUps:g,...ce};return n?(w.teamStats=p.get(n),e&&(w.opponentStats=p.get(e))):w.participatingTeamsCount=h.size,w.allParticipantStats=[...p.values()],w}function WA({participant:t,eventType:e}){var c,u,d,p,h,f;let i=(c=t==null?void 0:t.person)==null?void 0:c.personId,n=(d=(u=t==null?void 0:t.person)==null?void 0:u.personOtherIds)==null?void 0:d[0],r=(p=t==null?void 0:t.person)==null?void 0:p.tennisId,a=(f=(h=t==null?void 0:t.ratings)==null?void 0:h[e])==null?void 0:f.find(({scaleName:m})=>m===$q),o=a==null?void 0:a.scaleValue,{wtnRating:s,confidence:l}=o||{};return{timeStamp:a==null?void 0:a.scaleDate,personOtherId:n,confidence:l,wtnRating:s,personId:i,tennisId:r}}function HLe({tournamentRecord:t}){if(!t)return{error:ut};let e=t.tournamentId,{participantMap:i}=Nr({withScaleValues:!0,withEvents:!0,withSeeding:!0,tournamentRecord:t,withDraws:!0}),n=(oo({matchUpFilters:{matchUpTypes:[Sb,jv]},tournamentRecord:t}).matchUps??[]).flatMap(({sides:h,matchUpType:f})=>h==null?void 0:h.flatMap(m=>{var g,v;return f===jv?(g=m==null?void 0:m.participant)==null?void 0:g.individualParticipantIds:((v=m==null?void 0:m.participant)==null?void 0:v.participantId)||m.participantId}).filter(Boolean)).filter(Boolean),r=[],a={},o={},s={},l=0,c=({id:h,entry:f,eventId:m,eventType:g})=>{var C;let{qualifyingSeeding:v,mainSeeding:y,entryStatus:b,entryStage:I,drawId:T}=f;a[h]||(a[h]=[]);let{participant:w,events:S}=(i==null?void 0:i[h])??{},D=WA({participant:w,eventType:g}),E=(C=S==null?void 0:S[m])==null?void 0:C.ranking;b===xq&&r.push(h),a[h].push({participantType:w==null?void 0:w.participantType,participantId:h,tournamentId:e,eventType:g,eventId:m,drawId:T,entryStatus:b,entryStage:I,...D,ranking:E,mainSeeding:y,qualifyingSeeding:v})};for(let h of t.events??[]){let f={},m=S=>{f[S]||(f[S]={count:0}),f[S].count+=1},{drawDefinitions:g=[],eventType:v,eventId:y}=h,b=g.flatMap(S=>{let{drawId:D,entries:E}=S;l+=1;let C=({stage:M,stageSequence:A})=>M===xt&&A===1||M===Zt,P=(S.structures??[]).filter(C).flatMap(({positionAssignments:M})=>M).filter(Boolean).map(({participantId:M})=>M),R=({participantId:M})=>P.includes(M),N=M=>{var B,F,G,H,$,q,z,Z;let{participantId:A,entryStatus:_,entryStage:x}=M;m(_);let O=(H=(G=(F=(B=i==null?void 0:i[A])==null?void 0:B.draws)==null?void 0:F[D])==null?void 0:G.seedAssignments)==null?void 0:H[xt];return{qualifyingSeeding:(Z=(z=(q=($=i==null?void 0:i[A])==null?void 0:$.draws)==null?void 0:q[D])==null?void 0:z.seedAssignments)==null?void 0:Z[Zt],participantId:A,mainSeeding:O,entryStatus:_,entryStage:x,drawId:D}};return E==null?void 0:E.filter(R).map(N)}),I=S=>{var C;let D=S.participantId,E=(C=i==null?void 0:i[D].participant.individualParticipantIds)==null?void 0:C.filter(P=>n.includes(P));return D&&{[D]:{individualParticipantIds:E}}};v===Gm?(()=>{let S=Object.assign({},...b.map(I).filter(Boolean)),D=E=>{S[E.participantId].individualParticipantIds.forEach(C=>{c({id:C,eventType:v,eventId:y,entry:E})})};b.forEach(D)})():b.forEach(S=>{c({id:S==null?void 0:S.participantId,eventType:v,eventId:y,entry:S})});let T=Object.values(f).reduce((S,D)=>S+D.count,0);Object.keys(f).forEach(S=>{f[S].pct=f[S].count/T*100}),s[y]={tournamentId:e,eventId:y,entries:b,entryStatuses:f};let w=Object.assign({},...Bu.flatMap(S=>{var D,E;return[{[S+"_count"]:(D=f[S])==null?void 0:D.count},{[S+"_pct"]:(E=f[S])==null?void 0:E.pct}]}));o[y]={tournamentId:e,eventId:y,...w}}let u=Object.values(i??{}).filter(({participant:{participantType:h,participantRole:f}})=>h===Hi&&f===Do),d=u.filter(({participant:h})=>!n.includes(h.participantId)).map(({participant:h})=>h.participantId),p={nonParticipatingEntriesCount:d.length,individualParticipantsCount:u.length,eventsCount:Object.values(s).length,nonParticipatingParticipantIds:d,drawDefinitionsCount:l,tournamentId:e};return{entryStatusReports:Object.values(o).flat(),participantEntryReports:Object.values(a).flat(),eventReports:Object.values(s).flat(),withDrawnParticipantIds:r,tournamentEntryReport:p}}function zLe({eventType:t,matchUps:e,eventId:i,drawId:n}){let r={},a=f=>{let m=f==null?void 0:f.matchUpFormat;m&&(r[m]||(r[m]=0),r[m]+=1)},o=e.filter(f=>i?f.eventId===i:f.drawId===n).reduce((f,m)=>(a(m),(m.sides??[]).flatMap(g=>{var v;return(((v=g==null?void 0:g.participant)==null?void 0:v.individualParticipants)||[g==null?void 0:g.participant]).filter(Boolean)}).forEach(g=>f[g.participantId]=g),f),{}),s=Object.values(o),l=s.map(f=>WA({participant:f,eventType:t})).filter(({wtnRating:f})=>f),c=(s.length-l.length)/s.length*100,u=l.reduce((f,m)=>{let{wtnRating:g,confidence:v}=m;return f.totalWTN+=g,f.totalConfidence+=v,f},{totalWTN:0,totalConfidence:0}),d=l!=null&&l.length?u.totalWTN/l.length:0,p=l!=null&&l.length?u.totalConfidence/l.length:0,h=Object.values(r).reduce((f,m)=>f+(m||0),0);return{matchUpFormatCounts:r,matchUpsCount:h,avgConfidence:p,pctNoRating:c,avgWTN:d}}function qLe({firstFlightOnly:t=!0,extensionProfiles:e,tournamentRecord:i}){var h;if(!i)return{error:J0};let n=[],r={},a={},o=[],s=Object.assign({},...(e??[]).map(({name:f,label:m,accessor:g})=>{var b,I,T;let v=(I=(b=Ri({element:i,name:f}))==null?void 0:b.extension)==null?void 0:I.value,y=g?(T=Tb({element:v,accessor:g}))==null?void 0:T.value:v;return{[m||f]:y}})),l=i==null?void 0:i.tournamentId,c=oo({participantsProfile:{withScaleValues:!0},tournamentRecord:i}).matchUps??[],u=f=>{var m,g,v;return(v=(g=(m=Wc({itemType:Lz,itemSubTypes:[Qp],element:{timeItems:f}}))==null?void 0:m.timeItem)==null?void 0:g.itemValue)==null?void 0:v.scaleBasis},d=({positionManipulations:f})=>{f==null||f.forEach(m=>{let{structureId:g,name:v}=m,y=m.drawPositions||[m.drawPosition];r[g]||(r[g]=[]),r[g].push(`${v}: ${y.join("/")}`)})},p=(h=i==null?void 0:i.events)==null?void 0:h.flatMap(({timeItems:f,drawDefinitions:m=[],extensions:g,eventType:v,eventName:y,eventId:b,category:I})=>{var N,M,A,_;let T=(A=(M=(N=g==null?void 0:g.find(x=>x.name===Pu))==null?void 0:N.value)==null?void 0:M.flights)==null?void 0:A.map(x=>({[x.drawId]:x.flightNumber})),w=T&&Object.assign({},...T),S=g==null?void 0:g.find(x=>x.name===Cv),D=f==null?void 0:f.find(x=>x.itemType===Cv),E=((_=S==null?void 0:S.value)==null?void 0:_.length)||(D==null?void 0:D.itemValue)||0,C=Object.values(w),P=w&&Math.min(...C),R=u(f);return a[b]={seedingBasis:R?JSON.stringify(R):void 0,totalPositionManipulations:0,maxPositionManipulations:0,generatedDrawsCount:0,drawDeletionsCount:E,tournamentId:l,eventId:b},m.filter(x=>!t||!T||w[x.drawId]===P).flatMap(x=>{let{matchUpFormat:O,tieFormat:B,timeItems:F,extensions:G,structures:H,drawName:$,drawType:q,drawId:z}=x,{matchUpFormatCounts:Z,matchUpsCount:Y,avgConfidence:Q,pctNoRating:X,avgWTN:oe}=zLe({eventType:v,matchUps:c,drawId:z}),re=u(F)||R,me=WLe({extensions:G}),se=(me==null?void 0:me.length)||0;return d({positionManipulations:me}),a[b].totalPositionManipulations+=se,a[b].generatedDrawsCount+=1,se>a[b].maxPositionManipulations&&(a[b].maxPositionManipulations=se),H==null?void 0:H.filter(te=>te.stageSequence===1&&[Zt,xt,Po,Fr].includes(te.stage)).map(te=>{var Ut,pt,tt;let he=[xt,Fr].includes(te.stage)?c.find(At=>At.structureId===te.structureId&&At.finishingRound===1&&At.winningSide):void 0;te.stage===xt&&n.push({eventName:y,drawName:$,structureId:te.structureId});let ae=(pt=(Ut=he==null?void 0:he.sides)==null?void 0:Ut.find(At=>At.sideNumber===he.winningSide))==null?void 0:pt.participant,de=(ae==null?void 0:ae.participantType)===Nc&&ae.participantId,Ie=(ae==null?void 0:ae.participantType)===Ti?ae.individualParticipants:[],De=WA({participant:(Ie==null?void 0:Ie[0])||ae,eventType:v}),{personId:Te,personOtherId:_e,tennisId:Ve,confidence:ot,wtnRating:St}=De||{},nt=WA({participant:Ie==null?void 0:Ie[1],eventType:v}),{personId:Bt,personOtherId:Pe,tennisId:et,confidence:Ee,wtnRating:lt}=nt||{},{ageCategoryCode:Ke,categoryName:bt,subType:gt}=I??{},Ue=te.matchUpFormat||O,xe=(Z[Ue]||0)/Y*100,{tieFormatName:We,tieFormatDesc:st}=VA(B),{tieFormatName:vt,tieFormatDesc:ge}=VA(te.tieFormat),Se=st===ge,qe=!Se&&vt,$e=te.tieFormat&&!Se&&ge,ke=((tt=me==null?void 0:me.filter(At=>At.structureId===te.structureId))==null?void 0:tt.length)||0;return{...s,tournamentId:l,eventId:b,structureId:te.structureId,drawId:z,eventType:v,category:gt,categoryName:bt,ageCategoryCode:Ke,flightNumber:w[z],drawType:q,stage:te.stage,seedingBasis:re?JSON.stringify(re):void 0,winningPersonId:Te,winningPersonOtherId:_e,winningPersonTennisId:Ve,winningPersonWTNrating:St,winningPersonWTNconfidence:ot,winningPerson2Id:Bt,winningPerson2OtherId:Pe,winningPerson2TennisId:et,winningPerson2WTNrating:lt,winningPerson2WTNconfidence:Ee,winningTeamId:de,positionManipulations:ke,pctNoRating:X,matchUpFormat:Ue,pctInitialMatchUpFormat:xe,matchUpsCount:Y,drawTieFormatName:We,drawTieFormatDesc:st,tieFormatName:qe,tieFormatDesc:$e,avgConfidence:Q,avgWTN:oe}})})});return n.forEach(({eventName:f,drawName:m,structureId:g})=>{var v;(v=r[g])!=null&&v.length&&o.push({eventName:f,drawName:m,actions:r[g]})}),{eventStructureReports:Object.values(a),structureReports:p,flightReports:o}}function WLe({extensions:t}){var e,i;return(i=(e=t==null?void 0:t.find(({name:n})=>n===_1))==null?void 0:e.value)==null?void 0:i.slice(1)}function KLe({ignoreDisabled:t=!0,tournamentRecords:e,tournamentId:i,venueIds:n=[],dates:r=[]}){var u,d;if(!Array.isArray(r))return{error:Re,dates:r};if(!Array.isArray(n))return{error:Re,venueIds:n};if(!(e&&Object.keys(e).filter(p=>!i||p===i)||[]).length)return{error:Sr};if(!r.every(Dl))return{error:Xa};let a=nm({tournamentRecords:e,ignoreDisabled:t,dates:r});if(a.error)return a;let o=(u=a==null?void 0:a.venues)==null?void 0:u.filter(({venueId:p})=>!(n!=null&&n.length)||n.includes(p)),s=(d=a.courts)==null?void 0:d.reduce((p,h)=>{var f;return(f=h.dateAvailability)==null||f.forEach(m=>{let g=m.date;p.includes(g)||p.push(g)}),p},[]).filter(p=>!r.length||r.includes(p)),l={venueIds:o==null?void 0:o.map(({venueId:p})=>p)},{matchUps:c}=wd({afterRecoveryTimes:!0,tournamentRecords:e,matchUpFilters:l});return{venuesReport:o==null?void 0:o.map(p=>YLe(s,p,c))}}function YLe(t,e,i){let{venueId:n,courts:r,venueName:a}=e,o={};return t.forEach(s=>{var h;let l=0,c=0,u=0;for(let f of r){let m=f.dateAvailability.find(v=>v.date===s),g=(h=m&&YT({courtDate:m}).timeSlots)==null?void 0:h.reduce((v,y)=>{let{startTime:b,endTime:I}=y,T=an(I)-an(b);return v+T},0);g&&(u+=1),l+=g}let d=i.filter(({schedule:f})=>f.venueId===n&&vh(s,f.scheduledDate));d.forEach(({schedule:f})=>{let m=ir(f.scheduledTime),g=tl(m,f.averageMinutes),v=an(g)-an(m);c+=v});let p=l?(c/l*100).toFixed(2):"100";o[s]={scheduledMatchUpsCount:d.length,availableCourts:u,availableMinutes:l,scheduledMinutes:c,percentUtilization:p}}),{venueId:n,venueName:a,venueReport:o}}var jW={};$i(jW,{addMatchUpCourtOrder:()=>IW,addMatchUpEndTime:()=>SW,addMatchUpOfficial:()=>Fue,addMatchUpResumeTime:()=>UW,addMatchUpScheduleItems:()=>DO,addMatchUpScheduledDate:()=>TO,addMatchUpScheduledTime:()=>Ag,addMatchUpStartTime:()=>wW,addMatchUpStopTime:()=>TW,addSchedulingProfileRound:()=>OW,allocateTeamMatchUpCourts:()=>UO,assignMatchUpCourt:()=>QI,assignMatchUpVenue:()=>XT,bulkRescheduleMatchUps:()=>rpe,bulkScheduleMatchUps:()=>gP,bulkScheduleTournamentMatchUps:()=>YD,bulkUpdateCourtAssignments:()=>epe,calculateScheduleTimes:()=>GW,clearMatchUpSchedule:()=>ope,clearScheduledMatchUps:()=>PO,courtGridRows:()=>lO,findMatchUpFormatTiming:()=>aO,findVenue:()=>kh,generateBookings:()=>CO,generateVirtualCourts:()=>yO,getPersonRequests:()=>Ry,getProfileRounds:()=>sO,getScheduledRoundsDetails:()=>rP,getSchedulingProfile:()=>rm,getSchedulingProfileIssues:()=>x3,matchUpScheduleChange:()=>ape,modifyMatchUpFormatTiming:()=>tW,mutate:()=>Xde,proAutoSchedule:()=>Qde,proConflicts:()=>ipe,publicFindCourt:()=>cq,query:()=>jce,removeEventMatchUpFormatTiming:()=>mO,removeMatchUpCourtAssignment:()=>Jde,reorderUpcomingMatchUps:()=>npe,scheduleMatchUps:()=>tpe,scheduleProfileRounds:()=>RO,setMatchUpDailyLimits:()=>spe,setMatchUpHomeParticipantId:()=>bW,setSchedulingProfile:()=>zT,toggleParticipantCheckInState:()=>IO,validateSchedulingProfile:()=>oO});var Xde={};$i(Xde,{addMatchUpCourtOrder:()=>IW,addMatchUpEndTime:()=>SW,addMatchUpOfficial:()=>Fue,addMatchUpResumeTime:()=>UW,addMatchUpScheduleItems:()=>DO,addMatchUpScheduledDate:()=>TO,addMatchUpScheduledTime:()=>Ag,addMatchUpStartTime:()=>wW,addMatchUpStopTime:()=>TW,addSchedulingProfileRound:()=>OW,allocateTeamMatchUpCourts:()=>UO,assignMatchUpCourt:()=>QI,assignMatchUpVenue:()=>XT,bulkRescheduleMatchUps:()=>rpe,bulkScheduleMatchUps:()=>gP,bulkScheduleTournamentMatchUps:()=>YD,bulkUpdateCourtAssignments:()=>epe,calculateScheduleTimes:()=>GW,clearMatchUpSchedule:()=>ope,clearScheduledMatchUps:()=>PO,findMatchUpFormatTiming:()=>aO,generateBookings:()=>CO,generateVirtualCourts:()=>yO,matchUpScheduleChange:()=>ape,modifyMatchUpFormatTiming:()=>tW,proAutoSchedule:()=>Qde,proConflicts:()=>ipe,removeEventMatchUpFormatTiming:()=>mO,removeMatchUpCourtAssignment:()=>Jde,reorderUpcomingMatchUps:()=>npe,scheduleMatchUps:()=>tpe,scheduleProfileRounds:()=>RO,setMatchUpDailyLimits:()=>spe,setMatchUpHomeParticipantId:()=>bW,setSchedulingProfile:()=>zT,toggleParticipantCheckInState:()=>IO,validateSchedulingProfile:()=>oO});function GW({calculateStartTimeFromCourts:t=!0,defaultRecoveryMinutes:e=0,averageMatchUpMinutes:i=90,remainingScheduleTimes:n,clearScheduleDates:r,tournamentRecords:a,periodLength:o,scheduleDate:s,startTime:l,venueIds:c,endTime:u}){if(typeof a!="object"||!Object.keys(a).length)return{error:Sr};o=o??bO({recoveryMinutes:e,averageMatchUpMinutes:i});let{courts:d,venues:p}=nm({dates:[s],ignoreDisabled:!0,tournamentRecords:a}),h=d==null?void 0:d.filter(C=>!c||c.includes(C.venueId));l||(l=h==null?void 0:h.reduce((C,P)=>{var N,M;let R=((M=(N=P.dateAvailability)==null?void 0:N.find(A=>!A.date||vh(s,A.date)))==null?void 0:M.startTime)??P.startTime;return R&&(!C||an(R)<an(C))?R:C},void 0)),u||(u=h==null?void 0:h.reduce((C,P)=>{var N,M;let R=((M=(N=P.dateAvailability)==null?void 0:N.find(A=>!A.date||vh(s,A.date)))==null?void 0:M.endTime)??P.endTime;return R&&(!C||an(R)>an(C))?R:C},void 0));let f=Object.values(a),m=Object.assign({},...f.map(C=>(C.events??[]).map(P=>{let{scheduleTiming:R}=yC({tournamentRecord:C,event:P});return{[P.eventId]:{event:P,scheduleTiming:R}}})).flat()),g=sP({sortDateMatchUps:!1,tournamentRecords:a,matchUpFilters:{scheduledDate:s,venueIds:c}}),v=(g==null?void 0:g.dateMatchUps)??[],y=(g==null?void 0:g.completedMatchUps)??[],b=[];b.push(...v),b.push(...y);let I={averageTimes:[{minutes:{default:i}}],recoveryTimes:[{minutes:{default:e}}]},T=b==null?void 0:b.map(({eventId:C,schedule:P,matchUpFormat:R})=>{let{event:N,scheduleTiming:M}=m[C],A=N==null?void 0:N.eventType,_={...M,defaultTiming:I,matchUpFormat:R},{averageMinutes:x,recoveryMinutes:O}=Ix({eventType:A,timingDetails:_}),{courtId:B,venueId:F}=P,G=ir(P.scheduledTime),H=tl(G,x);return{recoveryMinutes:O,averageMinutes:x,periodLength:o,startTime:G,endTime:H,courtId:B,venueId:F}}),w={calculateStartTimeFromCourts:t,remainingScheduleTimes:n,averageMatchUpMinutes:i,date:s,clearScheduleDates:r,periodLength:o,startTime:l,endTime:u,bookings:T,courts:h},{scheduleTimes:S}=pW(w),D=(c==null?void 0:c.length)===1&&c[0]||(p==null?void 0:p.length)===1&&p[0].venueId||void 0,E=b.map($a);return{venueId:D,scheduleTimes:S,dateScheduledMatchUpIds:E}}function Jde(t){var h;let e=di(t,[{[zo]:!0}]);if(e.error)return e;let{removePriorValues:i,tournamentRecords:n,tournamentId:r,courtDayDate:a,matchUpId:o,courtId:s,drawId:l}=t,c=n[r];if(!c)return{error:ut};let{drawDefinition:u,event:d}=Ng({tournamentRecord:c,drawId:l});if(!u)return{error:Vt};let p=nr({drawDefinition:u,event:d,matchUpId:o});if(p.error)return p;if(((h=p==null?void 0:p.matchUp)==null?void 0:h.matchUpType)===pp){let{itemValue:f}=Rg({timeItems:p.matchUp.timeItems??[],itemType:Mf}),m=s&&f.filter(g=>g.courtId!==s);return Al({duplicateValues:!1,removePriorValues:i,tournamentRecord:c,drawDefinition:u,matchUpId:o,timeItem:{itemType:Mf,itemValue:m}})}else return QI({tournamentRecord:c,drawDefinition:u,courtDayDate:a,courtId:"",matchUpId:o})}function Qde({scheduleCompletedMatchUps:t,tournamentRecords:e,scheduledDate:i,matchUps:n}){if(!Kc(n))return{error:Re};if(n.some(({hasContext:h})=>!h))return{info:"matchUps must have { inContext: true, nextMatchUps: true }",error:Vk};let r=sP({courtCompletedMatchUps:!0,withCourtGridRows:!0,minCourtGridRows:10,tournamentRecords:e,matchUpFilters:{localPerspective:!0,scheduledDate:i}});if(r.error)return r;let{rows:a}=r,o=[],s=h=>[(h.sides||[]).map(f=>{var m;return[f.participantId,(m=f.participant)==null?void 0:m.individualParticipantIds]}),(h.potentialParticipants||[]).flat().map(f=>[f.participantId,f.individualParticipantIds])].flat(1/0).filter(Boolean),l=a==null?void 0:a.reduce((h,f)=>{let m=[],g=[];Object.values(f).forEach(y=>{if(Xi(y)&&(y.matchUpId&&(m.push(y.matchUpId),o.push(y)),y.sides)){let b=s(y);g.push(...b)}});let v=Object.values(f).filter(y=>Xi(y)&&!y.matchUpId);return h.concat({matchUpIds:m,availableCourts:v,rowId:f.rowId,participantIds:g})},[]);n.filter(({matchUpStatus:h})=>h&&h!==vn&&(t||!ba.includes(h))).sort(GI);let c=Vu({matchUps:n.concat(o),includeParticipantDependencies:!0,tournamentRecords:e}).matchUpDependencies,u=[],d=[];for(;n.length&&l.length;){let h=l.shift(),f=[];for(;n.length&&h.availableCourts.length;){let m=n.concat(f).map(D=>D.matchUpId),g=n.shift(),v=g==null?void 0:g.matchUpId,y=v&&c[v].matchUpIds.concat(c[v].dependentMatchUpIds),b=v&&m.some(D=>c[v].matchUpIds.includes(D)),I=v&&d.some(D=>c[v].dependentMatchUpIds.includes(D)),T=h.matchUpIds.some(D=>y.includes(D)),w=s(g),S=h.participantIds.some(D=>w.includes(D));if(g&&!T&&!b&&!S&&!I){let D=h.availableCourts.shift();Object.assign(g.schedule,D.schedule),Object.assign(D,g),u.push(g),h.participantIds.push(...w),h.matchUpIds.push(v)}else g&&f.push(g)}n.push(...f),d.push(...h.matchUpIds)}let p=u.map(({matchUpId:h,tournamentId:f,schedule:m,drawId:g})=>({tournamentId:f,matchUpId:h,drawId:g,schedule:{...m,scheduledDate:i}}));return r=gP({tournamentRecords:e,matchUpDetails:p}),{...r,scheduled:u,notScheduled:n}}function epe(t){let{courtDayDate:e}=t,i=di(t,[{courtAssignments:!0,[$l]:gs,[Ql]:Yt},{[zo]:!0}]);if(i.error)return i;let n=t.courtAssignments.reduce((a,o)=>{let{tournamentId:s}=o;return a[s]||(a[s]=[]),a[s].push(o),a},{}),r;return Object.keys(n).every(a=>{let o=t[zo][a];if(!o)return r={error:ut},!1;let s=n[a].reduce((l,c)=>{let{drawId:u}=c;return l[u]||(l[u]=[]),l[u].push(c),l},{});Object.keys(s).every(l=>{let{drawDefinition:c}=zs({tournamentRecord:o,drawId:l});return c?(s[l].every(u=>{let{matchUpId:d,courtId:p}=u,h=QI({tournamentRecord:o,drawDefinition:c,courtDayDate:e,matchUpId:d,courtId:p});if(h.success)return h==null?void 0:h.success;r={error:Xne}}),!0):(r={error:Vt},!1)})}),r||ce}function tpe(t){let{tournamentRecords:e,allDateMatchUpIds:i=[],averageMatchUpMinutes:n=90,recoveryMinutes:r=0,recoveryMinutesMap:a,matchUpPotentialParticipantIds:o={},individualParticipantProfiles:s={},matchUpNotBeforeTimes:l={},matchUpDailyLimits:c={},checkPotentialRequestConflicts:u=!0,remainingScheduleTimes:d,clearScheduleDates:p,periodLength:h=30,scheduleDate:f,matchUpIds:m,venueIds:g,startTime:v,endTime:y,dryRun:b}=t,I=di(t,[{[zo]:!0,[uC]:!0},{[$o]:Dl,[Ql]:Xa,[pRe]:!0},{[$o]:z=>!z||!isNaN(z),[vRe]:!1,[Ql]:Re,[yRe]:!1,[bRe]:!1}]);if(I.error)return I;let T=t.competitionMatchUps??wd({nextMatchUps:!0,tournamentRecords:e}).matchUps??[],w=t.matchUpDependencies??Vu({includeParticipantDependencies:!0,matchUps:T,tournamentRecords:e}).matchUpDependencies;T.forEach(z=>{var Z;(Z=z.schedule)!=null&&Z.scheduledDate&&vh(f,Ei(z.schedule.scheduledDate))&&bS({matchUpPotentialParticipantIds:o,matchUpNotBeforeTimes:l,matchUp:z})});let S=m.map(z=>T.find(Z=>Z.matchUpId===z)).filter(Boolean),{venueId:D,scheduleTimes:E,dateScheduledMatchUpIds:C}=GW({tournamentRecords:e,remainingScheduleTimes:d,startTime:ir(v),endTime:ir(y),scheduleDate:Ei(f),averageMatchUpMinutes:n,clearScheduleDates:p,periodLength:h,venueIds:g}),P={},R=[],N={},M={},A={};T.filter(({matchUpId:z})=>C==null?void 0:C.includes(z)).forEach(z=>{var Y;UV({matchUpPotentialParticipantIds:o,individualParticipantProfiles:s,matchUp:z,value:1});let Z=(Y=z.schedule)==null?void 0:Y.scheduledTime;if(Z){N[z.matchUpId]=Z;let Q=a==null?void 0:a[z.matchUpId];KD({recoveryMinutes:Q||r,matchUpPotentialParticipantIds:o,individualParticipantProfiles:s,matchUpNotBeforeTimes:l,averageMatchUpMinutes:n,matchUpDependencies:w,scheduleTime:Z,matchUp:z})}});let _=S.filter(z=>{let Z=C==null?void 0:C.includes(z.matchUpId),Y=[vn,Zi,jr,ol,go,hn].includes(z==null?void 0:z.matchUpStatus);return!Z&&!z.winningSide&&!Y}),{matchUpMap:x,overLimitMatchUpIds:O,participantIdsAtLimit:B}=_.reduce((z,Z)=>{let{drawId:Y,tournamentId:Q,matchUpType:X}=Z,{participantIdsAtLimit:oe,relevantParticipantIds:re}=AW({individualParticipantProfiles:s,matchUpPotentialParticipantIds:o,matchUpDailyLimits:c,matchUp:Z});return oe!=null&&oe.length?(z.overLimitMatchUpIds.push(Z.matchUpId),z.participantIdsAtLimit.push(...oe),z):(re.forEach(me=>{fP({individualParticipantProfiles:s,participantId:me});let se=s[me].counters;se[X]?se[X]+=1:se[X]=1,se[bu]?se[bu]+=1:se[bu]=1}),z.matchUpMap[Q]||(z.matchUpMap[Q]={}),z.matchUpMap[Q][Y]?z.matchUpMap[Q][Y].push(Z):z.matchUpMap[Q][Y]=[Z],bS({matchUpPotentialParticipantIds:o,matchUpNotBeforeTimes:l,matchUp:Z}),z)},{matchUpMap:{},overLimitMatchUpIds:[],participantIdsAtLimit:[]});_=_.filter(({matchUpId:z})=>!O.includes(z));let F=0,G=(E==null?void 0:E.length)??0,{personRequests:H}=Ry({tournamentRecords:e,requestType:mP});for(;E!=null&&E.length&&_.length&&F<=G;){F++;let{scheduleTime:z}=E.shift(),Z=_.find(Y=>{let{matchUpId:Q}=Y,{dependenciesScheduled:X,remainingDependencies:oe}=RW({matchUpScheduleTimes:N,matchUpDependencies:w,allDateMatchUpIds:i,matchUp:Y});if(!X)return A[Q]||(A[Q]=[]),A[Q].push({scheduleTime:z,remainingDependencies:oe}),!1;let{enoughTime:re}=NW({individualParticipantProfiles:s,matchUpNotBeforeTimes:l,matchUpDependencies:w,scheduleTime:z,matchUp:Y});if(!re)return M[Q]||(M[Q]=[]),M[Q].push({scheduleTime:z}),!1;let{conflicts:me}=MW({potentials:u,averageMatchUpMinutes:n,requestConflicts:P,personRequests:H,scheduleTime:z,scheduleDate:f,matchUp:Y});if(me!=null&&me.length)return!1;let se=a==null?void 0:a[Y.matchUpId];return KD({recoveryMinutes:se||r,matchUpPotentialParticipantIds:o,individualParticipantProfiles:s,matchUpNotBeforeTimes:l,averageMatchUpMinutes:n,matchUpDependencies:w,scheduleTime:z,matchUp:Y}),N[Y.matchUpId]=z,!0});_=_.filter(({matchUpId:Y})=>Y!==(Z==null?void 0:Z.matchUpId)),Z||R.push(z)}_.forEach(z=>{UV({individualParticipantProfiles:s,matchUpPotentialParticipantIds:o,value:-1,matchUp:z})});let $=[];Object.keys(x).forEach(z=>{let Z=e[z];Z&&Object.keys(x[z]).forEach(Y=>{let{drawDefinition:Q}=Ng({tournamentRecord:Z,drawId:Y});Q&&x[z][Y].forEach(({matchUpId:X})=>{let oe=N[X];if(oe){let re=oe.split(":").map(Tc).join(":"),me=`${Ei(f)}T${re}`;b?$.push(X):(Ag({drawDefinition:Q,matchUpId:X,scheduledTime:me}).success&&$.push(X),D&&XT({tournamentRecords:e,tournamentRecord:Z,drawDefinition:Q,matchUpId:X,venueId:D}))}})})});let q=Pz(_);return{...ce,requestConflicts:Object.values(P),remainingScheduleTimes:E==null?void 0:E.map(({scheduleTime:z})=>z),individualParticipantProfiles:s,matchUpNotBeforeTimes:l,participantIdsAtLimit:B,skippedScheduleTimes:R,overLimitMatchUpIds:O,scheduledMatchUpIds:$,noTimeMatchUpIds:q,recoveryTimeDeferred:M,dependencyDeferred:A}}function ipe({tournamentRecords:t,matchUps:e}){if(!Kc(e))return{error:Xf};if(e.some(({matchUpId:h,hasContext:f})=>h&&!f))return{info:"matchUps must have { inContext: true, nextMatchUps: true }",error:Vk};let i=Math.max(...e.map(({schedule:h})=>(h==null?void 0:h.courtOrder)||1).map(h=>ri(h))),n=Et(1,i+1).map(h=>e.filter(f=>{var m;return ri((m=f.schedule)==null?void 0:m.courtOrder)===h})),r={},a={},o={};n.flat().filter(Boolean).sort(GI).forEach(({schedule:h})=>delete h[IN]);let s=Pi(e.map(({drawId:h})=>h)),l=Vu({includeParticipantDependencies:!0,tournamentRecords:t,drawIds:s}).matchUpDependencies,c=n.map((h,f)=>h.reduce((m,g)=>{if(!g.matchUpId)return m;let{matchUpId:v,winnerMatchUpId:y,loserMatchUpId:b,schedule:I,sides:T,potentialParticipants:w}=g,S=I==null?void 0:I.courtId;r[v]=f,a[S]=[],m.matchUpIds.push(v),o[v]=g;let D=l[v].matchUpIds;D.length&&m.sourceMatchUpIds.push(...D);let E=(T==null?void 0:T.map(P=>{var R;return[(R=P.participant)==null?void 0:R.individualParticipantIds,P.participantId]}).flat().filter(Boolean))??[],C=(w==null?void 0:w.flat().map(({individualParticipantIds:P,participantId:R})=>[P,R]).flat().filter(Boolean))||[];return m.participantIds.push(...C,...E),y&&m.targetMatchUpIds.push(y),b&&m.targetMatchUpIds.push(b),m},{sourceMatchUpIds:[],targetMatchUpIds:[],participantIds:[],matchUpIds:[]})),u=(h,f)=>l[h].sources.reduce((m,g,v)=>g.includes(f)&&v+1||m,0),d=c.map(()=>[]),p=(h,f,m,g)=>{if(!o[h].schedule[IN]){o[h].schedule[IN]=f,o[h].schedule[$ae]=g,d[r[h]].push({matchUpId:h,issueType:m,issueIds:g,issue:f});let v=o[h].schedule.courtId;a[v]||(a[v]=[]),a[v].push({matchUpId:h,issue:f,issueType:m,issueIds:g})}};return c.forEach((h,f)=>{let m=f?c[f-1]:void 0,g=c.slice(f+1),v={},y=Pl(h.participantIds),b=Object.keys(y).filter(w=>y[w]>1),I=h.matchUpIds.filter(w=>l[w].participantIds.some(S=>b.includes(S)));I.forEach(w=>{v[w]||(v[w]={}),v[w][ov]||(v[w][ov]=I.filter(S=>S!==w))});let T=m&&h.participantIds.filter(w=>m.participantIds.includes(w));T&&T.forEach(w=>{let S=h.matchUpIds.concat(m.matchUpIds).filter(D=>l[D].participantIds.includes(w));S.forEach(D=>{v[D]||(v[D]={}),v[D][sv]||(v[D][sv]=S.filter(E=>E!==D))})}),h.matchUpIds.forEach(w=>{var E,C,P,R;let S=l[w].matchUpIds;for(let N of g){let M=N.matchUpIds.filter(A=>S.includes(A));M!=null&&M.length&&(M.forEach(A=>p(A,K2,Cm,[w])),p(w,K2,Cm,M))}if((E=v[w])!=null&&E[ov]&&p(w,ov,W2,v[w][ov]),h.sourceMatchUpIds.includes(w)){let N=h.matchUpIds.filter(M=>l[M].matchUpIds.includes(w));p(w,ov,Cm,N),h.matchUpIds.filter(M=>l[M].matchUpIds.includes(w)).forEach(M=>p(M,ov,Cm,[w]))}let D=(C=m==null?void 0:m.matchUpIds)==null?void 0:C.filter(N=>u(w,N)>1);if(D!=null&&D.length&&(p(w,Y2,Cm,D),D.forEach(N=>p(N,Y2,Cm,[w]))),(P=v[w])!=null&&P[sv]&&p(w,sv,W2,v[w][sv]),(R=m==null?void 0:m.targetMatchUpIds)==null?void 0:R.includes(w)){let N=o[w].schedule.courtId,M=S.filter(A=>m.matchUpIds.includes(A));M.some(A=>o[A].schedule.courtId===N)||(M.forEach(A=>p(A,sv,Cm,[w])),p(w,sv,Cm,M))}})}),{courtIssues:a,rowIssues:d}}function npe(t){let e="reorderUpcomingMatchUps",{tournamentRecords:i}=t;if(typeof i!="object"||!Object.keys(i).length)return pe({result:{error:Sr},stack:e});let{matchUpsContextIds:n,firstToLast:r}=t;if(!n)return pe({result:{error:Yt},stack:e});let a=n==null?void 0:n.length;if(!a)return{...ce};let o=0;return n.forEach((l,c)=>{let{tournamentId:u,drawId:d,matchUpId:p}=l,h=c+(r?-1:1);h<0&&(h=a-1),h===a&&(h=0);let f=n[h].schedule.scheduledTime,m=s({tournamentId:u,scheduledTime:f,matchUpId:p,drawId:d});if(m.success)o++;else return m}),o===a?ce:pe({result:{error:Zne},stack:e});function s({tournamentId:l,scheduledTime:c,matchUpId:u,drawId:d}){let p=i[l],{drawDefinition:h}=Ng({tournamentRecord:p,drawId:d});return h?Ag({drawDefinition:h,scheduledTime:c,matchUpId:u}):{error:Zl}}}function rpe(t){var l,c;let{scheduleChange:e,matchUpIds:i,dryRun:n}=t;if(!i||!Array.isArray(i))return{error:PI};if(typeof e!="object")return{error:Re};let r=qc(t),a=[],o=[];for(let u of Object.values(r)){let d=ZLe({tournamentRecord:u,scheduleChange:e,matchUpIds:i,dryRun:n});if(d.error)return d;Array.isArray(d.notRescheduled)&&o.push(...d.notRescheduled);let p=Pz(d.notRescheduled),h=[];(l=d.rescheduled)==null||l.forEach(f=>{let{matchUpId:m}=f;p.includes(m)&&h.push(m),a.push(f)}),h.length&&(o=((c=d==null?void 0:d.notRescheduled)==null?void 0:c.filter(({matchUpId:f})=>!h.includes(f)))||[])}let s=!!(a.length&&!o.length);return{...ce,rescheduled:a,notRescheduled:o,allRescheduled:s}}function ZLe({tournamentRecord:t,scheduleChange:e,matchUpIds:i,dryRun:n}){var I;if(!t)return{error:ut};if(!i||!Array.isArray(i))return{error:PI};if(typeof e!="object")return{error:Re};let r=[],a=[],{minutesChange:o,daysChange:s}=e;if(!o&&!s)return{...ce};if(o&&isNaN(o))return{error:Re};if(s&&isNaN(s))return{error:Re};let{matchUps:l}=oo({matchUpFilters:{matchUpIds:i},tournamentRecord:t}),c=({matchUpStatus:T})=>!ba.includes(T),u=l==null?void 0:l.filter(T=>oP({schedule:T.schedule})).filter(T=>c({matchUpStatus:T.matchUpStatus}));if(!(u!=null&&u.length))return{...ce};let{tournamentInfo:d}=XI({tournamentRecord:t}),{startDate:p,endDate:h}=d,f=u==null?void 0:u.reduce((T,w)=>{let{matchUpId:S,drawId:D}=w;return T[D]?T[D].push(S):T[D]=[S],T},{}),m=1440;for(let T of Object.keys(f)){let w=Ng({tournamentRecord:t,drawId:T});if(w.error)return w;let S=w.drawDefinition,D=f[T].filter(E=>i.includes(E));for(let E of D)if(E&&S){let C=(I=u.find(_=>_.matchUpId===E))==null?void 0:I.schedule,{scheduledTime:P,scheduledDate:R}=C,N,M,A;if(!N&&s&&R){let _=Ei(R);A=v1(_,s),N=new Date(A)<new Date(p)||new Date(A)>new Date(h)}if(o&&P){let _=Ei(P),x=an(ir(P))+o;if(N=x<0||x>m,!N){let O=tl(P,o),B=_&&A||R===_&&_;M=B?`${B}T${O}`:O}}if(N)a.push(E);else{if(!n){if(M){let _=Ag({scheduledTime:M,drawDefinition:S,matchUpId:E});if(_.error)return _}if(A){let _=TO({scheduledDate:A,drawDefinition:S,matchUpId:E});if(_.error)return _}}(M||A)&&r.push(E)}}}let g=oo({matchUpFilters:{matchUpIds:i},tournamentRecord:t}).matchUps??[],v=g.filter(({matchUpId:T})=>r.includes(T)),y=g.filter(({matchUpId:T})=>a.includes(T)),b=v.length&&!y.length;return{...ce,rescheduled:v,notRescheduled:y,allRescheduled:b}}function ape(t){let e="matchUpScheduleChange",{tournamentRecords:i}=t;if(typeof i!="object"||!Object.keys(i).length)return{error:Sr};let{sourceMatchUpContextIds:n,targetMatchUpContextIds:r,sourceCourtId:a,targetCourtId:o,courtDayDate:s}=t||{},{drawId:l,matchUpId:c,tournamentId:u}=n||{},{drawId:d,matchUpId:p,tournamentId:h}=r||{};if(!c&&!p)return pe({result:{error:Yt},stack:e});let{matchUps:f}=wd({matchUpFilters:{matchUpIds:[c,p].filter(Boolean),drawIds:[l,d].filter(Boolean)},tournamentRecords:t.tournamentRecords}),m=f==null?void 0:f.find(({matchUpId:I})=>I===c),g=f==null?void 0:f.find(({matchUpId:I})=>I===p),v=0;if(o&&c&&!p){let I=y({tournamentId:u,matchUpId:c,courtId:o,matchUp:m,drawId:l,tournamentRecords:i,sourceCourtId:a,courtDayDate:s});if(I!=null&&I.success&&v++,I.error)return pe({result:I,stack:e})}else if(a&&o&&c&&p){let I=y({tournamentId:u,matchUpId:c,courtId:o,matchUp:m,drawId:l,tournamentRecords:i,sourceCourtId:a,courtDayDate:s});if(I.success&&v++,I.error)return pe({result:I,stack:e,info:"source"});let T=y({tournamentId:h,sourceCourtId:o,matchUpId:p,matchUp:g,courtId:a,drawId:d,tournamentRecords:i,courtDayDate:s});if(T.success&&v++,T.error)return pe({result:T,stack:e,info:"target"})}else return{error:Yt};return v?ce:pe({result:{error:TT},stack:e});function y(I){let{tournamentRecords:T,tournamentId:w,matchUp:S,drawId:D}=I,E=T[w],{drawDefinition:C}=Ng({tournamentRecord:E,drawId:D});return S.matchUpType===Xn?b({...I,tournamentRecord:E,drawDefinition:C}):QI({...I,tournamentRecord:E,drawDefinition:C})}function b({removePriorValues:I,tournamentRecords:T,tournamentRecord:w,drawDefinition:S,sourceCourtId:D,courtDayDate:E,matchUpId:C,matchUp:P,courtId:R}){let N=[R].concat(P.schedule.allocatedCourts.map(({courtId:M})=>M).filter(M=>M!==D));return UO({removePriorValues:I,tournamentRecords:T,tournamentRecord:w,drawDefinition:S,courtDayDate:E,matchUpId:C,courtIds:N})}}function ope({scheduleAttributes:t=[Mf,Gv,xT,OT,LT,id,Nf,eh,vf],tournamentRecord:e,drawDefinition:i,matchUpId:n}){var s,l;let r="clearMatchUpSchedule",a=i?(s=ws({matchUpFilters:{matchUpIds:[n]},inContext:!1,drawDefinition:i}).matchUps)==null?void 0:s[0]:(l=oo({matchUpFilters:{matchUpIds:[n]},tournamentRecord:e,inContext:!1}).matchUps)==null?void 0:l[0];if(!a)return{error:Ho};let o=(a.timeItems??[]).filter(c=>(c==null?void 0:c.itemType)&&!t.includes(c==null?void 0:c.itemType));return a.timeItems=o,en({tournamentId:e.tournamentId,context:r,drawDefinition:i,matchUp:a}),{...ce}}function spe(t){let{tournamentRecord:e,tournamentId:i,dailyLimits:n}=t,r=t.tournamentRecords||e&&{[e.tournamentId]:e}||{};if(typeof r!="object"||!Object.keys(r).length)return{error:Sr};if(typeof n!="object")return{error:Jf};let a=Object.keys(r).filter(o=>!i||i===o);if(i&&!a.includes(i))return{error:Re};for(let o of a){let s=r[o],l=cn({extension:{name:hC,value:{dailyLimits:n}},element:s});if(l.error)return l}return{...ce}}var HW={};$i(HW,{addCollectionDefinition:()=>WW,addCollectionGroup:()=>hpe,aggregateTieFormats:()=>mpe,compareTieFormats:()=>Af,getTieFormat:()=>A3,modifyCollectionDefinition:()=>zW,modifyTieFormat:()=>fpe,mutate:()=>lpe,orderCollectionDefinitions:()=>dpe,query:()=>kce,removeCollectionDefinition:()=>qW,removeCollectionGroup:()=>upe,tieFormatGenderValidityCheck:()=>Fx,validateCollectionDefinition:()=>KC});var lpe={};$i(lpe,{addCollectionDefinition:()=>WW,addCollectionGroup:()=>hpe,aggregateTieFormats:()=>mpe,modifyCollectionDefinition:()=>zW,modifyTieFormat:()=>fpe,orderCollectionDefinitions:()=>dpe,removeCollectionDefinition:()=>qW,removeCollectionGroup:()=>upe});function Jv({drawDefinition:t,structureId:e,matchUpId:i,structure:n,matchUp:r,eventId:a,event:o}){var c;let s="getTieFormat",l;if(e=(n==null?void 0:n.structureId)??e,i=(r==null?void 0:r.matchUpId)??i,(i||e)&&!t)return{error:Vt};if(a&&o)l=Hd(o);else if(i){if(t&&(!r||!n)){let u=nr({drawDefinition:t,matchUpId:i});if(u.error)return u;if(((c=u.matchUp)==null?void 0:c.matchUpType)!==pp)return pe({result:{error:al},stack:s});n||(n=u.structure),r||(r=u.matchUp)}l=L1({item:r,drawDefinition:t,structure:n,event:o})||L1({item:n,drawDefinition:t,structure:n,event:o})||Hd(t)||Hd(o)}else if(t&&e){if(!n){let u=ui({drawDefinition:t,structureId:e});if(u.error)return u;n=u==null?void 0:u.structure}l=L1({item:n,drawDefinition:t,structure:n,event:o})||Hd(t)||Hd(o)}else l=Hd(t)||Hd(o);return l?{...ce,structure:n,tieFormat:l,matchUp:r}:pe({result:{error:IT},stack:s})}function KA({matchUp:t,updateInProgressMatchUps:e}){return!t.winningSide&&![ba].includes(t.matchUpStatus)&&(e||t.matchUpStatus!==Lu&&!Pa(t))}function GB({from:t,to:e}){let i=Object.keys(t),n=zr(i,Object.keys(e)).length===i.length,r=i.filter(o=>t[o]!==e[o]).map(o=>({countChange:e[o]-t[o],collectionId:o})),a=i.every(o=>t[o]===e[o]);return{equivalent:n&&a,matchUpsCountChanges:r}}function XLe({updateInProgressMatchUps:t,tournamentRecord:e,drawDefinition:i,structure:n,tieFormat:r,eventId:a,matchUp:o,event:s,uuids:l}){var w,S,D,E;let c="updateTieFormat",u=e==null?void 0:e.tournamentId,d=0,p=0,h=0,f=0,m=r==null?void 0:r.collectionDefinitions.reduce((C,P)=>(C[P.collectionId]=(C[P.collectionId]||0)+P.matchUpCount,C),{}),g=({tieFormat:C})=>{let P=C==null?void 0:C.collectionDefinitions.reduce((R,N)=>(R[N.collectionId]=(R[N.collectionId]||0)+N.matchUpCount,R),{});return GB({from:P,to:m}).equivalent},v=(w=Jv({drawDefinition:i}))==null?void 0:w.tieFormat,y=(S=Jv({event:s}))==null?void 0:S.tieFormat;if(s&&a){for(let C of s.drawDefinitions??[])b({drawDefinition:C});s.tieFormat=wo(r),f+=1}else if(o){if(!o.tieMatchUps)return pe({result:{error:al},stack:c});let C=Pl((D=o.tieMatchUps)==null?void 0:D.map(({collectionId:A})=>A)),P=GB({to:m,from:C}),{changes:R,changesArePossible:N,cannotChangeReaon:M}=xY({matchUp:o,check:P});if(P.equivalent)if(KA({matchUp:o,updateInProgressMatchUps:t}))o.tieFormat=wo(r),f+=1;else return pe({result:{error:$H},info:"matchUp is IN_PROGRESS or COMPLETE",stack:c});else if(N)T({tieFormat:r,matchUp:o,changes:R,uuids:l});else return pe({context:{collectionMap:m,matchUpMap:C},result:{error:mf},info:M||"specified changes not possible",stack:c});p+=1,en({eventId:s==null?void 0:s.eventId,context:c,drawDefinition:i,tournamentId:u,matchUp:o})}else if(n){let C=(E=I({inheritedTieFormat:v??y,structure:n}))==null?void 0:E.modifiedMatchUpsCount;C&&(p+=C,d+=1,f+=1);let P=!n.tieFormat||Af({ancestor:n.tieFormat,descendant:r}).different;P&&(n.tieFormat=wo(r),d+=1,f+=1),(C||P)&&i&&qn({structureIds:[n.structureId],eventId:s==null?void 0:s.eventId,drawDefinition:i})}else if(i)b({drawDefinition:i}),i.tieFormat=wo(r),f+=1;else return{error:Vt};return{modifiedStructuresCount:d,modifiedMatchUpsCount:p,addedMatchUpsCount:h,modifiedCount:f,...ce,tieFormat:r};function b({drawDefinition:C}){var N;let P=C.structures||[],R=[];for(let M of P){if(M.tieFormat)continue;let A=(N=I({inheritedTieFormat:y,structure:M}))==null?void 0:N.modifiedMatchUpsCount;if(A){d+=1,p+=A;let _=M.structureId;R.push(_)}}return qn({structureIds:R,eventId:s==null?void 0:s.eventId,drawDefinition:C}),R.length}function I({inheritedTieFormat:C,structure:P}){var M,A;let R=0,N=((M=wn({matchUpFilters:{matchUpTypes:[Xn]},structure:P}))==null?void 0:M.matchUps)||[];for(let _ of N){let x=KA({matchUp:_,updateInProgressMatchUps:t}),O=!1,B=Pl((A=_.tieMatchUps)==null?void 0:A.map(({collectionId:G})=>G)),F=GB({from:B,to:m});if(F.equivalent)_.tieFormat&&g(_)&&x&&(_.tieFormat=wo(r),O=!0);else{let{changes:G,changesArePossible:H}=xY({matchUp:_,check:F});if(H&&!_.tieFormat)T({changes:G,matchUp:_,tieFormat:r,uuids:l});else if(C)(!_.tieFormat||Af({ancestor:C,descendant:_.tieFormat}).different)&&(_.tieFormat=C,O=!0);else return pe({result:{error:IT},stack:c})}O&&(R+=1,en({tournamentId:e==null?void 0:e.tournamentId,drawDefinition:i,context:c,eventId:a,matchUp:_}))}return{modifiedMatchUpsCount:R}}function T({uuids:C,matchUp:P,tieFormat:R,changes:N}){P.tieFormat=wo(R);let M=[],A=[];return N.forEach(_=>{if(_.countChange>0){let x=Math.max(0,...P.tieMatchUps.filter(F=>F.collectionId===_.collectionId).map(Ml("collectionPosition"))),O=R.collectionDefinitions.find(F=>F.collectionId===_.collectionId),B=zC({matchUpsLimit:_.countChange,collectionPositionOffset:x,collectionDefinition:O,matchUp:P,uuids:C});A.push(...Ot(B,!1,!0)),h+=A.length,P.tieMatchUps.push(...B)}else{let x=_.toBePlayedTieMatchUpIds.slice(0,Math.abs(_.countChange));console.log("remove",x.length),M.push(...x),P.tieMatchUps=P.tieMatchUps.filter(({matchUpId:O})=>!x.includes(O))}}),A.length&&Km({matchUps:A,drawDefinition:i,tournamentId:u,eventId:a}),M.length&&Qf({matchUpIds:M,action:"updateTieFormat",drawDefinition:i,tournamentId:u,eventId:a}),{matchUpIdsRemoved:M,matchUpsAdded:A}}}function xY({check:t,matchUp:e}){let i="",n=[];return{changesArePossible:t.matchUpsCountChanges.every(({collectionId:r,countChange:a})=>{let o=e.tieMatchUps.filter(l=>l.collectionId===r&&l.matchUpStatus===qr).map(Ml("matchUpId")),s=o.length+a>=0||a>0;return!s&&a<0&&(i="Insufficient TO_BE_PLAYED matchUps"),n.push({toBePlayedTieMatchUpIds:o,collectionId:r,countChange:a}),s}),changes:n,cannotChangeReaon:i}}function kO({appliedPolicies:t,drawDefinition:e,auditData:i}){var a;if(!((a=t==null?void 0:t.audit)!=null&&a[k1]))return;let{extension:n}=Ri({name:k1,element:e}),r={value:Array.isArray(n==null?void 0:n.value)?n==null?void 0:n.value.concat(i):[i],name:k1};cn({element:e,extension:r})}function zW({updateInProgressMatchUps:t=!1,tournamentRecord:e,collectionOrder:i,collectionName:n,tieFormatName:r,drawDefinition:a,matchUpFormat:o,matchUpCount:s,collectionId:l,matchUpType:c,structureId:u,matchUpId:d,category:p,eventId:h,gender:f,event:m,collectionValueProfiles:g,collectionValue:v,matchUpValue:y,scoreValue:b,setValue:I}){let T="modifyCollectionDefinition";if(o&&!Nl({matchUpFormat:o}))return pe({result:{error:Re},context:{matchUpFormat:o},stack:T});if(n&&typeof n!="string")return pe({result:{error:Re},context:{collectionName:n},stack:T});if(f&&!Object.values(Mp).includes(f))return pe({result:{error:Re},context:{gender:f},stack:T});if(p&&typeof p!="object")return pe({result:{error:Re},context:{category:p},stack:T});let w={collectionValueProfiles:g,collectionValue:v,matchUpValue:y,scoreValue:b,setValue:I};if(!Object.values(w).filter(Boolean).length&&!i&&!n&&!o&&!s&&!c)return pe({result:{error:Yt},stack:T});if(Object.values(w).filter(Boolean).length>1)return pe({info:"Only one value assignment allowed per collectionDefinition",result:{error:Re},stack:T});let S=Jv({drawDefinition:a,structureId:u,matchUpId:d,eventId:h,event:m});if(S.error)return pe({result:S,stack:T});let{matchUp:D,structure:E,tieFormat:C}=S,P=wo(C),R=C==null?void 0:C.collectionDefinitions.find($=>$.collectionId===l),N=P==null?void 0:P.collectionDefinitions.find($=>$.collectionId===l);if(!R)return pe({info:"source collectionDefinition",result:{error:no},context:{collectionId:l},stack:T});let M=v??y??b??I;if(g!=null&&g.length){let $=gse({matchUpCount:s??(R==null?void 0:R.matchUpCount)??0,collectionValueProfiles:g});if($.errors)return pe({result:{error:Re},info:$.errors,stack:T})}else if(M&&!yi(M))return pe({result:{error:Re},info:"value is not an integer",context:{value:M},stack:T});let A=($,q)=>zr(Object.keys($),Object.keys(q)).length===Object.keys($).length&&zr(Object.values($),Object.values(q)).length===Object.values($).length,_=g&&(!R.collectionValueProfiles||!A(R.collectionValueProfiles,g)),x=yi(v)&&R.collectionValue!==v||yi(y)&&R.matchUpValue!==y||yi(b)&&R.scoreValue!==b||yi(I)&&R.setValue!==I||_,O=[];if(x&&(N.collectionValueProfiles=void 0,N.collectionValue=void 0,N.matchUpValue=void 0,N.scoreValue=void 0,N.setValue=void 0,Object.assign(N,w),O.push({collectionId:l,...zt(w)})),(yi(b)||yi(I))&&N.collectionGroupNumber){let $=N.collectionGroupNumber;P.collectionDefinitions=P.collectionDefinitions.map(q=>{let{collectionGroupNumber:z,...Z}=q;return z===$?Z:q}),P.collectionGroups=P.collectionGroups.filter(({groupNumber:q})=>q!==$),O.push({collectionId:l,change:"collectionGroupNumber removed"})}let{aggregateValue:B,valueGoal:F}=JI(P),G=zt({aggregateValue:B,valueGoal:F});if((G.aggregateValue!==(C==null?void 0:C.winCriteria.aggregateValue)||G.valueGoal!==(C==null?void 0:C.winCriteria.valueGoal))&&(P.winCriteria=G,O.push({collectionId:l,winCriteria:G})),yi(i)&&R.collectionOrder!==i&&(N.collectionOrder=i,O.push({collectionId:l,collectionOrder:i})),n&&R.collectionName!==n&&(N.collectionName=n,O.push({collectionId:l,collectionName:n})),o&&R.matchUpFormat!==o&&(N.matchUpFormat=o,O.push({collectionId:l,matchUpFormat:o})),yi(s)&&R.matchUpCount!==s&&(N.matchUpCount=s,O.push({collectionId:l,matchUpCount:s})),c&&R.matchUpType!==c)return pe({result:{error:Hk},context:{matchUpType:c},stack:T});p&&R.category!==p&&(N.category=p,O.push({collectionId:l,category:p})),f&&R.gender!==f&&(N.gender=f,O.push({collectionId:l,gender:f}));let H=zt(P);if(S=ll({tieFormat:H}),S.error)return pe({result:S,stack:T});if(!O.length)return pe({result:{...ce,modifications:O}});if((C==null?void 0:C.tieFormatName)!==r?(H.tieFormatName=r,O.push({tieFormatName:r})):O.length&&(delete H.tieFormatName,O.push("tieFormatName removed: modifications without new tieFormatName")),S=XLe({tieFormat:H,updateInProgressMatchUps:t,tournamentRecord:e,drawDefinition:a,structure:E,eventId:h,matchUp:D,event:m}),!S.error){let{appliedPolicies:$}=dn({tournamentRecord:e}),q=zt({collectionDefinition:N,drawId:a==null?void 0:a.drawId,action:T,structureId:u,matchUpId:d,eventId:h});kO({appliedPolicies:$,drawDefinition:a,auditData:q})}return pe({result:{...S,modifications:O},stack:T})}function JLe({updateInProgressMatchUps:t,drawDefinition:e,structureId:i,structure:n,matchUpId:r,matchUp:a}){var s,l;let o=[];return r&&a?o=[a]:i&&n?o=((s=wn({matchUpFilters:{matchUpTypes:[Xn]},structure:n}))==null?void 0:s.matchUps)??[]:e&&(o=((l=ws({matchUpFilters:{matchUpTypes:[Xn]},drawDefinition:e}))==null?void 0:l.matchUps)??[]),{targetMatchUps:o.filter(c=>!c.winningSide&&c.matchUpStatus!==jr&&(t||c.matchUpStatus!==Lu&&!Pa(c)))}}function QLe({updateInProgressMatchUps:t,tournamentRecord:e,drawDefinition:i,targetMatchUps:n,tieFormat:r,event:a}){for(let o of n){let s=!!o.tieFormat;s&&(o.tieFormat=wo(r));let l;if(t){let c=dn({tournamentRecord:e,drawDefinition:i,event:a}).appliedPolicies,u=im({matchUpId:o.matchUpId,exitWhenNoValues:!0,tournamentRecord:e,appliedPolicies:c,drawDefinition:i,event:a});if(u.error)return u;l=u.score}s&&!l&&en({tournamentId:e==null?void 0:e.tournamentId,context:"updateTargetTeamMatchUps",eventId:a==null?void 0:a.eventId,matchUp:o,drawDefinition:i})}return{...ce}}function cpe({updateInProgressMatchUps:t,originalValueGoal:e,tournamentRecord:i,wasAggregateValue:n,tieFormatName:r,drawDefinition:a,structureId:o,structure:s,tieFormat:l,matchUpId:c,matchUp:u,eventId:d,event:p}){let{aggregateValue:h,valueGoal:f}=JI(l);l.winCriteria=zt({aggregateValue:h,valueGoal:f}),(e&&e!==f||h&&!n)&&(r?l.tieFormatName=r:delete l.tieFormatName);let{targetMatchUps:m}=JLe({updateInProgressMatchUps:t,drawDefinition:a,structureId:o,structure:s,matchUpId:c,matchUp:u});QLe({updateInProgressMatchUps:t,tournamentRecord:i,targetMatchUps:m,drawDefinition:a,tieFormat:l,event:p});let g=zt(l),v=ll({tieFormat:g});if(v.error)return v;if(d&&p)p.tieFormat=g;else if(c&&u)u.tieFormat=l;else if(s)s.tieFormat=g;else if(a)a.tieFormat=g;else if(!u||!a)return{error:Vt};return qn({drawDefinition:a,eventId:p==null?void 0:p.eventId}),{...ce}}function upe({updateInProgressMatchUps:t=!0,collectionGroupNumber:e,tournamentRecord:i,drawDefinition:n,tieFormatName:r,structureId:a,matchUpId:o,matchUp:s,eventId:l,event:c}){if(!e)return{error:Yt};if(isNaN(e))return{error:Re};let u="removeCollectionGroup",d=s?void 0:Jv({drawDefinition:n,structureId:a,matchUpId:o,eventId:l,event:c});if(d!=null&&d.error)return pe({result:d,stack:u});let p=d==null?void 0:d.structure;s=s??(d==null?void 0:d.matchUp);let h=d==null?void 0:d.tieFormat,f=h==null?void 0:h.winCriteria.valueGoal,m=h==null?void 0:h.winCriteria.aggregateValue,g=wo(h);if(d=ll({tieFormat:g}),d.error)return pe({result:d,stack:u});let v=[];if(g.collectionDefinitions=g.collectionDefinitions.map(y=>{let{collectionGroupNumber:b,...I}=y;return b!==e?y:(v.push(y.collectionId),I)}),g.collectionGroups=g.collectionGroups.filter(({groupNumber:y})=>y!==e),d=cpe({updateInProgressMatchUps:t,originalValueGoal:f,wasAggregateValue:m,tournamentRecord:i,drawDefinition:n,tieFormatName:r,structureId:a,structure:p,tieFormat:g,matchUpId:o,matchUp:s,eventId:l,event:c}),!d.error){let{appliedPolicies:y}=dn({tournamentRecord:i}),b=zt({drawId:n==null?void 0:n.drawId,collectionGroupNumber:e,action:u,structureId:a,matchUpId:o,eventId:l});kO({appliedPolicies:y,drawDefinition:n,auditData:b})}return pe({result:{...d,modifiedCollectionIds:v},stack:u})}function IS({tieFormat:t,orderMap:e}){var n;let i=wo(t);return i.collectionDefinitions.forEach(r=>{let a=e[r.collectionId];a&&(r.collectionOrder=a)}),(n=i.collectionDefinitions)==null||n.sort((r,a)=>tS(r.collectionOrder)-tS(a.collectionOrder)),i}function dpe({tournamentRecord:t,drawDefinition:e,structureId:i,matchUpId:n,orderMap:r,eventId:a,matchUp:o,event:s}){if(typeof r!="object"||!Object.values(r).every(l=>yi(l)))return pe({result:{error:Re},context:{orderMap:r}});if(a&&(s!=null&&s.tieFormat))OY({tournamentRecord:t,event:s,orderMap:r});else if(n){let l=e&&nr({drawDefinition:e,matchUpId:n});if(l!=null&&l.error)return l;if(o=l.matchUp,!o)return{error:rl};o!=null&&o.tieFormat&&(o.tieFormat=IS({tieFormat:o.tieFormat,orderMap:r}),en({tournamentId:t==null?void 0:t.tournamentId,eventId:s==null?void 0:s.eventId,drawDefinition:e,matchUp:o}))}else if(i){let l=ui({drawDefinition:e,structureId:i});if(l.error)return l;let c=l.structure;if(c!=null&&c.tieFormat)c.tieFormat=IS({tieFormat:c.tieFormat,orderMap:r}),ppe({eventId:s==null?void 0:s.eventId,tournamentRecord:t,drawDefinition:e,structure:c,orderMap:r}),qn({drawDefinition:e,structureIds:[c.structureId]});else if(e.tieFormat)EV({structureIds:[i],tournamentRecord:t,drawDefinition:e,orderMap:r,event:s});else if(s!=null&&s.tieFormat)OY({structureIds:[i],tournamentRecord:t,orderMap:r,event:s});else return{error:no}}else if(e!=null&&e.tieFormat)EV({tournamentRecord:t,drawDefinition:e,orderMap:r,event:s});else return{error:no};return{...ce}}function OY({tournamentRecord:t,structureIds:e,orderMap:i,event:n}){let r=IS({tieFormat:n.tieFormat,orderMap:i});e!=null&&e.length||(n.tieFormat=r);for(let a of n.drawDefinitions??[])EV({tournamentRecord:t,drawDefinition:a,structureIds:e,orderMap:i,event:n})}function EV({tournamentRecord:t,drawDefinition:e,structureIds:i,orderMap:n,event:r}){let a=e.tieFormat??(r==null?void 0:r.tieFormat),o=IS({tieFormat:a,orderMap:n});i!=null&&i.length||(e.tieFormat=o);let s=[];for(let l of e.structures??[])i!=null&&i.length&&!i.includes(l.structureId)||((l.tieFormat||i!=null&&i.includes(l.structureId))&&(l.tieFormat=IS({tieFormat:l.tieFormat??e.tieFormat??(r==null?void 0:r.tieFormat),orderMap:n})),ppe({eventId:r==null?void 0:r.eventId,tournamentRecord:t,drawDefinition:e,structure:l,orderMap:n}),s.push(l.structureId));qn({drawDefinition:e,structureIds:s})}function ppe({tournamentRecord:t,drawDefinition:e,structure:i,orderMap:n,eventId:r}){var o;let a=(o=wn({matchUpFilters:{matchUpTypes:[Xn]},structure:i}))==null?void 0:o.matchUps;for(let s of a)s.tieFormat&&(s.tieFormat=IS({tieFormat:s.tieFormat,orderMap:n}),en({tournamentId:t==null?void 0:t.tournamentId,drawDefinition:e,eventId:r,matchUp:s}))}function qW({updateInProgressMatchUps:t=!0,tieFormatComparison:e,tournamentRecord:i,drawDefinition:n,tieFormatName:r,collectionId:a,structureId:o,matchUpId:s,eventId:l,matchUp:c,event:u}){var P,R,N,M,A;let d="removeCollectionDefinition",p=c?void 0:Jv({drawDefinition:n,structureId:o,matchUpId:s,eventId:l,event:u});if(p!=null&&p.error)return pe({result:p,stack:d});let h=p==null?void 0:p.structure;c=c??(p==null?void 0:p.matchUp);let f=p==null?void 0:p.tieFormat,m=wo(f);if(p=ll({tieFormat:m}),p.error)return pe({result:p,stack:d});let g=(P=m==null?void 0:m.collectionDefinitions)==null?void 0:P.find(_=>_.collectionId===a);if(!g)return pe({result:{error:no,collectionId:a}});m.collectionDefinitions=m.collectionDefinitions.filter(_=>_.collectionId!==a),g.collectionGroupNumber&&(m.collectionDefinitions=m.collectionDefinitions.map(_=>{let{collectionGroupNumber:x,...O}=_;return O}),m.collectionGroups=m.collectionGroups.filter(({groupNumber:_})=>_!==g.collectionGroupNumber));let{aggregateValue:v,valueGoal:y}=JI(m);m.winCriteria=zt({aggregateValue:v,valueGoal:y});let b=f==null?void 0:f.winCriteria.valueGoal,I=f==null?void 0:f.winCriteria.aggregateValue;(b&&b!==y||v&&!I)&&(r?m.tieFormatName=r:delete m.tieFormatName);let T=[];s&&c?T=[c]:o&&h?T=((R=wn({matchUpFilters:{matchUpTypes:[Xn]},structure:h}))==null?void 0:R.matchUps)??[]:n?T=((N=ws({matchUpFilters:{matchUpTypes:[Xn]},drawDefinition:n}))==null?void 0:N.matchUps)??[]:u&&(T=((M=xh({matchUpFilters:{matchUpTypes:[Xn]},drawDefinition:n}))==null?void 0:M.matchUps)??[]);let w=(T||[]).filter(_=>{var B,F,G;let x=(F=(B=_.tieMatchUps)==null?void 0:B.filter(H=>H.collectionId===a))==null?void 0:F.some(Pa),O=e&&_.tieFormat?(G=Af({descendant:_.tieFormat,ancestor:m}))==null?void 0:G.different:!1;return t&&!x||!_.winningSide&&_.matchUpStatus!==jr&&(t||_.matchUpStatus!==Lu&&!Pa(_)&&!O)});if(!w.length)return{error:TT};let{appliedPolicies:S}=dn({tournamentRecord:i});if(s&&c&&t){let _=(A=c.tieMatchUps)==null?void 0:A.filter(x=>x.collectionId===a);for(let x of _??[]){let O=pP({matchUpId:x.matchUpId,tieMatchUpId:c==null?void 0:c.matchUpId,winningSide:void 0,removeScore:!0,tournamentRecord:i,appliedPolicies:S,drawDefinition:n,event:u});if(O.error||(O=nr({drawDefinition:n,matchUpId:s}),O.error))return O;c=O==null?void 0:O.matchUp}}let D=[];for(let _ of w){for(let x of(_==null?void 0:_.sides)??[])x.lineUp=(x.lineUp??[]).map(O=>({participantId:O.participantId,collectionAssignments:((O==null?void 0:O.collectionAssignments)??[]).filter(B=>B.collectionId!==a)}));if(_.tieMatchUps=(_.tieMatchUps??[]).filter(x=>{let O=x.collectionId===a;return O&&D.push(x.matchUpId),!O}),_.tieFormat&&(_.tieFormat=wo(m)),t){let x=im({matchUpId:_.matchUpId,exitWhenNoValues:!0,tournamentRecord:i,appliedPolicies:S,drawDefinition:n,event:u});if(x.error)return x}en({tournamentId:i==null?void 0:i.tournamentId,eventId:u==null?void 0:u.eventId,drawDefinition:n,context:d,matchUp:_})}D.length&&Qf({tournamentId:i==null?void 0:i.tournamentId,matchUpIds:D,eventId:u==null?void 0:u.eventId,drawDefinition:n});let E=zt(m);if(p=ll({tieFormat:E}),p.error)return pe({result:p,stack:d});if(l&&u)u.tieFormat=E;else if(s&&c)c.tieFormat=E;else if(h)h.tieFormat=E;else if(n)n.tieFormat=E;else if(!c||!n)return{error:Vt};qn({drawDefinition:n,eventId:u==null?void 0:u.eventId});let C=zt({drawId:n==null?void 0:n.drawId,action:d,collectionId:a,structureId:o,matchUpId:s,eventId:l});return kO({appliedPolicies:S,drawDefinition:n,auditData:C}),{tieFormat:E,deletedMatchUpIds:D,targetMatchUps:w,...ce}}function hpe({updateInProgressMatchUps:t=!0,tournamentRecord:e,groupDefinition:i,drawDefinition:n,collectionIds:r,tieFormatName:a,structureId:o,matchUpId:s,matchUp:l,eventId:c,event:u}){let d="addCollectionGroup";if(!Array.isArray(r))return pe({result:{error:Yt},stack:d});let p=l?void 0:Jv({drawDefinition:n,structureId:o,matchUpId:s,eventId:c,event:u});if(p!=null&&p.error)return pe({result:p,stack:d});let h=p==null?void 0:p.structure;l=l||(p==null?void 0:p.matchUp);let f=p==null?void 0:p.tieFormat,m=f==null?void 0:f.winCriteria.valueGoal,g=wo(f);if(p=ll({tieFormat:g}),p.error)return pe({result:p,stack:d});for(let y of g.collectionDefinitions){let{collectionId:b,collectionGroupNumber:I}=y;if(I&&r.includes(b))return pe({info:"collectionIds cannot be part of other collectionGroups",result:{error:Re},stack:d})}let v=(g.collectionGroups||[]).reduce((y,b)=>b.groupNumber>y?b.groupNumber:y,0)+1;return i.groupNumber=v,g.collectionDefinitions=g.collectionDefinitions.map(y=>r.includes(y.collectionId)?{...y,collectionGroupNumber:v}:y),g.collectionGroups=[...g.collecitonGroups||[],i],cpe({updateInProgressMatchUps:t,originalValueGoal:m,tournamentRecord:e,drawDefinition:n,tieFormatName:a,structureId:o,structure:h,tieFormat:g,matchUpId:s,matchUp:l,eventId:c,event:u})}function WW({updateInProgressMatchUps:t=!0,collectionDefinition:e,referenceCategory:i,tournamentRecord:n,policyDefinitions:r,enforceCategory:a,referenceGender:o,drawDefinition:s,tieFormatName:l,enforceGender:c,structureId:u,matchUpId:d,matchUp:p,eventId:h,uuids:f,event:m}){var F,G;let g="addCollectionDefinition",v=dn({tournamentRecord:n,drawDefinition:s,event:m}).appliedPolicies??{},y=(r==null?void 0:r[Qa])??(v==null?void 0:v[Qa]);a=a??((F=y==null?void 0:y.participants)==null?void 0:F.enforceCategory);let b=(c??((G=y==null?void 0:y.participants)==null?void 0:G.enforceGender))!==!1,I=!!((i??(m==null?void 0:m.category))&&a!==!1),T=!!((o??(m==null?void 0:m.gender))&&b),w=KC({referenceCategory:i??(m==null?void 0:m.category),collectionDefinition:e,referenceGender:o,checkCategory:I,checkGender:T,event:m});if(w.error)return pe({result:w,stack:g});let S=p!=null&&p.tieFormat?void 0:Jv({drawDefinition:s,structureId:u,matchUpId:d,eventId:h,event:m});if(S!=null&&S.error)return pe({result:{error:S.error},stack:g});let D=S==null?void 0:S.structure;p=p??(S==null?void 0:S.matchUp);let E=(p==null?void 0:p.tieFormat)??(S==null?void 0:S.tieFormat),C=wo(E);if(S=ll({tieFormat:C}),S==null?void 0:S.error)return pe({result:{error:S.error},stack:g});if(!e.collectionId)e.collectionId=Pn();else if(C.collectionDefinitions.map(({collectionId:H})=>H).includes(e.collectionId))return pe({context:{collectionId:e.collectionId},result:{error:ere}});C.collectionDefinitions.push(e),C.collectionDefinitions.sort((H,$)=>(H.collectionOrder||0)-($.collectionOrder||0)).forEach((H,$)=>H.collectionOrder=$+1);let{aggregateValue:P,valueGoal:R}=JI(C);C.winCriteria=zt({aggregateValue:P,valueGoal:R});let N=E==null?void 0:E.winCriteria.valueGoal,M=E==null?void 0:E.winCriteria.aggregateValue;(N&&N!==R||P&&!M)&&(l?C.tieFormatName=l:delete C.tieFormatName);let A=[],_=[],x=[],O=zt(C);if(S=ll({tieFormat:O}),S==null?void 0:S.error)return pe({result:{error:S.error},stack:g});if(h&&m){m.tieFormat=O;for(let H of m.drawDefinitions??[])if(!H.tieFormat)for(let $ of H.structures??[]){if($.tieFormat)continue;let q=HB({updateInProgressMatchUps:t,collectionDefinition:e,structure:$,uuids:f});_.push(...q.newMatchUps),x.push(...q.targetMatchUps),A.push($.structureId)}wM({modifiedMatchUps:x,eventId:m==null?void 0:m.eventId,modifiedStructureIds:A,tournamentRecord:n,drawDefinition:s,addedMatchUps:_,stack:g})}else if(u&&D){D.tieFormat=O;let H=HB({updateInProgressMatchUps:t,collectionDefinition:e,structure:D,uuids:f});_.push(...H.newMatchUps),x=H.targetMatchUps,wM({modifiedMatchUps:x,eventId:m==null?void 0:m.eventId,modifiedStructureIds:A,tournamentRecord:n,drawDefinition:s,addedMatchUps:_,stack:g})}else if(d&&p){if(!KA({matchUp:p,updateInProgressMatchUps:t}))return pe({result:{error:$H},stack:g});p.tieFormat=O;let H=zC({collectionDefinition:e,matchUp:p,uuids:f});Array.isArray(p.tieMatchUps)||(p.tieMatchUps=[]),p.tieMatchUps.push(...H),_.push(...H),wM({modifiedMatchUps:[p],eventId:m==null?void 0:m.eventId,modifiedStructureIds:A,tournamentRecord:n,drawDefinition:s,addedMatchUps:_,stack:g})}else if(s){s.tieFormat=O;for(let H of s.structures??[]){let $=HB({updateInProgressMatchUps:t,collectionDefinition:e,structure:H,uuids:f});A.push(H.structureId),_.push(...$.newMatchUps),x.push(...$.targetMatchUps)}wM({modifiedMatchUps:x,eventId:m==null?void 0:m.eventId,tournamentRecord:n,drawDefinition:s,addedMatchUps:_,stack:g})}else return{error:Vt};let B=zt({drawId:s==null?void 0:s.drawId,collectionDefinition:e,action:g,structureId:u,matchUpId:d,eventId:h});return kO({appliedPolicies:v,drawDefinition:s,auditData:B}),{tieFormat:O,targetMatchUps:x,addedMatchUps:_,...ce}}function HB({updateInProgressMatchUps:t,collectionDefinition:e,structure:i,uuids:n}){var o;let r=[],a=((o=wn({matchUpFilters:{matchUpTypes:[Xn]},structure:i}))==null?void 0:o.matchUps).filter(s=>KA({matchUp:s,updateInProgressMatchUps:t})&&!s.tieFormat);for(let s of a){let l=zC({collectionDefinition:e,matchUp:s,uuids:n});Array.isArray(s.tieMatchUps)||(s.tieMatchUps=[]),s.tieMatchUps.push(...l),r.push(...l)}return{newMatchUps:r,targetMatchUps:a}}function wM({modifiedStructureIds:t,tournamentRecord:e,modifiedMatchUps:i,drawDefinition:n,addedMatchUps:r,eventId:a,stack:o}){Km({tournamentId:e==null?void 0:e.tournamentId,matchUps:r,drawDefinition:n,eventId:a}),i==null||i.forEach(s=>{en({tournamentId:e==null?void 0:e.tournamentId,drawDefinition:n,context:o,matchUp:s,eventId:a})}),qn({structureIds:t,drawDefinition:n,eventId:a})}function fpe({updateInProgressMatchUps:t=!1,tieFormatComparison:e,modifiedTieFormat:i,tournamentRecord:n,considerations:r,drawDefinition:a,structureId:o,matchUpId:s,eventId:l,uuids:c,event:u}){let d="modifyTieFormat";if(!ll({tieFormat:i}).valid)return pe({result:{error:mf},info:"falied validation",stack:d});let p=Jv({drawDefinition:a,structureId:o,matchUpId:s,eventId:l,event:u});if(p.error)return pe({result:p,stack:d});let{matchUp:h,tieFormat:f}=p,m=wo(f),g=Af({descendant:i,ancestor:m,considerations:r});if(g.invalid)return pe({context:{invalid:g.invalid},result:{error:mf},stack:d});if(!(g!=null&&g.different))return pe({result:{...ce},info:"Nothing to do",stack:d});let v=m.collectionDefinitions.map(({collectionId:E})=>E),y=i.collectionDefinitions.map(({collectionId:E})=>E),b=v.filter(E=>!y.includes(E)),I=i.collectionDefinitions.filter(({collectionId:E})=>!v.includes(E)),T=I.map(Ml("collectionId")),w=[],S,D=i.tieFormatName;for(let E of i.collectionDefinitions){if(T.includes(E.collectionId))continue;let C=zW({updateInProgressMatchUps:t,...E,tournamentRecord:n,tieFormatName:D,drawDefinition:a,structureId:o,matchUpId:s,eventId:l,event:u});if(C.modifications&&w.push(...C.modifications),C.error)return pe({result:C,stack:d});C.tieFormat&&(S=C.tieFormat)}for(let E of I){let C=WW({updateInProgressMatchUps:t,collectionDefinition:E,tournamentRecord:n,drawDefinition:a,tieFormatName:D,structureId:o,matchUpId:s,matchUp:h,eventId:l,uuids:c,event:u});if(C.error)return pe({result:C,stack:d});C.tieFormat&&(S=C.tieFormat)}for(let E of b){let C=qW({updateInProgressMatchUps:t,tieFormatComparison:e,tournamentRecord:n,drawDefinition:a,tieFormatName:D,collectionId:E,structureId:o,matchUpId:s,eventId:l,matchUp:h,event:u});if(C.error)return pe({result:C,stack:d});C.tieFormat&&(S=C.tieFormat)}return(f==null?void 0:f.tieFormatName)!==D?(S.tieFormatName=D,w.push({tieFormatName:D})):(w.length||T.length||b.length)&&(delete S.tieFormatName,w.push("tieFormatName removed: modifications without new tieFormatName")),S.collectionDefinitions=S.collectionDefinitions.sort((E,C)=>tS(E.collectionOrder)-tS(C.collectionOrder)).map((E,C)=>({...E,collectionOrder:C+1})),{processedTieFormat:wo(S),modifications:w,...ce}}function mpe({tournamentRecord:t}){if(!t)return{error:ut};let e=0;for(let i of t.events??[]){let n=i.tieFormats??[],r=u=>{if(!u.tieFormat)return;let d;for(let p of n)Af({descendant:u.tieFormat,ancestor:p}).different||(d=p.tieFormatId);if(d)u.tieFormatId=d,delete u.tieFormat;else{let p=Ot(u.tieFormat,void 0,!0);p.tieFormatId||(p.tieFormatId=Pn()),u.tieFormatId=p.tieFormatId,delete u.tieFormat,n.push(p),e+=1}},a=i.eventType;r({tieFormat:i.tieFormat,eventType:a});for(let u of i.drawDefinitions??[]){r({tieFormat:u.tieFormat,eventType:a});for(let d of u.structures??[])r({tieFormat:d.tieFormat,eventType:a})}let o=(u,d)=>{var h;let p=(h=l.matchUps)==null?void 0:h.find(f=>f.matchUpId===u);p&&(p.tieFormatId=d,delete p.tieFormat,en({tournamentId:t==null?void 0:t.tournamentId,eventId:i.eventId,matchUp:p}))},s=u=>{let d=Ot(u.tieFormat,void 0,!0);d.tieFormatId||(d.tieFormatId=Pn()),n.push(d),e+=1,o(u.matchUpId,d.tieFormatId)},l=xh({matchUpFilters:{matchUpTypes:[pp]},event:i}),c=l.matchUps??[];for(let u of c){let d;for(let p of n)u.tieFormat&&Af({descendant:u.tieFormat,ancestor:p}).different||(d=p.tieFormatId);d?o(u.matchUpId,d):s(u)}n.length&&(i.tieFormats=n)}return{...ce,addedCount:e}}var KW={};$i(KW,{addDrawDefinitionExtension:()=>ox,addEventExtension:()=>Ug,addEventTimeItem:()=>YI,addExtension:()=>cn,addNotes:()=>Ox,addOnlineResource:()=>Ipe,addParticipantExtension:()=>Wre,addParticipantTimeItem:()=>Kq,addTimeItem:()=>Np,addTournamentExtension:()=>Tz,addTournamentTimeItem:()=>XC,analyzeDraws:()=>JC,analyzeTournament:()=>M3,createTournamentRecord:()=>MO,generate:()=>gpe,getAllowedDrawTypes:()=>eO,getAllowedMatchUpFormats:()=>C3,getAppliedPolicies:()=>dn,getCompetitionDateRange:()=>iO,getCompetitionPenalties:()=>P3,getPolicyDefinitions:()=>em,getTournamentInfo:()=>XI,getTournamentPenalties:()=>tO,getTournamentPersons:()=>R3,getTournamentStructures:()=>Rq,getTournamentTimeItem:()=>vx,mutate:()=>vpe,query:()=>Ace,removeDrawDefinitionExtension:()=>Kre,removeEventExtension:()=>sx,removeExtension:()=>Is,removeNotes:()=>Hq,removeOnlineResource:()=>bpe,removeParticipantExtension:()=>Yre,removeTournamentExtension:()=>Uz,setTournamentCategories:()=>Tpe,setTournamentDates:()=>xO,setTournamentEndDate:()=>Dpe,setTournamentName:()=>wpe,setTournamentNotes:()=>Spe,setTournamentStartDate:()=>Upe,setTournamentStatus:()=>ype});var gpe={};$i(gpe,{createTournamentRecord:()=>MO});var vpe={};$i(vpe,{addDrawDefinitionExtension:()=>ox,addEventExtension:()=>Ug,addEventTimeItem:()=>YI,addExtension:()=>cn,addNotes:()=>Ox,addOnlineResource:()=>Ipe,addParticipantExtension:()=>Wre,addParticipantTimeItem:()=>Kq,addTimeItem:()=>Np,addTournamentExtension:()=>Tz,addTournamentTimeItem:()=>XC,removeDrawDefinitionExtension:()=>Kre,removeEventExtension:()=>sx,removeExtension:()=>Is,removeNotes:()=>Hq,removeOnlineResource:()=>bpe,removeParticipantExtension:()=>Yre,removeTournamentExtension:()=>Uz,setTournamentCategories:()=>Tpe,setTournamentDates:()=>xO,setTournamentEndDate:()=>Dpe,setTournamentName:()=>wpe,setTournamentNotes:()=>Spe,setTournamentStartDate:()=>Upe,setTournamentStatus:()=>ype});var eFe="ABANDONED",tFe="ACTIVE",iFe="CANCELLED",nFe="COMPLETED",rFe="IN_PROGRESS",YW={ABANDONED:eFe,ACTIVE:tFe,CANCELLED:iFe,COMPLETED:nFe,IN_PROGRESS:rFe};function ype({tournamentRecord:t,status:e}){return t?e&&!Object.keys(YW).includes(e)?{error:Re,info:"Unknown status"}:(t.tournamentStatus=e,{...ce}):{error:ut}}function bpe(t){var c,u,d;let e=di(t,[{tournamentRecord:!0,onlineResource:!0}]);if(e.error)return e;let{tournamentRecord:i,onlineResource:n,organisationId:r,participantId:a,personId:o,courtId:s,venueId:l}=t;if(r){if(((c=i.parentOrganisation)==null?void 0:c.parentOrganisationId)!==r)return pe({result:{error:no}});Zw({element:i.parentOrganisation,onlineResource:n})}else if(a||o){let p=(i.participants??[]).find(h=>{var f;return o&&((f=h.person)==null?void 0:f.personId)===o||h.participantId===a});if(!p)return pe(o?{result:{error:no}}:{result:{error:Vr}});if(o){if(((u=p.person)==null?void 0:u.personId)!==o)return pe({result:{error:MI}});Zw({element:p.person,onlineResource:n})}else Zw({element:p,onlineResource:n})}else if(s){let p=(d=(i.venues??[]).filter(h=>!l||h.venueId===l).flatMap(h=>(h.courts??[]).filter(f=>f.courtId===s)))==null?void 0:d[0];if(!p)return pe({result:{error:ST}});Zw({element:p,onlineResource:n})}else if(l){let p=(i.venues??[]).find(h=>h.venueId===l);if(!p)return pe({result:{error:AI}});Zw({element:p,onlineResource:n})}else Zw({element:i,onlineResource:n}),wi({payload:{parentOrganisation:i.parentOrganisation,onlineResources:i.onlineResources,tournamentId:i.tournamentId},topic:wy});return{...ce}}function Zw({element:t,onlineResource:e}){let i=(t.onlineResources??[]).filter(n=>!((n==null?void 0:n[iS])===e[iS]&&(n==null?void 0:n[nS])===e[nS]&&(n==null?void 0:n[rS])===e[rS]));t.onlineResources=i}function Ipe(t){var c,u,d;let e=di(t,[{tournamentRecord:!0,onlineResource:!0}]);if(e.error)return e;let{tournamentRecord:i,onlineResource:n,organisationId:r,participantId:a,personId:o,courtId:s,venueId:l}=t;if(r){if(((c=i.parentOrganisation)==null?void 0:c.parentOrganisationId)!==r)return pe({result:{error:no}});Xw({element:i.parentOrganisation,onlineResource:n})}else if(a||o){let p=(i.participants??[]).find(h=>{var f;return o&&((f=h.person)==null?void 0:f.personId)===o||h.participantId===a});if(!p)return pe(o?{result:{error:no}}:{result:{error:Vr}});if(o){if(((u=p.person)==null?void 0:u.personId)!==o)return pe({result:{error:MI}});Xw({element:p.person,onlineResource:n})}else Xw({element:p,onlineResource:n})}else if(s){let p=(d=(i.venues??[]).filter(h=>!l||h.venueId===l).flatMap(h=>(h.courts??[]).filter(f=>f.courtId===s)))==null?void 0:d[0];if(!p)return pe({result:{error:ST}});Xw({element:p,onlineResource:n})}else if(l){let p=(i.venues??[]).find(h=>h.venueId===l);if(!p)return pe({result:{error:AI}});Xw({element:p,onlineResource:n})}else Xw({element:i,onlineResource:n}),wi({payload:{parentOrganisation:i.parentOrganisation,onlineResources:i.onlineResources,tournamentId:i.tournamentId},topic:wy});return{...ce}}function Xw({element:t,onlineResource:e}){let i=(t.onlineResources??[]).filter(n=>(n==null?void 0:n[iS])!==e[iS]&&(n==null?void 0:n[nS])!==e[nS]&&(n==null?void 0:n[rS])!==e[rS]);return i.push(e),t.onlineResources=i,{...ce}}function wpe({tournamentRecord:t,promotionalName:e,tournamentName:i,formalName:n}){if(!t)return{error:ut};let r=t.tournamentId,a={tournamentId:r};return i&&i!==t.tournamentName&&(t.tournamentName=i,a.tournamentName=i),e&&e!==t.promotionalName&&(t.promotionalName=e,a.promotionalName=e),n&&n!==t.formalName&&(t.formalName=n,a.formalName=n),t.promotionalName===t.tournamentName&&(delete t.promotionalName,a.promotionalName=""),t.formalName===t.tournamentName&&(delete t.formalName,a.formalName=""),Object.keys(a).length>1&&wi({topic:wy,payload:{parentOrganisation:t.parentOrganisation,tournamentId:r,...a}}),{...ce}}function Spe({tournamentRecord:t,notes:e}){if(!t)return{error:ut};let i=e?Ox({element:t,notes:e}):Hq({element:t});return i.error?i:(wi({topic:wy,payload:{parentOrganisation:t.parentOrganisation,tournamentId:t.tournamentId,notes:e??""}}),{...ce})}function Tpe({tournamentRecord:t,categories:e}){return t?(e=(e||[]).filter(i=>i.categoryName&&i.type),t.tournamentCategories=e,wi({topic:wy,payload:{parentOrganisation:t.parentOrganisation,tournamentId:t.tournamentId,categories:e}}),{...ce}):{error:ut}}function aFe({tournamentRecord:t}){var a,o;if(!t)return{error:ut};let{startDate:e,endDate:i}=t,n=lS(e,i),r=[];for(let s of t.venues||[])(a=s==null?void 0:s.courts)!=null&&a.length&&r.push(...s.courts);for(let s of r){let{startTime:l,endTime:c}=(s.dateAvailability??[]).reduce((p,h)=>{let f=an(p.startTime),m=an(p.endTime);return h.startTime&&an(h.startTime)<f&&(p.startTime=h.startTime),h.endTime&&an(h.endTime)>m&&(p.endTime=h.endTime),p},{startTime:"08:00",endTime:"18:00"}),u=n.map(p=>{var h;return((h=s.dateAvailability)==null?void 0:h.find(f=>f.date===p))??{date:p,startTime:l,endTime:c}}),d=(o=s.dateAvailability)==null?void 0:o.find(p=>!p.date);d&&u.unshift(d),s.dateAvailability=u}return{...ce}}function xO(t){var h;let{tournamentRecord:e,startDate:i,endDate:n,activeDates:r,weekdays:a}=t,o=di(t,[{tournamentRecord:!0},{[$o]:f=>up.test(f),[Ql]:Xa,startDate:!1,endDate:!1},{[$o]:f=>f.every(m=>up.test(m)),[Ql]:Xa,activeDates:!1},{[$o]:uue,weekdays:!1}]);if(o.error)return o;if(n&&i&&new Date(n)<new Date(i))return{error:Re};if(n&&i&&new Date(i)>new Date(n))return{error:Re};if(r){let f=i||e.startDate,m=n||e.endDate,g=!f||r.every(y=>new Date(y)>=new Date(f)),v=!m||r.every(y=>new Date(y)<=new Date(m));if(!g||!v)return{error:Xa}}let s;(i&&e.startDate&&new Date(i)>new Date(e.startDate)||n&&e.endDate&&new Date(n)<new Date(e.endDate))&&(s=!0);let l=lS(e.startDate,e.endDate);i&&(e.startDate=i),n&&(e.endDate=n);let c=lS(e.startDate,e.endDate),u=l.filter(f=>!c.includes(f)),d=c.filter(f=>!l.includes(f));for(let f of e.events??[])i&&f.startDate&&new Date(f.startDate)<new Date(i)&&(f.startDate=i),n&&f.startDate&&new Date(f.startDate)>new Date(n)&&(f.startDate=i??n),n&&f.endDate&&new Date(f.endDate)>new Date(n)&&(f.endDate=n),i&&f.endDate&&new Date(f.endDate)<new Date(i)&&(f.endDate=n??i);i&&e.endDate&&new Date(i)>new Date(e.endDate)&&(e.endDate=i),n&&e.startDate&&new Date(n)<new Date(e.startDate)&&(e.startDate=n),r&&(e.activeDates=r),a&&(e.weekdays=a);let p=s&&((h=oFe({tournamentRecord:e}))==null?void 0:h.unscheduledMatchUpIds);return aFe({tournamentRecord:e}),wi({payload:zt({parentOrganisation:e.parentOrganisation,tournamentId:e.tournamentId,activeDates:r,startDate:i,weekdays:a,endDate:n}),topic:wy}),{...ce,unscheduledMatchUpIds:p,datesAdded:d,datesRemoved:u}}function Upe({tournamentRecord:t,startDate:e}){return e?xO({tournamentRecord:t,startDate:e}):{error:Xa}}function Dpe({tournamentRecord:t,endDate:e}){return e?xO({tournamentRecord:t,endDate:e}):{error:Xa}}function oFe({tournamentRecord:t}){let e=oo({tournamentRecord:t}).matchUps??[],i=t.startDate&&new Date(t.startDate),n=t.endDate&&new Date(t.endDate),r=[],a=[];for(let o of e){let{schedule:s,matchUpId:l}=o;if(s&&s.scheduledDate){let c=new Date(s.scheduledDate);(i&&c<i||n&&c>n)&&(a.push(l),r.includes(s.scheduledDate)||r.push(s.scheduledDate))}}return r.length&&!PO({scheduledDates:r,tournamentRecord:t}).clearedScheduleCount?{error:tne}:{unscheduledMatchUpIds:a}}var ZW={};$i(ZW,{addCourt:()=>AO,addCourts:()=>LW,addVenue:()=>PC,deleteCourt:()=>kpe,deleteVenue:()=>e4,deleteVenues:()=>Rpe,disableCourts:()=>Mpe,disableVenues:()=>Npe,enableCourts:()=>Ape,enableVenues:()=>_pe,generate:()=>Epe,generateCourts:()=>dW,getCompetitionVenues:()=>nP,getCourts:()=>W3,getVenuesAndCourts:()=>nm,modifyCourt:()=>t4,modifyCourtAvailability:()=>JW,modifyVenue:()=>xpe,mutate:()=>Cpe,publicFindVenue:()=>lq,query:()=>Yce});var Epe={};$i(Epe,{generateCourts:()=>dW});var Cpe={};$i(Cpe,{addCourt:()=>AO,addCourts:()=>LW,addVenue:()=>PC,deleteCourt:()=>kpe,deleteVenue:()=>e4,deleteVenues:()=>Rpe,disableCourts:()=>Mpe,disableVenues:()=>Npe,enableCourts:()=>Ape,enableVenues:()=>_pe,modifyCourt:()=>t4,modifyCourtAvailability:()=>JW,modifyVenue:()=>xpe});function XW(t){if(!(t!=null&&t.tournamentRecord)&&!Array.isArray(t==null?void 0:t.venueMatchUps))return{error:ut};if(!(t!=null&&t.courtId))return{error:RI};let{scheduleVisibilityFilters:e,tournamentRecord:i,matchUpFilters:n,venueMatchUps:r,courtId:a}=t,{schedulingProfile:o}=rm({tournamentRecord:i});if(Array.isArray(r))return{matchUps:l({matchUps:r,courtId:a})};let{matchUps:s}=oo({scheduleVisibilityFilters:e,tournamentRecord:i,matchUpFilters:n});return{matchUps:l({matchUps:s,courtId:a})};function l({matchUps:c,courtId:u}){let d=c.filter(p=>{var f,m,g;let h=(m=(f=p.schedule)==null?void 0:f.allocatedCourts)==null?void 0:m.map(({courtId:v})=>v);return((g=p.schedule)==null?void 0:g.courtId)===u||(h==null?void 0:h.includes(u))});return jA({matchUps:d,schedulingProfile:o})}}function sFe({scheduleVisibilityFilters:t,tournamentRecord:e,matchUpFilters:i,venueId:n}){if(!e)return{error:ut};if(!n)return{error:wg};let{schedulingProfile:r}=rm({tournamentRecord:e}),{matchUps:a}=oo({scheduleVisibilityFilters:t,tournamentRecord:e,matchUpFilters:i});return{matchUps:o({matchUps:a,venueId:n})};function o({matchUps:s,venueId:l}){let c=s.filter(u=>{var p,h,f;let d=(h=(p=u.schedule)==null?void 0:p.allocatedCourts)==null?void 0:h.map(({venueId:m})=>m);return((f=u.schedule)==null?void 0:f.venueId)===l||(d==null?void 0:d.includes(l))});return jA({matchUps:c,schedulingProfile:r})}}function JW({tournamentRecord:t,dateAvailability:e,disableNotice:i,venueMatchUps:n,courtId:r,force:a}){var h,f,m;if(!t)return{error:ut};if(!r)return{error:RI};let o=gde({dateAvailability:e});if(o.error)return o;let{updatedDateAvailability:s,totalMergeCount:l}=lFe(e);e=s;let c=jI({tournamentRecord:t,courtId:r});if(c.error)return c;let{court:u,venue:d}=c,{matchUps:p}=XW({tournamentRecord:t,venueMatchUps:n,courtId:r});if(p!=null&&p.length){let g=(h=dn({tournamentRecord:t}))==null?void 0:h.appliedPolicies,v=a??((m=(f=g==null?void 0:g[Tg])==null?void 0:f.allowDeletionWithScoresPresent)==null?void 0:m.courts),y=[];y.length&&(v||console.log("throw error: scheduled court matchUps",y.length))}return u&&(u.dateAvailability=e,!i&&d&&wi({payload:{venue:d,tournamentId:t.tournamentId},topic:Sy,key:d.venueId})),{...ce,totalMergeCount:l}}function lFe(t){let e=0,i=t.reduce((r,a)=>{let{date:o,startTime:s,endTime:l,bookings:c}=a;return r[o]||(r[o]=[]),r[o].push({startTime:s,endTime:l,bookings:c}),r},{}),n=[];return Object.keys(i).forEach(r=>{i[r].sort(ELe);let{mergedAvailability:a,mergeCount:o}=cFe(i[r]);n.push(...a.map(s=>({date:r,...s}))),e+=o}),{updatedDateAvailability:n,totalMergeCount:e}}function cFe(t){let e,i,n,r=t.length,a=0,o=[];for(;t.length&&r;){let l=t.shift(),{startTime:c,endTime:u,bookings:d}=l;if(r-=1,!e)e=c,n=d,i=u;else if(dC(la(i),la(c),!1)>0){let p={startTime:e,endTime:i};n!=null&&n.length&&(p.bookings=n),o.push(p),e=c,n=d,i=u}else d&&(n?n.push(d):n=d),i=u,a+=1}let s={startTime:e,endTime:i};return n!=null&&n.length&&(s.bookings=n),o.push(s),{mergedAvailability:o,mergeCount:a}}function QW({matchUpsCount:t=0}){let e=`Schedule would be deleted from ${t} ${t===1?"matchUp":"matchUps"}; use { force: true }`;return{error:are,info:e}}function Ppe({tournamentRecord:t,drawDefinition:e,matchUpId:i,drawId:n}){let r="removeCourtAssignment";if(!i)return{error:ss};if(!e&&!n)return{error:Pd};let a;if(!e){if(!t)return{error:ut};({drawDefinition:e}=zs({tournamentRecord:t,drawId:n}))}if(e)({matchUp:a}=nr({drawDefinition:e,matchUpId:i}));else{if(!t)return{error:ut};let o=oo({tournamentRecord:t,inContext:!1}).matchUps??[];({matchUp:a}=fse({matchUps:o,matchUpId:i}))}return a?(a.timeItems&&a.timeItems.find(o=>[Gv,Mf].includes(o.itemType))&&(a.timeItems=a.timeItems.filter(({itemType:o})=>![Gv,Mf].includes(o)),en({tournamentId:t==null?void 0:t.tournamentId,context:r,drawDefinition:e,matchUp:a})),{...ce}):{error:Ho}}function e4(t){var l,c,u;if(typeof(t==null?void 0:t.venueId)!="string")return{error:wg};let{tournamentRecord:e,venueId:i,force:n}=t,r=t.tournamentRecords||e&&{[e.tournamentId]:e}||{};if(!Object.keys(r).length)return{error:ut};let a=wd({tournamentRecords:r,contextFilters:{venueIds:[i]}}).matchUps??[],o=(l=dn({tournamentRecord:e}))==null?void 0:l.appliedPolicies,s=n??((u=(c=o==null?void 0:o[Tg])==null?void 0:c.allowDeletionWithScoresPresent)==null?void 0:u.venues);if(!a.length||s)for(let d of Object.values(r)){for(let h of a){let f=Ppe({matchUpId:h.matchUpId,drawId:h.drawId,tournamentRecord:d});if(f.error)return f}let p;d.venues=(d.venues??[]).filter(h=>(h==null?void 0:h.venueId)!==i?!0:(p=!0,!1)),p&&wi({payload:{venueId:i,tournamentId:d.tournamentId},topic:Vz,key:i})}else return QW({matchUpsCount:a.length});return aP({tournamentRecords:r}),{...ce}}function Rpe({tournamentRecord:t,venueIds:e,force:i}){if(!t)return{error:ut};if(!Array.isArray(e))return{error:Re};for(let n of t.venues||[]){let{venueId:r}=n;if(e.includes(r)){let{venueId:a}=n,o=e4({tournamentRecord:t,venueId:a,force:i});if(o.error)return o}}return{...ce}}function Mpe(t){let{courtIds:e,dates:i}=t,n=qc(t),r=[{[zo]:!0,[rx]:!0}],a=di(t,r);if(a.error)return a;for(let o of Object.values(n))uFe({tournamentRecord:o,courtIds:e,dates:i});return{...ce}}function uFe({tournamentRecord:t,courtIds:e,dates:i}){let n=Array.isArray(i)&&i.length?{dates:i}:!0,r=a=>cn({extension:{value:n,name:pd},creationTime:!1,element:a});for(let a of t.venues||[])for(let o of a.courts||[])if(e!=null&&e.includes(o.courtId)){let s=r(o);if(s.error)return s}return{...ce}}function Npe(t){let{tournamentRecords:e,tournamentId:i,venueIds:n}=t,r=[{[zo]:!0,[ax]:!0}],a=di(t,r);if(a.error)return a;let o=Object.keys(e).filter(s=>!i||s===i);for(let s of o){let l=e[s];dFe({tournamentRecord:l,venueIds:n})}return{...ce}}function dFe({tournamentRecord:t,venueIds:e}){for(let i of t.venues||[])if(e!=null&&e.includes(i.venueId)){let n=cn({creationTime:!1,element:i,extension:{name:pd,value:!0}});if(n.error)return n}return{...ce}}function Ape(t){let e=qc(t),i=[{[zo]:!0}];!t.enableAll&&i.push({[rx]:!0});let n=di(t,i);if(n.error)return n;let{enableAll:r,courtIds:a,dates:o}=t;for(let s of Object.values(e))pFe({tournamentRecord:s,courtIds:a,enableAll:r,dates:o});return{...ce}}function pFe({tournamentRecord:t,courtIds:e,enableAll:i,dates:n}){for(let r of t.venues||[])for(let a of r.courts||[])if(i||e!=null&&e.includes(a.courtId))if(Array.isArray(n)){let{extension:o}=Ri({element:a,name:pd});if(o){let s=o.value;Array.isArray(s.dates)&&(s.dates=s.dates.filter(l=>!n.includes(l))),cn({extension:{name:pd,value:s},creationTime:!1,element:a})}}else Is({element:a,name:pd});return{...ce}}function _pe(t){let e=qc(t),i=[{[zo]:!0}];!t.enableAll&&i.push({[ax]:!0});let n=di(t,i);if(n.error)return n;let{venueIds:r,enableAll:a}=t;for(let o of Object.values(e))for(let s of o.venues||[])(a||r!=null&&r.includes(s.venueId))&&Is({element:s,name:pd});return{...ce}}function kpe(t){let{courtId:e,disableNotice:i,force:n}=t,r=qc(t),a=di(t,[{[zo]:!0,[Lre]:!0}]);if(a.error)return a;let o,s;for(let l of Object.values(r)){if(s=hFe({tournamentRecord:l,disableNotice:i,courtId:e,force:n}),s.error&&s.error!==ST)return s;s.success&&(o=!0)}return o?{...ce}:s}function hFe({tournamentRecord:t,disableNotice:e,courtId:i,force:n}){var c,u,d;let r=jI({tournamentRecord:t,courtId:i});if(r.error)return r;let a=r.venue,{matchUps:o}=XW({tournamentRecord:t,courtId:i}),s=(c=dn({tournamentRecord:t}))==null?void 0:c.appliedPolicies,l=n??((d=(u=s==null?void 0:s[Tg])==null?void 0:u.allowDeletionWithScoresPresent)==null?void 0:d.courts);if(!(o!=null&&o.length)||l){for(let p of o??[]){let h=Ppe({matchUpId:p.matchUpId,drawId:p.drawId,tournamentRecord:t});if(h.error)return h}a&&(a.courts=(a.courts??[]).filter(p=>p.courtId!==i),e||wi({payload:{venue:a,tournamentId:t.tournamentId},topic:Sy,key:a.venueId}))}else return QW({matchUpsCount:o.length});return{...ce}}function t4(t){let{disableNotice:e,modifications:i,courtId:n,force:r,venueMatchUps:a}=t,o=qc(t);if(!Object.keys(o).length)return{error:Sr};let s,l;for(let c of Object.values(o)){let u=fFe({tournamentRecord:c,disableNotice:e,venueMatchUps:a,modifications:i,courtId:n,force:r});if(u!=null&&u.error)return u;s=!0}return s?{...ce}:l}function fFe({tournamentRecord:t,disableNotice:e,venueMatchUps:i,modifications:n,courtId:r,force:a}){if(!t)return{error:ut};if(!r)return{error:RI};if(!n||typeof n!="object")return{error:Jf};let o=jI({tournamentRecord:t,courtId:r});if(o.error)return o;let{venue:s,court:l}=o,c=Object.keys(DLe()).filter(p=>p!=="courtId");if(!Object.keys(n).filter(p=>c.includes(p)).length)return{error:Gk};let u=c.filter(p=>!["dateAvailability"].includes(p)),d=Object.keys(n).filter(p=>u.includes(p));if(l&&d.forEach(p=>Object.assign(l,{[p]:n[p]})),n.dateAvailability){let p=JW({dateAvailability:n.dateAvailability,tournamentRecord:t,venueMatchUps:i,disableNotice:e,courtId:r,force:a});if(p.error)return p}return e||wi({payload:{venue:s,tournamentId:t.tournamentId},topic:Sy,key:s==null?void 0:s.venueId}),{...ce,court:Ot(l)}}var mFe=()=>({venueId:void 0,venueName:"",venueAbbreviation:"",onlineResources:[],venueType:void 0,addresses:[],contacts:[],courts:[],roles:[]}),gFe=mFe;function xpe(t){let{modifications:e,venueId:i,force:n}=t,r=qc(t);if(!Object.keys(r).length)return{error:Sr};if(typeof i!="string")return{error:wg};let a,o;for(let s of Object.values(r)){let l=vFe({tournamentRecord:s,modifications:e,venueId:i,force:n});if(l.success&&(o=!0),l.error&&(a=l.error),l.error&&l.error!==AI)return l}return aP({tournamentRecords:r}),o?{...ce}:{error:a}}function vFe({tournamentRecord:t,modifications:e,venueId:i,force:n}){var g,v,y,b,I,T,w,S;if(!t)return{error:ut};if(!e||typeof e!="object")return{error:Jf};if(!i)return{error:wg};let r=(g=dn({tournamentRecord:t}))==null?void 0:g.appliedPolicies,a=n??((y=(v=r==null?void 0:r[Tg])==null?void 0:v.allowDeletionWithScoresPresent)==null?void 0:y.venues),{matchUps:o}=sFe({tournamentRecord:t,venueId:i}),s=kh({tournamentRecord:t,venueId:i});if(s.error)return s;let l=s.venue,c=Object.keys(gFe()).filter(D=>D!=="venueId");if(!Object.keys(e).filter(D=>c.includes(D)).length)return{error:Gk};let u=c.filter(D=>!["courts","onlineResources"].includes(D)),d=Object.keys(e).filter(D=>u.includes(D));l&&d.forEach(D=>Object.assign(l,{[D]:e[D]}));let p=((b=l==null?void 0:l.courts)==null?void 0:b.map(D=>D.courtId))??[],h=((I=e.courts)==null?void 0:I.map(D=>D.courtId))||[],f=h.length?p.filter(D=>!h.includes(D)):(e==null?void 0:e.courts)&&p,m=[];if(f!=null&&f.length){let D=(w=(T=l==null?void 0:l.courts)==null?void 0:T.filter(E=>f.includes(E.courtId)))==null?void 0:w.map(E=>{var P;let C=XW({courtId:E.courtId,tournamentRecord:t,venueMatchUps:o});for(let R of C.matchUps??[])m.push({matchUpId:R.matchUpId,drawId:R.drawId});return((P=C.matchUps)==null?void 0:P.length)??0}).reduce((E,C)=>E+C);if(l&&(!D||a))l.courts=(S=l.courts)==null?void 0:S.filter(E=>h.includes(E.courtId)),YD({schedule:{courtId:"",scheduledDate:""},matchUpDetails:m,removePriorValues:!0,tournamentRecord:t});else return QW({matchUpsCount:D})}if(e.courts)for(let D of e.courts){let{courtId:E}=D||{},C=t4({modifications:D,disableNotice:!0,tournamentRecord:t,venueMatchUps:o,courtId:E,force:n});if(C.error===ST&&(C=AO({disableNotice:!0,tournamentRecord:t,venueId:i,court:D})),C.error)return C}return aP({tournamentRecord:t}),l&&wi({payload:{venue:l,tournamentId:t.tournamentId},topic:Sy,key:l==null?void 0:l.venueId}),{...ce,venue:Ot(l)}}var _i={};$i(_i,{JSON2CSV:()=>UFe,UUID:()=>Pn,UUIDS:()=>xMe,allNumeric:()=>fre,attributeFilter:()=>Kb,chunkArray:()=>ro,chunkByNth:()=>B2,chunkSizeProfile:()=>hre,constantToString:()=>Eo,countValues:()=>GPe,createMap:()=>Zie,dateTime:()=>qre,definedAttributes:()=>zt,dehydrateMatchUps:()=>IFe,extractAttributes:()=>Xae,flattenJSON:()=>i4,generateDateRange:()=>lS,generateHashCode:()=>oPe,generateRange:()=>Et,generateTimeCode:()=>Sde,groupValues:()=>dre,hasAttributeValues:()=>aPe,instanceCount:()=>Pl,intersection:()=>zr,isConvertableInteger:()=>yi,isNumeric:()=>Rr,isOdd:()=>cre,isPowerOf2:()=>bd,makeDeepCopy:()=>Ot,matchUpScheduleSort:()=>bFe,matchUpSort:()=>GI,nearestPowerOf2:()=>ez,nextPowerOf2:()=>UT,noNulls:()=>jPe,noNumeric:()=>mre,numericSort:()=>ma,occurrences:()=>zPe,overlap:()=>Ts,randomMember:()=>Il,randomPop:()=>Sl,shuffleArray:()=>bs,structureSort:()=>FI,subSort:()=>qPe,undefinedToNull:()=>P2,unique:()=>Pi,visualizeScheduledMatchUps:()=>yFe});function yFe({scheduledMatchUps:t,showGlobalLog:e}){lNe();let i=t==null?void 0:t.reduce((r,{structureId:a})=>r.includes(a)?r:r.concat(a),[]),n=Array.isArray(i)&&{...i.map(r=>{let{structureName:a,matchUpType:o}=t.find(s=>s.structureId===r);return{[r]:`${a} ${o}`}})};i==null||i.forEach(r=>{var s;Ac({color:"blue",method:"draw",structure:n[r],keyColors:{structure:"magenta"}},!0);let a=t.filter(l=>l.structureId===r),o=((s=Us({matchUps:a}))==null?void 0:s.roundMatchUps)||[];Object.keys(o).forEach(l=>{Ac({roundNumber:l,keyColors:{roundNumber:"brightcyan"}},!0),o[l].forEach(({matchUpId:c,schedule:u})=>{let d=ir(u.scheduledTime);Ac({matchUpId:c,time:d,date:u.scheduledDate,venue:u.venueId,keyColors:{time:"brightcyan",date:"brightcyan",matchUpId:"yellow",venue:"magenta"}},!0)})})}),e&&sNe()}var{extractTime:LY,timeStringMinutes:FY}=qre;function bFe(t,e){let i=t.schedule??{},n=e.schedule??{};if(i.scheduledDate&&!n.scheduledDate)return 1;if(n.scheduledDate&&!i.scheduledDate)return-1;if(i.scheduledDate&&n.scheduledDate){if(i.scheduledDate===n.scheduledDate){if(i.scheduledTime&&!n.scheduledTime)return 1;if(n.scheduledTime&&!i.scheduledTime)return-1;if(i.scheduledTime&&n.scheduledTime){let r=FY(LY(i.scheduledTime)),a=FY(LY(n.scheduledTime));return r-a}}return new Date(i.scheduledDate).getTime()-new Date(n.scheduledDate).getTime()}return 0}function IFe({tournamentRecord:t}){if(!t)return{error:ut};if(typeof t!="object"||!t.tournamentId)return{error:Re};let{matchUps:e}=oo({tournamentRecord:t,inContext:!1});if(e!=null&&e.length){let i=wFe({tournamentRecord:t});TFe(e,i)}return{...ce}}function wFe({tournamentRecord:t}){let e={};for(let i of t.events||[]){i.matchUpFormat&&(e[i.eventId]=i.matchUpFormat);for(let n of i.drawDefinitions||[]){n.matchUpFormat&&(e[n.drawId]=n.matchUpFormat);for(let r of n.structures||[]){r.matchUpFormat&&(e[r.structureId]=r.matchUpFormat);for(let a of r.structures||[])a.matchUpFormat&&(e[a.structureId]=a.matchUpFormat)}}}return e}var SFe=["collectionId","collectionPosition","drawPositions","extensions","finishingPositionRange","finishingRound","isMock","matchUpId","matchUpStatus","matchUpStatusCodes","orderOfFinish","processCodes","roundNumber","tieFormat","tieMatchUps","roundPosition","score","sides","winnerMatchUpId","loserMatchUpId","matchUpDuration","winningSide"];function TFe(t,e={}){for(let i of t){let{structureId:n,drawId:r,eventId:a}=i,o=e[n]||e[r]||e[a],s=i.matchUpFormat===o?void 0:i.matchUpFormat;for(let l of Object.keys(i))SFe.includes(l)||delete i[l];i.sides&&i.drawPositions&&!i.tieMatchUps&&delete i.sides,s&&(i.matchUpFormat=s)}}function UFe(t,e){if(e&&typeof e!="object")return{error:Re};let{columnTransform:i={}}=e||{},{includeTransformAccessors:n,includeHeaderRow:r=!0,returnTransformedJSON:a,removeEmptyColumns:o,onlyHeaderRow:s,columnAccessors:l=[],functionMap:c={},columnMap:u={},valuesMap:d={},context:p={},delimiter:h='"',columnJoiner:f=",",rowJoiner:m=`\r
`,keyJoiner:g="."}=e||{};if(!Array.isArray(t)||!Array.isArray(l)||typeof p!="object"||typeof u!="object"||typeof i!="object"||typeof c!="object"||typeof d!="object"||typeof f!="string"||typeof m!="string"||typeof g!="string"||typeof h!="string")return{error:Re};i=Object.assign({},...Object.keys(i).reverse().map(M=>({[M]:Array.isArray(i[M])?i[M]:[typeof i[M]=="string"&&i[M]].filter(Boolean)})));let v=t.filter(Boolean).map(M=>i4(M,g)),y=Object.values(i).flat();n&&l.push(...y);let b=v.reduce((M,A)=>Object.keys(A).every(_=>!M.includes(_)&&M.push(_)||!0)&&M,[]).filter(M=>!(l!=null&&l.length)||l.includes(M)),I=Object.assign({},...Object.keys(i).reverse().map(M=>i[M].map(A=>({[A]:M})).flat()).flat()),T=(M,A)=>e!=null&&e.sortOrder?e.sortOrder.includes(M)&&e.sortOrder.includes(A)&&e.sortOrder.indexOf(M)-e.sortOrder.indexOf(A)||!e.sortOrder.includes(A)&&-1:0,w=b.reduce((M,A)=>{let _=I[A];return _?M.includes(_)||M.push(_):M.push(A),M},[]).sort(T);Object.keys(u).forEach(M=>!w.includes(M)&&w.unshift(M)),Object.keys(i).forEach(M=>!w.includes(M)&&w.unshift(M)),typeof p=="object"&&Object.keys(p).forEach(M=>!w.includes(M)&&w.unshift(M));let S=w.map(M=>u[M]||M);if(s)return[S];let D=M=>`${h}${M}${h}`,E=[],C=M=>Object.values(w.reduce((A,_,x)=>{var H;let O=i[_],B=(O!=null&&O.length?M[O.find($=>M[$])]:M[_])||(p==null?void 0:p[_])||"",F=((H=d[_])==null?void 0:H[B])||B,G=Gs(c[_])?c[_](F):F;return A[_]=D(G),G&&(E[x]=(E[x]||0)+1),A},{})),P=v.map(C),R=o&&[...E].map((M,A)=>!M&&A).filter(Rr).reverse();if(R){let M=A=>A.filter((_,x)=>!R.includes(x));P=P.map(M),S=M(S)}let N=P.map(M=>M.join(f));return a?N.map(M=>{let A=M.split(f);return Object.assign({},...A.map((_,x)=>({[S[x]]:_})))}):r?[S.map(D).join(f),...N].join(m):N.join(m)}function i4(t,e=".",i=[]){return typeof t=="object"&&Object.keys(t).reduce((n,r)=>typeof t[r]!="object"?(n[i.concat(r).join(e)]=t[r],n):Object.assign(n,i4(t[r],e,i.concat(r))),{})}var DFe={},{FACTORY:BY}=Pv;function EFe({tournamentRecord:t,value:e}){let{extension:i}=Ri({element:t,name:BY}),n={name:BY,value:{...i==null?void 0:i.value,...e}};cn({element:t,extension:n})}function OO({timeStamp:t}){let e=Sg(),i=iz();return i&&Object.values(e).forEach(n=>{EFe({tournamentRecord:n,value:{version:gT(),timeStamp:t}})}),i}function Ope({engineType:t,methodName:e,elapsed:i,params:n,result:r}){var d,p;let a=Jl();if(typeof a!="object")return;let o={method:e},s=(r==null?void 0:r.error)&&(a.errors===!0||Array.isArray(a.errors)&&a.errors.includes(e)),l=Array.isArray(a.params)&&((d=a.params)==null?void 0:d.includes(e)),c=a.params&&!Array.isArray(a.params)||l,u=Array.isArray(a.exclude)&&a.exclude.includes(e);!u&&![void 0,!1].includes(a.perf)&&!isNaN(a.perf)&&i>=a.perf&&(o.elapsed=i),!u&&(s||c)&&(o.params=n),!u&&(s||a.result&&!Array.isArray(a.result)&&(!Array.isArray(a.params)||l)||Array.isArray(a.result)&&((p=a.result)!=null&&p.includes(e)))&&(o.result=r),Object.keys(o).length>1&&Tre(o,t)}function vP({methodName:t,params:e,start:i}){let n={error:oC,methodName:t},r=i?Date.now()-i:0;return Ope({result:n,methodName:t,elapsed:r,params:e,engineType:"sync"}),n}function CFe(t,e){var a;if(e._middleware===!1)return e;if(e.tournamentId&&!t[e.tournamentId])return{error:ut};let i=e.drawId||((a=e.matchUp)==null?void 0:a.drawId);if(i){let{event:o,drawDefinition:s,tournamentId:l}=zs({tournamentRecords:t,drawId:i});s&&(e.drawDefinition=s),l&&(e.tournamentId=l),o&&(e.event=o)}if(e.eventId&&!e.event){let{event:o,tournamentId:s}=zs({eventId:e.eventId,tournamentRecords:t});if(!o)return{error:Xl};e.tournamentId=s,e.event=o}let n=e.tournamentId??kI();if(!n&&e)return e;let r=t[n];return n&&!r?{error:ut}:(r&&(e.tournamentRecord=r),e)}function yP(t,e,i,n,r){delete t.success,delete t.error;let a=Date.now(),o=kI();i&&(i.activeTournamentId=o);let s=(i==null?void 0:i.tournamentRecord)||oz(o),l=typeof(i==null?void 0:i.tournamentRecord)=="object"&&{[i==null?void 0:i.tournamentRecord.tournamentId]:i.tournamentRecord}||Sg(),c=i?Ot(i,void 0,!0):void 0,u=i?CFe(l,i):void 0;if(u!=null&&u.error)return u;let d=PFe({params:u,tournamentRecords:l,tournamentRecord:s,methodName:n,method:e}),p=Date.now()-a;return Ope({result:d,methodName:n,elapsed:p,params:c,engineType:r}),d}function PFe({tournamentRecords:t,tournamentRecord:e,params:i,methodName:n,method:r}){if(Jl())return r({tournamentRecords:t,tournamentRecord:e,...i});try{return r({tournamentRecords:t,tournamentRecord:e,...i})}catch(a){return Yk({engineName:"engine",methodName:n,params:i,err:a})}}function LO(t){let{mutationStatus:e,tournamentId:i,directives:n,timeStamp:r}=t||{},{topics:a}=rc();for(let o of[...a].sort(Fpe)){let s=rz({topic:o});s!=null&&s.length&&TD({topic:o,notices:s})}e&&r&&a.includes(xD)&&TD({notices:[{tournamentId:i,directives:n,timeStamp:r}],topic:xD})}async function Lpe(t){let{mutationStatus:e,tournamentId:i,directives:n,timeStamp:r}=t||{},{topics:a}=rc();for(let o of[...a].sort(Fpe)){let s=rz({topic:o});s&&await TD({topic:o,notices:s})}e&&r&&a.includes(xD)&&TD({notices:[{tournamentId:i,directives:n,timeStamp:r}],topic:xD})}var $Y={[Yz]:5,[Kz]:5,[Zz]:5,[Wz]:5,[qz]:5,[Hz]:5,[aae]:5,[oae]:5,[zz]:1,[hx]:1,[Ro]:5,[Sy]:5,[Gz]:4,[$z]:4,[Vz]:4,[jz]:4,[px]:3,[Oz]:2};function Fpe(t,e){return($Y[e]||0)-($Y[t]||0)}function RFe({convertExtensions:t,removeExtensions:e}){let i=Sg();return{tournamentId:kI(),tournamentRecords:Ot(i,t,!1,e)}}function MFe(t){let{convertExtensions:e=!1,removeExtensions:i=!1}=t??{},n=(t==null?void 0:t.tournamentId)??kI();if(typeof n!="string")return{};let r=oz(n);return{tournamentRecord:Ot(r,e,!1,i)}}function NFe(){var n;let t=Sg(),{extension:e}=Ri({name:Vv,tournamentRecords:t,discover:!0}),i=((n=e==null?void 0:e.value)==null?void 0:n.tournamentIds)||[];return Object.keys(t).forEach(r=>{i.includes(r)||delete t[r]}),Kk(t)}function VY(t,e=!0){return typeof t!="object"||Array.isArray(t)?{error:Jf}:t!=null&&t.tournamentId?wre(e?Ot(t):t):{error:Re}}function iI(t,e=!0){if(typeof t!="object")return{error:Jf};if(UD(),Array.isArray(t)){if(t.filter(i=>i==null?void 0:i.tournamentId).length!==t.length)return{error:N2};t=Object.assign({},...t.map(i=>({[i.tournamentId]:i})))}else if(t!=null&&t.tournamentId)t={[t.tournamentId]:t},UD(t.tournamentId);else if(!Object.keys(t).every(i=>t[i].tournamentId===i))return{error:N2};return Kk(e?Ot(t):t)}async function AFe(t,e,i){if(!Array.isArray(e))return{error:Re,message:"directives must be an array"};let n=nz(),r=Date.now(),a=i&&Ot(Sg(),!1,!0),o=[];for(let c of e){if(typeof c!="object")return{error:Re,message:"directive must be an object"};let{method:u,pipe:d}=c,p=c.params?{...c.params}:{};if(!n[u])return vP({methodName:u,start:r,params:p});if(d){let f=o[o.length-1],m=Object.keys(d);for(let g of m)f[g]&&(p[g]=f[g])}let h=yP(t,n[u],p,u,"async");if(h!=null&&h.error)return a&&iI(a),{...h,rolledBack:!!a};o.push({...h,methodName:u})}let s=Date.now(),l=OO({timeStamp:s});return await Lpe({directives:e,mutationStatus:l,timeStamp:s}),_I(),{success:o.every(c=>c.success),results:o}}async function jY(t,e){if(!Xi(e))return{error:Re,message:"args must be an object"};let i=Object.values(e).filter(Gs).length;if(i>1)return{message:"there must be only one arg with typeof function",error:Re};let n=i?Object.keys(e).find(h=>Gs(e[h])):$r(e.method)&&e.method;if(!n)return{error:oC};let{[n]:r,...a}=e,o=e!=null&&e.params?{...e.params}:{...a},s=o.rollbackOnError&&Ot(Sg(),!1,!0),l=r||t[n]||qk()[n];if(!l)return vP({methodName:n,params:o});let c=await yP(t,l,o,n,"async")??{};c!=null&&c.error&&s&&iI(s);let u=Date.now(),d=OO({timeStamp:u}),p=(c==null?void 0:c.success)&&(o==null?void 0:o.delayNotify)!==!0&&(o==null?void 0:o.doNotNotify)!==!0;return p&&await Lpe({directives:[{method:l,params:o}],mutationStatus:d,timeStamp:u}),(p||!(c!=null&&c.success)||o!=null&&o.doNotNotify)&&_I(),c}function _Fe(t,e,i,n,r,a){let o=Ure(i,n,r,a);if(o.error)return o;let s=o.methods??[];return Object.keys(s).filter(l=>Gs(s[l])).forEach(l=>{t[l]=c=>{let u=()=>e(t,{[l]:s[l],...c});if(Jl())return u();try{return u()}catch(d){Yk({engineName:"engine",methodName:l,params:c,err:d})}}}),{...ce,...t}}function Jw(t,e){return e!=null&&e.error?(t.error=e.error,t.success=!1):(t.error=void 0,t.success=!0),t}function n4(t,e){t.importMethods=(i,n,r,a)=>_Fe(t,e,i,n,r,a),t.getTournament=i=>MFe(i),t.getState=i=>RFe({convertExtensions:i==null?void 0:i.convertExtensions,removeExtensions:i==null?void 0:i.removeExtensions}),t.version=()=>gT(),t.reset=()=>(Kk({}),Jw(t)),t.devContext=i=>(wD(i),Jw(t)),t.getDevContext=i=>Jl(i),t.newTournamentRecord=(i={})=>{let n=MO(i),r=n.tournamentId;return n.error?n:(VY(n),UD(r),{...ce,tournamentId:r})},t.setState=(i,n,r)=>{SD(n,r);let a=iI(i,n);return Jw(t,a)},t.setTournamentId=i=>UD(i),t.getTournamentId=()=>kI(),t.setTournamentRecord=(i,n,r)=>{SD(n,r);let a=VY(i,n);return Jw(t,a)},t.removeTournamentRecord=i=>{let n=Sre(i);return Jw(t,n)},t.removeUnlinkedTournamentRecords=()=>{let i=NFe();return Jw(t,i)}}function kFe(t){let e=gre();if(e.error&&!t)return e;let i={executionQueue:(n,r)=>AFe(i,n,r),execute:n=>jY(i,n)};return n4(i,jY),i}function xFe(t,e,i){if(!Array.isArray(e))return{error:Re,message:"directives must be an array"};let n=nz(),r=Date.now(),a=i&&Ot(Sg(),!1,!0),o=[];for(let c of e){if(typeof c!="object")return{error:Re,message:"directive must be an object"};if(c.params&&typeof c.params!="object")return{error:Re,message:"params must be an object"};let{method:u,pipe:d}=c,p=c.params?{...c.params}:{};if(!n[u])return vP({methodName:u,start:r,params:p});if(d){let f=o[o.length-1],m=Object.keys(d);for(let g of m)f[g]&&(p[g]=f[g])}let h=yP(t,n[u],p,u,"sync");if(h!=null&&h.error)return a&&iI(a),{...h,rolledBack:!!a};o.push({...h,methodName:u})}let s=Date.now(),l=OO({timeStamp:s});return LO({directives:e,mutationStatus:l,timeStamp:s}),_I(),{success:o.every(c=>c.success),results:o}}function GY(t,e){if(!Xi(e))return{error:Re,message:"args must be an object"};let i=Object.values(e).filter(Gs).length;if(i>1)return{message:"there must be only one arg with typeof function",error:Re};let n=i?Object.keys(e).find(h=>Gs(e[h])):$r(e.method)&&e.method;if(!n)return{error:oC};let{[n]:r,...a}=e,o=e!=null&&e.params?{...e.params}:{...a},s=o.rollbackOnError&&Ot(Sg(),!1,!0),l=r||t[n]||qk()[n];if(!l)return vP({methodName:n,params:o});let c=yP(t,l,o,n,"sync")??{};c!=null&&c.error&&s&&iI(s);let u=Date.now(),d=OO({timeStamp:u}),p=(c==null?void 0:c.success)&&(o==null?void 0:o.delayNotify)!==!0&&(o==null?void 0:o.doNotNotify)!==!0;return p&&LO({directives:[{method:l,params:o}],mutationStatus:d,timeStamp:u}),(p||!(c!=null&&c.success)||o!=null&&o.doNotNotify)&&_I(),c}var Bpe=(()=>{let t={executionQueue:(e,i)=>xFe(t,e,i),execute:e=>GY(t,e)};return n4(t,GY),t})(),bP=Bpe;function HY(t,e){if(!Xi(e))return{error:Re,message:"args must be an object"};let i=Object.values(e).filter(Gs).length;if(i>1)return{message:"there must be only one arg with typeof function",error:Re};let n=i?Object.keys(e).find(l=>Gs(e[l])):$r(e.method)&&e.method;if(!n)return{error:oC};let{[n]:r,...a}=e,o=e!=null&&e.params?{...e.params}:{...a},s=r||t[n]||qk()[n];return s?yP(t,s,o,n,"ask"):vP({methodName:n,params:o})}var OFe=(()=>{let t={execute:e=>HY(t,e)};return n4(t,HY),t})(),Rb={},xm;function zY(t,e=!0){if(!t)return{error:Yt};if(typeof t!="object")return{error:Jf};if(t.matchUpId)xm=t.matchUpId,Rb[xm]=e?Ot(t):t;else if(Array.isArray(t))for(let i of t.reverse())i.matchUpId&&(Rb[i.matchUpId]=e?Ot(i):i,xm||(xm=i.matchUpId));else for(let i of Object.values(t))i.matchUpId&&(Rb[i.matchUpId]=e?Ot(i):i,xm||(xm=i.matchUpId));return e?Ot(t):t}function LFe(){return Rb[xm]}function FFe(){return Object.values(Rb)}function BFe(){xm=void 0,Rb={}}function $Fe(t){return Ot(Rb[xm],t==null?void 0:t.convertExtensions,!1,t==null?void 0:t.removeExtensions)}var VFe=(()=>{let t={getState:r=>$Fe(r),version:()=>gT(),reset:()=>(BFe(),{...ce}),drawId:void 0,error:void 0,success:!1,devContext:r=>(wD(r),t),setState:(r,a,o)=>{SD(a,o);let s=zY(r);return e(s)}};function e(r){return r!=null&&r.error?(t.error=r.error,t.success=!1):(t.error=void 0,t.success=!0,t.drawId=r.drawId),t}return i([Mv]),t;function i(r){r.forEach(a=>{Object.keys(a).forEach(o=>{t[o]=s=>{if(Jl())return n({params:s,governor:a,methodName:o});try{return n({params:s,governor:a,methodName:o})}catch(l){Yk({engineName:"matchUpEngine",methodName:o,params:s,err:l})}}})})}function n({params:r,governor:a,methodName:o}){t.error=void 0,t.success=!1;let s=(r==null?void 0:r.matchUp)||LFe(),l=(r==null?void 0:r.matchUps)||FFe(),c=(r==null?void 0:r.rollbackOnError)&&Ot(s,!1,!0);r={...r,matchUpId:s==null?void 0:s.matchUpId,matchUps:l,matchUp:s};let u=a[o](r);if(u!=null&&u.error)return c&&zY(c),{...u,rolledBack:!!c};let d=(u==null?void 0:u.success)&&(r==null?void 0:r.delayNotify)!==!0&&(r==null?void 0:r.doNotNotify)!==!0;return d&&LO(),(d||!(u!=null&&u.success)||r!=null&&r.doNotNotify)&&_I(),u}})(),zB=!1,IP=(()=>{let t={version:()=>gT(),setDeepCopy:(n,r)=>(SD(n,r),t),devContext:n=>(wD(n),zB=!0,t)};return i([EO]),t;function e(n,r){let a=n({...r});return a!=null&&a.error||LO(),_I(),zB&&(wD(!1),zB=!1),a}function i(n){n.forEach(r=>{Object.keys(r).forEach(a=>{t[a]=o=>{if(Jl()){let s=e(r[a],o);return!(s!=null&&s.error)&&(o!=null&&o.setState)&&(s!=null&&s.tournamentRecord)&&iI(s.tournamentRecord),s}else try{let s=e(r[a],o);return!(s!=null&&s.error)&&(o!=null&&o.setState)&&(s!=null&&s.tournamentRecord)&&iI(s.tournamentRecord),s}catch(s){let l;typeof s=="string"?l=s.toUpperCase():s instanceof Error&&(l=s.message),console.log("ERROR",{params:JSON.stringify(o),method:a,error:l})}}})})}})();bP.importMethods(_k,!0,1);var My=bP,at=bP;function $pe(t,e){return t&&e&&Array.isArray(e)&&e[t-1]||typeof e=="object"&&e[t]}function jFe(t){let{participation:e={},awardProfiles:i,startDate:n,eventType:r,drawSize:a,drawType:o,category:s,endDate:l,level:c}=t,{participationOrder:u,flightNumber:d,rankingStage:p}=e,h=f=>!n&&!l||!f.dateRanges?!0:f.dateRanges.some(m=>{let g=!n||!m.startDate||new Date(n)>new Date(m.startDate),v=!l||!m.endDate||new Date(l)<=new Date(m.endDate);return g&&v});return{awardProfile:i.find(f=>{var m,g,v,y,b,I,T,w,S,D;return h(f)&&(!f.maxFlightNumber||d<=f.maxFlightNumber)&&(!((m=f.drawTypes)!=null&&m.length)||((g=f.drawTypes)==null?void 0:g.includes(o)))&&(!((v=f.drawSizes)!=null&&v.length)||f.drawSizes.includes(a))&&(!((y=f.stages)!=null&&y.length)||f.stages.includes(p))&&(!((b=f.levels)!=null&&b.length)||f.levels.includes(c))&&(!f.maxDrawSize||a<=f.maxDrawSize)&&(!f.drawSize||f.drawSize===a)&&(!f.maxLevel||c<=f.maxLevel)&&(!d||!((T=(I=f.flights)==null?void 0:I.flightNumbers)!=null&&T.length)||f.flights.flightNumbers.includes(d))&&(!f.participationOrder||f.participationOrder===u)&&(!((w=f.category)!=null&&w.ageCategoryCodes)||f.category.ageCategoryCodes.includes(s==null?void 0:s.ageCategoryCode))&&(!((S=f.eventTypes)!=null&&S.length)||((D=f.eventTypes)==null?void 0:D.includes(r)))})}}function qY({participantWon:t,flightNumber:e,valueObj:i,drawSize:n,flights:r,level:a}){var f,m;let o=(g,v)=>{if(g){if(Array.isArray(v)){let y=v.find(b=>b.flight===g||b.f===g);return y.value||y.v}if(typeof v=="object"){let y=v.flights||v.f;if(Array.isArray(y))return y[g-1]}}},s=(g,v)=>{let y=(g==null?void 0:g.value)||(g==null?void 0:g.v)||(yi(g)?g:0),b=$pe(a,g==null?void 0:g.level);return{value:o(v,b)||yi(b)&&b||y}},l=0,c,u,d,p,h=t&&"won"||t===!1&&"lost"||void 0;if(Array.isArray(i)){let g=i.find(b=>{var I;return b.drawSize===n||((I=b.drawSizes)==null?void 0:I.includes(n))}),v=i.find(b=>b.drawSize&&b.threshold&&n>b.drawSize),y=i.find(b=>{var I;return!b.drawSize&&!((I=b.drawSizes)!=null&&I.length)});h!==void 0&&(g=g==null?void 0:g[h],v=v==null?void 0:v[h],y=y==null?void 0:y[h]),u=s(g,e).value,d=s(v,e).value,p=s(y,e).value,l=u||d||p,c=u&&g.requireWin||d&&v.requireWin||(y==null?void 0:y.requireWin)}else if(typeof i=="object"){let g=(f=i==null?void 0:i.drawSizes)==null?void 0:f[n],v=i;h!==void 0&&(g=g==null?void 0:g[h],v=v==null?void 0:v[h]),u=s(g,e).value,p=s(v,e).value,l=u||p,c=u?g.requireWin:v==null?void 0:v.requireWin}else yi(i)&&h===void 0&&(l=i);return e&&((m=r==null?void 0:r.pct)!=null&&m[e])&&(l=Math.round(l*r.pct[e])),{awardPoints:l,requireWin:c}}function GFe({participantFilters:t,policyDefinitions:e,tournamentRecord:i,level:n}){var v;if(!i)return{error:ut};let{policyDefinitions:r}=em({policyTypes:[vN],tournamentRecord:i}),a=(e==null?void 0:e[vN])??(r==null?void 0:r[vN]);if(!a)return{error:Ok};let o=a.awardProfiles,s=a.requireWinFirstRound,l=a.requireWinForPoints,{participants:c,derivedEventInfo:u,derivedDrawInfo:d,mappedMatchUps:p}=Nr({withRankingProfile:!0,participantFilters:t,tournamentRecord:i}),h=c==null?void 0:c.filter(y=>{var b;return(b=y.draws)==null?void 0:b.length}),f={},m={},g={};for(let y of h??[]){let{participantType:b,participantId:I,person:T,draws:w}=y;for(let S of w){let{drawId:D,structureParticipation:E,eventId:C}=S,P=u[C],R=d[D],N=R==null?void 0:R.drawType,{category:M,eventType:A}=P||{},_=S.startDate||P.startDate||i.startDate,x=S.endDate||P.endDate||i.endDate;if(A===Lc&&I!==Nc)continue;let O;if(o){let B=l,F=0,G=0,H=0,$;for(let q of E){let{finishingPositionRange:z,participationOrder:Z,participantWon:Y,flightNumber:Q,rankingStage:X,winCount:oe}=q;F+=oe||0;let re=R==null?void 0:R.drawSize,{awardProfile:me}=jFe({awardProfiles:o,participation:q,eventType:A,startDate:_,category:M,drawSize:re,drawType:N,endDate:x,level:n});if(me){if(!re)continue;let se=Array.isArray(z)&&Math.max(...z),te=Pi(z||[]).join("-"),he=se&&X!==Zt&&(z==null?void 0:z.includes(re));me.requireWinForPoints!==void 0&&(B=me.requireWinForPoints),me.requireWinFirstRound!==void 0&&(s=me.requireWinFirstRound);let{finishingPositionPoints:ae={},finishingPositionRanges:de,finishingRound:Ie,pointsPerWin:De,flights:Te}=me,_e=Array.isArray(me.perWinPoints)?(v=me.perWinPoints)==null?void 0:v.find(nt=>{var Bt;return(Bt=nt.participationOrders)==null?void 0:Bt.includes(Z)}):me.perWinPoints,Ve=ae.participationOrders,ot=0,St;if((!Ve||Ve.includes(Z))&&de&&se){let nt=de[se];nt&&({awardPoints:ot,requireWin:St}=qY({flightNumber:Q,valueObj:nt,drawSize:re,flights:Te,level:n}))}if(!ot&&Ie&&Z===1&&se){let nt=Ie[se];nt&&({awardPoints:ot,requireWin:St}=qY({participantWon:Y,flightNumber:Q,valueObj:nt,drawSize:re,flights:Te,level:n}))}if(he&&s!==void 0&&(B=s),St!==void 0&&(B=St),ot>G&&(!B||oe)&&(G=ot,$=se),!ot&&De&&oe&&(H+=oe*De,$=te),!ot&&oe&&_e){let nt=$pe(n,_e==null?void 0:_e.level);nt?H+=oe*nt:_e.value&&(H+=oe*_e.value)}}if(O=G+H,b===Nc){let se=(y.matchUps||[]).filter(({structureId:te})=>te===q.structureId);for(let{matchUpId:te}of se){let he=p[te],ae=he.sides.find(de=>de.participantId===I).sideNumber;if(he.winningSice===ae)for(let de of he.tieMatchUps)de.winningSide}}}if(H||G){let q={winCount:F,positionPoints:G,rangeAccessor:$,perWinPoints:H,eventType:A,drawId:D,points:O},z=T==null?void 0:T.personId;z?(f[z]||(f[z]=[]),f[z].push(q)):b===Ti?(g[I]||(g[I]=[]),g[I].push(q)):b===Nc&&(m[I]||(m[I]=[]),m[I].push(q))}}}}return{participantsWithOutcomes:h,personPoints:f,pairPoints:g,teamPoints:m,...ce}}var HFe={getTournamentPoints:GFe},zFe=HFe,qFe={calculateNewRatings:Yse,generateDynamicRatings:Zse},WFe=qFe,KFe={...zFe,...WFe};bP.importMethods(KFe);var YFe=bP,ZFe={[AD]:{roundsToSeparate:void 0,policyName:"Nationality Code",policyAttributes:[{key:"person.nationalityCode"},{key:"individualParticipants.person.nationalityCode"}]}},XFe={[Ef]:{policyName:"positionActionsUnrestricted",enabledStructures:[],otherFlightEntries:!0,disableRoundRestrictions:!0,activePositionOverrides:[Db,F1]}},JFe={[Ef]:{policyName:"positionActionsNoMovement",enabledStructures:[{stages:[],stageSequences:[],enabledActions:[Db,$D,Qb],disabledActions:[]}]}},QFe={[Ef]:{policyName:"positionActionsDisabled",enabledStructures:!1}},eBe={[NT]:{policyName:"Participant Privacy Policy",participant:{contacts:!1,individualParticipants:{onlineResources:!1,participantName:!0,participantOtherName:!0,participantId:!0,participantRole:!0,participantStatus:!0,penalties:!1,rankings:!0,ratings:!0,representing:!0,participantRoleResponsibilities:!1,participantType:!0,person:{addresses:!1,biographicalInformation:!1,birthDate:!1,contacts:!1,nationalityCode:!0,nativeFamilyName:!1,nativeGivenName:!1,onlineResources:!1,otherNames:!0,parentOrganisationId:!1,passportFamilyName:!1,passportGivenName:!1,personId:!1,personOtherIds:!1,previousNames:!1,sex:!1,standardFamilyName:!0,standardGivenName:!0,status:!1,tennisId:!1,wheelchair:!0}},individualParticipantIds:!0,onlineResources:!1,participantName:!0,participantOtherName:!0,participantId:!0,participantRole:!0,participantStatus:!0,penalties:!1,rankings:!0,ratings:!0,representing:!0,participantRoleResponsibilities:!1,participantType:!0,person:{addresses:!1,biographicalInformation:!1,birthDate:!1,contacts:!1,nationalityCode:!0,nativeFamilyName:!1,nativeGivenName:!1,onlineResources:!1,otherNames:!0,parentOrganisationId:!1,passportFamilyName:!1,passportGivenName:!1,personId:!1,personOtherIds:!1,previousNames:!1,sex:!1,standardFamilyName:!0,standardGivenName:!0,status:!1,tennisId:!1,wheelchair:!0}}}},tBe={[Bc]:{processCodes:{incompleteAssignmentsOnDefault:["RANKING.IGNORE"]},defaultMatchUpFormat:Iu,allowDeletionWithScoresPresent:{drawDefinitions:!1,structures:!1},requireParticipantsForScoring:!1,requireAllPositionsAssigned:void 0,allowChangePropagation:!1,stage:{[xt]:{stageSequence:{1:{requireAllPositionsAssigned:!0}}}},matchUpFormats:[],matchUpStatusCodes:{[ol]:[],[Rp]:[],[Zi]:[],[$c]:[],[go]:[],[hn]:[]}}},qB="Personal circumstance",iBe={[Bc]:{requireAllPositionsAssigned:!1,stage:{[xt]:{stageSequence:{1:{requireAllPositionsAssigned:!0}}}},defaultMatchUpFormat:Iu,matchUpFormats:[{description:"Best of 3 tiebreak sets",matchUpFormat:Iu,categoryNames:[],categoryTypes:[]},{description:"Two tiebreak sets, 7-point match tiebreak at one set all",matchUpFormat:"SET3-S:6/TB7-F:TB7"},{description:"Two tiebreak sets, 10-point match tiebreak at one set all",matchUpFormat:"SET3-S:6/TB7-F:TB10"},{description:"One standard tiebreak set to 6, 7-point tiebreak at 6 games all",matchUpFormat:"SET1-S:6/TB7"},{description:"Best of 3 sets to 4",matchUpFormat:"SET3-S:4/TB7"},{description:"Two out of three short sets to 4 with 5-point tiebreak at 3 games all",matchUpFormat:"SET3-S:4/TB5@3"},{description:"One short set to 4, 7-point tiebreak at 4 games all",matchUpFormat:"SET1-S:4/TB7"},{description:"One short set to 4, 5-point tiebreak at 3 games all",matchUpFormat:"SET1-S:4/TB5@3"},{description:"Two short sets to 4, 10-point match tiebreak at one set all",matchUpFormat:"SET3-S:4/TB7-F:TB10"},{description:"Two short sets to 4, 7-point match tiebreak at one set all",matchUpFormat:"SET3-S:4/TB7-F:TB7"},{description:"One no advantage set to 5, tiebreak to 9 at 4-4",matchUpFormat:"SET1-S:5/TB9@4"},{description:"One set to 6 with deciding game at 5 games all",matchUpFormat:"SET1-S:6NOAD"},{description:"One short set to 4, deciding game is played at 3 games all",matchUpFormat:"SET1-S:4NOAD"},{description:"Two short sets to 4 with deciding game at 3-3, 7-point match tiebreak at one set all",matchUpFormat:"SET3-S:4NOAD-F:TB7"},{description:"8 game pro-set with 7 point tiebreak at 8 games all",matchUpFormat:"SET1-S:8/TB7"},{description:"8 game pro-set with 7 point tiebreak at 7 games all",matchUpFormat:"SET1-S:8/TB7@7"},{description:"Best of 3 10-point tiebreak games",matchUpFormat:"SET3-S:TB10"},{description:"One 10-point tiebreak game",matchUpFormat:"SET1-S:TB10"},{description:"Timed 20 minute game - game based",matchUpFormat:"SET1-S:T20"}],matchUpStatusCodes:{[ol]:[{matchUpStatusCodeDisplay:"Abandoned",label:"Abandoned match",matchUpStatusCode:"OA"}],[Rp]:[{matchUpStatusCodeDisplay:"Unplayed or Cancelled",label:"Cancelled match",matchUpStatusCode:"OC"}],[$c]:[{matchUpStatusCodeDisplay:"Incomplete",label:"Incomplete match",matchUpStatusCode:"OI"}],[Zi]:[{description:"Disqualification for cause or ineligibility",label:"Disqualification (ineligibility)",matchUpStatusCodeDisplay:"Def [dq]",matchUpStatusCode:"DQ"},{description:"Misconduct before or between matches",label:"Misconduct",matchUpStatusCodeDisplay:"Def [cond]",matchUpStatusCode:"DM"},{description:"Failure to start match because of adult discipline",label:"Fail. (adult discipline)",matchUpStatusCodeDisplay:"Def [ad]",matchUpStatusCode:"D5"},{description:"Refusal to start match for reason other than adult discipline, injury, illness, or personal circumstance. (After the Referee has conclusively confirmed that a player refuses to play a match, the Referee need not wait until the scheduled time of the match to records the result.)",label:"Refusal to start match",matchUpStatusCodeDisplay:"Def [refsl]",matchUpStatusCode:"D4"},{label:"Not showing up",matchUpStatusCodeDisplay:"Def [ns]",matchUpStatusCode:"D6"},{description:"Lateness for match including, but not limited to, intending to play but mistakenly arriving at the wrong time, location, or without proper equipment",label:"Lateness for match",matchUpStatusCodeDisplay:"Score + Def [late]",matchUpStatusCode:"D7"},{label:"Double default",matchUpStatusCodeDisplay:"Def/Def",matchUpStatusCode:"DD"},{description:"Refusal to continue playing a match for reason other than injury, illness, personal circumstance, or adult discipline",label:"Refusal to continue match",matchUpStatusCodeDisplay:"Def [refsl]",matchUpStatusCode:"D9"},{description:"Default for receiving an injection, IV, or supplemental oxygen",label:"Default (PEDs)",matchUpStatusCodeDisplay:"Def [med]",matchUpStatusCode:"DI"},{description:"Default under Point Penalty System",label:"Default (Point Penalty System)",matchUpStatusCodeDisplay:"Def [pps]",matchUpStatusCode:"DP"}],[hn]:[{matchUpStatusCodeDisplay:"Wo [inj]",matchUpStatusCode:"W1",label:"Injury"},{matchUpStatusCodeDisplay:"Wo [ill]",matchUpStatusCode:"W2",label:"Illness"},{matchUpStatusCodeDisplay:"Wo [pc]",label:qB,matchUpStatusCode:"W3"},{matchUpStatusCodeDisplay:"Wo/Wo",matchUpStatusCode:"WOWO",label:"Double walkover"},{matchUpStatusCodeDisplay:"Wo [Tae]",label:"Tournament Administrative Error",matchUpStatusCode:"W4"},{matchUpStatusCodeDisplay:"Wo/Withdrawn",matchUpStatusCode:"W5",label:"Withdrawn"}],[go]:[{matchUpStatusCodeDisplay:"Ret [inj]",matchUpStatusCode:"RJ",label:"Injury"},{matchUpStatusCodeDisplay:"Ret [ill]",matchUpStatusCode:"RI",label:"Illness"},{matchUpStatusCodeDisplay:"Ret [pc]",label:qB,matchUpStatusCode:"RC"},{description:"Retirement because of adult discipline",label:"Ret. (adult discipline)",matchUpStatusCodeDisplay:"Ret [ad]",matchUpStatusCode:"RD"},{description:"A player who retires from a match remains eligible for consolations, place playoffs, doubles and subsequent round robin matches",matchUpStatusCodeDisplay:"Ret [elg]",label:"Ret. (eligible)",matchUpStatusCode:"RU"}],[yh]:[{matchUpStatusCodeDisplay:"Wd [inj]",matchUpStatusCode:"WD.INJ",label:"Injury"},{matchUpStatusCodeDisplay:"Wd [ill]",matchUpStatusCode:"WD.ILL",label:"Illness"},{matchUpStatusCodeDisplay:"Wd [pc]",label:qB,matchUpStatusCode:"WD.PC"},{matchUpStatusCodeDisplay:"Wd/Wd",matchUpStatusCode:"WD.WD",label:"Double withdrawal"},{label:"Tournament Administrative Error",matchUpStatusCodeDisplay:"Wd [Tae]",matchUpStatusCode:"WD.TAE"}]}}},nBe={[uu]:{seedingProfile:{positioning:Xk},validSeedPositions:{ignore:!0},duplicateSeedNumbers:!0,drawSizeProgression:!0,policyName:"ITF SEEDING",seedsCountThresholds:[{drawSize:4,minimumParticipantCount:3,seedsCount:2},{drawSize:16,minimumParticipantCount:12,seedsCount:4},{drawSize:32,minimumParticipantCount:24,seedsCount:8},{drawSize:64,minimumParticipantCount:48,seedsCount:16},{drawSize:128,minimumParticipantCount:97,seedsCount:32},{drawSize:256,minimumParticipantCount:192,seedsCount:64}]}},rBe={POLICY_AVOIDANCE_COUNTRY:ZFe,POLICY_POSITION_ACTIONS_DEFAULT:Nse,POLICY_POSITION_ACTIONS_DISABLED:QFe,POLICY_POSITION_ACTIONS_NO_MOVEMENT:JFe,POLICY_POSITION_ACTIONS_UNRESTRICTED:XFe,POLICY_PRIVACY_DEFAULT:eBe,POLICY_ROUND_NAMING_DEFAULT:dq,POLICY_SCHEDULING_DEFAULT:Wce,POLICY_SCORING_DEFAULT:tBe,POLICY_SCORING_USTA:iBe,POLICY_SEEDING_ITF:nBe,POLICY_SEEDING_DEFAULT:Mce},Qm={ratingsParameters:La,matchUpFormats:QAe,countryToFlag:mae,tieFormats:yue,countries:Fm,policies:rBe,flagIOC:nMe},ks={};$i(ks,{activeMatchUpStatuses:()=>dx,auditConstants:()=>sue,completedMatchUpStatuses:()=>ba,directingMatchUpStatuses:()=>Az,displayConstants:()=>Vce,drawDefinitionConstants:()=>pa,entryStatusConstants:()=>$u,errorConditionConstants:()=>ore,eventConstants:()=>pl,extensionConstants:()=>Pv,flightConstants:()=>wue,genderConstants:()=>Mp,keyValueConstants:()=>p3,matchUpActionConstants:()=>i3,matchUpStatusConstants:()=>xz,matchUpTypes:()=>hae,nonDirectingMatchUpStatuses:()=>_z,particicipantsRequiredMatchUpStatuses:()=>Mz,participantConstants:()=>Yo,participantRoles:()=>Mg,participantTypes:()=>$0,penaltyConstants:()=>Vpe,policyConstants:()=>Iy,positionActionConstants:()=>KI,ratingConstants:()=>rse,recoveryTimeRequiredMatchUpStatuses:()=>nae,requestConstants:()=>Que,resourceContants:()=>Dre,resultConstants:()=>Jie,scaleConstants:()=>PT,scheduleConstants:()=>Vae,sortingConstants:()=>Tue,surfaceConstants:()=>jpe,tieFormatConstants:()=>Tce,timeItemConstants:()=>bx,topicConstants:()=>uae,tournamentConstants:()=>YW,upcomingMatchUpStatuses:()=>kz,validMatchUpStatuses:()=>Nz,venueConstants:()=>Gpe,weekdayConstants:()=>iW});var aBe="Coaching",oBe="Ball Abuse",sBe="Racket Abuse",lBe="Verbal Abuse",cBe="INELIGIBILITY",uBe="Physical Abuse",dBe="Unsportmanlike Conduct",pBe="Dress Code Violation",hBe="Equipment Violation",fBe="Leaving the court",mBe="Failure to complete",gBe="No Show",vBe="Other",yBe="REFUSAL_TO_PLAY",bBe="PROHIBITED_SUBSTANCE",IBe="Puncuality",wBe="Failure to sign in",Vpe={COACHING:aBe,BALL_ABUSE:oBe,RACKET_ABUSE:sBe,VERBAL_ABUSE:lBe,PHYSICAL_ABUSE:uBe,INELIGIBILITY:cBe,UNSPORTSMANLIKE_CONDUCT:dBe,PROHIBITED_SUBSTANCE:bBe,DRESS_CODE_VIOLATION:pBe,EQUIMENT_VIOLATION:hBe,LEAVING_THE_COURT:fBe,REFUSAL_TO_PLAY:yBe,FAILURE_TO_COMPLETE:mBe,NO_SHOW:gBe,OTHER:vBe,PUNCTUALITY:IBe,FAILUIRE_TO_SIGN_IN:wBe},SBe="CLAY",TBe="HARD",UBe="GRASS",DBe="CARPET",EBe="ARTIFICIAL",jpe={CLAY:SBe,HARD:TBe,GRASS:UBe,CARPET:DBe,ARTIFICIAL:EBe},CBe="INDOOR",PBe="OUTDOOR",Gpe={INDOOR:CBe,OUTDOOR:PBe};const CV=Object.freeze(Object.defineProperty({__proto__:null,activeMatchUpStatuses:dx,askEngine:OFe,asyncEngine:kFe,auditConstants:sue,competitionEngine:My,competitionGovernor:DH,completedMatchUpStatuses:ba,directingMatchUpStatuses:Az,displayConstants:Vce,drawDefinitionConstants:pa,drawsGovernor:Ez,entriesGovernor:X3,entryStatusConstants:$u,errorConditionConstants:ore,eventConstants:pl,eventGovernor:eW,extensionConstants:Pv,factoryConstants:ks,fixtures:Qm,flightConstants:wue,forge:DFe,genderConstants:Mp,generationGovernor:uW,globalState:B0,governors:_k,keyValueConstants:p3,matchUpActionConstants:i3,matchUpEngine:VFe,matchUpFormatCode:_f,matchUpFormatGovernor:_f,matchUpGovernor:hW,matchUpStatusConstants:xz,matchUpTypes:hae,mocksEngine:IP,mocksGovernor:EO,nonDirectingMatchUpStatuses:_z,particicipantsRequiredMatchUpStatuses:Mz,participantConstants:Yo,participantGovernor:BW,participantRoles:Mg,participantTypes:$0,penaltyConstants:Vpe,policyConstants:Iy,policyGovernor:w3,positionActionConstants:KI,publishingGovernor:_O,queryGovernor:iP,ratingConstants:rse,recoveryTimeRequiredMatchUpStatuses:nae,reportGovernor:VW,requestConstants:Que,resourceContants:Dre,resultConstants:Jie,scaleConstants:PT,scaleEngine:YFe,scheduleConstants:Vae,scheduleGovernor:jW,scoreGovernor:Mv,sortingConstants:Tue,surfaceConstants:jpe,syncEngine:Bpe,tieFormatConstants:Tce,tieFormatGovernor:HW,timeItemConstants:bx,tools:_i,topicConstants:uae,tournamentConstants:YW,tournamentEngine:at,tournamentGovernor:KW,upcomingMatchUpStatuses:kz,utilities:_i,validMatchUpStatuses:Nz,venueConstants:Gpe,venueGovernor:ZW,version:gT,weekdayConstants:iW},Symbol.toStringTag,{value:"Module"})),{AFTER_REST:Hpe,FOLLOWED_BY:zpe,NEXT_AVAILABLE:qpe,NOT_BEFORE:Wpe,TO_BE_ANNOUNCED:Kpe}=ks.timeItemConstants,{SCHEDULE_ERROR:RBe,SCHEDULE_CONFLICT:MBe,SCHEDULE_WARNING:NBe}=ks.scheduleConstants,{ORGANISER_ACCEPTANCE:ABe,DIRECT_ACCEPTANCE:_Be,SPECIAL_EXEMPT:kBe,JUNIOR_EXEMPT:xBe,ALTERNATE:OBe,WILDCARD:LBe}=$u,Ype="All statuses",FBe="All genders",ZD="All flights",WY="All rounds",eg="All events",BBe="No events",Zpe="All teams",Xpe="All Types",$Be="Any team",Jpe="registration",VBe="timepicker",jBe="timevalue",$1="tmxContent",Qpe="tmxDrawer",XD="splash",FO="superadmin",GBe="admin",YA="competitionEngine",HBe="tournamentEngine",bh="tournaments",ehe="drawEntries",Fo="tournament",PV="structure",the="invite",ob="event",y1="draw",RV="view",JD="tournamentEvents",QT="overview",kf="participants",Qv="schedule",r4="matchUps",qp="events",a4="venues",zBe="unscheduled",wP={success:!0},qBe=10,ihe="ISSUE",bc="Automated",o4="Manual",nhe={[RBe]:"matchup-error",[MBe]:"matchup-conflict",[ihe]:"matchup-issue",[NBe]:"matchup-warning"},ZA="tournamentParticipants",rhe="scheduledDateFilter",Mb="unscheduledMatchUps",BO="tournamentsCalendar",XA="tournamentMatchUps",JA="tournamentSchedule",MV="tournamentsTable",QA="tournamentTeams",e_="venuesTable",ahe="entriesCount",ohe="eventsTable",QD="tmxOverlay",s4="teamStats",l4="drawControl",WBe="drawFrame",she="drawRight",lhe="drawLeft",che="entriesView",Ih="drawsView",SP="QUALIFYING",ed="ACCEPTED",uhe="eventInfo",c4="acceptedPanel",u4="alternatesPanel",d4="qualifyingPanel",p4="ungroupedPanel",h4="withdrawaPanel",dhe="unscheduledVisibility",phe="tournamentsControl",f4="participantControl",m4="unscheduledControl",g4="scheduleControl",v4="matchUpsControl",y4="venuesControl",b4="eventsControl",TP="eventControl",I4="teamsControl",KBe="controlBar",hhe="buttonBar",ub="tmxPanel",fhe="tmxTable",mhe="tcContainer",Ua="overlay",li="center",t_="header",Qt="right",ci="left",gp="bottom",KY="top",$O="subTable",wS="",SM="flex",Mt="none",ghe="isOpen",w4="Collection value",S4="Match value",T4="Score value",U4="Set value",XU={[Hpe]:"After rest",[zpe]:"Followed by",[Kpe]:"To be announced",[qpe]:"Next available",[Wpe]:"Not before"},YBe={[Hpe]:"After rest",[zpe]:"Followed by",[Kpe]:"TBA",[qpe]:"Next available",[Wpe]:"NB"},vhe={[ABe]:"OA",[_Be]:"DA",[kBe]:"SE",[xBe]:"JE",[SP]:"QUAL",[OBe]:"ALT",[LBe]:"WC"},i_="Playoff",pv="drawSize",n_="CUSTOM",f0="advancePerGroup",r_="qualifiersCount",a_="groupRemaining",D4="matchUpFormat",eE="structureName",V1="playoffType",lf="groupSize",yhe="positions",nI="drawName",Yp="drawType",j1="top",ZBe="winners",NV="roundsColumns",SS="roundsStats",TS="roundsTable",rI="utr",tE="wtn",G1={},XBe={position:"top-right",clickClose:!0,duration:2e3,offsetBottom:0,offsetRight:0,offsetLeft:0,offsetTop:0,opacity:1},JBe=(t,e,i,n,r)=>{const a=t.split("-"),o=a.includes(ci)&&`left:${n}`,s=a.includes(Qt)&&`right:${r}`,l=a.includes("top")&&`top:${e}`,c=a.includes("bottom")&&`bottom:${i}`,u="align-items: "+(a.includes("left")&&"flex-start"||a.includes("right")&&"flex-end"||li),d="text-align: "+(a.includes("left")&&"left"||a.includes("right")&&"right"||li);return[o,s,l,c,u,d].filter(Boolean).join(";")};function QBe(t){if(G1.position)return G1.position;const e=document.createElement("div");return e.style="position: fixed; display: flex; flex-direction: column; width:100%; z-index: 9999; pointer-events: none;padding:15px;"+JBe(t.position,t.offsetTop,t.offsetBottom,t.offsetLeft,t.offsetRight),(t.appendTo||document.body).appendChild(e),G1.position=e,e}function e$e(t){if(!t.message)return{error:"Missing message"};const e={...XBe,...t},i=QBe(e),n=t$e(e);if(e.onlyOne){let r=i.lastElementChild;for(;r;)i.removeChild(r),r=i.lastElementChild}i.appendChild(n.element)}function t$e(t){var l,c;const e=document.createElement("div");t.clickClose&&e.addEventListener("click",()=>a(t.onClose));const i=t.duration&&iPe(()=>a(t.onClose),t.duration);i&&t.pauseOnHover&&(e.addEventListener("mouseover",i.pause),e.addEventListener("mouseout",i.resume)),e.style=`display:inline-flex;width:auto;pointer-events:auto;white-space:pre-wrap;opacity:${t.opacity};${t.dismissible?"":"padding: 1.25rem, 1.5rem;"}`;const n=["notification"];if(typeof t.classList=="string"&&n.push(t.classList),t.type&&n.push(t.type),(l=t==null?void 0:t.animate)!=null&&l.in){const u=t.animate.speed?`animate__${t.animate.speed}`:"animate__faster",d=`animate__${t.animate.in}`;n.push(`animate__animated ${d} ${u}`),s(()=>e.classList.remove(d))}if(e.className=n.join(" "),t.dismissible){const u=document.createElement("button");u.className="delete",u.addEventListener("click",()=>a(t.onClose)),e.insertAdjacentElement("afterbegin",u)}const r=document.createElement("div");if(r.style="display: flex; flex-direction: row; align-items: center; justify-content: center;",typeof t.message=="string"?r.insertAdjacentHTML("beforeend",t.message):t.message&&console.log(" MESSAGE ",t.message,typeof t.messsage),Nt((c=t.action)==null?void 0:c.onClick)){const u=document.createElement("button");u.style="margin-left: 1em;",u.className="button",u.innerHTML=t.action.text||"OK",u.addEventListener("click",t.action.onClick),r.appendChild(u)}return e.appendChild(r),{element:e};function a(u){var d;Nt(u)&&u(),(d=t==null?void 0:t.animate)!=null&&d.out?(e.classList.add(`animate__${t.animate.out}`),s(()=>{o(e.parentNode),delete G1.position,e.remove()})):(o(e.parentNode),delete G1.position,e.remove())}function o(u){u&&u.children.length<=1&&u.remove()}function s(u=()=>{}){const d={WebkitAnimation:"webkitAnimationEnd",MozAnimation:"mozAnimationEnd",OAnimation:"oAnimationEnd",animation:"animationend"};for(const p in d)if(e.style[p]!==void 0){e.addEventListener(d[p],()=>u());break}}}function ti(t){const{position:e="top-center",intent:i="is-success",pauseOnHover:n=!1,dismissible:r=!0,clickClose:a=!0,duration:o=2500,single:s=!0,onClose:l,offsetBottom:c=0,offsetRight:u=0,offsetLeft:d=0,offsetTop:p=0,opacity:h=1,message:f,action:m}=t??{};e$e({animate:{in:"fadeIn",out:"fadeOut"},pauseOnHover:n,offsetBottom:c,type:i,offsetRight:u,dismissible:r,offsetLeft:d,clickClose:a,offsetTop:p,duration:o,position:e,message:f,onClose:l,opacity:h,action:m,single:s})}function i$e(){ti({intent:"is-success",message:"New Version Cached: Close Tab or Browser and Re-open to Update"})}function n$e(){let t=`${Bo.tr("phrases.blocked")}. ${Bo.tr("phrases.enablepopups")}`;return ti({intent:"is-danger",message:t})}function r$e(){const t=document.createElement("div");return t.className="is-marginless",t.style.width="inherit",t.id="o-tab",t.innerHTML=`
    <div class="tab_section events_tab">
        <div class="section">
            <div id=${QT} class="box tournament-information">
            </div>
        </div>
    </div>
  `,t}function a$e(){const t=document.getElementById("dnav"),e=window.pageXOffset!==void 0,i=(document.compatMode||"")==="CSS1Compat";let n=0;const r=()=>{let c=e?window.pageYOffset:i?document.documentElement.scrollTop:document.body.scrollTop,u;return c>n?u=!0:u=!1,n=c,u},a=()=>{r()&&!t.contains(document.activeElement)?(t.classList.add("scroll-down"),t.classList.remove("scroll-up")):(t.classList.add("scroll-up"),t.classList.remove("scroll-down"))};var o;const s=(c,u)=>{o||(o=!0,setTimeout(()=>{c(),o=!1},u))},l=window.matchMedia("(prefers-reduced-motion: reduce)");window.addEventListener("scroll",()=>{l&&!l.matches&&s(a,250)})}function o$e(){const t=document.createElement("div");return t.className="is-marginless",t.style.width="inherit",t.id="e-tab",t.innerHTML=`
  <div class="tab_section events_tab">
    <div class="section">
      <div class='tabHeader foreground'></div>
      <div id=${uhe} class="block" style='display: none; width: 100%;'}>
        <div id=${TP} class="controlBar" style='min-height: 3em; border-radius: 6px;'}></div>
      </div>
      <div id=${ohe}>
        <div id=${b4} class="controlBar"></div>
        <div id=${JD} class="tableClass flexcol flexcenter">
          {' '}
        </div>
      </div>
      <div id=${che} style='display: none;'}>
        <div id=${c4} class='tableClass block ${ub}'>
          {' '}
        </div>
        <div id=${d4} class='tableClass block ${ub}'>
          {' '}
        </div>
        <div id=${u4} class='tableClass block ${ub}'>
          {' '}
        </div>
        <div id=${p4} class='tableClass block ${ub}'>
          {' '}
        </div>
        <div id=${h4} class='tableClass block ${ub}'>
          {' '}
        </div>
      </div>
      <div style="width: 100%; margin: 0">
        <div id=${l4}></div>
        <div id=${WBe} class="flexrow flexjustifystart" style="width: 100%">
          <div id=${lhe} ></div>
          <div
            id=${Ih}
            style="overflow-x: scroll; width: 100%; display: none;"
          >
          </div>
          <div id=${she} ></div>
        </div>
      </div>
    </div>
  </div>
  `,t}const s$e=""+new URL("orgLogo-DsK9KK2k.png",import.meta.url).href;function l$e(){const t=document.createElement("img");return t.style.maxWidth="800px",t.style.width="100%",t.alt="tmxLogo",t.src=s$e,t}function c$e(){const t=document.getElementById("root");t.appendChild(u$e());const e=document.createElement("div");e.className="flexrow flexcenter",e.id=XD,e.style="margin-top: 2em; padding-top: 5em; display: none;",e.appendChild(l$e()),t.appendChild(e);const i=document.createElement("div");i.style.display=Mt,i.id=VBe;const n=document.createElement("input");n.className="timepicker-ui-input",n.id=jBe,n.type="text",i.appendChild(n),t.appendChild(i);const r=document.createElement("section");r.className="drawer drawer--left",r.setAttribute("data-drawer-target",""),r.id=Qpe,r.innerHTML=`
      <div class="drawer__overlay" data-drawer-close tabIndex="-1"></div>
      <div class="drawer__wrapper">
        <div class="drawer__header">
          <div class="drawer__title"></div>
          <button
            class="drawer__close"
            style='display: none;'}
            data-drawer-close
            aria-label="Close Drawer"
          ></button>
        </div>
        <div class="drawer__content"></div>
        <div class="drawer__footer"></div>
      </div>
  `,t.appendChild(r);const a=document.getElementById("navMain"),o=document.createElement("div");o.id=$1,o.className="springboard flexrow flexcenter",o.style.display=Mt;const s=document.createElement("div");s.id="navText",s.className="navText",s.style.display=Mt,o.appendChild(s);const l=document.createElement("div");l.id=mhe,l.className="flexcol flexcenter tournament_container",l.appendChild(r$e()),l.appendChild(o$e()),o.appendChild(l),a.appendChild(o);const c=document.createElement("div");c.className="flexcol flexgrow",c.style.display=Mt,c.id=bh;const u=document.createElement("div");u.className="controlBar flexcol flexgrow flexcenter",u.id=phe,c.appendChild(u);const d=document.createElement("div");d.className="flexcol flexgrow flexcenter box",d.id=MV,c.appendChild(d),a.appendChild(c);const p=document.createElement("div");return p.className="flexcol flexgrow",p.style.paddingTop="3em",p.style.display=Mt,p.style.height="90%",p.style.width="100%",p.id=BO,a.appendChild(p),a$e(),t}function u$e(){const t=document.createElement("div");return t.innerHTML=`<div id='dnav'>
    <div class="navbar-item" style="display: flex; flex-wrap: nowrap">
      <div id="provider" style="display: flex; flex-direction: column">
        <div style="font-size: .6em">TMX</div>
      </div>
      <div style="padding-left: 1em" id="pageTitle"> </div>
    </div>
    <div id='trnynav' class="navbar-item" style="display: flex; flex-direction: row;">
      <i id='o-route' class="nav-icon fa-solid fa-trophy"></i>
      <i id='p-route' class="nav-icon fa-solid fa-user-group" style="color: blue"></i>
      <i id='e-route' class="nav-icon fa-solid fa-diagram-project"></i>
      <i id='m-route' class="nav-icon fa-solid fa-table-tennis-paddle-ball"></i>
      <i id='s-route' class="nav-icon fa-solid fa-clock"></i>
      <i id='v-route' class="nav-icon fa-solid fa-location-dot"></i>
    </div>
    <div class="navbar-item" style="font-size: 1em">
      <i id="config" class="fa-solid fa-sliders"></i>
      <i id="login" style="padding-left: .5em" class="fa-solid fa-circle-user"></i>
    </div>
  </div>
  <main id="navMain"></main>`,t}window.location.hostname==="localhost"||window.location.hostname==="[::1]"||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/);function d$e(){"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(t=>{t.unregister()})}function as(t){if(t)for(;t.firstChild;)t.removeChild(t.firstChild)}const RN={[QT]:"o-tab",[kf]:"p-tab",[qp]:"e-tab",[r4]:"m-tab",[Qv]:"s-tab",[a4]:"v-tab"};function p$e(){const t=`
        <div id='individuals' class='tab_section participants_tab'>
          <div class='section'>
            <div class='tabHeader foreground'>Participants</div>
            <div id='${f4}' class='controlBar'></div>
            <div id='${ZA}' class='tableClass flexcol flexcenter'> </div>
          </div>
        </div>
        <div id='participantGroupings' class='tab_section participants_tab'>
            <div class='section'>
              <div class='tabHeader foreground'></div>
              <div id='${I4}' class='controlBar'></div>
              <div id='${QA}' class='tableClass flexcol flexcenter'> </div>
            </div>
        </div>
        `,e=`
        <div class='tab_section sch_tab'>
            <div class='section block'>
              <div id='${dhe}' style='width: 100%; display: none;'>
                  <div id='${m4}' class='controlBar flexcol flexcenter'></div>
                  <div id='${Mb}' class='tableClass flexcol flexcenter'></div>
              </div>
              <div>
                  <div id='${g4}' class='controlBar flexcol flexcenter'></div>
                  <div id='${JA}' class='tableClass flexcol flexcenter'></div>
              </div>
            </div>
        </div>
        `,i=`
        <div class='tab_section venues_tab'>
            <div class='section'>
              <div class='tabHeader foreground'></div>
              <div id='${y4}' class='controlBar'></div>
              <div id='${e_}' class='tableClass flexcol flexcenter'></div>
            </div>
        </div>
        `,n=`
        <div class='tab_section matchUps_tab'>
            <div class='section'>
              <div class='tabHeader foreground'></div>
              <div id='${v4}' class='controlBar'></div>
              <div id='${s4}' class='controlBar'></div>
              <div id='${XA}' class='tableClass flexcol flexcenter'> </div>
            </div>
        </div>
        `,r={"p-tab":t,"s-tab":e,"v-tab":i,"m-tab":n},a=document.getElementById(mhe);Object.keys(r).forEach(o=>{const s=document.createElement("div");s.class="is-marginless",s.style="width: inherit",s.id=o,s.innerHTML=r[o],a.appendChild(s)}),bhe(kf)}function bhe(t){return Object.keys(RN).includes(t)?(Object.keys(RN).forEach(e=>{const i=RN[e],n=document.getElementById(i);n?n.style.display=t===e?"":Mt:console.log({key:e,id:i,element:n})}),{...wP}):!1}function h$e(){[Ih,b4,v4,f4,m4,TP,I4,g4,y4,s4,c4,u4,d4,p4,h4,JD,XA,ZA,JA,QA,Mb,e_].forEach(e=>{const i=RN[e],n=document.getElementById(i);n&&as(n)})}function Ihe(){return"tmxToken"}function whe(t,e){return function(){return t.apply(e,arguments)}}const{toString:f$e}=Object.prototype,{getPrototypeOf:E4}=Object,VO=(t=>e=>{const i=f$e.call(e);return t[i]||(t[i]=i.slice(8,-1).toLowerCase())})(Object.create(null)),am=t=>(t=t.toLowerCase(),e=>VO(e)===t),jO=t=>e=>typeof e===t,{isArray:eU}=Array,iE=jO("undefined");function m$e(t){return t!==null&&!iE(t)&&t.constructor!==null&&!iE(t.constructor)&&ip(t.constructor.isBuffer)&&t.constructor.isBuffer(t)}const She=am("ArrayBuffer");function g$e(t){let e;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?e=ArrayBuffer.isView(t):e=t&&t.buffer&&She(t.buffer),e}const v$e=jO("string"),ip=jO("function"),The=jO("number"),GO=t=>t!==null&&typeof t=="object",y$e=t=>t===!0||t===!1,MN=t=>{if(VO(t)!=="object")return!1;const e=E4(t);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in t)&&!(Symbol.iterator in t)},b$e=am("Date"),I$e=am("File"),w$e=am("Blob"),S$e=am("FileList"),T$e=t=>GO(t)&&ip(t.pipe),U$e=t=>{let e;return t&&(typeof FormData=="function"&&t instanceof FormData||ip(t.append)&&((e=VO(t))==="formdata"||e==="object"&&ip(t.toString)&&t.toString()==="[object FormData]"))},D$e=am("URLSearchParams"),E$e=t=>t.trim?t.trim():t.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function UP(t,e,{allOwnKeys:i=!1}={}){if(t===null||typeof t>"u")return;let n,r;if(typeof t!="object"&&(t=[t]),eU(t))for(n=0,r=t.length;n<r;n++)e.call(null,t[n],n,t);else{const a=i?Object.getOwnPropertyNames(t):Object.keys(t),o=a.length;let s;for(n=0;n<o;n++)s=a[n],e.call(null,t[s],s,t)}}function Uhe(t,e){e=e.toLowerCase();const i=Object.keys(t);let n=i.length,r;for(;n-- >0;)if(r=i[n],e===r.toLowerCase())return r;return null}const Dhe=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,Ehe=t=>!iE(t)&&t!==Dhe;function AV(){const{caseless:t}=Ehe(this)&&this||{},e={},i=(n,r)=>{const a=t&&Uhe(e,r)||r;MN(e[a])&&MN(n)?e[a]=AV(e[a],n):MN(n)?e[a]=AV({},n):eU(n)?e[a]=n.slice():e[a]=n};for(let n=0,r=arguments.length;n<r;n++)arguments[n]&&UP(arguments[n],i);return e}const C$e=(t,e,i,{allOwnKeys:n}={})=>(UP(e,(r,a)=>{i&&ip(r)?t[a]=whe(r,i):t[a]=r},{allOwnKeys:n}),t),P$e=t=>(t.charCodeAt(0)===65279&&(t=t.slice(1)),t),R$e=(t,e,i,n)=>{t.prototype=Object.create(e.prototype,n),t.prototype.constructor=t,Object.defineProperty(t,"super",{value:e.prototype}),i&&Object.assign(t.prototype,i)},M$e=(t,e,i,n)=>{let r,a,o;const s={};if(e=e||{},t==null)return e;do{for(r=Object.getOwnPropertyNames(t),a=r.length;a-- >0;)o=r[a],(!n||n(o,t,e))&&!s[o]&&(e[o]=t[o],s[o]=!0);t=i!==!1&&E4(t)}while(t&&(!i||i(t,e))&&t!==Object.prototype);return e},N$e=(t,e,i)=>{t=String(t),(i===void 0||i>t.length)&&(i=t.length),i-=e.length;const n=t.indexOf(e,i);return n!==-1&&n===i},A$e=t=>{if(!t)return null;if(eU(t))return t;let e=t.length;if(!The(e))return null;const i=new Array(e);for(;e-- >0;)i[e]=t[e];return i},_$e=(t=>e=>t&&e instanceof t)(typeof Uint8Array<"u"&&E4(Uint8Array)),k$e=(t,e)=>{const n=(t&&t[Symbol.iterator]).call(t);let r;for(;(r=n.next())&&!r.done;){const a=r.value;e.call(t,a[0],a[1])}},x$e=(t,e)=>{let i;const n=[];for(;(i=t.exec(e))!==null;)n.push(i);return n},O$e=am("HTMLFormElement"),L$e=t=>t.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(i,n,r){return n.toUpperCase()+r}),YY=(({hasOwnProperty:t})=>(e,i)=>t.call(e,i))(Object.prototype),F$e=am("RegExp"),Che=(t,e)=>{const i=Object.getOwnPropertyDescriptors(t),n={};UP(i,(r,a)=>{let o;(o=e(r,a,t))!==!1&&(n[a]=o||r)}),Object.defineProperties(t,n)},B$e=t=>{Che(t,(e,i)=>{if(ip(t)&&["arguments","caller","callee"].indexOf(i)!==-1)return!1;const n=t[i];if(ip(n)){if(e.enumerable=!1,"writable"in e){e.writable=!1;return}e.set||(e.set=()=>{throw Error("Can not rewrite read-only method '"+i+"'")})}})},$$e=(t,e)=>{const i={},n=r=>{r.forEach(a=>{i[a]=!0})};return eU(t)?n(t):n(String(t).split(e)),i},V$e=()=>{},j$e=(t,e)=>(t=+t,Number.isFinite(t)?t:e),WB="abcdefghijklmnopqrstuvwxyz",ZY="0123456789",Phe={DIGIT:ZY,ALPHA:WB,ALPHA_DIGIT:WB+WB.toUpperCase()+ZY},G$e=(t=16,e=Phe.ALPHA_DIGIT)=>{let i="";const{length:n}=e;for(;t--;)i+=e[Math.random()*n|0];return i};function H$e(t){return!!(t&&ip(t.append)&&t[Symbol.toStringTag]==="FormData"&&t[Symbol.iterator])}const z$e=t=>{const e=new Array(10),i=(n,r)=>{if(GO(n)){if(e.indexOf(n)>=0)return;if(!("toJSON"in n)){e[r]=n;const a=eU(n)?[]:{};return UP(n,(o,s)=>{const l=i(o,r+1);!iE(l)&&(a[s]=l)}),e[r]=void 0,a}}return n};return i(t,0)},q$e=am("AsyncFunction"),W$e=t=>t&&(GO(t)||ip(t))&&ip(t.then)&&ip(t.catch),yt={isArray:eU,isArrayBuffer:She,isBuffer:m$e,isFormData:U$e,isArrayBufferView:g$e,isString:v$e,isNumber:The,isBoolean:y$e,isObject:GO,isPlainObject:MN,isUndefined:iE,isDate:b$e,isFile:I$e,isBlob:w$e,isRegExp:F$e,isFunction:ip,isStream:T$e,isURLSearchParams:D$e,isTypedArray:_$e,isFileList:S$e,forEach:UP,merge:AV,extend:C$e,trim:E$e,stripBOM:P$e,inherits:R$e,toFlatObject:M$e,kindOf:VO,kindOfTest:am,endsWith:N$e,toArray:A$e,forEachEntry:k$e,matchAll:x$e,isHTMLForm:O$e,hasOwnProperty:YY,hasOwnProp:YY,reduceDescriptors:Che,freezeMethods:B$e,toObjectSet:$$e,toCamelCase:L$e,noop:V$e,toFiniteNumber:j$e,findKey:Uhe,global:Dhe,isContextDefined:Ehe,ALPHABET:Phe,generateString:G$e,isSpecCompliantForm:H$e,toJSONObject:z$e,isAsyncFn:q$e,isThenable:W$e};function Tr(t,e,i,n,r){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=t,this.name="AxiosError",e&&(this.code=e),i&&(this.config=i),n&&(this.request=n),r&&(this.response=r)}yt.inherits(Tr,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:yt.toJSONObject(this.config),code:this.code,status:this.response&&this.response.status?this.response.status:null}}});const Rhe=Tr.prototype,Mhe={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(t=>{Mhe[t]={value:t}});Object.defineProperties(Tr,Mhe);Object.defineProperty(Rhe,"isAxiosError",{value:!0});Tr.from=(t,e,i,n,r,a)=>{const o=Object.create(Rhe);return yt.toFlatObject(t,o,function(l){return l!==Error.prototype},s=>s!=="isAxiosError"),Tr.call(o,t.message,e,i,n,r),o.cause=t,o.name=t.name,a&&Object.assign(o,a),o};const K$e=null;function _V(t){return yt.isPlainObject(t)||yt.isArray(t)}function Nhe(t){return yt.endsWith(t,"[]")?t.slice(0,-2):t}function XY(t,e,i){return t?t.concat(e).map(function(r,a){return r=Nhe(r),!i&&a?"["+r+"]":r}).join(i?".":""):e}function Y$e(t){return yt.isArray(t)&&!t.some(_V)}const Z$e=yt.toFlatObject(yt,{},null,function(e){return/^is[A-Z]/.test(e)});function HO(t,e,i){if(!yt.isObject(t))throw new TypeError("target must be an object");e=e||new FormData,i=yt.toFlatObject(i,{metaTokens:!0,dots:!1,indexes:!1},!1,function(m,g){return!yt.isUndefined(g[m])});const n=i.metaTokens,r=i.visitor||u,a=i.dots,o=i.indexes,l=(i.Blob||typeof Blob<"u"&&Blob)&&yt.isSpecCompliantForm(e);if(!yt.isFunction(r))throw new TypeError("visitor must be a function");function c(f){if(f===null)return"";if(yt.isDate(f))return f.toISOString();if(!l&&yt.isBlob(f))throw new Tr("Blob is not supported. Use a Buffer instead.");return yt.isArrayBuffer(f)||yt.isTypedArray(f)?l&&typeof Blob=="function"?new Blob([f]):Buffer.from(f):f}function u(f,m,g){let v=f;if(f&&!g&&typeof f=="object"){if(yt.endsWith(m,"{}"))m=n?m:m.slice(0,-2),f=JSON.stringify(f);else if(yt.isArray(f)&&Y$e(f)||(yt.isFileList(f)||yt.endsWith(m,"[]"))&&(v=yt.toArray(f)))return m=Nhe(m),v.forEach(function(b,I){!(yt.isUndefined(b)||b===null)&&e.append(o===!0?XY([m],I,a):o===null?m:m+"[]",c(b))}),!1}return _V(f)?!0:(e.append(XY(g,m,a),c(f)),!1)}const d=[],p=Object.assign(Z$e,{defaultVisitor:u,convertValue:c,isVisitable:_V});function h(f,m){if(!yt.isUndefined(f)){if(d.indexOf(f)!==-1)throw Error("Circular reference detected in "+m.join("."));d.push(f),yt.forEach(f,function(v,y){(!(yt.isUndefined(v)||v===null)&&r.call(e,v,yt.isString(y)?y.trim():y,m,p))===!0&&h(v,m?m.concat(y):[y])}),d.pop()}}if(!yt.isObject(t))throw new TypeError("data must be an object");return h(t),e}function JY(t){const e={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(t).replace(/[!'()~]|%20|%00/g,function(n){return e[n]})}function C4(t,e){this._pairs=[],t&&HO(t,this,e)}const Ahe=C4.prototype;Ahe.append=function(e,i){this._pairs.push([e,i])};Ahe.toString=function(e){const i=e?function(n){return e.call(this,n,JY)}:JY;return this._pairs.map(function(r){return i(r[0])+"="+i(r[1])},"").join("&")};function X$e(t){return encodeURIComponent(t).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function _he(t,e,i){if(!e)return t;const n=i&&i.encode||X$e,r=i&&i.serialize;let a;if(r?a=r(e,i):a=yt.isURLSearchParams(e)?e.toString():new C4(e,i).toString(n),a){const o=t.indexOf("#");o!==-1&&(t=t.slice(0,o)),t+=(t.indexOf("?")===-1?"?":"&")+a}return t}class QY{constructor(){this.handlers=[]}use(e,i,n){return this.handlers.push({fulfilled:e,rejected:i,synchronous:n?n.synchronous:!1,runWhen:n?n.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){yt.forEach(this.handlers,function(n){n!==null&&e(n)})}}const khe={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},J$e=typeof URLSearchParams<"u"?URLSearchParams:C4,Q$e=typeof FormData<"u"?FormData:null,e2e=typeof Blob<"u"?Blob:null,t2e={isBrowser:!0,classes:{URLSearchParams:J$e,FormData:Q$e,Blob:e2e},protocols:["http","https","file","blob","url","data"]},xhe=typeof window<"u"&&typeof document<"u",i2e=(t=>xhe&&["ReactNative","NativeScript","NS"].indexOf(t)<0)(typeof navigator<"u"&&navigator.product),n2e=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",r2e=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:xhe,hasStandardBrowserEnv:i2e,hasStandardBrowserWebWorkerEnv:n2e},Symbol.toStringTag,{value:"Module"})),cf={...r2e,...t2e};function a2e(t,e){return HO(t,new cf.classes.URLSearchParams,Object.assign({visitor:function(i,n,r,a){return cf.isNode&&yt.isBuffer(i)?(this.append(n,i.toString("base64")),!1):a.defaultVisitor.apply(this,arguments)}},e))}function o2e(t){return yt.matchAll(/\w+|\[(\w*)]/g,t).map(e=>e[0]==="[]"?"":e[1]||e[0])}function s2e(t){const e={},i=Object.keys(t);let n;const r=i.length;let a;for(n=0;n<r;n++)a=i[n],e[a]=t[a];return e}function Ohe(t){function e(i,n,r,a){let o=i[a++];if(o==="__proto__")return!0;const s=Number.isFinite(+o),l=a>=i.length;return o=!o&&yt.isArray(r)?r.length:o,l?(yt.hasOwnProp(r,o)?r[o]=[r[o],n]:r[o]=n,!s):((!r[o]||!yt.isObject(r[o]))&&(r[o]=[]),e(i,n,r[o],a)&&yt.isArray(r[o])&&(r[o]=s2e(r[o])),!s)}if(yt.isFormData(t)&&yt.isFunction(t.entries)){const i={};return yt.forEachEntry(t,(n,r)=>{e(o2e(n),r,i,0)}),i}return null}function l2e(t,e,i){if(yt.isString(t))try{return(e||JSON.parse)(t),yt.trim(t)}catch(n){if(n.name!=="SyntaxError")throw n}return(i||JSON.stringify)(t)}const P4={transitional:khe,adapter:["xhr","http"],transformRequest:[function(e,i){const n=i.getContentType()||"",r=n.indexOf("application/json")>-1,a=yt.isObject(e);if(a&&yt.isHTMLForm(e)&&(e=new FormData(e)),yt.isFormData(e))return r?JSON.stringify(Ohe(e)):e;if(yt.isArrayBuffer(e)||yt.isBuffer(e)||yt.isStream(e)||yt.isFile(e)||yt.isBlob(e))return e;if(yt.isArrayBufferView(e))return e.buffer;if(yt.isURLSearchParams(e))return i.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let s;if(a){if(n.indexOf("application/x-www-form-urlencoded")>-1)return a2e(e,this.formSerializer).toString();if((s=yt.isFileList(e))||n.indexOf("multipart/form-data")>-1){const l=this.env&&this.env.FormData;return HO(s?{"files[]":e}:e,l&&new l,this.formSerializer)}}return a||r?(i.setContentType("application/json",!1),l2e(e)):e}],transformResponse:[function(e){const i=this.transitional||P4.transitional,n=i&&i.forcedJSONParsing,r=this.responseType==="json";if(e&&yt.isString(e)&&(n&&!this.responseType||r)){const o=!(i&&i.silentJSONParsing)&&r;try{return JSON.parse(e)}catch(s){if(o)throw s.name==="SyntaxError"?Tr.from(s,Tr.ERR_BAD_RESPONSE,this,null,this.response):s}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:cf.classes.FormData,Blob:cf.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};yt.forEach(["delete","get","head","post","put","patch"],t=>{P4.headers[t]={}});const R4=P4,c2e=yt.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),u2e=t=>{const e={};let i,n,r;return t&&t.split(`
`).forEach(function(o){r=o.indexOf(":"),i=o.substring(0,r).trim().toLowerCase(),n=o.substring(r+1).trim(),!(!i||e[i]&&c2e[i])&&(i==="set-cookie"?e[i]?e[i].push(n):e[i]=[n]:e[i]=e[i]?e[i]+", "+n:n)}),e},eZ=Symbol("internals");function JU(t){return t&&String(t).trim().toLowerCase()}function NN(t){return t===!1||t==null?t:yt.isArray(t)?t.map(NN):String(t)}function d2e(t){const e=Object.create(null),i=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let n;for(;n=i.exec(t);)e[n[1]]=n[2];return e}const p2e=t=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(t.trim());function KB(t,e,i,n,r){if(yt.isFunction(n))return n.call(this,e,i);if(r&&(e=i),!!yt.isString(e)){if(yt.isString(n))return e.indexOf(n)!==-1;if(yt.isRegExp(n))return n.test(e)}}function h2e(t){return t.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(e,i,n)=>i.toUpperCase()+n)}function f2e(t,e){const i=yt.toCamelCase(" "+e);["get","set","has"].forEach(n=>{Object.defineProperty(t,n+i,{value:function(r,a,o){return this[n].call(this,e,r,a,o)},configurable:!0})})}class zO{constructor(e){e&&this.set(e)}set(e,i,n){const r=this;function a(s,l,c){const u=JU(l);if(!u)throw new Error("header name must be a non-empty string");const d=yt.findKey(r,u);(!d||r[d]===void 0||c===!0||c===void 0&&r[d]!==!1)&&(r[d||l]=NN(s))}const o=(s,l)=>yt.forEach(s,(c,u)=>a(c,u,l));return yt.isPlainObject(e)||e instanceof this.constructor?o(e,i):yt.isString(e)&&(e=e.trim())&&!p2e(e)?o(u2e(e),i):e!=null&&a(i,e,n),this}get(e,i){if(e=JU(e),e){const n=yt.findKey(this,e);if(n){const r=this[n];if(!i)return r;if(i===!0)return d2e(r);if(yt.isFunction(i))return i.call(this,r,n);if(yt.isRegExp(i))return i.exec(r);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,i){if(e=JU(e),e){const n=yt.findKey(this,e);return!!(n&&this[n]!==void 0&&(!i||KB(this,this[n],n,i)))}return!1}delete(e,i){const n=this;let r=!1;function a(o){if(o=JU(o),o){const s=yt.findKey(n,o);s&&(!i||KB(n,n[s],s,i))&&(delete n[s],r=!0)}}return yt.isArray(e)?e.forEach(a):a(e),r}clear(e){const i=Object.keys(this);let n=i.length,r=!1;for(;n--;){const a=i[n];(!e||KB(this,this[a],a,e,!0))&&(delete this[a],r=!0)}return r}normalize(e){const i=this,n={};return yt.forEach(this,(r,a)=>{const o=yt.findKey(n,a);if(o){i[o]=NN(r),delete i[a];return}const s=e?h2e(a):String(a).trim();s!==a&&delete i[a],i[s]=NN(r),n[s]=!0}),this}concat(...e){return this.constructor.concat(this,...e)}toJSON(e){const i=Object.create(null);return yt.forEach(this,(n,r)=>{n!=null&&n!==!1&&(i[r]=e&&yt.isArray(n)?n.join(", "):n)}),i}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([e,i])=>e+": "+i).join(`
`)}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e,...i){const n=new this(e);return i.forEach(r=>n.set(r)),n}static accessor(e){const n=(this[eZ]=this[eZ]={accessors:{}}).accessors,r=this.prototype;function a(o){const s=JU(o);n[s]||(f2e(r,o),n[s]=!0)}return yt.isArray(e)?e.forEach(a):a(e),this}}zO.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);yt.reduceDescriptors(zO.prototype,({value:t},e)=>{let i=e[0].toUpperCase()+e.slice(1);return{get:()=>t,set(n){this[i]=n}}});yt.freezeMethods(zO);const $m=zO;function YB(t,e){const i=this||R4,n=e||i,r=$m.from(n.headers);let a=n.data;return yt.forEach(t,function(s){a=s.call(i,a,r.normalize(),e?e.status:void 0)}),r.normalize(),a}function Lhe(t){return!!(t&&t.__CANCEL__)}function DP(t,e,i){Tr.call(this,t??"canceled",Tr.ERR_CANCELED,e,i),this.name="CanceledError"}yt.inherits(DP,Tr,{__CANCEL__:!0});function m2e(t,e,i){const n=i.config.validateStatus;!i.status||!n||n(i.status)?t(i):e(new Tr("Request failed with status code "+i.status,[Tr.ERR_BAD_REQUEST,Tr.ERR_BAD_RESPONSE][Math.floor(i.status/100)-4],i.config,i.request,i))}const g2e=cf.hasStandardBrowserEnv?{write(t,e,i,n,r,a){const o=[t+"="+encodeURIComponent(e)];yt.isNumber(i)&&o.push("expires="+new Date(i).toGMTString()),yt.isString(n)&&o.push("path="+n),yt.isString(r)&&o.push("domain="+r),a===!0&&o.push("secure"),document.cookie=o.join("; ")},read(t){const e=document.cookie.match(new RegExp("(^|;\\s*)("+t+")=([^;]*)"));return e?decodeURIComponent(e[3]):null},remove(t){this.write(t,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function v2e(t){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(t)}function y2e(t,e){return e?t.replace(/\/?\/$/,"")+"/"+e.replace(/^\/+/,""):t}function Fhe(t,e){return t&&!v2e(e)?y2e(t,e):e}const b2e=cf.hasStandardBrowserEnv?function(){const e=/(msie|trident)/i.test(navigator.userAgent),i=document.createElement("a");let n;function r(a){let o=a;return e&&(i.setAttribute("href",o),o=i.href),i.setAttribute("href",o),{href:i.href,protocol:i.protocol?i.protocol.replace(/:$/,""):"",host:i.host,search:i.search?i.search.replace(/^\?/,""):"",hash:i.hash?i.hash.replace(/^#/,""):"",hostname:i.hostname,port:i.port,pathname:i.pathname.charAt(0)==="/"?i.pathname:"/"+i.pathname}}return n=r(window.location.href),function(o){const s=yt.isString(o)?r(o):o;return s.protocol===n.protocol&&s.host===n.host}}():function(){return function(){return!0}}();function I2e(t){const e=/^([-+\w]{1,25})(:?\/\/|:)/.exec(t);return e&&e[1]||""}function w2e(t,e){t=t||10;const i=new Array(t),n=new Array(t);let r=0,a=0,o;return e=e!==void 0?e:1e3,function(l){const c=Date.now(),u=n[a];o||(o=c),i[r]=l,n[r]=c;let d=a,p=0;for(;d!==r;)p+=i[d++],d=d%t;if(r=(r+1)%t,r===a&&(a=(a+1)%t),c-o<e)return;const h=u&&c-u;return h?Math.round(p*1e3/h):void 0}}function tZ(t,e){let i=0;const n=w2e(50,250);return r=>{const a=r.loaded,o=r.lengthComputable?r.total:void 0,s=a-i,l=n(s),c=a<=o;i=a;const u={loaded:a,total:o,progress:o?a/o:void 0,bytes:s,rate:l||void 0,estimated:l&&o&&c?(o-a)/l:void 0,event:r};u[e?"download":"upload"]=!0,t(u)}}const S2e=typeof XMLHttpRequest<"u",T2e=S2e&&function(t){return new Promise(function(i,n){let r=t.data;const a=$m.from(t.headers).normalize();let{responseType:o,withXSRFToken:s}=t,l;function c(){t.cancelToken&&t.cancelToken.unsubscribe(l),t.signal&&t.signal.removeEventListener("abort",l)}let u;if(yt.isFormData(r)){if(cf.hasStandardBrowserEnv||cf.hasStandardBrowserWebWorkerEnv)a.setContentType(!1);else if((u=a.getContentType())!==!1){const[m,...g]=u?u.split(";").map(v=>v.trim()).filter(Boolean):[];a.setContentType([m||"multipart/form-data",...g].join("; "))}}let d=new XMLHttpRequest;if(t.auth){const m=t.auth.username||"",g=t.auth.password?unescape(encodeURIComponent(t.auth.password)):"";a.set("Authorization","Basic "+btoa(m+":"+g))}const p=Fhe(t.baseURL,t.url);d.open(t.method.toUpperCase(),_he(p,t.params,t.paramsSerializer),!0),d.timeout=t.timeout;function h(){if(!d)return;const m=$m.from("getAllResponseHeaders"in d&&d.getAllResponseHeaders()),v={data:!o||o==="text"||o==="json"?d.responseText:d.response,status:d.status,statusText:d.statusText,headers:m,config:t,request:d};m2e(function(b){i(b),c()},function(b){n(b),c()},v),d=null}if("onloadend"in d?d.onloadend=h:d.onreadystatechange=function(){!d||d.readyState!==4||d.status===0&&!(d.responseURL&&d.responseURL.indexOf("file:")===0)||setTimeout(h)},d.onabort=function(){d&&(n(new Tr("Request aborted",Tr.ECONNABORTED,t,d)),d=null)},d.onerror=function(){n(new Tr("Network Error",Tr.ERR_NETWORK,t,d)),d=null},d.ontimeout=function(){let g=t.timeout?"timeout of "+t.timeout+"ms exceeded":"timeout exceeded";const v=t.transitional||khe;t.timeoutErrorMessage&&(g=t.timeoutErrorMessage),n(new Tr(g,v.clarifyTimeoutError?Tr.ETIMEDOUT:Tr.ECONNABORTED,t,d)),d=null},cf.hasStandardBrowserEnv&&(s&&yt.isFunction(s)&&(s=s(t)),s||s!==!1&&b2e(p))){const m=t.xsrfHeaderName&&t.xsrfCookieName&&g2e.read(t.xsrfCookieName);m&&a.set(t.xsrfHeaderName,m)}r===void 0&&a.setContentType(null),"setRequestHeader"in d&&yt.forEach(a.toJSON(),function(g,v){d.setRequestHeader(v,g)}),yt.isUndefined(t.withCredentials)||(d.withCredentials=!!t.withCredentials),o&&o!=="json"&&(d.responseType=t.responseType),typeof t.onDownloadProgress=="function"&&d.addEventListener("progress",tZ(t.onDownloadProgress,!0)),typeof t.onUploadProgress=="function"&&d.upload&&d.upload.addEventListener("progress",tZ(t.onUploadProgress)),(t.cancelToken||t.signal)&&(l=m=>{d&&(n(!m||m.type?new DP(null,t,d):m),d.abort(),d=null)},t.cancelToken&&t.cancelToken.subscribe(l),t.signal&&(t.signal.aborted?l():t.signal.addEventListener("abort",l)));const f=I2e(p);if(f&&cf.protocols.indexOf(f)===-1){n(new Tr("Unsupported protocol "+f+":",Tr.ERR_BAD_REQUEST,t));return}d.send(r||null)})},kV={http:K$e,xhr:T2e};yt.forEach(kV,(t,e)=>{if(t){try{Object.defineProperty(t,"name",{value:e})}catch{}Object.defineProperty(t,"adapterName",{value:e})}});const iZ=t=>`- ${t}`,U2e=t=>yt.isFunction(t)||t===null||t===!1,Bhe={getAdapter:t=>{t=yt.isArray(t)?t:[t];const{length:e}=t;let i,n;const r={};for(let a=0;a<e;a++){i=t[a];let o;if(n=i,!U2e(i)&&(n=kV[(o=String(i)).toLowerCase()],n===void 0))throw new Tr(`Unknown adapter '${o}'`);if(n)break;r[o||"#"+a]=n}if(!n){const a=Object.entries(r).map(([s,l])=>`adapter ${s} `+(l===!1?"is not supported by the environment":"is not available in the build"));let o=e?a.length>1?`since :
`+a.map(iZ).join(`
`):" "+iZ(a[0]):"as no adapter specified";throw new Tr("There is no suitable adapter to dispatch the request "+o,"ERR_NOT_SUPPORT")}return n},adapters:kV};function ZB(t){if(t.cancelToken&&t.cancelToken.throwIfRequested(),t.signal&&t.signal.aborted)throw new DP(null,t)}function nZ(t){return ZB(t),t.headers=$m.from(t.headers),t.data=YB.call(t,t.transformRequest),["post","put","patch"].indexOf(t.method)!==-1&&t.headers.setContentType("application/x-www-form-urlencoded",!1),Bhe.getAdapter(t.adapter||R4.adapter)(t).then(function(n){return ZB(t),n.data=YB.call(t,t.transformResponse,n),n.headers=$m.from(n.headers),n},function(n){return Lhe(n)||(ZB(t),n&&n.response&&(n.response.data=YB.call(t,t.transformResponse,n.response),n.response.headers=$m.from(n.response.headers))),Promise.reject(n)})}const rZ=t=>t instanceof $m?{...t}:t;function US(t,e){e=e||{};const i={};function n(c,u,d){return yt.isPlainObject(c)&&yt.isPlainObject(u)?yt.merge.call({caseless:d},c,u):yt.isPlainObject(u)?yt.merge({},u):yt.isArray(u)?u.slice():u}function r(c,u,d){if(yt.isUndefined(u)){if(!yt.isUndefined(c))return n(void 0,c,d)}else return n(c,u,d)}function a(c,u){if(!yt.isUndefined(u))return n(void 0,u)}function o(c,u){if(yt.isUndefined(u)){if(!yt.isUndefined(c))return n(void 0,c)}else return n(void 0,u)}function s(c,u,d){if(d in e)return n(c,u);if(d in t)return n(void 0,c)}const l={url:a,method:a,data:a,baseURL:o,transformRequest:o,transformResponse:o,paramsSerializer:o,timeout:o,timeoutMessage:o,withCredentials:o,withXSRFToken:o,adapter:o,responseType:o,xsrfCookieName:o,xsrfHeaderName:o,onUploadProgress:o,onDownloadProgress:o,decompress:o,maxContentLength:o,maxBodyLength:o,beforeRedirect:o,transport:o,httpAgent:o,httpsAgent:o,cancelToken:o,socketPath:o,responseEncoding:o,validateStatus:s,headers:(c,u)=>r(rZ(c),rZ(u),!0)};return yt.forEach(Object.keys(Object.assign({},t,e)),function(u){const d=l[u]||r,p=d(t[u],e[u],u);yt.isUndefined(p)&&d!==s||(i[u]=p)}),i}const $he="1.6.8",M4={};["object","boolean","number","function","string","symbol"].forEach((t,e)=>{M4[t]=function(n){return typeof n===t||"a"+(e<1?"n ":" ")+t}});const aZ={};M4.transitional=function(e,i,n){function r(a,o){return"[Axios v"+$he+"] Transitional option '"+a+"'"+o+(n?". "+n:"")}return(a,o,s)=>{if(e===!1)throw new Tr(r(o," has been removed"+(i?" in "+i:"")),Tr.ERR_DEPRECATED);return i&&!aZ[o]&&(aZ[o]=!0,console.warn(r(o," has been deprecated since v"+i+" and will be removed in the near future"))),e?e(a,o,s):!0}};function D2e(t,e,i){if(typeof t!="object")throw new Tr("options must be an object",Tr.ERR_BAD_OPTION_VALUE);const n=Object.keys(t);let r=n.length;for(;r-- >0;){const a=n[r],o=e[a];if(o){const s=t[a],l=s===void 0||o(s,a,t);if(l!==!0)throw new Tr("option "+a+" must be "+l,Tr.ERR_BAD_OPTION_VALUE);continue}if(i!==!0)throw new Tr("Unknown option "+a,Tr.ERR_BAD_OPTION)}}const xV={assertOptions:D2e,validators:M4},ev=xV.validators;class o_{constructor(e){this.defaults=e,this.interceptors={request:new QY,response:new QY}}async request(e,i){try{return await this._request(e,i)}catch(n){if(n instanceof Error){let r;Error.captureStackTrace?Error.captureStackTrace(r={}):r=new Error;const a=r.stack?r.stack.replace(/^.+\n/,""):"";n.stack?a&&!String(n.stack).endsWith(a.replace(/^.+\n.+\n/,""))&&(n.stack+=`
`+a):n.stack=a}throw n}}_request(e,i){typeof e=="string"?(i=i||{},i.url=e):i=e||{},i=US(this.defaults,i);const{transitional:n,paramsSerializer:r,headers:a}=i;n!==void 0&&xV.assertOptions(n,{silentJSONParsing:ev.transitional(ev.boolean),forcedJSONParsing:ev.transitional(ev.boolean),clarifyTimeoutError:ev.transitional(ev.boolean)},!1),r!=null&&(yt.isFunction(r)?i.paramsSerializer={serialize:r}:xV.assertOptions(r,{encode:ev.function,serialize:ev.function},!0)),i.method=(i.method||this.defaults.method||"get").toLowerCase();let o=a&&yt.merge(a.common,a[i.method]);a&&yt.forEach(["delete","get","head","post","put","patch","common"],f=>{delete a[f]}),i.headers=$m.concat(o,a);const s=[];let l=!0;this.interceptors.request.forEach(function(m){typeof m.runWhen=="function"&&m.runWhen(i)===!1||(l=l&&m.synchronous,s.unshift(m.fulfilled,m.rejected))});const c=[];this.interceptors.response.forEach(function(m){c.push(m.fulfilled,m.rejected)});let u,d=0,p;if(!l){const f=[nZ.bind(this),void 0];for(f.unshift.apply(f,s),f.push.apply(f,c),p=f.length,u=Promise.resolve(i);d<p;)u=u.then(f[d++],f[d++]);return u}p=s.length;let h=i;for(d=0;d<p;){const f=s[d++],m=s[d++];try{h=f(h)}catch(g){m.call(this,g);break}}try{u=nZ.call(this,h)}catch(f){return Promise.reject(f)}for(d=0,p=c.length;d<p;)u=u.then(c[d++],c[d++]);return u}getUri(e){e=US(this.defaults,e);const i=Fhe(e.baseURL,e.url);return _he(i,e.params,e.paramsSerializer)}}yt.forEach(["delete","get","head","options"],function(e){o_.prototype[e]=function(i,n){return this.request(US(n||{},{method:e,url:i,data:(n||{}).data}))}});yt.forEach(["post","put","patch"],function(e){function i(n){return function(a,o,s){return this.request(US(s||{},{method:e,headers:n?{"Content-Type":"multipart/form-data"}:{},url:a,data:o}))}}o_.prototype[e]=i(),o_.prototype[e+"Form"]=i(!0)});const AN=o_;class N4{constructor(e){if(typeof e!="function")throw new TypeError("executor must be a function.");let i;this.promise=new Promise(function(a){i=a});const n=this;this.promise.then(r=>{if(!n._listeners)return;let a=n._listeners.length;for(;a-- >0;)n._listeners[a](r);n._listeners=null}),this.promise.then=r=>{let a;const o=new Promise(s=>{n.subscribe(s),a=s}).then(r);return o.cancel=function(){n.unsubscribe(a)},o},e(function(a,o,s){n.reason||(n.reason=new DP(a,o,s),i(n.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){if(this.reason){e(this.reason);return}this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const i=this._listeners.indexOf(e);i!==-1&&this._listeners.splice(i,1)}static source(){let e;return{token:new N4(function(r){e=r}),cancel:e}}}const E2e=N4;function C2e(t){return function(i){return t.apply(null,i)}}function P2e(t){return yt.isObject(t)&&t.isAxiosError===!0}const OV={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(OV).forEach(([t,e])=>{OV[e]=t});const R2e=OV;function Vhe(t){const e=new AN(t),i=whe(AN.prototype.request,e);return yt.extend(i,AN.prototype,e,{allOwnKeys:!0}),yt.extend(i,e,null,{allOwnKeys:!0}),i.create=function(r){return Vhe(US(t,r))},i}const Es=Vhe(R4);Es.Axios=AN;Es.CanceledError=DP;Es.CancelToken=E2e;Es.isCancel=Lhe;Es.VERSION=$he;Es.toFormData=HO;Es.AxiosError=Tr;Es.Cancel=Es.CanceledError;Es.all=function(e){return Promise.all(e)};Es.spread=C2e;Es.isAxiosError=P2e;Es.mergeConfig=US;Es.AxiosHeaders=$m;Es.formToJSON=t=>Ohe(yt.isHTMLForm(t)?new FormData(t):t);Es.getAdapter=Bhe.getAdapter;Es.HttpStatusCode=R2e;Es.default=Es;const jhe=Ihe(),M2e="https://courthive.net",EP=Es.create({baseURL:M2e});EP.interceptors.request.use(t=>{const e=localStorage.getItem(jhe);return e&&(t.headers.Authorization=`Bearer ${e}`),t},t=>Promise.reject(t));EP.interceptors.response.use(t=>{var e,i;return(e=t.data)!=null&&e.error&&ti({message:(i=t.data.error)==null?void 0:i.message,intent:"is-danger"}),t},t=>{var e;if(t.message==="Network Error"&&ti({message:t.message,intent:"is-danger"}),t.response){((e=t.response)==null?void 0:e.status)===401&&Ghe();const i=t.response.data.message||t.response.data.error||t.response.data;ti({message:i,intent:"is-danger"})}});const N2e=()=>{const t=localStorage.getItem(jhe);EP.defaults.headers.common.Authorization=`Bearer ${t}`},Ghe=()=>{EP.defaults.headers.common.Authorization=void 0},ju={...EP,addAuthorization:N2e,removeAuthorization:Ghe};async function qO({tournamentId:t}){return await ju.post("/factory/fetch",{tournamentId:t})}async function A2e({provider:t}){return await ju.post("/provider/add",t)}async function _2e({provider:t}){return await ju.post("/provider/modify",t)}async function k2e({providerId:t}){return await ju.post("/provider/detail",{providerId:t})}async function x2e({providerAbbr:t}){return await ju.post("/provider/calendar",{providerAbbr:t})}async function nE(){return await ju.post("/provider/allProviders",{})}async function O2e(){return await ju.post("/auth/allusers",{})}async function L2e({email:t}){return await ju.post("/auth/remove",{email:t})}async function H1({tournamentRecord:t}){return await ju.post("/factory/save",{tournamentRecord:t})}async function F2e({providerId:t,tournamentId:e}){return await ju.post("/factory/remove",{providerId:t,tournamentId:e})}function A4(t){return t[t.length-1]}function CP(t,...e){return e.forEach(i=>{t.includes(i)||t.push(i)}),t}function oZ(t,e){return t?t.split(e):[]}function _4(t,e,i){const n=e===void 0||t>=e,r=i===void 0||t<=i;return n&&r}function Hhe(t,e,i){return t<e?e:t>i?i:t}function DS(t,e,i={},n=0,r=""){const a=Object.keys(i).reduce((s,l)=>{let c=i[l];return typeof c=="function"&&(c=c(n)),`${s} ${l}="${c}"`},t);r+=`<${a}></${t}>`;const o=n+1;return o<e?DS(t,e,i,o,r):r}function k4(t){return t.replace(/>\s+/g,">").replace(/\s+</,"<")}function LV(t){return new Date(t).setHours(0,0,0,0)}function ew(){return new Date().setHours(0,0,0,0)}function ES(...t){switch(t.length){case 0:return ew();case 1:return LV(t[0])}const e=new Date(0);return e.setFullYear(...t),e.setHours(0,0,0,0)}function rE(t,e){const i=new Date(t);return i.setDate(i.getDate()+e)}function B2e(t,e){return rE(t,e*7)}function s_(t,e){const i=new Date(t),n=i.getMonth()+e;let r=n%12;r<0&&(r+=12);const a=i.setMonth(n);return i.getMonth()!==r?i.setDate(0):a}function aE(t,e){const i=new Date(t),n=i.getMonth(),r=i.setFullYear(i.getFullYear()+e);return n===1&&i.getMonth()===2?i.setDate(0):r}function sZ(t,e){return(t-e+7)%7}function Nb(t,e,i=0){const n=new Date(t).getDay();return rE(t,sZ(e,i)-sZ(n,i))}function zhe(t,e){return Math.round((t-e)/6048e5)+1}function $2e(t){const e=Nb(t,4,1),i=Nb(new Date(e).setMonth(0,4),4,1);return zhe(e,i)}function qhe(t,e){const i=Nb(new Date(t).setMonth(0,1),e,e),n=Nb(t,e,e),r=zhe(n,i);if(r<53)return r;const a=Nb(new Date(t).setDate(32),e,e);return n===a?1:r}function V2e(t){return qhe(t,0)}function j2e(t){return qhe(t,6)}function Qw(t,e){const i=new Date(t).getFullYear();return Math.floor(i/e)*e}function Nv(t,e,i){if(e!==1&&e!==2)return t;const n=new Date(t);return e===1?i?n.setMonth(n.getMonth()+1,0):n.setDate(1):i?n.setFullYear(n.getFullYear()+1,0,0):n.setMonth(0,1),n.setHours(0,0,0,0)}const FV=/dd?|DD?|mm?|MM?|yy?(?:yy)?/,G2e=/[\s!-/:-@[-`{-~]+/;let XB={};const lZ={y(t,e){return new Date(t).setFullYear(parseInt(e,10))},m(t,e,i){const n=new Date(t);let r=parseInt(e,10)-1;if(isNaN(r)){if(!e)return NaN;const a=e.toLowerCase(),o=s=>s.toLowerCase().startsWith(a);if(r=i.monthsShort.findIndex(o),r<0&&(r=i.months.findIndex(o)),r<0)return NaN}return n.setMonth(r),n.getMonth()!==Whe(r)?n.setDate(0):n.getTime()},d(t,e){return new Date(t).setDate(parseInt(e,10))}},H2e={d(t){return t.getDate()},dd(t){return TM(t.getDate(),2)},D(t,e){return e.daysShort[t.getDay()]},DD(t,e){return e.days[t.getDay()]},m(t){return t.getMonth()+1},mm(t){return TM(t.getMonth()+1,2)},M(t,e){return e.monthsShort[t.getMonth()]},MM(t,e){return e.months[t.getMonth()]},y(t){return t.getFullYear()},yy(t){return TM(t.getFullYear(),2).slice(-2)},yyyy(t){return TM(t.getFullYear(),4)}};function Whe(t){return t>-1?t%12:Whe(t+12)}function TM(t,e){return t.toString().padStart(e,"0")}function Khe(t){if(typeof t!="string")throw new Error("Invalid date format.");if(t in XB)return XB[t];const e=t.split(FV),i=t.match(new RegExp(FV,"g"));if(e.length===0||!i)throw new Error("Invalid date format.");const n=i.map(a=>H2e[a]),r=Object.keys(lZ).reduce((a,o)=>(i.find(l=>l[0]!=="D"&&l[0].toLowerCase()===o)&&a.push(o),a),[]);return XB[t]={parser(a,o){const s=a.split(G2e).reduce((l,c,u)=>{if(c.length>0&&i[u]){const d=i[u][0];d==="M"?l.m=c:d!=="D"&&(l[d]=c)}return l},{});return r.reduce((l,c)=>{const u=lZ[c](l,s[c],o);return isNaN(u)?l:u},ew())},formatter(a,o){let s=n.reduce((l,c,u)=>l+=`${e[u]}${c(a,o)}`,"");return s+=A4(e)}}}function aI(t,e,i){if(t instanceof Date||typeof t=="number"){const n=LV(t);return isNaN(n)?void 0:n}if(t){if(t==="today")return ew();if(e&&e.toValue){const n=e.toValue(t,e,i);return isNaN(n)?void 0:LV(n)}return Khe(e).parser(t,i)}}function PP(t,e,i){if(isNaN(t)||!t&&t!==0)return"";const n=typeof t=="number"?new Date(t):t;return e.toDisplay?e.toDisplay(n,e,i):Khe(e).formatter(n,i)}const z2e=document.createRange();function tg(t){return z2e.createContextualFragment(t)}function Yhe(t){return t.parentElement||(t.parentNode instanceof ShadowRoot?t.parentNode.host:void 0)}function WO(t){return t.getRootNode().activeElement===t}function z1(t){t.style.display!=="none"&&(t.style.display&&(t.dataset.styleDisplay=t.style.display),t.style.display="none")}function q1(t){t.style.display==="none"&&(t.dataset.styleDisplay?(t.style.display=t.dataset.styleDisplay,delete t.dataset.styleDisplay):t.style.display="")}function l_(t){t.firstChild&&(t.removeChild(t.firstChild),l_(t))}function q2e(t,e){l_(t),e instanceof DocumentFragment?t.appendChild(e):typeof e=="string"?t.appendChild(tg(e)):typeof e.forEach=="function"&&e.forEach(i=>{t.appendChild(i)})}const c_=new WeakMap,{addEventListener:W2e,removeEventListener:K2e}=EventTarget.prototype;function u_(t,e){let i=c_.get(t);i||(i=[],c_.set(t,i)),e.forEach(n=>{W2e.call(...n),i.push(n)})}function Zhe(t){let e=c_.get(t);e&&(e.forEach(i=>{K2e.call(...i)}),c_.delete(t))}if(!Event.prototype.composedPath){const t=(e,i=[])=>{i.push(e);let n;return e.parentNode?n=e.parentNode:e.host?n=e.host:e.defaultView&&(n=e.defaultView),n?t(n,i):i};Event.prototype.composedPath=function(){return t(this.target)}}function Xhe(t,e,i){const[n,...r]=t;if(e(n))return n;if(!(n===i||n.tagName==="HTML"||r.length===0))return Xhe(r,e,i)}function Jhe(t,e){const i=typeof e=="function"?e:n=>n instanceof Element&&n.matches(e);return Xhe(t.composedPath(),i,t.currentTarget)}const QU={en:{days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],daysShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],daysMin:["Su","Mo","Tu","We","Th","Fr","Sa"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],monthsShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],today:"Today",clear:"Clear",titleFormat:"MM y"}},x4={autohide:!1,beforeShowDay:null,beforeShowDecade:null,beforeShowMonth:null,beforeShowYear:null,clearButton:!1,dateDelimiter:",",datesDisabled:[],daysOfWeekDisabled:[],daysOfWeekHighlighted:[],defaultViewDate:void 0,disableTouchKeyboard:!1,enableOnReadonly:!0,format:"mm/dd/yyyy",language:"en",maxDate:null,maxNumberOfDates:1,maxView:3,minDate:null,nextArrow:"",orientation:"auto",pickLevel:0,prevArrow:"",showDaysOfWeek:!0,showOnClick:!0,showOnFocus:!0,startView:0,title:"",todayButton:!1,todayButtonMode:0,todayHighlight:!1,updateOnBlur:!0,weekNumbers:0,weekStart:0},{language:JB,format:Y2e,weekStart:Z2e}=x4;function cZ(t,e){return t.length<6&&e>=0&&e<7?CP(t,e):t}function Qhe(t,e){switch(t===4?e===6?3:!e+1:t){case 1:return $2e;case 2:return V2e;case 3:return j2e}}function uZ(t,e,i){return e.weekStart=t,e.weekEnd=(t+6)%7,i===4&&(e.getWeekNumber=Qhe(4,t)),t}function dZ(t,e,i,n){const r=aI(t,e,i);return r!==void 0?r:n}function QB(t,e,i=3){const n=parseInt(t,10);return n>=0&&n<=i?n:e}function UM(t,e,i,n=void 0){e in t&&(i in t||(t[i]=n?n(t[e]):t[e]),delete t[e])}function e$(t,e){const i=Object.assign({},t),n={},r=e.constructor.locales,a=!!e.rangeSideIndex;let{datesDisabled:o,format:s,language:l,locale:c,maxDate:u,maxView:d,minDate:p,pickLevel:h,startView:f,weekNumbers:m,weekStart:g}=e.config||{};if(UM(i,"calendarWeeks","weekNumbers",w=>w?1:0),UM(i,"clearBtn","clearButton"),UM(i,"todayBtn","todayButton"),UM(i,"todayBtnMode","todayButtonMode"),i.language){let w;if(i.language!==l&&(r[i.language]?w=i.language:(w=i.language.split("-")[0],r[w]||(w=!1))),delete i.language,w){l=n.language=w;const S=c||r[JB];c=Object.assign({format:Y2e,weekStart:Z2e},r[JB]),l!==JB&&Object.assign(c,r[l]),n.locale=c,s===S.format&&(s=n.format=c.format),g===S.weekStart&&(g=uZ(c.weekStart,n,m))}}if(i.format){const w=typeof i.format.toDisplay=="function",S=typeof i.format.toValue=="function",D=FV.test(i.format);(w&&S||D)&&(s=n.format=i.format),delete i.format}let v=h;"pickLevel"in i&&(v=QB(i.pickLevel,h,2),delete i.pickLevel),v!==h&&(v>h&&("minDate"in i||(i.minDate=p),"maxDate"in i||(i.maxDate=u)),o&&!i.datesDisabled&&(i.datesDisabled=[]),h=n.pickLevel=v);let y=p,b=u;if("minDate"in i){const w=ES(0,0,1);y=i.minDate===null?w:dZ(i.minDate,s,c,y),y!==w&&(y=Nv(y,h,!1)),delete i.minDate}if("maxDate"in i&&(b=i.maxDate===null?void 0:dZ(i.maxDate,s,c,b),b!==void 0&&(b=Nv(b,h,!0)),delete i.maxDate),b<y?(p=n.minDate=b,u=n.maxDate=y):(p!==y&&(p=n.minDate=y),u!==b&&(u=n.maxDate=b)),i.datesDisabled){const w=i.datesDisabled;if(typeof w=="function")n.datesDisabled=null,n.checkDisabled=(S,D)=>w(new Date(S),D,a);else{const S=n.datesDisabled=w.reduce((D,E)=>{const C=aI(E,s,c);return C!==void 0?CP(D,Nv(C,h,a)):D},[]);n.checkDisabled=D=>S.includes(D)}delete i.datesDisabled}if("defaultViewDate"in i){const w=aI(i.defaultViewDate,s,c);w!==void 0&&(n.defaultViewDate=w),delete i.defaultViewDate}if("weekStart"in i){const w=Number(i.weekStart)%7;isNaN(w)||(g=uZ(w,n,m)),delete i.weekStart}if(i.daysOfWeekDisabled&&(n.daysOfWeekDisabled=i.daysOfWeekDisabled.reduce(cZ,[]),delete i.daysOfWeekDisabled),i.daysOfWeekHighlighted&&(n.daysOfWeekHighlighted=i.daysOfWeekHighlighted.reduce(cZ,[]),delete i.daysOfWeekHighlighted),"weekNumbers"in i){let w=i.weekNumbers;if(w){const S=typeof w=="function"?(D,E)=>w(new Date(D),E):Qhe(w=parseInt(w,10),g);S&&(m=n.weekNumbers=w,n.getWeekNumber=S)}else m=n.weekNumbers=0,n.getWeekNumber=null;delete i.weekNumbers}if("maxNumberOfDates"in i){const w=parseInt(i.maxNumberOfDates,10);w>=0&&(n.maxNumberOfDates=w,n.multidate=w!==1),delete i.maxNumberOfDates}i.dateDelimiter&&(n.dateDelimiter=String(i.dateDelimiter),delete i.dateDelimiter);let I=d;"maxView"in i&&(I=QB(i.maxView,d),delete i.maxView),I=h>I?h:I,I!==d&&(d=n.maxView=I);let T=f;if("startView"in i&&(T=QB(i.startView,T),delete i.startView),T<h?T=h:T>d&&(T=d),T!==f&&(n.startView=T),i.prevArrow){const w=tg(i.prevArrow);w.childNodes.length>0&&(n.prevArrow=w.childNodes),delete i.prevArrow}if(i.nextArrow){const w=tg(i.nextArrow);w.childNodes.length>0&&(n.nextArrow=w.childNodes),delete i.nextArrow}if("disableTouchKeyboard"in i&&(n.disableTouchKeyboard="ontouchstart"in document&&!!i.disableTouchKeyboard,delete i.disableTouchKeyboard),i.orientation){const w=i.orientation.toLowerCase().split(/\s+/g);n.orientation={x:w.find(S=>S==="left"||S==="right")||"auto",y:w.find(S=>S==="top"||S==="bottom")||"auto"},delete i.orientation}if("todayButtonMode"in i){switch(i.todayButtonMode){case 0:case 1:n.todayButtonMode=i.todayButtonMode}delete i.todayButtonMode}return Object.entries(i).forEach(([w,S])=>{S!==void 0&&w in x4&&(n[w]=S)}),n}const pZ={show:{key:"ArrowDown"},hide:null,toggle:{key:"Escape"},prevButton:{key:"ArrowLeft",ctrlOrMetaKey:!0},nextButton:{key:"ArrowRight",ctrlOrMetaKey:!0},viewSwitch:{key:"ArrowUp",ctrlOrMetaKey:!0},clearButton:{key:"Backspace",ctrlOrMetaKey:!0},todayButton:{key:".",ctrlOrMetaKey:!0},exitEditMode:{key:"ArrowDown",ctrlOrMetaKey:!0}};function X2e(t){return Object.keys(pZ).reduce((e,i)=>{const n=t[i]===void 0?pZ[i]:t[i],r=n&&n.key;if(!r||typeof r!="string")return e;const a={key:r,ctrlOrMetaKey:!!(n.ctrlOrMetaKey||n.ctrlKey||n.metaKey)};return r.length>1&&(a.altKey=!!n.altKey,a.shiftKey=!!n.shiftKey),e[i]=a,e},{})}const hZ=t=>t.map(e=>`<button type="button" class="%buttonClass% ${e}" tabindex="-1"></button>`).join(""),J2e=k4(`<div class="datepicker">
  <div class="datepicker-picker">
    <div class="datepicker-header">
      <div class="datepicker-title"></div>
      <div class="datepicker-controls">
        ${hZ(["prev-button prev-btn","view-switch","next-button next-btn"])}
      </div>
    </div>
    <div class="datepicker-main"></div>
    <div class="datepicker-footer">
      <div class="datepicker-controls">
        ${hZ(["today-button today-btn","clear-button clear-btn"])}
      </div>
    </div>
  </div>
</div>`),Q2e=k4(`<div class="days">
  <div class="days-of-week">${DS("span",7,{class:"dow"})}</div>
  <div class="datepicker-grid">${DS("span",42)}</div>
</div>`),eVe=k4(`<div class="week-numbers calendar-weeks">
  <div class="days-of-week"><span class="dow"></span></div>
  <div class="weeks">${DS("span",6,{class:"week"})}</div>
</div>`);let O4=class{constructor(e,i){Object.assign(this,i,{picker:e,element:tg('<div class="datepicker-view"></div>').firstChild,selected:[],isRangeEnd:!!e.datepicker.rangeSideIndex}),this.init(this.picker.datepicker.config)}init(e){"pickLevel"in e&&(this.isMinView=this.id===e.pickLevel),this.setOptions(e),this.updateFocus(),this.updateSelection()}prepareForRender(e,i,n){this.disabled=[];const r=this.picker;r.setViewSwitchLabel(e),r.setPrevButtonDisabled(i),r.setNextButtonDisabled(n)}setDisabled(e,i){i.add("disabled"),CP(this.disabled,e)}performBeforeHook(e,i){let n=this.beforeShow(new Date(i));switch(typeof n){case"boolean":n={enabled:n};break;case"string":n={classes:n}}if(n){const r=e.classList;if(n.enabled===!1&&this.setDisabled(i,r),n.classes){const a=n.classes.split(/\s+/);r.add(...a),a.includes("disabled")&&this.setDisabled(i,r)}n.content&&q2e(e,n.content)}}renderCell(e,i,n,r,{selected:a,range:o},s,l=[]){e.textContent=i,this.isMinView&&(e.dataset.date=r);const c=e.classList;if(e.className=`datepicker-cell ${this.cellClass}`,n<this.first?c.add("prev"):n>this.last&&c.add("next"),c.add(...l),(s||this.checkDisabled(r,this.id))&&this.setDisabled(r,c),o){const[u,d]=o;n>u&&n<d&&c.add("range"),n===u&&c.add("range-start"),n===d&&c.add("range-end")}a.includes(n)&&c.add("selected"),n===this.focused&&c.add("focused"),this.beforeShow&&this.performBeforeHook(e,r)}refreshCell(e,i,n,[r,a]){const o=e.classList;o.remove("range","range-start","range-end","selected","focused"),i>r&&i<a&&o.add("range"),i===r&&o.add("range-start"),i===a&&o.add("range-end"),n.includes(i)&&o.add("selected"),i===this.focused&&o.add("focused")}changeFocusedCell(e){this.grid.querySelectorAll(".focused").forEach(i=>{i.classList.remove("focused")}),this.grid.children[e].classList.add("focused")}};class tVe extends O4{constructor(e){super(e,{id:0,name:"days",cellClass:"day"})}init(e,i=!0){if(i){const n=tg(Q2e).firstChild;this.dow=n.firstChild,this.grid=n.lastChild,this.element.appendChild(n)}super.init(e)}setOptions(e){let i;if("minDate"in e&&(this.minDate=e.minDate),"maxDate"in e&&(this.maxDate=e.maxDate),e.checkDisabled&&(this.checkDisabled=e.checkDisabled),e.daysOfWeekDisabled&&(this.daysOfWeekDisabled=e.daysOfWeekDisabled,i=!0),e.daysOfWeekHighlighted&&(this.daysOfWeekHighlighted=e.daysOfWeekHighlighted),"todayHighlight"in e&&(this.todayHighlight=e.todayHighlight),"weekStart"in e&&(this.weekStart=e.weekStart,this.weekEnd=e.weekEnd,i=!0),e.locale){const n=this.locale=e.locale;this.dayNames=n.daysMin,this.switchLabelFormat=n.titleFormat,i=!0}if("beforeShowDay"in e&&(this.beforeShow=typeof e.beforeShowDay=="function"?e.beforeShowDay:void 0),"weekNumbers"in e)if(e.weekNumbers&&!this.weekNumbers){const n=tg(eVe).firstChild;this.weekNumbers={element:n,dow:n.firstChild,weeks:n.lastChild},this.element.insertBefore(n,this.element.firstChild)}else this.weekNumbers&&!e.weekNumbers&&(this.element.removeChild(this.weekNumbers.element),this.weekNumbers=null);"getWeekNumber"in e&&(this.getWeekNumber=e.getWeekNumber),"showDaysOfWeek"in e&&(e.showDaysOfWeek?(q1(this.dow),this.weekNumbers&&q1(this.weekNumbers.dow)):(z1(this.dow),this.weekNumbers&&z1(this.weekNumbers.dow))),i&&Array.from(this.dow.children).forEach((n,r)=>{const a=(this.weekStart+r)%7;n.textContent=this.dayNames[a],n.className=this.daysOfWeekDisabled.includes(a)?"dow disabled":"dow"})}updateFocus(){const e=new Date(this.picker.viewDate),i=e.getFullYear(),n=e.getMonth(),r=ES(i,n,1),a=Nb(r,this.weekStart,this.weekStart);this.first=r,this.last=ES(i,n+1,0),this.start=a,this.focused=this.picker.viewDate}updateSelection(){const{dates:e,rangepicker:i}=this.picker.datepicker;this.selected=e,i&&(this.range=i.dates)}render(){if(this.today=this.todayHighlight?ew():void 0,this.prepareForRender(PP(this.focused,this.switchLabelFormat,this.locale),this.first<=this.minDate,this.last>=this.maxDate),this.weekNumbers){const e=this.weekStart,i=Nb(this.first,e,e);Array.from(this.weekNumbers.weeks.children).forEach((n,r)=>{const a=B2e(i,r);n.textContent=this.getWeekNumber(a,e),r>3&&n.classList[a>this.last?"add":"remove"]("next")})}Array.from(this.grid.children).forEach((e,i)=>{const n=rE(this.start,i),r=new Date(n),a=r.getDay(),o=[];this.today===n&&o.push("today"),this.daysOfWeekHighlighted.includes(a)&&o.push("highlighted"),this.renderCell(e,r.getDate(),n,n,this,n<this.minDate||n>this.maxDate||this.daysOfWeekDisabled.includes(a),o)})}refresh(){const e=this.range||[];Array.from(this.grid.children).forEach(i=>{this.refreshCell(i,Number(i.dataset.date),this.selected,e)})}refreshFocus(){this.changeFocusedCell(Math.round((this.focused-this.start)/864e5))}}function fZ(t,e){if(!t||!t[0]||!t[1])return;const[[i,n],[r,a]]=t;if(!(i>e||r<e))return[i===e?n:-1,r===e?a:12]}class iVe extends O4{constructor(e){super(e,{id:1,name:"months",cellClass:"month"})}init(e,i=!0){i&&(this.grid=this.element,this.element.classList.add("months","datepicker-grid"),this.grid.appendChild(tg(DS("span",12,{"data-month":n=>n}))),this.first=0,this.last=11),super.init(e)}setOptions(e){if(e.locale&&(this.monthNames=e.locale.monthsShort),"minDate"in e)if(e.minDate===void 0)this.minYear=this.minMonth=this.minDate=void 0;else{const i=new Date(e.minDate);this.minYear=i.getFullYear(),this.minMonth=i.getMonth(),this.minDate=i.setDate(1)}if("maxDate"in e)if(e.maxDate===void 0)this.maxYear=this.maxMonth=this.maxDate=void 0;else{const i=new Date(e.maxDate);this.maxYear=i.getFullYear(),this.maxMonth=i.getMonth(),this.maxDate=ES(this.maxYear,this.maxMonth+1,0)}e.checkDisabled&&(this.checkDisabled=this.isMinView||e.datesDisabled===null?e.checkDisabled:()=>!1),"beforeShowMonth"in e&&(this.beforeShow=typeof e.beforeShowMonth=="function"?e.beforeShowMonth:void 0)}updateFocus(){const e=new Date(this.picker.viewDate);this.year=e.getFullYear(),this.focused=e.getMonth()}updateSelection(){const{dates:e,rangepicker:i}=this.picker.datepicker;this.selected=e.reduce((n,r)=>{const a=new Date(r),o=a.getFullYear(),s=a.getMonth();return n[o]===void 0?n[o]=[s]:CP(n[o],s),n},{}),i&&i.dates&&(this.range=i.dates.map(n=>{const r=new Date(n);return isNaN(r)?void 0:[r.getFullYear(),r.getMonth()]}))}render(){this.prepareForRender(this.year,this.year<=this.minYear,this.year>=this.maxYear);const e=this.selected[this.year]||[],i=this.year<this.minYear||this.year>this.maxYear,n=this.year===this.minYear,r=this.year===this.maxYear,a=fZ(this.range,this.year);Array.from(this.grid.children).forEach((o,s)=>{const l=Nv(new Date(this.year,s,1),1,this.isRangeEnd);this.renderCell(o,this.monthNames[s],s,l,{selected:e,range:a},i||n&&s<this.minMonth||r&&s>this.maxMonth)})}refresh(){const e=this.selected[this.year]||[],i=fZ(this.range,this.year)||[];Array.from(this.grid.children).forEach((n,r)=>{this.refreshCell(n,r,e,i)})}refreshFocus(){this.changeFocusedCell(this.focused)}}function nVe(t){return[...t].reduce((e,i,n)=>e+=n?i:i.toUpperCase(),"")}class mZ extends O4{constructor(e,i){super(e,i)}init(e,i=!0){i&&(this.navStep=this.step*10,this.beforeShowOption=`beforeShow${nVe(this.cellClass)}`,this.grid=this.element,this.element.classList.add(this.name,"datepicker-grid"),this.grid.appendChild(tg(DS("span",12)))),super.init(e)}setOptions(e){if("minDate"in e&&(e.minDate===void 0?this.minYear=this.minDate=void 0:(this.minYear=Qw(e.minDate,this.step),this.minDate=ES(this.minYear,0,1))),"maxDate"in e&&(e.maxDate===void 0?this.maxYear=this.maxDate=void 0:(this.maxYear=Qw(e.maxDate,this.step),this.maxDate=ES(this.maxYear,11,31))),e.checkDisabled&&(this.checkDisabled=this.isMinView||e.datesDisabled===null?e.checkDisabled:()=>!1),this.beforeShowOption in e){const i=e[this.beforeShowOption];this.beforeShow=typeof i=="function"?i:void 0}}updateFocus(){const e=new Date(this.picker.viewDate),i=Qw(e,this.navStep),n=i+9*this.step;this.first=i,this.last=n,this.start=i-this.step,this.focused=Qw(e,this.step)}updateSelection(){const{dates:e,rangepicker:i}=this.picker.datepicker;this.selected=e.reduce((n,r)=>CP(n,Qw(r,this.step)),[]),i&&i.dates&&(this.range=i.dates.map(n=>{if(n!==void 0)return Qw(n,this.step)}))}render(){this.prepareForRender(`${this.first}-${this.last}`,this.first<=this.minYear,this.last>=this.maxYear),Array.from(this.grid.children).forEach((e,i)=>{const n=this.start+i*this.step,r=Nv(new Date(n,0,1),2,this.isRangeEnd);e.dataset.year=n,this.renderCell(e,n,n,r,this,n<this.minYear||n>this.maxYear)})}refresh(){const e=this.range||[];Array.from(this.grid.children).forEach(i=>{this.refreshCell(i,Number(i.textContent),this.selected,e)})}refreshFocus(){this.changeFocusedCell(Math.round((this.focused-this.start)/this.step))}}function m0(t,e){const i={bubbles:!0,cancelable:!0,detail:{date:t.getDate(),viewDate:new Date(t.picker.viewDate),viewId:t.picker.currentView.id,datepicker:t}};t.element.dispatchEvent(new CustomEvent(e,i))}function d_(t,e){const{config:i,picker:n}=t,{currentView:r,viewDate:a}=n;let o;switch(r.id){case 0:o=s_(a,e);break;case 1:o=aE(a,e);break;default:o=aE(a,e*r.navStep)}o=Hhe(o,i.minDate,i.maxDate),n.changeFocus(o).render()}function efe(t){const e=t.picker.currentView.id;e!==t.config.maxView&&t.picker.changeView(e+1).render()}function tfe(t){t.setDate({clear:!0})}function ife(t){const e=ew();t.config.todayButtonMode===1?t.setDate(e,{forceRefresh:!0,viewDate:e}):t.setFocusedDate(e,!0)}function nfe(t){const e=()=>{t.config.updateOnBlur?t.update({revert:!0}):t.refresh("input"),t.hide()},i=t.element;WO(i)?i.addEventListener("blur",e,{once:!0}):e()}function gZ(t,e){const i=t.picker,n=new Date(i.viewDate),r=i.currentView.id,a=r===1?s_(n,e-n.getMonth()):aE(n,e-n.getFullYear());i.changeFocus(a).changeView(r-1).render()}function rVe(t){efe(t)}function aVe(t){d_(t,-1)}function oVe(t){d_(t,1)}function sVe(t,e){const i=Jhe(e,".datepicker-cell");if(!i||i.classList.contains("disabled"))return;const{id:n,isMinView:r}=t.picker.currentView,a=i.dataset;r?t.setDate(Number(a.date)):n===1?gZ(t,Number(a.month)):gZ(t,Number(a.year))}function lVe(t){t.preventDefault()}const t$=["left","top","right","bottom"].reduce((t,e)=>(t[e]=`datepicker-orient-${e}`,t),{}),vZ=t=>t&&`${t}px`;function yZ(t,e){if("title"in e&&(e.title?(t.controls.title.textContent=e.title,q1(t.controls.title)):(t.controls.title.textContent="",z1(t.controls.title))),e.prevArrow){const i=t.controls.prevButton;l_(i),e.prevArrow.forEach(n=>{i.appendChild(n.cloneNode(!0))})}if(e.nextArrow){const i=t.controls.nextButton;l_(i),e.nextArrow.forEach(n=>{i.appendChild(n.cloneNode(!0))})}if(e.locale&&(t.controls.todayButton.textContent=e.locale.today,t.controls.clearButton.textContent=e.locale.clear),"todayButton"in e&&(e.todayButton?q1(t.controls.todayButton):z1(t.controls.todayButton)),"minDate"in e||"maxDate"in e){const{minDate:i,maxDate:n}=t.datepicker.config;t.controls.todayButton.disabled=!_4(ew(),i,n)}"clearButton"in e&&(e.clearButton?q1(t.controls.clearButton):z1(t.controls.clearButton))}function bZ(t){const{dates:e,config:i,rangeSideIndex:n}=t,r=e.length>0?A4(e):Nv(i.defaultViewDate,i.pickLevel,n);return Hhe(r,i.minDate,i.maxDate)}function IZ(t,e){!("_oldViewDate"in t)&&e!==t.viewDate&&(t._oldViewDate=t.viewDate),t.viewDate=e;const{id:i,year:n,first:r,last:a}=t.currentView,o=new Date(e).getFullYear();switch(i){case 0:return e<r||e>a;case 1:return o!==n;default:return o<r||o>a}}function i$(t){return window.getComputedStyle(t).direction}function rfe(t){const e=Yhe(t);if(!(e===document.body||!e))return window.getComputedStyle(e).overflow!=="visible"?e:rfe(e)}let cVe=class{constructor(e){const{config:i,inputField:n}=this.datepicker=e,r=J2e.replace(/%buttonClass%/g,i.buttonClass),a=this.element=tg(r).firstChild,[o,s,l]=a.firstChild.children,c=o.firstElementChild,[u,d,p]=o.lastElementChild.children,[h,f]=l.firstChild.children,m={title:c,prevButton:u,viewSwitch:d,nextButton:p,todayButton:h,clearButton:f};this.main=s,this.controls=m;const g=n?"dropdown":"inline";a.classList.add(`datepicker-${g}`),yZ(this,i),this.viewDate=bZ(e),u_(e,[[a,"mousedown",lVe],[s,"click",sVe.bind(null,e)],[m.viewSwitch,"click",rVe.bind(null,e)],[m.prevButton,"click",aVe.bind(null,e)],[m.nextButton,"click",oVe.bind(null,e)],[m.todayButton,"click",ife.bind(null,e)],[m.clearButton,"click",tfe.bind(null,e)]]),this.views=[new tVe(this),new iVe(this),new mZ(this,{id:2,name:"years",cellClass:"year",step:1}),new mZ(this,{id:3,name:"decades",cellClass:"decade",step:10})],this.currentView=this.views[i.startView],this.currentView.render(),this.main.appendChild(this.currentView.element),i.container?i.container.appendChild(this.element):n.after(this.element)}setOptions(e){yZ(this,e),this.views.forEach(i=>{i.init(e,!1)}),this.currentView.render()}detach(){this.element.remove()}show(){if(this.active)return;const{datepicker:e,element:i}=this,n=e.inputField;if(n){const r=i$(n);r!==i$(Yhe(i))?i.dir=r:i.dir&&i.removeAttribute("dir"),this.place(),i.classList.add("active"),e.config.disableTouchKeyboard&&n.blur()}else i.classList.add("active");this.active=!0,m0(e,"show")}hide(){this.active&&(this.datepicker.exitEditMode(),this.element.classList.remove("active"),this.active=!1,m0(this.datepicker,"hide"))}place(){const{classList:e,style:i}=this.element;i.display="block";const{width:n,height:r}=this.element.getBoundingClientRect(),a=this.element.offsetParent;i.display="";const{config:o,inputField:s}=this.datepicker,{left:l,top:c,right:u,bottom:d,width:p,height:h}=s.getBoundingClientRect();let{x:f,y:m}=o.orientation,g=l,v=c;if(a===document.body||!a)g+=window.scrollX,v+=window.scrollY;else{const D=a.getBoundingClientRect();g-=D.left-a.scrollLeft,v-=D.top-a.scrollTop}const y=rfe(s);let b=0,I=0,{clientWidth:T,clientHeight:w}=document.documentElement;if(y){const D=y.getBoundingClientRect();D.top>0&&(I=D.top),D.left>0&&(b=D.left),D.right<T&&(T=D.right),D.bottom<w&&(w=D.bottom)}let S=0;f==="auto"&&(l<b?(f="left",S=b-l):l+n>T?(f="right",T<u&&(S=T-u)):i$(s)==="rtl"?f=u-n<b?"left":"right":f="left"),f==="right"&&(g+=p-n),g+=S,m==="auto"&&(c-r>I?m=d+r>w?"top":"bottom":m="bottom"),m==="top"?v-=r:v+=h,e.remove(...Object.values(t$)),e.add(t$[f],t$[m]),i.left=vZ(g),i.top=vZ(v)}setViewSwitchLabel(e){this.controls.viewSwitch.textContent=e}setPrevButtonDisabled(e){this.controls.prevButton.disabled=e}setNextButtonDisabled(e){this.controls.nextButton.disabled=e}changeView(e){const i=this.currentView;return e!==i.id&&(this._oldView||(this._oldView=i),this.currentView=this.views[e],this._renderMethod="render"),this}changeFocus(e){return this._renderMethod=IZ(this,e)?"render":"refreshFocus",this.views.forEach(i=>{i.updateFocus()}),this}update(e=void 0){const i=e===void 0?bZ(this.datepicker):e;return this._renderMethod=IZ(this,i)?"render":"refresh",this.views.forEach(n=>{n.updateFocus(),n.updateSelection()}),this}render(e=!0){const{currentView:i,datepicker:n,_oldView:r}=this,a=new Date(this._oldViewDate),o=e&&this._renderMethod||"render";if(delete this._oldView,delete this._oldViewDate,delete this._renderMethod,i[o](),r&&(this.main.replaceChild(i.element,r.element),m0(n,"changeView")),!isNaN(a)){const s=new Date(this.viewDate);s.getFullYear()!==a.getFullYear()&&m0(n,"changeYear"),s.getMonth()!==a.getMonth()&&m0(n,"changeMonth")}}};function afe(t,e,i,n,r,a){if(_4(t,r,a)){if(n(t)){const o=e(t,i);return afe(o,e,i,n,r,a)}return t}}function uVe(t,e,i){const n=t.picker,r=n.currentView,a=r.step||1;let o=n.viewDate,s;switch(r.id){case 0:o=rE(o,i?e*7:e),s=rE;break;case 1:o=s_(o,i?e*4:e),s=s_;break;default:o=aE(o,e*(i?4:1)*a),s=aE}o=afe(o,s,e<0?-a:a,l=>r.disabled.includes(l),r.minDate,r.maxDate),o!==void 0&&n.changeFocus(o).render()}function dVe(t,e){const{config:i,picker:n,editMode:r}=t,a=n.active,{key:o,altKey:s,shiftKey:l}=e,c=e.ctrlKey||e.metaKey,u=()=>{e.preventDefault(),e.stopPropagation()};if(o==="Tab"){nfe(t);return}if(o==="Enter"){if(!a)t.update();else if(r)t.exitEditMode({update:!0,autohide:i.autohide});else{const m=n.currentView;m.isMinView?t.setDate(n.viewDate):(n.changeView(m.id-1).render(),u())}return}const d=i.shortcutKeys,p={key:o,ctrlOrMetaKey:c,altKey:s,shiftKey:l},h=Object.keys(d).find(m=>{const g=d[m];return!Object.keys(g).find(v=>g[v]!==p[v])});if(h){let m;if(h==="toggle"?m=h:r?h==="exitEditMode"&&(m=h):a?h==="hide"?m=h:h==="prevButton"?m=[d_,[t,-1]]:h==="nextButton"?m=[d_,[t,1]]:h==="viewSwitch"?m=[efe,[t]]:i.clearButton&&h==="clearButton"?m=[tfe,[t]]:i.todayButton&&h==="todayButton"&&(m=[ife,[t]]):h==="show"&&(m=h),m){Array.isArray(m)?m[0].apply(null,m[1]):t[m](),u();return}}if(!a||r)return;const f=(m,g)=>{l||c||s?t.enterEditMode():(uVe(t,m,g),e.preventDefault())};o==="ArrowLeft"?f(-1,!1):o==="ArrowRight"?f(1,!1):o==="ArrowUp"?f(-1,!0):o==="ArrowDown"?f(1,!0):(o==="Backspace"||o==="Delete"||o&&o.length===1&&!c)&&t.enterEditMode()}function pVe(t){t.config.showOnFocus&&!t._showing&&t.show()}function hVe(t,e){const i=e.target;(t.picker.active||t.config.showOnClick)&&(i._active=WO(i),i._clicking=setTimeout(()=>{delete i._active,delete i._clicking},2e3))}function fVe(t,e){const i=e.target;i._clicking&&(clearTimeout(i._clicking),delete i._clicking,i._active&&t.enterEditMode(),delete i._active,t.config.showOnClick&&t.show())}function mVe(t,e){e.clipboardData.types.includes("text/plain")&&t.enterEditMode()}function gVe(t,e){const{element:i,picker:n}=t;if(!n.active&&!WO(i))return;const r=n.element;Jhe(e,a=>a===i||a===r)||nfe(t)}function ofe(t,e){return t.map(i=>PP(i,e.format,e.locale)).join(e.dateDelimiter)}function sfe(t,e,i=!1){if(e.length===0)return i?[]:void 0;const{config:n,dates:r,rangeSideIndex:a}=t,{pickLevel:o,maxNumberOfDates:s}=n;let l=e.reduce((c,u)=>{let d=aI(u,n.format,n.locale);return d===void 0||(d=Nv(d,o,a),_4(d,n.minDate,n.maxDate)&&!c.includes(d)&&!n.checkDisabled(d,o)&&(o>0||!n.daysOfWeekDisabled.includes(new Date(d).getDay()))&&c.push(d)),c},[]);if(l.length!==0)return n.multidate&&!i&&(l=l.reduce((c,u)=>(r.includes(u)||c.push(u),c),r.filter(c=>!l.includes(c)))),s&&l.length>s?l.slice(s*-1):l}function p_(t,e=3,i=!0,n=void 0){const{config:r,picker:a,inputField:o}=t;if(e&2){const s=a.active?r.pickLevel:r.startView;a.update(n).changeView(s).render(i)}e&1&&o&&(o.value=ofe(t.dates,r))}function wZ(t,e,i){const n=t.config;let{clear:r,render:a,autohide:o,revert:s,forceRefresh:l,viewDate:c}=i;a===void 0&&(a=!0),a?o===void 0&&(o=n.autohide):o=l=!1,c=aI(c,n.format,n.locale);const u=sfe(t,e,r);!u&&!s||(u&&u.toString()!==t.dates.toString()?(t.dates=u,p_(t,a?3:1,!0,c),m0(t,"changeDate")):p_(t,l?3:1,!0,c),o&&t.hide())}function SZ(t,e){return e?i=>PP(i,e,t.config.locale):i=>new Date(i)}class lfe{constructor(e,i={},n=void 0){e.datepicker=this,this.element=e,this.dates=[];const r=this.config=Object.assign({buttonClass:i.buttonClass&&String(i.buttonClass)||"button",container:null,defaultViewDate:ew(),maxDate:void 0,minDate:void 0},e$(x4,this));let a;if(e.tagName==="INPUT"?(a=this.inputField=e,a.classList.add("datepicker-input"),i.container&&(r.container=i.container instanceof HTMLElement?i.container:document.querySelector(i.container))):r.container=e,n){const u=n.inputs.indexOf(a),d=n.datepickers;if(u<0||u>1||!Array.isArray(d))throw Error("Invalid rangepicker object.");d[u]=this,this.rangepicker=n,this.rangeSideIndex=u}this._options=i,Object.assign(r,e$(i,this)),r.shortcutKeys=X2e(i.shortcutKeys||{});const o=oZ(e.value||e.dataset.date,r.dateDelimiter);delete e.dataset.date;const s=sfe(this,o);s&&s.length>0&&(this.dates=s),a&&(a.value=ofe(this.dates,r));const l=this.picker=new cVe(this),c=[e,"keydown",dVe.bind(null,this)];a?u_(this,[c,[a,"focus",pVe.bind(null,this)],[a,"mousedown",hVe.bind(null,this)],[a,"click",fVe.bind(null,this)],[a,"paste",mVe.bind(null,this)],[document,"mousedown",gVe.bind(null,this)],[window,"resize",l.place.bind(l)]]):(u_(this,[c]),this.show())}static formatDate(e,i,n){return PP(e,i,n&&QU[n]||QU.en)}static parseDate(e,i,n){return aI(e,i,n&&QU[n]||QU.en)}static get locales(){return QU}get active(){return!!(this.picker&&this.picker.active)}get pickerElement(){return this.picker?this.picker.element:void 0}setOptions(e){const i=e$(e,this);Object.assign(this._options,e),Object.assign(this.config,i),this.picker.setOptions(i),p_(this,3)}show(){if(this.inputField){const{config:e,inputField:i}=this;if(i.disabled||i.readOnly&&!e.enableOnReadonly)return;!WO(i)&&!e.disableTouchKeyboard&&(this._showing=!0,i.focus(),delete this._showing)}this.picker.show()}hide(){this.inputField&&(this.picker.hide(),this.picker.update().changeView(this.config.startView).render())}toggle(){this.picker.active?this.inputField&&this.picker.hide():this.show()}destroy(){this.hide(),Zhe(this),this.picker.detach();const e=this.element;return e.classList.remove("datepicker-input"),delete e.datepicker,this}getDate(e=void 0){const i=SZ(this,e);if(this.config.multidate)return this.dates.map(i);if(this.dates.length>0)return i(this.dates[0])}setDate(...e){const i=[...e],n={},r=A4(e);r&&typeof r=="object"&&!Array.isArray(r)&&!(r instanceof Date)&&Object.assign(n,i.pop());const a=Array.isArray(i[0])?i[0]:i;wZ(this,a,n)}update(e=void 0){if(!this.inputField)return;const i=Object.assign(e||{},{clear:!0,render:!0,viewDate:void 0}),n=oZ(this.inputField.value,this.config.dateDelimiter);wZ(this,n,i)}getFocusedDate(e=void 0){return SZ(this,e)(this.picker.viewDate)}setFocusedDate(e,i=!1){const{config:n,picker:r,active:a,rangeSideIndex:o}=this,s=n.pickLevel,l=aI(e,n.format,n.locale);l!==void 0&&(r.changeFocus(Nv(l,s,o)),a&&i&&r.changeView(s),r.render())}refresh(e=void 0,i=!1){e&&typeof e!="string"&&(i=e,e=void 0);let n;e==="picker"?n=2:e==="input"?n=1:n=3,p_(this,n,!i)}enterEditMode(){const e=this.inputField;!e||e.readOnly||!this.picker.active||this.editMode||(this.editMode=!0,e.classList.add("in-edit"))}exitEditMode(e=void 0){if(!this.inputField||!this.editMode)return;const i=Object.assign({update:!1},e);delete this.editMode,this.inputField.classList.remove("in-edit"),i.update&&this.update(i)}}function TZ(t){const e=Object.assign({},t);return delete e.inputs,delete e.allowOneSidedRange,delete e.maxNumberOfDates,e}function vVe(t,e,i,n){u_(t,[[i,"changeDate",e]]),new lfe(i,n,t)}function e1(t,e){if(t._updating)return;t._updating=!0;const i=e.target;if(i.datepicker===void 0)return;const n=t.datepickers,[r,a]=n,o={render:!1},s=t.inputs.indexOf(i),l=s===0?1:0,c=n[s].dates[0],u=n[l].dates[0];c!==void 0&&u!==void 0?s===0&&c>u?(r.setDate(u,o),a.setDate(c,o)):s===1&&c<u&&(r.setDate(c,o),a.setDate(u,o)):t.allowOneSidedRange||(c!==void 0||u!==void 0)&&(o.clear=!0,n[l].setDate(n[s].dates,o)),n.forEach(d=>{d.picker.update().render()}),delete t._updating}class yVe{constructor(e,i={}){let n=Array.isArray(i.inputs)?i.inputs:Array.from(e.querySelectorAll("input"));if(n.length<2)return;e.rangepicker=this,this.element=e,this.inputs=n=n.slice(0,2),Object.freeze(n),this.allowOneSidedRange=!!i.allowOneSidedRange;const r=e1.bind(null,this),a=TZ(i),o=this.datepickers=[];n.forEach(s=>{vVe(this,r,s,a)}),Object.freeze(o),Object.defineProperty(this,"dates",{get(){return o.map(s=>s.dates[0])}}),o[0].dates.length>0?e1(this,{target:n[0]}):o[1].dates.length>0&&e1(this,{target:n[1]})}setOptions(e){this.allowOneSidedRange=!!e.allowOneSidedRange;const i=TZ(e);this.datepickers.forEach(n=>{n.setOptions(i)})}destroy(){this.datepickers.forEach(e=>{e.destroy()}),Zhe(this),delete this.element.rangepicker}getDates(e=void 0){const i=e?n=>PP(n,e,this.datepickers[0].config.locale):n=>new Date(n);return this.dates.map(n=>n===void 0?n:i(n))}setDates(e,i){const{datepickers:[n,r],inputs:[a,o],dates:[s,l]}=this;this._updating=!0,n.setDate(e),r.setDate(i),delete this._updating,r.dates[0]!==l?e1(this,{target:o}):n.dates[0]!==s&&e1(this,{target:a})}}var Zd=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function RP(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var cfe={exports:{}};(function(t){(function(){var e=function(l,c){var u=this;e.count=(e.count||0)+1,this.count=e.count,this.isOpened=!1,this.input=a(l),this.input.setAttribute("autocomplete","off"),this.input.setAttribute("aria-expanded","false"),this.input.setAttribute("aria-owns","awesomplete_list_"+this.count),this.input.setAttribute("role","combobox"),this.options=c=c||{},n(this,{minChars:2,maxItems:10,autoFirst:!1,data:e.DATA,filter:e.FILTER_CONTAINS,sort:c.sort===!1?!1:e.SORT_BYLENGTH,container:e.CONTAINER,item:e.ITEM,replace:e.REPLACE,tabSelect:!1},c),this.index=-1,this.container=this.container(l),this.ul=a.create("ul",{hidden:"hidden",role:"listbox",id:"awesomplete_list_"+this.count,inside:this.container}),this.status=a.create("span",{className:"visually-hidden",role:"status","aria-live":"assertive","aria-atomic":!0,inside:this.container,textContent:this.minChars!=0?"Type "+this.minChars+" or more characters for results.":"Begin typing for results."}),this._events={input:{input:this.evaluate.bind(this),blur:this.close.bind(this,{reason:"blur"}),keydown:function(d){var p=d.keyCode;u.opened&&(p===13&&u.selected?(d.preventDefault(),u.select(void 0,void 0,d)):p===9&&u.selected&&u.tabSelect?u.select(void 0,void 0,d):p===27?u.close({reason:"esc"}):(p===38||p===40)&&(d.preventDefault(),u[p===38?"previous":"next"]()))}},form:{submit:this.close.bind(this,{reason:"submit"})},ul:{mousedown:function(d){d.preventDefault()},click:function(d){var p=d.target;if(p!==this){for(;p&&!/li/i.test(p.nodeName);)p=p.parentNode;p&&d.button===0&&(d.preventDefault(),u.select(p,d.target,d))}}}},a.bind(this.input,this._events.input),a.bind(this.input.form,this._events.form),a.bind(this.ul,this._events.ul),this.input.hasAttribute("list")?(this.list="#"+this.input.getAttribute("list"),this.input.removeAttribute("list")):this.list=this.input.getAttribute("data-list")||c.list||[],e.all.push(this)};e.prototype={set list(l){if(Array.isArray(l))this._list=l;else if(typeof l=="string"&&l.indexOf(",")>-1)this._list=l.split(/\s*,\s*/);else if(l=a(l),l&&l.children){var c=[];r.apply(l.children).forEach(function(u){if(!u.disabled){var d=u.textContent.trim(),p=u.value||d,h=u.label||d;p!==""&&c.push({label:h,value:p})}}),this._list=c}document.activeElement===this.input&&this.evaluate()},get selected(){return this.index>-1},get opened(){return this.isOpened},close:function(l){this.opened&&(this.input.setAttribute("aria-expanded","false"),this.ul.setAttribute("hidden",""),this.isOpened=!1,this.index=-1,this.status.setAttribute("hidden",""),a.fire(this.input,"awesomplete-close",l||{}))},open:function(){this.input.setAttribute("aria-expanded","true"),this.ul.removeAttribute("hidden"),this.isOpened=!0,this.status.removeAttribute("hidden"),this.autoFirst&&this.index===-1&&this.goto(0),a.fire(this.input,"awesomplete-open")},destroy:function(){if(a.unbind(this.input,this._events.input),a.unbind(this.input.form,this._events.form),!this.options.container){var l=this.container.parentNode;l.insertBefore(this.input,this.container),l.removeChild(this.container)}this.input.removeAttribute("autocomplete"),this.input.removeAttribute("aria-autocomplete");var c=e.all.indexOf(this);c!==-1&&e.all.splice(c,1)},next:function(){var l=this.ul.children.length;this.goto(this.index<l-1?this.index+1:l?0:-1)},previous:function(){var l=this.ul.children.length,c=this.index-1;this.goto(this.selected&&c!==-1?c:l-1)},goto:function(l){var c=this.ul.children;this.selected&&c[this.index].setAttribute("aria-selected","false"),this.index=l,l>-1&&c.length>0&&(c[l].setAttribute("aria-selected","true"),this.status.textContent=c[l].textContent+", list item "+(l+1)+" of "+c.length,this.input.setAttribute("aria-activedescendant",this.ul.id+"_item_"+this.index),this.ul.scrollTop=c[l].offsetTop-this.ul.clientHeight+c[l].clientHeight,a.fire(this.input,"awesomplete-highlight",{text:this.suggestions[this.index]}))},select:function(l,c,u){if(l?this.index=a.siblingIndex(l):l=this.ul.children[this.index],l){var d=this.suggestions[this.index],p=a.fire(this.input,"awesomplete-select",{text:d,origin:c||l,originalEvent:u});p&&(this.replace(d),this.close({reason:"select"}),a.fire(this.input,"awesomplete-selectcomplete",{text:d,originalEvent:u}))}},evaluate:function(){var l=this,c=this.input.value;c.length>=this.minChars&&this._list&&this._list.length>0?(this.index=-1,this.ul.innerHTML="",this.suggestions=this._list.map(function(u){return new i(l.data(u,c))}).filter(function(u){return l.filter(u,c)}),this.sort!==!1&&(this.suggestions=this.suggestions.sort(this.sort)),this.suggestions=this.suggestions.slice(0,this.maxItems),this.suggestions.forEach(function(u,d){l.ul.appendChild(l.item(u,c,d))}),this.ul.children.length===0?(this.status.textContent="No results found",this.close({reason:"nomatches"})):(this.open(),this.status.textContent=this.ul.children.length+" results found")):(this.close({reason:"nomatches"}),this.status.textContent="No results found")}},e.all=[],e.FILTER_CONTAINS=function(l,c){return RegExp(a.regExpEscape(c.trim()),"i").test(l)},e.FILTER_STARTSWITH=function(l,c){return RegExp("^"+a.regExpEscape(c.trim()),"i").test(l)},e.SORT_BYLENGTH=function(l,c){return l.length!==c.length?l.length-c.length:l<c?-1:1},e.CONTAINER=function(l){return a.create("div",{className:"awesomplete",around:l})},e.ITEM=function(l,c,u){var d=c.trim()===""?l:l.replace(RegExp(a.regExpEscape(c.trim()),"gi"),"<mark>$&</mark>");return a.create("li",{innerHTML:d,role:"option","aria-selected":"false",id:"awesomplete_list_"+this.count+"_item_"+u})},e.REPLACE=function(l){this.input.value=l.value},e.DATA=function(l){return l};function i(l){var c=Array.isArray(l)?{label:l[0],value:l[1]}:typeof l=="object"&&"label"in l&&"value"in l?l:{label:l,value:l};this.label=c.label||c.value,this.value=c.value}Object.defineProperty(i.prototype=Object.create(String.prototype),"length",{get:function(){return this.label.length}}),i.prototype.toString=i.prototype.valueOf=function(){return""+this.label};function n(l,c,u){for(var d in c){var p=c[d],h=l.input.getAttribute("data-"+d.toLowerCase());typeof p=="number"?l[d]=parseInt(h):p===!1?l[d]=h!==null:p instanceof Function?l[d]=null:l[d]=h,!l[d]&&l[d]!==0&&(l[d]=d in u?u[d]:p)}}var r=Array.prototype.slice;function a(l,c){return typeof l=="string"?(c||document).querySelector(l):l||null}function o(l,c){return r.call((c||document).querySelectorAll(l))}a.create=function(l,c){var u=document.createElement(l);for(var d in c){var p=c[d];if(d==="inside")a(p).appendChild(u);else if(d==="around"){var h=a(p);h.parentNode.insertBefore(u,h),u.appendChild(h),h.getAttribute("autofocus")!=null&&h.focus()}else d in u?u[d]=p:u.setAttribute(d,p)}return u},a.bind=function(l,c){if(l)for(var u in c){var d=c[u];u.split(/\s+/).forEach(function(p){l.addEventListener(p,d)})}},a.unbind=function(l,c){if(l)for(var u in c){var d=c[u];u.split(/\s+/).forEach(function(p){l.removeEventListener(p,d)})}},a.fire=function(l,c,u){var d=document.createEvent("HTMLEvents");d.initEvent(c,!0,!0);for(var p in u)d[p]=u[p];return l.dispatchEvent(d)},a.regExpEscape=function(l){return l.replace(/[-\\^$*+?.()|[\]{}]/g,"\\$&")},a.siblingIndex=function(l){for(var c=0;l=l.previousElementSibling;c++);return c};function s(){o("input.awesomplete").forEach(function(l){new e(l)})}return typeof self<"u"&&(self.Awesomplete=e),typeof Document<"u"&&(document.readyState!=="loading"?s():document.addEventListener("DOMContentLoaded",s)),e.$=a,e.$$=o,t.exports&&(t.exports=e),e})()})(cfe);var bVe=cfe.exports;const IVe=RP(bVe);function wVe({list:t,element:e,callback:i,currentValue:n,withCatchTab:r,onChange:a}){var c;const o=new IVe(e,{list:t});e.parentElement.style.width="100%";let s=!1;const l=u=>{s=!0,Nt(i)&&i(u.text.value),e.value=u.text.label,o.suggestions=[]};if(r){const u=d=>d.which===9&&d.preventDefault();e.addEventListener("keydown",u,!1),e.addEventListener("keyup",u,!1)}if(typeof a=="function"&&e.addEventListener("change",a),e.setAttribute("autocomplete","off"),e.addEventListener("awesomplete-selectcomplete",u=>l(u),!1),e.addEventListener("keyup",function(u){var d;(u.which===13||u.which===9)&&!s&&((d=o.suggestions)!=null&&d.length)&&(o.next(),o.select(0)),s=!1}),n){const u=(c=t.find(d=>d.value===n))==null?void 0:c.label;u&&(e.value=u)}return{typeAhead:o}}function ufe(t,e,i,n,r){if(r){const a=e.target.value;r(a)?(n.innerHTML="",n.classList.remove("is-danger"),i.classList.remove("is-danger"),i.classList.add("is-success")):(n.innerHTML=t.error||"Invalid",i.classList.remove("is-success"),i.classList.add("is-danger"),n.classList.add("is-danger"))}}function L4(t,e){for(const i of e.options){if(i.hide)continue;const n=document.createElement("option");n.className="font-medium",i.value&&n.setAttribute("value",i.value),(i.selected||e.value===i.value)&&n.setAttribute("selected","true"),i.disabled&&n.setAttribute("disabled","true"),n.innerHTML=i.label,t.appendChild(n)}}function W1(t){var o,s;const e=document.createElement("div");if(e.className="field font-medium",t.class&&e.classList.add(t.class),t.width?e.style=`width: ${t.width}`:e.style="flex-grow: 1",t.label&&!t.checkbox){const l=document.createElement("label");l.style=t.labelStyle||"font-weight: bold; font-size: larger;",l.innerHTML=t.label,e.appendChild(l)}let i,n,r=[];const a=document.createElement("div");if(a.className="control font-medium",t.controlVisible===!1&&(a.style.display=Mt),t.controlId&&(a.id=t.controlId),t.text){const l=document.createElement("div");t.id&&(l.id=t.id),l.className="content",l.innerHTML=t.text,a.appendChild(l)}else if(t.radio){const l=document.createElement("div");l.id=t.id,l.className="control";for(const c of t.options??[]){const u=document.createElement("label");u.className="radio";const d=document.createElement("input");c.field&&r.push({input:d,field:c.field}),c.id&&(d.id=c.id),d.name=t.id,d.type="radio",d.value=c.text,c.checked&&(d.checked=!0),u.appendChild(d),l.appendChild(u);const p=document.createElement("span");p.style.marginLeft=".25em",p.style.marginRight="1em",p.innerHTML=c.text,l.appendChild(p)}a.appendChild(l),i=l}else if(t.options){const l=document.createElement("div");l.className="select font-medium",l.style="width: 100%",t.zIndex&&(l.style.zIndex=t.zIndex);const c=document.createElement("select");if(t.dataPlaceholder&&c.setAttribute("data-placeholder",t.dataPlaceholder),t.dataType&&c.setAttribute("data-type",t.dataType),t.multiple&&c.setAttribute("multiple",!0),t.disabled&&(c.disabled=!0),t.id&&(l.id=t.id),c.style="width: 100%",L4(c,t),l.appendChild(c),a.appendChild(l),t.help){const u=document.createElement("p");u.className="help font-medium is-info",u.innerHTML=(o=t.help)==null?void 0:o.text,u.style.display=(s=t.help)!=null&&s.visible?"":Mt,a.appendChild(u)}i=c,Nt(t.onChange)&&c.addEventListener("change",u=>t.onChange(u,t))}else if(t.checkbox){const l=document.createElement("div");l.className="flexrow nowrap",l.style.display="inline-block";const c=document.createElement("input");Nt(t.onChange)&&c.addEventListener("change",p=>t.onChange(p,t)),i=c;const u=t.intent??"is-success";c.className=`is-checkradio ${u}`,c.type="checkbox",c.id=t.id,t.checked&&(c.checked=!0),l.appendChild(c);const d=document.createElement("label");d.setAttribute("for",t.id),t.color&&(d.style.color=t.color),d.innerHTML=t.label,l.appendChild(d),a.appendChild(l)}else{const l=document.createElement("input");if(l.className="input font-medium",t.class&&l.classList.add(t.class),l.setAttribute("type",t.type||"text"),l.setAttribute("autocomplete",t.autocomplete||"off"),l.setAttribute("placeholder",t.placeholder||""),t.disabled&&l.setAttribute("disabled",!0),t.id&&l.setAttribute("id",t.id),a.appendChild(l),t.iconLeft){a.classList.add("has-icons-left");const u=document.createElement("span");u.className="icon is-small is-left font-medium";const d=document.createElement("i");d.className=t.iconLeft,u.appendChild(d),a.appendChild(u)}if(t.type==="password"){a.classList.add("has-icons-right");const u=document.createElement("span");u.className="icon is-small is-right font-medium";const d=document.createElement("i");d.className=t.iconRight,u.appendChild(d),a.appendChild(u)}i=l;const c=document.createElement("p");c.className="help font-medium",a.appendChild(c),t.validator&&l.addEventListener("input",u=>ufe(t,u,l,c,t.validator)),t.date?n=new lfe(i,{format:"yyyy-mm-dd",autohide:!0}):t.typeAhead&&wVe({...t.typeAhead,element:l}),Nt(t.onKeyDown)&&l.addEventListener("keydown",u=>t.onKeyDown(u,t)),Nt(t.onChange)&&l.addEventListener("change",u=>t.onChange(u,t)),Nt(t.onInput)&&l.addEventListener("input",u=>t.onInput(u,t)),Nt(t.onKeyUp)&&l.addEventListener("keyup",u=>t.onKeyUp(u,t)),t.value!==void 0&&(l.value=t.value),t.selectOnFocus&&l.addEventListener("focus",()=>l.select())}return e.appendChild(a),t.visible===!1&&(e.style.display=Mt),{field:e,inputElement:i,datepicker:n,subFields:r}}function Cr(t,e,i){const n=document.createElement("div");n.style="display: flex; width: 100%;",n.classList.add("flexcol");const r={},a={};let o;for(const s of e){if((s.text||s.html)&&!s.field){const l=s.fieldPair&&document.createElement("div");l&&(l.className="flexrow");const c=document.createElement("div");c.className="flexaligncenter",c.style=s.style||s.header&&"font-weight: bold; font-size: larger;"||"height: 2.5em; padding-right: 1em;";const u=document.createElement("div");if(s.id&&(u.id=s.id),u.className="content",u.innerHTML=s.text,c.appendChild(u),l){l.appendChild(c);const{field:d,inputElement:p,datepicker:h}=W1(s.fieldPair);h&&(r[`${s.field}.date`]=h),p&&(r[s.fieldPair.field]=p),a[s.fieldPair.field]=d,l.appendChild(d),n.appendChild(l)}else n.appendChild(c);continue}if(s.divider){const l=document.createElement("hr");l.classList.add("dropdown-divider"),n.appendChild(l);continue}if(s.spacer){const l=document.createElement("div"),c=typeof s.spacer=="number"&&`${s.spacer}em`||typeof s.spacer=="string"&&s.spacer||"1em";l.style.marginBlockEnd=c,n.appendChild(l);continue}if(!(!s.label&&!s.field||s.hide)&&s.field){const l=s.fieldPair&&document.createElement("div");l&&(l.className="flexrow");const{field:c,inputElement:u,datepicker:d,subFields:p}=W1(s);if(p&&p.forEach(h=>r[h.field]=h.input),d&&(r[`${s.field}.date`]=d),s.focus&&(o=u),r[s.field]=u,a[s.field]=c,l){l.appendChild(c);const{field:h,inputElement:f,datepicker:m}=W1(s.fieldPair);m&&(r[`${s.field}.date`]=m),f&&(r[s.fieldPair.field]=f),a[s.fieldPair.field]=h,l.appendChild(h),n.appendChild(l)}else n.appendChild(c)}}if(o&&setTimeout(()=>o.focus(),200),t.appendChild(n),i!=null&&i.length)for(const s of i){if(s.dateRange&&Array.isArray(s.fields)){const[l,c]=s.fields;if(r[l]&&r[c]){const u=new yVe(r[l],{inputs:[r[l],r[c]],minDate:s.minDate,maxDate:s.maxDate,format:"yyyy-mm-dd",autohide:!0});r[`${l}.date`]=u}}s.control&&(Nt(s.onChange)&&r[s.control].addEventListener("change",l=>s.onChange({e:l,inputs:r,fields:a})),Nt(s.onInput)&&r[s.control]&&r[s.control].addEventListener("input",l=>s.onInput({e:l,inputs:r,fields:a})),Nt(s.onFocusOut)&&r[s.control]&&r[s.control].addEventListener("focusout",l=>s.onFocusOut({e:l,inputs:r,fields:a})))}return r}var UZ,ha="colors",vc="sizes",fi="space",SVe={gap:fi,gridGap:fi,columnGap:fi,gridColumnGap:fi,rowGap:fi,gridRowGap:fi,inset:fi,insetBlock:fi,insetBlockEnd:fi,insetBlockStart:fi,insetInline:fi,insetInlineEnd:fi,insetInlineStart:fi,margin:fi,marginTop:fi,marginRight:fi,marginBottom:fi,marginLeft:fi,marginBlock:fi,marginBlockEnd:fi,marginBlockStart:fi,marginInline:fi,marginInlineEnd:fi,marginInlineStart:fi,padding:fi,paddingTop:fi,paddingRight:fi,paddingBottom:fi,paddingLeft:fi,paddingBlock:fi,paddingBlockEnd:fi,paddingBlockStart:fi,paddingInline:fi,paddingInlineEnd:fi,paddingInlineStart:fi,top:fi,right:fi,bottom:fi,left:fi,scrollMargin:fi,scrollMarginTop:fi,scrollMarginRight:fi,scrollMarginBottom:fi,scrollMarginLeft:fi,scrollMarginX:fi,scrollMarginY:fi,scrollMarginBlock:fi,scrollMarginBlockEnd:fi,scrollMarginBlockStart:fi,scrollMarginInline:fi,scrollMarginInlineEnd:fi,scrollMarginInlineStart:fi,scrollPadding:fi,scrollPaddingTop:fi,scrollPaddingRight:fi,scrollPaddingBottom:fi,scrollPaddingLeft:fi,scrollPaddingX:fi,scrollPaddingY:fi,scrollPaddingBlock:fi,scrollPaddingBlockEnd:fi,scrollPaddingBlockStart:fi,scrollPaddingInline:fi,scrollPaddingInlineEnd:fi,scrollPaddingInlineStart:fi,fontSize:"fontSizes",background:ha,backgroundColor:ha,backgroundImage:ha,borderImage:ha,border:ha,borderBlock:ha,borderBlockEnd:ha,borderBlockStart:ha,borderBottom:ha,borderBottomColor:ha,borderColor:ha,borderInline:ha,borderInlineEnd:ha,borderInlineStart:ha,borderLeft:ha,borderLeftColor:ha,borderRight:ha,borderRightColor:ha,borderTop:ha,borderTopColor:ha,caretColor:ha,color:ha,columnRuleColor:ha,fill:ha,outline:ha,outlineColor:ha,stroke:ha,textDecorationColor:ha,fontFamily:"fonts",fontWeight:"fontWeights",lineHeight:"lineHeights",letterSpacing:"letterSpacings",blockSize:vc,minBlockSize:vc,maxBlockSize:vc,inlineSize:vc,minInlineSize:vc,maxInlineSize:vc,width:vc,minWidth:vc,maxWidth:vc,height:vc,minHeight:vc,maxHeight:vc,flexBasis:vc,gridTemplateColumns:vc,gridTemplateRows:vc,borderWidth:"borderWidths",borderTopWidth:"borderWidths",borderRightWidth:"borderWidths",borderBottomWidth:"borderWidths",borderLeftWidth:"borderWidths",borderStyle:"borderStyles",borderTopStyle:"borderStyles",borderRightStyle:"borderStyles",borderBottomStyle:"borderStyles",borderLeftStyle:"borderStyles",borderRadius:"radii",borderTopLeftRadius:"radii",borderTopRightRadius:"radii",borderBottomRightRadius:"radii",borderBottomLeftRadius:"radii",boxShadow:"shadows",textShadow:"shadows",transition:"transitions",zIndex:"zIndices"},TVe=(t,e)=>typeof e=="function"?{"()":Function.prototype.toString.call(e)}:e,MP=()=>{const t=Object.create(null);return(e,i,...n)=>{const r=(a=>JSON.stringify(a,TVe))(e);return r in t?t[r]:t[r]=i(e,...n)}},_N=Symbol.for("sxs.internal"),F4=(t,e)=>Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)),DZ=t=>{for(const e in t)return!0;return!1},{hasOwnProperty:UVe}=Object.prototype,BV=t=>t.includes("-")?t:t.replace(/[A-Z]/g,e=>"-"+e.toLowerCase()),DVe=/\s+(?![^()]*\))/,e0=t=>e=>t(...typeof e=="string"?String(e).split(DVe):[e]),EZ={appearance:t=>({WebkitAppearance:t,appearance:t}),backfaceVisibility:t=>({WebkitBackfaceVisibility:t,backfaceVisibility:t}),backdropFilter:t=>({WebkitBackdropFilter:t,backdropFilter:t}),backgroundClip:t=>({WebkitBackgroundClip:t,backgroundClip:t}),boxDecorationBreak:t=>({WebkitBoxDecorationBreak:t,boxDecorationBreak:t}),clipPath:t=>({WebkitClipPath:t,clipPath:t}),content:t=>({content:t.includes('"')||t.includes("'")||/^([A-Za-z]+\([^]*|[^]*-quote|inherit|initial|none|normal|revert|unset)$/.test(t)?t:`"${t}"`}),hyphens:t=>({WebkitHyphens:t,hyphens:t}),maskImage:t=>({WebkitMaskImage:t,maskImage:t}),maskSize:t=>({WebkitMaskSize:t,maskSize:t}),tabSize:t=>({MozTabSize:t,tabSize:t}),textSizeAdjust:t=>({WebkitTextSizeAdjust:t,textSizeAdjust:t}),userSelect:t=>({WebkitUserSelect:t,userSelect:t}),marginBlock:e0((t,e)=>({marginBlockStart:t,marginBlockEnd:e||t})),marginInline:e0((t,e)=>({marginInlineStart:t,marginInlineEnd:e||t})),maxSize:e0((t,e)=>({maxBlockSize:t,maxInlineSize:e||t})),minSize:e0((t,e)=>({minBlockSize:t,minInlineSize:e||t})),paddingBlock:e0((t,e)=>({paddingBlockStart:t,paddingBlockEnd:e||t})),paddingInline:e0((t,e)=>({paddingInlineStart:t,paddingInlineEnd:e||t}))},n$=/([\d.]+)([^]*)/,EVe=(t,e)=>t.length?t.reduce((i,n)=>(i.push(...e.map(r=>r.includes("&")?r.replace(/&/g,/[ +>|~]/.test(n)&&/&.*&/.test(r)?`:is(${n})`:n):n+" "+r)),i),[]):e,CVe=(t,e)=>t in PVe&&typeof e=="string"?e.replace(/^((?:[^]*[^\w-])?)(fit-content|stretch)((?:[^\w-][^]*)?)$/,(i,n,r,a)=>n+(r==="stretch"?`-moz-available${a};${BV(t)}:${n}-webkit-fill-available`:`-moz-fit-content${a};${BV(t)}:${n}fit-content`)+a):String(e),PVe={blockSize:1,height:1,inlineSize:1,maxBlockSize:1,maxHeight:1,maxInlineSize:1,maxWidth:1,minBlockSize:1,minHeight:1,minInlineSize:1,minWidth:1,width:1},ig=t=>t?t+"-":"",dfe=(t,e,i)=>t.replace(/([+-])?((?:\d+(?:\.\d*)?|\.\d+)(?:[Ee][+-]?\d+)?)?(\$|--)([$\w-]+)/g,(n,r,a,o,s)=>o=="$"==!!a?n:(r||o=="--"?"calc(":"")+"var(--"+(o==="$"?ig(e)+(s.includes("$")?"":ig(i))+s.replace(/\$/g,"-"):s)+")"+(r||o=="--"?"*"+(r||"")+(a||"1")+")":"")),RVe=/\s*,\s*(?![^()]*\))/,MVe=Object.prototype.toString,M0=(t,e,i,n,r)=>{let a,o,s;const l=(c,u,d)=>{let p,h;const f=m=>{for(p in m){const y=p.charCodeAt(0)===64,b=y&&Array.isArray(m[p])?m[p]:[m[p]];for(h of b){const I=/[A-Z]/.test(v=p)?v:v.replace(/-[^]/g,w=>w[1].toUpperCase()),T=typeof h=="object"&&h&&h.toString===MVe&&(!n.utils[I]||!u.length);if(I in n.utils&&!T){const w=n.utils[I];if(w!==o){o=w,f(w(h)),o=null;continue}}else if(I in EZ){const w=EZ[I];if(w!==s){s=w,f(w(h)),s=null;continue}}if(y&&(g=p.slice(1)in n.media?"@media "+n.media[p.slice(1)]:p,p=g.replace(/\(\s*([\w-]+)\s*(=|<|<=|>|>=)\s*([\w-]+)\s*(?:(<|<=|>|>=)\s*([\w-]+)\s*)?\)/g,(w,S,D,E,C,P)=>{const R=n$.test(S),N=.0625*(R?-1:1),[M,A]=R?[E,S]:[S,E];return"("+(D[0]==="="?"":D[0]===">"===R?"max-":"min-")+M+":"+(D[0]!=="="&&D.length===1?A.replace(n$,(_,x,O)=>Number(x)+N*(D===">"?1:-1)+O):A)+(C?") and ("+(C[0]===">"?"min-":"max-")+M+":"+(C.length===1?P.replace(n$,(_,x,O)=>Number(x)+N*(C===">"?-1:1)+O):P):"")+")"})),T){const w=y?d.concat(p):[...d],S=y?[...u]:EVe(u,p.split(RVe));a!==void 0&&r(CZ(...a)),a=void 0,l(h,S,w)}else a===void 0&&(a=[[],u,d]),p=y||p.charCodeAt(0)!==36?p:`--${ig(n.prefix)}${p.slice(1).replace(/\$/g,"-")}`,h=T?h:typeof h=="number"?h&&I in NVe?String(h)+"px":String(h):dfe(CVe(I,h??""),n.prefix,n.themeMap[I]),a[0].push(`${y?`${p} `:`${BV(p)}:`}${h}`)}}var g,v};f(c),a!==void 0&&r(CZ(...a)),a=void 0};l(t,e,i)},CZ=(t,e,i)=>`${i.map(n=>`${n}{`).join("")}${e.length?`${e.join(",")}{`:""}${t.join(";")}${e.length?"}":""}${Array(i.length?i.length+1:0).join("}")}`,NVe={animationDelay:1,animationDuration:1,backgroundSize:1,blockSize:1,border:1,borderBlock:1,borderBlockEnd:1,borderBlockEndWidth:1,borderBlockStart:1,borderBlockStartWidth:1,borderBlockWidth:1,borderBottom:1,borderBottomLeftRadius:1,borderBottomRightRadius:1,borderBottomWidth:1,borderEndEndRadius:1,borderEndStartRadius:1,borderInlineEnd:1,borderInlineEndWidth:1,borderInlineStart:1,borderInlineStartWidth:1,borderInlineWidth:1,borderLeft:1,borderLeftWidth:1,borderRadius:1,borderRight:1,borderRightWidth:1,borderSpacing:1,borderStartEndRadius:1,borderStartStartRadius:1,borderTop:1,borderTopLeftRadius:1,borderTopRightRadius:1,borderTopWidth:1,borderWidth:1,bottom:1,columnGap:1,columnRule:1,columnRuleWidth:1,columnWidth:1,containIntrinsicSize:1,flexBasis:1,fontSize:1,gap:1,gridAutoColumns:1,gridAutoRows:1,gridTemplateColumns:1,gridTemplateRows:1,height:1,inlineSize:1,inset:1,insetBlock:1,insetBlockEnd:1,insetBlockStart:1,insetInline:1,insetInlineEnd:1,insetInlineStart:1,left:1,letterSpacing:1,margin:1,marginBlock:1,marginBlockEnd:1,marginBlockStart:1,marginBottom:1,marginInline:1,marginInlineEnd:1,marginInlineStart:1,marginLeft:1,marginRight:1,marginTop:1,maxBlockSize:1,maxHeight:1,maxInlineSize:1,maxWidth:1,minBlockSize:1,minHeight:1,minInlineSize:1,minWidth:1,offsetDistance:1,offsetRotate:1,outline:1,outlineOffset:1,outlineWidth:1,overflowClipMargin:1,padding:1,paddingBlock:1,paddingBlockEnd:1,paddingBlockStart:1,paddingBottom:1,paddingInline:1,paddingInlineEnd:1,paddingInlineStart:1,paddingLeft:1,paddingRight:1,paddingTop:1,perspective:1,right:1,rowGap:1,scrollMargin:1,scrollMarginBlock:1,scrollMarginBlockEnd:1,scrollMarginBlockStart:1,scrollMarginBottom:1,scrollMarginInline:1,scrollMarginInlineEnd:1,scrollMarginInlineStart:1,scrollMarginLeft:1,scrollMarginRight:1,scrollMarginTop:1,scrollPadding:1,scrollPaddingBlock:1,scrollPaddingBlockEnd:1,scrollPaddingBlockStart:1,scrollPaddingBottom:1,scrollPaddingInline:1,scrollPaddingInlineEnd:1,scrollPaddingInlineStart:1,scrollPaddingLeft:1,scrollPaddingRight:1,scrollPaddingTop:1,shapeMargin:1,textDecoration:1,textDecorationThickness:1,textIndent:1,textUnderlineOffset:1,top:1,transitionDelay:1,transitionDuration:1,verticalAlign:1,width:1,wordSpacing:1},PZ=t=>String.fromCharCode(t+(t>25?39:97)),Ab=t=>(e=>{let i,n="";for(i=Math.abs(e);i>52;i=i/52|0)n=PZ(i%52)+n;return PZ(i%52)+n})(((e,i)=>{let n=i.length;for(;n;)e=33*e^i.charCodeAt(--n);return e})(5381,JSON.stringify(t))>>>0),b1=["themed","global","styled","onevar","resonevar","allvar","inline"],AVe=t=>{if(t.href&&!t.href.startsWith(location.origin))return!1;try{return!!t.cssRules}catch{return!1}},_Ve=t=>{let e;const i=()=>{const{cssRules:r}=e.sheet;return[].map.call(r,(a,o)=>{const{cssText:s}=a;let l="";if(s.startsWith("--sxs"))return"";if(r[o-1]&&(l=r[o-1].cssText).startsWith("--sxs")){if(!a.cssRules.length)return"";for(const c in e.rules)if(e.rules[c].group===a)return`--sxs{--sxs:${[...e.rules[c].cache].join(" ")}}${s}`;return a.cssRules.length?`${l}${s}`:""}return s}).join("")},n=()=>{if(e){const{rules:s,sheet:l}=e;if(!l.deleteRule){for(;Object(Object(l.cssRules)[0]).type===3;)l.cssRules.splice(0,1);l.cssRules=[]}for(const c in s)delete s[c]}const r=Object(t).styleSheets||[];for(const s of r)if(AVe(s)){for(let l=0,c=s.cssRules;c[l];++l){const u=Object(c[l]);if(u.type!==1)continue;const d=Object(c[l+1]);if(d.type!==4)continue;++l;const{cssText:p}=u;if(!p.startsWith("--sxs"))continue;const h=p.slice(14,-3).trim().split(/\s+/),f=b1[h[0]];f&&(e||(e={sheet:s,reset:n,rules:{},toString:i}),e.rules[f]={group:d,index:l,cache:new Set(h)})}if(e)break}if(!e){const s=(l,c)=>({type:c,cssRules:[],insertRule(u,d){this.cssRules.splice(d,0,s(u,{import:3,undefined:1}[(u.toLowerCase().match(/^@([a-z]+)/)||[])[1]]||4))},get cssText(){return l==="@media{}"?`@media{${[].map.call(this.cssRules,u=>u.cssText).join("")}}`:l}});e={sheet:t?(t.head||t).appendChild(document.createElement("style")).sheet:s("","text/css"),rules:{},reset:n,toString:i}}const{sheet:a,rules:o}=e;for(let s=b1.length-1;s>=0;--s){const l=b1[s];if(!o[l]){const c=b1[s+1],u=o[c]?o[c].index:a.cssRules.length;a.insertRule("@media{}",u),a.insertRule(`--sxs{--sxs:${s}}`,u),o[l]={group:a.cssRules[u+1],index:u,cache:new Set([s])}}kVe(o[l])}};return n(),e},kVe=t=>{const e=t.group;let i=e.cssRules.length;t.apply=n=>{try{e.insertRule(n,i),++i}catch{}}},t1=Symbol(),xVe=MP(),OVe=(t,e)=>xVe(t,()=>(...i)=>{let n={type:null,composers:new Set};for(const r of i)if(r!=null)if(r[_N]){n.type==null&&(n.type=r[_N].type);for(const a of r[_N].composers)n.composers.add(a)}else r.constructor!==Object||r.$$typeof?n.type==null&&(n.type=r):n.composers.add(LVe(r,t));return n.type==null&&(n.type="span"),n.composers.size||n.composers.add(["PJLV",{},[],[],{},[]]),FVe(t,n,e)}),LVe=({variants:t,compoundVariants:e,defaultVariants:i,...n},r)=>{const a=`${ig(r.prefix)}c-${Ab(n)}`,o=[],s=[],l=Object.create(null),c=[];for(const p in i)l[p]=String(i[p]);if(typeof t=="object"&&t)for(const p in t){u=l,d=p,UVe.call(u,d)||(l[p]="undefined");const h=t[p];for(const f in h){const m={[p]:String(f)};String(f)==="undefined"&&c.push(p);const g=h[f],v=[m,g,!DZ(g)];o.push(v)}}var u,d;if(typeof e=="object"&&e)for(const p of e){let{css:h,...f}=p;h=typeof h=="object"&&h||{};for(const g in f)f[g]=String(f[g]);const m=[f,h,!DZ(h)];s.push(m)}return[a,n,o,s,l,c]},FVe=(t,e,i)=>{const[n,r,a,o]=BVe(e.composers),s=typeof e.type=="function"||e.type.$$typeof?(d=>{function p(){for(let h=0;h<p[t1].length;h++){const[f,m]=p[t1][h];d.rules[f].apply(m)}return p[t1]=[],null}return p[t1]=[],p.rules={},b1.forEach(h=>p.rules[h]={apply:f=>p[t1].push([h,f])}),p})(i):null,l=(s||i).rules,c=`.${n}${r.length>1?`:where(.${r.slice(1).join(".")})`:""}`,u=d=>{d=typeof d=="object"&&d||$Ve;const{css:p,...h}=d,f={};for(const v in a)if(delete h[v],v in d){let y=d[v];typeof y=="object"&&y?f[v]={"@initial":a[v],...y}:(y=String(y),f[v]=y!=="undefined"||o.has(v)?y:a[v])}else f[v]=a[v];const m=new Set([...r]);for(const[v,y,b,I]of e.composers){i.rules.styled.cache.has(v)||(i.rules.styled.cache.add(v),M0(y,[`.${v}`],[],t,S=>{l.styled.apply(S)}));const T=RZ(b,f,t.media),w=RZ(I,f,t.media,!0);for(const S of T)if(S!==void 0)for(const[D,E,C]of S){const P=`${v}-${Ab(E)}-${D}`;m.add(P);const R=(C?i.rules.resonevar:i.rules.onevar).cache,N=C?l.resonevar:l.onevar;R.has(P)||(R.add(P),M0(E,[`.${P}`],[],t,M=>{N.apply(M)}))}for(const S of w)if(S!==void 0)for(const[D,E]of S){const C=`${v}-${Ab(E)}-${D}`;m.add(C),i.rules.allvar.cache.has(C)||(i.rules.allvar.cache.add(C),M0(E,[`.${C}`],[],t,P=>{l.allvar.apply(P)}))}}if(typeof p=="object"&&p){const v=`${n}-i${Ab(p)}-css`;m.add(v),i.rules.inline.cache.has(v)||(i.rules.inline.cache.add(v),M0(p,[`.${v}`],[],t,y=>{l.inline.apply(y)}))}for(const v of String(d.className||"").trim().split(/\s+/))v&&m.add(v);const g=h.className=[...m].join(" ");return{type:e.type,className:g,selector:c,props:h,toString:()=>g,deferredInjector:s}};return F4(u,{className:n,selector:c,[_N]:e,toString:()=>(i.rules.styled.cache.has(n)||u(),n)})},BVe=t=>{let e="";const i=[],n={},r=[];for(const[a,,,,o,s]of t){e===""&&(e=a),i.push(a),r.push(...s);for(const l in o){const c=o[l];(n[l]===void 0||c!=="undefined"||s.includes(c))&&(n[l]=c)}}return[e,i,n,new Set(r)]},RZ=(t,e,i,n)=>{const r=[];e:for(let[a,o,s]of t){if(s)continue;let l,c=0,u=!1;for(l in a){const d=a[l];let p=e[l];if(p!==d){if(typeof p!="object"||!p)continue e;{let h,f,m=0;for(const g in p){if(d===String(p[g])){if(g!=="@initial"){const v=g.slice(1);(f=f||[]).push(v in i?i[v]:g.replace(/^@media ?/,"")),u=!0}c+=m,h=!0}++m}if(f&&f.length&&(o={["@media "+f.join(", ")]:o}),!h)continue e}}}(r[c]=r[c]||[]).push([n?"cv":`${l}-${a[l]}`,o,u])}return r},$Ve={},VVe=MP(),jVe=(t,e)=>VVe(t,()=>(...i)=>{const n=()=>{for(let r of i){r=typeof r=="object"&&r||{};let a=Ab(r);if(!e.rules.global.cache.has(a)){if(e.rules.global.cache.add(a),"@import"in r){let o=[].indexOf.call(e.sheet.cssRules,e.rules.themed.group)-1;for(let s of[].concat(r["@import"]))s=s.includes('"')||s.includes("'")?s:`"${s}"`,e.sheet.insertRule(`@import ${s};`,o++);delete r["@import"]}M0(r,[],[],t,o=>{e.rules.global.apply(o)})}}return""};return F4(n,{toString:n})}),GVe=MP(),HVe=(t,e)=>GVe(t,()=>i=>{const n=`${ig(t.prefix)}k-${Ab(i)}`,r=()=>{if(!e.rules.global.cache.has(n)){e.rules.global.cache.add(n);const a=[];M0(i,[],[],t,s=>a.push(s));const o=`@keyframes ${n}{${a.join("")}}`;e.rules.global.apply(o)}return n};return F4(r,{get name(){return r()},toString:r})}),zVe=class{constructor(t,e,i,n){this.token=t==null?"":String(t),this.value=e==null?"":String(e),this.scale=i==null?"":String(i),this.prefix=n==null?"":String(n)}get computedValue(){return"var("+this.variable+")"}get variable(){return"--"+ig(this.prefix)+ig(this.scale)+this.token}toString(){return this.computedValue}},qVe=MP(),WVe=(t,e)=>qVe(t,()=>(i,n)=>{n=typeof i=="object"&&i||Object(n);const r=`.${i=(i=typeof i=="string"?i:"")||`${ig(t.prefix)}t-${Ab(n)}`}`,a={},o=[];for(const l in n){a[l]={};for(const c in n[l]){const u=`--${ig(t.prefix)}${l}-${c}`,d=dfe(String(n[l][c]),t.prefix,l);a[l][c]=new zVe(c,d,l,t.prefix),o.push(`${u}:${d}`)}}const s=()=>{if(o.length&&!e.rules.themed.cache.has(i)){e.rules.themed.cache.add(i);const l=`${n===t.theme?":root,":""}.${i}{${o.join(";")}}`;e.rules.themed.apply(l)}return i};return{...a,get className(){return s()},selector:r,toString:s}}),KVe=MP(),pfe=t=>{let e=!1;const i=KVe(t,n=>{e=!0;const r="prefix"in(n=typeof n=="object"&&n||{})?String(n.prefix):"",a=typeof n.media=="object"&&n.media||{},o=typeof n.root=="object"?n.root||null:globalThis.document||null,s=typeof n.theme=="object"&&n.theme||{},l={prefix:r,media:a,theme:s,themeMap:typeof n.themeMap=="object"&&n.themeMap||{...SVe},utils:typeof n.utils=="object"&&n.utils||{}},c=_Ve(o),u={css:OVe(l,c),globalCss:jVe(l,c),keyframes:HVe(l,c),createTheme:WVe(l,c),reset(){c.reset(),u.theme.toString()},theme:{},sheet:c,config:l,prefix:r,getCssText:c.toString,toString:c.toString};return String(u.theme=u.createTheme(s)),u});return e||i.reset(),i},YVe=()=>UZ||(UZ=pfe()),Tn=(...t)=>YVe().css(...t);function ZVe({variant:t}){return Tn({margin:"2.5px 0",variants:{variant:{showAddress:{lineHeight:"2.3em"}}}})({variant:t})}const XVe=Tn({justifyContent:"flex-start",alignItems:"center",whiteSpace:"nowrap",fontWeight:500,display:"flex"}),JVe=Tn({textTransform:"$participant$textTransform",fontSize:"0.875rem",fontWeight:500,variants:{variant:{winner:{fontWeight:700,color:"$winnerName"},loser:{fontWeight:500}}}}),QVe=Tn({"&::WebkitScrollbar":{display:"none"},justifyContent:"space-between",flexDirection:"column",marginInlineEnd:"0rem",scrollbarWidth:"none",overflowX:"scroll",fontWeight:500,display:"flex",width:"100%",variants:{variant:{doubles:{marginTop:"0.25rem",fontSize:"0.75rem",lineHeight:"1rem"}}}});function eje({drawPosition:t,sideNumber:e}){return Tn({minHeight:"$participant$minHeight",justifyContent:"space-between",paddingInlineStart:"0.75rem",backgroundColor:"$matchUp",paddingInlineEnd:"0rem",boxSizing:"border-box",paddingBottom:".2rem",position:"relative",alignItems:"center",paddingTop:".2rem",minWidth:"15rem",cursor:"pointer",display:"flex",flexGrow:1,"& p":{fontFamily:"Sharp Sans, Arial, sans-serif",color:"$color"},variants:{sideNumber:{1:{borderBottom:"1px solid $internalDividers"}}}})({sideNumber:e,css:t&&{"&:before":{backgroundColor:"$backgroundColor",content:`${t}`,justifyContent:"center",alignContent:"center",insetInlineStart:-10,position:"absolute",color:"#55AFFE",display:"flex",width:20}}})}function tje({winnerChevron:t,isDoubles:e}){const i=(e?.4:.3)*2;return Tn({variants:{variant:{winner:{"&::before":{borderTop:`${i}rem solid transparent`,borderBottom:`${i}rem solid transparent`,borderInlineStart:"8px solid #008f70",position:"absolute",insetInlineStart:0,display:"block",content:""}}}}})({variant:t?"winner":void 0})}const B4=Tn({fontSize:"smaller",color:"gray"});var ije=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function hfe(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var ffe={exports:{}};/*!
	Copyright (c) 2018 Jed Watson.
	Licensed under the MIT License (MIT), see
	http://jedwatson.github.io/classnames
*/(function(t){(function(){var e={}.hasOwnProperty;function i(){for(var a="",o=0;o<arguments.length;o++){var s=arguments[o];s&&(a=r(a,n(s)))}return a}function n(a){if(typeof a=="string"||typeof a=="number")return a;if(typeof a!="object")return"";if(Array.isArray(a))return i.apply(null,a);if(a.toString!==Object.prototype.toString&&!a.toString.toString().includes("[native code]"))return a.toString();var o="";for(var s in a)e.call(a,s)&&a[s]&&(o=r(o,s));return o}function r(a,o){return o?a?a+" "+o:a+o:a}t.exports?(i.default=i,t.exports=i):window.classNames=i})()})(ffe);var nje=ffe.exports;const Ny=hfe(nje);function rje({individualParticipant:t,className:e}){var i,n;const{city:r,state:a,countryCode:o}=((n=(i=t==null?void 0:t.person)==null?void 0:i.addresses)==null?void 0:n[0])||{},s=[r,a,o].filter(Boolean).join(", ")||" ",l=document.createElement("div");return l.className=Ny(B4(),e),l.innerHTML=s,l}const aje=Tn({willChange:"opacity",position:"fixed",zIndex:9998,bottom:0,right:0,left:0,top:0}),oje=Tn({display:"block"}),sje=Tn({position:"fixed",right:0,left:0}),lje=Tn({paddingRight:"15px",alignItems:"center",margin:"30px auto",paddingLeft:"15px",position:"fixed",height:"100vh",display:"flex",width:"100%",zIndex:9999,bottom:0,right:0,left:0,top:0}),cje=Tn({boxShadow:"0 3px 6px rgba(0, 0, 0, 0.16), 0 3px 6px rgba(0, 0, 0, 0.23)",backgroundColor:"white",position:"relative",borderRadius:"3px",minHeight:"auto",width:"100%"}),uje=Tn({borderBottom:"1px solid rgba(0, 0, 0, 0.1)",alignItems:"center",position:"relative",display:"flex"}),dje=Tn({fontWeight:"600",fontSize:"20px"}),MZ=Tn({borderTop:"1px solid rgba(0, 0, 0, 0.1)",justifyContent:"right",alignItems:"center",position:"relative",display:"flex"}),NZ="Nothing to see here";function sd(t){return typeof t=="function"}function kN(t){return typeof t=="string"}function AZ(t){return Array.isArray(t)}function r$(t){return typeof t=="object"&&!Array.isArray(t)}function pje(t){if(t)for(;t.firstChild;)t.removeChild(t.firstChild)}const h_=(()=>{const t=sje(),e={},i=".5";let n=[],r,a=[],o=[],s;const l=m=>{if(m){let g;o=o.filter(v=>(v.id===m&&(g=v),v.id!==m)),g&&document.body.removeChild(g)}else{const g=o.pop();g&&document.body.removeChild(g)}},c=()=>{s&&(s.style.opacity=0,s.style.display="none")},u=m=>{const g=o.length;if(m&&e[g]===!1)return;const v=a.pop(),y=n.pop();sd(v)&&v({content:y}),document.body.classList.remove(t),document.body.style.top=null,window.scrollTo({top:r,behavior:"instant"}),c(),l()},d=()=>{s=document.createElement("div"),s.className=aje(),s.id="cmdl-backdrop",s.onclick=()=>u(!0),document.body.appendChild(s)},p=({config:m})=>{r=window.scrollY,document.body.classList.add(t),document.body.style.top=`-${r}px`,s||d(),s.style.display="",(m==null?void 0:m.backdrop)!==!1&&(s.style.backgroundColor="rgba(0, 0, 0, 0.2)",s.style.transition="opacity 0.15s linear",s.style.opacity=1)},h=({config:m,attr:g,attrs:v,unit:y="em",value:b})=>{var I;let T;return kN(g)?T=$V({element:m,attr:g}):AZ(v)&&(T=(I=v.map(w=>$V({element:m,attr:w})).filter(Boolean))==null?void 0:I[0]),T!==void 0&&(b=T),isNaN(b)?b:`${b}${y}`},f=({buttons:m,config:g,modalNumber:v})=>{var y,b;const I=document.createElement("div");I.className=MZ(),I.style.padding=h({config:g,attrs:["footer.padding","padding"],value:i});const T={label:((y=g==null?void 0:g.dictionary)==null?void 0:y.close)||"Close",onClick:h_.close,intent:"is-info"};for(const w of m){if(w.hide)continue;const S={...T};r$(w)&&Object.assign(S,w);const D=document.createElement("button");S.disabled!==void 0&&(D.disabled=S.disabled),S.id&&(D.id=S.id),D.className=((b=S==null?void 0:S.footer)==null?void 0:b.className)||"button font-medium",D.classList.add(S.intent),D.style="margin-right: .5em;",D.innerHTML=S.label||S.text,D.onclick=E=>{E.stopPropagation(),sd(S.onClick)&&(D.classList.add("is-loading"),S.onClick({e:E,content:n[v]})),S.close!==!1&&(sd(S.close)&&S.close(),h_.close())},I.appendChild(D)}return I};return{close:u,open:({title:m="",content:g,buttons:v,footer:y,config:b,onClose:I}={})=>{p({config:b}),a.push(I);const T=o.length+1;e[T]=b==null?void 0:b.clickAway;const w=document.createElement("section"),S=`cmdl-${T}`;w.className=oje(),w.role="dialog",w.tabIndex=-1,w.id=S;const D=document.createElement("div");D.className=lje(),D.style.maxWidth=`${(b==null?void 0:b.maxWidth)||450}px`,D.onclick=()=>u(!0);const E=document.createElement("div");E.className=cje(),E.onclick=O=>O.stopPropagation();const C=document.createElement("div"),P=document.createElement("div");C.appendChild(P),E.appendChild(C);const R=({title:O,config:B})=>{C.className=O?uje():"",C.style.padding=h({config:B,attrs:["title.padding","padding"],value:i}),P.className=O?dje():"",P.innerHTML=O};m&&R({title:m});const N=document.createElement("div");E.appendChild(N);const M=({content:O,config:B})=>{N.style.fontSize=h({config:B,attr:"fontSize",value:"15px"}),N.style.position="relative",N.style.padding=h({config:B,attrs:["content.padding","padding"],value:i}),sd(O)?n[T]=O(N):r$(O)?N.appendChild(O):kN(O)?N.innerHTML=O:N.innerHTML=NZ};if(M({content:g,config:b}),AZ(v))y=f({buttons:v,config:b,modalNumber:T}),E.appendChild(y);else if(y){const O=document.createElement("div");O.className=MZ(),O.style.padding=h({config:b,attrs:["footer.padding","padding"]}),r$(y)?O.appendChild(y):kN(y)?O.innerHTML=y:O.innerHTML=NZ,E.appendChild(O)}D.appendChild(E),w.appendChild(D),document.body.appendChild(w),o.push(w);const A=({content:O,config:B})=>{n[T]=void 0,pje(N),M({content:O,config:B})},_=({buttons:O,config:B})=>{E.removeChild(y),y=f({buttons:O,config:B,modalNumber:T}),E.appendChild(y)},x=({onClose:O})=>{a.length=0,a.push(O)};return{setContent:A,setButtons:_,update:({content:O,buttons:B,title:F,config:G,onClose:H})=>{b=G||b,O&&A({content:O,config:b}),B&&_({buttons:B,config:b}),H&&x({onClose:H}),F&&R({title:F,config:b})}}}}})();function $V({element:t,attr:e}){if(!kN(e))return;const i=e.split(".");for(const n of i)if(t=t==null?void 0:t[n],!t)return;return t}function hje({individualParticipant:t,attribute:e,className:i}){const n=t==null?void 0:t.person,r=$V({element:n,attr:e});if(!r)return;const a=document.createElement("div");return a.className=Ny(B4(),i),a.innerHTML=r,a}function fje({individualParticipant:t,className:e}){var i;const n=(i=t==null?void 0:t.teams)==null?void 0:i[0],r=(n==null?void 0:n.participantName)||" ",a=document.createElement("div");return a.className=Ny(B4(),e),a.classList.add("tmx-tm"),a.setAttribute("id",n==null?void 0:n.participantId),a.innerHTML=r,a}function mje(t){var e,i,n,r;const a=(i=(e=t==null?void 0:t.composition)==null?void 0:e.configuration)==null?void 0:i.participantDetail;if(((r=(n=t==null?void 0:t.composition)==null?void 0:n.configuration)==null?void 0:r.showAddress)??a==="ADDRESS")return rje(t);if(a==="TEAM")return fje(t);if(a){const o=hje({...t,attribute:a});if(o)return o}return document.createElement("div")}const gje=Tn({color:"$participant$seed",marginInlineStart:".5rem",textTransform:"uppercase",fontSize:"0.75rem",lineHeight:"1rem"});function vje({className:t,composition:e,side:i}){const n=(i==null?void 0:i.seedValue)||(i==null?void 0:i.seedNumber);if(!n)return"";const r=(e==null?void 0:e.configuration)||{},{bracketedSeeds:a}=r,o=typeof a=="boolean"&&["(",")"]||a==="square"&&["[","]"]||["",""],s=`${o[0]}${n}${o[1]}`,l=r.seedingElement==="sup"?"sup":"span",c=document.createElement(l);return c.className=t,c.innerHTML=s,c}const yje=Tn({WebkitBoxSizing:"border-box",marginInlineEnd:".5em",boxSizing:"border-box",display:"inline-block",position:"relative",fontSize:"smaller",fontWeight:"bold",borderRadius:2,color:"blue",variants:{color:{green:{color:"green"},red:{color:"red"}}}});function bje({individualParticipant:t,composition:e,className:i,matchUp:n,spacer:r}){var a,o,s,l,c,u,d;const p=e==null?void 0:e.configuration,h=((a=p==null?void 0:p.scaleAttributes)==null?void 0:a.eventType)||(n==null?void 0:n.matchUpType)||"SINGLES",f=t==null?void 0:t.rankings,m=t==null?void 0:t.ratings,g=p==null?void 0:p.scaleAttributes,v=g==null?void 0:g.scaleType,y=g==null?void 0:g.scaleName,b=g==null?void 0:g.accessor,I=v==="RATING"?m:f,T=(s=(o=I==null?void 0:I.SINGLES)==null?void 0:o.find(N=>(N==null?void 0:N.scaleName)===y))==null?void 0:s.scaleValue,w=(c=(l=I==null?void 0:I.DOUBLES)==null?void 0:l.find(N=>(N==null?void 0:N.scaleName)===y))==null?void 0:c.scaleValue,S=T&&b?T[b]:T||"",D=w&&b?w[b]:w||"",E=h==="SINGLES"?S:D,C=(u=p==null?void 0:p.scaleAttributes)==null?void 0:u.fallback,P=!r&&(E||C&&(S||D)),R=document.createElement("span");return P&&(R.className=Ny(i,yje({color:(d=p==null?void 0:p.scaleAttributes)==null?void 0:d.scaleColor}))),R.innerHTML=P||"",R}var Ije=Object.defineProperty,zi=(t,e)=>{for(var i in e)Ije(t,i,{get:e[i],enumerable:!0})};function KO(){return"2.0.28"}var mfe={};zi(mfe,{competitionGovernor:()=>gfe,drawsGovernor:()=>uge,entriesGovernor:()=>mwe,eventGovernor:()=>Swe,generationGovernor:()=>Lwe,matchUpFormatGovernor:()=>qwe,matchUpGovernor:()=>Wwe,mocksGovernor:()=>M7,participantGovernor:()=>j0e,policyGovernor:()=>GIe,publishingGovernor:()=>uSe,queryGovernor:()=>KIe,reportGovernor:()=>vSe,scheduleGovernor:()=>ySe,scoreGovernor:()=>b8,tieFormatGovernor:()=>MSe,tournamentGovernor:()=>BSe,venueGovernor:()=>YSe});var gfe={};zi(gfe,{getLinkedTournamentIds:()=>zP,getTournamentIds:()=>GP,linkTournaments:()=>oge,mutate:()=>vfe,query:()=>cge,unlinkTournament:()=>lge,unlinkTournaments:()=>sge});var vfe={};zi(vfe,{linkTournaments:()=>oge,unlinkTournament:()=>lge,unlinkTournaments:()=>sge});var wje={};zi(wje,{addNotice:()=>tn,callListener:()=>JV,createInstanceState:()=>gGe,cycleMutationStatus:()=>y5,deepCopyEnabled:()=>v5,deleteNotice:()=>b5,deleteNotices:()=>BP,disableNotifications:()=>kme,enableNotifications:()=>FN,getDevContext:()=>jc,getMethods:()=>Lme,getNotices:()=>Fme,getProvider:()=>QV,getTopics:()=>Gu,getTournamentId:()=>rw,getTournamentRecord:()=>I5,getTournamentRecords:()=>aw,globalLog:()=>Vme,handleCaughtError:()=>cL,removeTournamentRecord:()=>$me,setDeepCopy:()=>sE,setDevContext:()=>oE,setGlobalLog:()=>_me,setGlobalMethods:()=>xme,setGlobalSubscriptions:()=>yGe,setMethods:()=>Ome,setStateMethods:()=>jme,setStateProvider:()=>mGe,setSubscriptions:()=>bGe,setTournamentId:()=>lE,setTournamentRecord:()=>Bme,setTournamentRecords:()=>lL,timeKeeper:()=>vGe});function wl(t){return typeof t=="function"}function qs(t){return typeof t=="string"}function sr(t){return t!==null&&typeof t=="object"&&!Array.isArray(t)}function Sje(t,e){if(!sr(t)||!sr(e))return!1;let i=Object.keys(t),n=Object.keys(e);if(i.length!==n.length)return!1;for(let r of i)if(t[r]!==e[r])return!1;return!0}function yfe(t,e){return Array.isArray(t)?Object.assign({},...(t??[]).filter(sr).map(i=>i[e]&&{[i[e]]:i}).filter(Boolean)):{}}var Tje=t=>e=>Object.keys(t).every(i=>e[i]===t[i]);function VV(t,e){if(t===void 0)return null;if(typeof t!="object"||t===null)return t;let i=Object.keys(t),n=r=>r===void 0?null:r;return Object.assign({},...i.map(r=>Array.isArray(t[r])?{[r]:e?t[r]:t[r].map(a=>VV(a))}:{[r]:e?n(t[r]):VV(t[r])}))}function jV(t){return Array.isArray(t)?t.length+t.map(jV).reduce((e,i)=>e+i,0):typeof t=="object"&&t!==null?Object.keys(t).length+Object.keys(t).map(e=>jV(t[e])).reduce((e,i)=>e+i,0):0}function Uje(t){if(t===null||typeof t!="object")return;let e=JSON.stringify(t),i=jV(t),n=e.split("").reduce((r,a)=>r+a.charCodeAt(0),0);return[e.length,i,n].map(r=>r.toString(36)).join("")}var ue={success:!0},Dje="error",Eje={SUCCESS:ue,ERROR:Dje},GV={message:"Chronological error; time violation.",code:"ANACHRONISM"},bfe={message:"Cannot remove main structure",code:"ERR_CANNOT_REMOVE_MAIN_STRUCTURE"},HV={message:"records must be an object with tournamentId keys",code:"ERR_INVALID_TOURNAMENTS"},_r={message:"Missing tournamentRecords",code:"ERR_MISSING_TOURNAMENTS"},it={message:"Missing tournamentRecord",code:"ERR_MISSING_TOURNAMENT"},NP={message:"Invalid tournamentRecord",code:"ERR_INVALID_TOURNAMENT"},CS={message:"Missing tournamentId",code:"ERR_MISSING_TOURNAMENT_ID"},_b={message:"Invalid drawDefinition",code:"ERR_INVALID_DRAWDEF"},Lt={message:"Missing drawDefinition",code:"ERR_MISSING_DRAWDEF"},Ife={message:"Existing drawDefinition(s)",code:"ERR_EXISTING_DRAWDEFS"},_l={message:"drawDefinition not found",code:"ERR_NOT_FOUND_DRAWDEF"},tw={message:"Invalid structure",code:"ERR_INVALID_STRUCTURE"},$4={message:"Incomplete source structure",code:"ERR_INCOMPLETE_STRUCTURE"},V4={message:"Invalid drawPosition for seedAssignment",code:"ERR_INVALID_SEEDING_POSITION"},PS={message:"drawPosition already assigned",code:"ERR_EXISTING_POSITION_ASSIGNMENT"},wfe={message:"Schedule not cleared",code:"ERR_UNCHANGED_SCHEDULE_NOT_CLEARED"},Sfe={message:"drawPosition not cleared",code:"ERR_FAILURE_POSITION_NOT_CLEARED"},Cje={message:"drawPosition not found",code:"ERR_NOT_FOUND_DRAW_POSITION"},j4={message:"Unrecognized drawType",code:"ERR_UNRECOGNIZED_DRAW_TYPE"},AP={message:"Missing drawPositions",code:"ERR_MISSING_DRAW_POSITIONS"},YO={message:"drawPosition is active",code:"ERR_ACTIVE_DRAW_POSITION"},tU={message:"Invlid drawPosition",code:"ERR_INVALID_DRAW_POSITION"},iU={message:"Missing drawPosition",code:"ERR_MISSING_DRAW_POSITION"},G4={message:"Invalid drawType",code:"ERR_INVALID_DRAW_TYPE"},ZO={message:"Invalid drawSize",code:"ERR_INVALID_DRAW_SIZE"},H4={message:"Cannot set drawSize to be less than existing entries",code:"ERR_INVALID_DRAW_SIZE_MISMATCH"},_P={message:"Missing drawSize",code:"ERR_MISSING_DRAW_SIZE"},Rd={message:"Missing drawId",code:"ERR_MISSING_DRAW_ID"},Tfe={message:"drawId exists",code:"ERR_EXISTING_DRAW_ID"},Ufe={message:"participantId cannot be assigned to multiple seedNumbers",code:"INVALID_PARTICIPANT_SEEDING"},Dfe={message:"seedsCount greater than drawSize",code:"ERR_INVALID_SEED_COUNT"},Efe={message:"Missing seedCountThresholds",code:"ERR_MISSING_SEED_COUNT_THRESHOLD"},Cfe={message:"Invalid action",code:"ERR_INVALID_ACTION"},zV={message:"Invalid assignment",code:"ERR_INVALID_ASSIGNMENT"},Pfe={message:"Missing seedAssignments",code:"ERR_MISSING_SEED_ASSIGNMENTS"},Rfe={message:"Invalid seedNumber",code:"ERR_INVALID_SEED_NUMBER"},Mfe={message:"Invalid seedPosition",code:"ERR_INVALID_SEED_POSITION"},z4={message:"Missing targetLink",code:"ERR_MISSING_LINK_TARGET"},Nfe={message:"Existing round",code:"ERR_EXISTING_ROUND"},Pje={message:"Missing roundNumber",code:"ERR_MISSING_ROUND_NUMBER"},lc={message:"Missing structureId",code:"ERR_MISSING_STRUCTURE_ID"},Dr={message:"structure not found",code:"ERR_NOT_FOUND_STRUCTURE"},q4={message:"Missing structures",code:"ERR_MISSING_STRUCTURES"},_g={message:"Missing structure",code:"ERR_MISSING_STRUCTURE"},Afe={message:"drawDefinition contains unlinked structures",code:"ERR_MISSING_STRUCTURE_LINKS"},ng={message:"Invalid eventType",code:"ERR_INVALID_EVENT_TYPE"},_n={message:"Missing event / eventId",code:"ERR_MISSING_EVENT_ID"},kl={message:"Event not found",code:"ERR_NOT_FOUND_EVENT"},_fe={message:"Event exists",code:"ERR_EXISTING_EVENT"},kfe={message:"Missing entries",code:"ERR_MISSING_ENTRIES"},xfe={message:"Invalid entries",code:"ERR_INVALID_ENTRIES"},W4={message:"Missing assignments",code:"ERR_MISSING_ASSIGNMENTS"},K4={message:"Missing stage",code:"ERR_MISSING_STAGE"},Ay={message:"Invalid stage",code:"ERR_INVALID_STAGE"},Ofe={message:"stageSequence limit",code:"ERR_LIMIT_STAGE_SEQUENCE"},Lfe={message:"Missing positionAssignments",code:"ERR_MISSING_POSITION_ASSIGNMENTS"},Ffe={message:"Cannot Assign BYE status if no assignment: { bye: true }",code:"ERR_UNCHANGED_CANNOT_ASSIGN_BYE"},qV={message:"Unrecognized matchUpStatus",code:"ERR_UNRECOGNIZED_MATCHUP_STATUS"},kP={message:"Unrecognized matchUpFormat",code:"ERR_UNRECOGNIZED_MATCHUP_FORMAT"},xN={message:"Incompatible matchUpStatus",code:"ERR_INCOMPATIBLE_MATCHUP_STATUS"},RS={message:"Invalid matchUpStatus",code:"ERR_INVALID_MATCHUP_STATUS"},nf={message:"Invalid tieFormat",code:"ERR_INVALID_TIE_FORMAT"},Y4={message:"Invalid matchUpFormat",code:"ERR_INVALID_MATCHUP_FORMAT"},Z4={message:"Missing matchUpFormat",code:"ERR_MISSING_MATCHUP_FORMAT"},Bfe={message:"Missing collectionDefinition",code:"ERR_MISSING_COLLECTION_DEFINITION"},xP={message:"Missing tieFormat",code:"ERR_MISSING_TIE_FORMAT"},_o={message:"Missing matchUpId",code:"ERR_MISSING_MATCHUP_ID"},nU={message:"Missing matchUpIds",code:"ERR_MISSING_MATCHUP_IDS"},qo={message:"matchUp not found",code:"ERR_NOT_FOUND_MATCHUP"},Oh={message:"Missing matchUps",code:"ERR_MISSING_MATCHUPS"},cl={message:"Missing matchUp",code:"ERR_MISSING_MATCHUP"},Ws={message:"Invalid matchUp",code:"ERR_INVALID_MATCHUP"},X4={message:"Missing policyType",code:"ERR_MISSING_POLICY_TYPE"},XO={message:"Missing policyDefinitions",code:"ERR_MISSING_POLICY_DEFINITIONS"},Rje={message:"Missing seeding policy",code:"ERR_MISSING_POLICY_SEEDING"},$fe={message:"Missing avoidance policy",code:"ERR_MISSING_POLICY_AVOIDANCE"},J4={message:"Missing policy attributes",code:"ERR_MISSING_POLICY_ATTRIBUTES"},Vfe={message:"Invalid policyDefinitions",code:"ERR_INVALID_POLICY_DEFINITIONS"},Q4={message:"existing policyType",code:"ERR_EXISTING_POLICY_TYPE"},Mje={message:"Policy not attached",code:"ERR_FAILURE_POLICY_NOT_ATTACHED"},MS={message:"Policy not found",code:"ERR_NOT_FOUND_POLICY"},Nje={message:"Missing scoring policy / matchUpFormats",code:"ERR_MISSING_POLICY_SCORING_MATCHUP_FORMATS"},e5={message:"Invalid sideNumber",code:"ERR_INVALID_SIDE_NUMBER"},Aje={message:"Invalid setNumber",code:"ERR_INVALID_SET_NUMBER"},JO={message:"Missing setObject",code:"ERR_MISSING_SET_ATTRIBUTE"},_je={message:"Missing setNumber",code:"ERR_MISSING_SET_NUMBER"},kje={message:"Missing sideNumber",code:"ERR_MISSING_SIDE_NUMBER"},iw={message:"Missing courtId",code:"ERR_MISSING_COURT_ID"},Ht={message:"Missing value",code:"ERR_MISSING_VALUE"},jfe={message:"Missing date",code:"ERR_MISSING_DATE"},Gfe={message:"No valid dates",code:"ERR_NO_VALID_DATES"},f_={message:"Invalid bookings",code:"ERR_INVALID_BOOKINGS"},ON={message:"Invalid dateAvailability",code:"ERR_INVALID_DATE_AVAILABILITY"},Hfe={message:"Missing dateAvailability",code:"ERR_MISSING_DATE_AVAILABILITY"},Cs={message:"Invalid Date",code:"ERR_INVALID_DATE"},lu={message:"Invalid time",code:"ERR_INVALID_TIME"},zfe={message:"Invalid tournament dates",code:"ERR_INVALID_DATES_TOURNAMENT"},WV={message:"Invalid game scores",code:"ERR_INVALID_SCORES_GAME"},qfe={message:"Invalid score",code:"ERR_INVALID_SCORE"},QO={message:"Invalid winningSide",code:"ERR_INVALID_WINNING_SIDE"},xje={message:"No participants generated",code:"ERR_NO_PARTICIPANTS_GENERATED"},t5={message:"Cannot modify tieFormat",code:"ERR_UNCHANGED_CANNOT_MODIFY_TIEFORMAT"},Wfe={message:"Cannot modify participantType",code:"ERR_UNCHANGED_CANNOT_MODIFY_PARTICIPANT_TYPE"},eL={message:"Cannot remove participants",code:"ERR_UNCHANGED_CANNOT_REMOVE_PARTICIPANTS"},i5={message:"Cannot change winningSide",code:"ERR_UNCHANGED_CANNOT_CHANGE_WINNING_SIDE"},rU={message:"Invalid participant",code:"ERR_INVALID_PARTICIPANT"},vp={message:"Invalid participantId",code:"ERR_INVALID_PARTICIPANT_ID"},wu={message:"Invalid participantIds",code:"ERR_INVALID_PARTICIPANT_IDS"},Kfe={message:"Invalid participantRole",code:"ERR_INVALID_PARTICIPANT_ROLE"},Sd={message:"Invalid participantType",code:"ERR_INVALID_PARTICIPANT_TYPE"},Yfe={message:"Missing participantRole",code:"ERR_MISSING_PARTICIPANT_ROLE"},nw={message:"Missing participant",code:"ERR_MISSING_PARTICIPANT"},OP={message:"Missing participants",code:"ERR_MISSING_PARTICIPANTS"},Ra={message:"Missing participantId",code:"ERR_MISSING_PARTICIPANT_ID"},Jr={message:"Participant Not Found",code:"ERR_NOT_FOUND_PARTICIPANT"},Zfe={message:"participantId exists",code:"ERR_EXISTING_PARTICIPANT_ID"},Oje={message:"participant pair exists",code:"ERR_EXISTING_PARTICIPANT_PAIR"},Xfe={message:"No participant removed",code:"ERR_UNCHANGED_NO_PARTICIPANT_REMOVED"},kg={message:"Missing participantIds",code:"ERR_MISSING_PARTICIPANT_IDS"},Jfe={message:"Missing participantsCount",code:"ERR_MISSING_PARTICIPANT_COUNT"},Qfe={message:"Participant not checked in",code:"ERR_UNCHANGED_PARTICIPANT_NOT_CHECKED_IN"},eme={message:"Missing person details",code:"ERR_MISSING_PERSON_DETAILS"},aU={message:"Existing participant drawPosition assignment",code:"ERR_EXISTING_PARTICIPANT_DRAW_POSITION_ASSIGNMENT"},tL={message:"Existing participant",code:"ERR_EXISTING_PARTICIPANT"},n5={message:"participantsCount exceeds drawSize",code:"ERR_INVALID_PARTICIPANT_COUNT"},KV={message:"Invalid entry status",code:"ERR_INVALID_ENTRY_STATUS"},tme={message:"Participant Entry Not Found",code:"ERR_NOT_FOUND_PARTICIPANT_ENTRY"},Lje={message:"Participant not entered in stage",code:"ERR_UNCHANGED_PARTICIPANT_NOT_ENTERED"},Fje={message:"Participant not found in stageSequence",code:"ERR_NOT_FOUND_PARTICIPANT_IN_STAGE"},ime={message:"entryStatus not allowed in stage",code:"ERR_INVALID_ENTRY_STATUS_IN_STAGE"},nme={message:"entryStatus not allowed for event",code:"ERR_INVALID_ENTRY_STATUS_IN_EVENT"},YV={message:"No stage space available for entryStatus",code:"ERR_UNCHANGED_NO_AVAILABLE_STAGE_SPACE"},rme={message:"Insufficient drawPositions to accommodate qualifiers",code:"ERR_UNCHANGED_NO_DRAW_POSITIONS_FOR_QUALIFIERS"},r5={message:"Insufficient drawPositions to accommodate entries",code:"ERR_INSUFFICIENT_DRAW_POSITIONS"},ame={message:"Missing penaltyType",code:"ERR_MISSING_PENALTY_TYPE"},a5={message:"Missing penaltyId",code:"ERR_MISSING_PENALTY_ID"},NS={message:"Penalty not found",code:"ERR_NOT_FOUND_PENALTY"},ome={message:"Missing courtsCount/courtNames",code:"ERR_MISSING_COURTS_INFO"},LP={message:"Court not found",code:"ERR_NOT_FOUND_COURT"},sme={message:"Court exists",code:"ERR_EXISTING_COURT"},lme={message:"Venue exists",code:"ERR_EXISTING_VENUE"},oU={message:"Venue not found",code:"ERR_NOT_FOUND_VENUE"},xg={message:"Missing venueId",code:"ERR_MISSING_VENUE_ID"},cme={message:"Invalid endTime",code:"ERR_INVALID_END_TIME"},o5={message:"Existing endTime",code:"ERR_EXISTING_END_TIME"},ume={message:"Invalid stopTime",code:"ERR_INVALID_STOP_TIME"},dme={message:"Invalid startTime",code:"ERR_INVALID_START_TIME"},Bje={message:"Invalid resumeTime",code:"ERR_INVALID_RESUME_TIME"},s5={message:"Invalid timeItem",code:"ERR_INVALID_TIME_ITEMS"},pme={message:"Missing async state provider",code:"ERR_MISSING_ASYNC_STATE_PROVIDER"},l5={message:"Missing timeItem",code:"ERR_MISSING_TIME_ITEM"},c5={message:"Missing timeItems",code:"ERR_MISSING_TIME_ITEMS"},iL={message:"Missing context",code:"ERR_MISSING_CONTEXT"},hme={message:"Missing schedule",code:"ERR_MISSING_SCHEDULE"},FP={message:"Invalid scaleItem",code:"ERR_INVALID_SCALE_ITEM"},fme={message:"Modifications failed",code:"ERR_FAILURE_MODIFICATIONS"},sU={message:"No modifications applied",code:"ERR_UNCHANGED_NO_MODIFICATIONS_APPLIED"},mme={message:"Unable to assign court",code:"ERR_UNCHANGED_COURT_NOT_ASSIGNED"},nL={message:"No Candidates",code:"ERR_UNCHANGED_NO_CANDIDATES"},gme={message:"Invalid configuration",code:"ERR_INVALID_CONFIG"},vme={message:"Invalid collectionDefinition",code:"ERR_INVALID_COLLECTION_DEFINITION"},om={message:"Invalid object",code:"ERR_INVALID_OBJECT"},LN={message:"Invalid gender",code:"ERR_INVALID_GENDER"},m_={message:"Invalid category",code:"ERR_INVALID_CATEGORY"},Me={message:"Invalid values",code:"ERR_INVALID_VALUES"},yme={message:"Duplicate value",code:"ERR_DUPLICATE_VALUE"},u5={message:"Team not found",code:"ERR_NOT_FOUND_TEAM"},bme={message:"No valid actions",code:"ERR_NO_VALID_ACTIONS"},rL={message:"No valid attributes",code:"ERR_NO_VALID_ATTRIBUTES"},d5={message:"Value unchanged",code:"ABORT_UNCHANGED"},Wo={message:"Not found",code:"ERR_NOT_FOUND"},aL={message:"Not implemented",code:"ERR_NOT_IMPLEMENTED"},Ime={message:"Existing flight",code:"ERR_EXISTING_FLIGHT"},p5={message:"Existing flight profile",code:"ERR_EXISTING_FLIGHT_PROFILE"},wme={message:"Existing outcome",code:"ERR_EXISTING_OUTCOME"},Sme={message:"Existing matchUpId",code:"ERR_EXISTING_MATCHUP_ID"},ZV={message:"Existing stage",code:"ERR_EXISTING_STAGE"},h5={message:"Existing structure",code:"ERR_EXISTING_STRUCTURE"},oL={message:"Method not found",code:"ERR_NOT_FOUND_METHOD"},Tme={message:"Scheduled matchUps",code:"ERR_SCHEDULED_MATCHUPS"},sL={message:"Scores present",code:"ERR_SCORES_PRESENT"},$je={ANACHRONISM:GV,CANNOT_CHANGE_WINNING_SIDE:i5,CANNOT_MODIFY_TIEFORMAT:t5,CANNOT_MODIFY_PARTICIPANT_TYPE:Wfe,CANNOT_REMOVE_MAIN_STRUCTURE:bfe,CANNOT_REMOVE_PARTICIPANTS:eL,COURT_EXISTS:sme,COURT_NOT_FOUND:LP,DRAW_DEFINITION_NOT_FOUND:_l,DRAW_ID_EXISTS:Tfe,DRAW_POSITION_ACTIVE:YO,DRAW_POSITION_ASSIGNED:PS,DRAW_POSITION_NOT_CLEARED:Sfe,DRAW_POSITION_NOT_FOUND:Cje,DRAW_SIZE_MISMATCH:H4,DUPLICATE_VALUE:yme,ENTRY_STATUS_NOT_ALLOWED_FOR_EVENT:nme,ENTRY_STATUS_NOT_ALLOWED_IN_STAGE:ime,EVENT_EXISTS:_fe,EVENT_NOT_FOUND:kl,EXISTING_DRAW_DEFINITIONS:Ife,EXISTING_END_TIME:o5,EXISTING_FLIGHT:Ime,EXISTING_MATCHUP_ID:Sme,EXISTING_OUTCOME:wme,EXISTING_PARTICIPANT_DRAW_POSITION_ASSIGNMENT:aU,EXISTING_PARTICIPANT:tL,EXISTING_POLICY_TYPE:Q4,EXISTING_PROFILE:p5,EXISTING_ROUND:Nfe,EXISTING_STAGE:ZV,EXISTING_STRUCTURE:h5,INCOMPATIBLE_MATCHUP_STATUS:xN,INCOMPLETE_SOURCE_STRUCTURE:$4,INSUFFICIENT_DRAW_POSITIONS:r5,INVALID_ACTION:Cfe,INVALID_ASSIGNMENT:zV,INVALID_BOOKINGS:f_,INVALID_CATEGORY:m_,INVALID_COLLECTION_DEFINITION:vme,INVALID_CONFIGURATION:gme,INVALID_DATE_AVAILABILITY:ON,INVALID_DATE:Cs,INVALID_DRAW_DEFINITION:_b,INVALID_DRAW_POSITION_FOR_SEEDING:V4,INVALID_DRAW_POSITION:tU,INVALID_DRAW_SIZE:ZO,INVALID_END_TIME:cme,INVALID_ENTRIES:xfe,INVALID_EVENT_TYPE:ng,INVALID_GAME_SCORES:WV,INVALID_GENDER:LN,INVALID_MATCHUP_FORMAT:Y4,INVALID_MATCHUP_STATUS:RS,INVALID_MATCHUP_STATUS_BYE:Ffe,INVALID_MATCHUP:Ws,INVALID_OBJECT:om,INVALID_PARTICIPANT_ID:vp,INVALID_PARTICIPANT_IDS:wu,INVALID_PARTICIPANT_ROLE:Kfe,INVALID_PARTICIPANT_SEEDING:Ufe,INVALID_PARTICIPANT_TYPE:Sd,INVALID_PARTICIPANT:rU,INVALID_POLICY_DEFINITION:Vfe,INVALID_RECORDS:HV,INVALID_SCALE_ITEM:FP,INVALID_SEED_NUMBER:Rfe,INVALID_SEED_POSITION:Mfe,INVALID_SET_NUMBER:Aje,INVALID_SIDE_NUMBER:e5,INVALID_SCORE:qfe,INVALID_STAGE:Ay,INVALID_START_TIME:dme,INVALID_STRUCTURE:tw,INVALID_STOP_TIME:ume,INVALID_TIE_FORMAT:nf,INVALID_TIME:lu,INVALID_TIME_ITEM:s5,INVALID_TOURNAMENT_DATES:zfe,INVALID_TOURNAMENT_RECORD:NP,INVALID_VALUES:Me,INVALID_WINNING_SIDE:QO,MATCHUP_NOT_FOUND:qo,METHOD_NOT_FOUND:oL,MISSING_ASSIGNMENTS:W4,MISSING_ASYNC_STATE_PROVIDER:pme,MISSING_AVOIDANCE_POLICY:$fe,MISSING_COLLECTION_DEFINITION:Bfe,MISSING_COURT_ID:iw,MISSING_COURTS_INFO:ome,MISSING_DATE_AVAILABILITY:Hfe,MISSING_DATE:jfe,MISSING_DRAW_DEFINITION:Lt,MISSING_DRAW_ID:Rd,MISSING_DRAW_POSITION:iU,MISSING_DRAW_POSITIONS:AP,MISSING_DRAW_SIZE:_P,MISSING_ENTRIES:kfe,MISSING_EVENT:_n,MISSING_MATCHUP_FORMAT:Z4,MISSING_MATCHUP_ID:_o,MISSING_MATCHUP_IDS:nU,MISSING_MATCHUP:cl,MISSING_MATCHUPS:Oh,MISSING_PARTICIPANT_COUNT:Jfe,MISSING_PARTICIPANT_ID:Ra,MISSING_PARTICIPANT_IDS:kg,MISSING_PARTICIPANT_ROLE:Yfe,MISSING_PARTICIPANT:nw,MISSING_PARTICIPANTS:OP,MISSING_PENALTY_ID:a5,MISSING_PENALTY_TYPE:ame,MISSING_PERSON_DETAILS:eme,MISSING_POLICY_ATTRIBUTES:J4,MISSING_POLICY_DEFINITION:XO,MISSING_POLICY_TYPE:X4,MISSING_POSITION_ASSIGNMENTS:Lfe,MISSING_ROUND_NUMBER:Pje,MISSING_SCHEDULE:hme,MISSING_SCORING_POLICY:Nje,MISSING_SEED_ASSIGNMENTS:Pfe,MISSING_SEEDCOUNT_THRESHOLDS:Efe,MISSING_SEEDING_POLICY:Rje,MISSING_SET_NUMBER:_je,MISSING_SET_OBJECT:JO,MISSING_SIDE_NUMBER:kje,MISSING_STAGE:K4,MISSING_STRUCTURE_ID:lc,MISSING_STRUCTURE:_g,MISSING_STRUCTURES:q4,MISSING_TARGET_LINK:z4,MISSING_TIE_FORMAT:xP,MISSING_TIME_ITEM:l5,MISSING_TIME_ITEMS:c5,MISSING_TOURNAMENT_ID:CS,MISSING_TOURNAMENT_RECORD:it,MISSING_TOURNAMENT_RECORDS:_r,MISSING_VALUE:Ht,MISSING_VENUE_ID:xg,MODIFICATIONS_FAILED:fme,NO_CANDIDATES:nL,NO_DRAW_POSITIONS_AVAILABLE_FOR_QUALIFIERS:rme,NO_MODIFICATIONS_APPLIED:sU,NO_STAGE_SPACE_AVAILABLE_FOR_ENTRY_STATUS:YV,NO_PARTICIPANT_REMOVED:Xfe,NO_VALID_ACTIONS:bme,NO_VALID_ATTRIBUTES:rL,NO_VALID_DATES:Gfe,NOT_FOUND:Wo,NOT_IMPLEMENTED:aL,PARTICIPANT_COUNT_EXCEEDS_DRAW_SIZE:n5,PARTICIPANT_ID_EXISTS:Zfe,PARTICIPANT_NOT_CHECKED_IN:Qfe,PARTICIPANT_NOT_FOUND:Jr,PARTICIPANT_PAIR_EXISTS:Oje,PENALTY_NOT_FOUND:NS,POLICY_NOT_ATTACHED:Mje,POLICY_NOT_FOUND:MS,SCHEDULE_NOT_CLEARED:wfe,SCHEDULED_MATCHUPS:Tme,SCORES_PRESENT:sL,SEEDSCOUNT_GREATER_THAN_DRAW_SIZE:Dfe,STAGE_SEQUENCE_LIMIT:Ofe,STRUCTURE_NOT_FOUND:Dr,TEAM_NOT_FOUND:u5,UNABLE_TO_ASSIGN_COURT:mme,UNLINKED_STRUCTURES:Afe,UNRECOGNIZED_DRAW_TYPE:j4,UNRECOGNIZED_MATCHUP_FORMAT:kP,UNRECOGNIZED_MATCHUP_STATUS:qV,VALUE_UNCHANGED:d5,VENUE_EXISTS:lme},br={disableNotifications:!1,tournamentId:void 0,tournamentRecords:{},subscriptions:{},modified:!1,methods:{},notices:[]},Ume={addNotice:Jje,callListener:nGe,cycleMutationStatus:Xje,deleteNotice:tGe,deleteNotices:eGe,disableNotifications:Vje,enableNotifications:jje,getMethods:f5,getNotices:Qje,getTopics:iGe,getTournamentId:Dme,getTournamentRecord:Gje,getTournamentRecords:Hje,removeTournamentRecord:Kje,setMethods:Zje,setSubscriptions:Yje,setTournamentId:qje,setTournamentRecord:zje,setTournamentRecords:Wje,handleCaughtError:rGe};function Vje(){br.disableNotifications=!0}function jje(){br.disableNotifications=!1}function Dme(){return br.tournamentId}function Gje(t){return br.tournamentRecords[t]}function Hje(){return br.tournamentRecords}function zje(t){let e=t==null?void 0:t.tournamentId;return e?(br.tournamentRecords[e]=t,{success:!0}):{error:NP}}function qje(t){return t?br.tournamentRecords[t]?(br.tournamentId=t,{success:!0}):{error:it}:(br.tournamentId=void 0,{success:!0})}function Wje(t){br.tournamentRecords=t;let e=Object.keys(t);e.length===1?br.tournamentId=e[0]:e.length||(br.tournamentId=void 0)}function Kje(t){if(typeof t!="string")return{error:Me};if(!br.tournamentRecords[t])return{error:Wo};delete br.tournamentRecords[t];let e=Object.keys(br.tournamentRecords);return e.length===1?br.tournamentId=e[0]:e.length||(br.tournamentId=void 0),{success:!0}}function Yje(t){return typeof t.subscriptions!="object"?{error:Me}:(Object.keys(t.subscriptions).forEach(e=>{br.subscriptions[e]=t.subscriptions[e]}),{...ue})}function Zje(t){return typeof t!="object"?{error:Me}:(Object.keys(t).forEach(e=>{typeof t[e]=="function"&&(br.methods[e]=t[e])}),{...ue})}function Xje(){let t=br.modified;return br.modified=!1,t}function Jje({topic:t,payload:e,key:i},n){if(!(typeof t!="string"||typeof e!="object")&&(br.disableNotifications||(br.modified=!0),!(br.disableNotifications||!br.subscriptions[t]&&!n)))return i&&(br.notices=br.notices.filter(r=>!(r.topic===t&&r.key===i))),br.notices.push({topic:t,payload:e,key:i}),{...ue}}function f5(){return br.methods??{}}function Qje({topic:t}){return br.notices.filter(e=>e.topic===t).map(e=>e.payload)}function eGe(){br.notices=[]}function tGe({topic:t,key:e}){br.notices=br.notices.filter(i=>(!t||i.topic===t)&&i.key!==e)}function iGe(){return{topics:Object.keys(br.subscriptions)}}function nGe({topic:t,notices:e},i){let n=br.subscriptions[t];n&&typeof n=="function"&&n(e);let r=i==null?void 0:i[t];r&&typeof r=="function"&&r(e)}function rGe({engineName:t,methodName:e,params:i,err:n}){let r;return typeof n=="string"?r=n.toUpperCase():n instanceof Error&&(r=n.message),console.log("ERROR",{tournamentId:Dme(),params:JSON.stringify(i),engine:t,methodName:e,error:r}),{error:r}}function va(t,e){return(t??0)-(e??0)}function ai(t){return typeof t=="number"?parseInt(t.toString()):typeof t=="string"?parseInt(t):0}function Td(t){return isNaN(t)?!1:t&&(t&t-1)===0}function _Z(t){if(!t.length)return;let e=[...t].sort(va),i=Math.floor(e.length/2);return e.length%2?e[i]:(e[i-1]+e[i])/2}function aGe(t){if(!Td(t))return!1;let e=t,i=1;for(;e!==2;)i+=1,e=e/2;return i}function m5(t){return isNaN(t)?0:t%2&&t+1||t}function g5(t){return Math.pow(2,Math.round(Math.log(t)/Math.log(2)))}function Lr(t){return!isNaN(parseFloat(t))}function Eme(t){let e=ai(t);if(!isNaN(e))return e===0?!1:(e&-e)===1}function lU(t){if(isNaN(t))return!1;for(;!Td(t);)t++;return t}function Ic(t,e){return t=Math.ceil(t),e=Math.floor(e),Math.floor(Math.random()*(e-t+1))+t}function bi(t){return Number.isSafeInteger(typeof t=="string"?+t:t)}function oGe(t=1,e=3,i=!0){let n=0;for(let r=0;r<e;r++)n+=Math.random()*(t/e);return i&&t>1?Math.round(n):n}function sGe(t,e){e||(e=1);let i=1/e;return Math.round(t*i)/i}function Cme(t,e,i,n,r=2){let a=1-Math.random(),o=1-Math.random(),s=Math.sqrt(-2*Math.log(a))*Math.cos(2*Math.PI*o);return s=s/10+.5,s>1||s<0?s=Cme(t,e,i):(s=Math.pow(s,i),s*=e-t,s+=t),n&&(s=sGe(s,n)),parseFloat(s.toFixed(r))}function ki(t){return Array.isArray(t)?t==null?void 0:t.filter((e,i,n)=>n.lastIndexOf(e)===i):[]}function lGe(t){return Array.isArray(t)?t==null?void 0:t.map(e=>e===null?void 0:e):t}function vs(t){return Array.isArray(t)?t.map(e=>[Math.random(),e]).sort((e,i)=>e[0]-i[0]).map(e=>e[1]):[]}function AS(t){return bi(t)?t:1/0}function xl(t){return Array.isArray(t)?t.reduce((e,i)=>(e[i]||(e[i]=0),e[i]++,e),{}):{}}function cGe(t){return Pme(xl(t))}function Pme(t){return Object.keys(t).reduce((e,i)=>{let n=t[i];return e[n]?e[n].push(i):e[n]=[i],e},{})}function uGe(t,e,i){return i.indexOf(t)===e}function Rme(t){return t.filter(uGe)}function Tl(t){return Array.isArray(t)&&t.length?t.splice(Math.floor(Math.random()*t.length),1)[0]:void 0}function mu(t){let e=Math.floor(Math.random()*t.length);return t[e]}function Ct(t,e){return Array.from({length:e-t},(i,n)=>n+t)}function np(t,e){return e.reduce((i,n,r)=>(n===t&&i.push(r),i),[])}function Wr(t,e){return!Array.isArray(t)||!Array.isArray(e)?[]:t.filter(i=>e.indexOf(i)!==-1).filter((i,n,r)=>r.indexOf(i)===n)}function kZ(t,e){return!Array.isArray(t)||!Array.isArray(e)?[]:t.filter(i=>!e.includes(i))}function Ps(t,e){return!Array.isArray(t)||!Array.isArray(e)?!1:t.some(i=>e.includes(i))}function dGe(t,e){return Array.isArray(e)&&e.reduce((i,n)=>(i[n]=1+i[n]||1,i),{})[t]||0}function pGe(t,e,i,n){return Array.isArray(t)?[].concat(...t.slice(0,e),...t.slice(e,e+i).sort(n),...t.slice(e+i,t.length)):[]}function so(t,e){return Array.isArray(t)?t.reduce((i,n,r)=>{let a=Math.floor(r/e);return i[a]=[].concat(i[a]||[],n),i},[]):[]}function Mme(t,[e,...i]){return t.length?[t.slice(0,e),...Mme(t.slice(e),[...i,e])]:[]}function hGe(t){return t.reduce((e,i)=>{let n=e[e.length-1];return(!n||n[n.length-1]!==i-1)&&e.push([]),e[e.length-1].push(i),e},[])}function Nme(t){return Array.isArray(t)?t.reduce((e,i)=>!isNaN(parseInt(i))&&e,!0):!1}function Ame(t){return Array.isArray(t)?t.reduce((e,i)=>isNaN(parseInt(i))&&e,!0):!1}function XV(t,e,i){return Array.isArray(t)?t.reduce((n,r,a)=>{let o=i?!!(Math.floor(a/e)%2):!1,s=a%e,l=o?e-1-s:s;return n[l]||(n[l]=[]),n[l].push(r),n},[]):[]}function fGe(t,e=1){if(!Array.isArray(t)||!t.every(bi))return[];let i=Math.min(...t,e),n=Math.max(...t);return Ct(i,n+1).filter(r=>!t.includes(r))}var $n={timers:{default:{elapsedTime:0}},globalSubscriptions:{},deepCopyAttributes:{stringify:[],ignore:[],toJSON:[]},globalMethods:[],deepCopy:!0},lo=Ume,xZ=["addNotice","callListener","cycleMutationStatus","deleteNotice","deleteNotices","disableNotifications","enableNotifications","getMethods","getNotices","getTopics","getTournamentId","getTournamentRecord","getTournamentRecords","removeTournamentRecord","setSubscriptions","setTournamentId","setTournamentRecord","setTournamentRecords"];function mGe(t){if(typeof t!="object")throw new Error("Global state provider can not be undefined or null");if(Wr(Object.keys(t),xZ).length!==xZ.length)throw new Error("Global state provider is missing required methods");return lo=t,{success:!0}}function gGe(){if(lo.createInstanceState){try{lo.createInstanceState()}catch(t){return{error:t}}return{success:!0}}else return{error:pme}}function jc(t){return!t||typeof t!="object"?$n.devContext??!1:typeof $n.devContext!="object"?!1:Object.keys(t).every(e=>{var i;return((i=$n.devContext)==null?void 0:i[e])===t[e]})&&$n.devContext}function vGe(t="reset",e="default"){var i,n;let r=Date.now();if(t==="report"){if(e==="allTimers")return Object.keys($n.timers).filter(a=>a!=="default"||$n.timers[a].startTime).map(a=>{let o=$n.timers[a],s=o.state==="stopped"?0:(r-((o==null?void 0:o.startTime)??0))/1e3,l=o.elapsedTime+s;return{state:$n.timers[a].state,elapsedTime:l.toFixed(2),timer:a}});{let a=$n.timers[e].state==="stopped"?0:(r-(((i=$n.timers[e])==null?void 0:i.startTime)??0))/1e3,o=$n.timers[e].elapsedTime+a;return{state:$n.timers[e].state,elapsedTime:o.toFixed(2),timer:e}}}if(!$n.timers[e]||t==="reset"){if(e==="allTimers")return $n.timers={default:{elapsedTime:0}},!0;$n.timers[e]={startTime:r,state:"active",elapsedTime:0}}return $n.timers[e].elapsedTime||($n.timers[e].elapsedTime=0),t==="stop"&&$n.timers[e].state!=="stopped"&&($n.timers[e].state="stopped")&&($n.timers[e].elapsedTime+=(r-(((n=$n.timers[e])==null?void 0:n.startTime)??0))/1e3),t==="start"&&($n.timers[e].startTime=r)&&($n.timers[e].state="active"),$n.timers[e]}function _me(t){wl(t)?$n.globalLog=t:delete $n.globalLog}function oE(t){$n.devContext=t}function kme(){lo.disableNotifications()}function FN(){lo.enableNotifications()}function sE(t,e){typeof t=="boolean"&&($n.deepCopy=t),typeof e=="object"&&(Array.isArray(e.ignore)&&($n.deepCopyAttributes.ignore=e.ignore),Array.isArray(e.toJSON)&&($n.deepCopyAttributes.toJSON=e.toJSON),Array.isArray(e.stringify)&&($n.deepCopyAttributes.stringify=e.stringify),e.threshold&&($n.deepCopyAttributes.threshold=e.threshold))}function v5(){return{enabled:$n.deepCopy,...$n.deepCopyAttributes}}function yGe(t){return t!=null&&t.subscriptions?(Object.keys(t.subscriptions).forEach(e=>{$n.globalSubscriptions[e]=t.subscriptions[e]}),{...ue}):{error:Ht,info:"missing subscriptions"}}function bGe(t){return t!=null&&t.subscriptions?lo.setSubscriptions({subscriptions:t.subscriptions}):{error:Ht,info:"missing subscriptions"}}function xme(t){return t?typeof t!="object"?{error:Me}:(Object.keys(t).forEach(e=>{wl(t[e])&&($n.globalMethods[e]=t[e])}),{...ue}):{error:Ht,info:"missing method declarations"}}function Ome(t){return t?typeof t!="object"?{error:Me}:lo.setMethods(t):{error:Ht,info:"missing method declarations"}}function y5(){return lo.cycleMutationStatus()}function tn(t){if(typeof(t==null?void 0:t.topic)!="string")return;let e=$n.globalSubscriptions[t.topic];return lo.addNotice(t,e)}function Lme(){return{...$n.globalMethods,...lo.getMethods()}}function Fme(t){return lo.getNotices(t)}function b5({key:t,topic:e}){return lo.deleteNotice({key:t,topic:e})}function BP(){return lo.deleteNotices()}function Gu(){return lo.getTopics()}async function JV(t){return lo.callListener(t,$n.globalSubscriptions)}function rw(){return lo.getTournamentId()}function I5(t){return lo.getTournamentRecord(t)}function aw(){return lo.getTournamentRecords()}function Bme(t){return lo.setTournamentRecord(t)}function lL(t){return lo.setTournamentRecords(t)}function lE(t){return lo.setTournamentId(t)}function $me(t){return lo.removeTournamentRecord(t)}function QV(){return lo}function cL({engineName:t,methodName:e,params:i,err:n}){return(wl(lo.handleCaughtError)&&lo.handleCaughtError||Ume.handleCaughtError)({engineName:t,methodName:e,params:i,err:n})}function Vme(t,e){if($n.globalLog)try{$n.globalLog({log:t,engine:e})}catch(i){console.log("globalLog error",i),console.log(e,t),_me()}else console.log(e,t)}function jme(t,e,i,n){if(!sr(t))return{error:Me};Lr||(i=1);let r=Array.isArray(e)?e:[],a={},o=(s,l=0)=>{Object.keys(s).forEach(c=>{wl(s[c])?a[c]=s[c]:sr(s[c])&&(e===!0||r!=null&&r.includes(c))&&(i===void 0||l<i)&&o(s[c],l+1)})};return o(t),n?xme(a):Ome(a),{methods:a}}function IGe(t,e,i){return Object.keys(t).filter(n=>!e.includes(t[n])&&(!i||(Array.isArray(t[n])?t[n].length:!0)))}function qt(t,e,i,n){var r;if(typeof t!="object"||t===null)return t;(r=v5())!=null&&r.enabled||(n=!0);let a=["",void 0,null];e&&a.push(!1);let o=IGe(t,a,i);return Object.assign({},...o.map(s=>Array.isArray(t[s])?{[s]:n?t[s]:t[s].map(l=>qt(l))}:{[s]:n?t[s]:qt(t[s])}))}function fe({context:t,result:e,stack:i,info:n}){return e&&!Array.isArray(e==null?void 0:e.stack)&&(e.stack=[]),e&&Array.isArray(e==null?void 0:e.stack)&&typeof i=="string"&&e.stack.push(i),e&&n&&(e.info=n),e&&typeof t=="object"&&Object.keys(t).length&&Object.assign(e,qt(t)),e&&!(e!=null&&e.error)&&!(e!=null&&e.success)&&Object.assign(e,{...ue}),e??{success:!0}}var Ko="tournamentRecords",w5="policyDefinitions",Lh="tournamentRecord",Md="drawDefinition",S5="matchUpFormat",wh="participantId",Gme="scheduleDates",wGe="tournamentId",SGe="scheduleDate",T5="structureId",U5="participant",$P="matchUpIds",TGe="policyType",Hme="structures",_y="matchUpId",D5="inContext",E5="structure",uL="courtIds",UGe="personId",dL="venueIds",zme="matchUps",qme="courtId",Wme="eventId",Og="matchUp",Kme="drawId",kb="error",cU="event",VP="param",DGe="uuids",EGe="averageMatchUpMinutes",CGe="recoveryMinutes",PGe="periodLength",RGe="number",Xh="object",bl="array",nd="_validate",Yme="_message",Sh="_invalid",Lg="_ofType",C5="_anyOf",cE="_oneOf",MGe={[Ko]:_r,[Lh]:it,[w5]:XO,[Md]:Lt,[wh]:Ra,[S5]:Z4,[wGe]:CS,[T5]:lc,[$P]:nU,[U5]:nw,[Hme]:q4,[_y]:_o,[E5]:_g,[qme]:iw,[zme]:Oh,[Wme]:kl,[Og]:cl,[uL]:Ht,[dL]:Ht,[Kme]:Rd,[cU]:_n},NGe={[Ko]:Xh,[w5]:Xh,[Lh]:Xh,[Md]:Xh,[Gme]:bl,[U5]:Xh,[$P]:bl,[Hme]:bl,[E5]:Xh,[uL]:bl,[dL]:bl,[zme]:bl,[Og]:Xh,[cU]:Xh,[DGe]:bl};function mn(t,e,i){if(!t&&!sr(t))return{error:Me};if(!(e!=null&&e.length)||t!=null&&t._bypassParamCheck)return{valid:!0};if(!Array.isArray(e))return{error:Me};let{paramError:n,errorParam:r}=kGe(t,e);if(!n)return{valid:!0};let a=(t==null?void 0:t[r])===void 0?MGe[r]||Me:n[nd]&&n[Sh]||Me,o=r??(n[cE]&&Object.keys(n[cE]).join(", "));return fe({info:{param:o,message:n[Yme]},result:{error:a},stack:i})}function Zme(t,e){let i=Object.keys(t),n=Object.keys(e);return Wr(i,n)}function AGe(t,e){if(!e)return;let i=Zme(t,e);return i.length!==1?{error:Me}:i.reduce((n,r)=>({...n,[r]:!0}),{})}function _Ge(t,e){if(!e)return;let i=Zme(t,e).filter(n=>t[n]);return i.length<1?{error:Me}:i.reduce((n,r)=>({...n,[r]:!0}),{})}function kGe(t,e){let i,n;return{paramError:e.find(({_ofType:r,_oneOf:a,_anyOf:o,_validate:s,_info:l,...c})=>{let u=a&&AGe(t,a);if(u!=null&&u.error)return u.error;u&&Object.assign(c,u);let d=o&&_Ge(t,o);if(d!=null&&d.error)return d.error;d&&Object.assign(c,d);let p=Object.keys(c).filter(f=>typeof c[f]=="boolean"),h=p.find(f=>{let m=s&&!wl(s),g=t[f]&&!s&&xGe(t,f,r),v=c[f]&&!t[f],y=m||g||v||s&&t[f]&&!OGe(t[f],s);return y&&(i=f,n=l),y});return!p.length||h}),errorParam:i,paramInfo:n}}function xGe(t,e,i){return i=i||NGe[e]||"string",i==="array"?!Array.isArray(t[e]):typeof t[e]!==i}function OGe(t,e){return wl(e)?e(t):!0}var Xme="DYNAMIC",rg="RANKING",Av="RATING",oI="SCALE",ah="SEEDING",LGe={RANKING:rg,RATING:Av,SCALE:oI,SEEDING:ah};function uU(t){var e;let i=mn(t,[{[U5]:!0}]);if(i.error)return i;let n=(e=t.participant.timeItems)==null?void 0:e.filter(({itemType:a})=>(a==null?void 0:a.startsWith(oI))&&[rg,Av,ah].includes(a.split(".")[1])),r={ratings:{},rankings:{},seedings:{}};if(n!=null&&n.length){let a=s=>n.filter(l=>(l==null?void 0:l.itemType)===s).sort((l,c)=>new Date(l.createdAt||void 0).getTime()-new Date(c.createdAt||void 0).getTime()).pop(),o=ki(n.map(({itemType:s})=>s));for(let s of o){let l=a(s);if(l){let[,c,u,d,p]=l.itemType.split("."),h=p?`${d}.${p}`:d,f=c===ah&&"seedings"||c===rg&&"rankings"||"ratings";r[f][u]||(r[f][u]=[]),r[f][u].push({scaleValue:l.itemValue,scaleDate:l.itemDate,scaleName:h})}}}return{...ue,...r}}function sI(t){if(t===null)return{};let{source:e,template:i}=t||{};if(!i)return e;let n={};return r(e,i,n),n;function r(a,o,s){if(!a||!o)return;let l=Object.keys(a),c=Object.keys(o),u=Object.assign({},...c.filter(h=>h.indexOf("||")).map(h=>h.split("||").map(f=>({[f]:h}))).flat()),d=c.concat(...Object.keys(u)),p=d.includes("*");for(let h of l)if(d.indexOf(h)>=0||p){let f=u[h]||h,m=o[f]||p,g=a[h];if(typeof m=="object"&&typeof g!="function"&&!Array.isArray(m))if(Array.isArray(g)){let v=g.map(y=>{let b={};return r(y,m,b)!==!1?b:void 0}).filter(Boolean);s[h]=v}else g&&(s[h]={},r(g,m,s[h]));else{let v=a[h];if(Array.isArray(m)&&!m.includes(v))return!1;(o[h]||p&&o[h]!==!1)&&(s[h]=v)}}}}var g_=/^[\d]{4}-(0[1-9]|1[0-2])-(0[1-9]|[1-2][\d]|3[0-1])$/,Jme=/^((0[\d]|1[\d]|2[0-3]):[0-5][\d](:[0-5][\d])?)([.,][0-9]{3})?$/,Th=/^([\d]{4}-(0[1-9]|1[0-2])-(0[1-9]|[1-2][\d]|3[0-1]))([ T](0[\d]|1[\d]|2[0-3]):[0-5][\d](:[0-5][\d])?)?([.,][\d]{3})?Z?$/,Tv=/^([\d]{4}-(0[1-9]|1[0-2])-(0[1-9]|[1-2][\d]|3[0-1]))?([ T]?(0[\d]|1[\d]|2[0-3]):[0-5][\d](:[0-5][\d])?)?([.,][\d]{3})?Z?$/;function v_(t){let{scheduledDate:e}=t;if(!e&&t.scheduledTime&&(e=Ci(t.scheduledTime)),!e)return;let i=rr(t.scheduledTime),n=Ci(e);return n&&i&&(n+=`T${i}`),n}function FGe(t){return typeof t!="object"||Array.isArray(t)?!1:Object.prototype.toString.call(t)==="[object Date]"}function dU(t){let e=typeof t=="string"?t==null?void 0:t.split(" "):[];return t&&(e==null?void 0:e.length)>1&&!["AM","PM"].includes(e[1].toUpperCase())?!1:!!(!t||Tv.test(ow(t,!0,!0)))}function Kl(t){return ey(t)||g_.test(t)}function BGe(t){let e=new Date(t),i=e.getSeconds()+60*e.getMinutes()+60*60*e.getHours();return $Ge(i,{displaySeconds:!1})}function $Ge(t,e){let i=parseInt(t,10),n=Math.floor(i/3600),r=Math.floor((i-n*3600)/60),a=i-n*3600-r*60;return(!e||e!=null&&e.displaySeconds?n+":"+r+":"+a:n+":"+r).split(":").map(Dc).join(":")}var P5=t=>{let e=uE(t)||ey(t)?new Date(t):new Date,i=e.getUTCMonth()+1,n=i<10?`0${i}`:`${i}`;return`${e.getUTCFullYear()}-${Dc(n)}-${Dc(e.getUTCDate())}`};function VGe(t){let e=uE(t)||ey(t)?new Date(t):new Date;return Date.UTC(e.getFullYear(),e.getMonth(),e.getDate())}function fd(t,e="-",i="YMD"){if(!t)return"";typeof t=="string"&&t.indexOf("T")<0&&(t=t+"T00:00");let n=new Date(t),r=""+(n.getMonth()+1),a=""+n.getDate(),o=n.getFullYear();return r.length<2&&(r="0"+r),a.length<2&&(a="0"+a),i==="DMY"?[a,r,o].join(e):i==="MDY"?[r,a,o].join(e):i==="YDM"?[o,a,r].join(e):i==="DYM"?[a,o,r].join(e):i==="MYD"?[r,o,a].join(e):[o,r,a].join(e)}function y_(t){let e=t?new Date(t):new Date,i=e.getTimezoneOffset();return new Date(e.getTime()-i*60*1e3)}function jGe(t){return y_(t).getTime()}function uE(t){if(typeof t=="boolean")return!1;let e=t instanceof Date&&t||!isNaN(t)&&new Date(t)||!1;return e&&!isNaN(e.valueOf())}function _S(t,e){if(!Kl(t)||!Kl(e))return[];let i=Ci(t)+"T00:00",n=Ci(e)+"T00:00",r=new Date(i),a=new Date(n),o=uE(a)&&uE(r)&&c(r,a),s=[],l=0;if(o){let u=r,d=u.getTime();for(;d<=a.getTime()&&l<300;)l+=1,s.push(new Date(u)),d=u.setDate(u.getDate()+1)}return s.map(u=>fd(u));function c(u,d){return u<=d}}var GGe=/^([+-]?\d{4}(?!\d{2}\b))((-?)((0[1-9]|1[0-2])(\3([12]\d|0[1-9]|3[01]))?|W([0-4]\d|5[0-2])(-?[1-7])?|(00[1-9]|0[1-9]\d|[12]\d{2}|3([0-5]\d|6[1-6])))([T\s]((([01]\d|2[0-3])((:?)[0-5]\d)?|24:?00)([.,]\d+(?!:))?)?(\17[0-5]\d([.,]\d+)?)?([zZ]|([+-])([01]\d|2[0-3]):?([0-5]\d)?)?)?)?$/;function ey(t){return typeof t!="string"?!1:GGe.test(t)}function R5(t){if(typeof t!="string")return!1;let e=t.split("Z")[0].split(":"),i=e.every(n=>!isNaN(parseInt(n)));return!(e.length<2||!i||parseInt(e[0])>23||parseInt(e[1])>60)}function on(t){let e=rr(t);if(!e)return 0;let[i,n]=e.split(":").map(r=>parseInt(r));return i*60+n}function HGe(t){let e=Math.floor(t/60),i=t-e*60;return e>23&&(e=e%24),[Dc(e),Dc(i)].join(":")}function b_(t){return R5(t)?t.split(":").slice(0,2).map(Dc).join(":"):void 0}function rr(t){return ey(t)&&t.indexOf("T")>0?b_(t.split("T").reverse()[0]):b_(t)}function Ci(t){return ey(t)||Th.test(t)?t.split("T")[0]:void 0}function I1(t,e){let i=new Date(t);return i.setDate(i.getDate()+e),Ci(i.toISOString())}function I_(t){t=typeof t!="string"?"00:00":t;let e={},i={};return{0:e.time,1:e.ampm}=t.split(" ")||[],{0:i.hours,1:i.minutes}=e.time.split(":")||[],i.ampm=e.ampm,isNaN(i.hours)||isNaN(i.minutes)||i.ampm&&!["AM","PM"].includes(i.ampm.toUpperCase())?{}:i}function zGe(t){let e=I_(t);return e.ampm&&e.hours&&(e.ampm.toLowerCase()==="pm"&&parseInt(e.hours)<12&&(e.hours=(e.hours&&parseInt(e.hours)||0)+12),e.ampm.toLowerCase()==="am"&&e.hours==="12"&&(e.hours="00")),`${e.hours||"12"}:${e.minutes||"00"}`.split(":").map(Dc).join(":")}function qGe(t){var e;let i=I_(t);if(!(typeof i=="object"&&!Object.keys(i).length))return i.ampm?t:(i.hours>12?(i.hours-=12,i.ampm="PM"):i.hours==="12"?i.ampm="PM":(i.hours==="00"&&(i.hours="12"),i.ampm="AM"),((e=i.hours)==null?void 0:e[0])==="0"&&(i.hours=i.hours.slice(1)),`${i.hours||"12"}:${i.minutes||"00"} ${i.ampm}`)}function ow(t,e,i){let n=Ci(t),r=rr(t),a=n?r:t;return t?e&&(n&&i&&t||zGe(a))||qGe(a):void 0}function Qme(t,e){let i=I_(t),n=I_(e);if(parseInt(i.hours)<parseInt(n.hours))return-1;if(parseInt(i.hours)>parseInt(n.hours))return 1;if(i.hours===n.hours){if(parseInt(i.minutes)<parseInt(n.minutes))return-1;if(parseInt(i.minutes)>parseInt(n.minutes))return 1}return 0}function ege(t,e=7){let i=Ci(t)+"T00:00",n=new Date(i),r=new Date(n.setDate(n.getDate()+e));return fd(r)}function WGe(t){return ege(t)}function KGe(t,e,i,n=!1){let r=new Date(e,0,1+(t-1)*7),a=n?0:1;return r.setDate(r.getDate()+(a-r.getDay())),fd(r,i)}function YGe(t,e,i){let n=new Date(t,0);return fd(new Date(n.setDate(e)),i)}function ca(t,e=void 0){let[i,n]=(t||"00:00").split(":").map(Dc),r=y_(e).setHours(i,n,0,0);return y_(r)}function jP(t,e,i=!0){let n=new Date(t),r=(new Date(e).getTime()-n.getTime())/1e3/60;return i?Math.abs(Math.round(r)):Math.round(r)}function il(t,e){let i=rr(t);if(!i)return"00:00";let n=isNaN(e)?0:e;return rr(M5(ca(i),n).toISOString())}function M5(t,e){let i=new Date(t);return new Date(i.getTime()+e*6e4)}function Dc(t){return t.toString()[1]?t:"0"+t}function Uh(t,e){let i=new Date(t),n=new Date(e);return i.getFullYear()===n.getFullYear()&&i.getMonth()===n.getMonth()&&i.getDate()===n.getDate()}var ZGe={addDays:ege,addWeek:WGe,addMinutesToTimeString:il,convertTime:ow,getIsoDateString:v_,getUTCdateString:P5,DateHHMM:BGe,extractDate:Ci,extractTime:rr,formatDate:fd,getDateByWeek:KGe,isISODateString:ey,isDate:uE,isTimeString:R5,offsetDate:y_,offsetTime:jGe,sameDay:Uh,timeStringMinutes:on,timeToDate:ca,timeUTC:VGe,validTimeValue:dU,validDateString:g_,timeValidation:Tv,dateValidation:Th};function $t(t,e,i,n,r=0){if(QV().makeDeepCopy)return QV().makeDeepCopy(t,e,i,n);let a=v5(),{stringify:o,toJSON:s,ignore:l,modulate:c}=a||{};if(!(a!=null&&a.enabled)&&!i||typeof t!="object"||wl(t)||t===null||typeof(a==null?void 0:a.threshold)=="number"&&r>=a.threshold)return t;let u=Array.isArray(t)?[]:{},d=Object.keys(t).filter(h=>!i||!l||Array.isArray(l)&&!l.includes(h)||wl(l)&&!l(h)),p=(h,f)=>{u[h]=wl(f==null?void 0:f.toString)?f.toString():JSON.stringify(f)};for(let h of d){let f=t[h],m=wl(c)?c(f):void 0;if(m!==void 0)u[h]=m;else if(e&&h==="extensions"&&Array.isArray(f)){let g=N5(f);Object.assign(u,...g)}else n&&h==="extensions"?u[h]=[]:Array.isArray(o)&&o.includes(h)?p(h,f):Array.isArray(s)&&s.includes(h)&&wl(f==null?void 0:f.toJSON)?u[h]=f.toJSON():f===null?u[h]=void 0:FGe(f)?u[h]=new Date(f).toISOString():u[h]=$t(f,e,i,n,r+1)}return u}function N5(t){return t==null?void 0:t.map(e=>{let{name:i,value:n}=e;return i&&n&&{[`_${i}`]:n}}).filter(Boolean)}var ej="voluntaryConsolation",uf="competitiveBands",A5="roundRobinTally",xf="positionActions",eo="matchUpActions",BN="rankingPoints",kS="roundNaming",pU="participant",dE="progression",Fg="scheduling",pE="avoidance",XGe="display",Dh="scoring",du="seeding",xS="feedIn",JGe="audit",w_="draws",QGe={POLICY_TYPE_VOLUNTARY_CONSOLATION:ej,POLICY_TYPE_COMPETITIVE_BANDS:uf,POLICY_TYPE_ROUND_ROBIN_TALLY:A5,POLICY_TYPE_POSITION_ACTIONS:xf,POLICY_TYPE_MATCHUP_ACTIONS:eo,POLICY_TYPE_RANKING_POINTS:BN,POLICY_TYPE_ROUND_NAMING:kS,POLICY_TYPE_PARTICIPANT:pU,POLICY_TYPE_PROGRESSION:dE,POLICY_TYPE_SCHEDULING:Fg,POLICY_TYPE_AVOIDANCE:pE,POLICY_TYPE_DISPLAY:XGe,POLICY_TYPE_FEED_IN:xS,POLICY_TYPE_SCORING:Dh,POLICY_TYPE_SEEDING:du,POLICY_TYPE_AUDIT:JGe,POLICY_TYPE_DRAWS:w_};function ag({tournamentParticipants:t=[],policyDefinitions:e={},contextProfile:i,participantId:n,internalUse:r,personId:a}){let o=t.find(l=>n&&l.participantId===n||a&&l.person&&l.person.personId===a),s=$t(o,!1,r);if(s){let l=e==null?void 0:e[pU];if(i!=null&&i.withScaleValues){let{ratings:c,rankings:u}=uU({participant:s});s.rankings=u,s.ratings=c}if(l!=null&&l.participant)return sI({template:l.participant,source:s})}return s}var _5="element required",eHe="missing name";function Ss(t){if(!t||typeof t!="object")return{error:Ht};if(t.element&&typeof(t==null?void 0:t.element)!="object")return{error:Me};if(!(t!=null&&t.name))return{error:Ht,info:eHe};if(!(t!=null&&t.element)){if(t.discover&&t.tournamentRecords){for(let e of Object.keys(t.tournamentRecords)){let i=t.tournamentRecords[e],n=Ss({element:i,name:t.name});if(n.error)return fe({result:n,stack:"removeExtension"})}return{...ue}}return{error:Ht,info:_5}}return t!=null&&t.element.extensions?(t.element.extensions=t.element.extensions.filter(e=>(e==null?void 0:e.name)!==t.name),{...ue}):{...ue,info:Wo}}function yp({requiredAttributes:t=["name","value"],extension:e}){if(!e||typeof e!="object"||typeof e.name!="string")return!1;let i=Object.keys(e);return t.filter(n=>i.includes(n)).length===t.length}function un(t){if(typeof t!="object")return{error:Ht};let e="addExtension";if(t!=null&&t.element&&typeof t.element!="object")return fe({result:{error:Me},stack:e});if(!yp({extension:t.extension}))return fe({result:{error:Me,info:"invalid extension"},stack:e});if(!t.element)if(t.discover&&!t.tournamentId&&t.tournamentRecords){for(let n of Object.values(t.tournamentRecords)){let r=un({extension:t.extension,element:n});if(r.error)return fe({result:r,stack:e})}return{...ue}}else return fe({result:{error:Ht},stack:e});if(t.element.extensions||(t.element.extensions=[]),(t==null?void 0:t.creationTime)??!0){let n=new Date().toISOString();Object.assign(t.extension,{createdAt:n})}let i=t.element.extensions.find(({name:n})=>n===t.extension.name);return i?i.value=t.extension.value:t.extension.value&&t.element.extensions.push(t.extension),{...ue}}function k5(t){return!t||typeof t!="object"?{error:Ht}:t.tournamentRecord?un({creationTime:t.creationTime,element:t.tournamentRecord,extension:t.extension}):{error:it}}function pL(t){return!t||typeof t!="object"?{error:Ht}:t.drawDefinition?un({creationTime:t.creationTime,element:t.drawDefinition,extension:t.extension}):{error:_l}}function Bg(t){return!t||typeof t!="object"?{error:Ht}:t.event?un({creationTime:t.creationTime,extension:t.extension,element:t.event}):{error:kl}}function tge(t){var e;if(!t||typeof t!="object")return{error:Ht};if(!t.participantId)return{error:Ra};let i=((e=t.tournamentRecord)==null?void 0:e.participants)||[],n=ag({participantId:t.participantId,tournamentParticipants:i});return n?un({creationTime:t.creationTime,extension:t.extension,element:n}):{error:Jr}}function x5(t){return!t||typeof t!="object"?{error:Ht}:t.tournamentRecord?Ss({element:t.tournamentRecord,name:t.name}):{error:it}}function ige(t){return!t||typeof t!="object"?{error:Ht}:t.drawDefinition?Ss({element:t.drawDefinition,name:t.name}):{error:_l}}function hL(t){return!t||typeof t!="object"?{error:Ht}:t!=null&&t.event?Ss({element:t.event,name:t.name}):{error:kl}}function nge(t){var e;if(!t||typeof t!="object")return{error:Ht};if(!t.participantId)return{error:Ra};let i=((e=t.tournamentRecord)==null?void 0:e.participants)||[],n=ag({participantId:t.participantId,tournamentParticipants:i});return n?Ss({element:n,name:t.name}):{error:Jr}}function GP({tournamentRecords:t}){return{tournamentIds:sr(t)?Object.keys(t):[],...ue}}var tHe="extensionQueries";function Bi({discover:t,element:e,name:i,...n}){var r;if(!e||!i){if(t&&n){let o=Object.keys(n).filter(c=>typeof t=="boolean"||Array.isArray(t)&&t.includes(c)).find(c=>{var u;return Array.isArray((u=n[c])==null?void 0:u.extensions)?n[c].extensions.find(d=>(d==null?void 0:d.name)===i):!1}),s=o&&n[o];!s&&n.tournamentRecords&&(s=Object.values(n.tournamentRecords).find(c=>{var u;return(u=c.extensions)==null?void 0:u.length}));let l=(r=s==null?void 0:s.extensions)==null?void 0:r.find(c=>(c==null?void 0:c.name)===i);return{extension:l,info:l?void 0:Wo}}return fe({result:{error:Ht},stack:tHe})}if(!Array.isArray(e.extensions))return{info:"no extensions"};let a=e.extensions.find(o=>(o==null?void 0:o.name)===i);return{extension:a,info:a?void 0:Wo}}var iHe="activeSuspension",hE="appliedPolicies",S_="positionActions",rge="context",fL="delegatedOutcome",md="disabled",mL="disableLinks",OS="disableAutoCalc",T_="drawDeletions",nHe="drawProfile",U_="entryProfile",rHe="eventProfile",aHe="eventWithdrawalRequests",oHe="factory",Au="flightProfile",tj="groupingAttribute",Of="lineUps",lI="linkedTournamentsIds",gL="matchUpHistory",O5="participantRepresentatives",hU="personRequests",sHe="rankingPoints",Ap="roundTarget",HP="scheduleLimits",Lf="scheduleTiming",cI="schedulingProfile",lHe="statusDetail",LS="subOrder",og="tally",uI="tieFormatModification",age={ACTIVE_SUSPENSION:iHe,APPLIED_POLICIES:hE,AUDIT_POSITION_ACTIONS:S_,CONTEXT:rge,DELEGATED_OUTCOME:fL,DISABLED:md,DISABLE_LINKS:mL,DISABLE_AUTO_CALC:OS,DRAW_DELETIONS:T_,DRAW_PROFILE:nHe,ENTRY_PROFILE:U_,EVENT_PROFILE:rHe,EVENT_WITHDRAWAL_REQUESTS:aHe,FLIGHT_PROFILE:Au,GROUPING_ATTRIBUTE:tj,LINEUPS:Of,LINKED_TOURNAMENTS:lI,MATCHUP_HISTORY:gL,PARTICIPANT_REPRESENTATIVES:O5,PERSON_REQUESTS:hU,RANKING_POINTS:sHe,ROUND_TARGET:Ap,SCHEDULE_LIMITS:HP,SCHEDULE_TIMING:Lf,SCHEDULING_PROFILE:cI,STATUS_DETAIL:lHe,SUB_ORDER:LS,TALLY:og,TIE_FORMAT_MODIFICATIONS:uI,FACTORY:oHe},OZ=[fL,md,mL,Au,Of,gL,O5,hU,Ap,HP,Lf,cI,LS,og];function oge({tournamentRecords:t}){if(typeof t!="object"||!Object.keys(t).length)return{error:_r};let e=GP({tournamentRecords:t}),{tournamentIds:i}=e;return(i==null?void 0:i.length)>1?un({tournamentRecords:t,discover:!0,extension:{name:lI,value:{tournamentIds:i}}}):{...ue}}function sge({tournamentRecords:t}){if(typeof t!="object"||!Object.keys(t).length)return{error:_r};let e=Ss({name:lI,tournamentRecords:t,discover:!0});return fe({result:e,stack:"unlinkTournaments"})}function lge({tournamentRecords:t,tournamentId:e}){if(typeof t!="object")return{error:Me};if(!e)return{error:CS};let i=GP({tournamentRecords:t}),{tournamentIds:n}=i;if(!n.includes(e))return{error:CS};let r;return n.every(a=>{var o;let s=t[a],{extension:l}=Bi({element:s,name:lI});if(!l)return!0;let c=((o=l==null?void 0:l.value)==null?void 0:o.tournamentIds)||[];if(!(c!=null&&c.length)||c.length===1&&c.includes(e)||a===e){let p=x5({name:lI,tournamentRecord:s});return p.error&&(r=p.error),p.success}let u=c.filter(p=>p!==e);l.value={tournamentIds:u};let d=k5({tournamentRecord:s,extension:l});return d.error&&(r=d.error),d.success}),r?{error:r}:{...ue}}var cge={};zi(cge,{getLinkedTournamentIds:()=>zP,getTournamentIds:()=>GP});function zP({tournamentRecords:t}){return typeof t!="object"||!Object.keys(t).length?{error:_r}:{linkedTournamentIds:Object.assign({},...Object.keys(t).map(e=>{var i;let n=t[e],r=n==null?void 0:n.tournamentId,{extension:a}=Bi({element:n,name:lI}),o=(((i=a==null?void 0:a.value)==null?void 0:i.tournamentIds)||[]).filter(s=>s!==r);return{[e]:o}}))}}var uge={};zi(uge,{addAdHocMatchUps:()=>qL,addDrawDefinitionTimeItem:()=>z6,addFinishingRounds:()=>ZP,addGoesTo:()=>ly,addPlayoffStructures:()=>zL,addQualifyingStructure:()=>dye,addVoluntaryConsolationStage:()=>cye,addVoluntaryConsolationStructure:()=>A6,allPlayoffPositionsFilled:()=>j6,alternateDrawPositionAssignment:()=>Hve,assignDrawPosition:()=>Fye,assignDrawPositionBye:()=>uc,attachConsolationStructures:()=>kye,attachPlayoffStructures:()=>t8,attachQualifyingStructure:()=>H6,attachStructures:()=>HL,autoSeeding:()=>M5e,automatedPlayoffPositioning:()=>wR,automatedPositioning:()=>IR,checkValidEntries:()=>ZL,deleteAdHocMatchUps:()=>$ye,drawMatic:()=>P8,findDrawDefinition:()=>o8,generateAdHocMatchUps:()=>XL,generateAdHocRounds:()=>C8,generateAndPopulatePlayoffStructures:()=>e8,generateDrawDefinition:()=>yF,generateDrawMaticRound:()=>y8,generateDrawStructuresAndLinks:()=>m8,generateDrawTypeAndModifyDrawDefinition:()=>g8,generateQualifyingStructure:()=>W6,generateVoluntaryConsolation:()=>fbe,getAssignedParticipantIds:()=>Gy,getAvailableMatchUpsCount:()=>WL,getAvailablePlayoffProfiles:()=>TR,getDrawDefinitionTimeItem:()=>S6,getDrawParticipantRepresentativeIds:()=>r8,getDrawTypeCoercion:()=>AR,getEligibleVoluntaryConsolationParticipants:()=>n8,getMatchUpsMap:()=>ko,getParticipantIdFinishingPositions:()=>a8,getPositionAssignments:()=>DE,getPositionsPlayedOff:()=>EU,getSeedingThresholds:()=>O6,getSeedsCount:()=>_R,getStructureSeedAssignments:()=>Gc,getTeamLineUp:()=>sy,getValidGroupSizes:()=>yR,isAdHoc:()=>Ll,isCompletedStructure:()=>dg,isValidForQualifying:()=>f8,luckyLoserDrawPositionAssignment:()=>Gve,modifyDrawDefinition:()=>xye,modifyDrawName:()=>i8,modifySeedAssignment:()=>Qve,mutate:()=>dge,positionActions:()=>h8,pruneDrawDefinition:()=>Lye,qualifierDrawPositionAssignment:()=>Zve,query:()=>Gye,removeDrawPositionAssignment:()=>SE,removeRoundMatchUps:()=>Vye,removeSeededParticipant:()=>uye,removeStructure:()=>sye,renameStructures:()=>oye,resetDrawDefinition:()=>Oye,resetVoluntaryConsolationStructure:()=>kge,setDrawParticipantRepresentativeIds:()=>pge,setPositionAssignments:()=>Kve,setStructureOrder:()=>rye,setSubOrder:()=>jye,shiftAdHocRounds:()=>Wve,swapAdHocRounds:()=>Yve,swapDrawPositionAssignments:()=>Jve,updateTeamLineUp:()=>yw,withdrawParticipantAtDrawPosition:()=>xve});var dge={};zi(dge,{addAdHocMatchUps:()=>qL,addDrawDefinitionTimeItem:()=>z6,addPlayoffStructures:()=>zL,addQualifyingStructure:()=>dye,addVoluntaryConsolationStage:()=>cye,addVoluntaryConsolationStructure:()=>A6,alternateDrawPositionAssignment:()=>Hve,assignDrawPosition:()=>Fye,assignDrawPositionBye:()=>uc,attachConsolationStructures:()=>kye,attachPlayoffStructures:()=>t8,attachQualifyingStructure:()=>H6,attachStructures:()=>HL,automatedPlayoffPositioning:()=>wR,automatedPositioning:()=>IR,deleteAdHocMatchUps:()=>$ye,luckyLoserDrawPositionAssignment:()=>Gve,modifyDrawDefinition:()=>xye,modifyDrawName:()=>i8,modifySeedAssignment:()=>Qve,pruneDrawDefinition:()=>Lye,qualifierDrawPositionAssignment:()=>Zve,removeDrawPositionAssignment:()=>SE,removeRoundMatchUps:()=>Vye,removeSeededParticipant:()=>uye,removeStructure:()=>sye,renameStructures:()=>oye,resetDrawDefinition:()=>Oye,resetVoluntaryConsolationStructure:()=>kge,setDrawParticipantRepresentativeIds:()=>pge,setPositionAssignments:()=>Kve,setStructureOrder:()=>rye,setSubOrder:()=>jye,shiftAdHocRounds:()=>Wve,swapAdHocRounds:()=>Yve,swapDrawPositionAssignments:()=>Jve,updateTeamLineUp:()=>yw,withdrawParticipantAtDrawPosition:()=>xve});var L5=t=>e=>t[e],F5=(t=[])=>t.map(Va).filter(Boolean),ij=(t=[])=>t.map(Wi).filter(Boolean),Wi=(t={})=>L5(t)("participantId"),Va=(t={})=>L5(t)("matchUpId"),fE=(t={})=>L5(t)("drawId");function pge({representativeParticipantIds:t,drawDefinition:e}){if(!e)return{error:_l};if(!Array.isArray(t))return{error:Me};let i=ij((e==null?void 0:e.entries)||[]);return t.length&&Wr(t,i).length<t.length?{error:Me}:pL({drawDefinition:e,extension:{name:O5,value:t}})}var ec="ABANDONED",sw="AWAITING_RESULT",yn="BYE",sm="CANCELLED",ia="COMPLETED",fU="DEAD_RUBBER",fn="DEFAULTED",Ca="DOUBLE_DEFAULT",da="DOUBLE_WALKOVER",Hu="IN_PROGRESS",bp="INCOMPLETE",B5="NOT_PLAYED",os="RETIRED",$g="SUSPENDED",Kr="TO_BE_PLAYED",Rn="WALKOVER",cHe=[sw,ia,fn,Hu,bp,os,$g],hge=[sw,ia,fn,da,Ca,Hu,bp,os,$g,Rn],fge=[ec,sw,yn,sm,ia,fU,fn,da,Ca,Hu,bp,B5,os,$g,Kr,Rn],mge=[yn,da,Ca,ia,fn,os,Rn],gge=[ec,sw,sm,fU,Hu,bp,B5,$g,Kr,void 0],Ga=[sm,ec,ia,fU,fn,da,Ca,os,Rn],$5=[ec,ia,fn,da,Ca,Hu,os,Rn],vge=[Hu,bp,$g,Kr],yge={ABANDONED:ec,AWAITING_RESULT:sw,BYE:yn,CANCELLED:sm,COMPLETED:ia,DEAD_RUBBER:fU,DEFAULTED:fn,DOUBLE_WALKOVER:da,DOUBLE_DEFAULT:Ca,IN_PROGRESS:Hu,INCOMPLETE:bp,NOT_PLAYED:B5,RETIRED:os,SUSPENDED:$g,TO_BE_PLAYED:Kr,WALKOVER:Rn},Ft="MAIN",Xt="QUALIFYING",Mo="CONSOLATION",to="VOLUNTARY_CONSOLATION",Br="PLAY_OFF",V5=[Ft,Xt,Mo,Br,to],dI={[Xt]:1,[Ft]:2,[Br]:3,[Mo]:3,[to]:4},bge="finishingPositions",Ige="aggregateEventStructures",wge={[Ft]:1,[Br]:2,[Mo]:3,[Xt]:4,[to]:5},uHe={[Br]:1,[Ft]:2,[Mo]:3,[Xt]:4,[to]:5},vL="CLUSTER",dHe="SEPARATE",ty="WATERFALL",yL="ITEM",xs="CONTAINER",rd="DRAW",bL="RANDOM",gu="TOP_DOWN",iy="BOTTOM_UP",Ff="POSITION",Bf="WINNER",Eh="LOSER",Ch="FIRST_MATCHUP",_u="AD_HOC",pHe="AD_HOC",mU="FEED_IN",FS="COMPASS",BS="OLYMPIC",hHe="SINGLE_ELIMINATION",rp="SINGLE_ELIMINATION",qP="DOUBLE_ELIMINATION",$S="FIRST_MATCH_LOSER_CONSOLATION",WP="FIRST_ROUND_LOSER_CONSOLATION",ky="LUCKY_DRAW",IL="CURTIS_CONSOLATION",fHe="CURTIS_CONSOLATION",j5="FEED_IN_CHAMPIONSHIP_TO_SF",mE="FEED_IN_CHAMPIONSHIP_TO_SF",G5="FEED_IN_CHAMPIONSHIP_TO_QF",gE="FEED_IN_CHAMPIONSHIP_TO_QF",H5="FEED_IN_CHAMPIONSHIP_TO_R16",vE="FEED_IN_CHAMPIONSHIP_TO_R16",Sge="MODIFIED_FEED_IN_CHAMPIONSHIP",yE="MODIFIED_FEED_IN_CHAMPIONSHIP",KP="FEED_IN_CHAMPIONSHIP",ku="ROUND_ROBIN",Ph="ROUND_ROBIN_WITH_PLAYOFF",Tge="DECIDER",Uge="BACKDRAW",z5={0:{name:"East",abbreviation:"E"},"0-1":{name:"West",abbreviation:"W"},"0-2":{name:"North",abbreviation:"N"},"0-3":{name:"Northeast",abbreviation:"NE"},"0-1-1":{name:"South",abbreviation:"S"},"0-1-2":{name:"Southwest",abbreviation:"SW"},"0-2-1":{name:"Northwest",abbreviation:"NW"},"0-1-1-1":{name:"Southeast",abbreviation:"SE"}},q5={0:{name:"East",abbreviation:"E"},"0-1":{name:"West",abbreviation:"W"},"0-2":{name:"North",abbreviation:"N"},"0-1-1":{name:"South",abbreviation:"S"}},gU="WIN_RATIO",lw="ROUND_OUTCOME",Dge=[FS,IL,gE,vE,mE,KP,G5,H5,j5,$S,WP,ky,yE,BS,Br,Ph],mHe=[_u,FS,IL,qP,gE,vE,mE,KP,mU,$S,WP,ky,yE,BS,Br,ku,Ph,rp],Ege={MAIN:Ft,QUALIFYING:Xt,CONSOLATION:Mo,ITEM:yL,CONTAINER:xs,FIRST_MATCHUP:Ch,WINNER:Bf,LOSER:Eh,AD_HOC:_u,FEED_IN:mU,FLEX_ROUNDS:pHe,COMPASS:FS,PLAY_OFF:Br,OLYMPIC:BS,KNOCKOUT:hHe,SINGLE_ELIMINATION:rp,DOUBLE_ELIMINATION:qP,CURTIS:IL,FICSF:j5,FICQF:G5,FICR16:H5,MFIC:Sge,VOLUNTARY_CONSOLATION:to,FIRST_MATCH_LOSER_CONSOLATION:$S,FIRST_ROUND_LOSER_CONSOLATION:WP,MODIFIED_FEED_IN_CHAMPIONSHIP:yE,FEED_IN_CHAMPIONSHIP_TO_R16:vE,FEED_IN_CHAMPIONSHIP_TO_QF:gE,FEED_IN_CHAMPIONSHIP_TO_SF:mE,FEED_IN_CHAMPIONSHIP:KP,LUCKY_DRAW:ky,ROUND_ROBIN_WITH_PLAYOFF:Ph,ROUND_ROBIN:ku,DECIDER:Tge,BACKDRAW:Uge,COMPASS_ATTRIBUTES:z5,OLYMPIC_ATTRIBUTES:q5,DRAW:rd,RANDOM:bL,TOP_DOWN:gu,BOTTOM_UP:iy,WATERFALL:ty,WIN_RATIO:gU,ROUND_OUTCOME:lw,MULTI_STRUCTURE_DRAWS:Dge,generatedDrawTypes:mHe,stageOrder:dI,finishOrder:wge,AGGREGATE_EVENT_STRUCTURES:Ige,FINISHING_POSITIONS:bge},gHe=Ege;function cw(t,e,i){var n,r;let a=h=>{var f,m;return(m=(f=Bi({element:h,name:Ap}))==null?void 0:f.extension)==null?void 0:m.value},o=i==null?void 0:i.deprioritizeCompleted,s=(i==null?void 0:i.mode)===Ige&&uHe,l=(i==null?void 0:i.mode)===bge&&wge,c=l||s||dI,u=h=>(h==null?void 0:h.stage)===Ft&&(h==null?void 0:h.stageSequence)===1,d=h=>u(h)?-1:c[h==null?void 0:h.stage],p=h=>h==null?void 0:h.matchUps.every(({matchUpStatus:f})=>Ga.includes(f)?1:-1);return o&&p(t)-p(e)||s&&d(t)-d(e)||((t==null?void 0:t.stage)&&c[t.stage]||0)-((e==null?void 0:e.stage)&&c[e.stage]||0)||(a(t)||0)-(a(e)||0)||!l&&!s&&(((n=e==null?void 0:e.positionAssignments)==null?void 0:n.length)??1/0)-(((r=t==null?void 0:t.positionAssignments)==null?void 0:r.length)??1/0)||((t==null?void 0:t.stageSequence)??0)-((e==null?void 0:e.stageSequence)??0)||(D_(t)||0)-(D_(e)||0)}function D_(t){return((t==null?void 0:t.matchUps)||[]).reduce((e,i)=>{var n;let r=(((n=i.finishingPositionRange)==null?void 0:n.winner)||[]).reduce((a,o)=>a+o,0);return!e||r<e?r:e},void 0)}function pi(t){let e=mn(t,[{[Md]:!0,[T5]:!0}]);if(e.error)return e;let{drawDefinition:i,structureId:n}=t,{structures:r}=Rh({drawDefinition:i}),a=r==null?void 0:r.map(l=>l.structures?[...l.structures].concat(l):l).flat(),o=a==null?void 0:a.find(l=>l.structureId===n);if(!o)return{error:Dr};let s=o.structureType===yL?a==null?void 0:a.find(l=>{var c;return(c=l.structures)==null?void 0:c.some(u=>u.structureId===n)}):void 0;return{structure:o,containingStructure:s}}function Rh({withStageGrouping:t,drawDefinition:e,stageSequences:i,stageSequence:n,roundTarget:r,sortConfig:a,stages:o,stage:s}){var l;let c=!e&&Lt||!(e!=null&&e.structures)&&q4||void 0;if(c)return{error:c,structures:[],stageStructures:{}};let u=m=>{var g,v;let y=(v=(g=Bi({element:m,name:Ap}))==null?void 0:g.extension)==null?void 0:v.value;return!r||r===y},d=((l=e==null?void 0:e.structures)==null?void 0:l.filter(h).filter(f).filter(u).sort((m,g)=>cw(m,g,a)))??[],p=t?Object.assign({},...V5.map(m=>{let g=d==null?void 0:d.filter(v=>v.stage===m);return(g==null?void 0:g.length)&&{[m]:g}}).filter(Boolean)):{};return{structures:d,stageStructures:p};function h(m){return!s&&!Array.isArray(o)||s&&m.stage===s||Array.isArray(o)&&o.includes(m.stage)}function f(m){return!n&&!Array.isArray(i)||n&&m.stageSequence===n||Array.isArray(i)&&i.includes(m.stageSequence)}}function Cge({drawDefinition:t}){if(!t)return{error:Lt};let e={};return{allPositionedParticipantIds:(t.structures||[]).map(i=>{let n=i.stage;e[n]||(e[n]=[]);let{positionAssignments:r}=jn({structure:i}),a=(r==null?void 0:r.map(Wi).filter(Boolean))??[];return e[n].push(...a),a}).flat(),stagePositionedParticipantIds:e}}function jn({drawDefinition:t,structureId:e,structure:i}){let n,r=[];if(!i){if(!t)return{positionAssignments:r,error:Lt};if({structure:i,error:n}=pi({drawDefinition:t,structureId:e}),n)return{positionAssignments:r,error:n}}return i.structures?r=[].concat(...i.structures.map(a=>jn({structure:a}).positionAssignments)):i.positionAssignments?r=i.positionAssignments:n=Lfe,{positionAssignments:r,error:n}}function Ha({drawDefinition:t,structureId:e,structure:i}){var n;let r=((n=jn({drawDefinition:t,structureId:e,structure:i}))==null?void 0:n.positionAssignments)||[],a=r==null?void 0:r.filter(u=>u.participantId??u.bye??u.qualifier),o=r&&(r==null?void 0:r.length)===(a==null?void 0:a.length),s=r==null?void 0:r.filter(u=>!u.participantId&&!u.bye&&!u.qualifier),l=r==null?void 0:r.filter(u=>!u.participantId&&u.bye),c=r==null?void 0:r.filter(u=>!u.participantId&&u.qualifier);return{allPositionsAssigned:o,positionAssignments:r,unassignedPositions:s,assignedPositions:a,qualifierPositions:c,byePositions:l}}var W5="addDrawDefinition",wL="addMatchUps",sg="addParticipants",K5="addScaleItems",Y5="addVenue",VS="audit",Z5="deleteParticipants",X5="deleteVenue",J5="deletedDrawIds",Q5="deletedMatchUpIds",e6="modifyDrawDefinition",Pge="modifyDrawEntries",Rge="modifyEventEntries",t6="modifyMatchUp",No="modifyParticipants",i6="modifyPositionAssignments",n6="modifySeedAssignments",Mge="modifyTournamentDetail",xy="modifyVenue",nj="mutations",rj="publishEvent",Nge="publishEventSeeding",Age="publishOrderOfPlay",r6="unPublishEvent",a6="unPublishEventSeeding",o6="unPublishOrderOfPlay",SL="updateInContextMatchUp",vHe={ADD_DRAW_DEFINITION:W5,ADD_MATCHUPS:wL,ADD_PARTICIPANTS:sg,ADD_SCALE_ITEMS:K5,ADD_VENUE:Y5,AUDIT:VS,DELETE_PARTICIPANTS:Z5,DELETE_VENUE:X5,DELETED_DRAW_IDS:J5,DELETED_MATCHUP_IDS:Q5,MODIFY_DRAW_DEFINITION:e6,MODIFY_DRAW_ENTRIES:Pge,MODIFY_EVENT_ENTRIES:Rge,MODIFY_MATCHUP:t6,MODIFY_PARTICIPANTS:No,MODIFY_POSITION_ASSIGNMENTS:i6,MODIFY_SEED_ASSIGNMENTS:n6,MODIFY_TOURNAMENT_DETAIL:Mge,MODIFY_VENUE:xy,MUTATIONS:nj,PUBLISH_EVENT_SEEDING:Nge,PUBLISH_EVENT:rj,PUBLISH_ORDER_OF_PLAY:Age,UNPUBLISH_EVENT_SEEDING:a6,UNPUBLISH_EVENT:r6,UNPUBLISH_ORDER_OF_PLAY:o6,UPDATE_INCONTEXT_MATCHUP:SL};function TL(t,e){var i;if(!t)return{error:Lt};let n=Date.now();t.updatedAt&&n===new Date(t.updatedAt).getTime()&&(n+=1);let r=new Date(n).toISOString(),a=e==null?void 0:e.filter(Boolean);return t.updatedAt=r,(i=t.structures)==null||i.filter(Boolean).forEach(o=>{(!(a!=null&&a.length)||a!=null&&a.includes(o.structureId))&&(o.updatedAt=r)}),{...ue}}function lg({drawDefinition:t,tournamentId:e,matchUps:i,eventId:n}){return t&&TL(t),tn({payload:{matchUps:i,tournamentId:e,eventId:n},topic:wL}),{...ue}}function lm({drawDefinition:t,tournamentId:e,matchUpIds:i,eventId:n,action:r}){t&&TL(t),tn({topic:Q5,payload:{tournamentId:e,matchUpIds:i,eventId:n,action:r}});for(let a of i)b5({key:a});return{...ue}}function sn({drawDefinition:t,tournamentId:e,structureId:i,context:n,eventId:r,matchUp:a}){return a?(t&&er({drawDefinition:t,structureIds:i?[i]:void 0,tournamentId:e,eventId:r}),tn({topic:t6,payload:{matchUp:a,tournamentId:e,context:n},key:a.matchUpId}),{...ue}):(console.log(cl),{error:cl})}function yHe({tournamentId:t,inContextMatchUp:e}){return e?(tn({payload:{inContextMatchUp:e,tournamentId:t},topic:SL,key:e.matchUpId}),{...ue}):{error:cl}}function YP({tournamentId:t,eventId:e,drawDefinition:i}){return i?(TL(i),tn({payload:{drawDefinition:i,tournamentId:t,eventId:e},topic:W5,key:i.drawId}),{...ue}):(console.log(Lt),{error:Lt})}function bHe({tournamentId:t,eventId:e,drawId:i}){return tn({payload:{drawId:i,tournamentId:t,eventId:e},topic:J5,key:i}),b5({key:i}),{...ue}}function er({drawDefinition:t,tournamentId:e,structureIds:i,eventId:n}){return t?(TL(t,i),tn({payload:{tournamentId:e,eventId:n,drawDefinition:t},topic:e6,key:t.drawId}),{...ue}):{error:Lt}}function _ge({drawDefinition:t,tournamentId:e,structure:i,eventId:n}){if(!t)return{error:Lt};if(!i)return{error:_g};let r=i.seedAssignments,a=i.structureId,o=t.drawId;return tn({payload:{tournamentId:e,eventId:n,drawId:o,structureId:a,seedAssignments:r},topic:n6,key:t.drawId}),er({structureIds:[a],drawDefinition:t,tournamentId:e,eventId:n}),{...ue}}function cg({drawDefinition:t,tournamentId:e,structure:i,event:n}){if(!t)return{error:Lt};if(!i)return{error:_g};let r=jn({structure:i}),a=i.structureId,o=t.drawId,s=n==null?void 0:n.eventId;return tn({topic:i6,payload:{positionAssignments:r,tournamentId:e,structureId:a,eventId:s,drawId:o},key:a}),er({structureIds:[a],drawDefinition:t,tournamentId:e,eventId:s}),{...ue}}function kge({tournamentRecord:t,drawDefinition:e,resetEntries:i,event:n}){var r,a;if(!e)return{error:Lt};let o=(r=e.structures)==null?void 0:r.find(l=>l.stage===to);if(!o)return{error:Dr};let s=((a=o.matchUps)==null?void 0:a.map(({matchUpId:l})=>l))||[];return o.positionAssignments=[],o.seedAssignments=[],o.matchUps=[],lm({tournamentId:t==null?void 0:t.tournamentId,action:"resetVoluntaryConsolationStructure",matchUpIds:s,drawDefinition:e}),i&&(e.entries=e.entries.filter(l=>l.entryStage!==to)),er({tournamentId:t==null?void 0:t.tournamentId,eventId:n==null?void 0:n.eventId,drawDefinition:e,structureIds:[o.structureId]}),{...ue}}function s6({drawPositions:t,structure:e}){var i;if([Xt,Ft].includes(e.stage)&&e.stageSequence===1)return;let{positionAssignments:n}=jn({structure:e});(i=n==null?void 0:n.filter(({drawPosition:r})=>t==null?void 0:t.includes(r)))==null||i.forEach(r=>{un({element:r,extension:{name:mL,value:!0}})})}function UL({drawDefinition:t,positionAction:e}){var i;let{extension:n}=Bi({name:S_,element:t}),r=Array.isArray(n==null?void 0:n.value)?(n==null?void 0:n.value)??[]:[];if(!(r!=null&&r.length)){let o=t.structures.find(s=>s.stage===Ft);if(o){let s=(i=jn({structure:o}).positionAssignments)==null?void 0:i.map(({drawPosition:l,participantId:c,bye:u,qualifier:d})=>({drawPosition:l,participantId:c,qualifier:d,bye:u}));r.push({name:"initialMainAssignments",initialAssignments:s})}}let a={name:S_,value:r.concat(e)};un({element:t,extension:a})}function vU({tournamentRecord:t,drawDefinition:e,event:i}){var n;let r=((n=(t==null?void 0:t.events)||i&&[i])==null?void 0:n.map(l=>l==null?void 0:l.drawDefinitions).flat().filter(Boolean))||e&&[e]||[],a={},o={},s=r.map(l=>{var c;return(c=l==null?void 0:l.structures)==null?void 0:c.filter(u=>u==null?void 0:u.structures)}).flat().filter(Boolean);for(let l of s){let{structures:c,structureId:u}=l??{};c&&u&&(a[u]=c==null?void 0:c.map(d=>d.structureId))&&c.forEach(d=>o[d.structureId]=l==null?void 0:l.structureId)}return{containedStructures:a,containerStructures:o}}var xb="SINGLES",Mr="SINGLES",ny="DOUBLES",Zn="DOUBLES",Ip="TEAM",Jn="TEAM",IHe={SINGLES_MATCHUP:xb,SINGLES:Mr,DOUBLES_MATCHUP:ny,DOUBLES:Zn,TEAM_MATCHUP:Ip,TEAM:Jn};function DL(t){var e;let{sides:i,matchUpType:n}=t||{},r=(e=t.potentialParticipants)!=null&&e.length?t.potentialParticipants.flat().map(o=>n===Zn?(o==null?void 0:o.individualParticipantIds)||[]:o.participantId).flat():[],a=(i||[]).map(o=>{var s;return n===Zn&&(((s=o==null?void 0:o.participant)==null?void 0:s.individualParticipantIds)||[])||(o==null?void 0:o.participantId)&&[o.participantId]||[]}).flat();return{individualParticipantIds:a.concat(r).flat(),enteredIndividualParticipantIds:a,potentialIndividualParticipantIds:r}}function _p(t){return(t==null?void 0:t.tournamentRecords)??((t==null?void 0:t.tournamentRecord)&&{[t.tournamentRecord.tournamentId]:t.tournamentRecord})??{}}function EL(t){if(!sr(t))return!1;let{matchUpId:e,drawPositions:i}=t,n=typeof e=="string",r=!i||Array.isArray(i)&&i.length<=2&&i.every(a=>bi(a)||a===void 0||a===null);return n&&r}function Zc(t){return Array.isArray(t)?t.every(EL):!1}function Rs({matchUps:t=[],interpolate:e}){var i;if(!Zc(t))return{roundMatchUps:[],error:Me};let n=t.reduce((p,h)=>{let f=typeof h.roundNumber=="string"?ai(h.roundNumber):h.roundNumber;return!h.roundNumber||p.includes(f)?p:p.concat(f)},[]).sort(va).map(p=>{let h=t.filter(g=>g.roundNumber===p),f=h.find(({matchUpType:g})=>g===Jn)?h.filter(({matchUpType:g})=>g===Jn):h,m=g=>g.sort((v,y)=>va(v.roundPosition,y.roundPosition));return{[p]:m(f)}}),r=t.reduce((p,h)=>{let f=typeof h.roundNumber=="string"?ai(h.roundNumber):h.roundNumber;return p[f]||(p[f]=qt({abbreviatedRoundName:h.abbreviatedRoundName,finishingRound:h.finishingRound,roundName:h.roundName})),p},{}),a=Object.assign({},...n);if(e){let p=Math.max(...Object.keys(a).map(f=>ai(f)).filter(f=>!isNaN(f))),h=(i=a[p])==null?void 0:i.length;if(h>1&&Td(h)){let f=p+1,m=f+h/2;Ct(f,m).forEach((g,v)=>{a[g]=Ct(0,h/(2+v*2)).map(()=>({}))})}}let o=0,s=Object.assign({},...Object.keys(a).map(p=>{var h,f,m;let g=(h=a[p])==null?void 0:h.length,v=(m=(f=a[p])==null?void 0:f.filter(b=>{var I;return!Ga.includes(b.matchUpStatus)&&!((I=b.score)!=null&&I.scoreStringSide1)}))==null?void 0:m.length,y=g&&g===v;return o=Math.max(o,g),{[p]:{matchUpsCount:g,inactiveCount:v,inactiveRound:y}}})),l=0,c=0,u=Object.keys(a).map(p=>ai(p)).filter(p=>!isNaN(p));u.forEach(p=>{var h,f,m,g,v;let y=a[p].sort((I,T)=>I.roundPosition-T.roundPosition),b=y.map(I=>(I==null?void 0:I.drawPositions)||[]).flat();if(s[p].roundNumber=p,s[p].roundFactor=s[p].matchUpsCount?o/s[p].matchUpsCount:1,s[p].finishingRound=(h=r[p])==null?void 0:h.finishingRound,s[p].roundName=(f=r[p])==null?void 0:f.roundName,s[p].abbreviatedRoundName=(m=r[p])==null?void 0:m.abbreviatedRoundName,s[p].finishingPositionRange=(v=(g=a[p])==null?void 0:g[0])==null?void 0:v.finishingPositionRange,p===1||!s[p-1]){let I=b.sort(va),T=so(I,2);s[p].drawPositions=I,s[p].pairedDrawPositions=T}else{let I=s[p-1],T=I.drawPositions,w=I.matchUpsCount/s[p].matchUpsCount,S=so(T,w),D=y.map(E=>{let{roundPosition:C}=E,P=[...E.drawPositions||[],void 0,void 0].slice(0,2);if(!C)return P;let R=(P==null?void 0:P.filter(Boolean))||[];if(!(R!=null&&R.length))return[void 0,void 0];if(p<3&&(R==null?void 0:R.length)===2)return P==null?void 0:P.slice().sort(va);let N=Wr(T,R).length!==(R==null?void 0:R.length);if(R!=null&&R.length&&N)return(R==null?void 0:R.length)===1?[R[0],void 0]:P==null?void 0:P.slice().sort(va);let M=(C-1)*2;return S.slice(M,M+2).map(A=>R==null?void 0:R.find(_=>A.includes(_)))});s[p].drawPositions=D==null?void 0:D.flat(),s[p].pairedDrawPositions=D}s[p+1]&&s[p+1].matchUpsCount===s[p].matchUpsCount&&(s[p+1].feedRound=!0,s[p+1].feedRoundIndex=c,s[p].preFeedRound=!0,c+=1),s[p]&&!s[p].feedRound&&(s[p].roundIndex=l,l+=1)});let d=!!Object.values(s).find(({matchUpsCount:p})=>!Td(p));return{hasNoRoundPositions:t.some(p=>!p.roundPosition),roundsNotPowerOf2:d,maxMatchUpsCount:o,roundMatchUps:a,roundNumbers:u,roundProfile:s,...ue}}function Ob({element:t,accessor:e}){if(typeof e!="string")return{values:[]};let i=$t(t),n=e.split("."),r=[],a;s({targetElement:i,attributes:n});let o={value:a};return r.length&&(o.values=r),o;function s({targetElement:l,attributes:c=[],significantCharacters:u}){for(let[p,h]of c.entries())if(l!=null&&l[h]){let f=c.slice(p+1);f.length?Array.isArray(l[h])?l[h].forEach(m=>s({targetElement:m,attributes:f})):(l=l[h],d({targetElement:l,index:p})):(a||(a=l[h]),r.includes(l[h])||r.push(l[h]))}function d({targetElement:p,index:h}){if(p&&h===c.length-1&&["string","number"].includes(typeof p)){let f=u?p.slice(0,u):p;a?r.includes(f)||r.push(f):(a=f,r.push(f))}}}}var xge=t=>e=>{var i;return!t||typeof e!="object"?void 0:Array.isArray(t)&&t.map(n=>{var r;return{[n]:(r=Ob({element:e,accessor:n}))==null?void 0:r.value}})||typeof t=="object"&&Object.keys(t).map(n=>{var r;return{[n]:(r=Ob({element:e,accessor:n}))==null?void 0:r.value}})||((i=typeof t=="string"&&Ob({element:e,accessor:t}))==null?void 0:i.value)},Ol=xge;function ZP({finishingPositionOffset:t=0,finishingPositionLimit:e,positionsFed:i,roundsCount:n,roundLimit:r,matchUps:a,lucky:o,fmlc:s}){var l;if(!Zc(a))return[];let{roundProfile:c,roundNumbers:u=[]}=Rs({interpolate:!0,matchUps:a});n=n??Math.max(...u,0);let d=r?n-r:0,p=d&&((l=c==null?void 0:c[n-d])==null?void 0:l.matchUpsCount),h=c&&Object.values(c).map(Ol("matchUpsCount")),f=(v,y)=>{let b=Math.min(...v);p&&y&&b===1&&(b=p);let I=Math.max(...v);return e&&I>e&&(I=e),[b,I]},m=c&&Object.assign({},...u.map(v=>{let y=(n??0)+1-v-d,b=c[v].matchUpsCount,I={finishingPositionRange:{},finishingRound:y},T=h==null?void 0:h.slice(v-1).reduce((N,M)=>N+(M||0),0),w=s&&v!==1,S=1+t+(w?i??0:0),D=1,E=Ct(S,o?S+b*2:T+S+D),C=T+D-b,P=f(E.slice(C)),R=f(E.slice(0,C),!0);return I.finishingPositionRange={loser:P,winner:R},{[v]:I}})),g=jc({finishingRound:!0});return a.filter(Boolean).forEach(v=>{let y=v.roundNumber&&m[v.roundNumber];g&&!y&&console.log({roundFinishingData:m,matchUp:v}),v.finishingRound=y==null?void 0:y.finishingRound,v.finishingPositionRange=y==null?void 0:y.finishingPositionRange}),a}function ko({drawDefinition:t,structure:e}){let i={},n=[];return((t==null?void 0:t.structures)??[e]).filter(r=>r&&typeof r=="object").forEach(r=>{if(!r)return;let{structureId:a,matchUps:o,structures:s}=r,l=Array.isArray(s);if(l)l&&s.forEach(c=>{let{structureName:u}=c,d=c.matchUps;i[c.structureId]={matchUps:d,itemStructureIds:[],structureName:u},d&&(n.push(...d),d.forEach(p=>{p.tieMatchUps&&n.push(...p.tieMatchUps)})),i[a]||(i[a]={itemStructureIds:[],matchUps:[]}),i[a].itemStructureIds||(i[a].itemStructureIds=[]),i[a].itemStructureIds.push(c.structureId)});else{let c=o;i[a]={matchUps:c,itemStructureIds:[]},c==null||c.forEach(u=>{n.push(u),u.tieMatchUps&&n.push(...u.tieMatchUps)})}}),{mappedMatchUps:i,drawMatchUps:n}}function ry({mappedMatchUps:t,matchUpsMap:e,structureId:i,inContext:n}){t=(e==null?void 0:e.mappedMatchUps)??t;let r=t[i],a=((r==null?void 0:r.itemStructureIds)||[]).map(o=>{let{matchUps:s,structureName:l}=t[o];return n?s.map(c=>Object.assign($t(c,!0,!0),{containerStructureId:i,structureId:o,structureName:l})):s}).flat();return((r==null?void 0:r.matchUps)||[]).concat(...a)}var XP="SIGN_IN_STATUS",Oge="SIGNED_OUT",bE="SIGNED_IN",_c="TEAM",Ki="INDIVIDUAL",cc="GROUP",Ui="PAIR",Hn="TEAM",K1={TEAM_PARTICIPANT:_c,INDIVIDUAL:Ki,GROUP:cc,TEAM:Hn,PAIR:Ui},wHe={INDIVIDUAL:Ki,GROUP:cc,PAIR:Ui,TEAM:Hn,SIGN_IN_STATUS:XP,SIGNED_OUT:Oge,SIGNED_IN:bE};function l6({participantsProfile:t,participants:e=[],deepCopy:i}){let n=new Map,r=i!==!1?$t(e,t==null?void 0:t.convertExtensions,!0):e,a=r.filter(l=>l.participantType===Hn),o=r.filter(l=>l.participantType===cc),s=r.filter(l=>l.participantType===Ui);return r.forEach(l=>{if(l.participantType===Ki){let{participantId:c}=l;l.groupParticipantIds=[],l.teamParticipantIds=[],l.pairParticipantIds=[],l.groups=[],l.teams=[],a.forEach(u=>{((u==null?void 0:u.individualParticipantIds)||[]).forEach(d=>{var p;d===c&&!((p=l.teamParticipantIds)!=null&&p.includes(u.participantId))&&(l.teamParticipantIds.push(u.participantId),n.get(u.participantId)||n.set(u.participantId,{participantName:u.participantName,participantId:u.participantId}),l.teams.push({participantRoleResponsibilities:u.participantRoleResponsibilities,participantOtherName:u.participantOtherName,participantName:u.participantName,participantId:u.participantId,teamId:u.teamId}))})}),s.forEach(u=>{((u==null?void 0:u.individualParticipantIds)||[]).forEach(d=>{d===c&&!l.pairParticipantIds.includes(u.participantId)&&l.pairParticipantIds.push(u.participantId)})}),o.forEach(u=>{((u==null?void 0:u.individualParticipantIds)||[]).forEach(d=>{d===c&&!l.groupParticipantIds.includes(u.participantId)&&(l.groupParticipantIds.push(u.participantId),l.groups.push({participantRoleResponsibilities:u.participantRoleResponsibilities,participantOtherName:u.participantOtherName,participantName:u.participantName,participantId:u.participantId}))})})}}),{participantsWithGroupings:r,groupInfo:Object.fromEntries(n)}}function c6({drawDefinition:t,attributes:e}){let{extension:i}=Bi({element:t,name:U_}),n=(i==null?void 0:i.value)||{};return e.forEach(r=>{Object.keys(r).forEach(a=>{n[a]?Object.assign(n[a],r[a]):n[a]=r[a]})}),i={name:U_,value:n},pL({drawDefinition:t,extension:i}),{entryProfile:n}}function JP({drawDefinition:t}){let{extension:e}=Bi({element:t,name:U_});return{entryProfile:(e==null?void 0:e.value)||{}}}var Su="ALTERNATE",QP="CONFIRMED",tc="DIRECT_ACCEPTANCE",eR="FEED_IN",tR="JUNIOR_EXEMPT",$f="LUCKY_LOSER",iR="ORGANISER_ACCEPTANCE",nR="QUALIFIER",SHe="REGISTERED",rR="SPECIAL_EXEMPT",zu="UNGROUPED",Oy="UNPAIRED",jS="WILDCARD",Vf="WITHDRAWN",$N=[QP,tc,tR,iR,rR],Lge=[eR,$f,nR],Ly=[QP,tc,eR,tR,iR,rR,jS],qu=[QP,tc,tR,$f,nR,iR,rR,jS],Fge=[Su,QP,tc,eR,tR,$f,iR,nR,SHe,rR,zu,Oy,jS,Vf],THe={ALTERNATE:Su,CONFIRMED:QP,DIRECT_ACCEPTANCE:tc,DIRECT_ENTRY_STATUSES:Ly,DRAW_SPECIFIC_STATUSES:Lge,EQUIVALENT_ACCEPTANCE_STATUSES:$N,FEED_IN:eR,JUNIOR_EXEMPT:tR,LUCKY_LOSER:$f,ORGANISER_ACCEPTANCE:iR,QUALIFIER:nR,SPECIAL_EXEMPT:rR,STRUCTURE_SELECTED_STATUSES:qu,UNGROUPED:zu,UNPAIRED:Oy,VALID_ENTRY_STATUSES:Fge,WILDCARD:jS,WITHDRAWN:Vf};function u6({stage:t,drawDefinition:e}){let{entryProfile:i}=JP({drawDefinition:e}),n=Object.keys(i).includes(t);if(!n&&V5.includes(t)){let r=[{[t]:{drawSize:void 0,alternates:!0}}];return c6({drawDefinition:e,attributes:r}),!0}return n}function UHe({stage:t,drawDefinition:e}){var i;let{entryProfile:n}=JP({drawDefinition:e});return((i=n[t])==null?void 0:i.alternates)||0}function DHe({stage:t,drawDefinition:e}){var i;let{entryProfile:n}=JP({drawDefinition:e});return((i=n[t])==null?void 0:i.wildcardsCount)||0}function aj({stage:t,drawDefinition:e,entryStatus:i}){return e.entries.reduce((n,r)=>r.entryStage===t&&r.entryStatus===i?n+1:n,0)}function uw({provisionalPositioning:t,placementGroup:e,drawDefinition:i,stageSequence:n,entryStatuses:r,structureId:a,roundTarget:o,stages:s,stage:l}){var c;let u=((c=i.entries)==null?void 0:c.reduce((d,p)=>{var h,f;let m=(f=(h=Bi({name:Ap,element:p}))==null?void 0:h.extension)==null?void 0:f.value,g=l&&p.entryStage===l||(s==null?void 0:s.length)&&p.entryStage&&s.includes(p.entryStage),v=!r||p.entryStatus&&r.includes(p.entryStatus),y=p.entryStageSequence??1;return g&&(!n||y===n)&&v&&(!o||!m||o===m)?d.concat(p):d},[]))??[];if(a&&l===Br){let{playoffEntries:d,error:p}=EHe({provisionalPositioning:t,drawDefinition:i,structureId:a});return p&&console.log("playoff entries error"),(d!=null&&d.length?d:u).filter(h=>!e||h.placementGroup===e)}return u}function EHe({provisionalPositioning:t,drawDefinition:e,structureId:i}){let n=[],r=(e.links??[]).find(a=>a.linkType===Ff&&a.target.structureId===i);if(r){let{finishingPositions:a,structureId:o}=r.source,{structure:s}=pi({drawDefinition:e,structureId:o});(s==null?void 0:s.structureType)===xs&&(s.structures??[]).forEach(l=>{let c=l.positionAssignments??[],{structureId:u}=l,d=u,p=Object.assign({},...c.map(m=>{var g;let{participantId:v}=m,y=(g=Bi({element:m,name:og}).extension)==null?void 0:g.value;return y&&v?{[v]:y}:void 0}).filter(Boolean)),h=Object.keys(p).reduce((m,g)=>{let v=p[g],y=v.groupOrder||t&&v.provisionalOrder;return m.includes(y)||m.push(y),m},[]).length===Object.keys(p).length,f=Object.keys(p).filter(m=>{let g=p[m],v=g.groupOrder||t&&g.provisionalOrder;return a==null?void 0:a.includes(v)});(!t||h)&&f.forEach(m=>{let g=p[m],{groupOrder:v,provisionalOrder:y,GEMscore:b}=g,I=v||t&&y,T=[...a??[]].sort(va).indexOf(I)+1;n.push({entryStage:Br,entryStatus:eR,placementGroup:T,groupingValue:d,participantId:m,GEMscore:b})})})}return{playoffEntries:n}}function CHe({stage:t,drawDefinition:e}){return Ly.reduce((i,n)=>(aj({drawDefinition:e,entryStatus:n,stage:t})||0)+i,0)}function Gc({provisionalPositioning:t,returnAllProxies:e,drawDefinition:i,structureId:n,structure:r}){var a;let o,s=[];r||({structure:r,error:o}=pi({drawDefinition:i,structureId:n}));let l=jn({structure:r}).positionAssignments;if(o||!r)return{seedAssignments:[],error:Dr};n||(n=r.structureId);let{stage:c,stageSequence:u}=r,d=c===Br&&i&&uw({provisionalPositioning:t,drawDefinition:i,stageSequence:u,structureId:n,stage:c}),p=d?d.filter(m=>m.placementGroup===1).sort((m,g)=>m.GEMscore<g.GEMscore&&1||m.GEMscore>g.GEMscore&&-1||0).map((m,g)=>{let v=g+1;return{participantId:m.participantId,seedValue:v,seedProxy:!0,seedNumber:v}}):[],h=p==null?void 0:p.slice(0,e?p.length:l.length/2);h.length?s=h:r.seedAssignments?s=r.seedAssignments:o=Pfe;let f=r.seedLimit??((a=r==null?void 0:r.positionAssignments)==null?void 0:a.length);return{seedAssignments:s,stageSequence:u,seedLimit:f,stage:c,error:o}}var Bge="WALKOVER",LZ="RETIRED",d6="COMPETITIVE",IE="ROUTINE",wE="DECISIVE",VN="winRatio",PHe=(t,e)=>(t||0)+(e||0);function $ge(t,e){let i=Array.isArray(t)?t[0]:t;return isNaN(i)&&Bge||i<=e[wE]&&wE||i<=e[IE]&&IE||d6}function Vge({score:t}){let e=(t==null?void 0:t.sets)||[],i=e.reduce((r,a)=>(r[0]+=a.side1Score||0,r[1]+=a.side2Score||0,r),[0,0]),n=e.reduce((r,a)=>(r[0]+=a.side1TiebreakScore||0,r[1]+=a.side2TiebreakScore||0,r),[0,0]);return n.reduce(PHe)&&(i[n[0]>n[1]?0:1]+=1),{sets:e,games:i,score:t}}function RHe(t){let e=Math.min(...t.games),i=Math.max(...t.games);return Math.round(e/i*100)}function jge(t){return t.map(RHe).sort().map(e=>parseFloat(e.toFixed(2)))}function Mn({onlySpecifiedPolicyTypes:t=!1,policyTypes:e=[],tournamentRecord:i,drawDefinition:n,structure:r,event:a}){if(!Array.isArray(e))return{error:X4};let o={};return i&&s(i),a&&s(a),n&&s(n),r&&s(r),{appliedPolicies:o,...ue};function s(l){var c,u;let d=(u=(c=l==null?void 0:l.extensions)==null?void 0:c.find(p=>p.name===hE))==null?void 0:u.value;if(d)for(let p of Object.keys(d))(t?e.includes(p):!e.length||e.includes(p))&&(o[p]=$t(d[p],!1,!0))}}function cm({policyTypes:t=[],tournamentRecord:e,drawDefinition:i,structure:n,event:r}){if(!Array.isArray(t))return{error:X4};let{appliedPolicies:a}=Mn({tournamentRecord:e,drawDefinition:i,structure:n,event:r}),o={};for(let s of t){let l=a==null?void 0:a[s];l&&(o[s]=l)}return Object.keys(o).length?{policyDefinitions:o}:{info:MS.message}}function Fy({tournamentRecord:t,drawDefinition:e,policyType:i,structure:n,event:r}){if(!t)return{error:it};let{appliedPolicies:a}=Mn({tournamentRecord:t,drawDefinition:e,structure:n,event:r});return a!=null&&a[i]?{policy:a[i]}:{info:MS==null?void 0:MS.message}}var MHe={[uf]:{policyName:"Competitive Bands Default",profileBands:{[wE]:20,[IE]:50}}},p6=MHe;function aR({tournamentRecord:t,profileBands:e,matchUp:i}){if(!i)return{error:cl};let{score:n,winningSide:r}=i;if(!r)return{error:Me};let a=!e&&t&&Fy({policyType:uf,tournamentRecord:t}).policy,o=e||(a==null?void 0:a.profileBands)||p6[uf].profileBands,s=Vge({score:n}),l=jge([s]),c=$ge(l,o),u=Array.isArray(l)?l[0]:l;return{...ue,competitiveness:c,pctSpread:u}}function Gge({matchUp:t}){var e,i,n;if(!t)return{error:cl};if(t&&!t.sides)return{error:Ws};if(t&&!t.hasContext)return{error:iL};let r=(e=t.sides??[])==null?void 0:e.map(c=>c==null?void 0:c.participantId).filter(Boolean),a=((i=t.sides)==null?void 0:i.filter(c=>{var u;return((u=c.participant)==null?void 0:u.participantType)===Ki}).map(c=>c.participantId).filter(Boolean))??[],o=(((n=t.sides??[])==null?void 0:n.map(c=>{var u;return(u=c.participant)==null?void 0:u.individualParticipants}).filter(Boolean))??[]).map(c=>(c??[]).map(u=>u==null?void 0:u.participantId).filter(Boolean)),s=[...a,...o.flat()].filter(Boolean)??[],l=ki(s.concat(r)).filter(Boolean)??[];return{nestedIndividualParticipantIds:o,allRelevantParticipantIds:l,individualParticipantIds:s,sideParticipantIds:r,...ue}}var E_="CHECK_IN",C_="CHECK_OUT",NHe="SCHEDULE",yU="SCHEDULE.ASSIGNMENT.VENUE",jf="SCHEDULE.ALLOCATION.COURTS",ay="SCHEDULE.ASSIGNMENT.COURT",h6="SCHEDULE.COURT.ORDER",bU="SCHEDULE.DATE",AHe="COMPLETED.DATE",Hge="SCHEDULE.ASSIGN.OFFICIAL",IU="SCHEDULE.TIME.SCHEDULED",ad="SCHEDULE.TIME.START",yf="SCHEDULE.TIME.STOP",oh="SCHEDULE.TIME.RESUME",Gf="SCHEDULE.TIME.END",f6="SCHEDULE.TIME.MODIFIERS",zge="TO_BE_ANNOUNCED",qge="NEXT_AVAILABLE",Wge="FOLLOWED_BY",Kge="AFTER_REST",Yge="RAIN_DELAY",_He="NOT_BEFORE",oj=[zge,qge,Wge,Kge,Yge],kHe="ELIGIBILITY",xHe="REGISTRATION",OHe="SUSPENSION",LHe="MEDICAL",FHe="PENALTY",Zge="SCALE",Xge="RATING",Jge="RANKING",m6="SEEDING",By="PUBLISH",Wu="PUBLIC",$y="STATUS",BHe="MODIFICATION",$He="RETRIEVAL",VHe="other",jHe={MUTUALLY_EXCLUSIVE_TIME_MODIFIERS:oj,AFTER_REST:Kge,ALLOCATE_COURTS:jf,ASSIGN_COURT:ay,ASSIGN_OFFICIAL:Hge,ASSIGN_VENUE:yU,CHECK_IN:E_,CHECK_OUT:C_,COMPLETED_DATE:AHe,COURT_ORDER:h6,ELIGIBILITY:kHe,END_TIME:Gf,FOLLOWED_BY:Wge,MEDICAL:LHe,MODIFICATION:BHe,NEXT_AVAILABLE:qge,NOT_BEFORE:_He,OTHER:VHe,PENALTY:FHe,PUBLIC:Wu,PUBLISH:By,RANKING:Jge,RATING:Xge,RAIN_DELAY:Yge,REGISTRATION:xHe,RESUME_TIME:oh,RETRIEVAL:$He,SCALE:Zge,SCHEDULE:NHe,SCHEDULED_DATE:bU,SCHEDULED_TIME:IU,SEEDING:m6,START_TIME:ad,STATUS:$y,STOP_TIME:yf,SUSPENSION:OHe,TIME_MODIFIERS:f6,TO_BE_ANNOUNCED:zge};function dw({matchUp:t}){if(!t)return{error:cl};if(!t.hasContext)return{error:iL};if(!t.sides||t.sides.filter(Boolean).length!==2)return{error:Ws};let{nestedIndividualParticipantIds:e,allRelevantParticipantIds:i,sideParticipantIds:n}=Gge({matchUp:t}),r=(t.timeItems??[]).filter(s=>(s==null?void 0:s.itemType)&&[E_,C_].includes(s.itemType)).sort((s,l)=>(s.createdAt?new Date(s.createdAt).getTime():0)-(l.createdAt?new Date(l.createdAt).getTime():0)),a=r.map(s=>s.itemValue).filter(s=>r.filter(l=>(l==null?void 0:l.itemValue)===s).reverse()[0].itemType===E_);e==null||e.forEach((s,l)=>{let c=n==null?void 0:n[l],u=(s==null?void 0:s.length)&&s.every(d=>a.includes(d));c&&u&&!a.includes(c)&&a.push(c)}),n==null||n.forEach((s,l)=>{a.includes(s)&&((e==null?void 0:e[l])??[]).forEach(c=>{c&&!a.includes(c)&&a.push(c)})});let o=n==null?void 0:n.reduce((s,l)=>a.includes(l)&&s,!0);return{allRelevantParticipantIds:i,allParticipantsCheckedIn:o,checkedInParticipantIds:a,...ue}}var Qge={[Mr]:[Mr,"S"],[Zn]:[Zn,"D"],[Jn]:[Jn,"T"],S:[Mr,"S"],D:[Zn,"D"],T:[Jn,"T"]},Hr=t=>e=>{let i=sr(e)&&(e==null?void 0:e.matchUpType)||qs(e)&&e;return i&&Qge[t].includes(i)};function Y1(t){var e;let{matchUpAverageTimes:i,matchUpFormat:n}=t||{},r=(i==null?void 0:i.map(({matchUpFormatCodes:o})=>o==null?void 0:o.filter(s=>s===n)).flat().filter(Boolean).sort((o,s)=>((o==null?void 0:o.length)||0)-((s==null?void 0:s.length)||0)))||[],a=r.includes(n)?n:r[0];return(e=i==null?void 0:i.find(({matchUpFormatCodes:o,averageTimes:s})=>(o==null?void 0:o.find(l=>a===l))&&s))==null?void 0:e.averageTimes}function Z1(t){var e;let{matchUpRecoveryTimes:i,averageMinutes:n,matchUpFormat:r}=t||{};return(e=i==null?void 0:i.find(({matchUpFormatCodes:a,averageTimes:o,recoveryTimes:s})=>{if(o&&n){let{greaterThan:l=0,lessThan:c=360}=o;if(n>l&&n<c)return!0}return(a==null?void 0:a.find(l=>l===r))&&s}))==null?void 0:e.recoveryTimes}function eve({timesBlockArray:t,categoryName:e,categoryType:i}){return t.filter(n=>Array.isArray(n)).map(n=>n.sort((r,a)=>{var o,s;return(((o=a.categoryNames)==null?void 0:o.length)||0)-(((s=r.categoryNames)==null?void 0:s.length)||0)}).find(({categoryTypes:r,categoryNames:a})=>!(a!=null&&a.length)&&!(r!=null&&r.length)||(a==null?void 0:a.includes(e))||(r==null?void 0:r.includes(i)))).find(Boolean)}function GHe({tournamentScheduling:t,eventScheduling:e,averageMinutes:i,defaultTiming:n,matchUpFormat:r,categoryName:a,categoryType:o,policy:s}){var l;let c=(e==null?void 0:e.matchUpRecoveryTimes)&&Z1({...e,averageMinutes:i,matchUpFormat:r}),u=(t==null?void 0:t.matchUpRecoveryTimes)&&Z1({...t,averageMinutes:i,matchUpFormat:r}),d=(s==null?void 0:s.matchUpRecoveryTimes)&&Z1({...s,averageMinutes:i,matchUpFormat:r}),p=[c,u,d,(l=s==null?void 0:s.defaultTimes)==null?void 0:l.recoveryTimes,n==null?void 0:n.recoveryTimes];return eve({categoryName:a,categoryType:o,timesBlockArray:p})}function HHe({matchUpFormat:t,categoryName:e,categoryType:i,defaultTiming:n,tournamentScheduling:r,eventScheduling:a,policy:o}){var s;let l=(a==null?void 0:a.matchUpAverageTimes)&&Y1({...a,matchUpFormat:t}),c=(r==null?void 0:r.matchUpAverageTimes)&&Y1({...r,matchUpFormat:t}),u=(o==null?void 0:o.matchUpAverageTimes)&&Y1({...o,matchUpFormat:t}),d=[l,c,u,(s=o==null?void 0:o.defaultTimes)==null?void 0:s.averageTimes,n==null?void 0:n.averageTimes];return eve({categoryName:e,categoryType:i,timesBlockArray:d})}function oR({tournamentRecord:t,categoryName:e,categoryType:i,event:n}){var r,a,o,s,l,c;e=e??((r=n==null?void 0:n.category)==null?void 0:r.categoryName)??((a=n==null?void 0:n.category)==null?void 0:a.ageCategoryCode),i=i??((o=n==null?void 0:n.category)==null?void 0:o.categoryType)??((s=n==null?void 0:n.category)==null?void 0:s.subType);let{policy:u}=Fy({policyType:Fg,tournamentRecord:t,event:n}),d=(l=t?Bi({element:t,name:Lf}).extension:void 0)==null?void 0:l.value,p=(c=n&&Bi({name:Lf,element:n}).extension)==null?void 0:c.value;return{scheduleTiming:{tournamentScheduling:d,eventScheduling:p,categoryName:e,categoryType:i,policy:u}}}var tve="DOUBLES_SINGLES",ive="SINGLES_DOUBLES",Tu="total",sj="participantConflict",Rm="matchUpConflict",nve="ISSUE_IDS",lv="CONFLICT",cv="WARNING",lj="ERROR",cj="ISSUE",jN="STATE",zHe={SINGLES_DOUBLES:ive,DOUBLES_SINGLES:tve,TOTAL:Tu,CONFLICT_MATCHUP_ORDER:Rm,CONFLICT_PARTICIPANTS:sj,SCHEDULE_ISSUE_IDS:nve,SCHEDULE_CONFLICT:lv,SCHEDULE_WARNING:cv,SCHEDULE_ERROR:lj,SCHEDULE_ISSUE:cj,SCHEDULE_STATE:jN},Mh="SINGLES",pI="SINGLES",xu="DOUBLES",ug="DOUBLES",Fa="TEAM",Hc="TEAM",qHe="AGE",WHe="RATING",KHe="BOTH",YHe={AGE:qHe,BOTH:KHe,DOUBLES:xu,DOUBLES_EVENT:ug,RATING:WHe,SINGLES:Mh,SINGLES_EVENT:pI,TEAM_EVENT:Hc,TEAM:Fa};function sR({defaultAverageMinutes:t=90,defaultRecoveryMinutes:e=0,tournamentRecord:i,matchUpFormat:n,categoryName:r,categoryType:a,eventType:o,event:s}){if(!i)return{error:it};o=o??(s==null?void 0:s.eventType)??pI;let l={averageTimes:[{minutes:{default:t}}],recoveryTimes:[{minutes:{default:e}}]},{scheduleTiming:c}=oR({tournamentRecord:i,categoryName:r,categoryType:a,event:s}),u={...c,matchUpFormat:n,categoryType:a,defaultTiming:l};return CL({eventType:o,timingDetails:u})}function CL({timingDetails:t,eventType:e}){let i=HHe(t),n=Object.keys((i==null?void 0:i.minutes)||{}),r=(i==null?void 0:i.minutes)&&((n==null?void 0:n.includes(e))&&i.minutes[e]||i.minutes.default),a=GHe({...t,averageMinutes:r}),o=Object.keys((a==null?void 0:a.minutes)||{}),s=(a==null?void 0:a.minutes)&&((o==null?void 0:o.includes(e))&&a.minutes[e]||a.minutes.default),l=Hr(pI)(e)?ive:tve,c=(a==null?void 0:a.minutes)&&((o==null?void 0:o.includes(l))&&a.minutes[l]||s);return{averageMinutes:r,recoveryMinutes:s,typeChangeRecoveryMinutes:c}}function DM(t){return t.createdAt?new Date(t.createdAt).getTime():0}function Vy({visibilityThreshold:t,timeItems:e,itemType:i}){let n=e.filter(a=>a&&a.itemType===i&&(!t||DM(a)<new Date(t).getTime())).sort((a,o)=>DM(a)-DM(o)).pop(),r=n&&DM(n);return{itemValue:n==null?void 0:n.itemValue,timeStamp:r}}function uj({visibilityThreshold:t,timeStamp:e,schedule:i,matchUp:n}){let{itemValue:r,timeStamp:a}=Vy({timeItems:(n==null?void 0:n.timeItems)||[],itemType:IU,visibilityThreshold:t});return!i||a&&e&&new Date(a).getTime()>new Date(e).getTime()?{scheduledTime:r}:i}function oy({visibilityThreshold:t,timeStamp:e,schedule:i,matchUp:n}){let{itemValue:r,timeStamp:a}=Vy({timeItems:(n==null?void 0:n.timeItems)||[],itemType:bU,visibilityThreshold:t});return!i||a&&e&&new Date(a).getTime()>new Date(e).getTime()?{scheduledDate:r}:i}function rve({visibilityThreshold:t,timeStamp:e,schedule:i,matchUp:n}){let{itemValue:r,timeStamp:a}=Vy({timeItems:(n==null?void 0:n.timeItems)||[],itemType:jf,visibilityThreshold:t});return!i||a&&e&&new Date(a).getTime()>new Date(e).getTime()?{allocatedCourts:$t(r,!1,!0)}:i}function ave({visibilityThreshold:t,timeStamp:e,schedule:i,matchUp:n}){let{itemValue:r,timeStamp:a}=Vy({timeItems:(n==null?void 0:n.timeItems)||[],itemType:ay,visibilityThreshold:t});return!i||a&&e&&new Date(a).getTime()>new Date(e).getTime()?{courtId:r}:i}function ove({visibilityThreshold:t,timeStamp:e,schedule:i,matchUp:n}){let{itemValue:r,timeStamp:a}=Vy({timeItems:(n==null?void 0:n.timeItems)||[],itemType:yU,visibilityThreshold:t});return!i||a&&e&&new Date(a).getTime()>new Date(e).getTime()?{venueId:r}:i}function g6({visibilityThreshold:t,timeStamp:e,schedule:i,matchUp:n}){let{itemValue:r,timeStamp:a}=Vy({timeItems:(n==null?void 0:n.timeItems)||[],itemType:f6,visibilityThreshold:t});return!i||a&&e&&new Date(a).getTime()>new Date(e).getTime()?{timeModifiers:r}:i}function Jy(t){if(Jme.test(t)){let e=P5();return new Date(`${e}T${t}`)}else return new Date(t)}function ZHe({matchUp:t}){if(!t)return{error:cl};if(!t.timeItems)return{error:c5};let e=t.timeItems.filter(n=>[ad,yf,oh,Gf].includes(n==null?void 0:n.itemType)).sort((n,r)=>Jy(n.itemValue).getTime()-Jy(r.itemValue).getTime()),i=e.reduce((n,r)=>{var a,o;let s,l=(a=r==null?void 0:r.itemType)==null?void 0:a.split("."),c=`SCHEDULE.TIME.${((o=r==null?void 0:r.itemType)==null?void 0:o.startsWith("SCHEDULE.TIME"))&&l[2]}`;switch(c){case ad:s=0;break;case Gf:if(n.lastValue&&[ad,oh].includes(n.lastType)){let u=Jy(r.itemValue).getTime()-Jy(n.lastValue).getTime();s=n.milliseconds+u}else s=n.milliseconds;break;case yf:if([ad,"SCHECULE.TIME.RESUME"].includes(n.lastType)){let u=Jy(r.itemValue).getTime()-Jy(n.lastValue).getTime();s=n.milliseconds+u}else s=n.milliseconds;break;default:s=n.milliseconds;break}return{milliseconds:s,lastType:c,lastValue:r.itemValue}},{milliseconds:0,lastType:void 0,lastValue:void 0});if([ad,oh].includes(i.lastType)){let n=new Date().getTime()-Jy(i.lastValue).getTime();i.milliseconds+=n}return{milliseconds:i.milliseconds,time:XHe(i.milliseconds),relevantTimeItems:e}}function XHe(t){let e=(i,n=2)=>("00"+i).slice(-n);return e(t/36e5|0)+":"+e(t%36e5/6e4|0)+":"+e(t%6e4/1e3|0)}function JHe({visibilityThreshold:t,timeStamp:e,schedule:i,matchUp:n}){let{itemValue:r,timeStamp:a}=Vy({timeItems:(n==null?void 0:n.timeItems)||[],itemType:h6,visibilityThreshold:t});return!i||a&&e&&new Date(a).getTime()>new Date(e).getTime()?{courtOrder:r}:i}function QHe({matchUp:t}){var e;let i=(t==null?void 0:t.timeItems)||[],n=r=>r.createdAt?new Date(r.createdAt).getTime():0;return{startTime:(e=i.reduce((r,a)=>{let o=a.itemType===ad&&a;return o&&(!r||n(o)<n(r))?o:r},void 0))==null?void 0:e.itemValue}}function eze(t=1){return Ct(0,t).map(xn)}function xn(){let t=[];for(let a=0;a<256;a++)t[a]=(a<16?"0":"")+a.toString(16);let e=Math.random()*4294967295|0,i=Math.random()*4294967295|0,n=Math.random()*4294967295|0,r=Math.random()*4294967295|0;return t[e&255]+t[e>>8&255]+t[e>>16&255]+t[e>>24&255]+"-"+t[i&255]+t[i>>8&255]+"-"+t[i>>16&15|64]+t[i>>24&255]+"-"+t[n&63|128]+t[n>>8&255]+"-"+t[n>>16&255]+t[n>>24&255]+t[r&255]+t[r>>8&255]+t[r>>16&255]+t[r>>24&255]}function lR(t){let{disableNotice:e,venue:i,context:n}=t;if(typeof i!="object")return{error:Me};let r=_p(t);i.venueId||(i.venueId=xn());let a;for(let o of Object.values(r)){let s=tze({disableNotice:!0,tournamentRecord:o,context:n,venue:i});if(s!=null&&s.error)return s;a=s.venue}return e||tn({topic:Y5,payload:{venue:i}}),qt({...ue,venue:a})}function tze({tournamentRecord:t,disableNotice:e,context:i,venue:n}){return t?n?(t.venues||(t.venues=[]),n.venueId||(n.venueId=xn()),t.venues.reduce((r,a)=>r||a.venueId===n.venueId,void 0)?{error:lme}:(i&&un({element:n,extension:{value:i,name:rge}}),t.venues.push(n),e||tn({payload:{venue:n,tournamentId:t.tournamentId},topic:Y5}),{...ue,venue:$t(n)})):{error:Ht,info:"missing venue"}:{error:it}}function um({tournamentRecords:t,tournamentRecord:e,venueId:i}){if(!e)return{error:it};if(!i)return{error:xg};let n=(e.venues??[]).reduce((r,a)=>a.venueId===i?a:r,void 0);if(!n&&t){let r=(zP({tournamentRecords:t}).linkedTournamentIds??[])[e.tournamentId];for(let a of r){let o=t[a],s=um({tournamentRecord:o,venueId:i});if(s.success&&s.venue)return lR({tournamentRecord:e,venue:s.venue}),{...ue,venue:n}}}return n?{...ue,venue:n}:{error:oU}}function v6({convertExtensions:t,...e}){let{tournamentRecords:i,tournamentRecord:n,venueId:r}=e,a=um({tournamentRecords:i,tournamentRecord:n,venueId:r});return $t(a,t,!0)}function pw({tournamentRecords:t,tournamentRecord:e,courtId:i}){if(!e)return{error:it};if(!i)return{error:iw};let n="findCourt",r,a;if((e.venues??[]).forEach(o=>{(o.courts??[]).forEach(s=>{s.courtId===i&&(r=s,a=o)})}),r)return{...ue,court:r,venue:a};if(t){let o=(zP({tournamentRecords:t}).linkedTournamentIds??[])[e.tournamentId];for(let s of o){let l=t[s],c=pw({tournamentRecord:l,courtId:i});if(c.success)return c.venue&&lR({tournamentRecord:e,venue:c.venue}),{...ue,court:r,venue:a}}}return fe({result:{error:LP},stack:n})}function sve(t){return $t(pw(t),!1,!0)}function PL({tournamentRecord:t,internalUse:e,courtId:i}){if(!t)return{error:it};if(!i)return{error:iw};let n=pw({tournamentRecord:t,courtId:i});if(n.error)return n;let r=n.court&&(({altitude:a,courtId:o,courtName:s,courtDimensions:l,latitude:c,longitude:u,surfaceCategory:d,surfaceType:p,surfacedDate:h,pace:f,notes:m})=>({altitude:a,courtId:o,courtName:s,courtDimensions:l,latitude:c,longitude:u,surfaceCategory:d,surfaceType:p,surfacedDate:h,pace:f,notes:m}))(n.court);return{...ue,courtInfo:$t(r,!1,e)}}function GS({tournamentRecord:t,venueId:e}){var i;if(!t)return{error:it};if(!e)return{error:xg};let n=um({tournamentRecord:t,venueId:e});if(n.error)return n;let r=(((i=n.venue)==null?void 0:i.courts)??[]).map(s=>(({courtInfo:l})=>({...l}))(PL({courtId:s.courtId,internalUse:!0,tournamentRecord:t}))),a=n.venue&&(({venueId:s,venueName:l,venueAbbreviation:c})=>({venueAbbreviation:c,venueName:l,venueId:s}))(n.venue),o=a&&{...a,courtsInfo:r};return{...ue,venueData:$t(o,!1,!0)}}function ize({matchUp:t}){var e;let i=(t==null?void 0:t.timeItems)||[],n=r=>r.createdAt?new Date(r.createdAt).getTime():0;return{endTime:(e=i.reduce((r,a)=>{let o=a.itemType===Gf&&a;return o&&(!r||n(o)>n(r))?o:r},void 0))==null?void 0:e.itemValue}}function Xr({event:t,eventId:e}){var i,n;if(!t)return{error:_n};let r=(i=Bi({name:Au,element:t}))==null?void 0:i.extension,a=e?$t(r==null?void 0:r.value,!1,!0):r==null?void 0:r.value;return e&&((n=t.drawDefinitions)==null||n.forEach(o=>{var s;(s=a==null?void 0:a.flights)==null||s.forEach(l=>{l.drawId===o.drawId&&Object.assign(l,{drawDefinition:o})})})),{flightProfile:a}}function Ks(t){let{tournamentRecord:e,eventId:i,drawId:n}=t,r="findEvent",a={},o=t.tournamentRecords??(e&&{[e.tournamentId]:e})??{},s=Object.values(o).map(({events:c,tournamentId:u})=>(c&&c.forEach(d=>{a[d.eventId]={tournamentId:u}}),c??[])).flat(),l;if(n){let c,u=s.find(d=>{var p,h,f;let m=((d==null?void 0:d.drawDefinitions)??[]).find(g=>g.drawId===n);if(m)c=m,l=a[d.eventId].tournamentId;else{let g=(f=(h=d&&((p=Xr({event:d}))==null?void 0:p.flightProfile))==null?void 0:h.flights)==null?void 0:f.find(v=>v.drawId===n);if(g)return l=a[d.eventId].tournamentId,{entries:g.drawEntries,drawName:g.drawName,tournamentId:l,drawId:n}}return m});if(u)return{event:u,drawDefinition:c,tournamentId:l}}if(i){let c=s.find(u=>(u==null?void 0:u.eventId)===i);if(c)l=a[c.eventId].tournamentId;else return{event:void 0,drawDefinition:void 0,...fe({result:{error:kl},stack:r})};return{event:c,drawDefinition:void 0,tournamentId:l}}return{event:void 0,drawDefinition:void 0,...fe({result:{error:_l},context:{drawId:n,eventId:i},stack:r})}}function RL(t){var e,i,n,r,a,o,s,l,c;let u=t.event,d=t.matchUpType,{scheduleVisibilityFilters:p,afterRecoveryTimes:h,tournamentRecord:f,usePublishState:m,scheduleTiming:g,matchUpFormat:v,publishStatus:y,matchUp:b}=t;if(!b)return{error:cl};if(h&&!b.matchUpType&&!t.matchUpType&&(u||f)&&b.drawId){let A=(e=u==null?void 0:u.drawDefinitions)==null?void 0:e.find(x=>x.drawId===b.drawId);!A&&f&&({drawDefinition:A,event:u}=Ks({tournamentRecord:f,drawId:b.drawId}));let _=b.structureId&&((i=A==null?void 0:A.structures)==null?void 0:i.find(({structureId:x})=>x===b.structureId));d=t.matchUpType||(_==null?void 0:_.matchUpType)||(A==null?void 0:A.matchUpType)||(u==null?void 0:u.eventType)!==Fa&&(u==null?void 0:u.eventType)}let{milliseconds:I,time:T}=ZHe({matchUp:b}),{startTime:w}=QHe({matchUp:b}),{endTime:S}=ize({matchUp:b}),D,{visibilityThreshold:E,eventIds:C,drawIds:P}=p??{};if((!C||C.includes(b.eventId))&&(!P||P.includes(b.drawId))){let A={matchUp:b,visibilityThreshold:E},{allocatedCourts:_}=rve(A),{scheduledTime:x}=uj(A),{scheduledDate:O}=oy(A),{venueId:B}=ove(A),{courtId:F}=ave(A),{courtOrder:G}=JHe(A),{timeModifiers:H}=g6(A),$,q,z,Z,Y,Q=b.matchUpType??d;if(g&&x&&h&&Q){let ae={matchUpFormat:b.matchUpFormat??v,...g};({averageMinutes:q=0,recoveryMinutes:z=0,typeChangeRecoveryMinutes:Z=0}=CL({timingDetails:ae,eventType:Q})),(q||z)&&($=S?il(rr(S),z):il(x,q+z)),Z&&(Y=S?il(rr(S),Z):il(x,q+Z))}!O&&x&&(O=Ci(x));let X=v_({scheduledDate:O,scheduledTime:x}),oe={},re=((n=f&&B&&GS({tournamentRecord:f,venueId:B}))==null?void 0:n.venueData)||{};B&&(oe[B]=re);let{venueName:me,venueAbbreviation:se,courtsInfo:te}=re,he=(r=F&&(te==null?void 0:te.find(ae=>ae.courtId===F)))==null?void 0:r.courtName;for(let ae of _||[]){if(!f)break;ae.venueId&&!oe[ae.venueid]&&(oe[ae.venueId]=(a=GS({venueId:ae.venueId,tournamentRecord:f}))==null?void 0:a.venueData);let de=oe[ae.venueId];ae.venueName=de==null?void 0:de.venueName;let Ie=(o=de==null?void 0:de.courtsInfo)==null?void 0:o.find(De=>De.courtId===ae.courtId);ae.courtName=Ie==null?void 0:Ie.courtName}D=qt({typeChangeTimeAfterRecovery:Y,timeAfterRecovery:$,scheduledDate:O,scheduledTime:x,isoDateString:X,allocatedCourts:_,timeModifiers:H,venueAbbreviation:se,venueName:me,venueId:B,courtOrder:G,courtName:he,courtId:F,typeChangeRecoveryMinutes:Z,recoveryMinutes:z,averageMinutes:q,milliseconds:I,startTime:w,endTime:S,time:T})}else D=qt({milliseconds:I,startTime:w,endTime:S,time:T});let{scheduledDate:R}=oy({matchUp:b}),{scheduledTime:N}=uj({matchUp:b});if(m&&(s=y==null?void 0:y.displaySettings)!=null&&s.draws){let A=y.displaySettings.draws,_=(l=(A==null?void 0:A[b.drawId])??(A==null?void 0:A.default))==null?void 0:l.scheduleDetails;if(_){let x=(c=_.find(O=>{var B;return R&&((B=O.dates)==null?void 0:B.includes(R))})??_.find(O=>{var B;return!((B=O.dates)!=null&&B.length)}))==null?void 0:c.attributes;if(x){let O=Object.assign({},...Object.keys(D).map(B=>({[B]:!0})),x);D=sI({source:D,template:O})}}}let M=b.matchUpStatus&&Ga.includes(b.matchUpStatus)&&(Ci(S)||Ci(R)||Ci(N))||void 0;return{schedule:D,endDate:M}}function Nm(t){if(!t)return;let{tieFormatId:e,tieFormats:i}=t;if(t.tieFormat)return t.tieFormat;if(e&&Array.isArray(i))return i.find(n=>n.tieFormatId===e)}function X1({item:t,drawDefinition:e,structure:i,event:n}){var r,a,o;if(t){if(t.tieFormat)return t.tieFormat;if(t.tieFormatId)return e.tieFormat?e.tieFormat:((r=e.tieFormats)==null?void 0:r.find(s=>t.tieFormatId===s.tieFormatId))||(n.tieFormat?n.tieFormat:(a=n.tieFormats)==null?void 0:a.find(s=>t.tieFormatId===s.tieFormatId));if(i.tieFormat)return i.tieFormat;if(i.tieFormatId){let s=(o=e.tieFormats)==null?void 0:o.find(l=>i.tieFormatId===l.tieFormatId);if(s)return s}}}function ns({drawDefinition:t,structure:e,matchUp:i,event:n}){return{tieFormat:X1({item:i,drawDefinition:t,structure:e,event:n})||X1({item:e,drawDefinition:t,structure:e,event:n})||Nm(t)||Nm(n)}}function nze({matchUps:t}){let e=t.reduce((i,n)=>!n.collectionPosition||i.includes(n.collectionPosition)?i:i.concat(n.collectionPosition),[]).map(i=>({[i]:t.filter(n=>n.collectionPosition===i)}));return{collectionPositionMatchUps:Object.assign({},...e)}}function lve({groupedOrder:t,roundPositionsCount:e}){if(!t||(t==null?void 0:t.length)<=e)return t;let i=so(t,t.length/e).map(r=>r.reduce((a,o)=>a+o)),n=i.slice().sort(va);return i.map(r=>n.indexOf(r)+1)}function GN(t){if(!Array.isArray(t))return"";let e=t.filter(Lr);return e.length?ki([Math.min(...e),Math.max(...e)]).join("-"):""}function rze({drawDefinition:t,structureId:e,matchUpsMap:i}){if(!t)return{error:Lt};if(!e)return{error:lc};let{structure:n}=pi({drawDefinition:t,structureId:e});if((n==null?void 0:n.stage)!==Mo)return{error:Ay,info:"Structure is not CONSOLATION stage"};let{links:r}=t,a=(r==null?void 0:r.filter(d=>d.target.structureId===e))||[],o=(a==null?void 0:a.reduce((d,p)=>{let{structureId:h}=p.source;return d.includes(h)?d:d.concat(h)},[]))||[],s=Object.assign({},...o.map(d=>{let p=ry({structureId:d,matchUpsMap:i}),h=Rs({matchUps:p}).roundProfile;return{[d]:h}})),l=ry({matchUpsMap:i,structureId:e}),{roundProfile:c}=Rs({matchUps:l}),u={};return a==null||a.forEach(d=>{var p,h,f;let{structureId:m,roundNumber:g}=d.source,{feedProfile:v,groupedOrder:y,positionInterleave:b,roundNumber:I}=d.target,T=s[m],w=(p=T[1])==null?void 0:p.drawPositions,S=(h=T[g])==null?void 0:h.matchUpsCount;if(!S)return;let D=S?w.length/S:0,E=w.length/D,C=w.slice(),P=lve({roundPositionsCount:E,groupedOrder:y}),R=(P==null?void 0:P.length)||1;if(R<=E){let A=w.length/R,_=so(C,A);v===iy&&_.forEach(x=>x.reverse()),C=(P==null?void 0:P.length)&&(P==null?void 0:P.map(x=>_[x-1]).flat())||C}let N=so(C,D);if(b){let A=Ct(0,b.interleave).map(()=>{}),_=Ct(0,b.offset).map(()=>{});N=N.map(O=>[O,...A]),N.unshift(_),N=N.flat(1);let x=N.length-b.offset;N=N.slice(0,x)}u[I]||(u[I]={});let M=(f=c==null?void 0:c[I])!=null&&f.feedRound?2:1;N.forEach((A,_)=>{let x=1+_*M;u[I][x]||(u[I][x]=GN(A))})}),{sourceDrawPositionRanges:u}}function dm({policyDefinitions:t,tournamentRecord:e,contextProfile:i,drawDefinition:n,event:r}){let a={policies:{}};if(!i)return a;let o=cm({tournamentRecord:e,drawDefinition:n,event:r}).policyDefinitions;if(i.withCompetitiveness){let s=(t==null?void 0:t[uf])??(o==null?void 0:o[uf])??p6[uf];a.policies[uf]=s}return a}function aze({drawPositions:t,roundProfile:e,roundNumber:i}){var n;let r=[void 0,void 0];if(Ame(t))return{orderedDrawPositions:r,displayOrder:r};let a=e==null?void 0:e[i],o=((n=a==null?void 0:a.pairedDrawPositions)==null?void 0:n.find(l=>Ps(l||[],t.filter(Boolean))))??r,s=a==null?void 0:a.feedRound;if(Nme(t)){let l=[...t].sort(va);return{orderedDrawPositions:l.length===2?l:o,displayOrder:s?l:o}}if(s){let l=[t.find(c=>!isNaN(ai(c))),void 0];return{orderedDrawPositions:l,displayOrder:l}}return{orderedDrawPositions:o,displayOrder:o}}function P_({collectionPosition:t,collectionId:e,lineUp:i}){let n=[],r=[];if(i){let a=s=>s===void 0?-1:s,o=i.map(s=>{let{collectionAssignments:l,participantId:c}=s,u=l==null?void 0:l.find(d=>d.collectionPosition===t&&d.collectionId===e);return u&&{participantId:c,...u}}).filter(Boolean).sort((s,l)=>a(s.substitutionOrder)-a(l.substitutionOrder));for(let s of o){let{participantId:l,previousParticipantId:c,substitutionOrder:u}=s;n.includes(l)||(c&&r.push({previousParticipantId:c,substitutionOrder:u,participantId:l}),n=n.filter(d=>d!==c),n.push(l))}}return{assignedParticipantIds:n,substitutions:r}}function Ou({tournamentParticipants:t,tournamentRecord:e,participantIds:i}){let n="getPairedParticipant";if(!t&&!e)return{error:it};if(!Array.isArray(i)||i.length>2)return{error:wu};if(!i.length)return fe({result:{error:kg},stack:n});t=t??(e==null?void 0:e.participants)??[];let r=t.filter(s=>s.participantType===Ui&&Wr(i,s.individualParticipantIds).length===i.length&&s.individualParticipantIds.length===i.length),a=r[0];if(!a)return fe({result:{error:Jr},stack:n});let o=$t(r.slice(1),!1,!0);return{participant:$t(a),duplicatedPairParticipants:o,...ue}}function sy({drawDefinition:t,participantId:e}){if(typeof t!="object")return{error:Lt};if(typeof e!="string")return{error:Ra};let{extension:i}=Bi({element:t,name:Of});return{lineUp:((i==null?void 0:i.value)||{})[e]}}function oze({tournamentParticipants:t,positionAssignments:e,collectionPosition:i,drawPositions:n=[],participantMap:r,drawDefinition:a,collectionId:o,sideLineUps:s,matchUpType:l}){if(!o||!i)return{};let c=({attribute:d,lineUp:p,teamParticipant:h})=>{var f,m,g,v;let{assignedParticipantIds:y,substitutions:b}=P_({collectionPosition:i,collectionId:o,lineUp:p});if(l===Zn){if((y==null?void 0:y.length)<=2){let I=(m=(f=r==null?void 0:r[y[0]])==null?void 0:f.pairIdMap)==null?void 0:m[y[1]],T=(v=I&&((g=r[I])==null?void 0:g.participant)||Ou({participantIds:y,tournamentParticipants:t}).participant)==null?void 0:v.participantId;return{[d]:{participantId:T,teamParticipant:h,substitutions:b}}}else if((y==null?void 0:y.length)>2)return{[d]:{teamParticipant:h,substitutions:b}}}else{let I=y==null?void 0:y[0];return I&&{[d]:{participantId:I,teamParticipant:h,substitutions:b}}}};if(!(n!=null&&n.length)){let d=(s==null?void 0:s.map(p=>{var h;let{teamParticipant:f,sideNumber:m}=p,g=p.lineUp||((h=sy({participantId:f.teamParticipantId,drawDefinition:a}))==null?void 0:h.lineUp);return c({attribute:m,lineUp:g,teamParticipant:f})}).filter(Boolean))||{};return{sideNumberCollectionAssignment:Object.assign({},...d)}}let u=(n==null?void 0:n.map(d=>{var p,h,f;let m=(p=e.find(b=>b.drawPosition===d))==null?void 0:p.participantId,g=s==null?void 0:s.find(b=>(b==null?void 0:b.drawPosition)===d),v=(g==null?void 0:g.teamParticipant)||m&&((h=r==null?void 0:r[m])==null?void 0:h.participant)||(t==null?void 0:t.find(({participantId:b})=>b===m)),y=(g==null?void 0:g.lineUp)||((f=sy({participantId:m,drawDefinition:a}))==null?void 0:f.lineUp);return c({attribute:d,lineUp:y,teamParticipant:v})}).filter(Boolean))||{};return{drawPositionCollectionAssignment:Object.assign({},...u)}}function cve({drawDefinition:t}){if(typeof t!="object")return{error:_b};let e={},{structures:i=[],links:n=[]}=t||{},r=i.reduce((o,s)=>{let{stage:l}=s;return o[l]?o[l].push(s):o[l]=[s],o},{});for(let o of Object.keys(r)){let s=r[o].find(({stageSequence:c})=>c===1);if(!s)continue;let{structureId:l}=s;a({aggregator:{},targetRound:0,exitProfiles:e,exitProfile:"0",structureId:l,stage:o})}return{exitProfiles:e};function a({exitProfiles:o,exitProfile:s,structureId:l,targetRound:c,aggregator:u,stage:d}){o[l]||(o[l]=[]),s==="0"&&[Mo,Br].includes(d)||o[l].push(s);let p=n.filter(h=>h.source.structureId===l&&h.source.roundNumber>=c);for(let h of p){let f=h.source.roundNumber,m=h.target.roundNumber,g=h.target.structureId,v=i.find(b=>b.structureId===g).stage,y=[v,g,m,f].join("|");if(u[y])return;u[y]=!0,a({exitProfile:`${s}-${f}`,structureId:g,exitProfiles:o,targetRound:m,aggregator:u,stage:v})}}}function sze({drawDefinition:t,roundProfile:e,structureId:i,matchUpsMap:n}){var r;if(!t)return{error:Lt};if(!i)return{error:lc};if(!e){let s=ry({matchUpsMap:n,structureId:i});if({roundProfile:e}=Rs({matchUps:s}),!e)return{error:Ht}}let a=(Math.min(...((r=e==null?void 0:e[1])==null?void 0:r.drawPositions)??[])||1)-1,o=Object.keys(e);return{drawPositionsRanges:Object.assign({},...(o||[]).map(s=>{var l,c;let u=(l=e==null?void 0:e[s])==null?void 0:l.matchUpsCount,d=((c=e==null?void 0:e[1])==null?void 0:c.drawPositions)??[],p=so(d,d.length/u),h=p.map(GN),f=p.map(b=>b.map(I=>I-a)).map(GN),m=o.map(b=>{var I;if(b>s)return;let T=((I=e==null?void 0:e[b])==null?void 0:I.drawPositions)??[];return so(T,T.length/u)}).filter(Boolean),g=Ct(0,u).map(b=>m.map(I=>I[b]).flat().filter(Boolean).sort(va)).map(b=>ki(b)),v=g.map(b=>hGe(b).map(GN).join(", ")),y=Object.assign({},...Ct(0,u).map(b=>({[b+1]:{firstRoundDrawPositionsRange:h[b],firstRoundOffsetDrawPositionsRange:f[b],possibleDrawPositions:g[b],drawPositionsRange:v[b]}})));return{[s]:y}}))}}function y6({roundsNotPowerOf2:t,drawDefinition:e,structure:i,matchUps:n}){var r;if(!i)return!1;n=n??i.matchUps??[],t=t??Rs({matchUps:n}).roundsNotPowerOf2;let a=!!((r=i.positionAssignments)!=null&&r.find(({drawPosition:o})=>o))||!!(n!=null&&n.find(({drawPositions:o})=>o==null?void 0:o.length));return(!(e!=null&&e.drawType)||e.drawType!==ky)&&!(i!=null&&i.structures)&&t&&a}function Ll({structure:t}){if(!t)return!1;let e=t.matchUps||t.roundMatchUps&&Object.values(t.roundMatchUps).flat(),i=!!(e!=null&&e.find(r=>r==null?void 0:r.roundPosition)),n=!!(e!=null&&e.find(r=>{var a;return(a=r==null?void 0:r.drawPositions)==null?void 0:a.length}));return!(t!=null&&t.structures)&&(t==null?void 0:t.stage)!==to&&(!e.length||!i&&!n)}var b6={[kS]:{policyName:"Round Naming Default",namingConventions:{round:"Round",pre:"Pre"},qualifyingFinishMap:{1:"Final"},abbreviatedRoundNamingMap:{1:"F",2:"SF",4:"QF"},roundNamingMap:{1:"Final",2:"Semifinal",4:"Quarterfinal"},affixes:{roundNumber:"R",preFeedRound:"Q",preQualifying:"P"},stageConstants:{[Ft]:"",[Br]:"P",[Xt]:"Q",[Mo]:"C"}}},lze=b6;function cze({roundNamingPolicy:t,drawDefinition:e,structure:i,matchUps:n}){var r,a,o;let{roundProfile:s,roundMatchUps:l}=Rs({matchUps:n}),{structureAbbreviation:c,stage:u}=i,d=Ll({structure:i}),p=y6({structure:i}),h=i.structures,f={},m=b6[kS],g=i.stage===Xt,v=g?Math.max(...((e==null?void 0:e.structures)??[]).filter(A=>A.stage===Xt).map(({stageSequence:A})=>A??1),0):0,y=(i.stageSequence??1)<v?i.stageSequence??1:"",b=y&&(((r=t==null?void 0:t.affixes)==null?void 0:r.preQualifying)||m.affixes.preQualifying)||"",I=(t==null?void 0:t.roundNamingMap)||m.roundNamingMap||{},T=(t==null?void 0:t.abbreviatedRoundNamingMap)||m.abbreviatedRoundNamingMap||{},w=((a=t==null?void 0:t.affixes)==null?void 0:a.preFeedRound)||m.affixes.preFeedRound,S=((o=t==null?void 0:t.affixes)==null?void 0:o.roundNumber)||m.affixes.roundNumber,D=((t==null?void 0:t.namingConventions)||m.namingConventions).round,E=u&&u!==Ft?u[0]:"",C=(t==null?void 0:t.stageConstants)||m.stageConstants,P=u&&(C==null?void 0:C[u])||E,R=`${b}${P}${y}`,N=s?Object.keys(s):[],M=g&&C!=null&&C[Xt]?`${C==null?void 0:C[Xt]}-`:"";if(h||d||p)Object.assign(f,...N.map(A=>{let _=`${M}${D} ${A}`,x=`${S}${A}`;return{[A]:{roundName:_,abbreviatedRoundName:x}}}));else{let A=g&&((t==null?void 0:t.qualifyingFinishMap)||(m==null?void 0:m.qualifyingFinishMap)||{});Object.assign(f,...N.map(_=>{if(!(s!=null&&s[_]))return;let{matchUpsCount:x,preFeedRound:O}=s[_],B=x*2,F=(A==null?void 0:A[s==null?void 0:s[_].finishingRound])||A&&`${S}${B}`||I[x]||`${S}${B}`,G=O?`-${w}`:"",H=`${F}${G}`,$=[R,c,H].filter(Boolean).join("-"),q=`${T[x]||`${S}${B}`}${G}`,z=[R,c,q].filter(Boolean).join("-");return{[_]:{abbreviatedRoundName:z,roundName:$}}}))}return{roundNamingProfile:f,roundProfile:s,roundMatchUps:l}}function ML(t){var e,i,n;let r=mn(t,[{[Og]:!0}]);if(r.error)return r;let a=t==null?void 0:t.matchUp,o=a==null?void 0:a.matchUpType;if(!o&&(e=a==null?void 0:a.sides)!=null&&e.length){let s=(n=(i=a.sides.find(({participant:l})=>l))==null?void 0:i.participant)==null?void 0:n.participantType;o=s===Ki&&Mr||s===Ui&&Zn||s===Hn&&Hn||void 0}return{matchUpType:o}}var uze="normal",FZ="timed",dze="final",I6="NOAD",HN="SET",pze={S:uze,F:dze};function Zs(t){if(typeof t=="string"){let e=t.startsWith("T")&&FZ||t.startsWith(HN)&&HN||"";if(e===FZ){let i=dve(t),n={simplified:!0,setFormat:i,bestOf:1};if(i)return n}if(e===HN)return hze(t)}}function hze(t){let e=t.split("-"),i=cR(e[0].slice(3)),n=i===1||i%2!==0?i:void 0,r=i!==1&&i%2===0?i:void 0,a=e&&BZ(e[1]),o=e&&BZ(e[2]),s=a&&a.timed||o&&o.timed,l=n&&n<6||s&&r,c=!e[2]||o,u=a,d=qt({setFormat:a,exactly:r,bestOf:n});if(o&&(d.finalSetFormat=o),l&&u&&c)return d}function BZ(t){if((t==null?void 0:t[1])===":"){let e=t.split(":"),i=pze[e[0]],n=e[1];if(i&&n){if(n.startsWith("TB")){let f=$Z(n);return f===!1?!1:typeof f=="object"?{tiebreakSet:f}:void 0}if(n.startsWith("T"))return dve(n);let r=t.match(/^[FS]:(\d+)([A-Za-z]*)/),a=r&&pve(r[2])||!1,o=!(r!=null&&r[2])||a,s=r?cR(r[1]):void 0,l=uve(n),c=l!==!1,u=c&&l||s,d=$Z(n.split("/")[1]),p=d!==!1,h={setTo:s};return a&&(h.NoAD=!0),d?(h.tiebreakFormat=d,h.tiebreakAt=u):h.noTiebreak=!0,s&&o&&p&&c&&h||!1}}}function uve(t,e=!0){let i=(t==null?void 0:t.indexOf("@"))>0&&t.split("@");if(i)return(e?cR(i[1]):i[1])||!1}function $Z(t){if(t)if(t.startsWith("TB")){let e=uve(t,!1),i=t.match(/^TB(\d+)([A-Za-z]*)/),n=i==null?void 0:i[1],r=i&&pve(i[2]),a=!(i!=null&&i[2])||r,o=cR(n);if(o&&a){let s={tiebreakTo:o};return e&&typeof e=="string"&&!bi(e)&&(s.modifier=e),r&&(s.NoAD=!0),s}else return!1}else return!1}function dve(t){var e;let i=t.slice(1),n=i.match(/^(\d+)(@?[A-Za-z]*)/),r=cR(n==null?void 0:n[1]);if(!r)return;let a={timed:!0,minutes:r},o=n==null?void 0:n[2],s=[void 0,"P","G"].includes(o);if(o&&!s){let l=(e=i.match(/^(\d+)(@)([A-Za-z]+)$/))==null?void 0:e[3];return l?(a.modifier=l,a):void 0}return o&&(a.based=n[2]),a}function pve(t){return t&&t.indexOf(I6)>=0}function cR(t){return isNaN(Number(t))?0:Number(t)}function NL(t,e){return!Array.isArray(t)||!qs(e)?!1:Wr(t,Qge[e]).length}function gb(t){let{matchUps:e,isCollectionMatchUp:i,excludeMatchUpStatuses:n,matchUpStatuses:r,hasWinningSide:a,matchUpFormats:o,roundPositions:s,matchUpFormat:l,collectionIds:c,isMatchUpTie:u,roundNumbers:d,matchUpIds:p,roundNames:h,stageSequences:f,scheduledDates:m,scheduledDate:g,participantIds:v,processContext:y,tournamentIds:b,matchUpTypes:I,structureIds:T,readyToScore:w,courtIds:S,eventIds:D,venueIds:E,drawIds:C,stages:P,filterMatchUpIds:R=!0,filterMatchUpTypes:N=!0}=t,M=Array.isArray(v)?v.filter(Boolean):[],A=Array.isArray(r)?r.filter(Boolean):[],_=Array.isArray(n)?n.filter(Boolean):[],x=Array.isArray(P)?P.filter(Boolean):[],O=Array.isArray(f)?f.filter(Boolean):[],B=Array.isArray(c)?c.filter(Boolean):[],F=Array.isArray(h)?h.filter(Boolean):[],G=Array.isArray(d)?d.filter(Boolean):[],H=Array.isArray(s)?s.filter(Boolean):[],$=Array.isArray(p)&&R?p.filter(Boolean):[],q=Array.isArray(I)&&N?I.filter(Boolean):[],z=Array.isArray(S)?S.filter(Boolean):[],Z=Array.isArray(E)?E.filter(Boolean):[],Y=Array.isArray(o)&&o.filter(Boolean)||typeof l=="string"&&[l]||[],Q=Array.isArray(m)&&m.filter(Boolean)||typeof g=="string"&&g.length&&[g]||[],X=Array.isArray(b)?b.filter(Boolean):[],oe=Array.isArray(D)?D.filter(Boolean):[],re=Array.isArray(C)?C.filter(Boolean):[],me=Array.isArray(T)?T.filter(Boolean):[];return e.filter(se=>{var te;if(w&&!Hr(Ip)(se)&&!se.readyToScore||se.winningSide&&a&&![1,2].includes(se.winningSide)||u!==void 0&&(u&&!se.tieMatchUps||!u&&se.tieMatchUps)||i!==void 0&&(i&&!se.collectionId||!i&&se.collectionId)||x.length&&!x.includes(se.stage)||O.length&&!O.includes(se.stageSequence)||B.length&&(!se.collectionId||!B.includes(se.collectionId))||F.length&&(!se.roundName||!F.includes(se.roundName))||G.length&&(!se.roundNumber||!G.includes(se.roundNumber))||H.length&&(!se.roundPosition||!H.includes(se.roundPosition))||A.length&&(!se.matchUpStatus||!A.includes(se.matchUpStatus))||_.length&&se.matchUpStatus&&_.includes(se.matchUpStatus)||$.length&&!$.includes(se.matchUpId)||q.length&&(!se.matchUpType||!NL(q,se.matchUpType))||Y.length&&(!se.matchUpFormat||!Y.includes(se.matchUpFormat)))return!1;if(Q!=null&&Q.length){let{scheduledTime:he}=uj({matchUp:se}),{scheduledDate:ae}=oy({matchUp:se}),de=Ci(he)||ae;if(!Q.find(Ie=>Uh(Ie,de)))return!1}if(z.length){let{courtId:he}=ave({matchUp:se}),{allocatedCourts:ae}=rve({matchUp:se}),de=ae==null?void 0:ae.map(({courtId:Ie})=>Ie);if(!z.filter(Boolean).includes(he)||de!=null&&de.includes(he))return!1}if(Z.length){let{venueId:he}=ove({matchUp:se});if(!Z.filter(Boolean).includes(he))return!1}if(y){if(X.length&&!X.includes(se.tournamentId)||oe.length&&!oe.includes(se.eventId)||re.length&&!re.includes(se.drawId)||me.length&&!me.includes(se.structureId))return!1;if(M.length){let he=((te=se.sides)==null?void 0:te.map(({participantId:ae})=>ae).filter(Boolean))??[];if(!M.some(ae=>he.includes(ae)))return!1}}return!0})}function fze({drawPositionCollectionAssignment:t,sideNumberCollectionAssignment:e,positionAssignments:i,displaySideNumber:n,seedAssignments:r,drawPosition:a,isFeedRound:o,sideNumber:s}){var l,c,u,d;let p=i.find(v=>v.drawPosition&&v.drawPosition===a),h=a&&t,f=s&&e,m=h?(l=h[a])==null?void 0:l.participantId:p==null?void 0:p.participantId,g=p?mze({displaySideNumber:n,seedAssignments:r,participantId:m,assignment:p,sideNumber:s}):{...f==null?void 0:f[s]};if(o&&(s===1?Object.assign(g,{participantFed:!0}):Object.assign(g,{participantAdvanced:!0})),a&&h){let v=(c=h[a])==null?void 0:c.teamParticipant,y=(u=h[a])==null?void 0:u.participant,b=(d=h[a])==null?void 0:d.substitutions;y&&(g.participant=y),b&&(g.substitutions=b),v&&(g.teamParticipant=v)}return g}function mze({displaySideNumber:t,seedAssignments:e,participantId:i,assignment:n,sideNumber:r}){let a={drawPosition:n.drawPosition,displaySideNumber:t,sideNumber:r};if(i){let o=gze({seedAssignments:e,participantId:i});Object.assign(a,o,{participantId:i})}else n.bye&&Object.assign(a,{bye:!0});return n.qualifier&&Object.assign(a,{qualifier:!0}),a}function gze({seedAssignments:t,participantId:e}){return t==null?void 0:t.find(i=>!i.seedProxy&&i.participantId===e)}var wp="ANY",Yn="MALE",El="MIXED",vb="OTHER",Ir="FEMALE",w6={ANY:wp,MALE:Yn,FEMALE:Ir,MIXED:El,OTHER:vb};function Sn({scheduleVisibilityFilters:t,tournamentAppliedPolicies:e,provisionalPositioning:i,tournamentParticipants:n,afterRecoveryTimes:r,policyDefinitions:a,tournamentRecord:o,seedAssignments:s,usePublishState:l,contextFilters:c,contextContent:u,matchUpFilters:d,participantMap:p,scheduleTiming:h,contextProfile:f,drawDefinition:m,publishStatus:g,context:v={},exitProfiles:y,matchUpsMap:b,structure:I,inContext:T,event:w}){var S,D,E,C,P;let R={},N={};if(n=n??(o==null?void 0:o.participants),!I)return{collectionPositionMatchUps:R,error:_g,roundMatchUps:N,matchUps:[]};let M=Array.isArray(d==null?void 0:d.eventIds)?d==null?void 0:d.eventIds.filter(Boolean):[],A=Array.isArray(d==null?void 0:d.structureIds)?d==null?void 0:d.structureIds.filter(Boolean):[],_=Array.isArray(d==null?void 0:d.drawIds)?d==null?void 0:d.drawIds.filter(Boolean):[],x=!(v!=null&&v.eventId)||!(M!=null&&M.length)&&!((S=c==null?void 0:c.eventIds)!=null&&S.filter(Boolean).length)||(M==null?void 0:M.includes(v.eventId))||((D=c==null?void 0:c.eventIds)==null?void 0:D.includes(v.eventId)),O=!(A!=null&&A.length)||A.includes(I.structureId),B=!m||!(_!=null&&_.length)||_.includes(m.drawId);if(!x||!O||!B)return{collectionPositionMatchUps:R,roundMatchUps:N,matchUps:[]};f&&!u&&(u=dm({tournamentRecord:o,contextProfile:f,drawDefinition:m}));let{appliedPolicies:F}=Mn({drawDefinition:m}),G={...e,...F,...a},H=(E=G==null?void 0:G.scoring)==null?void 0:E.structures,$=I.stage&&(H==null?void 0:H.stage)&&(H==null?void 0:H.stage[I.stage]),q=I.stageSequence&&($==null?void 0:$.stageSequence)&&$.stageSequence[I.stageSequence],z=((C=G==null?void 0:G.scoring)==null?void 0:C.requireAllPositionsAssigned)||($==null?void 0:$.requireAllPositionsAssigned)||(q==null?void 0:q.requireAllPositionsAssigned);b||(b=ko({drawDefinition:m,structure:I}));let{positionAssignments:Z,allPositionsAssigned:Y}=Ha({structure:I}),Q=!z||Y,{seedAssignments:X}=Gc({provisionalPositioning:i,drawDefinition:m,structure:I});s=s??X;let{roundOffset:oe,structureId:re,structureName:me,stage:se,stageSequence:te}=I,{drawId:he,drawName:ae,drawType:de}=m??{};y=y||m&&cve({drawDefinition:m}).exitProfiles;let Ie=y==null?void 0:y[re],De=(Ie==null?void 0:Ie.length)&&(Ie[0].split("-").map(Pe=>parseInt(Pe)).reduce((Pe,et)=>Pe+et)||0),Te=!!I.structures,_e=ry({matchUpsMap:b,structureId:re,inContext:T}),Ve=G==null?void 0:G[kS],ot=cze({roundNamingPolicy:Ve,drawDefinition:m,structure:I,matchUps:_e}),{roundNamingProfile:St,roundProfile:nt}=ot;if(N=(ot==null?void 0:ot.roundMatchUps)??[],d&&(_e=gb({matchUps:_e,...d,filterMatchUpTypes:!1,filterMatchUpIds:!1})),T){let{sourceDrawPositionRanges:Pe}=rze({drawDefinition:m,matchUpsMap:b,structureId:re}),et=m?sze({drawDefinition:m,roundProfile:nt,matchUpsMap:b,structureId:re}).drawPositionsRanges:void 0;_e=_e.map(Ee=>Bt({scheduleVisibilityFilters:t,sourceDrawPositionRanges:Pe,drawPositionsRanges:et,roundNamingProfile:St,initialRoundOfPlay:De,appliedPolicies:G,usePublishState:l,publishStatus:g,isRoundRobin:Te,roundProfile:nt,matchUp:Ee,event:w})),(_e==null?void 0:_e.filter(Ee=>Array.isArray(Ee.tieMatchUps))).forEach(Ee=>{let lt=Ee.tieMatchUps;_e=_e.concat(...lt)}),c&&(_e=gb({processContext:!0,...c,matchUps:_e}))}else(_e==null?void 0:_e.filter(Pe=>Array.isArray(Pe.tieMatchUps))).forEach(Pe=>{let et=Pe.tieMatchUps;_e=_e.concat(...et)});return d&&(_e=gb({matchUps:_e,...d,filterMatchUpTypes:!1,filterMatchUpIds:!1})),(d!=null&&d.matchUpTypes||d!=null&&d.matchUpIds)&&(_e=gb({matchUpTypes:d.matchUpTypes,matchUpIds:d.matchUpIds,matchUps:_e})),(d!=null&&d.matchUpTypes||d!=null&&d.matchUpIds||T)&&(N=Rs({matchUps:_e}).roundMatchUps??[]),(P=ns({drawDefinition:m,structure:I,event:w}))!=null&&P.tieFormat&&({collectionPositionMatchUps:R}=nze({matchUps:_e})),{collectionPositionMatchUps:R,roundMatchUps:N,isRoundRobin:Te,roundProfile:nt,matchUpsMap:b,matchUps:_e};function Bt({scheduleVisibilityFilters:Pe,sourceDrawPositionRanges:et,drawPositionsRanges:Ee,initialRoundOfPlay:lt,additionalContext:Ke,roundNamingProfile:bt,tieDrawPositions:gt,appliedPolicies:Ue,isCollectionBye:xe,usePublishState:We,publishStatus:st,matchUpTieId:vt,isRoundRobin:ge,roundProfile:Se,sideLineUps:qe,matchUp:$e,event:ke}){var Ut,pt,tt,At,ei,vi,Ln,gn,Jt,kr,Kn,Gt,Ji,xo,na;Ke=Ke??{};let ra=(Ut=ns({drawDefinition:m,structure:I,matchUp:$e,event:ke}))==null?void 0:Ut.tieFormat,vo=ra==null?void 0:ra.collectionDefinitions,aa=$e.collectionId&&(vo==null?void 0:vo.find(xi=>xi.collectionId===$e.collectionId)),fr=$e.collectionId?aa==null?void 0:aa.matchUpFormat:$e.matchUpFormat??(I==null?void 0:I.matchUpFormat)??(m==null?void 0:m.matchUpFormat)??(ke==null?void 0:ke.matchUpFormat),Ma=$e.matchUpType||(aa==null?void 0:aa.matchUpType)||(I==null?void 0:I.matchUpType)||(m==null?void 0:m.matchUpType)||!Hr(Fa)(ke==null?void 0:ke.eventType)&&(ke==null?void 0:ke.eventType),tu=xe?yn:$e.matchUpStatus,{schedule:Zo,endDate:Xs}=RL({scheduleVisibilityFilters:Pe,afterRecoveryTimes:r,tournamentRecord:o,usePublishState:We,scheduleTiming:h,matchUpFormat:fr,publishStatus:st,matchUpType:Ma,matchUp:$e,event:ke}),Os=gt??$e.drawPositions??[],{collectionPosition:Qi,collectionId:za,roundPosition:Pr}=$e,Vi=$e.roundNumber??Ke.roundNumber,Ls=za?oze({tournamentParticipants:n,positionAssignments:Z,collectionPosition:Qi,drawDefinition:m,participantMap:p,drawPositions:Os,collectionId:za,sideLineUps:qe,matchUpType:Ma}):void 0,hl=((pt=bt==null?void 0:bt[Vi])==null?void 0:pt.roundName)||Ke.roundName,Fs=((tt=bt==null?void 0:bt[Vi])==null?void 0:tt.abbreviatedRoundName)||Ke.abbreviatedRoundName,mt=(At=Se==null?void 0:Se[Vi])==null?void 0:At.feedRound,hi=(ei=Se==null?void 0:Se[Vi])==null?void 0:ei.preFeedRound,Nn=(vi=Se==null?void 0:Se[Vi])==null?void 0:vi.roundFactor,xr=Ee==null?void 0:Ee[Vi],cs=Pr?xr==null?void 0:xr[Pr]:void 0,pn=et==null?void 0:et[Vi],Un=aa!=null&&aa.category?{...(v==null?void 0:v.category)||{},...aa.category}:(v==null?void 0:v.category)??(ke==null?void 0:ke.category),mr=((Ln=$e.processCodes)==null?void 0:Ln.length)&&$e.processCodes||((gn=aa==null?void 0:aa.processCodes)==null?void 0:gn.length)&&(aa==null?void 0:aa.processCodes)||((Jt=I==null?void 0:I.processCodes)==null?void 0:Jt.length)&&(I==null?void 0:I.processCodes)||((kr=m==null?void 0:m.processCodes)==null?void 0:kr.length)&&(m==null?void 0:m.processCodes)||((Kn=ke==null?void 0:ke.processCodes)==null?void 0:Kn.length)&&(ke==null?void 0:ke.processCodes)||(o==null?void 0:o.processCodes),Vl=(f==null?void 0:f.withCompetitiveness)&&aR({...u,matchUp:$e}),Dn=$e.finishingPositionRange??Ke.finishingPositionRange,Na=xi=>qt(xi,void 0,!0),Yi={...Na(v),...Na({matchUpFormat:$e.matchUpType===Fa?void 0:fr,tieFormat:$e.matchUpType!==Fa?void 0:ra,gender:(aa==null?void 0:aa.gender)??(ke==null?void 0:ke.gender),roundOfPlay:se!==Xt&&bi(lt)&&lt+(Vi||0),endDate:$e.endDate??Xs,discipline:ke==null?void 0:ke.discipline,category:Un,finishingPositionRange:Dn,abbreviatedRoundName:Fs,drawPositionsRange:cs,competitiveProfile:Vl,structureName:me,stageSequence:te,drawPositions:Os,matchUpStatus:tu,processCodes:mr,isRoundRobin:ge,matchUpTieId:vt,preFeedRound:hi,matchUpType:Ma,roundFactor:Nn,roundOffset:oe,structureId:re,roundNumber:Vi,feedRound:mt,roundName:hl,drawName:ae,drawType:de,schedule:Zo,drawId:he,stage:se}),...$t(Na($e),!0,!0)};if(fr&&(Gt=$e.score)!=null&&Gt.scoreStringSide1){let xi=Zs(fr),{bestOf:vr,finalSetFormat:_t,setFormat:oi}=xi??{};(_t!=null&&_t.tiebreakSet||oi!=null&&oi.tiebreakSet||oi!=null&&oi.timed)&&(Yi.score.sets=Yi.score.sets.sort((Oi,nn)=>Oi.setNumber-nn.setNumber).map((Oi,nn)=>(nn+1===vr?(_t!=null&&_t.tiebreakSet||_t!=null&&_t.timed)&&(Oi.tiebreakSet=!0):(oi!=null&&oi.tiebreakSet||oi!=null&&oi.timed)&&(Oi.tiebreakSet=!0),Oi)))}if(Array.isArray(Os)){let{orderedDrawPositions:xi,displayOrder:vr}=aze({drawPositions:Os,roundProfile:Se,roundNumber:Vi}),_t=(Ji=Se==null?void 0:Se[Vi])==null?void 0:Ji.feedRound,oi=vr[0]!==xi[0],Oi=xi.concat(void 0,void 0).slice(0,2).map((nn,si)=>{var ji;let ur=si+1,Mi=oi?3-ur:ur,Sa=fze({...Ls,positionAssignments:Z,displaySideNumber:Mi,seedAssignments:s,drawPosition:nn,isFeedRound:_t,sideNumber:ur}),jl=(ji=$e.sides)==null?void 0:ji.find(Bs=>Bs.sideNumber===ur),Xo=Pr?(Pr-1)*2+si+1:void 0,Aa=Xo?pn==null?void 0:pn[Xo]:void 0;return Na({sourceDrawPositionRange:Aa,...jl,...Sa})});Object.assign(Yi,$t({sides:Oi},!0,!0))}if(n&&Yi.sides){let xi=Ue==null?void 0:Ue[pU],vr=_t=>{var oi;let Oi=(oi=p==null?void 0:p[_t])==null?void 0:oi.participant;return Oi&&sI({template:xi==null?void 0:xi.participant,source:Oi})};if(Yi.sides.filter(Boolean).forEach(_t=>{var oi,Oi,nn;if(_t.participantId){let si=$t(vr(_t.participantId)||n&&ag({policyDefinitions:Ue,participantId:_t.participantId,tournamentParticipants:n,internalUse:!0,contextProfile:f}),void 0,!0);if(si){if(m!=null&&m.entries){let ji=m.entries.find(ur=>ur.participantId===_t.participantId);ji!=null&&ji.entryStatus&&(si.entryStatus=ji.entryStatus),ji!=null&&ji.entryStage&&(si.entryStage=ji.entryStage)}Object.assign(_t,{participant:si})}}if((Oi=(oi=_t==null?void 0:_t.participant)==null?void 0:oi.individualParticipantIds)!=null&&Oi.length&&!((nn=_t.participant.individualParticipants)!=null&&nn.length)){let si=_t.participant.individualParticipantIds.map(ji=>vr(ji)||n&&ag({policyDefinitions:Ue,tournamentParticipants:n,internalUse:!0,contextProfile:f,participantId:ji}));Object.assign(_t.participant,{individualParticipants:si})}}),!Yi.matchUpType){let{matchUpType:_t}=ML({matchUp:Yi});_t&&Object.assign(Yi,{matchUpType:_t})}if(f!=null&&f.inferGender&&(!Yi.gender||Yi.gender===El)&&((xo=Yi.sides)==null?void 0:xo.length)===2&&Yi.matchUpType!==Fa){let _t=Yi.sides.map(oi=>{var Oi,nn,si,ji;if(Hr(Mr)(Yi.matchUpType))return(nn=(Oi=oi.participant)==null?void 0:Oi.person)==null?void 0:nn.sex;if(((ji=(si=oi.participant)==null?void 0:si.individualParticipants)==null?void 0:ji.length)===2){let ur=ki(oi.participant.individualParticipants.map(Mi=>{var Sa;return(Sa=Mi.person)==null?void 0:Sa.sex})).filter(Boolean);if(ur.length===1)return ur[0]}});if(_t.filter(Boolean).length===2&&ki(_t).length===1){let oi=_t[0];Yi.inferredGender=oi}}}if(Yi.tieMatchUps){let xi=Yi.matchUpStatus===yn,vr=(na=Yi.sides)==null?void 0:na.map(({participant:_t,drawPosition:oi,sideNumber:Oi,lineUp:nn})=>{let si=(_t==null?void 0:_t.participantType)===Fa&&_t;return{teamParticipant:si&&qt({participantRoleResponsibilities:si.participantRoleResponsibilities,participantOtherName:si.participanOthertName,participantName:si.participantName,participantId:si.participantId,teamId:si.teamId}),drawPosition:oi,sideNumber:Oi,lineUp:nn}});Yi.tieMatchUps=Yi.tieMatchUps.map(_t=>{let oi=Yi.matchUpId,Oi={finishingPositionRange:Yi.finishingPositionRange,abbreviatedRoundName:Fs,roundNumber:Vi,roundName:hl};return Bt({tieDrawPositions:Os,scheduleVisibilityFilters:Pe,sourceDrawPositionRanges:et,sideLineUps:vr,drawPositionsRanges:Ee,initialRoundOfPlay:lt,roundNamingProfile:bt,additionalContext:Oi,appliedPolicies:Ue,isCollectionBye:xi,usePublishState:We,publishStatus:st,matchUpTieId:oi,isRoundRobin:ge,roundProfile:Se,matchUp:_t,event:ke})})}let Di=Yi.sides&&Yi.sides.filter(xi=>xi==null?void 0:xi.participantId).length===2,gr=!Yi.winningSide;if(Object.assign(Yi,{readyToScore:Q&&Di&&gr,hasContext:!0}),Di){let{allParticipantsCheckedIn:xi,checkedInParticipantIds:vr}=dw({matchUp:Yi});Object.assign(Yi,{allParticipantsCheckedIn:xi,checkedInParticipantIds:vr})}return Array.isArray(f==null?void 0:f.exclude)&&(f==null||f.exclude.forEach(xi=>delete Yi[xi])),Yi}}function _v({matchUp:t}){return t?Ga.includes(t==null?void 0:t.matchUpStatus)||(t==null?void 0:t.winningSide):!1}function AL({requireParticipants:t=!0,scheduleVisibilityFilters:e,tournamentAppliedPolicies:i,tournamentParticipants:n,afterRecoveryTimes:r,policyDefinitions:a,tournamentRecord:o,usePublishState:s,matchUpFilters:l,contextFilters:c,contextContent:u,participantMap:d,scheduleTiming:p,publishStatus:h,contextProfile:f,drawDefinition:m,exitProfiles:g,matchUpsMap:v,structureId:y,inContext:b,structure:I,context:T,event:w}){!I&&y&&({structure:I}=pi({drawDefinition:m,structureId:y}));let S=Sn({tournamentAppliedPolicies:i,scheduleVisibilityFilters:e,tournamentParticipants:n,afterRecoveryTimes:r,policyDefinitions:a,tournamentRecord:o,usePublishState:s,matchUpFilters:l,contextFilters:c,contextContent:u,participantMap:d,scheduleTiming:p,publishStatus:h,contextProfile:f,drawDefinition:m,exitProfiles:g,matchUpsMap:v,structure:I,inContext:b,context:T,event:w}),D=[],E=[],C=[],P=[],R=[];if(S.error)return S;let{matchUps:N}=S,{assignedPositions:M}=Ha({structure:I}),A=M==null?void 0:M.filter(x=>x.participantId).map(x=>x.drawPosition),_;return N.filter(x=>{var O;let B=((O=l==null?void 0:l.matchUpTypes)==null?void 0:O.length)===1&&l.matchUpTypes[0]===Jn;return!(x.matchUpType!==Jn&&B)}).forEach(x=>{var O,B,F,G;if(x.matchUpStatus===ec){D.push(x);return}x.matchUpType===Jn&&(_=!0);let H=x.collectionId,$=H&&((O=x.sides)==null?void 0:O.every(X=>X.participantId)),q=!H&&((B=x.drawPositions)==null?void 0:B.filter(Boolean).length)===2,z=!H&&((F=x.drawPositions)==null?void 0:F.every(X=>A==null?void 0:A.includes(X))),Z=M==null?void 0:M.filter(X=>X.bye).map(X=>X.drawPosition),Y=!H&&((G=x.drawPositions)==null?void 0:G.find(X=>Z==null?void 0:Z.includes(X))),Q=vge.includes(x.matchUpStatus)&&($||q&&(!t||z));return Y?R.push(x):_v({matchUp:x})?E.push(x):Q?C.push(x):P.push(x)}),{includesTeamMatchUps:_,abandonedMatchUps:D,completedMatchUps:E,upcomingMatchUps:C,pendingMatchUps:P,byeMatchUps:R,structure:I}}function vze({drawDefinition:t,roundNumber:e,structureId:i}){if(!t)return{error:Lt};if(!i)return{error:lc};let{links:n}=wU({drawDefinition:t,structureId:i}),r=n.source.reduce((o,s)=>!s.source.roundNumber||s.source.roundNumber===e?o.concat(s):o,[]),a=n.target.reduce((o,s)=>!s.target.roundNumber||s.target.roundNumber===e?o.concat(s):o,[]);return{links:{source:r,target:a}}}function a$({finishingPositions:t,linkCondition:e,linkType:i,source:n}){var r;let a=n.find(o=>{var s,l;let c=!((s=o.source)!=null&&s.finishingPositions)||!t||Ps(t,(l=o.source)==null?void 0:l.finishingPositions);return e===o.linkCondition&&c&&o.linkType===i});return[Bf,Eh].includes(a==null?void 0:a.linkType)&&!((r=a==null?void 0:a.source)!=null&&r.roundNumber)?fe({result:{error:Me},stack:"getTargetLink",context:a}):a}function wU({drawDefinition:t,structureId:e,roundNumber:i}){return t?e?{links:(t.links||[]).filter(Boolean).reduce((n,r)=>{var a,o;return((a=r.source)==null?void 0:a.structureId)===e&&(!i||r.source.roundNumber===i)&&(n.source=n.source.concat(r)),((o=r.target)==null?void 0:o.structureId)===e&&(!i||r.target.roundNumber===i)&&(n.target=n.target.concat(r)),n},{source:[],target:[]})}:{error:lc}:{error:Lt}}function yze({structureMatchUps:t,matchUp:e}){let{roundNumber:i,roundPosition:n}=e,r=t.filter(o=>o.roundNumber===i&&!o.matchUpTieId),a=t.filter(o=>o.roundNumber===i+1&&!o.matchUpTieId);if(a.length){let o;return a.length===r.length?o=a.find(s=>s.roundPosition===n):a.length===r.length/2&&(o=a.find(s=>s.roundPosition===Math.ceil(n/2))),{matchUp:o}}return{message:"no progression found"}}function o$({sourceRoundMatchUpCount:t,inContextDrawMatchUps:e,sourceRoundPosition:i,drawDefinition:n,targetLink:r}){var a;if(!r)return{error:z4};let{target:{structureId:o,feedProfile:s,groupedOrder:l,roundNumber:c,positionInterleave:u}}=r,{structure:d}=pi({drawDefinition:n,structureId:o}),{positionAssignments:p}=jn({structure:d}),h=(e==null?void 0:e.filter(C=>C.structureId===(d==null?void 0:d.structureId))).filter(C=>C.roundNumber===c&&!C.matchUpTieId),f=h.length,m=Ct(1,f+1),g=f/t,v=Math.ceil(g*i),y=1-i%2;if(u!=null&&u.interleave&&g!==.5){let C=u.offset+(i-1)*u.interleave,P=i+C;v=Math.ceil(P/2),y=1-P%2}let b=m,I=m[v-1],T=lve({roundPositionsCount:m.length,groupedOrder:l}),w=(T==null?void 0:T.length)||1;if(w<=m.length){let C=f/w,P=so(m,C);s===iy&&P.forEach(R=>R.reverse()),b=(T==null?void 0:T.length)&&(T==null?void 0:T.map(R=>P[R-1]).flat())||b}s===gu?I=b[v-1]:s===iy?((!(T!=null&&T.length)||w>m.length)&&(v=h.length+1-v),I=b[v-1]):s===bL&&jc()&&console.log(aL,{feedProfile:s});let S=I&&h.reduce((C,P)=>P.roundPosition===I?P:C,void 0),D;S!=null&&S.feedRound?(y=0,D=Math.min(...(S.drawPositions||[]).filter(Boolean))):D=((a=S==null?void 0:S.drawPositions)==null?void 0:a.length)===2&&(S==null?void 0:S.drawPositions[y]);let E=p==null?void 0:p.find(({drawPosition:C})=>C===D);if(E){let{extension:C}=Bi({element:E,name:mL});if(C!=null&&C.value)return{disabledDrawPosition:D}}return{matchUp:S,targetDrawPosition:D,matchUpDrawPositionIndex:y}}function Ms({inContextDrawMatchUps:t=[],useTargetMatchUpIds:e,inContextMatchUp:i,drawDefinition:n,matchUpId:r}){let a=i;t.length&&!a&&(a=t.find(s=>s.matchUpId===r));let{structure:o}=pi({structureId:a==null?void 0:a.structureId,drawDefinition:n});return(o==null?void 0:o.finishingPosition)===lw?bze({inContextDrawMatchUps:t,useTargetMatchUpIds:e,drawDefinition:n,structure:o,matchUp:a}):Ize({matchUp:a})}function bze({inContextDrawMatchUps:t,useTargetMatchUpIds:e,drawDefinition:i,structure:n,matchUp:r}){var a,o,s;let{winnerMatchUpId:l,loserMatchUpId:c}=r,{links:u}=vze({roundNumber:r.roundNumber,structureId:n.structureId,drawDefinition:i}),d=u==null?void 0:u.source,p=a$({source:d,linkType:Bf}),h=a$({linkCondition:Ch,linkType:Eh,source:d}),f=a$({source:d,linkType:Eh}),m=h&&f;f||(f=h);let g=(a=p==null?void 0:p.target)==null?void 0:a.feedProfile,v=(o=f==null?void 0:f.target)==null?void 0:o.feedProfile,y=(s=h==null?void 0:h.target)==null?void 0:s.feedProfile,b,I,T,w,S,D,E,C,P,R;if(e&&(l||c)&&(E=l&&g!==rd&&t.find(({matchUpId:A})=>A===l),w=c&&v!==rd&&t.find(({matchUpId:A})=>A===c),E||w))return{matchUp:r,targetLinks:{loserTargetLink:f,winnerTargetLink:p},targetMatchUps:{loserMatchUp:w,winnerMatchUp:E}};let{roundPosition:N}=r;R=R||t.filter(A=>A.structureId===n.structureId);let M=R.reduce((A,_)=>_.roundNumber===r.roundNumber&&!_.matchUpTieId?A+1:A,0);return f&&!w&&v!==rd&&({matchUpDrawPositionIndex:D,targetDrawPosition:S,matchUp:w}=o$({targetLink:f,sourceRoundMatchUpCount:M,inContextDrawMatchUps:t,sourceRoundPosition:N,drawDefinition:i})),m&&y!==rd&&({matchUpDrawPositionIndex:T,targetDrawPosition:I,matchUp:b}=o$({targetLink:h,sourceRoundMatchUpCount:M,inContextDrawMatchUps:t,sourceRoundPosition:N,drawDefinition:i})),p&&!E&&g!==rd&&({matchUpDrawPositionIndex:P,targetDrawPosition:C,matchUp:E}=o$({targetLink:p,sourceRoundMatchUpCount:M,inContextDrawMatchUps:t,sourceRoundPosition:N,drawDefinition:i})),E||(R=R||t.filter(A=>A.structureId===n.structureId),{matchUp:E}=yze({structureMatchUps:R,matchUp:r})),qt({matchUp:r,targetLinks:{loserTargetLink:f,winnerTargetLink:p,byeTargetLink:h},targetMatchUps:{winnerMatchUpDrawPositionIndex:P,loserMatchUpDrawPositionIndex:D,byeMatchUpDrawPositionIndex:T,winnerTargetDrawPosition:C,loserTargetDrawPosition:S,byeTargetDrawPosition:I,winnerMatchUp:E,loserMatchUp:w,byeMatchUp:b},targetMatchUpIds:!!(l||c)})}function Ize({matchUp:t}){return{targetLinks:{loserTargetLink:void 0,winnerTargetLink:void 0},targetMatchUps:{loserMatchUp:void 0,winnerMatchUp:void 0},matchUp:t}}function wze({drawDefinition:t,inContextDrawMatchUps:e}){let i={};return e.forEach(n=>{var r,a,o,s,l,c;let{matchUpId:u,structureId:d,drawPositions:p=[]}=n,{structure:h}=pi({drawDefinition:t,structureId:d});if((h==null?void 0:h.finishingPosition)===gU){let{roundNumber:f}=n,m=f&&ai(f)+1,g=h.matchUps??[],{roundMatchUps:v}=Rs({matchUps:g});if(m&&v!=null&&v[m]){let y=[...p].sort(va).map((b,I)=>{let T=v[m].find(w=>{var S;return(S=w.drawPositions)==null?void 0:S.includes(b)});return{matchUpId:T==null?void 0:T.matchUpId,roundNumber:m,schedule:T==null?void 0:T.schedule,sideNumber:I+1,structureName:h.structureName}});Object.assign(n,{sidesTo:y})}}else{let f=Ms({useTargetMatchUpIds:!0,inContextDrawMatchUps:e,inContextMatchUp:n,drawDefinition:t,matchUpId:u}),{winnerMatchUp:m}=f.targetMatchUps,{loserMatchUp:g}=f.targetMatchUps;!n.winnerMatchUpId&&m&&(n.winnerMatchUpId=m.matchUpId),!n.loserMatchUpId&&g&&(n.loserMatchUpId=g.matchUpId);let v=s$({upcomingMatchUp:m}),y=s$({upcomingMatchUp:g});if(n.matchUpStatus!==yn&&(g==null?void 0:g.matchUpStatus)===yn){let{matchUp:I}=hve({matchUp:g,drawDefinition:t,inContextDrawMatchUps:e})||{};y=I&&s$({upcomingMatchUp:I})||y}let b=(r=n.schedule)==null?void 0:r.timeAfterRecovery;if(b&&((a=v==null?void 0:v.schedule)!=null&&a.scheduledTime&&on(v.schedule.scheduledTime)<on(b)&&(i[v.matchUpId]=n.matchUpId,v.schedule.scheduleConflict=n.matchUpId),(o=y==null?void 0:y.schedule)!=null&&o.scheduledTime&&on(y.schedule.scheduledTime)<on(b)&&(i[y.matchUpId]=n.matchUpId,y.schedule.scheduleConflict=n.matchUpId)),Object.assign(n,{winnerTo:v,loserTo:y}),(s=n.drawPositions)==null?void 0:s.filter(Boolean).length){let I=((c=(l=f.targetLinks)==null?void 0:l.loserTargetLink)==null?void 0:c.linkCondition)===Ch,T=Sze(n);if(T.length){let w=ij(m==null?void 0:m.sides),S=ij(g==null?void 0:g.sides),D=T.find(({participantId:C})=>w.includes(C))?[]:T,E=T.find(({participantId:C})=>S.includes(C))?[]:T;g&&I&&E.length<2&&E.push({bye:!0,tbd:!0}),D!=null&&D.length&&m&&(!f.targetMatchUpIds&&m&&(m=e.find(({matchUpId:C})=>C===m.matchUpId)),m.potentialParticipants||(m.potentialParticipants=[]),m.potentialParticipants.push(D)),E!=null&&E.length&&g&&(f.targetMatchUpIds||(m=e.find(({matchUpId:C})=>C===g.matchUpId)),g.potentialParticipants||(g.potentialParticipants=[]),g.potentialParticipants.push(E))}}}}),Object.keys(i).length&&e.forEach(n=>{Object.keys(i).includes(n.matchUpId)&&(n.schedule.scheduleConflict=i[n.matchUpId])}),{scheduleConflictMatchUpIds:i}}function Sze(t){var e;return((e=t==null?void 0:t.sides)==null?void 0:e.map(({participant:i,participantId:n,qualifier:r})=>i||n&&{participantId:n}||r&&{qualifier:r}).filter(Boolean))||[]}function hve({matchUp:t,drawDefinition:e,inContextDrawMatchUps:i}){var n;let{matchUpId:r,matchUpStatus:a,structureId:o}=t||{};if(!t||!o||(t==null?void 0:t.matchUpStatus)===Kr)return{matchUp:t};if(a===yn){let s;return t.winnerMatchUpId?s=i.find(({matchUpId:l})=>l===t.winnerMatchUpId):{winnerMatchUp:s}=((n=Ms({inContextDrawMatchUps:i,drawDefinition:e,matchUpId:r}))==null?void 0:n.targetMatchUps)||{},hve({matchUp:s,drawDefinition:e,inContextDrawMatchUps:i})}return{matchUp:void 0}}function s$(t){if(t!=null&&t.upcomingMatchUp)return(({matchUpId:e,structureId:i,schedule:n,roundNumber:r,roundPosition:a,structureName:o})=>({matchUpId:e,structureId:i,schedule:n,roundNumber:r,roundPosition:a,structureName:o}))(t.upcomingMatchUp)}function wa(t){let e="getAllDrawMatchUps";Object.assign(t,{requireParticipants:!1});let i=SU(t);if(i.error)return fe({result:i,stack:e});let{abandonedMatchUps:n,completedMatchUps:r,upcomingMatchUps:a,pendingMatchUps:o,byeMatchUps:s,matchUpsMap:l}=i;return{matchUps:(n??[]).concat(...r??[],...a??[],...o??[],...s??[]),matchUpsMap:l}}function SU(t){if(!(t!=null&&t.drawDefinition))return{error:Lt};let{tournamentParticipants:e,contextContent:i,matchUpsMap:n}=t,{scheduleVisibilityFilters:r,tournamentAppliedPolicies:a,requireParticipants:o,participantsProfile:s,afterRecoveryTimes:l,policyDefinitions:c,tournamentRecord:u,usePublishState:d,contextFilters:p,matchUpFilters:h,scheduleTiming:f,participantMap:m,publishStatus:g,contextProfile:v,drawDefinition:y,nextMatchUps:b,inContext:I,context:T,event:w}=t,S=[],D=[],E=[],C=[],P=[];v&&!i&&(i=dm({policyDefinitions:c,tournamentRecord:u,contextProfile:v,event:w}));let R;!(e!=null&&e.length)&&u&&(e=u==null?void 0:u.participants,(I||s!=null&&s.withGroupings)&&e!=null&&e.length&&({participantsWithGroupings:e,groupInfo:R}=l6({participants:e,participantsProfile:s})));let{structures:N}=Rh({drawDefinition:y});if(!N)return{error:Dr};n||(n=ko({drawDefinition:y}));let M=y&&cve({drawDefinition:y}).exitProfiles;N.forEach(x=>{let{byeMatchUps:O=[],pendingMatchUps:B=[],upcomingMatchUps:F=[],completedMatchUps:G=[],abandonedMatchUps:H=[]}=AL({matchUpFilters:b?void 0:h,contextFilters:b?void 0:p,inContext:I||b||p,tournamentAppliedPolicies:a,scheduleVisibilityFilters:r,tournamentParticipants:e,requireParticipants:o,afterRecoveryTimes:l,policyDefinitions:c,tournamentRecord:u,usePublishState:d,contextContent:i,participantMap:m,scheduleTiming:f,publishStatus:g,contextProfile:v,drawDefinition:y,exitProfiles:M,matchUpsMap:n,structure:x,context:T,event:w});S=S.concat(...H),D=D.concat(...G),E=E.concat(...F),C=C.concat(...B),P=P.concat(...O)});let A=x=>(!h&&!b&&!p||(h&&(x=gb({matchUps:x,...h})),p&&(x=gb({matchUps:x,...p,processContext:!0}))),x),_={abandonedMatchUps:A(S),completedMatchUps:A(D),upcomingMatchUps:A(E),pendingMatchUps:A(C),byeMatchUps:A(P),matchUpsMap:n,...ue,groupInfo:R};if(b){let x=typeof b=="object"||{abandoned:!0,completed:!0,upcoming:!0,pending:!0,bye:!0},{abandoned:O,completed:B,upcoming:F,pending:G,bye:H}=x,$=[].concat(...O&&S||[],...B&&D||[],...F&&E||[],...G&&C||[],...H&&P||[]);wze({inContextDrawMatchUps:$,drawDefinition:y})}return _}function ly({inContextDrawMatchUps:t,drawDefinition:e,matchUpsMap:i}){var n;if(!e)return{error:Lt};let r={loserMatchUpIds:{},winnerMatchUpIds:{}};if(t||({matchUps:t,matchUpsMap:i}=wa({inContext:!0,drawDefinition:e,matchUpsMap:i})),!(i!=null&&i.drawMatchUps.some(a=>a.finishingPositionRange))&&((n=e==null?void 0:e.structures)==null?void 0:n.length)===1&&!(e!=null&&e.structures[0].structures)){let a=(i==null?void 0:i.drawMatchUps)??[];ZP({matchUps:a})}return(t??[]).filter(({collectionId:a})=>!a).forEach(a=>{let{matchUpId:o,structureId:s}=a,l=Ms({inContextDrawMatchUps:t,drawDefinition:e,matchUpId:o}),{winnerMatchUp:c,loserMatchUp:u}=l.targetMatchUps,d=c==null?void 0:c.matchUpId,p=u==null?void 0:u.matchUpId,h=ry({matchUpsMap:i,structureId:s}).find(f=>f.matchUpId===o);if(h&&(d&&(r.winnerMatchUpIds[h.matchUpId]=d,Object.assign(h,{winnerMatchUpId:d}),Object.assign(a,{winnerMatchUpId:d})),p&&(r.loserMatchUpIds[h.matchUpId]=p,a.loserMatchUpId=p,h.loserMatchUpId=p,a.finishingPositionRange))){let f=u.finishingPositionRange&&[...a.finishingPositionRange.loser,...u.finishingPositionRange.loser],m=f&&[Math.min(...f),Math.max(...f)];a.finishingPositionRange.loser=m,h.finishingPositionRange.loser=m}}),{inContextDrawMatchUps:t,goesToMap:r}}function fve(t){return t&&typeof String.fromCodePoint<"u"?t.toUpperCase().replace(/./g,e=>String.fromCodePoint(e.charCodeAt(0)+127397)):t}function Tze(t){let e=Object.assign({},...Vm.filter(i=>i.ioc).map(i=>({[i.ioc]:i.iso})));return fve(e[t])}var Vm=[{ioc:"",iso2:"",iso:"",label:"NONE",phone:""},{ioc:"AND",iso2:"AD",iso:"AND",label:"Andorra",phone:"376"},{ioc:"UAE",iso2:"AE",iso:"ARE",label:"United Arab Emirates",phone:"971"},{ioc:"AFG",iso2:"AF",iso:"AFG",label:"Afghanistan",phone:"93"},{ioc:"ANT",iso2:"AG",iso:"ATG",label:"Antigua and Barbuda",phone:"1-268"},{ioc:"AIA",iso2:"AI",iso:"AIA",label:"Anguilla",phone:"1-264"},{ioc:"ALB",iso2:"AL",iso:"ALB",label:"Albania",phone:"355"},{ioc:"ARM",iso2:"AM",iso:"ARM",label:"Armenia",phone:"374"},{ioc:"ANG",iso2:"AO",iso:"AGO",label:"Angola",phone:"244"},{ioc:"",iso2:"AQ",iso:"ATA",label:"Antarctica",phone:"672"},{ioc:"ARG",iso2:"AR",iso:"ARG",label:"Argentina",phone:"54"},{ioc:"ASA",iso2:"AS",iso:"ASM",label:"American Samoa",phone:"1-684"},{ioc:"AUT",iso2:"AT",iso:"AUT",label:"Austria",phone:"43"},{ioc:"AUS",iso2:"AU",iso:"AUS",label:"Australia",phone:"61",suggested:!0},{ioc:"ARU",iso2:"AW",iso:"ABW",label:"Aruba",phone:"297"},{ioc:"AZE",iso2:"AZ",iso:"AZE",label:"Azerbaijan",phone:"994"},{ioc:"BIH",iso2:"BA",iso:"BIH",label:"Bosnia and Herzegovina",phone:"387"},{ioc:"BAR",iso2:"BB",iso:"BRB",label:"Barbados",phone:"1-246"},{ioc:"BAN",iso2:"BD",iso:"BGD",label:"Bangladesh",phone:"880"},{ioc:"BEL",iso2:"BE",iso:"BEL",label:"Belgium",phone:"32"},{ioc:"BUR",iso2:"BF",iso:"BFA",label:"Burkina Faso",phone:"226"},{ioc:"BUL",iso2:"BG",iso:"BGR",label:"Bulgaria",phone:"359"},{ioc:"BRN",iso2:"BH",iso:"BHR",label:"Bahrain",phone:"973"},{ioc:"BDI",iso2:"BI",iso:"BDI",label:"Burundi",phone:"257"},{ioc:"BEN",iso2:"BJ",iso:"BEN",label:"Benin",phone:"229"},{ioc:"",iso2:"BL",iso:"BLM",label:"Saint Barthelemy",phone:"590"},{ioc:"BER",iso2:"BM",iso:"BMU",label:"Bermuda",phone:"1-441"},{ioc:"BRU",iso2:"BN",iso:"BRN",label:"Brunei Darussalam",phone:"673"},{ioc:"BOL",iso2:"BO",iso:"BOL",label:"Bolivia",phone:"591"},{ioc:"BRA",iso2:"BR",iso:"BRA",label:"Brazil",phone:"55"},{ioc:"BAH",iso2:"BS",iso:"BHS",label:"Bahamas",phone:"1-242"},{ioc:"BHU",iso2:"BT",iso:"BTN",label:"Bhutan",phone:"975"},{ioc:"",iso2:"BV",iso:"BVT",label:"Bouvet Island",phone:"47"},{ioc:"BOT",iso2:"BW",iso:"BWA",label:"Botswana",phone:"267"},{ioc:"BLR",iso2:"BY",iso:"BLR",label:"Belarus",phone:"375"},{ioc:"BIZ",iso2:"BZ",iso:"BLZ",label:"Belize",phone:"501"},{ioc:"CAN",iso2:"CA",iso:"CAN",label:"Canada",phone:"1",suggested:!0},{ioc:"",iso2:"CC",iso:"CCK",label:"Cocos (Keeling) Islands",phone:"61"},{ioc:"CGO",iso2:"CD",iso:"COG",label:"Congo, Republic of the",phone:"242"},{ioc:"CAF",iso2:"CF",iso:"CAF",label:"Central African Republic",phone:"236"},{ioc:"COD",iso2:"CG",iso:"CGD",label:"Congo, Democratic Republic of the",phone:"243"},{ioc:"SUI",iso2:"CH",iso:"CHE",label:"Switzerland",phone:"41"},{ioc:"CIV",iso2:"CI",iso:"CIV",label:"Cote d'Ivoire",phone:"225"},{ioc:"COK",iso2:"CK",iso:"COK",label:"Cook Islands",phone:"682"},{ioc:"CHI",iso2:"CL",iso:"CHL",label:"Chile",phone:"56"},{ioc:"CMR",iso2:"CM",iso:"CMR",label:"Cameroon",phone:"237"},{ioc:"CHN",iso2:"CN",iso:"CHN",label:"China",phone:"86"},{ioc:"COL",iso2:"CO",iso:"COL",label:"Colombia",phone:"57"},{ioc:"CRC",iso2:"CR",iso:"CRI",label:"Costa Rica",phone:"506"},{ioc:"CUB",iso2:"CU",iso:"CUB",label:"Cuba",phone:"53"},{ioc:"CPV",iso2:"CV",iso:"CPV",label:"Cape Verde",phone:"238"},{ioc:"CUW",iso2:"CW",iso:"CUW",label:"Curacao",phone:"599"},{ioc:"CXR",iso2:"CX",iso:"CXR",label:"Christmas Island",phone:"61"},{ioc:"CYP",iso2:"CY",iso:"CYP",label:"Cyprus",phone:"357"},{ioc:"CZE",iso2:"CZ",iso:"CZE",label:"Czech Republic",phone:"420"},{ioc:"GER",iso2:"DE",iso:"DEU",label:"Germany",phone:"49",suggested:!0},{ioc:"DJI",iso2:"DJ",iso:"DJI",label:"Djibouti",phone:"253"},{ioc:"DEN",iso2:"DK",iso:"DNK",label:"Denmark",phone:"45"},{ioc:"DMA",iso2:"DM",iso:"DMA",label:"Dominica",phone:"1-767"},{ioc:"DOM",iso2:"DO",iso:"DOM",label:"Dominican Republic",phone:"1-809"},{ioc:"ALG",iso2:"DZ",iso:"DZA",label:"Algeria",phone:"213"},{ioc:"ECU",iso2:"EC",iso:"ECU",label:"Ecuador",phone:"593"},{ioc:"EST",iso2:"EE",iso:"ESE",label:"Estonia",phone:"372"},{ioc:"EGY",iso2:"EG",iso:"EGY",label:"Egypt",phone:"20"},{ioc:"",iso2:"EH",iso:"ESH",label:"Western Sahara",phone:"212"},{ioc:"ERI",iso2:"ER",iso:"ERI",label:"Eritrea",phone:"291"},{ioc:"ESP",iso2:"ES",iso:"ESP",label:"Spain",phone:"34"},{ioc:"ETH",iso2:"ET",iso:"ETH",label:"Ethiopia",phone:"251"},{ioc:"FIN",iso2:"FI",iso:"FIN",label:"Finland",phone:"358"},{ioc:"FIJ",iso2:"FJ",iso:"FJI",label:"Fiji",phone:"679"},{ioc:"FLK",iso2:"FK",iso:"FLK",label:"Falkland Islands (Malvinas)",phone:"500"},{ioc:"FSM",iso2:"FM",iso:"FSM",label:"Micronesia, Federated States of",phone:"691"},{ioc:"FAR",iso2:"FO",iso:"FRO",label:"Faroe Islands",phone:"298"},{ioc:"FRA",iso2:"FR",iso:"FRA",label:"France",phone:"33",suggested:!0},{ioc:"GAB",iso2:"GA",iso:"GAB",label:"Gabon",phone:"241"},{ioc:"GBR",iso2:"GB",iso:"GBR",label:"United Kingdom",phone:"44"},{ioc:"GRN",iso2:"GD",iso:"GRD",label:"Grenada",phone:"1-473"},{ioc:"GEO",iso2:"GE",iso:"GEO",label:"Georgia",phone:"995"},{ioc:"FGU",iso2:"GF",iso:"GUF",label:"French Guiana",phone:"594"},{ioc:"",iso2:"GG",iso:"GGY",label:"Guernsey",phone:"44"},{ioc:"",iso2:"GH",iso:"GHA",label:"Ghana",phone:"233"},{ioc:"GIB",iso2:"GI",iso:"GIB",label:"Gibraltar",phone:"350"},{ioc:"GRL",iso2:"GL",iso:"GRL",label:"Greenland",phone:"299"},{ioc:"GAM",iso2:"GM",iso:"GMB",label:"Gambia",phone:"220"},{ioc:"GUI",iso2:"GN",iso:"GIN",label:"Guinea",phone:"224"},{ioc:"GUD",iso2:"GP",iso:"GLP",label:"Guadeloupe",phone:"590"},{ioc:"GEQ",iso2:"GQ",iso:"GNQ",label:"Equatorial Guinea",phone:"240"},{ioc:"GRE",iso2:"GR",iso:"GRC",label:"Greece",phone:"30"},{ioc:"",iso2:"GS",iso:"SGS",label:"South Georgia and the South Sandwich Islands",phone:"500"},{ioc:"GUA",iso2:"GT",iso:"GTM",label:"Guatemala",phone:"502"},{ioc:"GUM",iso2:"GU",iso:"GUM",label:"Guam",phone:"1-671"},{ioc:"GBS",iso2:"GW",iso:"GNB",label:"Guinea-Bissau",phone:"245"},{ioc:"GUY",iso2:"GY",iso:"GUY",label:"Guyana",phone:"592"},{ioc:"HKG",iso2:"HK",iso:"HKG",label:"Hong Kong",phone:"852"},{ioc:"",iso2:"HM",iso:"HMD",label:"Heard Island and McDonald Islands",phone:"672"},{ioc:"HON",iso2:"HN",iso:"HND",label:"Honduras",phone:"504"},{ioc:"CRO",iso2:"HR",iso:"HRV",label:"Croatia",phone:"385"},{ioc:"HAI",iso2:"HT",iso:"HTI",label:"Haiti",phone:"509"},{ioc:"HUN",iso2:"HU",iso:"HUN",label:"Hungary",phone:"36"},{ioc:"INA",iso2:"ID",iso:"IDN",label:"Indonesia",phone:"62"},{ioc:"IRL",iso2:"IE",iso:"IRL",label:"Ireland",phone:"353"},{ioc:"ISR",iso2:"IL",iso:"ISR",label:"Israel",phone:"972"},{ioc:"",iso2:"IM",iso:"IMN",label:"Isle of Man",phone:"44"},{ioc:"IND",iso2:"IN",iso:"IND",label:"India",phone:"91"},{ioc:"",iso2:"IO",iso:"IOT",label:"British Indian Ocean Territory",phone:"246"},{ioc:"IRQ",iso2:"IQ",iso:"IRQ",label:"Iraq",phone:"964"},{ioc:"IRI",iso2:"IR",iso:"IRN",label:"Iran, Islamic Republic of",phone:"98"},{ioc:"ISL",iso2:"IS",iso:"ISL",label:"Iceland",phone:"354"},{ioc:"ITA",iso2:"IT",iso:"ITA",label:"Italy",phone:"39"},{ioc:"",iso2:"JE",iso:"JEY",label:"Jersey",phone:"44"},{ioc:"JAM",iso2:"JM",iso:"JAM",label:"Jamaica",phone:"1-876"},{ioc:"JOR",iso2:"JO",iso:"JOR",label:"Jordan",phone:"962"},{ioc:"JPN",iso2:"JP",iso:"JPN",label:"Japan",phone:"81",suggested:!0},{ioc:"KEN",iso2:"KE",iso:"KEN",label:"Kenya",phone:"254"},{ioc:"KGZ",iso2:"KG",iso:"KGZ",label:"Kyrgyzstan",phone:"996"},{ioc:"CAM",iso2:"KH",iso:"KHM",label:"Cambodia",phone:"855"},{ioc:"KIR",iso2:"KI",iso:"KIR",label:"Kiribati",phone:"686"},{ioc:"COM",iso2:"KM",iso:"COM",label:"Comoros",phone:"269"},{ioc:"SKN",iso2:"KN",iso:"KNA",label:"Saint Kitts and Nevis",phone:"1-869"},{ioc:"KOR",iso2:"KP",iso:"KOR",label:"Korea, Democratic People's Republic of",phone:"850"},{ioc:"PRK",iso2:"KR",iso:"PRK",label:"Korea, Republic of",phone:"82"},{ioc:"KUW",iso2:"KW",iso:"KWT",label:"Kuwait",phone:"965"},{ioc:"CAY",iso2:"KY",iso:"CYM",label:"Cayman Islands",phone:"1-345"},{ioc:"KAZ",iso2:"KZ",iso:"KAZ",label:"Kazakhstan",phone:"7"},{ioc:"LAO",iso2:"LA",iso:"LAO",label:"Lao People's Democratic Republic",phone:"856"},{ioc:"LIB",iso2:"LB",iso:"LBN",label:"Lebanon",phone:"961"},{ioc:"LCA",iso2:"LC",iso:"LCA",label:"Saint Lucia",phone:"1-758"},{ioc:"LIE",iso2:"LI",iso:"LIE",label:"Liechtenstein",phone:"423"},{ioc:"SRI",iso2:"LK",iso:"LKA",label:"Sri Lanka",phone:"94"},{ioc:"LBR",iso2:"LR",iso:"LBR",label:"Liberia",phone:"231"},{ioc:"LES",iso2:"LS",iso:"LSO",label:"Lesotho",phone:"266"},{ioc:"LTU",iso2:"LT",iso:"LTU",label:"Lithuania",phone:"370"},{ioc:"LUX",iso2:"LU",iso:"LUX",label:"Luxembourg",phone:"352"},{ioc:"LAT",iso2:"LV",iso:"LVA",label:"Latvia",phone:"371"},{ioc:"LBA",iso2:"LY",iso:"LBY",label:"Libya",phone:"218"},{ioc:"MAR",iso2:"MA",iso:"MAR",label:"Morocco",phone:"212"},{ioc:"MON",iso2:"MC",iso:"MCO",label:"Monaco",phone:"377"},{ioc:"MDA",iso2:"MD",iso:"MDA",label:"Moldova, Republic of",phone:"373"},{ioc:"MNE",iso2:"ME",iso:"MNE",label:"Montenegro",phone:"382"},{ioc:"",iso2:"MF",iso:"MAF",label:"Saint Martin (French part)",phone:"590"},{ioc:"MAD",iso2:"MG",iso:"MDG",label:"Madagascar",phone:"261"},{ioc:"MSH",iso2:"MH",iso:"MHL",label:"Marshall Islands",phone:"692"},{ioc:"MKD",iso2:"MK",iso:"MKD",label:"Macedonia, the Former Yugoslav Republic of",phone:"389"},{ioc:"MLI",iso2:"ML",iso:"MLI",label:"Mali",phone:"223"},{ioc:"MYA",iso2:"MM",iso:"MMR",label:"Myanmar",phone:"95"},{ioc:"MGL",iso2:"MN",iso:"MNG",label:"Mongolia",phone:"976"},{ioc:"MAC",iso2:"MO",iso:"MAC",label:"Macao",phone:"853"},{ioc:"NMA",iso2:"MP",iso:"NMP",label:"Northern Mariana Islands",phone:"1-670"},{ioc:"MRT",iso2:"MQ",iso:"MTQ",label:"Martinique",phone:"596"},{ioc:"MTN",iso2:"MR",iso:"MRT",label:"Mauritania",phone:"222"},{ioc:"MNT",iso2:"MS",iso:"MSR",label:"Montserrat",phone:"1-664"},{ioc:"MLT",iso2:"MT",iso:"MLT",label:"Malta",phone:"356"},{ioc:"MRI",iso2:"MU",iso:"MUS",label:"Mauritius",phone:"230"},{ioc:"MDV",iso2:"MV",iso:"MDV",label:"Maldives",phone:"960"},{ioc:"MAW",iso2:"MW",iso:"MWI",label:"Malawi",phone:"265"},{ioc:"MEX",iso2:"MX",iso:"MEX",label:"Mexico",phone:"52"},{ioc:"MAS",iso2:"MY",iso:"MYS",label:"Malaysia",phone:"60"},{ioc:"MOZ",iso2:"MZ",iso:"MOZ",label:"Mozambique",phone:"258"},{ioc:"NAM",iso2:"NA",iso:"NAM",label:"Namibia",phone:"264"},{ioc:"NCL",iso2:"NC",iso:"NCL",label:"New Caledonia",phone:"687"},{ioc:"NIG",iso2:"NE",iso:"NER",label:"Niger",phone:"227"},{ioc:"NFI",iso2:"NF",iso:"NFK",label:"Norfolk Island",phone:"672"},{ioc:"NGR",iso2:"NG",iso:"NGA",label:"Nigeria",phone:"234"},{ioc:"NCA",iso2:"NI",iso:"NIC",label:"Nicaragua",phone:"505"},{ioc:"NED",iso2:"NL",iso:"NLD",label:"Netherlands",phone:"31"},{ioc:"NOR",iso2:"NO",iso:"NOR",label:"Norway",phone:"47"},{ioc:"NEP",iso2:"NP",iso:"NPL",label:"Nepal",phone:"977"},{ioc:"NRU",iso2:"NR",iso:"NRU",label:"Nauru",phone:"674"},{ioc:"NIU",iso2:"NU",iso:"NIU",label:"Niue",phone:"683"},{ioc:"NZL",iso2:"NZ",iso:"NZL",label:"New Zealand",phone:"64"},{ioc:"OMA",iso2:"OM",iso:"OMN",label:"Oman",phone:"968"},{ioc:"PAN",iso2:"PA",iso:"PAN",label:"Panama",phone:"507"},{ioc:"PER",iso2:"PE",iso:"PER",label:"Peru",phone:"51"},{ioc:"FPO",iso2:"PF",iso:"PYF",label:"French Polynesia",phone:"689"},{ioc:"PNG",iso2:"PG",iso:"PNG",label:"Papua New Guinea",phone:"675"},{ioc:"PHI",iso2:"PH",iso:"PHL",label:"Philippines",phone:"63"},{ioc:"PAK",iso2:"PK",iso:"PAK",label:"Pakistan",phone:"92"},{ioc:"POL",iso2:"PL",iso:"POL",label:"Poland",phone:"48"},{ioc:"SPM",iso2:"PM",iso:"SPM",label:"Saint Pierre and Miquelon",phone:"508"},{ioc:"",iso2:"PN",iso:"PCN",label:"Pitcairn",phone:"870"},{ioc:"PUR",iso2:"PR",iso:"PRI",label:"Puerto Rico",phone:"1"},{ioc:"PLE",iso2:"PS",iso:"PSE",label:"Palestine, State of",phone:"970"},{ioc:"POR",iso2:"PT",iso:"PRT",label:"Portugal",phone:"351"},{ioc:"PLW",iso2:"PW",iso:"PLW",label:"Palau",phone:"680"},{ioc:"PAR",iso2:"PY",iso:"PRY",label:"Paraguay",phone:"595"},{ioc:"QAT",iso2:"QA",iso:"QAT",label:"Qatar",phone:"974"},{ioc:"REU",iso2:"RE",iso:"REU",label:"Reunion",phone:"262"},{ioc:"ROU",iso2:"RO",iso:"ROU",label:"Romania",phone:"40"},{ioc:"SRB",iso2:"RS",iso:"SRB",label:"Serbia",phone:"381"},{ioc:"RUS",iso2:"RU",iso:"RUS",label:"Russia",phone:"7"},{ioc:"RWA",iso2:"RW",iso:"RWA",label:"Rwanda",phone:"250"},{ioc:"KSA",iso2:"SA",iso:"SAU",label:"Saudi Arabia",phone:"966"},{ioc:"SOL",iso2:"SB",iso:"SLB",label:"Solomon Islands",phone:"677"},{ioc:"SEY",iso2:"SC",iso:"SYC",label:"Seychelles",phone:"248"},{ioc:"SUD",iso2:"SD",iso:"SDN",label:"Sudan",phone:"249"},{ioc:"SWE",iso2:"SE",iso:"SWE",label:"Sweden",phone:"46"},{ioc:"SIN",iso2:"SG",iso:"SGP",label:"Singapore",phone:"65"},{ioc:"HEL",iso2:"SH",iso:"SHN",label:"Saint Helena",phone:"290"},{ioc:"SLO",iso2:"SI",iso:"SVN",label:"Slovenia",phone:"386"},{ioc:"",iso2:"SJ",iso:"SJM",label:"Svalbard and Jan Mayen",phone:"47"},{ioc:"SVK",iso2:"SK",iso:"SVK",label:"Slovakia",phone:"421"},{ioc:"SLE",iso2:"SL",iso:"SLE",label:"Sierra Leone",phone:"232"},{ioc:"SMR",iso2:"SM",iso:"SMR",label:"San Marino",phone:"378"},{ioc:"SEN",iso2:"SN",iso:"SEN",label:"Senegal",phone:"221"},{ioc:"SOM",iso2:"SO",iso:"SOM",label:"Somalia",phone:"252"},{ioc:"SUR",iso2:"SR",iso:"SUR",label:"Suriname",phone:"597"},{ioc:"",iso2:"SS",iso:"SSD",label:"South Sudan",phone:"211"},{ioc:"STP",iso2:"ST",iso:"STP",label:"Sao Tome and Principe",phone:"239"},{ioc:"ESA",iso2:"SV",iso:"SLV",label:"El Salvador",phone:"503"},{ioc:"",iso2:"SX",iso:"SMX",label:"Sint Maarten",phone:"1-721"},{ioc:"SYR",iso2:"SY",iso:"SYR",label:"Syria",phone:"963"},{ioc:"",iso2:"SZ",iso:"SWZ",label:"Swaziland",phone:"268"},{ioc:"TKS",iso2:"TC",iso:"TCA",label:"Turks and Caicos Islands",phone:"1-649"},{ioc:"CHA",iso2:"TD",iso:"TCD",label:"Chad",phone:"235"},{ioc:"",iso2:"TF",iso:"ATF",label:"French Southern Territories",phone:"262"},{ioc:"TOG",iso2:"TG",iso:"TGO",label:"Togo",phone:"228"},{ioc:"THA",iso2:"TH",iso:"THA",label:"Thailand",phone:"66"},{ioc:"TJK",iso2:"TJ",iso:"TJK",label:"Tajikistan",phone:"992"},{ioc:"",iso2:"TK",iso:"TKL",label:"Tokelau",phone:"690"},{ioc:"TLS",iso2:"TL",iso:"TLS",label:"Timor-Leste",phone:"670"},{ioc:"TKM",iso2:"TM",iso:"TKM",label:"Turkmenistan",phone:"993"},{ioc:"TUN",iso2:"TN",iso:"TUN",label:"Tunisia",phone:"216"},{ioc:"TGA",iso2:"TO",iso:"TON",label:"Tonga",phone:"676"},{ioc:"TUR",iso2:"TR",iso:"TUR",label:"Turkey",phone:"90"},{ioc:"TTO",iso2:"TT",iso:"TTO",label:"Trinidad and Tobago",phone:"1-868"},{ioc:"TUV",iso2:"TV",iso:"TUV",label:"Tuvalu",phone:"688"},{ioc:"TPE",iso2:"TW",iso:"TWN",label:"Taiwan",phone:"886"},{ioc:"TAN",iso2:"TZ",iso:"TZA",label:"United Republic of Tanzania",phone:"255"},{ioc:"UKR",iso2:"UA",iso:"UKR",label:"Ukraine",phone:"380"},{ioc:"UGA",iso2:"UG",iso:"UGA",label:"Uganda",phone:"256"},{ioc:"USA",iso2:"US",label:"United States",phone:"1",suggested:!0,iso:"USA"},{ioc:"URU",iso2:"UY",iso:"URY",label:"Uruguay",phone:"598"},{ioc:"UZB",iso2:"UZ",iso:"UZB",label:"Uzbekistan",phone:"998"},{ioc:"",iso2:"VA",iso:"VAT",label:"Holy See (Vatican City State)",phone:"379"},{ioc:"VIN",iso2:"VC",iso:"VCT",label:"Saint Vincent and the Grenadines",phone:"1-784"},{ioc:"VEN",iso2:"VE",iso:"VEN",label:"Venezuela",phone:"58"},{ioc:"IVB",iso2:"VG",iso:"VGB",label:"British Virgin Islands",phone:"1-284"},{ioc:"ISV",iso2:"VI",iso:"VIR",label:"US Virgin Islands",phone:"1-340"},{ioc:"VIE",iso2:"VN",iso:"VNM",label:"Vietnam",phone:"84"},{ioc:"VAN",iso2:"VU",iso:"VUT",label:"Vanuatu",phone:"678"},{ioc:"WAF",iso2:"WF",iso:"WLF",label:"Wallis and Futuna",phone:"681"},{ioc:"SAM",iso2:"WS",iso:"WSM",label:"Samoa",phone:"685"},{ioc:"KOS",iso2:"XK",iso:"KOS",label:"Kosovo",phone:"383"},{ioc:"YEM",iso2:"YE",iso:"YEM",label:"Yemen",phone:"967"},{ioc:"MAY",iso2:"YT",iso:"MYT",label:"Mayotte",phone:"262"},{ioc:"RSA",iso2:"ZA",iso:"ZAF",label:"South Africa",phone:"27"},{ioc:"ZAM",iso2:"ZM",iso:"ZMB",label:"Zambia",phone:"260"},{ioc:"ZIM",iso2:"ZW",iso:"ZWE",label:"Zimbabwe",phone:"263"}];function mve({participant:t,withISO2:e,withIOC:i}){let{person:n,individualParticipants:r}=t,a=[n,r==null?void 0:r.map(({person:s})=>s)].flat().filter(Boolean);function o(s){let{nationalityCode:l}=s||{};if(l){let c=Vm.find(({iso:u})=>u===l);i&&c!=null&&c.ioc&&!s.iocNationalityCode&&(s.iocNationalityCode=c.ioc),e&&c!=null&&c.iso2&&!s.iso2NationalityCode&&(s.iso2NationalityCode=c.iso2),c!=null&&c.label&&!s.countryName&&(s.countryName=c.label)}}a.forEach(o)}function Uze({participantMap:t,template:e}){var i;let n=Object.values(t);for(let r of n){let a=r.participant;if((i=a.individualParticipantIds)!=null&&i.length){a.individualParticipants=[];for(let o of a.individualParticipantIds){let s=t[o].participant;a.individualParticipants.push(e?sI({template:e,source:s}):s)}}}}function jy(t){var e;let{tournamentRecord:i,participantId:n}=t,r=t.tournamentRecords||i&&{[i.tournamentId]:i}||{};for(let a of Object.values(r)){let o=(e=a.participants)==null?void 0:e.find(s=>s.participantId===n);if(o)return{participant:o,tournamentId:a.tournamentId}}return{error:Jr}}function kp({returnPreviousValues:t,itemSubTypes:e,itemType:i,element:n}){if(!n)return{error:Ht,info:_5};if(e&&!Array.isArray(e))return{error:Me,context:{itemSubTypes:e}};if(!Array.isArray(n.timeItems))return{error:c5};let r=n.timeItems.filter(o=>(o==null?void 0:o.itemType)===i).filter(o=>!(e!=null&&e.length)||e.some(s=>{var l;return(l=o==null?void 0:o.itemSubTypes)==null?void 0:l.includes(s)})).sort((o,s)=>{let l=new Date(o.createdAt||void 0).getTime(),c=new Date(s.createdAt||void 0).getTime();return l-c}),a=r.pop();if(a){let o={timeItem:a,...ue};return t&&Object.assign(o,{previousItems:r}),o}else return{info:Wo}}function S6({returnPreviousValues:t,drawDefinition:e,itemSubTypes:i,itemType:n}){if(!e)return{error:Rd};if(!e.timeItems)return{info:Wo};let{timeItem:r,previousItems:a,info:o}=kp({element:e,returnPreviousValues:t,itemSubTypes:i,itemType:n});return r&&{timeItem:r,previousItems:a}||{info:o}}function uR({returnPreviousValues:t,itemSubTypes:e,itemType:i,event:n}){if(!n)return{error:_n};if(!n.timeItems)return{info:Wo};let{timeItem:r,previousItems:a,info:o}=kp({returnPreviousValues:t,element:n,itemSubTypes:e,itemType:i});return r&&{timeItem:r,previousItems:a}||{info:o}}function dR({returnPreviousValues:t,tournamentRecord:e,itemSubTypes:i,itemType:n}){if(!e)return{error:it};if(!e.timeItems)return{info:Wo};let{timeItem:r,previousItems:a,info:o}=kp({element:e,returnPreviousValues:t,itemSubTypes:i,itemType:n});return r&&{timeItem:r,previousItems:a}||{info:o}}function T6({returnPreviousValues:t,tournamentRecord:e,participantId:i,itemSubTypes:n,itemType:r}){if(!e)return{error:it};if(!i)return{error:Ra};let a=jy({tournamentRecord:e,participantId:i});if(a.error)return a;let{participant:o}=a;if(!(o!=null&&o.timeItems))return{info:Wo};let{timeItem:s,previousItems:l,info:c}=kp({element:a.participant,returnPreviousValues:t,itemSubTypes:n,itemType:r});return s&&{timeItem:s,previousItems:l}||{info:c}}var Dze={[cc]:"groupParticipantIds",[Ui]:"pairParticipantIds",[Hn]:"teamParticipantIds"},Eze={[cc]:"groups",[Hn]:"teams"};function gve({withIndividualParticipants:t,convertExtensions:e,tournamentRecord:i,withSignInStatus:n,withScaleValues:r,internalUse:a,withISO2:o,withIOC:s}){let l={};for(let c of i.participants??[]){let u=c==null?void 0:c.participantId;u&&Rze({participantMap:l,participantId:u})}for(let c of i.participants??[]){let u=$t(c,e,a),{participantId:d,individualParticipantIds:p,participantType:h}=u;if(Object.assign(l[d].participant,u),p&&Pze({individualParticipantIds:p,participantCopy:u,participantMap:l,participantType:h,participantId:d}),n&&(l[d].participant.signedIn=Cze(u)),r){let{ratings:f,rankings:m,seedings:g}=uU({participant:u});l[d].participant.seedings=g,l[d].participant.rankings=m,l[d].participant.ratings=f}(s||o)&&mve({participant:l[d].participant,withISO2:o,withIOC:s})}if(t){let c=sr(t)?t:void 0;Uze({participantMap:l,template:c})}return{participantMap:l}}function Cze(t){let{timeItem:e}=kp({itemType:XP,element:t});return(e==null?void 0:e.itemValue)===bE}function Pze({individualParticipantIds:t,participantCopy:e,participantMap:i,participantType:n,participantId:r}){for(let a of t){let o=i[a].participant;if(o[Dze[n]].push(r),[Hn,cc].includes(n)){let{participantRoleResponsibilities:s,participantOtherName:l,participantName:c,participantId:u,teamId:d}=e,p=Eze[n];o[p].push({participantRoleResponsibilities:s,participantOtherName:l,participantName:c,participantId:u,teamId:d})}if(n===Ui){let s=t.find(l=>l!==a);i[a].pairIdMap[r]=s,i[a].pairIdMap[s]=r}}}function Rze({participantMap:t,participantId:e}){if(t[e])return;let i={walkoverWins:0,defaultWins:0,walkovers:0,defaults:0,losses:0,wins:0};t[e]={structureParticipation:{},potentialMatchUps:{},scheduleConflicts:{},scheduleItems:[],participant:{groupParticipantIds:[],pairParticipantIds:[],teamParticipantIds:[],seedings:{},rankings:{},ratings:{},groups:[],teams:[]},statistics:{},opponents:{},pairIdMap:{},matchUps:{},events:{},draws:{},counters:{[Mr]:{...i},[Zn]:{...i},[Hn]:{...i},...i}}}function hw({participantsProfile:t,useParticipantMap:e,tournamentRecord:i,contextProfile:n,inContext:r}){var a;if(e)return{participantMap:(a=gve({...t,...n,tournamentRecord:i}))==null?void 0:a.participantMap};let o=$t(i.participants,!1,!0)||[];(t!=null&&t.withIOC||t!=null&&t.withISO2)&&o.forEach(l=>mve({participant:l,...t}));let s;if((r||t!=null&&t.withGroupings)&&o!=null&&o.length&&({participantsWithGroupings:o,groupInfo:s}=l6({participantsProfile:t,deepCopy:!1,participants:o})),(t==null?void 0:t.withScaleValues)&&(o==null?void 0:o.length))for(let l of o){let{ratings:c,rankings:u}=uU({participant:l});l.rankings=u,l.ratings=c}return{participants:o,groupInfo:s}}function pm(t){let{participants:e=[],contextContent:i,participantMap:n}=t,{scheduleVisibilityFilters:r,tournamentAppliedPolicies:a,participantsProfile:o,afterRecoveryTimes:s,policyDefinitions:l,useParticipantMap:c,tournamentRecord:u,contextFilters:d,contextProfile:p,matchUpFilters:h,nextMatchUps:f,inContext:m,context:g,event:v}=t;if(!v)return{error:_n};let{eventId:y,eventName:b,endDate:I,eventType:T,category:w,gender:S,matchUpFormat:D}=v??{},E={...g,...qt({indoorOutDoor:v.indoorOutdoor??(u==null?void 0:u.indoorOutdoor),surfaceCategory:v.surfaceCategory??(u==null?void 0:u.surfaceCategory),endDate:v.endDate??(u==null?void 0:u.endDate),tournamentId:u==null?void 0:u.tournamentId,matchUpFormat:D,eventName:b,eventType:T,category:w,eventId:y,gender:S})};I&&(E.endDate=I),p&&!i&&(i=dm({policyDefinitions:l,tournamentRecord:u,contextProfile:p,event:v}));let C;if(!(e!=null&&e.length)&&!n&&u){let N=hw({participantsProfile:o,useParticipantMap:c,policyDefinitions:l,tournamentRecord:u,contextProfile:p,inContext:m});n=N.participantMap,e=N.participants??[],C=N.groupInfo}let P=v.drawDefinitions??[],R=oR({tournamentRecord:u,event:v}).scheduleTiming;return{matchUps:P.flatMap(N=>{let{matchUps:M}=wa({tournamentParticipants:e,tournamentAppliedPolicies:a,scheduleVisibilityFilters:r,context:E,participantsProfile:o,afterRecoveryTimes:s,policyDefinitions:l,tournamentRecord:u,contextFilters:d,contextProfile:p,drawDefinition:N,contextContent:i,matchUpFilters:h,participantMap:n,scheduleTiming:R,nextMatchUps:f,inContext:m,event:v});return M??[]}),groupInfo:C}}function co(t){let e=mn(t,[{tournamentRecord:!0}]);if(e.error)return e;if(!(t!=null&&t.tournamentRecord))return{error:it};let{participantMap:i,participants:n}=t,{scheduleVisibilityFilters:r,participantsProfile:a,afterRecoveryTimes:o,useParticipantMap:s,policyDefinitions:l,tournamentRecord:c,inContext:u=!0,contextProfile:d,matchUpFilters:p,contextFilters:h,nextMatchUps:f,context:m}=t,g=t.tournamentId??c.tournamentId,v=(c==null?void 0:c.events)??[];n||({participants:n,participantMap:i}=hw({participantsProfile:a,useParticipantMap:s,policyDefinitions:l,tournamentRecord:c,contextProfile:d,inContext:u}));let{appliedPolicies:y}=Mn({tournamentRecord:c}),b={...m,tournamentId:g,indoorOutDoor:c.indoorOutdoor,surfaceCategory:c.surfaceCategory,endDate:c.endDate},I=dm({policyDefinitions:l,tournamentRecord:c,contextProfile:d});return{matchUps:v.flatMap(T=>{var w;return b.eventDrawsCount=((w=T.drawDefinitions)==null?void 0:w.length)??0,pm({context:b,scheduleVisibilityFilters:r,tournamentAppliedPolicies:y,participantsProfile:a,afterRecoveryTimes:o,policyDefinitions:l,tournamentRecord:c,contextContent:I,contextFilters:h,contextProfile:d,matchUpFilters:p,participantMap:i,nextMatchUps:f,participants:n,inContext:u,event:T}).matchUps??[]}).concat(...c.matchUps??[])}}function Ud({scheduleVisibilityFilters:t,afterRecoveryTimes:e,participantsProfile:i,tournamentRecords:n,policyDefinitions:r,matchUpFilters:a,contextFilters:o,nextMatchUps:s,inContext:l}){return typeof n!="object"||!Object.keys(n).length?{error:_r}:{matchUps:Object.keys(n).map(c=>{let u=n[c];return co({scheduleVisibilityFilters:t,afterRecoveryTimes:e,participantsProfile:i,policyDefinitions:r,tournamentRecord:u,matchUpFilters:a,contextFilters:o,nextMatchUps:s,inContext:l}).matchUps??[]}).flat()}}function fw(t,e){return Mze(t,e)||((t==null?void 0:t.stageSequence)||0)-((e==null?void 0:e.stageSequence)||0)||(t==null?void 0:t.roundNumber)&&e.roundNumber&&(t==null?void 0:t.roundNumber)-(e==null?void 0:e.roundNumber)||((t==null?void 0:t.roundPosition)??0)-((e==null?void 0:e.roundPosition)??0)}function Mze(t,e){return(dI[t==null?void 0:t.stage]||0)-(dI[e==null?void 0:e.stage]||0)}function Hs(t){let{participants:e,participantMap:i,contextContent:n}=t,{scheduleVisibilityFilters:r,tournamentAppliedPolicies:a,participantsProfile:o,afterRecoveryTimes:s,policyDefinitions:l,useParticipantMap:c,tournamentRecord:u,matchUpFilters:d,contextFilters:p,contextProfile:h,drawDefinition:f,nextMatchUps:m,inContext:g,context:v,event:y}=t,{eventId:b,eventName:I,endDate:T,eventType:w,category:S,gender:D,matchUpFormat:E}=y??{},C={...v,surfaceCategory:(y==null?void 0:y.surfaceCategory)??(u==null?void 0:u.surfaceCategory),indoorOutDoor:(y==null?void 0:y.indoorOutdoor)??(u==null?void 0:u.indoorOutdoor),matchUpFormat:E,eventType:w,eventName:I,category:S,eventId:b,endDate:T,gender:D},P;return!(e!=null&&e.length)&&!i&&u&&({participants:e=[],participantMap:i,groupInfo:P}=hw({participantsProfile:o,useParticipantMap:c,policyDefinitions:l,tournamentRecord:u,contextProfile:h,inContext:g})),h&&!n&&(n=dm({policyDefinitions:l,tournamentRecord:u,contextProfile:h,drawDefinition:f,event:y})),{...wa({context:C,tournamentAppliedPolicies:a,scheduleVisibilityFilters:r,tournamentParticipants:e,participantsProfile:o,afterRecoveryTimes:s,policyDefinitions:l,tournamentRecord:u,drawDefinition:f,contextContent:n,contextFilters:p,contextProfile:h,matchUpFilters:d,participantMap:i,nextMatchUps:m,inContext:g,event:y}),groupInfo:P}}function Ku(t){var e;let i=_p(t),n=t.matchUps??[],r=t.drawIds??[],{includeParticipantDependencies:a,tournamentRecord:o,drawDefinition:s}=t;if(!Array.isArray(n))return{error:Oh};if(!Array.isArray(r))return{error:Rd};let l=(e=t.matchUpIds)!=null&&e.length?t.matchUpIds:n.map(b=>b.matchUpId);if(!Array.isArray(l))return{error:nU};let c={},u={},d={},p={};o&&!Object.keys(i).length&&(i={[o.tournamentId]:o});let h=Object.values(i),f=h.reduce((b,I)=>b.concat(I.events??[]).map(T=>(T.drawDefinitions||[]).map(w=>w.links||[])).flat(1/0),[]).filter(({linkType:b})=>b===Ff),m=n;if(f.length){m=Ud({nextMatchUps:!0,tournamentRecords:i}).matchUps;let b=f.reduce((I,T)=>{var w,S;let D=(w=T.source)==null?void 0:w.structureId,E=(S=T.target)==null?void 0:S.structureId;return D&&E&&(d[E]=D),D&&!I.includes(D)&&I.push(D),I},[]);for(let I of b)c[I]=[];for(let I of m??[]){let T=I.containerStructureId||I.structureId;b.includes(T)&&c[T].push(I.matchUpId)}}let g=b=>{u[b]||(u[b]={dependentMatchUpIds:[],participantIds:[],matchUpIds:[],sources:[]},p[b]=[])},v=(b,I)=>{u[b].matchUpIds.forEach(T=>{u[I].matchUpIds.push(T)}),u[I].matchUpIds.push(b),u[b].dependentMatchUpIds.push(I),a&&u[b].participantIds.forEach(T=>u[I].participantIds.push(T))},y=b=>{let I=Object.keys(c).length;for(let T of b||[]){let{matchUpId:w,winnerMatchUpId:S,loserMatchUpId:D}=T;if(!l.length||l.includes(w)){if(g(w),a){let{individualParticipantIds:P}=DL(T);u[w].participantIds=P}S&&(g(S),v(w,S),p[S].push(w)),D&&(g(D),v(w,D),p[D].push(w)),u[w].sources.push(p[w]);let E=p[w].map(P=>u[P].sources[0]).flat(),C=p[w].map(P=>u[P].sources[1]).flat();if(u[w].sources.push(E,C),I){let P=T.containerStructureId||T.structureId,R=d[P];if(c[R])for(let N of c[R])g(N),v(N,w),p[N].push(w)}}}};if(s)ly({drawDefinition:s}),m!=null&&m.length||(m=Hs({drawDefinition:s}).matchUps),y(m);else{if(m!=null&&m.length||(m=Ud({nextMatchUps:!0,tournamentRecords:i}).matchUps),!r.length){let b=h!=null&&h.length?h.map(({events:I=[]})=>I.map(({drawDefinitions:T=[]})=>T.map(({drawId:w})=>w))).flat(1/0):[];b&&(r=b)}for(let b of r){let I=m==null?void 0:m.filter(T=>T.drawId===b).sort(fw);if(!(I!=null&&I.find(({roundPosition:T})=>!T))){let T=I==null?void 0:I.find(({tournamentId:S})=>S),{drawDefinition:w}=Ks({tournamentRecord:i[T==null?void 0:T.tournamentId],drawId:b});w&&ly({drawDefinition:w})}y(I)}}return{positionDependencies:c,matchUpDependencies:u,sourceMatchUpIds:p,matchUps:m,...ue}}function uo(t){var e,i;let n=t==null?void 0:t.matchUp,r=(t==null?void 0:t.score)||(n==null?void 0:n.score),a=(e=r==null?void 0:r.sets)==null?void 0:e[0],{side1Score:o,side2Score:s,side1TiebreakScore:l,side2TiebreakScore:c,side1PointScore:u,side2PointScore:d}=a||{},p=o||s||l||c||u||d;return!!(((i=r==null?void 0:r.sets)==null?void 0:i.length)>1||p)}function pR({matchUpStatus:t}){return mge.includes(t)}function Nze({matchUpStatus:t}){return $5.includes(t)}function dj({matchUpStatus:t}){return gge.includes(t)}function U6({matchUpStatus:t,winningSide:e,tieMatchUps:i,sides:n,score:r}){var a;let o=n==null?void 0:n.find(({participantId:l})=>l),s=(a=i==null?void 0:i.filter(U6))==null?void 0:a.length;return uo({score:r})||s||e&&o||t&&Nze({matchUpStatus:t})&&![fn,Rn,Hu].includes(t)}function hR(t){var e;let{drawDefinition:i,findContainer:n,structureId:r,event:a}=t,o=t.structure,s={isCollectionMatchUp:!1},{containedStructures:l}=vU({drawDefinition:i}),c=r?l[r]||[]:[];if(!o){let D=pi({drawDefinition:i,structureId:r});if(D.error)return D;o=n?D.containingStructure??D.structure:D.structure}if(Ll({structure:o}))return{structure:o,isAdHoc:!0,error:tU};let{matchUps:u}=wa({inContext:!0,matchUpFilters:s,drawDefinition:i,event:a}),d=u==null?void 0:u.filter(D=>D.structureId===r||c.includes(D.structureId)),{matchUpDependencies:p}=Ku({drawIds:[i.drawId],matchUps:u,drawDefinition:i}),h=[],f=[],m={},g=[];for(let D of u??[]){if(D.structureId===r||c.includes(D.structureId)){f.push(...D.drawPositions??[]);let E=D.roundNumber;for(let C of(D.drawPositions??[]).filter(Boolean))(!m[C]||E&&m[C]>E)&&(m[C]=E)}U6(D)&&(g.push(D),h.push(D.matchUpId,...((e=p==null?void 0:p[D==null?void 0:D.matchUpId])==null?void 0:e.matchUpIds)||[]))}let v=ki(f.filter(Boolean)).sort(va),y=ki(h),b=ki(d==null?void 0:d.map(({matchUpId:D,drawPositions:E})=>y.includes(D)?E:[]).flat().filter(Boolean)).sort(va),{positionAssignments:I}=jn({drawDefinition:i,structure:o}),T=I==null?void 0:I.filter(D=>D.bye).map(D=>D.drawPosition),w=I==null?void 0:I.filter(D=>D.qualifier).map(D=>D.drawPosition),S=(v==null?void 0:v.filter(D=>!b.includes(D)))||[];return{allDrawPositions:v,inContextStructureMatchUps:d,drawPositionInitialRounds:m,activeDependentMatchUpIds:y,qualifyingDrawPositions:w,inactiveDrawPositions:S,positionAssignments:I,activeDrawPositions:b,byeDrawPositions:T,activeMatchUps:g,structure:o}}function hI({drawPosition:t,matchUps:e=[]}){return{initialRoundNumber:e.filter(({drawPositions:i})=>t&&(i==null?void 0:i.includes(t))).map(({roundNumber:i})=>i).sort(va)[0]}}var Tm={reset:"\x1B[0m",bright:"\x1B[1m",dim:"\x1B[2m",red:"\x1B[31m",brightred:"\x1B[91m",green:"\x1B[32m",brightgreen:"\x1B[92m",yellow:"\x1B[33m",brightyellow:"\x1B[93m",blue:"\x1B[34m",brightblue:"\x1B[94m",lightblue:"\x1B[105m",magenta:"\x1B[35m",brightmagenta:"\x1B[95m",cyan:"\x1B[36m",brightcyan:"\x1B[96m",white:"\x1B[37m",brightwhite:"\x1B[97m"},R_=[];function kc(t,e){typeof t=="string"&&(t={method:t}),(e||jc())&&R_.push(t)}function Aze(t){let e=R_.slice();return t&&(R_.length=0),e}function _ze(t){let e=Aze(t).map(i=>{let{color:n,keyColors:r,method:a,newline:o}=i,s=Object.keys(Tm).includes(n)?Tm[n]:Tm.cyan,l=Object.keys(i).filter(u=>!["color","keyColors","method","newline"].includes(u)).map(u=>{let d=r&&Object.keys(r).includes(u)&&Tm[r[u]]?Tm[r[u]]:Tm.brightwhite;return`${Tm.white}${u}: ${d}${i[u]}`}).join(", "),c=(a==null?void 0:a.length)<15?"		":"	";return[o?`
`:"",s,a,c,Tm.white,l,Tm.reset,`
`].join("")});e!=null&&e.length&&console.log(...e)}function kze(){R_.length=0}function uc({provisionalPositioning:t,isPositionAction:e,tournamentRecord:i,drawDefinition:n,drawPosition:r,matchUpsMap:a,structureId:o,structure:s,event:l}){var c,u,d;if(!n)return{error:Lt};if(s||({structure:s}=pi({drawDefinition:n,structureId:o})),!s)return{error:Dr};o||({structureId:o}=s);let p="assignDrawPositionBye";kc({method:p,color:"cyan",drawPosition:r}),a||(a=ko({drawDefinition:n}));let{positionAssignments:h}=jn({structure:s}),{activeDrawPositions:f}=hR({drawDefinition:n,structureId:o});if((c=h==null?void 0:h.find(P=>P.drawPosition===r))!=null&&c.bye)return{...ue};if(f!=null&&f.includes(r))return{error:YO};let m=h==null?void 0:h.find(P=>P.drawPosition===r);if(!m)return{error:tU};let{filled:g,containsBye:v,assignedParticipantId:y}=xze(m);if(v)return{...ue};if(g&&!v)return fe({result:{error:PS},stack:p});let b=wa({inContext:!0,drawDefinition:n,matchUpsMap:a}).matchUps??[],I={isCollectionMatchUp:!1},{matchUps:T}=Sn({provisionalPositioning:t,drawDefinition:n,matchUpFilters:I,matchUpsMap:a,structure:s});if(h==null||h.forEach(P=>{P.drawPosition===r&&(P.bye=!0)}),s.structureType===xs)return Oze({tournamentRecord:i,drawDefinition:n,drawPosition:r,matchUps:T}),cg({tournamentId:i==null?void 0:i.tournamentId,drawDefinition:n,structure:s,event:l}),VZ({assignedParticipantId:y,isPositionAction:e,drawDefinition:n,drawPosition:r,structureId:o,stack:p});let{roundProfile:w,roundMatchUps:S}=Rs({matchUps:T}),D=(u=w&&Object.keys(w).map(P=>parseInt(P)).reverse())==null?void 0:u.find(P=>{var R;return(R=w==null?void 0:w[P].drawPositions)==null?void 0:R.includes(r)}),E=D?S==null?void 0:S[D].find(({drawPositions:P})=>P==null?void 0:P.includes(r)):void 0;E&&vve({tournamentRecord:i,drawDefinition:n,matchUp:E,event:l});let C=(d=E==null?void 0:E.drawPositions)==null?void 0:d.find(P=>P!==r);if(E&&C){let P=D6({sourceDrawPositions:E.drawPositions,matchUpId:E.matchUpId,inContextDrawMatchUps:b,drawPositionToAdvance:C,tournamentRecord:i,drawDefinition:n,matchUpsMap:a});if(P.error)return P}return cg({tournamentId:i==null?void 0:i.tournamentId,drawDefinition:n,structure:s,event:l}),VZ({assignedParticipantId:y,isPositionAction:e,drawDefinition:n,drawPosition:r,structureId:o,stack:p})}function VZ({assignedParticipantId:t,isPositionAction:e,drawDefinition:i,drawPosition:n,structureId:r,stack:a}){return e&&UL({drawDefinition:i,positionAction:{removedParticipantId:t,drawPosition:n,structureId:r,name:a}}),fe({result:{...ue},stack:a})}function xze(t){let e=t.bye,i=t.qualifier,n=t.participantId;return{containsBye:e,containsQualifier:i,assignedParticipantId:n,filled:e||i||n}}function vve({tournamentRecord:t,drawDefinition:e,eventId:i,matchUp:n,event:r}){Object.assign(n,{matchUpStatus:yn,score:void 0,winningSide:void 0}),sn({tournamentId:t==null?void 0:t.tournamentId,eventId:i??(r==null?void 0:r.eventId),context:"setMatchUpStatusBye",drawDefinition:e,matchUp:n})}function Oze({tournamentRecord:t,drawDefinition:e,drawPosition:i,matchUps:n,event:r}){n.forEach(a=>{var o;(o=a.drawPositions)!=null&&o.includes(i)&&vve({eventId:r==null?void 0:r.eventId,tournamentRecord:t,drawDefinition:e,matchUp:a})})}function D6({drawPositionToAdvance:t,inContextDrawMatchUps:e,sourceDrawPositions:i,tournamentRecord:n,drawDefinition:r,matchUpsMap:a,matchUpId:o,event:s}){var l,c;kc({method:"advanceDrawPosition",color:"cyan",drawPositionToAdvance:t});let u=a.drawMatchUps.find(T=>T.matchUpId===o),d=(l=e.find(T=>T.matchUpId===o))==null?void 0:l.structureId,{structure:p}=pi({drawDefinition:r,structureId:d}),{positionAssignments:h}=jn({structure:p}),f=h==null?void 0:h.filter(T=>T.bye).map(T=>T.drawPosition),m=(c=u==null?void 0:u.drawPositions)==null?void 0:c.find(T=>T!==t),g=m&&(f==null?void 0:f.includes(m)),{targetLinks:{loserTargetLink:v},targetMatchUps:{loserMatchUp:y,winnerMatchUp:b,loserTargetDrawPosition:I}}=Ms({inContextDrawMatchUps:e,drawDefinition:r,matchUpId:o});if(b&&b.structureId===(p==null?void 0:p.structureId)&&Lze({drawPositionToAdvance:t,inContextDrawMatchUps:e,sourceDrawPositions:i,tournamentRecord:n,drawDefinition:r,winnerMatchUp:b,matchUpsMap:a,event:s}),y&&g&&y.structureId!==(p==null?void 0:p.structureId)){let{roundNumber:T}=y;if(T===1){let w=uc({structureId:v.target.structureId,drawPosition:I,tournamentRecord:n,drawDefinition:r,event:s});if(w.error)return w}else yve({loserTargetDrawPosition:I,tournamentRecord:n,loserTargetLink:v,drawDefinition:r,loserMatchUp:y,matchUpsMap:a,event:s})}return{...ue}}function Lze({drawPositionToAdvance:t,inContextDrawMatchUps:e,sourceDrawPositions:i,tournamentRecord:n,drawDefinition:r,winnerMatchUp:a,matchUpsMap:o,event:s}){var l,c,u,d,p,h;let f="advanceWinner",m=o.drawMatchUps.find(F=>F.matchUpId===a.matchUpId),g=(l=e.find(F=>F.matchUpId===a.matchUpId))==null?void 0:l.structureId,{structure:v}=pi({drawDefinition:r,structureId:g}),{positionAssignments:y}=jn({structure:v}),b=(c=y==null?void 0:y.find(({drawPosition:F})=>F===t))==null?void 0:c.bye,I=(u=m.drawPositions)==null?void 0:u.filter(Boolean),T=y==null?void 0:y.filter(F=>I==null?void 0:I.includes(F.drawPosition)),w=y==null?void 0:y.find(({drawPosition:F})=>F===t),S=i==null?void 0:i.find(F=>F!==t),D=(d=S&&(T==null?void 0:T.find(({drawPosition:F})=>F===S)))==null?void 0:d.bye,E=b&&D;if(E&&console.log({isByeAdvancedBye:E}),(I==null?void 0:I.length)>1&&b&&!D)return fe({result:{error:PS},stack:f});let C=I==null?void 0:I.find(F=>F!==t),P=E,R=[...(m.drawPositions||[]).filter(Boolean),void 0,void 0].slice(0,2),N=R.map(F=>!F&&!P||F===t?(P=!0,t):F).sort(va);if(!P)return console.log("@@@@@@@",{advancingAssignmentIsBye:w,drawPositionToAdvance:t,existingAssignments:T}),fe({result:{error:PS},stack:f});let M=(p=y==null?void 0:y.find(({drawPosition:F})=>F===C))==null?void 0:p.bye,A=(h=y==null?void 0:y.find(({drawPosition:F})=>F===t))==null?void 0:h.bye;Object.assign(m,{matchUpStatus:A||M?yn:Kr,score:void 0,winningSide:void 0,drawPositions:N});let _=m.drawPositions.find(F=>!R.includes(F));kc({method:f,color:"brightyellow",changedDrawPosition:_,pairedDrawPositionIsBye:M,drawPositionIsBye:A}),sn({tournamentId:n==null?void 0:n.tournamentId,matchUp:m,eventId:s==null?void 0:s.eventId,context:f,drawDefinition:r});let{targetLinks:{loserTargetLink:x},targetMatchUps:{loserMatchUp:O,loserTargetDrawPosition:B}}=Ms({matchUpId:a.matchUpId,inContextDrawMatchUps:e,drawDefinition:r});if(M||A){let F=M?t:C;if(F)D6({drawPositionToAdvance:F,matchUpId:a.matchUpId,inContextDrawMatchUps:e,tournamentRecord:n,drawDefinition:r,matchUpsMap:o});else if(A&&x&&O)if(O.feedRound)yve({loserTargetDrawPosition:B,tournamentRecord:n,loserTargetLink:x,drawDefinition:r,loserMatchUp:O,matchUpsMap:o});else{let G=1-a.roundPosition%2,H=O.drawPositions[G],$=uc({structureId:x.target.structureId,drawPosition:H,tournamentRecord:n,drawDefinition:r,event:s});if($.error)return $}}}function yve({loserTargetDrawPosition:t,tournamentRecord:e,loserTargetLink:i,drawDefinition:n,loserMatchUp:r,matchUpsMap:a,event:o}){let{roundNumber:s}=r;kc({method:"assignFedDrawPositionBye",color:"cyan",loserTargetDrawPosition:t});let l=((a==null?void 0:a.mappedMatchUps)||{})[r.structureId].matchUps,{initialRoundNumber:c}=hI({drawPosition:t,matchUps:l});if(c===s){let u=uc({structureId:i.target.structureId,drawPosition:t,tournamentRecord:e,drawDefinition:n,event:o});if(u.error)return u}}function bve({positionAssignments:t,tournamentRecord:e,drawDefinition:i,matchUpsMap:n,structure:r,event:a}){let{matchUps:o}=Sn({drawDefinition:i,matchUpsMap:n,structure:r,event:a});o.forEach(s=>{let l=t.filter(({drawPosition:c})=>{var u;return(u=s.drawPositions)==null?void 0:u.includes(c)}).filter(c=>c.bye).length;s.winningSide||(Object.assign(s,{matchUpStatus:l?yn:Kr}),sn({tournamentId:e==null?void 0:e.tournamentId,context:"modifyRoundRobinMatchUpsStatus",eventId:a==null?void 0:a.eventId,drawDefinition:i,matchUp:s}))})}function fR(t){let{inContextDrawMatchUps:e,participantId:i,drawPosition:n}=t,{tournamentRecord:r,drawDefinition:a,structureId:o,matchUpsMap:s,event:l}=t,{structure:c}=pi({drawDefinition:a,structureId:o}),u=(Ha({drawDefinition:a,structure:c}).positionAssignments||[]).find(p=>i&&p.participantId===i||n&&p.drawPosition===n);if(u&&i&&!n&&(n=u==null?void 0:u.drawPosition),!n)return{error:iU};i||(i=u==null?void 0:u.participantId);let{activeDrawPositions:d}=hR({drawDefinition:a,structureId:o});return d.includes(n)?{error:YO}:(e||({matchUps:e}=wa({inContext:!0,drawDefinition:a,matchUpsMap:s})),pj({inContextDrawMatchUps:e,tournamentRecord:r,drawDefinition:a,structureId:o,drawPosition:n,matchUpsMap:s,event:l}).drawPositionCleared?(cg({tournamentId:r==null?void 0:r.tournamentId,drawDefinition:a,structure:c,event:l}),{...ue,participantId:i}):{error:Sfe})}function pj({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,drawPosition:n,matchUpsMap:r,structureId:a,event:o}){var s,l;let{structure:c}=pi({drawDefinition:i,structureId:a});if(!c)return{error:Dr};let u=Ha({drawDefinition:i,structure:c}).positionAssignments||[],d=u.some(b=>{if(b.drawPosition===n)return delete b.participantId,delete b.qualifier,delete b.bye,!0});if(c.structureType===xs)return bve({positionAssignments:u,tournamentRecord:e,drawDefinition:i,matchUpsMap:r,structure:c}),{drawPositionCleared:d,...ue};let p={isCollectionMatchUp:!1},{matchUps:h}=Sn({drawDefinition:i,matchUpFilters:p,matchUpsMap:r,structure:c,event:o}),{roundProfile:f,roundMatchUps:m}=Rs({matchUps:h}),g=(s=f&&Object.keys(f))==null?void 0:s.map(b=>ai(b)),v=n,y=(l=g==null?void 0:g.map(b=>{var I,T,w,S;let D=(T=(I=f==null?void 0:f[b])==null?void 0:I.pairedDrawPositions)==null?void 0:T.find(_=>_.includes(v)),E=D==null?void 0:D.find(_=>_!==v),C=u.find(_=>_.drawPosition===E),P=f==null?void 0:f[b+1],R=C==null?void 0:C.bye,N=(w=P==null?void 0:P.pairedDrawPositions)==null?void 0:w.find(_=>_.includes(E)),M=R&&N&&P&&((S=P.drawPositions)==null?void 0:S.includes(E)),A=D&&{pairedDrawPositionByeAdvancedPair:!M&&N,pairedDrawPosition:E,targetDrawPosition:v,relevantPair:D,roundNumber:b};return M&&(v=E),A}).filter(b=>b==null?void 0:b.targetDrawPosition))==null?void 0:l.reduce((b,I)=>{let{roundNumber:T,relevantPair:w,targetDrawPosition:S,pairedDrawPosition:D,pairedDrawPositionByeAdvancedPair:E}=I,C={roundNumber:T,targetDrawPosition:S,relevantPair:w},P=E&&{roundNumber:T+1,targetDrawPosition:D,relevantPair:E,subsequentRoundRemoval:!0},R=[C,P].filter(Boolean);return b.concat(...R)},[]);return y==null||y.forEach(({roundNumber:b,targetDrawPosition:I,relevantPair:T})=>{let w=m==null?void 0:m[b].find(S=>{var D;return Ps((D=S.drawPositions)==null?void 0:D.filter(Boolean),T.filter(Boolean))});w&&(Fze({inContextDrawMatchUps:t,targetDrawPosition:I,tournamentRecord:e,drawDefinition:i,structureId:a,roundNumber:b,matchUpsMap:r}),Ive({inContextDrawMatchUps:t,positionAssignments:u,tournamentRecord:e,drawDefinition:i,targetMatchUp:w,drawPosition:n,matchUpsMap:r,structure:c,event:o}))}),{tasks:y,drawPositionCleared:d,positionAssignments:u}}function Fze({inContextDrawMatchUps:t,targetDrawPosition:e,tournamentRecord:i,drawDefinition:n,matchUpsMap:r,roundNumber:a,structureId:o}){let{structure:s}=pi({drawDefinition:n,structureId:o});if(!s)return{error:Dr};if(s.structureType===xs)return;r=r||ko({drawDefinition:n});let l=((r==null?void 0:r.mappedMatchUps)||{})[o].matchUps,{initialRoundNumber:c}=hI({drawPosition:e,matchUps:l}),u=l==null?void 0:l.filter(p=>{var h;return p.roundNumber>=a&&p.roundNumber!==c&&((h=p.drawPositions)==null?void 0:h.includes(e))}),d=jn({drawDefinition:n,structureId:o}).positionAssignments??[];return u==null||u.forEach(p=>Ive({drawPosition:e,targetMatchUp:p,inContextDrawMatchUps:t,positionAssignments:d,tournamentRecord:i,drawDefinition:n,matchUpsMap:r,structure:s})),{...ue}}function Ive({inContextDrawMatchUps:t,positionAssignments:e,tournamentRecord:i,drawDefinition:n,targetMatchUp:r,drawPosition:a,matchUpsMap:o,structure:s,event:l}){var c,u,d,p,h,f;let m="removeDrawPosition",g=(c=r.drawPositions)==null?void 0:c.slice(),v=r.matchUpStatus,y=r.winningSide;o=o??ko({drawDefinition:n});let b=o.mappedMatchUps[s.structureId].matchUps,{initialRoundNumber:I}=hI({drawPosition:a,matchUps:b});if(r.roundNumber&&I&&r.roundNumber>I){let N=(r.drawPositions??[]).map(M=>M===a?void 0:M);r.drawPositions=N}if(r.matchUpType===Jn){let N=(((u=t==null?void 0:t.find(M=>M.matchUpId===r.matchUpId))==null?void 0:u.sides)??[]).reduce((M,A,_)=>A.drawPosition===a?_:M,void 0);N!==void 0&&(p=(d=r.sides)==null?void 0:d[N])!=null&&p.lineUp&&((h=r.sides)==null||delete h[N].lineUp,sn({tournamentId:i==null?void 0:i.tournamentId,context:`${m}-TEAM`,eventId:l==null?void 0:l.eventId,matchUp:r,drawDefinition:n}))}let T=Ms({matchUpId:r.matchUpId,inContextDrawMatchUps:t,drawDefinition:n}),{targetLinks:{winnerTargetLink:w},targetMatchUps:{loserMatchUp:S,winnerMatchUp:D,loserMatchUpDrawPositionIndex:E}}=T,C=e.filter(({drawPosition:N})=>{var M;return(M=r.drawPositions)==null?void 0:M.includes(N)}).filter(N=>N.bye).length,P=C&&yn||r.matchUpStatus&&[fn,Rn].includes(r.matchUpStatus)&&r.matcHUpStatus||((f=r.drawPositions)==null?void 0:f.length)===2&&Kr||void 0;r.matchUpStatus=P,r.matchUpStatus&&[Rn,fn].includes(r.matchUpStatus)&&(r.winningSide=void 0);let R=g==null?void 0:g.find(N=>{var M;return!((M=r.drawPositions)!=null&&M.includes(N))});if(g!=null&&g.includes(a)&&v===r.matchUpStatus&&y===r.winningSide||(R&&kc({method:m,color:"brightyellow",removedDrawPosition:R}),sn({tournamentId:i==null?void 0:i.tournamentId,eventId:l==null?void 0:l.eventId,matchUp:r,context:`${m}-${a}`,drawDefinition:n})),S&&S.structureId!==T.matchUp.structureId&&!C){let{drawPositions:N,roundNumber:M}=S;if(M===1){let A=N[E];pj({structureId:S.structureId,drawPosition:A,inContextDrawMatchUps:t,tournamentRecord:i,drawDefinition:n,matchUpsMap:o})}else{let A=Math.min(...N.filter(Boolean)),_=Bze({loserMatchUpDrawPosition:A,inContextDrawMatchUps:t,tournamentRecord:i,drawDefinition:n,loserMatchUp:S,matchUpsMap:o,event:l});if(_.error)return fe({result:_,stack:m});let x=((o==null?void 0:o.mappedMatchUps)||{})[S.structureId].matchUps,{initialRoundNumber:O}=hI({drawPosition:A,matchUps:x});O===1&&(kc({method:m,color:"brightyellow",loserMatchUpDrawPosition:A}),pj({structureId:S.structureId,drawPosition:A,inContextDrawMatchUps:t,tournamentRecord:i,drawDefinition:n,matchUpsMap:o}))}}return D&&D.structureId!==T.matchUp.structureId&&w.target.feedProfile,{...ue}}function Bze({loserMatchUpDrawPosition:t,inContextDrawMatchUps:e,tournamentRecord:i,drawDefinition:n,loserMatchUp:r,matchUpsMap:a,event:o}){var s;let{structure:l}=pi({structureId:r.structureId,drawDefinition:n}),{positionAssignments:c}=jn({structure:l});if((s=c==null?void 0:c.find(u=>u.drawPosition===t))!=null&&s.bye){let u=fR({drawPosition:t,structureId:r.structureId,inContextDrawMatchUps:e,tournamentRecord:i,drawDefinition:n,matchUpsMap:a,event:o});if(u.error)return u}return{...ue}}function Gy({drawDefinition:t,stages:e}){if(!t)return{error:Lt};let i=((t==null?void 0:t.structures)??[]).filter(r=>!(e!=null&&e.length)||r.stage&&e.includes(r.stage)),n=ki(i.map(r=>{let{positionAssignments:a}=jn({structure:r});return a?a.map(Wi):[]}).flat().filter(Boolean));return{...ue,assignedParticipantIds:n}}function gd(t){let e=((t==null?void 0:t.entries)??[]).filter(Boolean).reduce((n,r)=>{let{entryStage:a,entryStatus:o}=r,s=`_${a||Ft}${o||""}`;return n[s]||(n[s]=[]),n[s].push(r),n},{}),i=n=>isNaN(n)?1/0:n;return Object.keys(e).map(n=>e[n].sort((r,a)=>i(r.entryPosition)-i(a.entryPosition)).map((r,a)=>{let o=a+1;return{...r,entryPosition:o}})).flat()}function hv(t){return[Oy,zu].includes(t)}function M_({autoEntryPositions:t=!0,ignoreAssignment:e,tournamentRecord:i,drawDefinition:n,participantIds:r,entryStatus:a,entryStage:o,extension:s,eventSync:l,drawId:c,stage:u,event:d}){var p,h,f,m,g,v,y,b,I,T,w,S;if(!r||!Array.isArray(r))return{error:vp,method:"modifyEntriesStatus",participantIds:r};if(!n&&!d)return{error:_n};if(a&&!Fge.includes(a))return{error:KV};if(o&&!V5.includes(o))return{error:Ay};let D="modifyEntriesStatus",E=[];if(!a&&!s)return fe({result:{error:Ht},info:"Missing entryStatus",stack:D});if(s&&!yp({extension:s,requiredAttributes:["name"]}))return fe({result:{error:Me},info:"Invalid extension",context:{extension:s},stack:D});let C=[];(p=d==null?void 0:d.drawDefinitions)==null||p.forEach(G=>{let H=Gy({stages:u&&[u],drawDefinition:G}).assignedParticipantIds??[];C.push(...H)});let P=(i==null?void 0:i.participants)??[];if(!r.every(G=>{var H;let $=(H=ag({tournamentParticipants:P,participantId:G}))==null?void 0:H.participantType;return!($&&[Ui,_c].includes($)&&hv(a))&&!(a&&d!=null&&d.eventType&&$===Ki&&[xu,Hc].includes(d.eventType)&&[Su,...$N].includes(a))}))return{error:KV};let R=d&&Xr({event:d}).flightProfile,N=(h=R==null?void 0:R.flights)==null?void 0:h.find(G=>G.drawId===c),M=G=>{let H=(G||[]).filter(q=>!u||!q.entryStage||u===q.entryStage).filter(({participantId:q})=>r.includes(q)),$=q=>a&&C.includes(q.participantId)&&!($N.includes(q.entryStatus)&&$N.includes(a));return H.every(q=>$(q)&&!e?!1:(a&&(q.entryStatus=a,delete q.entryPosition),o&&(q.entryStage=o,delete q.entryPosition),s&&(s.value?un({element:q,extension:s}):Ss({element:q,name:s.name})),!0))?{...ue}:{error:aU}},A=({flight:G,drawDefinition:H})=>{d&&(d.entries=gd({entries:d.entries??[]})),G&&(G.drawEntries=gd({entries:G.drawEntries})),H&&(H.entries=gd({entries:H.entries}))},_=G=>{let{flight:H,drawDefinition:$}=G,q="updateDrawEntries";if(H){let z=M(H.drawEntries);if(z.error)return fe({result:z,stack:q})}if($){let z=M($.entries);if(z.error)return fe({result:z,stack:q});E.includes($.drawId)||E.push($.drawId)}return{...ue}},x=((f=d==null?void 0:d.entries)==null?void 0:f.find(({entryPosition:G})=>G))??(((m=N==null?void 0:N.drawEntries)==null?void 0:m.find(({entryPosition:G})=>G))||((g=n==null?void 0:n.entries)==null?void 0:g.find(({entryPosition:G})=>G)));if(t&&!x&&A({flight:N,drawDefinition:n}),N||n){let G=_({flight:N,drawDefinition:n});if(G.error)return fe({result:G,stack:D})}let O=((v=d==null?void 0:d.drawDefinitions)==null?void 0:v.map(({drawId:G})=>G))??[],B=((y=R==null?void 0:R.flights)==null?void 0:y.filter(G=>!O.includes(G.drawId)))||[];for(let G of B){let H=G&&_({flight:G});if(H!=null&&H.error)return fe({result:H,stack:D})}let F=((b=R==null?void 0:R.flights)==null?void 0:b.length)===1&&(((I=d==null?void 0:d.drawDefinitions)==null?void 0:I.length)??0)<=((T=R==null?void 0:R.flights)==null?void 0:T.length);if(!N&&!n&&a&&Lge.includes(a))return{error:nme};if(!N&&!n||a===Vf||l&&F){let G=M(d==null?void 0:d.entries);if(G!=null&&G.error)return fe({result:G,stack:D});let H;if(a===Vf&&((w=R==null?void 0:R.flights)==null||w.every($=>{let q=M($.drawEntries);return q.error?(H=q.error,!1):($.drawEntries=$.drawEntries.filter(({participantId:z})=>!r.includes(z)),!0)}),(S=d==null?void 0:d.drawDefinitions)==null||S.every($=>{var q;let z=M($.entries);return z.error?(H=z.error,!1):($.entries=(q=$.entries)==null?void 0:q.filter(({participantId:Z})=>!r.includes(Z)),!0)})),H)return fe({result:{error:H},stack:D})}t&&A({flight:N,drawDefinition:n});for(let G of(d==null?void 0:d.drawDefinitions)??[])E.length&&!E.includes(G.drawId)||er({tournamentId:i.tournamentId,eventId:d==null?void 0:d.eventId,drawDefinition:G});return{...ue}}function wve(t){let{participantMap:e,participantId:i,matchUpStatus:n,roundPosition:r,structureId:a,matchUpType:o,roundNumber:s,matchUpId:l,potential:c,schedule:u,drawId:d,score:p}=t;!u||!Object.keys(u).length||n===yn||e[i].scheduleItems.push({...u,scheduledDate:Ci(u==null?void 0:u.scheduledDate),scheduledTime:rr(u==null?void 0:u.scheduledTime),checkScoreHasValue:uo({score:p}),matchUpStatus:n,roundPosition:r,structureId:a,matchUpType:o,roundNumber:s,matchUpId:l,potential:c,drawId:d})}function sh({requireTimeStamp:t,scaleAttributes:e,participant:i}){var n,r;if(!i)return{error:nw};if(!sr(e))return{error:Me};if(i.timeItems||(i.timeItems=[]),Array.isArray(i.timeItems)){let{accessor:a,scaleType:o,eventType:s,scaleName:l}=e,c=[oI,o,s,l].join("."),u=i.timeItems.filter(d=>(d==null?void 0:d.itemType)===c).filter(d=>!t||(d==null?void 0:d.itemDate)).sort((d,p)=>(d.createdAt?new Date(d.createdAt).getTime():0)-(p.createdAt?new Date(p.createdAt).getTime():0)).pop();if(u){let[d,p,h,f]=((n=u.itemType)==null?void 0:n.split("."))??[];if(d!==oI)return{error:FP};let m=((r=a&&Ob({element:u.itemValue,accessor:a}))==null?void 0:r.value)||u.itemValue,g={eventType:h,scaleDate:u.itemDate,scaleValue:m,scaleName:f,scaleType:p};return{...ue,scaleItem:g}}}return{...ue,scaleItem:void 0}}function $ze({publishedSeeding:t,usePublishState:e,withSeeding:i,participant:n,event:r}){var a,o,s;let l={},c=h=>[oI,ah,r.eventType,h].join("."),u=Object.assign({},...(n.timeItems||[]).filter(({itemType:h})=>h.split(".")[1]===ah).map(({itemType:h,itemValue:f})=>({[h]:f}))),d=((t==null?void 0:t.stageSeedingScaleNames)&&Object.values(t==null?void 0:t.stageSeedingScaleNames)||Array.isArray(t==null?void 0:t.seedingScaleNames)&&t.seedingScaleNames||[]).map(c),p=Wr(Object.keys(u),d);if((!e||!Object.keys(u).length&&!((a=t==null?void 0:t.drawIds)!=null&&a.length)||p.length)&&p.length){if(t!=null&&t.stageSeedingScaleNames){let h=Object.keys(t.stageSeedingScaleNames).map(m=>{let g=c(t.stageSeedingScaleNames[m]),v=u[g];return[m,v]}).filter(m=>m[1]).map(m=>({[m[0]]:{seedValue:m[1]}})),f=Object.assign({},...h);l.seedAssignments=f}else if(p){let h=p.map(f=>u[f]);l.seedValue=h.pop()}}else if(!e&&typeof i=="object"){let h=Object.keys(i).map(m=>{let g=c(i[m]),v=u[g];return[m,v]}).filter(m=>m[1]).map(m=>({[m[0]]:{seedValue:m[1]}})),f=Object.assign({},...h);l.seedAssignments=f}else{let{categoryName:h,ageCategoryCode:f}=r.category||{},m=[f,r.eventId,h].filter(Boolean),g;for(let v of m){let y={eventType:r.eventType,scaleType:ah,scaleName:v},b=sh({scaleAttributes:y,participant:n});if(b.scaleItem){g=b.scaleItem;break}}if(g&&(!e||t!=null&&t.published&&!((s=(o=t==null?void 0:t.published)==null?void 0:o.drawIds)!=null&&s.length))){let v=g.scaleValue;l.seedValue=v}}return l}function Vze({convertExtensions:t,seedAssignments:e,participant:i,withSeeding:n,seedValue:r,eventId:a,ranking:o,entry:s}){let{entryStatus:l,entryStage:c,entryPosition:u,extensions:d}=s,p=d!=null&&d.length&&t?Object.assign({},...N5(d??[])):{},h=Object.assign(p,{entryPosition:u,entryStatus:l,entryStage:c,ranking:o,eventId:a});i.events[a]=qt(h,!1,!1,!0),n&&(e&&(i.events[a].seedAssignments=e),r&&(i.events[a].seedValue=r))}function _L(t,e){return(t||"").localeCompare(e||"")}function jze({tournamentRecord:t,status:e=Wu}){var i,n,r;let a=`${By}.${$y}`;return(r=(n=(i=dR({tournamentRecord:t,itemType:a}))==null?void 0:i.timeItem)==null?void 0:n.itemValue)==null?void 0:r[e]}function Gze(t){let{tournamentId:e}=t??{};return!!e}function Xc({event:t,status:e=Wu}){var i,n,r;let a=`${By}.${$y}`;return(r=(n=(i=uR({itemType:a,event:t}))==null?void 0:i.timeItem)==null?void 0:n.itemValue)==null?void 0:r[e]}function E6({drawDetails:t,drawId:e}){var i,n;return(n=(i=t==null?void 0:t[e])==null?void 0:i.publishingDetail)==null?void 0:n.published}function mw(t){var e,i,n,r,a,o,s;let{tournamentRecord:l,drawDefinition:c,eventIds:u,eventId:d,drawIds:p,drawId:h,event:f}=t??{};if(l&&!Gze(l))return{error:Me};if(d&&!f)return{error:kl};if(Array.isArray(u)&&u!=null&&u.length){let b={};for(let I of u){if(!qs(I))return{error:Me};let T=(e=Ks({tournamentRecord:l,eventId:I}))==null?void 0:e.event;if(!T)return{error:kl};let w=l$({event:T});b[I]=w}return{...ue,publishState:b}}if(f){let b=l$({event:f}),I={};if(h)return c?{publishState:{status:{published:!!((i=b.status.publishedDrawIds)!=null&&i.includes(h)),drawDetail:(n=b.status.drawDetails)==null?void 0:n[h]},...ue}}:{error:_l};if(Array.isArray(p)&&p!=null&&p.length){let T=((r=f.drawDefinitions)==null?void 0:r.map(fE))??[];for(let w of p){if(!qs(w))return{error:Me};if(!T.includes(w))return{error:_l};I[w]={status:{published:!!b.status.publishedDrawIds.includes(w),drawDetail:(a=b.status.drawDetails)==null?void 0:a[w]}}}}else I=b;return{...ue,publishState:I}}let m=[],g=!1,v={},y=jze({tournamentRecord:l});v.tournament=y??{};for(let b of(l==null?void 0:l.events)??[]){let I=l$({event:b});v[b.eventId]=I,I.status.published&&(m.push(b.eventId),g=!0);for(let{drawId:T}of b.drawDefinitions??[]){let w=(s=(o=I.status)==null?void 0:o.publishedDrawIds)==null?void 0:s.includes(T);w&&(v[T]={status:{published:w}})}}return l&&(v.tournament.status={published:g,publishedEventIds:m}),{...ue,publishState:v}}function l$({event:t}){var e;let i=Xc({event:t});if(!i)return{status:{published:!1}};let n={published:void 0,seedingScaleNames:[],drawIds:[]};i.seeding&&Object.assign(n,i.seeding);let r=i.drawDetails??{};for(let o of((e=t.drawDefinitions)==null?void 0:e.map(fE))||[])r[o]||(r[o]={publishingDetail:{published:!1}});let a=r&&Object.keys(r).length&&Object.keys(r).filter(o=>E6({drawDetails:r,drawId:o}))||i.drawIds;return{status:{published:a&&a.length>0,publishedDrawIds:a,publishedSeeding:n,drawDetails:r}}}function Hze({finishingPositionRange:t={},participantMap:e,finishingRound:i,participantWon:n,matchUpStatus:r,participantId:a,stageSequence:o,roundNumber:s,structureId:l,matchUpId:c,drawId:u,stage:d}){let p=e[a],h=y=>Math.abs(y[0]-y[1]);p.structureParticipation[l]||(p.structureParticipation[l]={rankingStage:d,walkoverWinCount:0,defaultWinCount:0,stageSequence:o,winCount:0,structureId:l,drawId:u});let f=p.structureParticipation[l],{winner:m,loser:g}=t,v=n?m:g;n&&(f.winCount+=1,r===Rn&&(f.walkoverWinCount+=1),r===fn&&(f.defaultWinCount+=1)),v&&(!f.finishingPositionRange||h(v)<h(f.finishingPositionRange))&&(f.finishingPositionRange=v),i&&((!f.finishingRound||i<f.finishingRound)&&(f.finishingMatchUpId=c,f.finishingRound=i,f.roundNumber=s),i===1&&(f.participantWon=n))}function jZ(t){var e,i,n,r,a,o,s,l,c,u;let{withScheduleItems:d,scheduleAnalysis:p,withTeamMatchUps:h,participantMap:f,withOpponents:m,withMatchUps:g,withEvents:v,withDraws:y,finishingPositionRange:b,finishingRound:I,matchUpStatus:T,stageSequence:w,roundNumber:S,structureId:D,score:E,stage:C,withRankingProfile:P,tieWinningSide:R,roundPosition:N,matchUpTieId:M,matchUpSides:A,collectionId:_,matchUpType:x,winningSide:O,matchUpId:B,schedule:F,eventId:G,drawId:H,sides:$}=t,q=m&&($==null?void 0:$.length)===2&&Object.assign({},...$.map(({sideNumber:z},Z)=>{let Y=$[1-Z].participantId;return z&&{[z]:Y}}).filter(Boolean));for(let z of $){let{participantId:Z,sideNumber:Y,bye:Q}=z;if(Q)continue;let X=O===Y,oe=se=>{var te,he;let ae=(te=f[se])==null?void 0:te.participant,de=ae==null?void 0:ae.participantType,Ie=[{participantId:se,participantType:de}];if(de!==_c)for(let De of(ae==null?void 0:ae.individualParticipantIds)||[]){let Te=(he=f[De])==null?void 0:he.participant;Ie.push({participantType:Te==null?void 0:Te.participantType,participantId:De})}return Ie},re=(se,te)=>{if(g){if(f[se].matchUps[B]={participantWon:X,matchUpType:x,structureId:D,sideNumber:Y,matchUpId:B,eventId:G,drawId:H,stage:C},m){let he=oe(te);f[se].matchUps[B].opponentParticipantInfo=he}_&&(f[se].matchUps[B].collectionId=_)}m&&te&&(f[se].opponents[te]={participantId:te,matchUpId:B,eventId:G,drawId:H}),P&&Hze({finishingPositionRange:b,participantMap:f,participantWon:X,finishingRound:I,matchUpStatus:T,participantId:se,stageSequence:w,roundNumber:S,structureId:D,matchUpId:B,drawId:H,stage:C}),(p||d)&&wve({participantMap:f,participantId:se,matchUpStatus:T,roundPosition:N,matchUpType:x,roundNumber:S,structureId:D,matchUpId:B,schedule:F,drawId:H,score:E})},me=({participant:se,partnerParticipantId:te})=>{var he,ae,de;let Ie=(De,Te)=>{De&&(De.partnerParticipantIds||(De.partnerParticipantIds=[]),De.partnerParticipantIds.includes(Te)||De.partnerParticipantIds.push(Te))};y&&Ie((he=se==null?void 0:se.draws)==null?void 0:he[H],te),v&&Ie((ae=se==null?void 0:se.events)==null?void 0:ae[G],te),g&&Ie((de=se==null?void 0:se.matchUps)==null?void 0:de[B],te)};if(Z&&f[Z]){let se=q==null?void 0:q[Y];re(Z,se);let te=((e=f[Z])==null?void 0:e.participant.participantType)===Ui,he=((i=f[Z])==null?void 0:i.participant.individualParticipantIds)||[];if(M){if(h){let ae=de=>f[de].matchUps[M]={participantWon:R===Y,matchUpId:M,matchUpType:Jn,sideNumber:Y};ae(Z),he.forEach(ae)}if(y&&!f[Z].draws[H]){let ae=(r=(n=A.find(De=>De.sideNumber===Y))==null?void 0:n.participant)==null?void 0:r.participantId,de=(s=(o=(a=f[ae])==null?void 0:a.draws)==null?void 0:o[H])==null?void 0:s.entryStatus,Ie=De=>f[De].draws[H]={entryStatus:de,eventId:G,drawId:H};Ie(Z),he.forEach(Ie)}}if(te&&(he.forEach(ae=>f[ae]&&re(ae,se)),he.forEach((ae,de)=>{let Ie=he[1-de],De=f[ae];De&&me({participant:De,partnerParticipantId:Ie})}),v&&A)){let ae=(c=(l=A.find(de=>de.sideNumber===Y))==null?void 0:l.participant)==null?void 0:c.participantId;if(ae){let de=(u=f[ae])==null?void 0:u.events[G];de?(f[Z].events[G]={...de},he.forEach(Ie=>f[Ie].events[G]={...de})):console.log("Missing teamEntry",{eventId:G,teamParticipantId:ae})}}if(O){let ae=de=>{X?(f[de].counters[x].wins+=1,f[de].counters.wins+=1,T===Rn&&(f[de].counters[x].walkoverWins+=1,f[de].counters.walkoverWins+=1),T===fn&&(f[de].counters[x].defaultWins+=1,f[de].counters.defaultWins+=1)):(f[de].counters[x].losses+=1,f[de].counters.losses+=1,T===Rn&&(f[de].counters[x].walkovers+=1,f[de].counters.walkovers+=1),T===fn&&(f[de].counters[x].defaults+=1,f[de].counters.defaults+=1))};ae(Z),he.forEach(ae)}}}}function zze(t){var e,i,n,r,a,o,s;let{participantFilters:l,convertExtensions:c,policyDefinitions:u,tournamentRecord:d,usePublishState:p,contextProfile:h,participantMap:f,withPotentialMatchUps:m,withRankingProfile:g,withScheduleItems:v,scheduleAnalysis:y,withTeamMatchUps:b,withStatistics:I,withOpponents:T,withMatchUps:w,withSeeding:S,withEvents:D,withDraws:E}=t,C=l==null?void 0:l.participantIds,P=F=>{var G,H;let $=[F];return(H=(G=f[F])==null?void 0:G.participant.individualParticipantIds)==null||H.forEach(q=>$.push(q)),$.some(q=>!(C!=null&&C.length)||C.includes(q))?$:[]},R={withMatchUps:w||g,withEvents:D||g,withDraws:E||g,withPotentialMatchUps:m,withRankingProfile:g,withScheduleItems:v,scheduleAnalysis:y,withTeamMatchUps:b,withStatistics:I,participantMap:f,withOpponents:T,withSeeding:S},N=[],M={},A=[],_={},x={},O={},B=({eventType:F,scaleNames:G,participantId:H})=>{var $,q,z,Z;return(Z=(z=(q=($=f[H].participant)==null?void 0:$.rankings)==null?void 0:q[F])==null?void 0:z.find(Y=>G.includes(Y.scaleName)))==null?void 0:Z.scaleValue};for(let F of(d==null?void 0:d.events)||[]){if(l!=null&&l.eventIds&&!l.eventIds.includes(F.eventId))continue;let{drawDefinitions:G=[],extensions:H=[],eventType:$,eventName:q,category:z,entries:Z,eventId:Y,gender:Q}=F,{flightProfile:X}=Xr({event:F}),oe=(X==null?void 0:X.flights)??[],re=mw({event:F}).publishState;re&&(_[Y]=re);let me=(e=re==null?void 0:re.status)==null?void 0:e.publishedSeeding;if(D||S||g){let te=c?Object.assign({},...N5(H??[])):{};x[Y]={...te,eventName:q,eventType:$,category:z,eventId:Y,gender:Q};let he=[z==null?void 0:z.categoryName,z==null?void 0:z.ageCategoryCode].filter(Boolean);for(let ae of Z){let{participantId:de}=ae;if(!de||!f[de])continue;let Ie=B({eventType:$,scaleNames:he,participantId:de}),De,Te;if(S){let Ve=f[de].participant;({seedAssignments:De,seedValue:Te}=$ze({publishedSeeding:me,usePublishState:p,withSeeding:S,participant:Ve,event:F}))}let _e=Ve=>{var ot,St;if((St=(ot=f[Ve])==null?void 0:ot.events)!=null&&St[Y])return;let nt=f[Ve];Vze({convertExtensions:c,seedAssignments:De,participant:nt,withSeeding:S,seedValue:Te,eventId:Y,ranking:Ie,entry:ae})};_e(de),(f[de].participant.individualParticipantIds||[]).forEach(_e)}}let se=(i=_==null?void 0:_[Y])==null?void 0:i.publishedSeeding;if(E||g||S){let te=ae=>ae?Object.assign({},...ae.map(({participantId:de,seedValue:Ie,seedNumber:De})=>({[de]:{seedValue:Ie,seedNumber:De}}))):void 0,he=ki([...G.map(fE),...oe.map(fE)]);for(let ae of he){let de=G.find(ge=>ge.drawId===ae),Ie=oe==null?void 0:oe.find(ge=>ge.drawId===ae),De=(de==null?void 0:de.entries)||(Ie==null?void 0:Ie.drawEntries),{structures:Te=[],drawOrder:_e,drawName:Ve,drawType:ot}=de??{},St=Ie==null?void 0:Ie.flightNumber,nt=[z==null?void 0:z.categoryName,z==null?void 0:z.ageCategoryCode].filter(Boolean),Bt=((de==null?void 0:de.structures)||[]).sort((ge,Se)=>cw(ge,Se)).map(({structureId:ge,structures:Se})=>[ge,...(Se||[]).map(({structureId:qe})=>qe)]).flat(1/0),Pe,et,Ee,lt,Ke=0,bt=Te.filter(({stage:ge,stageSequence:Se})=>ge===Ft&&Se===1||ge===Xt).flatMap(ge=>{let{seedAssignments:Se,stageSequence:qe,stage:$e}=ge,{positionAssignments:ke}=jn({structure:ge});return $e===Ft?(Ke=(ke==null?void 0:ke.length)??0,Ee=ke,lt=Se):qe===1&&(Pe=ke,et=Se),ke}).map(({participantId:ge})=>ge).filter(Boolean),gt=te(lt),Ue=te(et),xe=de?De.filter(({participantId:ge})=>bt.includes(ge)):De,We=!p||(se==null?void 0:se.published)&&(((n=se==null?void 0:se.drawIds)==null?void 0:n.length)===0||((r=se==null?void 0:se.drawIds)==null?void 0:r.includes(ae)));for(let ge of xe){let{entryStatus:Se,entryStage:qe,entryPosition:$e,participantId:ke}=ge,Ut=B({participantId:ke,scaleNames:nt,eventType:$}),pt=tt=>{var At,ei,vi,Ln,gn;if((At=f[tt].draws)!=null&&At[ae])return;let Jt=S&&We,kr=Jt?{}:void 0,Kn=Jt?((ei=gt==null?void 0:gt[ke])==null?void 0:ei.seedValue)||((vi=gt==null?void 0:gt[ke])==null?void 0:vi.seedNumber):void 0,Gt=Kn?gt==null?void 0:gt[ke]:void 0,Ji=Jt?((Ln=Ue==null?void 0:Ue[ke])==null?void 0:Ln.seedValue)||((gn=Ue==null?void 0:Ue[ke])==null?void 0:gn.seedNumber):void 0,xo=Ji?Ue==null?void 0:Ue[ke]:void 0;kr&&Kn&&(kr[Ft]=Gt),kr&&Ji&&(kr[Xt]=xo);let na=Kn||Ji;na&&(f[tt].participant.seedings[$]||(f[tt].participant.seedings[$]=[]),Gt&&f[tt].participant.seedings[$].push({...Gt,scaleName:ae}),xo&&f[tt].participant.seedings[$].push({...xo,scaleName:ae}),kr&&(f[tt].events[Y].seedAssignments||(f[tt].events[Y].seedAssignments={}),Object.keys(kr).forEach(ra=>f[tt].events[Y].seedAssignments[ra]=kr[ra]))),(E||g)&&(f[tt].draws[ae]=qt({seedAssignments:kr,entryPosition:$e,entryStatus:Se,entryStage:qe,seedValue:na,eventId:Y,ranking:Ut,drawId:ae},!1,!1,!0))};[zu,Oy].includes(Se)||(pt(ke),(a=f[ke].participant.individualParticipantIds||[])==null||a.forEach(pt))}let st=((de==null?void 0:de.structures)??[]).reduce((ge,Se)=>(ge.includes(Se.stage)||ge.push(Se.stage),ge),[]),vt=((de==null?void 0:de.links)??[]).length;O[ae]={qualifyingPositionAssignments:Pe,qualifyingSeedAssignments:et,mainPositionAssignments:Ee,qualifyingSeedingMap:Ue,mainSeedAssignments:lt,orderedStructureIds:Bt,mainSeedingMap:gt,flightNumber:St,linksCount:vt,drawOrder:_e,drawName:Ve,drawType:ot,drawSize:Ke,drawId:ae,stages:st}}}if(g||y||b||I||T||w||E){let te=!!y||m,he=((o=pm({afterRecoveryTimes:!!y,policyDefinitions:u,tournamentRecord:d,inContext:!0,contextProfile:h,participantMap:f,nextMatchUps:te,event:F}))==null?void 0:o.matchUps)??[];for(let ae of he){let{finishingPositionRange:de,potentialParticipants:Ie,tieMatchUps:De=[],sides:Te=[],winningSide:_e,matchUpType:Ve,matchUpId:ot,eventId:St,drawId:nt,collectionId:Bt,stageSequence:Pe,finishingRound:et,matchUpStatus:Ee,roundPosition:lt,roundNumber:Ke,structureId:bt,schedule:gt,score:Ue,stage:xe}=ae;M[ot]=ae;let We={finishingPositionRange:de,finishingRound:et,stageSequence:Pe,roundPosition:lt,collectionId:Bt,roundNumber:Ke,structureId:bt,schedule:gt,eventId:St,drawId:nt,score:Ue,stage:xe};jZ({...We,...R,matchUpStatus:Ee,winningSide:_e,matchUpType:Ve,matchUpId:ot,sides:Te});for(let st of De){let{winningSide:vt,sides:ge=[],matchUpId:Se,matchUpStatus:qe,matchUpType:$e}=st;jZ({...We,...R,winningSide:vt,tieWinningSide:_e,matchUpTieId:ot,matchUpId:Se,sides:ge,matchUpSides:Te,matchUpStatus:qe,matchUpType:$e})}Array.isArray(Ie)&&(te||y||v)&&((s=Ie.flat().map(Wi).filter(Boolean))==null||s.forEach(st=>{var vt;(vt=P(st))==null||vt.forEach(ge=>{f[ge]&&(f[ge].potentialMatchUps[ot]=qt({tournamentId:d==null?void 0:d.tournamentId,matchUpId:ot,eventId:St,drawId:nt}))}),(y||v)&&wve({potential:!0,participantMap:f,participantId:st,matchUpStatus:Ee,roundPosition:lt,structureId:bt,matchUpType:Ve,roundNumber:Ke,matchUpId:ot,schedule:gt,drawId:nt,score:Ue})}))}A.push(...he)}}if(I||g||y){let F=Object.values(f);for(let G of F){let{wins:H,losses:$,[Mr]:{wins:q,losses:z},[Zn]:{wins:Z,losses:Y}}=G.counters,Q=(X,oe,re)=>{let me=oe+re,se=oe,te=me&&se/me;G.statistics[X]={denominator:me,numerator:se,statValue:te,statCode:X}};if(I&&(Q(VN,H,$),Q(`${VN}.${Mr}`,q,z),Q(`${VN}.${Zn}`,Z,Y)),g){let X=(oe=[])=>Math.abs(oe[0]-oe[1]);for(let oe of Object.keys(G.draws)){let{orderedStructureIds:re=[],flightNumber:me}=O[oe]||{};if(G.structureParticipation&&re.length){let se,te=0,he=re.map(ae=>{let de=G.structureParticipation[ae];if(!de)return;se||(se=de==null?void 0:de.finishingPositionRange),X(se)>X(de==null?void 0:de.finishingPositionRange)&&(se=de==null?void 0:de.finishingPositionRange);let Ie=de.stage!==Xt;return Ie&&(te+=1),qt({...de,participationOrder:Ie?te:void 0,flightNumber:me})}).filter(Boolean);G.draws[oe]&&(G.draws[oe].finishingPositionRange=se,G.draws[oe].structureParticipation=he)}}}if(y){let X=sr(y)?y.scheduledMinutesDifference:0,oe=G.scheduleItems||[],re=G.potentialMatchUps||{},me=oe.reduce((te,he)=>{let{scheduledDate:ae,scheduledTime:de}=he;return te[ae]||(te[ae]=[]),de&&te[ae].push(he),te},{});Object.values(me).forEach(te=>te.sort(Qme));for(let te of oe){let{typeChangeTimeAfterRecovery:he,timeAfterRecovery:ae,scheduledDate:de,scheduledTime:Ie}=te,De=me[de],Te=on(Ie);for(let _e of De){if(_e.matchUpId===te.matchUpId||[Rn,fn].includes(_e.matchUpStatus)&&!_e.checkScoreHasValue)continue;let Ve=te.matchUpType!==_e.matchUpType&&he||ae,ot=te.drawId===_e.drawId,St=re[te.matchUpId]&&re[_e.matchUpId],nt=on(_e.scheduledTime),Bt=Math.abs(nt-Te),Pe=nt>=Te;if((X&&!isNaN(X)?Bt<=X:Pe&&on(_e.scheduledTime)<on(Ve))&&!(St&&ot)&&Pe){let et=[te.matchUpId,_e.matchUpId].sort(_L).join("|");G.scheduleConflicts[et]={priorScheduledMatchUpId:te.matchUpId,matchUpIdWithConflict:_e.matchUpId}}}}let se=G.participant.participantId;Object.keys(G.scheduleConflicts).length&&N.push(se),f[se].scheduleConflicts=G.scheduleConflicts}}}return{participantIdsWithConflicts:N,eventsPublishStatuses:_,derivedEventInfo:x,derivedDrawInfo:O,mappedMatchUps:M,participantMap:f,matchUps:A}}function mR({participantFilters:t={},tournamentRecord:e,participants:i=[]}){var n;if(!Object.keys(t).length)return i;let{accessorValues:r,drawEntryStatuses:a,positionedParticipants:o,eventEntryStatuses:s,participantRoles:l,participantRoleResponsibilities:c,participantTypes:u,participantIds:d,signInStatus:p,enableOrFiltering:h,eventIds:f,genders:m}=t,g=Bp(f)&&((n=e==null?void 0:e.events)==null?void 0:n.filter(T=>f==null?void 0:f.includes(T.eventId)))||(e==null?void 0:e.events)||[],v=a&&qze({drawEntryStatuses:a,tournamentEvents:g}),y=s&&Wze({eventEntryStatuses:s,tournamentEvents:g}),b=o!==void 0&&[!0,!1].includes(o)&&g.reduce((T,w)=>T.concat(...(w.drawDefinitions||[]).map(S=>Cge({drawDefinition:S}).allPositionedParticipantIds).filter(Boolean)),[]),I=T=>r==null?void 0:r.reduce((w,S)=>{let{accessor:D,value:E}=S,{values:C}=Ob({element:T,accessor:D});return w&&(C==null?void 0:C.includes(E))},!0);if(i=i==null?void 0:i.filter(T=>{var w,S;let D=(S=(w=kp({element:T,itemType:XP}))==null?void 0:w.timeItem)==null?void 0:S.itemValue,{participantRoleResponsibilities:E,participantType:C,participantRole:P,participantId:R,person:N}=T,M=Array.isArray(m)&&(m==null?void 0:m.length)&&(N==null?void 0:N.sex)&&m.includes(N.sex);return h?m&&M||o&&b.includes(R)||o===!1&&!b.includes(R)||(v==null?void 0:v.includes(R))||(y==null?void 0:y.includes(R))||(d==null?void 0:d.includes(R))||p&&D===p||u&&C&&Bp(u)&&u.includes(C)||l&&P&&Bp(l)&&l.includes(P)||c&&Bp(E)&&Bp(c)&&c.find(A=>E==null?void 0:E.includes(A))||(r==null?void 0:r.length)&&Bp(r)&&I(T):(!m||M)&&(o===void 0||o&&b.includes(R)||o===!1&&!b.includes(R))&&(!v||v.includes(R))&&(!y||y.includes(R))&&(!d||d.includes(R))&&(!p||D===p)&&(!u||C&&Bp(u)&&u.includes(C))&&(!l||P&&Bp(l)&&l.includes(P))&&(!c||Bp(E)&&Bp(c)&&c.find(A=>E==null?void 0:E.includes(A)))&&(!(r!=null&&r.length)||Bp(r)&&I(T))}),g.length&&f){let T=g.filter(w=>f.includes(w.eventId)).map(w=>{let S=(w.entries||[]).map(E=>E.participantId);if(Hr(Mh)(w.eventType))return S;let D=((e==null?void 0:e.participants)??[]).filter(E=>S.includes(E.participantId)).map(E=>E.individualParticipantIds).flat(1);return S.concat(...D)}).flat(1);i=i==null?void 0:i.filter(w=>T.includes(w.participantId))}return i}function Bp(t){return t&&Array.isArray(t)&&t.length}function qze({drawEntryStatuses:t,tournamentEvents:e}){let i=({entryStatus:n})=>Array.isArray(t)?t.includes(n):!0;return ki(e.reduce((n,r)=>{var a,o;let{flightProfile:s}=Xr({event:r}),l=((a=s==null?void 0:s.flights)==null?void 0:a.map(({drawEntries:u})=>Array.isArray(u)?u.filter(i).map(Wi):[]).flat())||[],c=((o=r.drawDefinitions)==null?void 0:o.map(({entries:u})=>u?u.filter(i).map(Wi):[]))||[];return n.concat(...l,...c)},[]))}function Wze({eventEntryStatuses:t,tournamentEvents:e}){return ki(e.reduce((i,n)=>{let r=(n.entries||[]).filter(({entryStatus:a})=>Array.isArray(t)?t.includes(a):!0).map(Wi);return i.concat(...r)},[]))}function Yr(t){var e;let{withIndividualParticipants:i,participantFilters:n={},withPotentialMatchUps:r,withRankingProfile:a,convertExtensions:o,policyDefinitions:s,withScheduleItems:l,tournamentRecord:c,scheduleAnalysis:u,withSignInStatus:d,withTeamMatchUps:p,withScaleValues:h,usePublishState:f,contextProfile:m,withStatistics:g,withOpponents:v,withMatchUps:y,internalUse:b,withSeeding:I,withEvents:T,withDraws:w,withISO2:S,withIOC:D}=t;if(!c)return{error:it};(y||a)&&Ku({tournamentRecord:c});let{participantMap:E}=gve({convertExtensions:o,tournamentRecord:c,withSignInStatus:d,withScaleValues:h,internalUse:b,withISO2:S,withIOC:D}),C=zze({withMatchUps:y??a,withEvents:T??a,withDraws:w??a,withPotentialMatchUps:r,participantFilters:n,withRankingProfile:a,convertExtensions:o,withScheduleItems:l,policyDefinitions:s,tournamentRecord:c,scheduleAnalysis:u,withTeamMatchUps:p,usePublishState:f,withStatistics:g,participantMap:E,withOpponents:v,contextProfile:m,withSeeding:I}),{participantIdsWithConflicts:P,eventsPublishStatuses:R,derivedEventInfo:N,derivedDrawInfo:M,mappedMatchUps:A}=C,_=C.matchUps;E=C.participantMap;let x=u??r,O=({potentialMatchUps:q,scheduleConflicts:z,scheduleItems:Z,participant:Y,statistics:Q,opponents:X,matchUps:oe,events:re,draws:me})=>{let se=Object.values(me),te=Object.values(X);return v&&(se==null||se.forEach(he=>{he.opponents=te.filter(ae=>ae.drawId===he.drawId)})),qt({...Y,scheduleConflicts:u?Object.values(z):void 0,draws:w||a?se:void 0,events:T||a?Object.values(re):void 0,matchUps:y||a?Object.values(oe):void 0,opponents:v?te:void 0,potentialMatchUps:x?Object.values(q):void 0,statistics:g?Object.values(Q):void 0,scheduleItems:l?Z:void 0},!1,!1,!0)},B=new Map;for(let q of Object.keys(E))B.set(q,O(E[q]));let F=[...B.values()],G=(e=s==null?void 0:s[pU])==null?void 0:e.participant,H=mR({participants:F,participantFilters:n,tournamentRecord:c});if(i){let q=sr(i)?i:void 0;for(let z of H)for(let Z of z.individualParticipantIds??[]){z.individualParticipants||(z.individualParticipants=[]);let Y=B.get(Z);z.individualParticipants.push(q?sI({template:q,source:Y}):Y)}}let $=G?H.map(q=>sI({source:q,template:G})):H;return{participantIdsWithConflicts:P,eventsPublishStatuses:R,derivedEventInfo:N,derivedDrawInfo:M,mappedMatchUps:A,participantMap:E,participants:$,...ue,matchUps:_}}function Lb({participantId:t,drawDefinition:e,entryStatus:i,entryStage:n}){var r;if(!e)return{error:Lt};let a=(r=e.entries)==null?void 0:r.find(o=>o.participantId===t&&(!i||i===o.entryStatus)&&(!n||n===o.entryStage));return t&&a}function TU(t){var e,i,n,r,a,o,s,l,c;let{provisionalPositioning:u,drawDefinition:d,stageSequence:p,structureId:h,stage:f}=t;if(!d)return{error:Lt};let{entryProfile:m}=JP({drawDefinition:d}),g=f&&p&&((n=(i=(e=m==null?void 0:m[f])==null?void 0:e.stageSequence)==null?void 0:i[p])==null?void 0:n.qualifiersCount)||f&&((r=m==null?void 0:m[f])==null?void 0:r.qualifiersCount)||0,v={};if(!h)return{qualifiersCount:g,roundQualifiersCounts:v};let{structure:y}=pi({drawDefinition:d,structureId:h}),b=(a=d.links)==null?void 0:a.filter(w=>{var S;return((S=w==null?void 0:w.target)==null?void 0:S.structureId)===(y==null?void 0:y.structureId)}),I=0;if(b!=null&&b.length)for(let w of b){let S=(o=pi({structureId:w.source.structureId,drawDefinition:d}))==null?void 0:o.structure;if((S==null?void 0:S.stage)===Xt){let D=w.source.roundNumber,E=w.target.roundNumber,C=0;if(S.structureType===xs){let P=((s=S.structures)==null?void 0:s.length)??0,R=((l=w.source.finishingPositions)==null?void 0:l.length)??0;C=P*R}else C=((c=Sn({matchUpFilters:{roundNumbers:[D]},structure:S,afterRecoveryTimes:!1,provisionalPositioning:u,inContext:!1}).matchUps)==null?void 0:c.length)||0;v[E]||(v[E]=0),v[E]+=C,I+=C}}let T=Object.keys(v);if(T.length<=1){let w=T[0]||1;v[w]=Math.max(v[w]||0,g)}return I=Math.max(I,g),{qualifiersCount:I,roundQualifiersCounts:v}}function N_({stage:t,drawDefinition:e}){var i;let{entryProfile:n}=JP({drawDefinition:e});return((i=n==null?void 0:n[t])==null?void 0:i.drawSize)||0}function Kze(t){let{provisionalPositioning:e,drawDefinition:i,stageSequence:n,stage:r}=t,a=N_({stage:r,drawDefinition:i}),{qualifiersCount:o}=TU({provisionalPositioning:e,drawDefinition:i,stageSequence:n,stage:r});return a&&a-o}function Sve({stage:t,drawDefinition:e}){return!!(t===to||u6({stage:t,drawDefinition:e})&&N_({stage:t,drawDefinition:e}))}function Tve({entryStatus:t=tc,drawDefinition:e,stageSequence:i,stage:n}){if(t===Su)return UHe({stage:n,drawDefinition:e})?{positionsAvailable:1/0,...ue}:{error:ime};let r=Kze({drawDefinition:e,stageSequence:i,stage:n}),a=DHe({drawDefinition:e,stage:n}),o=aj({entryStatus:jS,drawDefinition:e,stage:n}),s=aj({entryStatus:tc,drawDefinition:e,stage:n}),l=o+s,c=l>=r,u=r-l;return n!==to&&c?{error:YV}:t===jS?o<a?{...ue}:{error:YV}:{positionsAvailable:u,...ue}}function Uve(t){let{entryStatus:e=tc,entryStageSequence:i,entryStage:n=Ft,ignoreStageSpace:r,drawDefinition:a,entryPosition:o,participant:s,roundTarget:l,extensions:c,extension:u,drawType:d}=t,p="addDrawEntry";if(!a)return{error:Lt};if(!n)return{error:K4};if(d!==_u&&!Sve({stage:n,drawDefinition:a}))return fe({result:{error:Ay},stack:p});let h=Tve({stageSequence:i,stage:n,drawDefinition:a,entryStatus:e});if(!r&&!h.success&&(!d||d!==_u))return{error:h.error};if(u&&!yp({extension:u}))return fe({result:{error:Me},info:"Invalid extension",context:{extension:u},stack:p});let f=t.participantId||(s==null?void 0:s.participantId);if(!f)return fe({result:{error:Ra},stack:p});let m=e===$f&&Lb({participantId:f,drawDefinition:a,entryStatus:e}),g=n===to&&Lb({participantId:f,drawDefinition:a,entryStage:n}),v=e!==$f&&n!==to&&Lb({drawDefinition:a,participantId:f});if(v||m||g)return fe({context:{invalidEntry:v,invalidLuckyLoser:m,invalidVoluntaryConsolation:g},result:{error:tL},stack:p});let y=qt({entryStageSequence:i,participantId:f,entryPosition:o,entryStatus:e,entryStage:n,extensions:c});return u&&un({element:y,extension:u}),l&&un({extension:{name:"roundEntry",value:l},element:y}),a.entries||(a.entries=[]),a.entries.push(y),er({drawDefinition:a}),{...ue}}function Yze(t){let e="addDrawEntries",{entryStatus:i=tc,stage:n=Ft,autoEntryPositions:r=!0,ignoreStageSpace:a,drawDefinition:o,participantIds:s,stageSequence:l,roundTarget:c,extension:u}=t;if(!n)return{error:K4};if(!o)return{error:Lt};if(!Array.isArray(s))return{error:wu};if(!Sve({stage:n,drawDefinition:o}))return{error:Ay};if(u&&!yp({extension:u}))return fe({result:{error:Me},info:"Invalid extension",context:{extension:u},stack:e});let d=Tve({drawDefinition:o,stageSequence:l,entryStatus:i,stage:n});if(!a&&!d.success)return{error:d.error};let p=d.positionsAvailable??0;if(!a&&n!==to&&p<s.length)return{error:n5};let h=s.reduce((f,m)=>{let g=i===$f&&Lb({participantId:m,drawDefinition:o,entryStatus:i}),v=n===to&&Lb({entryStage:n,drawDefinition:o,participantId:m});return i!==$f&&n!==to&&Lb({drawDefinition:o,participantId:m})||g||v?f.concat(m):f},[]);return s.filter(f=>f&&!h.includes(f)).forEach(f=>{let m={entryStageSequence:l,entryStage:n,participantId:f,entryStatus:i};u&&un({element:m,extension:u}),c&&un({extension:{name:Ap,value:c},element:m}),o.entries||(o.entries=[]),o.entries.push(m)}),r&&(o.entries=gd({entries:o.entries})),er({drawDefinition:o}),h!=null&&h.length?{info:"some participantIds could not be added",participantIdsNotAdded:h,...ue}:{...ue}}function C6({autoEntryPositions:t=!0,entryStageSequence:e,ignoreStageSpace:i,drawDefinition:n,participantIds:r,entryStatus:a,roundTarget:o,entryStage:s,extension:l,drawId:c,event:u}){if(!(r!=null&&r.length))return{error:kg};if(!u)return{error:kl};if(!c)return{error:Rd};let d=(u.entries||[]).map(Wi);if(r.filter(f=>!d.includes(f)).length)return{error:kfe};if(n){let f=Yze({stageSequence:e,autoEntryPositions:t,stage:s,ignoreStageSpace:i,drawDefinition:n,participantIds:r,entryStatus:a,roundTarget:o,extension:l});if(f.error)return f}let{flightProfile:p}=Xr({event:u}),h=p==null?void 0:p.flights.find(f=>f.drawId===c);return h!=null&&h.drawEntries&&(r.forEach(f=>{let m=a===$f&&c$({participantId:f,entryStatus:a,flight:h}),g=s===to&&c$({participantId:f,entryStage:s,flight:h});!(a!==$f&&s!==to&&c$({flight:h,participantId:f}))&&!m&&!g&&h.drawEntries.push({participantId:f,entryStatus:a,entryStage:s})}),t&&(h.drawEntries=gd({entries:h.drawEntries}))),{...ue}}function c$({participantId:t,entryStatus:e,entryStage:i,flight:n}){var r;let a=(r=n.drawEntries)==null?void 0:r.find(o=>o.participantId===t&&(!e||e===o.entryStatus)&&(!i||i===o.entryStage));return t&&a}function gR({autoEntryPositions:t=!0,participantIds:e=[],entryStatuses:i,stage:n,event:r}){var a,o,s,l;let c="removeEventEntries";if(!(r!=null&&r.eventId))return{error:_n};if(!Array.isArray(e)||e.some(m=>!qs(m)))return fe({result:{error:vp},stack:c});let u=(r.drawDefinitions??[]).flatMap(m=>Gy({drawDefinition:m}).assignedParticipantIds??[]),d=((i==null?void 0:i.length)&&((a=r.entries)==null?void 0:a.filter(m=>m.entryStatus&&i.includes(m.entryStatus)))||[]).map(Wi).filter(m=>!u.includes(m)),p=(n&&((o=r.entries)==null?void 0:o.filter(m=>m.entryStage&&m.entryStage===n))||[]).map(Wi).filter(m=>!u.includes(m));if(e.length?e=e.filter(m=>(!(i!=null&&i.length)||d.includes(m))&&(!n||p.includes(m))):d.length&&p.length?e=Wr(d,p):d.length?e=d:p.length&&(e=p),(e==null?void 0:e.length)&&u.some(m=>e.includes(m)))return fe({result:{error:aU},stack:c});if(!(e!=null&&e.length))return{...ue,participantIdsRemoved:[]};let h=[];r.entries=(r.entries??[]).filter(m=>{let g=!e.includes(m==null?void 0:m.participantId);return g||h.push(m.participantId),g}),t&&(r.entries=gd({entries:r.entries}));let{flightProfile:f}=Xr({event:r});return(s=f==null?void 0:f.flights)==null||s.forEach(m=>{m.drawEntries=(m.drawEntries||[]).filter(g=>!e.includes(g.participantId))}),(l=r.drawDefinitions)==null||l.forEach(m=>{m.entries=(m.entries??[]).filter(g=>!e.includes(g.participantId))}),{...ue,participantIdsRemoved:h}}var Dve={[eo]:{policyName:"matchUpActionsDefault",enabledStructures:[{stages:[],stageSequences:[],enabledActions:[],disabledActions:[]}],participants:{enforceCategory:!0,enforceGender:!0},processCodes:{substitution:["RANKING.IGNORE","RATING.IGNORE"]},substituteAfterCompleted:!1,substituteWithoutScore:!1}},UU=Dve;function lh(t){var e,i;let{entryStatus:n=tc,autoEntryPositions:r=!0,enforceGender:a=!0,participantIds:o=[],entryStageSequence:s,policyDefinitions:l,entryStage:c=Ft,tournamentRecord:u,ignoreStageSpace:d,drawDefinition:p,roundTarget:h,extensions:f,extension:m,drawId:g,event:v}=t,y="addEventEntries";if(!v)return{error:_n};if(!(o!=null&&o.length))return fe({result:{error:kg},stack:y});if(!(v!=null&&v.eventId))return{error:kl};let b=Mn({tournamentRecord:u,event:v}).appliedPolicies??{},I=(l==null?void 0:l[eo])??(b==null?void 0:b[eo])??UU[eo],T=(a??((e=I==null?void 0:I.participants)==null?void 0:e.enforceGender))!==!1,w=[],S=[];if(f&&(!Array.isArray(f)||!f.every(A=>yp({extension:A})))||m&&!yp({extension:m}))return fe({context:qt({extension:m,extensions:f}),result:{error:Me},info:"Invalid extension(s)",stack:y});let D=!!u,E=[],C,P=((i=u==null?void 0:u.participants)==null?void 0:i.filter(A=>{var _,x,O;if(!o.includes(A.participantId))return!1;let B=Hr(Mr)(v.eventType)&&A.participantType===Ki&&!hv(n),F=v.eventType===Zn&&A.participantType===Ui;return B&&(!v.gender||!T||[El,wp].includes(v.gender)||v.gender===((_=A.person)==null?void 0:_.sex))||F&&!hv(n)||v.eventType===Zn&&A.participantType===Ki&&hv(n)?!0:B&&v.gender&&T&&![El,wp].includes(v.gender)&&v.gender!==((x=A.person)==null?void 0:x.sex)?(E.push({participantId:A.participantId,sex:(O=A.person)==null?void 0:O.sex}),!1):v.eventType===Hn&&(A.participantType===Hn||hv(n)&&A.participantType===Ki)}).map(A=>A.participantId))??[],R=o.filter(A=>!D||P.includes(A));v.entries||(v.entries=[]);let N=v.entries.map(A=>{var _;return A.participantId||((_=A.participant)==null?void 0:_.participantId)});if(R.forEach(A=>{var _;if(!N.includes(A)){let x=qt({participantId:A,entryStatus:n,entryStage:c,extensions:f});m&&un({element:x,extension:m}),h&&un({extension:{name:Ap,value:h},element:x}),s&&(x.entryStageSequence=s),w.push(x.participantId),(_=v.entries)==null||_.push(x)}}),g&&!hv(c)){let A=C6({participantIds:R,autoEntryPositions:r,entryStageSequence:s,ignoreStageSpace:d,drawDefinition:p,entryStatus:n,roundTarget:h,entryStage:c,extension:m,drawId:g,event:v});A.error&&(C=A.error)}if(v.eventType&&[ug,Hc].includes(v.eventType)){let A=(v.entries||[]).map(B=>B.participantId),_=(v.entries||[]).filter(B=>hv(B.entryStatus)).map(B=>B.participantId),x=((u==null?void 0:u.participants)??[]).filter(B=>A.includes(B.participantId)&&B.participantType&&[Ui,Hn].includes(B.participantType)).map(B=>B.individualParticipantIds).flat(1/0),O=_.filter(B=>x.includes(B));O.length&&(S.push(...O),gR({participantIds:O,autoEntryPositions:!1,event:v}))}if(R.length!==o.length)return fe({context:{mismatchedGender:E,gender:v.gender},result:{error:wu},stack:y});r&&(v.entries=gd({entries:v.entries||[]}));let M=w.length-S.length;return fe({result:{...ue,addedEntriesCount:M},stack:y,info:C})}var Eve="ADMINISTRATION",Zze="CAPTAIN",Xze="COACH",jo="COMPETITOR",Cve="MEDIA",Pve="MEDICAL",P6="OFFICIAL",Rve="OTHER",Mve="SECURITY",R6={ADMINISTRATION:Eve,CAPTAIN:Zze,COACH:Xze,COMPETITOR:jo,MEDIA:Cve,MEDICAL:Pve,OFFICIAL:P6,OTHER:Rve,SECURITY:Mve};function M6({addIndividualParticipantsToEvents:t,individualParticipantIds:e,groupingParticipantId:i,tournamentRecord:n,suppressErrors:r}){let a="removeIndividualParticipantIds";if(!n)return fe({result:{error:it},stack:a});if(!i||!e)return fe({result:{error:Ht},stack:a});let o=(n.participants??[]).find(u=>u.participantId===i);if(!o)return fe({result:{error:Jr},stack:a});if(![Hn,cc].includes(o.participantType))return fe({result:{participantType:o.participantType,error:Sd},stack:a});let s=Nve({individualParticipantIds:e,groupingParticipant:o,tournamentRecord:n,suppressErrors:r}),{removed:l,error:c}=s;if(c)return fe({result:s,stack:a});if(t)for(let u of n.events??[]){let d=(u.entries??[]).map(({participantId:p})=>p).filter(Boolean);if(d.includes(i)){let p=l==null?void 0:l.filter(h=>!d.includes(h));lh({participantIds:p,entryStatus:zu,tournamentRecord:n,event:u})}}return l&&tn({topic:No,payload:{tournamentId:n.tournamentId,participants:[o]}}),{...ue,...s}}function Nve({individualParticipantIds:t=[],groupingParticipant:e,tournamentRecord:i,suppressErrors:n,mappedMatchUps:r,participants:a}){var o,s;let l=[];if(!e)return{removed:l};let c=[],u=[];a||({participants:a,mappedMatchUps:r}=Yr({withMatchUps:!0,tournamentRecord:i,withEvents:!0}));let d=(s=(o=a==null?void 0:a.find(({participantId:f})=>f===e.participantId))==null?void 0:o.events)==null?void 0:s.map(({eventId:f})=>f),p=(e.individualParticipantIds??[]).filter(f=>{var m;let g=t==null?void 0:t.includes(f),v=g&&((m=a==null?void 0:a.find(b=>b.participantId===f))==null?void 0:m.matchUps.filter(({eventId:b})=>d.includes(b)).map(({matchUpId:b})=>r==null?void 0:r[b]).filter(({winningSide:b,score:I})=>b||uo({score:I}))),y=g&&!(v!=null&&v.length);if(g&&!y&&u.push(f),y){l.push(f);for(let b of i.events??[])for(let I of b.drawDefinitions??[]){let{extension:T}=Bi({element:I,name:Of}),w=T==null?void 0:T.value[e.participantId];T&&w&&(T.value[e.participantId]=w.filter(D=>D.participantId!==f),un({element:I,extension:T}),YP({drawDefinition:I}));let S=Hs({drawDefinition:I,inContext:!1}).matchUps??[];for(let D of S){let E=D.sides??[];for(let C of E){let P=C.lineUp??[];P.find(R=>R.participantId===f)&&(C.lineUp=P.filter(R=>R.participantId!==f),sn({tournamentId:i==null?void 0:i.tournamentId,drawDefinition:I,matchUp:D}))}}}}else c.push(f);return!y});e.individualParticipantIds=p;let h={groupingParticipantId:e.participantId,cannotRemove:u,notRemoved:c,removed:l};return u.length&&!n&&{...h,cannotRemove:u,error:eL}||h}function kL({participantRole:t=jo,individualParticipantIds:e=[],groupingTypes:i=[_c,cc],tournamentRecord:n}){if(!n)return{error:it};let r=n.participants??[],{participants:a,mappedMatchUps:o}=Yr({withMatchUps:!0,tournamentRecord:n,withEvents:!0}),s=0;return r.filter(l=>(l.participantRole===t||!l.participantRole)&&l.participantType&&i.includes(l.participantType)).forEach(l=>{let{removed:c}=Nve({groupingParticipant:l,individualParticipantIds:e,tournamentRecord:n,mappedMatchUps:o,participants:a});c&&s++}),s?ue:{error:Xfe}}function gw(t){var e,i,n;if(!(t!=null&&t.tournamentRecord))return{error:it};if(!((e=t==null?void 0:t.participantIds)!=null&&e.length))return{error:kg};let{addIndividualParticipantsToEvents:r,tournamentRecord:a,participantIds:o}=t,s=((i=a.participants)==null?void 0:i.length)||0;if(!s)return{...ue};let l=(n=a.events||[])==null?void 0:n.filter(({eventType:g})=>g===Fa).map(g=>{var v;return(v=g==null?void 0:g.drawDefinitions)==null?void 0:v.map(({drawId:y})=>y)}).flat(1/0),c=Yr({participantFilters:{participantIds:o},tournamentRecord:a,withDraws:!0}).participants??[],u=()=>{let g=(co({matchUpFilters:{drawIds:l,matchUpTypes:[Zn]},tournamentRecord:a}).matchUps??[]).map(({sides:v})=>v==null?void 0:v.map(({participantId:y})=>y)).flat().filter(Boolean);return Wr(g,o)},d=(l==null?void 0:l.length)&&u(),p=c.filter(g=>{var v;return(v=g.draws)==null?void 0:v.filter(y=>(!(l!=null&&l.length)||!(l!=null&&l.includes(y.drawId)))&&y.positionAssignments).length});if(d!=null&&d.length||p.length)return{error:aU};let h={},f={};for(let g of a.events||[]){let v=gR({participantIds:o,event:g});if(v.error)return v;h[g.eventId]=v.participantIdsRemoved}a.participants=a.participants.filter(g=>{let v=o.includes(g.participantId)||g.participantType===Ui&&g.individualParticipantIds.some(y=>o.includes(y));if(!v&&g.participantType===Fa&&g.individualParticipantIds.some(y=>o.includes(y))&&(g.individualParticipantIds=g.individualParticipantIds.filter(y=>!o.includes(y))),v&&r&&[Ui,Hn].includes(g.participantType))for(let y of g.individualParticipantIds||[])o.includes(y)||(f[g.participantId]||(f[g.participantId]=[]),f[g.participantId].push(y));return!v});let m=s-a.participants.length;if(kL({individualParticipantIds:o,tournamentRecord:a}),r)for(let g of a.events||[]){let v=h[g.eventId].map(y=>f[y]||[]).flat();lh({participantIds:v,entryStatus:zu,tournamentRecord:a,event:g})}return m&&tn({payload:{participantIds:o,tournamentId:a.tournamentId},topic:Z5}),m?{...ue,participantsRemovedCount:m}:{error:eL}}function Ave({selected:t=!0,drawDefinition:e,entryStatuses:i,drawId:n,event:r,stage:a}){var o;let s=r.entries??[];if(n){let{flightProfile:c}=Xr({event:r}),u=(o=c==null?void 0:c.flights)==null?void 0:o.find(d=>d.drawId===n);u?s=u.drawEntries:e.entries&&(s=e==null?void 0:e.entries)}let l=s.filter(c=>(!(i!=null&&i.length)||!c.entryStatus||i.includes(c.entryStatus))&&(!a||!c.entryStage||c.entryStage===a)&&(!t||c.entryStatus&&qu.includes(c.entryStatus)));return{entries:s,stageEntries:l}}function _ve({removeGroupParticipant:t,tournamentRecord:e,drawDefinition:i,participantId:n,drawId:r,stage:a,event:o}){var s;let l="destroyGroupEntry";if(!e)return{error:it};if(!n)return fe({result:{error:Ra},stack:l});if(!o)return{error:_n};if(!o.eventType||![ug,Hc].includes(o.eventType))return fe({result:{error:ng},stack:l});let c=e.participants??[],u=c.find(y=>y.participantId===n);if(!u)return fe({result:{error:Jr},stack:l});if(!u.participantType||![Ui,_c].includes(u.participantType)||u.participantType===_c&&o.eventType!==Hc||u.participantType===Ui&&o.eventType!==ug)return{error:Sd};let d=(o.entries??[]).find(y=>y.participantId===n);if(!d)return{error:tme};let{stageEntries:p}=Ave({selected:!1,drawDefinition:i,drawId:r,event:o,stage:a}),h=p.map(Wi),f=c.filter(({participantId:y})=>h.includes(y)).map(({individualParticipantIds:y})=>y).flat().filter(Boolean),m=(s=u.individualParticipantIds)==null?void 0:s.filter(y=>np(y,f).length===1),g=gR({participantIds:[n],event:o});if(g.error||m!=null&&m.length&&(g=lh({participantIds:m,entryStatus:zu,entryStage:d.entryStage,tournamentRecord:e,drawDefinition:i,drawId:r,event:o}),g.error))return g;let v;return t&&gw({participantIds:[n],tournamentRecord:e}).success&&(v=!0),{...ue,participantRemoved:v}}function N6({removeGroupParticipant:t,tournamentRecord:e,drawDefinition:i,participantId:n,drawId:r,event:a}){return _ve({removeGroupParticipant:t,tournamentRecord:e,drawDefinition:i,participantId:n,drawId:r,event:a})}function kve(t){if(!t.tournamentRecord)return{error:it};let{participantIds:e,...i}=t,n=0,r=[];for(let a of e){let o=_ve({participantId:a,...i});o.success&&(n+=1),o.error&&r.push(o.error)}return n?{destroyedCount:n,...ue}:{error:r}}function SE(t){let{tournamentRecord:e,replaceWithBye:i,drawDefinition:n,destroyPair:r,entryStatus:a,matchUpsMap:o,drawId:s}=t,l="removeDrawPositionAssignment",c=fR(t);if(c.error)return fe({result:c,stack:l});let{participantId:u}=c,{drawPosition:d,event:p,structureId:h}=t;if([Su,Vf].includes(a)&&u){let{tournamentRecord:m}=t,{participant:g}=jy({tournamentRecord:m,participantId:u}),{participantType:v,individualParticipantIds:y}=g??{};if(r&&v===Ui){let b=N6({tournamentRecord:m,drawDefinition:n,participantId:u,event:p});if(b.error)return fe({result:b,stack:l});y&&M_({participantIds:y,tournamentRecord:m,drawDefinition:n,entryStatus:a,drawId:s,event:p})}else M_({participantIds:[u],tournamentRecord:m,drawDefinition:n,entryStatus:a,drawId:s,event:p})}if(i){let m=uc({tournamentRecord:e,drawDefinition:n,drawPosition:d,structureId:h,matchUpsMap:o,event:p});if(m.error)return fe({result:m,stack:l})}let{structure:f}=pi({drawDefinition:n,structureId:h});return s6({structure:f,drawPositions:[d]}),UL({drawDefinition:n,positionAction:{name:"removeDrawPositionAssignment",replaceWithBye:i,drawPosition:d,entryStatus:a,structureId:h}}),c}function xve(t){return Object.assign(t,{entryStatus:Vf}),SE(t)}function hj(t){return qs(t)?t.split(" ").map(e=>e.split("").map((i,n)=>n?i.toLowerCase():i.toUpperCase()).join("")).join(" "):t}function Co(t){return qs(t)?hj(t.replace(/_/g," ")):""}var jm=({finishingPosition:t=lw,qualifyingRoundNumber:e,structureAbbreviation:i,seedAssignments:n=[],stageSequence:r=1,structureOrder:a,seedingProfile:o,matchUpFormat:s,structureType:l,structureName:c,matchUpType:u,matchUps:d=[],structureId:p,roundOffset:h,roundLimit:f,stageOrder:m,structures:g,stage:v})=>{let y={structureId:p??xn(),structureAbbreviation:i,finishingPosition:t,seedAssignments:n,matchUpFormat:s,stageSequence:r,structureName:c};a&&(y.structureOrder=a),l&&(y.structureType=l),o&&(typeof o=="string"?y.seedingProfile=o:typeof o=="object"&&typeof o.positioning=="string"&&(y.seedingProfile=o.positioning)),u&&(y.matchUpType=u),h&&(y.roundOffset=h),m&&(y.stageOrder=m),f&&(y.roundLimit=f),v&&(y.stage=v),e&&(y.qualifyingRoundNumber=e);let b=d.flatMap(({drawPositions:I})=>I).filter(Boolean);return g?y.structures=g:(y.matchUps=d,y.positionAssignments=ki(b).sort((I,T)=>I-T).map(I=>({drawPosition:I}))),y},Ec=jm;function A6({structureName:t=Co(to),structureAbbreviation:e,drawDefinition:i,matchUpType:n,structureId:r}){if(!i)return{error:Lt};let a=Ec({stage:to,structureAbbreviation:e,structureName:t,matchUps:[],structureId:r,matchUpType:n});return i.structures||(i.structures=[]),i.structures.push(a),er({drawDefinition:i,structureIds:[a.structureId]}),{...ue}}function _6({drawPositions:t}){if(!(t!=null&&t.length))return{error:AP};let e=r=>t.filter(a=>a!==r).map(a=>[r,a]),i=[].concat(...(t??[]).map(e)),n=ki(i.map(xL)).map(r=>r.split("|").map(a=>+a));return{groupMatchUps:i,uniqueMatchUpGroupings:n}}function xL(t=[]){return!Array.isArray(t)||!t.length?"":[...t].sort(va).join("|")}function Ove({groupSize:t,drawPositionOffset:e}){if(!t)return[];let i=d=>[...Array(d)].map((p,h)=>h),n=i(2*Math.round(t/2)+1).slice(1),r=i(n.length-1).map(()=>[]),a=n.slice(0,n.length/2),o=n.slice(n.length/2);n.slice(1).forEach((d,p)=>{a.forEach((g,v)=>{r[p].push([a[v],o[v]])});let h=a.shift(),f=a.pop(),m=o.shift();a=[h,m,...a].filter(Boolean),o=[...o,f].filter(Boolean)});let s=a.shift(),l=a.pop(),c=o.shift();a=[s,c,...a].filter(Boolean),o=[...o,l].filter(Boolean);let u=d=>d[0].reduce((p,h)=>p+h);return[...r].reverse().sort((d,p)=>u(d)-u(p)).map(d=>d.filter(p=>p.every(h=>h<=t)).map(p=>{let h=p.map(f=>f+e);return xL(h)}))}function Jze({rounds:t,hash:e}){return t!=null&&t.length?t==null?void 0:t.reduce((i,n,r)=>n.includes(e)?r+1:i,void 0):{error:Ht}}var Qze={getRoundRobinGroupMatchUps:_6,determineRoundNumber:Jze,drawPositionsHash:xL,groupRounds:Ove};function vR(t){var e;let{groupNameBase:i="Group",playoffAttributes:n,stageSequence:r=1,structureOptions:a,appliedPolicies:o,seedingProfile:s,stage:l=Ft,matchUpType:c,roundTarget:u,structureId:d,groupNames:p,drawSize:h,idPrefix:f,isMock:m,uuids:g}=t,v=t.structureName??((e=n==null?void 0:n[0])==null?void 0:e.name)??Co(Ft),{groupCount:y,groupSize:b}=eqe({structureOptions:a,appliedPolicies:o,drawSize:h}),I=gU,T,w=Ct(1,y+1).map(D=>{let E=tqe({groupSize:b,structureOrder:D,matchUpType:c,drawSize:h,idPrefix:f,isMock:m});T=Array.isArray(E)?Math.max(...E.map(({roundNumber:P})=>P??0)):0;let C=(p==null?void 0:p[D-1])??`${i} ${D}`;return jm({structureId:g==null?void 0:g.pop(),structureType:yL,finishingPosition:I,structureOrder:D,structureName:C,matchUps:E})}),S=jm({structureId:d??(g==null?void 0:g.pop()),structureType:xs,finishingPosition:I,seedingProfile:s,structureName:v,stageSequence:r,structures:w,stage:l});return u&&un({extension:{name:Ap,value:u},element:S}),{structures:[S],maxRoundNumber:T,groupCount:y,links:[],groupSize:b,...ue}}function eqe({appliedPolicies:t,structureOptions:e,drawSize:i}){let n=e==null?void 0:e.groupSize,r=(e==null?void 0:e.groupSizeLimit)||8,{validGroupSizes:a}=yR({groupSizeLimit:r,drawSize:i}),o=a&&Math.max(...a);n&&a!=null&&a.includes(n)||(n&&n>4||!(a!=null&&a.includes(4))?n=o:n=4);let s=Math.ceil(i/n);return{groupSize:n,groupCount:s}}function yR({drawSize:t,groupSizeLimit:e=10}){let i=Ct(3,e+1).filter(n=>{let r=Math.ceil(t/n),a=r*n-t,o=Math.ceil(t/r),s=Math.ceil(a/r);return(!a||a<n)&&o===n&&o>=3&&s<2});return{...ue,validGroupSizes:i}}function tqe({structureOrder:t,matchUpType:e,groupSize:i,drawSize:n,idPrefix:r,isMock:a,uuids:o}){let s=(t-1)*i,l=Ct(1+s,i+1+s),c=_6({drawPositions:l}).uniqueMatchUpGroupings??[],u=Ove({groupSize:i,drawPositionOffset:s});return c.map(p).sort((h,f)=>(h.roundNumber??1/0)-(f.roundNumber??1/0));function d(h){return u.reduce((f,m,g)=>m.includes(h)?g+1:f,void 0)}function p(h){let f=xL(h),m=d(f),g=[1,n],v=iqe({structureOrder:t,drawPositions:h,roundNumber:m,idPrefix:r,uuids:o}),y={matchUpStatus:m?Kr:yn,matchUpType:e,finishingPositionRange:{winner:g,loser:g},drawPositions:h,roundNumber:m,matchUpId:v};return a&&(y.isMock=!0),y}}function iqe({structureOrder:t,drawPositions:e,roundNumber:i,idPrefix:n,uuids:r}){return n?`${n}-${t}-${i}-DP-${e.join("-")}`:(r==null?void 0:r.pop())||xn()}function k6(t){let{roundRobinGroupsCount:e,participantsCount:i,cluster:n}=t;if(!bi(i))return{seedBlocks:void 0,...fe({result:{error:Me},context:{participantsCount:i},stack:"getSeedBlocks"})};let r=lU(i);if(e){let h=Math.min(e,r),f=[],m=1;for(Ct(0,h).forEach(()=>{f.push([m]),m++});m<r;){let g=Ct(m,m+h);m+=h,f.push(g)}return{...ue,seedBlocks:f}}let a=Ct(1,r+1),o=[],s=r/2;for(;s>1;){let h=so(a,s),f=h.length;h.forEach((m,g)=>{let v,y=g<f/2,b=g%2===0,I=m[0],T=m[m.length-1];n&&f>4?f===8?v=y?T:I:v=b?I:T:v=y?I:T,Ps(m,o)||o.push(v)}),s=s/2}let l=a.filter(h=>!o.includes(h));for(;l.length;)l.length%2===0?o.push(l.pop()):o.push(l.shift());let c=Ct(0,20).map(h=>Math.pow(2,h));c.unshift(1);let u=c.indexOf(r),d=0,p=[];return Ct(0,u).forEach(h=>{p.push(o.slice(d,d+c[h])),d+=c[h]}),{...ue,seedBlocks:p}}function x6({roundRobinGroupsCount:t,drawSize:e}){let i="getSeedGroups";if(!bi(e))return{seedGroups:void 0,...fe({result:{error:Me},context:{drawSize:e},stack:i})};if(t){if(!bi(t))return{seedGroups:void 0,...fe({context:{roundRobinGroupsCount:t},result:{error:Me},stack:i})};let n=1,r=Math.floor(e/t);return{seedGroups:Ct(0,r).map(()=>{let a=Ct(n,n+t);return n+=t,a})}}else{let{seedBlocks:n}=k6({participantsCount:e,roundRobinGroupsCount:t}),r=0;return{seedGroups:(n||[]).map(a=>(a||[]).map(()=>(r+=1,r)))}}}function O6({roundRobinGroupsCount:t,participantsCount:e}){var i;if(t){let{validGroupSizes:a}=yR({drawSize:e});if(!((i=a==null?void 0:a.map(o=>Math.ceil(e/o)))!=null&&i.includes(t)))return fe({context:{roundRobinGroupsCount:t},result:{error:Me}})}let{seedGroups:n}=x6({drawSize:e,roundRobinGroupsCount:t}),r=(n==null?void 0:n.map(a=>Math.min(...a)))||[];return{...ue,seedingThresholds:r}}function HS(t){if(!t)return 1/0;if(bi(t))return ai(t);let e=t.split("-")[0];return bi(e)?ai(e):1/0}function nqe({size:t}){let e=[t],i=t;for(;i/2===Math.floor(i/2);)i=i/2,e.push(i);return e.includes(1)||e.push(1),e.sort(va),e.reverse(),e}function rqe({blockPattern:t,index:e}){let i=0;for(let n of t){if(i===e)return n;let r=0;for(;r<n.length;){if(i===e)return n;i+=1,r++}}}function aqe({positioning:t,size:e}){let i=nqe({size:e}),n=[],r=[],a=p=>p[0],o=p=>p[p.length-1],s=(p,h)=>(t&&[vL,ty].includes(t)&&h%2?o(p):a(p))||a(p),l=(p,h)=>{if(p.every(f=>!r.includes(f))){let f=s(p,h);return r.push(f),f}},c=p=>{let h=p.filter(f=>!r.includes(f));if(h.length)return r.push(...h),h},u=(p,h)=>{let f=s(p,h);if(!r.includes(f))return r.push(f),f},d=Ct(1,e+1);for(let p of i)if(p===1){let h=so(d,2),f=h.map(l).filter(Boolean);f.length&&n.push(f);let m=h.flatMap(c).filter(Boolean);m.length&&n.push(m)}else{let h=so(d,p).map(u).filter(Boolean);h.length&&n.push(h)}return{divisions:i,divisionGroupings:n}}function vw({provisionalPositioning:t,returnAllProxies:e,appliedPolicies:i,seedingProfile:n,drawDefinition:r,allPositions:a,structure:o}){var s;let l=[];if(!o)return{error:_g};let{matchUps:c,roundMatchUps:u}=Sn({matchUpFilters:{roundNumbers:[1]},provisionalPositioning:t,structure:o}),{seedAssignments:d}=Gc({provisionalPositioning:t,returnAllProxies:e,drawDefinition:r,structure:o}),{positionAssignments:p}=Ha({structure:o}),h=p==null?void 0:p.length,f=(d==null?void 0:d.length)??0,m=[],g=Object.keys(u).map(x=>parseInt(x)).sort((x,O)=>x-O).map(x=>{let O=u[x].map(F=>F.drawPositions).flat(1/0).filter(Boolean),B=O.filter(F=>!m.includes(F));return m=m.concat(...O),B}).filter(x=>x.length).reverse(),v=g.pop()??[],y=v&&Math.min(...v)-1||0;n=n??((s=i==null?void 0:i.seeding)==null?void 0:s.seedingProfile);let b=(v==null?void 0:v.length)||0,I=g.filter(x=>x.filter(O=>O<=f).length),{stage:T,structureType:w,roundLimit:S}=o,D=w===xs,E=!D&&(g==null?void 0:g.length),C=!D&&T===Xt&&S,P=I.flat(1/0),R=E?P==null?void 0:P.length:0,N=a?h:f,M=y6({drawDefinition:r,structure:o,matchUps:c}),A=M?0:!E&&N||N&&P.length<N&&N-P.length||0;if(C){let x=o!=null&&o.matchUps?o.matchUps.filter(({roundNumber:B})=>B===o.roundLimit).length:0,O=v.length/x;if(!E){let B=bR(n),F=so(v,O),G=1,H=Ct(0,F[0].length).map(()=>{let $=Ct(G,G+F.length);return G+=F.length,$});({validSeedBlocks:l}=Lve({drawPositionBlocks:F,nonRandom:n==null?void 0:n.nonRandom,positioning:B,seedGroups:H}))}}else D?{validSeedBlocks:l}=oqe({nonRandom:n==null?void 0:n.nonRandom,seedingProfile:n,structure:o}):E?l=I.map(x=>({seedNumbers:x,drawPositions:x})):M&&so(v,2).map((x,O)=>({drawPositions:[x[0]],seedNumbers:[O+1]})).forEach(x=>l.push(x));if(!D&&!M&&!C){let{blocks:x}=sqe({drawPositionOffset:y,seedNumberOffset:R,seedCountGoal:A,seedingProfile:n,baseDrawSize:b});x.forEach(O=>l.push(O))}let _=l.flatMap(x=>x.drawPositions).reduce((x,O)=>(v==null?void 0:v.includes(O))&&x,!0);return!M&&!E&&!D&&!_?{error:Mfe,validSeedBlocks:[],isContainer:D,isFeedIn:E}:{isLuckyStructure:M,validSeedBlocks:l,isContainer:D,isFeedIn:E}}function oqe({seedingProfile:t,structure:e,nonRandom:i}){var n;let r=e.structures||[],a=r.length,o=(n=jn({structure:e}))==null?void 0:n.positionAssignments,s=bR(t),l=(o==null?void 0:o.length)??0,{seedGroups:c}=x6({roundRobinGroupsCount:a,drawSize:l}),u=r.map(d=>{var p;return(p=jn({structure:d}).positionAssignments)==null?void 0:p.map(h=>h.drawPosition)});return Lve({drawPositionBlocks:u,positioning:s,seedGroups:c,nonRandom:i})}function Lve({drawPositionBlocks:t,positioning:e,seedGroups:i,nonRandom:n}){let r=[],{divisionGroupings:a}=aqe({size:i.length,positioning:e}),o=[];return i.forEach((s,l)=>{let c=rqe({blockPattern:a,index:l});s.forEach((u,d)=>{let p=l%2?t.length-d-1:d,h=t[p].slice().filter((m,g)=>c.includes(g+1)&&m);e!==ty?h=n?h:vs(h):l%2&&h.reverse();let f=h.find(m=>!o.includes(m));f&&(o.push(f),r.push({drawPositions:[f],seedNumbers:[u]}))})}),{validSeedBlocks:r}}function sqe(t){let{drawPositionOffset:e=0,roundRobinGroupsCount:i,seedNumberOffset:n=0,seedingProfile:r,seedCountGoal:a,baseDrawSize:o}=t,s=1,l=[],{seedBlocks:c}=k6({cluster:bR(r)===vL,participantsCount:o,roundRobinGroupsCount:i});s=0;for(let d of c){if(s+1>a)break;let p=d.map(f=>f+e),h=u(s+1,d.length).map(f=>+f+n);s+=d.length,l.push({drawPositions:p,seedNumbers:h})}return{blocks:l};function u(d,p){return Array.from(new Array(p),(h,f)=>f+d)}}function A_({appliedPolicies:t,drawDefinition:e,seedBlockInfo:i,drawPosition:n,structureId:r,seedNumber:a}){var o,s,l,c,u,d;let{structure:p}=pi({drawDefinition:e,structureId:r});t||(t=Mn({drawDefinition:e}).appliedPolicies);let h=i==null?void 0:i.validSeedBlocks;return!h&&p&&(h=(o=vw({appliedPolicies:t,drawDefinition:e,structure:p}))==null?void 0:o.validSeedBlocks),(l=(s=t==null?void 0:t.seeding)==null?void 0:s.validSeedPositions)!=null&&l.ignore?!0:(u=(c=t==null?void 0:t.seeding)==null?void 0:c.validSeedPositions)!=null&&u.strict?(((d=h.find(f=>f.seedNumbers.includes(a)))==null?void 0:d.drawPositions)||[]).includes(n):[].concat(...h.map(f=>f.drawPositions)).includes(n)}function Fve(t){var e,i,n;let{provisionalPositioning:r,drawDefinition:a,seedingProfile:o,seedBlockInfo:s,structureId:l,randomize:c}=t,{structure:u}=pi({drawDefinition:a,structureId:l}),{seedAssignments:d}=Gc({returnAllProxies:t.returnAllProxies,provisionalPositioning:r,drawDefinition:a,structure:u}),{positionAssignments:p}=Ha({structure:u}),h=(e=p==null?void 0:p.filter(A=>A.participantId??A.bye??A.qualifier))==null?void 0:e.map(A=>A.drawPosition).filter(Boolean),{appliedPolicies:f}=Mn({drawDefinition:a}),m=((s==null?void 0:s.validSeedBlocks)||u&&((i=vw({returnAllProxies:t.returnAllProxies,provisionalPositioning:r,appliedPolicies:f,drawDefinition:a,seedingProfile:o,structure:u}))==null?void 0:i.validSeedBlocks)||[]).filter(A=>A.drawPositions.filter(_=>!(h!=null&&h.includes(_))).length)[0],g=d==null?void 0:d.map(A=>A.participantId).filter(Boolean),v=p==null?void 0:p.map(A=>A.participantId).filter(Boolean),y=g==null?void 0:g.filter(A=>v==null?void 0:v.includes(A)),b=g==null?void 0:g.filter(A=>!(v!=null&&v.includes(A))),I=d==null?void 0:d.filter(A=>b==null?void 0:b.includes(A.participantId)),T=d==null?void 0:d.filter(A=>!A.participantId),w=(I!=null&&I.length&&I.length>0?I.length:(T==null?void 0:T.length)??0)&&(m==null?void 0:m.drawPositions.filter(A=>!(h!=null&&h.includes(A))))||[],S=c?vs(w):w,D=[],E=S.map(()=>{var A;let _=(A=M(I,D))==null?void 0:A.participantId;return _&&D.push(_),_}).filter(Boolean),C=d==null?void 0:d.filter(A=>y==null?void 0:y.includes(A.participantId)).map(A=>A.seedNumber),P=((m==null?void 0:m.seedNumbers)||[]).filter(A=>!(C!=null&&C.includes(A))),R=d==null?void 0:d.filter(A=>P.includes(A.seedNumber)).map(A=>A.participantId),N=(n=f==null?void 0:f.seeding)==null?void 0:n.duplicateSeedNumbers;return{nextSeedBlock:m,unplacedSeedParticipantIds:N===void 0||N?E:R,unplacedSeedNumbers:P,unfilledPositions:S,unplacedSeedAssignments:I};function M(A,_){let x=A.filter(F=>!_.includes(F.participantId)),O=Math.min(...x.map(F=>HS(F.seedValue))),B=x.filter(F=>HS(F.seedValue)===O);return vs(B).pop()}}function bR(t){if(typeof t=="string")return t;if(typeof t=="object")return t.positioning}function DU({provisionalPositioning:t,tournamentRecord:e,drawDefinition:i,seedingProfile:n,participantId:r,seedBlockInfo:a,structureId:o,seedNumber:s,seedValue:l,eventId:c,event:u}){var d,p,h;let f="assignSeed",{structure:m}=pi({drawDefinition:i,structureId:o}),{positionAssignments:g}=Ha({structure:m}),v=Gc({provisionalPositioning:t,drawDefinition:i,structure:m}).seedAssignments,y=v.map(D=>D.seedNumber),b=Lb({drawDefinition:i,participantId:r});if(r&&!b)return fe({result:{error:vp},context:{participantId:r},stack:f});let I=u?(p=(d=Xr({event:u}).flightProfile)==null?void 0:d.flights)==null?void 0:p.length:0,T=I&&I>1,w=(h=g==null?void 0:g.find(D=>D.participantId===r))==null?void 0:h.drawPosition;if(w&&!A_({drawPosition:w,drawDefinition:i,seedBlockInfo:a,structureId:o,seedNumber:s}))return fe({result:{error:V4},context:{assignedDrawPosition:w},info:"invalid seed position",stack:f});y.includes(s)||v.push({seedNumber:s,seedValue:l});let S;return v.forEach(D=>{D.participantId===r&&D.seedNumber!==s&&(D.participantId=void 0),D.seedNumber===s&&(D.participantId=r,!(n!=null&&n.groupSeedingThreshold)&&!T&&(D.seedValue=l??s),S=!0)}),S?(_ge({tournamentId:e==null?void 0:e.tournamentId,drawDefinition:i,structure:m,eventId:c}),{...ue}):fe({result:{error:Rfe},stack:f})}function L6({inContextTargetMatchUp:t,drawPositionSideIndex:e,teamParticipantId:i,tournamentRecord:n,drawDefinition:r,matchUp:a,event:o}){var s,l,c,u;let d=(l=(s=t==null?void 0:t.sides)==null?void 0:s[e])==null?void 0:l.sideNumber,p=d&&((c=a.sides)==null?void 0:c.find(g=>g.sideNumber===d)),{extension:h}=Bi({element:r,name:Of}),f=(h==null?void 0:h.value)||{},m=$t(f[i],!1,!0);if(p)(u=a==null?void 0:a.sides)==null||u.forEach(g=>{g.sideNumber===d&&(g.lineUp=m)});else{a.sides=[1,2].map(v=>{var y;return{...((y=a.sides)==null?void 0:y.find(b=>b.sideNumber===v))??{},sideNumber:v}});let g=a.sides.find(v=>v.sideNumber===d);g&&(g.lineUp=m)}sn({tournamentId:n==null?void 0:n.tournamentId,context:"updateSidLineUp",eventId:o==null?void 0:o.eventId,drawDefinition:r,matchUp:a})}function Bve(t){let{sourceMatchUp:e}=t,{targetMatchUp:i,structure:n,matchUpsMap:r,drawPosition:a}=t,o=i.roundNumber>1&&i.roundNumber-1,s=ry({structureId:n.structureId,matchUpsMap:r});!e&&a&&(e=s.find(({drawPositions:f,roundNumber:m})=>m===o&&(f==null?void 0:f.includes(a))));let l=e==null?void 0:e.roundPosition,c=l%2?1:-1,u=l+c,d=o&&s.find(({roundNumber:f,roundPosition:m})=>f===o&&m===u),p=d==null?void 0:d.matchUpStatus,h=[da,Ca].includes(p);return{pairedPreviousMatchUp:d,pairedPreviousMatchUpIsDoubleExit:h}}function lqe({drawPosition:t,drawPositions:e}){let i=!1,n=!!(e!=null&&e.includes(t));return{updatedDrawPositions:n?e||[]:[...e,void 0,void 0].slice(0,2).map(r=>!r&&!n?(n=!0,i=!0,t):r).sort(va).filter(Boolean),positionAdded:i,positionAssigned:n}}function $ve({structureId:t,matchUpsMap:e,matchUp:i}){let n=i==null?void 0:i.roundPosition,r=n%2?1:-1,a=n+r;return{pairedPreviousMatchUp:ry({matchUpsMap:e,structureId:t}).find(({roundNumber:o,roundPosition:s})=>o===(i==null?void 0:i.roundNumber)&&s===a)}}function Vve({inContextDrawMatchUps:t,sourceMatchUpStatus:e,sourceMatchUpId:i,matchUpsMap:n,matchUp:r}){let a=t.find(s=>s.matchUpId===i),{pairedPreviousMatchUp:o}=$ve({structureId:a==null?void 0:a.structureId,matchUp:a,matchUpsMap:n});if(a&&o){let s=o==null?void 0:o.matchUpId,l=t.find(u=>u.matchUpId===s),c=(a==null?void 0:a.structureId)===(l==null?void 0:l.structureId)?(a==null?void 0:a.roundPosition)<(l==null?void 0:l.roundPosition)&&1||2:a.structureId===(l==null?void 0:l.structureId)&&2||1;r.matchUpStatusCodes=(r.matchUpStatusCodes??[]).map(u=>{let d=qs(u)||!isNaN(u)?{code:u}:u;return d.sideNumber===c?{...d,previousMatchUpStatus:e}:d})}}function zN({inContextDrawMatchUps:t,drawPosition:e,matchUpId:i}){let n=t.filter(({winnerMatchUpId:r,loserMatchUpId:a})=>a===i||r===i).sort((r,a)=>r.roundPosition-a.roundPosition);return t.find(r=>r.matchUpId===i).feedRound?1:n.reduce((r,a,o)=>{var s;return(s=a.drawPositions)!=null&&s.includes(e)?o+1:r},void 0)}function zS({inContextDrawMatchUps:t,sourceMatchUpStatus:e,tournamentRecord:i,sourceMatchUpId:n,drawDefinition:r,matchUpStatus:a,drawPosition:o,matchUpsMap:s,matchUpId:l,event:c}){var u,d,p,h;let f="assignMatchUpDrawPosition";s||(s=ko({drawDefinition:r})),t||(t=wa({inContext:!0,drawDefinition:r,matchUpsMap:s}).matchUps??[]);let m=t.find(_=>_.matchUpId===l),g=m==null?void 0:m.structureId,v=(u=r==null?void 0:r.structures)==null?void 0:u.find(_=>_.structureId===g);if(!v)return{error:Dr};let y=(d=s==null?void 0:s.drawMatchUps)==null?void 0:d.find(_=>_.matchUpId===l),b=(y==null?void 0:y.drawPositions)??[],{positionAdded:I,positionAssigned:T,updatedDrawPositions:w}=lqe({drawPosition:o,drawPositions:b}),{positionAssignments:S}=jn({drawDefinition:r,structure:v}),D=(p=S==null?void 0:S.filter(_=>w.includes(_.drawPosition)))==null?void 0:p.find(({bye:_})=>_),E=(y==null?void 0:y.matchUpStatus)&&[Rn,fn].includes(y.matchUpStatus)&&w.filter(Boolean).length<2;if(a=D&&yn||a||E&&y.matchUpStatus||(y==null?void 0:y.matchUpStatus)&&[da,Ca].includes(y.matchUpStatus)&&y.matchUpStatus||Kr,y&&I){t=wa({inContext:!0,drawDefinition:r,matchUpsMap:s}).matchUps??[];let _=E&&zN({inContextDrawMatchUps:t,drawPosition:o,matchUpId:l})||void 0;y!=null&&y.matchUpStatusCodes&&Vve({inContextDrawMatchUps:t,sourceMatchUpStatus:e,sourceMatchUpId:n,matchUpsMap:s,matchUp:y}),Object.assign(y,{drawPositions:w,winningSide:_,matchUpStatus:a}),sn({tournamentId:i==null?void 0:i.tournamentId,eventId:m==null?void 0:m.eventId,context:f,drawDefinition:r,matchUp:y})}let C=Ms({inContextDrawMatchUps:t,inContextMatchUp:m,drawDefinition:r,matchUpId:l}),{targetMatchUps:{winnerMatchUp:P,loserMatchUp:R,loserTargetDrawPosition:N},targetLinks:{loserTargetLink:M}}=C,A=ry({structureId:v.structureId,matchUpsMap:s});if(T&&D){if(P)if([yn,da,Ca].includes(a)){let _=zS({matchUpId:P.matchUpId,inContextDrawMatchUps:t,tournamentRecord:i,drawDefinition:r,drawPosition:o,matchUpsMap:s});if(_.error)return _}else{let{structureId:_}=P;_!==v.structureId&&console.log("winnerMatchUp in different structure... participant is in different targetDrawPosition")}}else if(P&&m&&!m.feedRound){let{pairedPreviousMatchUpIsDoubleExit:_}=Bve({targetMatchUp:y,drawPosition:o,matchUpsMap:s,structure:v});if(_){let x=zS({matchUpId:P.matchUpId,inContextDrawMatchUps:t,tournamentRecord:i,drawDefinition:r,drawPosition:o,matchUpsMap:s});if(x.error)return x}}if((y==null?void 0:y.matchUpType)===Jn){let _=t==null?void 0:t.find(({matchUpId:B})=>B===y.matchUpId),x=((_==null?void 0:_.sides)??[]).reduce((B,F,G)=>F.drawPosition===o?G:B,void 0),O=(h=S==null?void 0:S.find(B=>B.drawPosition===o))==null?void 0:h.participantId;O&&x!==void 0&&L6({inContextTargetMatchUp:_,drawPositionSideIndex:x,teamParticipantId:O,tournamentRecord:i,drawDefinition:r,matchUp:y})}if((M==null?void 0:M.linkCondition)===Ch&&w.filter(Boolean).length===2&&!D&&A.filter(({drawPositions:_,roundNumber:x})=>x===1&&Ps(_,w)).every(({matchUpStatus:_})=>[ia,os].includes(_))&&R){let{structureId:_}=R,x=uc({drawPosition:N,tournamentRecord:i,drawDefinition:r,structureId:_,matchUpsMap:s,event:c});if(x.error)return x}return T?{...ue}:fe({result:{error:PS},context:{drawPosition:o},stack:f})}function jve({inContextDrawMatchUps:t,drawDefinition:e,assignments:i,matchUpsMap:n,structure:r}){var a,o,s,l;let c=((s=(o=(a=vU({drawDefinition:e}))==null?void 0:a.containedStructures)==null?void 0:o[r.structureId])==null?void 0:s.map(({structureId:f})=>f))||[];c.push(r==null?void 0:r.structureId);let u=(i==null?void 0:i.map(({drawPosition:f})=>f))||[],d=(t==null?void 0:t.filter(f=>c.includes(f.structureId)&&Wr(f.drawPositions??[],u).length))??[],p=d.map(({matchUpId:f})=>f),h=((l=n==null?void 0:n.drawMatchUps)==null?void 0:l.filter(f=>p.includes(f.matchUpId)))??[];return{drawPositions:u,matchUps:h,targetMatchUps:d}}function F6({lineUp:t}){if(!Array.isArray(t))return;let e={};return ki(t.flatMap(({collectionAssignments:i})=>i==null?void 0:i.map(({collectionId:n,collectionPosition:r})=>[n,r].join("|"))).filter(Boolean)).forEach(i=>{let[n,r]=i.split("|"),a=parseInt(r),{assignedParticipantIds:o}=P_({collectionPosition:a,collectionId:n,lineUp:t});o.forEach(s=>{e[s]||(e[s]=[]),e[s].push({collectionId:n,collectionPosition:a})})}),Object.keys(e).map(i=>({participantId:i,collectionAssignments:e[i]}))}function Nh(t){return`${t} must be an array`}function OL({lineUp:t,tieFormat:e}){let i=[];if(!Array.isArray(t))return i.push(Nh("lineUp")),{valid:!1,errors:i,error:Me};let n=t.every(a=>{if(typeof a!="object")return i.push("lineUp entries must be objects"),!1;let{participantId:o,collectionAssignments:s}=a;return o?typeof o!="string"?(i.push("participantIds must be strings"),!1):Array.isArray(s)?s.every(l=>{if(typeof l!="object")return i.push("collectionAssignments must be objects"),!1;let{collectionPosition:c}=l;return typeof c!="number"?(i.push("collectionPosition must be a number"),!1):!0}):(i.push(Nh("collectionAssignments")),!1):(i.push("Missing participantId"),!1)}),r=ki(t.map(Wi)).length===t.length;return r||i.push("Duplicated participantId(s)"),{valid:n&&r,errors:i,error:i.length?Me:void 0}}function yw({drawDefinition:t,participantId:e,tieFormat:i,lineUp:n}){if(typeof t!="object")return{error:Lt};if(typeof e!="string")return{error:Ra};let r=OL({lineUp:n,tieFormat:i});if(!r.valid)return r;let{extension:a}=Bi({element:t,name:Of}),o=(a==null?void 0:a.value)||{};return o[e]=F6({lineUp:n}),un({element:t,extension:{name:Of,value:o}}),YP({drawDefinition:t}),{...ue}}function B6({inContextDrawMatchUps:t,inheritance:e=!0,tournamentRecord:i,drawDefinition:n,matchUpsMap:r,assignments:a,structure:o,event:s}){if(!n)return{error:Lt};let{drawPositions:l,matchUps:c,targetMatchUps:u}=jve({inContextDrawMatchUps:t,matchUpsMap:r,assignments:a,structure:o});for(let d of u)d.matchUpType===Ip&&(d.sides??[]).forEach((p,h)=>{var f;if(p!=null&&p.drawPosition&&l!=null&&l.includes(p.drawPosition)){let m=c.find(({matchUpId:g})=>g===d.matchUpId);if((f=m==null?void 0:m.sides)!=null&&f[h]){if(delete m.sides[h].lineUp,e===!1){let g=d.tieFormat,v=p.participantId;g&&v&&yw({drawDefinition:n,participantId:v,lineUp:[],tieFormat:g})}sn({tournamentId:i==null?void 0:i.tournamentId,context:"resetLineUps",eventId:s==null?void 0:s.eventId,drawDefinition:n,matchUp:m})}}});return{...ue}}function Sp({provisionalPositioning:t,inContextDrawMatchUps:e,isQualifierPosition:i,sourceMatchUpStatus:n,tournamentRecord:r,drawDefinition:a,seedingProfile:o,participantId:s,seedBlockInfo:l,drawPosition:c,matchUpsMap:u,structureId:d,event:p}){var h,f,m;let g="assignDrawPosition";if(!s&&!i)return fe({result:{error:Ra},stack:g});u=u??ko({drawDefinition:a}),e||({matchUps:e}=wa({inContext:!0,drawDefinition:a,matchUpsMap:u}));let v=pi({drawDefinition:a,structureId:d});if(v.error)return fe({result:v,stack:g});let{structure:y}=v;if(!y)return{error:Dr};if(Ll({structure:y}))return fe({result:{error:Ws},stack:g});let{seedAssignments:b}=Gc({provisionalPositioning:t,drawDefinition:a,structure:y}),I=(h=b==null?void 0:b.find(P=>P.participantId===s))==null?void 0:h.seedNumber,{appliedPolicies:T}=Mn({tournamentRecord:r,drawDefinition:a,structure:y,event:p});if(I&&!A_({seedNumber:I,appliedPolicies:T,drawDefinition:a,seedBlockInfo:l,drawPosition:c,structureId:d}))return fe({result:{error:V4},context:{drawPosition:c},stack:g});let w=Ha({structure:y}).positionAssignments||[],S=w==null?void 0:w.find(P=>P.drawPosition===c);if(!S)return fe({result:{error:tU},context:{drawPosition:c},stack:g});if(w!=null&&w.map(Wi).includes(s))return fe({result:{error:aU},context:{drawPosition:c},stack:g});let{containsParticipant:D,containsBye:E}=C(S);if(E){let P=fR({inContextDrawMatchUps:e,tournamentRecord:r,drawDefinition:a,drawPosition:c,structureId:d,matchUpsMap:u,event:p});if(P.error)return fe({result:P,stack:g})}if(D&&S.participantId!==s){let{activeDrawPositions:P}=hR({drawDefinition:a,structureId:d});if(P.includes(c))return fe({result:{error:YO},stack:g});B6({assignments:[S],inContextDrawMatchUps:e,tournamentRecord:r,drawDefinition:a,matchUpsMap:u,structure:y})}if(S.participantId=s,i&&(S.qualifier=!0),((y==null?void 0:y.stageSequence)||0)>1||y.stage&&[Mo,Br].includes(y.stage)){let P=y.stage===Xt?Xt:Ft,R=(((m=(f=a.structures)==null?void 0:f.find(N=>(N==null?void 0:N.stage)===P&&(N==null?void 0:N.stageSequence)===1))==null?void 0:m.seedAssignments)??[]).find(N=>N.participantId===s);if(R!=null&&R.participantId){let{participantId:N,seedNumber:M,seedValue:A}=R;DU({eventId:p==null?void 0:p.eventId,provisionalPositioning:t,tournamentRecord:r,drawDefinition:a,seedingProfile:o,participantId:N,seedNumber:M,seedValue:A,structureId:d,event:p})}}if(y.structureType!==xs)cqe({provisionalPositioning:t,inContextDrawMatchUps:e,sourceMatchUpStatus:n,tournamentRecord:r,drawDefinition:a,drawPosition:c,matchUpsMap:u,structure:y,event:p});else{bve({positionAssignments:w,tournamentRecord:r,drawDefinition:a,matchUpsMap:u,structure:y});let{drawPositions:P,matchUps:R,targetMatchUps:N}=jve({assignments:[S],inContextDrawMatchUps:e,drawDefinition:a,matchUpsMap:u,structure:y});if(P&&(R==null?void 0:R.length)===1&&R[0].matchUpType===Jn){let M=((N==null?void 0:N[0].sides)??[]).reduce((A,_,x)=>P!=null&&P.includes(_.drawPosition)?x:A,void 0);L6({inContextTargetMatchUp:N[0],teamParticipantId:s,matchUp:R[0],drawPositionSideIndex:M,tournamentRecord:r,drawDefinition:a})}}return cg({tournamentId:r==null?void 0:r.tournamentId,drawDefinition:a,structure:y,event:p}),{positionAssignments:w,...ue};function C(P){let R=P.bye,N=P.qualifier,M=P.participantId;return{containsBye:R,containsQualifier:N,containsParticipant:M,filled:R||N||M}}}function cqe({provisionalPositioning:t,inContextDrawMatchUps:e,sourceMatchUpStatus:i,tournamentRecord:n,drawDefinition:r,drawPosition:a,matchUpsMap:o,structure:s,event:l}){let c={isCollectionMatchUp:!1},{matchUps:u}=Sn({provisionalPositioning:t,matchUpFilters:c,drawDefinition:r,matchUpsMap:o,structure:s,event:l}),{roundMatchUps:d}=Rs({matchUps:u}),{initialRoundNumber:p}=hI({drawPosition:a,matchUps:u}),h=p&&(d==null?void 0:d[p].find(f=>{var m;return(m=f.drawPositions)==null?void 0:m.includes(a)}));if(h){let f=zS({matchUpId:h.matchUpId,inContextDrawMatchUps:e,sourceMatchUpStatus:i,tournamentRecord:n,drawDefinition:r,drawPosition:a,matchUpsMap:o});if(f.error)return fe({stack:"assignDrawPositionToMatchUps",context:{drawPosition:a},result:f})}return{...ue}}function $6(t){let{participantIdAttributeName:e="participantId",isQualifierPosition:i,positionActionName:n,tournamentRecord:r,drawDefinition:a,participantId:o,drawPosition:s,structureId:l,event:c}=t,u="positionParticipantAction";if(!a)return{error:Lt};let{inContextDrawMatchUps:d,matchUpsMap:p}=t;p||(p=ko({drawDefinition:a}),Object.assign(t,{matchUpsMap:p})),d||({matchUps:d}=wa({inContext:!0,drawDefinition:a,matchUpsMap:p}),Object.assign(t,{inContextDrawMatchUps:d}));let{positionAssignments:h}=jn({drawDefinition:a,structureId:l}),f=h==null?void 0:h.find(b=>b.drawPosition===s);if(f!=null&&f.participantId){let b=f.participantId,I=Sp({inContextDrawMatchUps:d,tournamentRecord:r,drawDefinition:a,participantId:o,drawPosition:s,structureId:l,matchUpsMap:p,event:c});return I.success?y({removedParticipantId:b}):fe({result:I,stack:u})}let m=fR({inContextDrawMatchUps:d,tournamentRecord:r,drawDefinition:a,drawPosition:s,structureId:l,matchUpsMap:p,event:c});if(m.error)return fe({result:m,stack:u});let g=m.participantId,v=Sp({inContextDrawMatchUps:d,isQualifierPosition:i,tournamentRecord:r,drawDefinition:a,participantId:o,drawPosition:s,structureId:l,matchUpsMap:p,event:c});if(!v.success)return fe({result:v,stack:u});return y({removedParticipantId:g});function y({removedParticipantId:b}){let{structure:I}=pi({drawDefinition:a,structureId:l});s6({drawPositions:[s],structure:I});let T={[e]:o,name:n,drawPosition:s,structureId:l};return UL({drawDefinition:a,positionAction:T}),fe({context:{removedParticipantId:b},result:{...ue},stack:u})}}function uqe({luckyLoserParticipantId:t,tournamentRecord:e,drawDefinition:i,drawPosition:n,structureId:r}){return $6({positionActionName:"luckyLoserDrawPositionAssignment",participantId:t,tournamentRecord:e,drawDefinition:i,drawPosition:n,structureId:r})}function Gve(t){return uqe(t)}function dqe({alternateParticipantId:t,tournamentRecord:e,drawDefinition:i,drawPosition:n,structureId:r}){return $6({positionActionName:"alternateDrawPositionAssignment",participantIdAttributeName:"alternateParticipantid",participantId:t,tournamentRecord:e,drawDefinition:i,drawPosition:n,structureId:r})}function Hve(t){return dqe(t)}function zve({params:t,modMap:e,structure:i}){let{tournamentRecord:n,drawDefinition:r,event:a}=t;for(let o of i.matchUps)e[o.matchUpId]&&(o.roundNumber=e[o.matchUpId],sn({tournamentId:n==null?void 0:n.tournamentId,eventId:a==null?void 0:a.eventId,drawDefinition:r,matchUp:o}))}function qve(t,e){let i=[{drawDefinition:!0,structureId:!0}];Array.isArray(e)&&i.push(...e);let n=mn(t,i);if(n.error)return n;let r=pi(t);if(r.error)return r;let a=r.structure;if(!Ll({structure:a}))return fe({result:{error:tw,message:"structure must be adHoc"}});let{roundMatchUps:o=[],roundNumbers:s}=Rs({matchUps:a==null?void 0:a.matchUps});return s!=null&&s.length?{valid:!0,structure:a,roundMatchUps:o,roundNumbers:s}:{error:Oh}}function Wve(t){var e;let i=qve(t,[{targetRoundNumber:!0,roundNumber:!0,[Lg]:RGe}]);if(i.error)return i;let{structure:n,roundMatchUps:r,roundNumbers:a}=i,{targetRoundNumber:o,roundNumber:s}=t;if(!(a!=null&&a.includes(s))||!(a!=null&&a.includes(o)))return fe({result:{error:Me},info:"roundNumbers must be valid rounds"});let l=o>s,c=l?Ct(s+1,o+1):Ct(o,s),u={};return c.forEach(d=>((r==null?void 0:r[d])??[]).forEach(({matchUpId:p})=>{u[p]=d-(l?1:-1)})),(e=r==null?void 0:r[s])==null||e.forEach(({matchUpId:d})=>u[d]=o),zve({params:t,modMap:u,structure:n}),{...ue}}function Kve({structurePositionAssignments:t,provisionalPositioning:e,tournamentRecord:i,drawDefinition:n,event:r}){var a;if(!n)return{error:Lt};if(!Array.isArray(t))return{error:Me};let o="setPositionAssignments";for(let l of t){let{structureId:c,positionAssignments:u}=l;if(!u)continue;let d=pi({drawDefinition:n,structureId:c});if(d.error)return d;let p=d.structure;if(!p)return{error:Dr};let h=(a=jn({structure:p}).positionAssignments)==null?void 0:a.map(({drawPosition:v})=>v),f=u==null?void 0:u.map(({drawPosition:v})=>v);if(Wr(h,f).length!==(h==null?void 0:h.length))return fe({result:{error:Me},info:"drawPositions do not match",stack:o});let m=ko({drawDefinition:n}),{matchUps:g}=wa({inContext:!0,drawDefinition:n,matchUpsMap:m});for(let v of u||[]){let{drawPosition:y,participantId:b,bye:I,qualifier:T}=v;if(I){let w=uc({tournamentRecord:i,drawDefinition:n,drawPosition:y,matchUpsMap:m,structureId:c,structure:p,event:r});if(w!=null&&w.error)return w}else if(T)u.forEach(w=>{w.drawPosition===y&&(w.qualifier=!0,delete w.participantId,delete w.bye)});else if(b){let w=Sp({provisionalPositioning:e,inContextDrawMatchUps:g,tournamentRecord:i,drawDefinition:n,participantId:b,drawPosition:y,matchUpsMap:m,structureId:c,event:r});if(w!=null&&w.error)return w}}cg({tournamentId:i==null?void 0:i.tournamentId,drawDefinition:n,structure:p,event:r})}let s=t.map(({structureId:l})=>l);return er({tournamentId:i==null?void 0:i.tournamentId,eventId:r==null?void 0:r.eventId,drawDefinition:n,structureIds:s}),{...ue}}function Yve(t){let e=qve(t,[{roundNumbers:!0,[Lg]:bl,[nd]:o=>o.length===2&&o.every(Lr)}]);if(e.error)return e;let{structure:i,roundMatchUps:n,roundNumbers:r}=e;if(!t.roundNumbers.every(o=>r==null?void 0:r.includes(o)))return fe({result:{error:Me,message:"roundNumbers must be valid rounds"}});let a={};return t.roundNumbers.forEach((o,s)=>((n==null?void 0:n[o])??[]).forEach(({matchUpId:l})=>{a[l]=t.roundNumbers[1-s]})),zve({params:t,modMap:a,structure:i}),{...ue}}function pqe({qualifyingParticipantId:t,tournamentRecord:e,drawDefinition:i,drawPosition:n,structureId:r}){return $6({positionActionName:"qualifierDrawPositionAssignment",participantId:t,isQualifierPosition:!0,tournamentRecord:e,drawDefinition:i,drawPosition:n,structureId:r})}function Zve(t){return pqe(t)}function hqe({tournamentRecord:t,drawDefinition:e,drawPositions:i,structureId:n,event:r}){if(!e)return{error:Lt};if(!n)return{error:lc};if((i==null?void 0:i.length)!==2)return{error:Me,drawPositions:i};let a=ko({drawDefinition:e}),{matchUps:o}=wa({inContext:!0,drawDefinition:e,matchUpsMap:a}),{structure:s}=pi({drawDefinition:e,structureId:n});if(!s)return{error:Dr};let l;if(s.structureType===xs?l=gqe({inContextDrawMatchUps:o,tournamentRecord:t,drawDefinition:e,drawPositions:i,matchUpsMap:a,structure:s,event:r}):l=fqe({inContextDrawMatchUps:o,tournamentRecord:t,drawDefinition:e,drawPositions:i,matchUpsMap:a,structure:s,event:r}),l.error)return l;if(s6({structure:s,drawPositions:i}),UL({drawDefinition:e,positionAction:{name:"swapDrawPositionAssignments",drawPositions:i,structureId:n}}),cg({tournamentId:t==null?void 0:t.tournamentId,drawDefinition:e,structure:s,event:r}),r.eventType===Hc){let c=Sn({matchUpFilters:{matchUpTypes:[Ip]},inContext:!0,structure:s}).matchUps.filter(d=>{var p;return(p=d.drawPositions)==null?void 0:p.some(h=>i.includes(h))}),u=Sn({matchUpFilters:{matchUpTypes:[Ip]},structure:s}).matchUps;c.forEach(d=>{(d.sides||[]).forEach(p=>{var h;let f=p==null?void 0:p.drawPosition;if(i.includes(f)){let m=p.participantId,g=u.find(({matchUpId:y})=>y===d.matchUpId),v=(h=d==null?void 0:d.sides)==null?void 0:h.reduce((y,b,I)=>b.drawPosition===f?I:y,void 0);L6({inContextTargetMatchUp:d,drawPositionSideIndex:v,teamParticipantId:m,tournamentRecord:t,drawDefinition:e,matchUp:g,event:r})}})})}return er({drawDefinition:e,structureIds:[n]}),{...ue}}function fqe({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,drawPositions:n,matchUpsMap:r,structure:a,event:o}){let s=a==null?void 0:a.positionAssignments.filter(c=>n==null?void 0:n.includes(c.drawPosition));if(!s)return{error:Me,structure:a,info:"Missing positionAssignments"};if(s.filter(({bye:c})=>c).length===2)return{...ue};if(s.filter(({qualifier:c})=>c).length===2)return{...ue};let l=s.some(({qualifier:c})=>c);return s.some(({bye:c})=>c)&&!l?Xve({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,assignments:s,matchUpsMap:r,structure:a,event:o}):mqe({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,assignments:s,matchUpsMap:r,structure:a,event:o})}function Xve({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,assignments:n,matchUpsMap:r,structure:a,event:o}){let s=n.find(({bye:f})=>f),l=n.find(({participantId:f})=>f),c=s.drawPosition,{participantId:u,drawPosition:d}=l,{structureId:p}=a,h=SE({drawPosition:c,inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,structureId:p,matchUpsMap:r});return h.error||(h=SE({drawPosition:d,inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,structureId:p,matchUpsMap:r}),h.error)||(uc({drawPosition:d,tournamentRecord:e,drawDefinition:i,structureId:p,matchUpsMap:r,event:o}),h=Sp({drawPosition:c,inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,structureId:p,participantId:u,matchUpsMap:r,event:o}),h.error)?h:{...ue}}function mqe({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,assignments:n,matchUpsMap:r,structure:a,event:o}){let s=Object.assign({},...n.map((l,c)=>{let{drawPosition:u}=l,d={...n[1-c],drawPosition:u};return{[u]:d}}));return a.positionAssignments=a.positionAssignments.map(l=>s[l.drawPosition]||l),B6({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,matchUpsMap:r,assignments:n,structure:a,event:o}),{...ue}}function gqe({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,drawPositions:n,matchUpsMap:r,structure:a,event:o}){var s;let l=(s=a.structures)==null?void 0:s.reduce((u,d)=>{let p=d==null?void 0:d.positionAssignments.filter(h=>n==null?void 0:n.includes(h.drawPosition));return p&&u.push(...p),u},[]);if(l.filter(({bye:u})=>u).length===2)return{...ue};if(l.filter(({qualifier:u})=>u).length===2)return{...ue};B6({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,matchUpsMap:r,assignments:l,structure:a,event:o});let c=l.some(({qualifier:u})=>u);if(l.some(({bye:u})=>u)&&!c)Xve({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,assignments:l,matchUpsMap:r,structure:a,event:o});else{let u=$t(l,!1,!0);l.forEach((d,p)=>{let h=u[1-p].participantId;d.qualifier=u[1-p].qualifier,d.participantId=h})}return{...ue}}function Jve(t){return hqe(t)}function Qve({validation:t=!0,tournamentRecord:e,drawDefinition:i,participantId:n,structureId:r,seedValue:a,event:o}){if(!i)return{error:Lt};if(!r)return{error:lc};let s=((e==null?void 0:e.participants)??[]).find(p=>p.participantId===n);if(e&&!s)return{error:vp};let{structure:l}=pi({drawDefinition:i,structureId:r});if(!l)return{error:Dr};if(!(!t||Lr(a)||a===void 0||a===""||typeof a=="string"&&a.split("-").every(p=>Lr(p)&&ai(p)>0)))return{error:Me};let{seedAssignments:c}=Gc({drawDefinition:i,structure:l}),u=c==null?void 0:c.map(p=>p.seedNumber),d=c==null?void 0:c.find(p=>p.participantId===n);if(d){let p=typeof a=="string"?a.includes("-")&&a.split("-").map(h=>parseInt(h)).join("-")||parseInt(a)>0&&parseInt(a)||"":a&&a>0&&a||"";d.seedValue=p}else{let p={seedNumber:Math.max(0,...u||[])+1,participantId:n};a&&(p.seedValue=a),l.seedAssignments||(l.seedAssignments=[]),l.seedAssignments.push(p)}return _ge({tournamentId:e==null?void 0:e.tournamentId,eventId:o==null?void 0:o.eventId,drawDefinition:i,structure:l}),{...ue}}function eye({drawDefinition:t,structureId:e}){if(!t)return{error:Lt};let{structure:i}=pi({drawDefinition:t,structureId:e}),n=((t==null?void 0:t.links)||[]).filter(r=>{var a;return((a=r.source)==null?void 0:a.structureId)===e}).map(r=>{var a;return(a=r.target)==null?void 0:a.structureId});return{playoffStructures:((t==null?void 0:t.structures)||[]).filter(r=>n.includes(r.structureId)),structure:i}}function LL({withStageGrouping:t,stageSequences:e,stageSequence:i,roundTarget:n,stages:r,event:a,stage:o}){if(!a)return{error:_n};let s={},l=[];for(let c of a.drawDefinitions||[]){let{structures:u,stageStructures:d}=Rh({withStageGrouping:t,stageSequences:e,drawDefinition:c,stageSequence:i,roundTarget:n,stages:r,stage:o});if(l.push(...u),d)for(let p of Object.keys(d))s[p]||(s[p]=[]),s[p].push(...d[p])}return{structures:l,stageStructures:s}}function V6({withStageGrouping:t,tournamentRecord:e,stageSequences:i,stageSequence:n,roundTarget:r,stages:a,stage:o}){if(!e)return{error:it};let s={},l=[];for(let c of e.events||[]){let{structures:u,stageStructures:d}=LL({withStageGrouping:t,stageSequences:i,stageSequence:n,roundTarget:r,stages:a,event:c,stage:o});if(u&&l.push(...u),d)for(let p of Object.keys(d))s[p]||(s[p]=[]),s[p].push(...d[p])}return{structures:l,stageStructures:s}}function dg(t){if(!(t!=null&&t.drawDefinition))return!1;let e=AL(t),i=e==null?void 0:e.includesTeamMatchUps,{completedMatchUps:n,pendingMatchUps:r,upcomingMatchUps:a}=e||{};return i&&(n=n==null?void 0:n.filter(({matchUpType:o})=>o===Jn),r=r==null?void 0:r.filter(({matchUpType:o})=>o===Jn),a=a==null?void 0:a.filter(({matchUpType:o})=>o===Jn)),!!(n!=null&&n.length&&!(r!=null&&r.length)&&!(a!=null&&a.length))}function j6(t){var e,i;let{drawDefinition:n,structureId:r}=t;if(!n)return{error:Lt};let{playoffStructures:a}=eye({drawDefinition:n,structureId:r});if(!(a!=null&&a.length))return!1;let o=((i=(e=n==null?void 0:n.entries)==null?void 0:e.filter(l=>(l==null?void 0:l.entryStatus)&&qu.includes(l.entryStatus)))==null?void 0:i.length)??0,s=0;return(a||[]).reduce((l,c)=>{var u;return!!((u=jn({structure:c}).positionAssignments??[])!=null&&u.filter(d=>(d.participantId&&s++,(d==null?void 0:d.bye)??(d==null?void 0:d.participantId))).length&&l)},!!a.length)||s===o}function fj({significantCharacters:t,accessors:e=[],value:i}){let n=[],r=e[0];if(i!=null&&i[r]){let o=e.slice(1);if(Array.isArray(i[r]))i[r].forEach(s=>{let l=fj({accessors:o,significantCharacters:t,value:s});n.push(...l)});else if(i=i[r],o.length){let s=fj({accessors:o,significantCharacters:t,value:i});n.push(...s)}else a({value:i})}function a({value:o}){if(o&&["string","number"].includes(typeof o)){let s=t?o.slice(0,t):o;n.push(s)}}return n}function vqe({targetParticipantIds:t,policyAttributes:e,idCollections:i,participants:n}){if(!Array.isArray(e))return{error:J4};if(!Array.isArray(n))return{error:OP};let r={};return t.forEach(a=>{let o=n.find(l=>l.participantId===a),{values:s}=tye({policyAttributes:e,idCollections:i,participants:n,participant:o});s&&s.forEach(l=>{r[l]||(r[l]=[]),r[l].includes(a)||r[l].push(a)})}),r}function tye({policyAttributes:t,idCollections:e,participants:i,participant:n}){if(!Array.isArray(t))return{error:J4};if(!n)return{error:nw};let r=[];return t.forEach(a=>{let{directive:o,groupings:s,key:l,significantCharacters:c}=a||{};if(l){let u=l.split(".");r.push(...fj({significantCharacters:c,value:n,accessors:u}))}else if(o){let u=a==null?void 0:a.includeIds,d=((e==null?void 0:e[o])||[]).filter(p=>!u||u.includes(p));d!=null&&d.length&&i!=null&&i.length&&d.forEach(p=>{var h;let f=i.find(m=>m.participantId===p);if((h=f==null?void 0:f.individualParticipantIds)!=null&&h.includes(n.participantId)){let m=f==null?void 0:f.participantId;r.push(m)}})}else s&&Object.keys(s).forEach(u=>{s[u].includes(n.participantId)&&r.push(u)})}),{values:ki(r)}}function GZ({candidatePositionAssignments:t,participantsWithGroupings:e,policyAttributes:i,idCollections:n}){let r=Object.assign({},...e.map(a=>({[a.participantId]:a})));return t.map(a=>{let o=r[a.participantId],{values:s}=tye({participants:e,policyAttributes:i,idCollections:n,participant:o});return{...a,values:s}})}function iye({participantIdGroups:t,positionAssignments:e,groupsToAvoid:i}){return Object.assign({},...e.filter(n=>n==null?void 0:n.participantId).map(n=>{let{drawPosition:r,participantId:a}=n,o=t?t[a]||[]:[],s=!!i.some(l=>o.includes(l));return{[r]:{participantGroups:o,includesGroupsToAvoid:s}}}))}function yqe(t){let{unfilledPositions:e,chunkedDrawPositions:i}=t,n=iye(t);return i.map(a=>{let o=e.filter(c=>a.includes(c)),s=r(o),l=o.filter(c=>!s.includes(c)).filter(c=>{var u;let d=HZ(c);return!((u=n[d])!=null&&u.includesGroupsToAvoid)});return{unassigned:o,unpaired:s,pairedNoConflict:l}});function r(a){return a.filter(s=>!o(s));function o(s){let l=HZ(s);return!a.includes(l)}}}function bqe(t){let{unfilledPositions:e,chunkedDrawPositions:i}=t,n=iye(t);return i.map(r=>{let a=e.filter(l=>r.includes(l)),o=a.length===r.length?a:[],s=r.filter(l=>{var c;return(c=n[l])==null?void 0:c.includesGroupsToAvoid}).length;return{unassigned:a,unpaired:o,pairedNoConflict:s?[]:a,conflictsCount:s}})}function HZ(t){return Number(t%2?t+1:t-1)}function Iqe({allGroups:t,participantId:e}){return Object.keys(t).filter(i=>t[i].includes(e))}function wqe({selectedParticipantGroups:t,participantIdGroups:e,positionAssignments:i,drawPositionChunks:n,unfilledPositions:r,isRoundRobin:a}){let o=n.map(s=>a?bqe({groupsToAvoid:t,chunkedDrawPositions:s,participantIdGroups:e,positionAssignments:i,unfilledPositions:r}):yqe({groupsToAvoid:t,chunkedDrawPositions:s,participantIdGroups:e,positionAssignments:i,unfilledPositions:r}));if(a){let s=o.map(u=>u.map(d=>d.unassigned).filter(d=>d==null?void 0:d.length)).filter(u=>u==null?void 0:u.length).sort((u,d)=>(d.length||0)-(u.length||0)),l=o.map(u=>u.map(d=>d.unpaired).filter(d=>d==null?void 0:d.length)).filter(u=>u==null?void 0:u.length),c=o.map(u=>u.map(d=>d.pairedNoConflict).filter(d=>d==null?void 0:d.length)).filter(u=>u==null?void 0:u.length).sort((u,d)=>(d.length||0)-(u.length||0));return{unassigned:s,unpaired:l,pairedNoConflict:c}}else{let s=o.map(u=>u.map(d=>d.unassigned).filter(d=>d==null?void 0:d.length)).filter(u=>u==null?void 0:u.length),l=o.map(u=>u.map(d=>d.unpaired).filter(d=>d==null?void 0:d.length)).filter(u=>u==null?void 0:u.length),c=o.map(u=>u.map(d=>d.pairedNoConflict).filter(d=>d==null?void 0:d.length)).filter(u=>u==null?void 0:u.length);return{unassigned:s,unpaired:l,pairedNoConflict:c}}}function nye({positionAssignments:t,participantIds:e}){let i=t.map(n=>n.participantId);return e.filter(n=>!i.includes(n))}function Sqe({useSpecifiedGroupKey:t=!1,targetParticipantIds:e,largestFirst:i=!0,allGroups:n,groupKey:r}){var a;let o=Object.assign({},...Object.keys(n).map(u=>[u,n[u].filter(d=>e.includes(d))]).filter(u=>u[1].length).map(([u,d])=>({[u]:d}))),s=Object.keys(o).reduce((u,d)=>o[d].length>u?o[d].length:u,0),l=Object.keys(o).filter(u=>o[u].length===s),c=mu(i?l:Object.keys(o));return r=t&&(a=o[r])!=null&&a.length?r:c,{participantId:r&&o[r]?mu(o[r]):mu(e),groupKey:r}}function Tqe({drawPositionGroups:t,positionAssignments:e}){let i=Object.assign({},...e.map(n=>({[n.drawPosition]:n})));return t.map(n=>n.filter(Boolean).map(r=>i[r]).filter(Boolean).filter(r=>!r.participantId&&!r.bye).map(r=>r.drawPosition)).flat().filter(Boolean)}function Uqe({candidatePositionAssignments:t,unseededParticipantIds:e,participantIdGroups:i,drawPositionChunks:n,drawPositionGroups:r,pairedPriority:a,allGroups:o,groupKey:s}){let l=r.reduce((D,E)=>E.length>D?E.length:D,0)<=2,c=nye({positionAssignments:t,participantIds:e}),u=Tqe({positionAssignments:t,drawPositionGroups:r}),{participantId:d,groupKey:p}=Sqe({targetParticipantIds:c,useSpecifiedGroupKey:l,allGroups:o,groupKey:s}),h=Iqe({participantId:d,allGroups:o}),f=wqe({positionAssignments:t,isRoundRobin:l,selectedParticipantGroups:h,participantIdGroups:i,drawPositionChunks:n,unfilledPositions:u}),{unassigned:m,unpaired:g,pairedNoConflict:v}=f,y=(v==null?void 0:v.length)&&v[0],b=(g==null?void 0:g.length)&&g[0],I=a&&y?y:b,T=a?b:y,w=(I==null?void 0:I.length)&&I||(T==null?void 0:T.length)&&T,S;if(w!=null&&w.length){let D=Tl(w);S=Tl(D)}else{let D=Tl(m[0]);S=Tl(D)}return{newGroupKey:p,selectedParticipantId:d,targetDrawPosition:S}}function __({isRoundRobin:t,groupedParticipants:e}){let i=[];return t?e.forEach(n=>{let r=n.map(s=>s.drawPosition),a=_6({drawPositions:r}).uniqueMatchUpGroupings??[],o=Object.assign({},...n.map(s=>({[s.drawPosition]:s})));a.forEach(s=>{Ps(o[s[0]].values||[],o[s[1]].values||[])&&(i.push(s),n.conflict=!0)})}):e.forEach(n=>{var r,a;Ps(((r=n[0])==null?void 0:r.values)||[],((a=n[1])==null?void 0:a.values)||[])&&(i.push(n),n.conflict=!0)}),i}function Dqe({positionedParticipants:t,potentialDrawPositions:e,drawPositionGroups:i,avoidanceConflicts:n,isRoundRobin:r}){return n.map(a=>{let o=a.map(s=>s.drawPosition);return a.filter(s=>e.includes(s.drawPosition)).map(s=>{let l=e.filter(c=>!(o!=null&&o.includes(c))).filter(c=>{let u=i.find(m=>m.includes(c)).find(m=>m!==c),d=t.find(m=>m.drawPosition===u),p=__({isRoundRobin:r,groupedParticipants:[[s,d]]}),h=[t.find(m=>m.drawPosition===c),d],f=__({isRoundRobin:r,groupedParticipants:[h]});return!p.length&&!f.length});if(l.length)return{drawPosition:s.drawPosition,possibleDrawPositions:l}}).filter(Boolean)}).flat(1)}function zZ(t){let{initialPositionAssignments:e,participantsWithGroupings:i,opponentsToPlaceCount:n,unseededByePositions:r,drawPositionGroups:a,policyAttributes:o,idCollections:s,allGroups:l}=t,c=[],u,d=Math.min(...(a||[]).map(b=>b==null?void 0:b.length).filter(Boolean)),p=d>2,h=$t(e,!1,!0).filter(b=>!b.qualifier),f=e.filter(b=>!b.participantId&&(!b.bye||(r==null?void 0:r.includes(b.drawPosition)))).map(b=>b.drawPosition);Ct(0,n).forEach(()=>{let{newGroupKey:b,selectedParticipantId:I,targetDrawPosition:T}=Uqe({...t,candidatePositionAssignments:h,allGroups:l,groupKey:u});u=b,h.forEach(w=>{w.drawPosition===T&&(w.participantId=I)})});let m=GZ({candidatePositionAssignments:h,participantsWithGroupings:i,policyAttributes:o,idCollections:s}),g=so(m,d),v=__({groupedParticipants:g,isRoundRobin:p}),y=0;for(;y<20&&v.length;){let b=Dqe({positionedParticipants:m,potentialDrawPositions:f,avoidanceConflicts:v,drawPositionGroups:a,isRoundRobin:p});if(b.length){let I=Eqe({candidatePositionAssignments:h,swapOptions:b});I.error&&console.log({result:I}),m=GZ({candidatePositionAssignments:h,participantsWithGroupings:i,policyAttributes:o,idCollections:s}),g=so(m,d),v=__({groupedParticipants:g,isRoundRobin:p}),y++}else y=20}return h.forEach(b=>{if(b.bye&&b.participantId){let I=zV;c.push(I)}if(b.qualifier&&b.participantId){let I=zV;c.push(I)}}),{positionAssignments:h,conflicts:v.length,groupedParticipants:g,errors:c}}function Eqe({candidatePositionAssignments:t,swapOptions:e}){let i=Tl(e);if(!i)return{error:{message:"No swap options"}};let n=i.drawPosition,r=Tl(i.possibleDrawPositions),a=t.find(c=>c.drawPosition===n),o=t.find(c=>c.drawPosition===r)??{},s={participantId:o==null?void 0:o.participantId,qualifier:o==null?void 0:o.qualifier,bye:o==null?void 0:o.bye},l={participantId:a.participantId,qualifier:a.qualifier,bye:a.bye};return Object.assign(a,s),Object.assign(o,l),{...ue}}function Cqe({provisionalPositioning:t,unseededParticipantIds:e,inContextDrawMatchUps:i,unseededByePositions:n,tournamentRecord:r,drawDefinition:a,seedBlockInfo:o,participants:s,matchUpsMap:l,structureId:c,avoidance:u,drawSize:d,event:p}){var h;if(!u)return{error:$fe};let{candidatesCount:f=1,policyAttributes:m,targetDivisions:g}=u,{roundsToSeparate:v}=u,y="randomUnseededSeparation",{structure:b}=pi({drawDefinition:a,structureId:c}),{matchUps:I}=Sn({provisionalPositioning:t,matchUpsMap:l,structure:b,event:p});if(g&&Td(g)&&!v){let H=aGe(g)||0,$=I.reduce((q,z)=>z.roundNumber>q?z.roundNumber:q,0);v=$<H?1:$-H+1}let{positionAssignments:T}=Ha({structure:b}),w=l6({participantsProfile:{convertExtensions:!0},deepCopy:!1,participants:s}).participantsWithGroupings,S=T==null?void 0:T.filter(H=>!H.participantId),D=T==null?void 0:T.map(H=>H.drawPosition),E=(b==null?void 0:b.structureType)===xs,C=E?{structure:b,matchUps:I,allDrawPositions:D,roundsToSeparate:v}:{matchUps:I,allDrawPositions:D,roundsToSeparate:v},{drawPositionGroups:P,drawPositionChunks:R}=E?Pqe(C):Rqe(C),N={groupParticipants:s.filter(H=>H.participantType===cc).map(H=>H.participantId),teamParticipants:s.filter(H=>H.participantType===Hn).map(H=>H.participantId),pairParticipants:s.filter(H=>H.participantType===Ui).map(H=>H.participantId)},M=vqe({targetParticipantIds:e,policyAttributes:m,idCollections:N,participants:s});if(M.error)return fe({result:M,stack:y});let A=Object.assign({},...e.map(H=>{let $=Object.keys(M).filter(q=>(M[q]??[]).includes(H));return{[H]:$}})),_=nye({participantIds:e,positionAssignments:T});if(_.length>((S==null?void 0:S.length)||0))return{error:r5};let x,O=_.length,B=Ct(0,f).map(()=>zZ({initialPositionAssignments:T,participantsWithGroupings:w,unseededParticipantIds:e,opponentsToPlaceCount:O,pairedPriority:!1,unseededByePositions:n,participantIdGroups:A,drawPositionChunks:R,drawPositionGroups:P,policyAttributes:m,idCollections:N,allGroups:M,drawSize:d}));if(x=B.reduce((H,$)=>!H||($.conflicts||0)<(H.conflicts||0)?$:H,void 0),!x||x.conflicts){let H=Ct(0,f).map(()=>zZ({initialPositionAssignments:T,participantsWithGroupings:w,unseededParticipantIds:e,opponentsToPlaceCount:O,pairedPriority:!0,unseededByePositions:n,participantIdGroups:A,drawPositionChunks:R,drawPositionGroups:P,policyAttributes:m,idCollections:N,allGroups:M,drawSize:d}));x=B.concat(...H).filter($=>{var q;return!((q=$.errors)!=null&&q.length)}).reduce(($,q)=>!$||(q.conflicts||0)<($.conflicts||0)?q:$,void 0)}if(!x)return{error:nL};let F=(((h=jn({structure:b}))==null?void 0:h.positionAssignments)??[]).filter(H=>H.participantId).map(H=>H.participantId),G=x.positionAssignments.filter(H=>!F.includes(H.participantId));for(let H of G)if(H.bye){let $=uc({tournamentRecord:r,drawDefinition:a,seedBlockInfo:o,structureId:c,matchUpsMap:l,event:p,...H});if($.error)return fe({result:$,stack:y})}else if(H.participantId){let $=Sp({automaticPlacement:!0,inContextDrawMatchUps:i,tournamentRecord:r,drawDefinition:a,seedBlockInfo:o,structureId:c,matchUpsMap:l,event:p,...H});if($.error)return fe({result:$,stack:y,context:{assignment:H}})}return{...ue}}function Pqe(t){let{structure:{structures:e}}=t,i=e.map(n=>n.positionAssignments.map(r=>r.drawPosition));return{drawPositionGroups:i,drawPositionChunks:[i]}}function Rqe({allDrawPositions:t,roundsToSeparate:e,matchUps:i}){let n=i.filter(u=>u.roundNumber===1).map(u=>u.drawPositions),r=n.flat().sort(va),a=Math.max(...r),o=t.filter(u=>u>a),s=r.length,l=Ct(s===2?1:2,s).filter(u=>u===g5(u)),c=l.slice(0,e||l.length).reverse().map(u=>so(r,u));return o.length&&console.log({fedDrawPositions:o}),{drawPositionGroups:n,drawPositionChunks:c}}function Mqe({provisionalPositioning:t,inContextDrawMatchUps:e,unseededByePositions:i,multipleStructures:n,tournamentRecord:r,drawDefinition:a,seedBlockInfo:o,participants:s,matchUpsMap:l,structureId:c,structure:u,drawSize:d,event:p}){var h,f;let m="positionUnseededParticipants";u||({structure:u}=pi({drawDefinition:a,structureId:c})),c||({structureId:c}=u);let{positionAssignments:g}=Ha({structure:u}),{seedAssignments:v}=Gc({provisionalPositioning:t,drawDefinition:a,structure:u}),y=v==null?void 0:v.map(P=>P.participantId).filter(Boolean),{stage:b,stageSequence:I}=u,T=b===Xt?(f=(h=Bi({element:u,name:Ap}))==null?void 0:h.extension)==null?void 0:f.value:void 0,w=uw({provisionalPositioning:t,drawDefinition:a,stageSequence:I,entryStatuses:Ly,structureId:c,roundTarget:T,stage:b}),S=w.filter(P=>!(y!=null&&y.includes(P.participantId))).map(P=>P.participantId),D=g==null?void 0:g.filter(P=>!P.participantId&&!P.bye&&!P.qualifier).map(P=>P.drawPosition);if(!n&&S.length>((D==null?void 0:D.length)||0))return fe({result:{error:r5},context:{unseededParticipantsCount:S.length,unfilledDrawPositionsCount:D==null?void 0:D.length},stack:m});let{appliedPolicies:E}=Mn({tournamentRecord:r,drawDefinition:a,event:p}),C=E==null?void 0:E[pE];if(u.stage===Br){let P=w.reduce((R,N)=>(R[N.groupingValue]||(R[N.groupingValue]=[]),R[N.groupingValue].push(N.participantId),R),{});Object.keys(P).length&&(C||(C={policyName:"Playoff Avoidance"}),C.policyAttributes||(C.policyAttributes=[]),C.policyAttributes.push({groupings:P}))}return C&&s?Cqe({provisionalPositioning:t,unseededParticipantIds:S,inContextDrawMatchUps:e,unseededByePositions:i,tournamentRecord:r,drawDefinition:a,seedBlockInfo:o,participants:s,matchUpsMap:l,structureId:c,avoidance:C,drawSize:d,entries:w}):Nqe({provisionalPositioning:t,unseededParticipantIds:S,inContextDrawMatchUps:e,unfilledDrawPositions:D,multipleStructures:n,tournamentRecord:r,drawDefinition:a,seedBlockInfo:o,structureId:c,matchUpsMap:l,drawSize:d,event:p})}function Nqe({provisionalPositioning:t,unseededParticipantIds:e,inContextDrawMatchUps:i,unfilledDrawPositions:n,multipleStructures:r,tournamentRecord:a,drawDefinition:o,seedBlockInfo:s,matchUpsMap:l,structureId:c,drawSize:u,event:d}){let p=u>2?vs(n):n.reverse();for(let h of e){let f=p.pop();if(!r||f){let m=Sp({provisionalPositioning:t,inContextDrawMatchUps:i,tournamentRecord:a,drawDefinition:o,seedBlockInfo:s,participantId:h,drawPosition:f,matchUpsMap:l,structureId:c,event:d});if(m!=null&&m.error&&console.log("!!!!!",{result:m}),m==null?void 0:m.error)return fe({result:m,stack:"randomUnseededDistribution"})}}return{...ue}}function Aqe(t){let e=t.structure??pi(t).structure,i="positionQualifiers",n=[];if(e.stage===Mo)return fe({result:{error:Ay},stack:i});let{unplacedRoundQualifierCounts:r,positionAssignments:a,roundDrawPositions:o}=_qe(t);for(let s of Object.keys(r)){let l=a==null?void 0:a.filter(c=>o[s].includes(c.drawPosition)&&!c.participantId&&!c.qualifier&&!c.bye).map(c=>c.drawPosition);if(r[s]>(l||0))return fe({result:{error:rme},context:{unfilledDrawPositions:l},stack:i});Ct(0,r[s]).forEach(()=>{let c=Tl(l);n.push(c),a==null||a.forEach(u=>{u.drawPosition===c&&(u.qualifier=!0,delete u.participantId,delete u.bye)})})}return{...ue,qualifierDrawPositions:n}}function _qe({drawDefinition:t,structure:e,structureId:i}){e||({structure:e}=pi({drawDefinition:t,structureId:i})),i||({structureId:i}=e);let{positionAssignments:n}=Ha({structure:e}),{stage:r,stageSequence:a}=e,{qualifiersCount:o,roundQualifiersCounts:s}=TU({drawDefinition:t,stageSequence:a,structureId:i,stage:r}),l=(s?Object.keys(s):[]).map(m=>ai(m)),{matchUps:c}=Sn({structure:e}),{roundProfile:u}=Rs({matchUps:c}),d=Object.assign({},...l.filter(m=>u==null?void 0:u[m]).map(m=>{var g,v;return{[m]:((v=(g=u==null?void 0:u[m])==null?void 0:g.drawPositions)==null?void 0:v.filter(Boolean))??[]}})),p=n==null?void 0:n.filter(m=>m.qualifier).map(m=>m.drawPosition),h=o-((p==null?void 0:p.length)??0),f=p==null?void 0:p.length;return{unplacedRoundQualifierCounts:Object.assign({},...l.map(m=>{let g=n==null?void 0:n.filter(v=>{var y,b;return v.qualifier&&((b=(y=d[m])==null?void 0:y.drawPositions)==null?void 0:b.includes(v.drawPosition))}).map(v=>v.drawPosition);return{[m]:((s==null?void 0:s[m])??0)-((g==null?void 0:g.length)??0)}})),unplacedQualifiersCount:h,placedQualifiersCount:f,roundQualifiersCounts:s,positionAssignments:n,roundDrawPositions:d,qualifiersCount:o}}function qZ({provisionalPositioning:t,inContextDrawMatchUps:e,tournamentRecord:i,appliedPolicies:n,validSeedBlocks:r,drawDefinition:a,seedingProfile:o,seedBlockInfo:s,participants:l,groupsCount:c,structureId:u,matchUpsMap:d,structure:p,event:h}){let f=[],m=[],g=0;if(p||({structure:p}=pi({drawDefinition:a,structureId:u})),u||(u=p==null?void 0:p.structureId),n||(n=Mn({drawDefinition:a}).appliedPolicies),!r){let v=p&&vw({provisionalPositioning:t,appliedPolicies:n,drawDefinition:a,seedingProfile:o,structure:p});v!=null&&v.error&&m.push(v.error),r=v==null?void 0:v.validSeedBlocks}return c=c??(r==null?void 0:r.length)??0,Ct(0,c).forEach(()=>{if(g<(c||0)){let v=kqe({provisionalPositioning:t,inContextDrawMatchUps:e,tournamentRecord:i,drawDefinition:a,seedingProfile:o,seedBlockInfo:s,participants:l,structureId:u,matchUpsMap:d,event:h});v!=null&&v.success&&(g++,f.push(...v.seedPositions??[])),v.error&&m.push({seedPositionError:v.error})}}),m.length?{error:m}:{...ue,seedPositions:f}}function kqe({provisionalPositioning:t,inContextDrawMatchUps:e,tournamentRecord:i,drawDefinition:n,seedingProfile:r,seedBlockInfo:a,participants:o,structureId:s,matchUpsMap:l,event:c}){let{unplacedSeedParticipantIds:u,unfilledPositions:d}=Fve({provisionalPositioning:t,randomize:!0,drawDefinition:n,seedingProfile:r,seedBlockInfo:a,structureId:s,event:c}),{appliedPolicies:p}=Mn({drawDefinition:n}),{avoidance:h}=p??{};h&&o&&(u==null?void 0:u.length)>2;let f=[];for(let m of u){let g=d.pop();if(!g)return{error:iU};f.push(g);let v=Sp({provisionalPositioning:t,inContextDrawMatchUps:e,tournamentRecord:i,drawDefinition:n,seedingProfile:r,participantId:m,seedBlockInfo:a,drawPosition:g,matchUpsMap:l,structureId:s,event:c});if(!v.success)return v}return{...ue,seedPositions:f}}function xqe({provisionalPositioning:t,drawDefinition:e,structure:i}){let{positionAssignments:n}=Ha({structure:i}),{seedAssignments:r}=Gc({provisionalPositioning:t,drawDefinition:e,structure:i}),a=Object.assign({},...(r||[]).filter(o=>o.participantId).map(o=>({[o.participantId]:o})));return n==null?void 0:n.map(o=>a[o.participantId]?{...o,seedNumber:a[o.participantId].seedNumber,seedValue:a[o.participantId].seedValue}:"").filter(Boolean)}function Oqe({orderedSortedFirstRoundSeededDrawPositions:t,validSeedBlocks:e,byesToPlace:i}){let n=[];e.forEach(a=>{if(i-n.length>a.drawPositions.length)n.push(...a.drawPositions);else{let o=mj(so(a.drawPositions,2)),s,l=t[n.length];for(;s=qN(o,l);)n.push(s),l=t[n.length]}});let r=n.map(a=>Array.isArray(a)?vs(a):a).flat(1/0);return Eme(i)&&e.map(a=>a.seedNumbers[0]).includes(i)?t:r}function qN(t,e){if(Array.isArray(t)&&t.length!==2)return t.pop();if(!Array.isArray(t[0]))return t.includes(e)?t.indexOf(e)?t.pop():t.shift():Math.round(Math.random())?t.pop():t.shift();let i=t[0].flat(1/0).length,n=t[1].flat(1/0).length;if(i===n){let r=t[0].flat(1/0).includes(e)?t[0]:t[1];return qN(e?r:t[Math.round(Math.random())],e)}return i<n?qN(t[1],e):qN(t[0],e)}function mj(t){let e=Math.floor(t.length/2);return t.length>2?[mj(t.slice(0,e)),mj(t.slice(e))]:t}function Lqe({provisionalPositioning:t,relevantMatchUps:e,appliedPolicies:i,drawDefinition:n,seedingProfile:r,seedBlockInfo:a,byesToPlace:o,structure:s}){var l;a||(a=vw({provisionalPositioning:t,appliedPolicies:i,drawDefinition:n,seedingProfile:r,structure:s}));let{isFeedIn:c,isLuckyStructure:u,isContainer:d}=a,{validSeedBlocks:p}=a;(l=i==null?void 0:i.seeding)!=null&&l.containerByesIgnoreSeeding&&(p=[]);let h=xqe({provisionalPositioning:t,drawDefinition:n,structure:s})??[],f=ki([].concat(...e.map(T=>T.drawPositions))),m=h.filter(T=>f.includes(T.drawPosition)),g=(T,w)=>HS(T.seedValue)-HS(w.seedValue),v=p.reduce((T,w)=>{let S=m.filter(D=>{var E;return(E=w.drawPositions)==null?void 0:E.includes(D.drawPosition)}).sort(g);return T.concat(...S)},[]).map(T=>T.drawPosition),y=Oqe({orderedSortedFirstRoundSeededDrawPositions:v,validSeedBlocks:p,byesToPlace:o}),b=WZ({orderedSeedDrawPositions:v,relevantMatchUps:e}).slice(0,o),I=WZ({orderedSeedDrawPositions:y,relevantMatchUps:e}).slice(0,o);return{strictSeedOrderByePositions:b,blockSeedOrderByePositions:I,isLuckyStructure:u,positionedSeeds:h,isContainer:d,isFeedIn:c}}function WZ({orderedSeedDrawPositions:t,relevantMatchUps:e}){let i=e.map(n=>n.drawPositions).map(n=>n==null?void 0:n.sort((r,a)=>r-a)).filter(n=>(n==null?void 0:n[0])+1===(n==null?void 0:n[1]));return t.map(n=>i.find(r=>r==null?void 0:r.includes(n))).filter(Boolean).map(n=>n==null?void 0:n.reduce((r,a)=>t.includes(a)?r:a,void 0)).filter(Boolean)}function Fqe({provisionalPositioning:t,seedOrderByePositions:e,isLuckyStructure:i,appliedPolicies:n,drawDefinition:r,seedLimit:a,structure:o,isFeedIn:s}){var l,c;let u=(l=n==null?void 0:n.seeding)==null?void 0:l.seedingProfile,d=o.stage===Xt,{positionAssignments:p}=Ha({structure:o}),h=p==null?void 0:p.filter(x=>x.participantId).map(x=>x.drawPosition),f={isCollectionMatchUp:!1},{matchUps:m,roundMatchUps:g}=Sn({provisionalPositioning:t,matchUpFilters:f,structure:o}),v=(g==null?void 0:g[1])||[],y=o.structureType===xs?m:v,b=ki([].concat(...y.map(x=>x.drawPositions))),I=Math.min(...b)-1,T=h==null?void 0:h.filter(x=>b.includes(x)),w=x=>{let O=Math.ceil(x.length/2),B=[x.slice(0,O),x.slice(O)],F=B.map(Q=>[].concat(...Q.flat(1/0)).length),G=Math.min(...F.flat(1/0)),H=Math.max(...F.flat(1/0)),$=F.indexOf(H),q=G!==H,z=vs(B),[Z,Y]=!G||q?[B[$],B[1-$]]:[z[0],z[1]];return{greaterHalf:Z,lesserHalf:Y}},S=x=>{let{greaterHalf:O,lesserHalf:B}=w(x),{greaterHalf:F,lesserHalf:G}=w(O),H=vs(F.flat(1/0)).pop(),$=F.flat().filter(q=>q!==H);return{newlyFilteredChunks:[...B,...G,$],drawPosition:H}},D=x=>!e.includes(x),E=x=>!(T!=null&&T.includes(x)),C=x=>{let O=so(x.sort(va),Math.ceil(x.length/4)).map(G=>G.filter(E)),B=[].concat(...O.flat(1/0)).length,F=[];for(let G=0;G<B;G++){let{newlyFilteredChunks:H,drawPosition:$}=S(O);F.push($),O=H}return F},{validSeedBlocks:P}=vw({provisionalPositioning:t,allPositions:!0,appliedPolicies:n,drawDefinition:r,structure:o}),R=P==null?void 0:P.map(x=>{var O;return(O=x.drawPositions)==null?void 0:O.map(B=>B+I)}),N;if(s){let x=b.length,{seedBlocks:O}=k6({cluster:bR(u)===vL,participantsCount:x});N=O.map(B=>B.map(F=>F+I)).map(C).filter(B=>B.length)}else d?N=R==null?void 0:R.map(x=>x.filter(E)):N=R==null?void 0:R.map(C).filter(x=>x.length);let M=y.map(x=>x.drawPositions).map(x=>x==null?void 0:x.sort((O,B)=>O-B)).filter(x=>(x==null?void 0:x[0])+1===(x==null?void 0:x[1])),A=x=>M.reduce((O,B)=>B.includes(x)?B.reduce((F,G)=>G!==x?G:F,void 0):O,void 0),_=N.map(x=>x.map(A)).flat(1/0).filter(E).filter(D).filter(Boolean);if(d&&!o.structures){let x=a%4,O=_.slice(0,x),B=(c=g[o.roundLimit])==null?void 0:c.length,F=so(_.slice(x),B).map(vs).flat();_=O.concat(F)}return{unseededByePositions:_}}function Bqe({provisionalPositioning:t,drawDefinition:e,matchUpsMap:i,structure:n,event:r}){var a;let o={isCollectionMatchUp:!1},{matchUps:s,roundMatchUps:l}=Sn({afterRecoveryTimes:!1,provisionalPositioning:t,drawDefinition:e,matchUpFilters:o,matchUpsMap:i,structure:n,event:r}),c=(l==null?void 0:l[1])||[],u=(n==null?void 0:n.structureType)===xs,d=u?s:c,p=u?((a=n==null?void 0:n.structures)==null?void 0:a.length)||0:s.length,{structureId:h,stage:f,stageSequence:m}=n,g=uw({entryStatuses:qu,provisionalPositioning:t,drawDefinition:e,stageSequence:m,structureId:h,stage:f}),{qualifiersCount:v}=TU({provisionalPositioning:t,drawDefinition:e,stageSequence:m,structureId:h,stage:f}),y=g.length+v,{positionAssignments:b,unassignedPositions:I}=Ha({structure:n}),T=I==null?void 0:I.map(P=>P.drawPosition),w=b==null?void 0:b.filter(P=>P.bye).length,S=b==null?void 0:b.filter(P=>P.bye).map(P=>P.drawPosition),D=d.map(P=>P.drawPositions).filter(P=>P==null?void 0:P.reduce((R,N)=>!(S!=null&&S.includes(N))&&R,!0)).flat(1/0).filter(P=>T==null?void 0:T.includes(P)),E=b==null?void 0:b.length,C=E?E-y:0;return C>p&&n.stageSequence===1&&n.stage!==Mo&&(C=p),{placedByes:w,byesCount:C,relevantMatchUps:d,placedByePositions:S,roundMatchUps:l,positionsToAvoidDoubleBye:D}}function KZ({provisionalPositioning:t,tournamentRecord:e,appliedPolicies:i,drawDefinition:n,seedBlockInfo:r,seedingProfile:a,matchUpsMap:o,structureId:s,structure:l,seedLimit:c,seedsOnly:u,event:d}){var p;l||({structure:l}=pi({drawDefinition:n,structureId:s})),s||(s=l==null?void 0:l.structureId);let h=!((l==null?void 0:l.structures)??(l==null?void 0:l.stage)===Xt),{byesCount:f,placedByes:m,relevantMatchUps:g}=Bqe({provisionalPositioning:t,drawDefinition:n,matchUpsMap:o,structure:l,event:d}),v=f-(m||0);if(v<=0)return{...ue};let{strictSeedOrderByePositions:y,blockSeedOrderByePositions:b,isLuckyStructure:I,isFeedIn:T}=Lqe({provisionalPositioning:t,relevantMatchUps:g,appliedPolicies:i,drawDefinition:n,seedingProfile:a,seedBlockInfo:r,byesToPlace:v,structure:l}),w=(l==null?void 0:l.structureType)&&[xs,yL].includes(l.structureType)&&((p=i==null?void 0:i.seeding)==null?void 0:p.containerByesIgnoreSeeding),S=h&&b!=null&&b.length?b:y,{unseededByePositions:D}=Fqe({provisionalPositioning:t,seedOrderByePositions:S,isLuckyStructure:I,appliedPolicies:i,drawDefinition:n,seedLimit:c,structure:l,isFeedIn:T}),E=N=>N%2,C=(N,M)=>(N||[]).every(A=>E(A)?M!==A+1:M!==A-1),P=[].concat(...S);if(!u)for(;D.length;){let N=D.find(M=>C(P,M));N?(P.push(N),D=D.filter(M=>M!==N)):(P.push(...D),D=[])}w&&(P=vs(P),jc({ignoreSeededByes:w})&&console.log({byePositions:P}));let R=P.slice(0,v);for(let N of R){let M=uc({provisionalPositioning:t,tournamentRecord:e,drawDefinition:n,drawPosition:N,matchUpsMap:o,structureId:s,structure:l,event:d});if(M!=null&&M.error)return M}return{...ue,unseededByePositions:D,byeDrawPositions:R}}function IR(t){var e,i,n,r;let{drawDefinition:a}=t,{applyPositioning:o=!0,provisionalPositioning:s,multipleStructures:l,placeByes:c=!0,tournamentRecord:u,placementGroup:d,seedingProfile:p,structureId:h,seedLimit:f,seedsOnly:m,drawType:g,drawSize:v,event:y}=t,b=[];o||(kme(),a=$t(a,!1,!0));let I=B=>(o||FN(),fe({result:B,stack:"automatedPositioning"})),T=B=>(o||FN(),B),w=pi({drawDefinition:a,structureId:h});if(w.error)return I(w);let S=w.structure;if(!S)return{error:Dr};let D=t.appliedPolicies||((e=Mn({drawDefinition:a,structure:S,event:y}))==null?void 0:e.appliedPolicies),{qualifiersCount:E}=TU({stageSequence:S.stageSequence,provisionalPositioning:s,stage:S.stage,drawDefinition:a,structureId:h}),C=Ly;if(!((i=uw({stageSequence:S.stageSequence,provisionalPositioning:s,stage:S.stage,placementGroup:d,drawDefinition:a,entryStatuses:C,structureId:h}))!=null&&i.length)&&!E)return T({...ue});let P=t.matchUpsMap??ko({drawDefinition:a}),R=t.inContextDrawMatchUps??((n=wa({inContext:!0,drawDefinition:a,matchUpsMap:P}))==null?void 0:n.matchUps),N=[],M=vw({provisionalPositioning:s,appliedPolicies:D,drawDefinition:a,seedingProfile:p,structure:S});if(M.error)return M;let{validSeedBlocks:A}=M;b.push({validSeedBlocks:A});let _=t.participants||(u?(r=Yr({withIndividualParticipants:!0,convertExtensions:!0,tournamentRecord:u}))==null?void 0:r.participants:[]);if(bR(S.seedingProfile||p)===ty){let B=c?KZ({provisionalPositioning:s,tournamentRecord:u,appliedPolicies:D,drawDefinition:a,seedBlockInfo:M,matchUpsMap:P,structure:S,seedLimit:f,seedsOnly:m,event:y}):void 0;if(B!=null&&B.error)return I(B);N=B.unseededByePositions,b.push({action:"positionByes",unseededByePositions:N});let F=S.seedingProfile?{positioning:S.seedingProfile}:p;if(B=qZ({seedingProfile:F,provisionalPositioning:s,inContextDrawMatchUps:R,tournamentRecord:u,appliedPolicies:D,validSeedBlocks:A,drawDefinition:a,seedBlockInfo:M,participants:_,matchUpsMap:P,structure:S,event:y}),B.error)return I(B);b.push({seedPositions:B.seedPositions,action:"positionSeedBlocks"})}else{if(g!==ky){let F=S.seedingProfile?{positioning:S.seedingProfile}:p,G=qZ({seedingProfile:F,provisionalPositioning:s,inContextDrawMatchUps:R,tournamentRecord:u,appliedPolicies:D,validSeedBlocks:A,drawDefinition:a,seedBlockInfo:M,participants:_,matchUpsMap:P,structure:S,event:y});if(G.error)return I(G);b.push({action:"positionSeedBlocks",seedPositions:G.seedPositions})}let B=c?KZ({provisionalPositioning:s,tournamentRecord:u,appliedPolicies:D,drawDefinition:a,seedBlockInfo:M,matchUpsMap:P,structure:S,seedLimit:f,seedsOnly:m,event:y}):void 0;if(B!=null&&B.error)return I(B);N=B==null?void 0:B.unseededByePositions,b.push({action:"positionByes",byeDrawPositions:B==null?void 0:B.byeDrawPositions,unseededByePositions:N})}let x={};if(!m){let B=Aqe({inContextDrawMatchUps:R,tournamentRecord:u,appliedPolicies:D,validSeedBlocks:A,drawDefinition:a,seedBlockInfo:M,participants:_,matchUpsMap:P,structure:S});if(B.error||(B.conflicts&&(x.qualifierConflicts=B.conflicts),b.push({action:"positionQualifiers",qualifierDrawPositions:B.qualifierDrawPositions}),B=Mqe({provisionalPositioning:s,inContextDrawMatchUps:R,unseededByePositions:N,multipleStructures:l,tournamentRecord:u,drawDefinition:a,seedBlockInfo:M,participants:_,matchUpsMap:P,structureId:h,structure:S,drawSize:v,event:y}),B.error))return I(B);B.conflicts&&(x.unseededConflicts=B.conflicts),b.push({action:"positionUnseededParticipants"})}let{positionAssignments:O}=jn({drawDefinition:a,structure:S});return er({drawDefinition:a,structureIds:[h]}),o||FN(),{positionAssignments:O,conflicts:x,...ue,positioningReport:b}}function wR(t){var e;let{applyPositioning:i=!0,provisionalPositioning:n,tournamentRecord:r,drawDefinition:a,seedingProfile:o,structureId:s,placeByes:l,seedsOnly:c,event:u}=t;if(!u)return{error:kl};if(!a)return{error:_l};if(!dg({drawDefinition:a,structureId:s})&&!n)return{error:$4};let d=(e=eye({drawDefinition:a,structureId:s}).playoffStructures)==null?void 0:e.sort((f,m)=>D_(f)-D_(m)),p=[],h=[];if(d)for(let f of d){let{structureId:m}=f,g=IR({structureId:m,provisionalPositioning:n,applyPositioning:i,tournamentRecord:r,drawDefinition:a,seedingProfile:o,placeByes:l,seedsOnly:c});if(g.error)return g;g.positionAssignments&&p.push({positionAssignments:g.positionAssignments,structureId:m}),g.positioningReport&&h.push(g.positioningReport)}return{...ue,structurePositionAssignments:p,positioningReports:h}}function rye({drawDefinition:t,orderMap:e}){return t?((typeof e!="object"||!Object.values(e).every(i=>bi(i)))&&fe({result:{error:Me},context:{orderMap:e}}),t.structures||(t.structures=[]),t.structures.forEach(i=>{let n=e[i.structureId];n&&(i.structureOrder=n)}),t.structures.sort((i,n)=>AS(i.structureOrder)-AS(n.structureOrder)),{...ue}):{error:Lt}}function FL({drawDefinition:t}){var e,i,n,r,a,o,s;let l=t.structures??[],c=t.links??[],u=new Map,d=S=>{let D=u.get(S)||u.set(S,{drawSources:[],drawTargets:[],progeny:[],sources:[],targets:[]})&&u.get(S);if(D&&!(D!=null&&D.stage)){let E=l.find(C=>C.structureId===S);D.stage=E==null?void 0:E.stage}return D},p={},h={},f=c.map(S=>{let D=S.source.structureId,E=S.target.structureId,C=d(D),P=d(E);return[iy,gu,bL,ty].includes(S.target.feedProfile)?(C==null||C.targets.push(E),P==null||P.sources.push(D)):S.target.feedProfile===rd&&(P==null||P.drawSources.push(D),C==null||C.drawTargets.push(E)),h[E]=h[E]||S.target.feedProfile===rd,p[E]=ki([...p[E]||[],D]).filter(Boolean),[S.source.structureId,S.target.structureId]});for(let S of u.keys()){let D=u.get(S);if(D){let E=D.targets??[];for(;E.length;){let C=E.pop(),P=C&&u[C];(e=P==null?void 0:P.targets)!=null&&e.length?E.push(...P.targets):P&&(D.rootStage=P.stage)}if(D.rootStage||(D.rootStage=D.stage),!((i=D.targets)!=null&&i.length)){let C=D.sources??[];for(;C.length;){let P=C.pop(),R=P&&u[P];if((n=R==null?void 0:R.sources)!=null&&n.length){for(let N of R.sources)(r=D.progeny)!=null&&r.includes(N)||(a=D.progeny)==null||a.push(N);C.push(...R.sources)}}}}}let m=0;for(let S of u.keys()){let D=u.get(S);if(D&&D.rootStage===Xt){let E=[(o=D.drawTargets)==null?void 0:o[0]],C=0;for(;E.length;){C+=1;let P=E.pop(),R=P?u.get(P):void 0;(s=R==null?void 0:R.drawTargets)!=null&&s.length&&E.push(R.drawTargets[0])}D.distanceFromMain=C,C>m&&(m=C)}}let g=f.length;Ct(0,Math.ceil(g/2)).forEach(()=>{f=Ct(0,g).map(S=>{let D=f[S],E=f.reduce((C,P)=>Ps(D,P)?C.concat(...P):C,[])||[];return ki(D.concat(...E))})});let v=f[0],y=(S,D)=>Wr(S,D).length===S.length,b=f.slice(1).reduce((S,D)=>S&&y(D,v),!0),I=[v].filter(Boolean),T=[v].filter(Boolean);l.forEach(S=>{let{structureId:D,stage:E}=S;I.find(C=>C.includes(D))||(I.push([D]),E!==to&&T.push([D]))});let w=b&&T.length===1;return!(c!=null&&c.length)&&l.length===1&&d(l[0].structureId),{structureProfiles:Object.fromEntries(u),allStructuresLinked:w,maxQualifyingDepth:m,sourceStructureIds:p,hasDrawFeedProfile:h,structureGroups:I}}function aye({drawDefinition:t}){let{maxQualifyingDepth:e,structureProfiles:i}=FL({drawDefinition:t});for(let n of t.structures){let r=i[n.structureId];r.distanceFromMain&&(n.stageSequence=e+1-r.distanceFromMain)}return{...ue}}function Vg(t){var e;let{duplicateValues:i=!0,creationTime:n=!0,removePriorValues:r,timeItem:a,element:o}=t;if(!a)return{error:l5};if(!o)return{error:Ht,info:_5};let s=a&&Object.keys(a),l=["itemType","itemValue"];if(l.filter(c=>s.includes(c)).length!==l.length)return{error:s5};if(!o.timeItems)o.timeItems=[];else{let{itemType:c,itemSubTypes:u,itemValue:d}=a,p=c&&((e=kp({itemSubTypes:u,itemType:c,element:o}))==null?void 0:e.timeItem);if(p&&JSON.stringify(p==null?void 0:p.itemValue)===JSON.stringify(d)&&!i)return{...ue}}if(a.itemSubTypes&&!a.itemSubTypes.length&&delete a.itemSubTypes,n){let c=new Date().toISOString();Object.assign(a,{createdAt:c})}return r&&(o.timeItems=o.timeItems.filter(({itemType:c})=>a.itemType!==c)),r&&!a.itemValue||o.timeItems.push(a),{...ue}}function G6({creationTime:t=!0,removePriorValues:e,tournamentRecord:i,duplicateValues:n,participantId:r,timeItem:a}){if(!i)return{error:it};if(!r)return{error:Ra};let o=jy({tournamentRecord:i,participantId:r});return o.error?o:Vg({element:o.participant,removePriorValues:e,duplicateValues:n,creationTime:t,timeItem:a})}function bw(t){let{removePriorValues:e,tournamentRecord:i,duplicateValues:n,creationTime:r,timeItem:a}=t;return i?Vg({element:i,removePriorValues:e,duplicateValues:n,creationTime:r,timeItem:a}):{error:it}}function Iw(t){let{removePriorValues:e,duplicateValues:i,creationTime:n,timeItem:r,event:a}=t;return a?Vg({removePriorValues:e,duplicateValues:i,element:a,creationTime:n,timeItem:r}):{error:kl}}function H6({tournamentRecord:t,drawDefinition:e,structure:i,link:n}){if(!t)return{error:it};if(!e)return{error:Lt};let r=$qe({tournamentId:t.tournamentId,drawDefinition:e,structure:i,link:n});if(r.error)return r;let a={itemType:"attachQualifyingStructures",itemValue:{structureId:i.structureId,drawId:e.drawId}};return bw({tournamentRecord:t,timeItem:a}),r}function $qe({drawDefinition:t,tournamentId:e,structure:i,eventId:n,link:r}){var a;if(!t)return{error:Lt};if(!i)return{error:_g};if(!r)return{error:z4};let o=r.target.structureId,s=pi({drawDefinition:t,structureId:o});if(s.error)return fe({stack:"attachQualifyingStructure",context:{targetStructureId:o},result:s});t.structures||(t.structures=[]),t.links||(t.links=[]),t.structures.push(i),t.links.push(r),aye({drawDefinition:t});let l=((a=Sn({structure:i}))==null?void 0:a.matchUps)||[];return lg({drawDefinition:t,tournamentId:e,matchUps:l,eventId:n}),er({drawDefinition:t,structureIds:[i.structureId]}),{...ue}}function oye({drawDefinition:t,structureDetails:e}){if(!Array.isArray(e))return{error:Me};if(!t)return{error:Lt};let i=Object.assign({},...e.map(n=>{if(!sr(n))return;let{structureId:r,structureName:a}=n||{};if(!(!r||!a))return{[r]:a}}).filter(Boolean));if(!Object.values(i).length)return{error:Ht};for(let n of t.structures||[]){let r=i[n.structureId];r&&(n.structureName=r)}return{...ue}}function z6({drawDefinition:t,timeItem:e}){if(!t)return{error:_l};if(!e)return{error:l5};let i=e&&Object.keys(e),n=["itemType","itemValue"];if(n.filter(a=>i.includes(a)).length!==n.length)return{error:s5};t.timeItems||(t.timeItems=[]);let r=new Date().toISOString();return Object.assign(e,{createdAt:r}),t.timeItems.push(e),YP({drawDefinition:t}),{...ue}}function sye(t){var e;let{tournamentRecord:i,drawDefinition:n,structureId:r,event:a}=t,o=mn(t,[{drawDefinition:!0,structureId:!0}]);if(o.error)return o;let s=n.structures??[],l=s.find(y=>y.structureId===r);if(!l)return{error:Dr};let c=s.find(({stage:y,stageSequence:b})=>y===Ft&&b===1),u=r===(c==null?void 0:c.structureId),d=s.filter(({stage:y})=>y===Xt).map(Ol("structureId"));if(u&&!d.length)return{error:bfe};let p=d.includes(r),h=Vqe({isQualifyingStructure:p,structure:l,...t});if(h!=null&&h.error)return h;let{structureIdsToRemove:f,relatedStructureIdsMap:m}=Gqe({qualifyingStructureIds:d,isQualifyingStructure:p,isMainStageSequence1:u,mainStageSequence1:c,drawDefinition:n,structureId:r}),{removedMatchUpIds:g,removedStructureIds:v}=Hqe({relatedStructureIdsMap:m,qualifyingStructureIds:d,isMainStageSequence1:u,mainStageSequence1:c,drawDefinition:n,structureIdsToRemove:f,structureId:r});if(jqe({removedMatchUpIds:g,drawDefinition:n}),u){let y=(e=c.matchUps??[])==null?void 0:e.map(Ol("matchUpId"));g.push(...y),c.positionAssignments=[],c.seedAssignments=[],c.matchUps=[],c.extensions&&(c.extensions=[])}return p&&aye({drawDefinition:n}),lm({tournamentId:i==null?void 0:i.tournamentId,matchUpIds:g,action:"removeStructure",eventId:a==null?void 0:a.eventId,drawDefinition:n}),er({drawDefinition:n,eventId:a==null?void 0:a.eventId}),{...ue,removedMatchUpIds:g,removedStructureIds:v}}function Vqe({isQualifyingStructure:t,tournamentRecord:e,drawDefinition:i,structureId:n,structure:r,event:a,force:o}){var s,l,c,u,d,p;let h=[n];if(t){let f=g=>{var v;return(v=i.links)==null?void 0:v.find(y=>y.target.structureId===g)},m=(s=f(n))==null?void 0:s.source.structureId;for(;m;)h.push(m),m=(l=f(m))==null?void 0:l.source.structureId}if((c=wa({matchUpFilters:{structureIds:h},drawDefinition:i}).matchUps)!=null&&c.some(({score:f})=>uo({score:f}))){let f=(u=Mn({tournamentRecord:e,drawDefinition:i,structure:r,event:a}))==null?void 0:u.appliedPolicies;if(!(o??((p=(d=f==null?void 0:f[Dh])==null?void 0:d.allowDeletionWithScoresPresent)==null?void 0:p.structures)))return{error:sL}}return{...ue}}function jqe({removedMatchUpIds:t,drawDefinition:e}){let{matchUps:i}=wa({drawDefinition:e});i==null||i.forEach(n=>{n.winnerMatchUpId&&t.includes(n.winnerMatchUpId)&&delete n.winnerMatchUpId,n.loserMatchUpId&&t.includes(n.loserMatchUpId)&&delete n.loserMatchUpId})}function Gqe({qualifyingStructureIds:t,isQualifyingStructure:e,isMainStageSequence1:i,mainStageSequence1:n,drawDefinition:r,structureId:a}){let o=(r.structures??[]).map(Ol("structureId")),s=u=>{var d;return((d=r.links)==null?void 0:d.map(p=>p.source.structureId===u&&p.target.structureId!==(n==null?void 0:n.structureId)&&p.target.structureId).filter(Boolean))??[]},l=u=>{var d;return((d=r.links)==null?void 0:d.map(p=>t.includes(p.source.structureId)&&p.target.structureId===u&&p.source.structureId).filter(Boolean))??[]},c=new Map;return o.forEach(u=>c.set(u,e?l(u):s(u))),{structureIdsToRemove:i?c.get(a):[a],relatedStructureIdsMap:c}}function Hqe({relatedStructureIdsMap:t,qualifyingStructureIds:e,isMainStageSequence1:i,mainStageSequence1:n,drawDefinition:r,structureIdsToRemove:a,structureId:o}){let s=[],l=[];for(;a!=null&&a.length;){let c=a.pop();l.push(...Wqe({idBeingRemoved:c,drawDefinition:r}));let u=qqe({qualifyingStructureIds:e,isMainStageSequence1:i,idBeingRemoved:c,drawDefinition:r,structureId:o});s.push(...u.removedStructureIds);let d=zqe({relatedStructureIdsMap:t,mainStageSequence1:n,idBeingRemoved:c,structureId:o});d!=null&&d.length&&a.push(...d)}return{removedMatchUpIds:l,removedStructureIds:s}}function zqe({idBeingRemoved:t,relatedStructureIdsMap:e,mainStageSequence1:i,structureId:n}){var r;return t&&((r=e.get(t))==null?void 0:r.filter(a=>a!==(i==null?void 0:i.structureId)||n===i.structureId))}function qqe({qualifyingStructureIds:t,isMainStageSequence1:e,idBeingRemoved:i,drawDefinition:n,structureId:r}){var a;let o=[];return n.links=((a=n.links)==null?void 0:a.filter(s=>s.source.structureId!==i&&s.target.structureId!==i))??[],(!e||e&&t.length||i!==r)&&(n.structures=(n.structures??[]).filter(s=>(i&&i===s.structureId&&o.push(i),s.structureId!==i))),{removedStructureIds:o}}function Wqe({idBeingRemoved:t,drawDefinition:e}){let{structure:i}=pi({structureId:t,drawDefinition:e}),n=Sn({structure:i}).matchUps;return F5(n)}function k_({stageSequence:t=1,drawDefinition:e,drawSize:i,stage:n}){if(!e)return{error:Lt};if(!u6({drawDefinition:e,stage:n}))return{error:Ay};let r=CHe({drawDefinition:e,stage:n}),{qualifiersCount:a}=TU({drawDefinition:e,stageSequence:t,stage:n}),o=r+a;if(i<o)return{error:H4};let{entryProfile:s}=c6({attributes:[{[n]:{drawSize:i}}],drawDefinition:e});return er({drawDefinition:e}),{...ue,entryProfile:s}}function lye({qualifiersCount:t=0,drawDefinition:e,stage:i}){return e?u6({drawDefinition:e,stage:i})?i!==Ft?{error:H4,info:"qualifiersCount can only be set for main stage"}:(c6({attributes:[{[i]:{qualifiersCount:t}}],drawDefinition:e}),er({drawDefinition:e}),{...ue}):{error:Ay}:{error:Lt}}function Kqe({drawDefinition:t,drawSize:e}){if(!t)return{error:Lt};let i=k_({stage:to,stageSequence:1,drawDefinition:t,drawSize:e});return i.error?i:(er({drawDefinition:t}),{...ue})}function cye(t){return Kqe(t)}function uye({tournamentRecord:t,drawDefinition:e,participantId:i,structureId:n}){var r;let a="removeSeededParticipant";if(!t)return{error:it};if(!e)return{error:Lt};let o=(e.structures??[]).find(s=>s.structureId===n);return o?!o.stage||![Ft,Xt].includes(o.stage)||o.stage===Ft&&o.stageSequence!==1?fe({result:{error:tw},stack:a}):(r=o.seedAssignments)!=null&&r.find(s=>s.participantId===i)?{...ue}:fe({info:"participant not seeded",result:{error:Wo},context:{participantId:i}}):fe({result:{error:Dr},stack:a})}function SR({targetEntryRound:t=1,finishingPositions:e,sourceRoundNumber:i,sourceStructureId:n,targetStructureId:r,linkType:a=Bf}){return!n||!r?{error:lc}:{link:qt({linkType:a,source:{roundNumber:i,structureId:n,finishingPositions:e},target:{feedProfile:rd,roundNumber:t,structureId:r}})}}function q6({roundPosition:t,roundNumber:e,idPrefix:i,uuids:n}){return i?`${i}-${e}-${t}`:(n==null?void 0:n.pop())||xn()}function x_({includeMatchUpType:t,matchUpType:e,roundNumber:i,matchUps:n,idPrefix:r,isMock:a,uuids:o,nodes:s}){let l=0,c=[],u=1,d=i-1,p=s==null?void 0:s.length;for(;l<(p||0);){let h=s==null?void 0:s[l],f=s==null?void 0:s[l+1];d&&(h.roundNumber=d),f&&d&&(f.roundNumber=d);let m=q6({roundPosition:u,roundNumber:i,idPrefix:r,uuids:o}),g={roundPosition:u,children:[h,f],matchUpId:m};c.push(g);let v={drawPositions:g.children.map(y=>y==null?void 0:y.drawPosition).filter(Boolean),matchUpStatus:Kr,matchUpId:g.matchUpId,roundPosition:u,roundNumber:i};t&&e&&(v.matchUpType=e),a&&(v.isMock=!0),n.push(v),u++,l+=2}return{roundNodes:c,matchUps:n}}function Tp({finishingPositionOffset:t,finishingPositionLimit:e,qualifyingRoundNumber:i,qualifyingPositions:n,matchUpType:r,roundLimit:a,idPrefix:o,drawSize:s,isMock:l,uuids:c}){if(isNaN(s)||s<2||n&&s<=n)return{matchUps:[],roundsCount:0};if(n&&(!Td(s)||s%n)){let g=n;for(;g<s;)g=2*g;s=g}let u=n&&!(s%2)&&(!isNaN(n)||i&&!isNaN(i))&&(s/n===Math.round(s/n)||i&&s/i===Math.round(s/i));if(!Td(s)&&!u)return{matchUps:[],roundsCount:0};let d=Ct(1,s+1).map(g=>({drawPosition:g})),p,h=[],f=1;for({roundNodes:p,matchUps:h}=x_({matchUpType:r,roundNumber:f,idPrefix:o,matchUps:h,isMock:l,nodes:d,uuids:c}),f++,a=a??i;p.length>1;)n&&p.length===n&&(a=f-1),{roundNodes:p,matchUps:h}=x_({nodes:p,matchUpType:r,roundNumber:f,idPrefix:o,matchUps:h,isMock:l,uuids:c}),f++;let m=f-1;return h=ZP({finishingPositionOffset:t,finishingPositionLimit:e,roundsCount:m,roundLimit:a,matchUps:h}),a?h=h.filter(g=>a&&(g.roundNumber??0)<=a):a=f-1,{drawSize:s,matchUps:h,roundsCount:m,roundLimit:a}}function W6(t){var e,i,n,r,a,o;let s="generateQualifyingStructure";if(!t.drawDefinition)return fe({result:{error:Lt},stack:s});if(t.drawSize&&!bi(t.drawSize)||t.participantsCount&&!bi(t.participantsCount)||t.qualifyingPositions&&!bi(t.qualifyingPositions))return fe({result:{error:Me},stack:s});let l=t.drawSize??m5(t.participantsCount),{qualifyingRoundNumber:c,qualifyingPositions:u,targetStructureId:d,structureOptions:p,appliedPolicies:h,drawDefinition:f,matchUpFormat:m,structureName:g,structureId:v,roundTarget:y,drawType:b,idPrefix:I,isMock:T,uuids:w}=t;if(!t.drawSize)return fe({result:{error:_P},context:{drawSize:l},stack:s});if(u&&u>=t.drawSize)return fe({result:{error:Me},context:{drawSize:l,qualifyingPositions:u},stack:s});let S,D,E,C,P=0,R,N=1,{structureProfiles:M}=FL({drawDefinition:f}),A=M[d];if(!A)return fe({result:{error:Dr},context:{targetStructureId:d},stack:s});let _=f.matchUpType,x=y?`${y}-`:"",O=A.stage===Xt,B=((i=(e=h==null?void 0:h[kS])==null?void 0:e.namingConventions)==null?void 0:i.pre)??((r=(n=lze[kS])==null?void 0:n.namingConventions)==null?void 0:r.pre),F=O&&B?`${B}-`:"",G=g??(x?`${F}${Co(Xt)} ${x}`:`${F}${Co(Xt)}`);if(b===ku){let{maxRoundNumber:q,structures:z,groupCount:Z}=vR({structureName:g??G,structureId:v??(w==null?void 0:w.pop()),stage:Xt,structureOptions:p,appliedPolicies:h,stageSequence:N,matchUpType:_,roundTarget:y,idPrefix:I,drawSize:l,isMock:T,uuids:w});P=Z,S=q,E=z[0],R=[1]}else({drawSize:l,matchUps:C,roundLimit:S,roundsCount:D}=Tp({qualifyingRoundNumber:c,qualifyingPositions:u,matchUpType:_,idPrefix:I,drawSize:l,isMock:T,uuids:w})),S||(S=D),E=Ec({structureName:g??G,structureId:v??(w==null?void 0:w.pop()),qualifyingRoundNumber:S,stage:Xt,matchUpFormat:m,stageSequence:N,matchUpType:_,roundLimit:S,matchUps:C}),y&&un({extension:{name:Ap,value:y},element:E}),P=(a=C==null?void 0:C.filter(q=>q.roundNumber===S))==null?void 0:a.length;let H=b===ku?Ff:Bf,$=E&&S&&((o=SR({sourceStructureId:E.structureId,sourceRoundNumber:S,targetStructureId:d,finishingPositions:R,linkType:H}))==null?void 0:o.link);return{qualifyingDrawPositionsCount:l,qualifiersCount:P,...ue,structure:E,link:$}}function dye(t){let e=t.tournamentRecord;if(!e)return{error:it};let i=Yqe(t);if(i.error)return i;let{qualifyingRoundNumber:n,qualifyingPositions:r,targetStructureId:a,drawDefinition:o,structureName:s,matchUpType:l,drawSize:c,drawType:u}=t,d={itemType:"addQualifyingStructures",itemValue:qt({drawId:o.drawId,qualifyingRoundNumber:n,qualifyingPositions:r,targetStructureId:a,structureName:s,matchUpType:l,drawSize:c,drawType:u})};return bw({tournamentRecord:e,timeItem:d}),i}function Yqe(t){if(!t.drawDefinition)return{error:Lt};if(!t.targetStructureId)return{error:lc};let e=W6(t);if(e.error)return e;let{structure:i,link:n}=e;return!i||!n?{error:Me}:H6({tournamentRecord:t.tournamentRecord,drawDefinition:t.drawDefinition,structure:i,link:n})}function Zqe({includeMatchUpType:t,drawPosition:e,roundNumber:i,matchUpType:n,idPrefix:r,matchUps:a,isMock:o,uuids:s,nodes:l,fed:c}){let u=l.length,d=e?e-u:void 0,p=Ct(0,u).map(m=>d?d+m:void 0),h=[];for(let m=0;m<u;m++){let g=p.shift(),v={drawPosition:g,fed:c+1,feed:!0},y=l[m];y.roundNumber=i-1;let b=q6({roundPosition:y.roundPosition,roundNumber:i,idPrefix:r,uuids:s}),I={roundPosition:y.roundPosition,drawPositions:[g],matchUpStatus:Kr,roundNumber:i,matchUpId:b};t&&(I.matchUpType=n),o&&(I.isMock=!0),a.push(I);let T={children:[y,v]};h.push(T)}let f=e?e-u:void 0;return{roundNodes:h,matchUps:a,drawPosition:f}}function pg(t){let e=t.drawSize,{feedRoundsProfile:i,feedRounds:n=0,skipRounds:r=0,baseDrawSize:a}=t,{linkFedFinishingRoundNumbers:o,finishingPositionOffset:s,linkFedRoundNumbers:l,feedsFromFinal:c,isConsolation:u,matchUpType:d,idPrefix:p,isMock:h,uuids:f,fmlc:m}=t;a=a??M(e);let g=Xqe({drawSize:a}),v=g.length,y=0;if(i!=null&&i.length)y=i.reduce((A,_)=>A+_,0);else if(e){let A=e-a;i=g.filter(_=>_<=A?(A-=_,!0):!1),y=i.reduce((_,x)=>_+x,0),n=i.length}else r>=v?n=0:c&&(n=v-c,r=0),i=g.filter((A,_)=>c&&!n||n&&_>=r+n||_<r?0:A),y=i.reduce((A,_)=>A+_,0),n=i.length;let b=[...g,...i].sort((A,_)=>_-A),I=b.length,T=[...(l??[]).map(A=>A-1),...(o??[]).map(A=>I-A)].map(A=>b[A]).reduce((A,_)=>A+_,0);y=y-T;let w=0,S=[],D,E=1,C=Ct(0,a).map((A,_)=>({drawPosition:_+1+y})),P=y+1;for(let A of g){if({roundNodes:D,matchUps:S}=x_({matchUpType:d,roundNumber:E,idPrefix:p,matchUps:S,isMock:h,nodes:C,uuids:f}),E++,i.includes(A)){let _=xl(i)[A],x=Ct(0,_),O=I+1-E,B=(o==null?void 0:o.includes(O))??(l==null?void 0:l.includes(E));x.forEach(()=>{({roundNodes:D,matchUps:S,drawPosition:P}=Zqe({drawPosition:!B&&P||void 0,nodes:D,matchUpType:d,roundNumber:E,idPrefix:p,matchUps:S,isMock:h,uuids:f,fed:w})),E++,w+=1})}C=D}I!==E-1&&console.log("ERROR");let R=a-y;S=ZP({finishingPositionOffset:u?R:s,positionsFed:y,roundsCount:I,matchUps:S,fmlc:m});let N=D!=null&&D.length?D[0]:D;return N&&(N.roundNumber=E-1,N.matchUps=S),{draw:N,matchUps:S,roundsCount:I};function M(A){let _=g5(A);return _>A?_/2:_}}function Xqe({drawSize:t}){let e=Math.ceil(Math.log(t)/Math.log(2));return Ct(0,e).reverse().map(i=>Math.pow(2,i))}function G0(t){let{finishingPositionOffset:e=0,addNameBaseToAttributeName:i,playoffStructureNameBase:n,finishingPositionNaming:r,finishingPositionLimit:a,playoffAttributes:o,stageSequence:s=1,exitProfile:l="0",exitProfileLimit:c,roundOffsetLimit:u,roundOffset:d=0,drawDefinition:p,staggeredEntry:h,sequenceLimit:f,stage:m=Ft,drawSize:g,idPrefix:v,isMock:y,uuids:b}=t;if(!(!o||!c||o!=null&&o[l])||g<2||f&&s>f)return{};let I=[],T=[],w=[],S=t.matchUpType??(p==null?void 0:p.matchUpType),D=e+1,E=e+g,C=`${D}-${E}`,P=o==null?void 0:o[l],R=n&&`${n} `||"",N=(o==null?void 0:o[C])??(r==null?void 0:r[C]),M=t.structureName||(N==null?void 0:N.name)||(P==null?void 0:P.name)&&(i?`${R}${P==null?void 0:P.name}`:P.name)||`${R}${C}`,A=(N==null?void 0:N.abbreviation)??(P==null?void 0:P.abbreviation),_=t.structureId??(P==null?void 0:P.structureId)??(b==null?void 0:b.pop()),x={idPrefix:v&&`${v}-${M}-RP`,finishingPositionOffset:e,matchUpType:S,drawSize:g,isMock:y,uuids:b},{matchUps:O}=h?pg(x):Tp(x),B=Ec({structureAbbreviation:A,stageSequence:s,structureName:M,matchUpType:S,roundOffset:d,structureId:_,matchUps:O,stage:m});I.push(...O),T.push(B);let F=Math.ceil(Math.log(g)/Math.log(2)),G=u?Math.min(u-d,F):!a||D<a?F:0;return g>2&&Ct(1,G+1).forEach($=>H($)),{structureId:B.structureId,matchUps:I,structureName:M,structures:T,links:w,...ue};function H($){let q=g/Math.pow(2,$);if(q<2)return;let z=g/Math.pow(2,$)+e;if(a&&z+1>a)return;let{structures:Z,structureId:Y,matchUps:Q,links:X}=G0({finishingPositionOffset:z,exitProfile:`${l}-${$}`,roundOffset:d+$,stageSequence:s+1,drawSize:q,addNameBaseToAttributeName:i,playoffStructureNameBase:n,finishingPositionNaming:r,finishingPositionLimit:a,playoffAttributes:o,exitProfileLimit:c,roundOffsetLimit:u,drawDefinition:p,sequenceLimit:f,matchUpType:S,idPrefix:v,uuids:b,stage:m});if(B.structureId&&Y){let oe={linkType:Eh,source:{roundNumber:$,structureId:B.structureId},target:{roundNumber:1,feedProfile:gu,structureId:Y}};X&&B&&X.push(oe),X!=null&&X.length&&w.push(...X)}return Z!=null&&Z.length&&T.push(...Z),Q!=null&&Q.length&&I.push(...Q),{structureId:Y,childLinks:X,structures:T}}}function K6({drawDefinition:t,matchUpsMap:e,structureId:i}){let n=pi({drawDefinition:t,structureId:i});if(n.error)return fe({result:n});let{matchUps:r}=Sn({structure:n.structure,matchUpsMap:e});return{...Rs({matchUps:r}),matchUps:r,matchUpsMap:e}}function YZ({finishingPositions:t,drawDefinition:e,structureId:i}){var n;let{roundProfile:r}=K6({drawDefinition:e,structureId:i});return(n=r&&Object.keys(r))==null?void 0:n.reduce((a,o)=>(pye(r==null?void 0:r[o]).forEach(s=>{t.forEach(l=>{Jqe({position:l,rangeDefinition:s})&&(a[l]={roundNumber:o})})}),a),{})}function Jqe({position:t,rangeDefinition:e}){if(!Array.isArray(e)||e.reduce((r,a)=>r||isNaN(a),!1))return!1;let[i,n]=e;return Ct(i,(n||i)+1).includes(t)}function pye(t){var e,i;return[ki(((e=t==null?void 0:t.finishingPositionRange)==null?void 0:e.loser)||[]),ki(((i=t==null?void 0:t.finishingPositionRange)==null?void 0:i.winner)||[])]}function Qqe(t){return pye(t).map(e=>Ct(e[0],e[1]&&e[1]+1||e[0]+1))}function EU({drawDefinition:t,structureIds:e,matchUpsMap:i}){if(e&&!Array.isArray(e))return{error:Me,context:{structureIds:e}};if(!t)return{error:Lt};e=e??(t.structures??[]).filter(a=>a.stage!==Xt).map(({structureId:a})=>a);let n=e.map(a=>{var o;let{roundProfile:s}=K6({drawDefinition:t,matchUpsMap:i,structureId:a});return(o=s&&Object.values(s))==null?void 0:o.map(Qqe).flat()}).flat(),r=n.filter(a=>(a==null?void 0:a.length)===1).sort(va).flat();return{positionsNotPlayedOff:ki(n.flat()).filter(a=>!r.includes(a)),positionsPlayedOff:r}}function hye({excludeRoundNumbers:t=[],playoffPositions:e=[],drawDefinition:i,structureId:n}){if(!i)return{error:Lt};if(!n)return{error:lc};if(!e)return{error:Ht,info:"missing playoffPositions"};let r=EU({drawDefinition:i});if(r.error)return r;let a=r.positionsPlayedOff,o=e.filter(v=>!a.includes(v)),s=YZ({finishingPositions:o,drawDefinition:i,structureId:n}),l=Object.values(s).reduce((v,y)=>v.includes(y.roundNumber)?v:v.concat(y.roundNumber),[]).map(v=>ai(v)).filter(v=>!t.includes(v)),c=YZ({finishingPositions:a,drawDefinition:i,structureId:n}),u=c?Object.values(c):[],d=c?u.reduce((v,y)=>v.includes(y.roundNumber)?v:v.concat(y.roundNumber),[]).map(v=>ai(v)):[],p=l.filter(v=>!d.includes(v)).sort(va),{roundProfile:h}=K6({drawDefinition:i,structureId:n}),f=p.map(v=>{let y=h==null?void 0:h[v].finishingPositionRange.loser,[b,I]=y??[0,0];return Ct(b,(I||b)+1)}).flat().sort(va),{playoffRoundsRanges:m}=e3e({playoffSourceRounds:p,roundProfile:h}),g=[...p,...d];return{playoffPositionsReturned:f,playedOffSourceRounds:d,playoffRoundsRanges:m,playoffSourceRounds:p,sourceRounds:g,roundProfile:h}}function e3e({playoffSourceRounds:t,roundProfile:e}){return{playoffRoundsRanges:t.map(i=>{let n=e[i].finishingPositionRange.loser,[r,a]=n,o=Ct(r,(a||r)+1);return{finishingPositionRange:n.join("-"),finishingPositions:o,roundNumber:i}})}}function TR({drawDefinition:t,structureId:e}){if(!t)return{error:Lt};let{matchUps:i,matchUpsMap:n}=Hs({inContext:!0,drawDefinition:t}),{positionsNotPlayedOff:r,positionsPlayedOff:a}=EU({drawDefinition:t,matchUpsMap:n}),{structures:o}=Rh({drawDefinition:t}),s=o.filter(c=>!e&&c.stage!==to||c.structureId===e),l={};for(let c of s){let u=c==null?void 0:c.structureId,d=t3e({playoffPositions:r,drawDefinition:t,structure:c,matchUps:i}),{error:p,...h}=d;if(p)return d;l[u]={structureId:u,...h}}return e?{positionsPlayedOff:a,...l[e]}:{availablePlayoffProfiles:Object.values(l),availablePlayoffRounds:Object.values(l),positionsPlayedOff:a}}function t3e({playoffPositions:t,drawDefinition:e,structure:i,matchUps:n}){var r,a,o,s,l,c,u,d,p;let h=i==null?void 0:i.structureId,{links:f}=wU({drawDefinition:e,structureId:h});if(i.structureType===xs||i.structures){let w=(a=(r=jn({structure:i}))==null?void 0:r.positionAssignments)==null?void 0:a.length,S=i.structures.length,D=(w??0)/S,E=((o=f.source)==null?void 0:o.flatMap(({source:B})=>(B==null?void 0:B.finishingPositions)||[]))||[],C=Ct(1,D+1).filter(B=>!E.includes(B)),P=((l=(s=n.find(B=>B.containerStructureId===h&&B.finishingPositionRange))==null?void 0:s.finishingPositionRange)==null?void 0:l.winner)||[0,1],R=f==null?void 0:f.source.map(({target:B})=>B.structureId),{positionsPlayedOff:N=[],positionsNotPlayedOff:M=[]}=EU({structureIds:R,drawDefinition:e}),A=[...N,...M],_=Ct(P[0],P[1]+1).filter(B=>!A.includes(B)),x=so(_,_.length/C.length),O=C.map((B,F)=>{let G=x[F],H=[Math.min(...G||[]),Math.max(...G||[])].join("-");return{finishingPosition:B,finishingPositions:G,finishingPositionRange:H}});return{positionsNotPlayedOff:_,playoffFinishingPositionRanges:O,finishingPositionsAvailable:C,finishingPositionsPlayedOff:E,positionsPlayedOff:N,groupCount:S,groupSize:D}}let m=((c=f==null?void 0:f.source)==null?void 0:c.filter(w=>w.linkCondition!==Ch).map(w=>{var S;return(S=w.source)==null?void 0:S.roundNumber}))||[],g=((u=f==null?void 0:f.source)==null?void 0:u.filter(w=>w.linkCondition===Ch).map(w=>{var S;return(S=w.source)==null?void 0:S.roundNumber}))||[],v=hye({excludeRoundNumbers:m,playoffPositions:t,drawDefinition:e,structureId:h}),y=v!=null&&v.playoffSourceRounds?[...(v==null?void 0:v.playoffSourceRounds)||[]]:void 0,b=[...(v==null?void 0:v.playoffRoundsRanges)||[]],{roundProfile:I,error:T}=v;for(let w of g){let S=f==null?void 0:f.source.find(R=>R.source.roundNumber===w),D=S==null?void 0:S.target.roundNumber,E=S==null?void 0:S.target.structureId,C=n.filter(({roundNumber:R,structureId:N})=>N===E&&R===D),P=C.filter(({sides:R})=>R.find(N=>N.participantFed&&!N.participantId)).length;if(y&&P===C.length){y.push(w);let R=(p=(d=I==null?void 0:I[w])==null?void 0:d.finishingPositionRange)==null?void 0:p.loser;if(R){let N=Math.min(...R),M=N+P,A=Ct(N,M),_={finishingPositionRange:[N,M-1].join("-"),finishingPositions:A,roundNumber:w};b.push(_)}}}return y&&y.sort(va),b.sort((w,S)=>w.roundNumber-S.roundNumber),{playoffRounds:y,playoffRoundsRanges:b,error:T}}function i3e({playoffGroups:t,drawDefinition:e,structureId:i}){var n,r;if(!e)return{error:Lt};if(typeof i!="string"||!Array.isArray(t))return{error:Me};let a=t.map(({finishingPositions:o})=>o).flat();return{positionRangeMap:(r=(n=TR({drawDefinition:e,structureId:i}).playoffFinishingPositionRanges)==null?void 0:n.filter(o=>a.includes(o.finishingPosition)))==null?void 0:r.reduce((o,s)=>(o[s.finishingPosition]=s,o),{})}}function fye(t){var e,i;let{finishingPositionOffset:n=0,playoffAttributes:r,stageSequence:a=1,staggeredEntry:o,structureName:s,stage:l=Ft,matchUpType:c,structureId:u,idPrefix:d,drawSize:p,isMock:h,uuids:f}=t,m={finishingPositionOffset:n,matchUpType:c,drawSize:p,idPrefix:d,isMock:h,uuids:f},{matchUps:g}=o?pg(m):Tp(m),v=Ec({structureName:s||((e=r==null?void 0:r[0])==null?void 0:e.name)||Co(Ft),structureId:u||(f==null?void 0:f.pop()),stageSequence:a,matchUpType:c,matchUps:g,stage:l}),y=[v],b=[];if(p>2){let I=p/2,{matchUps:T}=Tp({finishingPositionOffset:n+I,idPrefix:d&&`${d}-c`,drawSize:I,matchUpType:c,isMock:h}),w=Co(Mo),S=((i=r==null?void 0:r["0-1"])==null?void 0:i.name)??t.consolationStructureName??(s?`${s} ${w}`:w),D=Ec({structureName:S,matchUps:T,structureId:f==null?void 0:f.pop(),stage:Mo,stageSequence:1,matchUpType:c});y.push(D);let E={linkType:Eh,source:{roundNumber:1,structureId:v.structureId},target:{roundNumber:1,feedProfile:gu,structureId:D.structureId}};b.push(E)}return{...ue,structures:y,links:b}}function mye({consolationStructure:t,roundOffset:e=0,mainStructure:i,roundsCount:n,feedPolicy:r,fmlc:a}){let o=t.matchUps.reduce((c,u)=>(u.drawPositions||[]).filter(Boolean).length&&!c.includes(u.roundNumber)?c.concat(u.roundNumber):c,[]),s=(r==null?void 0:r.roundGroupedOrder)||[],l=r==null?void 0:r.roundFeedProfiles;return Ct(1+e,n+1+e).map(c=>{let u=l&&l[c-1]?l[c-1]:c%2?gu:iy,d=c-e<=2?c-e:(c-e-2)*2+2,p={linkType:Eh,source:{roundNumber:c,structureId:i.structureId},target:{feedProfile:u,roundNumber:d,structureId:t.structureId}},h=s[c-1];return h&&(p.target.groupedOrder=h),jc()&&(p.source.structureName=i.structureName,p.target.structureName=t.structureName),c===2&&a&&(p.linkCondition=Ch,p.target.feedProfile=gu),o.includes(d)?p:void 0}).filter(Boolean)}function gye(t){var e,i;let{playoffStructureNameBase:n,finishingPositionOffset:r,stageSequence:a=1,playoffAttributes:o,structureNameMap:s,staggeredEntry:l,stage:c=Ft,matchUpType:u,structureId:d,drawSize:p,idPrefix:h,isMock:f,uuids:m}=t,g={finishingPositionOffset:r,matchUpType:u,drawSize:p,idPrefix:h,isMock:f,uuids:m},{matchUps:v,roundsCount:y}=l?pg(g):Tp(g),b=t.structureName??((e=o==null?void 0:o[0])==null?void 0:e.name)??Co(Ft),I=jm({structureId:d||(m==null?void 0:m.pop()),structureName:b,stageSequence:a,matchUpType:u,matchUps:v,stage:c}),T=[I],w=[];if(p>2){let S=[0,2].slice(0,p/16).map((D,E)=>{let C=E+1,{consolationStructure:P}=n3e({idPrefix:h&&`${h}-c${E}`,structureId:m==null?void 0:m.pop(),playoffStructureNameBase:n,playoffAttributes:o,structureNameMap:s,stageSequence:C,roundOffset:D,matchUpType:u,drawSize:p,isMock:f,index:E,uuids:m});T.push(P);let R=mye({consolationStructure:P,roundsCount:2,mainStructure:I,roundOffset:D});return{consolationStructure:P,links:R}}).map(D=>D.links).flat();if(w.push(...S),p>=4&&p<=16||p>32){let{matchUps:D}=Tp({idPrefix:h&&`${h}-p3t4`,finishingPositionOffset:2,drawSize:2,matchUpType:u,isMock:f}),E=((i=o==null?void 0:o["3-4"])==null?void 0:i.name)??Co(Br),C=(s==null?void 0:s[E])||E,P=n?`${n} ${C}`:C,R=jm({structureId:m==null?void 0:m.pop(),matchUps:D,stageSequence:2,stage:Br,structureName:P,matchUpType:u}),N={linkType:Eh,source:{roundNumber:y-1,structureId:I.structureId},target:{structureId:R.structureId,feedProfile:gu,roundNumber:1}};T.push(R),w.push(N)}}return{structures:T,links:w,...ue}}function n3e({playoffStructureNameBase:t,stageSequence:e=1,playoffAttributes:i,structureNameMap:n,roundOffset:r=0,matchUpType:a,structureId:o,idPrefix:s,drawSize:l,isMock:c,index:u,uuids:d}){var p,h;let f=l/(2*Math.pow(2,r)),{matchUps:m,roundsCount:g}=pg({finishingPositionOffset:f,baseDrawSize:f,isConsolation:!0,feedRounds:1,matchUpType:a,idPrefix:s,isMock:c,uuids:d}),v=u===0&&((p=i==null?void 0:i["0-1"])==null?void 0:p.name)||u===1&&((h=i==null?void 0:i["0-3"])==null?void 0:h.name)||`${Co(Mo)} ${u+1}`,y=(n==null?void 0:n[v])||v,b=t?`${t} ${y}`:y;return{consolationStructure:jm({matchUps:m,stage:Mo,structureName:b,stageSequence:e,matchUpType:a,structureId:o}),consolationRoundsCount:g}}function sb(t){var e,i,n,r;let{finishingPositionOffset:a,stageSequence:o=1,playoffAttributes:s,feedsFromFinal:l,staggeredEntry:c,structureName:u,stage:d=Ft,structureId:p,matchUpType:h,skipRounds:f,feedRounds:m,idPrefix:g,drawSize:v,isMock:y,uuids:b,fmlc:I}=t,T=t.feedPolicy||((e=t.policyDefinitions)==null?void 0:e[xS])||((i=t.appliedPolicies)==null?void 0:i[xS]),w={finishingPositionOffset:a,matchUpType:h,skipRounds:f,drawSize:v,idPrefix:g,isMock:y,uuids:b},{matchUps:S}=c?pg(w):Tp(w),D=Ec({structureName:u||((n=s==null?void 0:s[0])==null?void 0:n.name)||Co(Ft),structureId:p||(b==null?void 0:b.pop()),stageSequence:o,matchUpType:h,matchUps:S,stage:d}),E=[D],C=[],P=v/2,{matchUps:R,roundsCount:N}=pg({finishingPositionOffset:P,idPrefix:g&&`${g}-c`,isConsolation:!0,feedsFromFinal:l,baseDrawSize:P,matchUpType:h,feedRounds:m,skipRounds:f,isMock:y,uuids:b,fmlc:I});if(v>2){let M=((r=s==null?void 0:s["0-1"])==null?void 0:r.name)??Co(Mo),A=t.playoffStructureNameBase?`${t.playoffStructureNameBase} ${M}`:M,_=Ec({matchUps:R,structureId:b==null?void 0:b.pop(),stage:Mo,stageSequence:1,structureName:A,matchUpType:h});E.push(_);let x=mye({consolationStructure:_,mainStructure:D,roundsCount:N,feedPolicy:T,fmlc:I});C.push(...x)}return{...ue,structures:E,links:C}}function vye({requireSequential:t=!0,playoffMatchUpFormat:e,playoffAttributes:i,sourceStructureId:n,policyDefinitions:r,stageSequence:a,drawDefinition:o,playoffGroups:s,matchUpType:l,feedPolicy:c,groupCount:u,idPrefix:d,isMock:p,uuids:h}){var f,m,g,v,y,b;c=c||(r==null?void 0:r[xS]);let I="processPlayoffGroups",T=0,w=[],S=[],D=[],{error:E,positionRangeMap:C}=i3e({structureId:n,drawDefinition:o,playoffGroups:s});if(E)return fe({result:{error:E},stack:I});if(!(!C||s!=null&&s.every(P=>{let{finishingPositions:R=[]}=P;if(!R.length)return!1;let N=[...R].sort(va).map((M,A)=>(R[A+1]||M)-M).every(M=>M<2);return(!t||N)&&R.every(M=>C[M])})))return fe({context:{validFinishingPositions:Object.values(C)},result:{error:Me},stack:I});for(let P of s){let R=P.finishingPositions,N=C&&R.map(G=>{var H;return(H=C[G])==null?void 0:H.finishingPositions}).flat(),M=u*R.length,A=lU(M),_=A===2&&rp||P.drawType||rp;N&&(T=Math.min(...N)-1);let x=N&&`${Math.min(...N)}-${Math.max(...N)}`,O=P.structureName||x&&((m=(f=P.playoffAttributes)==null?void 0:f[x])==null?void 0:m.name)||((v=(g=P.playoffAttributes)==null?void 0:g[0])==null?void 0:v.name),B={addNameBaseToAttributeName:P.addNameBaseToAttributeName,playoffStructureNameBase:P.playoffStructureNameBase,finishingPositionNaming:P.finishingPositionNaming,finishingPositionLimit:P.finishingPositionLimit,structureId:P.structureId??(h==null?void 0:h.pop()),playoffAttributes:P.playoffAttributes,structureNameMap:P.structureNameMap,sequenceLimit:P.sequenceLimit,structureName:O,idPrefix:d&&`${d}-po`,appliedPolicies:r,finishingPositionOffset:T,stage:Br,stageSequence:a,matchUpType:l,drawSize:A,isMock:p,uuids:h},F=({playoffStructures:G,playoffLinks:H})=>{let[$]=G,q=EM({playoffStructureId:$.structureId,finishingPositions:R,sourceStructureId:n});D.push(q),D.push(...H),S.push(...G),w.push({structureId:$.structureId,finishingPositions:R}),T+=M};if(_===rp){let{matchUps:G}=Tp({finishingPositionLimit:T+M,idPrefix:d&&`${d}-po`,finishingPositionOffset:T,matchUpType:l,drawSize:A,isMock:p,uuids:h}),H=Ec({structureId:P.structureId??(h==null?void 0:h.pop()),matchUpFormat:e,stage:Br,structureName:O,stageSequence:a,matchUps:G});S.push(H);let $=EM({playoffStructureId:H.structureId,finishingPositions:R,sourceStructureId:n});D.push($),T+=M,w.push({structureId:H.structureId,finishingPositions:R})}else if([FS,BS,Br].includes(_)){let G={playoffAttributes:P.playoffAttributes??i,playoffStructureNameBase:P.playoffStructureNameBase,structureId:P.structureId??(h==null?void 0:h.pop()),structureName:P.structureName,idPrefix:d&&`${d}-po`,addNameBaseToAttributeName:!0,finishingPositionOffset:T,stage:Br,roundOffset:0,stageSequence:a,drawSize:A,isMock:p,uuids:h};_===FS?Object.assign(G,{playoffAttributes:(P==null?void 0:P.playoffAttributes)??i??z5,roundOffsetLimit:3}):_===BS&&Object.assign(G,{playoffAttributes:(P==null?void 0:P.playoffAttributes)??i??q5,roundOffsetLimit:2});let H=G0(G);if(H.error)return H;if((y=H.links)!=null&&y.length&&D.push(...H.links),(b=H.structures)!=null&&b.length&&S.push(...H.structures),S.sort(cw),H.structureId){let $=EM({playoffStructureId:H.structureId,finishingPositions:R,sourceStructureId:n});D.push($),w.push({structureId:H.structureId,finishingPositions:R})}T+=M}else if([$S,KP,vE,gE,mE,yE].includes(_)){let G=[h==null?void 0:h.pop(),h==null?void 0:h.pop()],H={playoffStructureNameBase:P.playoffStructureNameBase,structureId:P.structureId??(h==null?void 0:h.pop()),playoffAttributes:P.playoffAttributes,idPrefix:d&&`${d}-po`,finishingPositionOffset:T,uuids:G,stage:Br,structureName:O,matchUpType:l,feedPolicy:c,drawSize:A,isMock:p},$={[$S]:{fmlc:!0,feedRounds:1},[yE]:{feedRounds:1},[vE]:{feedsFromFinal:3},[gE]:{feedsFromFinal:2},[mE]:{feedsFromFinal:1}};Object.assign(H,$[_]||{});let{structures:q,links:z}=sb(H),[Z]=q,Y=EM({playoffStructureId:Z.structureId,finishingPositions:R,sourceStructureId:n});D.push(Y),D.push(...z),S.push(...q),w.push({structureId:Z.structureId,finishingPositions:R}),T+=M}else if([ku].includes(_)){let{structures:G,links:H}=vR({...B,structureOptions:P.structureOptions||{groupSize:4}});F({playoffStructures:G,playoffLinks:H})}else if([WP].includes(_)){let{structures:G,links:H}=fye(B);F({playoffStructures:G,playoffLinks:H})}else if([fHe].includes(_)){let{structures:G,links:H}=gye(B);F({playoffStructures:G,playoffLinks:H})}else if([_u].includes(_)){let G=Ec({structureId:P.structureId??(h==null?void 0:h.pop()),structureName:P.structureName,finishingPosition:VN,stage:Br,stageSequence:a,matchUps:[]});F({playoffStructures:[G],playoffLinks:[]})}}return{finishingPositionTargets:w,positionRangeMap:C,structures:S,links:D}}function EM({playoffStructureId:t,finishingPositions:e,sourceStructureId:i}){return{linkType:Ff,source:{structureId:i,finishingPositions:e},target:{structureId:t,feedProfile:rd,roundNumber:1}}}function UR({matchUp:t,tieFormat:e,isMock:i,uuids:n}){let{collectionDefinitions:r}=e??{};return{tieMatchUps:(r??[]).map(a=>DR({matchUp:t,collectionDefinition:a,uuids:n,isMock:i})).filter(Boolean).flat()}}function DR({collectionPositionOffset:t=0,collectionDefinition:e,matchUpsLimit:i,matchUp:n,isMock:r,uuids:a}){let{matchUpCount:o,matchUpType:s,collectionId:l,processCodes:c}=e||{},u=i??o??0,d=p=>{if(!r&&!(n!=null&&n.isMock))return(a==null?void 0:a.pop())??xn();let h=e==null?void 0:e.collectionId;return(a==null?void 0:a.pop())??`${n==null?void 0:n.matchUpId}-${h}-TMU-${p+1}`};return Ct(0,u).map(p=>{let h=t+p+1;return{sides:[{sideNumber:1},{sideNumber:2}],matchUpId:d(p),matchUpStatus:Kr,collectionPosition:h,collectionId:l,processCodes:c,matchUpType:s,isMock:r}})}function r3e(t){var e,i,n;let r="generateAndPopulateRRplayoffStructures";if(!t.playoffGroups)return fe({result:{error:Ht},info:"playoffGroups required",stack:r});let{sourceStructureId:a,requireSequential:o,tournamentRecord:s,drawDefinition:l,playoffGroups:c,groupCount:u,groupSize:d,event:p}=t,{structures:h=[],links:f=[],finishingPositionTargets:m,positionRangeMap:g,error:v}=vye({requireSequential:o,sourceStructureId:a,playoffGroups:c,groupCount:u,groupSize:d,...t});if(v)return{error:v};let y=m==null?void 0:m.map(({finishingPositions:P})=>P).flat().map(P=>g[P].finishingPositions).flat();l.structures.push(...h),l.links.push(...f);let{matchUps:b,matchUpsMap:I}=wa({inContext:!0,drawDefinition:l}),T=h.map(({structureId:P})=>P),w=b==null?void 0:b.filter(({structureId:P})=>T.includes(P)).map(Va),S=(e=I==null?void 0:I.drawMatchUps)==null?void 0:e.filter(({matchUpId:P})=>w==null?void 0:w.includes(P));if(S!=null&&S.length){let P=(i=ns({drawDefinition:l,event:p}))==null?void 0:i.tieFormat;P&&S.forEach(R=>{let{tieMatchUps:N}=UR({isMock:t.isMock,tieFormat:P,matchUp:R});Object.assign(R,{tieMatchUps:N,matchUpType:Ip})})}let{positionAssignments:D}=jn({structureId:a,drawDefinition:l}),E={};D==null||D.forEach(P=>{var R,N,M;let A=(M=(N=(R=Bi({element:P,name:og}))==null?void 0:R.extension)==null?void 0:N.value)==null?void 0:M.groupOrder;A&&(E[A]||(E[A]=[]),E[A].push(P.participantId))});let C=wR({provisionalPositioning:t.provisionalPositioning,structureId:a,applyPositioning:!0,event:t.event,tournamentRecord:s,drawDefinition:l});return C.error&&((n=C.error)==null?void 0:n.code)!==$4.code?fe({result:C,stack:r}):{structures:h,links:f,positionsPlayedOff:y,drawDefinition:l,...ue}}var Cc="SET3-S:6/TB7",a3e="SET3-S:6NOAD",yye="SET3-S:6/TB7-F:TB10",o3e="SET3-S:4/TB7",s3e="SET3-S:4/TB5@3",l3e="SET1-S:T20",c3e="SET1-S:8/TB7",u3e="SET1-S:8/TB7@7",d3e={FORMAT_STANDARD:Cc,FORMAT_STANDARD_NOAD:a3e,FORMAT_ATP_DOUBLES:yye,FORMAT_SHORT_SETS:o3e,FORMAT_FAST4:s3e,FORMAT_PRO_SET:c3e,FORMAT_COLLEGE_PRO_SET:u3e,TIMED20:l3e};function Y6({winningSide:t,matchUpFormat:e=Cc,matchUpStatus:i,tallyPolicy:n,score:r}){let a=[0,0],o=r==null?void 0:r.sets,s=typeof t=="number"&&t-1,l=Zs(e),c=Z6((l==null?void 0:l.bestOf)??1);if(typeof s=="number"&&(i===fn&&n!=null&&n.setsCreditForDefaults||i===Rn&&n!=null&&n.setsCreditForWalkovers))a[s]=c;else for(let u of o||[]){let{winningSide:d}=u;d&&(a[d-1]+=1)}return typeof s=="number"&&i===os&&(+a[1-s]===c&&(a[1-s]-=1),n!=null&&n.setsCreditForRetirements&&(a[s]=c)),a}function bye({matchUpFormat:t=Cc,winningSide:e,matchUpStatus:i,tallyPolicy:n,score:r}){var a,o;let{sets:s}=r||{};if(!s)return[0,0];let l=typeof e=="number"&&e-1,c=Zs(t),u=(c==null?void 0:c.bestOf)??1,d=Z6(u),p=((a=c==null?void 0:c.setFormat)==null?void 0:a.tiebreakAt)||0,h=[[],[]];if(typeof l=="number"&&(i===fn&&n!=null&&n.gamesCreditForDefaults||i===Rn&&n!=null&&n.gamesCreditForWalkovers)){let f=((o=c==null?void 0:c.setFormat)==null?void 0:o.setTo)||0,m=d*f;h[l].push(m)}else s.forEach((f,m)=>{var g;let v=(f.setNumber||m+1)>d&&c!=null&&c.finalSetFormat?"finalSetFormat":"setFormat",y=(g=c==null?void 0:c[v])==null?void 0:g.based,b=c==null?void 0:c[v].tiebreakSet,{side1Score:I,side2Score:T}=f;ZZ(y)&&(h[0].push(ai(I||0)),h[1].push(ai(T||0))),b&&f.winningSide&&(n==null?void 0:n.gamesCreditForTiebreakSets)!==!1&&h[f.winningSide-1].push(1)});if(i===os&&typeof l=="number"){let f=s.length>d&&c!=null&&c.finalSetFormat?"finalSetFormat":"setFormat",m=c==null?void 0:c[f];if(ZZ(m.based)){let g=(m==null?void 0:m.setTo)||0,v=b=>{if(!(!c||b===""))return+b===p-1||+b===p?ai(p||0)+1:+b<p?g:p},y=Y6({winningSide:e,score:{sets:s},matchUpStatus:i,matchUpFormat:t,tallyPolicy:n});if(h.map(b=>b[l]<=b[1-l]).reduce((b,I)=>b+(I?1:0),0)>y[1-l]){let b=h[l].length,I=v(h[1-l][b-1]);I&&(h[l][b-1]=I)}d>h[l].length&&n!=null&&n.gamesCreditForRetirements&&h[l].push(g)}}return[h[0].reduce((f,m)=>f+m,0),h[1].reduce((f,m)=>f+m,0)]}function Iye({matchUpFormat:t,score:e}){var i;let n=t?Zs(t):void 0,r=(n==null?void 0:n.bestOf)??1,a=Z6(r),o=[0,0],s=[0,0];return(i=e==null?void 0:e.sets)==null||i.forEach((l,c)=>{var u;let d=(l.setNumber||c+1)>a&&n!=null&&n.finalSetFormat?"finalSetFormat":"setFormat",p=(u=n==null?void 0:n[d])==null?void 0:u.based;if(wye(p)){let{side1Score:h,side2Score:f}=l;h&&(s[0]+=ai(h||0)),f&&(s[1]+=ai(f||0))}else l.side1TiebreakScore&&(s[0]+=ai(l.side1TiebreakScore||0)),l.side2TiebreakScore&&(s[1]+=ai(l.side2TiebreakScore||0)),(l.side1TiebreakScore||l.side2TiebreakScore)&&l.winningSide&&(o[l.winningSide-1]+=1)}),{pointsTally:s,tiebreaksTally:o}}function Z6(t){return t&&Math.ceil(t/2)||1}function wye(t){return t==="P"}function ZZ(t){return!wye(t)}function p3e({participantResults:t,matchUpFormat:e,tallyPolicy:i,perPlayer:n,totalSets:r}){var a;let o=e&&Zs(e)||{},s=o.bestOf,l=s&&Math.ceil(s/2)||1,c=(a=o.setFormat)==null?void 0:a.setTo;Object.keys(t).forEach(u=>{let d=t[u].setsWon,p=t[u].setsLost,h=i!=null&&i.groupTotalSetsPlayed?r:n*(l||0)||d+p,f=Math.round(d/h*1e3)/1e3;(f===1/0||isNaN(f))&&(f=h);let m=t[u].tieMatchUpsWon,g=t[u].tieMatchUpsLost,v=m+g,y=Math.round(m/v*1e3)/1e3;(y===1/0||isNaN(y))&&(y=m);let b=t[u].matchUpsWon,I=t[u].matchUpsLost,T=b+I,w=Math.round(b/T*1e3)/1e3;(w===1/0||isNaN(w))&&(w=b);let S=t[u].gamesWon||0,D=t[u].gamesLost||0,E=(n||0)*(l||0)*(c||0),C=Math.max(E,S+D),P=Math.round(S/C*1e3)/1e3;(P===1/0||isNaN(P))&&(P=0);let R=Math.round(t[u].pointsWon/t[u].pointsLost*1e3)/1e3;(R===1/0||isNaN(R))&&(R=0),t[u].setsWon=d,t[u].setsLost=p,t[u].setsPct=f,t[u].tieMatchUpsWon=m,t[u].tieMatchUpsPct=y,t[u].matchUpsPct=w,t[u].gamesWon=S,t[u].gamesLost=D,t[u].gamesPct=P,t[u].pointsPct=R,t[u].result=`${t[u].matchUpsWon}/${t[u].matchUpsLost}`})}function ER({participantIds:t,matchUpFormat:e,tallyPolicy:i,perPlayer:n,matchUps:r}){var a,o,s,l,c,u,d;let p={},h=(i==null?void 0:i.excludeMatchUpStatuses)||[],f=r==null?void 0:r.filter(g=>(g.tieMatchUps||!h.includes(g.matchUpStatus))&&(!(t!=null&&t.length)||Wr(t,[N0(g,0),N0(g,1)]).length===2)),m=(a=f==null?void 0:f.flatMap(({score:g,tieMatchUps:v})=>{var y;return v?v.filter(({matchUpStatus:b})=>!h.includes(b)).flatMap(({score:b})=>{var I;return((I=b==null?void 0:b.sets)==null?void 0:I.length)??0}):((y=g==null?void 0:g.sets)==null?void 0:y.length)??0}))==null?void 0:a.reduce((g,v)=>g+v,0);for(let g of f??[]){let{matchUpStatus:v,tieMatchUps:y,tieFormat:b,score:I,winningSide:T,sides:w}=g,S=b&&g._disableAutoCalc&&b.collectionDefinitions.every(({scoreValue:C})=>C),D=T&&h3e(g),E=T&&f3e(g);if(!D&&!E)if(v&&Ga.includes(v)){let C=N0(g,0),P=N0(g,1);C&&(Mm(p,C),p[C].matchUpsCancelled+=1),P&&(Mm(p,P),p[P].matchUpsCancelled+=1)}else if(y!=null&&y.length){n=0;for(let C of y){if(C.winningSide){let P=(o=w==null?void 0:w.find(({sideNumber:N})=>N===C.winningSide))==null?void 0:o.participantId,R=(s=w==null?void 0:w.find(({sideNumber:N})=>N===C.winningSide))==null?void 0:s.participantId;P&&R&&(Mm(p,P),Mm(p,R),p[P].tieMatchUpsWon+=1,p[R].tieMatchUpsLost+=1,Hr(Mr)(C.matchUpType)?(p[P].tieSinglesWon+=1,p[R].tieSinglesLost+=1):Hr(Zn)(C.matchUpType)&&(p[P].tieDoublesWon+=1,p[R].tieDoublesLost+=1))}XZ({score:C.score,manualGamesOverride:S,participantResults:p,sides:w})}}else XZ({manualGamesOverride:S,participantResults:p,score:I,sides:w});else if(Mm(p,D),Mm(p,E),y==null?void 0:y.length){n=0;for(let C of y){let{matchUpType:P}=C,R=Hr(Zn)(P),N=Hr(Mr)(P);C.winningSide&&(C.winningSide===T?(D&&(p[D].tieMatchUpsWon+=1,N&&(p[D].tieSinglesWon+=1),R&&(p[D].tieDoublesWon+=1)),E&&(p[E].tieMatchUpsLost+=1,N&&(p[E].tieSinglesLost+=1),R&&(p[E].tieDoublesLost+=1))):C.winningSide!==T&&(E&&(p[E].tieMatchUpsWon+=1,N&&(p[E].tieSinglesWon+=1),R&&(p[E].tieDoublesWon+=1)),D&&(p[D].tieMatchUpsLost+=1,N&&(p[D].tieSinglesLost+=1),R&&(p[D].tieDoublesLost+=1)))),JZ({matchUpFormat:C.matchUpFormat,matchUpStatus:C.matchUpStatus,score:C.score,winningParticipantId:D,losingParticipantId:E,participantResults:p,isTieMatchUp:!0,manualGamesOverride:S,tallyPolicy:i,winningSide:T})}Sye({winningParticipantId:D,losingParticipantId:E,participantResults:p,matchUpStatus:v})}else JZ({matchUpFormat:g.matchUpFormat??e,isTieMatchUp:void 0,winningParticipantId:D,manualGamesOverride:S,losingParticipantId:E,participantResults:p,matchUpStatus:v,tallyPolicy:i,winningSide:T,score:I});if(S){let C=(l=w==null?void 0:w.find(({sideNumber:M})=>M===1))==null?void 0:l.participantId,P=(c=w==null?void 0:w.find(({sideNumber:M})=>M===2))==null?void 0:c.participantId;Mm(p,C),Mm(p,P);let R=(u=I==null?void 0:I.sets)==null?void 0:u.reduce((M,A)=>M+((A==null?void 0:A.side1Score)??0),0),N=(d=I==null?void 0:I.sets)==null?void 0:d.reduce((M,A)=>M+(A.side2Score??0),0);C&&(p[C].gamesWon+=R,p[C].gamesLost+=N),P&&(p[P].gamesWon+=N,p[P].gamesLost+=R)}}return p3e({participantResults:p,matchUpFormat:e,tallyPolicy:i,perPlayer:n,totalSets:m}),{participantResults:p}}function h3e(t){let e=t.winningSide-1;return N0(t,e)}function f3e(t){let e=1-(t.winningSide-1);return N0(t,e)}function N0(t,e){if(!(t!=null&&t.sides))return console.log("no sides:",{matchUp:t}),"foo";let i=t.sides[e];return i?i.participantId:(console.log("No Side",{matchUp:t,index:e}),"foo")}function Mm(t,e){e&&!t[e]&&(t[e]={allDefaults:0,defaults:0,defeats:[],gamesLost:0,gamesWon:0,matchUpsCancelled:0,matchUpsLost:0,matchUpsWon:0,pointsLost:0,pointsWon:0,retirements:0,setsLost:0,setsWon:0,tieSinglesWon:0,tieSinglesLost:0,tieDoublesWon:0,tieDoublesLost:0,tieMatchUpsLost:0,tieMatchUpsWon:0,victories:[],walkovers:0})}function XZ({manualGamesOverride:t,participantResults:e,score:i,sides:n}){let{sets:r}=i||{},a=[[],[]],o=[0,0];for(let l of r||[]){let{winningSide:c,side1Score:u,side2Score:d}=l;c&&(o[c-1]+=1),a[0].push(ai(u||0)),a[1].push(ai(d||0))}let s=[a[0].reduce((l,c)=>l+c,0),a[1].reduce((l,c)=>l+c,0)];n.forEach((l,c)=>{let{participantId:u}=l;u&&(Mm(e,u),e[u].setsWon+=o[c],e[u].setsLost+=o[1-c],t||(e[u].gamesWon+=s[c],e[u].gamesLost+=s[1-c]))})}function JZ({winningParticipantId:t,losingParticipantId:e,participantResults:i,manualGamesOverride:n,matchUpFormat:r,matchUpStatus:a,isTieMatchUp:o,tallyPolicy:s,winningSide:l,score:c}){let u=l&&l-1,d=1-u;o||Sye({winningParticipantId:t,losingParticipantId:e,participantResults:i,matchUpStatus:a});let p=Y6({matchUpStatus:a,matchUpFormat:r,tallyPolicy:s,winningSide:l,score:c}),h=bye({matchUpStatus:a,matchUpFormat:r,tallyPolicy:s,winningSide:l,score:c}),{pointsTally:f}=Iye({score:c,matchUpFormat:r});t&&(i[t].setsWon+=p[u],i[t].setsLost+=p[d],n||(i[t].gamesWon+=h[u],i[t].gamesLost+=h[d]),i[t].pointsWon+=f[u],i[t].pointsLost+=f[d]),e&&(i[e].setsWon+=p[d],i[e].setsLost+=p[u],n||(i[e].gamesWon+=h[d],i[e].gamesLost+=h[u]),i[e].pointsWon+=f[d],i[e].pointsLost+=f[u])}function Sye({winningParticipantId:t,losingParticipantId:e,participantResults:i,matchUpStatus:n}){e&&(n===Rn&&(i[e].walkovers+=1),n===fn&&(i[e].defaults+=1),n===os&&(i[e].retirements+=1),[fn,os,Rn].includes(n)&&(i[e].allDefaults+=1),i[e].matchUpsLost+=1),t&&(i[t].matchUpsWon+=1),e&&t&&(i[e].defeats.push(t),i[t].victories.push(e))}function m3e({matchUps:t,order:e,report:i}){let n={};t.forEach(({sides:a})=>{a.forEach(o=>{o.participantId&&o.participant&&(n[o.participantId]=o.participant.participantName)})});let r=[];return Array.isArray(i)&&i.forEach((a,o)=>{var s,l;if((s=a.excludedDirectives)!=null&&s.length){let c=a.excludedDirectives.map(({attribute:p})=>p).join(", "),u=`${c.length} directives were excluded due to participants limit}`;r.push(u);let d=`Excluded: ${c}`;r.push(d)}else{let c=(m,g)=>parseFloat(a.reversed?m:g)-parseFloat(a.reversed?g:m),u=a.groups?Object.values(a.groups).flat(1/0).length:((l=a.participantIds)==null?void 0:l.length)??0,d=m=>{m.groups&&Object.keys(m.groups).sort(c).forEach(g=>{let v=m.groups[g].map(b=>n[b]).join(", "),y=`${g} ${m.attribute}: ${v}`;r.push(y)})},p=a.reversed?" in reverse order":"",h=a.groups?"grouped":"separated",f=`Step ${o+1}: ${u} particiants were ${h}${p} by ${a.attribute}`;if(r.push(f),a.idsFilter){let m=`${a.attribute} was calculated considering ONLY TIED PARTICIPANTS`;r.push(m)}d(a)}r.push("----------------------")}),r.push("Final Order:"),e.forEach(a=>{let{participantId:o,resolved:s}=a,l=a.groupOrder||a.provisionalOrder;r.push(`${l}: ${n[o]} => resolved: ${!!s}`)}),r.join(`\r
`)}function Tye({participantResults:t,participantIds:e,attribute:i}){return Uye({participantResults:t,participantIds:e}).reduce((n,r)=>{let{participantId:a,results:o}=r,s=o==null?void 0:o[i];return!isNaN(s)&&a&&(n[s]?n[s].push(a):n[s]=[a]),n},{})}function Uye(t){return(t.participantIds||Object.keys(t.participantResults)).reduce((e,i,n)=>(e.push({participantId:i,i:n,results:t.participantResults[i]}),e),[])}var g3e=[{attribute:"matchUpsPct",idsFilter:!1},{attribute:"allDefaults",reversed:!0,idsFilter:!1},{attribute:"defaults",reversed:!0,idsFilter:!1},{attribute:"walkovers",reversed:!0,idsFilter:!1},{attribute:"retirements",reversed:!0,idsFilter:!1},{attribute:"setsPct",idsFilter:!1},{attribute:"gamesPct",idsFilter:!1},{attribute:"pointsPct",idsFilter:!1},{attribute:"matchUpsPct",idsFilter:!0},{attribute:"setsPct",idsFilter:!0},{attribute:"gamesPct",idsFilter:!0},{attribute:"pointsPct",idsFilter:!0}],u$={matchUpsPct:20,tieMatchUpsPct:16,setsPct:12,gamesPct:8,pointsPct:4};function QZ(t){let{requireCompletion:e=!0,participantResults:i,subOrderMap:n,tallyPolicy:r}=t,a=[];if(e&&!v3e(t))return{};let o=["tieMatchUpsWon","tieSinglesWon","tieDoublesWon","matchUpsWon","pointsWon","gamesWon","setsWon","gamesPct","setsPct","pointsPct","matchUpsPct"].includes(r==null?void 0:r.groupOrderKey)?r.groupOrderKey:"matchUpsWon",s=Tye({participantResults:i,attribute:o});a.push({attribute:o,groups:s});let l=Object.keys(s).map(f=>parseFloat(f)).sort((f,m)=>m-f).map(f=>s[f]).map(f=>{let m=Dye({participantIds:f,...t});return a.push(...m.report??[]),m.order}).flat(1/0),c=1,u;l.forEach((f,m)=>{m&&(f.resolved||u&&!f.resolved)&&(c+=1),u=f.resolved,f.resolved?(f.position=m+1,c=f.position):f.position=c});let d=l.map(({position:f})=>f),p=xl(d);return l.forEach(f=>{let{participantId:m,position:g}=f||{},v=i[m];f.GEMscore=h(v);let y=p[g];(f==null?void 0:f.position)!==void 0&&(y>1&&(f.ties=y,n&&(f.subOrder=n[m])),f.rankOrder=g,f.groupOrder=g+(f.subOrder||1)-1)}),{groupOrder:l,report:a.flat(1/0).filter(Boolean)};function h(f){return(Array.isArray(r==null?void 0:r.GEMscore)?Object.keys(u$).filter(m=>r.GEMscore.includes(m)):Object.keys(u$)).map(m=>(f[m]||0)*Math.pow(10,u$[m].toFixed(3))).reduce((m,g)=>m+g,0)}}function v3e({participantResults:t,participantsCount:e}){let i=Uye({participantResults:t}).filter(n=>e-1===n.results.matchUpsWon+n.results.matchUpsLost+n.results.matchUpsCancelled);return e===i.length}function y3e({disableHeadToHead:t,participantIds:e,matchUpFormat:i,tallyPolicy:n,attribute:r,idsFilter:a,matchUps:o,reversed:s}){let{participantResults:l}=ER({participantIds:a&&e,matchUpFormat:i,tallyPolicy:n,matchUps:o}),c=Tye({participantResults:l,participantIds:e,attribute:r}),u=[{attribute:r,reversed:s,groups:c,idsFilter:a}],d;return Object.keys(c).length>1&&e.length&&(d=Object.keys(c).map(p=>parseFloat(p)).sort((p,h)=>s?p-h:h-p).map(p=>c[p]).map(p=>{let h=Dye({participantResults:l,disableHeadToHead:t,participantIds:p,matchUpFormat:i,tallyPolicy:n,matchUps:o});return u.push(...h.report??[]),h.order}).flat(1/0)),{order:d,report:u}}function Dye({participantResults:t,disableHeadToHead:e,participantIds:i,matchUpFormat:n,tallyPolicy:r,matchUps:a}){let o=[],s=[],l;if((i==null?void 0:i.length)===1)return{order:[{resolved:!0,participantId:i[0]}]};if((i==null?void 0:i.length)===2&&(!(r!=null&&r.headToHead)||!r.headToHead.disabled&&!e)){let u=b3e({participantIds:i,participantResults:t});if(u){let d=u[0].participantId;return s.push({attribute:"head2Head",participantIds:i,headToHeadWinner:d}),{order:[u],headToHeadWinner:d,report:s}}}let c=((r==null?void 0:r.tallyDirectives)||g3e).filter(u=>{let d=!(Lr(u.maxParticipants)&&(i==null?void 0:i.length)>u.maxParticipants);return d||o.push(u),d});return o.length&&s.push({excludedDirectives:o,participantIds:i}),c.every(({attribute:u,reversed:d,idsFilter:p,disableHeadToHead:h})=>(l=y3e({disableHeadToHead:h,participantIds:i,matchUpFormat:n,tallyPolicy:r,attribute:u,idsFilter:p,matchUps:a,reversed:d}),s.push(l.report),!l.order)),l.order?{order:l.order,report:s}:{order:i==null?void 0:i.map(u=>({participantId:u})),report:s}}function b3e({participantIds:t,participantResults:e}){if(t){if(e[t[0]].victories.includes(t[1]))return t.map(i=>({resolved:!0,participantId:i}));if(e[t[1]].victories.includes(t[0]))return t.reverse().map(i=>({resolved:!0,participantId:i}))}}function CU({policyDefinitions:t,generateReport:e,matchUpFormat:i,matchUps:n=[],subOrderMap:r,perPlayer:a}){if(!(n!=null&&n.length)||!Zc(n))return{error:Oh};let o=ki(n.map(({structureId:b})=>b));if(o.length!==1)return fe({result:{error:Me,info:"Maximum one structureId"},stack:"tallyParticipantResults",context:{structureIds:o}});let s=n.filter(b=>b&&b.matchUpStatus!==yn),l=s.length&&ki(s.map(({drawPositions:b})=>b).flat()).length,c=s.filter(b=>_v({matchUp:b})).length===s.length;c||(a=0);let u=n.every(({matchUpType:b,tieMatchUps:I})=>b===Jn&&(I==null?void 0:I.every(T=>_v({matchUp:T})))),d=t==null?void 0:t[A5],p=n.filter(b=>_v({matchUp:b})||b.matchUpType===Jn),{participantResults:h}=ER({matchUps:p,matchUpFormat:i,tallyPolicy:d,perPlayer:a}),f,m,{groupOrder:g,report:v}=QZ({matchUps:p,participantResults:h,participantsCount:l,matchUpFormat:i,tallyPolicy:d,subOrderMap:r});if(c&&g)f=v,m=g,g.forEach(b=>{let{participantId:I,groupOrder:T,rankOrder:w,subOrder:S,ties:D,GEMscore:E}=b,C=h[I];Object.assign(C,{groupOrder:T,rankOrder:w,GEMscore:E,subOrder:S,ties:D})});else{let{groupOrder:b,report:I}=QZ({requireCompletion:!1,participantResults:h,participantsCount:l,matchUpFormat:i,tallyPolicy:d,subOrderMap:r,matchUps:n});f=I,m=b,b&&b.forEach(T=>{let{participantId:w,groupOrder:S,GEMscore:D}=T,E=h[w];Object.assign(E,{provisionalOrder:S,GEMscore:D})})}let y={completedTieMatchUps:u,readableReport:"",participantResults:h,bracketComplete:c,order:[],report:f};if((c||u)&&(y.order=m),e||jc({tally:!0})){let b=m3e({matchUps:n,report:f,order:m});jc({tally:!0})&&console.log(b),y.readableReport=b}return y}function Eye({positionAssignments:t}){let e=(t||[]).filter(Ol(wh)).map(r=>{let{extension:a}=Bi({element:r,name:LS}),o=ai(a==null?void 0:a.value),s=!isNaN(o)&&o;return s&&{participantId:r.participantId,subOrder:s}}).filter(Boolean),i=e.map(({subOrder:r})=>r),n=xl(i);return{subOrderMap:Object.assign({},...e.filter(({subOrder:r})=>n[r]===1).map(({participantId:r,subOrder:a})=>({[r]:a})))}}function X6({positionAssignments:t,tournamentRecord:e,drawDefinition:i,matchUpFormat:n,matchUps:r,event:a}){if(!Zc(r))return{error:Me};if(!t)return{error:Me};let{policyDefinitions:o}=cm({policyTypes:[A5],tournamentRecord:e,drawDefinition:i,event:a}),{subOrderMap:s}=Eye({positionAssignments:t}),l=r.length?CU({policyDefinitions:o,matchUpFormat:n,subOrderMap:s,matchUps:r}):void 0;if(l!=null&&l.error)return l;let{participantResults:c={},bracketComplete:u,report:d}=l??{},p=Object.keys(c);return t.forEach(h=>{let{participantId:f}=h;if(p.includes(f)){let m={value:c[f],name:og};un({element:h,extension:m}),c[f].ties||Ss({element:h,name:LS})}else Ss({element:h,name:og}),Ss({element:h,name:LS})}),er({drawDefinition:i}),{...ue,participantResults:c,bracketComplete:u,report:d}}function Cye({matchUps:t,matchUpId:e}){return{matchUp:(t||[]).find(i=>i.matchUpId===e)}}function ar({tournamentParticipants:t,afterRecoveryTimes:e,contextContent:i,contextProfile:n,drawDefinition:r,matchUpsMap:a,matchUpId:o,inContext:s,context:l,event:c}){if(!r)return{error:Lt};if(!o)return{error:_o};if(typeof o!="string")return{error:Me};let{structures:u=[]}=Rh({drawDefinition:r});n&&!i&&(i=dm({contextProfile:n,drawDefinition:r}));for(let d of u){let{matchUps:p}=Sn({tournamentParticipants:t,afterRecoveryTimes:e,contextContent:i,drawDefinition:r,contextProfile:n,matchUpsMap:a,inContext:s,structure:d,context:l,event:c}),{matchUp:h}=Cye({matchUps:p,matchUpId:o});if(h)return{matchUp:h,structure:d}}return{error:qo}}function BL(t){var e;return typeof t!="object"?{error:Ht}:typeof t.element!="object"?{error:Me}:t.notes?typeof t.notes!="string"&&!((e=t.notes)!=null&&e.testing)?{error:Me}:(Object.assign(t.element,{notes:t.notes}),{...ue}):{error:Ht}}function Pye(t){return typeof t!="object"?{error:Ht}:typeof t.element!="object"?{error:Me}:(t.element.notes&&delete t.element.notes,{...ue})}var $L={matchUpStatus:Kr,matchUpStatusCodes:[],score:{scoreStringSide1:"",scoreStringSide2:"",sets:void 0},matchUpFormat:void 0,winningSide:void 0};function ap(t){var e,i,n,r,a,o,s,l;let c="modifyMatchUpScore",u=t.matchUpFormat,d=t.matchUp,p,{matchUpStatusCodes:h,removeWinningSide:f,tournamentRecord:m,drawDefinition:g,matchUpStatus:v,removeScore:y,winningSide:b,matchUpId:I,event:T,notes:w,score:S}=t,D=t.appliedPolicies&&Object.keys(t.appliedPolicies).length?t.appliedPolicies:(e=Mn({policyTypes:[Dh],tournamentRecord:m,drawDefinition:g,structure:p,event:T}))==null?void 0:e.appliedPolicies,E=d.matchUpType===Jn;if(E&&g){if(I&&d.matchUpId!==I){let _=ar({drawDefinition:g,matchUpId:I,event:T});if(!_.matchUp)return{error:qo};({matchUp:d,structure:p}=_)}}else d.matchUpId!==I&&console.log("!!!!!");v&&[Rn,da].includes(v)||y?Object.assign(d,{...$L}):S&&(d.score=S);let C=v&&(d==null?void 0:d.matchUpStatus)===fn&&v!==fn;v&&(d.matchUpStatus=v),u&&(d.matchUpFormat=u),h&&(d.matchUpStatusCodes=h),b&&(d.winningSide=b),f&&(d.winningSide=void 0),!p&&g&&({structure:p}=ar({drawDefinition:g,matchUpId:I,event:T})),v&&!d.winningSide&&uo(d)&&!Ga.includes(v)&&![sw,$g].includes(v)&&(d.matchUpStatus=Hu);let P;if((C&&(i=d==null?void 0:d.processCodes)!=null&&i.length||v===fn)&&(P=(r=(n=D==null?void 0:D[Dh])==null?void 0:n.processCodes)==null?void 0:r.incompleteAssignmentsOnDefault),!d.collectionId){let _=(p==null?void 0:p.structureType)===xs,x=Ll({structure:p});if(y6({drawDefinition:g,structure:p})||x||_){let O=G=>{u=E?"SET1-S:T100":u??d.matchUpFormat??(G==null?void 0:G.matchUpFormat)??(g==null?void 0:g.matchUpFormat)??(T==null?void 0:T.matchUpFormat);let H=E?{matchUpTypes:[Jn]}:void 0,{matchUps:$}=Sn({afterRecoveryTimes:!1,tournamentRecord:m,inContext:!0,matchUpFilters:H,drawDefinition:g,structure:G,event:T});return x&&(G.positionAssignments=ki($.flatMap(q=>(q.sides??[]).map(z=>z.participantId)).filter(Boolean)).map(q=>({participantId:q}))),X6({positionAssignments:G.positionAssignments,tournamentRecord:m,drawDefinition:g,matchUpFormat:u,matchUps:$,event:T})},B=_&&p.structures.find(G=>G==null?void 0:G.matchUps.find(H=>H.matchUpId===I)),F=O(B||p);if(F.error)return fe({result:F,stack:c})}}if(w){let _=BL({element:d,notes:w});if(_.error)return fe({result:_,stack:c})}let R=m==null?void 0:m.tournamentId,N=Gu().topics.includes(SL),M=(N||P)&&ko({drawDefinition:g}),A=M&&((a=wa({matchUpFilters:{matchUpIds:[I]},nextMatchUps:!0,tournamentRecord:m,inContext:!0,drawDefinition:g,matchUpsMap:M}).matchUps)==null?void 0:a[0]);if(N&&A&&yHe({tournamentId:R,inContextMatchUp:A}),Array.isArray(P)&&A&&!((o=A.sides)!=null&&o.every(({participantId:_})=>_)))if(v===fn)d.processCodes=ki([...d.processCodes??[],...P]);else for(let _ of P||[]){let x=_&&((s=d==null?void 0:d.processCodes)==null?void 0:s.lastIndexOf(_));(l=d==null?void 0:d.processCodes)==null||l.splice(x,1)}return sn({eventId:T==null?void 0:T.eventId,context:c,drawDefinition:g,tournamentId:R,matchUp:d}),{...ue}}function J6(t){let{dualWinningSideChange:e,matchUpStatusCodes:i,matchUpStatus:n,structure:r,matchUp:a}=t,o=pR({matchUpStatus:n})||[sm,ec].includes(n)&&e,s="attemptToModifyScore",l=!!a.collectionId,c=Ll({structure:r});if(!(l||c||I3e({structure:r,matchUp:a})))return{error:W4};let u=[Rn].includes(n),d=ap({...t,matchUpStatusCodes:o&&i||[],matchUpStatus:o&&n||ia,context:s,removeScore:u});return fe({result:d,stack:s})}function I3e({structure:t,matchUp:e}){var i;let{drawPositions:n}=e,{positionAssignments:r}=Ha({structure:t});return((i=r==null?void 0:r.filter(a=>(n==null?void 0:n.includes(a.drawPosition))&&a.participantId))==null?void 0:i.length)===2}function Rye({collectionGroups:t=[]}){let e=Object.assign({},...t.filter(n=>bi(n==null?void 0:n.groupValue)&&(n==null?void 0:n.groupNumber)).map(n=>({[n.groupNumber]:{...n,allGroupMatchUpsCompleted:!0,matchUpsCount:0,sideWins:[0,0],values:[0,0]}}))),i=Object.keys(e).map(n=>ai(n));return{groupValueGroups:e,groupValueNumbers:i}}function w3e({collectionDefinition:t,groupValueNumbers:e,groupValueGroups:i,sideTieValues:n,tieMatchUps:r}){let a=r.filter(y=>y.collectionId===t.collectionId),o=[0,0],s=[0,0],l=a.every(y=>Ga.includes(y.matchUpStatus)),{collectionValueProfiles:c,collectionGroupNumber:u,collectionValue:d,matchUpValue:p,winCriteria:h,scoreValue:f,setValue:m}=t,g=u&&e.includes(u),v=[0,0];if(a.forEach(y=>{y.winningSide&&(v[y.winningSide-1]+=1)}),bi(p)?a.forEach(y=>{y.winningSide&&(o[y.winningSide-1]+=p)}):bi(m)?a.forEach(y=>{var b,I;(I=(b=y.score)==null?void 0:b.sets)==null||I.forEach(T=>{T.winningSide&&(o[T.winningSide-1]+=m)})}):bi(f)?a.forEach(y=>{var b,I;(I=(b=y.score)==null?void 0:b.sets)==null||I.forEach(T=>{let{side1TiebreakScore:w=0,side2TiebreakScore:S=0,side1Score:D=0,side2Score:E=0}=T;(y.matchUpStatus===ia||y.winningSide||T.winningSide)&&(D||E?(o[0]+=D,o[1]+=E):(w||S)&&T.winningSide&&(o[T.winningSide-1]+=1))})}):Array.isArray(c)&&a.forEach(y=>{if(y.winningSide){let b=y.collectionPosition,I=S3e({collectionDefinition:t,collectionPosition:b});bi(I)&&(o[y.winningSide-1]+=I)}}),bi(d)){let y;if(h!=null&&h.aggregateValue)l&&(bi(p||m||f)&&o[0]!==o[1]?y=o[0]>o[1]?1:2:v[0]!==v[1]&&(y=v[0]>v[1]?1:2));else if(h!=null&&h.valueGoal)y=o.reduce((b,I,T)=>I>=h.valueGoal?T+1:b,0);else{let b=Math.floor(t.matchUpCount/2)+1;y=v.reduce((I,T,w)=>T>=b?w+1:I,0)}y&&(g?i[u].values[y-1]+=d:s[y-1]+=d)}else g?(i[u].values[0]+=o[0]||0,i[u].values[1]+=o[1]||0):s=o;g?(i[u].sideWins[0]+=v[0]||0,i[u].sideWins[1]+=v[1]||0,i[u].allGroupMatchUpsCompleted=i[u].allGroupMatchUpsCompleted&&l,i[u].matchUpsCount+=a.length):s.forEach((y,b)=>n[b]+=y||0)}function S3e({collectionDefinition:t,collectionPosition:e}){var i,n;return(n=(i=t.collectionValueProfiles||[])==null?void 0:i.find(r=>r.collectionPosition===e))==null?void 0:n.matchUpValue}function Mye({collectionValueProfiles:t,matchUpCount:e}){let i=[];if(!Array.isArray(t))return i.push(`collectionValueProfiles is not an array: ${t}`),{errors:i};if(t.length&&t.length!==e)return i.push("collectionValueProfiles do not align with matchUpsCount"),{errors:i};for(let r of t){if(typeof r!="object")return i.push(`valueProfile is not type object: ${r}`),{errors:i};let{matchUpValue:a,collectionPosition:o}=r;if(typeof a!="number"||typeof o!="number"||o>e||o<1)return i.push("Invalid value profile: value and collectionPosition must be numeric. collectionPosition cannot be greater than matchUpCount"),{errors:i}}let n=t.map(r=>r.collectionPosition);return n.length!==ki(n).length?(i.push("collectionPositions are not unique"),{errors:i}):{...ue}}var T3e="MIXED events can not contain mixed singles or { gender: ANY } collections",U3e="events with { gender: ANY } can not contain MIXED singles collections";function VL(t){let e="tieFormatGenderValidityCheck",{referenceGender:i,matchUpType:n,gender:r}=t;return i&&r&&[Yn,Ir].includes(i)&&i!==r?fe({result:{valid:!1,error:LN},context:{gender:r},stack:e}):i===El&&(r===wp||r===El&&n!==Zn)?fe({result:{error:LN,valid:!1},info:T3e,stack:e}):i===wp&&r===El&&n!==Zn?fe({result:{error:LN,valid:!1},info:U3e,stack:e}):{valid:!0}}function jL(t,e){if((t!=null&&t.bestOf||t!=null&&t.exactly)&&t!=null&&t.setFormat)return D3e(t,e)}function TE(t){return!isNaN(Number(t))&&Number(t)}function Nye(t){let e=`T${t.minutes}`;return t.based&&(e+=t.based),t.modifier&&(e+=`@${t.modifier}`),e}function D3e(t,e){var i;let n=TE(t.bestOf)||void 0,r=TE(t.exactly)||void 0,a=n||r;if((i=t.setFormat)!=null&&i.timed&&t.simplified&&a===1)return Nye(t.setFormat);let o=a&&`${HN}${a}`||"",s=eX(t.setFormat,e),l=s&&`S:${s}`||"",c=eX(t.finalSetFormat,e),u=a&&a>1&&c&&s!==c&&`F:${c}`||"";if(o&&s)return[o,l,u].filter(d=>d).join("-")}function eX(t,e){if(typeof t=="object"&&Object.keys(t).length){if(t.timed)return Nye(t);if(t.tiebreakSet)return tX(t.tiebreakSet);let i=TE(t.setTo);if(i){let n=t.NoAD&&I6||"",r=tX(t.tiebreakFormat),a=r&&`/${r}`||"",o=TE(t.tiebreakAt),s=o&&(o!==i||e)&&`@${o}`||"";if(r!==!1)return`${i}${n}${a}${s}`}}}function tX(t){if(t){if(typeof t=="object"&&!t.tiebreakTo)return"";if(typeof t=="object"&&TE(t.tiebreakTo)){let e=`TB${t.tiebreakTo}${t.NoAD?I6:""}`;return t.modifier&&(e+=`@${t.modifier}`),e}else return!1}}function Fl({matchUpFormat:t}){if(typeof t!="string")return!1;let e=Zs(t),i=t.match(/-S:([1-9])+\/TB([0-9]{1,2})@?([1-9]?)*/),n=i==null?void 0:i[1],r=i==null?void 0:i[2],a=i==null?void 0:i[3],o=t.match(/-F:([1-9])+\/TB([0-9]{1,2})@?([1-9]?)*/),s=o==null?void 0:o[1],l=o==null?void 0:o[2],c=o==null?void 0:o[3];return jL(e,!!(i&&r&&n===a||o&&l&&s===c))===t}var E3e=(t,e)=>t.filter(Boolean).every(i=>typeof i===e),C3e=t=>t.filter(Boolean).every(Lr);function CR(t){let e=t.category;if(typeof e!="object")return{error:m_};let{ageCategoryCode:i,ageMaxDate:n,ageMinDate:r,ageMax:a,ageMin:o}=e,s=e.categoryName,l;if(!E3e([i,n,r,s],"string")||!C3e([a,o]))return{error:m_};let c=t.consideredDate??Ci(new Date().toLocaleDateString("sv"));if(!Kl(c))return{error:Cs};let[u]=c.split("-").slice(0,3).map(B=>parseInt(B)),d=I1(c,-1),[p,h]=d.split("-").slice(1,3).map(B=>parseInt(B)),f=`${Dc(p)}-${Dc(h)}`,m=I1(c,1),[g,v]=m.split("-").slice(1,3).map(B=>parseInt(B)),y=`${Dc(g)}-${Dc(v)}`,b=o&&I1(c,-1*365*o),I=a&&I1(c,-1*365*a),T=[],w=B=>!T.includes(B)&&T.push(B);i=i??s;let S=/^([UO]?)(\d{1,2})([UO]?)$/,D=/^C(\d{1,2})-(\d{1,2})$/,E=i==null?void 0:i.includes("-"),C=E&&(i==null?void 0:i.match(D)),P=i==null?void 0:i.match(S),R=(B,F)=>`${B}-${F}`,N=B=>{let F=u-B,G=R(F,y);e.ageMinDate&&e.ageMinDate!==G&&w(`Invalid submitted ageMinDate: ${r}`),r=G,i&&(e.ageMax&&e.ageMax!==B-1&&(w(`Invalid submitted ageMax: ${a}`),I=void 0),a=B-1)},M=B=>{let F=u-B-1,G=R(F,y);e.ageMin&&e.ageMin>B&&w(`Invalid submitted ageMin: ${o}`),e.ageMax&&e.ageMax>B&&w(`Invalid submitted ageMax: ${a}`),e.ageMinDate&&e.ageMinDate!==G&&w(`Invalid submitted ageMinDate: ${r}`),r=G,i&&(e.ageMax&&e.ageMax!==B&&(w(`Invalid submitted ageMax: ${a}`),b=void 0),a=B)},A=B=>{let F=u-B,G=R(F,f);e.ageMaxDate&&e.ageMaxDate!==G&&w(`Invalid submitted ageMaxDate: ${n}`),n=G,i&&(e.ageMin&&e.ageMin!==B+1&&(w(`Invalid submitted ageMin: ${o}`),b=void 0),o=B+1)},_=B=>{let F=u-B-1,G=R(F,f);e.ageMaxDate&&e.ageMaxDate!==G&&w(`Invalid submitted ageMaxDate: ${n}`),n=G,i&&(e.ageMin&&e.ageMin!==B&&(w(`Invalid submitted ageMin: ${o}`),b=void 0),o=B)},x=B=>{let[F,G,H]=(B.match(S)||[]).slice(1),$=parseInt(G);F==="U"?(e.ageMaxDate&&e.ageMaxDate!==n&&w(`Invalid submitted ageMaxDate: ${e.ageMaxDate}`),N($)):F==="O"&&A($),H==="U"?(e.ageMaxDate&&e.ageMaxDate!==n&&w(`Invalid submitted ageMaxDate: ${e.ageMaxDate}`),M($)):H==="O"&&_($),n=n??b,r=r??I};if(C){if(n=void 0,r=void 0,a=void 0,o=void 0,e.ageMin){let G=u-e.ageMin;n=R(G,f)}if(e.ageMax){let G=u-e.ageMax-1;r=R(G,y)}let[B,F]=((i==null?void 0:i.match(D))??[]).slice(1).map(G=>parseInt(G));B<=F?(o=B,a=F,l=!0):w(`Invalid combined age range ${i}`)}else E?i==null||i.split("-").forEach(x):P?x(i):(o&&A(o),a&&M(a));a&&e.ageMin&&e.ageMin>a&&(w(`Invalid submitted ageMin: ${e.ageMin}`),o=void 0);let O=qt({consideredDate:c,combinedAge:l,ageMaxDate:n,ageMinDate:r,ageMax:a,ageMin:o});return T.length&&(O.errors=T),O}function O_({category:t}){if(!sr(t))return{error:Me};let e=CR({category:t});if(e.error)return{error:e};let{ratingMax:i,ratingMin:n}=t;return i&&!Lr(i)?fe({result:{error:Me},context:{ratingMax:i}}):n&&!Lr(n)?fe({result:{error:Me},context:{ratingMin:n}}):{...e}}function GL({childCategory:t,withDetails:e,category:i}){let n=O_({category:i}),r=O_({category:t}),a=r.ageMin&&(n.ageMin&&r.ageMin<n.ageMin||n.ageMax&&r.ageMin>n.ageMax),o=r.ageMax&&(n.ageMax&&r.ageMax>n.ageMax||n.ageMin&&r.ageMax<n.ageMin),s=r.ageMinDate&&n.ageMaxDate&&new Date(r.ageMinDate)>new Date(n.ageMaxDate),l=r.ageMaxDate&&n.ageMinDate&&new Date(r.ageMaxDate)<new Date(n.ageMinDate),c=(i==null?void 0:i.ratingType)&&(t==null?void 0:t.ratingType)&&i.ratingType===t.ratingType&&(i.ratingMin&&t.ratingMin&&t.ratingMin<i.ratingMin||i.ratingMax&&t.ratingMax&&t.ratingMax>i.ratingMax||i.ratingMin&&t.ratingMax&&t.ratingMax<i.ratingMin||i.ratingMax&&t.ratingMin&&t.ratingMin>i.ratingMax),u=(i==null?void 0:i.ballType)&&(t==null?void 0:t.ballType)&&i.ballType!==t.ballType,d=qt({invalidRatingRange:c,invalidAgeMinDate:s,invalidAgeMaxDate:l,invalidBallType:u,invalidAgeMax:o,invalidAgeMin:a,valid:!c&&!s&&!l&&!u&&!o&&!a},!0);return e&&Object.assign(d,{categoryDetails:n,childCategoryDetails:r}),d}function PR({checkCategory:t=!0,collectionDefinition:e,checkCollectionIds:i,checkGender:n=!0,referenceCategory:r,referenceGender:a,event:o}){a=a??(o==null?void 0:o.gender);let s="validateCollectionDefinition",l=[];if(typeof e!="object")return l.push(`collectionDefinition must be an object: ${e}`),fe({result:{errors:l,error:om},stack:s});let{collectionValueProfiles:c,collectionGroupNumber:u,collectionValue:d,collectionId:p,matchUpCount:h,matchUpFormat:f,matchUpValue:m,matchUpType:g,scoreValue:v,setValue:y,category:b,gender:I}=e;if(i&&typeof p!="string"&&l.push(`collectionId is not type string: ${p}`),typeof h!="number"&&l.push(`matchUpCount is not type number: ${h}`),g&&!NL([Mr,Zn],g)&&l.push(`matchUpType must be SINGLES or DOUBLES: ${g}`),[!!(c!=null&&c.length)].concat([m,d,v,y].map(bi)).filter(Boolean).length!==1&&l.push("Missing value definition for matchUps: matchUpValue, collectionValue, or collectionValueProfiles"),m&&typeof m!="number"&&l.push(`matchUpValue is not type number: ${m}`),d&&typeof d!="number"&&l.push(`collectionValue is not type number: ${d}`),c&&h){let T=Mye({collectionValueProfiles:c,matchUpCount:h});T.errors&&l.push(...T.errors)}if(u&&typeof u!="number"&&l.push(`collectionGroupNumber is not type number: ${d}`),f&&!Fl({matchUpFormat:f})&&l.push(`Invalid matchUpFormat: ${f}`),n){let T=VL({referenceGender:a,matchUpType:g,gender:I});if(T.error)return fe({context:{referenceGender:a,gender:I},result:T,stack:s})}if(t&&r&&b){let T=GL({category:r,childCategory:b});if(!T.valid)return fe({result:{error:m_},context:T,stack:s})}return l.length?fe({result:{errors:l,error:vme},stack:s}):{valid:!0}}function ul(t){var e,i,n,r;let a=!!((t==null?void 0:t.enforceCategory)!==!1&&t!=null&&t.category),o=!!((t==null?void 0:t.enforceGender)!==!1&&t!=null&&t.gender),s=t==null?void 0:t.checkCollectionIds,l=t==null?void 0:t.tieFormat,c=t==null?void 0:t.event,u="validateTieFormat",d=[];if(!t||!l||typeof l!="object")return d.push("tieFormat must be an object"),fe({result:{error:nf},context:{tieFormat:l,errors:d},stack:u});if(typeof l.winCriteria!="object")return d.push("tieFormat.winCriteria must be an object"),fe({result:{error:nf},context:{tieFormat:l,errors:d},stack:u});if(!Array.isArray(l.collectionDefinitions))return d.push(Nh("tieFormat.collectionDefinitions")),fe({result:{error:nf},context:{tieFormat:l,errors:d},stack:u});let p,h=l.collectionDefinitions.every(y=>{let{setValue:b,scoreValue:I,collectionValue:T}=y;(b||I)&&!T&&(p=!0);let{valid:w,errors:S}=PR({referenceCategory:t.category,referenceGender:t.gender,collectionDefinition:y,checkCollectionIds:s,checkCategory:a,checkGender:o,event:c});return w?!0:(Array.isArray(S)&&d.push(...S),!1)}),f=typeof((e=l.winCriteria)==null?void 0:e.valueGoal)=="number"&&((i=l.winCriteria)==null?void 0:i.valueGoal)>0&&!p||((n=l.winCriteria)==null?void 0:n.aggregateValue);if(!(f||(r=l.winCriteria)!=null&&r.aggregateValue))return p?d.push("aggregateValue is required"):d.push("Either non-zero valueGoal, or { aggregateValue: true } must be specified in winCriteria"),fe({context:{tieFormat:l,errors:d,aggregateValueImperative:p},result:{error:nf},stack:u});let m=l.collectionDefinitions.map(({collectionId:y})=>y),g=!s||m.length===ki(m).length,v=h&&f&&g;return v?{valid:v,errors:d}:fe({result:{error:nf},context:{tieFormat:l,errors:d},stack:u})}function RR(t){var e,i,n,r,a;let{sideAdjustments:o=[0,0],separator:s="-",drawDefinition:l,matchUpsMap:c,structure:u,matchUp:d,event:p}=t;if(!Array.isArray(o)||o.length!==2||isNaN(o.reduce((E,C)=>E+C)))return{error:Me};if(!d)return{error:cl};let h=((e=ns({matchUp:d,drawDefinition:l,structure:u,event:p}))==null?void 0:e.tieFormat)||(t==null?void 0:t.tieFormat);if(!h)return{error:xP};let f=ul({tieFormat:h});if(f.error)return f;let m=(h==null?void 0:h.collectionDefinitions)||[],g=(d==null?void 0:d.tieMatchUps)??[],v=[0,0],{groupValueGroups:y,groupValueNumbers:b}=Rye(h);for(let E of m)w3e({collectionDefinition:E,groupValueNumbers:b,groupValueGroups:y,sideTieValues:v,tieMatchUps:g});for(let E of b){let C=y[E],{allGroupMatchUpsCompleted:P,matchUpCount:R,winCriteria:N,groupValue:M,sideWins:A,values:_}=C,x;if(N!=null&&N.aggregateValue)P&&_[0]!==_[1]&&(x=_[0]>_[1]?1:2);else if(N!=null&&N.valueGoal)x=_.reduce((O,B,F)=>B>=N.valueGoal?F+1:O,void 0);else{let O=Math.floor(R/2)+1;x=A.reduce((B,F,G)=>F>=O?G+1:B,void 0)}x&&(v[x-1]+=M||0)}let I=v.map((E,C)=>(E||0)+o[C]),T={side1Score:I[0],side2Score:I[1],winningSide:void 0},w=I.join(s),S=I.slice().reverse().join(s),D;if(h!=null&&h.winCriteria){let{valueGoal:E,aggregateValue:C,tallyDirectives:P}=h.winCriteria;if(E?D=(i=I.map((R,N)=>({sideNumber:N+1,points:R})).find(({points:R})=>R>=E))==null?void 0:i.sideNumber:C&&g.every(R=>R.matchUpStatus&&Ga.includes(R.matchUpStatus)||R.winningSide)&&I[0]!==I[1]&&(D=I[0]>I[1]?1:2),!D&&P){let R=d.matchUpId,N=d.hasContext?d:((n=c==null?void 0:c.drawMatchUps)==null?void 0:n[R])||l&&((r=ar({inContext:!0,drawDefinition:l,matchUpId:R}))==null?void 0:r.matchUp);if(N){let{completedTieMatchUps:M,order:A}=CU({matchUps:[N]});if(M&&A!=null&&A.length){let _=A[0].participantId;D=(a=N.sides.find(({participantId:x})=>x===_))==null?void 0:a.sideNumber}}}}return D&&(T.winningSide=D),{scoreStringSide1:w,scoreStringSide2:S,winningSide:D,set:T}}function MR({inContextDualMatchUp:t,drawDefinition:e,tournamentId:i,dualMatchUp:n,eventId:r}){var a,o;if(n){t||(t=(a=ar({matchUpId:n.matchUpId,inContext:!0,drawDefinition:e}))==null?void 0:a.matchUp);let{extension:s}=Bi({element:e,name:Of}),l=$t((s==null?void 0:s.value)||{},!1,!0),c=({displaySideNumber:u,drawPosition:d,sideNumber:p})=>({drawPosition:d,sideNumber:p,displaySideNumber:u});n.sides=(o=t==null?void 0:t.sides)==null?void 0:o.map(u=>{var d;let p=u.participantId,h=p&&l[p]||void 0,{lineUp:f,...m}=((d=n.sides)==null?void 0:d.find(({sideNumber:v})=>v===u.sideNumber))??{},g=f!=null&&f.length?f:h;return{...c(u),...m,lineUp:g}}),sn({context:"ensureSidLineUps",matchUp:n,drawDefinition:e,tournamentId:i,eventId:r})}}function So(t){if(t)return $t(t,!1,!0)}function Q6(t){let e=mn(t,[{[Ko]:!0}]);return e.error?e:Object.keys(t.tournamentRecords).reduce((i,n)=>{i.tournamentIdMap[n]=[];let r=t.tournamentRecords[n].events??[],a=r.map(({eventId:s})=>s),o=r.map(s=>(s.drawDefinitions??[]).map(({drawId:l})=>l)).flat();return i.tournamentIdMap[n].push(...a,...o),i.eventIds.push(...a),i.drawIds.push(...o),i},{eventIds:[],drawIds:[],tournamentIdMap:{}})}function Aye({tournamentRecords:t,eventId:e,drawId:i}){let{tournamentIdMap:n}=Q6({tournamentRecords:t});return(n?Object.keys(n):[]).find(r=>e&&(n==null?void 0:n[r].includes(e))||i&&(n==null?void 0:n[r].includes(i)))}function hm(t){var e,i,n,r;let{exitWhenNoValues:a,drawDefinition:o,matchUpStatus:s,removeScore:l,matchUpsMap:c,matchUpId:u,event:d}=t,p=t.tournamentRecords||t.tournamentRecord&&{[(e=t.tournamentRecord)==null?void 0:e.tournamentId]:t.tournamentRecord}||{},h=t.tournamentId||((i=t.tournamentRecord)==null?void 0:i.tournamentId);p&&Aye({tournamentRecords:p,...t});let f=h&&p[h];if(!f)return{error:it};let m=ar({drawDefinition:o,event:d,matchUpId:u});if(m.error)return m;if(!m.matchUp)return{error:qo};let{matchUp:g,structure:v}=m;if(!g.tieMatchUps)return{error:Ws};MR({tournamentId:f==null?void 0:f.tournamentId,eventId:d==null?void 0:d.eventId,dualMatchUp:g,drawDefinition:o});let{extension:y}=Bi({name:OS,element:g});if(y!=null&&y.value)if(l)Ss({element:g,name:OS});else return{...ue,score:g.score};let b=(n=ns({drawDefinition:o,structure:v,matchUp:g,event:d}))==null?void 0:n.tieFormat;g.tieFormat=So(b);let I=RR({drawDefinition:o,matchUpsMap:c,structure:v,matchUp:g,event:d}),{winningSide:T,set:w,scoreStringSide1:S,scoreStringSide2:D}=I,E=(w==null?void 0:w.side1Score)||(w==null?void 0:w.side2Score);if(a&&!g.score&&!E)return{...ue};let C={scoreStringSide1:S,scoreStringSide2:D,sets:w?[w]:[]},P=T&&[1,2].includes(T),R=P&&ia||U6({matchUpStatus:s??g.matchUpStatus,tieMatchUps:g.tieMatchUps,winningSide:g.winningSide,score:C})&&Hu||Kr,N=!!(g.winningSide&&!P),M=g.tieMatchUps.find(({score:_,winningSide:x,matchUpStatus:O})=>{var B;return((B=_==null?void 0:_.sets)==null?void 0:B.length)&&(_.sets[0].side1Score||_.sets[0].side2Score)||O&&Ga.includes(O)||x}),A;if(g.tieFormat&&!P&&!M){let _=(r=ns({drawDefinition:o,structure:v,event:d}))==null?void 0:r.tieFormat;_&&JSON.stringify(b)===JSON.stringify(_)&&(g.tieFormatId=void 0,g.tieFormat=void 0,A=!0)}return ap({appliedPolicies:t.appliedPolicies,matchUpStatus:R,score:C,removeWinningSide:N,tournamentRecord:f,drawDefinition:o,removeScore:l,winningSide:T,matchUpId:u,matchUp:g,event:d}),{...ue,score:C,removeWinningSide:N,tieFormatRemoved:A,winningSide:T}}function P3e({winnerMatchUpDrawPositionIndex:t,inContextDrawMatchUps:e,projectedWinningSide:i,sourceMatchUpStatus:n,winningDrawPosition:r,tournamentRecord:a,winnerTargetLink:o,sourceMatchUpId:s,drawDefinition:l,winnerMatchUp:c,dualMatchUp:u,matchUpsMap:d,event:p}){var h,f,m,g,v;let y="directWinner";if(o){let b=c.drawPositions||[],I=b[t],T=o.source.structureId,w=pi({structureId:T,drawDefinition:l});if(w.error)return w;let{structure:S}=w,{positionAssignments:D}=Ha({structureId:T,drawDefinition:l}),E=(h=D==null?void 0:D.find(A=>A.drawPosition===r))==null?void 0:h.participantId,C=o.target.structureId,{positionAssignments:P}=Ha({structureId:C,drawDefinition:l}),R=(f=P==null?void 0:P.find(A=>A.participantId===E))==null?void 0:f.drawPosition,N=P==null?void 0:P.filter(A=>{let _=b.includes(A.drawPosition),x=!A.participantId&&!A.bye&&!A.qualifier;return _&&x}).map(A=>A.drawPosition),M=N==null?void 0:N.includes(I);if(E&&o.target.roundNumber===1&&M)Sp({drawPosition:I,participantId:E,structureId:C,inContextDrawMatchUps:e,sourceMatchUpStatus:n,tournamentRecord:a,drawDefinition:l,matchUpsMap:d,event:p});else if(E&&N!=null&&N.length){let A=N.pop();A&&Sp({participantId:E,structureId:C,inContextDrawMatchUps:e,sourceMatchUpStatus:n,tournamentRecord:a,drawDefinition:l,drawPosition:A,matchUpsMap:d,event:p})}else if(R){let A=zS({drawPosition:R,matchUpId:c.matchUpId,inContextDrawMatchUps:e,sourceMatchUpStatus:n,tournamentRecord:a,sourceMatchUpId:s,drawDefinition:l,matchUpsMap:d});if(A.error)return fe({result:A,stack:y})}else if((S==null?void 0:S.stage)!==Xt){let A="winner target position unavaiallble";return console.log(A),{error:A}}if(S!=null&&S.seedAssignments&&S.structureId!==C){let A=S.seedAssignments.find(({participantId:x})=>x===E),_=A==null?void 0:A.participantId;A&&_&&DU({eventId:c==null?void 0:c.eventId,structureId:C,...A,tournamentRecord:a,drawDefinition:l,participantId:_})}}else{let b=zS({matchUpId:c.matchUpId,drawPosition:r,inContextDrawMatchUps:e,sourceMatchUpStatus:n,tournamentRecord:a,sourceMatchUpId:s,drawDefinition:l,matchUpsMap:d});if(b.error)return b}if(u&&i){let b=(m=u.sides)==null?void 0:m.find(I=>I.sideNumber===i);if(b!=null&&b.lineUp){let I=u.roundPosition,T=c.roundPosition,w=I===T&&I!==1||Math.floor(I/2)===T?2:1,S=(g=d==null?void 0:d.drawMatchUps)==null?void 0:g.find(({matchUpId:C})=>C===c.matchUpId),D=[1,2].map(C=>{var P;return{...((P=S.sides)==null?void 0:P.find(R=>R.sideNumber===C))||{},sideNumber:C}});S.sides=D;let E=S.sides.find(C=>C.sideNumber===w);if(E){let C=(v=b.lineUp)==null?void 0:v.filter(P=>P==null?void 0:P.participantId);E.lineUp=F6({lineUp:C}),sn({tournamentId:a==null?void 0:a.tournamentId,eventId:c==null?void 0:c.eventId,matchUp:S,context:y,drawDefinition:l})}}}return{...ue}}function R3e(t){var e,i,n;let{loserMatchUpDrawPositionIndex:r,inContextDrawMatchUps:a,projectedWinningSide:o,sourceMatchUpStatus:s,loserDrawPosition:l,tournamentRecord:c,loserTargetLink:u,drawDefinition:d,loserMatchUp:p,dualMatchUp:h,matchUpsMap:f,event:m}=t,g="directLoser",v=u.linkCondition,y=p.drawPositions||[],b=v===Ch&&p.roundNumber===2&&Math.min(...y.filter(Boolean)),I=b||y[r],T=b||y[1-r],w=u.source.structureId,{structure:S}=pi({structureId:w,drawDefinition:d}),{matchUps:D}=Sn({afterRecoveryTimes:!1,inContext:!0,drawDefinition:d,structure:S,event:m}),E=D.filter($=>{var q;return(q=$.drawPositions)==null?void 0:q.includes(l)}).filter($=>{let q=$.sides.find(Z=>Z.drawPosition===l),z=$.matchUpStatus===Rn||$.matchUpStatus===fn&&!uo($);return(q==null?void 0:q.sideNumber)===$.winningSide&&!z}),C=v===Ch&&E.length===0,{positionAssignments:P}=Ha({structureId:w,drawDefinition:d}),R=(e=P==null?void 0:P.find($=>$.drawPosition===l))==null?void 0:e.participantId,N=u.target.structureId,{positionAssignments:M}=Ha({structureId:N,drawDefinition:d}),A=M==null?void 0:M.filter(({drawPosition:$})=>y.includes($));if(A!=null&&A.some($=>$.participantId===R))return{...ue};let _=A==null?void 0:A.filter($=>{let q=y.includes($.drawPosition),z=!$.participantId&&!$.bye&&!$.qualifier;return q&&z}).map($=>$.drawPosition),x=_==null?void 0:_.includes(I),O=u.target.roundNumber>1&&(_==null?void 0:_.length),B=u.target.roundNumber===1&&x;if(b){let $=F();if($.error)return fe({result:$,stack:g})}else if(B){let $=H();if($.error)return fe({result:$,stack:g})}else if(R&&O){_.sort(va);let $=_[0],q=Sp({participantId:R,structureId:N,drawPosition:$,inContextDrawMatchUps:a,sourceMatchUpStatus:s,tournamentRecord:c,drawDefinition:d,matchUpsMap:f,event:m});if(q.error)return fe({result:q,stack:g})}else return fe({result:{error:tU},context:{loserDrawPosition:l,loserTargetLink:u},stack:g});if(S!=null&&S.seedAssignments&&S.structureId!==N){let $=S.seedAssignments.find(({participantId:z})=>z===R),q=$==null?void 0:$.participantId;$&&q&&DU({eventId:p==null?void 0:p.eventId,structureId:N,...$,tournamentRecord:c,drawDefinition:d,participantId:q})}if(h&&o){let $=(i=h.sides)==null?void 0:i.find(q=>q.sideNumber===3-o);if($!=null&&$.lineUp){let{roundNumber:q,eventId:z}=p,{roundPosition:Z}=h,Y=q===1?2-Z%2:1,Q=(n=f==null?void 0:f.drawMatchUps)==null?void 0:n.find(({matchUpId:re})=>re===p.matchUpId),X=[1,2].map(re=>{var me;return{...((me=Q.sides)==null?void 0:me.find(se=>se.sideNumber===re))||{},sideNumber:re}});Q.sides=X;let oe=Q.sides.find(re=>re.sideNumber===Y);oe&&(oe.lineUp=F6({lineUp:$.lineUp}),sn({tournamentId:c==null?void 0:c.tournamentId,matchUp:Q,context:g,drawDefinition:d,eventId:z}))}}return{...ue};function F(){let $="loserLinkFedFMLC";return fe(C?{result:H(),stack:$}:{result:G(),stack:$})}function G(){let $=uc({drawPosition:T,structureId:N,tournamentRecord:c,drawDefinition:d,event:m});return fe({result:$,stack:"assignLoserPositionBye"})}function H(){let $=R?Sp({drawPosition:I,participantId:R,structureId:N,inContextDrawMatchUps:a,sourceMatchUpStatus:s,tournamentRecord:c,drawDefinition:d,matchUpsMap:f,event:m}):{error:Ra};return fe({result:$,stack:"assignLoserDrawPosition"})}}function _ye(t){var e;let i=J6(t);if(i.error)return i;let n=pR({matchUpStatus:t.matchUpStatus}),{dualWinningSideChange:r,projectedWinningSide:a,inContextDrawMatchUps:o,tournamentRecord:s,drawDefinition:l,matchUpStatus:c,dualMatchUp:u,matchUpsMap:d,winningSide:p,targetData:h,matchUpId:f,structure:m,matchUp:g,event:v}=t,y="directParticipants",b=!!g.collectionId,I=Ll({structure:m}),T=g.drawPositions,w;if(b){let{matchUpTieId:S,matchUpsMap:D}=t,E=hm({appliedPolicies:t.appliedPolicies,matchUpId:S,tournamentRecord:s,drawDefinition:l,matchUpsMap:D,event:v});if(w=E&&{tieMatchUpResult:E},T=(e=o.find(({matchUpId:C})=>C===S))==null?void 0:e.drawPositions,!r)return fe({result:{...ue,...w},stack:y})}if(I)return fe({result:{...ue,...w},stack:y});if(T){let S=a?a-1:p-1,D=1-S,E=T[S],C=T[D],{targetLinks:{loserTargetLink:P,winnerTargetLink:R,byeTargetLink:N},targetMatchUps:{winnerMatchUpDrawPositionIndex:M,loserMatchUpDrawPositionIndex:A,winnerMatchUp:_,loserMatchUp:x,byeMatchUp:O}}=h;if(_){let B=P3e({sourceMatchUpStatus:n&&c||ia,winnerMatchUpDrawPositionIndex:M,sourceMatchUpId:f,inContextDrawMatchUps:o,projectedWinningSide:a,winningDrawPosition:E,tournamentRecord:s,winnerTargetLink:R,drawDefinition:l,winnerMatchUp:_,dualMatchUp:u,matchUpsMap:d,event:v});if(B.error)return fe({result:B,stack:y})}if(x){let B=R3e({sourceMatchUpStatus:n&&c||ia,loserMatchUpDrawPositionIndex:A,sourceMatchUpId:f,inContextDrawMatchUps:o,projectedWinningSide:a,loserDrawPosition:C,tournamentRecord:s,loserTargetLink:P,drawDefinition:l,loserMatchUp:x,winningSide:p,matchUpsMap:d,dualMatchUp:u,event:v});if(B.error)return fe({result:B,stack:y})}if(O){let B=O.drawPositions||[],F=Math.min(...B.filter(Boolean)),G=N.target.structureId,H=uc({drawPosition:F,structureId:G,tournamentRecord:s,drawDefinition:l,event:v});if(H.error)return fe({result:H,stack:y})}}else return fe({result:{error:AP},stack:y});return fe({result:{...ue,...w},stack:y})}function e8(t){var e,i,n,r;let a="genPlayoffStructure";if(!t.drawDefinition)return fe({result:{error:Lt},stack:a});let o=TR(t);if(o.error)return fe({result:o,stack:a});let{structureId:s,addNameBaseToAttributeName:l,playoffStructureNameBase:c,finishingPositionNaming:u,finishingPositionLimit:d,playoffAttributes:p,playoffPositions:h,roundOffsetLimit:f,tournamentRecord:m,exitProfileLimit:g,roundProfiles:v,roundNumbers:y,idPrefix:b,isMock:I,event:T,uuids:w}=t,S=$t(t.drawDefinition,!1,!0),{structure:D}=pi({structureId:s,drawDefinition:S});if(!D)return fe({result:{error:Dr},stack:a});if(D.structureType===xs||D.structures)return r3e({sourceStructureId:D.structureId,...t,...o,drawDefinition:S});let{playoffRoundsRanges:E,playoffRounds:C}=o,{playoffPositionsReturned:P,error:R,playoffSourceRounds:N,playoffRoundsRanges:M}=hye(t);if(R)return fe({result:{error:R},stack:a});let A=(v==null?void 0:v.length)&&Object.assign({},...v),_=y||typeof v=="object"&&v.map(re=>Object.keys(re)).flat(),x=Array.isArray(_)&&_.map(re=>!isNaN(re)&&ai(re)).filter(Boolean);if(x){if(!Array.isArray(x))return fe({result:{error:Me},context:{validRoundNumbers:x},stack:a});x.forEach(re=>{if(!(C!=null&&C.includes(re)))return fe({result:{error:Me},context:{roundNumber:re},stack:a})})}h&&h.forEach(re=>{if(!(P!=null&&P.includes(re)))return fe({result:{error:Me},context:{playoffPosition:re},stack:a})});let O=x||N,B=x?E:M,F=[],G=[];for(let re of O??[]){let me=B==null?void 0:B.find(Te=>Te.roundNumber===re);if(!me)return fe({result:{error:Me},context:{roundNumber:re},stack:a});let se=me.finishingPositions.length,te=Math.min(...me.finishingPositions)-1,he=2,ae=re&&(A==null?void 0:A[re])&&he+A[re]-1,de=G0({exitProfile:`0-${re}`,addNameBaseToAttributeName:l,playoffStructureNameBase:c,finishingPositionOffset:te,playoffAttributes:p,exitProfileLimit:g,stage:Br,roundOffset:0,drawDefinition:S,sequenceLimit:ae,stageSequence:he,drawSize:se,idPrefix:b,isMock:I,uuids:w,finishingPositionNaming:u,finishingPositionLimit:d,roundOffsetLimit:f});if(de.error)return fe({result:de,stack:a});let{structures:Ie,links:De}=de;if(Ie!=null&&Ie.length&&F.push(...Ie),De!=null&&De.length&&G.push(...De),de.structureId&&re){let Te={linkType:Eh,source:{structureId:s,roundNumber:re},target:{structureId:de.structureId,feedProfile:gu,roundNumber:1}};G.push(Te)}}if(!F.length)return fe({result:{error:Me},info:"No structures generated",stack:a});S.structures.push(...F),S.links.push(...G);let{matchUps:H,matchUpsMap:$}=wa({inContext:!0,drawDefinition:S}),q=F.map(({structureId:re})=>re),z=H==null?void 0:H.filter(({structureId:re})=>q.includes(re)).map(Va),Z=(e=$==null?void 0:$.drawMatchUps)==null?void 0:e.filter(({matchUpId:re})=>z==null?void 0:z.includes(re));if(Z!=null&&Z.length){let re=(i=ns({drawDefinition:S,event:T}))==null?void 0:i.tieFormat;re&&Z.forEach(me=>{let{tieMatchUps:se}=UR({matchUp:me,tieFormat:re,isMock:I});Object.assign(me,{tieMatchUps:se,matchUpType:Jn})})}(n=H==null?void 0:H.filter(re=>_v({matchUp:re})&&re.structureId===s))==null||n.forEach(re=>{let{matchUpId:me,score:se,winningSide:te}=re,he=Ms({inContextDrawMatchUps:H,drawDefinition:S,matchUpId:me}),ae=_ye({inContextDrawMatchUps:H,tournamentRecord:m,drawDefinition:S,matchUpsMap:$,winningSide:te,targetData:he,matchUpId:me,structure:D,matchUp:re,score:se,event:T});ae.error&&console.log(ae.error)}),(r=H==null?void 0:H.filter(re=>re.matchUpStatus===yn&&re.structureId===s))==null||r.forEach(re=>{let{matchUpId:me}=re,se=Ms({inContextDrawMatchUps:H,drawDefinition:S,matchUpId:me}),{targetLinks:{loserTargetLink:te},targetMatchUps:{loserMatchUpDrawPositionIndex:he,loserMatchUp:ae}}=se;if(te&&ae){let de=te.target.structureId,Ie=ae.drawPositions[he],De=uc({drawPosition:Ie,structureId:de,tournamentRecord:m,drawDefinition:S,event:T});De.error&&console.log(De.error)}});let Y=[],Q=ly({inContextDrawMatchUps:H,drawDefinition:S,matchUpsMap:$}).goesToMap,{structure:X}=pi({drawDefinition:t.drawDefinition,structureId:s}),{matchUps:oe}=Sn({structure:X});return oe.forEach(re=>{var me,se;let te=Q==null?void 0:Q.loserMatchUpIds[re.matchUpId];if(te&&re.loserMatchUpId!==te){re.loserMatchUpId=te;let ae={tournamentId:m==null?void 0:m.tournamentId,eventId:(me=t.event)==null?void 0:me.eventId,context:a,matchUp:re};Y.push(ae)}let he=Q==null?void 0:Q.winnerMatchUpIds[re.matchUpId];if(he&&re.winnerMatchUpId!==he){re.winnerMatchUpId=he;let ae={tournamentId:m==null?void 0:m.tournamentId,eventId:(se=t.event)==null?void 0:se.eventId,context:a,matchUp:re};Y.push(ae)}}),{structures:F,matchUpModifications:Y,links:G,drawDefinition:S,...ue}}function kye(t){return HL({...t,itemType:"attachConsolationStructures"})}function t8(t){return HL({...t,itemType:"attachPlayoffStructures"})}function HL({itemType:t="attachStructures",matchUpModifications:e,tournamentRecord:i,drawDefinition:n,structures:r,links:a=[],event:o}){var s,l,c;let u="attachStructures";if(!n)return{error:Lt};if(!Array.isArray(r)||!Array.isArray(a))return fe({result:{error:Me},stack:u});let d=b=>{var I;return[b.source.structureId,b.source.roundNumber||((I=b.source.finishingPositions)==null?void 0:I.join("|")),b.target.roundNumber].join("|")},p=(s=n.links)==null?void 0:s.map(d);if(a.some(b=>{let I=d(b);return p==null?void 0:p.includes(I)}))return fe({result:{error:h5},info:"playoff structure exists",stack:u});a.length&&((l=n.links)==null||l.push(...a));let h=r.map(({structureId:b})=>b),f=(c=n.structures)==null?void 0:c.map(({structureId:b})=>b);n.structures=(n.structures??[]).map(b=>h.includes(b.structureId)?r.find(({structureId:I})=>I===b.structureId):b);let m=r==null?void 0:r.filter(({structureId:b})=>!(f!=null&&f.includes(b)));m.length&&n.structures.push(...m),ly({drawDefinition:n});let g=r.map(b=>{var I;return((I=Sn({structure:b}))==null?void 0:I.matchUps)||[]}).flat();lg({tournamentId:i==null?void 0:i.tournamentId,eventId:o==null?void 0:o.eventId,drawDefinition:n,matchUps:g});let v=r.map(({structureId:b})=>b);if(er({drawDefinition:n,structureIds:v}),e==null?void 0:e.length){let b={};e.forEach(T=>{var w;let S=(w=T.matchUp)==null?void 0:w.matchUpId;S&&(b[S]=T)});let I=T=>{T.matchUps.forEach(w=>{if(b[w.matchUpId]){let{tieMatchUps:S,...D}=b[w.matchUpId].matchUp;if(Object.assign(w,D),S==null?void 0:S.length){let E={};S.forEach(C=>b[C.matchUpId]=C),w.tieMatchUps.forEach(C=>Object.assign(C,E[C.matchUpId]))}b[w.matchUpId].matchUp=w,sn(b[w.matchUpId])}})};n.structures.forEach(T=>{if(f!=null&&f.includes(T.structureId))if(T.structures)for(let w of T.structures)I(w);else I(T)})}let y=m.map(Ol("structureId"));if(i){let b={itemValue:{structureIds:v,drawId:n.drawId},itemType:t};Vg({element:i,timeItem:b})}return{...ue,addedStructureIds:y}}function zL(t){var e,i;let{structures:n,links:r,matchUpModifications:a,error:o}=e8(t);if(o)return{error:o};let s=t.drawDefinition;return t8({tournamentId:(e=t.tournamentRecord)==null?void 0:e.tournamentId,eventId:((i=t.event)==null?void 0:i.eventId)||t.eventId,matchUpModifications:a,drawDefinition:s,structures:n,links:r})}function cy(t){let e=mn(t,[{_anyOf:{[Ko]:!1,[Lh]:!1,[Md]:!1,[cU]:!1},[w5]:!0}]);if(e.error)return e;let i=[],n=t.drawDefinition??t.event??((t.tournamentId||!t.tournamentRecords)&&t.tournamentRecord);if(n){let r=iX(t,n);if(r.error)return r;i.push(...(r==null?void 0:r.applied)??[]),t.drawDefinition&&er({drawDefinition:t.drawDefinition,tournamentId:t.tournamentId})}else if(t.tournamentRecords){let r=Object.keys(t.tournamentRecords);if(!r.length)return{error:it};for(let a of r){let o=t.tournamentRecords[a],s=iX(t,o);if(s.error)return s;i.push(...(s==null?void 0:s.applied)??[])}}else return{error:it};return i.length?{...ue,applied:i}:{error:Q4}}function iX(t,e){let i=Mn(t).appliedPolicies??{};e.extensions||(e.extensions=[]);let n=[],r=Object.keys(t.policyDefinitions);if(!r.length)return{error:XO};for(let a of r)if(!i[a]||t.allowReplacement){let o=t.policyDefinitions[a];if(!o)continue;if(!sr(o))return{error:Me};let{policyName:s,...l}=o;if(!l||!Object.keys(l).length||s&&!qs(s))return{error:Me};i[a]=t.policyDefinitions[a],n.push(a)}return n!=null&&n.length?{...un({element:e,extension:{name:hE,value:i}}),applied:n}:{applied:n,error:Q4}}function i8({tournamentRecord:t,drawDefinition:e,flightProfile:i,drawName:n,drawId:r,event:a}){var o;if(!n||typeof n!="string")return fe({result:{error:Me},context:{drawName:n}});i||(i=Xr({event:a}).flightProfile);let s=(o=i==null?void 0:i.flights)==null?void 0:o.find(l=>l.drawId===r);if(s){s.drawName=n;let l={name:Au,value:{...i,flights:i.flights}};Bg({event:a,extension:l})}return e&&(e.drawName=n,er({tournamentId:t==null?void 0:t.tournamentId,drawDefinition:e})),!s&&!e?{error:Lt}:{...ue,flight:s}}function xye({tournamentRecord:t,drawDefinition:e,drawUpdates:i,drawId:n,event:r}){var a;if(!sr(i))return{error:Me};let o=Xr({event:r}).flightProfile,s=i.drawName&&i8({drawName:i.drawName,tournamentRecord:t,drawDefinition:e,flightProfile:o,drawId:n,event:r});if(s!=null&&s.error)return s==null?void 0:s.error;let l=(s==null?void 0:s.flight)||((a=o==null?void 0:o.flights)==null?void 0:a.find(c=>c.drawId===n));if(!l&&!e)return{error:Lt};if(l){let c={name:Au,value:{...o,flights:o.flights}};Bg({event:r,extension:c})}return e&&(i.policyDefinitions&&cy({policyDefinitions:i.policyDefinitions,drawDefinition:e}),er({tournamentId:t==null?void 0:t.tournamentId,drawDefinition:e})),{...ue}}function Oye({tournamentRecord:t,removeScheduling:e,drawDefinition:i}){var n,r;if(!i)return{error:Lt};let a=ko({drawDefinition:i}),o=l=>{var c;return(c=a==null?void 0:a.drawMatchUps)==null?void 0:c.find(u=>u.matchUpId===l)};for(let l of i.structures||[]){let{positionAssignments:c,stage:u,stageSequence:d}=l;c&&(d!==1||![Xt,Ft].includes(u))&&(l.positionAssignments=c.map(f=>(delete f.participantId,f)),l.seedAssignments=[]);let{matchUps:p,isRoundRobin:h}=Sn({afterRecoveryTimes:!1,inContext:!0,matchUpsMap:a,structure:l});for(let f of p){let{matchUpId:m,roundNumber:g}=f,v=f.sides||[],y=o(m);if(y){if(delete y.extensions,delete y.notes,y.matchUpStatus!==yn&&Object.assign(y,$L),g&&g>1&&((n=y.drawPositions)==null?void 0:n.length)&&!h){let b=v==null?void 0:v.map(({drawPosition:T,participantFed:w})=>!w&&T).filter(Boolean),I=y.drawPositions.map(T=>b.includes(T)?void 0:T);y.drawPositions=I}e?delete y.timeItems:(r=y.timeItems)!=null&&r.length&&(y.timeItems=y.timeItems.filter(b=>b.itemType&&![jf,ay,yU,Hge,bU,IU].includes(b.itemType))),sn({tournamentId:t==null?void 0:t.tournamentId,context:"resetDrawDefiniton",drawDefinition:i,matchUp:y})}}}let s=(i.structures||[]).map(({structureId:l})=>l);return er({drawDefinition:i,structureIds:s}),{...ue}}function NR({tournamentRecord:t}){var e;if(!t)return{error:it};let i={positionsNoOutcomes:[],canBePruned:[],matchPlay:[],inactive:[],drawAnalysis:{}},n={};return((e=t.events)==null?void 0:e.map(r=>{let a=r.eventId;return n[a]=r,((r==null?void 0:r.drawDefinitions)||[]).map(o=>({drawDefinition:o,eventId:a}))}).flat().filter(Boolean)).forEach(({drawDefinition:r,eventId:a})=>{let o=0,s=0,l=0,{allStructuresLinked:c}=FL({drawDefinition:r}),u=n[a],d=((r==null?void 0:r.structures)||[]).map(I=>{let{stage:T,stageSequence:w,structureId:S}=I,D=dI[T],{inContextStructureMatchUps:E}=hR({drawDefinition:r,structure:I,event:u}),C=E==null?void 0:E.filter(({winningSide:$})=>$),P=C.filter(Boolean).length||0;s+=P,l+=E.length-s;let R=Math.max(C.filter(({roundNumber:$})=>$===1).map(({roundPosition:$})=>$)),{positionAssignments:N}=jn({structure:I}),M=N==null?void 0:N.filter(({participantId:$})=>$);o+=(M==null?void 0:M.length)??0;let A=((N==null?void 0:N.length)??0)-((M==null?void 0:M.length)??0),{roundMatchUps:_,roundProfile:x,roundNumbers:O,maxMatchUpsCount:B}=Rs({matchUps:E}),F=x&&Object.keys(x).filter($=>!x[$].inactiveRound).map($=>parseInt($)),G=x&&Object.keys(x).filter($=>x[$].inactiveRound).map($=>parseInt($)),H=x&&Object.values(x).every($=>$.inactiveRound);return{positionsAssignedCount:(M==null?void 0:M.length)??0,maxWinningSideFirstRoundPosition:R,unassignedPositionsCount:A,inactiveStructure:H,maxMatchUpsCount:B,inactiveRounds:G,roundMatchUps:_,activeRounds:F,roundNumbers:O,roundProfile:x,structureId:S,stageSequence:w,orderNumber:D,stage:T}}),p=d.find(I=>I.orderNumber===2&&I.stageSequence===1),h=d.filter(({inactiveStructure:I})=>!I).length,{links:f}=wU({structureId:p.structureId,drawDefinition:r}),m=ai(p.activeRounds[0])===1&&p.activeRounds.length===1&&h===1,g=d==null?void 0:d.every(({inactiveStructure:I})=>I),v=!f.length&&p.activeRounds.length&&(p.roundProfile[1].inactiveCount||p.inactiveRounds.length),y=r.drawId;o&&!s&&i.positionsNoOutcomes.push(y),g&&i.inactive.push(y),m&&i.matchPlay.push(y),v&&i.canBePruned.push(y);let b={matchUpsWithWinningSideCount:s,matchUpsNoOutcomeCount:l,positionsAssignedCount:o,allStructuresLinked:c,structuresData:d,inactiveDraw:g,isMatchPlay:m,drawId:y};i.drawAnalysis[y]=b}),{...ue,drawsAnalysis:i}}function Lye({matchPlayDrawPositions:t=!0,tournamentRecord:e,drawDefinition:i,drawId:n}){var r;if(!e)return{error:it};if(!i)return{error:Lt};let a=[],{drawsAnalysis:o}=NR({tournamentRecord:e});if(o.canBePruned.includes(n)){let s=o.matchPlay.includes(n),l=o.drawAnalysis[n],{structures:[c]}=Rh({stageSequence:1,drawDefinition:i,stage:Ft}),u=l.structuresData.find(({structureId:f})=>c.structureId===f),d=(c.matchUps??[]).sort((f,m)=>f.roundPosition-m.roundPosition);a=d.filter(({roundNumber:f})=>!u.inactiveRounds.includes(f));let p=a.map(Va),h=d.map(Va).filter(f=>!p.includes(f));if(s){let f=a.filter(({roundNumber:b})=>!u.inactiveRounds.includes(b)).filter(({winningSide:b})=>b),m=f.map(Va),g=p.filter(b=>!m.includes(b));h.push(...g);let v=f.flatMap(b=>b.drawPositions??[]).filter(Boolean).flat(),y=Object.assign({},...v.map((b,I)=>({[b]:I+1})));if(f.forEach(b=>{t?b.drawPositions=b.drawPositions.map(I=>y[I]):delete b.drawPositions}),t){let b=(r=c==null?void 0:c.positionAssignments)==null?void 0:r.filter(I=>v.includes(I.drawPosition)).map(I=>(I.drawPosition=y[I.drawPosition],I));c.positionAssignments=b}else c.positionAssignments=[];c.matchUps=f,a=f}lm({tournamentId:e==null?void 0:e.tournamentId,matchUpIds:h,drawDefinition:i}),er({drawDefinition:i})}return{...ue,matchUps:a}}function Fye({tournamentRecord:t,drawDefinition:e,participantId:i,drawPosition:n,structureId:r,qualifier:a,event:o,bye:s}){if(!e)return{error:Lt};if(!n)return{error:iU};if(!r)return{error:lc};if(s){let l=uc({tournamentRecord:t,drawDefinition:e,drawPosition:n,structureId:r,event:o});if(l.error)return l}else{if(a)return{error:aL};{let l=Sp({tournamentRecord:t,drawDefinition:e,participantId:i,drawPosition:n,structureId:r,event:o});if(l.error)return l}}return{...ue}}function Bye(t){var e,i,n,r,a;let o=t.matchUpIds??[],{drawDefinition:s}=t,l=t.structureId??((i=(e=s==null?void 0:s.structures)==null?void 0:e.find(h=>{var f;return(f=h.matchUps)==null?void 0:f.some(({matchUpId:m})=>o.includes(m))}))==null?void 0:i.structureId)??((r=(n=s==null?void 0:s.structures)==null?void 0:n[0])==null?void 0:r.structureId);if(!l)return{error:Dr};let c=(a=s.structures)==null?void 0:a.find(h=>h.structureId===l);if(!c)return{error:Dr};let u=c==null?void 0:c.matchUps,d=u==null?void 0:u.find(h=>!!h.roundPosition);if(c.structures||d||c.finishingPosition===lw)return{error:tw};let p=u.filter(({roundNumber:h})=>{var f;return(f=t.roundNumbers)==null?void 0:f.includes(h)}).map(Va);return o=o.filter(h=>!p.includes(h)),t.roundNumbers&&!o.length&&(o=p),{existingMatchUps:u,matchUpIds:o,structureId:l,structure:c}}function $ye(t){let e=mn(t,[{[Md]:!0},{[cE]:{[$P]:!1,roundNumbers:!1},[Sh]:Me,[Lg]:bl}]);if(e.error)return e;let{removeIncomplete:i=!1,removeUnAssigned:n=!0,removeCompleted:r=!1,tournamentRecord:a,drawDefinition:o,event:s}=t,l=Bye(t);if(l.error)return l;let{structure:c,structureId:u,existingMatchUps:d,matchUpIds:p}=l,h=[],f=(d==null?void 0:d.filter(({matchUpId:v,score:y,winningSide:b})=>{if(b&&!r)return!1;if(uo({score:y})){if(!b&&!i)return!1;h.push(v)}else if(!n)return!1;return p==null?void 0:p.includes(v)}))??[],m=f.map(Va),g=f.map(({tieMatchUps:v})=>v==null?void 0:v.map(Va)).filter(Boolean).flat();if(m.length){c.matchUps=(c.matchUps??[]).filter(({matchUpId:b})=>!m.includes(b)),lm({tournamentId:a==null?void 0:a.tournamentId,matchUpIds:[...g,...m],action:"deleteAdHocMatchUps",eventId:s==null?void 0:s.eventId,drawDefinition:o});let v=ki(c.matchUps.map(Ol("roundNumber"))),y=fGe(v);if(y.length){y.reverse();for(let b of y)c.matchUps.forEach(I=>{I.roundNumber&&I.roundNumber>b&&(I.roundNumber-=1,sn({tournamentId:a==null?void 0:a.tournamentId,context:["adHoc round deletion"],eventId:s==null?void 0:s.eventId,drawDefinition:o,matchUp:I}))})}if(h.length){c.positionAssignments=ki(c.matchUps.flatMap(w=>(w.sides??[]).map(S=>S.participantId)).filter(Boolean)).map(w=>({participantId:w}));let b=(c==null?void 0:c.matchUpFormat)??(o==null?void 0:o.matchUpFormat)??(s==null?void 0:s.matchUpFormat),{matchUps:I}=Sn({afterRecoveryTimes:!1,inContext:!0,structure:c,event:s}),T=X6({positionAssignments:c.positionAssignments,tournamentRecord:a,drawDefinition:o,matchUpFormat:b,matchUps:I,event:s});T.error&&console.log(T)}er({structureIds:[u],eventId:s==null?void 0:s.eventId,drawDefinition:o})}return!m.length&&p.length?{error:sL}:{...ue,deletedMatchUpsCount:[...m,...g].length}}function Vye({removeCompletedMatchUps:t,tournamentRecord:e,drawDefinition:i,structureId:n,roundNumber:r,event:a}){if(!e)return{error:it};if(!i)return{error:Lt};if(!r)return fe({result:{error:Ht},info:"roundNumber required"});let o=pi({drawDefinition:i,structureId:n});if(o.error)return o;let s=o.structure;return s!=null&&s.structures?{error:tw}:Ll({structure:s})?M3e({tournamentId:e.tournamentId,removeCompletedMatchUps:t,eventId:a.eventId,drawDefinition:i,roundNumber:r,structure:s}):(console.log("not implemented"),{...ue})}function M3e({removeCompletedMatchUps:t,drawDefinition:e,tournamentId:i,roundNumber:n,structure:r,eventId:a}){let o=(r==null?void 0:r.matchUps)??[],s=[],l=[],c=!1;if(o.reduce((u,d)=>{let p=d==null?void 0:d.roundNumber;return p?u.includes(p)?u:u.concat(p):u},[]).sort(va).includes(n)){let u=o.filter(d=>{let p=d.roundNumber===n&&(!Ga.includes(d.matchUpStatus)||t);return p&&(l.push(d.matchUpId),d.tieMatchUps&&s.push(...d.tieMatchUps.map(Va))),!p});l.length&&(lm({matchUpIds:[...s,...l],drawDefinition:e,tournamentId:i,eventId:a}),u.some(d=>d.roundNumber===n)||(u.forEach(d=>{d.roundNumber>n&&(d.roundNumber-=1,sn({drawDefinition:e,tournamentId:i,eventId:a,matchUp:d}))}),c=!0),r.matchUps=u)}return{deletedMatchUpsCount:l.length,roundRemoved:c,...ue}}function qL(t){var e,i,n,r,a,o;let{suppressNotifications:s,tournamentRecord:l,drawDefinition:c,matchUps:u,event:d}=t;if(typeof c!="object")return{error:Lt};let p=t==null?void 0:t.structureId;if(!p&&((e=c.structures)==null?void 0:e.length)===1&&(p=(n=(i=c.structures)==null?void 0:i[0])==null?void 0:n.structureId),typeof p!="string")return{error:lc};if(!Zc(u))return{error:Me,info:Nh("matchUps")};let h=(r=c.structures)==null?void 0:r.find(y=>y.structureId===p);if(!h)return{error:Dr};let f=(h==null?void 0:h.matchUps).find(y=>!!y.roundPosition);if(h.structures||f||h.finishingPosition===lw)return{error:tw};let m=((o=(a=co({tournamentRecord:l,inContext:!1}))==null?void 0:a.matchUps)==null?void 0:o.map(Va))??[],g=u.map(Va);if(Ps(m,g))return{error:Sme,info:"One or more matchUpIds already present in tournamentRecord"};h.matchUps.push(...u);let v=u.map(({tieMatchUps:y})=>y).filter(Boolean).flat();return s||(lg({tournamentId:l==null?void 0:l.tournamentId,matchUps:[...v,...u],eventId:d==null?void 0:d.eventId,drawDefinition:c}),er({drawDefinition:c,structureIds:[p]})),{...ue}}function jye({tournamentRecord:t,drawDefinition:e,drawPosition:i,structureId:n,subOrder:r,event:a}){var o;if(!e)return{error:Lt};if(!n)return{error:lc};if(!i)return{error:iU};let{structure:s}=pi({drawDefinition:e,structureId:n});if(!s)return{error:Dr};let l=s;s.structures&&s.structureType===xs&&(l=(o=s.structures)==null?void 0:o.find(f=>{var m;return(m=f.positionAssignments)==null?void 0:m.find(g=>g.drawPosition===i)}));let c=l==null?void 0:l.positionAssignments,u=c==null?void 0:c.find(f=>f.drawPosition===i);u&&un({element:u,extension:{name:LS,value:r}});let d=((a==null?void 0:a.eventType)===Jn||e.matchUpType===Jn||((a==null?void 0:a.tieFormat)??(e==null?void 0:e.tieFormat)??(s==null?void 0:s.tieFormat)))&&{matchUpTypes:[Jn]},{matchUps:p}=Sn({structure:l,afterRecoveryTimes:!1,inContext:!0,matchUpFilters:d,event:a}),h=(s==null?void 0:s.matchUpFormat)??e.matchUpFormat;return X6({positionAssignments:c,tournamentRecord:t,drawDefinition:e,matchUpFormat:h,matchUps:p,event:a}),er({drawDefinition:e,structureIds:[n]}),{...ue}}var Gye={};zi(Gye,{addGoesTo:()=>ly,allPlayoffPositionsFilled:()=>j6,checkValidEntries:()=>ZL,findDrawDefinition:()=>o8,getAssignedParticipantIds:()=>Gy,getAvailableMatchUpsCount:()=>WL,getAvailablePlayoffProfiles:()=>TR,getDrawDefinitionTimeItem:()=>S6,getDrawParticipantRepresentativeIds:()=>r8,getDrawTypeCoercion:()=>AR,getEligibleVoluntaryConsolationParticipants:()=>n8,getMatchUpsMap:()=>ko,getParticipantIdFinishingPositions:()=>a8,getPositionAssignments:()=>DE,getPositionsPlayedOff:()=>EU,getSeedingThresholds:()=>O6,getSeedsCount:()=>_R,getStructureSeedAssignments:()=>Gc,getTeamLineUp:()=>sy,getValidGroupSizes:()=>yR,isAdHoc:()=>Ll,isCompletedStructure:()=>dg,isValidForQualifying:()=>f8,positionActions:()=>h8});function n8({excludedMatchUpStatuses:t=[],includeEventParticipants:e,includeQualifyingStage:i,finishingRoundLimit:n,policyDefinitions:r,roundNumberLimit:a,tournamentRecord:o,drawDefinition:s,matchUpsLimit:l,requirePlay:c,requireLoss:u,allEntries:d,winsLimit:p,event:h}){var f,m,g,v,y;if(!s)return{error:Lt};let b=[Ft,Br];i&&b.push(Xt);let I=h!=null&&h.eventType?{matchUpTypes:[h.eventType]}:void 0,T=s!=null&&s.matchUpType?{matchUpTypes:[s.matchUpType]}:void 0,w=e&&h?((f=pm({contextFilters:{stages:b},matchUpFilters:I,tournamentRecord:o,inContext:!0,event:h}))==null?void 0:f.matchUps)??[]:((m=Hs({contextFilters:{stages:b},matchUpFilters:T,tournamentRecord:o,inContext:!0,drawDefinition:s}))==null?void 0:m.matchUps)??[],S=uw({stage:to,drawDefinition:s}).map(({participantId:H})=>H),D={},E={},C={},P={};r||(r=cm({policyTypes:[ej],tournamentRecord:o,drawDefinition:s,event:h}).policyDefinitions);let R=r==null?void 0:r[ej];t=t.length&&t||(R==null?void 0:R.excludedMatchUpStatuses)||[],e=e??(R==null?void 0:R.includeEventParticipants),d=d??(R==null?void 0:R.allEntries),n=n??(R==null?void 0:R.finishingRoundLimit),a=a??(R==null?void 0:R.roundNumberLimit),l=l??(R==null?void 0:R.matchUpsLimit),c===void 0&&(c=(R==null?void 0:R.requirePlay)!==void 0?R.requirePlay:!0),u===void 0&&(u=(R==null?void 0:R.requireLoss)!==void 0?R.requireLoss:!0),p=p??(R==null?void 0:R.winsLimit);for(let H of w){if(c&&H.winningSide&&![1,2].includes(H.winningSide)&&H.matchUpStatus!==da||H.finishingRound&&n&&H.finishingRound>=n||H.finishingRound&&a&&H.finishingRound<=a)continue;let $=(g=H.sides)==null?void 0:g.find(({sideNumber:z})=>H.winningSide&&z===3-H.winningSide),q=(v=H.sides)==null?void 0:v.find(({sideNumber:z})=>H.winningSide&&z===H.winningSide);if((y=H.sides)==null||y.forEach(z=>{var Z;let Y=(Z=z==null?void 0:z.participant)==null?void 0:Z.participantId;Y&&(C[Y]=z.participant,H.matchUpStatus===da&&!c&&(E[Y]=z.participant,D[Y]||(D[Y]=0),(!H.matchUpStatus||!t.includes(H.matchUpStatus))&&(D[Y]+=1)))}),$==null?void 0:$.participant){let z=$.participant.participantId;E[z]=$.participant,D[z]||(D[z]=0),H.matchUpStatus&&!t.includes(H.matchUpStatus)&&(D[z]+=1)}if(q!=null&&q.participant){let z=q.participant.participantId;P[z]||(P[z]=0),P[z]+=1,D[z]||(D[z]=0),H.matchUpStatus&&!t.includes(H.matchUpStatus)&&(D[z]+=1)}}let N=(o==null?void 0:o.participants)&&!c&&!u&&d,M=N?((e&&h?h.entries:s.entries)??[]).filter(H=>![Vf,zu].includes(H.entryStatus)).map(({participantId:H})=>H):[],A=Object.keys(E),_=N?((o==null?void 0:o.participants)??[]).filter(({participantId:H})=>M.includes(H)):u&&Object.values(E)||Object.values(C),x=H=>!u||A.includes(H),O=H=>!c||(D[H]||0)>=0,B=H=>!p||(P[H]||0)<=p,F=H=>!l||D[H]<=l,G=H=>!S.includes(H);return{eligibleParticipants:_.filter(H=>x(H.participantId)&&O(H.participantId)&&B(H.participantId)&&F(H.participantId)&&G(H.participantId)).map(H=>{var $;return{...H,individualParticipants:($=H.individualParticipantIds)==null?void 0:$.map(q=>{var z;return(z=o==null?void 0:o.participants)==null?void 0:z.find(Z=>Z.participantId===q)})}}),losingParticipantIds:A,...ue}}function WL(t){var e,i,n,r,a,o,s,l;let c=mn(t,[{drawDefinition:!0}]);if(c.error)return c;let{drawDefinition:u,roundNumber:d}=t,p=t.structureId??(((e=u.structures)==null?void 0:e.length)===1&&((n=(i=u.structures)==null?void 0:i[0])==null?void 0:n.structureId));if(typeof p!="string")return{error:lc};let h=(r=u.structures)==null?void 0:r.find(w=>w.structureId===p);if(!h)return{error:Dr};let f,m=(a=h.matchUps??[])==null?void 0:a.reduce((w,S)=>(S.roundPosition&&(f=!0),((S==null?void 0:S.roundNumber)||0)>w?S.roundNumber:w),0);if(h.structures||f||h.finishingPosition===lw)return{error:tw};let g=((o=u==null?void 0:u.entries)==null?void 0:o.filter(w=>{let S=w.entryStatus;return qu.includes(S)}))??[],v=Math.floor((g==null?void 0:g.length)/2)||1,y=d??m??1,b=((l=(s=h.matchUps)==null?void 0:s.filter(w=>w.roundNumber===y))==null?void 0:l.length)??0,I=v-b,T=I>0?I:0;return{...ue,availableMatchUpsCount:T,lastRoundNumber:m,roundMatchUpsCount:v}}function r8({drawDefinition:t}){var e;let i=Bi({name:"participantRepresentatives",element:t});return i.error?i:{representativeParticipantIds:((e=i.extension)==null?void 0:e.value)||[]}}function N3e({tournamentParticipants:t,drawDefinition:e,event:i}){if(!e)return{error:Lt};let n=wa({tournamentParticipants:t,inContext:!0,drawDefinition:e,event:i}),r=$t(n.matchUps,!1,!0),a=ki(r.reduce((s,l)=>s.concat(...l.sides.map(c=>c.participantId).filter(Boolean)),[])),o=Object.assign({},...a.map(s=>{let l=r.filter(c=>c.sides.map(u=>u.participantId).filter(Boolean).includes(s));return{[s]:l}}));return{participantIds:a,participantIdMatchUps:o}}function a8({byeAdvancements:t=!1,tournamentRecord:e,drawDefinition:i}){if(!i)return{error:Lt};let{participantIds:n,participantIdMatchUps:r}=N3e({tournamentParticipants:e==null?void 0:e.participants,drawDefinition:i}),a=(n==null?void 0:n.map(o=>{let s=r[o].filter(d=>[ia,yn].includes(d.matchUpStatus)||d.winningSide),l=s.map(d=>{let p=d.sides.find(f=>f.bye),h=d.sides.find(f=>f.participantId===o).sideNumber;return(d.winningSide||t&&p&&h)===h?d.finishingPositionRange.winner:d.finishingPositionRange.loser}),c=d=>Math.abs(d[0]-d[1]),u=l.reduce((d,p)=>d&&c(d)<c(p)?d:p,void 0);return{[o]:{relevantMatchUps:s,finishingPositionRanges:l,finishingPositionRange:u}}}))||[];return Object.assign({},...a)}function jg({tournamentRecords:t,tournamentRecord:e,tournamentId:i,drawId:n}){if(!e&&!t)return{error:it};if(!n)return{error:Rd};if(!e&&t){if(typeof i!="string"&&(i=Aye({tournamentRecords:t,drawId:n}),!i))return{error:CS};if(e=t[i],!e)return{error:it}}let r=e&&Ks({tournamentRecord:e,drawId:n});return r!=null&&r.drawDefinition?{drawDefinition:r.drawDefinition,event:r.event,tournamentRecord:e,...ue}:fe({result:{error:_l},stack:"findDrawDefinition"})}function o8(t){let{drawDefinition:e,error:i}=jg(t);return i?{error:i}:{drawDefinition:$t(e)}}function gj({targetRoundNumber:t,finishingPosition:e,drawDefinition:i,structureId:n,linkType:r}){let{links:a}=wU({drawDefinition:i,structureId:n})||{},o=((a==null?void 0:a.target)||[]).filter(({linkType:s})=>s===r).filter(({target:s})=>!t||t===s.roundNumber).map(s=>{let l=s.source.structureId,{structure:c}=pi({structureId:l,drawDefinition:i});if(!(e&&(c==null?void 0:c.finishingPosition)!==e))return s}).filter(Boolean);return{sourceStructureIds:o.map(({source:s})=>s.structureId),relevantLinks:o}}var A3e="qualifierDrawPositionAssignment",_3e="withdrawParticipantAtDrawPosition",k3e="alternateDrawPositionAssignment",x3e="luckyLoserDrawPositionAssignment",nX="removeDrawPositionAssignment",O3e="swapDrawPositionAssignments",L3e="modifyPairAssignment",F3e="modifyParticipantOtherName",rX="assignDrawPosition",B3e="removeSeededParticipant",$3e="assignDrawPositionBye",V3e="modifySeedAssignment",Hye="addPenalty",s8="MODIFY_PAIR",KL="QUALIFIER",l8="ALTERNATE",c8="WITHDRAW",fI="ASSIGN",vj="REMOVE",u8="LUCKY",J1="REMOVE_SEED",d8="SWAP",UE="NICKNAME",Fb="SEED_VALUE",mI="PENALTY",L_="BYE",j3e={MODIFY_PAIR_ASSIGNMENT:s8,QUALIFYING_PARTICIPANT:KL,ALTERNATE_PARTICIPANT:l8,WITHDRAW_PARTICIPANT:c8,ASSIGN_PARTICIPANT:fI,LUCKY_PARTICIPANT:u8,REMOVE_ASSIGNMENT:vj,SWAP_PARTICIPANTS:d8,ADD_NICKNAME:UE,REMOVE_SEED:J1,ADD_PENALTY:mI,ASSIGN_BYE:L_,SEED_VALUE:Fb};function G3e({tournamentParticipants:t,returnParticipants:e,drawPosition:i,participant:n,drawId:r,event:a}){var o;let s=((o=a==null?void 0:a.entries)==null?void 0:o.filter(({entryStatus:l})=>[zu,Oy].includes(l)).map(({participantId:l})=>l))||[];if(s.length){let l=n.individualParticipantIds,c=e?t.filter(({participantId:d})=>s.includes(d)):void 0,u=e?t.filter(({participantId:d})=>l.includes(d)):void 0;return{validModifyAssignedPairAction:qt({payload:{participantId:n.participantId,replacementIndividualParticipantId:void 0,existingIndividualParticipantId:void 0,drawPosition:i,drawId:r},method:L3e,availableIndividualParticipantIds:s,availableIndividualParticipants:c,existingIndividualParticipantIds:l,existingIndividualParticipants:u,type:s8},!1,!1,!0)}}return{}}function uy(t){var e,i;let{inContextDrawMatchUps:n,targetData:r,drawDefinition:a,relevantLink:o}=t;if((o==null?void 0:o.linkCondition)===Ch&&((e=r==null?void 0:r.matchUp)==null?void 0:e.matchUpStatus)===yn)return!1;let{targetMatchUps:{loserMatchUp:s,winnerMatchUp:l},targetLinks:c}=r,u=[fn,Rn].includes(s==null?void 0:s.matchUpStatus),d=((i=l==null?void 0:l.drawPositions)==null?void 0:i.filter(Boolean).length)||0;if(s!=null&&s.winningSide&&!u||l!=null&&l.winningSide&&d===2&&(!l.feedRound||![Rn,fn].includes(l==null?void 0:l.matchUpStatus)))return!0;let p=s&&Ms({matchUpId:s.matchUpId,inContextDrawMatchUps:n,drawDefinition:a}),h=l&&Ms({matchUpId:l.matchUpId,inContextDrawMatchUps:n,drawDefinition:a}),f=p&&uy({relevantLink:c==null?void 0:c.loserTargetLink,targetData:p,inContextDrawMatchUps:n,drawDefinition:a});return!!(h&&uy({targetData:h,inContextDrawMatchUps:n,drawDefinition:a})||f)}var zye={[xf]:{policyName:"positionActionsDefault",enabledStructures:[{stages:[Xt,Ft],stageSequences:[1],enabledActions:[],disabledActions:[]},{stages:[],stageSequences:[],enabledActions:[UE,mI,KL,Fb],disabledActions:[]}],disbledStructures:[],otherFlightEntries:!1,activePositionOverrides:[]}},WN="positionAction",yj="matchUpAction";function qye({actionType:t=WN,appliedPolicies:e,drawDefinition:i,structure:n}){var r,a;let o=t===WN&&xf||t===yj&&eo,s=t===WN&&zye||t===yj&&Dve,l=o&&((e==null?void 0:e[o])||(s==null?void 0:s[o])),c=((a=(r=i.links)==null?void 0:r.filter(h=>{var f;return((f=h==null?void 0:h.target)==null?void 0:f.structureId)===(n==null?void 0:n.structureId)}))==null?void 0:a.map(({target:h})=>h.feedProfile))??[],{enabledStructures:u,disabledStructures:d}=l||{},p=d==null?void 0:d.find(h=>{let{stages:f,stageSequences:m,structureTypes:g,feedProfiles:v}=h;return(!(v!=null&&v.length)||Array.isArray(v)&&v.some(y=>c.includes(y)))&&(!(f!=null&&f.length)||Array.isArray(f)&&(f==null?void 0:f.includes(n==null?void 0:n.stage)))&&(!(g!=null&&g.length)||Array.isArray(g)&&(g==null?void 0:g.includes(n==null?void 0:n.structureType)))&&(!(m!=null&&m.length)||Array.isArray(m)&&m.includes(n==null?void 0:n.stageSequence))});return{enabledStructures:u,actionsDisabled:p,actionsPolicy:l}}function aX({activePositionOverrides:t,activeDrawPositions:e,action:i}){return i&&t.includes(i)?!0:!e.length}function Wye({enabledStructures:t,drawDefinition:e,structure:i}){var n,r;if(t===!1)return{};if(!(t!=null&&t.length))return{policyActions:{enabledActions:[],disabledActions:[]}};let{stage:a,stageSequence:o,structureType:s}=i||{},l=((r=(n=e.links)==null?void 0:n.filter(c=>{var u;return((u=c==null?void 0:c.target)==null?void 0:u.structureId)===(i==null?void 0:i.structureId)}))==null?void 0:r.map(({target:c})=>c.feedProfile))||[];return{policyActions:t.find(c=>{let{stages:u,stageSequences:d,structureTypes:p,feedProfiles:h}=c||{},f=!(u!=null&&u.length)||Array.isArray(u)&&u.includes(a),m=!(d!=null&&d.length)||Array.isArray(d)&&d.includes(o),g=!(p!=null&&p.length)||Array.isArray(p)&&p.includes(s),v=!(h!=null&&h.length)||Array.isArray(h)&&h.some(y=>l.includes(y));return m&&g&&v&&c&&f})}}function el({action:t,policyActions:e}){var i;let n=!(e!=null&&e.enabledActions)||((i=e==null?void 0:e.disabledActions)==null?void 0:i.length)&&e.disabledActions.includes(t);return n?!1:((e==null?void 0:e.enabledActions.length)===0||(e==null?void 0:e.enabledActions.includes(t)))&&!n}var Kye="replaceTieMatchUpParticipantId",Yye="assignTieMatchUpParticipantId",bj="removeTieMatchUpParticipantId",oX="assignMatchUpSideParticipant",H3e="removeMatchUpSideParticipant",Zye="substituteParticipant",Ij="REMOVE_SUBSTITUTION",Xye="REPLACE_PARTICIPANT",p8="REMOVE_PARTICIPANT",wj="setMatchUpStatus",Sj="SUBSTITUTION",Jye="SCHEDULE",z3e="PENALTY",Tj="REFEREE",Qye="STATUS",Uj="START",ebe="SCORE",Dj="END",q3e={REPLACE_TEAM_POSITION_METHOD:Kye,ASSIGN_TEAM_POSITION_METHOD:Yye,REMOVE_TEAM_POSITION_METHOD:bj,REPLACE_PARTICIPANT:Xye,SUBSTITUTION_METHOD:Zye,REMOVE_SUBSTITUTION:Ij,REMOVE_PARTICIPANT:p8,SCHEDULE_METHOD:wj,SUBSTITUTION:Sj,SCHEDULE:Jye,PENALTY:z3e,REFEREE:Tj,STATUS:Qye,SCORE:ebe,START:Uj,END:Dj};function W3e({specifiedPolicyDefinitions:t,inContextDrawMatchUps:e,matchUpParticipantIds:i,matchUpActionsPolicy:n,inContextMatchUp:r,policyActions:a,enforceGender:o,participantId:s,sideNumber:l,matchUpId:c,matchUp:u,drawId:d,side:p}){var h,f,m,g,v,y,b,I,T,w,S,D,E,C,P;let R=[],N=(h=r.sides)==null?void 0:h.find(X=>X.participant),M=r.gender===El&&r.sideNumber&&((f=r.sides)==null?void 0:f.filter(X=>X.particiapntId).length)===1&&((g=(m=N==null?void 0:N.participant)==null?void 0:m.person)==null?void 0:g.sex),A=r.matchUpType,_=(o??((v=n==null?void 0:n.participants)==null?void 0:v.enforceGender))!==!1?r.gender:void 0,x=(b=(y=r.sides)==null?void 0:y.flatMap(X=>{var oe;return((oe=X.participant)==null?void 0:oe.individualParticipants)||X.participant}).filter(Boolean))==null?void 0:b.map(Wi),O=(I=r.sides)==null?void 0:I.filter(X=>!l||X.sideNumber===l).flatMap(X=>{var oe;return((oe=X.participant)==null?void 0:oe.individualParticipants)||X.participant}).filter(Boolean),B=O==null?void 0:O.map(Wi),F=(w=(T=e==null?void 0:e.find(X=>X.matchUpId===r.matchUpTieId))==null?void 0:T.sides)==null?void 0:w.map(X=>{var oe;return(oe=X.participant)==null?void 0:oe.individualParticipants.filter(({participantId:re,person:me})=>!(B!=null&&B.includes(re))&&(!_||_===wp||me.sex===_||_===El&&!M||M&&me.sex!==M))}),G=l?F==null?void 0:F[l-1]:F==null?void 0:F.map((X,oe)=>({participants:X,sideNumber:oe+1})),H=l?(S=F==null?void 0:F[l-1])==null?void 0:S.map(Wi):F==null?void 0:F.map((X,oe)=>({participants:X==null?void 0:X.map(Wi),sideNumber:oe+1})),$=l&&(Hr(xb)(A)&&!(B!=null&&B.length)||Hr(ny)(A)&&((B==null?void 0:B.length)??0)<2)||!l&&(Hr(xb)(A)&&((B==null?void 0:B.length)??0)<2||Hr(ny)(A)&&((B==null?void 0:B.length)??0)<4),q=H==null?void 0:H.filter(X=>!(x!=null&&x.includes(X))),z=G==null?void 0:G.filter(({participantId:X})=>q.includes(X));if($&&q!=null&&q.length&&R.push({availableParticipantIds:q,method:Yye,availableParticipants:z,type:fI,payload:{participantId:void 0,tieMatchUpId:c,sideNumber:l,drawId:d}}),B!=null&&B.length&&(!uo(u)||(D=p==null?void 0:p.substitutions)!=null&&D.length)&&R.push({method:bj,type:p8,existingParticipantIds:B,payload:{participantId:void 0,tieMatchUpId:c,drawId:d}}),z!=null&&z.length&&(!l&&B!=null&&B.length||l&&p!=null&&p.participant)&&R.push({availableParticipantIds:q,method:Kye,availableParticipants:z,type:Xye,existingParticipantIds:B,payload:{existingParticipantId:void 0,participantId:void 0,tieMatchUpId:c,drawId:d}}),el({policyActions:a,action:Ij})&&((E=p==null?void 0:p.substitutions)==null?void 0:E.length)){let X=((C=p.participant)==null?void 0:C.participantType)===Ki&&[p.participantId]||((P=p.participant)==null?void 0:P.participantType)===Ui&&p.participant.individualParticipantIds||[],oe=p.substitutions.map(re=>re.participantId).filter(re=>X.includes(re));(!s||oe.includes(s))&&R.push({method:bj,type:Ij,substitutedParticipantIds:oe,payload:{participantId:void 0,tieMatchUpId:c,drawId:d}})}let Z=t==null?void 0:t[eo],Y=Z==null?void 0:Z.substituteWithoutScore,Q=Z==null?void 0:Z.substituteAfterCompleted;if(el({policyActions:a,action:Sj})&&i.length===2&&(!l&&B!=null&&B.length||l&&p!=null&&p.participant)&&(Y||uo(u))&&(Q||u.matchUpStatus&&!Ga.includes(u.matchUpStatus))&&O!=null&&O.length&&G.length){let X=O.map(Wi);R.push({info:"list of team players available for substitution",method:Zye,availableParticipantIds:H,existingParticipantIds:X,availableParticipants:G,existingParticipants:O,type:Sj,payload:{substituteParticipantId:void 0,existingParticipantId:void 0,sideNumber:l,matchUpId:c,drawId:d}})}return R}function K3e({tournamentParticipants:t=[],possiblyDisablingAction:e,activeDrawPositions:i,positionAssignments:n,returnParticipants:r,appliedPolicies:a,drawDefinition:o,drawPosition:s,validActions:l,structureId:c,structure:u,drawId:d,event:p}){var h,f,m,g,v;if(i.includes(s))return{};let y=(h=l.find(R=>R.type===fI))==null?void 0:h.availableParticipantIds,b=(f=a==null?void 0:a[xf])==null?void 0:f.otherFlightEntries,I=(m=a==null?void 0:a[xf])==null?void 0:m.restrictQualifyingAlternates,T=(o.entries??[]).filter(({entryStage:R})=>!I||(u.stage===Xt?R===Xt:R!==Xt)).sort((R,N)=>(R.entryPosition??1/0)-(N.entryPosition??1/0)).map(({participantId:R})=>R).filter(Boolean),{allPositionedParticipantIds:w}=Cge({drawDefinition:o}),S=n.map(R=>R.participantId).filter(Boolean),D=T.filter(R=>u.stage&&[Xt,Ft,Br].includes(u.stage)?!(w!=null&&w.includes(R)):!S.includes(R)),E=((p==null?void 0:p.entries)??[]).filter(R=>R.entryStatus===Su&&tbe({restrictQualifyingAlternates:I,structure:u,entry:R})&&(u.stage&&[Xt,Ft,Br].includes(u.stage)?!(w!=null&&w.includes(R.participantId)):!S.includes(R.participantId))).sort((R,N)=>(R.entryPosition??1/0)-(N.entryPosition??1/0)).map(R=>R.participantId),C=ki(D.concat(E));if(b){let R=(v=(g=p?Xr({event:p}).flightProfile:void 0)==null?void 0:g.flights)==null?void 0:v.filter(N=>N.drawId!==d).map(N=>N.drawEntries.filter(M=>M.participantId&&![Vf,zu,Oy].includes(M.entryStatus)&&!T.includes(M.participantId)).map(({participantId:M})=>M)).flat().filter(Boolean);R!=null&&R.length&&C.push(...R)}y!=null&&y.length&&(C=C.filter(R=>!y.includes(R)));let P=r?t==null?void 0:t.filter(R=>C.includes(R.participantId)):void 0;return P==null||P.forEach(R=>{let N=(o.entries??[]).find(M=>M.participantId===R.participantId);R.entryPosition=N==null?void 0:N.entryPosition}),P==null||P.sort((R,N)=>(R.entryPosition||1/0)-(N.entryPosition||1/0)),C.length?{validAlternatesAction:qt({payload:{drawId:d,structureId:c,drawPosition:s},willDisableLinks:e,method:k3e,availableAlternatesParticipantIds:C,type:l8,availableAlternates:P})}:{}}function tbe({restrictQualifyingAlternates:t,structure:e,entry:i}){let{stage:n}=e;if(!i.entryStage||i.entryStage===n||n===Xt&&!t||i.entryStage===Ft&&n===Mo)return!0}function Y3e({eventEntries:t,structure:e}){let i=r=>r.entryStatus===Su&&tbe({structure:e,entry:r}),n=(r,a)=>(r.entryPosition||1/0)-(a.entryPosition||1/0);return t.filter(i).sort(n).map(Wi)}function Z3e({restrictAdHocRoundParticipants:t,tournamentParticipants:e,matchUpParticipantIds:i,otherFlightEntries:n,drawDefinition:r,structureId:a,sideNumber:o,matchUpId:s,structure:l,matchUp:c,drawId:u,event:d}){var p,h,f,m,g;let v=[],y=((l==null?void 0:l.matchUps)??[]).filter(({roundNumber:P})=>P===c.roundNumber),b=((p=r==null?void 0:r.entries)==null?void 0:p.filter(({entryStatus:P})=>P&&Ly.includes(P)).map(Wi))??[],I=y.map(P=>(P.sides??[]).flatMap(Wi)).flat().filter(Boolean),T=b.filter(P=>!i.includes(P)&&(!t||!I.includes(P))),w=e==null?void 0:e.filter(P=>T==null?void 0:T.includes(P.participantId)).map(P=>$t(P,void 0,!0));w==null||w.forEach(P=>{let R=(r.entries??[]).find(N=>N.participantId===P.participantId);P.entryPosition=R==null?void 0:R.entryPosition}),T.length&&v.push({payload:{drawId:u,matchUpId:s,structureId:a,sideNumber:o},method:oX,type:fI,availableParticipantIds:T,participantsAvailable:w});let S=(d==null?void 0:d.entries)??[],D=Y3e({eventEntries:S,structure:l}),E=ki(b.concat(D));if(n){let P=(f=(h=d?Xr({event:d}):void 0)==null?void 0:h.flights)==null?void 0:f.filter(R=>R.drawId!==u).flatMap(R=>R.drawEntries.filter(N=>N.participantId&&![Vf,zu,Oy].includes(N.entryStatus)).map(({participantId:N})=>N)).filter(Boolean);P!=null&&P.length&&E.push(...P)}E=E.filter(P=>!i.includes(P)&&!T.includes(P)&&(!t||!I.includes(P)));let C=e==null?void 0:e.filter(P=>E.includes(P.participantId)).map(P=>$t(P,void 0,!0));return C==null||C.forEach(P=>{let R=(r.entries??[]).find(N=>N.participantId===P.participantId);P.entryPosition=R==null?void 0:R.entryPosition}),C==null||C.sort((P,R)=>(P.entryPosition||1/0)-(R.entryPosition||1/0)),E.length&&v.push({payload:{drawId:u,matchUpId:s,structureId:a,sideNumber:o},availableParticipantIds:E,participantsAvailable:C,method:oX,type:Su}),!uo(c)&&o&&(g=(m=c.sides)==null?void 0:m.find(P=>P.sideNumber===o))!=null&&g.participantId&&v.push({payload:{drawId:u,matchUpId:s,structureId:a,sideNumber:o},method:H3e,type:p8}),v}function YL(t){var e,i,n,r,a,o,s,l,c;if(!t)return{error:Me};let{drawDefinition:u,event:d}=t,{restrictAdHocRoundParticipants:p=!0,policyDefinitions:h,enforceGender:f,participantId:m,sideNumber:g,matchUpId:v}=t,y=t.tournamentRecord??(t.tournamentId&&qs(t.tournamentId)&&((e=t.tournamentRecords)==null?void 0:e[t.tournamentId]));if(!y)return{error:it};if(!v||!qs(v))return{error:_o};if(g&&![1,2].includes(g))return fe({result:{error:Me},context:{sideNumber:g}});if(!u){let Ie=(co({tournamentRecord:y}).matchUps??[]).find(Te=>Te.matchUpId===v);d=((y==null?void 0:y.events)??[]).find(Te=>Te.eventId===(Ie==null?void 0:Ie.eventId));let De=((d==null?void 0:d.drawDefinitions)??[]).find(Te=>Te.drawId===(Ie==null?void 0:Ie.drawId));De&&(u=De)}if(!u)return{error:Lt};let b=Yr({withIndividualParticipants:!0,tournamentRecord:y}).participants,{drawId:I}=u,{matchUp:T,structure:w}=ar({drawDefinition:u,matchUpId:v,event:d});if(!T)return{error:qo};let S=Mn({tournamentRecord:y,drawDefinition:u,structure:w,event:d}).appliedPolicies??{};Object.assign(S,h??{});let D=(i=S==null?void 0:S[xf])==null?void 0:i.otherFlightEntries,E=(S==null?void 0:S[eo])??UU[eo],{enabledStructures:C}=qye({actionType:yj,appliedPolicies:S,drawDefinition:u,structure:w}),{policyActions:P}=Wye({enabledStructures:C,drawDefinition:u,structure:w}),R=t.matchUpsMap??ko({drawDefinition:u}),N=t.inContextDrawMatchUps??wa({tournamentParticipants:b,inContext:!0,drawDefinition:u,matchUpsMap:R,event:d}).matchUps,M=N==null?void 0:N.find(Ie=>Ie.matchUpId===v),A=g&&((n=M==null?void 0:M.sides)==null?void 0:n.find(Ie=>Ie.sideNumber===g)),_=((r=M==null?void 0:M.sides)==null?void 0:r.map(Ie=>{var De;return Ie.participantId||((De=Ie.participant)==null?void 0:De.participantid)}).filter(Boolean))??[],{assignedPositions:x,allPositionsAssigned:O}=Ha({structure:w}),{structureId:B}=w??{},F=[];if(!B)return{validActions:F};let G=Ll({structure:w}),H=T.collectionId;if(G&&!H){let Ie=Z3e({restrictAdHocRoundParticipants:p,tournamentParticipants:b,matchUpParticipantIds:_,otherFlightEntries:D,drawDefinition:u,structureId:B,sideNumber:g,matchUpId:v,structure:w,matchUp:T,drawId:I,event:d});F.push(...Ie)}let $=dg({drawDefinition:u,structure:w}),q=x==null?void 0:x.filter(Ie=>Ie.participantId).map(Ie=>Ie.drawPosition),z=x==null?void 0:x.filter(Ie=>Ie.bye).map(Ie=>Ie.drawPosition),Z=T.matchUpStatus===yn||!H&&((a=T.drawPositions)==null?void 0:a.reduce((Ie,De)=>(z==null?void 0:z.includes(De))||Ie,!1));if(Z)return{validActions:F,isByeMatchUp:Z};el({policyActions:P,action:Tj})&&F.push({type:Tj,payload:{matchUpId:v}});let Y=!pR({matchUpStatus:T.matchUpStatus}),Q=(o=S==null?void 0:S.scoring)==null?void 0:o.structures,X=(w==null?void 0:w.stage)&&(Q==null?void 0:Q.stage)&&(Q==null?void 0:Q.stage[w.stage]),oe=(w==null?void 0:w.stageSequence)&&(X==null?void 0:X.stageSequence)&&X.stageSequence[w.stageSequence],re=!((s=S==null?void 0:S.scoring)!=null&&s.requireAllPositionsAssigned||X!=null&&X.requireAllPositionsAssigned||oe!=null&&oe.requireAllPositionsAssigned)||O,me=T.sides&&T.sides.filter(Ie=>Ie==null?void 0:Ie.participantId).length===2,se=T.matchUpStatus&&[da,Ca].includes(T.matchUpStatus),te=Ms({inContextDrawMatchUps:N,drawDefinition:u,matchUpId:v}),he=uy({inContextDrawMatchUps:N,drawDefinition:u,targetData:te}),ae=(((l=M==null?void 0:M.drawPositions)==null?void 0:l.length)===2&&M.drawPositions.every(Ie=>q==null?void 0:q.includes(Ie))&&((c=M==null?void 0:M.sides)==null?void 0:c.length)===2&&M.sides.every(({participantId:Ie})=>Ie)||me)&&!(se&&he),de={method:Hye,type:mI,payload:{drawId:I,matchUpId:v,penaltyCode:void 0,penaltyType:void 0,participantIds:[],notes:void 0}};if(Y&&F.push({payload:{drawId:I,matchUpId:v,schedule:{}},method:wj,type:Jye}),el({policyActions:P,action:mI})&&(A!=null&&A.participant||!g&&_!=null&&_.length)&&F.push(de),Y&&ae&&F.push({type:Qye}),re&&ae){let{matchUpId:Ie,matchUpFormat:De}=T,Te={drawId:I,matchUpId:Ie,matchUpFormat:De,outcome:{scoreStringSide1:void 0,scoreStringSide2:void 0,sets:[]},winningSide:void 0};F.push({info:"set outcome and winningSide",method:wj,type:ebe,payload:Te}),el({policyActions:P,action:Uj})&&F.push({type:Uj}),el({policyActions:P,action:Dj})&&F.push({type:Dj})}if(H&&M){let Ie=W3e({specifiedPolicyDefinitions:h,inContextDrawMatchUps:N,matchUpParticipantIds:_,matchUpActionsPolicy:E,inContextMatchUp:M,policyActions:P,enforceGender:f,participantId:m,sideNumber:g,matchUpId:v,matchUp:T,drawId:I,side:A});F.push(...Ie)}return{structureIsComplete:$,validActions:F,isDoubleExit:se,...ue}}function X3e({tournamentParticipants:t=[],sourceStructuresComplete:e,possiblyDisablingAction:i,isWinRatioFedStructure:n,activeDrawPositions:r,positionAssignments:a,drawDefinition:o,drawPosition:s,structureId:l,structure:c,drawId:u,event:d}){var p,h,f,m,g,v,y;if(r.includes(s)||n&&!e)return{};let{sourceStructureIds:b,targetStructureIds:I}=((p=o.links)==null?void 0:p.reduce((D,E)=>{var C,P;let R=(C=E.source)==null?void 0:C.structureId,N=(P=E.target)==null?void 0:P.structureId;return D.sourceStructureIds.includes(R)||D.sourceStructureIds.push(R),D.targetStructureIds.includes(N)||D.targetStructureIds.push(N),D},{sourceStructureIds:[],targetStructureIds:[]}))||{},T=[],w=((h=o.links)==null?void 0:h.filter(D=>{var E;return((E=D.target)==null?void 0:E.structureId)===c.structureId}))??[];for(let D of w){let E=(f=D==null?void 0:D.source)==null?void 0:f.structureId,{structure:C}=pi({structureId:E,drawDefinition:o}),P=(C==null?void 0:C.finishingPosition)===lw&&((b==null?void 0:b.length)!==1||(I==null?void 0:I.length)!==1),R={};if(P){let{matchUps:A}=Sn({drawDefinition:o,structure:c,event:d}),{initialRoundNumber:_}=hI({drawPosition:s,matchUps:A}),x=(v=(g=(m=o.links)==null?void 0:m.find(O=>{var B;return((B=O.target)==null?void 0:B.structureId)===(c==null?void 0:c.structureId)&&O.target.roundNumber===_}))==null?void 0:g.source)==null?void 0:v.roundNumber;R.roundNumbers=[x]}let{completedMatchUps:N}=AL({structureId:E,inContext:!0,matchUpFilters:R,drawDefinition:o}),M=a.map(A=>A.participantId).filter(Boolean);(y=N==null?void 0:N.filter(({matchUpType:A,winningSide:_})=>_&&((d==null?void 0:d.eventType)!==Fa||A===Fa)).map(({winningSide:A,sides:_})=>A&&(_==null?void 0:_[1-(A-1)])).map(Wi).filter(A=>A&&!M.includes(A)))==null||y.forEach(A=>{T.includes(A)||T.push(A)})}let S=t==null?void 0:t.filter(D=>T==null?void 0:T.includes(D.participantId));return S==null||S.forEach(D=>{let E=(o.entries??[]).find(C=>C.participantId===D.participantId);D.entryPosition=E==null?void 0:E.entryPosition}),T!=null&&T.length?{validLuckyLosersAction:{type:u8,method:x3e,availableLuckyLosers:S,availableLuckyLoserParticipantIds:T,willDisableLinks:i,payload:{drawId:u,structureId:l,drawPosition:s}}}:{}}function J3e({positionSourceStructureIds:t,unassignedParticipantIds:e,possiblyDisablingAction:i,provisionalPositioning:n,tournamentParticipants:r,isWinRatioFedStructure:a,positionAssignments:o,returnParticipants:s,appliedPolicies:l,drawDefinition:c,seedingProfile:u,isByePosition:d,drawPosition:p,structureId:h,event:f}){var m,g,v;let{drawId:y}=c,b=[],I,T,w=[],S=(g=(m=l==null?void 0:l[du])==null?void 0:m.validSeedPositions)==null?void 0:g.ignore;if(S||({unplacedSeedParticipantIds:I,unplacedSeedAssignments:T,unfilledPositions:w}=Fve({provisionalPositioning:n,returnAllProxies:!0,randomize:!0,drawDefinition:c,seedingProfile:u,structureId:h,event:f})),w!=null&&w.length||(w=o.filter(D=>!D.participantId&&!D.bye&&!D.qualifier).map(D=>D.drawPosition)),d||b.push({payload:{drawId:y,structureId:h,drawPosition:p,isPositionAction:!0},willDisableLinks:i,method:$3e,type:L_}),a&&S){let D=o.map(N=>N.participantId).filter(Boolean),E={structureIds:t},{completedMatchUps:C}=SU({inContext:!0,matchUpFilters:E,drawDefinition:c}),P=ki((v=(C??[]).filter(({matchUpType:N})=>(f==null?void 0:f.eventType)!==Fa||N===Fa))==null?void 0:v.map(({sides:N})=>N==null?void 0:N.map(Wi)).flat().filter(N=>N&&!D.includes(N))),R=s?r==null?void 0:r.filter(N=>P==null?void 0:P.includes(N.participantId)).map(N=>$t(N,void 0,!0)):void 0;return R==null||R.forEach(N=>{let M=(c.entries??[]).find(A=>A.participantId===N.participantId);N.entryPosition=M==null?void 0:M.entryPosition}),R!=null&&R.length&&b.push(qt({payload:{drawId:y,structureId:h,drawPosition:p},willDisableLinks:i,method:rX,type:fI,availableParticipantIds:P,participantsAvailable:R})),{validAssignmentActions:b}}if(w.includes(p)||d){let D;if(T!=null&&T.length){let C=T.filter(P=>I==null?void 0:I.includes(P.participantId));C.sort(Q3e),D=C.map(P=>P.participantId)}else D=e;let E=s?r==null?void 0:r.filter(C=>D.includes(C.participantId)).map(C=>$t(C,void 0,!0)):void 0;E!=null&&E.length&&b.push(qt({payload:{drawId:y,structureId:h,drawPosition:p},willDisableLinks:i,method:rX,type:fI,availableParticipantIds:D,participantsAvailable:E}))}return{validAssignmentActions:b}}function Q3e(t,e){return t.bye||HS(t.seedValue)<HS(e.seedValue)||t.seedValue&&!e.seedValue?-1:(t.seedNumber||0)-(e.seedNumber||0)}function eWe({drawPositionInitialRounds:t,tournamentParticipants:e,positionAssignments:i,returnParticipants:n,appliedPolicies:r,drawDefinition:a,drawPosition:o,structureId:s,drawId:l}){var c,u,d;let p=[],h=[],f=[],m=[],g=i.map(D=>D.participantId).filter(Boolean),v=r==null?void 0:r[xf],y=!(v!=null&&v.disableRoundRestrictions)&&t[o],b=v==null?void 0:v.requireCompletedStructures,{sourceStructureIds:I,relevantLinks:T}=gj({targetRoundNumber:y,linkType:Bf,drawDefinition:a,structureId:s})||{};I!=null&&I.length&&m.push(...I);let{sourceStructureIds:w,relevantLinks:S}=gj({targetRoundNumber:y,linkType:Ff,drawDefinition:a,structureId:s})||{};w!=null&&w.length&&m.push(...w);for(let D of T){let E=(c=a.structures)==null?void 0:c.find(P=>P.structureId===D.source.structureId);if((E==null?void 0:E.stage)!==Xt)continue;let C=dg({structureId:D.source.structureId,drawDefinition:a});if(!b||C){let P=E.qualifyingRoundNumber,{matchUps:R}=Sn({matchUpFilters:{roundNumbers:[P],hasWinningSide:!0},afterRecoveryTimes:!1,tournamentParticipants:e,inContext:!0,structure:E});for(let N of R){let M=N.sides.find(_=>(_==null?void 0:_.sideNumber)===N.winningSide),A=N.matchUpStatus===yn&&((u=N.sides)==null?void 0:u.find(({participantId:_})=>_));if(M||A){let{participantId:_,participant:x}=M||A||{};_&&!g.includes(_)&&(x&&n&&p.push(x),h.push(_))}}}}for(let D of S){let E=(d=a.structures)==null?void 0:d.find(P=>P.structureId===D.source.structureId);if((E==null?void 0:E.stage)!==Xt)continue;let C=dg({structureId:D.source.structureId,drawDefinition:a});if(!b||C){let{positionAssignments:P}=jn({structure:E}),R=(P==null?void 0:P.map(N=>{var M;let A=N.participantId,_=(M=Bi({element:N,name:og}).extension)==null?void 0:M.value;return _?{participantId:A,groupOrder:_==null?void 0:_.groupOrder}:{}}).filter(({groupOrder:N,participantId:M})=>N===1&&!g.includes(M)).map(({participantId:N})=>N))??[];if(R&&h.push(...R),n){let N=e.filter(({participantId:M})=>R.includes(M));p.push(...N)}}}return h.length&&f.push(qt({payload:{qualifyingParticipantId:void 0,drawPosition:o,structureId:s,drawId:l},method:A3e,type:KL,qualifyingParticipantIds:h,qualifyingParticipants:n?p:void 0})),{validAssignmentActions:f,sourceStructureIds:m}}function tWe({onlyAssignedPositions:t=!0,possiblyDisablingAction:e,tournamentParticipants:i,inactiveDrawPositions:n,activeDrawPositions:r,positionAssignments:a,returnParticipants:o,byeDrawPositions:s,drawDefinition:l,isByePosition:c,drawPosition:u,structureId:d,structure:p,drawId:h,event:f}){if(r.includes(u))return{};let m=C=>!t||C.participantId||C.qualifier||C.bye,g=n==null?void 0:n.filter(C=>C!==u&&!(c&&s.includes(C))),v=(a==null?void 0:a.filter(C=>m(C)&&(g==null?void 0:g.includes(C.drawPosition))))??[],y=v.map(({drawPosition:C})=>C),{matchUps:b}=Sn({afterRecoveryTimes:!1,inContext:!0,drawDefinition:l,structure:p,event:f}),I=b.filter(({drawPositions:C})=>Ps(C,y)),T=Object.assign({},...I.map(C=>{var P;return(P=C.sides)==null?void 0:P.filter(({sourceDrawPositionRange:R})=>R).map(({drawPosition:R,sourceDrawPositionRange:N})=>({[R]:N}))}).flat()),w=v.map(C=>C.participantId).filter(Boolean),S=(i??[]).filter(C=>w.includes(C.participantId)),D=Object.assign({},...S.map(C=>({[C.participantId]:C}))),E=v.map(C=>{let P=D==null?void 0:D[C.participantId],R=T[C.drawPosition];return qt({...C,participant:o?$t(P,!1,!0):void 0,sourceDrawPositionRange:R})});return E.length?{validSwapAction:{payload:{drawId:h,structureId:d,drawPositions:[u]},willDisableLinks:e,method:O3e,type:d8,availableAssignments:E}}:{}}function h8(t){var e;let i=mn(t,[{event:!0,drawDefinition:!0,structureId:!0}]);if(i.error)return i;let{policyDefinitions:n,returnParticipants:r=!0,provisionalPositioning:a,tournamentRecord:o,drawDefinition:s,drawPosition:l,event:c}=t,u=t.tournamentParticipants??(o&&Yr({withIndividualParticipants:!0,tournamentRecord:o}).participants)??[],d=pi({structureId:t.structureId,drawDefinition:s});if(d.error)return d;let p=d.containingStructure||d.structure;if(!p)return{error:Dr};let h=p.structureId;if(d=hR({drawDefinition:s,structureId:h}),l===void 0&&!d.isAdHoc)return{error:iU};if(d.isAdHoc)return YL(t);if(d.error)return d;let{drawPositionInitialRounds:f,inactiveDrawPositions:m,activeDrawPositions:g,byeDrawPositions:v}=d,y=Mn({tournamentRecord:o,drawDefinition:s,structure:p,event:c}).appliedPolicies??{};Object.assign(y,n??{});let{actionsPolicy:b,enabledStructures:I,actionsDisabled:T}=qye({actionType:WN,appliedPolicies:y,drawDefinition:s,structure:p}),w=(b==null?void 0:b.activePositionOverrides)||[],{sourceStructureIds:S}=gj({finishingPosition:gU,targetRoundNumber:1,linkType:Ff,drawDefinition:s,structureId:h})||{},D;S!=null&&S.length&&(D=S.reduce((Q,X)=>dg({structureId:X,drawDefinition:s})&&Q,!0));let E=S.length,C=S.length&&!D,{policyActions:P}=Wye({enabledStructures:I,drawDefinition:s,structure:p}),R=![Xt,Ft].includes(p.stage)||p.stageSequence!==1,{drawId:N}=s,M=[],{assignedPositions:A,positionAssignments:_}=Ha({structure:p}),x=A==null?void 0:A.find(Q=>Q.drawPosition===l);if(!((e=_==null?void 0:_.map(Q=>Q.drawPosition))!=null&&e.includes(l)))return{error:tU};let{stage:O,stageSequence:B}=p,F=[O];O===Mo&&F.push(Ft),O===Ft&&F.push(Mo);let G=uw({entryStatuses:Ly,provisionalPositioning:a,drawDefinition:s,stageSequence:B,structureId:h,stages:F}),H=Gy({drawDefinition:s,stages:F}).assignedParticipantIds??[],$=G.filter(Q=>!H.includes(Q.participantId)).map(Q=>Q.participantId),q=v.includes(l),z=g.includes(l);if(T)return{hasPositionAssigned:!!x,info:"Actions Disabled for structure",isActiveDrawPosition:z,isDrawPosition:!0,validActions:[],isByePosition:q};if(el({policyActions:P,action:fI})&&!z&&_&&!C&&(!x||q)){let{validAssignmentActions:Q}=J3e({positionSourceStructureIds:S,unassignedParticipantIds:$,possiblyDisablingAction:R,isWinRatioFedStructure:E,tournamentParticipants:u,positionAssignments:_,returnParticipants:r,appliedPolicies:y,drawDefinition:s,isByePosition:q,drawPosition:l,structureId:h,event:c});Q==null||Q.forEach(X=>M.push(X))}if(el({policyActions:P,action:KL})){let{validAssignmentActions:Q}=eWe({drawPositionInitialRounds:f,tournamentParticipants:u,positionAssignments:_,returnParticipants:r,appliedPolicies:y,drawDefinition:s,drawPosition:l,structureId:h,drawId:N});Q==null||Q.forEach(X=>M.push(X))}let{participantId:Z}=x||{},Y=Z&&u.find(Q=>Q.participantId===Z);if(x){el({policyActions:P,action:vj})&&!z&&(M.push({type:vj,method:nX,payload:{drawId:N,structureId:h,drawPosition:l},willDisableLinks:R}),q||M.push({type:c8,method:_3e,payload:{drawId:N,structureId:h,drawPosition:l},willDisableLinks:R}),el({policyActions:P,action:L_})&&!q&&M.push({type:L_,method:nX,payload:{drawId:N,structureId:h,drawPosition:l,replaceWithBye:!0},willDisableLinks:R}));let Q=p.stage===Xt||p.stage===Ft&&p.stageSequence===1;if(!q&&aX({activePositionOverrides:w,activeDrawPositions:g,action:Fb})&&el({policyActions:P,action:Fb})&&A_({drawDefinition:s,structureId:h,drawPosition:l})&&Q){let{seedAssignments:X}=Gc({returnAllProxies:!0,drawDefinition:s,structure:p}),{seedNumber:oe,seedValue:re}=(X==null?void 0:X.find(me=>me.participantId===Z))??{};M.push({type:Fb,method:V3e,participant:Y,seedNumber:oe,payload:{drawId:N,structureId:h,participantId:Z,seedValue:re}})}if(!q&&aX({activePositionOverrides:w,activeDrawPositions:g,action:J1})&&el({policyActions:P,action:J1})&&A_({drawDefinition:s,structureId:h,drawPosition:l})&&Q){let{seedAssignments:X}=Gc({returnAllProxies:!0,drawDefinition:s,structure:p}),{seedNumber:oe}=(X==null?void 0:X.find(re=>re.participantId===Z))??{};M.push({method:B3e,type:J1,participant:Y,seedNumber:oe,payload:{participantId:Z,structureId:h,drawId:N}})}if(!q&&Z){if(el({policyActions:P,action:mI})){let X={type:mI,method:Hye,participant:Y,payload:{penaltyCode:void 0,penaltyType:void 0,participantIds:[],notes:void 0,drawId:N}};M.push(X)}if(el({policyActions:P,action:UE})){let X={type:UE,method:F3e,participant:Y,payload:{participantId:Z,otherName:void 0}};M.push(X)}}if(el({policyActions:P,action:d8})){let{validSwapAction:X}=tWe({possiblyDisablingAction:R,tournamentParticipants:u,inactiveDrawPositions:m,activeDrawPositions:g,positionAssignments:_,returnParticipants:r,byeDrawPositions:v,drawDefinition:s,isByePosition:q,drawPosition:l,structureId:h,structure:p,drawId:N});X&&M.push(X)}}if(el({policyActions:P,action:l8})&&!C){let{validAlternatesAction:Q}=K3e({possiblyDisablingAction:R,tournamentParticipants:u,positionAssignments:_,activeDrawPositions:g,returnParticipants:r,appliedPolicies:y,drawDefinition:s,drawPosition:l,validActions:M,structureId:h,structure:p,drawId:N,event:c});Q&&M.push(Q)}if(el({policyActions:P,action:u8})&&!C&&_){let{validLuckyLosersAction:Q}=X3e({sourceStructuresComplete:D,possiblyDisablingAction:R,isWinRatioFedStructure:E,tournamentParticipants:u,activeDrawPositions:g,positionAssignments:_,drawDefinition:s,drawPosition:l,structureId:h,structure:p,drawId:N});Q&&M.push(Q)}if((Y==null?void 0:Y.participantType)===Ui&&el({policyActions:P,action:s8})){let{validModifyAssignedPairAction:Q}=G3e({tournamentParticipants:u,returnParticipants:r,drawPosition:l,participant:Y,drawId:N,event:c});Q&&M.push(Q)}return{hasPositionAssigned:!!x,isActiveDrawPosition:z,isDrawPosition:!0,isByePosition:q,validActions:M,...ue}}function AR({policyDefinitions:t,appliedPolicies:e,drawType:i}){var n,r;let a=(n=t==null?void 0:t[w_])==null?void 0:n.drawTypeCoercion,o=(r=e==null?void 0:e[w_])==null?void 0:r.drawTypeCoercion;return(typeof a=="boolean"?a:void 0)??(i&&(a==null?void 0:a[i]))??(typeof o=="boolean"?o:void 0)??(i&&(o==null?void 0:o[i]))??!0}function DE({tournamentRecord:t,drawDefinition:e,stage:i=Ft,structureId:n,structure:r}){var a;if(!t)return{error:it};if(!r&&!e)return{error:Lt};if(!r&&!n&&((a=e==null?void 0:e.structures)==null?void 0:a.filter(l=>l.stage===i).length)===1&&(r=e.structures.find(l=>l.stage===i)),!r&&!n)return{error:lc};let{error:o,positionAssignments:s}=jn({drawDefinition:e,structureId:n,structure:r});return{positionAssignments:s??[],structureId:r==null?void 0:r.structureId,error:o}}function f8({structureId:t,drawDefinition:e}){if(!e)return{error:Lt};if(!qs(t))return{error:Me};let i=wU({drawDefinition:e,structureId:t});if(i.error)return i;let n=i.links.target.flatMap(a=>a.target.feedProfile).filter(Boolean),r=!Wr([iy,gu,bL,ty],n).length;return{...ue,valid:r}}function ibe({participantsCount:t,participantCount:e}){if(t=t??e,!t)return{error:Me};let i=lU(t);return i?{drawSize:i}:fe({result:{error:Me},stack:"getEliminationDrawSize",context:{participantsCount:t}})}function _R(t){let{drawSizeProgression:e=!1,policyDefinitions:i,drawSize:n}=t||{},{requireParticipantCount:r=!0,tournamentRecord:a,drawDefinition:o,event:s}=t||{},l="getSeedsCount",c=(t==null?void 0:t.participantsCount)??(t==null?void 0:t.participantCount);if(!i){let f=cm({tournamentRecord:a,drawDefinition:o,event:s});if(f.error)return fe({result:f,stack:l});i=f.policyDefinitions}let u=bi(c);if(c&&!u)return fe({result:{error:Me},context:{participantsCount:c},stack:l});if(r&&!u)return fe({result:{error:Jfe},stack:l});if(isNaN(n))if(c)({drawSize:n}=ibe({participantsCount:c}));else return fe({result:{error:_P},stack:l});let d=r&&c||n;if(d&&d>n)return{error:n5};let p=i==null?void 0:i[du];if(!p)return{error:Vfe};let h=p.seedsCountThresholds;return h?(p.drawSizeProgression!==void 0&&(e=p.drawSizeProgression),{seedsCount:h.filter(f=>e?f.drawSize<=n:n===f.drawSize).reduce((f,m)=>c&&c>=m.minimumParticipantCount?m.seedsCount:f,0)}):{error:Efe}}function ZL({consideredEntries:t,policyDefinitions:e,tournamentRecord:i,appliedPolicies:n,participantMap:r,enforceGender:a,participants:o,event:s}){var l;if((!o||!r)&&i&&({participants:o,participantMap:r}=Yr({tournamentRecord:i})),!o)return{error:OP};if(!Array.isArray(o))return{error:Me};if(!s)return{error:_n};let c=(e==null?void 0:e[eo])??(n==null?void 0:n[eo])??UU[eo],u=(a??((l=c==null?void 0:c.participants)==null?void 0:l.enforceGender))!==!1,{eventType:d,gender:p}=s,h=d===ug,f=d===Hc&&Hn||h&&Ui||Ki,m=Object.assign({},...(t??s.entries??[]).map(y=>({[y.participantId]:y.entryStatus}))),g=Object.keys(m),v=o.filter(y=>g.includes(y.participantId)).filter(y=>{let b=iWe({participant:y,participantType:f,eventType:d,entryStatusMap:m}),I=nWe({genderEnforced:u,participantMap:r,eventGender:p,participant:y,isDoubles:h,mismatch:b});return b||!I});if(v.length){let y=v.map(b=>b.participantId);return{error:xfe,invalidParticipantIds:y}}return{...ue,valid:!0}}function iWe({participant:t,participantType:e,eventType:i,entryStatusMap:n}){let r=n[t.participantId],a=i&&[ug,Hc].includes(i)&&t.participantType===Ki&&(hv(r)||r===Vf);return t.participantType!==e&&!a}function nWe(t){var e,i,n;let{participant:r,participantMap:a,eventGender:o,mismatch:s,isDoubles:l,genderEnforced:c}=t,u=!s&&l&&ki(((e=r==null?void 0:r.individualParticipantIds)==null?void 0:e.map(f=>{var m,g,v;return(v=(g=(m=a==null?void 0:a[f])==null?void 0:m.participant)==null?void 0:g.person)==null?void 0:v.sex}).filter(Boolean))??[])||[],d=!o||!(u!=null&&u.length)||wp===o||[Yn,Ir].includes(o)&&u[0]===o||El===o&&(u.length==1&&((i=r.individualParticipantIds)==null?void 0:i.length)===1||u.length===2),p=(n=r==null?void 0:r.person)==null?void 0:n.sex,h=!(r!=null&&r.person)||!o||[wp,El].includes(o)||[Yn,Ir].includes(o)&&p===o;return!c||d&&h}function nbe({qualifyingProfiles:t,appliedPolicies:e,idPrefix:i,isMock:n,uuids:r}){var a;let o="generateQualifyingSTructures",s=[],l=[],c=[],u=(g,v)=>g.stageSequence-v.stageSequence,d=(g,v)=>g.roundTarget-v.roundTarget,p=0,h=0,f,m=1;for(let g of t.sort(d)){let v=g.structureProfiles||[];m=g.roundTarget||m;let y=1,b=0,I,T,w;for(let S of(v||[]).sort(u)){let D=m5(S.drawSize||S.participantsCount),{qualifyingRoundNumber:E,structureOptions:C,matchUpFormat:P,structureName:R,structureId:N,drawType:M}=S,A=S.matchUpType,_=S.qualifyingPositions||rWe({drawSize:D,qualifyingRoundNumber:E}),x,O,B;if(!bi(D))return fe({result:{error:_P},stack:o});let F=t.length>1?`${m}-`:"",G=v.length>1||F?y:"",H=R||(F||G?`${Co(Xt)} ${F}${G}`:Co(Xt));if(M===ku){let{structures:$,groupCount:q,maxRoundNumber:z}=vR({structureName:S.structureName||H,structureId:N||(r==null?void 0:r.pop()),stage:Xt,structureOptions:C,appliedPolicies:e,stageSequence:y,matchUpType:A,roundTarget:m,drawSize:D,idPrefix:i,isMock:n,uuids:r});b=q,x=z,O=$[0],f=[1]}else({drawSize:D,matchUps:B,roundLimit:x}=Tp({qualifyingRoundNumber:E,qualifyingPositions:_,matchUpType:A,drawSize:D,idPrefix:i,isMock:n,uuids:r})),O=Ec({structureName:S.structureName||H,structureId:N||(r==null?void 0:r.pop()),qualifyingRoundNumber:x,stage:Xt,matchUpFormat:P,stageSequence:y,matchUpType:A,roundLimit:x,matchUps:B}),m&&un({extension:{name:Ap,value:m},element:O}),b=((a=B==null?void 0:B.filter($=>$.roundNumber===x))==null?void 0:a.length)||0;if(y>1){let{link:$}=SR({sourceStructureId:T,sourceRoundNumber:I,targetStructureId:O.structureId,finishingPositions:w===Ff?[1]:void 0,linkType:w});c.push($),p+=(D||0)-b}else p+=D||0;w=M===ku?Ff:Bf,T=O.structureId,I=x,l.push(O),y+=1}h+=b,s.push({qualifiersCount:b,finalQualifyingRoundNumber:I,finalQualifyingStructureId:T,finishingPositions:f,roundTarget:m,linkType:w}),m+=1}return{qualifiersCount:h,qualifyingDrawPositionsCount:p,qualifyingDetails:s,structures:l,...ue,links:c}}function rWe({drawSize:t,qualifyingRoundNumber:e}){let i=t,n=0;for(;n<e;)i=Math.floor(i/2),n+=1;return i}function rbe(t){let{drawTypeCoercion:e,enforceMinimumDrawSize:i}=t,n=ai(t.drawSize),r=e&&(typeof e=="boolean"||e<=2)&&n===2&&rp||t.drawType||rp,a=Dge.includes(r);if(n&&a){if(e&&(typeof e=="boolean"&&n<4||n<=e))r=rp;else if(n<4&&i)return{...fe({context:{enforceMinimumDrawSize:i,drawSize:n,drawType:r},result:{error:ZO},stack:"getCoercedDrawType"}),drawType:r}}return{drawType:r}}function aWe(t){let{drawDefinition:e,structureOptions:i,requireSequential:n}=t,r={structureName:Co(Ft),...t,stage:Ft},{structures:a,groupCount:o,groupSize:s}=vR(r);if(o<1)return{error:gme};let l=(i==null?void 0:i.playoffGroups)||[{finishingPositions:[1],structureName:Co(Br)}],[c]=a,{structures:u,links:d}=vye({sourceStructureId:c.structureId,requireSequential:n,drawDefinition:e,playoffGroups:l,groupCount:o,groupSize:s,...t});return u&&a.push(...u),{...ue,structures:a,links:d}}function oWe({mainStructure:t,consolationStructure:e,deciderStructure:i}){let n=e.matchUps.reduce((c,u)=>(u.drawPositions||[]).filter(Boolean).length&&!c.includes(u.roundNumber)?c.concat(u.roundNumber):c,[]),r=t.matchUps.reduce((c,u)=>!c||u.roundNumber>c?u.roundNumber:c,void 0),a=e.matchUps.reduce((c,u)=>!c||u.roundNumber>c?u.roundNumber:c,void 0),o=n.map((c,u)=>{let d=n.indexOf(c)%2?gu:iy,p=1+u;return{linkType:Eh,source:{roundNumber:p,structureId:t.structureId},target:{feedProfile:d,roundNumber:c,structureId:e.structureId}}}),s={linkType:Bf,source:{roundNumber:a,structureId:e.structureId},target:{feedProfile:gu,roundNumber:r,structureId:t.structureId}},l=[{linkType:Bf,source:{roundNumber:r,structureId:t.structureId},target:{feedProfile:gu,roundNumber:1,structureId:i.structureId}},{linkType:Eh,source:{roundNumber:r,structureId:t.structureId},target:{feedProfile:gu,roundNumber:1,structureId:i.structureId}}];return[...o,s,...l]}function sWe({structureName:t,matchUpType:e,idPrefix:i,drawSize:n,isMock:r,uuids:a}){let o=[],{matchUps:s}=pg({linkFedFinishingRoundNumbers:[1],drawSize:n+1,matchUpType:e,idPrefix:i,isMock:r}),l=jm({structureName:t||Co(Ft),structureId:a==null?void 0:a.pop(),stageSequence:1,stage:Ft,matchUpType:e,matchUps:s});o.push(l);let c=n/2,{matchUps:u}=pg({finishingPositionOffset:c,idPrefix:i&&`${i}-c`,drawSize:n-1,isConsolation:!0,matchUpType:e,isMock:r,uuids:a}),d=jm({structureName:Co(Uge),matchUps:u,structureId:a==null?void 0:a.pop(),stage:Mo,stageSequence:2,matchUpType:e});o.push(d);let{matchUps:p}=Tp({idPrefix:i&&`${i}-p1t2`,drawSize:2,matchUpType:e,isMock:r}),h=jm({structureName:Co(Tge),matchUps:p,structureId:a==null?void 0:a.pop(),stageSequence:3,stage:Br,matchUpType:e});o.push(h);let f=oWe({mainStructure:l,consolationStructure:d,deciderStructure:h});return{structures:o,links:f,...ue}}function lWe(t){let{qualifyingRoundNumber:e,finishingPositionOffset:i,qualifyingPositions:n,matchUpType:r,idPrefix:a,drawSize:o,isMock:s,uuids:l}=t;if(!bi(o)||o<2)return{matchUps:[],roundsCount:0};if(Td(o))return Tp(t);let c=cWe(o),u=c.shift(),d=Ct(1,((u==null?void 0:u.participantsCount)||0)+1).map(g=>({drawPosition:g})),p=[],h=1;({matchUps:p}=x_({roundNumber:h,matchUpType:r,idPrefix:a,matchUps:p,isMock:s,nodes:d,uuids:l})),h++;let f=t.roundLimit||e;for(let g of c){let v=g.participantsCount/2,y=Ct(1,v+1);n&&v===n&&(f=h-1);let b=y.map(I=>{let T=q6({roundPosition:I,roundNumber:h,idPrefix:a,uuids:l});return{roundPosition:I,roundNumber:h,matchUpId:T}});p.push(...b),h++}let m=h-1;return p=ZP({finishingPositionOffset:i,lucky:!0,roundsCount:m,roundLimit:f,matchUps:p}),f&&(p=p.filter(g=>g.roundNumber<=f)),{matchUps:p,roundsCount:m,roundLimit:f}}function cWe(t){let e=ai(t),i=e%2?e+1:e,n=!!(Math.ceil(i/2)%2),r=[{participantsCount:i,preFeedRound:n}];for(;i>2;){let a=Math.ceil(i/2),o=a===1,s=!!(!o&&a%2);i=!o&&s?a+1:a;let l=!!(i!==2&&Math.ceil(i/2)%2);r.push({participantsCount:i,preFeedRound:l,feedRound:s})}return r}function abe(t){var e,i;let{playoffAttributes:n,stageSequence:r=1,stage:a=Ft,matchUpType:o,drawSize:s,uuids:l}=t,c=()=>!t.isMock&&!t.idPrefix?void 0:`${t.drawDefinition.drawId}-s-0`,u=t.structureId||c()||(l==null?void 0:l.pop()),d=t.appliedPolicies??Mn(t),p=((e=t.policyDefinitions)==null?void 0:e[xS])||(d==null?void 0:d[xS]);t.skipRounds=t.skipRounds||s<=4&&(p!=null&&p.feedFromMainFinal?0:1)||0;let h=t.structureName??((i=n==null?void 0:n[0])==null?void 0:i.name)??Co(Ft),f=()=>{let{matchUps:m}=Tp(t);return{structures:[Ec({stageSequence:r,structureName:h,matchUpType:o,structureId:u,matchUps:m,stage:a})],links:[],...ue}};return{generators:{[_u]:()=>({structures:[Ec({finishingPosition:gU,stageSequence:r,structureName:h,matchUps:[],matchUpType:o,structureId:u,stage:a})],links:[],...ue}),[ky]:()=>{let{matchUps:m}=lWe(t);return{structures:[Ec({stageSequence:r,structureName:h,matchUpType:o,structureId:u,matchUps:m,stage:a})],links:[],...ue}},[rp]:()=>f(),[qP]:()=>sWe(t),[FS]:()=>G0({...t,roundOffsetLimit:3,playoffAttributes:n??z5}),[BS]:()=>G0({...t,roundOffsetLimit:2,playoffAttributes:n??q5}),[Br]:()=>G0(t),[mU]:()=>{let{matchUps:m}=pg({drawSize:s,uuids:l,matchUpType:o});return{structures:[Ec({stageSequence:r,structureName:h,matchUpType:o,structureId:u,stage:Ft,matchUps:m})],links:[],...ue}},[WP]:()=>fye(t),[$S]:()=>sb({...t,feedRounds:1,fmlc:!0}),[Sge]:()=>sb({...t,feedRounds:1}),[j5]:()=>sb({...t,feedsFromFinal:1}),[G5]:()=>sb({...t,feedsFromFinal:2}),[H5]:()=>sb({...t,feedsFromFinal:3}),[KP]:()=>sb(t),[IL]:()=>gye(t),[ku]:()=>vR(t),[Ph]:()=>aWe(t)}}}function m8(t){var e,i,n,r,a;let{enforceMinimumDrawSize:o=!0,overwriteExisting:s,appliedPolicies:l,staggeredEntry:c,drawDefinition:u,tieFormat:d,isMock:p,uuids:h}=t||{},f=ai(t.drawSize),m=t.drawTypeCoercion??AR({appliedPolicies:l,drawType:t.drawType}),g="generateDrawStructuresAndLinks",v=rbe({drawType:t.drawType,enforceMinimumDrawSize:o,drawTypeCoercion:m,drawSize:f});if(v.error)return v;let y=v.drawType,b=[],I=[],T=(t==null?void 0:t.matchUpType)??Mr,w=(e=u==null?void 0:u.structures)==null?void 0:e.filter(({stage:Y})=>Y===Xt);w&&b.push(...w);let S=w==null?void 0:w.map(({structureId:Y})=>Y),D=(i=u==null?void 0:u.structures)==null?void 0:i.find(({stage:Y,stageSequence:Q})=>Y===Ft&&Q===1),E=(n=u==null?void 0:u.links)==null?void 0:n.filter(Y=>Y.target.structureId===(D==null?void 0:D.structureId)&&(S==null?void 0:S.includes(Y.source.structureId))),C=(Y,Q)=>{var X;if(Y.linkType===Ff&&Q!=null&&Q.structures){let oe=Y.source.finishingPositions||[];return Q.structures.length*oe.length}else if(Y.linkType===Bf&&(X=Q==null?void 0:Q.matchUps)!=null&&X.length){let oe=Y.source.roundNumber;return Q.matchUps.filter(({roundNumber:re})=>re===oe).length}},P=w==null?void 0:w.map(Y=>{var Q,X,oe;let re=E==null?void 0:E.find(ae=>ae.target.structureId===Y.structureId),me=((X=(Q=jn({structure:Y}))==null?void 0:Q.positionAssignments)==null?void 0:X.length)??0;if(!re)return me;let se=re==null?void 0:re.source.structureId,te=(oe=u.structures)==null?void 0:oe.find(ae=>ae.structureId===se),he=C(re,te)||0;return me-he}).filter(Boolean).reduce((Y,Q)=>Y+Q,0),R=E==null?void 0:E.map(Y=>{let Q=Y.source.structureId,X=w==null?void 0:w.find(oe=>oe.structureId===Q);return C(Y,X)}).filter(Boolean).reduce((Y,Q)=>Y+Q,0),N=!!(D&&!((r=D==null?void 0:D.matchUps)!=null&&r.length));if(w!=null&&w.length&&!N)return{error:ZV};let M=!(w!=null&&w.length)&&t.qualifyingProfiles,A=(M==null?void 0:M.length)&&nbe({idPrefix:t.idPrefix,qualifyingProfiles:M,appliedPolicies:l,isMock:p,uuids:h});if(A!=null&&A.error)return A;let{qualifyingDrawPositionsCount:_,qualifyingDetails:x,qualifiersCount:O}=A||{qualifyingDrawPositionsCount:P,qualifiersCount:R};_&&(A!=null&&A.structures&&b.push(...A.structures),A!=null&&A.links&&I.push(...A.links)),Object.assign(t,qt({drawSize:f,matchUpType:T,tieFormat:d}));let B=y!==_u&&(!f||f<2||!c&&![mU,ky].includes(y)&&([Ph,ku].includes(y)&&f<3||![ku,Ph].includes(y)&&!Td(f)));if(B&&!_)return fe({context:{drawSize:f,invalidDrawSize:B},result:{error:ZO},stack:g});let{generators:F,error:G}=abe(t);if(G)return{error:G};let H=F[y];if(!H)return{error:j4};let $=H==null?void 0:H();if($.error)return $;let{structures:q,links:z}=$;if(q!=null&&q.length){let Y=q.find(({stage:Q,stageSequence:X})=>Q===Ft&&X===1);if(D&&Y){if(N){let Q=Y.structureId;if(Y.structureId=D.structureId,z==null?void 0:z.length)for(let X of z)X.source.structureId===Q&&(X.source.structureId=D.structureId),X.target.structureId===Q&&(X.target.structureId=D.structureId)}else if(!s)return{error:ZV}}b.push(...q)}b.sort(cw),z!=null&&z.length&&I.push(...z);let Z=$.structures.find(({stage:Y,stageSequence:Q})=>Y===Ft&&Q===1);for(let Y of x||[]){let{finalQualifyingRoundNumber:Q,finalQualifyingStructureId:X,roundTarget:oe,finishingPositions:re,linkType:me}=Y,se=Z&&((a=SR({targetStructureId:Z.structureId,sourceStructureId:X,sourceRoundNumber:Q,finishingPositions:re,targetEntryRound:oe,linkType:me}))==null?void 0:a.link);if(se!=null&&se.error)return se;se&&I.push(se)}return E&&I.push(...E),{...ue,qualifyingResult:{qualifyingDrawPositionsCount:_,qualifiersCount:O},structures:b,links:I}}function g8(t){var e,i;let{modifyOriginal:n=!0,stageSequence:r=1,isMock:a}=t||{},o="generateDrawTypeAndModifyDrawDefinition";if(!t.drawDefinition)return fe({result:{error:Lt},stack:o});let s=n?t.drawDefinition:$t(t.drawDefinition,!1,!0),{tieFormat:l,matchUpType:c}=t;if(l){let T=ul({tieFormat:l});if(T.error)return T}l=So(l??((e=ns({drawDefinition:s}))==null?void 0:e.tieFormat)),c=c??(s.matchUpType||Mr),t.tieFormat=l,t.matchUpType=c;let u=N_({drawDefinition:s,stage:Ft});t.drawSize=t.drawSize??u,!u&&t.drawSize&&k_({drawSize:t.drawSize,drawDefinition:s,stageSequence:r,stage:Ft});let d=ko({drawDefinition:s}).drawMatchUps.map(Va),p=m8(t);if(p.error)return fe({result:p,stack:o});let{structures:h,links:f,qualifyingResult:m}=p;s.structures=h,s.links=f;let g=Math.max(t.qualifiersCount??0,(m==null?void 0:m.qualifiersCount)||0);if(m!=null&&m.qualifyingDrawPositionsCount&&!N_({stage:Xt,drawDefinition:s})){let T=k_({drawSize:m.qualifyingDrawPositionsCount,stage:Xt,drawDefinition:s});if(T.error)return T}if(g){let T=lye({qualifiersCount:g,drawDefinition:s,stage:Ft});if(T.error)return T}let v=t.drawSize??u;Object.assign(t,qt({drawSize:v,matchUpType:c,tieFormat:l}));let{matchUps:y,matchUpsMap:b}=wa({drawDefinition:s});l&&(y==null||y.forEach(T=>{if(!d.includes(T.matchUpId)){let{tieMatchUps:w}=UR({tieFormat:l,matchUp:T,isMock:a});Object.assign(T,{tieMatchUps:w,matchUpType:c})}}));let{inContextDrawMatchUps:I}=ly({drawDefinition:s,matchUpsMap:b});return er({tournamentId:(i=t.tournamentRecord)==null?void 0:i.tournamentId,drawDefinition:s}),{inContextDrawMatchUps:I,drawDefinition:s,matchUpsMap:b,...ue,structures:h,matchUps:y,links:f}}function qS(t){let{tournamentRecord:e,scaleAttributes:i,participantId:n}=t,r=t.tournamentRecords||e&&{[e.tournamentId]:e}||{};if(!n)return{error:Ra};let{participant:a,tournamentId:o}=jy({tournamentRecords:r,tournamentRecord:e,participantId:n});return a?{...sh({participant:a,scaleAttributes:i}),tournamentId:o}:{error:Jr}}function WS(t){let{removePriorValues:e,tournamentRecord:i,participantId:n,scaleItem:r}=t,a,o;if(!sbe({scaleItem:r}))return{error:FP};if(n&&Array.isArray(i.participants)&&(o=i.participants.find(s=>s.participantId===n),o)){let s=lbe({removePriorValues:e,participant:o,scaleItem:r});if(s.error)return s;a=!s.valueChanged;let{topics:l}=Gu();l.includes(No)&&tn({topic:No,payload:{tournamentId:i.tournamentId,participants:[o]}})}return a&&{...ue,info:d5,existingValue:r==null?void 0:r.scaleValue}||o&&{...ue,newValue:r==null?void 0:r.scaleValue}||{error:Jr}}function obe(t){var e;let{scaleItemsWithParticipantIds:i=[],removePriorValues:n,tournamentRecord:r,auditData:a,context:o}=t;if(!r)return{error:it};if(!r.participants)return{error:OP};let s=0,l={},c=[];for(let p of i){let h=p==null?void 0:p.participantId;if(Array.isArray(p==null?void 0:p.scaleItems))for(let f of p.scaleItems)if(sbe({scaleItem:f}))Array.isArray(l[h])||(l[h]=[]),l[h].push(f);else return{error:FP}}r.participants.forEach(p=>{let{participantId:h}=p||{};Array.isArray(l[h])&&l[h].forEach(f=>{lbe({participant:p,scaleItem:f,removePriorValues:n}),c.push(p),s++})});let u=s?void 0:sU,{topics:d}=Gu();if(d.includes(No)&&s&&tn({topic:No,payload:{tournamentId:r.tournamentId,participants:c}}),o){let{eventId:p,drawId:h,...f}=o,m=((e=f.scaleAttributes)==null?void 0:e.scaleType)&&[f.scaleAttributes.scaleType];if(Object.keys(f).length){let g={itemType:K5,itemValue:f};if(m&&(g.itemSubTypes=m),h||p){let{drawDefinition:v,event:y}=Ks({tournamentRecord:r,eventId:p,drawId:h});h&&z6({drawDefinition:v,timeItem:g}),p&&Iw({event:y,timeItem:g})}else bw({tournamentRecord:r,timeItem:g})}}return a&&d.includes(VS)&&tn({topic:VS,payload:a}),qt({...ue,modificationsApplied:s,info:u})}function sbe({scaleItem:t}){let e=t&&Object.keys(t),i=["scaleType","eventType","scaleName"];return i.filter(n=>e==null?void 0:e.includes(n)).length===i.length}function lbe({removePriorValues:t,participant:e,scaleItem:i}){if(!e)return{error:nw};let n=i&&Object.keys(i),r=["scaleType","eventType","scaleName"];if(r.filter(c=>n.includes(c)&&i[c]).length!==r.length)return{error:FP};let a=new Date().toISOString();e.timeItems||(e.timeItems=[]);let{scaleItem:o}=sh({scaleAttributes:i,participant:e}),s=c=>[void 0,null,""].includes(c),l=!(s(o==null?void 0:o.scaleValue)&&s(i.scaleValue))&&JSON.stringify(o==null?void 0:o.scaleValue)!==JSON.stringify(i.scaleValue);if(l){let{scaleType:c,eventType:u,scaleName:d}=i,p=[oI,c,u,d].join("."),h=qt({itemValue:i.scaleValue,itemDate:i.scaleDate,createdAt:a,itemType:p});i.scaleId&&(h.itemSubTypes=[i.scaleId]),t&&(e.timeItems=e.timeItems.filter(f=>f.itemType!==p)),e.timeItems.push(h)}return{...ue,valueChanged:l,newValue:i.scaleValue}}var Iv="ELO",cbe="NTRP",uWe="TRN",ube="UTR",v8="WTN",dWe={ELO:Iv,NTRP:cbe,TRN:uWe,UTR:ube,WTN:v8},pWe={[Iv]:{defaultInitialization:1500,decimalsCount:0,range:[0,3e3],ascending:!0},[cbe]:{accessors:["ntrpRating","dntrpRatingHundredths"],attributes:{ustaRatingType:""},accessor:"dntrpRatingHundredths",defaultInitialization:3,decimalsCount:1,ascending:!0,range:[1,7]},[ube]:{defaultInitialization:6,accessors:["utrRating"],accessor:"utrRating",decimalsCount:2,ascending:!0,range:[1,16]},[v8]:{attributes:{confidence:{generator:!0,range:[60,100]}},accessors:["wtnRating","confidence"],defaultInitialization:23,accessor:"wtnRating",ascending:!1,decimalsCount:2,range:[40,1]}},ql=pWe,hWe=t=>250/Math.pow(t+5,.4),fWe=()=>1;function mWe(t=3,e=2){let i=t/e;return isNaN(i)?g0.kDefault():i}var g0={nSpread:400,diffThreshold:.125,kCalc:hWe,kMultiplier:mWe,kDefault:fWe};function dbe(t){let{winnerRating:e,loserRating:i,ratingRange:n}=t,{ratings:r=ql,winnerCountables:a=1,loserCountables:o=0,ratingType:s=Iv,maxCountables:l,countables:c}=t||{},u=r==null?void 0:r[s];if(!u)return{error:Ht};n=u.range||n,e=e||u.defaultInitialization,i=i||u.defaultInitialization;let d=n[0]>n[1],p=u.decimalsCount||0,h=d?n.slice().reverse():n,f=(x,O)=>parseFloat(O)>=Math.min(...x)&&parseFloat(O)<=Math.max(...x);(!f(n,e)||!f(n,i))&&(f(n,e)||(e=u.defaultInitialization),f(n,i)||(i=u.defaultInitialization));let m=({value:x,sourceRange:O,targetRange:B})=>(x-O[0])*(B[1]-B[0])/(O[1]-O[0])+B[0],g=m({targetRange:ql[Iv].range,sourceRange:h,value:d?n[0]-e:e}),v=m({targetRange:ql[Iv].range,sourceRange:h,value:d?n[0]-i:i}),y=(x,O)=>1/(1+Math.pow(10,(O-x)/g0.nSpread)),b=y(g,v),I=y(v,g),T=g0.kCalc(a),w=g0.kCalc(o),S=g0.kMultiplier(l,c),D=g+S*T*(1-b),E=v+S*w*(0-I),C=m({sourceRange:ql[Iv].range,value:D,targetRange:h}),P=m({sourceRange:ql[Iv].range,value:E,targetRange:h}),R=d?n[0]-C:C,N=parseFloat(parseFloat(R).toFixed(p)),M=d?n[0]-P:P,A=parseFloat(parseFloat(M).toFixed(p)),_=Math.max(...n)?Math.abs(e-i)/Math.max(...n):0;return(C>P&&_>g0.diffThreshold||N<0||A<0)&&(N=e,A=i),{newWinnerRating:N,newLoserRating:A}}var gWe=t=>(t==null?void 0:t.reduce((e,i)=>(i.winningSide&&(e[i.winningSide-1]+=1),e),[0,0]))||[0,0];function pbe(t){var e,i;let{removePriorValues:n=!0,tournamentRecord:r,ratingType:a=Iv,considerGames:o,matchUpIds:s,asDynamic:l}=t;if(!r)return{error:it};if(!Array.isArray(s))return{error:Oh};if(typeof a!="string")return{error:Me,ratingType:a};if(!ql[a])return{error:Me};let c=ql[a],{accessor:u}=c,d={},p=t.matchUps??co({matchUpFilters:{matchUpIds:s,matchUpStatuses:Ga},tournamentRecord:r,inContext:!0}).matchUps??[];p.sort(fw);for(let f of p){let{endDate:m,matchUpFormat:g,score:v,sides:y,winningSide:b}=f,I=f.matchUpType,T={eventType:I,scaleName:a,scaleType:Av},w=`${a}.${Xme}`,S={scaleName:w,eventType:I,scaleType:Av},D=Object.assign({},...(y??[]).map(O=>{let{sideNumber:B,participant:F}=O;return B&&{[B]:[F==null?void 0:F.participantId,...(F==null?void 0:F.individualParticipantIds)??[]].filter(Boolean).flat()}})),E=l?w:a,C=Object.assign({},...Object.values(D).flat().map(O=>{let{scaleItem:B}=qS({scaleAttributes:S,tournamentRecord:r,participantId:O}),{scaleItem:F}=qS({tournamentRecord:r,scaleAttributes:T,participantId:O}),G=u?{[u]:void 0}:void 0;return O&&{[O]:B??F??{scaleName:E,eventType:I,scaleDate:m,scaleType:Av,scaleValue:G}}})),P=g?Zs(g):{},R=(P==null?void 0:P.bestOf)||1,N=(P==null?void 0:P.setsTo)||1,M=o?R&N:R,A=(v==null?void 0:v.sets)&&gWe(v.sets)||b===1&&[1,0]||[0,1],_=b?D[b]:[],x=b?D[3-b]:[];for(let O of _){let B=(e=C[O])==null?void 0:e.scaleValue,F=typeof B=="object"?B[u]:B;for(let G of x){let H=(i=C[G])==null?void 0:i.scaleValue,$=typeof H=="object"?H[u]:H,q=b?A[b]:[0,0],z=b?A[3-b]:[0,0],{newWinnerRating:Z,newLoserRating:Y}=dbe({winnerCountables:q,loserCountables:z,maxCountables:M,winnerRating:F,loserRating:$,ratingType:a}),Q=u?{...B,[u]:Z}:Z,X=u?{...H,[u]:Y}:Y;C[O].scaleValue=Q,C[G].scaleValue=X;let oe=WS({participantId:O,removePriorValues:n,tournamentRecord:r,scaleItem:{...C[O],scaleName:E}});if(oe.error||(oe=WS({participantId:G,removePriorValues:n,tournamentRecord:r,scaleItem:{...C[G],scaleName:E}}),oe.error))return oe}}Object.assign(d,C)}let h=p.map(({matchUpId:f})=>f);return{...ue,modifiedScaleValues:d,processedMatchUpIds:h}}function XL(t){var e;let{matchUpIds:i=[],drawDefinition:n,roundNumber:r,newRound:a,isMock:o,event:s}=t;if(typeof n!="object")return{error:Lt};let{participantIdPairings:l,matchUpsCount:c}=t,u=WL(t);if(u.error)return fe({result:u});let{lastRoundNumber:d,availableMatchUpsCount:p=0,roundMatchUpsCount:h=0}=u;if(!c)a?c=h:p>0&&(c=p);else if(c>h&&t.restrictMatchUpsCount!==!1)return fe({result:{error:Me,info:"matchUpsCount error",context:{roundMatchUpsCount:h}}});if(l&&!Array.isArray(l)||c&&!bi(c)||i&&!Array.isArray(i)||!l&&!c)return{error:Me,info:"matchUpsCount or pairings error"};if(c&&t.restrictMatchUpsCount!==!1&&c>32)return{error:Me,info:"matchUpsCount must be less than 33"};if(r&&!t.ignoreLastRoundNumber&&r-1>(d||0))return{error:Me,info:"roundNumber error"};let f=r??(a&&(d??0)+1||d||1);l=l??Ct(0,c).map(()=>({participantIds:[void 0,void 0]}));let m=v=>{if(!t.idPrefix)return;let y=n.drawId,b=t.idPrefix??"ah";return`${y}-${b}-${f}-${v}`},g=l==null?void 0:l.map((v,y)=>{let b=(v==null?void 0:v.participantIds)??[void 0,void 0];b.push(void 0,void 0);let I=b.slice(0,2).map((w,S)=>qt({sideNumber:S+1,participantId:w})),T=i[y]??m(y)??xn();return{roundNumber:f,matchUpStatus:Kr,matchUpId:T,sides:I}});if(g!=null&&g.length){let v=(e=ns({drawDefinition:n,event:s}))==null?void 0:e.tieFormat;v&&g.forEach(y=>{let{tieMatchUps:b}=UR({tieFormat:v,matchUp:y,isMock:o});Object.assign(y,{tieMatchUps:b,matchUpType:Jn})})}return{roundNumber:f,matchUpsCount:(g==null?void 0:g.length)??0,matchUps:g,...ue}}function vWe({maxIterations:t=4e3,valueSortedPairings:e,pairingValues:i,valueObjects:n,deltaObjects:r}){let a=Object.assign({},...e.map(y=>({[y.pairing]:y.value}))),o=Object.keys(i),s=[],l=sX({actorsCount:o.length,valueSortedPairings:e,pairingValueMap:a,deltaObjects:r,valueObjects:n}),c=[d$(l)];s.push(l);let u=l.value,d=l,p=0,h=0,f=o.length,m;do f-=1,m=o.length*i[o[0]].length;while(m>t&&f>5);let g=[];o.forEach(y=>{i[y].slice(0,f).forEach(b=>{h+=1;let I=Bb(y,b.opponent);if(!g.includes(I)){let T=sX({stipulated:[[y,b.opponent]],actorsCount:o.length,valueSortedPairings:e,pairingValueMap:a,deltaObjects:r,valueObjects:n});if(!c.includes(d$(T))){c.push(d$(T)),s.push(T);let{maxDelta:w,value:S}=T;w<d.maxDelta&&(d=T),(S<u||S===u&&Math.round(Math.random()))&&(u=S),g.push(I),p+=1}}}),s=s.filter(b=>Math.abs(b.value-u)<5)}),s.sort((y,b)=>y.maxDiff-b.maxDiff);let v=Tl(s);return{candidatesCount:p,deltaCandidate:d,maxIterations:t,iterations:h,candidate:v}}function d$(t){return t.participantIdPairings.map(({participantIds:e})=>e.sort().join("|")).sort().join("/")}function sX({valueSortedPairings:t,stipulated:e=[],pairingValueMap:i,deltaObjects:n,valueObjects:r,actorsCount:a}){let o=[].concat(...e),s=[],l=0;e.filter(Boolean).forEach(d=>{let[p,h]=d,f=Bb(p,h),m=i[f];s.push({participantIds:d,value:m}),l+=i[f]}),so(t,a).map(d=>vs(d).map(p=>({...p,value:p.value+Math.random()*Math.round(Math.random())}))).flat().forEach(d=>{let p=d.pairing.split("|");if(!p.reduce((h,f)=>o.includes(f)||h,!1)){o.push(...p);let h=d.value;l+=h,s.push({participantIds:p,value:h})}}),s.sort((d,p)=>d.value-p.value);let c=s.reduce((d,p)=>{let[h,f]=p.participantIds,m=Bb(h,f),g=n[m];return g>d?g:d},0),u=s.reduce((d,p)=>{let[h,f]=p.participantIds,m=Bb(h,f),g=r[m];return g>d?g:d},0);return{value:l,participantIdPairings:s,maxDelta:c,maxDiff:u}}function Bb(t,e){return[t,e].sort(_L).join("|")}function hbe({participantIds:t}){let e={},i=[];t.forEach(r=>{e[r]=t.filter(a=>a!==r),e[r].forEach(a=>{let o=Bb(a,r);i.includes(o)||i.push(o)})});let n=Object.assign({},...i.map(r=>({[r]:0})));return{uniquePairings:i,possiblePairings:e,deltaObjects:n}}function yWe({matchUps:t}){let e=[];for(let i of t){let n=i.sides.map(Wi);if(n.length===2){let[r,a]=n,o=Bb(r,a);e.includes(o)||e.push(o)}}return{encounters:e}}function bWe({possiblePairings:t,valueObjects:e}){let i={};for(let r of Object.keys(t)){let a=t[r].map(o=>n(r,o));i[r]=a.sort((o,s)=>o.value-s.value)}function n(r,a){let o=Bb(r,a);return{opponent:a,value:e[o]}}return{pairingValues:i}}var IWe=0;function wWe({tournamentParticipants:t,adHocRatings:e,eventType:i,scaleName:n,pairing:r}){var a;let o=((a=ql[n])==null?void 0:a.defaultInitialization)??IWe;return r.split("|").map(s=>{var l;if(i===xu){let c=(l=t==null?void 0:t.find(u=>u.participantId===s))==null?void 0:l.individualParticipantIds;return c?c==null?void 0:c.map(u=>e[u]||o):o*2}else return e[s]||o})}function SWe({tournamentParticipants:t,adHocRatings:e={},possiblePairings:i,uniquePairings:n,maxIterations:r,deltaObjects:a,valueObjects:o,eventType:s,scaleName:l,salted:c}){n.forEach(v=>{let y=wWe({tournamentParticipants:t,adHocRatings:e,scaleName:l,eventType:s,pairing:v}),b=typeof c=="number"&&c||.5,I=c&&(Math.round(Math.random())?b:b*-1)||0,T=Math.abs(y[0]-y[1])+I,w=Math.abs(y[0]-y[1]);a[v]=w,o[v]||(o[v]=0),o[v]+=T?Math.pow(T,2):0});let u=n.map(v=>({pairing:v,value:o[v]})).sort((v,y)=>v.value-y.value),{pairingValues:d}=bWe({possiblePairings:i,valueObjects:o}),{candidate:p,candidatesCount:h,deltaCandidate:f,iterations:m}=vWe({valueSortedPairings:u,maxIterations:r,pairingValues:d,deltaObjects:a,valueObjects:o}),{participantIdPairings:g}=p;return{participantIdPairings:g,candidatesCount:h,deltaCandidate:f,iterations:m,candidate:p}}var TWe=100,UWe=100,DWe=4e3;function y8({encounterValue:t=TWe,sameTeamValue:e=UWe,maxIterations:i=DWe,generateMatchUps:n=!0,ignoreLastRoundNumber:r,iterationMatchUps:a,tournamentRecord:o,dynamicRatings:s,participantIds:l,drawDefinition:c,adHocRatings:u,salted:d=.5,roundNumber:p,structureId:h,matchUpIds:f,eventType:m,structure:g,scaleName:v,idPrefix:y,isMock:b,event:I}){var T,w;if(!c)return{error:Lt};if(!g&&!h)return{error:Dr};if(g||(g=pi({drawDefinition:c,structureId:h}).structure),!sr(g))return{error:_g};if(!(l!=null&&l.length))return{error:kg};let S=[...a??[],...(g==null?void 0:g.matchUps)??[]],{encounters:D}=yWe({matchUps:S}),E=(o==null?void 0:o.participants)??[];if(s){let $=ki(g!=null&&g.matchUps?g.matchUps.map(({roundNumber:z})=>z):[]),q=Math.max(...$,0);if(q){let z=(T=g==null?void 0:g.matchUps)==null?void 0:T.filter(({roundNumber:Z})=>Z===q).map(({matchUpId:Z})=>Z);pbe({ratingType:v||((w=I==null?void 0:I.category)==null?void 0:w.ratingType),tournamentRecord:o,asDynamic:!0,matchUpIds:z})}}let{valueObjects:C}=EWe({tournamentParticipants:E,encounterValue:t,sameTeamValue:e,encounters:D}),{uniquePairings:P,possiblePairings:R,deltaObjects:N}=hbe({participantIds:l}),M={tournamentParticipants:E,possiblePairings:R,drawDefinition:c,participantIds:l,uniquePairings:P,maxIterations:i,adHocRatings:u,deltaObjects:N,valueObjects:C,eventType:m,scaleName:v,structure:g,salted:d},{candidatesCount:A,participantIdPairings:_,iterations:x,candidate:O}=SWe(M);if(!A)return{error:nL};let B,F;if(n){let $=XL({structureId:g==null?void 0:g.structureId,ignoreLastRoundNumber:r,participantIdPairings:_,newRound:!0,drawDefinition:c,roundNumber:p,matchUpIds:f,idPrefix:y,isMock:b,event:I});if($.error)return $;B=$.roundNumber,F=$.matchUps}let{maxDelta:G,maxDiff:H}=O;return{roundNumber:B,participantIdPairings:_,candidatesCount:A,...ue,iterations:x,matchUps:F,maxDelta:G,maxDiff:H}}function EWe({encounters:t,tournamentParticipants:e,encounterValue:i,sameTeamValue:n}){let r={};for(let o of t)r[o]||(r[o]=0),r[o]+=i;let a=e==null?void 0:e.filter(({participantType:o})=>o===Hn);if(a)for(let o of a){let s=o.individualParticipantIds??[],{uniquePairings:l}=hbe({participantIds:s});for(let c of l)r[c]||(r[c]=0),r[c]+=n}return{valueObjects:r}}function fbe(t){var e,i,n,r;let{drawType:a=rp,attachConsolation:o=!0,applyPositioning:s=!0,tournamentRecord:l,staggeredEntry:c,automated:u,placeByes:d,isMock:p,event:h}=t,f=t==null?void 0:t.drawDefinition;if(!f)return{error:Lt};let m=to,g=uw({stageSequence:1,drawDefinition:f,stage:m}),v=[ku,qP,Ph].includes(a)?g.length:lU(g.length);if(!c&&a===mU&&g.length<2||a===ku&&g.length<3)return{error:ZO};let{tieFormat:y,matchUpType:b}=t;if(y){let A=ul({tieFormat:y});if(A.error)return A}y=So(y??((e=ns({drawDefinition:f}))==null?void 0:e.tieFormat)),b=b??f.matchUpType??Mr;let{structures:I}=Rh({stageSequence:1,drawDefinition:f,stage:m});if(I.length>1)return{error:Ofe};if((n=(i=I==null?void 0:I[0])==null?void 0:i.matchUps)!=null&&n.length)return{error:h5};let T=(r=I==null?void 0:I[0])==null?void 0:r.structureId;Object.assign(t,qt({structureName:t.structureName??Co(to),structureId:T,matchUpType:b,tieFormat:y,drawSize:v,stage:m}));let w=abe(t);if(w.error)return w;let S=w.generators[a];if(!S)return{error:j4};let D=S==null?void 0:S();if(D.error)return D;let{structures:E,links:C}=D,P=E.map(A=>Sn({structure:A}).matchUps).flat();y&&P.forEach(A=>{let{tieMatchUps:_}=UR({matchUp:A,tieFormat:y,isMock:p});Object.assign(A,{tieMatchUps:_,matchUpType:b})}),(!s||!o)&&(f=$t(f,!1,!0)),f.links||(f.links=[]),C.length&&f.links.push(...C);let R=E.map(({structureId:A})=>A);f.structures||(f.structures=[]);let N=f.structures.map(({structureId:A})=>A);f.structures=f.structures.map(A=>R.includes(A.structureId)?E.find(({structureId:_})=>_===A.structureId):A);let M=E.filter(({structureId:A})=>!N.includes(A));return M.length&&f.structures.push(...M),u&&IR({seedingProfile:t.seedingProfile,applyPositioning:s,tournamentRecord:l,drawDefinition:f,structureId:T,placeByes:d,drawSize:v,event:h}),o&&er({drawDefinition:f}),{links:C,structures:E,...ue}}var b8={};zi(b8,{addGame:()=>Sbe,addPoint:()=>wbe,addSet:()=>Ube,addShot:()=>Tbe,analyzeSet:()=>CE,calculateHistoryScore:()=>ybe,checkScoreHasValue:()=>uo,checkSetIsComplete:()=>eF,clearHistory:()=>Ibe,generate:()=>mbe,generateScoreString:()=>ch,generateTieMatchUpScore:()=>RR,getSetComplement:()=>E8,getTiebreakComplement:()=>rF,helpers:()=>Pbe,isValidMatchUpFormat:()=>Fl,keyValueScore:()=>eIe,mutate:()=>vbe,parseMatchUpFormat:()=>Zs,parseScoreString:()=>V_,query:()=>aIe,redo:()=>Dbe,reverseScore:()=>gbe,setServingSide:()=>bbe,stringifyMatchUpFormat:()=>jL,tidyScore:()=>rIe,umo:()=>Cbe,undo:()=>Ebe,validateScore:()=>D8,validateTieFormat:()=>ul});var mbe={};zi(mbe,{generateScoreString:()=>ch,generateTieMatchUpScore:()=>RR,reverseScore:()=>gbe});function ch(t){let{winnerFirst:e=!0,addOutcomeString:i,reversed:n=!1,matchUpStatus:r,matchUpFormat:a,autoComplete:o,winningSide:s,sets:l}=t;if(!l)return{error:Ht,info:"missing sets"};let c=a&&Zs(a),{bestOf:u,finalSetFormat:d,setFormat:p}=c??{},h=n||!(!e||!s||s===1),f=i?CWe({matchUpStatus:r}):"",m=(l==null?void 0:l.sort(PWe).map(g).filter(Boolean).join(" "))||"";if(!f)return m;if(s===2)return`${f} ${m}`;return`${m} ${f}`;function g(v){let y=u&&v.setNumber===u&&d?d:p,b=x=>Lr(x==null?void 0:x.side1Score)||Lr(x==null?void 0:x.side2Score),I=x=>Lr(x==null?void 0:x.side1TiebreakScore)||Lr(x==null?void 0:x.side2TiebreakScore),T=(y==null?void 0:y.tiebreakSet)||!b(v)&&I(v),{side1Score:w,side2Score:S,side1TiebreakScore:D,side2TiebreakScore:E}=v,C=D||(Lr(D)||o?0:""),P=E||(Lr(E)||o?0:"");if(T)return`[${(h?[P,C]:[C,P]).join("-")}]`;let R=Math.min(C,P),N=R?`(${R})`:"",M=w||(Lr(w)||o?0:""),A=S||(Lr(S)||o?0:""),_=h?`${[A,M].join("-")}${N}`:`${[M,A].join("-")}${N}`;return["-"," "].includes(_)&&(_=""),_}}function CWe({matchUpStatus:t}){let e={[os]:"RET",[Rn]:"WO",[Ca]:"DF/DF",[da]:"WO/WO",[$g]:"SUS",[ec]:"ABN",[fn]:"DEF",[fU]:"DR"};return t&&e[t]||""}function PWe(t,e){return t.setNumber-e.setNumber}function gbe(t){if(!(t!=null&&t.score))return{error:Ht};let{sets:e}=t.score,i=e.map(a=>{let{side1TiebreakScore:o,side2TiebreakScore:s,winningSide:l,side1Score:c,side2Score:u,setNumber:d}=a;return qt({winningSide:l?3-l:void 0,side1TiebreakScore:s,side2TiebreakScore:o,side1Score:u,side2Score:c,setNumber:d})}),n=ch({sets:i}),r=ch({sets:i,reversed:!0});return{reversedScore:{sets:i,scoreStringSide1:n,scoreStringSide2:r},...ue}}var vbe={};zi(vbe,{addGame:()=>Sbe,addPoint:()=>wbe,addSet:()=>Ube,addShot:()=>Tbe,calculateHistoryScore:()=>ybe,clearHistory:()=>Ibe,redo:()=>Dbe,setServingSide:()=>bbe,umo:()=>Cbe,undo:()=>Ebe});function Hy({matchUp:t}){let{extension:e}=Bi({name:gL,element:t});if(!e)return{error:Wo};let{history:i=[],undoHistory:n=[]}=e.value;return{history:i,undoHistory:n,...ue}}function ybe(t){var e,i;if(!t)return{error:Ht};let{matchUp:n,updateScore:r}=t;if(!n)return{error:cl};let a=((e=Hy({matchUp:n}))==null?void 0:e.history)||[];if(!Array.isArray(a))return{error:Me,info:"history is not an array"};let{matchUpFormat:o}=n;if(!o)return{error:Z4};if(!Fl({matchUpFormat:o}))return{error:Y4};let s=Zs(o),{bestOf:l,finalSetFormat:c,setFormat:u}=s,d=["0","15","30","40","A","G"],p={sets:[]},h=[],f,m=[0,0],g=1,v=0,y,b=0,I=R=>[1,2].includes(R),T=()=>(v+=1,{winningSide:void 0,side1Score:0,side2Score:0,setNumber:v,games:[]}),w=()=>({winningSide:void 0,points:[]}),S=()=>({winningSide:void 0,side1Score:"",side2Score:"",shots:[]}),D=S(),E=w(),C=T(),P=0;for(let R of a){P+=1,y=p.sets.length+1===l;let N=y&&c?c:u,{tiebreakAt:M,setTo:A,NoAD:_,tiebbreakFormat:x}=N,O=C.side1Score===M&&C.side1Score===C.side2Score,B=!!N.tiebreakSet,F=B?N.tiebreakSet:x,{tiebreakTo:G,NoAD:H}=F||{},$=()=>{f=void 0,m=[0,0],g=3-g,C.side1TiebreakScore=0,C.side2TiebreakScore=0,C.side1PointScore="",C.side2PointScore="",b=0},q=Y=>{C.winningSide=Y;let{s:Q,...X}=C;p.sets.push(X),D=S(),E=w(),C=T(),$()},z=Y=>{E.winningSide=Y;let{g:Q,...X}=E;C.games.push(X),D=S(),E=w(),$();let oe=`side${Y}Score`;C[oe]+=1},Z=Y=>{D.winningSide=Y;let{p:Q,...X}=D;E.points.push(X),D=S(),b=0;let oe=()=>m.reduce((me,se)=>me+se)%4/4>.5?g:3-g,re=Y-1;if(O||B){m[re]+=1,f=oe(),C[`side${Y}TiebreakScore`]=m[re],C[`side${3-Y}TiebreakScore`]=m[1-re];let me=H?1:2;if(m[re]>=G&&m[re]>=m[1-re]+me)return z(Y),{gameCompleted:!0}}else if(m[1-re]===4&&m[re]===3?m[1-re]-=1:m[re]+=1,C.side1PointScore=d[m[0]],C.side2PointScore=d[m[1]],m[re]===5||m[re]===4&&m[1-re]<3||_&&m[re]===4)return z(Y),{gameCompleted:!0}};if(I(R.srv)&&(g=R.srv),["p","s","g","o"].includes(R.u)&&h.push(R.u),R.shotOutcome&&(D.shots.push(R),R.shotType==="SERVE"&&["OUT","NET"].includes(R.shotOutcome)&&(b+=1),b===2)){let Y=3-g;Z(Y)}if(I(R.p)||bi(R.pointNumber)){let Y=R.winningSide||R.p;if((i=Z(Y))!=null&&i.gameCompleted)continue}if(I(R.g)||bi(R.gameNumber)){let Y=R.winningSide||R.g;E.winningSide=Y;let Q=`side${Y}Score`,X=`side${3-Y}Score`;if(h.length&&(h.includes("p"),h=[]),z(Y),C[Q]===A&&C[Q]-C[X]>=(_?1:2)&&(q(Y),y))break}if(I(R.s)||bi(R.setNumber)){let Y=R.winningSide||R.s;if(q(Y),h.length&&(h.includes("p"),h.includes("g"),h=[]),y)break}}return P!==a.length&&console.log({error:"Match completed with excess history"}),(C.side1Score||C.side2Score||C.games.length||C.side1TiebreakScore||C.side2TiebreakScore)&&p.sets.push(C),p.scoreStringSide1=ch({...p,matchUpFormat:o}),p.scoreStringSide2=ch({...p,matchUpFormat:o,reversed:!0}),g=f||g,r&&(n.score=p),{...ue,servingSide:g,score:p}}function zy({undoHistory:t,history:e,matchUp:i}){return un({element:i,extension:{value:{history:e,undoHistory:t},name:gL}})}function bbe({matchUp:t,sideNumber:e}){if(![1,2].includes(e))return{error:e5};let{history:i=[]}=Hy({matchUp:t});return i.push({srv:e}),zy({matchUp:t,history:i})}function Ibe({matchUp:t}){return zy({matchUp:t})}function wbe({matchUp:t,point:e}){if(!e||!t)return{error:Ht};if(typeof e!="object")return{error:Me,context:{point:e}};let{history:i=[]}=Hy({matchUp:t});return i.push(e),zy({matchUp:t,history:i})}function Sbe({matchUp:t,game:e}){if(typeof e!="object")return{error:Me,context:{game:e}};let{history:i=[]}=Hy({matchUp:t});return i.push(e),zy({matchUp:t,history:i})}function Tbe({matchUp:t,shot:e}){if(typeof e!="object")return{error:Ht};let{history:i=[]}=Hy({matchUp:t});return i.push(e),zy({matchUp:t,history:i})}function Ube({matchUp:t,set:e}){if(typeof e!="object")return{error:Ht};let{history:i=[]}=Hy({matchUp:t});return i.push(e),zy({matchUp:t,history:i})}function Dbe({matchUp:t}){let{history:e=[],undoHistory:i=[]}=Hy({matchUp:t});return i.length&&e.push(i.pop()),zy({matchUp:t,history:e,undoHistory:i})}function Ebe({matchUp:t}){let{history:e=[],undoHistory:i=[]}=Hy({matchUp:t});return i.push(e.pop()),zy({matchUp:t,history:e,undoHistory:i})}var Cbe={},Pbe={};zi(Pbe,{keyValueScore:()=>eIe,parseMatchUpFormat:()=>Zs,stringifyMatchUpFormat:()=>jL,tidyScore:()=>rIe});var $b=" ",Ej="DEF",RWe="COMPLETED",Rbe="WO",MWe="WO/WO",Mbe="ABN",Nbe="SUS",Abe="RET",_be="INT",kbe=[Abe,Ej,Rbe,MWe,Mbe,Nbe,_be],Cj="DEFAULTED",xbe="WALKOVER",Obe="ABANDONED",Lbe="SUSPENDED",Fbe="RETIRED",Bbe="INTERRUPTED",NWe=[Fbe,Cj,xbe],AWe="Enter Score",gI="()",dy="[]",I8=["up","left","shift+tab"],w8=["enter","down","tab","right"],F_="backspace",$be="r",Vbe="s",jbe="a",Gbe="d",Hbe="w",zbe="i",JL=[$be,Gbe,Hbe,jbe,Vbe,zbe],QL="space",p$=["[","("],B_=[...I8,...w8,QL,"]"],qbe="-",_We="/",Vb=qbe,uh=qbe,Wbe=[_We],kWe=0,xWe=["=","+","num_1","num_2","shift+=","shift+-"],S8=["0","1","2","3","4","5","6","7","8","9"].concat(JL),Kbe=S8.map(t=>`shift+${t}`),Ybe=[Vb,F_].concat(B_,Wbe),Zbe=[S8,Kbe,Ybe].join(","),OWe=[Zbe,I8,w8,xWe].join(","),LWe={OUTCOMEKEYS:JL,SIDE1KEYS:S8,SIDE2KEYS:Kbe,MODIFIERS:Ybe,PROMPT:AWe,MOVEUP:I8,MOVEDOWN:w8,HOTKEYS:OWe};function t0({scoreString:t,lowSide:e,outcome:i}){if({scoreString:t}=Xbe({scoreString:t}),e===2){let n=(t&&t[t.length-1])!==$b?$b:"";return t+n+i}else return i+$b+t}function Xbe({scoreString:t}){if(!t)return{scoreString:""};let e=!1;for(let i of kbe){let n=t==null?void 0:t.indexOf(i);n===0?t=t.slice(i.length+1).trim()+$b:n>0&&(t=t.slice(0,n)),n>=0&&(e=!0)}return t!=null&&t.trim()||(t=""),{scoreString:t,removed:e}}function Pj({analysis:t,scoreString:e,sets:i,lowSide:n}){var r,a,o;let s,l;if(!e)return{scoreString:e,sets:i};let{scoreString:c,removed:u}=Xbe({scoreString:e});if(e=c,u)return{scoreString:e,sets:i,outcomeRemoved:!0};let d=i[i.length-1]||{},p=Object.values(d).filter(y=>y!==void 0).length;d.setNumber&&p===1&&(i=i.slice(0,i.length-1),d=i[i.length-1]||{});let{tiebreakSet:h}=t.setFormat,{tiebreakTo:f,NoAD:m}=h||{},{isTiebreakEntry:g}=H0({brackets:dy,scoreString:e}),v=BWe(e);if(v>=0){s=e.slice(0,v);let{isTiebreakEntry:y}=H0({brackets:gI,scoreString:s}),{lastOpenBracketIndex:b,isTiebreakEntry:I}=H0({brackets:dy,scoreString:s}),T=s&&s[s.length-1].trim(),w=s&&!isNaN(T),S=t.isIncompleteSetScore;if(g&&I){let D=s.slice(b+1).split(uh),E=(D==null?void 0:D.length)>0&&D[0]!==void 0&&!isNaN(parseInt(D[0]))&&parseInt(D[0])||void 0,C=(D==null?void 0:D.length)>1&&D[1]!==void 0&&parseInt(D[1])||void 0,P=[E,C];if(C){let R=n===1?1:0;P[R]=((P==null?void 0:P[1-R])||0)+(m?1:2),(P[R]||0)<f&&(P[R]=f),s=e.slice(0,b+1),s+=P.join(uh)}else E!==void 0?(s=e.slice(0,b+1),s+=E):(s=e.slice(0,b),S=!0);d.side1TiebreakScore=P[0]||0,d.side2TiebreakScore=P[1]||0}if(s.length||(s=void 0),S){let D=(r=d.side1Score)==null?void 0:r.toString();if(D){let E=D==null?void 0:D.slice(0,D.length-1);d.side1Score=!isNaN(E)&&parseInt(E)||void 0,d.side1Score===void 0&&(d.side2Score=void 0)}t.isTimedSet?(l=d.side1Score?i:(i==null?void 0:i.slice(0,i.length-1))||[],l[i.length-1]=d):l=(i==null?void 0:i.slice(0,i.length-1))||[]}else if(w){let D=(a=d.side2Score)==null?void 0:a.toString(),E=(o=d.side1Score)==null?void 0:o.toString();if(!t.isTiebreakEntry&&!t.isMatchTiebreak)if(d.side2Score){let C=D==null?void 0:D.slice(0,D.length-1);d.side2Score=!isNaN(C)&&parseInt(C)||void 0}else{let C=E==null?void 0:E.slice(0,E.length-1);d.side1Score=!isNaN(C)&&parseInt(C)||void 0}t.isTimedSet?d.side1Score?(l=i||[],l[i.length-1]=d):l=(i==null?void 0:i.slice(0,i.length-1))||[]:(l=i||[],l[i.length-1]=d),l[l.length-1]&&Object.assign(l[l.length-1],{winningSide:void 0})}else y?(l=i||[],Object.assign(l[l.length-1]||{},{winningSide:void 0,side1TiebreakScore:void 0,side2TiebreakScore:void 0})):(g&&!I?l=(i==null?void 0:i.slice(0,i.length-1))||[]:(l=i,l[i.length-1]=d),g||(l[l.length-1].side2Score=0,l[l.length-1].winningSide=void 0));return{scoreString:s,sets:l}}return{scoreString:e,sets:i}}function H0({brackets:t=gI,scoreString:e}){if(!e)return{};let[i,n]=t.split(""),r=e.split(""),a=Math.max(...np(i,r)),o=Math.max(...np(n,r));return{isTiebreakEntry:a>o,lastOpenBracketIndex:a}}function FWe({scoreString:t}){if(!t)return!1;let e=t&&t[t.length-1].trim(),i=t&&!isNaN(e),[n,r]=dy.split(""),a=t.split(""),o=Math.max(...np(n,a)),s=Math.max(...np(r,a)),l=Math.max(...np(uh,a));return i&&o>s&&l>o}function BWe(t){return t.split("").reduce((e,i,n)=>(i.match(/\d+/g)&&e.push(n),e),[]).pop()}function Jbe(t){let{lowValue:e=0,NoAD:i=!1,tiebreakTo:n}=t||{},r=i?1:2;return e+1>=n?e+r:parseInt(n)}function lX({matchUpFormat:t,matchUpStatus:e,winningSide:i,sets:n}){var r;let a=Zs(t),{bestOf:o}=a,s=Math.ceil(o/2),l=((r=n==null?void 0:n.reduce((c,u)=>{let{winningSide:d}=u;return d&&c[d-1]++,c},[0,0]))==null?void 0:r.indexOf(s))+1||void 0;return NWe.includes(e)&&i&&(l=i),{matchUpWinningSide:l}}function eF({ignoreTiebreak:t=!1,matchUpScoringFormat:e,matchUpFormat:i,isTiebreakSet:n,isDecidingSet:r,set:a}){var o;if(!a)return{error:Ht,info:"missing set"};e=e||i&&Zs(i);let s=r&&e.finalSetFormat||(e==null?void 0:e.setFormat)||{},{side1Score:l,side2Score:c}=a,{setTo:u,tiebreakAt:d}=s,p=tF({set:a}),h=Math.abs(l-c),f=l>=u||c>=u,m=n||l>=u&&c>=u||d&&d<u&&(l===d||c===d),g=t||m&&(p===1&&a.side1TiebreakScore>a.side2TiebreakScore||p===2&&a.side2TiebreakScore>a.side1TiebreakScore),v=!m&&s.NoAD||m||n&&(o=s.tiebreakFormat)!=null&&o.NoAD?1:2,y=h>=v;return!!((f&&(y||m)||n)&&(!m||g))}function tF({set:t}){if(t.side1Score||t.side2Score){if(t.side1Score>t.side2Score)return 1;if(t.side2Score>t.side1Score)return 2}else if(t.side1TiebreakScore||t.side2TiebreakScore){if(t.side1TiebreakScore>t.side2TiebreakScore)return 1;if(t.side2TiebreakScore>t.side1TiebreakScore)return 2}}function T8({analysis:t,set:e}){let i=tF({set:e}),{isDecidingSet:n,isTiebreakSet:r,matchUpScoringFormat:a}=t;return eF({matchUpScoringFormat:a,isDecidingSet:n,isTiebreakSet:r,set:e})&&i}function $We({analysis:t,scoreString:e,sets:i,value:n}){let r;if(!(i!=null&&i.length))return{sets:[]};let a=i[i.length-1];n=ai(n);let{validSide2Score:o,requiresTiebreak:s}=VWe({analysis:t,set:a,value:n});if(o){r=!0,e=(e||"")+n,a.side2Score=n;let l=T8({analysis:t,set:i[i.length-1]});if(a.winningSide=l||void 0,s){let c=gI.split("")[0];e+=c}else t.isDecidingSet||(e+=$b)}return{sets:i,scoreString:e,updated:r}}function VWe({analysis:t,set:e={},value:i}){let n=t.isDecidingSet&&t.matchUpScoringFormat.finalSetFormat||t.matchUpScoringFormat.setFormat,{tiebreakAt:r,setTo:a,NoAD:o}=n,{side1Score:s}=e,l,c;return r&&r<a?s===r?l=i<=a:l=i<=r:s===a?o?l=i<a:l=i<=a+1:s===a-1?o?l=i<=a:l=i<=a+1:s===a+1?l=i===a||i===a-1:l=i<=a,l&&(r&&r<a?c=s===a&&i===r||s===r&&i===a:c=s>=a&&i>=a&&s!==i),{validSide2Score:l,requiresTiebreak:c}}function Qbe({lowSide:t,value:e,sets:i,scoreString:n,winningSide:r,matchUpStatus:a}){let o;return e===$be?n?(o=!0,n=t0({scoreString:n,lowSide:t,outcome:Abe}),r=t===2?1:2,a=Fbe):(o=!0,n=t0({scoreString:n,lowSide:t,outcome:Ej}),r=t===2?1:2,a=Cj):e===Gbe?(o=!0,n=t0({scoreString:n,lowSide:t,outcome:Ej}),r=t===2?1:2,a=Cj):e===Hbe?(o=!0,i=[],n=Rbe,r=t===2?1:2,a=xbe):e===Vbe&&n?(o=!0,n=t0({scoreString:n,lowSide:t,outcome:Nbe}),a=Lbe,r=void 0):e===jbe?(o=!0,n=t0({scoreString:n,lowSide:t,outcome:Mbe}),a=Obe,r=void 0):e===zbe&&n&&(o=!0,n=t0({scoreString:n,lowSide:t,outcome:_be}),a=Bbe,r=void 0),{updated:o,sets:i,scoreString:n,matchUpStatus:a,winningSide:r}}function jWe(t){let{sets:e,info:i,scoreString:n,winningSide:r,matchUpStatus:a}=t,{analysis:o,lowSide:s,value:l}=t,c,u;!(e!=null&&e.length)&&l!==F_&&(e=[{setNumber:1}]);let d=e.length-1;if(JL.includes(l)){let p=e[e.length-1]||{},{side1Score:h,side2Score:f}=p;h&&!f?i="missing side2Score":o.finalSetIsComplete||r?i="final set is already complete":o.isIncompleteSetScore?i="incomplete set scoreString":o.isIncompleteSetScore||({sets:e,scoreString:n,winningSide:r,matchUpStatus:a,updated:c}=Qbe({lowSide:s,value:l,sets:e,scoreString:n,matchUpStatus:a,winningSide:r}))}else if(l===F_){if({scoreString:n,sets:e,outcomeRemoved:u}=Pj({analysis:o,scoreString:n,sets:e}),(n==null?void 0:n.trim())===""&&(n=n.trim()),n||(e=[]),u){let p=e[e.length-1]||{},{side1Score:h,side2Score:f}=p;if(h&&f){let m=h>f&&1||f>h&&2||void 0;m&&(p.winningSide=m,e.push({setNumber:e.length+1}))}}a=void 0,r=void 0,c=!0}else if(o.hasOutcome)i="has outcome";else{if(r)return{sets:e,scoreString:n,winningSide:r,matchUpStatus:a,updated:!1,info:"matchUp is complete"};if(l===QL){let p=e[e.length-1]||{},{side1Score:h,side2Score:f}=p,m=h>f&&1||f>h&&2||void 0;m&&!r&&!o.isIncompleteSetScore&&(e[e.length-1].winningSide=m,e.push({setNumber:e.length+1}),n+=" ",c=!0)}else if(l===Vb&&e[d].side1Score!==void 0&&e[d].side2Score===void 0&&n&&o.isNumericEnding)n+="-",e[d].side2Score=0,a=void 0,r=void 0,c=!0;else if(!isNaN(l)){let p;if(e[d].side2Score===void 0){let h=ai((e[d].side1Score||0).toString()+l).toString().slice(0,2);e[d].side1Score=ai(h),p=e[d].side1Score.toString(),c=!0}else{let h=ai((e[d].side2Score||0).toString()+l).toString().slice(0,2);e[d].side2Score=ai(h),p=[e[d].side1Score,e[d].side2Score].join("-"),c=!0}if(c){let h=(e.slice(0,d)||[]).filter(f=>f).map(f=>{let{side1Score:m,side2Score:g}=f;return[m,g].join("-")}).join(" ");h?n=h+" "+p:n=p}}}return{sets:e,scoreString:n,winningSide:r,matchUpStatus:a,info:i,updated:c}}function GWe({analysis:t,auto:e,lowSide:i,scoreString:n="",sets:r,value:a}){var o;let s,l,{tiebreakSet:{tiebreakTo:c,NoAD:u}}=t.setFormat,[d]=dy.split("");if(t.isMatchTiebreakEntry||(n+=d),r[t.setNumber-1]){let{lastOpenBracketIndex:p}=H0({brackets:dy,scoreString:n}),h=(n.slice((p??0)+1)+(e?"":a)).split(uh);if((((o=h[i-1])==null?void 0:o.length)||0)>=2)l="tiebreak digit limit";else if(e){i===1&&(h[0]=(h[0]||"")+a),i===2&&(h[1]=(h[1]||"")+a);let f=[h[0]||0,h[1]||0].map(v=>ai(v)),m=i===1?1:0;f[m]=f[1-m]+(u?1:2),f[m]<c&&(f[m]=c);let g=r[r.length-1];g.side1TiebreakScore=f[0],g.side2TiebreakScore=f[1],n=n.slice(0,(p??0)+1),n+=f.join(uh),s=!0}else{let f=[h[0]||0,h[1]||0].map(g=>ai(g)),m=r[r.length-1];m.side1TiebreakScore=f[0],m.side2TiebreakScore=f[1],n+=a,s=!0}}else{let p=Jbe({lowValue:ai(a||0),tiebreakTo:c,NoAD:u}),h=[ai(a),p];i===2&&h.reverse();let f={side1TiebreakScore:h[0],side2TiebreakScore:h[1],setNumber:(r==null?void 0:r.length)+1||1};r.push(f),n+=h.join(uh),s=!0}return{info:l,scoreString:n,sets:r,updated:s}}function HWe({analysis:t,lowSide:e,scoreString:i,value:n}){let{setTo:r,tiebreakAt:a,NoAD:o}=(t==null?void 0:t.setFormat)||{},s=n===parseInt(a||r);if(a&&a<r&&n>a)return{scoreString:i};if(o&&n===r||n>r)return{scoreString:i};let l=f(),c=[n,l];e===2&&c.reverse();let u=gI.split("")[0],d=c.join(Vb)+(s?u:$b);i=(i||"")+d;let p={side1Score:c[0],side2Score:c[1]},h=T8({analysis:t,set:p});return p.winningSide=h||void 0,{scoreString:i,set:p};function f(){return s?n+1:n+1===r?n+(o?1:2):r}}function zWe({matchUpFormat:t,scoreString:e,winningSide:i,value:n,sets:r}){var a,o,s;let l=(((a=r==null?void 0:r.filter(H=>H==null?void 0:H.winningSide))==null?void 0:a.length)||0)+(i?0:1),c=Zs(t),u=l===(c==null?void 0:c.bestOf),d=u&&(c==null?void 0:c.finalSetFormat)||(c==null?void 0:c.setFormat)||{},p=d==null?void 0:d.timed,h=u&&r[(c==null?void 0:c.bestOf)-1],f=h==null?void 0:h.winningSide,{isTiebreakEntry:m}=H0({brackets:gI,scoreString:e}),{isTiebreakEntry:g}=H0({brackets:dy,scoreString:e}),v=m||g,y=!!d.tiebreakSet,b=(o=e==null?void 0:e[e.length-1])==null?void 0:o.trim(),I=e&&!isNaN(b),T=!v&&b===Vb,w=m&&p$.includes(b),S=g&&p$.includes(b),D=g&&b===uh,E=e==null?void 0:e.split(""),[C]=dy.split(""),P=E&&Math.max(...np(C,E)),R=E&&Math.max(...np(uh,E)),N=E&&R>P,M=(s=r[r.length-1])==null?void 0:s.winningSide,A=(r==null?void 0:r.length)&&!M,_=kbe.find(H=>(e==null?void 0:e.indexOf(H))>=0),x=!isNaN(n),O=n===QL,B=B_.includes(n),F=e==null?void 0:e.split("").find(H=>p$.includes(H)),G=B&&g&&!S&&(D||!FWe({scoreString:e}));return{isTiebreakSetValue:y&&x,matchUpScoringFormat:c,setNumber:l,setFormat:d,matchTiebreakHasJoiner:N,isGameScoreEntry:A,isSpace:O,isCloser:B,isTiebreakCloser:B&&F&&v&&I,isDecidingSet:u,isTiebreakSet:y,isTimedSet:p,isNumericEnding:I,isNumericValue:x,hasOpener:F,hasOutcome:_,finalSet:h,finalSetIsComplete:f,lastSetIsComplete:M,isInvalidSetTiebreakValue:O&&v&&w,isInvalidMatchTiebreakValue:G,isTiebreakEntry:v,isSetTiebreakEntry:m,isMatchTiebreakEntry:g,isIncompleteSetScore:T,isIncompleteSetTiebreak:w,isIncompleteMatchTiebreak:S,isPartialMatchTiebreakValue:D}}function eIe(t){let{lowSide:e=1,value:i}=t,{scoreString:n,sets:r,winningSide:a,matchUpStatus:o}=t,{matchUpFormat:s,shiftFirst:l,auto:c=!0}=t,u,d,p=l&&e===2||!l&&e===1;if(!Zbe.includes(i))return{updated:!1,info:"invalid key"};l&&(e=3-e);let{matchUpWinningSide:h}=lX({sets:r,winningSide:a,matchUpStatus:o,matchUpFormat:s});a=h;let f=zWe({value:i,winningSide:a,scoreString:n,sets:r,matchUpFormat:s});if(Wbe.includes(i)&&(i=Vb),f.hasOpener&&f.isTiebreakEntry&&!f.isTiebreakSet&&p&&ai(i)===0&&(f.isTiebreakCloser=!0),B_.includes(i)&&f.hasOpener&&(i=""),B_.includes(i)&&(i=QL),f.lastSetIsComplete){let m=(n==null?void 0:n.length)&&n[n.length-1];n&&m!==" "&&(n+=" ")}if(f.isTimedSet)({info:d,sets:r,scoreString:n,updated:u,matchUpStatus:o,winningSide:a}=jWe({analysis:f,lowSide:e,scoreString:n,sets:r,matchUpStatus:o,winningSide:a,value:i}));else if(JL.includes(i))f.finalSetIsComplete||a?d="final set is already complete":!f.isTiebreakEntry&&!f.isIncompleteSetScore?{sets:r,scoreString:n,matchUpStatus:o,winningSide:a,updated:u}=Qbe({lowSide:e,sets:r,scoreString:n,matchUpStatus:o,winningSide:a,value:i}):f.isTiebreakEntry||f.isIncompleteSetScore?d="incomplete set scoreString or tiebreak entry":console.log("handle case",{value:i});else if(i===F_)u=!0,{scoreString:n,sets:r}=Pj({analysis:f,scoreString:n,sets:r,lowSide:e}),n||(r=[]),o=void 0,a=void 0;else if(f.hasOutcome)d="has outcome";else if(i===Vb&&!f.isMatchTiebreakEntry)(!f.isSetTiebreakEntry||f.isSetTiebreakEntry&&!f.isNumericEnding)&&(u=!0,{scoreString:n,sets:r}=Pj({analysis:f,scoreString:n,sets:r,lowSide:e}),o=void 0);else if(i===uh&&f.isMatchTiebreakEntry&&!f.isSetTiebreakEntry)f.matchTiebreakHasJoiner?d="existing joiner":f.isNumericEnding&&(u=!0,n+=uh);else if([Vb,uh].includes(i))d="invalid location for joiner";else{if(a)return{updated:!1,info:"matchUp is complete"};if(f.isIncompleteSetScore)f.isNumericValue&&({sets:r,scoreString:n,updated:u}=$We({analysis:f,scoreString:n,sets:r,value:i}));else if(f.isInvalidMatchTiebreakValue)d="invalid matchUp tiebreak character";else if(f.isInvalidSetTiebreakValue)d="invalid set tiebreak character";else if(f.isTiebreakCloser){let m=f.isSetTiebreakEntry?gI:dy,g=m.split("").reverse()[0],v=m.split("")[0],y=r[r.length-1],{tiebreakFormat:b}=f.setFormat,{tiebreakTo:I,NoAD:T}=b||{},w=tF({set:y});if(!f.isTiebreakSet){let D=parseInt(n.split(v).reverse()[0]),E=Jbe({lowValue:D,tiebreakTo:I,NoAD:T});w===1?(y.side1TiebreakScore=E,y.side2TiebreakScore=D):(y.side1TiebreakScore=D,y.side2TiebreakScore=E)}n=(n||"")+g,f.isDecidingSet||(n+=$b);let S=T8({analysis:f,set:y});y.winningSide=S||void 0,u=!0}else if(f.isTiebreakSetValue)({info:d,scoreString:n,sets:r,updated:u}=GWe({analysis:f,auto:c,lowSide:e,scoreString:n,sets:r,value:i}));else if(f.isSetTiebreakEntry){let[m]=gI.split(""),g=Math.max(...np(m,n.split(""))),v=n.slice(g+1),y=v&&ai(v)===kWe,b=ai(v?v+i:i),{tiebreakFormat:I}=f.setFormat,{tiebreakTo:T,NoAD:w}=I||{};!y&&v.length<2?w&&b>T-1?d="invalid low value for NoAD tiebreak":(u=!0,n=(n||"")+i):d=y?"tiebreak begins with zero":"tiebreak digit limit"}else if(f.isCloser)d=`invalid key: ${i}`;else if(f.isGameScoreEntry)d="game scoreString entry";else if(f.lastSetIsComplete||!r.length){u=!0;let{scoreString:m,set:g}=HWe({analysis:f,lowSide:e,scoreString:n,value:ai(i)});g&&(g.setNumber=(r==null?void 0:r.length)+1||1),r=(r==null?void 0:r.concat(g).filter(Boolean))||[g],n=m||void 0}else console.log("error: unknown outcome")}if(u){r=r==null?void 0:r.filter(Boolean);let{matchUpWinningSide:m}=lX({sets:r,winningSide:a,matchUpStatus:o,matchUpFormat:s});return a=m,m&&(!o||[Kr,bp].includes(o))?(o=RWe,r=r.filter(g=>{let{side1Score:v,side2Score:y,side1TiebreakScore:b,side2TiebreakScore:I}=g;return v||y||b||I})):n&&!a&&![Lbe,Obe,Bbe].includes(o)&&(o=void 0),{updated:u,scoreString:n,sets:r,winningSide:a,matchUpStatus:o,info:d}}return{updated:u,scoreString:n,sets:r,winningSide:a,matchUpStatus:o,info:d}}var iF="\\d+-\\d+",EE="\\d+-\\d+\\(\\d+\\)",U8="\\[\\d+-\\d+\\]",qWe="\\d+-\\d+\\(\\d+-\\d+\\)",WWe=new RegExp(`(${iF}),`,"g"),KWe=new RegExp(`(${EE}),`,"g"),YWe=[iF,EE,U8,qWe],ZWe=["0","1","2","00","01","10","11","002","012","102","112","000","001","010","100","011","101","110","111","002","012","102","112","0002","0012","0102","1002","0112","1012","1102","1112","3","03","13","013","103"],XWe=ZWe.map(t=>{let e=t.split("").map(i=>YWe[i]).join(" ");return new RegExp(`^${e}$`)});function cX(t){return!t||XWe.some(e=>e.test(t))}function JWe(t){let e="[];",i="()",n=e+i,r=[e[0],i[0]],a=Object.assign({},...n.split("").map(l=>({[l]:0}))),o="",s=t.split("").map(l=>{let c=n.includes(l)&&l,u=r.includes(c);if(u&&c)return a[c]+=1,o=c,l;if(!u&&c&&o&&c!==o){a[o]-=1;let d=e.includes(o)&&e||i.includes(o)&&i||"",p=d.split("").find(h=>h!==o);if(d.includes(c))a[o]||(o="");else return a[c]||(o=""),p}return l}).join("");return t!==s?s:t}function KN(t){return/^\(\d+\)$/.test(t)||/^\(\d+$/.test(t)}function QWe(t){return/^\(\d+-\d+\)$/.test(t)||/^\[\d+-\d+\]$/.test(t)}function KS(t){let e=(i=>i==null?void 0:i.split("-").join("").split("/").join(""))(t);if(/^\d+$/.test(e)&&e.length===2){let i=e.split("");return Math.abs(i.reduce((n,r)=>+n-+r))===1}return!1}function $_(t,e){let i=[t.slice(e,e+2),e?t.slice(0,1):t.slice(2)].map(r=>parseInt(r.join("")));e&&i.reverse();let n=i;if(Math.abs(n.reduce((r,a)=>+r-+a))>=2)return n.join("-")}function uX(t){return t.length===2?t.split("").join("-"):([", ",",","/"," "].forEach(e=>t=t.split(e).join("-")),t=t.replace(/-{2,}/,"-"),t)}function e4e(t){return t.startsWith("(")&&t.endsWith(")")}function t4e({score:t,applied:e}){t=JWe(t);let i=/\)(\d+)/g;if(i.test(t))for(let w of t.match(i)){let S=w.replace(")",") ");t=t.replace(w,S)}t=t.replace(/\)\//g,") / "),t=t.replace(/\/\)/g,")");let n=/\(([\d- ]+)\)/g,r=/\(([\d- ]+)\)/,a=t.match(n);for(let w of a||[]){let[S]=w.match(r).slice(1),D=S.replace(/ /g,"");t=t.replace(w,`(${D})`)}let o=/\(\(\d-\d\)\)/g;if(o.test(t)){let w=t.match(o);w.length&&w.forEach(S=>{let D=S.match(/\((\(\d-\d\))\)/).slice(1)[0];t=t.replace(S,D)})}if(o=/\(\((\d)\)\)/g,o.test(t)){let w=t.match(o);w.length&&w.forEach(S=>{let D=S.match(/\((\(\d\))\)/).slice(1)[0];t=t.replace(S,D)})}/(^|\s)6-,/.test(t)&&(t=t.replace(/(^|\s)6-,/g,"6-0,"));let s=new RegExp(/[-,]{2,}/g);t=t.replace(s,"-"),["- "," -"].forEach(w=>{let S=new RegExp(`(\\d+)${w}(\\d+)`,"g"),D=t.match(S);D&&D.forEach(E=>t=t.replace(E,E.split(w).join("-")))}),/^[(-/,]+$/.test(t)&&(t=""),/\)[-/,]+$/.test(t)&&(t=t.slice(0,t.length-1)),/\d \/\d/.test(t)&&(t=t.replace(/ \//g,"/")),t.includes(" /")&&(t=t.replace(/ \//g," "));let l=/\(\d+, \)/g;l.test(t)&&t.match(l).forEach(w=>{let[S]=w.match(/\((\d+), \)/).slice(1);S.length===2?t=t.replace(w,`(${S})`):S.length===1&&S==="6"&&(t=t.replace(w,"(6-0)"))});let c=/\((\d+)\/\)/g;c.test(t)&&t.match(c).forEach(w=>{let[S]=w.match(/\((\d+)\/\)/).slice(1);S.length===2?t=t.replace(w,`(${S})`):S.length===1&&S==="6"?t=t.replace(w,"(6-0)"):t=t.replace(w,`(${S})`)});let u=/\d\/\d\/,/g;u.test(t)&&t.match(u).forEach(w=>{let[S]=w.match(/(\d\/\d)\/,/).slice(1);t=t.replace(w,`${S},`),e.push("slashComma")});let d=/\(\/(\d+)\)/g;d.test(t)&&t.match(d).forEach(w=>{let[S]=w.match(/\(\/(\d+)\)/).slice(1);S.length===2?t=t.replace(w,`(${S})`):S.length===1&&parseInt(S)<6?t=t.replace(w,`(6-${S})`):t=t.replace(w,`(${S})`)});let p,h,f,m,g,v=()=>{g=xl(t.split("")),h=g["("]===(g[")"]||0)+1,p=(g["("]||0)+1===g[")"],f=g["["]===g["]"]+1,m=h&&!f};v();let y=/(\d+-\d+\(\d+)0,/;if(y.test(t)){let[w]=t.match(y).slice(1);t=t.replace(y,w+")")}if(g["("]===g[")"]&&g["("]>1){let w=t.split(")(").join(") (").split(" ");w.every(e4e)?t=w.map(S=>{let D=S.slice(1,S.length-1);return D.length>2?D:S}).join(" "):t=w.join(" ")}v();let b=/[A-Za-z]+/.test(t),I=/\d+/.test(t);if(!b&&!I)return{score:""};if(/^\[.+\]$/.test(t)&&"()/,- ".split("").some(w=>g[w])&&(t=t.slice(1,t.length-1)),/^\(.+\)$/.test(t)&&g["("]===1&&g[")"]===1&&"[]/,".split("").some(w=>g[w]>1)&&(t=t.slice(1,t.length-1)),t.startsWith("(")&&t.endsWith("))")&&(t=t.slice(1,t.length-1)),g["("]>(g[")"]||0)&&t[t.length-1]==="("&&(t=t.slice(0,t.length-1)+")",v()),g["("]===1&&!g[")"]&&t[0]==="("&&(t=t+")",v()),g["("]>(g[")"]||0)&&t.slice(0,2)==="(("&&(t=t.slice(1)),p){if(/^9\d/.test(t))t="("+t.slice(1);else if(t[0]!=="(")t="("+t;else{let w=[],S=0;for(let D of t.split("").reverse())D===")"&&(S?w.push("("):S+=1),D==="("&&(S-=1),w.push(D);w.reverse(),t=w.join("")}v()}if(g[")"]>(g["("]||0)&&t[0]===")"&&(t="("+t.slice(1),v()),m&&(t.endsWith(9)||/\d+0$/.test(t))&&(t=t.slice(0,t.length-1)+")",v()),m&&(!t.endsWith(")")||t.startsWith("(("))&&(t=t+")",v()),m){let w="",S=0;for(let D of t.split(""))D==="("&&(S?w+=")":S+=1),D===")"&&(S-=1),w+=D;t=w}v(),f&&!h&&(t=t+"]"),t.includes("([")&&t.includes("])")&&(t=t.split("([").join("[").split("])").join("]"),v()),/\(\d+0$/.test(t)&&(t=t.slice(0,t.length-1)+")"),v(),g[")"]===1&&!g["("]&&t.endsWith(")")&&(t=t.slice(0,t.length-1)),t.startsWith("(")&&t.endsWith(")")&&g["("]===1&&g[")"]===1&&(t=t.slice(1,t.length-1),v());let T=w=>{let S=w.indexOf("("),D=w.indexOf(")");return S>=0&&D>=0&&S<D};if(/^\([\d ]+.*[\d ]+\)$/.test(t)&&g["("]===g[")"]){let w=t.slice(1,t.length-1);T(w)&&(t=w,v())}return{score:t,applied:e}}function nF(t){if(!/^[\d-]+(\(\d\))*$/.test(t))return t;let e=np("-",t.split(""));if(!e.length)return t;let i=t.split("-"),n=!(i.length%2),r=!!(e.length%2);return n&&r&&e.length>i.length/2&&e.filter((a,o)=>o%2).forEach(a=>{t=t.substring(0,a)+" "+t.substring(a+1)}),t}function i4e({score:t,applied:e}){return t.includes("( ")&&(e.push("removeParenSpacingAfterOpen"),t=t.split("( ").map(i=>i.trim()).join("(")),t.includes(" )")&&(e.push("removeParenSpacingBeforeClose"),t=t.split(" )").map(i=>i.trim()).join(")")),[WWe,KWe].forEach(i=>{let n=t.match(i);n!=null&&n.length&&(n.forEach(r=>{t=t.replace(r,r.slice(0,r.length-1)+" ")}),e.push("setsEndComma"))}),t=t.split(" ").filter(Boolean).map(nF).join(" "),{score:t,applied:e}}function n4e({score:t}){if(typeof t!="string")return{score:t};let e=p=>p==null?void 0:p.split("-").join("").split("/").join(""),i=p=>p.split("[").join("(").split("]").join(")");t=t.split(", ").join(" ");let n=t.split(" ");t=n.map(p=>{let h=/^-(\d+)$/;if(h.test(p)){let[f]=p.match(h).slice(1);if(f.length===2)return f.split("").join("-")}return p}).join(" "),n=t.split(" ");let r=n.filter(KN),a=0,o="";for(let p of r){let h=np(p,n).filter(v=>!a||v>a)[0],f=n.slice(a,h-1),m=n[h-1],g=e(m);if(/^\d+$/.test(g)&&g.length===2){let v=g.split(""),y=Math.abs(v.reduce((b,I)=>+b-+I));if(y===1){let b=[f.join(" "),[m,p].join("")].join(" ");o+=b,a=h+1}else if(y===0){let b=Math.max(...v);if([4,5,6,7,8,9].includes(b)){let I=[6,4].includes(b)?b+1:b-1,T=[b,I].sort().reverse().join("-"),w=[f.join(" "),[T,p].join("")].join(" ");o+=w,a=h+1}}}}if(r.length&&o.length){let p=n.slice(a).join(" ");return o=[o,p].join(" "),{score:o.trim()}}if(n.length===2&&["(","["].some(p=>n[1].includes(p))){let p=e(n[0]).split("");if(Math.abs(p.reduce((h,f)=>+h-+f,0))===1)return n[1]=i(n[1]),{score:n.join("")}}let s=n.map(p=>QWe(p)&&"bracket"||KS(p)&&"set");if(s.includes("set")&&s.includes("bracket")){let p,h="";return n.forEach((f,m)=>{s[m]==="bracket"&&p==="set"?(f=i(f),h+=f):h+=` ${f}`,p=s[m]}),{score:h.trim()}}n=t.split(" ");let l,c=n.map(p=>{let h=new RegExp(/^(\d+)-(\d+)$/);if(h.test(p)){let[f,m]=p.match(h).slice(1),g=Math.abs([f,m].reduce((y,b)=>+y-+b)),v=Math.max(f,m);if(g===1)return l="tiebreakSet",l;if(g>=2&&v>=7&&l==="tiebreakSet")return l="tiebreak",l}}),u=np("tiebreak",c);if(u.length){let p="";n.forEach((h,f)=>{u.includes(f)?p+=`(${h}) `:u.includes(f+1)?p+=`${h}`:p+=`${h} `}),t=p.trim()}let d=/(\d+-\d+)\((\d+)-(\d+)\)$/;if(d.test(t)){let[p,h,f]=t.match(d).slice(1),m=Math.max(h,f)>=10;!KS(p)&&m&&(t=t.replace(d,`${p} [${h}-${f}]`))}return c=[],t=t.split(" ").map(p=>{let h=/^\((.*)\)$/,f=h.test(p),m=new RegExp(U8).test(p)&&"super"||new RegExp(EE).test(p)&&"tiebreak"||new RegExp(iF).test(p)&&"standard"||"unknown";return c.push(m),m==="standard"&&f?p.match(h)[1]:p}).join(" "),{score:t}}function r4e({score:t,applied:e}){for(let D of[".",","," ","/"]){let E=new RegExp(`^(\\d+)\\${D}(\\d+)$`);if(E.test(t)){let C=t.match(E).slice(1).map(R=>parseInt(R)),P=Math.abs(C[0]-C[1]);P<=10&&P>=2&&(t=t.split(D).join("-"),e.push("variedJoinerPattern"))}}t.includes(";")&&(t=t.split(";").join(" "),e.push("semicolon set separation"));let i=/(^|\s)(\d)\/(\d)(\d)\/(\d)(\(|$)/;if(i.test(t)){let[D,E,C,P,R,N]=t.match(i).slice(1);t=t.replace(i,`${D}${E}-${C} ${P}-${R}${N}`),e.push("smashSlashPattern")}/.*\s6[/-]+$/.test(t)&&(t+="0",e.push("incompleteFinalSetPattern"));let n=/\(6,\)/g;n.test(t)&&(t=t.replace(n,"(6, 0)"),e.push("missingZeroPattern1"));let r=/^\d{3,}\(/,a=/\(\d+\)\d+/;[r,a].forEach(()=>{t=t.split(" ").map(D=>(r.test(D)&&(D=D.replace("("," (")),a.test(D)&&(D=D.replace(")",") ")),D)).join(" "),e.push("spaceConsiderationPatterns")});let o=nF(t);o!==t&&(t=o,e.push("deDashMash"));let s=/^(\d)[-/,]+(\d{2})[-/,]+(\d)$/;if(s.test(t)){let[D,E,C]=t.match(s).slice(1),[P,R]=E.split("");t=`${D}-${P} ${R}-${C}`,e.push("smashSetPattern")}let l=/^(\d+)[ -](\d+)$/,c=/^([\d -]+)\/([\d -]+)$/;if(c.test(t)){let[D,E]=t.match(c).slice(1),C=D.trim(),P=E.trim();if(l.test(C)&&l.test(P)){let R=C.match(l).slice(1,3).join("-"),N=P.match(l).slice(1,3).join("-");t=`${R} ${N}`,e.push("slashSeparationPattern")}}let u=/^([\d -]+),([\d -]+)$/;if(u.test(t)){let[D,E]=t.match(u).slice(1),C=D.trim(),P=E.trim();if(l.test(C)&&l.test(P)){let R=C.match(l).slice(1,3).join("-"),N=P.match(l).slice(1,3).join("-");t=`${R} ${N}`,e.push("commaSeparationPattern")}}let d=/^\d \d,/;if(d.test(t)){let D=t.match(d)[0],E=D.slice(0,D.length-1).split(" ").join("-");t=t.replace(D,E),e.push("singleSetCommaSeparationPattern")}let p=0,h=/(\d+)-(\d{2})-(\d+)/;for(;h.test(t)&&p<3;){let[D,E,C]=t.match(h).slice(1),P=E.split(""),R=`${D}-${P[0]} ${P[1]}-${C}`;t=t.replace(h,R),e.push("noSetSeparationPattern"),p+=1}let f=/(^|\s)7-6\s(\d+)\s/g,m=t.match(f);if(m!=null&&m.length){let D=/(^|\s)7-6\s(\d+)\s/;m.forEach(E=>{let C=E.match(D).slice(2)[0];t=t.replace(E,`7-6(${C}) `),e.push("floatingTiebreakPattern1")})}let g=t.match(/\d \d /);g==null||g.forEach(D=>{let E=D.slice(0,D.length-1).split(" ").join("-");t=t.replace(D,E),e.push("spaceSeparatedSetPattern1")}),g=t.match(/ \d \d$/),g==null||g.forEach(D=>{let E=" "+D.slice(1).split(" ").join("-");t=t.replace(D,E),e.push("spaceSeparatedSetPattern2")});let v=/^\d, *\d\/\d, *\d/;if(v.test(t)){let D=t.match(v)[0],E=D.split("/").map(C=>`(${C})`).join(" ")+" ";t=t.replace(D,E),e.push("slashCommaSetPattern")}let y=/\(6-\)/g;y.test(t)&&(t=t.replace(y,"(6-0)"),e.push("missingZeroPattern2"));let b=new RegExp("(?<!-)(\\d+)\\/(\\d+)(?!-)","g");if(b.test(t)){let D=t.match(b),E=new RegExp("(?<!-)(\\d+)\\/(\\d+)(?!-)"),C=t;D.forEach(P=>{let[R,N]=P.match(E).slice(1),M=`${R}-${N}`;C=C.replace(P,M)}),t=C,e.push("slashSetPattern")}let I=/(.*)\s(1\d)\s(\d+)$/;if(I.test(t)){let[D,E,C]=t.match(I).slice(1);D.replace(/\D/g,"").length>=4&&(t=D+` ${E}${C}`,e.push("spaceSeparatedSuperPattern"))}let T=/(^|\s)(\d+-\d+)\s(\d+)(\s|$)/g;for(let D of t.match(T)||[]){let[E,C,P,R]=D.match(/(^|\s)(\d+-\d+)\s(\d+)(\s|$)/).slice(1),[N,M]=C.split("-").map(A=>parseInt(A));Math.abs(N-M)===1&&(t=t.replace(D,`${E}${C}(${P})${R}`),e.push("spaceSeparatedSetPattern"))}let w=/\d-\d \(\d{1,2}\)(\s|$|,)/g;for(let D of t.match(w)||[]){let E=/(\d-\d) \((\d{1,2})\)(\s|$|,)/,[C,P,R]=D.match(E).slice(1),[N,M]=C.split("-").map(A=>parseInt(A));Math.abs(N-M)===1&&(t=t.replace(D,`${C}(${P})${R}`),e.push("floatingTiebreakPattern2"))}let S=/(^|\s)(\d \d)\(/g;for(let D of t.match(S)||[]){let E=/(^|\s)(\d \d)\(/,[C,P]=D.match(E).slice(1);t=t.replace(D,`${C}${P.split(" ").join("-")}(`),e.push("spacedTiebreakPattern")}return{score:t,applied:e}}function a4e({score:t,matchUpStatus:e}){var i;let n=t==null?void 0:t.split(" ");t=n.map(l=>{if(l.endsWith("]")){let c=l.split("[");if(KS(c[0]))return c[0]+`(${c[1].slice(0,c[1].length-1)})`}return l}).join(" ");let r=new RegExp(/(\([\d ]+\))/g);if(r.test(t))for(let l of t.match(r)){let c=(i=l.replace(" ","-").match(/\((.*)\)/))==null?void 0:i[1];if(Lr(c)&&(c==null?void 0:c[0])>2){if([2,4].includes(c.length))c=c.split("").join("-");else if(c.length===3){let u=c.indexOf("1");c=$_(c.split(""),u)}}t=t.replace(l,`(${c})`)}n=t==null?void 0:t.split(" ");let a=new RegExp(/^(\d[-/]+\d)\((\d+)[-/]+(\d+)\)$/),o=n.length-1;t=n.map((l,c)=>{let u=[void 0,"","COMPLETED"].includes(e)||c!==o;if(a.test(l)&&u){let[d,p,h]=Array.from(l.match(a)).slice(1),f=Math.min(p,h);return`${d}(${f})`}return l}).join(" "),n=t==null?void 0:t.split(" "),a=new RegExp(/^(\d{2})\((\d+)\)$/),t=n.map(l=>{if(a.test(l)){let[c,u]=Array.from(l.match(a)).slice(1),d=c.split("");return`${d[0]}-${d[1]}(${u})`}return l}).join(" "),n=t==null?void 0:t.split(" "),a=new RegExp(/^\((\d[-/]+\d)\)(\d+)$/),t=n.map(l=>{if(a.test(l)){let[c,u]=Array.from(l.match(a)).slice(1);return KS(c)?`${c}(${u})`:c}return l}).join(" "),n=t==null?void 0:t.split(" "),a=new RegExp(/^1-0\((\d+)\)$/),t=n.map(l=>{if(a.test(l)){let[c]=l.match(a).slice(1);return`[${c<9?10:parseInt(c)+2}-${c}]`}return l}).join(" ");let s=/\((\d)+0 /;if(s.test(t)){let l=t.match(s)[1];t=t.replace(s,`(${l}) `)}return{score:t}}function o4e({score:t,attributes:e,identifier:i}){var n,r,a;if(typeof t!="string")return{score:t,identifier:i};let o=new RegExp(/\([\d,/ ]+\)/g),s=t.match(o);for(let h of s||[]){let f=(r=(n=h.match(/^\((.*)\)$/))==null?void 0:n.slice(1))==null?void 0:r[0],m=t.split(h)[0].split(")").reverse()[0].replace(/\D/g,"");if((f==null?void 0:f.length)===2&&(m==null?void 0:m.length)>=2){let y=m.slice(m.length-2).split("").map(b=>parseInt(b));if(Math.abs(y[0]-y[1])===1)continue}let g=uX(f),v=nF(g);t=t.replace(h,`(${v})`).trim()}let l=new RegExp(/\[[\d,/ ]+\]/g);(a=t.match(l))==null||a.forEach(h=>{let f=uX(h.match(/^\[(.*)\]$/)[1]);t=t.replace(h,`(${f}) `).trim()});let c=[")","]"],u=[")(","), (",") (",")[",") [","](","] ("];if(t.startsWith("(")&&c.some(h=>t.endsWith(h))&&u.some(h=>t.includes(h))){let h="",f=t.split(/[)\]]/).filter(Boolean).map(b=>(b.startsWith(",")&&(b=b.slice(1)),b.trim())),m=f.every(b=>b.includes(",")||KN(b)),g=f.every(b=>b.includes("/")||KN(b)),v=f.every(b=>b.includes("-")||KN(b)),y=m&&","||v&&"-"||g&&"/";if(y){let b;f.forEach(I=>{if(I.startsWith("("))if(b==="set"&&(h+=" "),I.includes(y))h+=I.slice(1).split(y).map(T=>T.trim()).join("-"),b="set";else{let T=I.slice(1);h+=`(${T}) `,b="tiebreak"}else if(I.startsWith("[")){let T=I.slice(1).split(y).map(S=>parseInt(S.trim())),w=Math.min(...T);b==="set"?h+=`(${w}) `:h+=`[${T.join("-")}] `,b="tiebreak"}}),t=h.trim()}}let d=xl(t.split(""));d["("]===1&&d[")"]===1&&t.startsWith("(")&&t.endsWith(")")&&(t=t.slice(1,t.length-1),d["-"]===1&&KS(t)&&Lr(e==null?void 0:e.removed)&&(t=t+`(${e.removed})`,e.removed=void 0));let p=/\(\)/g;return p.test(t)&&(t=t.replace(p,"").trim()),{score:t}}function tIe({score:t}){let e=t.split(""),i=[],n,r=()=>n=[void 0,void 0,void 0],a=()=>{let s=`${n[0]}-${n[1]}`;return n[2]&&(s+=` (${n[2]})`),r(),n.push(n),s};r();let o=()=>n[0]!==void 0&&n[1]!==void 0&&Math.abs(parseInt(n[0])-parseInt(n[1]));for(;e.length;){let s=e.shift(),l=Lr(s)&&parseInt(s),c=n[0]!==void 0&&n[1]!==void 0;if(Lr(l)){if(n[0]===void 0){n[0]=l;continue}if(n[1]===void 0&&(n[1]=l,o())){i.push(a()),n=[void 0,void 0];continue}if(c&&e.length===1&&Lr(e[0])){let u=e.pop();n[0]=n[0].toString()+n[1].toString(),n[1]=u,i.push(a()),n=[void 0,void 0]}c&&o()}}return{sets:i}}function Rj(t){let e=t.indexOf("1"),i=t.split(""),n=i.every(r=>!isNaN(r));if(n&&t.length===3&&e===0){let r=$_(i,e);if(r)return r}if(n&&t.length===7&&e>3){let r=i.slice(4),a=$_(r,e-4);if(a)return`${i[0]}-${i[1]} ${i[2]}-${i[3]} ${a}`}}function iIe(t){let{score:e}=t,{applied:i,matchUpStatus:n}=t,r=e==null?void 0:e.toString().split(""),a=r==null?void 0:r.every(s=>Lr(s)),o=s=>Math.abs(s[0]-s[1]);if(typeof e=="number"||a){e=e.toString().toLowerCase(),a&&(e=r.join(""));let s=a?r.map(l=>parseInt(l)):e.split("").map(l=>parseInt(l));if(tIe({score:e}),s.length,e.length===3&&o(s.slice(0,2))===1){let[l,c,u]=s;e=`${l}-${c}(${u})`,i.push("numericTiebreakPattern1")}else if(e.length===3&&s[0]===1){let[l,c,u]=s;e=`[${l}${c}-${u}]`,i.push("numericTiebreakPattern2")}else if(e.length===4&&o(s.slice(0,2))===1&&"987654".split("").includes(s[0].toString())){let[l,c,u,d]=s,p=Math.min(u,d);e=`${l}-${c}(${p})`,i.push("numericTiebreakPattern3")}else if(e.length===4&&s[0]===1&&s[2]===1){let[l,c,u,d]=s;e=`[${l}${c}-${u}${d}]`,i.push("bigSuper")}else if(e.length===4){let[l,c,u,d]=s;e=`${l}${c} ${u}${d}`,i.push("split4")}else if(e.length===5&&o(s.slice(0,2))===1){let[l,c,u,d,p]=s;e=`${l}-${c}(${u}) ${d}-${p}`,i.push("numericTiebreakPattern4")}else if(e.length===5&&o(s.slice(3))===1){let[l,c,u,d,p]=s;e=`${l}-${c} ${u}-${d}(${p})`,i.push("numericTiebreakPattern5")}else if(s.length===7)if(o(s.slice(0,2))>1&&o(s.slice(2,4))>1&&s[4]===1){let[l,c,u,d,p,h,f]=s;e=`${l}-${c} ${u}-${d} [${p}${h}-${f}]`,i.push("numericTiebreakPattern6")}else if(o(s.slice(0,2))===1&&o(s.slice(3,5))>1&&o(s.slice(5,7))>1){let[l,c,u,d,p,h,f]=s;e=`${l}-${c}(${u}) ${d}-${p} ${h}-${f}`,i.push("numericTiebreakPattern7")}else if(o(s.slice(0,2))>1&&o(s.slice(2,4))===1&&o(s.slice(5,7))>1){let[l,c,u,d,p,h,f]=s;e=`${l}-${c} ${u}-${d}(${p}) ${h}-${f}`,i.push("numericTiebreakPattern8")}else if(o(s.slice(0,2))>1&&o(s.slice(2,4))>1&&o(s.slice(4,6))===1){let[l,c,u,d,p,h,f]=s;e=`${l}-${c} ${u}-${d} ${p}-${h}(${f})`,i.push("numericTiebreakPattern9")}else e=e.slice(0,2)+" "+e.slice(2,4)+" "+e.slice(4),i.push("numericMatchTiebreakPattern");else if(e.length%2){let l=Rj(e);l&&e!==l&&i.push("parsedSuperPattern"),e=l??e}else{let l=so(e.split(""),2).map(g=>g.join("")),c=l.map(g=>{let[v,y]=g.split("").map(T=>parseInt(T)),b=Math.abs(v-y),I=v>y?1:2;return b>1&&I||I*-1}),u=c.reduce((g,v)=>g>0&&v>0,1),d=xl(c),p=c.map(g=>Math.abs(g)),h=xl(p),f=c[0]<0,m=!f&&c[1]<0;if(c[0]>0&&c[1]>0&&c[0]!==c[1])e=[l.slice(0,2).join(" "),l.slice(2).join("-")].join(" "),i.push("numeric3rdSetTiebreakPattern");else if(u)e=l.join(" "),i.push("chunkSplit");else if(s.length==6){if(d[1]==2||d[2]===2)if(!Object.values(h).includes(3))e=l.join(" "),i.push("chunkSplit");else{let[g,v,y,b,I,T]=s,w=c.reduce((S,D,E)=>D<0?E:S,void 0);if(w===0){let S=Math.min(y,b);e=`${g}-${v}(${S}) ${I}-${T}`,i.push("chunkSplitTiebreak1")}else if(w===1){let S=Math.min(I,T);e=`${g}-${v} ${y}-${b}(${S})`,i.push("chunkSplitTiebreak2")}else e=`${g}-${v} ${y}-${b}`,i.push("chunkSplitTrimExtraneous")}}else if(s.length===8){let[g,v,y,b,I,T,w,S]=s;f||m?s[5]===1&&(f?e=`${g}-${v}(${y}) ${b}-${I} [${T}${w}-${S}]`:e=`${g}-${v} ${y}-${b}(${I}) [${T}${w}-${S}]`):(c[0],c[1])}}}return{score:e,applied:i,matchUpStatus:n}}function nIe(t){let e=[0,0],i=[],n=t.split(" "),r=/(\d+)-(\d+)/;n.forEach(l=>{if(r.test(l)){let c=l.match(r).slice(1).map(d=>parseInt(d)),u=c[0]>c[1]&&1||c[1]>c[0]&&2;u&&(e[u-1]+=1,i.push(u))}});let a=e[0]>e[1]&&1||e[1]>e[0]&&2,o=e[0]>0&&e[0]===e[1],s=e.reduce((l,c)=>l+c,0);return{setsWon:e,setsTied:o,setWinners:i,totalSets:s,winningSide:a}}function s4e({score:t,matchUpStatus:e,attributes:i}){let n=[],r,a=t.split(" "),o=a.length;t=a.map((u,d)=>{if(new RegExp(EE).test(u)){let h=u.slice(3),f=u.slice(0,3),m=f.split("-");if(!KS(f)&&!e){let g=Math.max(...m),v=f.indexOf(g),y=[g,g-1];return v&&y.reverse(),y.join("-")+h}}else if(u.length===2&&Lr(u))return u.split("").join("-");u=nF(u);let p=new RegExp(`^${U8}$`).test(u)&&"super"||new RegExp(`^${EE}$`).test(u)&&"tiebreak"||new RegExp(`^${iF}$`).test(u)&&"standard"||"unknown";if(n.push(p),o>1&&p==="standard"&&d<2){let[h,f]=u.split("-"),m=Math.abs(parseInt(h)-parseInt(f)),g=Math.max(h,f),v=Math.min(h,f),y=[parseInt(h),parseInt(f)].indexOf(v);if(g>9&&m>2){let b=g.toString().split(""),I=b.find(T=>parseInt(T)>v||d&&parseInt(T)<=r)??b[0];I&&(u=y?[I,v].join("-"):[v,I].join("-"))}g>(r||0)&&(r=g)}if(p==="standard"){let[h,f]=u.split("-");if(!Math.abs(parseInt(h)-parseInt(f))&&e!=="RETIRED")return""}return u}).filter(Boolean).join(" ");let{setsWon:s,setWinners:l,totalSets:c}=nIe(t);if(c===1&&(i==null?void 0:i.removed)==="6"&&(t+=" 6-0"),t.split(" ").length>2&&Math.max(...s)>=2&&l[0]===l[1]&&(t=t.split(" ").slice(0,2).join(" ")),Math.max(...s)>2){let u=[0,0];t=t.split(" ").map((d,p)=>(u[l[p]]+=1,Math.max(...u)>2?void 0:d)).filter(Boolean).join(" ")}return{score:t,profile:n}}function l4e({score:t}){let{setsTied:e,winningSide:i}=nIe(t),n=/\s\((\d+)\)$/;if(!i&&e&&n.test(t)){let s=t.match(n).slice(1)[0],l=s<=8?10:s+2;t=t.replace(n,` [${l}-${s}]`)}let r=t.split(" "),a=r[r.length-1];if(!a.includes("-")||a.indexOf("(")>0)return{score:t};let o=a.split("(").join("").split(")").join("").split("-");if(!o.every(s=>Lr(s)))return{score:t};if(o[0]==="76"){let s=o[1].length===2?Math.min(...o[1].split("").map(l=>parseInt(l))):o[1];t=[...r.slice(0,r.length-1),`7-6(${s})`].join(" ")}else{o=o.map(c=>parseInt(c));let s=Math.max(...o),l=Math.abs(o[0]-o[1]);if(s>=10){if(l>2&&o.every(c=>+c>=10)){let c=o.map(u=>u===s?u-10:10).sort();l=Math.abs(c[0]-c[1]),l>2&&(o=c)}t=[...r.slice(0,r.length-1),`[${o.join("-")}]`].join(" ")}else r.length===3&&s>=7&&l>2&&(t=[...r.slice(0,r.length-1),`[${o.join("-")}]`].join(" "))}return{score:t}}function c4e({score:t}){return t=(t==null?void 0:t.toString().toLowerCase())||"",{score:t}}function u4e({score:t,applied:e}){return typeof t!="string"?{score:t}:(t.toLowerCase().includes("o")&&(t=t.toLowerCase().split(" ").map(i=>i.split("o").join("0")).join(" "),e.push("replaceOh")),{score:t,applied:e})}function d4e({score:t,applied:e}){return typeof t!="string"?{score:t}:(t=t.toLowerCase().split(" ").map(i=>{if(/^\d+$/.test(i)&&i.length>2){let n=i.indexOf("1");if(i.length%2){if(i.length===3&&n===0){let r=$_(i.split(""),n);return e.push("getSuper"),r}}else{let{score:r,applied:a}=iIe({score:i,applied:[]});r!==i&&(i=r,e.push(...a))}}return i}).join(" "),{score:t,applied:e})}function p4e({score:t,applied:e}){return typeof t!="string"?{score:t}:[3,4].includes(t.length)&&Rj(t)?{score:Rj(t)}:(t=t.toLowerCase().split(" ").map(i=>{if(/^\d+$/.test(i)&&i.length===1){e.push("removeErroneous1");return}return i}).filter(Boolean).join(" "),{score:t,applied:e})}function h4e({score:t,applied:e}){return["walkover","wo","w/o","w-o"].includes(t==null?void 0:t.toString().toLowerCase())?(e.push("handleWalkover"),{matchUpStatus:"walkover",score:"",applied:e}):{score:t}}function f4e({score:t,profile:e,applied:i}){var n;t=t==null?void 0:t.toString().toLowerCase();let r=/^(.*\d+.*)(ret|con)+[A-Za-z ]*$/;if(r.test(t)){let[s]=t.match(r).slice(1);return i.push("handleRetired"),{score:s.trim(),matchUpStatus:"retired",applied:i}}let a=(n=e==null?void 0:e.matchUpStatuses)==null?void 0:n.retired,o=["rtd",...Array.isArray(a)?a:[a].filter(Boolean)].find(s=>t==null?void 0:t.endsWith(s));return o?(i.push("handleRetired"),{matchUpStatus:"retired",score:t==null?void 0:t.replace(o,"").trim(),applied:i}):{score:t}}function m4e({score:t,attributes:e}){(t.endsWith(" am")||t.endsWith(" pm"))&&(t=""),t=t.replace(/[A-Za-z]+/g,"").trim(),[".",","].some(r=>t.endsWith(r))&&(t=t.slice(0,t.length-1));let i="()/-".split("").some(r=>t.includes(r));/ \d$/.test(t)&&i&&(e={removed:t.slice(t.length-2).trim()},t=t.slice(0,t.length-2));let n=/(.*)[A-Za-z]+$/;return n.test(t)&&(t=t.match(n).slice(1)[0].trim()),{score:t,attributes:e}}function g4e({score:t}){return new RegExp(/-\d+\/\d+-/).test(t)&&(t=t.split("/").join(" ")),{score:t}}function v4e({score:t}){let e=new RegExp(/^\d+\/\d+/),i=t.split(" ");i.some(r=>e.test(r))&&(t=i.map(r=>e.test(r)?r.replace("/","-"):r).join(" "));let n=/^(\d+), *(\d+)$/;if(n.test(t)){let[r,a]=t.match(n).slice(1);t=[r,a].join("-")}return{score:t}}function y4e({score:t}){let e=new RegExp(/\(\d+\/\d+\)/g),i=t.match(e);for(let n of i||[]){let r=n.replace("/","-");t=t.replace(n,r)}return{score:t}}function b4e({score:t}){if(t.includes(",")){let e=t.split(",").map(n=>n.trim()),i=n=>/\d \d/.test(n);e.every(i)&&(t=e.map(n=>{let r=/\d+ \d+/g;for(let a of n.match(r)){let[o,s]=a.match(/(\d+) (\d+)/).slice(1);n=n.replace(a,`${o}-${s}`)}return n}).join(" "))}if(t.includes(" ")){let e=t.replace(/[ ,]/g,"");e.split("").every(i=>Lr(i))&&e.length===4&&(t=e)}return{score:t}}function I4e({score:t}){let e=new RegExp(/^\[\d+\](.*)$/);e.test(t)&&(t=t.match(e).slice(1)[0].trim());let i=/\(,/g;return i.test(t)&&(t=t.replace(i,"(")),{score:t}}var w4e={handleTiebreakSlashSeparation:y4e,handleSetSlashSeparation:g4e,punctuationAdjustments:t4e,handleGameSeparation:v4e,joinFloatingTiebreak:n4e,handleBracketSpacing:i4e,handleSpaceSeparator:b4e,separateScoreBlocks:d4e,matchKnownPatterns:r4e,removeDanglingBits:m4e,removeErroneous:p4e,handleWalkover:h4e,properTiebreak:a4e,handleNumeric:iIe,handleRetired:f4e,containedSets:o4e,sensibleSets:s4e,stringScore:c4e,superSquare:l4e,setBuilder:tIe,excisions:I4e,replaceOh:u4e},h$={},S4e=["handleNumeric","handleWalkover","handleRetired","replaceOh","stringScore","punctuationAdjustments","excisions","handleSpaceSeparator","matchKnownPatterns","removeDanglingBits","handleBracketSpacing","matchKnownPatterns","containedSets","separateScoreBlocks","handleGameSeparation","removeErroneous","joinFloatingTiebreak","handleSetSlashSeparation","handleTiebreakSlashSeparation","properTiebreak","sensibleSets","superSquare"],T4e=["handleNumeric","separateScoreBlocks","sensibleSets","superSquare"];function rIe(t){if(!t.score)return{error:Me};let{score:e,sheetName:i,identifier:n,fileName:r,stepLog:a,fullLog:o,profile:s}=t,l=[],c,u=[],d,p,h=e,f=g=>{g.forEach(v=>{p=w4e[v]({profile:s,identifier:n,matchUpStatus:c,attributes:d,applied:u,score:h});let y=p.score!==h;y&&l.push({method:v,score:p.score}),a&&(o||y||p.matchUpStatus!==c)&&console.log(c?{score:p.score,matchUpStatus:c}:{score:p.score},v),p.matchUpStatus&&(c=p.matchUpStatus),p.attributes&&(d=p.attributes),p.applied&&(u=p.applied),h=p.score})};f(S4e);let m=cX(h);return m||(h=e.toString().replace(/\D/g,""),d!=null&&d.removed&&(d.removed=void 0),f(T4e),m=cX(h),m||(h="")),u.forEach(g=>{h$[g]||(h$[g]=0),h$[g]+=1}),{matchUpStatus:c==null?void 0:c.toUpperCase(),modifications:l,attributes:d,isValid:m,score:h}}var aIe={};zi(aIe,{analyzeSet:()=>CE,checkScoreHasValue:()=>uo,checkSetIsComplete:()=>eF,getSetComplement:()=>E8,getTiebreakComplement:()=>rF,isValidMatchUpFormat:()=>Fl,parseScoreString:()=>V_,validateScore:()=>D8,validateTieFormat:()=>ul});function U4e({existingMatchUpStatus:t,matchUpFormat:e,matchUpStatus:i,winningSide:n,score:r}){let a=(r==null?void 0:r.sets)??[],o=((a==null?void 0:a.filter(I=>I==null?void 0:I.winningSide))||[]).reduce((I,T)=>{let{winningSide:w}=T;if(!w)return I;let S=w-1;return I[S]++,I},[0,0]),s=n?n-1:void 0,l=s!==void 0?1-s:void 0,c=s!==void 0&&o[s],u=l!==void 0&&o[l],d=e?Zs(e):void 0,p=Math.max(...o),h=xl(o)[p],f=d==null?void 0:d.bestOf,m=f&&Math.ceil(f/2)||1,g=i??t,v=g&&[fn,os,Rn].includes(g),y=!d||!a.length||a.every((I,T)=>{let w=T+1,S=w===f,D=w===a.length,{side1Score:E,side2Score:C,side1TiebreakScore:P,side2TiebreakScore:R,winningSide:N}=I,M=Math.max(E??0,C??0),A=P??R,{finalSetFormat:_,setFormat:x}=d,O=S&&_||x;if(A){let{tiebreakTo:B,NoAD:F}=(O==null?void 0:O.tiebreakFormat)||{},G=Math.max(P??0,R??0);if(F&&G>B||G<B&&N&&(D&&!v||!D))return!1}return O.setTo?!(!O.noTiebreak&&M>O.setTo+1):!0}),b=(!e||p===m)&&h===1&&o.indexOf(p)+1||void 0;return{valid:y&&(n&&c>u&&n===b||!n&&!b||v)}}function D8({existingMatchUpStatus:t,matchUpFormat:e,matchUpStatus:i,winningSide:n,score:r}){if(typeof r!="object")return{error:Me};let{sets:a,scoreStringSide1:o,scoreStringSide2:s}=r,l="scoreString must be a string!";if(o!==void 0&&typeof o!="string")return{error:Me,info:l};if(s!==void 0&&typeof s!="string")return{error:Me,info:l};if(a!==void 0&&!Array.isArray(a))return{error:Me,info:Nh("sets")};if(a!=null&&a.length){let c=a.map(d=>d==null?void 0:d.setNumber).filter(Boolean);if(c.length!==ki(c).length)return{error:Me,info:"setNumbers not unique"};for(let d of a){let{side1Score:p,side2Score:h,side1TiebreakScore:f,side2TiebreakScore:m,side1PointScore:g,side2PointScore:v,winningSide:y,setNumber:b}=d;if(![[p,h],[f,m],[g,v]].filter(I=>I.some(T=>T!==void 0)).every(I=>I.every(T=>bi(T))))return{error:Me,info:"non-numeric values"};if(![b,y].filter(I=>I!==void 0).every(I=>bi(I)))return{error:Me,info:"non-numeric values"};if(y&&![1,2].includes(y))return{error:Me,info:"winningSide must be 1 or 2"}}let{valid:u}=U4e({existingMatchUpStatus:t,matchUpStatus:i,matchUpFormat:e,winningSide:n,score:r});if(!u)return{error:qfe,info:"score is invalid for matchUpFormat or winningSide does not match calculated winningSide"}}return{valid:!0}}var E8=t=>{let{isSide1:e,lowValue:i,setTo:n,tiebreakAt:r,NoAD:a}=t;if(i===void 0)return!1;let o=ai(i);(o==null?void 0:o.toString().length)>2&&(o=parseInt(o.toString().slice(0,2))),r&&r<n&&o>r&&(o=r);let s;return a&&!r?(o>n&&(s=n),s=o<n?n:n-1):s=o+1<n&&n||r&&r<n&&o===r&&n||!r&&o+2||n+1,[e?o:s,e?s:o]},rF=t=>{let{isSide1:e,lowValue:i,tiebreakTo:n,tiebreakNoAd:r}=t;if(i===void 0)return!1;let a=typeof i=="string"?parseInt(i):i;(a==null?void 0:a.toString().length)>2&&(a=parseInt(a.toString().slice(0,2))),r&&a>n-1&&(a=n-1);let o=D4e({lowValue:a,NoAD:r,tiebreakTo:n});return[e?a:o,e?o:a]};function D4e(t){let{lowValue:e,NoAD:i,tiebreakTo:n}=t,r=i?1:2;return e+1>=n?e+r:n}function V_({tiebreakTo:t=7,scoreString:e=""}){return e==null?void 0:e.split(" ").filter(Boolean).map((n,r)=>i({set:n,setNumber:r+1}));function i({set:n,setNumber:r}){let a=(n==null?void 0:n.startsWith("["))&&n.split("[")[1].split("]")[0].split("-").map(m=>parseInt(m)),o=n.includes("(")&&n.split("(")[0]||n.includes("[")&&n.split("[")[0]||n,s=!a&&o.split("-").map(m=>parseInt(m)),l=a?a[0]>a[1]&&1||a[0]<a[1]&&2||void 0:s[0]>s[1]&&1||s[0]<s[1]&&2||void 0,c=n.includes("(")?n.split("(")[1].split(")")[0]:void 0,u=(c&&rF({lowValue:c,isSide1:l===2,tiebreakTo:t}))??[],[d,p]=s||[],[h,f]=a||u||[];return{side1Score:d,side2Score:p,side1TiebreakScore:h,side2TiebreakScore:f,winningSide:l,setNumber:r}}}function E4e({matchUpScoringFormat:t,isDecidingSet:e,isTiebreakSet:i,setObject:n}){if(!n)return;let r=tF({set:n});return eF({matchUpScoringFormat:t,set:n,isDecidingSet:e,isTiebreakSet:i})&&r||void 0}function CE(t){let{setObject:e,matchUpScoringFormat:i}=t;if(!e)return{error:JO};let{setNumber:n}=e||{},{bestOf:r}=i||{},a=!!(n&&r&&n===r),o=a&&(i==null?void 0:i.finalSetFormat)||(i==null?void 0:i.setFormat),s=!!(o!=null&&o.tiebreakSet),l=!!(o!=null&&o.timed),c=!s&&!l,u=!!(n&&r&&n<=r),d=[e==null?void 0:e.side1Score,e==null?void 0:e.side2Score],p=[e==null?void 0:e.side1PointScore,e==null?void 0:e.side2PointScore],h=[e==null?void 0:e.side1TiebreakScore,e==null?void 0:e.side2TiebreakScore],f=d.filter(_=>_!==void 0).length,m=p.filter(_=>_!==void 0).length,g=h.filter(_=>_!==void 0).length,v=d==null?void 0:d.filter(_=>!isNaN(_)).length,y=h==null?void 0:h.filter(_=>!isNaN(_)).length,{tiebreakAt:b}=o||{},I=b&&d.filter(_=>_>=b).length===2,T=I&&(d[0]>d[1]&&1||d[1]>d[0]&&2||void 0),w=!!(y&&!v),S=!!(e!=null&&e.winningSide),{error:D,result:E}=C4e({setObject:e,setFormat:o,sideGameScores:d,sideTiebreakScores:h}),{error:C,result:P}=P4e({setObject:e,setFormat:o,sideTiebreakScores:h}),R=c&&!w&&E||s&&w&&P,N=u&&!(s&&!w)&&!(c&&w)&&(!S||R),M=E4e({isDecidingSet:a,isTiebreakSet:w,matchUpScoringFormat:i,setObject:e}),A={expectTiebreakSet:s,expectTimedSet:l,hasTiebreakCondition:I,isCompletedSet:S,isDecidingSet:a,isTiebreakSet:w,isValidSet:N,isValidSetNumber:u,isValidSetOutcome:R,leadingSide:T,setFormat:o,sideGameScores:d,sideGameScoresCount:f,sidePointScores:p,sidePointScoresCount:m,sideTiebreakScores:h,sideTiebreakScoresCount:g,winningSide:M};return(e==null?void 0:e.winningSide)!==void 0&&(w?(A.isValidTiebreakSetOutcome=P,P||(A.tiebreakSetError=C)):(A.isValidStandardSetOutcome=E,E||(A.standardSetError=D))),A}function C4e({setObject:t,setFormat:e,sideGameScores:i,sideTiebreakScores:n}){if(!t)return{result:!1,error:JO};let r=!!(e!=null&&e.tiebreakSet),a=!!(e!=null&&e.timed);if(!e||r||a)return{result:!1,error:Me};if((i==null?void 0:i.filter(S=>!isNaN(S)).length)!==2)return{result:!1,error:WV};let{setTo:o,tiebreakAt:s,tiebreakFormat:l,NoAD:c}=e||{};if(!(o&&i!=null&&i.find(S=>S>=o)))return{result:!1,error:WV};let u=[1,2].includes(t==null?void 0:t.winningSide);if(!t||!u)return{result:!1,error:QO};let d=(t==null?void 0:t.winningSide)-1,p=1-d,h=i[d],f=i[p],m=h-f;if(!(h>f))return{result:!1,error:{message:"winningSide game scoreString is not high"}};let g=s&&l,v=(n==null?void 0:n.filter(S=>!isNaN(S)).length)===2,y=n==null?void 0:n[d],b=n==null?void 0:n[p],I=s&&i.filter(S=>S>=s).length===2;if(g){let{NoAD:S,tiebreakTo:D}=l;if(I){if(m>1)return{result:!1,error:{message:"invalid winning game scoreString (5)"}};if(!v)return{result:!1,error:{message:"invalid tiebreak scores (1)"}};if(isNaN(D))return{result:!1,error:{message:"tiebreakTo error"}};if(!(D&&n!=null&&n.find(N=>N>=D)))return{result:!1,error:{message:"invalid tiebreak scores (2)"}};let E=s<o?o:o+1;if(h>E)return{result:!1,error:{message:"invalid winning game scoreString (1)"}};if(!y||!b||y<b)return{result:!1,error:{message:"winningSide tiebreak value is not high"}};let C=S?1:2,P=y-b,R=b>=D-1;if(P&&R&&P<C)return{result:!1,error:{message:"invalid tiebreak scores (3)"}}}if(h>o&&!I)return{result:!1,error:{message:"invalid winning game scoreString (2)"}}}let T=c?1:2,w=f>=o-1;return m&&w&&!I&&m<T?{result:!1,error:{message:"invalid winning game scoreString (3)"}}:m>T&&h>o?{result:!1,error:{message:"invalid winning game scoreString (4)"}}:{result:!0}}function P4e({setObject:t,setFormat:e,sideTiebreakScores:i}){if(!t)return{result:!1,error:JO};let n=!!(e!=null&&e.tiebreakSet),r=!!(e!=null&&e.timed);if(!e||!n||r)return{result:!1,error:{message:"not tiebreak set"}};let a=[1,2].includes(t==null?void 0:t.winningSide);if(!t||!a)return{result:!1,error:QO};let{tiebreakSet:o}=e||{},{NoAD:s,tiebreakTo:l}=o||{};if((i==null?void 0:i.filter(g=>!isNaN(g)).length)!==2)return{result:!1,error:{message:"invalid tiebreak scores (1)"}};if(isNaN(l))return{result:!1,error:{message:"tiebreakTo error"}};if(!(i!=null&&i.find(g=>g>=l)))return{result:!1,error:{message:"invalid tiebreak scores (2)"}};let c=(t==null?void 0:t.winningSide)-1,u=1-c,d=i[c],p=i[u];if(!d||!p||d<p)return{result:!1,error:{message:"winningSide tiebreak value is not high"}};let h=s?1:2,f=d-p,m=p>=l-1;return f&&m&&f<h?{result:!1,error:{message:"invalid tiebreak scores (3)"}}:{result:!0}}var oIe={collectionDefinitions:[{collectionName:"Male Singles",matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpCount:4,matchUpValue:1,gender:"MALE"},{collectionName:"Female Singles",matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",gender:"FEMALE",matchUpCount:4,matchUpValue:1},{collectionName:"Male Doubles",matchUpFormat:"SET1-S:8/TB7@7",matchUpType:"DOUBLES",matchUpCount:2,matchUpValue:1,gender:"MALE"},{collectionName:"Female Doubles",matchUpFormat:"SET1-S:8/TB7@7",matchUpType:"DOUBLES",gender:"FEMALE",matchUpCount:2,matchUpValue:1},{collectionName:"Mixed Doubles",matchUpFormat:"SET1-S:8/TB7@7",matchUpType:"DOUBLES",matchUpCount:4,matchUpValue:1,gender:"MIXED"}],tieFormatName:"USTA_GOLD_TEAM_CHALLENGE",winCriteria:{valueGoal:9}},sIe={collectionDefinitions:[{collectionName:"Round 1",matchUpCount:3,matchUpFormat:"SET1-S:T20",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Round 2",matchUpCount:3,matchUpFormat:"SET1-S:T20",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Round 3",matchUpCount:3,matchUpFormat:"SET1-S:T20",matchUpType:"DOUBLES",scoreValue:1}],tieFormatName:"Doubles Shuffle",unrestrictedSelections:!0,winCriteria:{aggregateValue:!0}},lIe={collectionDefinitions:[{collectionName:"Male Singles",gender:"MALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Female Singles",gender:"FEMALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Mixed Doubles",gender:"MIXED",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1}],tieFormatName:"USTA_SOUTHERN_LEVEL_5",winCriteria:{valueGoal:8}},cIe={collectionDefinitions:[{category:{ageCategoryCode:"16U"},collectionName:"16U Singles",matchUpCount:4,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Singles",matchUpCount:4,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1},{category:{ageCategoryCode:"16U"},collectionName:"16U Doubles",matchUpCount:2,matchUpFormat:"SET1-S:6/TB7",matchUpType:"DOUBLES",matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Doubles",matchUpCount:2,matchUpFormat:"SET1-S:6/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Tiebreak Doubles",matchUpCount:1,matchUpFormat:"SET1-S:TB10",matchUpType:"DOUBLES",matchUpValue:1,processCodes:["RANKING.IGNORE"]}],tieFormatName:"USTA_SECTION_BATTLE",winCriteria:{valueGoal:9}},uIe={collectionDefinitions:[{collectionName:"Male Singles",gender:"MALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Female Singles",gender:"FEMALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Male Doubles",gender:"MALE",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Female Doubles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Mixed Doubles",gender:"MIXED",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1}],tieFormatName:"USTA_INTERSECTIONAL",winCriteria:{valueGoal:8}},dIe={collectionDefinitions:[{scoreValue:1,matchUpType:"SINGLES",collectionName:"Men's Singles",matchUpFormat:"SET1-S:T60",gender:"MALE",matchUpCount:1},{scoreValue:1,matchUpType:"SINGLES",collectionName:"Women's Singles",matchUpFormat:"SET1-S:T60",gender:"FEMALE",matchUpCount:1},{matchUpValue:1,matchUpType:"DOUBLES",collectionName:"Mixed Doubles",matchUpFormat:"SET1-S:T60",gender:"MIXED",matchUpCount:1}],tieFormatName:"Time Tennis Pro Circuit",winCriteria:{aggregateValue:!0}},pIe={collectionDefinitions:[{collectionName:"Mixed Doubles",gender:"MIXED",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Male Singles",matchUpCount:1,gender:"MALE",matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Female Singles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"DOMINANT_DUO_MIXED",winCriteria:{valueGoal:2}},hIe={collectionDefinitions:[{scoreValue:1,matchUpType:"SINGLES",collectionName:"Men's Singles",matchUpFormat:"SET1-S:T60",gender:"MALE",matchUpCount:3},{scoreValue:1,matchUpType:"SINGLES",collectionName:"Women's Singles",matchUpFormat:"SET1-S:T60",gender:"FEMALE",matchUpCount:3},{scoreValue:1,matchUpType:"DOUBLES",collectionName:"Men's Doubles",matchUpFormat:"SET1-S:T60",gender:"MALE",matchUpCount:1},{matchUpValue:1,matchUpType:"DOUBLES",collectionName:"Women's Doubles",matchUpFormat:"SET1-S:T60",gender:"FEMALE",matchUpCount:1},{matchUpValue:1,matchUpType:"DOUBLES",collectionName:"Mixed Doubles",matchUpFormat:"SET1-S:T60",gender:"MIXED",matchUpCount:1}],tieFormatName:"Time Tennis Dual",winCriteria:{aggregateValue:!0}},fIe={collectionDefinitions:[{category:{ageCategoryCode:"14U"},collectionName:"14U Singles",matchUpCount:2,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{category:{ageCategoryCode:"16U"},collectionName:"16U Singles",matchUpCount:2,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Singles",matchUpCount:2,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{category:{ageCategoryCode:"14U"},collectionName:"14U Doubles",collectionGroupNumber:1,matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{category:{ageCategoryCode:"16U"},collectionName:"16U Doubles",collectionGroupNumber:1,matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Doubles",collectionGroupNumber:1,matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1}],collectionGroups:[{groupNumber:1,groupName:"Doubles",groupValue:1,winCriteria:{valueGoal:2}}],tieFormatName:"USTA_BREWER_CUP",winCriteria:{valueGoal:4}},mIe={winCriteria:{valueGoal:23},tieFormatName:"USTA_OZAKI_CUP",collectionDefinitions:[{category:{ageCategoryCode:"18U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"18U Boys Singles",matchUpType:"SINGLES",matchUpCount:3,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"18U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"18U Girls Singles",matchUpType:"SINGLES",gender:"FEMALE",matchUpCount:3,matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Boys Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",matchUpCount:1,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"18U"},collectionName:"18U Girls Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"FEMALE",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Mixed Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"MIXED",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"16U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"16U Boys Singles",matchUpType:"SINGLES",matchUpCount:3,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"16U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"16U Girls Singles",matchUpType:"SINGLES",gender:"FEMALE",matchUpCount:3,matchUpValue:1},{category:{ageCategoryCode:"16U"},collectionName:"16U Boys Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",matchUpCount:1,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"16U"},collectionName:"16U Girls Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"FEMALE",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"16U"},collectionName:"16U Mixed Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"MIXED",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"14U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"14U Boys Singles",matchUpType:"SINGLES",matchUpCount:3,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"14U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"14U Girls Singles",matchUpType:"SINGLES",gender:"FEMALE",matchUpCount:3,matchUpValue:1},{category:{ageCategoryCode:"14U"},collectionName:"14U Boys Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",matchUpCount:1,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"14U"},collectionName:"14U Girls Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"FEMALE",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"14U"},collectionName:"14U Mixed Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"MIXED",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"12U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"12U Boys Singles",matchUpType:"SINGLES",matchUpCount:3,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"12U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"12U Girls Singles",matchUpType:"SINGLES",gender:"FEMALE",matchUpCount:3,matchUpValue:1},{category:{ageCategoryCode:"12U"},collectionName:"12U Boys Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",matchUpCount:1,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"12U"},collectionName:"12U Girls Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"FEMALE",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"12U"},collectionName:"12U Mixed Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"MIXED",matchUpCount:1,matchUpValue:1}]},gIe={collectionDefinitions:[{collectionName:"Doubles",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Singles",matchUpCount:2,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"DOMINANT_DUO",winCriteria:{valueGoal:2}},vIe={collectionDefinitions:[{collectionName:"Doubles",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7@7",matchUpType:"DOUBLES",collectionValue:1},{collectionName:"Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"USTA_COLLEGE",winCriteria:{valueGoal:4}},yIe={collectionDefinitions:[{collectionName:"Male Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Female Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Male Doubles",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Female Doubles",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1}],tieFormatName:"USTA_LEVEL_1",winCriteria:{valueGoal:10}},bIe={collectionDefinitions:[{collectionName:"Female Doubles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Male Doubles",gender:"MALE",matchUpCount:1,matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Female Singles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"SINGLES",scoreValue:1},{collectionName:"Male Singles",matchUpCount:1,gender:"MALE",matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"SINGLES",scoreValue:1},{collectionName:"Mixed Doubles",matchUpCount:1,gender:"MIXED",matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Mixed Doubles",matchUpCount:1,gender:"MIXED",matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Overtime",matchUpCount:1,gender:"MIXED",matchUpFormat:"SET1-S:T20",matchUpType:"DOUBLES",scoreValue:1}],tieFormatName:"USTA_WTT_ITT",winCriteria:{aggregateValue:!0}},IIe={collectionDefinitions:[{collectionName:"Male Singles",gender:"MALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Female Singles",gender:"FEMALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Male Doubles",gender:"MALE",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Female Doubles",gender:"FEMALE",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Mixed Doubles",gender:"MIXED",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1}],tieFormatName:"USTA_ZONAL",winCriteria:{valueGoal:10}},wIe={collectionDefinitions:[{collectionGroupNumber:1,matchUpType:"DOUBLES",matchUpCount:1,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:1},{collectionGroupNumber:1,matchUpType:"SINGLES",matchUpCount:3,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:1},{collectionGroupNumber:2,matchUpType:"DOUBLES",matchUpCount:1,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:2},{collectionGroupNumber:2,matchUpType:"SINGLES",matchUpCount:3,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:2},{collectionGroupNumber:3,matchUpType:"DOUBLES",matchUpCount:1,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:3},{collectionGroupNumber:3,matchUpType:"SINGLES",matchUpCount:3,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:3}],collectionGroups:[{groupNumber:1,groupName:"Day 1"},{groupNumber:2,groupName:"Day 2"},{groupNumber:3,groupName:"Day 3"}],tieFormatName:"LAVER_CUP",winCriteria:{valueGoal:13}},SIe={collectionDefinitions:[{collectionName:"Female Doubles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Male Doubles",gender:"MALE",matchUpCount:1,matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Female Singles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"SINGLES",scoreValue:1},{collectionName:"Male Singles",matchUpCount:1,gender:"MALE",matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"SINGLES",scoreValue:1},{collectionName:"Mixed Doubles",matchUpCount:1,gender:"MIXED",matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Overtime",matchUpCount:1,gender:"MIXED",matchUpFormat:"SET1-S:T20",matchUpType:"DOUBLES",scoreValue:1}],tieFormatName:"USTA_TOC",winCriteria:{aggregateValue:!0}},Mj="COLLEGE_DEFAULT",Nj="COLLEGE_JUCO",Aj="COLLEGE_D3",TIe="DOMINANT_DUO",UIe="DOMINANT_DUO_MIXED",DIe="LAVER_CUP",EIe="TEAM_DOUBLES_3_AGGREGATION",CIe="TIME_TENNIS_DUAL",PIe="TIME_TENNIS_PRO_CIRCUIT",RIe="USTA_BREWER_CUP",MIe="USTA_OZAKI_CUP",NIe="USTA_COLLEGE",AIe="USTA_GOLD_TEAM_CHALLENGE",_Ie="USTA_LEVEL_1",kIe="USTA_INTERSECTIONAL",xIe="USTA_SECTION_BATTLE",OIe="USTA_SOUTHERN_LEVEL_5",LIe="USTA_TOC",FIe="USTA_WTT_ITT",BIe="USTA_ZONAL",R4e={COLLEGE_D3:Aj,COLLEGE_DEFAULT:Mj,COLLEGE_JUCO:Nj,DOMINANT_DUO:TIe,DOMINANT_DUO_MIXED:UIe,LAVER_CUP:DIe,TEAM_DOUBLES_3_AGGREGATION:EIe,TIME_TENNIS_DUAL:CIe,TIME_TENNIS_PRO_CIRCUIT:PIe,USTA_BREWER_CUP:RIe,USTA_OZAKI_CUP:MIe,USTA_COLLEGE:NIe,USTA_GOLD_TEAM_CHALLENGE:AIe,USTA_INTERSECTIONAL:kIe,USTA_LEVEL_1:_Ie,USTA_SECTION_BATTLE:xIe,USTA_SOUTHERN_LEVEL_5:OIe,USTA_TOC:LIe,USTA_WTT_ITT:FIe,USTA_ZONAL:BIe},$Ie="STANDARD",dX={[$Ie]:{hydrate:!0,doubles:{matchUpCount:3,matchUpValue:1},singles:{matchUpCount:6,matchUpValue:1},valueGoal:5},[Aj]:{hydrate:!0,doubles:{matchUpCount:3,matchUpValue:1,matchUpFormat:"SET1-S:8/TB7@7"},singles:{matchUpFormat:Cc,matchUpCount:6,matchUpValue:1},tieFormatName:Aj,valueGoal:5},[Mj]:{hydrate:!0,doubles:{matchUpCount:3,collectionValue:1,matchUpFormat:Cc},singles:{matchUpCount:6,matchUpValue:1,matchUpFormat:Cc},tieFormatName:Mj,valueGoal:4},[Nj]:{hydrate:!0,doubles:{matchUpCount:3,matchUpValue:1,matchUpFormat:"SET1-S:8/TB7"},singles:{matchUpCount:6,matchUpValue:1,matchUpFormat:Cc},tieFormatName:Nj,valueGoal:5},[DIe]:wIe,[TIe]:gIe,[UIe]:pIe,[EIe]:sIe,[CIe]:hIe,[PIe]:dIe,[RIe]:fIe,[MIe]:mIe,[NIe]:vIe,[AIe]:oIe,[kIe]:uIe,[_Ie]:yIe,[xIe]:cIe,[OIe]:lIe,[FIe]:bIe,[LIe]:SIe,[BIe]:IIe},M4e=t=>{let e=t!=null&&t.namedFormat&&Object.keys(dX).includes(t.namedFormat)?t.namedFormat:$Ie,i=Array.isArray(t==null?void 0:t.uuids)?t==null?void 0:t.uuids:[],n,{category:r,gender:a}=(t==null?void 0:t.event)??{},o=$t(dX[e],!1,!0),s=l=>{var c,u;if(!(t!=null&&t.isMock)&&!((c=t==null?void 0:t.event)!=null&&c.isMock)||!t.event)return(i==null?void 0:i.pop())??xn();let d=(u=t==null?void 0:t.event)==null?void 0:u.eventId;return i.pop()??`${d}-COL-${l+1}`};return o.hydrate?(n={winCriteria:{valueGoal:o.valueGoal},collectionDefinitions:[{collectionId:s(0),matchUpFormat:yye,collectionName:"Doubles",matchUpType:Zn,...o.doubles},{collectionId:s(1),matchUpFormat:Cc,collectionName:"Singles",matchUpType:Mr,...o.singles}]},o.tieFormatName&&(n.tieFormatName=o.tieFormatName)):(o.collectionDefinitions.forEach((l,c)=>l.collectionId=s(c)),n=o),t!=null&&t.hydrateCollections&&n.collectionDefinitions.forEach(l=>{r&&!l.category&&(l.category=r),a&&!l.gender&&(l.gender=a)}),n},vI=M4e;function N4e(t){var e,i,n;let{existingDrawDefinition:r,hydrateCollections:a,enforceGender:o,tieFormatName:s,matchUpType:l,eventType:c,isMock:u,event:d}=t,{tieFormat:p,matchUpFormat:h}=t;if(l===Fa&&c===Fa){let f=(i=(e=r==null?void 0:r.structures)==null?void 0:e.find(({stage:m})=>m===Ft))==null?void 0:i.tieFormat;p=p||f||s&&((n=d==null?void 0:d.tieFormat)==null?void 0:n.tieFormatName)===s&&d.tieFormat||s&&vI({namedFormat:s,hydrateCollections:a,isMock:u,event:d})||(d==null?void 0:d.tieFormat)||vI({event:d,isMock:u,hydrateCollections:a}),h=void 0}else h||(p=void 0,d!=null&&d.matchUpFormat||(h=Cc));if(p){let f=ul({gender:d==null?void 0:d.gender,enforceGender:o,tieFormat:p});if(f.error)return f}return{tieFormat:p,matchUpFormat:h}}function A4e(t){var e,i,n,r,a;let o=t.drawDefinition,{existingQualifyingPlaceholderStructureId:s,drawEntries:l,appliedPolicies:c,structureId:u,idPrefix:d,isMock:p}=t,h=t.qualifyingProfiles,f=h!=null&&h.length?nbe({uuids:t.uuids,qualifyingProfiles:h,appliedPolicies:c,idPrefix:d,isMock:p}):void 0;if(f!=null&&f.error)return f;o.structures=(e=o.structures)==null?void 0:e.filter(({structureId:S})=>S!==s),o.links=(i=o.links)==null?void 0:i.filter(({source:S})=>S.structureId!==s);let{qualifiersCount:m,qualifyingDrawPositionsCount:g,qualifyingDetails:v}=f??{};g&&(f!=null&&f.structures&&((n=o.structures)==null||n.push(...f.structures)),f!=null&&f.links&&((r=o.links)==null||r.push(...f.links)));let y=(a=o.structures)==null?void 0:a.find(({stage:S,stageSequence:D})=>S===Ft&&D===1),{qualifiersCount:b}=TU({stageSequence:1,drawDefinition:o,structureId:u,stage:Ft}),I=Math.max(m??0,b??0),T=lye({qualifiersCount:I,drawDefinition:o,stage:Ft});if(T.error||(T=k_({drawSize:g,stage:Xt,drawDefinition:o}),T.error))return T;_4e({drawDefinition:o,drawEntries:l});let w=k4e({mainStructure:y,qualifyingDetails:v,drawDefinition:o});return w.error?w:{drawDefinition:o,structureId:u}}function _4e({drawDefinition:t,drawEntries:e}){for(let i of(e??[]).filter(({entryStage:n})=>n===Xt)){let n={...i,entryStage:i.entryStage??Ft,drawDefinition:t};Uve(n)}}function k4e({mainStructure:t,qualifyingDetails:e,drawDefinition:i}){var n;for(let r of e||[]){let{finalQualifyingRoundNumber:a,finalQualifyingStructureId:o,roundTarget:s,finishingPositions:l,linkType:c}=r,u=t&&((n=SR({targetStructureId:t.structureId,sourceStructureId:o,sourceRoundNumber:a,finishingPositions:l,targetEntryRound:s,linkType:c}))==null?void 0:n.link);if(u!=null&&u.error)return u;u&&(i.links||(i.links=[]),i.links.push(u))}return{error:void 0}}function VIe(t){var e,i;let{participantIds:n}=t,r=((i=(e=t.drawDefinition)==null?void 0:e.entries)==null?void 0:i.filter(a=>{let o=a.entryStatus;return!t.restrictEntryStatus||qu.includes(o)}).map(Wi))??[];if(n){let a=n.filter(o=>!(r!=null&&r.includes(o)));if(a!=null&&a.length)return fe({result:{error:vp},info:{invalidParticipantIds:a}})}else n=r;return t.roundsCount&&t.restrictRoundsCount!==!1&&t.roundsCount>n.length-1&&(!t.enableDoubleRobin||t.roundsCount>(n.length-1)*2)?{error:Me,info:"Not enough participants for roundsCount"}:t.roundsCount&&t.restrictRoundsCount!==!1&&t.roundsCount>31?{error:Me,info:"roundsCount must be less than 32"}:{participantIds:n}}function C8(t){var e;let i=[],{roundsCount:n=1,drawDefinition:r,matchUpsCount:a,structureId:o,idPrefix:s,isMock:l,event:c}=t,u,d=VIe(t);if(d.error)return d;for(let p of Ct(1,n+1)){let h=XL({restrictMatchUpsCount:t.restrictMatchUpsCount,ignoreLastRoundNumber:!!u,newRound:!u,drawDefinition:r,matchUpsCount:a,structureId:o,roundNumber:u,idPrefix:s,isMock:l,event:c});if(h.error)return fe({result:h,info:{iteration:p}});(e=h.matchUps)!=null&&e.length&&i.push(...h.matchUps),u=((h==null?void 0:h.roundNumber)??1)+1}return{matchUps:i}}function x4e(t){var e;let{tournamentRecord:i,participantIds:n,scaleName:r,eventType:a,adHocRatings:o={}}=t,s=t.scaleAccessor??((e=ql[r])==null?void 0:e.accessor),l=i.participants??[];for(let c of n??[]){let u=l==null?void 0:l.find(p=>p.participantId===c),d=pX({scaleName:`${r}.${Xme}`,participant:u,eventType:a});!d&&r&&(d=pX({scaleAccessor:s,participant:u,scaleName:r,eventType:a})),d&&!o[c]&&(o[c]=d)}return o}function pX({scaleType:t=Av,scaleAccessor:e,participant:i,scaleName:n,eventType:r}){var a,o;let s=(o=(a=i&&sh({scaleAttributes:{eventType:r??pI,scaleType:t,scaleName:n},participant:i}))==null?void 0:a.scaleItem)==null?void 0:o.scaleValue;return e&&sr(s)?s[e]:s}function P8(t){var e,i;let n=L4e(t);if(n!=null&&n.error)return n;let r=VIe(t);if(r.error)return r;let a=O4e(t);if(a.error)return a;let o=x4e(t),s=((e=t.tournamentRecord)==null?void 0:e.isMock)??t.isMock,l=t.eventType??((i=t.event)==null?void 0:i.eventType),c=[],u=[],d;for(let p of Ct(1,(t.roundsCount??1)+1)){let h=y8({...t,participantIds:r.participantIds,structure:a.structure,ignoreLastRoundNumber:!0,iterationMatchUps:c,adHocRatings:o,roundNumber:d,eventType:l,isMock:s});if(h.error)return h;let{matchUps:f,...m}=h;u.push({...m,iteration:p,matchUpsCount:f==null?void 0:f.length}),d=((m==null?void 0:m.roundNumber)??1)+1,f!=null&&f.length&&c.push(...f)}return{...ue,matchUps:c,roundResults:u}}function O4e(t){var e,i,n;if(t.structureId)return t.structureId;let r=t.drawDefinition,a=(i=(e=r==null?void 0:r.structures)==null?void 0:e.filter(s=>s.stageSequence===1))==null?void 0:i.reduce((s,l)=>{let c=l.stage&&dI[l.stage];return Ll({structure:l})&&c>(dI[s==null?void 0:s.stage]||1)?l:s},void 0),o=(n=r==null?void 0:r.structures)==null?void 0:n.find(s=>s.structureId===(a==null?void 0:a.structureId));return o?Ll({structure:o})?{structure:o}:{error:_b}:{error:Dr}}function L4e(t){var e;return t.roundsCount&&typeof t.roundsCount!="number"?{error:Me,info:"roundsCount must be a number"}:typeof t.drawDefinition!="object"||t.drawDefinition.drawType&&t.drawDefinition.drawType!==_u?{error:_b}:!Array.isArray((e=t.drawDefinition)==null?void 0:e.entries)&&t.participantIds&&!Array.isArray(t.participantIds)?{error:Me,info:"Missing Entries"}:{error:void 0}}function F4e(t){var e,i;let{tournamentRecord:n,drawDefinition:r,structureId:a,idPrefix:o,isMock:s,event:l}=t,c=(e=l==null?void 0:l.entries)==null?void 0:e.filter(({entryStage:p,entryStatus:h})=>(!p||p===Ft)&&h&&qu.includes(h)),u=c==null?void 0:c.map(Wi),d=c?Math.floor(c.length/2):0;if(t.automated)return B4e({...t,participantIds:u});{let p=C8({roundsCount:t.roundsCount,drawDefinition:r,matchUpsCount:d,idPrefix:o,isMock:s,event:l});if(p.error)return p;(i=p.matchUps)!=null&&i.length&&qL({matchUps:p.matchUps,suppressNotifications:!0,tournamentRecord:n,drawDefinition:r,structureId:a,event:l})}return{...ue}}function B4e(t){var e,i;let{restrictEntryStatus:n,generateMatchUps:r,structureId:a,matchUpIds:o,scaleName:s,scaleAccessor:l}=t.drawMatic??{},c=P8({...t,eventType:((e=t.drawMatic)==null?void 0:e.eventType)??t.matchUpType,generateMatchUps:r??!0,scaleAccessor:l??t.scaleAccessor,scaleName:s??t.scaleName,participantIds:t.participantIds,roundsCount:t.roundsCount,restrictEntryStatus:n,structureId:a,matchUpIds:o});return c.error?c:((i=c==null?void 0:c.matchUps)!=null&&i.length&&qL({tournamentRecord:t.tournamentRecord,drawDefinition:t.drawDefinition,suppressNotifications:!0,matchUps:c.matchUps,event:t.event,structureId:a}),{...ue})}function $4e({requireParticipantCount:t=!0,enforcePolicyLimits:e=!0,drawSizeProgression:i,participantsCount:n,participantCount:r,appliedPolicies:a,drawDefinition:o,seedingProfile:s,structureId:l,seedsCount:c}){var u,d;n=n??r;let p=pi({drawDefinition:o,structureId:l});if(p.error)return p;let h=p.structure;if(!h)return{error:Dr};let{positionAssignments:f}=Ha({structure:h}),m=(f==null?void 0:f.length)||0;if(c>m)return{error:Dfe};let g=(u=h.structures)==null?void 0:u.length,v=bi(s==null?void 0:s.groupSeedingThreshold)&&(s==null?void 0:s.groupSeedingThreshold),y=(d=x6({roundRobinGroupsCount:g,drawSize:m}))==null?void 0:d.seedGroups,{seedsCount:b}=_R({policyDefinitions:a,requireParticipantCount:t,drawSizeProgression:i,participantsCount:n,drawSize:m});return b&&a!=null&&a[du]&&c>b&&e&&(c=b),h.seedLimit=c,h.seedAssignments=Ct(1,c+1).map(I=>{let T=y==null?void 0:y.find(D=>D.includes(I)),w=T&&Math.min(...T),S=v&&I>=v?w:I;return{participantId:void 0,seedNumber:I,seedValue:S}}),er({drawDefinition:o,structureIds:[l]}),{...ue,seedLimit:c}}function ww({sortDescending:t=!1,tournamentRecord:e,scaleAttributes:i,scaleSortMethod:n,stageSequence:r,entries:a,event:o,stage:s}){if(!e)return{error:it};return a=a??(o==null?void 0:o.entries)??[],{scaledEntries:a.filter(u=>(!s||!u.entryStage||u.entryStage===s)&&(!r||!u.entryStageSequence||u.entryStageSequence===r)&&qu.includes(u.entryStatus)).map(u=>{let{participantId:d}=u,{scaleItem:p}=qS({tournamentRecord:e,scaleAttributes:i,participantId:d});return{...u,...p}}).filter(u=>{let d=u.scaleValue;return!n&&(isNaN(d)||!parseFloat(d))?!1:d}).sort(n||l)};function l(u,d){return t?c(d)-c(u):c(u)-c(d)}function c(u){return parseFloat(u.scaleValue||(t?-1:1e5))}}function jIe(t){let e="prepareStage",{drawDefinition:i}=t,{structures:n}=Rh({stageSequence:t.stageSequence||1,roundTarget:t.roundTarget,stage:t.stage,drawDefinition:i}),r=t.preparedStructureIds||[],a=n==null?void 0:n.find(({structureId:h})=>!r.includes(h));if(!a)return fe({result:{error:Dr},stack:e});let o=a==null?void 0:a.structureId,{seedsCount:s,stageEntries:l,seedLimit:c}=K4e({...t,structureId:o});(t.seededParticipants||t.event||t.seedingScaleName)&&G4e({...t,seedsCount:s,structure:a,structureId:o});let u=t.automated!==!1&&t.drawType!==_u&&!(t.qualifyingOnly&&t.stage!==Xt),d=((n==null?void 0:n.length)||0)>1,p=u?j4e({...t,multipleStructures:d,seedLimit:c,structureId:o}):{};return p!=null&&p.error?fe({result:p,stack:e}):{...p,stageEntries:l,structureId:o,seedsCount:s}}function V4e({entries:t,stage:e,stageSequence:i,roundTarget:n}){return t.filter(r=>{var a,o;let s=(o=(a=Bi({name:Ap,element:r}))==null?void 0:a.extension)==null?void 0:o.value;return(!r.entryStage||r.entryStage===e)&&(!i||!r.entryStageSequence||r.entryStageSequence===i)&&(!n||!s||s===n)&&Ly.includes(r.entryStatus)})}function j4e(t){let e=typeof t.automated=="object"&&t.automated.seedsOnly,i=IR({...t,seedsOnly:e});if(i.error)return i;let n=i==null?void 0:i.positionAssignments,r=i==null?void 0:i.positioningReport;return{conflicts:i.conflicts,positionAssignments:n,positioningReport:r}}function G4e(t){let{seededParticipants:e,seedingScaleName:i,entries:n,event:r}=t,a=n.map(Wi);e?H4e({...t,enteredParticipantIds:a}):(r||i)&&z4e({...t,enteredParticipantIds:a})}function H4e(t){let{provisionalPositioning:e,enteredParticipantIds:i,seededParticipants:n,tournamentRecord:r,appliedPolicies:a,drawDefinition:o,seedingProfile:s,structureId:l,structure:c,event:u}=t,d=c?vw({provisionalPositioning:e,appliedPolicies:a,drawDefinition:o,seedingProfile:s,structure:c}):void 0;n.filter(({participantId:p})=>i.includes(p)).filter(p=>!p.seedNumber||p.seedNumber<=n.length).sort((p,h)=>p.seedNumber<h.seedNumber?-1:p.seedNumber<h.seedNumber?1:0).forEach(p=>{let{participantId:h,seedNumber:f,seedValue:m}=p;DU({provisionalPositioning:e,tournamentRecord:r,drawDefinition:o,seedingProfile:s,participantId:h,seedBlockInfo:d,structureId:l,seedNumber:f,seedValue:m,event:u})})}function z4e(t){let e=t.seedsCount,{provisionalPositioning:i,enteredParticipantIds:n,seedAssignmentProfile:r,assignSeedsCount:a,tournamentRecord:o,drawDefinition:s,seedByRanking:l,seedingProfile:c,structureId:u,event:d}=t,{categoryName:p,ageCategoryCode:h}=(d==null?void 0:d.category)||{},f=d==null?void 0:d.eventType,m=q4e({...t,ageCategoryCode:h,categoryName:p,eventType:f})||l&&W4e({...t,ageCategoryCode:h,categoryName:p,eventType:f}),g=(m==null?void 0:m.length)??0;g<e&&(e=g),m==null||m.filter(({participantId:v})=>n.includes(v)).slice(0,a||e).forEach((v,y)=>{let b=y+1,{participantId:I,scaleValue:T}=v,w=(r==null?void 0:r[b])||T||b;DU({provisionalPositioning:i,tournamentRecord:o,drawDefinition:s,seedingProfile:c,participantId:I,structureId:u,seedNumber:b,seedValue:w,event:d})})}function q4e(t){let{tournamentRecord:e,seedingScaleName:i,stageSequence:n,entries:r,stage:a,event:o}=t,{categoryName:s,ageCategoryCode:l}=(o==null?void 0:o.category)||{},c=o==null?void 0:o.eventType,u={scaleName:i||s||l||o.eventId,scaleType:ah,eventType:c};return ww({scaleAttributes:u,tournamentRecord:e,stageSequence:n,entries:r,stage:a}).scaledEntries}function W4e(t){let{tournamentRecord:e,stageSequence:i,event:n,entries:r,stage:a}=t,{categoryName:o,ageCategoryCode:s}=(n==null?void 0:n.category)||{},l=n==null?void 0:n.eventType;return ww({scaleAttributes:{scaleName:o||s,scaleType:rg,eventType:l},tournamentRecord:e,stageSequence:i,entries:r,stage:a}).scaledEntries}function K4e(t){let{seedsCount:e}=t;t.seededParticipants&&(e=t.seededParticipants.length),e>t.drawSize&&(e=t.drawSize);let i=V4e(t);e>i.length&&(e=i.length);let{seedLimit:n}=$4e({enforcePolicyLimits:t.enforcePolicyLimits??!0,appliedPolicies:t.appliedPolicies,participantsCount:i.length,seedingProfile:t.seedingProfile,drawDefinition:t.drawDefinition,structureId:t.structureId,seedsCount:e});return n&&n<e&&(e=n),{seedsCount:e,stageEntries:i,seedLimit:n}}function Y4e(t){var e;let i=g8({...t,modifyOriginal:!1});if(i.error)return i;let n=i.drawDefinition,{ignoreStageSpace:r,appliedPolicies:a,qualifyingOnly:o,seedingProfile:s,participants:l,drawEntries:c,placeByes:u,drawSize:d,drawType:p,entries:h}=t,f=[],m=[],g=Z4e({ignoreStageSpace:r,drawDefinition:n,drawEntries:c,drawType:p,entries:h});if(g.error)return g;let v=p===ky?0:ai(t.seedsCount??0),y=jIe({...t,qualifyingOnly:!d||o,appliedPolicies:a,drawDefinition:n,seedingProfile:s,participants:l,stage:Ft,seedsCount:v,placeByes:u,drawSize:d,entries:h});if(y.error&&!y.conflicts)return y;(e=y.positioningReport)!=null&&e.length&&f.push({[Ft]:y.positioningReport});let b=y.structureId;return y.conflicts&&(m=y.conflicts),p===_u&&t.roundsCount&&F4e({...t,drawDefinition:n,structureId:b}),{drawDefinition:n,positioningReports:f,conflicts:m,structureId:b}}function Z4e(t){let{ignoreStageSpace:e,drawDefinition:i,drawEntries:n,drawType:r,entries:a}=t;for(let o of a){if(n&&o.entryStage&&o.entryStage!==Ft)continue;let s={...o,ignoreStageSpace:e??r===_u,entryStage:o.entryStage??Ft,drawDefinition:i,drawType:r},l=Uve(s);if(n&&l.error)return l}return{error:void 0}}var X4e=()=>({matchUpType:void 0,drawName:void 0,drawId:void 0,structures:[],entries:[],links:[]}),J4e=X4e;function Q4e(t){let{drawId:e=xn(),processCodes:i,matchUpType:n,drawType:r}=t??{},a=J4e();return Object.assign(a,{processCodes:i,matchUpType:n,drawType:r,drawId:e})}function R8(t){let e=t.structureIds,{tournamentRecord:i,drawDefinition:n,matchUpFormat:r,structureId:a,matchUpId:o,event:s}=t,l=mn(t,[{[Md]:!0,[S5]:!0}]);if(l.error)return l;if(!Fl({matchUpFormat:r}))return{error:kP};let c="setMatchUpFormat";if(o){let u=ar({drawDefinition:n,matchUpId:o,event:s});if(u.error)return u;let d=u.matchUp;if((d==null?void 0:d.matchUpType)===Fa)return{info:"Cannot set matchUpFormat when { matchUpType: TEAM }",error:Ws};d&&(d.matchUpFormat=r,sn({tournamentId:i==null?void 0:i.tournamentId,eventId:s==null?void 0:s.eventId,context:c,drawDefinition:n,matchUp:d}))}else if(Array.isArray(e)){if((s==null?void 0:s.eventType)===Fa)return{error:ng};for(let u of e){let d=pi({drawDefinition:n,structureId:u});if(d.error)return d;d.structure&&(d.structure.matchUpFormat=r)}}else if(a){if((s==null?void 0:s.eventType)===Fa)return{error:ng};let u=pi({drawDefinition:n,structureId:a});if(u.error)return u;u.structure&&(u.structure.matchUpFormat=r)}else n&&(n.matchUpFormat=r);return e=e??(a?[a]:void 0),er({drawDefinition:n,structureIds:e}),{...ue}}function e5e({tieFormat:t}){let e=ul({checkCollectionIds:!1,tieFormat:t});if(e.error)return e;for(let i of t.collectionDefinitions)i.collectionId||(i.collectionId=xn());return{tieFormat:t}}function t5e({tournamentRecord:t,drawDefinition:e,matchUpFormat:i,matchUpType:n,tieFormat:r,event:a}){if((i||r)&&!(i&&(a==null?void 0:a.matchUpFormat)===i||a!=null&&a.tieFormat&&r&&JSON.stringify(a.tieFormat)===JSON.stringify(r))){if(r){let o=e5e({tieFormat:r});if(o.error)return o;e.tieFormat=o.tieFormat??r}else if(i){let o=R8({tournamentRecord:t,drawDefinition:e,matchUpFormat:i,event:a});if(o.error)return{info:"matchUpFormat or tieFormat error",error:o.error}}n&&(e.matchUpType=n)}return{error:void 0}}var GIe={};zi(GIe,{attachPolicies:()=>cy,findPolicy:()=>Fy,getAppliedPolicies:()=>Mn,getPolicyDefinitions:()=>cm,mutate:()=>HIe,query:()=>qIe,removePolicy:()=>zIe});var HIe={};zi(HIe,{attachPolicies:()=>cy,removePolicy:()=>zIe});function zIe(t){let e=mn(t,[{[TGe]:!0,_anyOf:{[Ko]:!1,[Lh]:!1,[Md]:!1,[cU]:!1}}]);if(e.error)return e;let i,n=t.drawDefinition??t.event??((t.tournamentId||!t.tournamentRecords)&&t.tournamentRecord);if(n)return hX(t,n);if(t.tournamentRecords){let r=Object.keys(t.tournamentRecords);if(!r.length)return{error:it};for(let a of r){let o=t.tournamentRecords[a],s=hX(t,o);if(s.error)return s;i=!0}}else return{error:it};return i?{...ue}:{error:MS}}function hX(t,e){let i=Mn(t).appliedPolicies??{};return i[t.policyType]?(delete i[t.policyType],Object.keys(i).length?un({element:e,extension:{name:hE,value:i}}):Ss({element:e,name:hE}),{...ue}):{error:MS}}var qIe={};zi(qIe,{findPolicy:()=>Fy,getAppliedPolicies:()=>Mn,getPolicyDefinitions:()=>cm});var WIe={[du]:{validSeedPositions:{ignore:!0},duplicateSeedNumbers:!0,drawSizeProgression:!0,seedingProfile:{drawTypes:{[Ph]:{positioning:ty},[ku]:{positioning:ty}},positioning:dHe},policyName:"USTA SEEDING",seedsCountThresholds:[{drawSize:4,minimumParticipantCount:3,seedsCount:2},{drawSize:16,minimumParticipantCount:12,seedsCount:4},{drawSize:32,minimumParticipantCount:24,seedsCount:8},{drawSize:64,minimumParticipantCount:48,seedsCount:16},{drawSize:128,minimumParticipantCount:96,seedsCount:32},{drawSize:256,minimumParticipantCount:192,seedsCount:64}]}},_j=WIe;function i5e({appliedPolicies:t,policyDefinitions:e,drawDefinition:i,stack:n}){if(e&&typeof e!="object")return fe({info:"policyDefinitions must be an object",result:{error:Me},stack:n});let r={[pE]:t==null?void 0:t[pE]};return e?n5e({policyDefinitions:e,appliedPolicies:t,policiesToAttach:r,drawDefinition:i}):r.avoidance&&cy({drawDefinition:i,policyDefinitions:r}),!(t!=null&&t[du])&&!(e!=null&&e[du])&&(cy({policyDefinitions:_j,drawDefinition:i}),t&&Object.assign(t,_j)),{error:void 0}}function n5e({policyDefinitions:t,appliedPolicies:e,policiesToAttach:i,drawDefinition:n}){for(let r of Object.keys(t))JSON.stringify(e==null?void 0:e[r])!==JSON.stringify(t[r])&&(i[r]=t[r]);Object.keys(i).length&&(cy({policyDefinitions:i,drawDefinition:n}),e&&Object.assign(e,i))}function r5e(t){var e,i,n,r,a;let{tournamentRecord:o,matchUpFormat:s,appliedPolicies:l,policyDefinitions:c,matchUpType:u,tieFormat:d,drawType:p,stack:h,event:f}=t,m=t.drawId?(e=f==null?void 0:f.drawDefinitions)==null?void 0:e.find(w=>w.drawId===t.drawId):void 0;m&&p!==m.drawType&&(m.drawType=p);let g=m??Q4e({processCodes:t.processCodes,drawId:t.drawId,drawType:p}),v=t5e({tournamentRecord:o,drawDefinition:g,matchUpFormat:s,matchUpType:u,tieFormat:d,event:f});if(v.error)return fe({result:v,stack:h});let y=i5e({appliedPolicies:l,policyDefinitions:c,drawDefinition:g,stack:h});if(y.error)return y;let b=(n=(i=m==null?void 0:m.structures)==null?void 0:i.find(w=>w.stage===Ft&&w.stageSequence===1))==null?void 0:n.structureId,I=m?(r=m.structures)==null?void 0:r.filter(w=>w.stage===Xt):[],T=(I==null?void 0:I.length)===1&&!((a=I[0].matchUps)!=null&&a.length)&&I[0].structureId;return{drawDefinition:g,structureId:b,existingDrawDefinition:m,existingQualifyingPlaceholderStructureId:T}}function a5e(t){var e,i;let n="generateOrGetExisting",r=[],a=[],o=r5e(t);if(o.error)return fe({result:o,stack:n});let s=o.existingDrawDefinition,l=o.drawDefinition??{},c=o.structureId,u=t.drawEntries??t.eventEntries??[],d=o.existingQualifyingPlaceholderStructureId&&A4e({...t,...o})||Y4e({...t,...o,entries:u});return d.error?fe({result:d,stack:n}):((e=d.positioningReports)!=null&&e.length&&r.push(...d.positioningReports??[]),(i=d.conflicts)!=null&&i.length&&a.push(...d.conflicts??[]),l=d.drawDefinition,c=d.structureId,{existingDrawDefinition:s,positioningReports:r,drawDefinition:l,structureId:c,conflicts:a,entries:u})}function o5e(t){var e,i,n;let{qualifyingPlaceholder:r,qualifyingProfiles:a,existingDrawDefinition:o,positioningReports:s,appliedPolicies:l,qualifyingOnly:c,drawDefinition:u,seedingProfile:d,participants:p,structureId:h,entries:f,stack:m}=t,g=r&&!(a!=null&&a.length)&&!o,v=[];if(a){let y=(w,S)=>w.stageSequence-S.stageSequence,b=(w,S)=>w.roundTarget-S.roundTarget,I=[],T=1;a.sort(b);for(let w of a){if(!Array.isArray(w.structureProfiles))return fe({info:Nh("structureProfiles"),result:{error:Ht},stack:m});T=w.roundTarget||T;let S=((e=w.structureProfiles)==null?void 0:e.sort(y))||[],D=1;for(let E of S){let{qualifyingRoundNumber:C,qualifyingPositions:P,seededParticipants:R,seedingScaleName:N,seedsCount:M=0,seedByRanking:A,placeByes:_,drawSize:x}=E,O=jIe({...t,seedingProfile:E.seedingProfile??d,stageSequence:D,qualifyingRoundNumber:C,preparedStructureIds:I,qualifyingPositions:P,seededParticipants:R,stage:Xt,seedingScaleName:N,appliedPolicies:l,drawDefinition:u,qualifyingOnly:c,seedByRanking:A,participants:p,roundTarget:T,seedsCount:M,placeByes:_,drawSize:x,entries:f});if(O.error)return O;O.structureId&&I.push(O.structureId),D+=1,(i=O.conflicts)!=null&&i.length&&v.push(...O.conflicts),(n=O.positioningReport)!=null&&n.length&&s.push({[Xt]:O.positioningReport})}T+=1}}else if(h&&g){let y=Ec({structureName:Co(Xt),stage:Xt}),{link:b}=SR({sourceStructureId:y.structureId,targetStructureId:h,sourceRoundNumber:0,linkType:Ff});u.structures||(u.structures=[]),u.structures.push(y),u.links||(u.links=[]),u.links.push(b)}return{qualifyingConflicts:v,error:void 0}}var KIe={};zi(KIe,{addGoesTo:()=>ly,allCompetitionMatchUps:()=>Ud,allDrawMatchUps:()=>Hs,allEventMatchUps:()=>pm,allPlayoffPositionsFilled:()=>j6,allTournamentMatchUps:()=>co,analyzeDraws:()=>NR,analyzeMatchUp:()=>RE,analyzeTournament:()=>F8,bulkUpdatePublishedEventIds:()=>V8,calculateWinCriteria:()=>Tw,categoryCanContain:()=>GL,checkMatchUpIsComplete:()=>_v,checkValidEntries:()=>ZL,compareTieFormats:()=>Hf,competitionScheduleMatchUps:()=>FR,credits:()=>s5e,drawMatchUps:()=>t7,eventMatchUps:()=>mF,filterParticipants:()=>mR,findDrawDefinition:()=>o8,findExtension:()=>Bi,getAllDrawMatchUps:()=>wa,getAllEventData:()=>j8,getAllStructureMatchUps:()=>Sn,getAllowedDrawTypes:()=>aF,getAllowedMatchUpFormats:()=>x8,getAppliedPolicies:()=>Mn,getAssignedParticipantIds:()=>Gy,getAvailableMatchUpsCount:()=>WL,getAvailablePlayoffProfiles:()=>TR,getCategoryAgeDetails:()=>CR,getCheckedInParticipantIds:()=>dw,getCompetitionDateRange:()=>sF,getCompetitionMatchUps:()=>PE,getCompetitionParticipants:()=>M8,getCompetitionPenalties:()=>O8,getCompetitionVenues:()=>kR,getCourtInfo:()=>PL,getCourts:()=>i7,getDrawData:()=>lF,getDrawDefinitionTimeItem:()=>S6,getDrawParticipantRepresentativeIds:()=>r8,getDrawTypeCoercion:()=>AR,getEligibleVoluntaryConsolationParticipants:()=>n8,getEntriesAndSeedsCount:()=>hF,getEvent:()=>a7,getEventData:()=>cF,getEventMatchUpFormatTiming:()=>q8,getEventProperties:()=>n7,getEventPublishStatus:()=>Xc,getEventStructures:()=>LL,getEventTimeItem:()=>uR,getEvents:()=>r7,getFlightProfile:()=>Xr,getLinkedTournamentIds:()=>zP,getMatchUpCompetitiveProfile:()=>aR,getMatchUpContextIds:()=>X8,getMatchUpDailyLimits:()=>vF,getMatchUpDailyLimitsUpdate:()=>W8,getMatchUpDependencies:()=>Ku,getMatchUpFormat:()=>J8,getMatchUpFormatTiming:()=>sR,getMatchUpFormatTimingUpdate:()=>z8,getMatchUpScheduleDetails:()=>RL,getMatchUpType:()=>ML,getMatchUpsMap:()=>ko,getMatchUpsStats:()=>Q8,getMaxEntryPosition:()=>H8,getModifiedMatchUpFormatTiming:()=>fF,getPairedParticipant:()=>Ou,getParticipantEventDetails:()=>N8,getParticipantIdFinishingPositions:()=>a8,getParticipantMembership:()=>A8,getParticipantResults:()=>ER,getParticipantScaleItem:()=>qS,getParticipantSchedules:()=>_8,getParticipantSignInStatus:()=>k8,getParticipantTimeItem:()=>T6,getParticipants:()=>Yr,getPersonRequests:()=>qy,getPolicyDefinitions:()=>cm,getPositionAssignments:()=>DE,getPositionsPlayedOff:()=>EU,getPredictiveAccuracy:()=>Z8,getProfileRounds:()=>pF,getPublishState:()=>mw,getRoundMatchUps:()=>Rs,getRounds:()=>e7,getScaleValues:()=>uU,getScaledEntries:()=>ww,getScheduledRoundsDetails:()=>xR,getSchedulingProfile:()=>mm,getSchedulingProfileIssues:()=>G8,getSeedingThresholds:()=>O6,getSeedsCount:()=>_R,getStructureSeedAssignments:()=>Gc,getTeamLineUp:()=>sy,getTieFormat:()=>$8,getTimeItem:()=>kp,getTournamentIds:()=>GP,getTournamentInfo:()=>Sw,getTournamentPenalties:()=>oF,getTournamentPersons:()=>L8,getTournamentStructures:()=>V6,getTournamentTimeItem:()=>dR,getValidGroupSizes:()=>yR,getVenueData:()=>GS,getVenuesAndCourts:()=>fm,isAdHoc:()=>Ll,isCompletedStructure:()=>dg,isValidForQualifying:()=>f8,isValidMatchUpFormat:()=>Fl,matchUpActions:()=>YL,participantScaleItem:()=>sh,participantScheduledMatchUps:()=>K8,positionActions:()=>h8,publicFindVenue:()=>v6,tallyParticipantResults:()=>CU,tieFormatGenderValidityCheck:()=>VL,tournamentMatchUps:()=>gF,validMatchUp:()=>EL,validMatchUps:()=>Zc,validateCollectionDefinition:()=>PR,validateLineUp:()=>OL});function s5e(){return`
    This project would not have been possible without the generous input and patience
    of tournament organizers and directors who worked with early versions of CourtHive/TMX.

    Thanks to Pavel, Ivan, Mladen, Zdenko, Antonia, Jakov, Kreso, Barry, Jeff, Bobby... to name just a few. 

    The project would not have even begun without the support of Miro, or the introduction by Sretchko.
    The project would not have succeeded without the enthusiasm of Randy and Bruce.
    Thanks to serendipity and Luca and the ensuing TODS conversations with ITF.
    Thanks to Scott and Jake for sanity checks, suggestions, and camaraderie.
    Thanks to Zoran for inspiring the async support and getting into the weeds with subscriptions.
    Thanks to Dave for backing the conversion of TMX 1.x source into the factory repository.
    Thanks to Vuk and Pavle and Rich and Chris and Deepa for the direct engagement with the APIs.
    Thanks to Joe for repeatedly challenging me and the many pointers to useful tooling.
    Thanks to Shannon for the validation of the approach from his deep domain experience.
    Thanks to Nikola for the ongoing camaraderie and explorations of what we can do with TODS.

    And a special thanks to my family for putting up with the long days and weeks and months of coding
    and conversations at all hours.
  `}var YIe={};zi(YIe,{filterParticipants:()=>mR,getCompetitionParticipants:()=>M8,getPairedParticipant:()=>Ou,getParticipantEventDetails:()=>N8,getParticipantMembership:()=>A8,getParticipantScaleItem:()=>qS,getParticipantSchedules:()=>_8,getParticipantSignInStatus:()=>k8,getParticipantTimeItem:()=>T6,getParticipants:()=>Yr,getScaleValues:()=>uU,participantScaleItem:()=>sh,validateLineUp:()=>OL});function M8(t){let{tournamentRecords:e}=t||{};if(typeof e!="object"||!Object.keys(e).length)return{error:_r};let i=[],n={},r={},a={},o=[],s={},l=[];for(let c of Object.values(e)){let{participantIdsWithConflicts:u,mappedMatchUps:d,participantMap:p,participants:h,matchUps:f,derivedEventInfo:m,derivedDrawInfo:g}=Yr({...t,tournamentRecord:c});Object.assign(s,d),Object.assign(n,p),Object.assign(r,m),Object.assign(a,g),i.push(...h??[]),o.push(...f??[]),u==null||u.forEach(v=>{l.includes(v)||l.push(v)})}return{participantIdsWithConflicts:l,derivedEventInfo:r,derivedDrawInfo:a,participantMap:n,mappedMatchUps:s,participants:i,...ue,matchUps:o}}function N8({tournamentRecord:t,participantId:e}){if(!t)return{error:it};if(!e)return{error:Ra};let i=[e].concat((t.participants??[]).filter(n=>{var r;return(n==null?void 0:n.participantType)&&[Hn,Ui].includes(n.participantType)&&((r=n.individualParticipantIds)==null?void 0:r.includes(e))}).map(n=>n.participantId));return{eventDetails:(t.events??[]).filter(n=>{let r=((n==null?void 0:n.entries)??[]).map(a=>a.participantId);return Ps(r,i)}).map(n=>({eventName:n.eventName,eventId:n.eventId}))}}function A8({tournamentRecord:t,participantId:e}){if(!t)return{error:it};if(!e)return{error:Ra};let{participants:i}=Yr({participantFilters:{participantTypes:[Hn,Ui,cc]},tournamentRecord:t});return(i??[]).filter(n=>{var r;return(r=n.individualParticipantIds)==null?void 0:r.includes(e)}).reduce((n,r)=>{let a=r.participantType;return a&&(n[a]||(n[a]=[]),n[a].push(r)),n},{})}function _8({participantFilters:t={},tournamentRecord:e}){if(!e)return{error:it};if(typeof t!="object")return{error:om,context:{participantFilters:t}};let i={eventIds:t.eventIds},n=co({tournamentRecord:e,contextFilters:i}).matchUps??[],r=Object.assign({},...n.map(l=>({[l.matchUpId]:l}))),a=n.filter(({schedule:l})=>l&&Object.keys(l).length),o=Ku({tournamentRecord:e,matchUps:n}).sourceMatchUpIds??[],s={};for(let l of a){let{sides:c}=l,u,d=(c==null?void 0:c.map(h=>{if(h.participant)return[h.participant].concat(...h.participant.individualParticipants||[]);o[l.matchUpId]&&!u&&(u=(o[l.matchUpId]||[]).map(f=>r[f]).filter(({winningSide:f,bye:m})=>!f&&!m))}).filter(Boolean).flat())??[];for(let h of d){let{participantId:f}=h;s[f]||(s[f]={potentialMatchUps:[],participant:h,matchUps:[]}),s[f].matchUps.push(l)}let p=(u==null?void 0:u.map(({sides:h})=>h).flat().map(({participant:h})=>h&&[h].concat(...h.individualParticipants||[])).filter(Boolean).flat())||[];for(let h of p){let{participantId:f}=h;s[f]||(s[f]={potentialMatchUps:[],participant:h,matchUps:[]}),s[f].potentialMatchUps.push(l)}}return{participantSchedules:Object.values(s).filter(({participant:l})=>!(t.participantIds&&!t.participantIds.includes(l.participantId)||t.participantTypes&&!t.participantTypes.includes(l.participantType))),...ue}}function k8({tournamentRecord:t,participantId:e}){if(!t)return{error:it};if(!e)return{error:Ra};let{participant:i}=jy({tournamentRecord:t,participantId:e});if(!i)return{error:Jr};let{timeItem:n}=kp({itemType:XP,element:i});return n&&n.itemValue===bE&&bE}var ZIe={};zi(ZIe,{analyzeDraws:()=>NR,analyzeTournament:()=>F8,getAllowedDrawTypes:()=>aF,getAllowedMatchUpFormats:()=>x8,getAppliedPolicies:()=>Mn,getCompetitionDateRange:()=>sF,getCompetitionPenalties:()=>O8,getPolicyDefinitions:()=>cm,getTournamentInfo:()=>Sw,getTournamentPenalties:()=>oF,getTournamentPersons:()=>L8,getTournamentStructures:()=>V6,getTournamentTimeItem:()=>dR});function x8({tournamentRecord:t,categoryName:e,categoryType:i}){var n;if(!t)return{error:it};let{appliedPolicies:r}=Mn({tournamentRecord:t});return(((n=r==null?void 0:r[Dh])==null?void 0:n.matchUpFormats)||[]).filter(({categoryNames:a,categoryTypes:o})=>!e&&!o||e&&(a==null?void 0:a.includes(e))||i&&(o==null?void 0:o.includes(i)))}function aF({tournamentRecord:t,categoryName:e,categoryType:i}){var n;if(!t)return{error:it};let{appliedPolicies:r}=Mn({tournamentRecord:t});return(((n=r==null?void 0:r[w_])==null?void 0:n.allowedDrawTypes)||[]).filter(({categoryNames:a,categoryTypes:o})=>!e&&!o||e&&(a==null?void 0:a.includes(e))||i&&(o==null?void 0:o.includes(i)))}function oF({tournamentRecord:t}){if(!t)return{error:it};let e=((t==null?void 0:t.participants)??[]).reduce((i,n)=>{let{participantId:r}=n;return(n.penalties??[]).forEach(a=>{let{penaltyId:o}=a||{};i[o]?i[o].participants.push(r):i[o]={...a,participantIds:[r]}}),i},{});return{penalties:Object.values(e)}}function O8({tournamentRecords:t}){if(typeof t!="object"||!Object.keys(t).length)return{error:_r};let e=[];for(let i of Object.values(t)){let{penalties:n}=oF({tournamentRecord:i});e.push(...n??[])}return{penalties:e}}function XIe({event:t}){return{eventInfo:(({eventId:e,eventName:i,eventType:n,eventLevel:r,surfaceCategory:a,matchUpFormat:o,category:s,gender:l,startDate:c,endDate:u,ballType:d,discipline:p,onlineResources:h,notes:f})=>({eventId:e,eventName:i,eventType:n,eventLevel:r,surfaceCategory:a,matchUpFormat:o,category:s,gender:l,startDate:c,endDate:u,ballType:d,discipline:p,onlineResources:h,notes:f}))(t)}}var l5e={[pU]:{policyName:"Staff Privacy Policy",participant:{contacts:!1,individualParticipants:!1,individualParticipantIds:!1,onlineResources:!1,participantName:!0,participantOtherName:!0,participantId:!0,participantRole:!0,participantRoleResponsibilities:!0,participantStatus:!0,penalties:!1,representing:!0,participantType:!0,person:{addresses:!1,biographicalInformation:!1,birthDate:!1,contacts:!1,nationalityCode:!0,nativeFamilyName:!1,nativeGivenName:!1,onlineResources:!1,otherNames:!0,parentOrganisationId:!1,passportFamilyName:!1,passportGivenName:!1,personId:!1,personOtherIds:!1,previousNames:!1,sex:!1,standardFamilyName:!0,standardGivenName:!0,status:!1,tennisId:!1,wheelchair:!0}}}},c5e=l5e;function Sw(t){var e,i,n,r;let{tournamentRecord:a}=t??{};if(!a)return{error:it};let o=(({tournamentId:u,tournamentRank:d,tournamentStatus:p,formalName:h,tournamentName:f,promotionalName:m,onlineResources:g,localTimeZone:v,startDate:y,endDate:b,hostCountryCode:I,venues:T,notes:w,updatedAt:S})=>({tournamentId:u,tournamentRank:d,tournamentStatus:p,formalName:h,tournamentName:f,promotionalName:m,onlineResources:g,localTimeZone:v,startDate:y,endDate:b,hostCountryCode:I,venues:T,notes:w,updatedAt:S}))(a),s=Yr({participantFilters:{participantRoles:[Eve,P6,Cve,Pve,Mve]},policyDefinitions:c5e,tournamentRecord:a}).participants;s&&(o.tournamentContacts=s);let l=((r=(n=(i=(e=mw({tournamentRecord:a}))==null?void 0:e.publishState)==null?void 0:i.tournament)==null?void 0:n.status)==null?void 0:r.publishedEventIds)||[],c=[];for(let u of a.events??[])if(!(t!=null&&t.usePublishState)||l.includes(u.eventId)){let d=XIe({event:u}).eventInfo;d&&c.push(d)}return o.eventInfo=c,{tournamentInfo:$t(o,!1,!0),...ue}}function sF({tournamentRecords:t}){if(!sr(t))return{error:_r};let e=Object.keys(t??{}).reduce((r,a)=>{let o=t[a],{tournamentInfo:{startDate:s,endDate:l}}=Sw({tournamentRecord:o}),c=s&&new Date(Ci(s));(!r.startDate||c&&c<r.startDate)&&(r.startDate=c);let u=l&&new Date(Ci(l));return(!r.endDate||u&&u>r.endDate)&&(r.endDate=u),r},{startDate:void 0,endDate:void 0}),i=e.startDate&&Ci(e.startDate.toISOString()),n=e.endDate&&Ci(e.endDate.toISOString());return!i||!n?{error:jfe}:{startDate:i,endDate:n}}function L8({tournamentRecord:t,participantFilters:e}){if(!t)return{error:it};let i=t.participants||[];e&&(i=mR({participants:i,participantFilters:e,tournamentRecord:t}));let n={},r=a=>{if(a.person){let{personId:o}=a.person;n[o]?n[o].participantIds.push(a.participantId):n[o]={...a.person,participantIds:[a.participantId]}}};return i.forEach(a=>{a.person&&r(a)}),{tournamentPersons:Object.values(n)}}function u5e(t){var e,i,n,r,a,o,s;let l=((i=(e=t.participants)==null?void 0:e.filter(({participantType:p})=>p===Hn))==null?void 0:i.length)===2,c=((n=t.events)==null?void 0:n.length)===1&&t.events[0],u=((r=c==null?void 0:c.drawDefinitions)==null?void 0:r.length)===1&&c.drawDefinitions[0],d=((s=(o=((a=u==null?void 0:u.structures)==null?void 0:a.length)===1&&u.structures[0])==null?void 0:o.positionAssignments)==null?void 0:s.length)===2;return!!(c.tieFormat&&l&&d)}function F8({tournamentRecord:t}){if(!t)return{error:it};let{drawsAnalysis:e}=NR({tournamentRecord:t}),i={isDual:u5e(t),drawsAnalysis:e};return{...ue,analysis:i}}var JIe={};zi(JIe,{compareTieFormats:()=>Hf,getTieFormat:()=>$8,tieFormatGenderValidityCheck:()=>VL,validateCollectionDefinition:()=>PR});function j_(t){var e;if(!t)return{};let i=[],n=t.tieFormatName,r=(e=t.collectionDefinitions)==null?void 0:e.map(a=>{let{matchUpType:o,matchUpFormat:s,matchUpCount:l,category:c,gender:u}=a;i.includes(s)||i.push(s);let d=c==null?void 0:c.ageCategoryCode;return[l,o===ny?"D":"S",d,s,u].join(";")}).join("|");return{tieFormatName:t&&n||"UNNAMED",matchUpFormats:i,tieFormatDesc:r}}function Hf({considerations:t={},descendant:e,ancestor:i}){var n,r;let a={},o={},{matchUpFormats:s,tieFormatDesc:l}=j_(e),{matchUpFormats:c,tieFormatDesc:u}=j_(i),d=ki((s??[]).filter(S=>!(c??[]).includes(S)).concat((c??[]).filter(S=>!(s??[]).includes(S)))),p=!!(t!=null&&t.collectionName&&e.collectionDefinitions.map(({collectionName:S})=>S).join("|")!==i.collectionDefinitions.map(({collectionName:S})=>S).join("|")),h=!!(t!=null&&t.collectionOrder&&e.collectionDefinitions.map(({collectionOrder:S})=>S).join("|")!==i.collectionDefinitions.map(({collectionOrder:S})=>S).join("|")),f=Object.assign({},...((e==null?void 0:e.collectionDefinitions)||[]).map(S=>({[S.collectionId]:S}))),m=Object.assign({},...((i==null?void 0:i.collectionDefinitions)||[]).map(S=>({[S.collectionId]:S})));a.collectionIds=kZ(Object.keys(f),Object.keys(m)),o.collectionIds=kZ(Object.keys(m),Object.keys(f)),a.collectionsValue=fX(f),o.collectionsValue=fX(m),a.groupsCount=((n=i==null?void 0:i.collectionGroups)==null?void 0:n.length)??(0-(((r=e==null?void 0:e.collectionGroups)==null?void 0:r.length)??0)||0),o.groupsCount=a.groupsCount?-1*a.groupsCount:0;let g=a.collectionsValue.totalValue-o.collectionsValue.totalValue,v=a.collectionsValue.totalMatchUps-o.collectionsValue.totalMatchUps,y=o.collectionsValue.assignmentValues.length!==a.collectionsValue.assignmentValues.length,b=o.collectionsValue.assignmentValues.some((S,D)=>{let E=a.collectionsValue.assignmentValues[D];return!E||S.valueKey!==E.valueKey||S.value!==E.value?!0:Array.isArray(S.value)?S.value.every((C,P)=>E.value[P]===C):!1}),I=p||h||u!==l||y||b||g!==0,T=[...o.collectionsValue.invalidValues,...a.collectionsValue.invalidValues],w=T.length&&T;return{matchUpFormatDifferences:d,matchUpCountDifference:v,descendantDifferences:a,ancestorDifferences:o,orderDifference:h,valueDifference:g,nameDifference:p,descendantDesc:l,ancestorDesc:u,...ue,different:I,invalid:w}}function fX(t){let e=[],i=[],n=0;return{totalValue:Object.keys(t).sort(_L).reduce((r,a)=>{let o=t[a],{collectionValueProfiles:s,collectionValue:l,matchUpCount:c,matchUpValue:u,scoreValue:d,setValue:p}=o,h={collectionValueProfiles:s,collectionValue:l,matchUpValue:u,scoreValue:d,setValue:p},f=Object.keys(h).filter(g=>![void 0,null].includes(h[g]));f.length!==1&&e.push({collectionId:a});let m=f[0];if(m){let g=m==="collectionValueProfiles"?Object.values(s):h[m];i.push({valueKey:m,value:g})}return n+=c,s?r+s.reduce((g,v)=>g+v.value,0):c?bi(u)?r+u*c:bi(d)?r+d*c:bi(p)?r+p*c:r+l:r},0),totalMatchUps:n,invalidValues:e,assignmentValues:i}}function B8(t){Object.assign(t,{inContext:!0});let{matchUp:e,error:i}=QIe(t);return{matchUp:$t(e,!0,!0),error:i}}function QIe({participantsProfile:t,afterRecoveryTimes:e,tournamentRecord:i,contextContent:n,contextProfile:r,drawDefinition:a,nextMatchUps:o,matchUpId:s,inContext:l,eventId:c,drawId:u,event:d}){var p;if(!i)return{error:it};if(typeof s!="string")return{error:_o};if(!a||!d){let m=(co({tournamentRecord:i,nextMatchUps:o}).matchUps??[]).find(g=>g.matchUpId===s);if(!m)return{error:qo};({eventId:c,drawId:u}=m),{event:d,drawDefinition:a}=Ks({tournamentRecord:i,eventId:c,drawId:u})}if(!a)return{error:_l};r&&!n&&(n=dm({tournamentRecord:i,contextProfile:r}));let h={surfaceCategory:(d==null?void 0:d.surfaceCategory)??i.surfaceCategory,indoorOutDoor:(d==null?void 0:d.indoorOutdoor)??i.indoorOutdoor,endDate:(d==null?void 0:d.endDate)??i.endDate,tournamentId:i.tournamentId,eventId:c??(d==null?void 0:d.eventId),drawId:u},{participants:f=[]}=hw({participantsProfile:t,tournamentRecord:i,contextProfile:r,inContext:l});if(o){let m=(Hs({context:l?h:void 0,participants:f,afterRecoveryTimes:e,contextContent:n,contextProfile:r,drawDefinition:a,nextMatchUps:o,inContext:l,event:d}).matchUps??[]).find(v=>v.matchUpId===s);if(!m)return{error:qo};let g=(p=a==null?void 0:a.structures)==null?void 0:p.find(v=>v.structureId===m.structureId);return{drawDefinition:a,structure:g,matchUp:m}}else{let{matchUp:m,structure:g}=ar({context:l?h:void 0,tournamentParticipants:f,afterRecoveryTimes:e,contextContent:n,drawDefinition:a,contextProfile:r,matchUpId:s,inContext:l,event:d});return{matchUp:m,structure:g,drawDefinition:a}}}function $8({tournamentRecord:t,drawDefinition:e,structureId:i,matchUpId:n,structure:r,eventId:a,drawId:o,event:s}){var l,c,u,d,p;if(!t)return{error:it};if(!o&&!s&&!i&&!n)return fe({result:{error:Ht},stack:"getTieFormat"});a&&!s&&(s=(l=t.events)==null?void 0:l.find(y=>y.eventId===a));let h=B8({tournamentRecord:t,drawDefinition:e,matchUpId:n,drawId:o,event:s});if(n&&h!=null&&h.error)return h;if(!e&&h!=null&&h.drawDefinition&&(e=h==null?void 0:h.drawDefinition),r=r??(h==null?void 0:h.structure),!r&&i&&!n){if(!e)return{error:Rd};let y=pi({drawDefinition:e,structureId:i});if(y.error)return y;r=y.structure}let f=((r==null?void 0:r.tieFormat)||(r==null?void 0:r.tieFormatId))&&((c=ns({structure:r,drawDefinition:e,event:s}))==null?void 0:c.tieFormat),m=((e==null?void 0:e.tieFormat)||(e==null?void 0:e.tieFormatId))&&((u=ns({drawDefinition:e,event:s}))==null?void 0:u.tieFormat),g=(d=ns({event:s}))==null?void 0:d.tieFormat,v=(p=ns({matchUp:h==null?void 0:h.matchUp,drawDefinition:e,structure:r,event:s}))==null?void 0:p.tieFormat;return{...ue,matchUp:h==null?void 0:h.matchUp,structureDefaultTieFormat:So(f),eventDefaultTieFormat:So(g),drawDefaultTieFormat:So(m),tieFormat:So(v),structure:r}}var ewe={};zi(ewe,{bulkUpdatePublishedEventIds:()=>V8,getAllEventData:()=>j8,getCourtInfo:()=>PL,getDrawData:()=>lF,getEventData:()=>cF,getEventPublishStatus:()=>Xc,getPublishState:()=>mw,getVenueData:()=>GS});function V8({tournamentRecord:t,outcomes:e}){var i;if(!t)return{error:it};if(!(e!=null&&e.length))return{error:Ht,info:"Missing outcomes"};let n=e.reduce((a,o)=>{let{drawId:s,eventId:l}=o;return l&&s&&(a[l]?a[l].includes(s)||a[l].push(s):a[l]=[s]),a},{}),r=Object.keys(n);return{publishedEventIds:((i=t.events)==null?void 0:i.filter(a=>r.includes(a.eventId))).filter(a=>{let o=Xc({event:a}),{drawDetails:s,drawIds:l}=o??{},{eventId:c}=a;return n[c].filter(u=>{let d=s?Object.keys(o.drawDetails).filter(p=>E6({drawId:p,drawDetails:s})):[];return(l==null?void 0:l.includes(u))||d.includes(u)}).length}).map(a=>a.eventId),eventIdPublishedDrawIdsMap:n}}function twe({dates:t=[],extension:e}){var i;if(!e)return!1;if(typeof e.value=="boolean"&&e.value)return!0;if(!t.length)return!1;let n=sr(e.value)?(i=e.value)==null?void 0:i.dates:void 0;if(Array.isArray(n))return n!=null&&n.length?!!n.filter(r=>!t.length||t.includes(r)).length:!1}function iwe({convertExtensions:t,ignoreDisabled:e,venue:i,court:n}){var r;let a={...$t(n,t,!0),venueId:i.venueId},{extension:o}=Bi({name:md,element:n});if(e&&o){let s=sr(o.value)?(r=o.value)==null?void 0:r.dates:void 0,l=(o==null?void 0:o.value)===!0?[]:a.dateAvailability.map(c=>{let u=c.date;if(!(!u||s.includes(u)))return c}).filter(Boolean);a.dateAvailability=l}return{inContextCourt:a}}function fm(t){let{convertExtensions:e,ignoreDisabled:i,venueIds:n=[],dates:r}=t,a=t.tournamentRecords||t.tournamentRecord&&{[t.tournamentRecord.tournamentId]:t.tournamentRecord}||{},o=[],s=[],l=[],c=[];return Object.keys(a).filter(u=>!t.tournamentId||u===t.tournamentId).forEach(u=>{let d=a[u];for(let p of d.venues??[])if(!(n.length&&!n.includes(p.venueId))){if(i){let{extension:h}=Bi({name:md,element:p});if(h!=null&&h.value)continue}o.includes(p.venueId)||(c.push($t(p,e,!0)),o.push(p.venueId));for(let h of p.courts??[])if(!s.includes(h.courtId)){if(i){let{extension:m}=Bi({name:md,element:h});if(twe({extension:m,dates:r}))continue}let{inContextCourt:f}=iwe({convertExtensions:e,ignoreDisabled:i,venue:p,court:h});l.push(f),s.push(h.courtId)}}}),{courts:l,venues:c,...ue}}function d5e({convertExtensions:t,tournamentRecord:e,ignoreDisabled:i,dates:n}){if(!e)return{error:_r};let r=$t(e.venues??[],t).filter(o=>{if(!i)return o;let{extension:s}=Bi({name:md,element:o});return!(s!=null&&s.value)&&o}).filter(Boolean),a=r.reduce((o,s)=>{let l=((s==null?void 0:s.courts)||[]).filter(c=>{if(!i&&!(n!=null&&n.length))return c;let{extension:u}=Bi({name:md,element:c});return twe({extension:u,dates:n})}).filter(Boolean).map(c=>{let{inContextCourt:u}=iwe({convertExtensions:t,ignoreDisabled:i,venue:s,court:c});return u});return l.length?o.concat(l):o},[]);return{venues:r,courts:a}}function kR({tournamentRecords:t,requireCourts:e,dates:i}){return typeof t!="object"||!Object.keys(t).length?{error:_r}:Object.keys(t).reduce((n,r)=>{let a=t[r],{venues:o}=d5e({tournamentRecord:a,dates:i});return o==null||o.forEach(s=>{let{venueId:l,courts:c}=s;(!e||c!=null&&c.length)&&!n.venueIds.includes(l)&&(n.venues.push(s),n.venueIds.push(l))}),n},{venues:[],venueIds:[]})}function j8({tournamentRecord:t,policyDefinitions:e}){if(!t)return{error:it};let i=t.events||[],n=(t==null?void 0:t.participants)||[],{tournamentInfo:r}=Sw({tournamentRecord:t}),{venues:a}=fm({tournamentRecord:t}),o=i.map(s=>{let{eventId:l}=s,c=XIe({event:s}).eventInfo,u=oR({tournamentRecord:t,event:s}).scheduleTiming,d=(s.drawDefinitions||[]).map(h=>{let f=(({drawId:b,drawName:I,matchUpFormat:T,updatedAt:w})=>({matchUpFormat:T,updatedAt:w,drawName:I,drawId:b}))(h),{abandonedMatchUps:m,completedMatchUps:g,upcomingMatchUps:v,pendingMatchUps:y}=SU({requireParticipants:!0,tournamentParticipants:n,context:{eventId:l},policyDefinitions:e,tournamentRecord:t,inContext:!0,scheduleTiming:u,drawDefinition:h,event:s});return{drawInfo:f,matchUps:{abandonedMatchUps:m,completedMatchUps:g,upcomingMatchUps:v,pendingMatchUps:y}}}),p=Xc({event:s});return Object.assign(c,{drawsData:d,publish:p}),c});return{allEventData:{tournamentInfo:r,venuesData:a,eventsData:o}}}function nwe({publishStatus:t,drawId:e}){var i,n,r;return t!=null&&t.drawDetails?(r=(n=(i=t.drawDetails)==null?void 0:i[e])==null?void 0:n.publishingDetail)==null?void 0:r.published:t!=null&&t.drawIds?t.drawIds.includes(e):!0}function lF(t){var e,i;let{tournamentParticipants:n=[],includePositionAssignments:r,policyDefinitions:a,tournamentRecord:o,inContext:s=!0,usePublishState:l,status:c=Wu,drawDefinition:u,noDeepCopy:d,sortConfig:p,context:h,event:f}=t;if(!u)return{error:Lt};let m=(({matchUpFormat:P,updatedAt:R,drawType:N,drawName:M,drawId:A})=>({matchUpFormat:P,updatedAt:R,drawName:M,drawType:N,drawId:A}))(u),g,v,{allStructuresLinked:y,sourceStructureIds:b,hasDrawFeedProfile:I,structureGroups:T}=FL({drawDefinition:u});if(!y)return{error:Afe};let w=(t==null?void 0:t.publishStatus)??Xc({event:f,status:c}),S=t.eventPublished??!!((i=(e=mw({event:f}).publishState)==null?void 0:e.status)!=null&&i.published),D=!1,E=!1,C=T.map(P=>{let R={},N=P.map(M=>{let{structure:A}=pi({drawDefinition:u,structureId:M}),{seedAssignments:_}=Gc({drawDefinition:u,structure:A});return(A==null?void 0:A.stage)===Ft&&A.stageSequence===1&&(g=_),(A==null?void 0:A.stage)===Xt&&A.stageSequence===1&&(v=_),A}).sort((M,A)=>cw(M,A,p)).map(M=>{var A;if(!M)return;let _=M==null?void 0:M.structureId,x=[];M.stage&&[Ft,Mo,Br].includes(M.stage)&&(x=g),(M==null?void 0:M.stage)===Xt&&(x=v);let{matchUps:O,roundMatchUps:B,roundProfile:F}=Sn({seedAssignments:(A=M==null?void 0:M.seedAssignments)!=null&&A.length?void 0:x,context:{drawId:m.drawId,...h},tournamentParticipants:n,policyDefinitions:a,tournamentRecord:o,usePublishState:l,publishStatus:w,drawDefinition:u,inContext:s,structure:M,event:f}),{positionAssignments:G}=jn({structure:M}),H=G==null?void 0:G.filter(Ol(wh)).map(z=>{let{drawPosition:Z,participantId:Y}=z,{extension:Q}=Bi({element:z,name:og});return E=!0,{participantResult:Q==null?void 0:Q.value,participantId:Y,drawPosition:Z}});if(!(H!=null&&H.length)&&O.length&&t.allParticipantResults){let{subOrderMap:z}=Eye({positionAssignments:G}),Z=CU({matchUpFormat:M.matchUpFormat,policyDefinitions:a,subOrderMap:z,matchUps:O});H=G==null?void 0:G.filter(Ol(wh)).map(Y=>{let{drawPosition:Q,participantId:X}=Y;return E=!0,{participantResult:X&&Z.participantResults[X],participantId:X,drawPosition:Q}})}let $=M?(({stageSequence:z,structureName:Z,structureType:Y,matchUpFormat:Q,stage:X})=>({stageSequence:z,structureName:Z,structureType:Y,matchUpFormat:Q,stage:X}))(M):{};$.sourceStructureIds=b[_],$.hasDrawFeedProfile=I[_],$.positionAssignments=G,$.structureActive=O.reduce((z,Z)=>{var Y;let Q=[ia,sm,fn,os,Rn,Hu,Ca,da].includes(Z.matchUpStatus);return z||Q||!!Z.winningSide||!!((Y=Z.score)!=null&&Y.scoreStringSide1)},!1);let q=O.reduce((z,Z)=>z&&[yn,ia,os,Rn,fn,ec].includes(Z.matchUpStatus),!!O.length);return $.structureCompleted=q,R[_]=q,$.structureActive&&(D=!0),{...$,participantResults:H,seedAssignments:x,roundMatchUps:B,roundProfile:F,structureId:_}});return N.forEach(M=>{var A;r||delete M.positionAssignments,M.sourceStructuresComplete=(A=M.sourceStructureIds)==null?void 0:A.every(_=>R[_])}),N}).flat();return m.drawActive=D,m.participantPlacements=E,m.drawGenerated=C==null?void 0:C.reduce((P,R)=>P||!!(R!=null&&R.roundMatchUps),!1),m.drawCompleted=C==null?void 0:C.reduce((P,R)=>P&&R.structureCompleted,!0),m.drawPublished=l?S&&nwe({publishStatus:w,drawId:m.drawId}):void 0,{structures:!l||m.drawPublished?d?C:$t(C,!1,!0):void 0,drawInfo:d?m:$t(m,!1,!0),...ue}}function cF(t){var e,i;let{includePositionAssignments:n,participantsProfile:r,policyDefinitions:a,usePublishState:o,status:s=Wu,sortConfig:l}=t,c=mn(t,[{tournamentRecord:!0},{[C5]:{event:!1,eventId:!1}}]);if(c.error)return c;let u=$t(t.tournamentRecord,!1,!0),d=t.event?void 0:Ks({tournamentRecord:u,eventId:t.eventId}).event,p=t.event?$t(t.event,!1,!0):d&&$t(d,!1,!0)||void 0;if(!p)return{error:kl};let{eventId:h}=p,{tournamentId:f,endDate:m}=u,g=Xc({event:p,status:s}),v=mw({event:p}).publishState??{},y=!!((e=v==null?void 0:v.status)!=null&&e.published),{participants:b}=Yr({withGroupings:!0,withEvents:!1,withDraws:!1,policyDefinitions:a,...r,tournamentRecord:u}),I=({stage:M,drawId:A})=>{var _,x,O;if(!o)return!0;let B=(x=(_=g==null?void 0:g.drawDetails)==null?void 0:_[A])==null?void 0:x.stageDetails;return!B||!Object.keys(B).length?!0:(O=B[M])==null?void 0:O.published},T=({structureId:M,drawId:A})=>{var _,x,O;if(!o)return!0;let B=(x=(_=g==null?void 0:g.drawDetails)==null?void 0:_[A])==null?void 0:x.structureDetails;return!B||!Object.keys(B).length?!0:(O=B[M])==null?void 0:O.published},w=({drawId:M})=>o?nwe({publishStatus:g,drawId:M}):!0,S=({drawId:M,structure:A})=>{var _,x,O,B;if(!o)return A;let F=(B=(O=(x=(_=g==null?void 0:g.drawDetails)==null?void 0:_[M])==null?void 0:x.structureDetails)==null?void 0:O[A.structureId])==null?void 0:B.roundLimit;if(bi(F)){let G=Ct(1,F+1),H={},$={};for(let q of G)A.roundMatchUps[q]&&(H[q]=A.roundMatchUps[q],$[q]=A.roundProfile[q]);A.roundMatchUps=H,A.roundProfile=$}return A},D=p.drawDefinitions||[],E=!o||y?D.filter(w).map(M=>(({drawInfo:A,structures:_})=>({...A,structures:_}))(lF({allParticipantResults:t.allParticipantResults,context:{eventId:h,tournamentId:f,endDate:m},includePositionAssignments:n,tournamentParticipants:b,noDeepCopy:!0,policyDefinitions:a,tournamentRecord:u,usePublishState:o,drawDefinition:M,publishStatus:g,sortConfig:l,event:p}))).map(({structures:M,...A})=>{let _=M==null?void 0:M.filter(({stage:x,structureId:O})=>T({structureId:O,drawId:A.drawId})&&I({stage:x,drawId:A.drawId})).map(x=>S({drawId:A.drawId,structure:x}));return{...A,structures:_}}).filter(M=>{var A;return(A=M.structures)==null?void 0:A.length}):void 0,{tournamentInfo:C}=Sw({tournamentRecord:u}),P=(u.venues||[]).map(M=>(({venueData:A})=>({...A}))(GS({tournamentRecord:u,venueId:M.venueId}))),R=(({eventId:M,eventName:A,eventType:_,eventLevel:x,surfaceCategory:O,matchUpFormat:B,category:F,gender:G,startDate:H,endDate:$,ballType:q,discipline:z})=>({eventId:M,eventName:A,eventType:_,eventLevel:x,surfaceCategory:O,matchUpFormat:B,category:F,gender:G,startDate:H,endDate:$,ballType:q,discipline:z}))(p),N={tournamentInfo:C,venuesData:P,eventInfo:R,drawsData:E};return N.eventInfo.publishState=v,N.eventInfo.published=(i=v==null?void 0:v.status)==null?void 0:i.published,{...ue,eventData:N,participants:b}}var rwe={};zi(rwe,{getPersonRequests:()=>qy,getProfileRounds:()=>pF,getScheduledRoundsDetails:()=>xR,getSchedulingProfile:()=>mm,getSchedulingProfileIssues:()=>G8});function uF({defaultRecoveryMinutes:t=0,defaultAverageMinutes:e,tournamentRecords:i,matchUpFormat:n,categoryName:r,categoryType:a,tournamentId:o,eventType:s,eventId:l}){if(!Fl({matchUpFormat:n}))return{error:kP};let c=Object.keys(i).filter(d=>!o||d===o),u;return c.forEach(d=>{var p;if(u)return;let h=i[d],f=l?(p=Ks({tournamentRecord:h,eventId:l}))==null?void 0:p.event:void 0;return u=sR({tournamentRecord:h,matchUpFormat:n,categoryName:r,categoryType:a,eventType:s,event:f}),(u==null?void 0:u.averageMinutes)||(u==null?void 0:u.recoveryMinutes)}),{recoveryMinutes:(u==null?void 0:u.recoveryMinutes)||t,averageMinutes:(u==null?void 0:u.averageMinutes)||e,typeChangeRecoveryMinutes:(u==null?void 0:u.typeChangeRecoveryMinutes)||(u==null?void 0:u.recoveryMinutes)||t}}function xR({scheduleCompletedMatchUps:t,containedStructureIds:e,tournamentRecords:i,periodLength:n=30,matchUps:r,rounds:a}){if(typeof i!="object")return{error:_r};if(!Array.isArray(a))return{error:Ht,info:Nh("rounds")};let o={},s=[];a.sort((p,h)=>(p.sortOrder??0)-(h.sortOrder??0)),e=e??Object.assign({},...Object.values(i).map(p=>vU({tournamentRecord:p}).containedStructures)),r||({matchUps:r}=Ud({nextMatchUps:!0,tournamentRecords:i}));let l=0,c={},u={},d={};return{scheduledRoundsDetails:a.flatMap(p=>{var h;let f=p.periodLength||n,m=[];e!=null&&e[p.structureId]?m.push(...e[p.structureId]):m.push(p.structureId);let g=r?gb({tournamentIds:[p.tournamentId],roundNumbers:[p.roundNumber],matchUpIds:p.matchUpIds,eventIds:[p.eventId],drawIds:[p.drawId],processContext:!0,structureIds:m,matchUps:r}).sort(fw):[],{segmentNumber:v,segmentsCount:y}=p.roundSegment||{};if(bi(v)&&Td(g==null?void 0:g.length)&&Td(y)&&v>0&&v<=y&&y<(g==null?void 0:g.length)&&!((h=p.matchUpIds)!=null&&h.length)){let w=g.length/y,S=w*(v-1);g=g.slice(S,S+w)}let b=i[p.tournamentId],I=Ks({drawId:p.drawId,tournamentRecord:b}).event,T=[];for(let w of g){let S=w.matchUpFormat;S&&(o[S]||(o[S]=[],o[S].push(w)),T.push(S))}for(let w of T){let{eventType:S,category:D}=I??{},{categoryName:E,ageCategoryCode:C}=D??{},{typeChangeRecoveryMinutes:P,recoveryMinutes:R,averageMinutes:N,error:M}=uF({categoryName:E??C,categoryType:D==null?void 0:D.categoryType,tournamentId:p.tournamentId,eventId:p.eventId,tournamentRecords:i,matchUpFormat:w,eventType:S});if(M)return{error:M,round:p};let A=g.filter(x=>(t||!Ga.includes(x.matchUpStatus))&&x.matchUpStatus!==yn).map(Va);A.forEach(x=>{d[x]={typeChangeRecoveryMinutes:P,recoveryMinutes:R,averageMinutes:N},c[x]=R,u[x]=N}),s.push(...A),l=Math.max(N||0,l);let _=`${N}|${f}`;return{roundPeriodLength:f,recoveryMinutes:R,averageMinutes:N,matchUpIds:A,hash:_}}}),greatestAverageMinutes:l,matchUpFormatCohorts:o,recoveryMinutesMap:c,averageMinutesMap:u,orderedMatchUpIds:s,minutesMap:d,...ue}}function awe({schedulingProfile:t,venueIds:e,eventIds:i,drawIds:n}){let r=[],a=t==null?void 0:t.map(s=>{let l=Ci(s==null?void 0:s.scheduleDate);if(!l){r.push(`Invalid date: ${s==null?void 0:s.scheduledDate}`);return}let c=((s==null?void 0:s.venues)||[]).map(u=>{let{rounds:d,venueId:p}=u;if(!(e!=null&&e.includes(p))){r.push(`Missing venueId: ${p}`);return}let h=d.filter(f=>{let m=i.includes(f.eventId)&&n.includes(f.drawId);return m||r.push(`Invalid eventId: ${f.eventId} or drawId: ${f.drawId}`),m});if(h.length)return{venueId:p,rounds:h}}).filter(Boolean);return c.length&&l&&{...s,venues:c}}).filter(Boolean),o=r.length;return{updatedSchedulingProfile:a,modifications:o,issues:r}}function dF({tournamentRecords:t,schedulingProfile:e}){if(!e)return{valid:!0};if(!Array.isArray(e))return{valid:!1,error:Me};let{venueIds:i,tournamentsMap:n}=h5e({tournamentRecords:t}),r,a,o=e.every(s=>{let{scheduleDate:l,venues:c}=s;return Kl(l)?c.every(u=>{let{venueId:d,rounds:p}=u;return typeof d!="string"?(a="venueId should be a string",!1):Array.isArray(p)?i.includes(d)?!!p.every(h=>{var f,m,g,v;if(!h)return a="empty round",!1;let{roundSegment:y,tournamentId:b,structureId:I,roundNumber:T,eventId:w,drawId:S}=h,D=(v=(g=(m=(f=n==null?void 0:n[b])==null?void 0:f[w])==null?void 0:m[S])==null?void 0:g[I])==null?void 0:v.includes(T);D||(a="Invalid rounds");let{segmentNumber:E,segmentsCount:C}=y||{},P=!y||bi(E)&&Td(C)&&E<=C;return P||(a="Invalid segment"),D&&P}):(r=oU,!1):(a="rounds should be an array",!1)}):!1});return!o&&!r&&(r=Me),{valid:!!o,error:r,info:a}}function p5e(t){let{tournamentRecord:e={},tournamentMap:i={},requireCourts:n}=t,r=[],a=[],o=[],s=[],l=((e==null?void 0:e.venues)||[]).map(({venueId:u,courts:d})=>(!n||(d==null?void 0:d.length))&&u),c=e==null?void 0:e.tournamentId;return c&&(r.push(c),i[c]={},((e==null?void 0:e.events)||[]).forEach(u=>{let d=u.eventId;o.push(d),i[c][d]={},(u.drawDefinitions||[]).forEach(p=>{let h=p.drawId;s.push(h),i[c][d][h]={};let{structures:f}=Rh({drawDefinition:p});(f||[]).forEach(m=>{var g;let v=m.structureId,{matchUps:y}=Sn({structure:m}),{roundMatchUps:b}=Rs({matchUps:y}),I=b&&Object.keys(b).map(T=>parseInt(T));i[c][d][h][v]=I,a.push(v),(g=m.structures)!=null&&g.length&&m.structures.forEach(T=>{a.push(T.structureId),i[c][d][h][T.structureId]=I})})})})),{tournamentMap:i,tournamentIds:r,structureIds:a,venueIds:l,eventIds:o,drawIds:s}}function h5e(t){let e=(t==null?void 0:t.tournamentRecords)&&Object.values(t==null?void 0:t.tournamentRecords)||[],i={},{venueIds:n,eventIds:r,drawIds:a,structureIds:o,tournamentIds:s}=e.reduce((l,c)=>{let{tournamentIds:u,tournamentMap:d,structureIds:p,venueIds:h,eventIds:f,drawIds:m}=p5e({tournamentRecord:c});return h.forEach(g=>{l.venueIds.includes(g)||l.venueIds.push(g)}),l.tournamentIds.push(...u),l.structureIds.push(...p),l.eventIds.push(...f),l.drawIds.push(...m),Object.assign(i,d),l},{tournamentIds:[],structureIds:[],venueIds:[],eventIds:[],drawIds:[]});return{tournamentsMap:i,tournamentIds:s,structureIds:o,venueIds:n,eventIds:r,drawIds:a}}function mm({tournamentRecords:t,tournamentRecord:e}){if(typeof t!="object"||!Object.keys(t).length)return{error:_r};let{extension:i}=Bi({element:e,name:cI,tournamentRecords:t,discover:!0}),n=(i==null?void 0:i.value)||[];if(n.length){let{venueIds:r}=kR({requireCourts:!0,tournamentRecords:t}),{eventIds:a,drawIds:o}=Q6({tournamentRecords:t}),{updatedSchedulingProfile:s,modifications:l,issues:c}=awe({schedulingProfile:n,venueIds:r,eventIds:a,drawIds:o});if(l){n=s;let u=PU({tournamentRecords:t,tournamentRecord:e,schedulingProfile:n});return u.error?u:{schedulingProfile:n,modifications:l,issues:c}}}return{schedulingProfile:n,modifications:0}}function PU({tournamentRecords:t,tournamentRecord:e,schedulingProfile:i}){let n=dF({tournamentRecords:t,schedulingProfile:i});return n.error?n:i?un({tournamentRecords:t,discover:!0,extension:{name:cI,value:i}}):Ss({element:e,name:cI,tournamentRecords:t,discover:!0})}function OR(t){let{tournamentRecord:e}=t,i=t.tournamentRecords||e&&{[e.tournamentId]:e}||{};if(!t.schedulingProfile){let{modifications:c,issues:u}=mm({tournamentRecords:i,tournamentRecord:e});return{success:!c,modifications:c,issues:u}}let{venueIds:n}=kR({tournamentRecords:i}),{eventIds:r,drawIds:a}=Q6({tournamentRecords:i}),{updatedSchedulingProfile:o,modifications:s,issues:l}=awe({schedulingProfile:t.schedulingProfile,venueIds:n,eventIds:r,drawIds:a});return s?{...PU({schedulingProfile:o,tournamentRecords:i}),modifications:s,issues:l}:{...ue,modifications:s,issues:l}}function G8(t){let{scheduleDates:e=[],tournamentRecords:i,periodLength:n=30}=t??{};if(typeof i!="object")return{error:NP};if(!Array.isArray(e))return{error:Me};if(!e.every(Kl))return{error:Cs};let r=[],a=0,o={},{schedulingProfile:s}=mm({tournamentRecords:i});if(!s)return{issues:r,...ue};let{matchUps:l}=Ud({nextMatchUps:!0,tournamentRecords:i});for(let u of s){let{scheduleDate:d,venues:p=[]}=u;if(!(e!=null&&e.length)||e.includes(d)){for(let h of p||[])if(h){let{rounds:f}=h,m=[],{orderedMatchUpIds:g,scheduledRoundsDetails:v}=xR({tournamentRecords:i,periodLength:n,matchUps:l,rounds:f}),{matchUpDependencies:y}=Ku({tournamentRecords:i,matchUps:l}),b=I=>{let T;return v==null||v.find((w,S)=>{let D=w.matchUpIds.includes(I);return D&&(T=S),D}),T};if(g==null||g.forEach((I,T)=>{var w;let S=g.slice(T+1),D=Wr(S,((w=y==null?void 0:y[I])==null?void 0:w.matchUpIds)||[]);D.length&&m.push({matchUpId:I,shouldBeAfter:D})}),m.length){a+=m.length;let I=m.map(({matchUpId:T,shouldBeAfter:w})=>{let S=b(T),D=ki(w.map(b));return o[d]||(o[d]={}),o[d][S]||(o[d][S]=[]),D.forEach(E=>{o[d][S].includes(E)||o[d][S].push(E)}),{matchUpId:T,matchUpRoundIndex:S,earlierRoundIndices:D,shouldBeAfter:w}});r.push(...I)}}}}let c={matchUpIdShouldBeAfter:Object.assign({},...r.map(u=>{let{matchUpId:d,shouldBeAfter:p,earlierRoundIndices:h}=u;return{[d]:{earlierRoundIndices:h,shouldBeAfter:p}}}))};return{issuesCount:a,profileIssues:c,roundIndexShouldBeAfter:o,...ue}}function qy(t){let{tournamentRecords:e,requestType:i}=t,n=mn(t,[{[Ko]:!0}]);if(n.error)return n;let r={};for(let a of Object.values(e)){let{extension:o}=Bi({element:a,name:hU}),s=(o==null?void 0:o.value)||[];for(let l of s){let{personId:c,requests:u}=l||{};r[c]||(r[c]=[]);for(let d of u)i&&d.requestType!==i||r[c].push(d)}}return{personRequests:r,...ue}}function kj(t){let{containerStructureId:e,roundSegment:i,isRoundRobin:n,tournamentId:r,roundNumber:a,structureId:o,eventId:s,drawId:l}=t,c=n?e:o,u=[r,s,l,c,a].join("|");return qt({structureId:c,roundSegment:i,tournamentId:r,roundNumber:a,eventId:s,drawId:l,id:u})}function mX({round:t,matchUps:e,events:i,tournamentRecords:n}){let r=i.find(p=>p.eventId===t.eventId),{eventType:a,category:o,categoryType:s}=r||{},{categoryName:l,ageCategoryCode:c}=o||{},u=xl(e.map(({matchUpFormat:p})=>p)),d=0;return Object.keys(u).forEach(p=>{let h=u[p],f=uF({categoryName:l||c,tournamentId:t.tournamentId,eventId:t.eventId,tournamentRecords:n,matchUpFormat:p,categoryType:s,eventType:a});if(f.error)return f;let m=f.averageMinutes*h;isNaN(d)||(d+=m)}),{roundMinutes:d}}function f5e(t){return(t||[]).reduce((e,i)=>{var n,r;let a=(((n=i.finishingPositionRange)==null?void 0:n.winner)||[]).reduce((s,l)=>s+l,0),o=(((r=i.finishingPositionRange)==null?void 0:r.winner)||[]).join("-")||"";return!e.minFinishingSum||a<e.minFinishingSum?{minFinishingSum:a,winnerFinishingPositionRange:o}:e},{minFinishingSum:0,winnerFinishingPositionRange:""})}function gX(t){let e=t.length,i=t.filter(({sides:c})=>c==null?void 0:c.some(({bye:u})=>u)).length||0,n=t.filter(({winningSide:c,matchUpStatus:u})=>c||Ga.includes(u)).length||0,r=t.filter(({schedule:c,matchUpStatus:u})=>(c==null?void 0:c.scheduledDate)&&(c==null?void 0:c.scheduledTime)&&u!==yn).length||0,a=e-i,o=a===n,s=a-r,l=a-r;return{unscheduledCount:s,incompleteCount:l,scheduledCount:r,completedCount:n,matchUpsCount:e,isScheduled:a===r,isComplete:o,byeCount:i}}function pF({tournamentRecords:t,schedulingProfile:e,tournamentRecord:i,withRoundId:n}){if(i&&!t){if(typeof i!="object")return{error:NP};t={[i.tournamentId]:i}}if(e){let a=dF({tournamentRecords:t,schedulingProfile:e});if(a.error)return a}if(!e&&t){let a=mm({tournamentRecords:t});if(a.error)return a;e=a.schedulingProfile}if(!e)return{error:Wo};let r={};return{profileRounds:e.map(({venues:a,scheduleDate:o})=>a.map(({rounds:s})=>s.map(l=>{var c;let u=kj(l);return(c=u.roundSegment)!=null&&c.segmentsCount&&(r[u.id]=u.roundSegment.segmentsCount),qt({id:n?u.id:void 0,scheduleDate:o,...u})}))).flat(1/0),segmentedRounds:r}}var owe={};zi(owe,{getEntriesAndSeedsCount:()=>hF,getMaxEntryPosition:()=>H8});function hF({policyDefinitions:t,drawDefinition:e,drawSize:i,drawId:n,event:r,stage:a}){if(!r)return{error:_n};let{entries:o,stageEntries:s}=Ave({drawDefinition:e,drawId:n,stage:a,event:r}),l=s.length,{drawSize:c}=ibe({participantsCount:l}),u=_R({drawSize:i??c,participantsCount:l,policyDefinitions:t});if(u.error)return fe({result:u,stack:"getEntriesAndSeedsCount"});let{seedsCount:d}=u;return{entries:o,seedsCount:d,stageEntries:s}}function H8(t){let{entries:e=[],entryStatus:i,stage:n}=t;return Math.max(...e.filter(r=>(!n||n===r.entryStage)&&(!i||r.entryStatus===i)&&!isNaN(r.entryPosition)).map(({entryPosition:r})=>ai(r||0)),0)}var swe={};zi(swe,{allCompetitionMatchUps:()=>Ud,allDrawMatchUps:()=>Hs,allEventMatchUps:()=>pm,allTournamentMatchUps:()=>co,analyzeMatchUp:()=>RE,calculateWinCriteria:()=>Tw,checkMatchUpIsComplete:()=>_v,competitionScheduleMatchUps:()=>FR,drawMatchUps:()=>t7,eventMatchUps:()=>mF,getAllDrawMatchUps:()=>wa,getAllStructureMatchUps:()=>Sn,getCheckedInParticipantIds:()=>dw,getCompetitionMatchUps:()=>PE,getEventMatchUpFormatTiming:()=>q8,getMatchUpCompetitiveProfile:()=>aR,getMatchUpContextIds:()=>X8,getMatchUpDailyLimits:()=>vF,getMatchUpDailyLimitsUpdate:()=>W8,getMatchUpDependencies:()=>Ku,getMatchUpFormat:()=>J8,getMatchUpFormatTiming:()=>sR,getMatchUpFormatTimingUpdate:()=>z8,getMatchUpScheduleDetails:()=>RL,getMatchUpType:()=>ML,getMatchUpsStats:()=>Q8,getModifiedMatchUpFormatTiming:()=>fF,getParticipantResults:()=>ER,getPredictiveAccuracy:()=>Z8,getRoundMatchUps:()=>Rs,getRounds:()=>e7,isValidMatchUpFormat:()=>Fl,matchUpActions:()=>YL,participantScheduledMatchUps:()=>K8,tallyParticipantResults:()=>CU,tournamentMatchUps:()=>gF,validMatchUp:()=>EL,validMatchUps:()=>Zc});function lwe({tournamentRecords:t,extensionName:e}){if(typeof t!="object"||!Object.keys(t).length)return{error:_r};let i=[],n;for(let r of Object.values(t)){let{extension:a}=Bi({element:r,name:e});a&&!n&&(i.push({params:{extension:a,discover:!0},method:"addExtension"}),n=!0);let o=r.events??[];for(let s of o){let{eventId:l}=s,{extension:c}=Bi({name:e,element:s});c&&i.push({params:{eventId:l,extension:c},method:"addEventExtension"})}}return{methods:i}}function z8({tournamentRecords:t}){return lwe({extensionName:Lf,tournamentRecords:t})}var f$="ADULT",m$="JUNIOR",CM="WHEELCHAIR",cwe={[Fg]:{allowModificationWhenMatchUpsScheduled:{courts:!1,venues:!1},defaultTimes:{averageTimes:[{categoryNames:[],minutes:{default:90}}],recoveryTimes:[{minutes:{[Zn]:30,default:60}}]},defaultDailyLimits:{[Mr]:2,[Zn]:2,total:3},matchUpAverageTimes:[{matchUpFormatCodes:[Cc],averageTimes:[{categoryNames:[],minutes:{default:90}},{categoryTypes:[CM],minutes:{default:120}}]},{matchUpFormatCodes:["SET3-S:6/TB7-F:TB10"],averageTimes:[{categoryNames:[],minutes:{default:85}}]},{matchUpFormatCodes:["SET3-S:6/TB7-F:TB7"],averageTimes:[{categoryNames:[],minutes:{default:70}}]},{matchUpFormatCodes:["SET3-S:4NOAD-F:TB7"],averageTimes:[{categoryNames:[],minutes:{default:55}}]},{matchUpFormatCodes:["SET3-S:4/TB7"],averageTimes:[{categoryNames:[],minutes:{default:60}}]},{matchUpFormatCodes:["SET3-S:4/TB7-F:TB7"],averageTimes:[{categoryNames:[],minutes:{default:50}}]},{matchUpFormatCodes:["SET3-S:4/TB7-F:TB10"],averageTimes:[{categoryNames:[],minutes:{default:55}}]},{matchUpFormatCodes:["SET3-S:4/TB5@3"],averageTimes:[{categoryNames:[],minutes:{default:45}}]},{matchUpFormatCodes:["SET1-S:8/TB7","SET1-S:8/TB7@7"],averageTimes:[{categoryNames:[],minutes:{default:40}}]},{matchUpFormatCodes:["SET1-S:5/TB9@4"],averageTimes:[{categoryNames:[],minutes:{default:30}}]},{matchUpFormatCodes:["SET1-S:6/TB7"],averageTimes:[{categoryNames:[],minutes:{default:30}}]},{matchUpFormatCodes:["SET1-S:6NOAD"],averageTimes:[{categoryNames:[],minutes:{default:30}}]},{matchUpFormatCodes:["SET1-S:4/TB7","SET1-S:4/TB5@3","SET3-S:TB10","SET1-S:T20"],averageTimes:[{categoryNames:[],minutes:{default:20}}]},{matchUpFormatCodes:["SET1-S:4NOAD"],averageTimes:[{categoryNames:[],minutes:{default:20}}]},{matchUpFormatCodes:["SET1-S:TB10"],averageTimes:[{categoryNames:[],minutes:{default:10}}]}],matchUpRecoveryTimes:[{matchUpFormatCodes:["SET3-S:6/TB7","SET3-S:6/TB7-F:TB10","SET3-S:6/TB7-F:TB7"],recoveryTimes:[{categoryTypes:[f$,CM],minutes:{default:60,[Zn]:30}},{categoryTypes:[m$],minutes:{default:60,[Zn]:60}}]},{matchUpFormatCodes:["SET3-S:4/TB7-F:TB7","SET3-S:4/TB7-F:TB10","SET3-S:4NOAD-F:TB7","SET3-S:4/TB7","SET3-S:4/TB5@3"],recoveryTimes:[{categoryTypes:[f$,CM],minutes:{default:30}},{categoryTypes:[m$],minutes:{default:60}}]},{matchUpFormatCodes:["SET1-S:8/TB7","SET1-S:8/TB7@7","SET1-S:5/TB9@4","SET1-S:6/TB7","SET1-S:6NOAD","SET1-S:4/TB7","SET1-S:4NOAD","SET3-S:TB10","SET1-S:T20"],recoveryTimes:[{categoryNames:[],minutes:{default:30}}]},{matchUpFormatCodes:["SET1-S:4/TB5@3"],recoveryTimes:[{categoryTypes:[f$,m$],minutes:{default:30}},{categoryTypes:[CM],minutes:{default:15}}]},{matchUpFormatCodes:["SET1-S:TB10"],recoveryTimes:[{categoryNames:[],minutes:{default:15}}]}],matchUpDailyLimits:[]}},m5e=cwe;function q8({tournamentRecord:t,matchUpFormats:e,categoryType:i,event:n}){if(!n)return{error:_n};let r=[],a;if(e!=null&&e.length){let d=[];r=e.map(p=>{let h=typeof p=="string"?{matchUpFormat:p}:p;if(!d.includes(h==null?void 0:h.matchUpFormat)&&Fl({matchUpFormat:h==null?void 0:h.matchUpFormat}))return d.push(h.matchUpFormat),h}).filter(Boolean)}else{let{policy:d}=Fy({policyType:Dh,tournamentRecord:t,event:n});if(d!=null&&d.matchUpFormats)r=d==null?void 0:d.matchUpFormats;else{let{extension:p}=Bi({name:Lf,element:n}),h,f;p!=null&&p.value?{matchUpAverageTimes:h,matchUpRecoveryTimes:f}=p.value:{matchUpAverageTimes:h,matchUpRecoveryTimes:f}=m5e[Fg],r=ki([...(h||[]).map(m=>m.matchUpFormatCodes),...(f||[]).map(m=>m.matchUpFormatCodes)].flat()).map(m=>({matchUpFormat:m})),a="default scheduling policy in use"}}let{eventType:o,eventId:s,category:l}=n,c=(l==null?void 0:l.categoryName)??(l==null?void 0:l.ageCategoryCode)??s;if(!s)return{error:_n};let u=r.map(({matchUpFormat:d,description:p})=>{let h=sR({tournamentRecord:t,matchUpFormat:d,categoryName:c,categoryType:i,eventType:o,event:n});return{matchUpFormat:d,description:p,...h}});return qt({eventMatchUpFormatTiming:u,info:a})}function fF(t){let e=mn(t,[{[Lh]:!0},{[nd]:m=>Fl({matchUpFormat:m}),[Sh]:kP,[S5]:!0}]);if(e.error)return e;let{tournamentRecord:i,matchUpFormat:n,event:r}=t,{extension:a}=Bi({name:Lf,element:r}),o=a==null?void 0:a.value,{extension:s}=Bi({element:i,name:Lf}),l=s==null?void 0:s.value,c=(o==null?void 0:o.matchUpAverageTimes)&&Y1({...o,matchUpFormat:n}),u=(l==null?void 0:l.matchUpAverageTimes)&&Y1({...l,matchUpFormat:n}),d=[c,u].find(m=>m),p=(o==null?void 0:o.matchUpRecoveryTimes)&&Z1({...o,matchUpFormat:n}),h=(l==null?void 0:l.matchUpRecoveryTimes)&&Z1({...l,matchUpFormat:n}),f=[p,h].find(m=>m);return{matchUpFormat:n,recoveryTimes:f,averageTimes:d}}function W8({tournamentRecords:t}){return lwe({extensionName:HP,tournamentRecords:t})}var LR=({scheduleAttributes:t=["scheduledDate","scheduledTime"],schedule:e={}})=>!!Object.keys(e).filter(i=>t.includes(i)).filter(i=>e[i]).length;function K8({scheduleAttributes:t=["scheduledDate","scheduledTime"],matchUps:e=[]}){if(!Zc(e))return{error:Oh};if(!Array.isArray(t))return{error:Me};let i=e.filter(Boolean).filter(({schedule:n})=>LR({schedule:n,scheduleAttributes:t})).reduce((n,r)=>{let{schedule:a}=r,o=Ci(a==null?void 0:a.scheduledDate),s=rr(a==null?void 0:a.scheduledTime);return o&&s&&(n[o]?n[o].push(r):n[o]=[r]),n},{});return Object.keys(i).forEach(n=>{i[n].sort((r,a)=>{var o,s;return Qme(rr((o=r.schedule)==null?void 0:o.scheduledTime),rr((s=a.schedule)==null?void 0:s.scheduledTime))})}),{...ue,scheduledMatchUps:i}}function g5e({tournamentRecords:t}){var e;let i=[],n={};for(let r of Object.values(t))for(let a of r.events??[]){let o=Xc({event:a}),s=o==null?void 0:o.drawDetails;sr(s)?(Object.assign(n,s),i.push(...Object.keys(s).filter(l=>E6({drawId:l,drawDetails:s})))):(e=o==null?void 0:o.drawIds)!=null&&e.length&&i.push(...o.drawIds)}return{drawIds:i,detailsMap:n}}function G_({schedulingProfile:t,matchUps:e=[]}){let i={},n=({eventId:s,drawId:l,structureId:c,roundNumber:u})=>`${s}|${l}|${c}${u}`;t!=null&&t.length&&t.map(({venues:s})=>s.map(({rounds:l})=>l)).flat().forEach(s=>{s.sort((l,c)=>(l.sortOrder||0)-(c.sortOrder||0)).forEach(({eventId:l,drawId:c,structureId:u,roundNumber:d},p)=>{let h=n({eventId:l,drawId:c,structureId:u,roundNumber:d});i[h]=p})});let r=[],a={noScheduledDate:[]};for(let s of e){let l=s.schedule||{},c=l.scheduledDate&&Ci(l.scheduledDate)||l.scheduledTime&&Ci(l.scheduledTime)||"noScheduledDate";a[c]||(a[c]=[]),a[c].push(s)}let o=Object.keys(a).sort();for(let s of o){let l=a[s],c={noScheduledTime:[]};for(let d of l){let p=d.schedule||{},h=p.scheduledTime&&rr(p.scheduledTime)||"noScheduledTime";c[h]||(c[h]=[]),c[h].push(d)}let u=Object.keys(c).sort();for(let d of u){let p=c[d];p.sort((h,f)=>{let m=i[n(h)]||0,g=i[n(f)]||0;return m-g}),r.push(...p)}}return r}function Y8({courtPrefix:t="C|",minRowsCount:e,courtsData:i}){if(!Array.isArray(i))return{error:Me};let n=i==null?void 0:i.reduce((o,s)=>{let l=s.matchUps||[],c=Math.max(0,...l.map(u=>u.schedule.courtOrder||0));return c>o?c:o},1),r=e?Math.max(e,n):n,a=Ct(0,r).map(o=>({matchUps:Ct(0,i.length).map(s=>{let l=i[s],{courtId:c,venueId:u}=l;return{schedule:{courtOrder:o+1,venueId:u,courtId:c}}})}));return i.forEach((o,s)=>{var l;for(let c of o.matchUps){let u=(l=c.schedule)==null?void 0:l.courtOrder;u&&(a[u-1].matchUps[s]=c)}}),{courtPrefix:t,rows:a.map((o,s)=>Object.assign({rowId:`rowId-${s+1}`},...o.matchUps.map((l,c)=>({[`${t}${c}`]:l}))))}}function mF(t){let{participants:e,contextContent:i,participantMap:n}=t,{tournamentAppliedPolicies:r,scheduleVisibilityFilters:a,participantsProfile:o,afterRecoveryTimes:s,policyDefinitions:l,useParticipantMap:c,tournamentRecord:u,usePublishState:d,contextFilters:p,matchUpFilters:h,contextProfile:f,nextMatchUps:m,tournamentId:g,inContext:v,context:y,event:b}=t;if(!b)return{error:_n};let{eventId:I,eventName:T,endDate:w,eventType:S,category:D,gender:E}=b??{},C={...y,...qt({surfaceCategory:b.surfaceCategory??(u==null?void 0:u.surfaceCategory),indoorOutDoor:b.indoorOutdoor??(u==null?void 0:u.indoorOutdoor),tournamentId:g??(u==null?void 0:u.tournamentId),endDate:w??(u==null?void 0:u.endDate),eventName:T,eventType:S,category:D,eventId:I,gender:E})},P;!e&&u&&({participants:e,participantMap:n,groupInfo:P}=hw({participantsProfile:o,policyDefinitions:l,useParticipantMap:c,tournamentRecord:u,contextProfile:f,inContext:v})),f&&!i&&(i=dm({policyDefinitions:l,tournamentRecord:u,contextProfile:f,event:b}));let R=Xc({event:b});return{...(b.drawDefinitions??[]).reduce((N,M)=>{var A;let _=SU({context:C,tournamentAppliedPolicies:r,scheduleVisibilityFilters:a,tournamentParticipants:e,participantsProfile:o,afterRecoveryTimes:s,policyDefinitions:l,tournamentRecord:u,usePublishState:d,contextContent:i,contextFilters:p,matchUpFilters:h,participantMap:n,publishStatus:R,contextProfile:f,drawDefinition:M,nextMatchUps:m,inContext:v,event:b});return(A=Object.keys(_))==null||A.forEach(x=>{Array.isArray(_[x])&&(N[x]||(N[x]=[]),N[x]=N[x].concat(_[x]))}),N},{}),...ue,groupInfo:P}}function gF(t){if(!(t!=null&&t.tournamentRecord))return{error:it};let e=t.contextContent,{scheduleVisibilityFilters:i,participantsProfile:n,afterRecoveryTimes:r,policyDefinitions:a,useParticipantMap:o,tournamentRecord:s,inContext:l=!0,usePublishState:c,contextFilters:u,matchUpFilters:d,contextProfile:p,nextMatchUps:h,context:f}=t,m=t.tournamentId??s.tournamentId,g=(s==null?void 0:s.events)??[],{participants:v,participantMap:y,groupInfo:b}=hw({participantsProfile:n,policyDefinitions:a,useParticipantMap:o,tournamentRecord:s,contextProfile:p,inContext:l});p&&!e&&(e=dm({policyDefinitions:a,tournamentRecord:s,contextProfile:p}));let{appliedPolicies:I}=Mn({tournamentRecord:s}),T=(u==null?void 0:u.eventIds)??[];return{...g.filter(w=>!T.includes(w.eventId)).map(w=>{var S,D,E;let C={eventDrawsCount:((D=(S=Xr({event:w}).flightProfile)==null?void 0:S.flights)==null?void 0:D.length)||((E=w.drawDefinitions)==null?void 0:E.length)||0,...f};return mF({context:C,tournamentAppliedPolicies:I,scheduleVisibilityFilters:i,participantsProfile:n,afterRecoveryTimes:r,policyDefinitions:a,tournamentRecord:s,usePublishState:c,contextFilters:u,contextProfile:p,contextContent:e,matchUpFilters:d,participantMap:y,participants:v,tournamentId:m,nextMatchUps:h,inContext:l,event:w})}).reduce((w,S)=>{var D;return(D=S&&Object.keys(S).filter(E=>!["success","matchUpsMap"].includes(E)))==null||D.forEach(E=>{Array.isArray(S[E])&&(w[E]||(w[E]=[]),w[E]=w[E].concat(S[E]),w.matchUpsCount+=S[E].length)}),w},{matchUpsCount:0}),groupInfo:b}}function PE({scheduleVisibilityFilters:t,participantsProfile:e,tournamentRecords:i,policyDefinitions:n,usePublishState:r,matchUpFilters:a,contextFilters:o,nextMatchUps:s,inContext:l}){if(typeof i!="object"||!Object.keys(i).length)return{error:_r};let c=Object.keys(i).map(d=>{let p=i[d];return gF({scheduleVisibilityFilters:t,participantsProfile:e,policyDefinitions:n,tournamentRecord:p,usePublishState:r,matchUpFilters:a,contextFilters:o,nextMatchUps:s,inContext:l})}),u={};return{...c.reduce((d,p)=>(Object.keys(p).forEach(h=>{Array.isArray(p[h])&&(d[h]||(d[h]=[]),d[h]=d[h].concat(p[h])),h==="groupInfo"&&Object.assign(u,p[h])}),d),{}),groupInfo:u}}function FR(t){var e,i,n,r,a,o,s,l;if(typeof(t==null?void 0:t.tournamentRecords)!="object"||!Object.keys(t==null?void 0:t.tournamentRecords).length)return{error:_r};let{courts:c,venues:u}=fm(t),d=mm(t).schedulingProfile,{sortDateMatchUps:p=!0,courtCompletedMatchUps:h,alwaysReturnCompleted:f,activeTournamentId:m,tournamentRecords:g,withCourtGridRows:v,minCourtGridRows:y,usePublishState:b,status:I=Wu,sortCourtsData:T}=t,w=b?(i=(e=dR({tournamentRecord:g[m??rw()],itemType:`${By}.${$y}`}).timeItem)==null?void 0:e.itemValue)==null?void 0:i[I]:void 0,S=f?PE({...t,matchUpFilters:{...t.matchUpFilters,matchUpStatuses:[ia]},contextFilters:t.contextFilters}).completedMatchUps:[];if(b&&(!w||!Object.keys(w).length))return{completedMatchUps:S,dateMatchUps:[],courtsData:[],venues:u};let D,E;b&&({drawIds:D,detailsMap:E}=g5e({tournamentRecords:g})),D!=null&&D.length&&(t.contextFilters||(t.contextFilters={}),(n=t.contextFilters)!=null&&n.drawIds?t.contextFilters.drawIds=t.contextFilters.drawIds.filter(B=>D.includes(B)):t.contextFilters.drawIds=D),(r=w==null?void 0:w.eventIds)!=null&&r.length&&(t.matchUpFilters||(t.matchUpFilters={}),(a=t.matchUpFilters)!=null&&a.eventIds&&t.matchUpFilters.eventIds.length?t.matchUpFilters.eventIds=t.matchUpFilters.eventIds.filter(B=>w.eventIds.includes(B)):t.matchUpFilters.eventIds=w.eventIds),(o=w==null?void 0:w.scheduledDates)!=null&&o.length&&(t.matchUpFilters||(t.matchUpFilters={}),t.matchUpFilters.scheduledDates&&t.matchUpFilters.scheduledDates.length?t.matchUpFilters.scheduledDates=t.matchUpFilters.scheduledDates.filter(B=>w.scheduledDates.includes(B)):t.matchUpFilters.scheduledDates=w.scheduledDates),f&&(t.matchUpFilters||(t.matchUpFilters={}),(l=(s=t.matchUpFilters)==null?void 0:s.excludeMatchUpStatuses)!=null&&l.length?t.matchUpFilters.excludeMatchUpStatuses.includes(ia)||t.matchUpFilters.excludeMatchUpStatuses.push(ia):t.matchUpFilters.excludeMatchUpStatuses=[ia]);let{completedMatchUps:C,upcomingMatchUps:P,pendingMatchUps:R,groupInfo:N}=PE({...t,matchUpFilters:t.matchUpFilters,contextFilters:t.contextFilters}),M=[...P??[],...R??[]];E&&Object.keys(E).length&&(M=M.filter(B=>{let{drawId:F,structureId:G,stage:H}=B;if(!E[F])return!1;if(E[F].stageDetails){let $=Object.keys(E[F].stageDetails),q=$.filter(Z=>!E[F].stageDetails[Z].published),z=$.filter(Z=>E[F].stageDetails[Z].published);return q.length&&q.includes(H)?!1:z.length&&z.includes(H)?!0:q.length&&!q.includes(H)&&!z.length}if(E[F].structureDetails){let $=Object.keys(E[F].structureDetails),q=$.filter(Z=>!E[F].structureDetails[Z].published),z=$.filter(Z=>E[F].structureDetails[Z].published);return q.length&&q.includes(G)?!1:z.length&&z.includes(G)?!0:q.length&&!q.includes(G)&&!z.length}return!0}));let A=p?G_({matchUps:M,schedulingProfile:d}):M,_=c==null?void 0:c.map(B=>{let F=O(B);return{surfaceCategory:(B==null?void 0:B.surfaceCategory)??"",matchUps:F,...B}}),x={completedMatchUps:f?S:C,dateMatchUps:A,courtsData:_,groupInfo:N,venues:u};if(v){let{rows:B,courtPrefix:F}=Y8({minRowsCount:y,courtsData:_});x.courtPrefix=F,x.rows=B}return{...x,...ue};function O({courtId:B}){let F=(h?A.concat(C??[]):A).filter(G=>{var H,$,q;return((H=G.schedule)==null?void 0:H.courtId)===B||((q=($=G.schedule)==null?void 0:$.allocatedCourts)==null?void 0:q.map(({courtId:z})=>z).includes(B))});return T?G_({matchUps:F,schedulingProfile:d}):F}}function vF({tournamentRecords:t,tournamentId:e}){if(typeof t!="object"||!Object.keys(t).length)return{error:_r};let i=Object.keys(t).filter(r=>!e||r===e),n;return i.forEach(r=>{let a=t[r],{matchUpDailyLimits:o}=v5e({tournamentRecord:a});n=o}),{matchUpDailyLimits:n}}function v5e(t){var e;let i=mn(t,[{[Lh]:!0}]);if(i.error)return i;let{tournamentRecord:n}=t,{policy:r}=Fy({policyType:Fg,tournamentRecord:n}),{extension:a}=Bi({element:n,name:HP}),o=(e=a==null?void 0:a.value)==null?void 0:e.dailyLimits,s=r==null?void 0:r.defaultDailyLimits;return{matchUpDailyLimits:o||s}}function Z8(t){var e,i,n,r;let{matchUps:a}=t,{singlesForDoubles:o,tournamentRecord:s,drawDefinition:l,excludeMargin:c,exclusionRule:u,zoneDoubling:d,matchUpType:p,scaleName:h,eventId:f,zonePct:m,drawId:g,event:v}=t;if(!s&&!a)return{error:it};if(p&&![Mr,Zn].includes(p))return{error:Me,info:{matchUpType:p}};if(a&&!Zc(a))return{error:Me,context:{matchUps:a}};let y=ql[h],b=(y==null?void 0:y.ascending)??t.ascending??!1,I=(y==null?void 0:y.accessor)??t.valueAccessor,T=Array.isArray(y==null?void 0:y.range)?Math.abs(y.range[0]-y.range[1]):0,w=bi(m)&&T?(m??0/100)*T:t.zoneMargin??T,S={withScaleValues:!0,withCompetitiveness:!0},D={matchUpTypes:p?[p]:[Mr,Zn]},E=s==null?void 0:s.participants;(e=a==null?void 0:a[0])!=null&&e.hasContext?g?a=a.filter(O=>O.drawId===g):f&&(a=a.filter(O=>O.eventId===f)):a===void 0&&(a=g&&!l&&[]||!g&&f&&!v&&[]||g&&((i=Hs({inContext:!0,drawDefinition:l,contextFilters:D,contextProfile:S,participants:E}))==null?void 0:i.matchUps)||!g&&f&&((n=pm({inContext:!0,contextFilters:D,contextProfile:S,participants:E,event:v}))==null?void 0:n.matchUps)||((r=co({tournamentRecord:s,contextFilters:D,contextProfile:S}))==null?void 0:r.matchUps)||[]),p&&(a=a.filter(O=>O.matchUpType===p));let C=a.filter(({winningSide:O,score:B,sides:F,matchUpStatus:G})=>![os,fn,Rn,fU,ec].includes(G??"")&&uo({score:B})&&(F==null?void 0:F.length)===2&&O),P=b5e({matchUps:C,excludeMargin:c,exclusionRule:u,valueAccessor:I,ascending:b,scaleName:h}),R=!d||Hr(Mr)(p)?w:(w||0)*2,N=w?C.map(({competitiveProfile:O,matchUpType:B,score:F,sides:G})=>{let H=uwe({singlesForDoubles:o,valueAccessor:I,matchUpType:B,scaleName:h,sides:G}),$=Math.abs(H[0].value-H[1].value);return{competitiveness:O==null?void 0:O.competitiveness,valuesGap:$,score:F}}).filter(({valuesGap:O})=>O<=R):[],M=y5e({zoneData:N}),A=M&&[].concat(Object.values(M)).flat().length,_=A&&Object.assign({},...Object.keys(M).map(O=>({[O]:Math.round(1e4*M[O].length/A)/100}))),x=C.length-((N==null?void 0:N.length)||0);return{...ue,relevantMatchUps:C,zoneDistribution:_,zoneData:N,accuracy:P,nonZone:x}}function y5e({zoneData:t}){let e={[d6]:[],[IE]:[],[wE]:[]};for(let i of t){let{competitiveness:n,score:r,valuesGap:a}=i;e[n]&&e[n].push({score:r,valuesGap:a})}return e}function uwe({singlesForDoubles:t,exclusionRule:e,valueAccessor:i,matchUpType:n,scaleName:r,sides:a}){let o=e==null?void 0:e.range.sort(),s=l=>{let c=l==null?void 0:l[e==null?void 0:e.valueAccessor];return{exclude:e&&c>=o[0]&&c<=o[1],exclusionValue:c}};return a.sort((l,c)=>l.sideNumber-c.sideNumber).map(({participant:l})=>{let c=[],u=l==null?void 0:l.individualParticipants;if(u!=null&&u.length){let d=[],p=0;for(let h of u){let{scaleValue:f,value:m}=vX({singlesForDoubles:t,valueAccessor:i,participant:h,matchUpType:n,scaleName:r}),{exclude:g,exclusionValue:v}=s(f);g&&c.push(v),d.push(f),m&&!isNaN(p)?p+=m:p=void 0}return{participantName:l.participantName,exclusionValues:c,scaleValues:d,value:p}}else if(l){let{scaleValue:d,value:p}=vX({singlesForDoubles:t,valueAccessor:i,matchUpType:n,participant:l,scaleName:r}),{exclude:h,exclusionValue:f}=s(d);return h&&c.push(f),{participantName:l.participantName,exclusionValues:c,scaleValue:d,value:p}}else return{}})}function vX({singlesForDoubles:t,valueAccessor:e,matchUpType:i,participant:n,scaleName:r}){var a,o,s,l,c;let u=t?Mr:i,d=(o=(a=n==null?void 0:n.rankings)==null?void 0:a[u])==null?void 0:o.find(f=>f.scaleName===r),p=(c=((l=(s=n==null?void 0:n.ratings)==null?void 0:s[u])==null?void 0:l.find(f=>f.scaleName===r))||d)==null?void 0:c.scaleValue,h=e?p==null?void 0:p[e]:p;return{scaleValue:p,value:h}}function b5e({excludeMargin:t,exclusionRule:e,valueAccessor:i,ascending:n,scaleName:r,matchUps:a}){let o={affirmative:[],negative:[],excluded:[]};for(let c of a){let{matchUpType:u,sides:d,score:p,winningSide:h}=c;if(!h)continue;if(e&&(!e.valueAccessor||!e.range))return{info:"exclusionRule requires valueAccessor and range",error:Ht};let f=h-1,m=uwe({exclusionRule:e,valueAccessor:i,matchUpType:u,scaleName:r,sides:d});if(e){let T=m.map(({exclusionValues:w})=>w).flat();if(T.length){o.excluded.push({scoreString:p==null?void 0:p.scoreStringSide1,exclusionValues:T,winningSide:h,sideValues:m});continue}}if(m.filter(T=>![void 0,"",null].includes(T.value)).length<2){o.excluded.push({scoreString:p==null?void 0:p.scoreStringSide1,missingValues:!0,winningSide:h,sideValues:m});continue}let g=m[f].value-m[1-f].value,v=parseFloat(t||0),y=v&&Math.abs(g)<v;if(y){o.excluded.push({scoreString:p==null?void 0:p.scoreStringSide1,excludeMargin:t,winningSide:h,excludeGap:y,sideValues:m,valuesGap:g});continue}let b=n?g:g*-1,I=h===1?p==null?void 0:p.scoreStringSide1:p==null?void 0:p.scoreStringSide2;b>0?o.affirmative.push({winningScoreString:I,winningSide:h,sideValues:m,valuesGap:g,score:p}):o.negative.push({winningScoreString:I,winningSide:h,sideValues:m,valuesGap:g,score:p})}let s=o.affirmative.length+o.negative.length,l=s&&o.affirmative.length/s*100;return o.percent=l?Math.round(100*l)/100:0,o}function Tw({collectionDefinitions:t=[],collectionGroups:e=[]}){let i=0,{groupValueNumbers:n}=Rye({collectionGroups:e}),r;for(let a of t||[]){let{collectionValueProfiles:o,collectionGroupNumber:s,collectionValue:l,matchUpCount:c,matchUpValue:u,scoreValue:d,setValue:p}=a,h=s&&n.includes(s);if(bi(p||d))r=!0;else{if(h)continue;if(typeof l=="number"&&bi(l))i+=l;else if(o!=null&&o.length)for(let f of o)i+=f.matchUpValue;else typeof u=="number"&&bi(u)&&(i+=(c??0)*u)}}for(let a of e)i+=a.groupValue??0;return r||!i?{aggregateValue:!0,...ue}:{valueGoal:Math.floor(i/2)+1,...ue}}function X8({matchUps:t,matchUpId:e}){if(!Zc(t))return{error:Me};let i=t.find(s=>s.matchUpId===e),{drawId:n,eventId:r,structureId:a,tournamentId:o}=i||{};return{matchUpId:e,drawId:n,eventId:r,structureId:a,tournamentId:o}}function BR(t,e){if(!sr(t))return{error:Me};if(!Array.isArray(e))return{error:Me};let i={};for(let{param:n,error:r,attr:a}of e){let o=I5e({params:t,param:n,attr:a,error:r});if(o!=null&&o.error)return o;i[n]=o}return i}function I5e({params:t,param:e,attr:i,error:n}){if(e===E5&&sr(t.drawDefinition)&&qs(t.structureId)){let r=(t.drawDefinition.structures??[]).find(({structureId:a})=>a===t.structureId);return!r.length&&n?{error:n}:{structure:r}}if(e===Og){let r=QIe({...t,...i});return r.error&&n?{...r,error:n}:r}return{error:Wo,info:{param:e}}}function J8(t){var e,i;let{structureId:n,matchUpId:r,event:a}=t,o=t.drawDefinition,s=mn(t,[{[Lh]:!0},{[C5]:{[T5]:!1,[_y]:!1,[Kme]:!1,[cU]:!1}}]);if(s[kb])return s;let l=(e=BR(t,[{[VP]:Og,[kb]:Ht}]))==null?void 0:e.matchUp;if(r&&l!=null&&l.error)return l;!o&&l!=null&&l.drawDefinition&&(o=l==null?void 0:l.drawDefinition);let c=l==null?void 0:l.structure;if(!c&&n&&!r){if(!o)return{error:Rd};let f=pi({drawDefinition:o,structureId:n});if(f.error)return f;c=f.structure}let u=c==null?void 0:c.matchUpFormat,d=o==null?void 0:o.matchUpFormat,p=a==null?void 0:a.matchUpFormat,h=((i=l==null?void 0:l.matchUp)==null?void 0:i.matchUpFormat)||u||d||p;return{structureDefaultMatchUpFormat:u,eventDefaultMatchUpFormat:p,drawDefaultMatchUpFormat:d,matchUpFormat:h}}function Q8({profileBands:t,tournamentRecord:e,matchUps:i}){if(!Zc(i))return{error:Oh};let n=!t&&Fy({policyType:uf,tournamentRecord:e}).policy,r=t||(n==null?void 0:n.profileBands)||p6[uf].profileBands,a=i.filter(({winningSide:p})=>p),o=a.map(Vge),s=(p,h)=>{let f=$ge(h,r);return p[f]+=1,p},l=jge(o).reduce((p,h)=>s(p,h),{[d6]:0,[IE]:0,[wE]:0,[Bge]:0}),c=Object.keys(l).reduce((p,h)=>(l[h]||0)+p,0),u=Object.keys(l).map(p=>{let h=parseFloat((l[p]/c).toFixed(4));return{[p]:h*100}}),d=a.filter(({matchUpStatus:p})=>p===LZ).length;return u.push({[LZ]:parseFloat((d/c).toFixed(4))*100}),{competitiveBands:Object.assign({},...u),...ue}}var{stageOrder:yX}=gHe;function w5e(t,e){return t.eventName.localeCompare(e.eventName)||t.eventId.localeCompare(e.eventId)||(yX[t==null?void 0:t.stage]||0)-(yX[e==null?void 0:e.stage]||0)||e.matchUpsCount-t.matchUpsCount||`${t.stageSequence}-${t.roundNumber}-${t.minFinishingSum}`.localeCompare(`${e.stageSequence}-${e.roundNumber}-${e.minFinishingSum}`)}function e7({excludeScheduleDateProfileRounds:t,excludeScheduledRounds:e,excludeCompletedRounds:i,inContextMatchUps:n,tournamentRecords:r,schedulingProfile:a,tournamentRecord:o,withSplitRounds:s,matchUpFilters:l,scheduleDate:c,withRoundId:u,venueId:d,context:p}){var h;if(n&&!Array.isArray(n||typeof n[0]!="object"))return{error:Me,inContextMatchUps:n};if(o&&!r){if(typeof o!="object")return{error:NP};r={[o.tournamentId]:o}}let f=typeof r!="object"||!Object.keys(r).length;if((d||c||!n||!a&&(t||i||a||s))&&f)return{error:_r};let m=Object.assign({},...Object.values(r??{}).map(({venues:S=[],tournamentId:D})=>({[D]:S==null?void 0:S.map(({venueId:E})=>E)}))),g=Object.values(r??{}).map(({events:S=[],tournamentId:D,startDate:E,endDate:C})=>S.map(P=>({...P,validVenueIds:m[D],startDate:P.startDate??E,endDate:P.endDate??C}))).flat(),{segmentedRounds:v,profileRounds:y}=r&&(t||i||a||s)&&pF({tournamentRecords:r,schedulingProfile:a})||{},b=t&&Object.assign({},...y.map(S=>({[S.id]:S}))),I=n||r&&((h=Ud({tournamentRecords:r,matchUpFilters:l}))==null?void 0:h.matchUps)||[],T=[],w=I&&Object.values(I.reduce((S,D)=>{var E;let C=kj(D).id,P=v==null?void 0:v[C],R=[...((E=S[C])==null?void 0:E.matchUps)??[],D],{containerStructureId:N,stageSequence:M,structureName:A,tournamentId:_,isRoundRobin:x,matchUpType:O,roundNumber:B,roundOffset:F,structureId:G,eventName:H,roundName:$,drawName:q,eventId:z,drawId:Z}=D,Y=x?N:G;return{...S,[C]:{id:u?C:void 0,structureId:Y,stageSequence:M,segmentsCount:P,structureName:A,tournamentId:_,matchUpType:O,roundNumber:B,roundOffset:F,eventName:H,roundName:$,drawName:q,matchUps:R,eventId:z,drawId:Z}}},{})).map(S=>{let{minFinishingSum:D,winnerFinishingPositionRange:E}=f5e(S.matchUps),C=S.segmentsCount;if(C){let O=S.matchUps.length/C;return so(S.matchUps.sort((B,F)=>B.roundPosition-F.roundPosition),O).map((B,F)=>{let{unscheduledCount:G,incompleteCount:H,matchUpsCount:$,isScheduled:q,isComplete:z,byeCount:Z}=gX(B),Y=mX({matchUps:S.matchUps,tournamentRecords:r,events:g,round:S});return qt({...S,...p,roundSegment:{segmentsCount:C,segmentNumber:F+1},winnerFinishingPositionRange:E,unscheduledCount:G,incompleteCount:H,minFinishingSum:D,matchUpsCount:$,isScheduled:q,roundTiming:Y,isComplete:z,byeCount:Z,matchUps:B})})}let{unscheduledCount:P,incompleteCount:R,matchUpsCount:N,isScheduled:M,isComplete:A,byeCount:_}=gX(S.matchUps),x=mX({matchUps:S.matchUps,tournamentRecords:r,events:g,round:S});return qt({...S,...p,winnerFinishingPositionRange:E,unscheduledCount:P,incompleteCount:R,minFinishingSum:D,matchUpsCount:N,isScheduled:M,roundTiming:x,isComplete:A,byeCount:_})}).flat().filter(S=>{if(t){let F=Ci(t),G=u?S.id:kj(S).id;if(F&&b[G]&&Ci(b[G].scheduleDate)===F)return!1}let{isComplete:D,isScheduled:E}=S,C=!i||!D,P=!e||!E,R=d||c?g==null?void 0:g.find(({eventId:F})=>F===S.eventId):void 0,N=(R==null?void 0:R.startDate)??(o==null?void 0:o.startDate),M=(R==null?void 0:R.endDate)??(o==null?void 0:o.endDate),A=!c||!N||new Date(c)>=new Date(N),_=!c||!M||new Date(c)<=new Date(M),x=A&&_,O=!d||(R==null?void 0:R.validVenueIds.includes(d)),B=C&&P&&O&&x;return B||T.push(S),B}).sort(w5e)||[];return{...ue,rounds:w,excludedRounds:T}}function RE(t){var e;let{matchUp:i,sideNumber:n,setNumber:r,isTiebreakValue:a,isPointValue:o}=t||{},{matchUpFormat:s}=t||{};if(!i)return{error:cl};s=s||(i==null?void 0:i.matchUpFormat);let l=Zs(s),c=!!(i!=null&&i.winningSide),u=(e=i.score)==null?void 0:e.sets,d=u==null?void 0:u.length,p=r&&r-1,h=!!(u!=null&&u.find((z,Z)=>z.setNumber===r&&Z===p)),f=(u==null?void 0:u.filter(z=>z==null?void 0:z.winningSide))||[],m=(f==null?void 0:f.length)||0,g=r&&(u==null?void 0:u.slice(r))||[],v=!!(d&&r&&g!=null&&g.reduce((z,Z)=>(!Z||!Z.side1Score&&!Z.side2Score&&!Z.side1TiebreakScore&&!Z.side2TiebreakScore&&!Z.side1PointScore&&!Z.side2PointScore)&&z,!0)),y=r<=d&&u.find(z=>z.setNumber===r),b=y&&CE({setObject:y,matchUpScoringFormat:l}),{isCompletedSet:I,sideGameScores:T,sideTiebreakScores:w}=b||{},S=!!(y&&!I&&v||r&&r===d+1&&!c),D=[1,2].includes(n),E=D?n-1:0,C=y&&D&&(!a&&!o&&T[E]!==void 0&&T[E]||a&&w[E]!==void 0&&w[E]),P=!!C,R=f==null?void 0:f.map(z=>CE({setObject:z,matchUpScoringFormat:l}).isValidSetOutcome).reduce((z,Z)=>z&&Z,!0),N=f.reduce((z,Z)=>{let{winningSide:Y}=Z,Q=Y-1;return z[Q]++,z},[0,0]),M=i==null?void 0:i.winningSide,A=M&&M-1,_=1-A,x=N[A],O=N[_],B=Math.max(...N),F=xl(N)[B],{bestOf:G}=l??{},H=G&&Math.ceil(G/2)||1,$=B===H&&F===1&&N.indexOf(B)+1||void 0,q=x>O&&M===$;return{completedSetsHaveValidOutcomes:R,validMatchUpWinningSide:q,calculatedWinningSide:$,matchUpScoringFormat:l,validMatchUpOutcome:$&&R&&q,isLastSetWithValues:v,completedSetsCount:m,isCompletedMatchUp:c,isValidSideNumber:D,hasExistingValue:P,existingValue:C,isExistingSet:h,isActiveSet:S,...b}}function t7({participants:t,tournamentAppliedPolicies:e,scheduleVisibilityFilters:i,participantsProfile:n,afterRecoveryTimes:r,policyDefinitions:a,useParticipantMap:o,tournamentRecord:s,usePublishState:l,contextFilters:c,contextContent:u,matchUpFilters:d,participantMap:p,publishStatus:h,contextProfile:f,drawDefinition:m,nextMatchUps:g,tournamentId:v,inContext:y,context:b,event:I}){let{eventId:T,eventName:w,endDate:S,eventType:D,category:E,gender:C}=I??{},P={...b,...qt({surfaceCategory:(I==null?void 0:I.surfaceCategory)??(s==null?void 0:s.surfaceCategory),indoorOutDoor:(I==null?void 0:I.indoorOutdoor)??(s==null?void 0:s.indoorOutdoor),endDate:S??(I==null?void 0:I.endDate)??(s==null?void 0:s.endDate),tournamentId:v??(s==null?void 0:s.tournamentId),eventName:w,eventType:D,category:E,eventId:T,gender:C})},R;return!(t!=null&&t.length)&&s&&({participants:t,participantMap:p,groupInfo:R}=hw({participantsProfile:n,policyDefinitions:a,useParticipantMap:o,tournamentRecord:s,contextProfile:f,inContext:y})),I&&f&&!u&&(u=dm({policyDefinitions:a,tournamentRecord:s,contextProfile:f,drawDefinition:m,event:I})),{...SU({context:P,tournamentAppliedPolicies:e,scheduleVisibilityFilters:i,tournamentParticipants:t,participantsProfile:n,afterRecoveryTimes:r,policyDefinitions:a,tournamentRecord:s,usePublishState:l,participantMap:p,contextContent:u,contextFilters:c,matchUpFilters:d,publishStatus:h,contextProfile:f,drawDefinition:m,nextMatchUps:g,inContext:y,event:I}),groupInfo:R}}var dwe={};zi(dwe,{getCompetitionVenues:()=>kR,getCourts:()=>i7,getVenuesAndCourts:()=>fm,publicFindVenue:()=>v6});function i7({tournamentRecord:t,venueId:e,venueIds:i}){return t?{courts:(t.venues||[]).filter(n=>e?n.venueId===e:i?i.includes(n.venueId):!0).map(n=>{let{venueId:r}=n,a=$t(n.courts||[]);return a.forEach(o=>Object.assign(o,{venueId:r})),a}).flat()}:{error:it}}var pwe={};zi(pwe,{categoryCanContain:()=>GL,getCategoryAgeDetails:()=>CR,getEvent:()=>a7,getEventProperties:()=>n7,getEventStructures:()=>LL,getEventTimeItem:()=>uR,getEvents:()=>r7,getFlightProfile:()=>Xr,getScaledEntries:()=>ww});function n7({tournamentRecord:t,event:e}){var i,n;if(!t)return{error:it};if(!e)return{error:_n};let r=e.entries||[],a=t.participants||[],o=((i=e.category)==null?void 0:i.categoryName)||((n=e.category)==null?void 0:n.ageCategoryCode),{eventType:s}=e,l=r.map(h=>h.participantId),c=a.filter(h=>l.includes(h.participantId)),u,d,p;return{entryScaleAttributes:c.map(h=>{var f,m,g,v,y,b;let{participantId:I,participantName:T,name:w}=h,S={scaleType:m6,eventType:s,scaleName:o},D=(m=(f=sh({participant:h,scaleAttributes:S}))==null?void 0:f.scaleItem)==null?void 0:m.scaleValue;S={scaleType:Jge,eventType:s,scaleName:o};let E=(v=(g=sh({participant:h,scaleAttributes:S}))==null?void 0:g.scaleItem)==null?void 0:v.scaleValue;S={scaleType:Xge,eventType:s,scaleName:o};let C=(b=(y=sh({participant:h,scaleAttributes:S}))==null?void 0:y.scaleItem)==null?void 0:b.scaleValue;return u=!!(u||D),d=!!(d||E),p=!!(p||C),{participantId:I,participantName:T||w,seed:D,ranking:E,rating:C}}),hasSeededParticipants:u,hasRankedParticipants:d,hasRatedParticipants:p}}function r7({tournamentRecord:t,withScaleValues:e,scaleEventType:i,inContext:n,eventIds:r,drawIds:a,context:o}){var s,l,c,u;if(!t)return{error:it};let{tournamentId:d}=t,p=(t.events??[]).filter(({eventId:f})=>!r||Array.isArray(r)&&r.includes(f)).map(f=>{var m;let g=(m=f.drawDefinitions)==null?void 0:m.map(fE);if(a!=null&&a.length&&!Wr(a,g).length)return;let v=$t(f);return n&&Object.assign(v,{tournamentId:d}),o&&Object.assign(v,o),v}).filter(Boolean),h={};if(e){let f=Yr({withScaleValues:!0,tournamentRecord:t}).participantMap,m=g=>g.reduce((v,y)=>v+parseFloat(y),0);for(let g of p){let v=i??g.eventType,y=g.eventId;h[y]||(h[y]={ratingsStats:{},ratings:{},ranking:{},draws:{}});let b=(g.entries??[]).filter(({entryStatus:C})=>qu.includes(C)).map(Wi),I=C=>{var P,R,N,M,A,_;if((P=C==null?void 0:C.ratings)!=null&&P[v])for(let x of((R=C==null?void 0:C.ratings)==null?void 0:R[v])??[]){let O=x.scaleName;h[y].ratings[O]||(h[y].ratings[O]=[]);let B=(N=ql[O])==null?void 0:N.accessor;if(B){let F=parseFloat((M=x.scaleValue)==null?void 0:M[B]);F&&h[y].ratings[O].push(F)}}if((A=C==null?void 0:C.rankings)!=null&&A[v])for(let x of((_=C==null?void 0:C.rankings)==null?void 0:_[v])??[]){let O=x.scaleName;h[y].ranking[O]||(h[y].ranking[O]=[]),x.scaleValue&&h[y].ranking[O].push(x.scaleValue)}};for(let C of b){let P=(s=f==null?void 0:f[C])==null?void 0:s.participant;if((P==null?void 0:P.participantType)!==Ki)for(let R of(P==null?void 0:P.individualParticipantIds)??[]){let N=(l=f==null?void 0:f[R])==null?void 0:l.participant;I(N)}else I(P)}let T=h[y].ratings;for(let C of Object.keys(T)){let P=T[C];if(!P.length)continue;let R=(c=_Z(P))==null?void 0:c.toFixed(2);h[y].ratingsStats[C]={avg:parseFloat((m(P)/P.length).toFixed(2)),median:R?parseFloat(R):void 0,max:Math.max(...P),min:Math.min(...P)}}let w=(C,P)=>{var R,N;let M=A=>{var _,x,O,B,F,G,H,$,q,z;if((_=h[y].draws)!=null&&_[C]&&(x=A==null?void 0:A.ratings)!=null&&x[v])for(let Z of((O=A==null?void 0:A.ratings)==null?void 0:O[v])??[]){let Y=Z.scaleName;(B=h[y].draws[C])!=null&&B.ratings[Y]||(h[y].draws[C].ratings[Y]=[]);let Q=(F=ql[Y])==null?void 0:F.accessor;if(Q){let X=parseFloat((G=Z.scaleValue)==null?void 0:G[Q]);X&&h[y].draws[C].ratings[Y].push(X)}}if((H=h[y].draws)!=null&&H[C]&&($=A==null?void 0:A.rankings)!=null&&$[v])for(let Z of((q=A==null?void 0:A.rankings)==null?void 0:q[v])??[]){let Y=Z.scaleName;(z=h[y].draws[C])!=null&&z.ranking[Y]||(h[y].draws[C].ranking[Y]=[]);let Q=Z.scaleValue;Q&&h[y].draws[C].ranking[Y].push(Q)}};for(let A of P.filter(Boolean)){let _=(R=f==null?void 0:f[A])==null?void 0:R.participant;if((_==null?void 0:_.participantType)!==Ki)for(let x of(_==null?void 0:_.individualParticipantIds)??[]){let O=(N=f==null?void 0:f[x])==null?void 0:N.participant;M(O)}else M(_)}},S=[],D=C=>(a==null?void 0:a.length)&&a.includes(C)||S.includes(C);for(let C of g.drawDefinitions??[]){let P=C.drawId;if(D(P))continue;let R=Gy({drawDefinition:C}).assignedParticipantIds??[];h[y].draws[P]||(h[y].draws[P]={ratingsStats:{},ratings:{},ranking:{}}),S.push(P),w(P,R)}let E=Xr({event:g}).flightProfile;for(let C of(E==null?void 0:E.flights)??[]){let P=C.drawId;if(D(P))continue;let R=C.drawEntries.map(Wi);w(P,R)}for(let C of S){let P=h[y].draws[C].ratings;for(let R of Object.keys(P)){let N=P[R];if(!N.length)continue;let M=(u=_Z(N))==null?void 0:u.toFixed(2);h[y].draws[C].ratingsStats[R]={avg:parseFloat((m(N)/N.length).toFixed(2)),median:M?parseFloat(M):void 0,max:Math.max(...N),min:Math.min(...N)}}}}}return qt({eventScaleValues:h,events:p,...ue})}function a7({tournamentRecord:t,drawDefinition:e,context:i,event:n}){var r;if(!t)return{error:it};if(!n)return{error:_n};let a=$t(n);i&&Object.assign(a,i);let o=e&&((r=a.drawDefinitions)==null?void 0:r.find(({drawId:s})=>e.drawId===s));return qt({drawDefinition:o,event:a})}function S5e(t){var e,i;let n="validateAndDeriveDrawValues",{appliedPolicies:r,policyDefinitions:a}=D5e(t),o=E5e({...t,policyDefinitions:a,appliedPolicies:r}),s=U5e(t),l=C5e({...t,consideredEntries:s,appliedPolicies:r});if(l!=null&&l.error)return fe({result:l,stack:n});let c=P5e({...t,consideredEntries:s}),u=T5e({...t,appliedPolicies:r,policyDefinitions:a,drawSize:c});if(u.error)return fe({result:u,stack:n});let d=u.drawType;if(isNaN(c)&&d!==_u)return fe({result:{error:_P},stack:n});let p=(a==null?void 0:a[du])??(r==null?void 0:r[du]),h=t.seedingProfile??((i=(e=p==null?void 0:p.seedingProfile)==null?void 0:e.drawTypes)==null?void 0:i[d??""])??(p==null?void 0:p.seedingProfile);t.seedingProfile&&(a[du]||(a[du]={..._j[du]}),a[du].seedingProfile=h);let f=R5e({...t,drawType:d});return f!=null&&f.error?fe({result:f,stack:n}):{drawSize:c,drawType:d,enforceGender:o,seedingProfile:h,appliedPolicies:r,policyDefinitions:a}}function T5e(t){let{policyDefinitions:e,appliedPolicies:i,enforceMinimumDrawSize:n=!0,drawSize:r}=t,a=t.drawTypeCoercion??AR({drawType:t.drawType,policyDefinitions:e,appliedPolicies:i}),o=rbe({drawType:t.drawType,enforceMinimumDrawSize:n,drawTypeCoercion:a,drawSize:r});return o.error?o:{drawType:o.drawType}}function hwe(t){return t==null?void 0:t.filter(e=>e.entryStatus&&[...qu,nR].includes(e.entryStatus))}function U5e({considerEventEntries:t=!0,drawEntries:e,eventEntries:i,qualifyingOnly:n}){return(n&&[]||hwe(e)||(t?i:[])).filter(({entryStage:r})=>!r||r===Ft)}function D5e(t){let{tournamentRecord:e,event:i}=t,n=Mn({tournamentRecord:e,event:i}).appliedPolicies??{},r=$t(t.policyDefinitions??{},!1,!0);return{appliedPolicies:n,policyDefinitions:r}}function E5e({enforceGender:t,policyDefinitions:e,appliedPolicies:i}){var n,r,a,o;return t??((r=(n=e==null?void 0:e[eo])==null?void 0:n.participants)==null?void 0:r.enforceGender)??((o=(a=i==null?void 0:i[eo])==null?void 0:a.participants)==null?void 0:o.enforceGender)}function C5e(t){let{consideredEntries:e,appliedPolicies:i,policyDefinitions:n,enforceGender:r,participantMap:a,participants:o,event:s}=t;return s&&o&&ZL({consideredEntries:e,policyDefinitions:n,appliedPolicies:i,participantMap:a,enforceGender:r,participants:o,event:s})}function P5e(t){return!t.drawSize&&t.consideredEntries.length&&![_u,qP,mU,ku,Ph].includes(t.drawType??"")&&lU(t.consideredEntries.length)||t.drawSize&&ai(t.drawSize)||!1}function R5e(t){var e,i;let{tournamentRecord:n,event:r,ignoreAllowedDrawTypes:a,drawType:o}=t,s=!a&&n&&aF({tournamentRecord:n,categoryType:(e=r==null?void 0:r.category)==null?void 0:e.categoryType,categoryName:(i=r==null?void 0:r.category)==null?void 0:i.categoryName});return s!=null&&s.length&&!s.includes(o)?{error:G4}:{...ue}}function yF(t){let{voluntaryConsolation:e,tournamentRecord:i,event:n}=t,r="generateDrawDefinition",{participants:a,participantMap:o}=Yr({withIndividualParticipants:!0,convertExtensions:!0,internalUse:!0,tournamentRecord:i}),s=hwe(n==null?void 0:n.entries)??[],l=S5e({...t,participantMap:o,participants:a,eventEntries:s});if(l.error)return fe({result:l,stack:r});let{appliedPolicies:c,policyDefinitions:u,drawSize:d,drawType:p,enforceGender:h,seedingProfile:f}=l,m=n==null?void 0:n.eventType,g=t.matchUpType??m,v=N4e({...t,enforceGender:h,eventType:m,matchUpType:g});if(v.error)return fe({result:v,stack:r});let{matchUpFormat:y,tieFormat:b}=v;if(t.drawId&&typeof t.drawId!="string")return fe({result:{error:Me},stack:r});let I=a5e({...t,isMock:t.isMock??!0,policyDefinitions:u,tournamentRecord:i,appliedPolicies:c,matchUpFormat:y,seedingProfile:f,participants:a,eventEntries:s,matchUpType:g,tieFormat:b,drawSize:d,drawType:p,event:n});if(I.error)return fe({result:I,stack:r});let{existingDrawDefinition:T,positioningReports:w,drawDefinition:S,structureId:D,conflicts:E,entries:C}=I;if(!S)return fe({result:{error:Me},stack:r});let P=o5e({...t,existingDrawDefinition:T,positioningReports:w,appliedPolicies:c,drawDefinition:S,seedingProfile:f,participants:a,structureId:D,entries:C,params:t,stack:r});if(P.error)return P;let{qualifyingConflicts:R}=P;return S.drawName=t.drawName??(p&&Co(p)),d&&typeof e=="object"&&d>=4&&A6({...e,drawDefinition:S,matchUpType:g}),{existingDrawDefinition:!!T,qualifyingConflicts:R,positioningReports:w,drawDefinition:S,structureId:D,...ue,conflicts:E}}function fwe({scaleAttributes:t,scaledEntries:e,stageEntries:i,seedsCount:n,scaleName:r}){if(!t)return{error:Ht,info:"missing scaleAttributes"};let a=Object.assign({},...(e||[]).slice(0,n).map(({participantId:s},l)=>({[s]:l+1})));r=r||t.scaleName;let o=new Date().toISOString();return{scaleItemsWithParticipantIds:i.map(({participantId:s})=>({scaleItems:[{scaleValue:a[s],eventType:t.eventType,scaleType:ah,scaleName:r,scaleDate:o}],participantId:s}))}}function M5e({tournamentRecord:t,drawDefinition:e,policyDefinitions:i,scaleAttributes:n,scaleName:r,drawSize:a,drawId:o,event:s,stage:l,sortDescending:c,scaleSortMethod:u}){let d=hF({policyDefinitions:i,drawDefinition:e,drawSize:a,drawId:o,event:s,stage:l});if(d.error)return d;let{entries:p,seedsCount:h,stageEntries:f}=d;if(!f||!h)return{error:Me};let m=ww({tournamentRecord:t,scaleAttributes:n,scaleSortMethod:u,sortDescending:c,entries:p,stage:l}).scaledEntries??[],{scaleItemsWithParticipantIds:g}=fwe({scaleAttributes:n,scaledEntries:m,stageEntries:f,seedsCount:h,scaleName:r});return{scaleItemsWithParticipantIds:g}}var mwe={};zi(mwe,{addDrawEntries:()=>C6,addEventEntries:()=>lh,addEventEntryPairs:()=>Iwe,destroyPairEntries:()=>kve,destroyPairEntry:()=>N6,getEntriesAndSeedsCount:()=>hF,getMaxEntryPosition:()=>H8,modifyEntriesStatus:()=>M_,modifyEventEntries:()=>wwe,mutate:()=>gwe,promoteAlternate:()=>ywe,promoteAlternates:()=>s7,query:()=>owe,removeDrawEntries:()=>bwe,removeEventEntries:()=>gR,setEntryPosition:()=>o7,setEntryPositions:()=>vwe});var gwe={};zi(gwe,{addDrawEntries:()=>C6,addEventEntries:()=>lh,addEventEntryPairs:()=>Iwe,destroyPairEntries:()=>kve,destroyPairEntry:()=>N6,modifyEntriesStatus:()=>M_,modifyEventEntries:()=>wwe,promoteAlternate:()=>ywe,promoteAlternates:()=>s7,removeDrawEntries:()=>bwe,removeEventEntries:()=>gR,setEntryPosition:()=>o7,setEntryPositions:()=>vwe});function o7({tournamentRecord:t,drawDefinition:e,participantId:i,entryPosition:n,skipRefresh:r,event:a}){let o="setEntryPositions";if(!t)return{error:it};if(!i)return fe({result:{error:Ra},stack:o});if(n!==void 0&&!Number.isSafeInteger(n))return{error:Me,entryPosition:n};((a==null?void 0:a.entries)||[]).forEach(l=>{l.participantId===i&&(l.entryPosition=n)}),((e==null?void 0:e.entries)||[]).forEach(l=>{l.participantId===i&&(l.entryPosition=n)});let s=l=>{l.entries.forEach(c=>{c.entryPosition===n&&c.participantId!==i&&(c.entryPosition+=.1)})};return r||(a!=null&&a.entries&&(s(a),a.entries=gd({entries:a.entries})),e!=null&&e.entries&&(s(e),e.entries=gd({entries:e.entries}))),{...ue}}function vwe({tournamentRecord:t,entryPositions:e,drawDefinition:i,event:n}){if(!t)return{error:it};if(!Array.isArray(e))return{error:Me};for(let r of e){let{participantId:a,entryPosition:o}=r,s=o7({skipRefresh:!0,tournamentRecord:t,drawDefinition:i,participantId:a,entryPosition:o,event:n});if(s.error)return s}return n!=null&&n.entries&&(n.entries=gd({entries:n.entries})),i!=null&&i.entries&&(i.entries=gd({entries:i.entries})),{...ue}}function ywe(t){let{participantId:e}=t;return e&&typeof e!="string"?{error:Me,participantId:e}:s7({...t,participantIds:[e].filter(Boolean)})}function s7({tournamentRecord:t,drawDefinition:e,participantIds:i,stageSequence:n,stage:r=Ft,eventId:a,event:o}){if(!t)return{error:it};if(!Array.isArray(i))return{error:Me,participantIds:i};if(!o)return{error:_n};let s="promoteAlternates";if(o){let l=bX({element:o,participantIds:i,stageSequence:n,stage:r});if(l.error)return l}if(e){let l=bX({element:e,participantIds:i,stageSequence:n,stage:r});if(l.error)return a?fe({context:{drawPromotionError:l.error,drawId:e.drawId},result:{...ue},stack:s}):l}return{...ue}}function bX({participantIds:t,stageSequence:e,element:i,stage:n}){let r=(i.entries||[]).filter(d=>d.entryStatus===Su),a=(i.entries||[]).filter(d=>t.includes(d.participantId)),o=r.reduce((d,p)=>{let{entryPosition:h}=p;return isNaN(h)&&d||(!d||h<d.entryPosition)&&p||d},void 0),s=a.length?a:[o].filter(Boolean);if(!(s!=null&&s.length))return{error:tme};let l=s.filter(({entryStatus:d})=>d!==Su);if(l.length)return{error:KV,invalidEntryStatus:l};let c=s.filter(({entryStage:d})=>d&&d!==n);if(c.length)return{error:Lje,invalidStage:c};let u=e&&s.filter(d=>d.stageSequence!==e);if(u!=null&&u.length)return{error:Fje,invalidStageSequence:u};for(let d of s){d.entryStatus=tc;let p=d==null?void 0:d.entryPosition;isNaN(p)||i.entries.forEach(f=>{f.entryStatus===Su&&f.entryPosition>p&&(f.entryPosition=f.entryPosition-1)});let h=Math.max(...i.entries.filter(f=>f.entryStatus===tc&&!isNaN(f.entryPosition)).map(({entryPosition:f})=>ai(f||0)),0);d.entryPosition=h||0}return{...ue}}function bwe({autoEntryPositions:t=!0,participantIds:e,drawDefinition:i,drawId:n,stages:r,event:a}){var o;if(!a)return{error:_n};if(!n)return{error:Rd};if(!(e!=null&&e.length))return{error:kg};let s=Gy({drawDefinition:i,stages:r}).assignedParticipantIds??[];if(Ps(s,e))return{error:aU};let l=d=>{let p=d.participantId;return!e.includes(p)},{flightProfile:c}=Xr({event:a}),u=(o=c==null?void 0:c.flights)==null?void 0:o.find(d=>d.drawId===n);return u!=null&&u.drawEntries&&(u.drawEntries=u.drawEntries.filter(l),t&&(u.drawEntries=gd({entries:u.drawEntries}))),i!=null&&i.entries&&(i.entries=i.entries.filter(l),t&&(i.entries=gd({entries:i.entries}))),{...ue}}function Up(t){var e,i,n,r,a;let o="addParticipant",{allowDuplicateParticipantIdPairs:s,returnParticipant:l,disableNotice:c,pairOverride:u,participant:d}=t,p=t.tournamentId?(e=t.tournamentRecords)==null?void 0:e[t.tournamentId]:t.tournamentRecord??(t.activeTournamentId&&((i=t.tournamentRecords)==null?void 0:i[t.activeTournamentId]));if(!p)return{error:it};if(!d)return fe({result:{error:nw},stack:o});d.participantId||(d.participantId=xn()),p.participants||(p.participants=[]);let{participantId:h,individualParticipantIds:f}=d;if(p.participants.reduce((I,T)=>T.participantId===h||I,!1))return{error:Zfe};let{participantType:m,participantRole:g}=d;if(!m||!Object.keys(K1).includes(m))return{error:Sd,participantType:m};if(!g)return{error:Yfe};let v=p.participants||[],y=v.filter(I=>I.participantType===Ki).map(I=>I.participantId);if(m!==Ki&&d.person)return{error:Me,person:d.person};if(f&&!Array.isArray(f))return{error:Me,individualParticipantIds:f};if(m===Ui){if(d.person)return{error:Me,person:d.person};if(d.individualParticipantIds){if(d.individualParticipantIds.length!==2&&!u)return fe({info:"PAIR must be 2 individualParticipantIds",result:{error:wu},stack:o});{let w=v.filter(S=>S.participantType===Ki).map(S=>S.participantId);if(!Array.isArray(d.individualParticipantIds))return fe({result:{error:wu},stack:o});if(!d.individualParticipantIds.reduce((S,D)=>w.includes(D)&&S,!0))return fe({result:{error:wu},stack:o})}}else return fe({result:{error:kg},stack:o});let I=v.filter(w=>w.participantType===Ui).map(w=>({individualParticipantIds:w.individualParticipantIds,participant:w})),T=d.participantType===Ui&&I.find(w=>Wr(w.individualParticipantIds,d.individualParticipantIds).length===2);if(T&&!s)return{...ue,existingParticipant:!0,participant:l&&$t(T.participant)};if(!d.participantName){let w=v.filter(D=>{var E;return(E=d.individualParticipantIds)==null?void 0:E.includes(D.participantId)}),S=w.map(D=>{var E;return(E=D.person)==null?void 0:E.standardFamilyName}).filter(Boolean).join("/");w.length===1&&(S+="/Unknown"),d.participantName=S}}else if(m===Ki){if(!((n=d.person)!=null&&n.standardFamilyName)||!((r=d.person)!=null&&r.standardGivenName))return{error:eme};if(!d.participantName){let I=`${d.person.standardFamilyName.toUpperCase()}, ${d.person.standardGivenName}`;d.participantName=I}}else if(m&&[Hn,cc].includes(m)){if(f||(d.individualParticipantIds=[]),(a=d.individualParticipantIds)==null?void 0:a.length)for(let I of d.individualParticipantIds){if(typeof I!="string")return fe({result:{participantId:I,error:Me},stack:o});if(!y.includes(I))return fe({result:{participantId:I,error:Jr},stack:o})}}else return{error:Sd};p.participants.push(d),c||tn({payload:{tournamentId:p.tournamentId,participants:[d]},topic:sg});let b={participant:l&&$t(d),...ue};return qt(b)}function Dd({allowDuplicateParticipantIdPairs:t,returnParticipants:e,tournamentRecord:i,participants:n=[]}){if(!i)return{error:it};i.participants||(i.participants=[]);let r=i.participants.map(d=>d.participantId)||[];n.forEach(d=>{d.participantId||(d.participantId=xn())});let a=n.filter(d=>!r.includes(d.participantId)),o=n.filter(d=>r.includes(d.participantId)),s=a.filter(d=>d.participantType===Ki),l=a.filter(d=>d.participantType!==Ki),c=s.concat(...l),u=[];if(c.length){for(let p of c){let h=Up({allowDuplicateParticipantIdPairs:t,returnParticipant:!0,disableNotice:!0,tournamentRecord:i,participant:p});if(h.error)return h;h.success&&!h.existingParticipant&&u.push(h.participant)}u.length&&tn({topic:sg,payload:{tournamentId:i.tournamentId,participants:u}});let d={participants:e&&$t(u),addedCount:u.length,...ue};return o.length&&Object.assign(d,{notAdded:o,info:tL}),qt(d)}else return{info:"No new participants to add",addedCount:0,...ue}}function Iwe({allowDuplicateParticipantIdPairs:t,entryStage:e=Ft,entryStatus:i=Su,participantIdPairs:n=[],tournamentRecord:r,drawDefinition:a,event:o,uuids:s}){if(!r)return{error:it};if(!o)return{error:_n};if(o.eventType!==Zn)return{error:ng};let l=[],c=new Map;for(let y of r.participants??[]){let{participantType:b,participantId:I,person:T,individualParticipantIds:w}=y;b===Ki&&T!=null&&T.sex?c.set(I,T.sex):b===Ui&&w&&l.push(w)}let u=n.filter(y=>{if(y.length!==2||!c.has(y[0])||!c.has(y[1]))return!0;if(!o.gender||o.gender===wp)return!1;let b=y.map(T=>c.get(T)),I=o.gender===Yn&&(b[0]!==Yn||b[1]!==Yn)||o.gender===Ir&&(b[0]!==Ir||b[1]!==Ir);return o.gender===El&&(b.sort(_L),(b[0]!==Ir||b[1]!==Yn)&&(I=!0)),I});if(u.length)return{error:wu,invalidParticipantIdPairs:u};let d=n.map(y=>({participantId:(s==null?void 0:s.pop())??xn(),participantRole:jo,individualParticipantIds:y,participantType:Ui})),p=t?d:d.filter(y=>!l.find(b=>Wr(b,y.individualParticipantIds).length===2)),h,f=[];if(p){let y=Dd({allowDuplicateParticipantIdPairs:t,participants:p,returnParticipants:!0,tournamentRecord:r});if(y.error)return y;f=y.participants||[],h=y.info}let m=n.map(y=>{let b=f.find(T=>Wr(T.individualParticipantIds,y).length===2);if(b)return b;let{participant:I}=Ou({tournamentRecord:r,participantIds:y});return I}).map(y=>y.participantId),g=lh({participantIds:m,tournamentRecord:r,drawDefinition:a,entryStatus:i,entryStage:e,event:o});p.length&&tn({payload:{participants:p},topic:sg});let v=p.map(Wi);return{...g,info:h,newParticipantIds:v}}function wwe({entryStatus:t=tc,unpairedParticipantIds:e=[],participantIdPairs:i=[],entryStage:n=Ft,tournamentRecord:r,event:a}){if(!r)return{error:it};if(!a)return{error:_n};let o=r.participants??[],s=o.filter(m=>m.participantType===Ki).map(m=>m.participantId),l=e.concat(...i).flat(1/0).filter(m=>!s.includes(m));if(l.length)return{error:wu,invalidParticipantIds:l};let c=i.filter(m=>m.length!==2);if(c.length)return{error:wu,invalidParticipantIdPairs:c};let u=o.filter(m=>m.participantType===Ui).map(m=>m.individualParticipantIds),d=i.filter(m=>!u.find(g=>Wr(g,m).length===2)).map(m=>({participantType:Ui,participantRole:jo,individualParticipantIds:m})),p=Dd({participants:d,tournamentRecord:r});if(p.error)return p;let h=i.map(m=>{let{participant:g}=Ou({tournamentRecord:r,participantIds:m});return g}).map(m=>({participantId:m,entryStatus:t,entryStage:n})),f=e.map(m=>({entryStatus:zu,participantId:m,entryStage:n}));return a.entries=(a.entries??[]).filter(m=>m.entryStage===n),a.entries=a.entries.concat(...h,...f),{...ue}}var Swe={};zi(Swe,{addDrawDefinition:()=>wF,addEvent:()=>$R,addFlight:()=>TF,assignSeedPositions:()=>Awe,attachFlightProfile:()=>h7,categoryCanContain:()=>GL,deleteDrawDefinitions:()=>bF,deleteEvents:()=>kwe,deleteFlightAndFlightDraw:()=>Mwe,deleteFlightProfileAndFlightDraws:()=>Ewe,getCategoryAgeDetails:()=>CR,getEvent:()=>a7,getEventProperties:()=>n7,getEventStructures:()=>LL,getEventTimeItem:()=>uR,getEvents:()=>r7,getFlightProfile:()=>Xr,getScaledEntries:()=>ww,modifyEvent:()=>xwe,modifyEventMatchUpFormatTiming:()=>Cwe,modifyPairAssignment:()=>Nwe,mutate:()=>Twe,query:()=>pwe,refreshEventDrawOrder:()=>p7,removeEventMatchUpFormatTiming:()=>IF,removeScaleValues:()=>f7,removeSeeding:()=>_we,setEventDates:()=>Pwe,setEventDisplay:()=>SF,setEventEndDate:()=>u7,setEventStartDate:()=>c7,updateDrawIdsOrder:()=>d7,validateCategory:()=>O_});var Twe={};zi(Twe,{addDrawDefinition:()=>wF,addEvent:()=>$R,addFlight:()=>TF,assignSeedPositions:()=>Awe,attachFlightProfile:()=>h7,deleteDrawDefinitions:()=>bF,deleteEvents:()=>kwe,deleteFlightAndFlightDraw:()=>Mwe,deleteFlightProfileAndFlightDraws:()=>Ewe,modifyEvent:()=>xwe,modifyEventMatchUpFormatTiming:()=>Cwe,modifyPairAssignment:()=>Nwe,refreshEventDrawOrder:()=>p7,removeEventMatchUpFormatTiming:()=>IF,removeScaleValues:()=>f7,removeSeeding:()=>_we,setEventDates:()=>Pwe,setEventDisplay:()=>SF,setEventEndDate:()=>u7,setEventStartDate:()=>c7,updateDrawIdsOrder:()=>d7,validateCategory:()=>O_});function RU({removePriorValues:t=!0,status:e=Wu,statusObject:i,event:n}){if(!sr(i))return{error:Me};let r=Xc({event:n,status:e}),a=`${By}.${$y}`,o={itemValue:{[e]:{...r,...i}},itemType:a};return Iw({timeItem:o,removePriorValues:t,event:n})}function MU(t){var e,i,n,r,a,o,s;let{includePositionAssignments:l,removePriorValues:c,tournamentRecord:u,status:d=Wu,event:p,drawIdsToRemove:h,drawIdsToAdd:f}=t;if(!u)return{error:it};if(!p)return{error:_n};let{appliedPolicies:m}=Mn({tournamentRecord:u,event:p}),g={...m,...t.policyDefinitions},v=((e=p.drawDefinitions)==null?void 0:e.map(({drawId:P})=>P))??[],y=t.drawDetails?Object.keys(t.drawDetails):[],b=y.length?[]:t.drawIds,I=(f??[]).concat(...h??[],...b??[],...y),T=I.filter(P=>!v.includes(P));if(T.length)return fe({result:{error:_l},context:{invalidDrawIds:T}});let w=Xc({event:p,status:d}),S=Object.keys((w==null?void 0:w.drawDetails)||{}).filter(P=>v.includes(P)).reduce((P,R)=>(P[R]=w.drawDetails[R],P),{});for(let P of v)if((!I.length||I.includes(P))&&(h!=null&&h.includes(P)||b!=null&&b.length&&!b.includes(P)?S[P]={...S[P],publishingDetail:{published:!1}}:(f!=null&&f.includes(P)||b!=null&&b.includes(P)||!(b!=null&&b.length))&&(S[P]={...S[P],publishingDetail:{published:!0}})),(i=t.drawDetails)==null?void 0:i[P]){let R=t.drawDetails[P],N=R.structureDetails??S[P].structureDetails,M=R.stageDetails??S[P].stageDetails??{},{structureIdsToRemove:A=[],structureIdsToAdd:_=[],publishingDetail:x={},stagesToRemove:O=[],stagesToAdd:B=[]}=R;if((_||B)&&(x.published=!0),S[P]={publishingDetail:x,structureDetails:N,stageDetails:M},_.length||A.length){let G=(((r=(n=p.drawDefinitions)==null?void 0:n.find($=>$.drawId===P))==null?void 0:r.structures)??[]).map(({structureId:$})=>$),H=(_??[]).concat(A??[]).filter($=>!G.includes($));if(H.length)return fe({result:{error:Dr},context:{invalidStructureIds:H}});N=N??{};for(let $ of G)A.includes($)?N[$]={published:!1}:N[$]={published:!0};S[P].structureDetails=N}let F=(((o=(a=p.drawDefinitions)==null?void 0:a.find(G=>G.drawId===P))==null?void 0:o.structures)??[]).map(({stage:G})=>G);if(B.length){for(let G of B)M[G]={published:!0};for(let G of F)M[G]||(M[G]={published:!1})}if(B.length||O.length){for(let G of O)M[G]={published:!1};for(let G of F)M[G]||(M[G]={published:!0})}(B.length||O.length)&&(S[P].stageDetails=M)}RU({statusObject:{drawDetails:S},removePriorValues:c,status:d,event:p});let{topics:D}=Gu(),E=D.includes(rj),C=E||t.returnEventData?(s=cF({includePositionAssignments:l,usePublishState:!0,tournamentRecord:u,policyDefinitions:g,event:p}))==null?void 0:s.eventData:void 0;return E&&tn({payload:{eventData:C,tournamentId:u.tournamentId},topic:rj}),{...ue,eventData:C}}var Uwe="deleteDrawDefinitions",Dwe="autoSchedulingAudit",xj="deleteEvents",N5e={AUTO_SCHEDULING_AUDIT:Dwe,DELETE_EVENTS:xj,DELETE_DRAW_DEFINITIONS:Uwe};function bF(t){var e,i,n;if(!t.tournamentRecord)return{error:it};let r="deleteDrawDefinitions",a=t.drawIds??[],o=t.event,{autoPublish:s=!0,tournamentRecord:l,auditData:c,eventId:u,force:d}=t,{appliedPolicies:p}=Mn({tournamentRecord:l,event:o}),h={...p,...t.policyDefinitions},f=Array.isArray(a)?a[0]:void 0;if(!o){let P=Ks({tournamentRecord:l,eventId:u,drawId:f});if(P.error)return P;o=P.event}let m=[],g=[],v=[];if(!(o!=null&&o.drawDefinitions))return fe({info:"event has no drawDefinition",result:{...ue},stack:r});let y=o.drawDefinitions.map(({drawId:P})=>P);if(a.length||(a=y),a=a.filter(P=>y.includes(P)),!a.length)return fe({info:"nothing to do; no matching drawIds in event.",result:{...ue},stack:r});let b=$t(Xr({event:o}).flightProfile,!1,!0),I=({participantId:P,drawPosition:R,qualifier:N,bye:M})=>({bye:M,qualifier:N,drawPosition:R,participantId:P}),T=d??((i=(e=p==null?void 0:p[Dh])==null?void 0:e.allowDeletionWithScoresPresent)==null?void 0:i.drawDefinitions),w=Xc({event:o})??{},S=w.drawIds??(w.drawDetails&&Object.keys(w.drawDetails))??[],D,E=[],C=o.drawDefinitions.filter(P=>{var R,N,M,A,_,x,O,B;if(a.includes(P.drawId)){let F=((R=Hs({event:o,drawDefinition:P}))==null?void 0:R.matchUps)??[];if(F.some(({score:oe})=>uo({score:oe}))&&!T)return E.push(P.drawId),!0;let{drawId:G,drawType:H,drawName:$}=P,q=(N=b==null?void 0:b.flights)==null?void 0:N.find(oe=>oe.drawId===P.drawId);q&&(q.drawEntries=(M=q.drawEntries)==null?void 0:M.filter(oe=>qu.includes(oe.entryStatus))),S.includes(G)&&(S=S.filter(oe=>oe!==G),D=!0);let z=(_=(A=Rh({stageSequence:1,drawDefinition:P,stage:Ft}))==null?void 0:A.structures)==null?void 0:_[0],Z=(O=(x=z?DE({structureId:z.structureId,tournamentRecord:l,drawDefinition:P}):void 0)==null?void 0:x.positionAssignments)==null?void 0:O.map(I),Y=(B=Rh({stage:Xt,drawDefinition:P}))==null?void 0:B.structures,Q=Y!=null&&Y.length?Y.map(oe=>{var re;let me=oe.stageSequence;return{positionAssignments:(re=DE({structureId:oe.structureId,tournamentRecord:l,drawDefinition:P}))==null?void 0:re.positionAssignments.map(I),stageSequence:me}}):void 0,X={action:Uwe,payload:{drawDefinitions:[P],eventId:u??(o==null?void 0:o.eventId),auditData:c}};v.push(X),m.push(qt({tournamentId:l.tournamentId,eventId:u??(o==null?void 0:o.eventId),qualifyingPositionAssignments:Q,positionAssignments:Z,auditData:c,drawType:H,drawName:$,drawId:G})),F==null||F.forEach(({matchUpId:oe})=>g.push(oe))}return!a.includes(P.drawId)});if(E.length&&!d)return fe({context:{drawIdsWithScoresPresent:E},result:{error:sL},stack:r});if(o.drawDefinitions=C,b&&Bg({event:o,extension:{name:Au,value:b}}),OR({tournamentRecord:l}),D){let P={};for(let N of S)P[N]=((n=w.drawDetails)==null?void 0:n[N])??{published:!0};let R=RU({statusObject:{drawDetails:P},event:o});if(R.error)return{error:R.error}}if(v.length&&tn({topic:VS,payload:v}),g.length&&lm({tournamentId:l==null?void 0:l.tournamentId,matchUpIds:g}),a.forEach(P=>{bHe({drawId:P})}),A5e({event:o,deletedDrawsDetail:m,auditData:c}),s&&D){let P=MU({drawIdsToRemove:a,policyDefinitions:h,tournamentRecord:l,event:o});if(P.error)return{...ue,info:P.error}}return{...ue}}function A5e({event:t,deletedDrawsDetail:e,auditData:i}){let{extension:n}=Bi({name:T_,element:t}),r={...i,deletedDrawsDetail:e},a={name:T_,value:Array.isArray(n==null?void 0:n.value)?n==null?void 0:n.value.concat(r):[r]};un({element:t,extension:a})}function Ewe({autoPublish:t=!0,tournamentRecord:e,auditData:i,event:n,force:r}){var a;if(!e)return{error:it};if(!n)return{error:_n};let{flightProfile:o}=Xr({event:n});if(o){let s=(a=o.flights)==null?void 0:a.map(({drawId:c})=>c).filter(Boolean),l=bF({eventId:n.eventId,tournamentRecord:e,autoPublish:t,auditData:i,drawIds:s,event:n,force:r});return l.error?l:hL({event:n,name:Au})}return{...ue}}function l7(t){let{matchUpFormat:e,recoveryTimes:i,averageTimes:n,tournamentId:r,eventId:a}=t,o=(t==null?void 0:t.tournamentRecords)??((t==null?void 0:t.tournamentRecord)&&{[t.tournamentRecord.tournamentId]:t.tournamentRecord})??{};if(!Object.keys(o).length)return{error:_r};let s=Object.keys(o).filter(c=>!r||r===c);if(r&&!s.includes(r))return{error:Me};let l;for(let c of s){let u=o[c],{event:d}=Ks({tournamentRecord:u,eventId:a});a&&d&&(l=!0);let p=_5e({tournamentRecord:u,event:d,matchUpFormat:e,averageTimes:n,recoveryTimes:i});if(p.error)return p}return!a||l?{...ue}:{error:kl}}function _5e({tournamentRecord:t,recoveryTimes:e,matchUpFormat:i,averageTimes:n,event:r}){if(!t)return{error:it};if(n&&!Array.isArray(n))return{error:Me};if(e&&!Array.isArray(e))return{error:Me};let a=Lf;if(r){let{extension:o}=Bi({element:r,name:a}),s=(o==null?void 0:o.value)||{},l=IX({...s,matchUpFormat:i,averageTimes:n,recoveryTimes:e});un({element:r,extension:{name:a,value:l}})}else{let{extension:o}=Bi({element:t,name:a}),s=(o==null?void 0:o.value)||{},l=IX({...s,matchUpFormat:i,averageTimes:n,recoveryTimes:e});un({extension:{name:a,value:l},element:t})}return{...ue}}function IX(t){let{matchUpRecoveryTimes:e=[],matchUpAverageTimes:i=[],matchUpFormat:n}=t,{averageTimes:r,recoveryTimes:a}=t;r=(r||[]).filter(l=>{var c,u;return((c=l==null?void 0:l.categoryNames)==null?void 0:c.length)||((u=l==null?void 0:l.categoryTypes)==null?void 0:u.length)});let o=(r==null?void 0:r.length)&&i.map(l=>{var c;return l!=null&&l.matchUpFormatCodes.includes(n)?{...l,matchUpFormatCodes:(c=l.matchUpFormatCodes)==null?void 0:c.filter(u=>u!==n)}:l}).filter(({matchUpFormatCodes:l})=>l==null?void 0:l.length).concat({matchUpFormatCodes:[n],averageTimes:r});a=(a||[]).filter(l=>{var c,u;return((c=l==null?void 0:l.categoryNames)==null?void 0:c.length)||((u=l==null?void 0:l.categoryTypes)==null?void 0:u.length)});let s=(a==null?void 0:a.length)&&e.map(l=>{var c;return l!=null&&l.matchUpFormatCodes.includes(n)?{...l,matchUpFormatCodes:(c=l.matchUpFormatCodes)==null?void 0:c.filter(u=>u!==n)}:l}).filter(({matchUpFormatCodes:l,averageTimes:c})=>(l==null?void 0:l.length)||c).concat({matchUpFormatCodes:[n],recoveryTimes:a});return{matchUpAverageTimes:(o==null?void 0:o.length)&&o||i,matchUpRecoveryTimes:(s==null?void 0:s.length)&&s||e}}function Cwe(t){let{tournamentRecord:e,recoveryMinutes:i,averageMinutes:n,matchUpFormat:r,categoryType:a,eventId:o,event:s}=t;if(!e)return{error:it};if(!Fl({matchUpFormat:r}))return{error:Me};if(!s)return{error:_n};let{averageTimes:l=[],recoveryTimes:c=[]}=fF({tournamentRecord:e,matchUpFormat:r,event:s}),u=s.category,d=(u==null?void 0:u.categoryName)||(u==null?void 0:u.ageCategoryCode)||(s==null?void 0:s.eventId),p={categoryNames:[d],minutes:{}},h={categoryNames:[d],minutes:{}},f=b=>{var I,T;if((I=b.categoryTypes)!=null&&I.includes(a)&&console.log("encountered:",{categoryType:a}),!((T=b.categoryNames)!=null&&T.includes(d)&&(b.categoryNames=b.categoryNames.filter(w=>w!==d),p={minutes:b.minutes,categoryNames:[d]},!b.categoryNames.length)))return b},m=n&&!isNaN(ai(n)),g=i&&!isNaN(ai(i)),v=l.map(f).filter(b=>{var I;return(I=b==null?void 0:b.categoryNames)==null?void 0:I.length}),y=c.map(f).filter(b=>{var I;return(I=b==null?void 0:b.categoryNames)==null?void 0:I.length});return m&&(Object.assign(p.minutes,{[(s==null?void 0:s.eventType)||Mr]:n}),v.push(p)),g&&(Object.assign(h.minutes,{[(s==null?void 0:s.eventType)||Mr]:i}),y.push(h)),!m&&!g?{error:Me}:l7({averageTimes:m&&v,recoveryTimes:g&&y,tournamentRecord:e,matchUpFormat:r,eventId:o,event:s})}function IF(t){if(t.event)return wX({event:t.event});{t.tournamentRecord&&!t.tournamentRecords&&(t.tournamentRecords={[t.tournamentRecord.tournamentId]:t.tournamentRecord});let e=mn(t,[{[Ko]:!0,[Wme]:!0}]);if(e.error)return e;let{tournamentRecords:i,eventId:n}=t;for(let r of Object.values(i??{})){let{event:a}=Ks({tournamentRecord:r,eventId:n});if(a)return wX({event:a})}}return{error:kl}}function wX({event:t}){return hL({event:t,name:Lf})}function c7({tournamentRecord:t,event:e,startDate:i}){if(!t)return{error:it};if(!e)return{error:_n};if(!Th.test(i))return{error:Cs};let n=Rwe(t);if(n.error)return n;let{tournamentStartDate:r,tournamentEndDate:a}=n,o=new Date(Ci(i)).getTime();if(!r||!a||o<r||o>a)return{error:Cs};let s=e.endDate&&new Date(Ci(e.endDate)).getTime();return s&&o>s&&(e.endDate=i),e.startDate=i,{...ue}}function u7({tournamentRecord:t,event:e,endDate:i}){if(!t)return{error:it};if(!e)return{error:_n};if(!Th.test(i))return{error:Cs};let n=Rwe(t);if(n.error)return n;let{tournamentStartDate:r,tournamentEndDate:a}=n,o=new Date(Ci(i)).getTime();if(!r||!a||o<r||o>a)return{error:Cs};let s=e.startDate&&new Date(Ci(e.startDate)).getTime();return s&&o<s&&(e.startDate=i),e.endDate=i,{...ue}}function Pwe({tournamentRecord:t,event:e,startDate:i,endDate:n}){if(!t)return{error:it};if(!e)return{error:_n};if(!i&&!n)return{error:Ht,info:"missing date"};if(i&&!Th.test(i))return{error:Cs};if(n&&!Th.test(n))return{error:Cs};if(i&&n){let r=new Date(Ci(i)).getTime(),a=new Date(Ci(n)).getTime();if(r>a)return{error:Me}}if(i){let r=c7({tournamentRecord:t,event:e,startDate:i});if(r.error)return r}if(n){let r=u7({tournamentRecord:t,event:e,endDate:n});if(r.error)return r}return{...ue}}function Rwe(t){let{startDate:e,endDate:i}=t;return!Th.test(e)||!Th.test(i)?fe({result:{error:zfe},context:{startDate:e,endDate:i}}):{tournamentStartDate:new Date(Ci(e)).getTime(),tournamentEndDate:new Date(Ci(i)).getTime()}}function d7({event:t,orderedDrawIdsMap:e}){var i,n;if(typeof t!="object")return{error:_n};if(!e)return{error:Ht,info:"Missing drawIdsOrderMap"};if(typeof e!="object")return{error:Me,info:"orderedDrawIdsMap must be an object"};let r=Object.values(e);if(!r.every(o=>!isNaN(o)))return{error:Me,info:"drawOrder must be numeric"};if(ki(r).length!==r.length)return{error:Me,info:"drawOrder values must be unique"};if((i=t.drawDefinitions)!=null&&i.length){let o=(t.drawDefinitions||[]).map(({drawId:l})=>l),s=Object.keys(e);if(s!=null&&s.length&&Wr(o,s).length!==o.length)return{error:Me,info:"Missing drawIds"};t.drawDefinitions.forEach(l=>{l.drawOrder=e[l.drawId]})}let{flightProfile:a}=Xr({event:t});return(n=a==null?void 0:a.flights)==null||n.forEach(o=>{o.flightNumber=e[o.drawId]}),{...ue}}function p7({tournamentRecord:t,event:e}){var i;if(!t)return{error:it};if(!e)return{error:_n};let{flightProfile:n}=Xr({event:e}),r=(n==null?void 0:n.flights)&&Object.assign({},...n.flights.sort((a,o)=>a.flightNumber-o.flightNumber).map((a,o)=>({[a.drawId]:o+1})))||((i=e.drawDefinitions)==null?void 0:i.length)&&Object.assign({},...e.drawDefinitions.sort((a,o)=>a.drawOrder-o.drawOrder).map((a,o)=>({[a.drawId]:o+1})))||void 0;return r?d7({event:e,orderedDrawIdsMap:r}):{...ue}}function Mwe({autoPublish:t=!0,tournamentRecord:e,auditData:i,drawId:n,event:r,force:a}){var o,s;if(!e)return{error:it};if(!n)return{error:Rd};if(!r)return{error:_n};let{flightProfile:l}=Xr({event:r});if(l&&(o=l.flights)!=null&&o.find(c=>c.drawId===n)){let c=l.flights.filter(d=>d.drawId!==n),u={name:Au,value:{...l,flights:c}};Bg({event:r,extension:u})}if((s=r.drawDefinitions)!=null&&s.find(c=>c.drawId===n)){let c=bF({drawIds:[n],eventId:r.eventId,tournamentRecord:e,autoPublish:t,auditData:i,event:r,force:a});if(c.error)return c}return p7({tournamentRecord:e,event:r})}function Nwe({replacementIndividualParticipantId:t,existingIndividualParticipantId:e,tournamentRecord:i,drawDefinition:n,participantId:r,event:a,uuids:o}){var s,l;if(!a)return{error:_n};if((a==null?void 0:a.eventType)!==xu)return{error:ng};if(o&&!Array.isArray(o))return{error:Me};if(!i)return{error:it};if(![t,e,r].every(g=>typeof g=="string"))return{error:Ra};if(!(((s=a==null?void 0:a.entries)==null?void 0:s.filter(({entryStatus:g})=>[zu,Oy].includes(g)).map(({participantId:g})=>g))||[]).includes(t))return{error:vp};let c=(i.participants||[]).find(g=>g.participantId===r);if((c==null?void 0:c.participantType)!==Ui)return{error:rU,participant:c};let u=c.individualParticipantIds,d=[t,...u.filter(g=>g!==e)],{participant:p}=Ou({participantIds:d,tournamentRecord:i}),h;if(p)h=p.participantId;else{let g={participantId:o==null?void 0:o.pop(),participantRole:jo,individualParticipantIds:d,participantType:Ui},v=Up({participant:g,returnParticipant:!0,tournamentRecord:i});if(v.error)return v;h=v.participant.participantId}let{flightProfile:f}=Xr({event:a});if(n){let g=(l=f==null?void 0:f.flights)==null?void 0:l.find(({drawId:v})=>v===n.drawId);g&&(g.drawEntries=g.drawEntries.map(v=>v.participantId===r?{...v,participantId:h}:v)),n.entries=n.entries.map(v=>v.participantId===r?{...v,participantId:h}:v);for(let v of n.structures||[])if(v.positionAssignments)v.positionAssignments=v.positionAssignments.map(y=>y.participantId===r?{...y,participantId:h}:y);else if(v.structures)for(let y of v.structures)y.positionAssignments=y.positionAssignments.map(b=>b.participantId===r?{...b,participantId:h}:b)}a.entries=a.entries.map(g=>g.participantId===r&&{...g,participantId:h}||g.participantId===t&&{...g,participantId:e}||g);let m=i.events.some(({entries:g,eventId:v,drawDefinitions:y})=>a.eventId===v?y.some(({drawId:b,entries:I})=>b===(n==null?void 0:n.drawId)?!1:I==null?void 0:I.find(T=>T.participantId===r)):g==null?void 0:g.find(b=>b.participantId===r));if(!m){let g=gw({addIndividualParticipantsToEvents:!1,participantIds:[r],tournamentRecord:i});if(g.error)return g}return{...ue,participantOtherEntries:m,newPairParticipantId:h}}function wF(t){var e,i,n,r,a,o,s,l,c,u,d,p;let{flight:h,suppressNotifications:f,modifyEventEntries:m,existingDrawCount:g,allowReplacement:v,checkEntryStatus:y,tournamentRecord:b,drawDefinition:I,event:T}=t;if(!I)return{error:Lt};if(!T)return{error:_n};T.drawDefinitions||(T.drawDefinitions=[]);let{drawId:w,drawName:S,entries:D}=I,{entries:E}=T,C=0;if(g!==void 0&&g!==T.drawDefinitions.length)return{error:Me,info:"drawDefintions count mismatch"};let{flightProfile:P}=Xr({event:T}),R=h&&((e=P==null?void 0:P.flights)==null?void 0:e.find(q=>q.flightNumber===h.flightNumber)),N=(r=(n=(i=P==null?void 0:P.links)==null?void 0:i.find(q=>{var z;return((z=q==null?void 0:q.target)==null?void 0:z.drawId)===w}))==null?void 0:n.source)==null?void 0:r.drawId;if(N&&!T.drawDefinitions.find(q=>q.drawId===N))return fe({result:{error:Lt},info:{sourceDrawId:N}});if(R&&R.drawId!==I.drawId)return fe({result:{error:_b},info:{relevantFlight:R}});let M=D==null?void 0:D.every(({participantId:q,entryStatus:z})=>{let Z=R==null?void 0:R.drawEntries.find(Y=>Y.participantId===q);return!z||(Z==null?void 0:Z.entryStatus)===z}),A=!y||E&&(D==null?void 0:D.every(({participantId:q,entryStatus:z,entryStage:Z})=>{var Y;return((Y=E.find(Q=>Q.participantId===q&&(!Q.entryStage||Q.entryStage===Z)))==null?void 0:Y.entryStatus)===z}));if(R&&!M)return fe({result:{error:_b},context:{drawEntriesPresentInFlight:M,matchingEventEntries:A,relevantFlight:R},info:"Draw entries are not present in flight or do not match entryStatuses"});if(m&&(D==null||D.filter(Boolean).forEach(q=>{if(q!=null&&q.entryStatus&&qu.includes(q==null?void 0:q.entryStatus)){let z=E==null?void 0:E.filter(Boolean).find(Z=>Z.participantId===q.participantId);z&&q.entryStatus&&(z==null?void 0:z.entryStatus)!==q.entryStatus&&(z.entryStatus=q.entryStatus,C+=1)}})),E&&!A)return fe({result:{info:"Draw entries do not match event entryStatuses",context:{matchingEventEntries:A,eventEntries:E},error:_b}});let _=((o=(a=P==null?void 0:P.flights)==null?void 0:a.map(({flightNumber:q})=>!isNaN(q)&&ai(q)))==null?void 0:o.filter(Boolean))||[],x=((s=T.drawDefinitions.map(({drawOrder:q})=>q&&ai(q)))==null?void 0:s.filter(Boolean))||[],O=Math.max(0,...x,..._)+1,B=(l=P==null?void 0:P.flights)==null?void 0:l.find(q=>q.drawId===w),F;if(B){B.drawName=I.drawName,F={name:Au,value:{...P,flights:P.flights}};let q=B.flightNumber;q&&!x.includes(q)?O=q:B.flightNumber=O}else{let q=(P==null?void 0:P.flights)||[];q.push({manuallyAdded:!0,flightNumber:O,drawEntries:D,drawName:S,drawId:w}),F={name:Au,value:{...P||{},flights:q}}}Bg({event:T,extension:F}),Object.assign(I,{drawOrder:O});let G=T.drawDefinitions.find(q=>q.drawId===w),H=b==null?void 0:b.tournamentId,$=T.eventId;if(G){if(!v)return{error:Tfe};let q=((u=(c=Hs({drawDefinition:G}))==null?void 0:c.matchUps)==null?void 0:u.map(Va))??[],z=(d=Hs({drawDefinition:I}))==null?void 0:d.matchUps;if(!f){q!=null&&q.length&&lm({matchUpIds:q,action:"modifyDrawDefinition",tournamentId:H,eventId:$}),z!=null&&z.length&&lg({matchUps:z,tournamentId:H,eventId:$}),T.drawDefinitions=T.drawDefinitions.map(Y=>Y.drawId===w?I:Y);let Z=(p=I.structures)==null?void 0:p.map(({structureId:Y})=>Y);er({drawDefinition:I,tournamentId:H,structureIds:Z,eventId:$})}}else if(T.drawDefinitions.push(I),!f){let{matchUps:q}=Hs({drawDefinition:I,event:T});q&&lg({tournamentId:b==null?void 0:b.tournamentId,matchUps:q}),YP({drawDefinition:I,tournamentId:H,eventId:$})}return{...ue,modifiedEventEntryStatusCount:C}}function Awe(t){let{provisionalPositioning:e,useExistingSeedLimit:i,tournamentRecord:n,drawDefinition:r,seedingProfile:a,structureId:o,assignments:s,drawId:l,event:c}=t,u=0;if(!(s!=null&&s.length))return{error:W4};if(!n)return{error:it};if(!l)return{error:Rd};let d=Gc({provisionalPositioning:e,drawDefinition:r,structureId:o});if(d.error)return d;let{seedAssignments:p,seedLimit:h}=d,f=Object.assign({},...(p??[]).filter(v=>v.seedNumber).map(v=>({[v.seedNumber]:v})));s.forEach(v=>{let{seedNumber:y}=v;h&&y<=h&&(!i||f[y])&&(f[y]=v)});let m=Object.values(f),g=m.map(v=>v==null?void 0:v.participantId).filter(Boolean);if(g.length!==Rme(g).length)return{error:Ufe};for(let v of m){let y=DU({...v,provisionalPositioning:e,tournamentRecord:n,drawDefinition:r,seedingProfile:a,structureId:o,event:c});if(y!=null&&y.error)return y;y!=null&&y.success&&u++}return u?{...ue,modifications:u}:{error:sU}}function h7({deleteExisting:t,event:e,flightProfile:i}){var n;let r="attachFlightProfile";if(!i)return fe({result:{error:Ht},stack:r});if(!e)return fe({result:{error:_n},stack:r});let{flightProfile:a}=Xr({event:e});return a&&!t?fe({result:{error:p5},stack:r}):(n=e.drawDefinitions)!=null&&n.length?fe({result:{error:Ife},stack:r}):(Bg({event:e,extension:{name:Au,value:i}}),{flightProfile:$t(i,!1,!0),...ue})}function k5e({tournamentRecord:t,scaleAttributes:e,participantIds:i}){var n;if(!t)return{error:it};if(!i)return{error:kg};if(!e)return{error:Ht,info:"scaleAttributes required"};let{scaleType:r,eventType:a,scaleName:o}=e,s=[Zge,r,a,o].join(".");return(n=t.participants)==null||n.forEach(l=>{i.includes(l.participantId)&&l.timeItems&&(l.timeItems=l.timeItems.filter(c=>c&&(c==null?void 0:c.itemType)!==s))}),{...ue}}function f7({tournamentRecord:t,scaleAttributes:e,drawDefinition:i,entryStatuses:n,drawId:r,event:a,stage:o}){var s;if(!a)return{error:_n};if(n&&!Array.isArray(n))return fe({result:{error:Me},info:Nh("entryStatus"),stack:"removeScaleValues"});let l=a.entries;if(r){let{flightProfile:u}=Xr({event:a}),d=(s=u==null?void 0:u.flights)==null?void 0:s.find(p=>p.drawId===r);d?l=d.drawEntries:l=i==null?void 0:i.entries}let c=(l||[]).filter(u=>(!o||!u.entryStage||u.entryStage===o)&&(!n||n.includes(u.entryStatus))).map(Wi);return k5e({tournamentRecord:t,scaleAttributes:e,participantIds:c})}function SF({removePriorValues:t,tournamentRecord:e,displaySettings:i,status:n=Wu,event:r}){if(!e)return fe({result:{error:it}});if(!r)return fe({result:{error:_n}});if(!sr(i))return fe({result:{error:Ht}});if(sr(i.draws))for(let o of Object.keys(i.draws)){let s=i.draws[o].scheduleDetails??[];if(s.length){let l=[];for(let c of s){let u=l.find(d=>Sje(d.attributes,c.attributes));u!=null&&u.dates&&c.dates?u.dates.push(...c.dates):l.push(c)}i.draws[o].scheduleDetails=l}}let a=RU({statusObject:{displaySettings:i},removePriorValues:t,status:n,event:r});return a.error?a:{...ue}}function _we({tournamentRecord:t,drawDefinition:e,entryStatuses:i,scaleName:n,drawId:r,event:a,stage:o}){var s,l;if(!t)return{error:it};if(!a)return{error:_n};n=n||((s=a.category)==null?void 0:s.categoryName)||((l=a.category)==null?void 0:l.ageCategoryCode);let c={eventType:a.eventType,scaleType:ah,scaleName:n};return f7({tournamentRecord:t,scaleAttributes:c,drawDefinition:e,entryStatuses:i,drawId:r,event:a,stage:o})}function kwe({removePairParticipants:t,tournamentRecord:e,eventIds:i}){if(!e)return{error:it};if(!e.events)return{error:kl};if(!Array.isArray(i))return{error:Ht,info:Nh("drawIds")};let n=[],r=[],a=[],o=[];if(e.events=(e.events||[]).filter(s=>{if(i.includes(s.eventId)){let u={action:xj,payload:{events:[s]}};n.push(u),r.push({tournamentId:e.tournamentId,eventName:s.eventName,eventType:s.eventType,category:s.category,eventId:s.eventId,gender:s.gender})}let l=s.eventType===xu?(s.entries||[]).map(({entryStatus:u,participantId:d})=>u!==zu&&d).filter(Boolean):[],c=i.includes(s.eventId);return c?o.push(...l):a.push(...l),!c}),t){let s=o.filter(l=>!a.includes(l));e.participants=e.participants.filter(({participantId:l})=>!s.includes(l))}return OR({tournamentRecord:e}),n.length&&(tn({topic:VS,payload:n}),bw({tournamentRecord:e,timeItem:{itemType:xj,itemValue:r}})),{...ue}}function xwe({tournamentRecord:t,eventUpdates:e,eventId:i,event:n}){var r;let a="modifyEvent";if(!t)return fe({result:{error:it},stack:a});if(!qs(i))return fe({result:{error:_n},context:{eventId:i},stack:a});if(!sr(e))return fe({result:{error:Me},context:{eventUpdates:e},stack:a});let o=((r=n==null?void 0:n.entries)==null?void 0:r.filter(({entryStatus:h})=>{let f=h;return[...qu,Su].includes(f)}).map(({participantId:h})=>h))??[],s=o?Yr({participantFilters:{participantIds:o},withIndividualParticipants:!0,tournamentRecord:t}).participants??[]:[],l=[],c=s.reduce((h,f)=>{var m,g;let v=(m=f.person)!=null&&m.sex?[f.person.sex]:((g=f.individualParticpants)==null?void 0:g.map(y=>{var b;return(b=y.person)==null?void 0:b.sex}))||[];return l.push(...v),h.includes(f.participantType)?h:h.concat(f.participantType)},[]),u=ki(l),d=!u.length||[El,wp].includes(e.gender??"")||u.length===1&&u[0]===e.gender;if(e.gender&&!d)return fe({context:{gender:e.gender,validGender:d},result:{error:Me},stack:a});let p=(c.includes(Fa)&&[Fa]||c.includes(Ki)&&[Mh]||c.includes(Ui)&&[xu]||[xu,Mh,Fa]).includes(e.eventType??"");return e.eventType&&!p?fe({context:{participantType:e.eventType,validEventType:p},result:{error:Me},stack:a}):(e.eventType&&(n.eventType=e.eventType),e.eventName&&(n.eventName=e.eventName),e.gender&&(n.gender=e.gender),{...ue})}function TF({qualifyingPositions:t,drawEntries:e=[],drawName:i,drawId:n,event:r,stage:a}){var o,s,l;let c="addFlight";if(!r)return fe({result:{error:_n},stack:c});if(!i)return fe({result:{error:Ht},stack:c});if(e!=null&&e.length){let g=(r.entries??[]).map(Wi),v=e.map(Wi);if(Wr(v,g).length!==v.length)return fe({result:{error:Me},stack:c})}let u=(o=Xr({event:r}))==null?void 0:o.flightProfile,d=((l=(s=u==null?void 0:u.flights)==null?void 0:s.map(({flightNumber:g})=>!isNaN(g)&&ai(g)))==null?void 0:l.filter(Boolean))||[],p=Math.max(0,...d)+1,h={drawId:n||xn(),flightNumber:p,drawEntries:e,drawName:i};if(a&&(h.stage=a),t&&(h.qualifyingPositions=t),((u==null?void 0:u.flights)||[]).find(({drawId:g})=>g===h.drawId))return fe({result:{error:Ime},stack:c});let f=((u==null?void 0:u.flights)||[]).concat(h),m={name:Au,value:{...u||{},flights:f}};return Bg({event:r,extension:m})}var x5e={collectionDefinitions:[{collectionName:"Doubles",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7@7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"COLLEGE_D3",winCriteria:{valueGoal:5}},O5e={collectionDefinitions:[{collectionName:"Doubles",collectionValue:1,matchUpCount:3,matchUpFormat:"SET1-S:6/TB7",matchUpType:"DOUBLES"},{collectionName:"Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"COLLEGE_DEFAULT",winCriteria:{valueGoal:5}},L5e={collectionDefinitions:[{collectionName:"Doubles",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"COLLEGE_JUCO",winCriteria:{valueGoal:5}},Owe={COLLEGE_D3:x5e,COLLEGE_DEFAULT:O5e,COLLEGE_JUCO:L5e,DOMINANT_DUO:gIe,DOMINANT_DUO_MIXED:pIe,LAVER_CUP:wIe,TEAM_DOUBLES_3_AGGREGATION:sIe,TIME_TENNIS_DUAL:hIe,TIME_TENNIS_PRO_CIRCUIT:dIe,USTA_BREWER_CUP:fIe,USTA_OZAKI_CUP:mIe,USTA_COLLEGE:vIe,USTA_GOLD_TEAM_CHALLENGE:oIe,USTA_INTERSECTIONAL:uIe,USTA_LEVEL_1:yIe,USTA_SECTION_BATTLE:cIe,USTA_SOUTHERN_LEVEL_5:lIe,USTA_TOC:SIe,USTA_WTT_ITT:bIe,USTA_ZONAL:IIe};function $R({suppressNotifications:t,tournamentRecord:e,internalUse:i,event:n}){var r,a,o,s;if(!e)return{error:it};if(e.events||(e.events=[]),!n)return{error:_n};let{startDate:l,endDate:c}=e;if(!i&&((r=n.entries)!=null&&r.length||(a=n.drawDefinitions)!=null&&a.length)){let d=qt({drawDefinitions:!!((o=n.drawDefinitions)!=null&&o.length),entries:!!((s=n.entries)!=null&&s.length)});return{info:"entries/drawDefinitions cannot exist",error:Me,context:d}}let u={eventType:pI,drawDefinitions:[],entries:[],startDate:l,endDate:c,...n};if(n.eventType===Hc){if(n.tieFormat){let d=ul({tieFormat:n.tieFormat});if(d.error)return d}else if(n.tieFormatName){if(!Owe[n.tieFormatName])return{context:{tieFormatName:n.tieFormatName},error:Me};let d=vI({isMock:e==null?void 0:e.isMock,namedFormat:n.tieFormatName,event:n});u.tieFormat=d}}if(u.eventId||(u.eventId=xn()),e.events.reduce((d,p)=>d||p.eventId===u.eventId,void 0))return{error:_fe};{let d=u;if(e.events.push(d),!t){let{topics:p}=Gu();if(p.includes(wL)){let h=pm({event:n}).matchUps??[];lg({tournamentId:e==null?void 0:e.tournamentId,eventId:n.eventId,matchUps:h})}for(let h of n.drawDefinitions||[])YP({drawDefinition:h})}return{...ue,event:u}}}var Lwe={};zi(Lwe,{drawMatic:()=>P8,garman:()=>jwe,generateAdHocMatchUps:()=>XL,generateAdHocRounds:()=>C8,generateAndPopulatePlayoffStructures:()=>e8,generateCourts:()=>m7,generateDrawDefinition:()=>yF,generateDrawMaticRound:()=>y8,generateDrawStructuresAndLinks:()=>m8,generateDrawTypeAndModifyDrawDefinition:()=>g8,generateFlightProfile:()=>$5e,generateLineUps:()=>Vwe,generateQualifyingStructure:()=>W6,generateSeedingScaleItems:()=>fwe,generateVoluntaryConsolation:()=>fbe,roundRobinGroups:()=>Qze});var F5e="splitLevelBased",Fwe="splitWaterfall",Bwe="splitShuttle",B5e={SPLIT_LEVEL_BASED:F5e,SPLIT_WATERFALL:Fwe,SPLIT_SHUTTLE:Bwe};function $5e(t){let{drawNameRoot:e="Flight",attachFlightProfile:i,tournamentRecord:n,scaleAttributes:r,scaleSortMethod:a,deleteExisting:o,sortDescending:s,drawNames:l=[],flightsCount:c,splitMethod:u,uuids:d=[],event:p,stage:h}=t;if(!p)return{error:_n};let f=p.entries??[],{flightProfile:m}=Xr({event:p});if(m&&i&&!o)return{error:p5};let g=t.scaledEntries??ww({tournamentRecord:n,scaleAttributes:r,scaleSortMethod:a,sortDescending:s,event:p,stage:h}).scaledEntries,v=g.map(Wi),y=vs(f.filter(({participantId:C})=>!v.includes(C)).filter(C=>(!h||!C.entryStage||C.entryStage===h)&&(!C.entryStatus||Ly.includes(C.entryStatus)))),b=g.concat(...y),I=b.length,T=Math.ceil(I/c),w=so(b,T);u===Fwe?w=XV(b,c):u===Bwe&&(w=XV(b,c,!0));function S(C){return(C||[]).map(({participantId:P,scaleValue:R})=>{let N=f.find(M=>M.participantId===P);return N!=null&&N.scaleValue&&R&&(N.scaleValue=R),N}).sort((P,R)=>P.scaleValue-R.scaleValue).map((P,R)=>(P.scaleValue&&(P.seedNumber=R+1),P))}let D=Ct(0,c).map(C=>{let P=C+1;return{flightNumber:P,drawId:(d==null?void 0:d.pop())??xn(),drawEntries:S(w[C]),drawName:(l==null?void 0:l.length)&&l[C]||`${e} ${P}`}}),E={scaleAttributes:r,splitMethod:u,flights:D};if(i){let C=h7({flightProfile:E,deleteExisting:o,event:p});return{splitEntries:jc()&&w||void 0,...C}}else return{flightProfile:E,...ue}}var V5e="ASC",$we="ASC",j5e="DESC",Oj="DESC",G5e={ASC:V5e,ASCENDING:$we,DESC:j5e,DESCENDING:Oj};function Vwe(t){var e,i,n,r,a;let{tieFormat:o}=t,{useDefaultEventRanking:s,tournamentRecord:l,drawDefinition:c,scaleAccessor:u,singlesOnly:d,attach:p,event:h}=t;if((h==null?void 0:h.eventType)!==Hc)return{error:ng};if(!l)return{error:it};if(!o&&!c)return{error:_l};if(o=o??((e=ns({drawDefinition:c,event:h}))==null?void 0:e.tieFormat),ul({tieFormat:o}).error)return{error:nf};if(typeof u!="object"&&!s)return{error:Me,context:{scaleAccessor:u}};let f={},m=((c==null?void 0:c.entries)??(h==null?void 0:h.entries)??[]).filter(_=>(_==null?void 0:_.entryStatus)===tc).map(Wi),{participants:g=[]}=Yr({withIndividualParticipants:!0,withScaleValues:!0,tournamentRecord:l}),v=g.filter(({participantId:_})=>m.includes(_)),y=_=>_===rg?"rankings":"ratings",b=((i=h==null?void 0:h.category)==null?void 0:i.categoryName)??((n=h==null?void 0:h.category)==null?void 0:n.ageCategoryCode),{scaleName:I=b,scaleType:T=rg,sortOrder:w,accessor:S}=u||{},D=y(T),E=(_,x)=>{var O,B,F;let G=(O=_[D])==null?void 0:O[x];if(!G&&s&&(G=(B=_[D])==null?void 0:B[xb]),Array.isArray(G)){let H=(F=G.find($=>$.scaleName===I))==null?void 0:F.scaleValue;if(Lr(H))return H;if(S&&typeof H=="object")return H[S]}return 0},C=(_,x,O)=>{let B=w===Oj?x:_,F=w===Oj?_:x;return E(B,O)-E(F,O)},P=(_,x)=>C(_,x,xb),R=(_,x)=>C(_,x,ny),N=[],M=(o==null?void 0:o.collectionDefinitions)??[];for(let _ of v){let x=((r=_.individualParticipants)==null?void 0:r.sort(P))??[],O=d?x:((a=_.individualParticipants)==null?void 0:a.sort(R))??[],B={};for(let G of M){let H=[],{collectionId:$,matchUpCount:q,matchUpType:z,gender:Z}=G,Y=Hr(xb)(z);Ct(0,q).forEach(Q=>{let X=Y?x:O??[],oe=Q+1,re=[];Ct(0,Y?1:2).forEach(me=>{var se;let te=(se=X==null?void 0:X.find(he=>{var ae;let de=Z&&([Yn,Ir].includes(Z)&&Z||Z===El&&[Yn,Ir][me]);return(!de||de===((ae=he.person)==null?void 0:ae.sex))&&!H.includes(he.participantId)}))==null?void 0:se.participantId;te&&(re.push(te),H.push(te),B[te]||(B[te]=[]),B[te].push({collectionPosition:oe,collectionId:$}))}),Y||N.push(re)})}let F=Object.keys(B).map(G=>({collectionAssignments:B[G],participantId:G}));f[_.participantId]=F}let A=[];for(let _ of N){let{participant:x}=Ou({tournamentParticipants:g,participantIds:_});if(!x){let O={individualParticipantIds:_,participantRole:jo,participantType:Ui};A.push(O)}}if(p){for(;A.length;)Up({participant:A.pop(),tournamentRecord:l});un({element:c,extension:{name:Of,value:f}})}return{...ue,lineUps:f,participantsToAdd:A}}function m7(t){if(!t)return{error:Ht};let e=mn(t,[{dates:!1,[nd]:o=>Array.isArray(o)&&o.every(Kl)},{uuids:!1,[nd]:o=>Array.isArray(o)&&o.every(qs)},{startTime:!1,endTime:!1,[nd]:R5},{idPrefix:!1,namePrefix:!1,[nd]:qs},{count:!0,[nd]:Lr}]);if(e.error)return e;let{startDate:i,endDate:n}=t.tournamentRecord??{},r=t.dates||i&&n&&_S(i,n)||[],a=Ct(1,t.count+1).map(o=>{var s,l;return qt({courtId:((s=t.uuids)==null?void 0:s.pop())??(t.idPrefix&&`${t.idPrefix}-${o}`)??xn(),courtName:((l=t.courtNames)==null?void 0:l.pop())??(t.namePrefix&&`${t.namePrefix} ${o}`),dateAvailability:r.map(c=>({startTime:t.startTime??"08:00",endTime:t.endTime??"20:00",date:c}))})});return{...ue,courts:a}}var jwe={};zi(jwe,{default:()=>q5e,garman:()=>zwe});function VR({court:t,date:e}){let i=e&&t.dateAvailability.find(r=>Uh(r.date,e)),n=t.dateAvailability.find(r=>!r.date);return i||n}function NU(t){let e=mn(t,[{courtDate:!0,_ofType:Xh}]);if(e.error)return e;let{includeBookingTypes:i=[],courtDate:n}=t,r=[],a=ca(n.startTime);(n.bookings||[]).filter(s=>!s.bookingType||!i.includes(s.bookingType)).sort((s,l)=>b_(s.startTime).localeCompare(b_(l.startTime))).forEach(s=>{let l={startTime:rr(a.toISOString()),endTime:s.startTime};ca(s.startTime)>a&&r.push(l),ca(s.endTime)>a&&(a=ca(s.endTime))});let o={startTime:rr(a.toISOString()),endTime:n.endTime};return ca(n.endTime)>a&&r.push(o),{timeSlots:r}}function H5e({averageMatchUpMinutes:t,includeBookingTypes:e,periodStartTime:i,periodEndTime:n}){let r=o=>{var s;let{timeSlots:l}=NU({includeBookingTypes:e,courtDate:o});return!!((s=l==null?void 0:l.filter(a))!=null&&s.length)};function a(o){let s=ca(o.startTime),l=ca(o.endTime);return s>i||l<n?!1:jP(i,l)>=t}return{enoughTime:r}}function Gwe(t){let e=mn(t,[{periodStart:!0,date:!0},{courts:!0,_ofType:bl}]);if(e.error)return e;let{averageMatchUpMinutes:i,includeBookingTypes:n,periodStart:r,date:a}=t,o=t.courts,s=ca(r),l=M5(s,i),{enoughTime:c}=H5e({averageMatchUpMinutes:i,includeBookingTypes:n,periodStartTime:s,periodEndTime:l});return{availableToScheduleCount:((o==null?void 0:o.filter(u=>{if(!Array.isArray(u.dateAvailability))return!1;let d=VR({date:a,court:u});return!!(d&&c(d))}))||[]).length,...ue}}function UF(t){var e;let{remainingScheduleTimes:i=[],clearScheduleDates:n,periodLength:r=30,scheduleDate:a,courts:o=[]}=t,{bookings:s=[]}=t;if(!Array.isArray(o)||!o.length)return{error:Me,courts:o};if(!Array.isArray(s))return{error:f_};if(!Kl(a))return{error:Cs};n&&(Array.isArray(n)?n.includes(a)&&(s=[]):s=[]);let{courtBookings:l,unassignedBookings:c}=s.reduce((h,f)=>{let{courtId:m}=f;return m?h.courtBookings[m]?h.courtBookings[m].push(f):h.courtBookings[m]=[f]:h.unassignedBookings.push(f),h},{courtBookings:{},unassignedBookings:[]}),u=o.map((h,f)=>{let{courtId:m,courtName:g}=h,v=l[m]||[],y=VR({date:a,court:h})||{},{bookings:b=[],startTime:I,endTime:T,date:w}=y,S=[i[f]&&{startTime:I,endTime:i[f]},...$t(b,!1,!0),...v].filter(Boolean);return{courtId:m,courtName:g,dateAvailability:{bookings:S,startTime:I,endTime:T,date:w}}});c.sort((h,f)=>on(h.startTime)-on(f.startTime));let d=()=>u.map(h=>{let f=h.dateAvailability,{timeSlots:m=[]}=NU({courtDate:f});return{courtName:h.courtName,courtId:h.courtId,timeSlots:m}}).flat(),p=[];for(let h of c){let{startTime:f,endTime:m,averageMinutes:g,recoveryMinutes:v,matchUpId:y}=h,b=on(f),I=on(m),T=d().reduce((w,{courtId:S,courtName:D,timeSlots:E})=>{let C;return E.find(({startTime:P,endTime:R})=>{C=on(P)-b;let N=b>=on(P);return I<=on(R)&&w.startDifference!==0&&((C===0||C+r>=0)&&(w.startDifference===void 0||C<w.startDifference)||N)})?{courtName:D,courtId:S,startDifference:C}:w},{});if(T.courtId){let w={averageMinutes:g,recoveryMinutes:v,matchUpId:y,startTime:f,endTime:m};p.push(w),(e=u.find(({courtId:S})=>S===T.courtId))==null||e.dateAvailability.bookings.push(w)}else console.log({unassignedBooking:h})}return{virtualCourts:u.map(({courtId:h,courtName:f,dateAvailability:m})=>({dateAvailability:[m],courtName:f,courtId:h})),assignedBookings:p}}function DF({averageMatchUpMinutes:t,periodLength:e=30,recoveryMinutes:i}){let n=(t||90)+(i||0);return e>n?n:e||30}function Hwe(t){let{startTime:e="8:00",endTime:i="20:30",count:n=10,date:r}=t??{};return Ct(0,n).map(()=>({dateAvailability:[{date:r,startTime:e,endTime:i}]}))}function YS({scheduleDate:t,startTime:e,endTime:i,courts:n}){let r=e&&"startTime"||i&&"endTime"||void 0;return n.reduce((a,o)=>{let s=VR({date:t,court:o}),l=r&&((s==null?void 0:s[r])||o[r]);return l&&(!a||e&&on(l)<on(a)||i&&on(l)>on(a))?l:a},void 0)}function z5e({averageMinutes:t,startTime:e,endTime:i,courts:n,date:r}){e=e||YS({courts:n,scheduleDate:r,startTime:!0}),i=i||YS({courts:n,scheduleDate:r,endTime:!0});let a;if(e&&i){let o=ca(e),s=ca(i);for(let l of n||[]){if(!Array.isArray(l.dateAvailability))continue;let c=VR({court:l,date:r}),{timeSlots:u}=NU({courtDate:c});u==null||u.forEach(d=>{let p=ca(d.startTime),h=ca(d.endTime);if(p>s||p<o||h<o)return!1;if(jP(p,h)>=t){let f=rr(p.toISOString());(!a||f<a)&&(a=f)}})}}return{firstTimeSlotStartTime:a}}function g7(t){let e=mn(t,[{courts:!0,_ofType:bl}]);if(e.error)return e;let{date:i=P5(),startTime:n="08:00",endTime:r="19:00",periodLength:a,courts:o}=t,{calculateStartTimeFromCourts:s=!0,remainingScheduleTimes:l,averageMatchUpMinutes:c,clearScheduleDates:u,courtsCount:d,bookings:p}=t;a=a||DF({averageMatchUpMinutes:c}),i=Ci(i),n=rr(n),r=rr(r);let h=0,f=0,m=0,g=0,v=0;!o&&d&&(o=Hwe({startTime:n,endTime:r,count:d,date:i}));let{virtualCourts:y}=UF({remainingScheduleTimes:l,clearScheduleDates:u,scheduleDate:i,periodLength:a,bookings:p,courts:o}),{firstTimeSlotStartTime:b}=z5e({averageMinutes:c,courts:y,startTime:n,endTime:r,date:i});s&&b&&(n=b||n);let I=on(n),T=on(r)-I,w=Math.floor(T/a),S=Ct(0,w+1).map(D=>{let E=I+D*a,C=HGe(E),P=Gwe({courts:y??[],averageMatchUpMinutes:c,periodStart:C,date:i});if(P.error)return{error:P.error};let{availableToScheduleCount:R=0}=P,N=R>f?R-f:0;v+=D?R:0;let M=D?v/D:R,A=a*M/c,_=D?A*(D-1)+M:M,x=R?f&&_-h||N:0;h=_,f=R,m+=x;let O=ai(m)-g;return g+=O,{periodStart:C,add:O,availableToScheduleCount:R,newCourts:N,totalMatchUps:g}});return{scheduleTimes:S.reduce((D,E)=>{let C=Ct(0,E.add).map(()=>({scheduleTime:E.periodStart}));return D.concat(...C)},[]).flat(),timingProfile:S,totalMatchUps:g}}var zwe={getCourtsAvailableAtPeriodStart:Gwe,generateTimeSlots:NU,getScheduleTimes:g7,courtGenerator:Hwe},q5e=zwe,qwe={};zi(qwe,{isValid:()=>Fl,isValidMatchUpFormat:()=>Fl,parse:()=>Zs,stringify:()=>jL});var Wwe={};zi(Wwe,{allCompetitionMatchUps:()=>Ud,allDrawMatchUps:()=>Hs,allEventMatchUps:()=>pm,allTournamentMatchUps:()=>co,analyzeMatchUp:()=>RE,applyLineUps:()=>m0e,assignMatchUpSideParticipant:()=>Ywe,assignTieMatchUpParticipantId:()=>H_,bulkMatchUpStatusUpdate:()=>d0e,calculateWinCriteria:()=>Tw,checkInParticipant:()=>y7,checkMatchUpIsComplete:()=>_v,checkOutParticipant:()=>v7,competitionScheduleMatchUps:()=>FR,disableTieAutoCalc:()=>l0e,drawMatchUps:()=>t7,enableTieAutoCalc:()=>a0e,eventMatchUps:()=>mF,findMatchUp:()=>B8,getAllDrawMatchUps:()=>wa,getAllStructureMatchUps:()=>Sn,getCheckedInParticipantIds:()=>dw,getCompetitionMatchUps:()=>PE,getEventMatchUpFormatTiming:()=>q8,getMatchUpCompetitiveProfile:()=>aR,getMatchUpContextIds:()=>X8,getMatchUpDailyLimits:()=>vF,getMatchUpDailyLimitsUpdate:()=>W8,getMatchUpDependencies:()=>Ku,getMatchUpFormat:()=>J8,getMatchUpFormatTiming:()=>sR,getMatchUpFormatTimingUpdate:()=>z8,getMatchUpScheduleDetails:()=>RL,getMatchUpType:()=>ML,getMatchUpsStats:()=>Q8,getModifiedMatchUpFormatTiming:()=>fF,getParticipantResults:()=>ER,getPredictiveAccuracy:()=>Z8,getRoundMatchUps:()=>Rs,getRounds:()=>e7,isValidMatchUpFormat:()=>Fl,matchUpActions:()=>YL,mutate:()=>Kwe,participantScheduledMatchUps:()=>K8,query:()=>swe,removeDelegatedOutcome:()=>o0e,removeMatchUpSideParticipant:()=>w7,removeTieMatchUpParticipantId:()=>Xwe,replaceTieMatchUpParticipantId:()=>I7,resetAdHocMatchUps:()=>h0e,resetMatchUpLineUps:()=>C7,resetScorecard:()=>R7,resetTieFormat:()=>P7,setDelegatedOutcome:()=>p0e,setMatchUpFormat:()=>c0e,setMatchUpStatus:()=>GR,setOrderOfFinish:()=>f0e,substituteParticipant:()=>s0e,tallyParticipantResults:()=>CU,toggleParticipantCheckInState:()=>EF,tournamentMatchUps:()=>gF,updateTieMatchUpScore:()=>hm,validMatchUp:()=>EL,validMatchUps:()=>Zc});var Kwe={};zi(Kwe,{applyLineUps:()=>m0e,assignMatchUpSideParticipant:()=>Ywe,assignTieMatchUpParticipantId:()=>H_,bulkMatchUpStatusUpdate:()=>d0e,checkInParticipant:()=>y7,checkOutParticipant:()=>v7,disableTieAutoCalc:()=>l0e,enableTieAutoCalc:()=>a0e,findMatchUp:()=>B8,removeDelegatedOutcome:()=>o0e,removeMatchUpSideParticipant:()=>w7,removeTieMatchUpParticipantId:()=>Xwe,replaceTieMatchUpParticipantId:()=>I7,resetAdHocMatchUps:()=>h0e,resetMatchUpLineUps:()=>C7,resetScorecard:()=>R7,resetTieFormat:()=>P7,setDelegatedOutcome:()=>p0e,setMatchUpFormat:()=>c0e,setMatchUpStatus:()=>GR,setOrderOfFinish:()=>f0e,substituteParticipant:()=>s0e,toggleParticipantCheckInState:()=>EF,updateTieMatchUpScore:()=>hm});function Ywe({tournamentRecord:t,drawDefinition:e,participantId:i,sideNumber:n,matchUpId:r,event:a}){var o,s;if(i&&typeof i!="string")return{error:vp};if(!e)return{error:Lt};if(!r)return{error:_o};let l=n===void 0;if(l&&(n=1),![1,2].includes(n))return fe({result:{error:Me,context:{sideNumber:n}}});let{matchUp:c,structure:u}=ar({drawDefinition:e,matchUpId:r,event:a});if(!c)return{error:qo};if(!(!(u!=null&&u.structures)&&!(e.drawType&&e.drawType!==_u)&&!((o=u==null?void 0:u.matchUps)!=null&&o.find(({roundPosition:d})=>!!d))))return{error:G4};if(!i&&((s=c==null?void 0:c.score)!=null&&s.scoreStringSide1||Ga.includes(c==null?void 0:c.matchUpstatus)||c!=null&&c.matchUpStatus&&[da,Ca].includes(c.matchUpStatus)))return{error:eL,info:"matchUp has completed status or score"};if(c){if(c.sides=[1,2].map(d=>{var p;let h=((p=c.sides)==null?void 0:p.find(f=>f.sideNumber===d))??{sideNumber:d};return n===d?{...h,participantId:i}:h}),l)for(let d of c.sides)d.sideNumber&&(d.sideNumber=3-d.sideNumber);sn({tournamentId:t==null?void 0:t.tournamentId,context:"assignSideParticipant",drawDefinition:e,matchUp:c})}return{...ue,sidesSwapped:l}}function ic({removePriorValues:t,tournamentRecord:e,duplicateValues:i,drawDefinition:n,disableNotice:r,matchUpId:a,timeItem:o,event:s}){let{matchUp:l}=ar({drawDefinition:n,event:s,matchUpId:a});if(!l)return{error:qo};let c=Vg({removePriorValues:t,element:l,duplicateValues:i,timeItem:o});return r||sn({tournamentId:e==null?void 0:e.tournamentId,eventId:s==null?void 0:s.eventId,context:"addTimeItem",drawDefinition:n,matchUp:l}),c}function v7(t){var e;let i=[{[Lh]:!0},{[Md]:!0},{[wh]:!0},{[_y]:!0}],n=mn(t,i);if(n.error)return n;let r=BR(t,[{[VP]:Og,attr:{[D5]:!0}}]);if(r.error)return r;let{tournamentRecord:a,drawDefinition:o,participantId:s,matchUpId:l}=t,c=(e=r==null?void 0:r.matchUp)==null?void 0:e.matchUp,{matchUpStatus:u,score:d}=c??{};if(u&&$5.includes(u)||u&&Ga.includes(u)||uo({score:d}))return{error:Cfe};let p=dw({matchUp:c});if(p!=null&&p.error)return p;let{checkedInParticipantIds:h,allRelevantParticipantIds:f}=p??{};if(!(f!=null&&f.includes(s)))return{error:vp};if(!(h!=null&&h.includes(s)))return{error:Qfe};let m=Gge({matchUp:c});if(m!=null&&m.error)return m;let{sideParticipantIds:g,nestedIndividualParticipantIds:v}=m??{},y=g==null?void 0:g.indexOf(s);return y!==void 0&&[0,1].includes(y)&&((v==null?void 0:v[y])??[]).forEach(b=>{ic({drawDefinition:o,matchUpId:l,timeItem:{itemType:C_,itemValue:b}})}),ic({tournamentRecord:a,drawDefinition:o,matchUpId:l,timeItem:{itemValue:s,itemType:C_}}),{...ue,checkedOut:!0}}function y7(t){var e;let i=[{[Lh]:!0},{[Md]:!0},{[wh]:!0},{[_y]:!0}],n=mn(t,i);if(n[kb])return n;let r=BR(t,[{[VP]:Og,attr:{[D5]:!0}}]);if(r[kb])return r;let{tournamentRecord:a,drawDefinition:o,participantId:s,matchUpId:l}=t,c=dw({matchUp:(e=r==null?void 0:r.matchUp)==null?void 0:e.matchUp});if(c!=null&&c.error)return c;let{checkedInParticipantIds:u,allRelevantParticipantIds:d}=c??{};if(!(d!=null&&d.includes(s)))return{[kb]:vp};let p={...ue,checkedIn:!0};return u!=null&&u.includes(s)||ic({tournamentRecord:a,drawDefinition:o,matchUpId:l,timeItem:{itemValue:s,itemType:E_}}),p}function EF(t){var e,i;let n=mn(t,[{[wh]:!0,[Md]:!0,[_y]:!0}]);if(n.error)return n;let r=t.tournamentId??t.activeTournamentId,a=t.tournamentRecord??(r&&((e=t.tournamentRecords)==null?void 0:e[r]));if(!a)return{error:it};let o=(i=BR(t,[{[VP]:Og,attr:{[D5]:!0},[kb]:qo}]).matchUp)==null?void 0:i.matchUp;if(!o)return{error:qo};let{checkedInParticipantIds:s=[]}=dw({matchUp:o}),{participantId:l,matchUpId:c,drawDefinition:u}=t;return l&&s.includes(l)?v7({tournamentRecord:a,drawDefinition:u,participantId:l,matchUpId:c,matchUp:o}):y7({tournamentRecord:a,drawDefinition:u,participantId:l,matchUpId:c,matchUp:o})}function b7({tournamentRecord:t,drawDefinition:e,tieMatchUpId:i,event:n}){var r,a;if(!t)return{error:it};if(!e)return{error:Rd};if(!n)return{error:kl};let o=ko({drawDefinition:e}),{matchUp:s}=ar({matchUpId:i,drawDefinition:e,matchUpsMap:o});if(!s)return{error:qo};let{matchUp:l,structure:c}=ar({tournamentParticipants:t.participants,matchUpId:i,inContext:!0,drawDefinition:e,matchUpsMap:o,event:n});if(!l)return{error:qo};let{collectionPosition:u,drawPositions:d,collectionId:p,matchUpTieId:h,matchUpType:f}=l;if(f&&!NL([Mr,Zn],f))return{error:Ws};let{positionAssignments:m}=jn({structure:c}),g=m==null?void 0:m.filter(D=>d==null?void 0:d.includes(D.drawPosition)),{matchUp:v}=ar({matchUpId:h,drawDefinition:e,matchUpsMap:o}),y=((r=v==null?void 0:v.sides)==null?void 0:r.map(Wi))??[],b=(g==null?void 0:g.map(Wi))??[],I=[...y,...b],{participants:T}=Yr({tournamentRecord:t,participantFilters:{participantTypes:[Hn],participantIds:I}}),{matchUp:w}=ar({matchUpId:h,inContext:!0,drawDefinition:e,matchUpsMap:o}),S=(a=ns({matchUp:v,drawDefinition:e,structure:c,event:n}))==null?void 0:a.tieFormat;return{inContextDualMatchUp:w,inContextTieMatchUp:l,relevantAssignments:g,collectionPosition:u,teamParticipants:T,collectionId:p,matchUpType:f,dualMatchUp:v,tieMatchUp:s,tieFormat:S,structure:c,...ue}}function I7(t){var e,i,n,r,a,o,s,l,c,u,d,p,h,f,m,g;let v=b7(t);if(v.error)return v;let y="replaceTieMatchUpParticipantid",{existingParticipantId:b,tournamentRecord:I,newParticipantId:T,drawDefinition:w,substitution:S,event:D}=t;if(!b||!T)return fe({result:{error:Ra},stack:y});if(b===T)return{...ue};let{inContextDualMatchUp:E,inContextTieMatchUp:C,collectionPosition:P,collectionId:R,dualMatchUp:N,tieMatchUp:M,tieFormat:A}=v,_=C==null?void 0:C.matchUpType,x=(e=C==null?void 0:C.sides)==null?void 0:e.find(te=>{var he,ae,de;return((he=te.participant)==null?void 0:he.participantId)===b||((de=(ae=te.participant)==null?void 0:ae.individualParticipantIds)==null?void 0:de.includes(b))});if(!x)return{error:Jr};let O=((i=Yr({tournamentRecord:I,participantFilters:{participantIds:[b,T]}}))==null?void 0:i.participants)??[];if(O.length!==2)return fe({result:{error:Ra},stack:y});if(O[0].participantType!==O[1].participantType)return fe({result:{error:Sd},stack:y});let{appliedPolicies:B}=Mn({tournamentRecord:I,drawDefinition:w,event:D}),F=((n=t.policyDefinitions)==null?void 0:n[eo])??(B==null?void 0:B[eo])??UU[eo],G=O.find(({participantId:te})=>te===T);if((t.enforceGender??((r=F==null?void 0:F.participants)==null?void 0:r.enforceGender))!==!1&&[Yn,Ir].includes(C==null?void 0:C.gender)&&(C==null?void 0:C.gender)!==((a=G==null?void 0:G.person)==null?void 0:a.sex))return{error:rU,info:"Gender mismatch"};let H=(o=F==null?void 0:F.processCodes)==null?void 0:o.substitution;MR({tournamentId:I.tournamentId,eventId:D.eventId,inContextDualMatchUp:E,drawDefinition:w,dualMatchUp:N});let $=(s=N==null?void 0:N.sides)==null?void 0:s.find(({sideNumber:te})=>te===x.sideNumber);if(!$)return fe({result:{sideNumber:x.sideNumber,existingParticipantId:b,error:Wo},stack:y});if((c=(l=C==null?void 0:C.sides)==null?void 0:l.flatMap(te=>{var he,ae;return((he=te.participant)==null?void 0:he.individualParticipantIds)||((ae=te.participant)==null?void 0:ae.participantId)||[]}))!=null&&c.includes(T))return fe({result:{error:tL},stack:y});let q=(d=(u=E==null?void 0:E.sides)==null?void 0:u.find(({sideNumber:te})=>te===x.sideNumber))==null?void 0:d.participantId,z=$.lineUp,Z=z==null?void 0:z.find(({participantId:te})=>T===te),Y=z==null?void 0:z.reduce((te,he)=>he.substitutionOrder>te?he.substitutionOrder:te,0),Q=(z==null?void 0:z.map(te=>{var he;let ae=$t(te,!1,!0);if(![b,T].includes(ae.participantId))return ae;if(!S&&[b,T].includes(ae.participantId)&&(ae.collectionAssignments=(he=ae.collectionAssignments)==null?void 0:he.filter(de=>!(de.collectionPosition===P&&de.collectionId===R))),S&&b===ae.participantId&&(ae.collectionAssignments=ae.collectionAssignments.map(de=>de.collectionPosition===P&&de.collectionId===R&&de.substitutionOrder===void 0?{...de,substitutionOrder:Y}:de)),ae.participantId===T){ae.collectionAssignments||(ae.collectionAssignments=[]);let de={collectionId:R,collectionPosition:P};S&&(de.previousParticipantId=b,de.substitutionOrder=(Y??0)+1),ae.collectionAssignments.push(de)}return ae}))??[];if(!Z){let te={collectionId:R,collectionPosition:P};S&&(te.substitutionOrder=(Y??0)+1,te.previousParticipantId=b);let he={collectionAssignments:[te],participantId:T};Q.push(he)}let X=_===Zn,{assignedParticipantIds:oe}=P_({lineUp:z,collectionPosition:P,collectionId:R}),{assignedParticipantIds:re}=P_({lineUp:Q,collectionPosition:P,collectionId:R});if($.lineUp=Q,q&&A){let te=yw({participantId:q,lineUp:Q,drawDefinition:w,tieFormat:A});if(te.error)return fe({result:te,stack:y})}else console.log("team participantId not found");let me,se;if(X){let{tournamentRecord:te}=t,he=Ou({participantIds:re,tournamentRecord:te});if(!he.participant){let de=Up({returnParticipant:!0,pairOverride:!0,tournamentRecord:te,participant:{participantRole:jo,individualParticipantIds:re,participantType:Ui}});if(de.error)return fe({result:de,stack:y});me=(p=de.participant)==null?void 0:p.participantId}he=Ou({participantIds:oe,tournamentRecord:te});let ae=(h=he.participant)==null?void 0:h.participantId;ae&&gw({participantIds:[ae],tournamentRecord:te}).success&&(se=ae)}if(S||((f=x.substitutions)==null?void 0:f.length)===1){if(S)H&&M&&(M.processCodes=ki([...(M==null?void 0:M.processCodes)??[],...H]));else for(let te of H||[]){let he=(m=M==null?void 0:M.processCodes)==null?void 0:m.lastIndexOf(te);he!==void 0&&((g=M==null?void 0:M.processCodes)==null||g.splice(he,1))}M&&sn({tournamentId:I==null?void 0:I.tournamentId,matchUp:M,context:y,drawDefinition:w})}return N&&sn({tournamentId:I==null?void 0:I.tournamentId,matchUp:N,context:y,drawDefinition:w}),{...ue,modifiedLineUp:Q,participantRemoved:se,participantAdded:me}}function Zwe({collectionPosition:t,teamParticipantId:e,dualMatchUpSide:i,drawDefinition:n,participantIds:r,collectionId:a}){var o;if(!a||!t||!Array.isArray(r))return{modifiedLineUp:(i==null?void 0:i.lineUp)||[],error:Me};let s=(i==null?void 0:i.lineUp)||((o=sy({participantId:e,drawDefinition:n}))==null?void 0:o.lineUp),l=[],c=[];return{modifiedLineUp:(s==null?void 0:s.map(u=>{var d;if(!r.includes(u.participantId))return u;let p=(d=u.collectionAssignments)==null?void 0:d.filter(h=>{let f=h.collectionId===a&&h.collectionPosition===t;return f&&(h.previousParticipantId&&l.push(h.previousParticipantId),c.push({participantId:u.participantId,...h})),!f});return{participantId:u.participantId,collectionAssignments:p}}).filter(Boolean))||[],assignmentsRemoved:c,previousParticipantIds:l}}function W5e({individualParticipantIds:t,groupingParticipantId:e,tournamentRecord:i}){var n,r;let a=(i.events||[]).filter(s=>{var l;return(s==null?void 0:s.eventType)===Fa&&((l=s==null?void 0:s.entries)==null?void 0:l.some(c=>c.participantId===e))}),o=s=>!t.includes(s.participantId);for(let s of a){s.entries=(s.entries||[]).filter(o);let{flightProfile:l}=Xr({event:s});(n=l==null?void 0:l.flights)==null||n.forEach(c=>{c.drawEntries=(c.drawEntries||[]).filter(o)}),(r=s==null?void 0:s.drawDefinitions)==null||r.forEach(c=>{c.entries=(c.entries||[]).filter(o)})}return{...ue}}function CF({individualParticipantIds:t,groupingParticipantId:e,removeFromOtherTeams:i,tournamentRecord:n}){let r="addIndividualParticipantIds";if(!n)return fe({result:{error:it},stack:r});if(!e||!t)return fe({result:{error:Ht},stack:r});let a=n.participants??[],o=a.find(d=>d.participantId===e);if(!o)return fe({result:{error:Jr},stack:r});if(o!=null&&o.participantType&&![Hn,cc].includes(o.participantType))return fe({context:{participantType:o.participantType},result:{error:Sd},stack:r});let s=t.filter(d=>{var p;return((p=a.find(h=>h.participantId===d))==null?void 0:p.participantType)!==Ki});if(s.length)return fe({result:{error:wu,invalidParticipantIds:s},stack:r});o.individualParticipantIds||(o.individualParticipantIds=[]);let l=o.individualParticipantIds,c=t.filter(d=>!l.includes(d));c.length&&(i&&kL({individualParticipantIds:c,tournamentRecord:n}),o.individualParticipantIds=o.individualParticipantIds.concat(...c));let{topics:u}=Gu();if(u.includes(No)){let d=a.find(({participantId:p})=>p===e);tn({topic:No,payload:{participants:[d]}})}return W5e({individualParticipantIds:t,groupingParticipantId:e,tournamentRecord:n}),{groupingParticipant:$t(o,!1,!0),added:c.length,...ue}}function PF(t){let{updateParticipantName:e=!0,groupingParticipantId:i,removeFromOtherTeams:n,tournamentRecord:r,pairOverride:a,participant:o}=t;if(!r)return{error:it};if(!o)return{error:nw};if(!o.participantId)return Up({tournamentRecord:r,participant:o});let{participant:s}=jy({participantId:o.participantId,tournamentRecord:r});if(!s)return Up({tournamentRecord:r,participant:o});let{participantRoleResponsibilties:l,individualParticipantIds:c,participantOtherName:u,participantName:d,participantRole:p,participantType:h,onlineResources:f,contacts:m,person:g}=o;if(h&&s.participantType!==h)return{error:Wfe};let v={};if(m&&(v.contacts=m),f&&(v.onlineResources=f),d&&typeof d=="string"&&(v.participantName=d),u&&typeof u=="string"&&(v.participantOtherName=u),Array.isArray(c)){let{participants:y}=Yr({participantFilters:{participantTypes:[Ki]},tournamentRecord:r}),b=y==null?void 0:y.map(Wi);if(b){let I=c.filter(T=>typeof T=="string"&&b.includes(T));([cc,Jn].includes(h||s.participantType)||h===Ui&&(I.length===2||a))&&(v.individualParticipantIds=I),s.participantType===K1.PAIR&&e&&(v.participantName=K5e({individualParticipants:y,newValues:v}))}}return Object.keys(R6).includes(p)&&(v.participantRole=p),Object.keys(K1).includes(h)&&(v.participantType=h),Array.isArray(l)&&(v.participantRoleResponsibilties=l),s.participantType===K1.INDIVIDUAL&&g&&Y5e({updateParticipantName:e,existingParticipant:s,newValues:v,person:g}),Object.assign(s,qt(v)),i&&CF({individualParticipantIds:[s.participantId],groupingParticipantId:i,removeFromOtherTeams:n,tournamentRecord:r}),tn({topic:No,payload:{tournamentId:r.tournamentId,participants:[s]}}),{participant:$t(s),...ue}}function K5e({individualParticipants:t,newValues:e}){let i=e.individualParticipantIds,n=t.filter(({participantId:r})=>i.includes(r)).map(({person:r})=>r==null?void 0:r.standardFamilyName).filter(Boolean).sort().join("/");return i.length===1&&(n+="/Unknown"),n}function Y5e({updateParticipantName:t,existingParticipant:e,newValues:i,person:n}){let r={},{standardFamilyName:a,standardGivenName:o,nationalityCode:s,personId:l,sex:c}=n;c&&Object.keys(w6).includes(c)&&(r.sex=c);let u;if(l&&typeof l=="string"&&(r.personId=l),s&&typeof s=="string"&&(Z5e(s)||s==="")&&(r.nationalityCode=s),a&&typeof a=="string"&&a.length>1&&(r.standardFamilyName=a,u=!0),o&&typeof o=="string"&&o.length>1&&(r.standardGivenName=o,u=!0),u&&t){let d=`${r.standardGivenName} ${r.standardFamilyName}`;i.participantName=d}Object.assign(e.person,r)}function Z5e(t){return Vm.flatMap(({iso:e,ioc:i})=>[e,i]).filter(Boolean).includes(t)}function H_(t){var e,i,n,r,a,o,s,l,c,u,d,p,h,f,m,g,v,y,b,I;let T=b7(t);if(T.error)return T;let w="assignTieMatchUpParticipantId",S=t.teamParticipantId,{tournamentRecord:D,drawDefinition:E,participantId:C,event:P}=t;if(!C)return fe({result:{error:Ra},stack:w});if(t.sideNumber&&![1,2].includes(t.sideNumber))return fe({result:{error:e5},stack:w});let{inContextDualMatchUp:R,inContextTieMatchUp:N,relevantAssignments:M,collectionPosition:A,teamParticipants:_,collectionId:x,matchUpType:O,dualMatchUp:B,tieFormat:F}=T;if((i=(e=N==null?void 0:N.sides)==null?void 0:e.flatMap(Te=>{var _e,Ve;return((_e=Te.participant)==null?void 0:_e.individualParticipantIds)||((Ve=Te.participant)==null?void 0:Ve.participantId)||[]}))!=null&&i.includes(C))return fe({result:{...ue},stack:w});S=S??(t.sideNumber?(r=(n=R==null?void 0:R.sides)==null?void 0:n.find(Te=>Te.sideNumber===t.sideNumber))==null?void 0:r.participantId:void 0);let G=(o=(a=Yr({participantFilters:{participantIds:[C]},tournamentRecord:D}))==null?void 0:a.participants)==null?void 0:o[0];if(!G)return fe({result:{error:Jr},stack:w});let{appliedPolicies:H}=Mn({tournamentRecord:D,drawDefinition:E,event:P}),$=((s=t.policyDefinitions)==null?void 0:s[eo])??(H==null?void 0:H[eo])??UU[eo];if((t.enforceGender??((l=$==null?void 0:$.participants)==null?void 0:l.enforceGender))!==!1&&[Yn,Ir].includes(N==null?void 0:N.gender)&&(N==null?void 0:N.gender)!==((c=G.person)==null?void 0:c.sex))return{error:rU,info:"Gender mismatch"};let{individualParticipantIds:q,participantType:z}=G;if(Hr(Mr)(O)&&z!==Ki)return{error:Sd};let Z=z===Ki?[C]:q,Y=S&&(_==null?void 0:_.find(({participantId:Te})=>Te===S))||(_==null?void 0:_.find(({individualParticipantIds:Te})=>Ps(Z,Te)));if(!Y)return{error:u5};if(S||(S=Y.participantId),!S)return{error:Jr};let Q=(u=M==null?void 0:M.find(Te=>Te.participantId===(Y==null?void 0:Y.participantId)))==null?void 0:u.drawPosition,X=(p=(d=B==null?void 0:B.sides)==null?void 0:d.find(Te=>Te.participantId===S))==null?void 0:p.sideNumber,oe=(f=(h=N==null?void 0:N.sides)==null?void 0:h.find(Te=>Q&&Te.drawPosition===Q))==null?void 0:f.sideNumber,re=X??oe??t.sideNumber;if(!F)return{error:xP};if(!((m=F.collectionDefinitions)!=null&&m.find(Te=>Te.collectionId===x)))return{error:Bfe};MR({tournamentId:D.tournamentId,eventId:P.eventId,inContextDualMatchUp:R,drawDefinition:E,dualMatchUp:B});let me=(g=B==null?void 0:B.sides)==null?void 0:g.find(Te=>Te.sideNumber===re),se=(v=N==null?void 0:N.sides)==null?void 0:v.find(Te=>Te.sideNumber===re),te=(I=(b=(me==null?void 0:me.lineUp)??((y=sy({participantId:S,drawDefinition:E}))==null?void 0:y.lineUp))==null?void 0:b.filter(Te=>{var _e;return(_e=Te.collectionAssignments)==null?void 0:_e.find(Ve=>Ve.collectionPosition===A&&Ve.collectionId===x&&!Ve.previousParticipantId)}))==null?void 0:I.map(Te=>Te==null?void 0:Te.participantId),he=(te==null?void 0:te.length)>1&&te||(z===Ui?G.individualParticipantIds:[C]),ae=Zwe({collectionPosition:A,teamParticipantId:S,dualMatchUpSide:me,drawDefinition:E,participantIds:he,collectionId:x});if(ae.error)return fe({result:ae,stack:w});let{modifiedLineUp:de}=ae,Ie;if(O===Zn){if(z!==Ui){let Te=g$({collectionPosition:A,teamParticipantId:S,drawDefinition:E,modifiedLineUp:de,participantId:C,collectionId:x,tieFormat:F});if(Te!=null&&Te.error)return fe({result:Te,stack:w});if(Te=De({side:se}),Te.error)return Te;Ie=Te.deletedParticipantId,me&&(me.lineUp=de),B&&sn({tournamentId:D==null?void 0:D.tournamentId,matchUp:B,context:w,drawDefinition:E})}else if(z===Ui)for(let Te of he)g$({collectionPosition:A,teamParticipantId:S,drawDefinition:E,modifiedLineUp:de,participantId:Te,collectionId:x,tieFormat:F})}else{let Te=g$({collectionPosition:A,teamParticipantId:S,drawDefinition:E,modifiedLineUp:de,participantId:C,collectionId:x,tieFormat:F});if(Te!=null&&Te.error)return Te}if(me&&(me.lineUp=de),B&&sn({tournamentId:D==null?void 0:D.tournamentId,matchUp:B,context:w,drawDefinition:E}),Ie){let{error:Te}=gw({participantIds:[Ie],tournamentRecord:D});Te&&console.log("cleanup")}return{...ue,modifiedLineUp:de};function De({side:Te}){let _e;if(Te.participant){let Ve=Te.participant.individualParticipantIds||[];if(Ve.filter(Boolean).length===1){let{participant:ot}=Ou({participantIds:Ve,tournamentRecord:D});Ve.push(C);let{participant:St}=Ou({participantIds:Ve,tournamentRecord:D});if(!St&&ot){ot.individualParticipantIds=Ve;let nt=PF({pairOverride:!0,tournamentRecord:D,participant:ot});if(nt.error)return nt}else _e=ot==null?void 0:ot.participantId}}else{let Ve=Up({participant:{individualParticipantIds:[C],participantRole:jo,participantType:Ui},pairOverride:!0,tournamentRecord:D});if(Ve.error)return Ve}return{...ue,deletedParticipantId:_e}}}function g$({collectionPosition:t,teamParticipantId:e,drawDefinition:i,modifiedLineUp:n,participantId:r,collectionId:a,tieFormat:o}){var s,l;let c=(s=sy({participantId:e,drawDefinition:i}))==null?void 0:s.lineUp,u=(l=n||c)==null?void 0:l.find(p=>(p==null?void 0:p.participantId)===r),d={collectionId:a,collectionPosition:t};if(u)u.collectionAssignments.push(d);else{let p={collectionAssignments:[d],participantId:r};n.push(p)}return yw({participantId:e,lineUp:n,drawDefinition:i,tieFormat:o})}function Xwe(t){var e,i,n,r,a,o,s,l,c,u,d,p,h,f,m,g,v,y,b,I,T,w;let{tournamentRecord:S,drawDefinition:D,participantId:E,event:C}=t,P="removeTieMatchUpParticiapantId";if(!E)return fe({result:{error:Ra},stack:P});let R=b7(t);if(R.error)return R;let{appliedPolicies:N}=Mn({tournamentRecord:S,drawDefinition:D,event:C}),M=(n=(i=((e=t.policyDefinitions)==null?void 0:e[eo])??(N==null?void 0:N[eo])??UU[eo])==null?void 0:i.processCodes)==null?void 0:n.substitution,{inContextDualMatchUp:A,inContextTieMatchUp:_,relevantAssignments:x,collectionPosition:O,teamParticipants:B,collectionId:F,matchUpType:G,dualMatchUp:H,tieMatchUp:$,tieFormat:q}=R;if(!H)return fe({result:{error:cl},stack:P});let z=(r=_==null?void 0:_.sides)==null?void 0:r.find(me=>{var se,te,he;return((se=me.participant)==null?void 0:se.participantId)===E||((he=(te=me.participant)==null?void 0:te.individualParticipantIds)==null?void 0:he.includes(E))});if(!z)return fe({result:{error:Jr},stack:P});if(!((a=z.substitutions)!=null&&a.length)&&(uo({score:_==null?void 0:_.score})||_!=null&&_.winningSide))return fe({result:{error:wme},stack:P});let Z=(s=(o=A==null?void 0:A.sides)==null?void 0:o.find(({sideNumber:me})=>me===z.sideNumber))==null?void 0:s.participantId;if(!Z)return fe({result:{error:Jr},stack:P});let Y=(c=(l=Yr({participantFilters:{participantIds:[E]},tournamentRecord:S}))==null?void 0:l.participants)==null?void 0:c[0];if(!Y)return fe({result:{error:Jr},stack:P});if(G===Mr&&Y.participantType===Ui)return fe({result:{error:rU},stack:P});let Q=Y.participantType===Ki?[E]:Y.individualParticipantIds;MR({tournamentId:S.tournamentId,eventId:C.eventId,inContextDualMatchUp:A,drawDefinition:D,dualMatchUp:H});let X=(u=H.sides)==null?void 0:u.find(({sideNumber:me})=>me===z.sideNumber);if(!X&&(((d=H.sides)==null?void 0:d.filter(({lineUp:me})=>!me).length)||0)<2){let me=B==null?void 0:B.map(({participantId:se})=>{var te;return{drawPosition:(te=x==null?void 0:x.find(he=>he.participantId===se))==null?void 0:te.drawPosition,teamParticipantId:se}});X=(p=H.sides)==null?void 0:p.find(se=>{var te;return((te=me==null?void 0:me.find(({drawPosition:he})=>he===se.drawPosition))==null?void 0:te.teamParticipantId)===Z})}if(!X)return fe({result:{error:Jr,context:{participantId:E}}});let{modifiedLineUp:oe,previousParticipantIds:re}=Zwe({collectionPosition:O,teamParticipantId:Z,dualMatchUpSide:X,participantIds:Q,drawDefinition:D,collectionId:F});if(X.lineUp=oe,Z&&q&&yw({participantId:Z,lineUp:oe,drawDefinition:D,tieFormat:q}),G===Zn&&Y.participantType===Ki){let me=(h=_==null?void 0:_.sides)==null?void 0:h.find(he=>he.sideNumber===(X==null?void 0:X.sideNumber)),{participantId:se}=me??{},te=se&&((m=(f=Yr({participantFilters:{participantIds:[se]},tournamentRecord:S,withDraws:!0}))==null?void 0:f.participants)==null?void 0:m[0]);if(te){let he=((g=te==null?void 0:te.individualParticipantIds)==null?void 0:g.filter(ae=>ae!==E))??[];if(re&&he.push(...re),he.length>2)return fe({result:{error:wu},stack:P});if((v=te.draws)!=null&&v.length){if(he.length===1){let{participant:ae}=Ou({participantIds:he,tournamentRecord:S});if(!ae){let de=Up({participant:{participantRole:jo,individualParticipantIds:he,participantType:Ui},pairOverride:!0,tournamentRecord:S});if(de.error)return fe({result:de,stack:P})}}}else if(he.length){te.individualParticipantIds=he;let ae=PF({participant:te,pairOverride:!0,tournamentRecord:S});if(ae.error)return fe({result:ae,stack:P})}else{let ae=gw({participantIds:[se],tournamentRecord:S});ae.error&&console.log("cleanup",{result:ae})}}else return fe({result:{error:Jr},stack:P})}if(((y=z.substitutions)==null?void 0:y.length)===1&&!((T=(I=(b=_==null?void 0:_.sides)==null?void 0:b.find(me=>me.sideNumber!==z.sideNumber))==null?void 0:I.substitutions)!=null&&T.length)&&(w=$==null?void 0:$.processCodes)!=null&&w.length){for(let me of M||[]){let se=$.processCodes.lastIndexOf(me);$.processCodes.splice(se,1)}sn({tournamentId:S==null?void 0:S.tournamentId,matchUp:$,context:P,drawDefinition:D})}return sn({tournamentId:S==null?void 0:S.tournamentId,matchUp:H,context:P,drawDefinition:D}),{...ue,modifiedLineUp:oe}}function w7(t){var e,i;let n=mn(t,[{[Lh]:!0,[Md]:!0,[_y]:!0}]);if(n.error)return n;let{drawDefinition:r,sideNumber:a,matchUpId:o,event:s}=t;if(a&&![1,2].includes(a))return{error:Me,sideNumber:a};let{matchUp:l,structure:c}=ar({drawDefinition:r,matchUpId:o,event:s});return l?Ll({structure:c})?((e=l.sides)==null||e.forEach(u=>{(!a||u.sideNumber===a)&&delete u.participantId}),sn({tournamentId:(i=t.tournamentRecord)==null?void 0:i.tournamentId,context:"assignSideParticipant",drawDefinition:r,matchUp:l}),{...ue}):{error:G4}:{error:qo}}function X5e({drawDefinition:t,matchUpStatus:e,matchUpsMap:i,winningSide:n,dualMatchUp:r,tieFormat:a,structure:o,matchUp:s,event:l,score:c}){var u;let d=$t(r,void 0,!0);for(let h of(d==null?void 0:d.tieMatchUps)||[])h.matchUpId===s.matchUpId&&(h.winningSide=n,h.score=c,!uo({score:c})&&!e?Object.assign(h,{...$L}):e&&(h.matchUpStatus=e));a=a??((u=ns({matchUp:s,structure:o,drawDefinition:t,event:l}))==null?void 0:u.tieFormat);let{winningSide:p}=RR({matchUp:d,drawDefinition:t,matchUpsMap:i,structure:o,tieFormat:a,event:l});return{projectedWinningSide:p}}function J5e({matchUpStatuses:t=[yn,Rn,fn],drawPositionMatchUps:e,loserDrawPosition:i,sourceMatchUps:n}){var r;let a=e==null?void 0:e.reduce((d,p)=>!d||p.roundNumber>d.roundNumber?p:d,void 0),o=(r=a==null?void 0:a.drawPositions)==null?void 0:r.find(d=>d!==i),s=n.filter(d=>{var p;return(p=d==null?void 0:d.drawPositions)==null?void 0:p.includes(o)}).map(d=>d.matchUpStatus),l=n.filter(d=>{var p;return(p=d==null?void 0:d.drawPositions)==null?void 0:p.includes(i)}).map(d=>d.matchUpStatus),c=Ps(s||[],t),u=Ps(l||[],t);return{sourceMatchUp:a,winnerHadMatchUpStatus:c,winnerMatchUpStatuses:s,loserHadMatchUpStatus:u,loserMatchUpStatuses:l}}function Q5e({inContextDrawMatchUps:t,sourceMatchUpStatus:e,targetDrawPosition:i,tournamentRecord:n,sourceMatchUpId:r,drawDefinition:a,structureId:o,dualMatchUp:s,roundNumber:l,matchUpsMap:c,event:u}){let{structure:d}=pi({drawDefinition:a,structureId:o});if((d==null?void 0:d.structureType)===xs)return{...ue};c=c??ko({drawDefinition:a});let p=((c==null?void 0:c.mappedMatchUps)||{})[o].matchUps,{initialRoundNumber:h}=hI({drawPosition:i,matchUps:p}),f=p==null?void 0:p.filter(g=>{var v;return g.roundNumber>=l&&g.roundNumber!==h&&((v=g.drawPositions)==null?void 0:v.includes(i))}),{positionAssignments:m}=jn({drawDefinition:a,structureId:o});for(let g of f??[])e6e({inContextDrawMatchUps:t,sourceMatchUpStatus:e,positionAssignments:m,targetDrawPosition:i,tournamentRecord:n,sourceMatchUpId:r,drawDefinition:a,dualMatchUp:s,matchUpsMap:c,matchUp:g,event:u});return{...ue}}function e6e({inContextDrawMatchUps:t,positionAssignments:e,sourceMatchUpStatus:i,targetDrawPosition:n,tournamentRecord:r,sourceMatchUpId:a,drawDefinition:o,dualMatchUp:s,matchUpsMap:l,matchUp:c,event:u}){var d,p,h;let f="removeSubsequentDrawPosition";if(s){let g=(p=(d=t.find(({matchUpId:y})=>c.matchUpId===y).sides)==null?void 0:d.find(y=>y.drawPosition===n))==null?void 0:p.sideNumber,v=(h=c.sides)==null?void 0:h.find(y=>y.sideNumber===g);v&&delete v.lineUp}c.drawPositions=(c.drawPositions||[]).map(g=>g===n?void 0:g).filter(Boolean);let m=e.filter(({drawPosition:g})=>{var v;return(v=c.drawPositions)==null?void 0:v.includes(g)}).filter(g=>g.bye).length;return c.matchUpStatus=m&&yn||[fn,Rn].includes(c.matchUpStatus)&&c.matchUpStatus||Kr,[Rn,fn].includes(c.matchUpStatus)&&(c.winningSide=void 0),c.matchUpStatusCodes&&Vve({inContextDrawMatchUps:t,sourceMatchUpStatus:i,sourceMatchUpId:a,matchUpsMap:l,matchUp:c}),sn({tournamentId:r==null?void 0:r.tournamentId,eventId:u==null?void 0:u.eventId,context:`${f}-${n}`,drawDefinition:o,matchUp:c}),{...ue}}function AU(t){let{dualWinningSideChange:e,inContextDrawMatchUps:i,tournamentRecord:n,drawDefinition:r,matchUpStatus:a,matchUpsMap:o,dualMatchUp:s,targetData:l,matchUpId:c,structure:u,event:d}=t,p=!!t.matchUp.collectionId,h=Ll({structure:u}),{drawPositions:f,winningSide:m}=l.matchUp||{};if(!h&&!f)return{error:AP};let{targetLinks:{loserTargetLink:g,winnerTargetLink:v,byeTargetLink:y},targetMatchUps:{loserMatchUp:b,winnerMatchUp:I,byeMatchUp:T}}=l,w=ap({...t,matchUpStatus:a||Kr,removeWinningSide:!0});if(w.error)return w;let S;if(p){let{matchUpTieId:x,matchUpsMap:O}=t;if(S=hm({appliedPolicies:t.appliedPolicies,matchUpId:x,tournamentRecord:n,drawDefinition:r,matchUpsMap:O,event:d}),!e&&!S.removeWinningSide)return{...ue}}if(h)return{...ue};let{matchUps:D}=Sn({afterRecoveryTimes:!1,inContext:!0,drawDefinition:r,matchUpsMap:o,structure:u}),{positionAssignments:E}=Ha({structure:u}),C=m-1,P=1-C,R=f[C],N=f[P],{winnerParticipantId:M,loserParticipantId:A}=(E==null?void 0:E.reduce((x,O)=>(O.drawPosition===N&&(x.loserParticipantId=O.participantId),O.drawPosition===R&&(x.winnerParticipantId=O.participantId),x),{winnerParticipantId:void 0,loserParticipantId:void 0}))||{},_=D.filter(x=>{var O;return(O=x.drawPositions)==null?void 0:O.includes(N)});if(I&&Jwe({sourceMatchUpStatus:a,sourceMatchUpId:c,inContextDrawMatchUps:i,winningDrawPosition:R,winnerParticipantId:M,tournamentRecord:n,winnerTargetLink:v,drawDefinition:r,winnerMatchUp:I,dualMatchUp:s,matchUpsMap:o}),b){let{winnerHadMatchUpStatus:x}=J5e({drawPositionMatchUps:_,loserDrawPosition:N,sourceMatchUps:D}),O=g.linkCondition===Ch;if(x&&O){let F=Math.min(...b.drawPositions);Lj({targetLink:g,inContextDrawMatchUps:i,drawDefinition:r,drawPosition:F,matchUpsMap:o,event:d})}let B=t6e({sourceMatchUpStatus:a,sourceMatchUpId:c,loserParticipantId:A,tournamentRecord:n,loserTargetLink:g,drawDefinition:r,loserMatchUp:b,dualMatchUp:s,matchUpsMap:o,event:d});if(B.error)return B}if(T){let x=Math.min(...T.drawPositions);Lj({sourceMatchUpId:c,targetLink:y,inContextDrawMatchUps:i,drawDefinition:r,drawPosition:x,matchUpsMap:o,event:d})}return{...ue,...S&&{tieMatchUpResult:S}}}function Jwe({inContextDrawMatchUps:t,winningDrawPosition:e,sourceMatchUpStatus:i,winnerParticipantId:n,tournamentRecord:r,winnerTargetLink:a,sourceMatchUpId:o,drawDefinition:s,winnerMatchUp:l,matchUpsMap:c,dualMatchUp:u,event:d}){var p,h;let{structureId:f,roundNumber:m}=l,g="removeDirectedWinner";if(a){let v=a.target.structureId,{structure:y}=pi({drawDefinition:s,structureId:v});if(!y)return{error:Dr};let{positionAssignments:b}=Ha({structure:y});y.seedAssignments=(y.seedAssignments??[]).filter(E=>E.participantId!==n);let I=(p=b==null?void 0:b.find(E=>E.participantId===n))==null?void 0:p.drawPosition,{matchUps:T}=Sn({drawDefinition:s,structure:y,event:d}),w=T.map(E=>E.drawPositions).flat(1/0).filter(Boolean),S=xl(w);if((I?S[I]:void 0)===1)b==null||b.forEach(E=>{E.participantId===n&&delete E.participantId});else{let E=T.filter(({drawPositions:C})=>C.includes(I));console.log("not removing from position assignments since instances > 1",{drawPositionMatchUps:E,winnerTargetLink:a})}let D=(h=c==null?void 0:c.drawMatchUps)==null?void 0:h.find(({matchUpId:E})=>E===l.matchUpId);D&&sn({tournamentId:r==null?void 0:r.tournamentId,eventId:d==null?void 0:d.eventId,matchUp:D,context:g,drawDefinition:s})}return m&&Q5e({targetDrawPosition:e,inContextDrawMatchUps:t,sourceMatchUpStatus:i,tournamentRecord:r,sourceMatchUpId:o,drawDefinition:s,dualMatchUp:u,matchUpsMap:c,roundNumber:m,structureId:f}),{...ue}}function t6e({sourceMatchUpStatus:t,loserParticipantId:e,tournamentRecord:i,loserTargetLink:n,sourceMatchUpId:r,drawDefinition:a,loserMatchUp:o,matchUpsMap:s,dualMatchUp:l,event:c}){var u,d,p;let h="removeDirectedLoser",f=n.target.structureId,{structure:m}=pi({drawDefinition:a,structureId:f});if(!m)return{error:Dr};let{positionAssignments:g}=Ha({structure:m}),v=(u=g==null?void 0:g.find(y=>y.participantId===e))==null?void 0:u.drawPosition;if(g==null||g.forEach(y=>{y.participantId===e&&delete y.participantId}),m.seedAssignments=(m.seedAssignments??[]).filter(y=>y.participantId!==e),l){let y=o==null?void 0:o.sides.reduce((T,w,S)=>w.drawPosition===v?S:T,void 0),b=(d=s==null?void 0:s.drawMatchUps)==null?void 0:d.find(({matchUpId:T})=>T===o.matchUpId),I=(p=b==null?void 0:b.sides)==null?void 0:p[y];I&&(delete I.lineUp,sn({tournamentId:i==null?void 0:i.tournamentId,eventId:c==null?void 0:c.eventId,matchUp:b,context:h,drawDefinition:a}))}return{...ue}}function Lj({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,drawPosition:n,matchUpsMap:r,targetLink:a,event:o}){let s=a.target.structureId;return fR({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,matchUpsMap:r,drawPosition:n,structureId:s,event:o}),{...ue}}function i6e(t){var e,i;let{matchUpFormat:n,score:r}=t,a=(e=r==null?void 0:r.sets)==null?void 0:e.length,o=n&&Zs(n),{setFormat:s,finalSetFormat:l,bestOf:c}=o??{};return((i=c&&a===c&&l||s)==null?void 0:i.timed)||!1}function n6e({tournamentRecord:t,drawDefinition:e,structure:i,matchUp:n}){var r;let a="attemptToSetMatchUpStatusBYE";if(n!=null&&n.winningSide)return fe({result:{error:RS},context:{matchUpStatus:yn},stack:a});let{positionAssignments:o}=Ha({structure:i}),s=o==null?void 0:o.filter(l=>l.bye).map(l=>l.drawPosition);return(r=n.drawPositions)!=null&&r.some(l=>s==null?void 0:s.includes(l))?(n.matchUpStatus=yn,n.matchUpStatusCodes=[],sn({tournamentId:t==null?void 0:t.tournamentId,context:a,drawDefinition:e,matchUp:n}),{...ue}):fe({result:{error:Ffe},info:"matchUp does not include BYE",stack:a})}function Q1(t){var e;let{tournamentRecord:i,appliedPolicies:n,drawDefinition:r,matchUpsMap:a,targetData:o,structure:s,event:l}=t,c="doubleExitAdvancement";if(s.structureType===xs)return fe({result:{...ue},stack:c});let{matchUp:u,targetMatchUps:d,targetLinks:p}=o,{loserMatchUp:h,winnerMatchUp:f,loserTargetDrawPosition:m}=d;if(h&&h.matchUpStatus!==yn){let{loserTargetLink:g}=p;if((e=n==null?void 0:n.progression)!=null&&e.doubleExitPropagateBye){let v=Qwe({loserTargetDrawPosition:m,tournamentRecord:i,loserTargetLink:g,drawDefinition:r,loserMatchUp:h,matchUpsMap:a,event:l});if(v.error)return fe({result:v,stack:c})}else{let{feedRound:v,drawPositions:y,matchUpId:b}=h,I=v?2:2-y.indexOf(m),T=SX({...t,targetMatchUp:h,walkoverWinningSide:I,tournamentRecord:i,sourceMatchUp:u,matchUpId:b});if(T.error)return fe({result:T,stack:c})}}if(f){let g=SX({...t,matchUpId:f.matchUpId,targetMatchUp:f,tournamentRecord:i,sourceMatchUp:u});if(g.error)return fe({result:g,stack:c})}return fe({result:{...ue},stack:c})}function SX(t){var e,i,n;let{inContextDrawMatchUps:r,tournamentRecord:a,drawDefinition:o,sourceMatchUp:s,targetMatchUp:l,matchUpsMap:c}=t,u=o.structures.find(({structureId:Q})=>Q===l.structureId),d=t.matchUpStatus===Ca?Ca:da,p=t.matchUpStatus===Ca?fn:Rn,h="conditionallyAdvanceDrawPosition",f=c.drawMatchUps.find(Q=>Q.matchUpId===l.matchUpId);if(!f)return{error:cl};let m=(s==null?void 0:s.drawPositions)||[],g=(e=f.drawPositions)==null?void 0:e.filter(Boolean),v=(s==null?void 0:s.structureId)===l.structureId;if(v&&Ps(m,g)&&(g=g.filter(Q=>!m.includes(Q))),v&&g.length>1)return fe({result:{error:PS},stack:h});let{pairedPreviousMatchUpIsDoubleExit:y,pairedPreviousMatchUp:b}=Bve(t),I=Ms({matchUpId:l.matchUpId,inContextDrawMatchUps:r,drawDefinition:o}),{targetMatchUps:T,targetLinks:w}=I,{loserTargetDrawPosition:S,winnerMatchUp:D,loserMatchUp:E}=T;if(E){let{loserTargetLink:Q}=w,X=Qwe({loserTargetDrawPosition:S,loserMatchUp:E,tournamentRecord:a,loserTargetLink:Q,drawDefinition:o,matchUpsMap:c});if(X.error)return fe({result:X,stack:h})}let C=((i=f.drawPositions)==null?void 0:i.filter(Boolean))||[],P=C.length===1,R=t.walkoverWinningSide||P&&zN({drawPosition:C[0],matchUpId:l.matchUpId,inContextDrawMatchUps:r})||void 0,N=[Rn,fn].includes(f.matchUpStatus)&&!C.length,M=f.finishingRound===1,A=N&&!M?d:p,_=r.find(Q=>Q.matchUpId===b.matchUpId),x=[],O;s&&((s==null?void 0:s.structureId)===(_==null?void 0:_.structureId)?s.roundPosition<(b==null?void 0:b.roundPosition)?O=1:O=2:l.feedRound?s.structureId===l.structureId?O=2:O=1:R&&(O=3-R));let B=t.matchUpStatus,F=b==null?void 0:b.matchUpStatus;O===1?x=[{matchUpStatus:PM(B),previousMatchUpStatus:B,sideNumber:1},{matchUpStatus:PM(F),previousMatchUpStatus:F,sideNumber:2}]:O===2&&(x=[{matchUpStatus:PM(F),previousMatchUpStatus:F,sideNumber:1},{matchUpStatus:PM(B),previousMatchUpStatus:B,sideNumber:2}]),x.length&&(x=x.map(Q=>qt(Q)));let G=ap({...t,winningSide:R,matchUp:f,matchUpStatusCodes:x,context:h,matchUpStatus:A});if(G.error)return fe({result:G,stack:h});if(N)return Q1({...t,matchUpStatus:A,targetData:I});if(!D)return fe({result:{...ue},stack:h});let H=g.length===2?g[R-1]:g[0],{positionAssignments:$}=jn({structure:u}),q=$==null?void 0:$.find(Q=>Q.drawPosition===H),z=c.drawMatchUps.find(Q=>Q.matchUpId===D.matchUpId),Z=(n=z==null?void 0:z.drawPositions)==null?void 0:n.filter(Boolean),Y=Z.length===1;if(H){if(q!=null&&q.bye){let Q=Ms({matchUpId:z.matchUpId,inContextDrawMatchUps:r,drawDefinition:o});if(Y){let X=Z.filter(Boolean)[0],oe=zN({drawPosition:X,matchUpId:z.matchUpId,inContextDrawMatchUps:r}),re=ap({appliedPolicies:t.appliedPolicies,matchUpId:z.matchUpId,matchUp:z,matchUpStatus:p,matchUpStatusCodes:[],removeScore:!0,context:h,drawDefinition:o,winningSide:oe});return re.error?fe({result:re,stack:h}):D6({drawPositionToAdvance:X,matchUpId:z.matchUpId,inContextDrawMatchUps:r,drawDefinition:o,matchUpsMap:c})}else if([Rn,fn].includes(D.matchUpStatus)){let X=Q1({...t,matchUpId:z.matchUpId,matchUpStatus:A,targetData:Q});if(X.error)return fe({result:X,stack:h})}return fe({result:{...ue},stack:h})}return zS({matchUpId:D.matchUpId,drawPosition:H,inContextDrawMatchUps:r,drawDefinition:o})}else if(y){if(!z)return{error:cl};if(Y){let oe=Z[0],re=zN({matchUpId:l.matchUpId,inContextDrawMatchUps:r,drawPosition:oe});console.log("existing drawPosition is winningSide",{walkoverWinningSide:re})}let Q=[Rn,fn].includes(z.matchUpStatus)?p:d,X=ap({matchUpId:z.matchUpId,appliedPolicies:t.appliedPolicies,matchUp:z,matchUpStatusCodes:[],removeScore:!0,context:h,drawDefinition:o,matchUpStatus:Q});if(X.error)return fe({result:X,stack:h});if(Q===d){let oe=Q1({...t,matchUpId:l.matchUpId,matchUpStatus:Q,targetData:I});if(oe.error)return oe}}return fe({result:{...ue},stack:h})}function Qwe(t){var e;let{loserTargetDrawPosition:i,tournamentRecord:n,loserTargetLink:r,drawDefinition:a,matchUpsMap:o,event:s}=t,l=(e=r==null?void 0:r.target)==null?void 0:e.structureId,{structure:c}=pi({drawDefinition:a,structureId:l});return c?uc({drawPosition:i,tournamentRecord:n,drawDefinition:a,structureId:l,matchUpsMap:o,event:s}):{error:_g}}function PM(t){return t===da?Rn:t===Ca?fn:t}function r6e(t){let{tournamentRecord:e,drawDefinition:i,matchUpStatus:n,structure:r,matchUp:a}=t,o=!!(a.tieMatchUps&&!a.rondPosition&&t.inContextDrawMatchUps.find(v=>v.matchUpId===a.matchUpId).containerStructureId),s="attemptToSetMatchUpStatus",l=n===yn,c=a.winningSide,u=[da,Ca].includes(n),d=pR({matchUpStatus:n}),p=dj({matchUpStatus:n}),h=!d&&!p,f=t.matchUpTieId||c&&d&&!u,m=c&&u,g=()=>ap({...t,removeScore:[sm,Rn].includes(n),matchUpStatus:n||Kr});return h&&{error:qV}||f&&Fj(t)||m&&a6e(t)||c&&AU(t)||p&&g()||l&&n6e({tournamentRecord:e,drawDefinition:i,structure:r,matchUp:a})||!d&&{error:qV}||u&&o6e(t)||o&&Fj(t)||fe({result:{error:RS},stack:s})}function a6e(t){let e=AU(t);return e.error?e:Q1(t)}function o6e(t){let e=Fj({...t,removeScore:!0});return e.error?e:Q1(t)}function Fj(t){var e;let i="scoreModification";if(t.isCollectionMatchUp&&(e=t.dualMatchUp)!=null&&e.winningSide&&!t.projectedWinningSide){let a=AU(t);if(a.error)return fe({result:a,stack:i})}let n=!!t.matchUp.collectionId,r=ap({...t,context:i});if(n){let{matchUpTieId:a,drawDefinition:o,matchUpsMap:s}=t,l=hm({tournamentRecord:t.tournamentRecord,appliedPolicies:t.appliedPolicies,matchUpId:a,event:t.event,drawDefinition:o,matchUpsMap:s});if(l.error)return fe({result:l,stack:i});Object.assign(r,{tieMatchUpResult:l})}return fe({result:r,stack:i})}function s6e({drawDefinition:t,structure:e,matchUp:i}){var n,r,a,o;let{drawPositions:s}=i,{positionAssignments:l}=jn({drawDefinition:t,structure:e}),c=(n=l==null?void 0:l.filter(({drawPosition:p})=>s==null?void 0:s.includes(p)))==null?void 0:n.map(p=>{var h;let{extension:f}=Bi({element:p,name:og});return(h=f==null?void 0:f.value)==null?void 0:h.groupOrder}),{containerStructures:u}=vU({drawDefinition:t}),d=u[e.structureId];return{structureIds:(o=(a=(r=wU({drawDefinition:t,structureId:d}))==null?void 0:r.links)==null?void 0:a.source)==null?void 0:o.filter(p=>{var h;return Ps(c,((h=p.source)==null?void 0:h.finishingPositions)||[])}).map(p=>p.source.structureId)}}function e0e({drawDefinition:t,structure:e,matchUp:i}){let n=[];if(e.finishingPosition===gU&&dg({drawDefinition:t,structure:e})){let{structureIds:r}=s6e({drawDefinition:t,structure:e,matchUp:i});r!=null&&r.length&&n.push(...r)}return{connectedStructureIds:n}}function l6e(t){var e,i,n;let r,{inContextDrawMatchUps:a,inContextMatchUp:o,drawDefinition:s,winningSide:l}=t,c=(e=t.targetData.targetLinks)==null?void 0:e.winnerTargetLink;if(c.target.feedProfile===rd){let u=o.sides.find(({sideNumber:p})=>p!==l).participantId,d=a.find(p=>p.structureId===c.target.structureId&&p.roundNumber===c.target.roundNumber&&p.sides.some(({participantId:h})=>h===u));if((d==null?void 0:d.matchUpStatus)===Kr){let p=Ms({matchUpId:d.matchUpId,inContextDrawMatchUps:a,drawDefinition:s});if(!uy({inContextDrawMatchUps:a,drawDefinition:s,targetData:p})){let{structure:h}=pi({structureId:d.structureId,drawDefinition:s}),f=jn({structure:h}).positionAssignments;for(let m of f||[])if(m.participantId===u){let g=o.sides.find(({sideNumber:v})=>v===l).participantId;if(m.participantId=g,h==null?void 0:h.positionAssignments)h.positionAssignments=f;else if(h!=null&&h.structures){let v=Object.assign({},...(f||[]).map(y=>({[y.drawPosition]:y.participantId})));for(let y of h.structures)(i=y.positionAssignments)==null||i.forEach(b=>b.participantId=v[b.drawPosition])}cg({tournamentId:(n=t.tournamentRecord)==null?void 0:n.tournamentId,event:t.event,drawDefinition:s,structure:h}),r=!0}}}}return{...ue,qualifierReplaced:r}}function c6e(t){var e,i,n,r,a;let o,{inContextDrawMatchUps:s,inContextMatchUp:l,drawDefinition:c,winningSide:u}=t,d=(e=t.targetData.targetLinks)==null?void 0:e.winnerTargetLink;if(d.target.feedProfile===rd){let p=(i=l.sides.find(({sideNumber:m})=>m===u))==null?void 0:i.participantId,h=s.filter(m=>m.structureId===d.target.structureId&&m.roundNumber===d.target.roundNumber&&m.sides.some(({participantId:g,qualifier:v})=>v&&!g)),f=mu(h);if((f==null?void 0:f.matchUpStatus)===Kr){let m=Ms({matchUpId:f.matchUpId,inContextDrawMatchUps:s,drawDefinition:c});if(!uy({inContextDrawMatchUps:s,drawDefinition:c,targetData:m})){let g=(n=f.sides.find(b=>b.qualifier&&!b.participantId))==null?void 0:n.drawPosition,{structure:v}=pi({structureId:f.structureId,drawDefinition:c});if(!v)return{error:Dr};let y=jn({structure:v}).positionAssignments;for(let b of y||[])if(b.drawPosition===g&&!b.participantId){if(b.participantId=p,v.positionAssignments)v.positionAssignments=y;else if(v.structures){let I=Object.assign({},...(y||[]).map(T=>({[T.drawPosition]:T.participantId})));for(let T of v.structures)(r=T.positionAssignments)==null||r.forEach(w=>w.participantId=I[w.drawPosition])}cg({tournamentId:(a=t.tournamentRecord)==null?void 0:a.tournamentId,event:t.event,drawDefinition:c,structure:v}),o=!0}}}}return{...ue,qualifierPlaced:o}}function u6e(t){var e,i;let n="attemptToSetWinningSide",r,{appliedPolicies:a,disableAutoCalc:o,drawDefinition:s,dualMatchUp:l,winningSide:c,structure:u,matchUp:d}=t;if(l!=null&&l._disableAutoCalc&&o!==!1)return J6(t);if(d.winningSide&&d.winningSide!==c){let{connectedStructureIds:m}=e0e({drawDefinition:s,structure:u,matchUp:d});m.length&&(console.log({connectedStructureIds:m}),r=!0);let g=AU(t);if(g.error)return g}let p=_ye(t);if(p.error)return fe({result:p,stack:n});let h,f;return t.qualifierChanging&&(e=a==null?void 0:a[dE])!=null&&e.autoReplaceQualifiers&&(h=l6e(t).qualifierReplaced),t.qualifierAdvancing&&(i=a==null?void 0:a[dE])!=null&&i.autoPlaceQualifiers&&(f=c6e(t).qualifierPlaced),fe({result:qt({...ue,...p,connectedStructures:r,qualifierReplaced:h,qualifierPlaced:f}),stack:n})}var YN={drawPositionToRemove:"green",iteration:"brightred",winner:"green",loser:"brightred"};function t0e(t){var e;let{inContextDrawMatchUps:i,appliedPolicies:n,drawDefinition:r,matchUpsMap:a,targetData:o,matchUp:s}=t,{iteration:l=0}=t;l+=1;let c="removeDoubleExit";kc({method:c,color:"brightyellow",iteration:l,keyColors:YN});let{targetLinks:{loserTargetLink:u},targetMatchUps:{loserMatchUp:d,winnerMatchUp:p,loserTargetDrawPosition:h}}=o;if(p&&p.matchUpStatus!==yn){let{stage:f,roundNumber:m,roundPosition:g}=p;kc({winner:"winner",stage:f,roundNumber:m,roundPosition:g,keyColors:YN}),TX({...t,targetMatchUp:p,sourceMatchUp:s,iteration:l})}if(d&&d.matchUpStatus!==yn){let f=i.find(({matchUpId:I})=>I===d.matchUpId),{structure:m}=pi({drawDefinition:r,structureId:f.structureId}),{stage:g,roundNumber:v,roundPosition:y,feedRound:b}=d;if(kc({loser:"loser",stage:g,roundNumber:v,roundPosition:y,keyColors:YN,feedRound:b}),(e=n==null?void 0:n.progression)==null?void 0:e.doubleExitPropagateBye)Lj({drawPosition:h,targetLink:u,inContextDrawMatchUps:i,drawDefinition:r,matchUpsMap:a});else{let I=TX({...t,structure:m,targetMatchUp:d,iteration:l});if(I.error)return fe({result:I,stack:c})}}return fe({result:{...ue},stack:c})}function TX(t){var e,i,n,r,a,o;let{inContextDrawMatchUps:s,appliedPolicies:l,drawDefinition:c,sourceMatchUp:u,targetMatchUp:d,matchUpsMap:p,structure:h,iteration:f}=t,m="conditionallyRemoveDrawPosition";kc({method:m});let g=Ms({matchUpId:d.matchUpId,inContextDrawMatchUps:s,drawDefinition:c}),{targetMatchUps:{winnerMatchUp:v}}=g,y=p==null?void 0:p.drawMatchUps.find(C=>C.matchUpId===d.matchUpId),b=[],I,T,w;if(d.feedRound)w=(i=(e=v==null?void 0:v.drawPositions)==null?void 0:e.filter(Boolean))==null?void 0:i.find(C=>d.drawPositions.includes(C));else if(!u)w=(n=Wr((d==null?void 0:d.drawPositions)||[],(v==null?void 0:v.drawPositions)||[]))==null?void 0:n[0];else if(T=(r=$ve({structureId:h.structureId,matchUp:u,matchUpsMap:p}))==null?void 0:r.pairedPreviousMatchUp,I=[da,Ca].includes(T==null?void 0:T.matchUpStatus),b=((a=T==null?void 0:T.drawPositions)==null?void 0:a.filter(Boolean))||[],[...Ga,yn].includes(T==null?void 0:T.matchUpStatus)||(T==null?void 0:T.winningSide)){let C=u.drawPositions||[],P=(o=d.drawPositions)==null?void 0:o.filter(Boolean);Ps(C,P)&&(P=P==null?void 0:P.filter(R=>!C.includes(R))),w=C.concat(b).find(R=>P==null?void 0:P.includes(R))}if(v&&w){let{stage:C,roundNumber:P,roundPosition:R}=v;kc({method:"removeDirectedWinner",drawPositionToRemove:w,keyColors:YN,color:"brightgreen",stage:C,roundNumber:P,roundPosition:R}),Jwe({winningDrawPosition:w,winnerMatchUp:v,inContextDrawMatchUps:s,drawDefinition:c,matchUpsMap:p})}let S=t0e({targetData:g,matchUp:d,inContextDrawMatchUps:s,appliedPolicies:l,drawDefinition:c,matchUpsMap:p,structure:h,iteration:f});if(S.error)return fe({result:S,stack:m});let D=d6e({pairedPreviousDoubleExit:I,noContextTargetMatchUp:y}),E=!I;return S=ap({...t,matchUpId:d.matchUpId,matchUp:y,removeWinningSide:!0,matchUpStatusCodes:[],context:m,matchUpStatus:D,removeScore:E,score:{scoreStringSide1:"",scoreStringSide2:"",sets:void 0}}),S.error?fe({result:S,stack:m}):{...ue}}function d6e({pairedPreviousDoubleExit:t,noContextTargetMatchUp:e}){return e.matchUpStatus===yn?yn:t?[Ca,fn].includes(e==null?void 0:e.matchUpStatus)?fn:Rn:Kr}function p6e(t){var e,i,n,r,a;let o,{inContextDrawMatchUps:s,inContextMatchUp:l,drawDefinition:c}=t,u=(e=t.targetData.targetLinks)==null?void 0:e.winnerTargetLink;if(u.target.feedProfile===rd){let d=(n=(i=l.sides)==null?void 0:i.find(({sideNumber:h})=>h===l.winningSide))==null?void 0:n.participantId,p=s.find(h=>{var f;return h.structureId===u.target.structureId&&h.roundNumber===u.target.roundNumber&&((f=h.sides)==null?void 0:f.some(({participantId:m})=>m===d))});if(p&&p.matchUpStatus===Kr){let h=Ms({matchUpId:p.matchUpId,inContextDrawMatchUps:s,drawDefinition:c});if(!uy({inContextDrawMatchUps:s,drawDefinition:c,targetData:h})){let{structure:f}=pi({structureId:p.structureId,drawDefinition:c}),m=jn({structure:f}).positionAssignments;for(let g of m||[])if(g.participantId===d){if(g.participantId=void 0,f==null?void 0:f.positionAssignments)f.positionAssignments=m;else if(f!=null&&f.structures){let v=Object.assign({},...(m||[]).map(y=>({[y.drawPosition]:y.participantId})));for(let y of(f==null?void 0:f.structures)||[])(r=y.positionAssignments)==null||r.forEach(b=>b.participantId=v[b.drawPosition])}cg({tournamentId:(a=t.tournamentRecord)==null?void 0:a.tournamentId,event:t.event,drawDefinition:c,structure:f}),o=!0}}}}return{qualifierRemoved:o}}function h6e(t){var e;let{matchUp:i,matchUpStatus:n,score:r,winningSide:a}=t,o="noDownStreamDependencies";if([da,Ca].includes(i==null?void 0:i.matchUpStatus)&&![da,Ca].includes(n)){let g=t0e(t);if(g.error)return fe({result:g,stack:o})}let s=n===da,l=uo({score:r})&&!s&&(t.isCollectionMatchUp&&!t.projectedWinningSide||!a),c=((e=t==null?void 0:t.inContextMatchUp)==null?void 0:e.collectionId)&&i6e(t.inContextMatchUp),u=t.removeScore||!c&&![bp,ec].includes(n||bp),d=t.isCollectionMatchUp&&t.dualMatchUp.winningSide&&!t.projectedWinningSide||i.winningSide&&!a&&!uo({score:r}),p=n&&n!==Kr,h=g=>{var v,y;let b,{structure:I,drawDefinition:T,dualMatchUp:w,disableAutoCalc:S}=t;if(w!=null&&w._disableAutoCalc&&S!==!1)return J6(t);let{connectedStructureIds:D}=e0e({drawDefinition:T,structure:I,matchUp:i});D.length&&(console.log({connectedStructureIds:D}),b=!0),Object.assign(t,{removeScore:g});let E=AU(t);if(E.error)return E;if(t.removingQualifier&&(y=(v=t.appliedPolicies)==null?void 0:v[dE])!=null&&y.autoRemoveQualifiers){let C=p6e(t);return{...ue,connectedStructures:b,...C}}return{...ue,connectedStructures:b}};if(d&&a&&t.isCollectionMatchUp)return UX(t);let f=[sm,ec].includes(n)&&t.dualWinningSideChange,m=(a||f)&&u6e(t)||l&&h(u)||p&&r6e(t)||d&&h(u)||i&&UX({...t,removeScore:!0})||{...ue};return fe({result:m,stack:o})}function UX(t){var e;let i="scoreModification";if(t.isCollectionMatchUp&&(e=t.dualMatchUp)!=null&&e.winningSide&&!t.projectedWinningSide){let r=AU(t);if(r.error)return r}let n=ap({...t,context:i});if(t.isCollectionMatchUp){let{matchUpTieId:r,drawDefinition:a,event:o,matchUpsMap:s}=t,{removeWinningSide:l}=hm({tournamentRecord:t.tournamentRecord,appliedPolicies:t.appliedPolicies,matchUpId:r,drawDefinition:a,matchUpsMap:s,event:o});l&&console.log("REMOVE WINNING SIDE")}return fe({result:n,stack:i})}function Gg(t){var e;let i="addMatchUpScheduledTime",n=t.matchUp,{removePriorValues:r,tournamentRecord:a,drawDefinition:o,disableNotice:s,scheduledTime:l,matchUpId:c}=t;if(!c)return fe({result:{error:_o},stack:i});if(!dU(l))return fe({result:{error:lu},stack:i});if(!n){let f=ar({drawDefinition:o,matchUpId:c});if(f.error)return fe({result:f,stack:i});n=f.matchUp}let u=Ci(l),d=oy({matchUp:n}).scheduledDate,p=u&&!d;if((e=g6({matchUp:n}).timeModifiers||[])!=null&&e.length){let f=i0e({disableNotice:!0,removePriorValues:r,tournamentRecord:a,timeModifiers:[],drawDefinition:o,matchUpId:c,matchUp:n});if(f!=null&&f.error)return fe({result:f,stack:i})}let h=ow(l,!0,p);return ic({duplicateValues:!1,removePriorValues:r,tournamentRecord:a,drawDefinition:o,disableNotice:s,matchUpId:c,timeItem:{itemType:IU,itemValue:h}})}function i0e({removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:n,timeModifiers:r,matchUpId:a,matchUp:o}){let s="addMatchUpTimeModifiers";if(!a)return fe({result:{error:_o},stack:s});if(r!==void 0&&!Array.isArray(r))return fe({info:Nh("timeModifiers"),result:{error:Me},stack:s});if(!o){let d=ar({drawDefinition:i,matchUpId:a});if(d.error)return fe({result:d,stack:s});o=d.matchUp}let l=g6({matchUp:o}).timeModifiers||[],c=r.filter(d=>!l.includes(d));if(r.length&&!c.length)return{...ue};if(c.some(d=>oj.includes(d))){l=l.filter(p=>!oj.includes(p));let d=Gg({disableNotice:!0,removePriorValues:t,scheduledTime:"",tournamentRecord:e,drawDefinition:i,matchUpId:a});if(d.error)return fe({result:d,stack:s})}let u=r!=null&&r.length?[...c,...l]:void 0;return ic({duplicateValues:!1,removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:n,matchUpId:a,timeItem:{itemType:f6,itemValue:u}})}function RF({removePriorValues:t,tournamentRecords:e,tournamentRecord:i,drawDefinition:n,disableNotice:r,courtDayDate:a,matchUpId:o,courtIds:s}){var l,c;if(!i&&!e)return{error:it};if(!o)return{error:_o};let u=ar({drawDefinition:n,matchUpId:o});if(u.error)return u;if(((l=u==null?void 0:u.matchUp)==null?void 0:l.matchUpType)!==Ip)return{error:Ws};if(!(s===void 0||Array.isArray(s)&&s.length&&s.every(p=>typeof p=="string")))return{error:Me,context:{courtIds:s}};let d;if(s){let p=e||i&&{[i.tournamentId]:i},h=fm({tournamentRecords:p});if(h.error)return h;let f=(c=h.courts)==null?void 0:c.filter(m=>s.includes(m.courtId));if((f==null?void 0:f.length)!==s.length)return{error:Me,context:{courtIds:s}};d=f==null?void 0:f.map(m=>({venueId:m.venueId,courtId:m.courtId}))}return ic({duplicateValues:!1,removePriorValues:t,tournamentRecord:i,drawDefinition:n,disableNotice:r,matchUpId:o,timeItem:{itemType:jf,itemDate:a,itemValue:d}})}function _U({removePriorValues:t,tournamentRecords:e,tournamentRecord:i,drawDefinition:n,disableNotice:r,matchUpId:a,venueId:o}){if(!i)return{error:it};if(!a)return{error:_o};if(o){let s=um({tournamentRecords:e,tournamentRecord:i,venueId:o});if(s.error)return s}return ic({duplicateValues:!1,removePriorValues:t,tournamentRecord:i,drawDefinition:n,disableNotice:r,matchUpId:a,timeItem:{itemType:yU,itemValue:o}})}function Uw({removePriorValues:t,tournamentRecords:e,tournamentRecord:i,drawDefinition:n,disableNotice:r,courtDayDate:a,matchUpId:o,courtId:s}){var l;if(!i&&!e)return{error:it};if(!o)return{error:_o};if(s){let c=pw({tournamentRecords:e,tournamentRecord:i,courtId:s});if(c.error)return c;let u=(l=c.venue)==null?void 0:l.venueId;_U({tournamentRecords:e,tournamentRecord:i,drawDefinition:n,disableNotice:r,matchUpId:o,venueId:u})}return ic({duplicateValues:!1,removePriorValues:t,tournamentRecord:i,drawDefinition:n,disableNotice:r,matchUpId:o,timeItem:{itemType:ay,itemDate:a,itemValue:s}})}function Xd(t,e){let i=Jme.test(t)?t:rr(t),n=Ci(t)||Ci(e)||fd(new Date);return new Date(`${n}T${i}`).getTime()}function MF({errorOnAnachronism:t=!1,checkChronology:e=!0,matchUpDependencies:i,inContextMatchUps:n,removePriorValues:r,tournamentRecords:a,tournamentRecord:o,drawDefinition:s,disableNotice:l,drawMatchUps:c,matchUpId:u,schedule:d,event:p}){var h;if(!d)return{error:Ht,info:"Missing schedule"};if(!s)return{error:Lt};if(!u)return{error:_o};let f="addMatchUpScheduleItems",m,g;if(c)m=c.find(N=>N.matchUpId===u);else{let N=ar({drawDefinition:s,event:p,matchUpId:u});if(N.error)return N;m=N.matchUp}let{endTime:v,courtId:y,courtIds:b,courtOrder:I,resumeTime:T,scheduledDate:w,scheduledTime:S,startTime:D,stopTime:E,timeModifiers:C,venueId:P}=d;e&&(!i||!n)&&({matchUpDependencies:i,matchUps:n}=Ku({drawDefinition:s}));let R=(h=i==null?void 0:i[u])==null?void 0:h.matchUpIds;if(d.scheduledDate&&e&&R){let N=n==null?void 0:n.filter(M=>{var A,_;return(((A=M.schedule)==null?void 0:A.scheduledDate)||Ci((_=M.schedule)==null?void 0:_.scheduledTime))&&R.includes(M.matchUpId)}).map(({schedule:M})=>{let A=v_(M);return new Date(A).getTime()});if(N!=null&&N.length){let M=v_(d),A=new Date(M).getTime();if(Math.max(...N)>=A){if(t)return fe({result:{error:GV},stack:f});g=GV}}}if(w!==void 0){let N=NF({disableNotice:!0,removePriorValues:r,tournamentRecord:o,drawDefinition:s,scheduledDate:w,matchUpId:u});if(N!=null&&N.error)return fe({result:N,stack:f,context:{scheduledDate:w}})}if(S!==void 0){let N=Gg({disableNotice:!0,removePriorValues:r,tournamentRecord:o,drawDefinition:s,scheduledTime:S,matchUpId:u,matchUp:m});if(N!=null&&N.error)return fe({result:N,stack:f,context:{scheduledTime:S}})}if(D!==void 0){let N=T7({disableNotice:!0,removePriorValues:r,tournamentRecord:o,drawDefinition:s,matchUpId:u,startTime:D,event:p});if(N!=null&&N.error)return fe({result:N,stack:f,context:{startTime:D}})}if(E!==void 0){let N=D7({disableNotice:!0,removePriorValues:r,tournamentRecord:o,drawDefinition:s,matchUpId:u,stopTime:E,event:p});if(N!=null&&N.error)return fe({result:N,stack:f,context:{stopTime:E}})}if(T!==void 0){let N=E7({disableNotice:!0,removePriorValues:r,tournamentRecord:o,drawDefinition:s,resumeTime:T,matchUpId:u,event:p});if(N!=null&&N.error)return fe({result:N,stack:f,context:{resumeTime:T}})}if(v!==void 0){let N=U7({disableNotice:!0,removePriorValues:r,tournamentRecord:o,drawDefinition:s,matchUpId:u,endTime:v,event:p});if(N!=null&&N.error)return fe({result:N,stack:f,context:{endTime:v}})}if(b!==void 0){let N=RF({disableNotice:!0,removePriorValues:r,tournamentRecord:o,drawDefinition:s,matchUpId:u,courtIds:b});if(N!=null&&N.error)return fe({result:N,stack:f,context:{courtIds:b}})}if(y!==void 0&&w!==void 0){let N=Uw({courtDayDate:w,disableNotice:!0,removePriorValues:r,tournamentRecords:a,tournamentRecord:o,drawDefinition:s,matchUpId:u,courtId:y});if(N!=null&&N.error)return fe({result:N,stack:f,context:{courtId:y}})}if(P!==void 0){let N=_U({disableNotice:!0,removePriorValues:r,tournamentRecords:a,tournamentRecord:o,drawDefinition:s,matchUpId:u,venueId:P});if(N!=null&&N.error)return fe({result:N,stack:f,context:{venueId:P}})}if(I!==void 0&&bi(I)){let N=S7({disableNotice:!0,removePriorValues:r,tournamentRecord:o,drawDefinition:s,courtOrder:I,matchUpId:u});if(N!=null&&N.error)return fe({result:N,stack:f,context:{courtOrder:I}})}if(C!==void 0){let N=i0e({disableNotice:!0,removePriorValues:r,tournamentRecord:o,drawDefinition:s,timeModifiers:C,matchUpId:u,matchUp:m});if(N!=null&&N.error)return fe({result:N,stack:f,context:{timeModifiers:C}})}return l||sn({tournamentId:o==null?void 0:o.tournamentId,eventId:p==null?void 0:p.eventId,context:f,drawDefinition:s,matchUp:m}),g?{...ue,warnings:[g]}:{...ue}}function NF({scheduledDate:t,removePriorValues:e,tournamentRecord:i,drawDefinition:n,disableNotice:r,matchUpId:a}){if(!a)return{error:_o};let o=t&&Th.test(t);if(t&&!o)return{error:Cs};let s={itemValue:Ci(t),itemType:bU};return ic({duplicateValues:!1,removePriorValues:e,tournamentRecord:i,drawDefinition:n,disableNotice:r,matchUpId:a,timeItem:s})}function S7({removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:n,courtOrder:r,matchUpId:a}){if(!a)return{error:_o};if(r&&!bi(r))return{error:Me,info:"courtOrder must be numeric"};let o=r&&ai(r);return ic({duplicateValues:!1,removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:n,matchUpId:a,timeItem:{itemType:h6,itemValue:o}})}function n0e({removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:n,participantId:r,officialType:a,matchUpId:o}){if(!o)return{error:_o};if(!r)return{error:Ra};if(e){let l=Yr({tournamentRecord:e,participantFilters:{participantTypes:[Ki],participantRoles:[P6]}}).participants??[];if(!ag({tournamentParticipants:l,participantId:r}))return{error:Jr}}let s={itemType:"SCHEDULE.ASSIGNMENT.OFFICIAL",itemValue:r};return a&&(s.itemSubTypes=[a]),ic({duplicateValues:!1,removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:n,matchUpId:o,timeItem:s})}function T7({removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:n,matchUpId:r,startTime:a,event:o}){if(!r)return{error:_o};if(!dU(a))return{error:lu};let{matchUp:s}=ar({drawDefinition:i,event:o,matchUpId:r}),{scheduledDate:l}=oy({matchUp:s}),c=((s==null?void 0:s.timeItems)??[]).filter(u=>[yf,oh,Gf].includes(u==null?void 0:u.itemType)).map(u=>Xd(u.itemValue,l)).reduce((u,d)=>!u||d<u?d:u,void 0);if(!c||Xd(a,l)<c){s!=null&&s.timeItems&&(s.timeItems=s.timeItems.filter(d=>d.itemType!==ad));let u=ow(a,!0,!0);return ic({duplicateValues:!1,removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:n,matchUpId:r,timeItem:{itemType:ad,itemValue:u}})}else return{error:dme}}function U7({validateTimeSeries:t=!0,removePriorValues:e,tournamentRecord:i,drawDefinition:n,disableNotice:r,matchUpId:a,endTime:o,event:s}){if(!a)return{error:_o};if(!dU(o))return{error:lu};let{matchUp:l}=ar({drawDefinition:n,event:s,matchUpId:a}),{scheduledDate:c}=oy({matchUp:l}),u=((l==null?void 0:l.timeItems)??[]).filter(d=>[ad,oh,yf].includes(d==null?void 0:d.itemType)).map(d=>Xd(d.itemValue,c)).reduce((d,p)=>!d||p>d?p:d,void 0);if(!t||!u||Xd(o,c)>u){l!=null&&l.timeItems&&(l.timeItems=l.timeItems.filter(p=>p.itemType!==Gf));let d=ow(o,!0,!0);return ic({duplicateValues:!1,removePriorValues:e,tournamentRecord:i,drawDefinition:n,disableNotice:r,matchUpId:a,timeItem:{itemType:Gf,itemValue:d}})}else return{error:cme}}function D7({removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:n,matchUpId:r,stopTime:a,event:o}){if(!r)return{error:_o};if(!dU(a))return{error:lu};let{matchUp:s}=ar({drawDefinition:i,event:o,matchUpId:r}),{scheduledDate:l}=oy({matchUp:s}),c=(s==null?void 0:s.timeItems)??[];if(c.reduce((f,m)=>m.itemType===Gf||f,void 0))return{error:o5};let u=c.filter(f=>[ad,oh,yf].includes(f==null?void 0:f.itemType)).sort((f,m)=>Xd(f.itemValue,l)-Xd(m.itemValue,l)),d=u[u.length-1],p=d&&d.itemType===yf,h=u.filter(f=>!p||f.createdAt!==d.createdAt).map(f=>Xd(f.itemValue,l)).reduce((f,m)=>!f||m>f?m:f,void 0);if(Xd(a,l)>h){if(s!=null&&s.timeItems&&p){let m=d.createdAt;s.timeItems=s.timeItems.filter(g=>g.createdAt!==m)}let f={itemValue:ow(a,!0,!0),itemType:yf};return ic({duplicateValues:!0,removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:n,matchUpId:r,timeItem:f})}else return{error:ume}}function E7({removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:n,resumeTime:r,matchUpId:a,event:o}){if(!a)return{error:_o};if(!dU(r))return{error:lu};let{matchUp:s}=ar({drawDefinition:i,event:o,matchUpId:a}),{scheduledDate:l}=oy({matchUp:s}),c=(s==null?void 0:s.timeItems)??[];if(c.reduce((f,m)=>m.itemType===Gf||f,void 0))return{error:o5};let u=c.filter(f=>[ad,oh,yf].includes(f==null?void 0:f.itemType)).sort((f,m)=>Xd(f.itemValue,l)-Xd(m.itemValue,l)),d=u[u.length-1],p=d&&d.itemType===oh,h=u.filter(f=>!p||f.createdAt!==d.createdAt).map(f=>Xd(f.itemValue,l)).reduce((f,m)=>!f||m>f?m:f,void 0);if(Xd(r,l)>h){if(s!=null&&s.timeItems&&p){let m=d.createdAt;s.timeItems=s.timeItems.filter(g=>g.createdAt!==m)}let f={itemValue:ow(r,!0,!0),itemType:oh};return ic({duplicateValues:!0,removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:n,matchUpId:a,timeItem:f})}else return{error:Bje}}function f6e(t){var e;let{tournamentRecord:i,inContextMatchUp:n,structure:r,drawDefinition:a}=t,o=n.roundNumber,s=n.sides.find(w=>w.sideNumber===n.winningSide),l=n.sides.find(w=>w.sideNumber!==n.winningSide),{drawPosition:c,participantId:u}=s,{drawPosition:d,participantId:p}=l,h="swapWinnerLoser",{matchUps:f}=Sn(t),m=f.filter(({drawPositions:w,roundNumber:S})=>(w==null?void 0:w.includes(c))&&S>o);jc({changeWinner:!0})&&console.log({existingWinnerSubsequentMatchUps:m}),m.forEach(w=>{var S,D;w.drawPositions=((S=w.drawPositions)==null?void 0:S.map(E=>E===c?d:E))||[],sn({tournamentId:i==null?void 0:i.tournamentId,eventId:(D=t.event)==null?void 0:D.eventId,context:h,drawDefinition:a,matchUp:w})});let{stage:g,stageSequence:v}=r,y=a.structures.filter(({stage:w,stageSequence:S})=>w===g&&S>v).map(({structureId:w})=>w),{targetLinks:{loserTargetLink:b,winnerTargetLink:I}}=t.targetData,T=[b==null?void 0:b.target.structureId,(e=I==null?void 0:I.target)==null?void 0:e.structureId].filter(Boolean);return a.structures.filter(({stage:w,structureId:S})=>w!==g&&T.includes(S)).forEach(({stage:w,stageSequence:S,structureId:D})=>{y.includes(D)||y.push(D),a.structures.filter(({stage:E,stageSequence:C})=>E===w&&C>S).forEach(({structureId:E})=>{y.includes(E)||y.push(E)})}),a.structures.filter(({structureId:w})=>y.includes(w)).forEach(w=>{let{positionAssignments:S}=jn({structure:w}),D=S==null?void 0:S.find(({participantId:C})=>C===u),E=S==null?void 0:S.find(({participantId:C})=>C===p);D&&(D.participantId=p),E&&(E.participantId=u)}),ap({...t,context:h})}function jR(t){var e,i,n,r;let a="setMatchUpStatus";t.matchUpStatus&&[Rn,da].includes(t.matchUpStatus)&&(t.score=void 0);let{allowChangePropagation:o,disableScoreValidation:s,tournamentRecords:l,tournamentRecord:c,disableAutoCalc:u,enableAutoCalc:d,drawDefinition:p,matchUpStatus:h,winningSide:f,matchUpId:m,event:g,score:v}=t;if(!p)return{error:Lt};if(h&&[sm,bp,ec,Kr].includes(h)&&f)return{error:Me,winningSide:f,matchUpStatus:h};if(![void 0,...fge].includes(h))return fe({result:{error:RS},info:"matchUpStatus does not exist",stack:"setMatchUpStatus"});let y=ko({drawDefinition:p}),{matchUps:b}=wa({nextMatchUps:!0,tournamentRecord:c,inContext:!0,drawDefinition:p,matchUpsMap:y,event:g}),I=y.drawMatchUps.find(Y=>Y.matchUpId===m),T=b==null?void 0:b.find(Y=>Y.matchUpId===m);if(!I||!b)return{error:qo};if((I.winningSide||f)&&h===yn)return{context:"Cannot have Bye with winningSide",error:xN,matchUpStatus:h};let w=T==null?void 0:T.structureId,{structure:S}=pi({drawDefinition:p,structureId:w}),D=Hr(Jn)(I.matchUpType),E=(e=T==null?void 0:T.drawPositions)==null?void 0:e.filter(Boolean),C;if(D){if(u)un({extension:{name:OS,value:!0},element:I});else if(d){let Y=I.winningSide;Ss({name:OS,element:I});let{winningSide:Q,scoreStringSide1:X,scoreStringSide2:oe,set:re}=RR({drawDefinition:p,matchUpsMap:y,structure:S,matchUp:I,event:g}),me={scoreStringSide1:X,scoreStringSide2:oe,sets:re?[re]:[]};C=Q!==Y,Object.assign(t,{winningSide:Q,dualWinningSideChange:C,projectedWinningSide:Q,score:me})}MR({tournamentId:c==null?void 0:c.tournamentId,inContextDualMatchUp:T,eventId:g==null?void 0:g.eventId,dualMatchUp:I,drawDefinition:p})}if(D&&h&&[sw].includes(h))return{error:Me,info:"Not supported for matchUpType: TEAM"};let P=T==null?void 0:T.matchUpTieId,R=Ms({matchUpId:P||m,inContextDrawMatchUps:b,drawDefinition:p});if(v&&!D&&!s){let Y=I.matchUpFormat??(S==null?void 0:S.matchUpFormat)??(p==null?void 0:p.matchUpFormat)??(g==null?void 0:g.matchUpFormat),Q=D8({existingMatchUpStatus:I.matchUpStatus,matchUpFormat:Y,matchUpStatus:h,winningSide:f,score:v});if(Q.error)return Q}let N=I!=null&&I.sides?[]:jn({drawDefinition:p,structureId:w}).positionAssignments,M=(i=T==null?void 0:T.sides)==null?void 0:i.map(Y=>Y.participantId).filter(Boolean).length,A=M&&M===2||I.collectionId&&Ll({structure:S})&&M&&M>=1||(E==null?void 0:E.length)===2&&(N==null?void 0:N.filter(Y=>E.includes(Y.drawPosition)).every(Y=>Y.participantId));if(h&&hge.includes(h)&&!A)return fe({info:"present in participantsRequiredMatchUpStatuses",context:{matchUpStatus:h,requiredParticipants:A},result:{error:RS}});let _=((n=Mn({policyTypes:[dE,Dh],tournamentRecord:c,drawDefinition:p,event:g}))==null?void 0:n.appliedPolicies)??{};typeof t.policyDefinitions=="object"&&Object.assign(_,t.policyDefinitions);let x=(T==null?void 0:T.stage)===Xt&&T.finishingRound===1,O=x&&f,B=x&&I.winningSide&&!f&&(!t.matchUpStatus||t.matchUpStatus&&dj({matchUpStatus:t.matchUpStatus}))&&(!t.outcome||!uo({outcome:t.outcome})),F=O&&f!==I.winningSide&&I.winningSide;if(Object.assign(t,{inContextDrawMatchUps:b,qualifierAdvancing:O,qualifierChanging:F,removingQualifier:B,inContextMatchUp:T,appliedPolicies:_,matchUpTieId:P,matchUpsMap:y,targetData:R,structure:S,matchUp:I}),P){let{matchUp:Y}=ar({matchUpId:P,inContext:!0,drawDefinition:p,matchUpsMap:y,event:g});if(Y){let Q=(r=ns({matchUp:Y,drawDefinition:p,structure:S,event:g}))==null?void 0:r.tieFormat,{projectedWinningSide:X}=X5e({drawDefinition:p,matchUpStatus:h,dualMatchUp:Y,matchUpsMap:y,winningSide:f,tieFormat:Q,structure:S,matchUp:I,event:g,score:v}),oe=Y.winningSide;C=X!==oe,Object.assign(t,{isCollectionMatchUp:!0,dualWinningSideChange:C,projectedWinningSide:X,matchUpTieId:P,dualMatchUp:Y,tieFormat:Q})}}let G=uy(t),H=pR({matchUpStatus:h});if(!P){if(G&&!f&&(h&&dj({matchUpStatus:h})||h&&[da,Ca].includes(h)))return{error:xN,activeDownstream:G,winningSide:f};if(f&&f===I.winningSide&&h&&!H)return{context:"winningSide must include directing matchUpStatus",error:xN,directingMatchUpStatus:H,matchUpStatus:h}}let{schedule:$}=t;if($){let Y=MF({disableNotice:!0,tournamentRecords:l,tournamentRecord:c,drawDefinition:p,matchUpId:m,schedule:$});if(Y.error)return Y}let q=!D&&!C&&f&&I.winningSide&&I.winningSide!==f;if(o&&q&&I.roundPosition)return f6e(t);let z=f&&!P||t.projectedWinningSide;kc({activeDownstream:G,matchUpWinner:z,method:a,winningSide:f});let Z=!G&&h6e(t)||z&&m6e(t)||H&&r0e(t)||{error:bme};return fe({result:Z,stack:a})}function m6e(t){let{matchUp:e,winningSide:i,matchUpTieId:n,dualWinningSideChange:r}=t;return i===e.winningSide||n&&!r?r0e(t):fe({stack:"winningSideWithDownstreamDependencies",result:{error:i5},context:{winningSide:i,matchUp:e}})}function r0e(t){let{tournamentRecord:e,matchUp:i,event:n}=t,r=t.isCollectionMatchUp&&i.winningSide&&!t.winningSide&&!uo({score:t.score}),a=t.isCollectionMatchUp?t.matchUpStatus||r&&Kr||ia:t.matchUpStatus||ia,o=t.removeScore||[sm,Rn].includes(a)&&![bp,ec].includes(a),s=ap({...t,matchUpStatus:a,removeWinningSide:r,context:"sms",removeScore:o});if(s.error)return s;if(t.isCollectionMatchUp){let{matchUpTieId:l,drawDefinition:c,matchUpsMap:u}=t,d=hm({appliedPolicies:t.appliedPolicies,matchUpId:l,tournamentRecord:e,drawDefinition:c,matchUpsMap:u,event:n});if(d.error)return d;Object.assign(s,{tieMatchUpResult:d})}return s}function a0e({tournamentRecord:t,drawDefinition:e,matchUpId:i,event:n}){if(!e)return{error:Lt};let{matchUp:r}=ar({drawDefinition:e,matchUpId:i,event:n});return(r==null?void 0:r.matchUpType)!==Ip?{error:Ws}:jR({enableAutoCalc:!0,tournamentRecord:t,drawDefinition:e,matchUpId:i,event:n})}function o0e({drawDefinition:t,event:e,matchUpId:i}){if(!t)return{error:Lt};if(!i)return{error:_o};let{matchUp:n}=ar({drawDefinition:t,event:e,matchUpId:i});return n?Ss({name:fL,element:n}):{error:qo}}function g6e({substituteParticipantId:t,existingParticipantId:e,tournamentRecord:i,drawDefinition:n,sideNumber:r,matchUpId:a,event:o}){var s,l,c,u,d;let p="substituteParticipant";if(!n)return{error:Lt};if(!a)return{error:_o};if(!e||!t)return fe({result:{error:Ra},stack:p});let{matchUp:h}=ar({drawDefinition:n,matchUpId:a,event:o});if(!h)return{error:qo};if(!h.collectionId)return fe({result:{error:Ws},stack:p});let f=ko({drawDefinition:n}),{matchUps:m}=wa({tournamentParticipants:i==null?void 0:i.participants,inContext:!0,drawDefinition:n,matchUpsMap:f}),g=m==null?void 0:m.find(y=>y.matchUpId===a),v=(l=(s=m==null?void 0:m.find(y=>y.matchUpId===(g==null?void 0:g.matchUpTieId)))==null?void 0:s.sides)==null?void 0:l.find(y=>y.participant.individualParticipants.some(({participantId:b})=>b===e));return!v||r&&v.sideNumber!==r?{error:vp}:(d=(u=(c=v.participant)==null?void 0:c.individualParticipants)==null?void 0:u.map(Wi).filter(y=>y!==e))!=null&&d.includes(t)?I7({newParticipantId:t,tieMatchUpId:a,existingParticipantId:e,substitution:!0,tournamentRecord:i,drawDefinition:n,event:o}):fe({result:{error:vp},stack:p})}function s0e(t){return g6e(t)}function l0e({drawDefinition:t,matchUpId:e,event:i}){if(!t)return{error:Lt};let{matchUp:n}=ar({drawDefinition:t,matchUpId:e,event:i});return un({extension:{name:OS,value:!0},element:n})}function c0e(t){let e="setMatchUpFormat",i=mn(t,[{tournamentRecord:!0},{[nd]:T=>Fl({matchUpFormat:T}),[Sh]:kP,matchUpFormat:!0}]);if(i.error)return fe({result:i,stack:e});let{tournamentRecord:n,drawDefinition:r,scheduledDates:a,stageSequences:o,matchUpFormat:s,structureId:l,eventType:c,matchUpId:u,eventId:d,stages:p,drawId:h,event:f,force:m}=t;if(a&&!Array.isArray(a))return fe({result:{error:Me,scheduledDates:a},stack:e});if(c&&!NL([Mh,xu],c))return fe({result:{error:ng},stack:e});let g=0,v=t.structureIds||l&&[l].filter(Boolean)||[],y=t.eventIds||d&&[d].filter(Boolean)||[],b=t.drawIds||h&&[h].filter(Boolean)||[];if((l||v!=null&&v.length)&&!r)return fe({result:{error:Lt},stack:e});if(h&&u&&r){let T=R8({tournamentRecord:n,drawDefinition:r,matchUpFormat:s,structureIds:v,structureId:l,matchUpId:u});if(T.error)return T;g+=1}let I=T=>{let w=[];for(let S of T.structures||[]){if(Array.isArray(p)&&!p.includes(S.stage)||Array.isArray(o)&&!o.includes(S.stageSequence)||v!=null&&v.length&&!v.includes(S.structureId))continue;v!=null&&v.length&&S.matchUpFormat!==s&&(S.matchUpFormat=s,w.push(S.structureId),g+=1);let D=((m||a)&&Sn({matchUpFilters:{matchUpStatuses:[Kr]},structure:S}).matchUps)??[],E=(a&&Sn({matchUpFilters:{matchUpStatuses:[Kr]},contextFilters:{scheduledDates:a},afterRecoveryTimes:!1,inContext:!0,structure:S}).matchUps)??[];if(D!=null&&D.length){let C=E?E.map(Va):D.map(Va);for(let P of D)C.includes(P.matchUpId)&&(P.matchUpFormat=a!=null&&a.length?s:void 0,sn({tournamentId:n==null?void 0:n.tournamentId,eventId:f==null?void 0:f.eventId,context:e,drawDefinition:T,matchUp:P}))}}return!w.length&&T.matchUpFormat!==s&&(T.matchUpFormat=s,g+=1),w};for(let T of(n==null?void 0:n.events)||[])if(!(y!=null&&y.length&&!y.includes(T.eventId)||c&&c!==T.eventType||c===Fa))if(Array.isArray(o)||Array.isArray(p)||v!=null&&v.length||b!=null&&b.length)for(let w of T.drawDefinitions||[]){if(Array.isArray(b)&&!b.includes(w.drawId))continue;let S=I(w);er({structureIds:S,drawDefinition:w})}else T.matchUpFormat!==s&&(T.matchUpFormat=s,g+=1);return g?{...ue,modificationsCount:g}:{...ue,info:sU}}function C7({inheritance:t=!0,tournamentRecord:e,drawDefinition:i,matchUpId:n,event:r}){var a,o;if(!i)return{error:Lt};let s=(a=ar({drawDefinition:i,matchUpId:n}))==null?void 0:a.matchUp;if(!(s!=null&&s.tieMatchUps))return{error:Ws};let l=(o=ar({inContext:!0,drawDefinition:i,matchUpId:n,event:r}))==null?void 0:o.matchUp,c=0;return((s==null?void 0:s.sides)||[]).forEach(u=>{u.lineUp&&delete u.lineUp}),((l==null?void 0:l.sides)||[]).forEach(u=>{if(c+=1,t===!1){let d=l==null?void 0:l.tieFormat,p=u.participantId;d&&p&&yw({drawDefinition:i,participantId:p,lineUp:[],tieFormat:d})}sn({tournamentId:e==null?void 0:e.tournamentId,context:"resetMatchUpLineUps",eventId:r==null?void 0:r.eventId,drawDefinition:i,matchUp:s})}),{...ue,modificationsCount:c}}function u0e(t){let{matchUpFormat:e,matchUpStatus:i,winningSide:n,score:r}=t;if(!r)return{sets:[]};let a=r.sets||[],o=ch({winnerFirst:!1,matchUpFormat:e,matchUpStatus:i,sets:a}),s=ch({winnerFirst:!1,reversed:!0,matchUpFormat:e,matchUpStatus:i,sets:a}),l=ch({matchUpFormat:e,matchUpStatus:i,winningSide:n,sets:a}),c=o===l?s:o;return n&&(o=n===1?l:c,s=n===2?l:c),{score:{sets:a,scoreStringSide1:o,scoreStringSide2:s}}}function GR(t){var e;let i=mn(t,[{[_y]:!0,[Md]:!0}]);if(i.error)return i;let n=_p(t);if(!t.drawDefinition){let y=t.tournamentRecord??(t.tournamentId&&n[t.tournamentId]);t.tournamentRecord||(t.tournamentRecord=y);let b=Ks({eventId:t.eventId,drawId:t.drawId,tournamentRecord:y});if(b.error)return b;b.drawDefinition&&(t.drawDefinition=b.drawDefinition),t.event=b.event}let{disableScoreValidation:r,policyDefinitions:a,tournamentRecord:o,disableAutoCalc:s,enableAutoCalc:l,drawDefinition:c,matchUpFormat:u,matchUpId:d,schedule:p,event:h,notes:f}=t,{policy:m}=Fy({policyType:Dh,tournamentRecord:o,event:h}),g=t.allowChangePropagation!==void 0&&t.allowChangePropagation||(m==null?void 0:m.allowChangePropagation)!==void 0&&m.allowChangePropagation||void 0,{outcome:v}=t;if(v!=null&&v.winningSide&&![1,2].includes(v.winningSide))return{error:QO};if(u){let y=R8({tournamentRecord:o,drawDefinition:c,matchUpFormat:u,matchUpId:d,event:h});if(y.error)return y}if((e=v==null?void 0:v.score)!=null&&e.sets&&!v.score.scoreStringSide1){let{score:y}=u0e(v);v.score=y,v.score.sets=v.score.sets.filter(b=>b.side1Score||b.side2Score||b.side1TiebreakScore||b.side2TiebreakScore)}return jR({matchUpStatusCodes:v==null?void 0:v.matchUpStatusCodes,matchUpStatus:v==null?void 0:v.matchUpStatus,winningSide:v==null?void 0:v.winningSide,allowChangePropagation:g,disableScoreValidation:r,score:v==null?void 0:v.score,tournamentRecords:n,policyDefinitions:a,tournamentRecord:o,disableAutoCalc:s,enableAutoCalc:l,drawDefinition:c,matchUpFormat:u,matchUpId:d,schedule:p,event:h,notes:f})}function d0e(t){if(!(t!=null&&t.outcomes))return{error:Ht};if(!Array.isArray(t.outcomes))return{error:Ht,info:{outcomes:t.outcomes}};let e=t.tournamentRecords||t.tournamentRecord&&{[t.tournamentRecord.tournamentId]:t.tournamentRecord}||{},i=t.outcomes??[],n=i.reduce((r,a)=>r.includes(a.tournamentId)?r:r.concat(a.tournamentId),[]);for(let r of n){let a=e[r];if(!a)return{error:it};let o=i.filter(s=>s.tournamentId===r);if(o.length){let s=v6e({outcomes:o,tournamentRecord:a});if(s.error)return s}}return{...ue}}function v6e(t){var e;let{tournamentRecords:i,tournamentRecord:n,outcomes:r,policyDefinitions:a}=t,o={};r.forEach(s=>{let{eventId:l}=s;o[l]||(o[l]=[]),o[l].push(s)});for(let s of Object.keys(o)){let{event:l}=Ks({tournamentRecord:n,eventId:s});for(let c of o[s]){let{drawId:u}=c,d=(e=l==null?void 0:l.drawDefinitions)==null?void 0:e.find(p=>p.drawId===u);if(d&&u){let{matchUpFormat:p,matchUpId:h}=c,f=GR({schedule:c==null?void 0:c.schedule,tournamentRecords:i,policyDefinitions:a,tournamentRecord:n,drawDefinition:d,matchUpFormat:p,matchUpId:h,outcome:c,drawId:u,event:l});if(f.error)return f}}}return{...ue}}function y6e({drawDefinition:t,matchUpId:e,outcome:i,matchUp:n}){var r,a;if(!n&&!t)return{error:Lt};if(!i)return{error:Ht,info:"missing outcome"};if(!n&&!e)return{error:cl};if(!n){let o=ar({drawDefinition:t,matchUpId:e});if(o.error)return o;n=o.matchUp}return typeof i!="object"||!((r=i.score)!=null&&r.scoreStringSide1)||!((a=i.score)!=null&&a.scoreStringSide2)?{error:Me}:un({element:n,extension:{name:fL,value:i}})}function p0e(t){return y6e(t)}function P7(t){var e,i;let n="resetTieFormat",{drawDefinition:r,event:a,uuids:o}=t,s=mn(t,[{[Lh]:!0,[_y]:!0}],n);if(s.error)return s;let l=BR(t,[{[VP]:Og}]);if(l[kb])return l;let c=(e=t.tournamentRecord)==null?void 0:e.tournamentId,{matchUp:u,structure:d}=(l==null?void 0:l.matchUp)??{};if(!(u!=null&&u.tieMatchUps))return fe({result:{error:Ws},info:"Must be a TEAM matchUp",stack:n});if(!u.tieFormat)return{...ue};let p=(i=ns({structure:d,drawDefinition:r,event:a}))==null?void 0:i.tieFormat;if(!p)return fe({result:{error:Wo},info:"No inherited tieFormat",stack:n});let h=[],f=[],m=[],g=[];for(let v of p.collectionDefinitions){let{matchUpCount:y,collectionId:b}=v;f.push(b);let I=(u.tieMatchUps||[]).filter(T=>T.collectionId===b);if(I.length>y)I.sort((T,w)=>(T.matchUpStatus===Kr?1:0)-(w.matchUpStatus===Kr?1:0)),m.push(...I.slice(0,y)),h.push(...I.slice(3).map(Va));else if(m.push(...I),I.length<y){let T=y-I.length,w=DR({collectionDefinition:v,matchUpsLimit:T,matchUp:u,uuids:o});g.push(...w)}}for(let v of(u==null?void 0:u.tieMatchUps)||[])v.collectionId&&!f.includes(v.collectionId)&&h.push(v.matchUpId);return g.length&&(m.push(...g),lg({eventId:a==null?void 0:a.eventId,matchUps:g,drawDefinition:r,tournamentId:c})),h.length&&lm({matchUpIds:h,eventId:a==null?void 0:a.eventId,drawDefinition:r,tournamentId:c}),u&&(u.tieMatchUps=m,u.tieFormatId=void 0,u.tieFormat=void 0,sn({structureId:d==null?void 0:d.structureId,eventId:a==null?void 0:a.eventId,context:n,drawDefinition:r,tournamentId:c,matchUp:u})),{...ue,newMatchUps:g,deletedMatchUpIds:h}}function R7(t){var e,i,n;let{tournamentRecord:r,drawDefinition:a,matchUpId:o,event:s}=t,l="resetScorecard";if(!a)return fe({result:{error:Lt},stack:l});if(!o)return fe({result:{error:_o},stack:l});if(!qs(o))return fe({result:{error:Me,matchUpId:o},stack:l});let c=ko({drawDefinition:a}),{matchUps:u}=wa({nextMatchUps:!0,inContext:!0,drawDefinition:a,matchUpsMap:c}),d=c.drawMatchUps.find(y=>y.matchUpId===o),p=u==null?void 0:u.find(y=>y.matchUpId===o);if(!d||!u)return{error:qo};if(d.matchUpType!==Hc)return{error:Ws};let h=Ms({inContextDrawMatchUps:u,drawDefinition:a,matchUpId:o}),f=p==null?void 0:p.structureId,{structure:m}=pi({drawDefinition:a,structureId:f});if(Object.assign(t,{inContextDrawMatchUps:u,inContextMatchUp:p,matchUpsMap:c,targetData:h,structure:m,matchUp:d}),uy(t))return{error:i5};if((e=d.tieMatchUps)!=null&&e.length)for(let y of d.tieMatchUps){let b=jR({matchUpId:y.matchUpId,matchUpTieId:o,winningSide:void 0,removeScore:!0,tournamentRecord:r,drawDefinition:a,event:s});if(b.error)return fe({result:b,stack:l})}let g=(i=Mn({tournamentRecord:r,drawDefinition:a,event:s}))==null?void 0:i.appliedPolicies,v=hm({event:t.event,removeScore:!0,tournamentRecord:r,appliedPolicies:g,drawDefinition:a,matchUpsMap:c,matchUpId:o});if(v.error)return fe({result:v,stack:l});if(t.tiebreakReset&&!v.tieFormatRemoved){let y=(n=ns({drawDefinition:a,structure:m,event:s}))==null?void 0:n.tieFormat;if(d.tieFormat&&y){let{matchUpCountDifference:b,descendantDifferences:I,ancestorDifferences:T,valueDifference:w}=Hf({descendant:d.tieFormat,ancestor:y});if(I.collectionIds.length===1&&!T.collectionIds.length&&!T.groupsCount&&b===1&&w===1){let S=P7({tournamentRecord:r,drawDefinition:a,matchUpId:o,event:s});if(S.error)return S}}}return{...ue}}function h0e(t){let e=mn(t,[{[Md]:!0,[cU]:!0},{[cE]:{[$P]:!1,roundNumbers:!1},[Yme]:"At least one must be provided",[Lg]:bl}]);if(e.error)return e;let i=Bye(t);if(i.error)return i;let{matchUpIds:n}=i,r=Hr(Hc)(t.event.eventType),{tournamentRecord:a,drawDefinition:o,event:s}=t;for(let l of n){if(r){let u=R7({tiebreakReset:!0,tournamentRecord:a,drawDefinition:o,matchUpId:l,event:s});if(u.error||t.removeAssignments&&C7({inheritance:!1,drawDefinition:o,matchUpId:l}).error)return u}let c=jR({winningSide:void 0,removeScore:!0,tournamentRecord:a,drawDefinition:o,matchUpId:l,event:s});if(c.error)return c;if(t.removeAssignments){let u=w7({...t,matchUpId:l});if(u.error)return u}}return{...ue}}function b6e({drawDefinition:t,finishingOrder:e}){var i;if(!t)return{error:Lt};let n="setOrderOfFinish";if(!Array.isArray(e))return fe({info:Nh("finishingOrder"),result:{error:Me},stack:n});let{completedMatchUps:r,matchUpsMap:a}=SU({inContext:!0,drawDefinition:t}),o=(r==null?void 0:r.map(Va))??[],s=e.map(Va),{matchUpTypes:l,roundNumbers:c,structureIds:u,matchUpTieIds:d}=(r??[]).filter(({matchUpId:y})=>s.includes(y)).reduce((y,b)=>{let{matchUpTieId:I,matchUpType:T,roundNumber:w,structureId:S}=b;return y.matchUpTypes.includes(T)||y.matchUpTypes.push(T),y.roundNumbers.includes(w)||y.roundNumbers.push(w),y.structureIds.includes(S)||y.structureIds.push(S),y.matchUpTieIds.includes(I)||y.matchUpTieIds.push(I),y},{matchUpTypes:[],roundNumbers:[],structureIds:[],matchUpTieIds:[]});if(l.length>1||d.length>1||c.length>1||u.length>1)return fe({info:"matchUpType, structureId and roundNumber must be equivalent",result:{error:Me},stack:n});let p,h,f={},m=[],g=[];if(!e.every(({orderOfFinish:y,matchUpId:b})=>(m.push(b),y&&g.push(y),f[b]=y,p=o.includes(b),h=y===void 0||bi(y)&&Math.floor(y)>0,p&&h)))return fe({result:{error:p?Me:RS},info:!p&&"matchUps must be completed"||!h&&"orderOfFinish must be integer > 0 or undefined"||void 0,stack:n});let v=r==null?void 0:r.filter(y=>y.structureId===u[0]&&y.roundNumber===c[0]&&y.matchUpType===l[0]&&y.matchUpTieId===d[0]&&!m.includes(y.matchUpId));for(let y of v??[]){let{orderOfFinish:b}=y||{};if(b){if(!bi(b))return fe({context:{orderOfFinish:b,matchUp:y},result:{error:Me},stack:n});g.push(b)}}if(Rme(g).length!==g.length||Math.max(...g)>g.length)return fe({info:"Values not unique or greater than expected number of values",result:{error:Me},stack:n});if(u.length){let y=AL({matchUpFilters:{matchUpIds:s},structureId:u[0],drawDefinition:t,matchUpsMap:a});if(y.error)return fe({result:y,stack:n});(i=y.completedMatchUps)==null||i.forEach(b=>b.orderOfFinish=f[b.matchUpId])}return{...ue}}function f0e(t){return b6e(t)}function m0e({tournamentRecord:t,drawDefinition:e,matchUpId:i,lineUps:n,event:r}){var a,o,s,l;if(!t)return{error:it};if(!e)return{error:_l};if(typeof i!="string")return{error:Ws};if(!Array.isArray(n))return{error:Me,lineUps:n};let c="applyLineUps",u=t.participants||[],d=ar({tournamentParticipants:u,inContext:!0,drawDefinition:e,matchUpId:i});if(d.error)return d;if(!d.matchUp)return{error:qo};let{matchUp:p,structure:h}=d,{drawPositions:f,matchUpType:m}=p;if(m!==Jn)return{error:Ws};if(!(f!=null&&f.length))return{error:AP};let g=(a=ns({matchUp:p,drawDefinition:e,structure:h,event:r}))==null?void 0:a.tieFormat,v={};for(let b of n){if(!Array.isArray(b))return{error:Me,lineUp:b};let I={},T=[];for(let C of b){if(typeof C!="object")return{error:Me,lineUpAssignment:C};let{participantId:P,collectionAssignments:R=[]}=C;if(!Array.isArray(R))return{error:Me,collectionAssignments:R};let N=u.find(A=>A.participantId===P);if(!N)return{error:Jr};if(N.participantType!==Ki)return{error:Sd};let M=(s=(o=p.sides)==null?void 0:o.find(A=>{var _,x;return(x=(_=A.participant)==null?void 0:_.individualParticipantIds)==null?void 0:x.includes(P)}))==null?void 0:s.sideNumber;M&&T.push(M);for(let A of R){if(typeof A!="object")return{error:Me,collectionAssignment:A};let{collectionId:_,collectionPosition:x}=A,O=(l=g==null?void 0:g.collectionDefinitions)==null?void 0:l.find(G=>G.collectionId===_);if(!O)return{error:Me,collectionId:_};let B=`${_}-${x}`;I[B]||(I[B]=[]);let F=I[B].length;if(Hr(Mr)(O.matchUpType)&&F||O.matchUpType===Zn&&F>1)return{info:"Excessive collectionPosition assignments",error:Me};I[B].push(P)}}let w=Object.values(I);for(let C of w)if(C.length===2){let{participant:P}=Ou({tournamentParticipants:u,participantIds:C});if(!P){let R=Up({participant:{participantType:Ui,participantRole:jo,individualParticipantIds:C},pairOverride:!0,tournamentRecord:t});if(R.error)return R}}let S=xl(T),D=(S[1]||0)>(S[2]||0)&&1||(S[2]||0)>(S[1]||0)&&2||void 0,E=Object.keys(v).map(C=>parseInt(C));D&&!E.includes(D)&&(v[D]=b)}if(!Object.keys(v).length)return{error:d5};if(d=ar({drawDefinition:e,matchUpId:i}),d.error)return d;if(!d.matchUp)return{error:qo};let{matchUp:y}=d;y.sides||(y.sides=[]);for(let b of[1,2]){let I=y.sides.find(w=>w.sideNumber===b),T=v[b];if(T)I?I.lineUp=T:y.sides.push({lineUp:T,sideNumber:b});else continue}return sn({tournamentId:t==null?void 0:t.tournamentId,context:c,drawDefinition:e,matchUp:y}),{...ue}}var M7={};zi(M7,{anonymizeTournamentRecord:()=>$0e,generate:()=>g0e,generateEventWithDraw:()=>xF,generateOutcome:()=>L7,generateOutcomeFromScoreString:()=>N7,generateParticipants:()=>WR,generateTournamentRecord:()=>F0e,modifyTournamentRecord:()=>V0e,mutate:()=>B0e});var g0e={};zi(g0e,{generateEventWithDraw:()=>xF,generateOutcome:()=>L7,generateOutcomeFromScoreString:()=>N7,generateParticipants:()=>WR,generateTournamentRecord:()=>F0e});function N7(t){let{matchUpFormat:e,matchUpStatus:i,winningSide:n,scoreString:r}=t;if(!r)return{outcome:{...$L,winningSide:n,matchUpStatus:i}};if(n&&![1,2,void 0].includes(n))return{error:Me,winningSide:n};let a=r&&V_({scoreString:r}),o={},s=ch({sets:a,matchUpFormat:e}),l=ch({sets:a,reversed:!0,matchUpFormat:e});return n===2?(o.scoreStringSide1=l,o.scoreStringSide2=s):(o.scoreStringSide1=s,o.scoreStringSide2=l),o.sets=V_({scoreString:o.scoreStringSide1}),qt({outcome:{matchUpStatus:i,winningSide:n,score:o}})}function A7({matchUpScheduleTimes:t,matchUpDependencies:e,allDateMatchUpIds:i,matchUp:n}){var r;let a=(((r=e==null?void 0:e[n.matchUpId])==null?void 0:r.matchUpIds)||[]).filter(o=>i.includes(o)).filter(o=>!t[o]);return{dependenciesScheduled:!(a!=null&&a.length),remainingDependencies:a}}function ZS({matchUpPotentialParticipantIds:t,matchUpNotBeforeTimes:e,timeAfterRecovery:i,matchUp:n}){var r,a,o,s;let{individualParticipantIds:l}=DL(n);i=i??((r=n.schedule)==null?void 0:r.timeAfterRecovery);let c=h=>{t[h]||(t[h]=[]),t[h]=ki(t[h].concat(...l))},u=h=>{i&&(!e[h]||i>e[h])&&(e[h]=i)},d=((a=n.winnerTo)==null?void 0:a.matchUpId)||n.winnerMatchUpId;d&&(i&&u(d),c(d));let p=((o=n.loserTo)==null?void 0:o.matchUpId)||n.loserMatchUpId;p&&(i&&u(p),c(p)),(s=n.sidesTo)!=null&&s.length&&n.sidesTo.forEach(({matchUpId:h})=>{h&&(i&&u(h),c(h))})}function HR({individualParticipantProfiles:t,participantId:e}){t[e]||(t[e]={typeChangeTimeAfterRecovery:void 0,timeAfterRecovery:void 0,priorMatchUpType:void 0,potentialRecovery:{},potentialCounted:{},potentialBookings:{},bookings:[],counters:{}})}function I6e({individualParticipantProfiles:t,recoveryValue:e,participantId:i,scheduleTime:n,drawId:r}){t[i].potentialRecovery[r]||(t[i].potentialRecovery[r]=[]),t[i].potentialRecovery[r].push(e),t[i].potentialBookings[r]||(t[i].potentialBookings[r]=[]),t[i].potentialBookings[r].push({timeAfterRecovery:e,scheduleTime:n})}function ME({matchUpPotentialParticipantIds:t,individualParticipantProfiles:e,typeChangeRecoveryMinutes:i,averageMatchUpMinutes:n=0,matchUpNotBeforeTimes:r,matchUpDependencies:a,recoveryMinutes:o=0,scheduleTime:s,matchUp:l}){var c,u;let d=rr((c=l==null?void 0:l.schedule)==null?void 0:c.endTime),p=d?il(d,ai(o)):il(s,ai(n)+ai(o)),h=i&&(d?il(rr(d),i):il(s,ai(n)+ai(i))),f=((u=a==null?void 0:a[l.matchUpId])==null?void 0:u.participantIds)||[],m=(l.roundPosition&&t[l.matchUpId]||[]).flat();f.forEach(g=>{HR({individualParticipantProfiles:e,participantId:g});let v=e[g].priorMatchUpType!==l.matchUpType&&h||p;m.includes(g)?I6e({individualParticipantProfiles:e,drawId:l.drawId,recoveryValue:v,participantId:g,scheduleTime:s}):(e[g].timeAfterRecovery=v,e[g].bookings.push({scheduleTime:s,timeAfterRecovery:v}))}),ZS({matchUpPotentialParticipantIds:t,matchUpNotBeforeTimes:r,timeAfterRecovery:p,matchUp:l})}function v0e({matchUpScheduleTimes:t,matchUpDependencies:e,scheduleTime:i,matchUpId:n,details:r}){var a,o,s,l,c;let u,d=(o=(a=r.minutesMap)==null?void 0:a[n])==null?void 0:o.recoveryMinutes,p=(((l=(s=r.minutesMap)==null?void 0:s[n])==null?void 0:l.averageMinutes)||0)+(d||0),h=il(i,p),f=((c=e==null?void 0:e[n])==null?void 0:c.dependentMatchUpIds)||[];if(f.length){let m=f.reduce((g,v)=>{let y=t[v];if(!y)return g;let b={scheduleTime:y,matchUpId:v};return y&&!g.matchUpId||on(y)<on(g.scheduleTime)?b:g},{});m.scheduleTime&&on(h)>on(m.scheduleTime)&&(u=m)}return{scheduledDependent:u}}function w6e(t){let{sides:e,matchUpType:i}=t||{};return(e||[]).map(n=>{var r;return i===Zn&&(((r=n==null?void 0:n.participant)==null?void 0:r.individualParticipants)||[])||(n==null?void 0:n.participant)&&[n.participant]||[]}).flat()}var zR="DO_NOT_SCHEDULE",S6e={DO_NOT_SCHEDULE:zR};function _7({averageMatchUpMinutes:t=90,requestConflicts:e={},potentials:i=!0,personRequests:n,scheduleTime:r,scheduleDate:a,matchUp:o}){let s=w6e(o).map(({person:h})=>h==null?void 0:h.personId);if(i){let h=((o==null?void 0:o.potentialParticipants)||[]).flat().map(({person:f})=>f==null?void 0:f.personId);s.push(...h)}let l=s.map(h=>{var f;return(f=n[h])==null?void 0:f.map(m=>({...m,personId:h}))}).filter(Boolean).flat().filter(h=>h.requestType===zR&&Uh(a,h.date)),c=[],u=o==null?void 0:o.matchUpId,d=ca(rr(r),Ci(a)),p=rr(M5(d,t).toISOString());for(let h of l){let{requestId:f,startTime:m,endTime:g}=h;(r>m&&r<g||p>m&&p<g)&&(c.push({matchUpId:u,request:h,scheduleTime:r}),e[f]?(e[f].scheduleTimes.includes(r)||e[f].scheduleTimes.push(r),e[f].matchUpIds.includes(u)||e[f].matchUpIds.push(u)):e[f]={request:h,scheduleTimes:[r],matchUpIds:[u]})}return{conflicts:c}}function Bj({matchUpPotentialParticipantIds:t,individualParticipantProfiles:e,matchUp:i,value:n}){let{matchUpType:r}=i,{individualParticipantIds:a}=DL(i),o=(t[i.matchUpId]||[]).filter(s=>!Ps(s,a)).flat();[...a,...o].forEach(s=>{if(HR({individualParticipantProfiles:e,participantId:s}),!e[s].potentialCounted[i.drawId]){let l=e[s].counters;l[r]?l[r]+=n:n>0&&(l[r]=n),l[Tu]?l[Tu]+=n:n>0&&(l[Tu]=n),o.includes(s)&&(e[s].potentialCounted[i.drawId]=!0)}})}function T6e({matchUpPotentialParticipantIds:t,individualParticipantProfiles:e,dateScheduledMatchUpIds:i,greatestAverageMinutes:n,dateScheduledMatchUps:r,matchUpNotBeforeTimes:a,matchUpScheduleTimes:o,matchUpDependencies:s,clearScheduleDates:l,scheduleDate:c,minutesMap:u,matchUps:d}){var p,h;let f=[];i||(r=d==null?void 0:d.filter(v=>{let y=v.schedule||{},b=v.matchUpStatus===yn;return b&&f.push({tournamentId:v.tournamentId,matchUpId:v.matchUpId}),!b&&LR({schedule:y})&&(!c||v.schedule.scheduledDate===c)}),i=r.map(Va));let m=Array.isArray(l)?l.includes(c):l,g=m?[]:d.filter(({matchUpId:v})=>i.includes(v));for(let v of g){Bj({matchUpPotentialParticipantIds:t,individualParticipantProfiles:e,value:1,matchUp:v});let y=(p=v.schedule)==null?void 0:p.scheduledTime;if(y){o[v.matchUpId]=y;let b=(h=u==null?void 0:u[v.matchUpId])==null?void 0:h.recoveryMinutes;ME({individualParticipantProfiles:e,matchUpPotentialParticipantIds:t,matchUpNotBeforeTimes:a,matchUpDependencies:s,averageMatchUpMinutes:n,recoveryMinutes:b,scheduleTime:y,matchUp:v})}}return{dateScheduledMatchUpIds:i,byeScheduledMatchUpDetails:f,dateScheduledMatchUps:r,clearDate:m}}function U6e({matchUpPotentialParticipantIds:t,scheduleCompletedMatchUps:e,dateScheduledMatchUpIds:i,matchUpNotBeforeTimes:n,matchUpScheduleTimes:r,orderedMatchUpIds:a,clearDate:o,matchUps:s}){let l=Object.keys(r),c=a.map(d=>s.find(p=>p.matchUpId===d)).filter(Boolean).filter(d=>{let p=!o&&(i.includes(d.matchUpId)||l.includes(d.matchUpId)),h=[yn,fn,ia,ec,os,Rn,da,Ca].includes(d==null?void 0:d.matchUpStatus);return e||!p&&!d.winningSide&&!h}),{matchUpMap:u}=c.reduce((d,p)=>{let{drawId:h,tournamentId:f}=p;return d.matchUpMap[f]||(d.matchUpMap[f]={}),d.matchUpMap[f][h]?d.matchUpMap[f][h].push(p):d.matchUpMap[f][h]=[p],ZS({matchUpPotentialParticipantIds:t,matchUpNotBeforeTimes:n,matchUp:p}),d},{matchUpMap:{}});return{matchUpsToSchedule:c,matchUpMap:u}}function AF({defaultRecoveryMinutes:t=0,averageMatchUpMinutes:e=90,dateScheduledMatchUps:i,tournamentRecords:n,venueIds:r=[],periodLength:a,scheduleDate:o,matchUps:s}){if(typeof n!="object")return{error:_r};if(!Zc(s)&&!Array.isArray(i))return{error:Oh};a=a??DF({recoveryMinutes:t,averageMatchUpMinutes:e});let l=Object.assign({},...Object.values(n).map(d=>(d.events??[]).map(p=>{let{scheduleTiming:h}=oR({tournamentRecord:d,event:p});return{[p.eventId]:{event:p,scheduleTiming:h}}})).flat()),c={averageTimes:[{minutes:{default:e}}],recoveryTimes:[{minutes:{default:t}}]};i||(i=s==null?void 0:s.filter(d=>{let p=d.schedule;return LR({schedule:p})&&(!o||d.schedule.scheduledDate===o)}));let u=i==null?void 0:i.filter(d=>(!r.length||r.includes(d.schedule.venueId))&&d.matchUpStatus!==yn);return{bookings:u==null?void 0:u.map(({eventId:d,schedule:p,matchUpFormat:h})=>{let{event:f,scheduleTiming:m}=l[d],g=f==null?void 0:f.eventType,v={...m,defaultTiming:c,matchUpFormat:h},{averageMinutes:y,recoveryMinutes:b}=CL({timingDetails:v,eventType:g}),{courtId:I,venueId:T}=p,w=rr(p.scheduledTime),S=il(w,y);return{recoveryMinutes:b,averageMinutes:y,periodLength:a,startTime:w,courtId:I,endTime:S,venueId:T}}).filter(Boolean),relevantMatchUps:u,dateScheduledMatchUps:i}}function D6e({calculateStartTimeFromCourts:t=!0,remainingScheduleTimes:e,defaultRecoveryMinutes:i,averageMatchUpMinutes:n,clearScheduleDates:r,tournamentRecords:a,tournamentRecord:o,periodLength:s,scheduleDate:l,startTime:c,venueIds:u,matchUps:d,endTime:p}){if(o&&!a&&(a={[o.tournamentId]:o}),typeof a!="object"||!Object.keys(a).length)return{error:_r};s=s??DF({recoveryMinutes:i,averageMatchUpMinutes:n});let{courts:h,venues:f}=fm({dates:[l],ignoreDisabled:!0,tournamentRecords:a}),m=(h==null?void 0:h.filter(T=>!u||u.includes(T.venueId)))??[];c=c??YS({courts:m,scheduleDate:l,startTime:!0}),p=p??YS({courts:m,scheduleDate:l,endTime:!0});let{bookings:g,dateScheduledMatchUps:v}=AF({defaultRecoveryMinutes:i,averageMatchUpMinutes:n,tournamentRecords:a,scheduleDate:l,periodLength:s,venueIds:u,matchUps:d}),y={calculateStartTimeFromCourts:t,remainingScheduleTimes:e,averageMatchUpMinutes:n,clearScheduleDates:r,date:l,periodLength:s,startTime:c,bookings:g,endTime:p,courts:m},{scheduleTimes:b}=g7(y),I=(u==null?void 0:u.length)===1&&u[0]||(f==null?void 0:f.length)===1&&f[0].venueId||void 0;return{dateScheduledMatchUpIds:v==null?void 0:v.map(Ol("matchUpId")),dateScheduledMatchUps:v,scheduleTimes:b,venueId:I}}function E6e({scheduledRoundsDetails:t,greatestAverageMinutes:e,garmanSinglePass:i}){let n=[],r=[],a,o,s,l;for(let c of t.filter(Boolean))l||(l=c.hash),(c.hash===l||i)&&(r=r.concat(c.matchUpIds)),c.hash!==l&&!i&&(l=c.hash,n.push({averageMinutes:s,recoveryMinutes:o,roundPeriodLength:a,matchUpIds:r}),r=c.matchUpIds),s=i?e:c.averageMinutes,o=c.recoveryMinutes,a=c.roundPeriodLength;return r.length&&n.push({matchUpIds:r,roundPeriodLength:a,recoveryMinutes:o,averageMinutes:s}),{groupedRounds:n}}function y0e({matchUpPotentialParticipantIds:t,individualParticipantProfiles:e,scheduleCompletedMatchUps:i,containedStructureIds:n,matchUpNotBeforeTimes:r,matchUpScheduleTimes:a,matchUpDependencies:o,clearScheduleDates:s,tournamentRecords:l,periodLength:c,scheduleDate:u,useGarman:d,matchUps:p,courts:h,venues:f}){var m;let g={},v=[],y=[],b=[];for(let I of f){let{rounds:T=[],venueId:w}=I,{scheduledRoundsDetails:S,greatestAverageMinutes:D,orderedMatchUpIds:E,minutesMap:C}=xR({scheduleCompletedMatchUps:i,containedStructureIds:n,tournamentRecords:l,periodLength:c,matchUps:p,rounds:T});b.push(...E??[]);let{groupedRounds:P}=E6e({scheduledRoundsDetails:S,greatestAverageMinutes:D,garmanSinglePass:!0}),R,N,M=[];d&&({scheduleTimes:M,dateScheduledMatchUpIds:R,dateScheduledMatchUps:N}=D6e({averageMatchUpMinutes:(m=P[0])==null?void 0:m.averageMinutes,scheduleDate:Ci(u),venueIds:[I.venueId],clearScheduleDates:s,tournamentRecords:l,periodLength:c,matchUps:p}));let A=T6e({matchUpPotentialParticipantIds:t,individualParticipantProfiles:e,dateScheduledMatchUpIds:R,greatestAverageMinutes:D,matchUpNotBeforeTimes:r,matchUpScheduleTimes:a,matchUpDependencies:o,clearScheduleDates:s,scheduleDate:u,minutesMap:C,matchUps:p});({dateScheduledMatchUpIds:R,dateScheduledMatchUps:N}=A);let{byeScheduledMatchUpDetails:_,clearDate:x}=A;_!=null&&_.length&&y.push(..._);let{matchUpsToSchedule:O,matchUpMap:B}=U6e({matchUpPotentialParticipantIds:t,scheduleCompletedMatchUps:i,dateScheduledMatchUpIds:R,matchUpNotBeforeTimes:r,matchUpScheduleTimes:a,orderedMatchUpIds:E,clearDate:x,matchUps:p}),F=h.filter(G=>G.venueId===w);g[w]={previousRemainingScheduleTimes:[],courtsCount:F.length,greatestAverageMinutes:D,scheduledRoundsDetails:S,dateScheduledMatchUps:N,matchUpsToSchedule:O,scheduleTimes:M,groupedRounds:P,venueCourts:F,minutesMap:C,matchUpMap:B},s||v.push(...R)}return{allDateScheduledByeMatchUpDetails:y,allDateScheduledMatchUpIds:v,venueScheduledRoundDetails:g,allDateMatchUpIds:b}}function C6e(t,e){let i=on(t.scheduleTime),n=on(t.timeAfterRecovery),r=on(e.scheduleTime),a=on(e.timeAfterRecovery),o=i===r||n===a,s=i>r&&i<a,l=r>i&&r<n,c=n>r&&n<a,u=a>i&&a<n;return qt({hasOverlap:o||s||c||l||u,startAisContained:s,endAisContained:c,startBisContained:l,endBisContained:u},!0)}function k7({individualParticipantProfiles:t,matchUpNotBeforeTimes:e,matchUpDependencies:i,scheduleTime:n,matchUp:r,details:a}){var o,s,l,c,u;let d=(((o=i==null?void 0:i[r.matchUpId])==null?void 0:o.participantIds)||[]).flat(),p=((l=(s=a==null?void 0:a.minutesMap)==null?void 0:s[r.matchUpId])==null?void 0:l.averageMinutes)||0,h=((u=(c=a==null?void 0:a.minutesMap)==null?void 0:c[r.matchUpId])==null?void 0:u.recoveryMinutes)||0,f=d.every(v=>{var y;HR({individualParticipantProfiles:t,participantId:v});let b=t[v];if(!b.timeAfterRecovery)return!0;let I=rr((y=r==null?void 0:r.schedule)==null?void 0:y.endTime),T=I?il(I,ai(h)):il(n,ai(p)+ai(h));return![...Object.keys(b.potentialBookings).filter(w=>w!==r.drawId).map(w=>b.potentialBookings[w]).flat(),...b.bookings].find(w=>C6e({scheduleTime:n,timeAfterRecovery:T},w).hasOverlap)}),m=e[r.matchUpId],g=(m?jP(ca(m),ca(n),!1):0)>=0;return{enoughTime:f&&g}}function x7({individualParticipantProfiles:t,matchUpPotentialParticipantIds:e,matchUpDailyLimits:i={},matchUp:n}){let{enteredIndividualParticipantIds:r}=DL(n),{matchUpId:a,matchUpType:o}=n,s=(n.roundPosition&&e[a]||[]).flat(),l=ki(r.concat(...s));return l.forEach(c=>{HR({individualParticipantProfiles:t,participantId:c})}),{participantIdsAtLimit:l.filter(c=>{let u=t[c];if(u)return[o,Tu].find(d=>{var p;let h=((p=u.counters)==null?void 0:p[d])||0,f=i[d]||0;return h&&f&&h>=f})}),relevantParticipantIds:l}}function NE({scheduleCompletedMatchUps:t=!1,scheduleByeMatchUps:e=!1,errorOnAnachronism:i=!1,checkChronology:n=!0,matchUpDependencies:r,removePriorValues:a,tournamentRecords:o,tournamentRecord:s,matchUpDetails:l,matchUpIds:c,schedule:u}){var d,p,h;if(!s)return{error:it};if(!l&&(!c||!Array.isArray(c)))return{error:nU};if(!l&&(!u||typeof u!="object"))return{error:hme};let f,m=[],g=0;if(n&&!r){let b=Ku({tournamentRecords:o,tournamentRecord:s});r=b.matchUpDependencies,f=b.matchUps}f||(f=((d=co({tournamentRecord:s}))==null?void 0:d.matchUps)??[]);let v=f.reduce((b,I)=>{let{matchUpId:T,drawId:w,matchUpStatus:S}=I;return(e||S!==yn)&&(t||!Ga.includes(S))&&(b[w]?b[w].push(T):b[w]=[T]),b},{}),y=l==null?void 0:l.map(b=>b.matchUpId);for(let b of Object.keys(v)){let{drawDefinition:I}=jg({tournamentRecord:s,drawId:b});if(!I)continue;let T=v[b].filter(S=>(c==null?void 0:c.includes(S))??(y==null?void 0:y.includes(S))),w=Hs({inContext:!1,drawDefinition:I}).matchUps;for(let S of T){let D=((p=l==null?void 0:l.find(C=>C.matchUpId===S))==null?void 0:p.schedule)||u,E=MF({schedule:D,matchUpDependencies:r,errorOnAnachronism:i,removePriorValues:a,inContextMatchUps:f,tournamentRecords:o,tournamentRecord:s,checkChronology:n,drawDefinition:I,drawMatchUps:w,matchUpId:S});if((h=E==null?void 0:E.warnings)!=null&&h.length&&m.push(...E.warnings),E!=null&&E.success&&(g+=1),E.error)return E}}return m.length?{...ue,scheduled:g,warnings:m}:{...ue,scheduled:g}}function qR(t){var e;let{scheduleCompletedMatchUps:i=!1,scheduleByeMatchUps:n=!1,errorOnAnachronism:r,matchUpContextIds:a,removePriorValues:o,tournamentRecords:s,checkChronology:l,matchUpDetails:c,schedule:u}=t;if(t.matchUpIds&&!a)return NE(t);let d=mn(t,[{[Ko]:!0},{[cE]:{matchUpContextIds:!1,matchUpDetails:!1},[Sh]:Me,[Lg]:bl}]);if(d.error)return d;if((!c||a)&&!u)return{error:Ht,info:"schedule is required"};let p=[],h=0,{matchUpDependencies:f}=Ku({tournamentRecords:s});for(let m of Object.values(s)){let{tournamentId:g}=m,v=a==null?void 0:a.filter(b=>b.tournamentId===g).map(Va),y=c==null?void 0:c.filter(b=>(b==null?void 0:b.tournamentId)===g);if(v!=null&&v.length||y!=null&&y.length){let b=NE({matchUpDetails:y,scheduleCompletedMatchUps:i,scheduleByeMatchUps:n,matchUpDependencies:f,errorOnAnachronism:r,removePriorValues:o,tournamentRecords:s,tournamentRecord:m,checkChronology:l,matchUpIds:v,schedule:u});if((e=b.warnings)!=null&&e.length&&p.push(...b.warnings),b.scheduled&&(h+=b.scheduled),b.error)return b}}return p.length?{...ue,scheduled:h,warnings:p}:{...ue,scheduled:h}}function b0e({autoSchedulingAudit:t,tournamentRecords:e}){var i;tn({topic:VS,payload:t});let n=s=>s?Object.values(s).reduce((l,c)=>l+c.length||0,0):0,r=((t==null?void 0:t.schedulingProfile)||[]).reduce((s,l)=>s+l.venues.reduce((c,u)=>c+u.rounds.length,0),0),a={scheduledDatesCount:(i=t.scheduledDates)==null?void 0:i.length,noTimeMatchUpIdsCount:n(t==null?void 0:t.noTimeMatchUpIds),scheduledMatchUpIdsCount:n(t==null?void 0:t.scheduledMatchUpIds),overLimitMatchUpIdsCount:n(t==null?void 0:t.overLimitMatchUpIds),requestConflictsCount:n(t==null?void 0:t.requestConflicts),profileRoundsCount:r},o={itemType:Dwe,itemValue:a};for(let s of Object.values(e))bw({tournamentRecord:s,timeItem:o})}function P6e({schedulingProfileModifications:t,checkPotentialRequestConflicts:e,scheduleCompletedMatchUps:i,schedulingProfileIssues:n,dateSchedulingProfiles:r,containedStructureIds:a,matchUpDependencies:o,matchUpDailyLimits:s,clearScheduleDates:l,tournamentRecords:c,schedulingProfile:u,personRequests:d,periodLength:p,matchUps:h,courts:f,dryRun:m}){var g,v,y,b,I,T,w;let S={},D={},E={},C={},P={},R={},N={},M={},A={},_={};for(let B of r){let F=Ci(B==null?void 0:B.scheduleDate),G=(B==null?void 0:B.venues)||[],H={},$={},q=(se,te)=>{se.forEach(he=>{let ae=$[he].counters;ae[te]?ae[te]+=1:ae[te]=1,ae[Tu]?ae[Tu]+=1:ae[Tu]=1})};E[F]={},C[F]={},S[F]={},D[F]={},N[F]=[],M[F]=[],A[F]=[],_[F]=[];let z={};h.forEach(se=>{var te;(te=se.schedule)!=null&&te.scheduledDate&&Uh(F,Ci(se.schedule.scheduledDate))&&ZS({matchUpPotentialParticipantIds:H,matchUpNotBeforeTimes:z,matchUp:se})});let{allDateScheduledByeMatchUpDetails:Z,venueScheduledRoundDetails:Y,allDateMatchUpIds:Q}=y0e({matchUpPotentialParticipantIds:H,individualParticipantProfiles:$,scheduleCompletedMatchUps:i,containedStructureIds:a,matchUpNotBeforeTimes:z,matchUpScheduleTimes:R,matchUpDependencies:o,clearScheduleDates:l,tournamentRecords:c,useGarman:!0,periodLength:p,scheduleDate:F,matchUps:h,courts:f,venues:G}),X=10,oe=0,re,me=10;for(;!re;){for(let{venueId:se}of G){let te=0,he=Y[se];for(;he.courtsCount&&(g=he.scheduleTimes)!=null&&g.length&&(v=he.matchUpsToSchedule)!=null&&v.length&&te<=he.courtsCount;){let{scheduleTime:ae,attempts:de=0}=he.scheduleTimes.shift(),Ie=he.matchUpsToSchedule.find(De=>{var Te,_e;let{matchUpId:Ve,matchUpType:ot}=De,{participantIdsAtLimit:St,relevantParticipantIds:nt}=x7({matchUpPotentialParticipantIds:H,individualParticipantProfiles:$,matchUpDailyLimits:s,matchUp:De});if(St.length)return M[F].includes(Ve)||M[F].push(Ve),!1;let{scheduledDependent:Bt}=v0e({matchUpScheduleTimes:R,matchUpDependencies:o,scheduleTime:ae,matchUpId:Ve,details:he});if(Bt)return!1;let{dependenciesScheduled:Pe,remainingDependencies:et}=A7({matchUpScheduleTimes:R,matchUpDependencies:o,allDateMatchUpIds:Q,matchUp:De});if(!Pe)return C[F][Ve]||(C[F][Ve]=[]),C[F][Ve].push({scheduleTime:ae,remainingDependencies:et}),!1;let{enoughTime:Ee}=k7({individualParticipantProfiles:$,matchUpNotBeforeTimes:z,matchUpDependencies:o,scheduleTime:ae,details:he,matchUp:De});if(!Ee)return E[F][Ve]||(E[F][Ve]=[]),E[F][Ve].push({scheduleTime:ae}),!1;let lt=he.greatestAverageMinutes,{conflicts:Ke}=_7({potentials:e,averageMatchUpMinutes:lt,requestConflicts:_,personRequests:d,scheduleTime:ae,scheduleDate:F,matchUp:De});if(Ke!=null&&Ke.length)return P[F]||(P[F]=[]),P[F].push(...Ke),!1;q(nt,ot);let bt=(_e=(Te=he.minutesMap)==null?void 0:Te[Ve])==null?void 0:_e.recoveryMinutes;return ME({matchUpPotentialParticipantIds:H,individualParticipantProfiles:$,matchUpNotBeforeTimes:z,averageMatchUpMinutes:lt,matchUpDependencies:o,recoveryMinutes:bt,scheduleTime:ae,matchUp:De}),R[Ve]=ae,!0});he.matchUpsToSchedule=he.matchUpsToSchedule.filter(({matchUpId:De})=>De!==(Ie==null?void 0:Ie.matchUpId)),Ie?te+=1:(D[F][se]||(D[F][se]=[]),D[F][se].push({scheduleTime:ae,attempts:de+1}))}(y=he.matchUpsToSchedule)!=null&&y.length&&(D[F][se]=(b=D[F][se])==null?void 0:b.filter(ae=>{let de=ae.attempts<X;return de&&he.scheduleTimes.push(ae),!de})),(!((I=he.scheduleTimes)!=null&&I.length)||!((T=he.matchUpsToSchedule)!=null&&T.length))&&(he.complete=!0)}oe+=1,re=G.every(({venueId:se})=>Y[se].complete)||oe===me}for(let{venueId:se}of G){let te=Y[se].matchUpMap;Object.keys(te).forEach(he=>{let ae=c[he];ae&&Object.keys(te[he]).forEach(de=>{let{drawDefinition:Ie}=jg({tournamentRecord:ae,drawId:de});Ie&&te[he][de].forEach(({matchUpId:De})=>{let Te=R[De];if(Te){let _e=Te.split(":").map(Dc).join(":"),Ve=`${Ci(F)}T${_e}`;m?N[F].push(De):(Gg({drawDefinition:Ie,scheduledTime:Ve,matchUpId:De}).success&&N[F].push(De),se&&_U({tournamentRecord:ae,drawDefinition:Ie,matchUpId:De,venueId:se}))}})})}),A[F]=Y[se].matchUpsToSchedule.map(Va),S[F][se]=Y[se].scheduleTimes.sort((he,ae)=>on(he.scheduleTime)-on(ae.scheduleTime))}!m&&Z!=null&&Z.length&&qR({matchUpDetails:Z,scheduleByeMatchUps:!0,removePriorValues:!0,tournamentRecords:c,schedule:{scheduledDate:"",scheduledTime:"",courtOrder:"",courtId:"",venueId:""}});for(let se of B.venues)for(let te of se.rounds){let he=(((w=te.matchUps)==null?void 0:w.map(({matchUpId:de})=>de))||[]).filter(de=>N[F].includes(de));te.canScheduledMatchUpIds=he;let ae=Math.round(he.length/te.matchUpsCount*1e4)/100;(ae===1/0||isNaN(ae))&&(ae=0),te.possibleToSchedulePct=ae,te.matchUpsCount===he.length&&(te.possibleToSchedule=!0)}}let x=r.map(({scheduleDate:B})=>B),O={timeStamp:Date.now(),overLimitMatchUpIds:M,scheduledMatchUpIds:N,schedulingProfile:u,noTimeMatchUpIds:A,requestConflicts:_,scheduledDates:x};return b0e({tournamentRecords:c,autoSchedulingAudit:O}),{...ue,schedulingProfileModifications:t,schedulingProfileIssues:n,scheduleTimesRemaining:S,dateSchedulingProfiles:r,skippedScheduleTimes:D,recoveryTimeDeferredMatchUpIds:E,dependencyDeferredMatchUpIds:C,matchUpScheduleTimes:R,overLimitMatchUpIds:M,scheduledMatchUpIds:N,noTimeMatchUpIds:A,requestConflicts:_,scheduledDates:x}}function DX({averageMinutes:t,startTime:e,endTime:i,court:n,date:r}){if(!Array.isArray(n.dateAvailability))return{error:Ht,stack:"getEarliestCourtTime"};let a=YS({scheduleDate:r,courts:[n],startTime:!0}),o=YS({scheduleDate:r,courts:[n],endTime:!0});e=e||a,i=i||o;let s=VR({court:n,date:r}),{timeSlots:l}=NU({courtDate:s}),c=ca(e),u=ca(i);return{earliestCourtTime:l==null?void 0:l.reduce((d,p)=>{let h=ca(p.startTime),f=ca(p.endTime);if(h>u||f<c)return d;let m=c>h?c:h;if(jP(m,f)>=t){let g=rr(m.toISOString());(!d||g<d)&&(d=g)}return d},void 0),courtStartTime:a,courtEndTime:o}}function R6e({schedulingProfileModifications:t,checkPotentialRequestConflicts:e,scheduleCompletedMatchUps:i,schedulingProfileIssues:n,dateSchedulingProfiles:r,containedStructureIds:a,matchUpDependencies:o,matchUpDailyLimits:s,clearScheduleDates:l,tournamentRecords:c,periodLength:u=30,schedulingProfile:d,personRequests:p,matchUps:h=[],courts:f,dryRun:m}){var g,v;let y={},b={},I={},T={},w={},S={},D={},E={},C={};for(let N of r??[]){let M=Ci(N==null?void 0:N.scheduleDate),A=(N==null?void 0:N.venues)||[],_={},x={},O=(se,te)=>{se.forEach(he=>{let ae=x[he].counters;ae[te]?ae[te]+=1:ae[te]=1,ae[Tu]?ae[Tu]+=1:ae[Tu]=1})};y[M]={},b[M]={},S[M]=[],D[M]=[],E[M]=[],C[M]=[];let B={};h==null||h.forEach(se=>{var te;(te=se.schedule)!=null&&te.scheduledDate&&Uh(M,Ci(se.schedule.scheduledDate))&&ZS({matchUpPotentialParticipantIds:_,matchUpNotBeforeTimes:B,matchUp:se})});let{allDateScheduledByeMatchUpDetails:F,allDateScheduledMatchUpIds:G,venueScheduledRoundDetails:H,allDateMatchUpIds:$}=y0e({matchUpPotentialParticipantIds:_,individualParticipantProfiles:x,scheduleCompletedMatchUps:i,containedStructureIds:a,matchUpNotBeforeTimes:B,matchUpScheduleTimes:w,matchUpDependencies:o,clearScheduleDates:l,tournamentRecords:c,periodLength:u,scheduleDate:M,matchUps:h,courts:f,venues:A}),q=h==null?void 0:h.filter(({matchUpId:se})=>G.includes(se)),{bookings:z}=AF({dateScheduledMatchUps:q,tournamentRecords:c,scheduleDate:M,periodLength:u}),{virtualCourts:Z}=UF({scheduleDate:M,periodLength:u,bookings:z,courts:f}),Y=Z==null?void 0:Z.reduce((se,te)=>{let{earliestCourtTime:he,courtEndTime:ae}=DX({date:M,averageMinutes:0,court:te});return(!se.startTime||ca(he)<ca(se.startTime))&&(se.startTime=he),(!se.endTime||ca(ae)>ca(se.endTime))&&(se.endTime=ae),se},{}),Q=Y.startTime,X=({courtId:se,booking:te})=>{var he;return(he=Z==null?void 0:Z.find(ae=>ae.courtId===se))==null?void 0:he.dateAvailability[0].bookings.push(te)},oe=10,re=0,me;for(;!me;){for(let{venueId:se}of A){let te=H[se],he=te.matchUpsToSchedule.length,ae=[],de=[],Ie,De=0;for(;!Ie;){for(let Te of te.matchUpsToSchedule){if(de.length===te.courtsCount||ae.length===te.courtsCount){Ie=!0;break}let{matchUpId:_e,matchUpType:Ve}=Te,{participantIdsAtLimit:ot,relevantParticipantIds:St}=x7({matchUpPotentialParticipantIds:_,individualParticipantProfiles:x,matchUpDailyLimits:s,matchUp:Te});if(ot.length){D[M].includes(_e)||D[M].push(_e);continue}let{dependenciesScheduled:nt,remainingDependencies:Bt}=A7({matchUpScheduleTimes:w,matchUpDependencies:o,allDateMatchUpIds:$,matchUp:Te});if(!nt){b[M][_e]||(b[M][_e]=[]),b[M][_e].push({remainingDependencies:Bt});continue}let Pe=[],et=Z==null?void 0:Z.reduce((Ee,lt)=>{var Ke,bt,gt,Ue;if(de.includes(lt.courtId))return Ee;let{earliestCourtTime:xe}=DX({averageMinutes:te.greatestAverageMinutes,startTime:Q,date:M,court:lt});if(Ee.scheduleTime&&on(xe)>=on(Ee.scheduleTime))return Ee;let{scheduledDependent:We}=v0e({matchUpScheduleTimes:w,matchUpDependencies:o,scheduleTime:xe,matchUpId:_e,details:te});if(We)return Ee;let{enoughTime:st}=k7({individualParticipantProfiles:x,matchUpNotBeforeTimes:B,matchUpDependencies:o,scheduleTime:xe,details:te,matchUp:Te});if(!st)return y[M][_e]||(y[M][_e]=[]),y[M][_e].includes(xe)||y[M][_e].push(xe),Ee;let vt=((bt=(Ke=te.minutesMap)==null?void 0:Ke[_e])==null?void 0:bt.averageMinutes)||te.greatestAverageMinutes,{conflicts:ge}=_7({potentials:e,averageMatchUpMinutes:vt,requestConflicts:C,personRequests:p,scheduleTime:xe,scheduleDate:M,matchUp:Te});if(ge!=null&&ge.length)return Pe.push(...ge),!1;O(St,Ve);let Se=(Ue=(gt=te.minutesMap)==null?void 0:gt[_e])==null?void 0:Ue.recoveryMinutes;return ME({matchUpPotentialParticipantIds:_,individualParticipantProfiles:x,matchUpNotBeforeTimes:B,averageMatchUpMinutes:vt,matchUpDependencies:o,recoveryMinutes:Se,scheduleTime:xe,matchUp:Te}),(!Ee.scheduleTime||on(xe)<on(Ee.scheduleTime))&&(Ee.averageMatchUpMinutes=vt,Ee.recoveryMinutes=Se,Ee.scheduleTime=xe,Ee.courtName=lt.courtName,Ee.courtId=lt.courtId),Ee},{});if(et.scheduleTime){let{averageMatchUpMinutes:Ee,recoveryMinutes:lt,scheduleTime:Ke,courtId:bt}=et;w[_e]=Ke,T[_e]=bt,ae.push(_e),de.push(bt);let gt=Ke,Ue=il(gt,Ee);X({courtId:bt,booking:{averageMatchUpMinutes:Ee,recoveryMinutes:lt,periodLength:u,matchUpId:_e,startTime:gt,courtId:bt,endTime:Ue,venueId:se}}),te.matchUpsToSchedule=te.matchUpsToSchedule.filter(xe=>xe.matchUpId!==_e)}else Pe!=null&&Pe.length&&(I[M]||(I[M]=[]),I[M].push(...Pe))}(de.length===te.courtsCount||ae.length===te.courtsCount||!te.matchUpsToSchedule.length)&&(Ie=!0),te.matchUpsToSchedule.length&&ae<te.courtsCount&&(ca(Q)<ca(Y.endTime)?Q=il(Q,u):(Ie=!0,te.complete=!0)),De+=1,!Ie&&De>=he&&(Ie=!0)}(g=te.matchUpsToSchedule)!=null&&g.length||(te.complete=!0)}re+=1,me=A.every(({venueId:se})=>H[se].complete)||re===oe}for(let{venueId:se}of A){let te=H[se].matchUpMap;Object.keys(te).forEach(he=>{let ae=c[he];ae&&Object.keys(te[he]).forEach(de=>{let{drawDefinition:Ie}=jg({tournamentRecord:ae,drawId:de});Ie&&te[he][de].forEach(({matchUpId:De})=>{let Te=w[De],_e=T[De];if(Te){let Ve=Te.split(":").map(Dc).join(":"),ot=`${Ci(M)}T${Ve}`;m||(Gg({drawDefinition:Ie,scheduledTime:ot,matchUpId:De}),Uw({courtDayDate:M,tournamentRecords:c,tournamentRecord:ae,drawDefinition:Ie,matchUpId:De,courtId:_e})),S[M].push(De)}})})}),E[M]=H[se].matchUpsToSchedule.map(Va)}!m&&F!=null&&F.length&&qR({matchUpDetails:F,scheduleByeMatchUps:!0,removePriorValues:!0,tournamentRecords:c,schedule:{scheduledDate:"",scheduledTime:"",courtOrder:"",courtId:"",venueId:""}});for(let se of N.venues)for(let te of se.rounds){let he=(v=(te.matchUps??[]).map(({matchUpId:de})=>de))==null?void 0:v.filter(de=>S[M].includes(de));te.canScheduledMatchUpIds=he;let ae=Math.round(((he==null?void 0:he.length)||0)/te.matchUpsCount*1e4)/100;(ae===1/0||isNaN(ae))&&(ae=void 0),te.possibleToSchedulePct=ae,te.matchUpsCount===(he==null?void 0:he.length)&&(te.possibleToSchedule=!0)}}let P=(r??[]).map(({scheduleDate:N})=>N),R={timeStamp:Date.now(),overLimitMatchUpIds:D,scheduledMatchUpIds:S,schedulingProfile:d,noTimeMatchUpIds:E,requestConflicts:C,scheduledDates:P};return b0e({tournamentRecords:c,autoSchedulingAudit:R}),{...ue,schedulingProfileModifications:t,schedulingProfileIssues:n,dateSchedulingProfiles:r,recoveryTimeDeferredMatchUpIds:y,dependencyDeferredMatchUpIds:b,matchUpScheduleTimes:w,overLimitMatchUpIds:D,scheduledMatchUpIds:S,noTimeMatchUpIds:E,requestConflicts:C,scheduledDates:P}}function _F(t){let{scheduleAttributes:e=["scheduledDate","scheduledTime"],ignoreMatchUpStatuses:i=Ga,scheduledDates:n,venueIds:r}=t,a=_p(t),o=sr(a)?Object.values(a).map(({tournamentId:l})=>l).filter(Boolean):[];if(!(o!=null&&o.length))return{error:_r};let s=0;for(let l of o){let c=a[l],u=M6e({ignoreMatchUpStatuses:i,scheduleAttributes:e,tournamentRecord:c,scheduledDates:n,venueIds:r});if(u.error)return u;s+=u.clearedScheduleCount??0}return{...ue,clearedScheduleCount:s}}function M6e({scheduleAttributes:t=["scheduledDate","scheduledTime"],ignoreMatchUpStatuses:e=Ga,tournamentRecord:i,scheduledDates:n,venueIds:r=[]}){if(typeof i!="object")return{error:it};if(!Array.isArray(e)||!Array.isArray(r))return{error:Me};r.length&&t.push("venueId");let a=co({matchUpFilters:{scheduledDates:n},tournamentRecord:i}).matchUps??[],o={};a.forEach(({matchUpStatus:c,schedule:u,drawId:d,matchUpId:p})=>{(!c||!e.includes(c))&&LR({schedule:u,scheduleAttributes:t})&&(!(r!=null&&r.length)||r.includes(u.venueId))&&(o[d]||(o[d]=[]),o[d].push(p))});let s=i.tournamentId,l=0;for(let c in o){let{event:u,drawDefinition:d}=Ks({tournamentRecord:i,drawId:c}),p=Hs({drawDefinition:d,matchUpFilters:{matchUpIds:o[c]}}).matchUps??[];for(let h of p){let f=!1;h.timeItems=(h.timeItems??[]).filter(m=>{let g=(m==null?void 0:m.itemType)&&![jf,ay,yU,bU,IU].includes(m==null?void 0:m.itemType);return g||(f=!0),g}),f&&(sn({context:"clear schedules",eventId:u==null?void 0:u.eventId,drawDefinition:d,tournamentId:s,matchUp:h}),l+=1)}}return{...ue,clearedScheduleCount:l}}function kF(t){let{checkPotentialRequestConflicts:e=!0,scheduleCompletedMatchUps:i,clearScheduleDates:n,scheduleDates:r=[],tournamentRecords:a,periodLength:o,useGarman:s,dryRun:l,pro:c}=t,u=mn(t,[{[Ko]:!0},{[nd]:E=>!E||Array.isArray(E)&&E.every(Kl),[Gme]:!1,[Lg]:bl}]);if(u.error)return u;let d=mm({tournamentRecords:a});if(d.error)return d;if(!d.schedulingProfile.length)return{...ue};let{modifications:p,issues:h=[],schedulingProfile:f=[]}=d,m=Object.assign({},...Object.values(a).map(E=>vU({tournamentRecord:E}).containedStructures)),g=r.map(E=>{if(Kl(E))return Ci(E)}).filter(Boolean),v=f.map(E=>E.scheduleDate).map(E=>Kl(E)&&Ci(E)).filter(E=>E&&(!r.length||g.includes(E)));if(!v.length)return{error:Gfe};if(n&&!l){let E=Array.isArray(n)?n:[];_F({tournamentRecords:a,scheduledDates:E})}let y=fm({ignoreDisabled:!1,tournamentRecords:a}).courts,{matchUps:b}=Ud({matchUpFilters:{matchUpTypes:[Mr,Zn]},afterRecoveryTimes:!0,nextMatchUps:!0,tournamentRecords:a}),{matchUpDependencies:I}=Ku({includeParticipantDependencies:!0,tournamentRecords:a,matchUps:b}),{matchUpDailyLimits:T}=vF({tournamentRecords:a}),{personRequests:w}=qy({requestType:zR,tournamentRecords:a}),S=f.filter(E=>{let C=Ci(E==null?void 0:E.scheduleDate);return v.includes(C)}).sort((E,C)=>new Date(E.scheduleDate).getTime()-new Date(C.scheduleDate).getTime()),D={schedulingProfileModifications:p,checkPotentialRequestConflicts:e,scheduleCompletedMatchUps:i,schedulingProfileIssues:h,dateSchedulingProfiles:S,containedStructureIds:m,matchUpDependencies:I,matchUpDailyLimits:T,clearScheduleDates:n,tournamentRecords:a,schedulingProfile:f,personRequests:w,periodLength:o,useGarman:s,matchUps:b,dryRun:l,courts:y};return c?R6e(D):P6e(D)}function I0e(t){let e=t||{};return e.tournamentId||(e.tournamentId=xn()),e.startDate&&!ey(e.startDate)&&!g_.test(e.startDate)?{error:Cs}:e.endDate&&!ey(e.endDate)&&!g_.test(e.endDate)?{error:Cs}:(e.extensions&&(e.extensions=e.extensions.filter(yp)),{...e})}function O7({addParticipants:t=!0,participantAttribute:e,tournamentRecord:i,personAttribute:n,teamNames:r,accessor:a,uuids:o}){var s,l;if(!i)return{error:it};let c={},u=(i.participants??[]).filter(({participantType:g,participantRole:v})=>g===Ki&&v===jo),d=0;for(let g of u){let v=a&&((s=Ob({element:g,accessor:a}))==null?void 0:s.value)||n&&((l=g.person)==null?void 0:l[n])||e&&g[e];if(v){if(!Object.keys(c).includes(v)){c[v]={participantName:(r==null?void 0:r[d])??v,participantId:(o==null?void 0:o.pop())??xn(),individualParticipantIds:[],participantRole:jo,participantType:Hn};let y={value:n??e,name:tj};un({element:c[v],extension:y}),d+=1}c[v].individualParticipantIds.push(g.participantId)}}let p=Object.keys(c),h=(i.participants??[]).map(g=>{if(g.participantType!==Hn||g.participantRole!==jo)return;let{extension:v}=Bi({name:tj,element:g}),y=v==null?void 0:v.value;if(p.includes(y))return g.participantId}).filter(Boolean),f=0,m=[];return Object.keys(c).forEach(g=>{let v=c[g],{participantId:y}=v;h.includes(y)||(i.participants||(i.participants=[]),t&&i.participants.push(v),m.push(v),f++)}),t&&f?(tn({payload:{tournamentId:i.tournamentId,participants:m},topic:sg}),{...ue,participantsAdded:f}):m.length?{...ue,newParticipants:m}:{error:xje}}var N6e=[{AA:"Annexia"},{BA:"Bacteria"},{BO:"Borduria"},{BM:"Bensalem"},{BS:"Basenji"},{BI:"Balnibarbi"},{BV:"Bartovia"},{BZ:"Berzerkistan"},{CA:"Caldonia"},{CC:"Concordia"},{CH:"Chula"},{DA:"Deltora"},{DW:"Discworld"},{EA:"Eastasia"},{EP:"Ecotopia"},{ER:"Erewhon"},{FA:"Freedonia"},{FN:"Florin"},{FG:"Fogg"},{FK:"Fourecks"},{GA:"Genovia"},{GL:"Gilead"},{GD:"Gilead"},{GL:"Gondal"},{GO:"Gondor"},{GR:"Gruzinia"},{GT:"Goritania"},{GU:"Guilder"},{HA:"Heldscalla"},{HO:"Hidalgo"},{IL:"Illyria"},{KA:"Kinakuta"},{KG:"Kangan"},{KN:"Kreplachistan"},{KS:"Kallipolis"},{LH:"Lugash"},{LI:"Listenbourg"},{LT:"Lilliput"},{LU:"Luggnagg"},{LV:"Lichtenslava"},{MR:"Moher"},{NA:"Narnia"},{NV:"Novaria"},{OA:"Oceania"},{OS:"Orsinia"},{OV:"Octavia"},{PA:"Palombia"},{PG:"Penguina"},{QA:"Qasha"},{PM:"Panem"},{SA:"Solymbria"},{SD:"Syldavia"},{SG:"San Glucose"},{SL:"San Lorenzo"},{SR:"Sontar"},{SY:"Sylvania"},{TF:"Tralfamadore"},{TH:"Themyscira"},{UA:"Utopia"},{VA:"Vespugia"},{WA:"Wakanda"},{WX:"Wessex"},{ZA:"Zamunda"},{ZK:"Zubrowka"}],A6e=["Amber","Ansul","Atlantis","Braavos","Busytown","Castle Rock","Centralia","Coober Pedy","Chefchaouen","Chronopolis","Damanhur","Diaspar","Dictionopolis","Diomira","El Dorado","Elista","Ephesus","Gotham","Hadleyburg","Hallstatt","Hierusalem","Ilium","Inverness","Kowloon","Laputa","Longyearbyen","Lys","Matmata","Maycomb","Metropolis","Miyake-jima","Monowi","Nagoro","Navarre","New New York","Nimbin","Pemberley","Pseudopolis","Rivendell","Roswell","Shangri-La","Springfield","Supilinn","Thneedville","Trantor","Wobegon","Yonwood","Xanadu","Xylar","Zion"];function w0e({count:t=1,participantsCount:e=32}={}){let i=vs(A6e),n=i.slice(0,t);return{cities:Ct(0,e).map(r=>r<Math.min(t,i.length)?n[r]:mu(n))}}function S0e({count:t=1,participantsCount:e=32}={}){let i=vs(N6e),n=i.slice(0,t).map(r=>Object.keys(r)).flat();return{states:Ct(0,e).map(r=>r<Math.min(t,i.length)?n[r]:mu(n))}}function T0e({count:t=1,participantsCount:e=32}={}){let i=Ct(0,t).map(()=>Ct(0,5).map(()=>Ic(0,9)).join(""));return{postalCodes:Ct(0,e).map(n=>n<t?i[n]:mu(i))}}function U0e(t){let{cities:e,states:i,postalCodes:n,nationalityCode:r,participantIndex:a}=t;return{postalCode:n==null?void 0:n[a],state:i==null?void 0:i[a],city:e==null?void 0:e[a],countryCode:r}}var _6e={lastNames:["Abbey","Ahern","Ampleforth","Ananiadis","Andelic","Assange","Atreides","Austen","Bach","Banks","Barrington","Batty","Bauers","Beals","Beer","Bennett","Berry","Bonaparte","Brockovich","Bukowski","Cassidy","Catton","Calvino","Carson","Chip","Constant","Crane","Crowne","Cummings","Curie","Dallas","Diamond","Deckard","Drazic","Dunbar","Earhart","Eisenstein","Eldritch","Elliot","Escher","Eyre","Faulkner","Fulcher","Fukuoka","Godel","Goldstein","Greer","Hedges","Herbert","Holmgren","Humperdinck","Huxley","Illich","Jeffers","Jensen","Jevons","Johnson","Johnstone","Jovovich","Kingsnorth","Langer","Fernwright","Fuller","Le Guin","Lem","Lovelace","Mander","Midgely","Mond","Montoya","Moore","Murry","Nagle","Nearing","Ogden","Ophuls","Parks","Paz","Peet","Perfect","Pendejo","Pevensie","Postman","Ripley","Rodda","Rumfoord","Runciter","Rugen","Sale","Schumacher","Shaftoe","Shelley","Shepard","Smith","Stratton","Stewart","Swift","Tillich","Turing","Tyrell","Twain","Yeats","Veblen","Yates","Vonnegut","Waterhouse","Watson","Wolin","Wirt","Waschuk","Wormwood"],firstFemale:["Ada","Amelia","Amelie","America","Anne","Antonia","Aravis","Astrid","Beatrice","Brienne","Buttercup","Caitlin","Cimorene","Cordelia","Desdemona","Ellen","Elizabeth","Emily","Emmie","Erin","Eva","Evelyn","Heather","Helen","Hermia","Hypatia","Imogen","Jane","Jasmine","Juliana","Juliet","Katniss","Leeloo","Lenina","Lilith","Linda","Lizzie","Louise","Lucy","Marie","Mary","Martha","Matilda","Milla","Miranda","Meg","Melba","Nicole","Ola","Portia","Pris","Rachael","Rachel","Rebecca","River","Rosa","Rosalind","Scout","Sharn","Susanne","Titania","Uhura","Ursula","Valentina","Viola","Virginia","Xena","Zoe"],firstMale:["Alan","Aldous","August","Axel","Barda","Barry","Bill","Bruce","Charles","Chris","Constantine","Darwin","David","Derrick","Edward","Emmanuel","Ernst","Estlin","Fezzik","Filby","Frank","Frito","George","Glen","Helmholtz","Inigo","Italo","Ivan","James","Jared","Jerry","Joe","Johann","Julian","John Michael","Jonathan","Korben","Kirkpatrick","Kurt","Lief","Malachi","Mark","Masanobu","Maurits","Michael","Mustapha","Neil","Nikola","Octavio","Palmer","Paul","Pierre","Robinson","Rick","Rincewind","Roy","Shannon","Sheldon","Stafford","Stanislaw","Stanley","Syme","Thorstein","Thomas","Tyrone","Vizzini","Walton","Walker","Warren","Wendell","Westley","William","Winston","Zoran"]};function v$(t){let{count:e=100,sex:i}=t||{};if(!e||i&&![Yn,Ir].includes(i))return{personData:[],error:Me};let n=Math.ceil(e*1.3),{lastNames:r,firstFemale:a,firstMale:o}=_6e,s=Vm.map(({iso:m})=>m).filter(Boolean),l=Math.ceil(n/r.length),c=Math.ceil(n/a.length),u=Math.ceil(n/o.length),d=Ct(0,l).flatMap(()=>{let m=$t(r,!1,!0);return Ct(0,r.length).map(()=>Tl(m))}),p=Ct(0,c).flatMap(()=>{let m=$t(a,!1,!0);return Ct(0,a.length).map(()=>Tl(m))}),h=Ct(0,u).flatMap(()=>{let m=$t(o,!1,!0);return Ct(0,o.length).map(()=>Tl(m))}),f={};for(let m=0;m<n;m++){let g=d.pop(),v=i||mu([Yn,Ir]),y=v===Yn?h.pop():p.pop(),b=mu(s);f[`${y}${g}`]={nationalityCode:b,sex:v,firstName:y,lastName:g}}return{personData:Object.values(f).slice(0,e)}}function D0e(t){let e=(t==null?void 0:t.count)||1,{personExtensions:i,consideredDate:n,isMock:r=!0,gendersCount:a,personData:o,category:s,sex:l}=t||{};if(isNaN(e))return{error:Me};let c=(a==null?void 0:a[Yn])||l===Yn&&e||0,u=(a==null?void 0:a[Ir])||l===Ir&&e||0;e=Math.max(e,c+u);let d=e-(c+u),p=c&&v$({count:c,sex:Yn}).personData||[],h=u&&v$({count:u,sex:Ir}).personData||[],f=[...p,...h,...d&&v$({count:d}).personData||[]],m=f.filter(D=>!l||c&&u||D.sex===l),g=[];if(Array.isArray(o)){let D=o.filter(E=>typeof E.firstName!="string"||typeof E.lastName!="string"||E.sex&&![Yn,Ir].includes(E.sex)||E.nationalityCode&&(typeof E.nationalityCode!="string"||E.nationalityCode.length>3||!Vm.find(({iso:C,ioc:P})=>[C,P].includes(E.nationalityCode)))?!1:(E.nationalityCode&&g.push(E.nationalityCode),!0));if(D.length)m=D;else return{error:Me}}let v=o?m:vs(m);if(v.length<e){let{maleFirstNames:D,maleLastNames:E,femaleFirstNames:C,femaleLastNames:P,nationalityCodes:R}=f.reduce((N,M)=>{let{firstName:A,lastName:_,nationalityCode:x}=M;return M.sex===Yn?(N.maleFirstNames.includes(A)||N.maleFirstNames.push(A),N.maleLastNames.includes(_)||N.maleLastNames.push(_)):(N.femaleFirstNames.includes(A)||N.femaleFirstNames.push(A),N.femaleLastNames.includes(_)||N.femaleLastNames.push(_)),N.nationalityCodes.includes(x)||N.nationalityCodes.push(x),N},{maleFirstNames:[],maleLastNames:[],femaleFirstNames:[],femaleLastNames:[],nationalityCodes:[]});Ct(0,e-v.length).forEach(()=>{let N=l||mu([Yn,Ir]),M=mu(R),A=mu(N===Yn?D:C),_=mu(N===Yn?E:P),x={firstName:A,lastName:_,sex:N,nationalityCode:M};v.push(x)})}let{ageMinDate:y,ageMaxDate:b}=CR({consideredDate:n,category:s}),I=ai((y==null?void 0:y.slice(0,4))||0)||ai((b==null?void 0:b.slice(0,4))||0)-3,T=ai((b==null?void 0:b.slice(0,4))||0)||ai((y==null?void 0:y.slice(0,4))||0)+3,w=(y||b)&&[I,T],S=v.slice(0,e).map((D,E)=>{let[C,P]=w||[],R=w&&Tl(Ct(C,P)),N=Tl(Ct(0,365)),M=R&&YGe(R,N);return Object.assign(qt({extensions:i||[{name:"regionCode",value:E+1}],birthDate:M,isMock:r}),D)});return{persons:S.length&&S||v[0],nationalityCodes:g}}var k6e=["Ace Academy","Avengers","Ball Bouncers","Baseliners","Captivators","Civil Disobedients","Continentals","Court Royal","Court Sharks","Diamond Dogs","Danger Zone","Doubles Dominators","Double Faults","Tricksters","Eliminators","Court Crusaders","Fuzz Busters","Game Changers","Goal Gurus","Good Volley","Green Machine","Hawk Eyes","Inside Outers","Killer Instinct","Line Toers","Masters of Mayhem","Matter Catchers","Cheap Shot","Mean Machines","Mindspace Invaders","Net Centric","Net Positive","Smash Mullet","Over Your Head","Spin Meisters","Aggressors","Racket Machine","Slice Happy","Refs Nightmare","Sandeaters","Sun Seekers","Slicer Dicers","Sparkle Soul Tribe","Stacked Deck","Cross Stringers","The Emergence","Total Demolition","Touch and Go","Upside Downers","Vertically Challenged","Visual Spectacle"];function $j({nameRoot:t="TEAM",count:e=1}={}){let i=vs(k6e).slice(0,e);return i.length<e&&Ct(0,e-i.length).forEach(n=>i.push(`${t} ${n+1}`)),{names:i}}function Vj({idPrefix:t,participantType:e,index:i,uuids:n}){return t?`${t}-${e===Ki?"I":"P"}-${i}`:(n==null?void 0:n.pop())||xn()}function WR(t){let{rankingRange:e,scaledParticipantsCount:i}=t,{ratingsParameters:n=ql,valuesInstanceLimit:r,consideredDate:a,category:o,nationalityCodesCount:s,nationalityCodeType:l,nationalityCodes:c,participantsCount:u=32,participantType:d,personIds:p,idPrefix:h,uuids:f,personExtensions:m,addressProps:g,gendersCount:v,matchUpType:y,personData:b,sex:I,inContext:T,withISO2:w,withIOC:S,scaleAllParticipants:D}=t,E=d===Ui||y===ny,C=d===Hn||y===Hn;e&&(!Array.isArray(e)||!e.every(De=>Lr(De))||e.length!==2)&&(e=void 0),i=D?u:i;let P=1e3,R=i&&i>P?i:P;e=e||[1,R],e[1]+=1;let N=u*(E?2:C?8:1),M=D0e({count:N,personExtensions:m,consideredDate:a,gendersCount:v,personData:b,category:o,sex:I});if(M.error)return M;let{nationalityCodes:A,persons:_}=M,x=[],O=[],B=[],F=[];if(typeof o=="object"){let{categoryName:De,ageCategoryCode:Te,ratingType:_e}=o;if((De||Te)&&!_e){let[Ve,ot]=e||[];if(O=vs(Ct(Ve,ot)).slice(0,i||Ic(20,30)),[Ui,Hn].includes(d)){let[St,nt]=e||[];x=vs(Ct(St,nt)).slice(0,i||Ic(20,30))}}if(_e&&n[_e]){let{ratingMax:Ve,ratingMin:ot,ratingAttributes:St}=o,nt={...n[_e],...St||{}},{attributes:Bt={},decimalsCount:Pe,accessors:et,range:Ee,step:lt}=nt,Ke=We=>{let st={},vt=Object.keys(We||{});for(let ge of vt){let Se=We[ge];if(typeof Se=="object"&&Se.generator){let{range:qe}=Se,[$e,ke]=qe.slice().sort();st[ge]=Ic($e,ke)}else st[ge]=Se}return st},bt=Ee[0]>Ee[1]?2:.5,[gt,Ue]=Ee.slice().sort(),xe=()=>Ct(0,2e3).map(()=>Cme(gt,Ue,bt,lt,Pe)).filter(We=>(!Ve||We<=Ve)&&(!ot||We>=ot)).slice(0,i||Ic(20,30)).map(We=>et?Object.assign({},...et.map(st=>({[st]:We})),Ke(Bt)):We);B=xe(),[Ui,Hn].includes(d)&&(F=xe())}}let G=Vm.filter(De=>l==="IOC"&&De.ioc||De.iso);function H(De){let Te=Math.ceil(N/De);return r&&Te>r?Math.ceil(N/r):De}let{postalCodesProfile:$,postalCodesCount:q,statesProfile:z,citiesProfile:Z,citiesCount:Y,statesCount:Q}=g||{},X=De=>Object.keys(De).map(Te=>Ct(0,z[Te]).map(()=>Te)).flat(),oe=Z&&X(Z)||(g==null?void 0:g.cities)||w0e({count:Y||N,participantsCount:N}).cities,re=z&&X(z)||(g==null?void 0:g.states)||S0e({count:Q||N,participantsCount:N}).states,me=$&&X($)||(g==null?void 0:g.postalCodes)||T0e({count:q||N,participantsCount:N}).postalCodes,se={cities:oe,states:re,postalCodes:me},te=H(s),he=te?vs(G).slice(0,s):c?G.filter(De=>c.includes(De.iso)):G,ae=vs(Ct(0,Math.ceil(N/(te||1))).map(()=>he).flat(1/0)),de=$j({count:u}).names;return{participants:Ct(0,u).map(De=>{let Te=E?2:C?8:1,_e=Ct(0,Te).map(Bt=>{let Pe=De*Te+Bt;return Ie(Pe)}),Ve=_e.map(Bt=>Bt.participantId),ot=_e.map(Bt=>Bt.person.standardFamilyName).join("/"),St=E?Ui:Hn,nt={participantId:Vj({participantType:St,idPrefix:h,index:De,uuids:f}),participantRole:jo,participantName:E?ot:de[De],individualParticipantIds:Ve,participantType:St};return T&&(nt.individualParticipants=_e),E||C?[nt,..._e]:_e}).flat(),...ue};function Ie(De){let Te=_[De],{nationalityCode:_e,participantExtensions:Ve,participantTimeItems:ot,extensions:St,firstName:nt,birthDate:Bt,lastName:Pe,personId:et,sex:Ee}=Te||{},lt=nt||"GivenName",Ke=Pe||"FamilyName",bt=`${lt} ${Ke}`,gt=ae[De],Ue=(A==null?void 0:A.length)&&_e||gt&&(l==="IOC"?gt.ioc||gt.iso:gt.iso||gt.ioc)||_e;ae!=null&&ae.length&&!Ue&&!_e&&console.log("%c Invalid Nationality Code",{participantIndex:De,country:gt});let xe=U0e({...se,participantIndex:De,nationalityCode:Ue}),We=qt({participantId:Vj({participantType:Ki,index:De,idPrefix:h,uuids:f}),extensions:Ve,timeItems:ot,participantRole:jo,participantType:Ki,participantName:bt,person:{addresses:[xe],personId:et||(p==null?void 0:p.length)&&p[De]||xn(),standardFamilyName:Ke,standardGivenName:lt,nationalityCode:Ue,extensions:St,birthDate:Kl(Bt)?Bt:void 0,sex:Ee}});if(S&&Ue){let st=Vm.find(({iso:vt})=>vt===Ue);st!=null&&st.ioc&&(We.person.iocNationalityCode=st.ioc),st!=null&&st.label&&(We.person.countryName=st.label)}if(w&&Ue){let st=Vm.find(({iso:vt})=>vt===Ue);st!=null&&st.iso2&&(We.person.iso2NationalityCode=st.iso2),st!=null&&st.label&&(We.person.countryName=st.label)}if(o){let st=O[De],vt=x[De];RM({scaleValue:st,eventType:pI,scaleType:rg,participant:We,category:o}),RM({scaleValue:vt,eventType:ug,scaleType:rg,participant:We,category:o});let ge=B[De],Se=F[De];RM({scaleValue:ge,eventType:pI,scaleType:Av,participant:We,category:o}),RM({scaleValue:Se,eventType:ug,scaleType:Av,participant:We,category:o})}return We}}function RM({scaleValue:t,participant:e,eventType:i,scaleType:n,category:r}){let a=r.categoryName||r.ratingType||r.ageCategoryCode,o=[oI,n,i,a].join("."),s={itemValue:t,itemType:o};a&&t&&(e.timeItems||(e.timeItems=[]),e.timeItems.push(s))}function E0e({alternatesCount:t=0,tieFormatName:e,tieFormat:i,drawSize:n}){var r;let a=0,o=0,s=0,l=0,c={},u={[Yn]:0,[Ir]:0,[El]:0,[vb]:0,[wp]:0};i=typeof i=="object"?i:vI({namedFormat:e}),(r=i==null?void 0:i.collectionDefinitions)==null||r.filter(Boolean).forEach(f=>{let{category:m,collectionId:g,matchUpType:v,matchUpCount:y,gender:b}=f;if([Yn,Ir].includes(b)){let I=y*(v===Zn?2:1);u[b]<I&&(u[b]=I)}else b===El&&(u[Yn]<y&&(u[Yn]=y),u[Ir]<y&&(u[Ir]=y));if(m){let I=JSON.stringify(m);c[I]=m}if(g||(f.collectionId=xn()),Hr(Zn)(v)){let I=y;l+=y,a=Math.max(a,I)}if(Hr(Mr)(v)){let I=y;s+=y,o=Math.max(o,I)}});let d=Object.keys(c).length?Math.max(s,l*2):Math.max(o,a*2),p=a*(n+t),h=o*(n+t);return{maxDoublesDraw:p,maxSinglesDraw:h,teamSize:d,genders:u}}function x6e({participantsProfile:t,eventProfiles:e,drawProfiles:i}){let{participantsCount:n,participantType:r=Ki}=t||{},a=n||0,o={[Ir]:0,[El]:0,[vb]:0,[Yn]:0,[wp]:0},s=0,l=0,c=0,u=0,d=0,p=({alternatesCount:f=0,uniqueParticipants:m,tieFormatName:g,drawSize:v=0,eventType:y,tieFormat:b,category:I,gender:T,stage:w})=>{let S=y===xu,D=y===Fa,E=!!(m||w===Xt||I||T);if(D){u=Math.max(u,v+f),b=typeof b=="object"?b:vI({namedFormat:g});let{teamSize:C,maxDoublesDraw:P,maxSinglesDraw:R,genders:N}=E0e({alternatesCount:f,tieFormatName:g,tieFormat:b,drawSize:v});c=Math.max(c,C),l=Math.max(l,R),E||(s=Math.max(s,P)),Object.keys(N).forEach(M=>o[M]+=N[M])}else if(S)if(E){let C=(v+f)*2;d+=C,T&&(o[T]+=C)}else v+f&&v+f>s&&(s=v+f);else if(E){let C=v+f;T&&(o[T]+=C),d+=C}else v&&v>l&&(l=v+f)};if(e==null||e.forEach(f=>{let{tieFormatName:m,tieFormat:g,drawProfiles:v,eventType:y,category:b,gender:I}=f;if(v)for(let T of v){let{tieFormatName:w,tieFormat:S}=T;p({...T,tieFormatName:w||m,tieFormat:S||g,eventType:y,category:b,gender:I})}}),Array.isArray(i))for(let f of i)p(f);let h=Math.max(u*c,s*2,l);return s&&(r=Ui),(n||a)<h&&(n=h),n&&s&&[Ui,Fa].includes(r)&&(l&&Math.floor(l/2)>s?n=Math.floor(l/2):(!l||s*2>=l)&&(n=Math.ceil(n/2))),n===void 0&&(n=!(e!=null&&e.length)&&!(i!=null&&i.length)?32:0),n<a&&(n=a),{uniqueParticipantsCount:d,participantsCount:n,largestTeamDraw:u,largestTeamSize:c,participantType:r,gendersCount:o}}function C0e({participantsProfile:t,tournamentRecord:e,eventProfiles:i,drawProfiles:n,startDate:r,uuids:a}){let{participantsCount:o,participantType:s,largestTeamDraw:l,largestTeamSize:c,gendersCount:u}=x6e({participantsProfile:t,eventProfiles:i,drawProfiles:n}),d=t==null?void 0:t.teamKey,p=WR({uuids:a,...t,consideredDate:r,participantsCount:o,participantType:s,gendersCount:u}).participants,h=0,f=Dd({tournamentRecord:e,participants:p});if(f.error)return f;if(h+=f.addedCount,d){let y=O7({tournamentRecord:e,...d});if(y.error)return y}let m=p.filter(({participantType:y})=>y===Ki).map(Wi),g=t!=null&&t.idPrefix?`${Hn}-${t.idPrefix}`:void 0,v=Ct(0,l).map(y=>{let b=m.slice(y*c,(y+1)*c),I=Vj({index:y,participantType:s,idPrefix:g,uuids:a});return{participantName:`Team ${y+1}`,participantRole:jo,individualParticipantIds:b,participantType:Hn,participantId:I}});return f=Dd({participants:v,tournamentRecord:e}),f.error?f:(h+=f.addedCount,{addedCount:h,...ue})}function P0e({drawProfiles:t,category:e,gender:i}){let n={},r=t==null?void 0:t.reduce((o,s)=>{let{qualifyingPositions:l=0,participantsCount:c=0,uniqueParticipants:u,stage:d=Ft,drawSize:p=0}=s||{};Object.keys(o).includes(d)||(o[d]=0);let h=(c||p)-l;return u||i||e||d===Xt?(Object.keys(n).includes(d)||(n[d]=0),n[d]+=h):o[d]=Math.max(o[d],h),o},{}),a=Object.keys(n);return a.forEach(o=>r[o]+=n[o]),{stageParticipantsCount:r,uniqueParticipantsCount:n,uniqueParticipantStages:a}}function R0e({allUniqueParticipantIds:t,stageParticipantsCount:e,eventParticipantType:i,targetParticipants:n}){let r=e[Ft]||0,a=e[Xt]||0;return{stageParticipants:{QUALIFYING:n.filter(({participantType:o})=>o===i).filter(({participantId:o})=>!t.includes(o)).slice(0,a),MAIN:n.filter(({participantType:o})=>o===i).filter(({participantId:o})=>!t.includes(o)).slice(a,a+r)}}}var O6e={[Rn]:2,[da]:1,[Ca]:1,[os]:1,[fn]:4};function L7(t){let{defaultWithScorePercent:e=2,winningSide:i}=t,{matchUpStatusProfile:n=O6e,matchUpFormat:r=Cc,pointsPerMinute:a=1,sideWeight:o=4}=t;if(!Fl({matchUpFormat:r}))return{error:Y4};if(typeof n!="object")return{error:Me};if(e>100&&(e=100),isNaN(e)||isNaN(a)||isNaN(o))return{error:Me};let s=Object.keys(n).filter(D=>Object.keys(yge).includes(D)&&D!==ia);if(Object.keys(s).reduce((D,E)=>D+n[E],0)>100)return{error:Me,matchUpStatusProfile:n};let l=s.reduce((D,E)=>(D.pointer=D.pointer+n[E],D.valueMap.push([D.pointer,E]),D),{pointer:0,valueMap:[]}),c=Ic(1,100),u=(l.valueMap.find(D=>c<=D[0])??[100,ia])[1],d={sets:[],scoreStringSide1:"",side2ScoreString:""};if([Rn,fn].includes(u)){i=i||Ic(1,2);let D={score:d,winningSide:i,matchUpStatus:u};if(!(u===fn&&Ic(1,100)>100-e))return{outcome:D}}else if([da,Ca].includes(u))return{outcome:{score:d,matchUpStatus:u}};let p=Zs(r),{bestOf:h,setFormat:f,finalSetFormat:m}=p??{},g=[],v=Ic(0,1),y=i?[i-1]:[...Ct(0,o).map(()=>v),1-v],b=[os,fn,bp,$g].includes(u)&&(Tl(Ct(1,h))||1),I;for(let D of Ct(1,(h??0)+1)){let E=D===h,{set:C,incomplete:P,winningSideNumber:R}=L6e({incomplete:b===D,matchUpStatus:u,pointsPerMinute:a,setFormat:E&&m||f,setNumber:D,weightedRange:y});if(g.push(C),P){I=R;break}if(RE({matchUp:{score:{sets:g},matchUpFormat:r}}).calculatedWinningSide)break}let T=RE({matchUp:{score:{sets:g},matchUpFormat:r}}),w=I?i||I:T.calculatedWinningSide,{score:S}=u0e({score:{sets:g},winningSide:w,matchUpStatus:u});return{outcome:{score:S,winningSide:w,matchUpStatus:u}}}function L6e({weightedRange:t=[0,1],pointsPerMinute:e,matchUpStatus:i,incomplete:n,setFormat:r,setNumber:a}){let o={setNumber:a},{setTo:s,tiebreakFormat:l,tiebreakAt:c,tiebreakSet:u,timed:d,minutes:p}=r,h=Ic(0,t.length-1),f=t[h],m;if(d){let g=p*e,v=Math.round(g*.2),y=g+Tl([1,-1])*v,b=oGe(y,2),I=[b,y-b];f&&I.reverse(),m=t[h]+1;let T=I[0]>I[1]&&1||I[1]>I[0]&&2||0;if(n){let[D,E]=I;return Object.assign(o,{side1Score:D,side2Score:E}),Ga.includes(i)?{set:o,incomplete:n,winningSideNumber:m}:{set:o,incomplete:n}}T||(I[Ic(0,1)]+=1),T=I[0]>I[1]?1:2,T!==m&&I.reverse();let[w,S]=I;return Object.assign(o,{side1Score:w,side2Score:S,winningSide:m}),{set:o}}else{if(n)return o.side1Score=Ic(0,c),o.side2Score=Ic(0,c),Ga.includes(i)&&(m=t[h]+1),{set:o,incomplete:n,winningSideNumber:m};{let g=Ct(1,s+1).map(S=>Ct(0,s+2-S).map(()=>S)).flat(),v=g[Ic(0,g.length-1)],y=s&&E8({isSide1:!0,tiebreakAt:c,lowValue:v,setTo:s}),b=!y,I=t.length===1&&t[h]+1;if(!b){I?(y[0]>y[1]?1:2)!==I&&y.reverse():f&&y.reverse();let[S,D]=y;Object.assign(o,{side1Score:S,side2Score:D})}let T=CE({matchUpScoringFormat:{setFormat:r},setObject:o}),w;if(T.hasTiebreakCondition||b){let{NoAD:S,tiebreakTo:D}=l||u||{},E=Ct(1,D+1).map(R=>Ct(0,D+2-R).map(()=>R)).flat(),C=E[Ic(0,E.length-1)],P=rF({isSide1:!0,tiebreakNoAd:S,tiebreakTo:D,lowValue:C});if(P)if(b){let R=P[0]>P[1]?1:2;I?R!==I&&P.reverse():f&&P.reverse(),[o.side1TiebreakScore,o.side2TiebreakScore]=P,w=P[0]>P[1]&&1||P[1]>P[0]&&2||void 0}else T.leadingSide===2?[o.side1TiebreakScore,o.side2TiebreakScore]=P:[o.side2TiebreakScore,o.side1TiebreakScore]=P}o.winningSide=T.winningSide||T.leadingSide||I||w}}return{set:o}}function z_(t){var e,i,n;let{matchUpStatusProfile:r,completeAllMatchUps:a,randomWinningSide:o,tournamentRecord:s,completionGoal:l,drawDefinition:c,event:u}=t;if(!c)return{error:Lt};let d=t.matchUpFormat||c.matchUpFormat||(u==null?void 0:u.matchUpFormat),p=c.structures.slice().sort(cw),h=0,{matchUps:f,matchUpsMap:m}=wa({contextFilters:{stages:[Ft,Xt]},matchUpFilters:{matchUpTypes:[Jn],roundNumbers:[1]},inContext:!0,drawDefinition:c});if(f!=null&&f.length){let y=((e=u==null?void 0:u.category)==null?void 0:e.ageCategoryCode)||((i=u==null?void 0:u.category)==null?void 0:i.categoryName);if(y){let b=Vwe({singlesOnly:!0,tournamentRecord:s,drawDefinition:c,scaleAccessor:{scaleName:y,sortOrder:$we,scaleType:rg},event:u});if(b.error)return b;let{lineUps:I,participantsToAdd:T}=b;Dd({tournamentRecord:s,participants:T}),un({element:c,extension:{name:Of,value:I}})}else{let b=(n=f[0])==null?void 0:n.structureId,{positionAssignments:I}=jn({drawDefinition:c,structureId:b});if(I!=null&&I.length){let{participants:T}=Yr({participantFilters:{participantTypes:[Jn]},tournamentRecord:s}),w=S=>{let D=S.tieMatchUps.filter(Hr(Mr)),E=S.tieMatchUps.filter(Hr(Zn));D.forEach((C,P)=>{let R=C.matchUpId;C.sides.forEach(N=>{var M;let{drawPosition:A}=N,_=T==null?void 0:T.find(x=>{var O;let{participantId:B}=x;return((O=I.find(F=>F.participantId===B))==null?void 0:O.drawPosition)===A});if(_){let x=(M=_.individualParticipantIds)==null?void 0:M[P];x&&H_({teamParticipantId:_.participantId,participantId:x,tournamentRecord:s,drawDefinition:c,tieMatchUpId:R,event:u})}})}),E.forEach((C,P)=>{let R=C.matchUpId;C.sides.forEach(N=>{var M,A;let{drawPosition:_}=N,x=T==null?void 0:T.find(O=>{var B;let{participantId:F}=O;return((B=I.find(G=>G.participantId===F))==null?void 0:B.drawPosition)===_});x&&((A=(M=x.individualParticipantIds)==null?void 0:M.slice(P*2,P*2+2))==null||A.forEach(O=>{H_({teamParticipantId:x.participantId,participantId:O,tournamentRecord:s,drawDefinition:c,tieMatchUpId:R,event:u})}))})})};f.forEach(w)}}}let g=typeof a=="string"&&a,v=g&&ia;for(let y of p){if(h>=l)break;let{matchUps:b}=Sn({matchUpFilters:{matchUpTypes:[Zn,Mr]},afterRecoveryTimes:!1,tournamentRecord:s,inContext:!0,drawDefinition:c,matchUpsMap:m,structure:y,event:u}),I=b.filter(({winningSide:T})=>!T).sort(fw).map(Va);for(let T of I){if(!isNaN(l)&&h>=l)break;let{matchUps:w}=Sn({matchUpFilters:{matchUpTypes:[Zn,Mr]},afterRecoveryTimes:!1,tournamentRecord:s,inContext:!0,drawDefinition:c,matchUpsMap:m,structure:y,event:u}),S=w.find(E=>E.matchUpId===T),D=[da,Ca].includes(S.matchUpStatus);if(S!=null&&S.readyToScore&&!D){let E=F6e({winningSide:!o&&1,matchUpStatusProfile:r,tournamentRecord:s,drawDefinition:c,targetMatchUp:S,matchUpFormat:d,matchUpStatus:v,scoreString:g,event:u});if(E!=null&&E.error)return E;h+=1}}}return{...ue,completedCount:h}}function M0e(t){let{matchUpStatusCodes:e,policyDefinitions:i,tournamentRecord:n,drawDefinition:r,targetMatchUp:a,matchUpStatus:o,matchUpFormat:s,scoreString:l,winningSide:c,event:u}=t;if(!a||a.matchUpStatus===yn)return;let{matchUpId:d}=a||{},{outcome:p}=N7({matchUpFormat:s,matchUpStatus:o,scoreString:l,winningSide:c});return e&&(p.matchUpStatusCodes=e),GR({tournamentRecord:n,policyDefinitions:i,drawDefinition:r,matchUpFormat:s,matchUpId:d,outcome:p,event:u})}function F6e(t){let{matchUpStatusProfile:e={},tournamentRecord:i,policyDefinitions:n,drawDefinition:r,matchUpStatus:a,matchUpFormat:o,targetMatchUp:s,scoreString:l,winningSide:c,event:u}=t;if(l||a)return M0e(t);let{matchUpId:d}=s||{},{outcome:p}=L7({matchUpStatusProfile:e,matchUpFormat:o,winningSide:c});return GR({policyDefinitions:n,tournamentRecord:i,drawDefinition:r,matchUpFormat:o,matchUpId:d,outcome:p,event:u})}function N0e({matchUpStatusProfile:t,completeAllMatchUps:e,randomWinningSide:i,tournamentRecord:n,drawProfiles:r,event:a}){var o,s,l,c;let u=Xr({event:a}).flightProfile,{eventName:d,eventType:p,category:h}=a,{startDate:f}=n,m=[],g=(h==null?void 0:h.categoryName)||(h==null?void 0:h.ageCategoryCode)||(h==null?void 0:h.ratingType),v=(o=a.drawDefinitions)==null?void 0:o.map(({drawId:y})=>y);if(Array.isArray(u==null?void 0:u.flights))for(let[y,b]of u.flights.entries()){let{drawId:I,stage:T,drawName:w,drawEntries:S}=b;m.push(b.drawId);let D=r[y],{seedsCount:E,generate:C=!0}=D||{};if(C){let P=S.filter(Ol(wh)).map(Ol(wh)),R=g||d;if(n&&E&&E<=P.length&&Ct(1,E+1).forEach((x,O)=>{let B={scaleValue:x,scaleName:R,scaleType:ah,eventType:p,scaleDate:f},F=P[O];WS({tournamentRecord:n,participantId:F,scaleItem:B})}),v==null?void 0:v.includes(I))break;let N=yF({...D,matchUpType:p,seedingScaleName:R,tournamentRecord:n,isMock:!0,drawEntries:S,drawName:w,drawId:I,event:a,stage:T});if(N.error)return{error:N.error,drawIds:[]};let{drawDefinition:M}=N;if(!M)return{error:_l};let A=(s=r[y])==null?void 0:s.drawExtensions;if(Array.isArray(A)&&A.filter(yp).forEach(x=>un({element:M,extension:x})),N=wF({suppressNotifications:!0,tournamentRecord:n,drawDefinition:M,event:a}),N.error)return{error:N.error,drawIds:[]};if(D!=null&&D.withPlayoffs){let x=(l=M.structures)==null?void 0:l[0].structureId,O=zL({idPrefix:D.idPrefix,...D.withPlayoffs,tournamentRecord:n,drawDefinition:M,isMock:!0,structureId:x,event:a});if(O!=null&&O.error)return O}let _=D==null?void 0:D.completionGoal;if((D==null?void 0:D.automated)!==!1&&(e||_)){let x=D==null?void 0:D.matchUpFormat,O=z_({completeAllMatchUps:!_&&e,matchUpStatusProfile:t,randomWinningSide:i,tournamentRecord:n,completionGoal:_,drawDefinition:M,matchUpFormat:x,event:a});if(O.error)return{error:O.error,drawIds:[]};let B=O.completedCount;if((D==null?void 0:D.drawType)===Ph){let F=(c=M.structures)==null?void 0:c.find($=>$.stage===Ft);if(!F)return{error:Dr};let G=wR({structureId:F.structureId,tournamentRecord:n,drawDefinition:M,event:a});if(G.error)return{error:G.error,drawIds:[]};let H=_?_-(B??0):void 0;if(G=z_({completeAllMatchUps:!_&&e,completionGoal:_?H:void 0,matchUpStatusProfile:t,randomWinningSide:i,tournamentRecord:n,drawDefinition:M,matchUpFormat:x,event:a}),G.error)return{error:G.error,drawIds:[]}}}}}return{...ue,drawIds:m}}function A0e(t){var e,i;let{participantsProfile:n={},uniqueParticipantsCount:r,ratingsParameters:a,tournamentRecord:o,eventProfile:s,eventIndex:l,event:c,uuids:u}=t,{category:d,gender:p,eventType:h}=c,f=Hr(Mh)(h)&&Ki||Hr(xu)(h)&&Ui||h,m=r[Ft]||0,g=r[Xt]||0,v=(e=s.drawProfiles)!=null&&e.length?m+g:((i=s.participantsProfile)==null?void 0:i.participantsCount)??0,y=[Yn,Ir].includes(p)?p:void 0,b=n!=null&&n.idPrefix?`E-${l}-${n==null?void 0:n.idPrefix}`:void 0,{participants:I}=WR({uuids:s.uuids||u,...n,scaledParticipantsCount:s.scaledParticipantsCount,consideredDate:o==null?void 0:o.startDate,rankingRange:s.rankingRange,participantType:f,participantsCount:v,ratingsParameters:a,category:d,idPrefix:b,sex:y}),T=Dd({tournamentRecord:o,participants:I});if(T.error)return T;let w=I==null?void 0:I.filter(({participantType:D})=>D===f),S=I==null?void 0:I.map(Wi);return{uniqueDrawParticipants:w,uniqueParticipantIds:S}}function B6e({autoEntryPositions:t,tournamentRecord:e,drawParticipants:i,drawProfile:n,event:r}){let{drawType:a=rp,qualifyingPositions:o=0,stage:s=Ft,drawSize:l=0,drawName:c,drawId:u}=n,d=l-o,p=i.slice(0,d).map(Wi);if(p.length){let m=lh({participantIds:p,autoEntryPositions:t,entryStage:s,tournamentRecord:e,event:r});if(m.error)return m}let h=p.map(m=>({entryStatus:tc,entryStage:s,participantId:m})),f=TF({drawName:c||a,qualifyingPositions:o,drawEntries:h,drawId:u,event:r,stage:s});return f.error?f:{...ue}}function _0e({uniqueDrawParticipants:t,autoEntryPositions:e,stageParticipants:i,tournamentRecord:n,drawProfiles:r,category:a,gender:o,event:s}){let l=0;for(let c of r){let{qualifyingPositions:u=0,uniqueParticipants:d,stage:p=Ft,drawSize:h=0}=c,f=h-u,m=d||o||a||p===Xt,g=m?t.slice(l,l+f):i[p||Ft]||[];m&&(l+=f);let v=B6e({autoEntryPositions:e,drawParticipants:g,tournamentRecord:n,drawProfile:c,event:s});if(v.error)return v}return{...ue}}function k0e(t){var e;let{allUniqueParticipantIds:i,matchUpStatusProfile:n,participantsProfile:r,completeAllMatchUps:a,autoEntryPositions:o,hydrateCollections:s,randomWinningSide:l,ratingsParameters:c,tournamentRecord:u,eventProfile:d,eventIndex:p,publish:h,isMock:f,uuids:m}=t,g=d.gender,v=d.eventName,{eventType:y=Mh,policyDefinitions:b,drawProfiles:I=[],eventExtensions:T,surfaceCategory:w,tieFormatName:S,processCodes:D,discipline:E,eventLevel:C,timeItems:P,ballType:R,category:N}=d,M=d.eventId||xn(),A=d.tieFormat||(y===Fa?vI({namedFormat:S,event:{eventId:M,category:N,gender:g},hydrateCollections:s,isMock:f}):void 0),_=u.participants;for(let oe of I)!g&&oe.gender&&(g=oe==null?void 0:oe.gender);let{stageParticipantsCount:x,uniqueParticipantsCount:O,uniqueParticipantStages:B}=P0e({drawProfiles:I,category:N,gender:g}),F=Hr(Mh)(y)&&Ki||Hr(xu)(y)&&Ui||y,{uniqueDrawParticipants:G=[],uniqueParticipantIds:H=[]}=B?A0e({event:{eventType:y,category:N,gender:g},uniqueParticipantsCount:O,participantsProfile:r,ratingsParameters:c,tournamentRecord:u,eventProfile:d,eventIndex:p,uuids:m}):{},{eventAttributes:$}=d;typeof $!="object"&&($={});let q=(N==null?void 0:N.categoryName)||(N==null?void 0:N.ageCategoryCode)||(N==null?void 0:N.ratingType);v=v||q||"Generated Event";let z={...$,surfaceCategory:w,processCodes:D,discipline:E,eventLevel:C,eventName:v,eventType:y,tieFormat:A,ballType:R,category:N,eventId:M,gender:g};if(T!=null&&T.length&&Array.isArray(T)){let oe=T.filter(yp);oe!=null&&oe.length&&Object.assign(z,{extensions:oe})}if(Array.isArray(P)&&P.forEach(oe=>Iw({event:Q,timeItem:oe})),typeof b=="object")for(let oe of Object.keys(b))cy({policyDefinitions:{[oe]:b[oe]},event:z});z.category&&(z.category.categoryName=q);let Z,Y=$R({suppressNotifications:!1,internalUse:!0,tournamentRecord:u,event:z});if(Y.error)return Y;let Q=Y==null?void 0:Y.event,{stageParticipants:X}=R0e({allUniqueParticipantIds:i,stageParticipantsCount:x,eventParticipantType:F,targetParticipants:_});if(I!=null&&I.length){let oe=_0e({uniqueDrawParticipants:G,autoEntryPositions:o,stageParticipants:X,tournamentRecord:u,drawProfiles:I,category:N,gender:g,event:Q});if(oe.error)return oe;let re=N0e({matchUpStatusProfile:n,completeAllMatchUps:a,randomWinningSide:l,tournamentRecord:u,drawProfiles:I,event:Q});if(re.error)return re;Z=re.drawIds}else if((e=d==null?void 0:d.participantsProfile)!=null&&e.participantsCount){let oe=G.map(Wi);if(oe.length){let re=lh({participantIds:oe,autoEntryPositions:o,tournamentRecord:u,entryStage:Ft,event:Q});if(re.error)return re}}return h&&MU({tournamentRecord:u,event:Q}),{drawIds:Z,eventId:M,uniqueParticipantIds:H}}function F7({tournamentRecords:t,scheduleDate:e,venueId:i,round:n}){if(!Kl(e))return{error:Cs};let r="addSchedulingProfileRound",{extension:a}=Bi({name:cI,tournamentRecords:t,discover:!0}),o=(a==null?void 0:a.value)||[],s=o.find(p=>Uh(e,p.scheduleDate));if(!s){let{startDate:p,endDate:h}=sF({tournamentRecords:t}),f=new Date(e);if(p&&f<new Date(p)||h&&f>new Date(h))return{error:Cs};s={scheduleDate:e,venues:[]},o.push(s)}let l=s.venues.find(p=>p.venueId===i);l||(l={venueId:i,rounds:[]},s.venues.push(l));let c=["notBeforeTime"],u=p=>Object.keys(p).filter(h=>!c.includes(h)).sort().map(h=>sr(p[h])?u(p[h]):p[h]).flat().join("|");if(l.rounds.find(p=>u(p)===u(n)))return fe({result:{error:Nfe},stack:r});l.rounds.push(n);let d=PU({tournamentRecords:t,schedulingProfile:o});return d.error?d:{...ue}}function $6e({schedulingProfile:t,tournamentRecord:e}){if(typeof t!="object")return{error:Me};let i=vU({tournamentRecord:e}).containedStructures,n=co({tournamentRecord:e}).matchUps??[],{tournamentId:r}=e,a=[];for(let o of t){let{scheduleDate:s,venues:l=[]}=o;for(let c of l){let{rounds:u,venueId:d}=c;for(let p of u){let{drawId:h,winnerFinishingPositionRange:f,roundSegment:m}=p,g=n.filter(v=>{var y;let b=(f==null?void 0:f.indexOf("-"))>0&&f.split("-").map(T=>+T),I=(y=v.finishingPositionRange)==null?void 0:y.winner;return v.drawId===h&&(!p.roundNumber||v.roundNumber===p.roundNumber)&&(!I||!b||Wr(I,b).length===2||ki(I).length===ki(b).length&&Wr(I,b).length===ki(I).length)})[0];if(g){let{eventId:v,roundNumber:y,drawName:b,structureName:I,roundName:T}=g,w=g.structureId;y&&!f&&(w=Object.keys(i).find(E=>i[E].includes(w))??w);let S={tournamentId:r,structureId:w,roundNumber:y,roundSegment:m,eventId:v,drawId:h},D=F7({tournamentRecords:{[r]:e},round:S,scheduleDate:s,venueId:d});if(D.error)return D;a.push({structureName:I,roundName:T,drawName:b,...S})}}}}return{scheduledRounds:a}}function xF(t){var e,i,n;let r=mn(t,[{drawProfile:!0,_ofType:Xh}]);if(r.error)return r;let{allUniqueParticipantIds:a=[],participantsProfile:o={},matchUpStatusProfile:s,completeAllMatchUps:l,autoEntryPositions:c,hydrateCollections:u,randomWinningSide:d,ratingsParameters:p,tournamentRecord:h,isMock:f=!0,drawProfile:m,startDate:g,drawIndex:v,uuids:y}=t,b=$t(m,!1,!0),{excessParticipantAlternates:I=!0,matchUpFormat:T=Cc,drawType:w=rp,tournamentAlternates:S=0,alternatesCount:D=0,qualifyingPositions:E,qualifyingProfiles:C,generate:P=!0,eventExtensions:R,drawExtensions:N,completionGoal:M,tieFormatName:A,seedsCount:_,timeItems:x,drawName:O,category:B,idPrefix:F,publish:G,gender:H,stage:$}=b,q=b.drawSize||(b.ignoreDefaults?void 0:32),z=b.eventId||xn(),Z=m.eventType||m.matchUpType||Mh,Y=Z===xu?Ui:Ki,Q=typeof m.tieFormat=="object"&&m.tieFormat||Z===Hn&&vI({event:{eventId:z,category:B,gender:H},namedFormat:A,hydrateCollections:u,isMock:f})||void 0,X=(B==null?void 0:B.categoryName)||(B==null?void 0:B.ageCategoryCode)||(B==null?void 0:B.ratingType),oe=m.eventName||X||`Generated ${Z}`,re=(h==null?void 0:h.participants)||[],me=((C==null?void 0:C.map(Pe=>Pe.structureProfiles||[]).flat().reduce((Pe,et)=>{let Ee=!et.participantsCount||et.participantsCount>et.drawSize?et.drawSize:et.participantsCount||0;return Pe+Ee},0))||0)*(Y===Ui?2:1),se=(!m.participantsCount||m.participantsCount>q?q:m.participantsCount)||0,te={eventName:oe,eventType:Z,tieFormat:Q,category:B,eventId:z,gender:H};Array.isArray(x)&&x.forEach(Pe=>Iw({event:te,timeItem:Pe}));let{eventAttributes:he}=m;if(typeof he!="object"&&(he={}),Object.assign(te,he),(R==null?void 0:R.length)&&Array.isArray(R)){let Pe=R.filter(yp);Pe!=null&&Pe.length&&Object.assign(te,{extensions:Pe})}let ae=[];if(me||m.uniqueParticipants||!h||H||B){let Pe=(se||0)+D+me,et=Pe,Ee={[Yn]:0,[Ir]:0},lt,Ke;Z===Hn&&({teamSize:lt,genders:Ke}=E0e({alternatesCount:D,tieFormatName:A,tieFormat:Q,drawSize:q}),Object.keys(Ke).forEach(Ue=>{[Yn,Ir].includes(Ue)&&Ke[Ue]&&(Ee[Ue]=q*Ke[Ue])}),et=lt*((q||0)+me));let bt=o!=null&&o.idPrefix?`D-${v}-${o==null?void 0:o.idPrefix}`:void 0,gt=WR({...o,scaledParticipantsCount:m.scaledParticipantsCount||o.scaledParticipantsCount,participantsCount:et,consideredDate:h==null?void 0:h.startDate,sex:H||(o==null?void 0:o.sex),rankingRange:m.rankingRange,uuids:m.uuids||y,ratingsParameters:p,participantType:Y,gendersCount:Ee,idPrefix:bt,category:B}).participants;if(te.category&&(te.category.categoryName=X),h){let Ue=Dd({participants:gt,tournamentRecord:h});if(Ue.error)return Ue}if(gt.forEach(({participantId:Ue})=>ae.push(Ue)),re=gt,Z===Hn){let Ue=Ke[Yn]?gt.filter(({participantType:ke,person:Ut})=>ke===Ki&&(Ut==null?void 0:Ut.sex)===Yn).map(Wi):[],xe=Ke[Ir]?gt.filter(({participantType:ke,person:Ut})=>ke===Ki&&(Ut==null?void 0:Ut.sex)===Ir).map(Wi):[],We=gt.filter(({participantType:ke})=>ke===Ki).map(Wi).filter(ke=>!Ue.includes(ke)&&!xe.includes(ke)),st=lt-(Ke[Yn]+Ke[Ir]),vt=0,ge=0,Se=0,qe=Ct(0,Pe).map(ke=>{let Ut=xe.slice(vt,vt+Ke[Ir]),pt=Ue.slice(ge,ge+Ke[Yn]),tt=We.slice(Se,Se+st);return vt+=Ke[Ir],ge+=Ke[Yn],Se+=st,{individualParticipantIds:[...Ut,...pt,...tt],participantOtherName:`TM${ke+1}`,participantName:`Team ${ke+1}`,participantRole:jo,participantType:Hn,participantId:xn()}}),$e=Dd({participants:qe,tournamentRecord:h});if(!$e.success)return $e;re=qe}}let de=Pe=>{let{participantType:et}=Pe;return Hr(Mh)(Z)&&et===Ki||Hr(xu)(Z)&&et===Ui?!0:Z===Hn&&et===Hn},Ie=Pe=>{var et,Ee;return!m.gender||((et=Pe.person)==null?void 0:et.sex)===m.gender?!0:(Ee=Pe.individualParticipantIds)==null?void 0:Ee.some(lt=>{let Ke=re.find(bt=>bt.participantId===lt);return Ke&&Ie(Ke)})},De=re.filter(de).filter(Ie).filter(({participantId:Pe})=>!a.includes(Pe)),Te=De.slice(0,se).map(Pe=>Pe.participantId);if(f&&Te!=null&&Te.length){let Pe=lh({autoEntryPositions:c,entryStage:$,tournamentRecord:h,participantIds:Te,event:te});if(Pe.error)return Pe}let _e=me?De.slice(se,se+me).map(Pe=>Pe.participantId):0;if(f&&_e!=null&&_e.length){let Pe=0,et=1,Ee=(Ke,bt)=>Ke.stageSequence-bt.stageSequence,lt=(Ke,bt)=>Ke.roundTarget-bt.roundTarget;for(let Ke of C.sort(lt)){et=Ke.roundTarget||et;let bt=1,gt;for(let Ue of Ke.structureProfiles.sort(Ee)){let xe=(Ue.drawSize||m5(Ue.participantsCount))-(gt||0),We=_e.slice(Pe,Pe+xe),st=lh({entryStage:Xt,entryStageSequence:bt,autoEntryPositions:c,tournamentRecord:h,participantIds:We,roundTarget:et,event:te});if(st.error)return st;gt=Ue.qualifyingPositions,Pe+=xe,bt+=1}et+=1}}let Ve=I&&((e=h==null?void 0:h.participants)==null?void 0:e.filter(({participantId:Pe})=>!Te.includes(Pe)).filter(de).filter(Ie).slice(0,D||q-se||S).map(Pe=>Pe.participantId));if(f&&Ve!=null&&Ve.length){let Pe=lh({participantIds:Ve,autoEntryPositions:!1,entryStatus:Su,tournamentRecord:h,event:te});if(Pe.error)return Pe.error}let ot=X||oe;h&&_&&_<=Te.length&&Ct(1,_+1).forEach((Pe,et)=>{let Ee={scaleName:ot,scaleDate:g,scaleType:m6,scaleValue:Pe,eventType:Z},lt=Te[et];WS({tournamentRecord:h,participantId:lt,scaleItem:Ee})});let St=yF({...$t(m,!1,!0),tournamentRecord:h,seedingScaleName:ot,matchUpFormat:T,eventId:z,isMock:f,event:te});if(St.error)return St;if(!St.drawDefinition)return{error:_l};let{drawDefinition:nt}=St,Bt=nt.drawId;if(Array.isArray(N)&&N.filter(yp).forEach(Pe=>un({element:nt,extension:Pe})),P){if(wF({drawDefinition:nt,event:te,suppressNotifications:!0}),m.withPlayoffs){let et=(i=nt.structures)==null?void 0:i[0].structureId,Ee=zL({...m.withPlayoffs,tournamentRecord:h,drawDefinition:nt,structureId:et,idPrefix:F,isMock:f,event:te});if(Ee!=null&&Ee.error)return Ee}let Pe=m.automated===!1;if(f&&!Pe){let et=Ee=>{var lt;let Ke=z_({completeAllMatchUps:Ee.completeAllMatchUps,completionGoal:Ee.completionGoal,matchUpStatusProfile:s,randomWinningSide:d,tournamentRecord:h,drawDefinition:nt,matchUpFormat:T,event:te});if(Ke.error)return Ke;let bt=Ke.completedCount;if(w===Ph){let gt=(lt=nt.structures)==null?void 0:lt.find(We=>We.stage===Ft);if(!gt)return{error:Dr};wR({structureId:gt.structureId,tournamentRecord:h,drawDefinition:nt,event:te});let Ue=M?M-(bt??0):void 0,xe=z_({completionGoal:M?Ue:void 0,matchUpStatusProfile:s,completeAllMatchUps:l,randomWinningSide:d,tournamentRecord:h,drawDefinition:nt,matchUpFormat:T,event:te});if(xe.error)return xe}};if(M&&et({completionGoal:M}),m.outcomes){let{matchUps:Ee}=Hs({inContext:!0,drawDefinition:nt,event:te});for(let lt of m.outcomes){let{matchUpStatus:Ke=ia,matchUpStatusCodes:bt,stageSequence:gt=1,matchUpIndex:Ue=0,structureOrder:xe,matchUpFormat:We,drawPositions:st,roundPosition:vt,stage:ge=Ft,roundNumber:Se,winningSide:qe,scoreString:$e}=lt,ke=(Ee==null?void 0:Ee.reduce((At,ei)=>{let{structureId:vi,matchUpId:Ln}=ei;return At[vi]?At[vi].push(Ln):At[vi]=[Ln],At},{}))??[],Ut=Object.assign({},...Object.keys(ke).map((At,ei)=>({[At]:ei+1}))),pt=(n=Ee==null?void 0:Ee.filter(At=>(!ge||At.stage===ge)&&(!gt||At.stageSequence===gt)&&(!Se||At.roundNumber===Se)&&(!vt||At.roundPosition===vt)&&(!xe||Ut[At.structureId]===xe)&&(!st||Wr(st,At.drawPositions).length===2)))==null?void 0:n[Ue],tt=M0e({matchUpStatusCodes:bt,tournamentRecord:h,drawDefinition:nt,targetMatchUp:pt,matchUpFormat:We,matchUpStatus:Ke,scoreString:$e,winningSide:qe});if(tt!=null&&tt.error)return tt}}l&&et({completeAllMatchUps:l})}G&&MU({tournamentRecord:h,event:te})}else{let Pe=TF({drawEntries:nt.entries,drawName:O||w,qualifyingPositions:E,drawId:Bt,event:te,stage:$});if(Pe.error)return Pe}return{...ue,event:qt(te),uniqueParticipantIds:ae,targetParticipants:re,drawDefinition:nt,eventId:z,drawId:Bt}}var x0e=()=>({altitude:void 0,courtId:void 0,courtName:"",courtDimensions:void 0,latitude:void 0,longitude:void 0,surfaceCategory:void 0,surfaceType:void 0,surfacedDate:void 0,dateAvailability:[],onlineResources:[],pace:void 0,notes:void 0}),V6e=x0e;function q_(t){return parseInt(t)}function EX({startTime:t="",endTime:e=""}={}){if(!t||!e||!Tv.test(t)||!Tv.test(e))return!1;let[i,n]=t.split(":").map(q_),[r,a]=e.split(":").map(q_);return r<i?!1:!(i===r&&a<n)}function j6e(t,e){let[i,n]=t.startTime.split(":").map(q_),[r,a]=e.startTime.split(":").map(q_);return i<r?-1:i>r?1:n<a?-1:n>a?1:0}function O0e({dateAvailability:t}){if(!t)return{error:Hfe};if(!Array.isArray(t))return{error:ON};let e="Dates must be formated => YYYY-MM-DD",i="Times must be 24 hour => 00:00";for(let n of t){if(typeof n!="object")return{error:ON};let{date:r,startTime:a,endTime:o,bookings:s=[]}=n;if(!a||!o)return{error:ON};if(r&&!Th.test(r))return{error:Cs,dateAvailability:{date:r},info:e};if(!Tv.test(a))return{error:lu,dateAvailability:{startTime:a},info:i};if(!Tv.test(o))return{error:lu,dateAvailability:{endTime:o},info:i};if(a===o)return{error:lu,dateAvailability:{startTime:a,endTime:o},info:"startTime and endTime are equivalent"};if(!EX({startTime:a,endTime:o}))return{error:lu,dateAvailability:{startTime:a,endTime:o},info:"endTime must be after startTime"};if(s){if(!Array.isArray(s))return{error:f_};for(let l of s){if(typeof l!="object")return{error:f_};let{startTime:c,endTime:u}=l;if(!Tv.test(c))return{error:lu,booking:{startTime:c},info:i};if(!Tv.test(u))return{error:lu,booking:{endTime:u},info:i};if(c===u)return{error:lu,dateAvailability:{startTime:c,endTime:u},info:"startTime and endTime are equivalent"};if(!EX({startTime:c,endTime:u}))return{error:lu,dateAvailability:{startTime:c,endTime:u},info:"endTime must be after startTime"}}}}return{valid:!0}}function OF({tournamentRecord:t,disableNotice:e,venueId:i,courtId:n,court:r}){let{venue:a}=um({tournamentRecord:t,venueId:i});if(!a)return{error:oU};a.courts||(a.courts=[]);let o={...x0e(),venueId:i,courtId:n};if(o.courtId||(o.courtId=xn()),a.courts.some(s=>s.courtId===o.courtId))return{error:sme};{let s=((r==null?void 0:r.dateAvailability)||[]).map(u=>{var d;return{...u,date:Ci(u.date),startTime:rr(u.startTime),endTime:rr(u.endTime),bookings:(d=u.bookings)==null?void 0:d.map(({startTime:p,endTime:h,bookingType:f})=>({startTime:rr(p),endTime:rr(h),bookingType:f}))}}),l=Object.keys(o);for(let u of l)if(r!=null&&r[u])if(u==="dateAvailability"){let d=O0e({dateAvailability:s});if(!d.valid&&d.error)return d;o.dateAvailability=s}else o[u]=r[u];let c=o;return a.courts.push(c),e||tn({payload:{venue:a,tournamentId:t.tournamentId},topic:xy,key:a.venueId}),{...ue,court:$t(o),venueId:i}}}function B7(t){let{tournamentRecord:e,venueId:i}=t;if(typeof i!="string"||!i)return{error:xg};let n=t.tournamentRecords??(e&&{[e.tournamentId]:e})??{},r=[],a;for(let o of Object.values(n)){let{venue:s}=um({tournamentRecord:o,venueId:i});if(s){let l=G6e({...t,tournamentRecord:o});for(let c of(l==null?void 0:l.courts)??[])r.push(c==null?void 0:c.courtId);if(l.error)return l;a=!0}}return a?{...ue,courtIds:r}:{error:oU}}function G6e({courtNameRoot:t="Court",dateAvailability:e=[],venueAbbreviationRoot:i,tournamentRecord:n,courtNames:r=[],courtTimings:a,courtsCount:o,startTime:s,courtIds:l,endTime:c,idPrefix:u,venueId:d,dates:p}){if(!d)return{error:xg};let h=um({tournamentRecord:n,venueId:d});if(h.error)return h;let{venue:f}=h;if(!Lr(o)||!r)return{error:ome};o=o??r.length;let m=Ct(0,o).map(g=>{let v=a==null?void 0:a[g],y=v?p.map(b=>({date:fd(b),startTime:s,endTime:c,...v})):e;return v&&s&&c&&y.push({startTime:s,endTime:c}),{courtName:r[g]||i&&(f==null?void 0:f.venueAbbreviation)&&`${f==null?void 0:f.venueAbbreviation} ${g+1}`||`${t} ${g+1}`,dateAvailability:y}}).map((g,v)=>{let y=(l==null?void 0:l.pop())||u&&`${u}-${v+1}`;return OF({disableNotice:!0,tournamentRecord:n,courtId:y,venueId:d,court:g})}).map(g=>g.court).filter(Boolean);return m.length!==o?fe({info:"not all courts could be generated",result:{error:Me}}):(f&&tn({payload:{venue:f,tournamentId:n.tournamentId},topic:xy,key:f.venueId}),{...ue,courts:$t(m)})}function L0e({tournamentRecord:t,venueProfiles:e,uuids:i}){let{startDate:n,endDate:r}=t,a=[];for(let[o,s]of e.entries()){let{venueAbbreviation:l,venueId:c=(i==null?void 0:i.pop())??xn(),dateAvailability:u,startTime:d="07:00",endTime:p="19:00",courtTimings:h,courtsCount:f,courtNames:m,venueName:g,idPrefix:v,courtIds:y}=s,b={venueName:g||`Venue ${o+1}`,venueAbbreviation:l,venueId:c},I=lR({tournamentRecord:t,venue:b});if(I.error)return I;a.push(c);let T=_S(n,r),w=!Array.isArray(u)&&[{startTime:d,endTime:p}].concat(T.map(D=>({date:fd(D),startTime:d,endTime:p}))),S=B7({dateAvailability:u||w,tournamentRecord:t,courtTimings:h,courtsCount:f,courtNames:m,startTime:d,idPrefix:v,courtIds:y,endTime:p,venueId:c,dates:T});if(S.error)return S}return a}var H6e=["Mock Tournament","CourtHive Challenge","Racket Rally","Generated Tournament","Factory Follies","Open Competition"];function F0e(t){let{tournamentAttributes:e,startDate:i,endDate:n}=t??{},{tournamentName:r=Tl(H6e),ratingsParameters:a=ql,scheduleCompletedMatchUps:o,tournamentExtensions:s,matchUpStatusProfile:l,completeAllMatchUps:c,participantsProfile:u,autoEntryPositions:d,hydrateCollections:p,randomWinningSide:h,policyDefinitions:f,schedulingProfile:m,periodLength:g,autoSchedule:v,eventProfiles:y,venueProfiles:b,drawProfiles:I,uuids:T}=t??{};if(i&&!Kl(i)||n&&!Kl(n))return{error:Cs};if(y&&!Array.isArray(y))return{error:Me};if(!i){let M=new Date;i=fd(n??M),n=fd(M.setDate(M.getDate()+7))}if(!n){let M=new Date(i);n=fd(M.setDate(M.getDate()+7))}typeof e!="object"&&(e={});let w=I0e({...e,tournamentName:r,isMock:!0,startDate:i,endDate:n});if(s!=null&&s.length&&Array.isArray(s)){let M=s.filter(A=>yp({extension:A}));M!=null&&M.length&&Object.assign(w,{extensions:M,isMock:!0})}if(typeof f=="object")for(let M of Object.keys(f))cy({policyDefinitions:{[M]:f[M]},tournamentRecord:w});let S=C0e({participantsProfile:u,tournamentRecord:w,eventProfiles:y,drawProfiles:I,startDate:i,uuids:T});if(!S.success)return S;let D=[],E=[],C=[];if(Array.isArray(I)){let M=0;for(let A of I){let _=xF({allUniqueParticipantIds:D,matchUpStatusProfile:l,completeAllMatchUps:c,autoEntryPositions:d,hydrateCollections:p,participantsProfile:u,randomWinningSide:h,ratingsParameters:a,tournamentRecord:w,isMock:!0,drawProfile:A,startDate:i,drawIndex:M,uuids:T});if(_.error)return _;let{drawId:x,eventId:O,event:B,uniqueParticipantIds:F}=_;if(_=$R({suppressNotifications:!1,internalUse:!0,tournamentRecord:w,event:B}),_.error)return _;x&&C.push(x),E.push(O),F!=null&&F.length&&D.push(...F),M+=1}}if(y){let M=0;for(let A of y){let _=k0e({allUniqueParticipantIds:D,matchUpStatusProfile:l,participantsProfile:u,completeAllMatchUps:c,autoEntryPositions:d,hydrateCollections:p,randomWinningSide:h,ratingsParameters:a,tournamentRecord:w,eventProfile:A,eventIndex:M,startDate:i,uuids:T});if(_.error)return _;let{eventId:x,drawIds:O,uniqueParticipantIds:B}=_;O&&C.push(...O),E.push(x),B!=null&&B.length&&D.push(...B),M+=1}}let P=b!=null&&b.length?L0e({tournamentRecord:w,venueProfiles:b,uuids:T}):[],R,N={};if(m){let M=$6e({schedulingProfile:m,tournamentRecord:w});if(M.error)return M;if(R=M.scheduledRounds,v){let{tournamentId:A}=w,_={[A]:w};N=kF({scheduleCompletedMatchUps:o,tournamentRecords:_,periodLength:g})}}return y5(),qt({...ue,tournamentRecord:w,scheduledRounds:R,schedulerResult:N,eventIds:E,venueIds:P,drawIds:C})}var B0e={};zi(B0e,{anonymizeTournamentRecord:()=>$0e,modifyTournamentRecord:()=>V0e});function $0e({keepExtensions:t=[],anonymizeParticipantNames:e=!0,tournamentRecord:i,tournamentName:n,personIds:r=[],tournamentId:a}){var o,s,l,c,u;if(!i)return{error:it};let d=Array.isArray(t)?OZ.concat(...t):OZ,p=$=>{var q;return Array.isArray(t)?(q=$==null?void 0:$.extensions)==null?void 0:q.filter(z=>d.includes(z.name)):$==null?void 0:$.extensions},h={};i.extensions=p(i);let f=a||xn();h[i.tournamentId]=f,i.tournamentId=f,i.createdAt=new Date().toISOString(),i.tournamentName=n||`Anonymized: ${fd(new Date)}`,i.isMock=!0,delete i.parentOrganisation;for(let $ of i.participants||[]){let q=xn();h[$.participantId]=q,$.participantId=q}for(let $ of i.participants||[])Array.isArray($.individualParticipantIds)&&($.individualParticipantIds=$.individualParticipantIds.map(q=>h[q]));let m=0;for(let $ of i.venues||[]){$.extensions=p($),$.venueName=`Venue #${m}`,$.venueAbbreviation=`V${m}`;let q=xn();h[$.venueId]=q,$.isMock=!0,m+=1}let g=1;for(let $ of i.events||[]){$.extensions=p($),$.isMock=!0;let q=xn();h[$.eventId]=q,$.eventId=q;let z=((o=$.category)==null?void 0:o.categoryName)||((s=$.category)==null?void 0:s.ageCategoryCode)||((l=$.category)==null?void 0:l.ratingType)||$.gender;if($.eventName=`Event ${g} ${z}`,Array.isArray($.entries))for(let Y of $.entries)Y.participantId=h[Y.participantId];for(let Y of $.drawDefinitions||[]){Y.extensions=p(Y);let Q=xn();if(h[Y.drawId]=Q,Y.drawId=Q,Y.isMock=!0,Array.isArray(Y.entries))for(let oe of Y.entries)oe.participantId=h[oe.participantId];let X=oe=>{oe.extensions=p(oe);let re=xn();h[oe.structureId]=re,oe.structureId=re;for(let me of oe.positionAssignments||[])me.participantId&&(me.participantId=h[me.participantId]);for(let me of oe.seedAssignments||[])me.participantId&&(me.participantId=h[me.participantId]);for(let me of oe.matchUps||[]){me.isMock=!0;for(let se of me.sides||[])se.lineUp&&(se.lineUp=se.lineUp.map(({participantId:te,collectionAssignments:he})=>({participantId:h[te],collectionAssignments:he})))}};for(let oe of Y.structures||[])if(X(oe),Array.isArray(oe.structures))for(let re of oe.structures)X(re);for(let oe of Y.links||[])oe.source.structureId=h[oe.source.structureId],oe.target.structureId=h[oe.target.structureId]}let{extension:Z}=Bi({name:Au,element:$});Array.isArray((c=Z==null?void 0:Z.value)==null?void 0:c.flights)&&((u=Z==null?void 0:Z.value.flights)==null||u.forEach(Y=>{if(Y.drawId=h[Y.drawId],Array.isArray(Y.drawEntries))for(let Q of Y.drawEntries)Q.participantId=h[Q.participantId]})),g+=1}let v=i.startDate||fd(new Date),y=(i.participants||[]).filter(({participantType:$})=>$===Ki),b=y.reduce(($,q)=>{var z;let Z=(z=q.person)==null?void 0:z.sex;return[Yn,Ir].includes(Z)?$[Z]+=1:$[vb]+=1,$},{[Yn]:0,[Ir]:0,[vb]:0}),I=Object.assign({},...Object.keys(b).map($=>{var q;return{[$]:((q=D0e({category:{ageCategoryCode:"O18"},count:b[$],addressProps:{citiesCount:10},personExtensions:[],consideredDate:v,sex:$}))==null?void 0:q.persons)||[]}})),T={[Yn]:0,[Ir]:0,[vb]:0},w=y.length,S=y.reduce(($,q)=>{var z,Z;let Y=((Z=(z=q.person)==null?void 0:z.addresses)==null?void 0:Z[0])||{},{city:Q,state:X,postalCode:oe}=Y;return $.cities.includes(Q)||$.cities.push(Q),$.states.includes(X)||$.states.push(X),$.postalCodes.includes(oe)||$.postalCodes.push(oe),$},{cities:[],postalCodes:[],states:[]}),D=S.postalCodes.length,E=S.cities.length,C=S.states.length,{cities:P}=w0e({count:E||w,participantsCount:w}),{states:R}=S0e({count:C||w,participantsCount:w}),{postalCodes:N}=T0e({count:D||w,participantsCount:w}),M={cities:P,states:R,postalCodes:N};y.forEach(($,q)=>{var z,Z;let Y=$==null?void 0:$.person,Q=(Y==null?void 0:Y.sex)||vb,X=(z=Ci(Y==null?void 0:Y.birthDate))==null?void 0:z.split("-")[0],oe=T[Q],re=I[Q][oe];if(T[Q]+=1,X){let[,me,se]=((Z=re==null?void 0:re.birthDate)==null?void 0:Z.split("-"))||[],te=[X,me,se].join("-");re.birthDate=te}if(Y!=null&&Y.addresses){let me=U0e({...M,participantIndex:q,nationalityCode:re.nationalityCode});re.addresses=[me]}re.personId=(r==null?void 0:r[q])||xn(),e?(re.standardFamilyName=re.lastName,re.standardGivenName=re.firstName,$.participantName=`${re.standardGivenName} ${re.standardFamilyName}`):(re.standardFamilyName=Y==null?void 0:Y.standardFamilyName,re.standardGivenName=Y==null?void 0:Y.standardGivenName),delete re.firstName,delete re.lastName,re.extensions=p(Y),$.person=re,h[Y==null?void 0:Y.personId]=re.personId}),(i.participants||[]).filter(({participantType:$})=>$===Ui).forEach($=>{let{individualParticipantIds:q}=$;$.participantName=z6e({individualParticipantIds:q,individualParticipants:y})});let A=(i.participants||[]).filter(({participantType:$})=>$===Hn),_=A.length,x=$j({count:_}).names;A.forEach(($,q)=>{$.participantName=x[q]});let O=(i.participants||[]).filter(({participantType:$})=>$===cc),B=O.length,F=$j({count:B,nameRoot:"Group"}).names;O.forEach(($,q)=>{$.participantName=F[q]});let{extension:G}=Bi({element:i,name:cI});Array.isArray(G==null?void 0:G.value)&&(G==null||G.value.forEach($=>{$.tournamentId=h[$.tournamentId],$.structureId=h[$.structureId],$.eventId=h[$.eventId],$.drawId=h[$.drawId]}));let{extension:H}=Bi({element:i,name:hU});return Array.isArray(H==null?void 0:H.value)&&(H==null||H.value.forEach($=>{$.personId=h[$.personId]})),{...ue}}function z6e({individualParticipantIds:t,individualParticipants:e}){let i=e.filter(({participantId:n})=>t.includes(n)).map(({person:n})=>n==null?void 0:n.standardFamilyName).filter(Boolean).sort().join("/");return t.length===1&&(i+="/Unknown"),i}function V0e(t){var e,i,n;let{ratingsParameters:r=ql,participantsProfile:a={},matchUpStatusProfile:o,completeAllMatchUps:s,autoEntryPositions:l,hydrateCollections:c,randomWinningSide:u,schedulingProfile:d,tournamentRecord:p,eventProfiles:h,periodLength:f,venueProfiles:m,autoSchedule:g,drawProfiles:v,uuids:y}=t;if(!p)return{error:it};let b=[],I=[],T=[];h==null||h.forEach(P=>{var R;let N=(R=p.events)==null?void 0:R.find((M,A)=>P.eventIndex!==void 0&&A===P.eventIndex||P.eventName&&M.eventName===P.eventName||P.eventId&&M.eventId===P.eventId);N!=null&&N.gender&&(P.gender=N.gender)});let w=((e=p.participants)==null?void 0:e.length)||void 0;w&&a!=null&&a.idPrefix&&(a.idPrefix=`${a.idPrefix}-${w}`);let S=C0e({startDate:p.startDate,participantsProfile:a,tournamentRecord:p,eventProfiles:h,drawProfiles:v,uuids:y});if(!S.success)return S;if(h){let P=((i=p.events)==null?void 0:i.length)||0;for(let R of h){let{ratingsParameters:N}=R,M=(n=p.events)==null?void 0:n.find((A,_)=>R.eventIndex!==void 0&&_===R.eventIndex||R.eventName&&A.eventName===R.eventName||R.eventId&&A.eventId===R.eventId);if(M){let{gender:A,category:_,eventType:x}=M,{drawProfiles:O,publish:B}=R,F=Hr(Mh)(x)&&Ki||Hr(xu)(x)&&Ui||x;if(O){let{stageParticipantsCount:G,uniqueParticipantsCount:H,uniqueParticipantStages:$}=P0e({drawProfiles:O,category:_,gender:A}),{uniqueDrawParticipants:q=[],uniqueParticipantIds:z=[]}=$?A0e({event:{eventType:x,category:_,gender:A},uniqueParticipantsCount:H,participantsProfile:a,ratingsParameters:N,tournamentRecord:p,eventProfile:R,uuids:y}):{};b.push(...z);let{stageParticipants:Z}=R0e({targetParticipants:p.participants||[],allUniqueParticipantIds:b,stageParticipantsCount:G,eventParticipantType:F}),Y=_0e({uniqueDrawParticipants:q,autoEntryPositions:l,stageParticipants:Z,tournamentRecord:p,drawProfiles:O,category:_,gender:A,event:M});if(Y.error||(Y=N0e({matchUpStatusProfile:o,completeAllMatchUps:s,randomWinningSide:u,tournamentRecord:p,drawProfiles:O,event:M}),Y.error))return Y;T.push(...Y.drawIds)}B&&MU({tournamentRecord:p,event:M})}else{let A=k0e({startDate:p.startDate,allUniqueParticipantIds:b,matchUpStatusProfile:o,participantsProfile:a,completeAllMatchUps:s,autoEntryPositions:l,randomWinningSide:u,ratingsParameters:N,tournamentRecord:p,eventProfile:R,eventIndex:P,uuids:y});if(A.error)return A;let{eventId:_,drawIds:x,uniqueParticipantIds:O}=A;x&&T.push(...x),I.push(_),O!=null&&O.length&&b.push(...O),P+=1}}}if(v){let P=(p.events||[]).map(R=>{var N;return((N=R.drawDefinitions)==null?void 0:N.map(()=>1))||[]}).flat().reduce((R,N)=>R+N,0);for(let R of v){let N=xF({startDate:p.startDate,allUniqueParticipantIds:b,matchUpStatusProfile:o,participantsProfile:a,completeAllMatchUps:s,autoEntryPositions:l,hydrateCollections:c,randomWinningSide:u,ratingsParameters:r,tournamentRecord:p,drawProfile:R,drawIndex:P,uuids:y});if(N.error)return N;let{drawId:M,eventId:A,event:_,uniqueParticipantIds:x}=N;if(N=$R({tournamentRecord:p,event:_,internalUse:!0}),N.error)return N;M&&T.push(M),I.push(A),x!=null&&x.length&&b.push(...x),P+=1}}let D=m!=null&&m.length?L0e({tournamentRecord:p,venueProfiles:m}):[],E,C={};if(d!=null&&d.length){let P={[p.tournamentId]:p},R=PU({tournamentRecords:P,schedulingProfile:d});if(R.error)return R;if(g){let{tournamentId:N}=p,M={[N]:p};C=kF({tournamentRecords:M,periodLength:f})}}return{totalParticipantsCount:p.participants.length,scheduledRounds:E,schedulerResult:C,...ue,eventIds:I,venueIds:D,drawIds:T}}var j0e={};zi(j0e,{addIndividualParticipantIds:()=>CF,addParticipant:()=>Up,addParticipants:()=>Dd,addPenalty:()=>lSe,addPersonRequests:()=>K0e,addPersons:()=>cSe,createGroupParticipant:()=>eSe,createTeamsFromParticipantAttributes:()=>O7,deleteParticipants:()=>gw,filterParticipants:()=>mR,findParticipant:()=>Q0e,getCompetitionParticipants:()=>M8,getPairedParticipant:()=>Ou,getParticipantEventDetails:()=>N8,getParticipantMembership:()=>A8,getParticipantScaleItem:()=>qS,getParticipantSchedules:()=>_8,getParticipantSignInStatus:()=>k8,getParticipantTimeItem:()=>T6,getParticipants:()=>Yr,getScaleValues:()=>uU,mergeParticipants:()=>sSe,modifyIndividualParticipantIds:()=>Y0e,modifyParticipant:()=>PF,modifyParticipantName:()=>tSe,modifyParticipantOtherName:()=>X0e,modifyParticipantsSignInStatus:()=>Z0e,modifyPenalty:()=>aSe,modifyPersonRequests:()=>q0e,mutate:()=>G0e,participantScaleItem:()=>sh,query:()=>YIe,regenerateParticipantNames:()=>J0e,removeIndividualParticipantIds:()=>M6,removeParticipantIdsFromAllTeams:()=>kL,removePenalty:()=>nSe,removePersonRequests:()=>W0e,scaledTeamAssignment:()=>iSe,setParticipantScaleItem:()=>WS,setParticipantScaleItems:()=>obe,validateLineUp:()=>OL});var G0e={};zi(G0e,{addIndividualParticipantIds:()=>CF,addParticipant:()=>Up,addParticipants:()=>Dd,addPenalty:()=>lSe,addPersonRequests:()=>K0e,addPersons:()=>cSe,createGroupParticipant:()=>eSe,createTeamsFromParticipantAttributes:()=>O7,deleteParticipants:()=>gw,findParticipant:()=>Q0e,mergeParticipants:()=>sSe,modifyIndividualParticipantIds:()=>Y0e,modifyParticipant:()=>PF,modifyParticipantName:()=>tSe,modifyParticipantOtherName:()=>X0e,modifyParticipantsSignInStatus:()=>Z0e,modifyPenalty:()=>aSe,modifyPersonRequests:()=>q0e,regenerateParticipantNames:()=>J0e,removeIndividualParticipantIds:()=>M6,removeParticipantIdsFromAllTeams:()=>kL,removePenalty:()=>nSe,removePersonRequests:()=>W0e,scaledTeamAssignment:()=>iSe,setParticipantScaleItem:()=>WS,setParticipantScaleItems:()=>obe});function H0e(t=0){(typeof t!="number"||isNaN(t))&&(t=0);let e=new Date;return e.setHours(e.getHours()+t),e.getTime().toString(36).slice(-6).toUpperCase()}function z0e({personRequests:t,personId:e,requests:i}){t[e]||(t[e]=[]);let n=i.filter(({requestType:r})=>r).map(r=>{let{date:a,startTime:o,endTime:s}=r;return r.requestType===zR&&(a=Ci(a),o=rr(o),s=rr(s),a&&o&&s)?{date:a,startTime:o,endTime:s,requestType:r.requestType}:r}).filter(Boolean);for(let r of n)r.requestId=H0e(),t[e].push(r);return{mergeCount:n.length}}function $7(t){let{tournamentRecords:e,personRequests:i}=t,n=mn(t,[{[Ko]:!0}]);if(n.error)return n;if(!i)return{...ue};let r=Object.values(e);for(let a of r){let o=a.participants??[],s=[];for(let l of Object.keys(i))if(ag({tournamentParticipants:o,personId:l})){let c=i[l];c.length&&s.push({personId:l,requests:c})}Object.keys(s).length&&un({element:a,extension:{value:s,name:hU}})}return{...ue}}function q0e(t){let{tournamentRecords:e,requests:i,personId:n}=t,r=mn(t,[{[Ko]:!0},{requests:!0,[Lg]:bl,[Sh]:Me}]);if(r.error)return r;let a=i.map(({requestId:c})=>c).filter(Boolean),{personRequests:o}=qy({tournamentRecords:e}),s=c=>{o&&(o[c]=o[c].map(u=>{if(!a.includes(u.requestId))return u;let d=i.find(p=>p.requestId===u.requestId);if(d.requestType)return Object.assign(u,d)}).filter(Boolean))};if(n&&o!=null&&o[n])s(n);else if(o)for(let c of Object.keys(o))s(c);let l=i.filter(c=>!c.requestId);return l.length&&z0e({personRequests:o,personId:n,requests:l}),$7({tournamentRecords:e,personRequests:o})}function W0e(t){let{tournamentRecords:e,requestType:i,requestId:n,personId:r,date:a}=t,o=mn(t,[{[Ko]:!0}]);if(o.error)return o;let{personRequests:s}=qy({tournamentRecords:e}),l=u=>{var d;s&&(s[u]=s[u].filter(p=>(!i||p.requestType!==i)&&(!n||p.requestId!==n)&&(!a||p.date!==a)),(d=s==null?void 0:s[u])!=null&&d.length||delete s[u])},c=!i&&!n&&!r&&!a;if(!c){if(r&&s!=null&&s[r])l(r);else if(s)for(let u of Object.keys(s))l(u)}return c||!s||!Object.keys(s).length?Ss({name:hU,tournamentRecords:e,discover:!0}):$7({tournamentRecords:e,personRequests:s})}function K0e(t){let{tournamentRecords:e,personId:i,requests:n}=t,r=mn(t,[{[Ko]:!0,[UGe]:!0},{requests:!0,[Lg]:bl,[Sh]:Me}]);if(r.error)return r;let{personRequests:a}=qy({tournamentRecords:e}),{mergeCount:o}=z0e({personRequests:a,personId:i,requests:n});return o&&a?$7({tournamentRecords:e,personRequests:a}):{error:Me}}function Y0e({individualParticipantIds:t,groupingParticipantId:e,tournamentRecord:i}){let n="modifyIndividualParticipantIds";if(!i)return fe({result:{error:it},stack:n});if(!e||!t)return fe({result:{error:Ht},stack:n});let r=i.participants||[],a=r.find(h=>h.participantId===e);if(!a)return fe({result:{error:Jr},stack:n});if(![Hn,cc].includes(a.participantType))return fe({result:{error:Sd},context:{participantType:a.participantType},stack:n});let o=t.filter(h=>{var f;return((f=r.find(m=>m.participantId===h))==null?void 0:f.participantType)!==Ki});if(o.length)return fe({result:{error:wu,invalidParticipantIds:o},stack:n});let s=a.individualParticipantIds||[],l=t.filter(h=>!s.includes(h)),c=s.filter(h=>!t.includes(h)),u=CF({individualParticipantIds:l,groupingParticipantId:e,tournamentRecord:i});if(u.error)return fe({result:u,stack:n});let d=M6({individualParticipantIds:c,groupingParticipantId:e,tournamentRecord:i});if(d.error)return fe({result:d,stack:n});let{topics:p}=Gu();if(p.includes(No)){let h=r.find(({participantId:f})=>f===e);tn({topic:No,payload:{tournamentId:i.tournamentId,participants:[h]}})}return{...u,...d}}function Z0e({tournamentRecord:t,participantIds:e,signInState:i}){if(!t)return{error:it};if(!Array.isArray(e))return{error:Ht};if(![bE,Oge].includes(i))return{error:Me,signInState:i};let n=t.participants||[];if(!n.length)return{error:OP};let r=n.map(Wi),a=e.filter(c=>!r.includes(c));if(a.length)return{error:Me,context:{invalidParticipantIds:a}};let o=[],s=new Date().toISOString();for(let c of n){let{participantId:u}=c;if(e.includes(u)){let d=G6({duplicateValues:!1,tournamentRecord:t,participantId:u,timeItem:{itemType:XP,itemValue:i,createdAt:s}});if(d.error)return d;o.push(c)}}let{topics:l}=Gu();return o.length&&l.includes(No)&&tn({topic:No,payload:{tournamentId:t.tournamentId,participants:o}}),{...ue}}function X0e({tournamentRecord:t,participantId:e,participantOtherName:i}){if(!t)return{error:it};if(!e)return{error:Ra};let{participant:n}=jy({tournamentRecord:t,participantId:e});if(!n)return{error:Jr};n.participantOtherName=i;let{topics:r}=Gu();return r.includes(No)&&tn({topic:No,payload:{tournamentId:t.tournamentId,participants:[n]}}),{...ue}}function CX({personFormat:t,person:e}){let i=m=>m.replace(/\W/g,""),n=m=>/^[a-z]*$/.test(i(m)),r=m=>/^[A-Z]*$/.test(i(m)),a=m=>/^[LAST]{4}/.test(i(m)),o=m=>m.toLowerCase().indexOf("l")<m.toLowerCase().indexOf("f"),s=m=>m.indexOf(",")>=0,l=m=>m.toLowerCase().indexOf("f.")>=0,c=m=>m.toLowerCase().indexOf("f")<0,u=m=>m.indexOf(" ")>0;if(!e)return;let d=u(t)?" ":"",p=hj((e==null?void 0:e.standardGivenName)??""),h=hj((e==null?void 0:e.standardFamilyName)??"");if(!t)return`${p}${d}${h}`;l(t)&&!s(t)&&!o(t)&&(p=`${p[0]}.`),n(t)?(p=p.toLowerCase(),h=h.toLowerCase()):r(t)?(p=p.toUpperCase(),h=h.toUpperCase()):a(t)&&(h=h.toUpperCase());let f=`${p}${d}${h}`;return c(t)?f=h:o(t)&&(s(t)?f=`${h},${d}${p}`:f=`${h}${d}${p}`),f}function q6e({participantMap:t,participant:e,formats:i}){let{participantType:n,individualParticipantIds:r,person:a}=e,o=n&&i[n];if(n!==_c&&o){let{personFormat:s,doublesJoiner:l}=o;n===Ki&&(e.participantName=CX({person:a,personFormat:s})),n===Ui&&(e.participantName=r==null?void 0:r.map(c=>{var u;let d=(u=t[c])==null?void 0:u.person;return CX({person:d,personFormat:s})}).filter(Boolean).join(l??"/"))}}function J0e({tournamentRecord:t,formats:e}){if(!t)return{error:it};if(!sr(e))return{error:Ht};let i=t.participants??[],n=yfe(i,"participantId");for(let r of i)q6e({participant:r,participantMap:n,formats:e});return{...ue}}function Q0e(t){let{tournamentRecord:e,policyDefinitions:i,contextProfile:n,participantId:r,personId:a}=t,o=t.tournamentRecords||e&&{[e.tournamentId]:e}||{};if(typeof r!="string"&&typeof a!="string")return{error:Ht,stack:"publicFindParticipant"};let s,l;for(let c of Object.values(o)){l=c.tournamentId;let u=c.participants||[];if(s=ag({tournamentParticipants:u,internalUse:!0,policyDefinitions:i,contextProfile:n,participantId:r,personId:a}),s)break}return{participant:s,tournamentId:l,...ue}}function eSe({individualParticipantIds:t=[],participantRoleResponsibilities:e,participantRole:i=Rve,tournamentRecord:n,participantId:r,groupName:a}){if(!n)return{error:it};if(!a)return{error:Ht,info:"Missing groupName"};if(!Array.isArray(t))return{info:"Invalid individualParticipantIds",error:Me};let o=(Yr({participantFilters:{participantTypes:[Ki]},tournamentRecord:n}).participants??[]).map(u=>u.participantId);for(let u of t)if(!o.includes(u))return{error:Sd,participantId:u};let s=qt({participantId:r||xn(),participantRoleResponsibilities:e,participantName:a,individualParticipantIds:t,participantType:cc,participantRole:i}),l=Up({participant:s,tournamentRecord:n});if(l.error)return l;let{topics:c}=Gu();return c.includes(sg)&&tn({topic:sg,payload:{tournamentId:n.tournamentId,participants:[s]}}),{...ue,participant:$t(s)}}function tSe({tournamentRecord:t,participantName:e,participantId:i}){if(!t)return{error:it};if(!i)return{error:Ra};if(!e)return{error:Ht,info:"Missing participantName"};let{participant:n}=jy({tournamentRecord:t,participantId:i});if(!n)return{error:Jr};n.participantName=e;let{topics:r}=Gu();return r.includes(No)&&tn({topic:No,payload:{tournamentId:t.tournamentId,participants:[n]}}),{...ue}}function iSe({clearExistingAssignments:t=!0,individualParticipantIds:e,reverseAssignmentOrder:i,initialTeamIndex:n=0,scaledParticipants:r=[],teamParticipantIds:a,tournamentRecord:o,scaleAttributes:s,teamNameBase:l,teamsCount:c,eventId:u,event:d}){var p,h,f,m,g;if(!o)return{error:it};if(!Array.isArray(a)&&!bi(c)&&!u||!bi(n)||r&&!Array.isArray(r)||s&&(typeof s!="object"||!Object.keys(s).length))return{error:Me};if(!s&&!r.length||!r&&!(e&&s))return{error:Ht,info:"Missing scaling details"};if(u&&!a){if((d==null?void 0:d.eventType)!==Hc)return{error:ng};a=(p=d==null?void 0:d.entries)==null?void 0:p.filter(({entryStatus:w})=>w===tc).map(Wi)}if(!(a!=null&&a.length)&&!c)return{info:"Missing teamParticipantIds or teamsCount",error:Ht};let v=e??r.map(({participantId:w})=>w);i&&(a==null||a.reverse(),n+=1),n>((a==null?void 0:a.length)||0)-1&&(n=0);let y=(a==null?void 0:a.slice(n).concat(...a.slice(0,n)))??[],b=[];for(let w of o.participants??[]){let{participantId:S,participantType:D}=w;if(y.includes(S)){if(D!==_c)return{error:Sd,participant:w};b.push(w)}}if(c&&b.length<c){let w=c-((b==null?void 0:b.length)||0),S=l??"Team",D=Ct(0,w).map(R=>({participantName:`${S} ${R+1}`,participantType:_c,participantRole:jo})),{participants:E=[]}=Dd({participants:D,returnParticipants:!0,tournamentRecord:o}),C=E.map(Wi),P=((h=o.participants)==null?void 0:h.filter(({participantId:R})=>C.includes(R)))??[];b.push(...P)}if(!b.length)return{error:u5};if(t)for(let w of b)w.individualParticipantIds=[];else{let w=b.map(S=>S).flat();e!=null&&e.length?v=v.filter(S=>!w.includes(S)):r=r==null?void 0:r.filter(({participantId:S})=>!w.includes(S))}if(!(e!=null&&e.length)&&!(r!=null&&r.length))return{error:nL,info:"Nothing to be done"};if(!r.length){for(let w of o.participants??[]){let{participantId:S,participantType:D}=w;if(!v.includes(S))continue;if(D!==Ki)return{error:Sd,participant:w};let E=(f=sh({scaleAttributes:s,participant:w}))==null?void 0:f.scaleItem,C=s!=null&&s.accessor?(m=E==null?void 0:E.scaleValue)==null?void 0:m[s==null?void 0:s.accessor]:E==null?void 0:E.scaleValue,P={participantId:S,scaleValue:C};r.push(P)}if(!r.length)return{error:Jr}}r.sort((w,S)=>s!=null&&s.sortOrder?((S==null?void 0:S.scaleValue)||0)-((w==null?void 0:w.scaleValue)||0):((w==null?void 0:w.scaleValue)||1/0)-((S==null?void 0:S.scaleValue)||1/0));for(let w of r)if(!w.participantId)return{error:Me,scaledParticipant:w};let I=0;for(;I<r.length;){for(let w of b){if(I+1>r.length)break;let S=r[I];w.individualParticipantIds.push(S.participantId),I++}b.reverse()}let T=b.map(Wi);for(let w of o.events??[]){if(w.eventType!==Hc)continue;let S=(w.entries??[]).filter(D=>T.includes(D.participantId));for(let D of S){let E=D.participantId,C=(g=b.find(R=>R.participantId===E))==null?void 0:g.individualParticipantIds;w.entries=(w.entries??[]).filter(R=>!C.includes(R.participantId)),(w.drawDefinitions??[]).forEach(R=>{R.entries=(R.entries??[]).filter(N=>!C.includes(N.participantId))});let{flightProfile:P}=Xr({event:w});((P==null?void 0:P.flights)||[]).forEach(R=>{R.drawEntries=(R.drawEntries||[]).filter(N=>!C.includes(N.participantId))})}}return{...ue,scaledParticipants:r}}function nSe(t){let{tournamentRecords:e}=t;if(typeof e!="object"||!Object.keys(e).length)return{error:_r};for(let i of Object.values(e)){let n=W6e({...t,tournamentRecord:i});if(n.error&&n.error!==NS)return n}return{...ue}}function W6e({tournamentRecord:t,penaltyId:e}){if(!t)return{error:it};if(!e)return{error:a5};let i=(t==null?void 0:t.participants)??[],n=[],r=!1,a;return i.forEach(o=>{let s=!1;o.penalties=(o.penalties??[]).filter(l=>(l.penaltyId===e&&(s=!0,r||(a=l,r=!0)),s&&n.push(o),l.penaltyId!==e))}),a&&tn({topic:No,payload:{tournamentId:t.tournamentId,participants:n}}),a?{...ue,penalty:a}:{error:NS}}var K6e=({penaltyId:t=xn()}={})=>({refereeParticipantId:void 0,penaltyCode:void 0,penaltyType:void 0,extensions:void 0,matchUpId:void 0,createdAt:void 0,issuedAt:void 0,notes:void 0,penaltyId:t}),rSe=K6e;function aSe(t){let{tournamentRecords:e}=t;if(typeof e!="object"||!Object.keys(e).length)return{error:_r};for(let i of Object.values(e)){let n=Y6e({...t,tournamentRecord:i});if(n.error&&n.error!==NS||n.success)return n}return{error:NS}}function Y6e({tournamentRecord:t,modifications:e,penaltyId:i}){if(!t)return{error:it};if(!e)return{error:Me,modifications:e};if(!i)return{error:a5};let n=(t==null?void 0:t.participants)??[],r=Object.keys(rSe()).filter(l=>l!=="penaltyId"),a=Object.keys(e).filter(l=>r.includes(l));if(!a.length)return{error:rL};let o,s=[];return n.forEach(l=>{let c=!1;l.penalties=(l.penalties??[]).map(u=>(u.penaltyId===i&&(c=!0,a.forEach(d=>Object.assign(u,{[d]:e[d]})),o||(o=u)),u)),c&&s.push(l)}),o&&tn({topic:No,payload:{tournamentId:t.tournamentId,participants:s}}),o?{...ue,penalty:o}:{error:NS}}function oSe(t,e,i){return!t&&e?e:t&&!e||typeof t!="object"||typeof e!="object"?t:ki(Object.keys(t).concat(Object.keys(e))).reduce((n,r)=>{if(!e[r])n[r]=t[r];else if(!t[r])n[r]=e[r];else if(typeof t[r]!=typeof e[r])n[r]=e[r];else if(Array.isArray(t[r]))if(i===!0||Array.isArray(i)&&i.includes(r)){let a=ki(t[r].map(o=>JSON.stringify(o)).concat(e[r].map(o=>JSON.stringify(o)))).map(o=>JSON.parse(o));n[r]=a}else n[r]=e[r];else typeof t[r]=="object"?n[r]=oSe(t[r],e[r],i):n[r]=e[r];return n},{})}function sSe({participants:t=[],tournamentRecord:e,arraysToMerge:i}){if(!e)return{error:it};e.participants||(e.participants=[]);let n=t.filter(Ol(wh)).map(c=>({[c.participantId]:c})),r=Object.assign({},...n),a=[];e.participants=e.participants.map(c=>{if(r[c.participantId]){let u=oSe(c,r[c.participantId],i);return a.push(u),u}return c});let o=e.participants.map(Ol(wh))||[],s=t.filter(({participantId:c})=>!o.includes(c)),{topics:l}=Gu();return s.length&&(e.participants=e.participants.concat(...s),l.includes(sg)&&tn({topic:sg,payload:{participants:s}})),a.length&&l.includes(No)&&tn({topic:No,payload:{tournamentId:e.tournamentId,participants:a}}),{modifiedParticipantsCount:a.length,newParticipantsCount:s.length,...ue}}function lSe(t){var e;let{tournamentRecord:i,participantIds:n}=t,r=t.tournamentRecords??(i&&{[i.tournamentId]:i})??{},a;for(let o of Object.values(r)){let s=(e=Yr({tournamentRecord:o}).participants??[])==null?void 0:e.map(Wi).filter(l=>n.includes(l));s.length&&(a=Z6e({...t,penaltyId:t.penaltyId??a,tournamentRecord:o,participantIds:s}).penaltyId)}return a?{...ue,penaltyId:a}:{error:Jr}}function Z6e({refereeParticipantId:t,tournamentRecord:e,participantIds:i,penaltyCode:n,penaltyType:r,extensions:a,penaltyId:o,matchUpId:s,issuedAt:l,notes:c}){if(!e)return{error:it};if(!i)return{error:Ra};if(!r)return{error:ame};let u=((e==null?void 0:e.participants)??[]).filter(h=>i.includes(h.participantId));if(!u.length)return{error:Jr};let d=new Date().toISOString(),p=Object.assign(rSe({penaltyId:o}),{refereeParticipantId:t,penaltyCode:n,penaltyType:r,matchUpId:s,createdAt:d,issuedAt:l,notes:c});return Array.isArray(a)&&a.forEach(h=>un({element:p,extension:h})),u.forEach(h=>{h.penalties||(h.penalties=[]),h.penalties.push(p)}),tn({topic:No,payload:{tournamentId:e.tournamentId,participants:u}}),{...ue,penaltyId:p.penaltyId}}function cSe({participantRole:t=jo,tournamentRecord:e,persons:i}){var n;if(!e)return{error:it};if(!Array.isArray(i))return{error:Me};if(!Object.keys(R6).includes(t))return{error:Kfe};let r=(e.participants||[]).map(({person:m})=>m==null?void 0:m.personId).filter(Boolean),a=[],o=i.filter(m=>m&&(!m.personId||!r.includes(m.personId))).map(m=>(m.personId||(m.personId=xn()),a.push(m.personId),m)),s=(m,g)=>Object.assign({},...Object.keys(m).filter(v=>!g.includes(v)).map(v=>({[v]:m[v]}))),l=o.map(m=>qt({extensions:m.participantExtensions,timeItems:m.participantTimeItems,participantType:Ki,participantRole:t,person:s(m,["participantExtensions","participantTimeItems","pairedPersons"])})),c=0,u=0,d=Dd({participants:l,tournamentRecord:e});if(d.error)return d;u=d.addedCount||0;let p=[],h=((n=Yr({participantFilters:{participantTypes:[Ki]},tournamentRecord:e}))==null?void 0:n.participants)??[];if(t===jo&&i.filter(({pairedPersons:m})=>m).forEach(({personId:m,pairedPersons:g})=>{Array.isArray(g)&&g.forEach(v=>{let y=[m,v.personId].map(b=>ag({tournamentParticipants:h,personId:b})).filter(Boolean);if(y.length===2){let b=y.map(Wi);p.push(qt({extensions:v.participantExtensions,timeItems:v.timeItems,participantRole:jo,individualParticipantIds:b,participantType:Ui}))}})}),p.length){if(d=Dd({participants:p,tournamentRecord:e}),d.error)return d;c=d.addedCount||0}let f=u+c;return{...ue,addedCount:f,newPersonIds:a}}var uSe={};zi(uSe,{bulkUpdatePublishedEventIds:()=>V8,getAllEventData:()=>j8,getCourtInfo:()=>PL,getDrawData:()=>lF,getEventData:()=>cF,getEventPublishStatus:()=>Xc,getPublishState:()=>mw,getVenueData:()=>GS,mutate:()=>dSe,publishEvent:()=>MU,publishEventSeeding:()=>pSe,publishOrderOfPlay:()=>mSe,query:()=>ewe,setEventDisplay:()=>SF,unPublishEvent:()=>gSe,unPublishEventSeeding:()=>hSe,unPublishOrderOfPlay:()=>fSe});var dSe={};zi(dSe,{publishEvent:()=>MU,publishEventSeeding:()=>pSe,publishOrderOfPlay:()=>mSe,setEventDisplay:()=>SF,unPublishEvent:()=>gSe,unPublishEventSeeding:()=>hSe,unPublishOrderOfPlay:()=>fSe});function pSe({removePriorValues:t=!0,stageSeedingScaleNames:e,seedingScaleNames:i,tournamentRecord:n,status:r=Wu,drawIds:a=[],event:o}){var s,l,c,u;if(!n)return{error:it};if(!o)return{error:_n};let d=Xc({event:o,status:r}),p=(((s=d==null?void 0:d.seeding)==null?void 0:s.seedingScaleNames)||i)&&{...(l=d==null?void 0:d.seeding)==null?void 0:l.seedingScaleNames,...i},h=(((c=d==null?void 0:d.seeding)==null?void 0:c.stageSeedingScaleNames)||e)&&{...(u=d==null?void 0:d.seeding)==null?void 0:u.stageSeedingScaleNames,...e},f=qt({stageSeedingScaleNames:h,seedingScaleNames:p,published:!0,drawIds:a});return RU({statusObject:{seeding:f},removePriorValues:t,status:r,event:o}),tn({topic:Nge,payload:{tournamentId:n.tournamentId,eventId:o.eventId,drawIds:a}}),{...ue}}function hSe({removePriorValues:t=!0,seedingScaleNames:e,tournamentRecord:i,status:n=Wu,drawIds:r,stages:a,event:o}){var s,l;if(!i)return{error:it};if(!o)return{error:_n};let c=Xc({event:o});if(c){let u=c.seeding;if(Array.isArray(a)&&u.stageSeedingScaleNames)for(let d of a)u.stageSeedingScaleNames[d]&&delete u.stageSeedingScaleNames[d];Array.isArray(e)&&u!=null&&u.seedingScaleNames&&(u.seedingScaleNames=u.seedingScaleNames.filter(d=>!e.includes(d))),Array.isArray(r)&&u!=null&&u.drawIds&&(u.drawIds=u.drawIds.filter(d=>!r.includes(d))),(!Object.values(u.stageSeedingScaleNames??{}).length&&!((s=u.seedingScaleNames)!=null&&s.length)&&!((l=u.drawIds)!=null&&l.length)||!a&&!e&&!(r!=null&&r.length))&&(delete u.stageSeedingScaleNames,delete u.seedingScaleNames,delete u.drawIds,u.published=!1),RU({statusObject:{seeding:u},removePriorValues:t,status:n,event:o})}return tn({topic:a6,payload:{tournamentId:i.tournamentId,eventId:o.eventId}}),{...ue}}function fSe(t){let e=(t==null?void 0:t.tournamentRecords)??((t==null?void 0:t.tournamentRecord)&&{[t.tournamentRecord.tournamentId]:t.tournamentRecord})??{};if(!Object.keys(e).length)return{error:_r};for(let i of Object.values(e)){let n=X6e({tournamentRecord:i,...t});if(n.error)return n}return{...ue}}function X6e({removePriorValues:t=!0,tournamentRecord:e,status:i=Wu}){if(!e)return{error:it};let n=`${By}.${$y}`,{timeItem:r}=kp({element:e,itemType:n}),a=(r==null?void 0:r.itemValue)||{[i]:{}};return a[i]&&delete a[i].orderOfPlay,Vg({timeItem:{itemValue:a,itemType:n},element:e,removePriorValues:t}),tn({topic:o6,payload:{tournamentId:e.tournamentId}}),{...ue}}function mSe(t){let e=_p(t);if(!Object.keys(e).length)return{error:_r};for(let i of Object.values(e)){let n=J6e({tournamentRecord:i,...t});if(n.error)return n}return{...ue}}function J6e({scheduledDates:t=[],removePriorValues:e,tournamentRecord:i,status:n=Wu,eventIds:r=[]}){if(!i)return{error:it};let a=`${By}.${$y}`,{timeItem:o}=kp({element:i,itemType:a}),s=(o==null?void 0:o.itemValue)||{[n]:{}};return s[n].orderOfPlay={published:!0,scheduledDates:t,eventIds:r},Vg({timeItem:{itemValue:s,itemType:a},element:i,removePriorValues:e}),tn({topic:Age,payload:{tournamentId:i.tournamentId,scheduledDates:t,eventIds:r}}),{...ue}}function gSe({removePriorValues:t=!0,tournamentRecord:e,status:i=Wu,event:n}){if(!e)return{error:it};if(!n)return{error:_n};let r=`${By}.${$y}`,{timeItem:a}=uR({itemType:r,event:n}),o=(a==null?void 0:a.itemValue)||{[i]:{}};return delete o[i].structureIds,delete o[i].drawDetails,delete o[i].drawIds,Iw({event:n,timeItem:{itemValue:o,itemType:r},removePriorValues:t}),RU({statusObject:{structureIds:void 0,drawIds:void 0,seeding:void 0},removePriorValues:t,status:i,event:n}),tn({topic:r6,payload:{tournamentId:e.tournamentId,eventId:n.eventId}}),{eventId:n.eventId,...ue}}var vSe={};zi(vSe,{getEntryStatusReports:()=>e8e,getParticipantStats:()=>Q6e,getStructureReports:()=>i8e,getVenuesReport:()=>r8e});function Q6e({withCompetitiveProfiles:t,opponentParticipantId:e,withIndividualStats:i,teamParticipantId:n,tournamentRecord:r,withScaleValues:a,tallyPolicy:o,matchUps:s}){var l,c,u,d,p;if(!r)return{error:it};if(s&&!Array.isArray(s))return{error:Ws};if(s=s??co({tournamentRecord:r,participantsProfile:a?{withScaleValues:a}:void 0}).matchUps,!(s!=null&&s.length))return{error:Oh};let h=[];e&&h.push(e),n&&h.push(n);let f=h.length?{participantIds:h}:{participantTypes:[_c]},m=Yr({participantFilters:f,tournamentRecord:r}).participants??[];if(!m.every(({participantType:R})=>R===_c))return{error:wu};h.length||h.push(...m.map(Wi));let g=new Map,v=new Map,y=new Map,b=new Map,I=(R,N="")=>v.get(R)||v.set(R,{participantName:N,participantId:R,competitorIds:[],competitiveness:{},matchUpStatuses:{},tiebreaks:[0,0],matchUps:[0,0],points:[0,0],games:[0,0],sets:[0,0]})&&v.get(R);for(let R of m){let{participantId:N,individualParticipantIds:M}=R;b.set(N,M??[]),I(N,R.participantName)}if(n&&!b.get(n))return fe({result:{error:Jr},context:{teamParticipantId:n}});if(e&&!b.get(e))return fe({result:{error:Jr},context:{opponentParticipantId:e}});let T=[],w=R=>{let N=[[],[]];for(let A of R){let _=A.participant;if(_!=null&&_.participantName){g.set(_.participantId,{participantName:_.participantName,ratings:_.ratings});let x=v.get(_.participantId);x&&(x.participantName=_.participantName)}}let M=({side:A,individualParticipantIds:_})=>{var x,O,B,F,G;return A.participantId&&(!(_!=null&&_.length)||_.includes(A.participantId))&&[A.participantId]||((O=(x=A.participant)==null?void 0:x.individualParticipantIds)==null?void 0:O.length)&&(!(_!=null&&_.length)||Wr(_,(B=A.participant)==null?void 0:B.individualParticipantIds).length===((G=(F=A.participant)==null?void 0:F.individualParticipantIds)==null?void 0:G.length))&&A.participant.individualParticipantIds};if(b.size){let A=(_,x)=>{for(let O of R){if(!O.participant)continue;let B=M({individualParticipantIds:x,side:O});if(B!=null&&B.length){let F=O.sideNumber;if(!F)continue;let G=[_];i&&G.push(...B),N[F-1]=G;let H=v.get(_);for(let $ of B.filter(Boolean))H&&!H.competitorIds.includes($)&&H.competitorIds.push($)}}};if(n)(!e||R.every(_=>_.participant&&(M({individualParticipantIds:b.get(n),side:_})||M({individualParticipantIds:b.get(e),side:_}))))&&A(n,b.get(n));else for(let[_,x]of b)A(_,x)}else if(i)for(let A of R){if(!A.participant)continue;let _=M({individualParticipantIds:[],side:A}),x=A.sideNumber;x&&(N[x-1]=_)}return N};for(let R of s){if(!sr(R))return{error:Ws};let{matchUpStatus:N,matchUpFormat:M,matchUpType:A,winningSide:_,score:x,sides:O}=R;if(!O||!x||A===Ip||N===yn)continue;let B=w(O);if(!B.filter(Boolean).length)continue;let F=t&&_&&((l=aR({matchUp:R}))==null?void 0:l.competitiveness);T.push(R);let G=Y6({matchUpStatus:N,matchUpFormat:M,tallyPolicy:o,winningSide:_,score:x}),H=bye({matchUpStatus:N,matchUpFormat:M,tallyPolicy:o,winningSide:_,score:x}),{pointsTally:$,tiebreaksTally:q}=Iye({matchUpFormat:M,score:x});B.forEach((z,Z)=>{var Y;for(let Q of z){let X=(Y=g.get(Q))==null?void 0:Y.participantName,oe=I(Q,X);if(oe){let re=(ae,de)=>de.forEach((Ie,De)=>oe[ae][De]+=Ie),me=Z?[...q].reverse():q,se=Z?[...$].reverse():$,te=Z?[...H].reverse():H,he=Z?[...G].reverse():G;if(re("tiebreaks",me),re("points",se),re("games",te),re("sets",he),_){let ae=_-1===Z?0:1;oe.matchUps[ae]+=1}if(F){let ae=F.toLowerCase();oe.competitiveness[ae]||(oe.competitiveness[ae]=[0,0]),oe.competitiveness[ae][Z]+=1}if(N){let ae=N.toLowerCase();oe.matchUpStatuses[ae]||(oe.matchUpStatuses[ae]=0),oe.matchUpStatuses[ae]+=1}}}})}let S=["tiebreaks","matchUps","points","games","sets"],D=["competitive","routine","decisive"],E=new Map,C=(R,N)=>(R??0)+(N??0);for(let[R,N]of v.entries()){for(let M of S){let A=N[M].reduce(C);if(A){let _=N[M][0]/A,x=`${M}Ratio`,O=parseFloat(_.toFixed(2));N[x]=O,y.set(R,!0),E.has(x)||E.set(x,[]),(c=E.get(x))==null||c.push(O)}}for(let M of D){let A=(d=(u=N.competitiveness)==null?void 0:u[M])==null?void 0:d.reduce(C);if(A){let _=N.competitiveness[M][0]/A,x=`${M}Ratio`,O=parseFloat(_.toFixed(2));N[x]=O}}}if(!n){let R=(N,M)=>M-N;for(let N of v.values())for(let M of S){let A=`${M}Ratio`;if(typeof N[A]=="number"){let _=(p=E.get(A))==null?void 0:p.sort(R).indexOf(N[A]);if(typeof _=="number"&&_>=0){let x=`${M}Rank`;N[x]=_+1}}}}let P={relevantMatchUps:T,...ue};return n?(P.teamStats=v.get(n),e&&(P.opponentStats=v.get(e))):P.participatingTeamsCount=y.size,P.allParticipantStats=[...v.values()],P}function W_({participant:t,eventType:e}){var i,n,r,a,o,s;let l=(i=t==null?void 0:t.person)==null?void 0:i.personId,c=(r=(n=t==null?void 0:t.person)==null?void 0:n.personOtherIds)==null?void 0:r[0],u=(a=t==null?void 0:t.person)==null?void 0:a.tennisId,d=(s=(o=t==null?void 0:t.ratings)==null?void 0:o[e])==null?void 0:s.find(({scaleName:m})=>m===v8),p=d==null?void 0:d.scaleValue,{wtnRating:h,confidence:f}=p||{};return{timeStamp:d==null?void 0:d.scaleDate,personOtherId:c,confidence:f,wtnRating:h,personId:l,tennisId:u}}function e8e({tournamentRecord:t}){if(!t)return{error:it};let e=t.tournamentId,{participantMap:i}=Yr({withScaleValues:!0,withEvents:!0,withSeeding:!0,tournamentRecord:t,withDraws:!0}),n=(co({matchUpFilters:{matchUpTypes:[xb,ny]},tournamentRecord:t}).matchUps??[]).flatMap(({sides:h,matchUpType:f})=>h==null?void 0:h.flatMap(m=>{var g,v;return f===ny?(g=m==null?void 0:m.participant)==null?void 0:g.individualParticipantIds:((v=m==null?void 0:m.participant)==null?void 0:v.participantId)||m.participantId}).filter(Boolean)).filter(Boolean),r=[],a={},o={},s={},l=0,c=({id:h,entry:f,eventId:m,eventType:g})=>{var v;let{qualifyingSeeding:y,mainSeeding:b,entryStatus:I,entryStage:T,drawId:w}=f;a[h]||(a[h]=[]);let{participant:S,events:D}=(i==null?void 0:i[h])??{},E=W_({participant:S,eventType:g}),C=(v=D==null?void 0:D[m])==null?void 0:v.ranking;I===c8&&r.push(h),a[h].push({participantType:S==null?void 0:S.participantType,participantId:h,tournamentId:e,eventType:g,eventId:m,drawId:w,entryStatus:I,entryStage:T,...E,ranking:C,mainSeeding:b,qualifyingSeeding:y})};for(let h of t.events??[]){let f={},m=S=>{f[S]||(f[S]={count:0}),f[S].count+=1},{drawDefinitions:g=[],eventType:v,eventId:y}=h,b=g.flatMap(S=>{let{drawId:D,entries:E}=S;l+=1;let C=({stage:M,stageSequence:A})=>M===Ft&&A===1||M===Xt,P=(S.structures??[]).filter(C).flatMap(({positionAssignments:M})=>M).filter(Boolean).map(({participantId:M})=>M),R=({participantId:M})=>P.includes(M),N=M=>{var A,_,x,O,B,F,G,H;let{participantId:$,entryStatus:q,entryStage:z}=M;m(q);let Z=(O=(x=(_=(A=i==null?void 0:i[$])==null?void 0:A.draws)==null?void 0:_[D])==null?void 0:x.seedAssignments)==null?void 0:O[Ft];return{qualifyingSeeding:(H=(G=(F=(B=i==null?void 0:i[$])==null?void 0:B.draws)==null?void 0:F[D])==null?void 0:G.seedAssignments)==null?void 0:H[Xt],participantId:$,mainSeeding:Z,entryStatus:q,entryStage:z,drawId:D}};return E==null?void 0:E.filter(R).map(N)}),I=S=>{var D;let E=S.participantId,C=(D=i==null?void 0:i[E].participant.individualParticipantIds)==null?void 0:D.filter(P=>n.includes(P));return E&&{[E]:{individualParticipantIds:C}}};v===ug?(()=>{let S=Object.assign({},...b.map(I).filter(Boolean)),D=E=>{S[E.participantId].individualParticipantIds.forEach(C=>{c({id:C,eventType:v,eventId:y,entry:E})})};b.forEach(D)})():b.forEach(S=>{c({id:S==null?void 0:S.participantId,eventType:v,eventId:y,entry:S})});let T=Object.values(f).reduce((S,D)=>S+D.count,0);Object.keys(f).forEach(S=>{f[S].pct=f[S].count/T*100}),s[y]={tournamentId:e,eventId:y,entries:b,entryStatuses:f};let w=Object.assign({},...qu.flatMap(S=>{var D,E;return[{[S+"_count"]:(D=f[S])==null?void 0:D.count},{[S+"_pct"]:(E=f[S])==null?void 0:E.pct}]}));o[y]={tournamentId:e,eventId:y,...w}}let u=Object.values(i??{}).filter(({participant:{participantType:h,participantRole:f}})=>h===Ki&&f===jo),d=u.filter(({participant:h})=>!n.includes(h.participantId)).map(({participant:h})=>h.participantId),p={nonParticipatingEntriesCount:d.length,individualParticipantsCount:u.length,eventsCount:Object.values(s).length,nonParticipatingParticipantIds:d,drawDefinitionsCount:l,tournamentId:e};return{entryStatusReports:Object.values(o).flat(),participantEntryReports:Object.values(a).flat(),eventReports:Object.values(s).flat(),withDrawnParticipantIds:r,tournamentEntryReport:p}}function t8e({eventType:t,matchUps:e,eventId:i,drawId:n}){let r={},a=f=>{let m=f==null?void 0:f.matchUpFormat;m&&(r[m]||(r[m]=0),r[m]+=1)},o=e.filter(f=>i?f.eventId===i:f.drawId===n).reduce((f,m)=>(a(m),(m.sides??[]).flatMap(g=>{var v;return(((v=g==null?void 0:g.participant)==null?void 0:v.individualParticipants)||[g==null?void 0:g.participant]).filter(Boolean)}).forEach(g=>f[g.participantId]=g),f),{}),s=Object.values(o),l=s.map(f=>W_({participant:f,eventType:t})).filter(({wtnRating:f})=>f),c=(s.length-l.length)/s.length*100,u=l.reduce((f,m)=>{let{wtnRating:g,confidence:v}=m;return f.totalWTN+=g,f.totalConfidence+=v,f},{totalWTN:0,totalConfidence:0}),d=l!=null&&l.length?u.totalWTN/l.length:0,p=l!=null&&l.length?u.totalConfidence/l.length:0,h=Object.values(r).reduce((f,m)=>f+(m||0),0);return{matchUpFormatCounts:r,matchUpsCount:h,avgConfidence:p,pctNoRating:c,avgWTN:d}}function i8e({firstFlightOnly:t=!0,extensionProfiles:e,tournamentRecord:i}){var n;if(!i)return{error:CS};let r={},a=Object.assign({},...(e??[]).map(({name:u,label:d,accessor:p})=>{var h,f,m;let g=(f=(h=Bi({element:i,name:u}))==null?void 0:h.extension)==null?void 0:f.value,v=p?(m=Ob({element:g,accessor:p}))==null?void 0:m.value:g;return{[d||u]:v}})),o=i==null?void 0:i.tournamentId,s=co({participantsProfile:{withScaleValues:!0},tournamentRecord:i}).matchUps??[],l=u=>{var d,p,h;return(h=(p=(d=kp({itemType:K5,itemSubTypes:[ah],element:{timeItems:u}}))==null?void 0:d.timeItem)==null?void 0:p.itemValue)==null?void 0:h.scaleBasis},c=(n=i==null?void 0:i.events)==null?void 0:n.flatMap(({timeItems:u,drawDefinitions:d=[],extensions:p,eventType:h,eventId:f,category:m})=>{var g,v,y,b,I;let T=(y=(v=(g=p==null?void 0:p.find(P=>P.name===Au))==null?void 0:g.value)==null?void 0:v.flights)==null?void 0:y.map(P=>({[P.drawId]:P.flightNumber})),w=T&&Object.assign({},...T),S=((I=(b=p==null?void 0:p.find(P=>P.name===T_))==null?void 0:b.value)==null?void 0:I.length)||0,D=Object.values(w),E=w&&Math.min(...D),C=l(u);return r[f]={totalPositionManipulations:0,maxPositionManipulations:0,generatedDrawsCount:0,drawDeletionsCount:S,seedingBasis:C?JSON.stringify(C):void 0,tournamentId:o,eventId:f},d.filter(P=>!t||!T||w[P.drawId]===E).flatMap(P=>{let{matchUpFormat:R,tieFormat:N,timeItems:M,extensions:A,structures:_,drawType:x,drawId:O}=P,{matchUpFormatCounts:B,matchUpsCount:F,avgConfidence:G,pctNoRating:H,avgWTN:$}=t8e({eventType:h,matchUps:s,drawId:O}),q=l(M)||C,z=n8e({extensions:A}),Z=(z==null?void 0:z.length)||0;return r[f].totalPositionManipulations+=Z,r[f].generatedDrawsCount+=1,Z>r[f].maxPositionManipulations&&(r[f].maxPositionManipulations=Z),_==null?void 0:_.filter(Y=>Y.stageSequence===1&&[Xt,Ft,Mo,Br].includes(Y.stage)).map(Y=>{var Q,X,oe;let re=[Ft,Br].includes(Y.stage)?s.find(Se=>Se.structureId===Y.structureId&&Se.finishingRound===1&&Se.winningSide):void 0,me=(X=(Q=re==null?void 0:re.sides)==null?void 0:Q.find(Se=>Se.sideNumber===re.winningSide))==null?void 0:X.participant,se=(me==null?void 0:me.participantType)===_c&&me.participantId,te=(me==null?void 0:me.participantType)===Ui?me.individualParticipants:[],he=W_({participant:(te==null?void 0:te[0])||me,eventType:h}),{personId:ae,personOtherId:de,tennisId:Ie,confidence:De,wtnRating:Te}=he||{},_e=W_({participant:te==null?void 0:te[1],eventType:h}),{personId:Ve,personOtherId:ot,tennisId:St,confidence:nt,wtnRating:Bt}=_e||{},{ageCategoryCode:Pe,categoryName:et,subType:Ee}=m??{},lt=Y.matchUpFormat||R,Ke=(B[lt]||0)/F*100,{tieFormatName:bt,tieFormatDesc:gt}=j_(N),{tieFormatName:Ue,tieFormatDesc:xe}=j_(Y.tieFormat),We=gt===xe,st=!We&&Ue,vt=Y.tieFormat&&!We&&xe,ge=((oe=z==null?void 0:z.filter(Se=>Se.structureId===Y.structureId))==null?void 0:oe.length)||0;return{...a,tournamentId:o,eventId:f,structureId:Y.structureId,drawId:O,eventType:h,category:Ee,categoryName:et,ageCategoryCode:Pe,flightNumber:w[O],drawType:x,stage:Y.stage,seedingBasis:q?JSON.stringify(q):void 0,winningPersonId:ae,winningPersonOtherId:de,winningPersonTennisId:Ie,winningPersonWTNrating:Te,winningPersonWTNconfidence:De,winningPerson2Id:Ve,winningPerson2OtherId:ot,winningPerson2TennisId:St,winningPerson2WTNrating:Bt,winningPerson2WTNconfidence:nt,winningTeamId:se,positionManipulations:ge,pctNoRating:H,matchUpFormat:lt,pctInitialMatchUpFormat:Ke,matchUpsCount:F,drawTieFormatName:bt,drawTieFormatDesc:gt,tieFormatName:st,tieFormatDesc:vt,avgConfidence:G,avgWTN:$}})})});return{eventStructureReports:Object.values(r),structureReports:c}}function n8e({extensions:t}){var e,i;return(i=(e=t==null?void 0:t.find(({name:n})=>n===S_))==null?void 0:e.value)==null?void 0:i.slice(1)}function r8e({ignoreDisabled:t=!0,tournamentRecords:e,tournamentId:i,venueIds:n=[],dates:r=[]}){var a,o;if(!Array.isArray(r))return{error:Me,dates:r};if(!Array.isArray(n))return{error:Me,venueIds:n};if(!(e&&Object.keys(e).filter(p=>!i||p===i)||[]).length)return{error:_r};if(!r.every(Kl))return{error:Cs};let s=fm({tournamentRecords:e,ignoreDisabled:t,dates:r});if(s.error)return s;let l=(a=s==null?void 0:s.venues)==null?void 0:a.filter(({venueId:p})=>!(n!=null&&n.length)||n.includes(p)),c=(o=s.courts)==null?void 0:o.reduce((p,h)=>{var f;return(f=h.dateAvailability)==null||f.forEach(m=>{let g=m.date;p.includes(g)||p.push(g)}),p},[]).filter(p=>!r.length||r.includes(p)),u={venueIds:l==null?void 0:l.map(({venueId:p})=>p)},{matchUps:d}=Ud({afterRecoveryTimes:!0,tournamentRecords:e,matchUpFilters:u});return{venuesReport:l==null?void 0:l.map(p=>a8e(c,p,d))}}function a8e(t,e,i){let{venueId:n,courts:r,venueName:a}=e,o={};return t.forEach(s=>{var l;let c=0,u=0,d=0;for(let f of r){let m=f.dateAvailability.find(v=>v.date===s),g=(l=m&&NU({courtDate:m}).timeSlots)==null?void 0:l.reduce((v,y)=>{let{startTime:b,endTime:I}=y,T=on(I)-on(b);return v+T},0);g&&(d+=1),c+=g}let p=i.filter(({schedule:f})=>f.venueId===n&&Uh(s,f.scheduledDate));p.forEach(({schedule:f})=>{let m=rr(f.scheduledTime),g=il(m,f.averageMinutes),v=on(g)-on(m);u+=v});let h=c?(u/c*100).toFixed(2):"100";o[s]={scheduledMatchUpsCount:p.length,availableCourts:d,availableMinutes:c,scheduledMinutes:u,percentUtilization:h}}),{venueId:n,venueName:a,venueReport:o}}var ySe={};zi(ySe,{addMatchUpCourtOrder:()=>S7,addMatchUpEndTime:()=>U7,addMatchUpOfficial:()=>n0e,addMatchUpResumeTime:()=>E7,addMatchUpScheduleItems:()=>MF,addMatchUpScheduledDate:()=>NF,addMatchUpScheduledTime:()=>Gg,addMatchUpStartTime:()=>T7,addMatchUpStopTime:()=>D7,addSchedulingProfileRound:()=>F7,allocateTeamMatchUpCourts:()=>RF,assignMatchUpCourt:()=>Uw,assignMatchUpVenue:()=>_U,bulkRescheduleMatchUps:()=>ESe,bulkScheduleMatchUps:()=>qR,bulkScheduleTournamentMatchUps:()=>NE,bulkUpdateCourtAssignments:()=>SSe,calculateScheduleTimes:()=>V7,clearMatchUpSchedule:()=>PSe,clearScheduledMatchUps:()=>_F,courtGridRows:()=>Y8,findMatchUpFormatTiming:()=>uF,findVenue:()=>um,generateBookings:()=>AF,generateVirtualCourts:()=>UF,getPersonRequests:()=>qy,getProfileRounds:()=>pF,getScheduledRoundsDetails:()=>xR,getSchedulingProfile:()=>mm,getSchedulingProfileIssues:()=>G8,matchUpScheduleChange:()=>CSe,modifyMatchUpFormatTiming:()=>l7,mutate:()=>bSe,proAutoSchedule:()=>wSe,proConflicts:()=>USe,publicFindCourt:()=>sve,query:()=>rwe,removeEventMatchUpFormatTiming:()=>IF,removeMatchUpCourtAssignment:()=>ISe,reorderUpcomingMatchUps:()=>DSe,scheduleMatchUps:()=>TSe,scheduleProfileRounds:()=>kF,setMatchUpDailyLimits:()=>RSe,setSchedulingProfile:()=>PU,toggleParticipantCheckInState:()=>EF,validateSchedulingProfile:()=>dF});var bSe={};zi(bSe,{addMatchUpCourtOrder:()=>S7,addMatchUpEndTime:()=>U7,addMatchUpOfficial:()=>n0e,addMatchUpResumeTime:()=>E7,addMatchUpScheduleItems:()=>MF,addMatchUpScheduledDate:()=>NF,addMatchUpScheduledTime:()=>Gg,addMatchUpStartTime:()=>T7,addMatchUpStopTime:()=>D7,addSchedulingProfileRound:()=>F7,allocateTeamMatchUpCourts:()=>RF,assignMatchUpCourt:()=>Uw,assignMatchUpVenue:()=>_U,bulkRescheduleMatchUps:()=>ESe,bulkScheduleMatchUps:()=>qR,bulkScheduleTournamentMatchUps:()=>NE,bulkUpdateCourtAssignments:()=>SSe,calculateScheduleTimes:()=>V7,clearMatchUpSchedule:()=>PSe,clearScheduledMatchUps:()=>_F,courtGridRows:()=>Y8,findMatchUpFormatTiming:()=>uF,findVenue:()=>um,generateBookings:()=>AF,generateVirtualCourts:()=>UF,matchUpScheduleChange:()=>CSe,modifyMatchUpFormatTiming:()=>l7,proAutoSchedule:()=>wSe,proConflicts:()=>USe,publicFindCourt:()=>sve,removeEventMatchUpFormatTiming:()=>IF,removeMatchUpCourtAssignment:()=>ISe,reorderUpcomingMatchUps:()=>DSe,scheduleMatchUps:()=>TSe,scheduleProfileRounds:()=>kF,setMatchUpDailyLimits:()=>RSe,setSchedulingProfile:()=>PU,toggleParticipantCheckInState:()=>EF,validateSchedulingProfile:()=>dF});function V7({calculateStartTimeFromCourts:t=!0,defaultRecoveryMinutes:e=0,averageMatchUpMinutes:i=90,remainingScheduleTimes:n,clearScheduleDates:r,tournamentRecords:a,periodLength:o,scheduleDate:s,startTime:l,venueIds:c,endTime:u}){if(typeof a!="object"||!Object.keys(a).length)return{error:_r};o=o??DF({recoveryMinutes:e,averageMatchUpMinutes:i});let{courts:d,venues:p}=fm({dates:[s],ignoreDisabled:!0,tournamentRecords:a}),h=d==null?void 0:d.filter(C=>!c||c.includes(C.venueId));l||(l=h==null?void 0:h.reduce((C,P)=>{var R,N;let M=((N=(R=P.dateAvailability)==null?void 0:R.find(A=>!A.date||Uh(s,A.date)))==null?void 0:N.startTime)??P.startTime;return M&&(!C||on(M)<on(C))?M:C},void 0)),u||(u=h==null?void 0:h.reduce((C,P)=>{var R,N;let M=((N=(R=P.dateAvailability)==null?void 0:R.find(A=>!A.date||Uh(s,A.date)))==null?void 0:N.endTime)??P.endTime;return M&&(!C||on(M)>on(C))?M:C},void 0));let f=Object.values(a),m=Object.assign({},...f.map(C=>(C.events??[]).map(P=>{let{scheduleTiming:R}=oR({tournamentRecord:C,event:P});return{[P.eventId]:{event:P,scheduleTiming:R}}})).flat()),g=FR({sortDateMatchUps:!1,tournamentRecords:a,matchUpFilters:{scheduledDate:s,venueIds:c}}),v=(g==null?void 0:g.dateMatchUps)??[],y=(g==null?void 0:g.completedMatchUps)??[],b=[];b.push(...v),b.push(...y);let I={averageTimes:[{minutes:{default:i}}],recoveryTimes:[{minutes:{default:e}}]},T=b==null?void 0:b.map(({eventId:C,schedule:P,matchUpFormat:R})=>{let{event:N,scheduleTiming:M}=m[C],A=N==null?void 0:N.eventType,_={...M,defaultTiming:I,matchUpFormat:R},{averageMinutes:x,recoveryMinutes:O}=CL({eventType:A,timingDetails:_}),{courtId:B,venueId:F}=P,G=rr(P.scheduledTime),H=il(G,x);return{recoveryMinutes:O,averageMinutes:x,periodLength:o,startTime:G,endTime:H,courtId:B,venueId:F}}),w={calculateStartTimeFromCourts:t,remainingScheduleTimes:n,averageMatchUpMinutes:i,date:s,clearScheduleDates:r,periodLength:o,startTime:l,endTime:u,bookings:T,courts:h},{scheduleTimes:S}=g7(w),D=(c==null?void 0:c.length)===1&&c[0]||(p==null?void 0:p.length)===1&&p[0].venueId||void 0,E=b.map(Va);return{venueId:D,scheduleTimes:S,dateScheduledMatchUpIds:E}}function ISe(t){var e;let i=mn(t,[{[Ko]:!0}]);if(i.error)return i;let{removePriorValues:n,tournamentRecords:r,tournamentId:a,courtDayDate:o,matchUpId:s,courtId:l,drawId:c}=t,u=r[a];if(!u)return{error:it};let{drawDefinition:d,event:p}=jg({tournamentRecord:u,drawId:c});if(!d)return{error:Lt};let h=ar({drawDefinition:d,event:p,matchUpId:s});if(h.error)return h;if(((e=h==null?void 0:h.matchUp)==null?void 0:e.matchUpType)===Ip){let{itemValue:f}=Vy({timeItems:h.matchUp.timeItems??[],itemType:jf}),m=l&&f.filter(g=>g.courtId!==l);return ic({duplicateValues:!1,removePriorValues:n,tournamentRecord:u,drawDefinition:d,matchUpId:s,timeItem:{itemType:jf,itemValue:m}})}else return Uw({tournamentRecord:u,drawDefinition:d,courtDayDate:o,courtId:"",matchUpId:s})}function wSe({scheduleCompletedMatchUps:t,tournamentRecords:e,scheduledDate:i,matchUps:n}){if(!Zc(n))return{error:Me};if(n.some(({hasContext:h})=>!h))return{info:"matchUps must have { inContext: true, nextMatchUps: true }",error:iL};let r=FR({courtCompletedMatchUps:!0,withCourtGridRows:!0,minCourtGridRows:10,tournamentRecords:e,matchUpFilters:{localPerspective:!0,scheduledDate:i}});if(r.error)return r;let{rows:a}=r,o=[],s=h=>[(h.sides||[]).map(f=>{var m;return[f.participantId,(m=f.participant)==null?void 0:m.individualParticipantIds]}),(h.potentialParticipants||[]).flat().map(f=>[f.participantId,f.individualParticipantIds])].flat(1/0).filter(Boolean),l=a==null?void 0:a.reduce((h,f)=>{let m=[],g=[];Object.values(f).forEach(y=>{if(sr(y)&&(y.matchUpId&&(m.push(y.matchUpId),o.push(y)),y.sides)){let b=s(y);g.push(...b)}});let v=Object.values(f).filter(y=>sr(y)&&!y.matchUpId);return h.concat({matchUpIds:m,availableCourts:v,rowId:f.rowId,participantIds:g})},[]);n.filter(({matchUpStatus:h})=>h&&h!==yn&&(t||!Ga.includes(h))).sort(fw);let c=Ku({matchUps:n.concat(o),includeParticipantDependencies:!0,tournamentRecords:e}).matchUpDependencies,u=[],d=[];for(;n.length&&l.length;){let h=l.shift(),f=[];for(;n.length&&h.availableCourts.length;){let m=n.concat(f).map(D=>D.matchUpId),g=n.shift(),v=g==null?void 0:g.matchUpId,y=v&&c[v].matchUpIds.concat(c[v].dependentMatchUpIds),b=v&&m.some(D=>c[v].matchUpIds.includes(D)),I=v&&d.some(D=>c[v].dependentMatchUpIds.includes(D)),T=h.matchUpIds.some(D=>y.includes(D)),w=s(g),S=h.participantIds.some(D=>w.includes(D));if(g&&!T&&!b&&!S&&!I){let D=h.availableCourts.shift();Object.assign(g.schedule,D.schedule),Object.assign(D,g),u.push(g),h.participantIds.push(...w),h.matchUpIds.push(v)}else g&&f.push(g)}n.push(...f),d.push(...h.matchUpIds)}let p=u.map(({matchUpId:h,tournamentId:f,schedule:m,drawId:g})=>({tournamentId:f,matchUpId:h,drawId:g,schedule:{...m,scheduledDate:i}}));return r=qR({tournamentRecords:e,matchUpDetails:p}),{...r,scheduled:u,notScheduled:n}}function SSe(t){let{courtDayDate:e}=t,i=mn(t,[{courtAssignments:!0,[Lg]:bl,[Sh]:Ht},{[Ko]:!0}]);if(i.error)return i;let n=t.courtAssignments.reduce((a,o)=>{let{tournamentId:s}=o;return a[s]||(a[s]=[]),a[s].push(o),a},{}),r;return Object.keys(n).every(a=>{let o=t[Ko][a];if(!o)return r={error:it},!1;let s=n[a].reduce((l,c)=>{let{drawId:u}=c;return l[u]||(l[u]=[]),l[u].push(c),l},{});Object.keys(s).every(l=>{let{drawDefinition:c}=Ks({tournamentRecord:o,drawId:l});return c?(s[l].every(u=>{let{matchUpId:d,courtId:p}=u,h=Uw({tournamentRecord:o,drawDefinition:c,courtDayDate:e,matchUpId:d,courtId:p});if(h.success)return h==null?void 0:h.success;r={error:mme}}),!0):(r={error:Lt},!1)})}),r||ue}function TSe(t){let{tournamentRecords:e,allDateMatchUpIds:i=[],averageMatchUpMinutes:n=90,recoveryMinutes:r=0,recoveryMinutesMap:a,matchUpPotentialParticipantIds:o={},individualParticipantProfiles:s={},matchUpNotBeforeTimes:l={},matchUpDailyLimits:c={},checkPotentialRequestConflicts:u=!0,remainingScheduleTimes:d,clearScheduleDates:p,periodLength:h=30,scheduleDate:f,matchUpIds:m,venueIds:g,startTime:v,endTime:y,dryRun:b}=t,I=mn(t,[{[Ko]:!0,[$P]:!0},{[nd]:Kl,[Sh]:Cs,[SGe]:!0},{[nd]:z=>!z||!isNaN(z),[EGe]:!1,[Sh]:Me,[CGe]:!1,[PGe]:!1}]);if(I.error)return I;let T=t.competitionMatchUps??Ud({nextMatchUps:!0,tournamentRecords:e}).matchUps??[],w=t.matchUpDependencies??Ku({includeParticipantDependencies:!0,matchUps:T,tournamentRecords:e}).matchUpDependencies;T.forEach(z=>{var Z;(Z=z.schedule)!=null&&Z.scheduledDate&&Uh(f,Ci(z.schedule.scheduledDate))&&ZS({matchUpPotentialParticipantIds:o,matchUpNotBeforeTimes:l,matchUp:z})});let S=m.map(z=>T.find(Z=>Z.matchUpId===z)).filter(Boolean),{venueId:D,scheduleTimes:E,dateScheduledMatchUpIds:C}=V7({tournamentRecords:e,remainingScheduleTimes:d,startTime:rr(v),endTime:rr(y),scheduleDate:Ci(f),averageMatchUpMinutes:n,clearScheduleDates:p,periodLength:h,venueIds:g}),P={},R=[],N={},M={},A={};T.filter(({matchUpId:z})=>C==null?void 0:C.includes(z)).forEach(z=>{var Z;Bj({matchUpPotentialParticipantIds:o,individualParticipantProfiles:s,matchUp:z,value:1});let Y=(Z=z.schedule)==null?void 0:Z.scheduledTime;if(Y){N[z.matchUpId]=Y;let Q=a==null?void 0:a[z.matchUpId];ME({recoveryMinutes:Q||r,matchUpPotentialParticipantIds:o,individualParticipantProfiles:s,matchUpNotBeforeTimes:l,averageMatchUpMinutes:n,matchUpDependencies:w,scheduleTime:Y,matchUp:z})}});let _=S.filter(z=>{let Z=C==null?void 0:C.includes(z.matchUpId),Y=[yn,fn,ia,ec,os,Rn].includes(z==null?void 0:z.matchUpStatus);return!Z&&!z.winningSide&&!Y}),{matchUpMap:x,overLimitMatchUpIds:O,participantIdsAtLimit:B}=_.reduce((z,Z)=>{let{drawId:Y,tournamentId:Q,matchUpType:X}=Z,{participantIdsAtLimit:oe,relevantParticipantIds:re}=x7({individualParticipantProfiles:s,matchUpPotentialParticipantIds:o,matchUpDailyLimits:c,matchUp:Z});return oe!=null&&oe.length?(z.overLimitMatchUpIds.push(Z.matchUpId),z.participantIdsAtLimit.push(...oe),z):(re.forEach(me=>{HR({individualParticipantProfiles:s,participantId:me});let se=s[me].counters;se[X]?se[X]+=1:se[X]=1,se[Tu]?se[Tu]+=1:se[Tu]=1}),z.matchUpMap[Q]||(z.matchUpMap[Q]={}),z.matchUpMap[Q][Y]?z.matchUpMap[Q][Y].push(Z):z.matchUpMap[Q][Y]=[Z],ZS({matchUpPotentialParticipantIds:o,matchUpNotBeforeTimes:l,matchUp:Z}),z)},{matchUpMap:{},overLimitMatchUpIds:[],participantIdsAtLimit:[]});_=_.filter(({matchUpId:z})=>!O.includes(z));let F=0,G=(E==null?void 0:E.length)??0,{personRequests:H}=qy({tournamentRecords:e,requestType:zR});for(;E!=null&&E.length&&_.length&&F<=G;){F++;let{scheduleTime:z}=E.shift(),Z=_.find(Y=>{let{matchUpId:Q}=Y,{dependenciesScheduled:X,remainingDependencies:oe}=A7({matchUpScheduleTimes:N,matchUpDependencies:w,allDateMatchUpIds:i,matchUp:Y});if(!X)return A[Q]||(A[Q]=[]),A[Q].push({scheduleTime:z,remainingDependencies:oe}),!1;let{enoughTime:re}=k7({individualParticipantProfiles:s,matchUpNotBeforeTimes:l,matchUpDependencies:w,scheduleTime:z,matchUp:Y});if(!re)return M[Q]||(M[Q]=[]),M[Q].push({scheduleTime:z}),!1;let{conflicts:me}=_7({potentials:u,averageMatchUpMinutes:n,requestConflicts:P,personRequests:H,scheduleTime:z,scheduleDate:f,matchUp:Y});if(me!=null&&me.length)return!1;let se=a==null?void 0:a[Y.matchUpId];return ME({recoveryMinutes:se||r,matchUpPotentialParticipantIds:o,individualParticipantProfiles:s,matchUpNotBeforeTimes:l,averageMatchUpMinutes:n,matchUpDependencies:w,scheduleTime:z,matchUp:Y}),N[Y.matchUpId]=z,!0});_=_.filter(({matchUpId:Y})=>Y!==(Z==null?void 0:Z.matchUpId)),Z||R.push(z)}_.forEach(z=>{Bj({individualParticipantProfiles:s,matchUpPotentialParticipantIds:o,value:-1,matchUp:z})});let $=[];Object.keys(x).forEach(z=>{let Z=e[z];Z&&Object.keys(x[z]).forEach(Y=>{let{drawDefinition:Q}=jg({tournamentRecord:Z,drawId:Y});Q&&x[z][Y].forEach(({matchUpId:X})=>{let oe=N[X];if(oe){let re=oe.split(":").map(Dc).join(":"),me=`${Ci(f)}T${re}`;b?$.push(X):(Gg({drawDefinition:Q,matchUpId:X,scheduledTime:me}).success&&$.push(X),D&&_U({tournamentRecords:e,tournamentRecord:Z,drawDefinition:Q,matchUpId:X,venueId:D}))}})})});let q=F5(_);return{...ue,requestConflicts:Object.values(P),remainingScheduleTimes:E==null?void 0:E.map(({scheduleTime:z})=>z),individualParticipantProfiles:s,matchUpNotBeforeTimes:l,participantIdsAtLimit:B,skippedScheduleTimes:R,overLimitMatchUpIds:O,scheduledMatchUpIds:$,noTimeMatchUpIds:q,recoveryTimeDeferred:M,dependencyDeferred:A}}function USe({tournamentRecords:t,matchUps:e}){if(!Zc(e))return{error:Oh};if(e.some(({matchUpId:h,hasContext:f})=>h&&!f))return{info:"matchUps must have { inContext: true, nextMatchUps: true }",error:iL};let i=Math.max(...e.map(({schedule:h})=>(h==null?void 0:h.courtOrder)||1).map(h=>ai(h))),n=Ct(1,i+1).map(h=>e.filter(f=>{var m;return ai((m=f.schedule)==null?void 0:m.courtOrder)===h})),r={},a={},o={};n.flat().filter(Boolean).sort(fw).forEach(({schedule:h})=>delete h[jN]);let s=ki(e.map(({drawId:h})=>h)),l=Ku({includeParticipantDependencies:!0,tournamentRecords:t,drawIds:s}).matchUpDependencies,c=n.map((h,f)=>h.reduce((m,g)=>{if(!g.matchUpId)return m;let{matchUpId:v,winnerMatchUpId:y,loserMatchUpId:b,schedule:I,sides:T,potentialParticipants:w}=g,S=I==null?void 0:I.courtId;r[v]=f,a[S]=[],m.matchUpIds.push(v),o[v]=g;let D=l[v].matchUpIds;D.length&&m.sourceMatchUpIds.push(...D);let E=(T==null?void 0:T.map(P=>{var R;return[(R=P.participant)==null?void 0:R.individualParticipantIds,P.participantId]}).flat().filter(Boolean))??[],C=(w==null?void 0:w.flat().map(({individualParticipantIds:P,participantId:R})=>[P,R]).flat().filter(Boolean))||[];return m.participantIds.push(...C,...E),y&&m.targetMatchUpIds.push(y),b&&m.targetMatchUpIds.push(b),m},{sourceMatchUpIds:[],targetMatchUpIds:[],participantIds:[],matchUpIds:[]})),u=(h,f)=>l[h].sources.reduce((m,g,v)=>g.includes(f)&&v+1||m,0),d=c.map(()=>[]),p=(h,f,m,g)=>{if(!o[h].schedule[jN]){o[h].schedule[jN]=f,o[h].schedule[nve]=g,d[r[h]].push({matchUpId:h,issueType:m,issueIds:g,issue:f});let v=o[h].schedule.courtId;a[v]||(a[v]=[]),a[v].push({matchUpId:h,issue:f,issueType:m,issueIds:g})}};return c.forEach((h,f)=>{let m=f?c[f-1]:void 0,g=c.slice(f+1),v={},y=xl(h.participantIds),b=Object.keys(y).filter(w=>y[w]>1),I=h.matchUpIds.filter(w=>l[w].participantIds.some(S=>b.includes(S)));I.forEach(w=>{v[w]||(v[w]={}),v[w][lv]||(v[w][lv]=I.filter(S=>S!==w))});let T=m&&h.participantIds.filter(w=>m.participantIds.includes(w));T&&T.forEach(w=>{let S=h.matchUpIds.concat(m.matchUpIds).filter(D=>l[D].participantIds.includes(w));S.forEach(D=>{v[D]||(v[D]={}),v[D][cv]||(v[D][cv]=S.filter(E=>E!==D))})}),h.matchUpIds.forEach(w=>{var S,D,E,C;let P=l[w].matchUpIds;for(let N of g){let M=N.matchUpIds.filter(A=>P.includes(A));M!=null&&M.length&&(M.forEach(A=>p(A,lj,Rm,[w])),p(w,lj,Rm,M))}if((S=v[w])!=null&&S[lv]&&p(w,lv,sj,v[w][lv]),h.sourceMatchUpIds.includes(w)){let N=h.matchUpIds.filter(M=>l[M].matchUpIds.includes(w));p(w,lv,Rm,N),h.matchUpIds.filter(M=>l[M].matchUpIds.includes(w)).forEach(M=>p(M,lv,Rm,[w]))}let R=(D=m==null?void 0:m.matchUpIds)==null?void 0:D.filter(N=>u(w,N)>1);if(R!=null&&R.length&&(p(w,cj,Rm,R),R.forEach(N=>p(N,cj,Rm,[w]))),(E=v[w])!=null&&E[cv]&&p(w,cv,sj,v[w][cv]),(C=m==null?void 0:m.targetMatchUpIds)==null?void 0:C.includes(w)){let N=o[w].schedule.courtId,M=P.filter(A=>m.matchUpIds.includes(A));M.some(A=>o[A].schedule.courtId===N)||(M.forEach(A=>p(A,cv,Rm,[w])),p(w,cv,Rm,M))}})}),{courtIssues:a,rowIssues:d}}function DSe(t){let e="reorderUpcomingMatchUps",{tournamentRecords:i}=t;if(typeof i!="object"||!Object.keys(i).length)return fe({result:{error:_r},stack:e});let{matchUpsContextIds:n,firstToLast:r}=t;if(!n)return fe({result:{error:Ht},stack:e});let a=n==null?void 0:n.length;if(!a)return{...ue};let o=0;return n.forEach((l,c)=>{let{tournamentId:u,drawId:d,matchUpId:p}=l,h=c+(r?-1:1);h<0&&(h=a-1),h===a&&(h=0);let f=n[h].schedule.scheduledTime,m=s({tournamentId:u,scheduledTime:f,matchUpId:p,drawId:d});if(m.success)o++;else return m}),o===a?ue:fe({result:{error:fme},stack:e});function s({tournamentId:l,scheduledTime:c,matchUpId:u,drawId:d}){let p=i[l],{drawDefinition:h}=jg({tournamentRecord:p,drawId:d});return h?Gg({drawDefinition:h,scheduledTime:c,matchUpId:u}):{error:_l}}}function ESe(t){var e,i;let{scheduleChange:n,matchUpIds:r,dryRun:a}=t;if(!r||!Array.isArray(r))return{error:nU};if(typeof n!="object")return{error:Me};let o=_p(t),s=[],l=[];for(let u of Object.values(o)){let d=o8e({tournamentRecord:u,scheduleChange:n,matchUpIds:r,dryRun:a});if(d.error)return d;Array.isArray(d.notRescheduled)&&l.push(...d.notRescheduled);let p=F5(d.notRescheduled),h=[];(e=d.rescheduled)==null||e.forEach(f=>{let{matchUpId:m}=f;p.includes(m)&&h.push(m),s.push(f)}),h.length&&(l=((i=d==null?void 0:d.notRescheduled)==null?void 0:i.filter(({matchUpId:f})=>!h.includes(f)))||[])}let c=!!(s.length&&!l.length);return{...ue,rescheduled:s,notRescheduled:l,allRescheduled:c}}function o8e({tournamentRecord:t,scheduleChange:e,matchUpIds:i,dryRun:n}){var r;if(!t)return{error:it};if(!i||!Array.isArray(i))return{error:nU};if(typeof e!="object")return{error:Me};let a=[],o=[],{minutesChange:s,daysChange:l}=e;if(!s&&!l)return{...ue};if(s&&isNaN(s))return{error:Me};if(l&&isNaN(l))return{error:Me};let{matchUps:c}=co({matchUpFilters:{matchUpIds:i},tournamentRecord:t}),u=({matchUpStatus:T})=>!Ga.includes(T),d=c==null?void 0:c.filter(T=>LR({schedule:T.schedule})).filter(T=>u({matchUpStatus:T.matchUpStatus}));if(!(d!=null&&d.length))return{...ue};let{tournamentInfo:p}=Sw({tournamentRecord:t}),{startDate:h,endDate:f}=p,m=d==null?void 0:d.reduce((T,w)=>{let{matchUpId:S,drawId:D}=w;return T[D]?T[D].push(S):T[D]=[S],T},{}),g=1440;for(let T of Object.keys(m)){let w=jg({tournamentRecord:t,drawId:T});if(w.error)return w;let S=w.drawDefinition,D=m[T].filter(E=>i.includes(E));for(let E of D)if(E&&S){let C=(r=d.find(_=>_.matchUpId===E))==null?void 0:r.schedule,{scheduledTime:P,scheduledDate:R}=C,N,M,A;if(!N&&l&&R){let _=Ci(R);A=I1(_,l),N=new Date(A)<new Date(h)||new Date(A)>new Date(f)}if(s&&P){let _=Ci(P),x=on(rr(P))+s;if(N=x<0||x>g,!N){let O=il(P,s),B=_&&A||R===_&&_;M=B?`${B}T${O}`:O}}if(N)o.push(E);else{if(!n){if(M){let _=Gg({scheduledTime:M,drawDefinition:S,matchUpId:E});if(_.error)return _}if(A){let _=NF({scheduledDate:A,drawDefinition:S,matchUpId:E});if(_.error)return _}}(M||A)&&a.push(E)}}}let v=co({matchUpFilters:{matchUpIds:i},tournamentRecord:t}).matchUps??[],y=v.filter(({matchUpId:T})=>a.includes(T)),b=v.filter(({matchUpId:T})=>o.includes(T)),I=y.length&&!b.length;return{...ue,rescheduled:y,notRescheduled:b,allRescheduled:I}}function CSe(t){let e="matchUpScheduleChange",{tournamentRecords:i}=t;if(typeof i!="object"||!Object.keys(i).length)return{error:_r};let{sourceMatchUpContextIds:n,targetMatchUpContextIds:r,sourceCourtId:a,targetCourtId:o,courtDayDate:s}=t||{},{drawId:l,matchUpId:c,tournamentId:u}=n||{},{drawId:d,matchUpId:p,tournamentId:h}=r||{};if(!c&&!p)return fe({result:{error:Ht},stack:e});let{matchUps:f}=Ud({matchUpFilters:{matchUpIds:[c,p].filter(Boolean),drawIds:[l,d].filter(Boolean)},tournamentRecords:t.tournamentRecords}),m=f==null?void 0:f.find(({matchUpId:I})=>I===c),g=f==null?void 0:f.find(({matchUpId:I})=>I===p),v=0;if(o&&c&&!p){let I=y({tournamentId:u,matchUpId:c,courtId:o,matchUp:m,drawId:l,tournamentRecords:i,sourceCourtId:a,courtDayDate:s});if(I!=null&&I.success&&v++,I.error)return fe({result:I,stack:e})}else if(a&&o&&c&&p){let I=y({tournamentId:u,matchUpId:c,courtId:o,matchUp:m,drawId:l,tournamentRecords:i,sourceCourtId:a,courtDayDate:s});if(I.success&&v++,I.error)return fe({result:I,stack:e,info:"source"});let T=y({tournamentId:h,sourceCourtId:o,matchUpId:p,matchUp:g,courtId:a,drawId:d,tournamentRecords:i,courtDayDate:s});if(T.success&&v++,T.error)return fe({result:T,stack:e,info:"target"})}else return{error:Ht};return v?ue:fe({result:{error:sU},stack:e});function y(I){let{tournamentRecords:T,tournamentId:w,matchUp:S,drawId:D}=I,E=T[w],{drawDefinition:C}=jg({tournamentRecord:E,drawId:D});return S.matchUpType===Jn?b({...I,tournamentRecord:E,drawDefinition:C}):Uw({...I,tournamentRecord:E,drawDefinition:C})}function b({removePriorValues:I,tournamentRecords:T,tournamentRecord:w,drawDefinition:S,sourceCourtId:D,courtDayDate:E,matchUpId:C,matchUp:P,courtId:R}){let N=[R].concat(P.schedule.allocatedCourts.map(({courtId:M})=>M).filter(M=>M!==D));return RF({removePriorValues:I,tournamentRecords:T,tournamentRecord:w,drawDefinition:S,courtDayDate:E,matchUpId:C,courtIds:N})}}function PSe({scheduleAttributes:t=[jf,ay,yU,bU,IU,ad,Gf,oh,yf],tournamentRecord:e,drawDefinition:i,matchUpId:n}){var r,a;let o="clearMatchUpSchedule",s=i?(r=Hs({matchUpFilters:{matchUpIds:[n]},inContext:!1,drawDefinition:i}).matchUps)==null?void 0:r[0]:(a=co({matchUpFilters:{matchUpIds:[n]},tournamentRecord:e,inContext:!1}).matchUps)==null?void 0:a[0];if(!s)return{error:qo};let l=(s.timeItems??[]).filter(c=>(c==null?void 0:c.itemType)&&!t.includes(c==null?void 0:c.itemType));return s.timeItems=l,sn({tournamentId:e.tournamentId,context:o,drawDefinition:i,matchUp:s}),{...ue}}function RSe(t){let{tournamentRecord:e,tournamentId:i,dailyLimits:n}=t,r=t.tournamentRecords||e&&{[e.tournamentId]:e}||{};if(typeof r!="object"||!Object.keys(r).length)return{error:_r};if(typeof n!="object")return{error:om};let a=Object.keys(r).filter(o=>!i||i===o);if(i&&!a.includes(i))return{error:Me};for(let o of a){let s=r[o],l=un({element:s,extension:{name:HP,value:{dailyLimits:n}}});if(l.error)return l}return{...ue}}var MSe={};zi(MSe,{addCollectionDefinition:()=>H7,addCollectionGroup:()=>OSe,aggregateTieFormats:()=>FSe,compareTieFormats:()=>Hf,getTieFormat:()=>$8,modifyCollectionDefinition:()=>j7,modifyTieFormat:()=>LSe,mutate:()=>NSe,orderCollectionDefinitions:()=>kSe,query:()=>JIe,removeCollectionDefinition:()=>G7,removeCollectionGroup:()=>_Se,tieFormatGenderValidityCheck:()=>VL,validateCollectionDefinition:()=>PR});var NSe={};zi(NSe,{addCollectionDefinition:()=>H7,addCollectionGroup:()=>OSe,aggregateTieFormats:()=>FSe,modifyCollectionDefinition:()=>j7,modifyTieFormat:()=>LSe,orderCollectionDefinitions:()=>kSe,removeCollectionDefinition:()=>G7,removeCollectionGroup:()=>_Se});function py({drawDefinition:t,structureId:e,matchUpId:i,structure:n,matchUp:r,eventId:a,event:o}){var s;let l="getTieFormat",c;if(e=(n==null?void 0:n.structureId)??e,i=(r==null?void 0:r.matchUpId)??i,(i||e)&&!t)return{error:Lt};if(a&&o)c=Nm(o);else if(i){if(t&&(!r||!n)){let u=ar({drawDefinition:t,matchUpId:i});if(u.error)return u;if(((s=u.matchUp)==null?void 0:s.matchUpType)!==Ip)return fe({result:{error:Ws},stack:l});n||(n=u.structure),r||(r=u.matchUp)}c=X1({item:r,drawDefinition:t,structure:n,event:o})||X1({item:n,drawDefinition:t,structure:n,event:o})||Nm(t)||Nm(o)}else if(t&&e){if(!n){let u=pi({drawDefinition:t,structureId:e});if(u.error)return u;n=u==null?void 0:u.structure}c=X1({item:n,drawDefinition:t,structure:n,event:o})||Nm(t)||Nm(o)}else c=Nm(t)||Nm(o);return c?{...ue,structure:n,tieFormat:c,matchUp:r}:fe({result:{error:xP},stack:l})}function K_({matchUp:t,updateInProgressMatchUps:e}){return!t.winningSide&&![Ga].includes(t.matchUpStatus)&&(e||t.matchUpStatus!==Hu&&!uo(t))}function y$({from:t,to:e}){let i=Object.keys(t),n=Wr(i,Object.keys(e)).length===i.length,r=i.filter(o=>t[o]!==e[o]).map(o=>({countChange:e[o]-t[o],collectionId:o})),a=i.every(o=>t[o]===e[o]);return{equivalent:n&&a,matchUpsCountChanges:r}}function s8e({updateInProgressMatchUps:t,tournamentRecord:e,drawDefinition:i,structure:n,tieFormat:r,eventId:a,matchUp:o,event:s,uuids:l}){var c,u,d,p;let h="updateTieFormat",f=e==null?void 0:e.tournamentId,m=0,g=0,v=0,y=0,b=r==null?void 0:r.collectionDefinitions.reduce((C,P)=>(C[P.collectionId]=(C[P.collectionId]||0)+P.matchUpCount,C),{}),I=({tieFormat:C})=>{let P=C==null?void 0:C.collectionDefinitions.reduce((R,N)=>(R[N.collectionId]=(R[N.collectionId]||0)+N.matchUpCount,R),{});return y$({from:P,to:b}).equivalent},T=(c=py({drawDefinition:i}))==null?void 0:c.tieFormat,w=(u=py({event:s}))==null?void 0:u.tieFormat;if(s&&a){for(let C of s.drawDefinitions??[])S({drawDefinition:C});s.tieFormat=So(r),y+=1}else if(o){if(!o.tieMatchUps)return fe({result:{error:Ws},stack:h});let C=xl((d=o.tieMatchUps)==null?void 0:d.map(({collectionId:A})=>A)),P=y$({to:b,from:C}),{changes:R,changesArePossible:N,cannotChangeReaon:M}=PX({matchUp:o,check:P});if(P.equivalent)if(K_({matchUp:o,updateInProgressMatchUps:t}))o.tieFormat=So(r),y+=1;else return fe({result:{error:t5},info:"matchUp is IN_PROGRESS or COMPLETE",stack:h});else if(N)E({tieFormat:r,matchUp:o,changes:R,uuids:l});else return fe({context:{collectionMap:b,matchUpMap:C},result:{error:nf},info:M||"specified changes not possible",stack:h});g+=1,sn({eventId:s==null?void 0:s.eventId,context:h,drawDefinition:i,tournamentId:f,matchUp:o})}else if(n){let C=(p=D({inheritedTieFormat:T??w,structure:n}))==null?void 0:p.modifiedMatchUpsCount;C&&(g+=C,m+=1,y+=1);let P=!n.tieFormat||Hf({ancestor:n.tieFormat,descendant:r}).different;P&&(n.tieFormat=So(r),m+=1,y+=1),(C||P)&&i&&er({structureIds:[n.structureId],eventId:s==null?void 0:s.eventId,drawDefinition:i})}else if(i)S({drawDefinition:i}),i.tieFormat=So(r),y+=1;else return{error:Lt};return{modifiedStructuresCount:m,modifiedMatchUpsCount:g,addedMatchUpsCount:v,modifiedCount:y,...ue,tieFormat:r};function S({drawDefinition:C}){var P;let R=C.structures||[],N=[];for(let M of R){if(M.tieFormat)continue;let A=(P=D({inheritedTieFormat:w,structure:M}))==null?void 0:P.modifiedMatchUpsCount;if(A){m+=1,g+=A;let _=M.structureId;N.push(_)}}return er({structureIds:N,eventId:s==null?void 0:s.eventId,drawDefinition:C}),N.length}function D({inheritedTieFormat:C,structure:P}){var R,N;let M=0,A=((R=Sn({matchUpFilters:{matchUpTypes:[Jn]},structure:P}))==null?void 0:R.matchUps)||[];for(let _ of A){let x=K_({matchUp:_,updateInProgressMatchUps:t}),O=!1,B=xl((N=_.tieMatchUps)==null?void 0:N.map(({collectionId:G})=>G)),F=y$({from:B,to:b});if(F.equivalent)_.tieFormat&&I(_)&&x&&(_.tieFormat=So(r),O=!0);else{let{changes:G,changesArePossible:H}=PX({matchUp:_,check:F});if(H&&!_.tieFormat)E({changes:G,matchUp:_,tieFormat:r,uuids:l});else if(C)(!_.tieFormat||Hf({ancestor:C,descendant:_.tieFormat}).different)&&(_.tieFormat=C,O=!0);else return fe({result:{error:xP},stack:h})}O&&(M+=1,sn({tournamentId:e==null?void 0:e.tournamentId,drawDefinition:i,context:h,eventId:a,matchUp:_}))}return{modifiedMatchUpsCount:M}}function E({uuids:C,matchUp:P,tieFormat:R,changes:N}){P.tieFormat=So(R);let M=[],A=[];return N.forEach(_=>{if(_.countChange>0){let x=Math.max(0,...P.tieMatchUps.filter(F=>F.collectionId===_.collectionId).map(Ol("collectionPosition"))),O=R.collectionDefinitions.find(F=>F.collectionId===_.collectionId),B=DR({matchUpsLimit:_.countChange,collectionPositionOffset:x,collectionDefinition:O,matchUp:P,uuids:C});A.push(...$t(B,!1,!0)),v+=A.length,P.tieMatchUps.push(...B)}else{let x=_.toBePlayedTieMatchUpIds.slice(0,Math.abs(_.countChange));console.log("remove",x.length),M.push(...x),P.tieMatchUps=P.tieMatchUps.filter(({matchUpId:O})=>!x.includes(O))}}),A.length&&lg({matchUps:A,drawDefinition:i,tournamentId:f,eventId:a}),M.length&&lm({matchUpIds:M,action:"updateTieFormat",drawDefinition:i,tournamentId:f,eventId:a}),{matchUpIdsRemoved:M,matchUpsAdded:A}}}function PX({check:t,matchUp:e}){let i="",n=[];return{changesArePossible:t.matchUpsCountChanges.every(({collectionId:r,countChange:a})=>{let o=e.tieMatchUps.filter(l=>l.collectionId===r&&l.matchUpStatus===Kr).map(Ol("matchUpId")),s=o.length+a>=0||a>0;return!s&&a<0&&(i="Insufficient TO_BE_PLAYED matchUps"),n.push({toBePlayedTieMatchUpIds:o,collectionId:r,countChange:a}),s}),changes:n,cannotChangeReaon:i}}function LF({drawDefinition:t,auditData:e}){let{extension:i}=Bi({name:uI,element:t}),n={name:uI,value:Array.isArray(i==null?void 0:i.value)?i==null?void 0:i.value.concat(e):[e]};un({element:t,extension:n})}function j7({updateInProgressMatchUps:t=!1,tournamentRecord:e,collectionOrder:i,collectionName:n,tieFormatName:r,drawDefinition:a,matchUpFormat:o,matchUpCount:s,collectionId:l,matchUpType:c,structureId:u,matchUpId:d,category:p,eventId:h,gender:f,event:m,collectionValueProfiles:g,collectionValue:v,matchUpValue:y,scoreValue:b,setValue:I}){var T;let w="modifyCollectionDefinition";if(o&&!Fl({matchUpFormat:o}))return fe({result:{error:Me},context:{matchUpFormat:o},stack:w});if(n&&typeof n!="string")return fe({result:{error:Me},context:{collectionName:n},stack:w});if(f&&!Object.values(w6).includes(f))return fe({result:{error:Me},context:{gender:f},stack:w});if(p&&typeof p!="object")return fe({result:{error:Me},context:{category:p},stack:w});let S={collectionValueProfiles:g,collectionValue:v,matchUpValue:y,scoreValue:b,setValue:I};if(!Object.values(S).filter(Boolean).length&&!i&&!n&&!o&&!s&&!c)return fe({result:{error:Ht},stack:w});if(Object.values(S).filter(Boolean).length>1)return fe({info:"Only one value assignment allowed per collectionDefinition",result:{error:Me},stack:w});let D=py({drawDefinition:a,structureId:u,matchUpId:d,eventId:h,event:m});if(D.error)return fe({result:D,stack:w});let{matchUp:E,structure:C,tieFormat:P}=D,R=So(P),N=P==null?void 0:P.collectionDefinitions.find(q=>q.collectionId===l),M=R==null?void 0:R.collectionDefinitions.find(q=>q.collectionId===l);if(!N)return fe({info:"source collectionDefinition",result:{error:Wo},context:{collectionId:l},stack:w});let A=v??y??b??I;if(g){let q=Mye({matchUpCount:s??(N==null?void 0:N.matchUpCount)??0,collectionValueProfiles:g});if(q.errors)return fe({result:{error:Me},info:q.errors,stack:w})}else if(A&&!bi(A))return fe({result:{error:Me},info:"value is not an integer",context:{value:A},stack:w});let _=(q,z)=>Wr(Object.keys(q),Object.keys(z)).length===Object.keys(q).length&&Wr(Object.values(q),Object.values(z)).length===Object.values(q).length,x=g&&(!N.collectionValueProfiles||!_(N.collectionValueProfiles,g)),O=bi(v)&&N.collectionValue!==v||bi(y)&&N.matchUpValue!==y||bi(b)&&N.scoreValue!==b||bi(I)&&N.setValue!==I||x,B=[];if(O&&(M.collectionValueProfiles=void 0,M.collectionValue=void 0,M.matchUpValue=void 0,M.scoreValue=void 0,M.setValue=void 0,Object.assign(M,S),B.push({collectionId:l,...qt(S)})),(bi(b)||bi(I))&&M.collectionGroupNumber){let q=M.collectionGroupNumber;R.collectionDefinitions=R.collectionDefinitions.map(z=>{let{collectionGroupNumber:Z,...Y}=z;return Z===q?Y:z}),R.collectionGroups=R.collectionGroups.filter(({groupNumber:z})=>z!==q),B.push({collectionId:l,change:"collectionGroupNumber removed"})}let{aggregateValue:F,valueGoal:G}=Tw(R),H=qt({aggregateValue:F,valueGoal:G});if((H.aggregateValue!==(P==null?void 0:P.winCriteria.aggregateValue)||H.valueGoal!==(P==null?void 0:P.winCriteria.valueGoal))&&(R.winCriteria=H,B.push({collectionId:l,winCriteria:H})),bi(i)&&N.collectionOrder!==i&&(M.collectionOrder=i,B.push({collectionId:l,collectionOrder:i})),n&&N.collectionName!==n&&(M.collectionName=n,B.push({collectionId:l,collectionName:n})),o&&N.matchUpFormat!==o&&(M.matchUpFormat=o,B.push({collectionId:l,matchUpFormat:o})),bi(s)&&N.matchUpCount!==s&&(M.matchUpCount=s,B.push({collectionId:l,matchUpCount:s})),c&&N.matchUpType!==c)return fe({result:{error:aL},context:{matchUpType:c},stack:w});p&&N.category!==p&&(M.category=p,B.push({collectionId:l,category:p})),f&&N.gender!==f&&(M.gender=f,B.push({collectionId:l,gender:f}));let $=qt(R);if(D=ul({tieFormat:$}),D.error)return fe({result:D,stack:w});if(!B.length)return fe({result:{...ue,modifications:B}});if((P==null?void 0:P.tieFormatName)!==r?($.tieFormatName=r,B.push({tieFormatName:r})):B.length&&(delete $.tieFormatName,B.push("tieFormatName removed: modifications without new tieFormatName")),D=s8e({tieFormat:$,updateInProgressMatchUps:t,tournamentRecord:e,drawDefinition:a,structure:C,eventId:h,matchUp:E,event:m}),!D.error){let{appliedPolicies:q}=Mn({tournamentRecord:e});if((T=q==null?void 0:q.audit)!=null&&T[uI]){let z=qt({collectionDefinition:M,drawId:a==null?void 0:a.drawId,action:w,structureId:u,matchUpId:d,eventId:h});LF({drawDefinition:a,auditData:z})}}return fe({result:{...D,modifications:B},stack:w})}function l8e({updateInProgressMatchUps:t,drawDefinition:e,structureId:i,structure:n,matchUpId:r,matchUp:a}){var o,s;let l=[];return r&&a?l=[a]:i&&n?l=((o=Sn({matchUpFilters:{matchUpTypes:[Jn]},structure:n}))==null?void 0:o.matchUps)??[]:e&&(l=((s=Hs({matchUpFilters:{matchUpTypes:[Jn]},drawDefinition:e}))==null?void 0:s.matchUps)??[]),{targetMatchUps:l.filter(c=>!c.winningSide&&c.matchUpStatus!==ia&&(t||c.matchUpStatus!==Hu&&!uo(c)))}}function c8e({updateInProgressMatchUps:t,tournamentRecord:e,drawDefinition:i,targetMatchUps:n,tieFormat:r,event:a}){for(let o of n){let s=!!o.tieFormat;s&&(o.tieFormat=So(r));let l;if(t){let c=Mn({tournamentRecord:e,drawDefinition:i,event:a}).appliedPolicies,u=hm({matchUpId:o.matchUpId,exitWhenNoValues:!0,tournamentRecord:e,appliedPolicies:c,drawDefinition:i,event:a});if(u.error)return u;l=u.score}s&&!l&&sn({tournamentId:e==null?void 0:e.tournamentId,context:"updateTargetTeamMatchUps",eventId:a==null?void 0:a.eventId,matchUp:o,drawDefinition:i})}return{...ue}}function ASe({updateInProgressMatchUps:t,originalValueGoal:e,tournamentRecord:i,wasAggregateValue:n,tieFormatName:r,drawDefinition:a,structureId:o,structure:s,tieFormat:l,matchUpId:c,matchUp:u,eventId:d,event:p}){let{aggregateValue:h,valueGoal:f}=Tw(l);l.winCriteria=qt({aggregateValue:h,valueGoal:f}),(e&&e!==f||h&&!n)&&(r?l.tieFormatName=r:delete l.tieFormatName);let{targetMatchUps:m}=l8e({updateInProgressMatchUps:t,drawDefinition:a,structureId:o,structure:s,matchUpId:c,matchUp:u});c8e({updateInProgressMatchUps:t,tournamentRecord:i,targetMatchUps:m,drawDefinition:a,tieFormat:l,event:p});let g=qt(l),v=ul({tieFormat:g});if(v.error)return v;if(d&&p)p.tieFormat=g;else if(c&&u)u.tieFormat=l;else if(s)s.tieFormat=g;else if(a)a.tieFormat=g;else if(!u||!a)return{error:Lt};return er({drawDefinition:a,eventId:p==null?void 0:p.eventId}),{...ue}}function _Se({updateInProgressMatchUps:t=!0,collectionGroupNumber:e,tournamentRecord:i,drawDefinition:n,tieFormatName:r,structureId:a,matchUpId:o,matchUp:s,eventId:l,event:c}){var u;if(!e)return{error:Ht};if(isNaN(e))return{error:Me};let d="removeCollectionGroup",p=s?void 0:py({drawDefinition:n,structureId:a,matchUpId:o,eventId:l,event:c});if(p!=null&&p.error)return fe({result:p,stack:d});let h=p==null?void 0:p.structure;s=s??(p==null?void 0:p.matchUp);let f=p==null?void 0:p.tieFormat,m=f==null?void 0:f.winCriteria.valueGoal,g=f==null?void 0:f.winCriteria.aggregateValue,v=So(f);if(p=ul({tieFormat:v}),p.error)return fe({result:p,stack:d});let y=[];if(v.collectionDefinitions=v.collectionDefinitions.map(b=>{let{collectionGroupNumber:I,...T}=b;return I!==e?b:(y.push(b.collectionId),T)}),v.collectionGroups=v.collectionGroups.filter(({groupNumber:b})=>b!==e),p=ASe({updateInProgressMatchUps:t,originalValueGoal:m,wasAggregateValue:g,tournamentRecord:i,drawDefinition:n,tieFormatName:r,structureId:a,structure:h,tieFormat:v,matchUpId:o,matchUp:s,eventId:l,event:c}),!p.error){let{appliedPolicies:b}=Mn({tournamentRecord:i});if((u=b==null?void 0:b.audit)!=null&&u[uI]){let I=qt({drawId:n==null?void 0:n.drawId,collectionGroupNumber:e,action:d,structureId:a,matchUpId:o,eventId:l});LF({drawDefinition:n,auditData:I})}}return fe({result:{...p,modifiedCollectionIds:y},stack:d})}function XS({tieFormat:t,orderMap:e}){let i=So(t);return i.collectionDefinitions.forEach(n=>{let r=e[n.collectionId];r&&(n.collectionOrder=r)}),i.collectionDefinitions.sort((n,r)=>AS(n.collectionOrder)-AS(r.collectionOrder)),i}function kSe({tournamentRecord:t,drawDefinition:e,structureId:i,matchUpId:n,orderMap:r,eventId:a,matchUp:o,event:s}){if(typeof r!="object"||!Object.values(r).every(l=>bi(l)))return fe({result:{error:Me},context:{orderMap:r}});if(a&&s!=null&&s.tieFormat)RX({tournamentRecord:t,event:s,orderMap:r});else if(n){let l=e&&ar({drawDefinition:e,matchUpId:n});if(l!=null&&l.error)return l;if(o=l.matchUp,!o)return{error:cl};o!=null&&o.tieFormat&&(o.tieFormat=XS({tieFormat:o.tieFormat,orderMap:r}),sn({tournamentId:t==null?void 0:t.tournamentId,eventId:s==null?void 0:s.eventId,drawDefinition:e,matchUp:o}))}else if(i){let l=pi({drawDefinition:e,structureId:i});if(l.error)return l;let c=l.structure;if(c!=null&&c.tieFormat)c.tieFormat=XS({tieFormat:c.tieFormat,orderMap:r}),xSe({eventId:s==null?void 0:s.eventId,tournamentRecord:t,drawDefinition:e,structure:c,orderMap:r}),er({drawDefinition:e,structureIds:[c.structureId]});else if(e.tieFormat)jj({structureIds:[i],tournamentRecord:t,drawDefinition:e,orderMap:r,event:s});else if(s!=null&&s.tieFormat)RX({structureIds:[i],tournamentRecord:t,orderMap:r,event:s});else return{error:Wo}}else if(e!=null&&e.tieFormat)jj({tournamentRecord:t,drawDefinition:e,orderMap:r,event:s});else return{error:Wo};return{...ue}}function RX({tournamentRecord:t,structureIds:e,orderMap:i,event:n}){let r=XS({tieFormat:n.tieFormat,orderMap:i});e!=null&&e.length||(n.tieFormat=r);for(let a of n.drawDefinitions??[])jj({tournamentRecord:t,drawDefinition:a,structureIds:e,orderMap:i,event:n})}function jj({tournamentRecord:t,drawDefinition:e,structureIds:i,orderMap:n,event:r}){let a=e.tieFormat??(r==null?void 0:r.tieFormat),o=XS({tieFormat:a,orderMap:n});i!=null&&i.length||(e.tieFormat=o);let s=[];for(let l of e.structures??[])i!=null&&i.length&&!i.includes(l.structureId)||((l.tieFormat||i!=null&&i.includes(l.structureId))&&(l.tieFormat=XS({tieFormat:l.tieFormat??e.tieFormat??(r==null?void 0:r.tieFormat),orderMap:n})),xSe({eventId:r==null?void 0:r.eventId,tournamentRecord:t,drawDefinition:e,structure:l,orderMap:n}),s.push(l.structureId));er({drawDefinition:e,structureIds:s})}function xSe({tournamentRecord:t,drawDefinition:e,structure:i,orderMap:n,eventId:r}){var a;let o=(a=Sn({matchUpFilters:{matchUpTypes:[Jn]},structure:i}))==null?void 0:a.matchUps;for(let s of o)s.tieFormat&&(s.tieFormat=XS({tieFormat:s.tieFormat,orderMap:n}),sn({tournamentId:t==null?void 0:t.tournamentId,drawDefinition:e,eventId:r,matchUp:s}))}function G7({updateInProgressMatchUps:t=!0,tieFormatComparison:e,tournamentRecord:i,drawDefinition:n,tieFormatName:r,collectionId:a,structureId:o,matchUpId:s,eventId:l,matchUp:c,event:u}){var d,p,h,f,m,g;let v="removeCollectionDefinition",y=c?void 0:py({drawDefinition:n,structureId:o,matchUpId:s,eventId:l,event:u});if(y!=null&&y.error)return fe({result:y,stack:v});let b=y==null?void 0:y.structure;c=c??(y==null?void 0:y.matchUp);let I=y==null?void 0:y.tieFormat,T=So(I);if(y=ul({tieFormat:T}),y.error)return fe({result:y,stack:v});let w=(d=T==null?void 0:T.collectionDefinitions)==null?void 0:d.find(_=>_.collectionId===a);if(!w)return fe({result:{error:Wo,collectionId:a}});T.collectionDefinitions=T.collectionDefinitions.filter(_=>_.collectionId!==a),w.collectionGroupNumber&&(T.collectionDefinitions=T.collectionDefinitions.map(_=>{let{collectionGroupNumber:x,...O}=_;return O}),T.collectionGroups=T.collectionGroups.filter(({groupNumber:_})=>_!==w.collectionGroupNumber));let{aggregateValue:S,valueGoal:D}=Tw(T);T.winCriteria=qt({aggregateValue:S,valueGoal:D});let E=I==null?void 0:I.winCriteria.valueGoal,C=I==null?void 0:I.winCriteria.aggregateValue;(E&&E!==D||S&&!C)&&(r?T.tieFormatName=r:delete T.tieFormatName);let P=[];s&&c?P=[c]:o&&b?P=((p=Sn({matchUpFilters:{matchUpTypes:[Jn]},structure:b}))==null?void 0:p.matchUps)??[]:n?P=((h=Hs({matchUpFilters:{matchUpTypes:[Jn]},drawDefinition:n}))==null?void 0:h.matchUps)??[]:u&&(P=((f=pm({matchUpFilters:{matchUpTypes:[Jn]},drawDefinition:n}))==null?void 0:f.matchUps)??[]);let R=(P||[]).filter(_=>{var x,O,B;let F=(O=(x=_.tieMatchUps)==null?void 0:x.filter(H=>H.collectionId===a))==null?void 0:O.some(uo),G=e&&_.tieFormat?(B=Hf({descendant:_.tieFormat,ancestor:T}))==null?void 0:B.different:!1;return t&&!F||!_.winningSide&&_.matchUpStatus!==ia&&(t||_.matchUpStatus!==Hu&&!uo(_)&&!G)});if(!R.length)return{error:sU};let{appliedPolicies:N}=Mn({tournamentRecord:i});if(s&&c&&t){let _=(m=c.tieMatchUps)==null?void 0:m.filter(x=>x.collectionId===a);for(let x of _??[]){let O=jR({matchUpId:x.matchUpId,tieMatchUpId:c==null?void 0:c.matchUpId,winningSide:void 0,removeScore:!0,tournamentRecord:i,appliedPolicies:N,drawDefinition:n,event:u});if(O.error||(O=ar({drawDefinition:n,matchUpId:s}),O.error))return O;c=O==null?void 0:O.matchUp}}let M=[];for(let _ of R){for(let x of(_==null?void 0:_.sides)??[])x.lineUp=(x.lineUp??[]).map(O=>({participantId:O.participantId,collectionAssignments:((O==null?void 0:O.collectionAssignments)??[]).filter(B=>B.collectionId!==a)}));if(_.tieMatchUps=(_.tieMatchUps??[]).filter(x=>{let O=x.collectionId===a;return O&&M.push(x.matchUpId),!O}),_.tieFormat&&(_.tieFormat=So(T)),t){let x=hm({matchUpId:_.matchUpId,exitWhenNoValues:!0,tournamentRecord:i,appliedPolicies:N,drawDefinition:n,event:u});if(x.error)return x}sn({tournamentId:i==null?void 0:i.tournamentId,eventId:u==null?void 0:u.eventId,drawDefinition:n,context:v,matchUp:_})}M.length&&lm({tournamentId:i==null?void 0:i.tournamentId,matchUpIds:M,eventId:u==null?void 0:u.eventId,drawDefinition:n});let A=qt(T);if(y=ul({tieFormat:A}),y.error)return fe({result:y,stack:v});if(l&&u)u.tieFormat=A;else if(s&&c)c.tieFormat=A;else if(b)b.tieFormat=A;else if(n)n.tieFormat=A;else if(!c||!n)return{error:Lt};if(er({drawDefinition:n,eventId:u==null?void 0:u.eventId}),(g=N==null?void 0:N.audit)==null?void 0:g[uI]){let _=qt({drawId:n==null?void 0:n.drawId,action:v,collectionId:a,structureId:o,matchUpId:s,eventId:l});LF({drawDefinition:n,auditData:_})}return{tieFormat:A,deletedMatchUpIds:M,targetMatchUps:R,...ue}}function OSe({updateInProgressMatchUps:t=!0,tournamentRecord:e,groupDefinition:i,drawDefinition:n,collectionIds:r,tieFormatName:a,structureId:o,matchUpId:s,matchUp:l,eventId:c,event:u}){let d="addCollectionGroup";if(!Array.isArray(r))return fe({result:{error:Ht},stack:d});let p=l?void 0:py({drawDefinition:n,structureId:o,matchUpId:s,eventId:c,event:u});if(p!=null&&p.error)return fe({result:p,stack:d});let h=p==null?void 0:p.structure;l=l||(p==null?void 0:p.matchUp);let f=p==null?void 0:p.tieFormat,m=f==null?void 0:f.winCriteria.valueGoal,g=So(f);if(p=ul({tieFormat:g}),p.error)return fe({result:p,stack:d});for(let y of g.collectionDefinitions){let{collectionId:b,collectionGroupNumber:I}=y;if(I&&r.includes(b))return fe({info:"collectionIds cannot be part of other collectionGroups",result:{error:Me},stack:d})}let v=(g.collectionGroups||[]).reduce((y,b)=>b.groupNumber>y?b.groupNumber:y,0)+1;return i.groupNumber=v,g.collectionDefinitions=g.collectionDefinitions.map(y=>r.includes(y.collectionId)?{...y,collectionGroupNumber:v}:y),g.collectionGroups=[...g.collecitonGroups||[],i],ASe({updateInProgressMatchUps:t,originalValueGoal:m,tournamentRecord:e,drawDefinition:n,tieFormatName:a,structureId:o,structure:h,tieFormat:g,matchUpId:s,matchUp:l,eventId:c,event:u})}function H7({updateInProgressMatchUps:t=!0,collectionDefinition:e,referenceCategory:i,tournamentRecord:n,policyDefinitions:r,enforceCategory:a,referenceGender:o,drawDefinition:s,tieFormatName:l,enforceGender:c,structureId:u,matchUpId:d,matchUp:p,eventId:h,uuids:f,event:m}){var g,v,y;let b="addCollectionDefinition",I=Mn({tournamentRecord:n,drawDefinition:s,event:m}).appliedPolicies??{},T=(r==null?void 0:r[eo])??(I==null?void 0:I[eo]);a=a??((g=T==null?void 0:T.participants)==null?void 0:g.enforceCategory);let w=(c??((v=T==null?void 0:T.participants)==null?void 0:v.enforceGender))!==!1,S=!!((i??(m==null?void 0:m.category))&&a!==!1),D=!!((o??(m==null?void 0:m.gender))&&w),E=PR({referenceCategory:i??(m==null?void 0:m.category),collectionDefinition:e,referenceGender:o,checkCategory:S,checkGender:D,event:m});if(E.error)return fe({result:E,stack:b});let C=p!=null&&p.tieFormat?void 0:py({drawDefinition:s,structureId:u,matchUpId:d,eventId:h,event:m});if(C!=null&&C.error)return fe({result:{error:C.error},stack:b});let P=C==null?void 0:C.structure;p=p??(C==null?void 0:C.matchUp);let R=(p==null?void 0:p.tieFormat)??(C==null?void 0:C.tieFormat),N=So(R);if(C=ul({tieFormat:N}),C==null?void 0:C.error)return fe({result:{error:C.error},stack:b});if(!e.collectionId)e.collectionId=xn();else if(N.collectionDefinitions.map(({collectionId:H})=>H).includes(e.collectionId))return fe({context:{collectionId:e.collectionId},result:{error:yme}});N.collectionDefinitions.push(e),N.collectionDefinitions.sort((H,$)=>(H.collectionOrder||0)-($.collectionOrder||0)).forEach((H,$)=>H.collectionOrder=$+1);let{aggregateValue:M,valueGoal:A}=Tw(N);N.winCriteria=qt({aggregateValue:M,valueGoal:A});let _=R==null?void 0:R.winCriteria.valueGoal,x=R==null?void 0:R.winCriteria.aggregateValue;(_&&_!==A||M&&!x)&&(l?N.tieFormatName=l:delete N.tieFormatName);let O=[],B=[],F=[],G=qt(N);if(C=ul({tieFormat:G}),C==null?void 0:C.error)return fe({result:{error:C.error},stack:b});if(h&&m){m.tieFormat=G;for(let H of m.drawDefinitions??[])if(!H.tieFormat)for(let $ of H.structures??[]){if($.tieFormat)continue;let q=b$({updateInProgressMatchUps:t,collectionDefinition:e,structure:$,uuids:f});B.push(...q.newMatchUps),F.push(...q.targetMatchUps),O.push($.structureId)}MM({modifiedMatchUps:F,eventId:m==null?void 0:m.eventId,modifiedStructureIds:O,tournamentRecord:n,drawDefinition:s,addedMatchUps:B,stack:b})}else if(u&&P){P.tieFormat=G;let H=b$({updateInProgressMatchUps:t,collectionDefinition:e,structure:P,uuids:f});B.push(...H.newMatchUps),F=H.targetMatchUps,MM({modifiedMatchUps:F,eventId:m==null?void 0:m.eventId,modifiedStructureIds:O,tournamentRecord:n,drawDefinition:s,addedMatchUps:B,stack:b})}else if(d&&p){if(!K_({matchUp:p,updateInProgressMatchUps:t}))return fe({result:{error:t5},stack:b});p.tieFormat=G;let H=DR({collectionDefinition:e,matchUp:p,uuids:f});Array.isArray(p.tieMatchUps)||(p.tieMatchUps=[]),p.tieMatchUps.push(...H),B.push(...H),MM({modifiedMatchUps:[p],eventId:m==null?void 0:m.eventId,modifiedStructureIds:O,tournamentRecord:n,drawDefinition:s,addedMatchUps:B,stack:b})}else if(s){s.tieFormat=G;for(let H of s.structures??[]){let $=b$({updateInProgressMatchUps:t,collectionDefinition:e,structure:H,uuids:f});O.push(H.structureId),B.push(...$.newMatchUps),F.push(...$.targetMatchUps)}MM({modifiedMatchUps:F,eventId:m==null?void 0:m.eventId,tournamentRecord:n,drawDefinition:s,addedMatchUps:B,stack:b})}else return{error:Lt};if((y=I==null?void 0:I.audit)!=null&&y[uI]){let H=qt({drawId:s==null?void 0:s.drawId,collectionDefinition:e,action:b,structureId:u,matchUpId:d,eventId:h});LF({drawDefinition:s,auditData:H})}return{tieFormat:G,targetMatchUps:F,addedMatchUps:B,...ue}}function b$({updateInProgressMatchUps:t,collectionDefinition:e,structure:i,uuids:n}){var r;let a=[],o=((r=Sn({matchUpFilters:{matchUpTypes:[Jn]},structure:i}))==null?void 0:r.matchUps).filter(s=>K_({matchUp:s,updateInProgressMatchUps:t})&&!s.tieFormat);for(let s of o){let l=DR({collectionDefinition:e,matchUp:s,uuids:n});Array.isArray(s.tieMatchUps)||(s.tieMatchUps=[]),s.tieMatchUps.push(...l),a.push(...l)}return{newMatchUps:a,targetMatchUps:o}}function MM({modifiedStructureIds:t,tournamentRecord:e,modifiedMatchUps:i,drawDefinition:n,addedMatchUps:r,eventId:a,stack:o}){lg({tournamentId:e==null?void 0:e.tournamentId,matchUps:r,drawDefinition:n,eventId:a}),i==null||i.forEach(s=>{sn({tournamentId:e==null?void 0:e.tournamentId,drawDefinition:n,context:o,matchUp:s,eventId:a})}),er({structureIds:t,drawDefinition:n,eventId:a})}function LSe({updateInProgressMatchUps:t=!1,tieFormatComparison:e,modifiedTieFormat:i,tournamentRecord:n,drawDefinition:r,structureId:a,matchUpId:o,eventId:s,uuids:l,event:c}){let u="modifyTieFormat";if(!ul({tieFormat:i}).valid)return fe({result:{error:nf},info:"falied validation",stack:u});let d=py({drawDefinition:r,structureId:a,matchUpId:o,eventId:s,event:c});if(d.error)return fe({result:d,stack:u});let{matchUp:p,tieFormat:h}=d,f=So(h),m=Hf({descendant:i,ancestor:f});if(m.invalid)return fe({context:{invalid:m.invalid},result:{error:nf},stack:u});if(!(m!=null&&m.different))return fe({result:{...ue},info:"Nothing to do",stack:u});let g=f.collectionDefinitions.map(({collectionId:D})=>D),v=i.collectionDefinitions.map(({collectionId:D})=>D),y=g.filter(D=>!v.includes(D)),b=i.collectionDefinitions.filter(({collectionId:D})=>!g.includes(D)),I=b.map(Ol("collectionId")),T=[],w,S=i.tieFormatName;for(let D of i.collectionDefinitions){if(I.includes(D.collectionId))continue;let E=j7({updateInProgressMatchUps:t,...D,tournamentRecord:n,tieFormatName:S,drawDefinition:r,structureId:a,matchUpId:o,eventId:s,event:c});if(E.modifications&&T.push(...E.modifications),E.error)return fe({result:E,stack:u});E.tieFormat&&(w=E.tieFormat)}for(let D of b){let E=H7({updateInProgressMatchUps:t,collectionDefinition:D,tournamentRecord:n,drawDefinition:r,tieFormatName:S,structureId:a,matchUpId:o,matchUp:p,eventId:s,uuids:l,event:c});if(E.error)return fe({result:E,stack:u});E.tieFormat&&(w=E.tieFormat)}for(let D of y){let E=G7({updateInProgressMatchUps:t,tieFormatComparison:e,tournamentRecord:n,drawDefinition:r,tieFormatName:S,collectionId:D,structureId:a,matchUpId:o,eventId:s,matchUp:p,event:c});if(E.error)return fe({result:E,stack:u});E.tieFormat&&(w=E.tieFormat)}return(h==null?void 0:h.tieFormatName)!==S?(w.tieFormatName=S,T.push({tieFormatName:S})):(T.length||I.length||y.length)&&(delete w.tieFormatName,T.push("tieFormatName removed: modifications without new tieFormatName")),w.collectionDefinitions=w.collectionDefinitions.sort((D,E)=>AS(D.collectionOrder)-AS(E.collectionOrder)).map((D,E)=>({...D,collectionOrder:E+1})),{processedTieFormat:So(w),modifications:T,...ue}}function FSe({tournamentRecord:t}){if(!t)return{error:it};let e=0;for(let i of t.events??[]){let n=i.tieFormats??[],r=u=>{if(!u.tieFormat)return;let d;for(let p of n)Hf({descendant:u.tieFormat,ancestor:p}).different||(d=p.tieFormatId);if(d)u.tieFormatId=d,delete u.tieFormat;else{let p=$t(u.tieFormat,void 0,!0);p.tieFormatId||(p.tieFormatId=xn()),u.tieFormatId=p.tieFormatId,delete u.tieFormat,n.push(p),e+=1}},a=i.eventType;r({tieFormat:i.tieFormat,eventType:a});for(let u of i.drawDefinitions??[]){r({tieFormat:u.tieFormat,eventType:a});for(let d of u.structures??[])r({tieFormat:d.tieFormat,eventType:a})}let o=(u,d)=>{var p;let h=(p=l.matchUps)==null?void 0:p.find(f=>f.matchUpId===u);h&&(h.tieFormatId=d,delete h.tieFormat,sn({tournamentId:t==null?void 0:t.tournamentId,eventId:i.eventId,matchUp:h}))},s=u=>{let d=$t(u.tieFormat,void 0,!0);d.tieFormatId||(d.tieFormatId=xn()),n.push(d),e+=1,o(u.matchUpId,d.tieFormatId)},l=pm({matchUpFilters:{matchUpTypes:[Ip]},event:i}),c=l.matchUps??[];for(let u of c){let d;for(let p of n)u.tieFormat&&Hf({descendant:u.tieFormat,ancestor:p}).different||(d=p.tieFormatId);d?o(u.matchUpId,d):s(u)}n.length&&(i.tieFormats=n)}return{...ue,addedCount:e}}var BSe={};zi(BSe,{addDrawDefinitionExtension:()=>pL,addEventExtension:()=>Bg,addEventTimeItem:()=>Iw,addExtension:()=>un,addNotes:()=>BL,addOnlineResource:()=>GSe,addParticipantExtension:()=>tge,addParticipantTimeItem:()=>G6,addTimeItem:()=>Vg,addTournamentExtension:()=>k5,addTournamentTimeItem:()=>bw,analyzeDraws:()=>NR,analyzeTournament:()=>F8,getAllowedDrawTypes:()=>aF,getAllowedMatchUpFormats:()=>x8,getAppliedPolicies:()=>Mn,getCompetitionDateRange:()=>sF,getCompetitionPenalties:()=>O8,getPolicyDefinitions:()=>cm,getTournamentInfo:()=>Sw,getTournamentPenalties:()=>oF,getTournamentPersons:()=>L8,getTournamentStructures:()=>V6,getTournamentTimeItem:()=>dR,mutate:()=>$Se,query:()=>ZIe,removeDrawDefinitionExtension:()=>ige,removeEventExtension:()=>hL,removeExtension:()=>Ss,removeNotes:()=>Pye,removeParticipantExtension:()=>nge,removeTournamentExtension:()=>x5,setTournamentCategories:()=>qSe,setTournamentDates:()=>FF,setTournamentEndDate:()=>KSe,setTournamentName:()=>HSe,setTournamentNotes:()=>zSe,setTournamentStartDate:()=>WSe,setTournamentStatus:()=>jSe});var $Se={};zi($Se,{addDrawDefinitionExtension:()=>pL,addEventExtension:()=>Bg,addEventTimeItem:()=>Iw,addExtension:()=>un,addNotes:()=>BL,addOnlineResource:()=>GSe,addParticipantExtension:()=>tge,addParticipantTimeItem:()=>G6,addTimeItem:()=>Vg,addTournamentExtension:()=>k5,addTournamentTimeItem:()=>bw,removeDrawDefinitionExtension:()=>ige,removeEventExtension:()=>hL,removeExtension:()=>Ss,removeNotes:()=>Pye,removeParticipantExtension:()=>nge,removeTournamentExtension:()=>x5,setTournamentCategories:()=>qSe,setTournamentDates:()=>FF,setTournamentEndDate:()=>KSe,setTournamentName:()=>HSe,setTournamentNotes:()=>zSe,setTournamentStartDate:()=>WSe,setTournamentStatus:()=>jSe});var u8e="ABANDONED",d8e="ACTIVE",p8e="CANCELLED",h8e="COMPLETED",f8e="IN_PROGRESS",VSe={ABANDONED:u8e,ACTIVE:d8e,CANCELLED:p8e,COMPLETED:h8e,IN_PROGRESS:f8e};function jSe({tournamentRecord:t,status:e}){return t?e&&!Object.keys(VSe).includes(e)?{error:Me,info:"Unknown status"}:(t.tournamentStatus=e,{...ue}):{error:it}}function GSe({tournamentRecord:t,onlineResource:e,organisationId:i,participantId:n,personId:r,courtId:a,venueId:o}){var s,l,c;if(!t)return{error:it};if(!sr(e))return{error:Ht};if(Wr(Object.keys(e),["resourceSubType","resourceType","identifier"]).length!==3)return fe({result:{error:om},context:{onlineResource:e}});if(i){if(((s=t.parentOrganisation)==null?void 0:s.parentOrganisationId)!==i)return fe({result:{error:Wo}});t.parentOrganisation.onlineResources||(t.parentOrganisation.onlineResources=[]),t.parentOrganisation.onlineResources.push(e)}else if(n||r){let u=(t.participants??[]).find(d=>{var p;return r&&((p=d.person)==null?void 0:p.personId)===r||d.participantId===n});if(!u)return fe(r?{result:{error:Wo}}:{result:{error:Jr}});if(r){if(((l=u.person)==null?void 0:l.personId)!==r)return fe({result:{error:rU}});u.person.onlineResources||(u.person.onlineResources=[]),u.person.onlineResources.push(e)}else u.onlineResources||(u.onlineResources=[]),u.onlineResources.push(e)}else if(a){let u=(c=(t.venues??[]).filter(d=>!o||d.venueId===o).flatMap(d=>(d.courts??[]).filter(p=>p.courtId===a)))==null?void 0:c[0];if(!u)return fe({result:{error:LP}});u.onlineResources||(u.onlineResources=[]),u.onlineResources.push(e)}else if(o){let u=(t.venues??[]).find(d=>d.venueId===o);if(!u)return fe({result:{error:oU}});u.onlineResources||(u.onlineResources=[]),u.onlineResources.push(e)}else t.onlineResources||(t.onlineResources=[]),t.onlineResources.push(e);return{...ue}}function HSe({tournamentRecord:t,promotionalName:e,tournamentName:i,formalName:n}){return t?(i&&(t.tournamentName=i),e&&(t.promotionalName=e),n&&(t.formalName=n),t.promotionalName===t.tournamentName&&delete t.promotionalName,t.formalName===t.tournamentName&&delete t.formalName,{...ue}):{error:it}}function zSe({tournamentRecord:t,notes:e}){return t?BL({element:t,notes:e}):{error:it}}function qSe({tournamentRecord:t,categories:e}){return t?(e=(e||[]).filter(i=>i.categoryName&&i.type),t.tournamentCategories=e,{...ue}):{error:it}}function m8e({tournamentRecord:t}){var e,i;if(!t)return{error:it};let{startDate:n,endDate:r}=t,a=_S(n,r),o=[];for(let s of t.venues||[])(e=s==null?void 0:s.courts)!=null&&e.length&&o.push(...s.courts);for(let s of o){let{startTime:l,endTime:c}=(s.dateAvailability??[]).reduce((p,h)=>{let f=on(p.startTime),m=on(p.endTime);return h.startTime&&on(h.startTime)<f&&(p.startTime=h.startTime),h.endTime&&on(h.endTime)>m&&(p.endTime=h.endTime),p},{startTime:"08:00",endTime:"18:00"}),u=a.map(p=>{var h;return((h=s.dateAvailability)==null?void 0:h.find(f=>f.date===p))??{date:p,startTime:l,endTime:c}}),d=(i=s.dateAvailability)==null?void 0:i.find(p=>!p.date);d&&u.unshift(d),s.dateAvailability=u}return{...ue}}function FF(t){var e;let{tournamentRecord:i,startDate:n,endDate:r}=t,a=mn(t,[{tournamentRecord:!0},{[C5]:{startDate:!1,endDate:!1},[Sh]:Cs,[nd]:p=>Th.test(p)}]);if(a.error)return a;if(r&&n&&new Date(r)<new Date(n))return{error:Me};let o;(n&&i.startDate&&new Date(n)>new Date(i.startDate)||r&&i.endDate&&new Date(r)<new Date(i.endDate))&&(o=!0);let s=_S(i.startDate,i.endDate);n&&(i.startDate=n),r&&(i.endDate=r);let l=_S(i.startDate,i.endDate),c=s.filter(p=>!l.includes(p)),u=l.filter(p=>!s.includes(p));for(let p of i.events??[])n&&p.startDate&&new Date(n)>new Date(p.startDate)&&(p.startDate=n),r&&p.endDate&&new Date(r)<new Date(p.endDate)&&(p.endDate=r);n&&i.endDate&&new Date(n)>new Date(i.endDate)&&(i.endDate=n),r&&i.startDate&&new Date(r)<new Date(i.startDate)&&(i.startDate=r);let d=o&&((e=g8e({tournamentRecord:i}))==null?void 0:e.unscheduledMatchUpIds);return m8e({tournamentRecord:i}),tn({topic:Mge,payload:{startDate:n,endDate:r}}),{...ue,unscheduledMatchUpIds:d,datesAdded:u,datesRemoved:c}}function WSe({tournamentRecord:t,startDate:e}){return FF({tournamentRecord:t,startDate:e})}function KSe({tournamentRecord:t,endDate:e}){return FF({tournamentRecord:t,endDate:e})}function g8e({tournamentRecord:t}){let e=co({tournamentRecord:t}).matchUps??[],i=t.startDate&&new Date(t.startDate),n=t.endDate&&new Date(t.endDate),r=[],a=[];for(let o of e){let{schedule:s,matchUpId:l}=o;if(s&&s.scheduledDate){let c=new Date(s.scheduledDate);(i&&c<i||n&&c>n)&&(a.push(l),r.includes(s.scheduledDate)||r.push(s.scheduledDate))}}return r.length&&!_F({scheduledDates:r,tournamentRecord:t}).clearedScheduleCount?{error:wfe}:{unscheduledMatchUpIds:a}}var YSe={};zi(YSe,{addCourt:()=>OF,addCourts:()=>B7,addVenue:()=>lR,deleteCourt:()=>rTe,deleteVenue:()=>K7,deleteVenues:()=>QSe,disableCourts:()=>eTe,disableVenues:()=>tTe,enableCourts:()=>iTe,enableVenues:()=>nTe,generate:()=>ZSe,generateCourts:()=>m7,getCompetitionVenues:()=>kR,getCourts:()=>i7,getVenuesAndCourts:()=>fm,modifyCourt:()=>Y7,modifyCourtAvailability:()=>q7,modifyVenue:()=>aTe,mutate:()=>XSe,publicFindVenue:()=>v6,query:()=>dwe});var ZSe={};zi(ZSe,{generateCourts:()=>m7});var XSe={};zi(XSe,{addCourt:()=>OF,addCourts:()=>B7,addVenue:()=>lR,deleteCourt:()=>rTe,deleteVenue:()=>K7,deleteVenues:()=>QSe,disableCourts:()=>eTe,disableVenues:()=>tTe,enableCourts:()=>iTe,enableVenues:()=>nTe,modifyCourt:()=>Y7,modifyCourtAvailability:()=>q7,modifyVenue:()=>aTe});function z7(t){if(!(t!=null&&t.tournamentRecord)&&!Array.isArray(t==null?void 0:t.venueMatchUps))return{error:it};if(!(t!=null&&t.courtId))return{error:iw};let{scheduleVisibilityFilters:e,tournamentRecord:i,matchUpFilters:n,venueMatchUps:r,courtId:a}=t,{schedulingProfile:o}=mm({tournamentRecord:i});if(Array.isArray(r))return{matchUps:l({matchUps:r,courtId:a})};let{matchUps:s}=co({scheduleVisibilityFilters:e,tournamentRecord:i,matchUpFilters:n});return{matchUps:l({matchUps:s,courtId:a})};function l({matchUps:c,courtId:u}){let d=c.filter(p=>{var h,f,m;let g=(f=(h=p.schedule)==null?void 0:h.allocatedCourts)==null?void 0:f.map(({courtId:v})=>v);return((m=p.schedule)==null?void 0:m.courtId)===u||(g==null?void 0:g.includes(u))});return G_({matchUps:d,schedulingProfile:o})}}function v8e({scheduleVisibilityFilters:t,tournamentRecord:e,matchUpFilters:i,venueId:n}){if(!e)return{error:it};if(!n)return{error:xg};let{schedulingProfile:r}=mm({tournamentRecord:e}),{matchUps:a}=co({scheduleVisibilityFilters:t,tournamentRecord:e,matchUpFilters:i});return{matchUps:o({matchUps:a,venueId:n})};function o({matchUps:s,venueId:l}){let c=s.filter(u=>{var d,p,h;let f=(p=(d=u.schedule)==null?void 0:d.allocatedCourts)==null?void 0:p.map(({venueId:m})=>m);return((h=u.schedule)==null?void 0:h.venueId)===l||(f==null?void 0:f.includes(l))});return G_({matchUps:c,schedulingProfile:r})}}function q7({tournamentRecord:t,dateAvailability:e,disableNotice:i,venueMatchUps:n,courtId:r,force:a}){var o,s,l;if(!t)return{error:it};if(!r)return{error:iw};let c=O0e({dateAvailability:e});if(c.error)return c;let{updatedDateAvailability:u,totalMergeCount:d}=y8e(e);e=u;let p=pw({tournamentRecord:t,courtId:r});if(p.error)return p;let{court:h,venue:f}=p,{matchUps:m}=z7({tournamentRecord:t,venueMatchUps:n,courtId:r});if(m!=null&&m.length){let g=(o=Mn({tournamentRecord:t}))==null?void 0:o.appliedPolicies,v=a??((l=(s=g==null?void 0:g[Fg])==null?void 0:s.allowDeletionWithScoresPresent)==null?void 0:l.courts),y=[];y.length&&(v||console.log("throw error: scheduled court matchUps",y.length))}return h&&(h.dateAvailability=e,!i&&f&&tn({payload:{venue:f,tournamentId:t.tournamentId},topic:xy,key:f.venueId})),{...ue,totalMergeCount:d}}function y8e(t){let e=0,i=t.reduce((r,a)=>{let{date:o,startTime:s,endTime:l,bookings:c}=a;return r[o]||(r[o]=[]),r[o].push({startTime:s,endTime:l,bookings:c}),r},{}),n=[];return Object.keys(i).forEach(r=>{i[r].sort(j6e);let{mergedAvailability:a,mergeCount:o}=b8e(i[r]);n.push(...a.map(s=>({date:r,...s}))),e+=o}),{updatedDateAvailability:n,totalMergeCount:e}}function b8e(t){let e,i,n,r=t.length,a=0,o=[];for(;t.length&&r;){let l=t.shift(),{startTime:c,endTime:u,bookings:d}=l;if(r-=1,!e)e=c,n=d,i=u;else if(jP(ca(i),ca(c),!1)>0){let p={startTime:e,endTime:i};n!=null&&n.length&&(p.bookings=n),o.push(p),e=c,n=d,i=u}else d&&(n?n.push(d):n=d),i=u,a+=1}let s={startTime:e,endTime:i};return n!=null&&n.length&&(s.bookings=n),o.push(s),{mergedAvailability:o,mergeCount:a}}function W7({matchUpsCount:t=0}){let e=`Schedule would be deleted from ${t} ${t===1?"matchUp":"matchUps"}; use { force: true }`;return{error:Tme,info:e}}function JSe({tournamentRecord:t,drawDefinition:e,matchUpId:i,drawId:n}){let r="removeCourtAssignment";if(!i)return{error:_o};if(!e&&!n)return{error:Rd};let a;if(!e){if(!t)return{error:it};({drawDefinition:e}=Ks({tournamentRecord:t,drawId:n}))}if(e)({matchUp:a}=ar({drawDefinition:e,matchUpId:i}));else{if(!t)return{error:it};let o=co({tournamentRecord:t,inContext:!1}).matchUps??[];({matchUp:a}=Cye({matchUps:o,matchUpId:i}))}return a?(a.timeItems&&a.timeItems.find(o=>[ay,jf].includes(o.itemType))&&(a.timeItems=a.timeItems.filter(({itemType:o})=>![ay,jf].includes(o)),sn({tournamentId:t==null?void 0:t.tournamentId,context:r,drawDefinition:e,matchUp:a})),{...ue}):{error:qo}}function K7(t){var e,i,n;if(typeof(t==null?void 0:t.venueId)!="string")return{error:xg};let{tournamentRecord:r,venueId:a,force:o}=t,s=t.tournamentRecords||r&&{[r.tournamentId]:r}||{};if(!Object.keys(s).length)return{error:it};let l=Ud({tournamentRecords:s,contextFilters:{venueIds:[a]}}).matchUps??[],c=(e=Mn({tournamentRecord:r}))==null?void 0:e.appliedPolicies,u=o??((n=(i=c==null?void 0:c[Fg])==null?void 0:i.allowDeletionWithScoresPresent)==null?void 0:n.venues);if(!l.length||u)for(let d of Object.values(s)){for(let h of l){let f=JSe({matchUpId:h.matchUpId,drawId:h.drawId,tournamentRecord:d});if(f.error)return f}let p;d.venues=(d.venues??[]).filter(h=>(h==null?void 0:h.venueId)!==a?!0:(p=!0,!1)),p&&tn({payload:{venueId:a,tournamentId:d.tournamentId},topic:X5,key:a})}else return W7({matchUpsCount:l.length});return OR({tournamentRecords:s}),{...ue}}function QSe({tournamentRecord:t,venueIds:e,force:i}){if(!t)return{error:it};if(!Array.isArray(e))return{error:Me};for(let n of t.venues||[]){let{venueId:r}=n;if(e.includes(r)){let{venueId:a}=n,o=K7({tournamentRecord:t,venueId:a,force:i});if(o.error)return o}}return{...ue}}function eTe(t){let{courtIds:e,dates:i}=t,n=_p(t),r=[{[Ko]:!0,[uL]:!0}],a=mn(t,r);if(a.error)return a;for(let o of Object.values(n))I8e({tournamentRecord:o,courtIds:e,dates:i});return{...ue}}function I8e({tournamentRecord:t,courtIds:e,dates:i}){let n=Array.isArray(i)&&i.length?{dates:i}:!0,r=a=>un({extension:{value:n,name:md},creationTime:!1,element:a});for(let a of t.venues||[])for(let o of a.courts||[])if(e!=null&&e.includes(o.courtId)){let s=r(o);if(s.error)return s}return{...ue}}function tTe(t){let{tournamentRecords:e,tournamentId:i,venueIds:n}=t,r=[{[Ko]:!0,[dL]:!0}],a=mn(t,r);if(a.error)return a;let o=Object.keys(e).filter(s=>!i||s===i);for(let s of o){let l=e[s];w8e({tournamentRecord:l,venueIds:n})}return{...ue}}function w8e({tournamentRecord:t,venueIds:e}){for(let i of t.venues||[])if(e!=null&&e.includes(i.venueId)){let n=un({creationTime:!1,element:i,extension:{name:md,value:!0}});if(n.error)return n}return{...ue}}function iTe(t){let e=_p(t),i=[{[Ko]:!0}];!t.enableAll&&i.push({[uL]:!0});let n=mn(t,i);if(n.error)return n;let{enableAll:r,courtIds:a,dates:o}=t;for(let s of Object.values(e))S8e({tournamentRecord:s,courtIds:a,enableAll:r,dates:o});return{...ue}}function S8e({tournamentRecord:t,courtIds:e,enableAll:i,dates:n}){for(let r of t.venues||[])for(let a of r.courts||[])if(i||e!=null&&e.includes(a.courtId))if(Array.isArray(n)){let{extension:o}=Bi({element:a,name:md});if(o){let s=o.value;Array.isArray(s.dates)&&(s.dates=s.dates.filter(l=>!n.includes(l))),un({extension:{name:md,value:s},creationTime:!1,element:a})}}else Ss({element:a,name:md});return{...ue}}function nTe(t){let e=_p(t),i=[{[Ko]:!0}];!t.enableAll&&i.push({[dL]:!0});let n=mn(t,i);if(n.error)return n;let{venueIds:r,enableAll:a}=t;for(let o of Object.values(e))for(let s of o.venues||[])(a||r!=null&&r.includes(s.venueId))&&Ss({element:s,name:md});return{...ue}}function rTe(t){let{courtId:e,disableNotice:i,force:n}=t,r=_p(t),a=mn(t,[{[Ko]:!0,[qme]:!0}]);if(a.error)return a;let o,s;for(let l of Object.values(r)){if(s=T8e({tournamentRecord:l,disableNotice:i,courtId:e,force:n}),s.error&&s.error!==LP)return s;s.success&&(o=!0)}return o?{...ue}:s}function T8e({tournamentRecord:t,disableNotice:e,courtId:i,force:n}){var r,a,o;let s=pw({tournamentRecord:t,courtId:i});if(s.error)return s;let l=s.venue,{matchUps:c}=z7({tournamentRecord:t,courtId:i}),u=(r=Mn({tournamentRecord:t}))==null?void 0:r.appliedPolicies,d=n??((o=(a=u==null?void 0:u[Fg])==null?void 0:a.allowDeletionWithScoresPresent)==null?void 0:o.courts);if(!(c!=null&&c.length)||d){for(let p of c??[]){let h=JSe({matchUpId:p.matchUpId,drawId:p.drawId,tournamentRecord:t});if(h.error)return h}l&&(l.courts=(l.courts??[]).filter(p=>p.courtId!==i),e||tn({payload:{venue:l,tournamentId:t.tournamentId},topic:xy,key:l.venueId}))}else return W7({matchUpsCount:c.length});return{...ue}}function Y7(t){let{disableNotice:e,modifications:i,courtId:n,force:r,venueMatchUps:a}=t,o=_p(t);if(!Object.keys(o).length)return{error:_r};let s,l;for(let c of Object.values(o)){let u=U8e({tournamentRecord:c,disableNotice:e,venueMatchUps:a,modifications:i,courtId:n,force:r});if(u!=null&&u.error)return u;s=!0}return s?{...ue}:l}function U8e({tournamentRecord:t,disableNotice:e,venueMatchUps:i,modifications:n,courtId:r,force:a}){if(!t)return{error:it};if(!r)return{error:iw};if(!n||typeof n!="object")return{error:om};let o=pw({tournamentRecord:t,courtId:r});if(o.error)return o;let{venue:s,court:l}=o,c=Object.keys(V6e()).filter(p=>p!=="courtId");if(!Object.keys(n).filter(p=>c.includes(p)).length)return{error:rL};let u=c.filter(p=>!["dateAvailability"].includes(p)),d=Object.keys(n).filter(p=>u.includes(p));if(l&&d.forEach(p=>Object.assign(l,{[p]:n[p]})),n.dateAvailability){let p=q7({dateAvailability:n.dateAvailability,tournamentRecord:t,venueMatchUps:i,disableNotice:e,courtId:r,force:a});if(p.error)return p}return e||tn({payload:{venue:s,tournamentId:t.tournamentId},topic:xy,key:s==null?void 0:s.venueId}),{...ue,court:$t(l)}}var D8e=()=>({venueId:void 0,venueName:"",venueAbbreviation:"",onlineResources:[],venueType:void 0,addresses:[],contacts:[],courts:[],roles:[]}),E8e=D8e;function aTe(t){let{modifications:e,venueId:i,force:n}=t,r=_p(t);if(!Object.keys(r).length)return{error:_r};if(typeof i!="string")return{error:xg};let a,o;for(let s of Object.values(r)){let l=C8e({tournamentRecord:s,modifications:e,venueId:i,force:n});if(l.success&&(o=!0),l.error&&(a=l.error),l.error&&l.error!==oU)return l}return OR({tournamentRecords:r}),o?{...ue}:{error:a}}function C8e({tournamentRecord:t,modifications:e,venueId:i,force:n}){var r,a,o,s,l,c,u,d;if(!t)return{error:it};if(!e||typeof e!="object")return{error:om};if(!i)return{error:xg};let p=(r=Mn({tournamentRecord:t}))==null?void 0:r.appliedPolicies,h=n??((o=(a=p==null?void 0:p[Fg])==null?void 0:a.allowDeletionWithScoresPresent)==null?void 0:o.venues),{matchUps:f}=v8e({tournamentRecord:t,venueId:i}),m=um({tournamentRecord:t,venueId:i});if(m.error)return m;let g=m.venue,v=Object.keys(E8e()).filter(D=>D!=="venueId");if(!Object.keys(e).filter(D=>v.includes(D)).length)return{error:rL};let y=v.filter(D=>!["courts","onlineResources"].includes(D)),b=Object.keys(e).filter(D=>y.includes(D));g&&b.forEach(D=>Object.assign(g,{[D]:e[D]}));let I=((s=g==null?void 0:g.courts)==null?void 0:s.map(D=>D.courtId))??[],T=((l=e.courts)==null?void 0:l.map(D=>D.courtId))||[],w=T.length?I.filter(D=>!T.includes(D)):(e==null?void 0:e.courts)&&I,S=[];if(w!=null&&w.length){let D=(u=(c=g==null?void 0:g.courts)==null?void 0:c.filter(E=>w.includes(E.courtId)))==null?void 0:u.map(E=>{var C;let P=z7({courtId:E.courtId,tournamentRecord:t,venueMatchUps:f});for(let R of P.matchUps??[])S.push({matchUpId:R.matchUpId,drawId:R.drawId});return((C=P.matchUps)==null?void 0:C.length)??0}).reduce((E,C)=>E+C);if(g&&(!D||h))g.courts=(d=g.courts)==null?void 0:d.filter(E=>T.includes(E.courtId)),NE({schedule:{courtId:"",scheduledDate:""},matchUpDetails:S,removePriorValues:!0,tournamentRecord:t});else return W7({matchUpsCount:D})}if(e.courts)for(let D of e.courts){let{courtId:E}=D||{},C=Y7({modifications:D,disableNotice:!0,tournamentRecord:t,venueMatchUps:f,courtId:E,force:n});if(C.error===LP&&(C=OF({disableNotice:!0,tournamentRecord:t,venueId:i,court:D})),C.error)return C}return OR({tournamentRecord:t}),g&&tn({payload:{venue:g,tournamentId:t.tournamentId},topic:xy,key:g==null?void 0:g.venueId}),{...ue,venue:$t(g)}}var Z7={};zi(Z7,{JSON2CSV:()=>_8e,UUID:()=>xn,UUIDS:()=>eze,allNumeric:()=>Nme,attributeFilter:()=>sI,chunkArray:()=>so,chunkByNth:()=>XV,chunkSizeProfile:()=>Mme,constantToString:()=>Co,countValues:()=>cGe,createMap:()=>yfe,dateTime:()=>ZGe,definedAttributes:()=>qt,dehydrateMatchUps:()=>R8e,extractAttributes:()=>xge,flattenJSON:()=>X7,generateDateRange:()=>_S,generateHashCode:()=>Uje,generateRange:()=>Ct,generateTimeCode:()=>H0e,groupValues:()=>Pme,hasAttributeValues:()=>Tje,instanceCount:()=>xl,intersection:()=>Wr,isConvertableInteger:()=>bi,isNumeric:()=>Lr,isOdd:()=>Eme,isPowerOf2:()=>Td,makeDeepCopy:()=>$t,matchUpSort:()=>fw,nearestPowerOf2:()=>g5,nextPowerOf2:()=>lU,noNulls:()=>lGe,noNumeric:()=>Ame,numericSort:()=>va,occurrences:()=>dGe,overlap:()=>Ps,randomMember:()=>mu,randomPop:()=>Tl,shuffleArray:()=>vs,structureSort:()=>cw,subSort:()=>pGe,undefinedToNull:()=>VV,unique:()=>ki,visualizeScheduledMatchUps:()=>P8e});function P8e({scheduledMatchUps:t,showGlobalLog:e}){kze();let i=t==null?void 0:t.reduce((r,{structureId:a})=>r.includes(a)?r:r.concat(a),[]),n=Array.isArray(i)&&{...i.map(r=>{let{structureName:a,matchUpType:o}=t.find(s=>s.structureId===r);return{[r]:`${a} ${o}`}})};i==null||i.forEach(r=>{var a;kc({color:"blue",method:"draw",structure:n[r],keyColors:{structure:"magenta"}},!0);let o=t.filter(l=>l.structureId===r),s=((a=Rs({matchUps:o}))==null?void 0:a.roundMatchUps)||[];Object.keys(s).forEach(l=>{kc({roundNumber:l,keyColors:{roundNumber:"brightcyan"}},!0),s[l].forEach(({matchUpId:c,schedule:u})=>{let d=rr(u.scheduledTime);kc({matchUpId:c,time:d,date:u.scheduledDate,venue:u.venueId,keyColors:{time:"brightcyan",date:"brightcyan",matchUpId:"yellow",venue:"magenta"}},!0)})})}),e&&_ze()}function R8e({tournamentRecord:t}){if(!t)return{error:it};if(typeof t!="object"||!t.tournamentId)return{error:Me};let{matchUps:e}=co({tournamentRecord:t,inContext:!1});if(e!=null&&e.length){let i=M8e({tournamentRecord:t});A8e(e,i)}return{...ue}}function M8e({tournamentRecord:t}){let e={};for(let i of t.events||[]){i.matchUpFormat&&(e[i.eventId]=i.matchUpFormat);for(let n of i.drawDefinitions||[]){n.matchUpFormat&&(e[n.drawId]=n.matchUpFormat);for(let r of n.structures||[]){r.matchUpFormat&&(e[r.structureId]=r.matchUpFormat);for(let a of r.structures||[])a.matchUpFormat&&(e[a.structureId]=a.matchUpFormat)}}}return e}var N8e=["collectionId","collectionPosition","drawPositions","extensions","finishingPositionRange","finishingRound","isMock","matchUpId","matchUpStatus","matchUpStatusCodes","orderOfFinish","processCodes","roundNumber","tieFormat","tieMatchUps","roundPosition","score","sides","winnerMatchUpId","loserMatchUpId","matchUpDuration","winningSide"];function A8e(t,e={}){for(let i of t){let{structureId:n,drawId:r,eventId:a}=i,o=e[n]||e[r]||e[a],s=i.matchUpFormat===o?void 0:i.matchUpFormat;for(let l of Object.keys(i))N8e.includes(l)||delete i[l];i.sides&&i.drawPositions&&!i.tieMatchUps&&delete i.sides,s&&(i.matchUpFormat=s)}}function _8e(t,e){if(e&&typeof e!="object")return{error:Me};let{columnTransform:i={}}=e||{},{includeTransformAccessors:n,includeHeaderRow:r=!0,returnTransformedJSON:a,removeEmptyColumns:o,onlyHeaderRow:s,columnAccessors:l=[],functionMap:c={},columnMap:u={},valuesMap:d={},context:p={},delimiter:h='"',columnJoiner:f=",",rowJoiner:m=`\r
`,keyJoiner:g="."}=e||{};if(!Array.isArray(t)||!Array.isArray(l)||typeof p!="object"||typeof u!="object"||typeof i!="object"||typeof c!="object"||typeof d!="object"||typeof f!="string"||typeof m!="string"||typeof g!="string"||typeof h!="string")return{error:Me};i=Object.assign({},...Object.keys(i).reverse().map(M=>({[M]:Array.isArray(i[M])?i[M]:[typeof i[M]=="string"&&i[M]].filter(Boolean)})));let v=t.filter(Boolean).map(M=>X7(M,g)),y=Object.values(i).flat();n&&l.push(...y);let b=v.reduce((M,A)=>Object.keys(A).every(_=>!M.includes(_)&&M.push(_)||!0)&&M,[]).filter(M=>!(l!=null&&l.length)||l.includes(M)),I=Object.assign({},...Object.keys(i).reverse().map(M=>i[M].map(A=>({[A]:M})).flat()).flat()),T=(M,A)=>e!=null&&e.sortOrder?e.sortOrder.includes(M)&&e.sortOrder.includes(A)&&e.sortOrder.indexOf(M)-e.sortOrder.indexOf(A)||!e.sortOrder.includes(A)&&-1:0,w=b.reduce((M,A)=>{let _=I[A];return _?M.includes(_)||M.push(_):M.push(A),M},[]).sort(T);Object.keys(u).forEach(M=>!w.includes(M)&&w.unshift(M)),Object.keys(i).forEach(M=>!w.includes(M)&&w.unshift(M)),typeof p=="object"&&Object.keys(p).forEach(M=>!w.includes(M)&&w.unshift(M));let S=w.map(M=>u[M]||M);if(s)return[S];let D=M=>`${h}${M}${h}`,E=[],C=M=>Object.values(w.reduce((A,_,x)=>{var O;let B=i[_],F=(B!=null&&B.length?M[B.find($=>M[$])]:M[_])||(p==null?void 0:p[_])||"",G=((O=d[_])==null?void 0:O[F])||F,H=wl(c[_])?c[_](G):G;return A[_]=D(H),H&&(E[x]=(E[x]||0)+1),A},{})),P=v.map(C),R=o&&[...E].map((M,A)=>!M&&A).filter(Lr).reverse();if(R){let M=A=>A.filter((_,x)=>!R.includes(x));P=P.map(M),S=M(S)}let N=P.map(M=>M.join(f));return a?N.map(M=>{let A=M.split(f);return Object.assign({},...A.map((_,x)=>({[S[x]]:_})))}):r?[S.map(D).join(f),...N].join(m):N.join(m)}function X7(t,e=".",i=[]){return typeof t=="object"&&Object.keys(t).reduce((n,r)=>typeof t[r]!="object"?(n[i.concat(r).join(e)]=t[r],n):Object.assign(n,X7(t[r],e,i.concat(r))),{})}var{FACTORY:MX}=age;function k8e({tournamentRecord:t,value:e}){let{extension:i}=Bi({element:t,name:MX}),n={name:MX,value:{...i==null?void 0:i.value,...e}};un({element:t,extension:n})}function oTe({timeStamp:t}){let e=aw(),i=y5();return i&&Object.values(e).forEach(n=>{k8e({tournamentRecord:n,value:{version:KO(),timeStamp:t}})}),i}function sTe({engineType:t,methodName:e,elapsed:i,params:n,result:r}){var a,o;let s=jc();if(typeof s!="object")return;let l={method:e},c=(r==null?void 0:r.error)&&(s.errors===!0||Array.isArray(s.errors)&&s.errors.includes(e)),u=Array.isArray(s.params)&&((a=s.params)==null?void 0:a.includes(e)),d=s.params&&!Array.isArray(s.params)||u,p=Array.isArray(s.exclude)&&s.exclude.includes(e);!p&&![void 0,!1].includes(s.perf)&&!isNaN(s.perf)&&i>=s.perf&&(l.elapsed=i),!p&&(c||d)&&(l.params=n),!p&&(c||s.result&&!Array.isArray(s.result)&&(!Array.isArray(s.params)||u)||Array.isArray(s.result)&&(o=s.result)!=null&&o.includes(e))&&(l.result=r),Object.keys(l).length>1&&Vme(l,t)}function J7({methodName:t,params:e,start:i}){let n={error:oL,methodName:t},r=i?Date.now()-i:0;return sTe({result:n,methodName:t,elapsed:r,params:e,engineType:"sync"}),n}function x8e(t,e){var i;if(e._middleware===!1)return e;if(e.tournamentId&&!t[e.tournamentId])return{error:it};let n=e.drawId||((i=e.matchUp)==null?void 0:i.drawId);if(n){let{event:o,drawDefinition:s,tournamentId:l}=Ks({tournamentRecords:t,drawId:n});s&&(e.drawDefinition=s),l&&(e.tournamentId=l),o&&(e.event=o)}if(e.eventId&&!e.event){let{event:o,tournamentId:s}=Ks({eventId:e.eventId,tournamentRecords:t});if(!o)return{error:kl};e.tournamentId=s,e.event=o}let r=e.tournamentId??rw();if(!r&&e)return e;let a=t[r];return r&&!a?{error:it}:(a&&(e.tournamentRecord=a),e)}function Q7(t,e,i,n,r){delete t.success,delete t.error;let a=Date.now(),o=rw();i&&(i.activeTournamentId=o);let s=(i==null?void 0:i.tournamentRecord)||I5(o),l=typeof(i==null?void 0:i.tournamentRecord)=="object"&&{[i==null?void 0:i.tournamentRecord.tournamentId]:i.tournamentRecord}||aw(),c=i?$t(i,void 0,!0):void 0,u=i?x8e(l,i):void 0;if(u!=null&&u.error)return u;let d=O8e({params:u,tournamentRecords:l,tournamentRecord:s,methodName:n,method:e}),p=Date.now()-a;return sTe({result:d,methodName:n,elapsed:p,params:c,engineType:r}),d}function O8e({tournamentRecords:t,tournamentRecord:e,params:i,methodName:n,method:r}){if(jc())return r({tournamentRecords:t,tournamentRecord:e,...i});try{return r({tournamentRecords:t,tournamentRecord:e,...i})}catch(a){return cL({engineName:"engine",methodName:n,params:i,err:a})}}function BF(t){let{mutationStatus:e,tournamentId:i,directives:n,timeStamp:r}=t||{},{topics:a}=Gu();for(let o of[...a].sort(L8e)){let s=Fme({topic:o});s!=null&&s.length&&JV({topic:o,notices:s})}e&&r&&a.includes(nj)&&JV({notices:[{tournamentId:i,directives:n,timeStamp:r}],topic:nj})}var NX={[a6]:5,[r6]:5,[o6]:5,[n6]:5,[i6]:5,[e6]:5,[Pge]:5,[Rge]:5,[t6]:1,[SL]:1,[No]:5,[xy]:5,[Q5]:4,[Z5]:4,[X5]:4,[J5]:4,[wL]:3,[W5]:2};function L8e(t,e){return(NX[e]||0)-(NX[t]||0)}function F8e({convertExtensions:t,removeExtensions:e}){let i=aw();return{tournamentId:rw(),tournamentRecords:$t(i,t,!1,e)}}function B8e(t){let{convertExtensions:e=!1,removeExtensions:i=!1}=t??{},n=(t==null?void 0:t.tournamentId)??rw();if(typeof n!="string")return{};let r=I5(n);return{tournamentRecord:$t(r,e,!1,i)}}function $8e(){var t;let e=aw(),{extension:i}=Bi({name:lI,tournamentRecords:e,discover:!0}),n=((t=i==null?void 0:i.value)==null?void 0:t.tournamentIds)||[];return Object.keys(e).forEach(r=>{n.includes(r)||delete e[r]}),lL(e)}function AX(t,e=!0){return typeof t!="object"||Array.isArray(t)?{error:om}:t!=null&&t.tournamentId?Bme(e?$t(t):t):{error:Me}}function $F(t,e=!0){if(typeof t!="object")return{error:om};if(lE(),Array.isArray(t)){if(t.filter(i=>i==null?void 0:i.tournamentId).length!==t.length)return{error:HV};t=Object.assign({},...t.map(i=>({[i.tournamentId]:i})))}else if(t!=null&&t.tournamentId)t={[t.tournamentId]:t},lE(t.tournamentId);else if(!Object.keys(t).every(i=>t[i].tournamentId===i))return{error:HV};return lL(e?$t(t):t)}function V8e(t,e,i,n,r,a){let o=jme(i,n,r,a);if(o.error)return o;let s=o.methods??[];return Object.keys(s).filter(l=>wl(s[l])).forEach(l=>{t[l]=c=>{let u=()=>e(t,{[l]:s[l],...c});if(jc())return u();try{return u()}catch(d){cL({engineName:"engine",methodName:l,params:c,err:d})}}}),{...ue,...t}}function i0(t,e){return e!=null&&e.error?(t.error=e.error,t.success=!1):(t.error=void 0,t.success=!0),t}function lTe(t,e){t.importMethods=(i,n,r,a)=>V8e(t,e,i,n,r,a),t.getTournament=i=>B8e(i),t.getState=i=>F8e({convertExtensions:i==null?void 0:i.convertExtensions,removeExtensions:i==null?void 0:i.removeExtensions}),t.version=()=>KO(),t.reset=()=>(lL({}),i0(t)),t.devContext=i=>(oE(i),i0(t)),t.getDevContext=i=>jc(i),t.newTournamentRecord=(i={})=>{let n=I0e(i),r=n.tournamentId;return n.error?n:(AX(n),lE(r),{...ue,tournamentId:r})},t.setState=(i,n,r)=>{sE(n,r);let a=$F(i,n);return i0(t,a)},t.setTournamentId=i=>lE(i),t.getTournamentId=()=>rw(),t.setTournamentRecord=(i,n,r)=>{sE(n,r);let a=AX(i,n);return i0(t,a)},t.removeTournamentRecord=i=>{let n=$me(i);return i0(t,n)},t.removeUnlinkedTournamentRecords=()=>{let i=$8e();return i0(t,i)}}function j8e(t,e,i){if(!Array.isArray(e))return{error:Me,message:"directives must be an array"};let n=Lme(),r=Date.now(),a=i&&$t(aw(),!1,!0),o=[];for(let c of e){if(typeof c!="object")return{error:Me,message:"directive must be an object"};if(c.params&&typeof c.params!="object")return{error:Me,message:"params must be an object"};let{method:u,pipe:d}=c,p=c.params?{...c.params}:{};if(!n[u])return J7({methodName:u,start:r,params:p});if(d){let f=o[o.length-1],m=Object.keys(d);for(let g of m)f[g]&&(p[g]=f[g])}let h=Q7(t,n[u],p,u,"sync");if(h!=null&&h.error)return a&&$F(a),{...h,rolledBack:!!a};o.push({...h,methodName:u})}let s=Date.now(),l=oTe({timeStamp:s});return BF({directives:e,mutationStatus:l,timeStamp:s}),BP(),{success:o.every(c=>c.success),results:o}}function _X(t,e){if(!sr(e))return{error:Me,message:"args must be an object"};let i=Object.values(e).filter(wl).length;if(i>1)return{message:"there must be only one arg with typeof function",error:Me};let n=i?Object.keys(e).find(h=>wl(e[h])):qs(e.method)&&e.method;if(!n)return{error:oL};let{[n]:r,...a}=e,o=e!=null&&e.params?{...e.params}:{...a},s=o.rollbackOnError&&$t(aw(),!1,!0),l=r||t[n]||f5()[n];if(!l)return J7({methodName:n,params:o});let c=Q7(t,l,o,n,"sync")??{};c!=null&&c.error&&s&&$F(s);let u=Date.now(),d=oTe({timeStamp:u}),p=(c==null?void 0:c.success)&&(o==null?void 0:o.delayNotify)!==!0&&(o==null?void 0:o.doNotNotify)!==!0;return p&&BF({directives:[{method:l,params:o}],mutationStatus:d,timeStamp:u}),(p||!(c!=null&&c.success)||o!=null&&o.doNotNotify)&&BP(),c}var G8e=(()=>{let t={executionQueue:(e,i)=>j8e(t,e,i),execute:e=>_X(t,e)};return lTe(t,_X),t})(),e9=G8e;function kX(t,e){if(!sr(e))return{error:Me,message:"args must be an object"};let i=Object.values(e).filter(wl).length;if(i>1)return{message:"there must be only one arg with typeof function",error:Me};let n=i?Object.keys(e).find(l=>wl(e[l])):qs(e.method)&&e.method;if(!n)return{error:oL};let{[n]:r,...a}=e,o=e!=null&&e.params?{...e.params}:{...a},s=r||t[n]||f5()[n];return s?Q7(t,s,o,n,"ask"):J7({methodName:n,params:o})}(()=>{let t={execute:e=>kX(t,e)};return lTe(t,kX),t})();var jb={},Om;function xX(t,e=!0){if(!t)return{error:Ht};if(typeof t!="object")return{error:om};if(t.matchUpId)Om=t.matchUpId,jb[Om]=e?$t(t):t;else if(Array.isArray(t))for(let i of t.reverse())i.matchUpId&&(jb[i.matchUpId]=e?$t(i):i,Om||(Om=i.matchUpId));else for(let i of Object.values(t))i.matchUpId&&(jb[i.matchUpId]=e?$t(i):i,Om||(Om=i.matchUpId));return e?$t(t):t}function H8e(){return jb[Om]}function z8e(){return Object.values(jb)}function q8e(){Om=void 0,jb={}}function W8e(t){return $t(jb[Om],t==null?void 0:t.convertExtensions,!1,t==null?void 0:t.removeExtensions)}(()=>{let t={getState:r=>W8e(r),version:()=>KO(),reset:()=>(q8e(),{...ue}),drawId:void 0,error:void 0,success:!1,devContext:r=>(oE(r),t),setState:(r,a,o)=>{sE(a,o);let s=xX(r);return e(s)}};function e(r){return r!=null&&r.error?(t.error=r.error,t.success=!1):(t.error=void 0,t.success=!0,t.drawId=r.drawId),t}return i([b8]),t;function i(r){r.forEach(a=>{Object.keys(a).forEach(o=>{t[o]=s=>{if(jc())return n({params:s,governor:a,methodName:o});try{return n({params:s,governor:a,methodName:o})}catch(l){cL({engineName:"matchUpEngine",methodName:o,params:s,err:l})}}})})}function n({params:r,governor:a,methodName:o}){t.error=void 0,t.success=!1;let s=(r==null?void 0:r.matchUp)||H8e(),l=(r==null?void 0:r.matchUps)||z8e(),c=(r==null?void 0:r.rollbackOnError)&&$t(s,!1,!0);r={...r,matchUpId:s==null?void 0:s.matchUpId,matchUps:l,matchUp:s};let u=a[o](r);if(u!=null&&u.error)return c&&xX(c),{...u,rolledBack:!!c};let d=(u==null?void 0:u.success)&&(r==null?void 0:r.delayNotify)!==!0&&(r==null?void 0:r.doNotNotify)!==!0;return d&&BF(),(d||!(u!=null&&u.success)||r!=null&&r.doNotNotify)&&BP(),u}})();var I$=!1;(()=>{let t={version:()=>KO(),setDeepCopy:(n,r)=>(sE(n,r),t),devContext:n=>(oE(n),I$=!0,t)};return i([M7]),t;function e(n,r){let a=n({...r});return a!=null&&a.error||BF(),BP(),I$&&(oE(!1),I$=!1),a}function i(n){n.forEach(r=>{Object.keys(r).forEach(a=>{t[a]=o=>{try{let s=e(r[a],o);return!(s!=null&&s.error)&&o!=null&&o.setState&&s!=null&&s.tournamentRecord&&$F(s.tournamentRecord),s}catch(s){let l;typeof s=="string"?l=s.toUpperCase():s instanceof Error&&(l=s.message),console.log("ERROR",{params:JSON.stringify(o),method:a,error:l})}}})})}})();e9.importMethods(mfe,!0,1);var cTe=e9;function uTe(t,e){return t&&e&&Array.isArray(e)&&e[t-1]||typeof e=="object"&&e[t]}function K8e(t){let{participation:e={},awardProfiles:i,startDate:n,eventType:r,drawSize:a,drawType:o,category:s,endDate:l,level:c}=t,{participationOrder:u,flightNumber:d,rankingStage:p}=e,h=f=>!n&&!l||!f.dateRanges?!0:f.dateRanges.some(m=>{let g=!n||!m.startDate||new Date(n)>new Date(m.startDate),v=!l||!m.endDate||new Date(l)<=new Date(m.endDate);return g&&v});return{awardProfile:i.find(f=>{var m,g,v,y,b,I,T,w,S,D;return h(f)&&(!f.maxFlightNumber||d<=f.maxFlightNumber)&&(!((m=f.drawTypes)!=null&&m.length)||((g=f.drawTypes)==null?void 0:g.includes(o)))&&(!((v=f.drawSizes)!=null&&v.length)||f.drawSizes.includes(a))&&(!((y=f.stages)!=null&&y.length)||f.stages.includes(p))&&(!((b=f.levels)!=null&&b.length)||f.levels.includes(c))&&(!f.maxDrawSize||a<=f.maxDrawSize)&&(!f.drawSize||f.drawSize===a)&&(!f.maxLevel||c<=f.maxLevel)&&(!d||!((T=(I=f.flights)==null?void 0:I.flightNumbers)!=null&&T.length)||f.flights.flightNumbers.includes(d))&&(!f.participationOrder||f.participationOrder===u)&&(!((w=f.category)!=null&&w.ageCategoryCodes)||f.category.ageCategoryCodes.includes(s==null?void 0:s.ageCategoryCode))&&(!((S=f.eventTypes)!=null&&S.length)||((D=f.eventTypes)==null?void 0:D.includes(r)))})}}function OX({participantWon:t,flightNumber:e,valueObj:i,drawSize:n,flights:r,level:a}){var o,s;let l=(g,v)=>{if(g){if(Array.isArray(v)){let y=v.find(b=>b.flight===g||b.f===g);return y.value||y.v}if(typeof v=="object"){let y=v.flights||v.f;if(Array.isArray(y))return y[g-1]}}},c=(g,v)=>{let y=(g==null?void 0:g.value)||(g==null?void 0:g.v)||(bi(g)?g:0),b=uTe(a,g==null?void 0:g.level);return{value:l(v,b)||bi(b)&&b||y}},u=0,d,p,h,f,m=t&&"won"||t===!1&&"lost"||void 0;if(Array.isArray(i)){let g=i.find(b=>{var I;return b.drawSize===n||((I=b.drawSizes)==null?void 0:I.includes(n))}),v=i.find(b=>b.drawSize&&b.threshold&&n>b.drawSize),y=i.find(b=>{var I;return!b.drawSize&&!((I=b.drawSizes)!=null&&I.length)});m!==void 0&&(g=g==null?void 0:g[m],v=v==null?void 0:v[m],y=y==null?void 0:y[m]),p=c(g,e).value,h=c(v,e).value,f=c(y,e).value,u=p||h||f,d=p&&g.requireWin||h&&v.requireWin||(y==null?void 0:y.requireWin)}else if(typeof i=="object"){let g=(o=i==null?void 0:i.drawSizes)==null?void 0:o[n],v=i;m!==void 0&&(g=g==null?void 0:g[m],v=v==null?void 0:v[m]),p=c(g,e).value,f=c(v,e).value,u=p||f,d=p?g.requireWin:v==null?void 0:v.requireWin}else bi(i)&&m===void 0&&(u=i);return e&&(s=r==null?void 0:r.pct)!=null&&s[e]&&(u=Math.round(u*r.pct[e])),{awardPoints:u,requireWin:d}}function Y8e({participantFilters:t,policyDefinitions:e,tournamentRecord:i,level:n}){var r;if(!i)return{error:it};let{policyDefinitions:a}=cm({policyTypes:[BN],tournamentRecord:i}),o=(e==null?void 0:e[BN])??(a==null?void 0:a[BN]);if(!o)return{error:XO};let s=o.awardProfiles,l=o.requireWinFirstRound,c=o.requireWinForPoints,{participants:u,derivedEventInfo:d,derivedDrawInfo:p,mappedMatchUps:h}=Yr({withRankingProfile:!0,participantFilters:t,tournamentRecord:i}),f=u==null?void 0:u.filter(y=>{var b;return(b=y.draws)==null?void 0:b.length}),m={},g={},v={};for(let y of f??[]){let{participantType:b,participantId:I,person:T,draws:w}=y;for(let S of w){let{drawId:D,structureParticipation:E,eventId:C}=S,P=d[C],R=p[D],N=R==null?void 0:R.drawType,{category:M,eventType:A}=P||{},_=S.startDate||P.startDate||i.startDate,x=S.endDate||P.endDate||i.endDate;if(A===Hc&&I!==_c)continue;let O;if(s){let B=c,F=0,G=0,H=0,$;for(let q of E){let{finishingPositionRange:z,participationOrder:Z,participantWon:Y,flightNumber:Q,rankingStage:X,winCount:oe}=q;F+=oe||0;let re=R==null?void 0:R.drawSize,{awardProfile:me}=K8e({awardProfiles:s,participation:q,eventType:A,startDate:_,category:M,drawSize:re,drawType:N,endDate:x,level:n});if(me){if(!re)continue;let se=Array.isArray(z)&&Math.max(...z),te=ki(z||[]).join("-"),he=se&&X!==Xt&&(z==null?void 0:z.includes(re));me.requireWinForPoints!==void 0&&(B=me.requireWinForPoints),me.requireWinFirstRound!==void 0&&(l=me.requireWinFirstRound);let{finishingPositionPoints:ae={},finishingPositionRanges:de,finishingRound:Ie,pointsPerWin:De,flights:Te}=me,_e=Array.isArray(me.perWinPoints)?(r=me.perWinPoints)==null?void 0:r.find(nt=>{var Bt;return(Bt=nt.participationOrders)==null?void 0:Bt.includes(Z)}):me.perWinPoints,Ve=ae.participationOrders,ot=0,St;if((!Ve||Ve.includes(Z))&&de&&se){let nt=de[se];nt&&({awardPoints:ot,requireWin:St}=OX({flightNumber:Q,valueObj:nt,drawSize:re,flights:Te,level:n}))}if(!ot&&Ie&&Z===1&&se){let nt=Ie[se];nt&&({awardPoints:ot,requireWin:St}=OX({participantWon:Y,flightNumber:Q,valueObj:nt,drawSize:re,flights:Te,level:n}))}if(he&&l!==void 0&&(B=l),St!==void 0&&(B=St),ot>G&&(!B||oe)&&(G=ot,$=se),!ot&&De&&oe&&(H+=oe*De,$=te),!ot&&oe&&_e){let nt=uTe(n,_e==null?void 0:_e.level);nt?H+=oe*nt:_e.value&&(H+=oe*_e.value)}}if(O=G+H,b===_c){let se=(y.matchUps||[]).filter(({structureId:te})=>te===q.structureId);for(let{matchUpId:te}of se){let he=h[te],ae=he.sides.find(de=>de.participantId===I).sideNumber;if(he.winningSice===ae)for(let de of he.tieMatchUps)de.winningSide}}}if(H||G){let q={winCount:F,positionPoints:G,rangeAccessor:$,perWinPoints:H,eventType:A,drawId:D,points:O},z=T==null?void 0:T.personId;z?(m[z]||(m[z]=[]),m[z].push(q)):b===Ui?(v[I]||(v[I]=[]),v[I].push(q)):b===_c&&(g[I]||(g[I]=[]),g[I].push(q))}}}}return{participantsWithOutcomes:f,personPoints:m,pairPoints:v,teamPoints:g,...ue}}var Z8e={getTournamentPoints:Y8e},X8e=Z8e,J8e={calculateNewRatings:dbe,generateDynamicRatings:pbe},Q8e=J8e,e7e={...X8e,...Q8e};e9.importMethods(e7e);var t7e={[pE]:{roundsToSeparate:void 0,policyName:"Nationality Code",policyAttributes:[{key:"person.nationalityCode"},{key:"individualParticipants.person.nationalityCode"}]}},i7e={[xf]:{policyName:"positionActionsUnrestricted",enabledStructures:[],otherFlightEntries:!0,disableRoundRestrictions:!0,activePositionOverrides:[Fb,J1]}},n7e={[xf]:{policyName:"positionActionsNoMovement",enabledStructures:[{stages:[],stageSequences:[],enabledActions:[Fb,UE,mI],disabledActions:[]}]}},r7e={[xf]:{policyName:"positionActionsDisabled",enabledStructures:!1}},a7e={[pU]:{policyName:"Participant Privacy Policy",participant:{contacts:!1,individualParticipants:{onlineResources:!1,participantName:!0,participantOtherName:!0,participantId:!0,participantRole:!0,participantStatus:!0,penalties:!1,representing:!0,participantRoleResponsibilities:!1,participantType:!0,person:{addresses:!1,biographicalInformation:!1,birthDate:!1,contacts:!1,nationalityCode:!0,nativeFamilyName:!1,nativeGivenName:!1,onlineResources:!1,otherNames:!0,parentOrganisationId:!1,passportFamilyName:!1,passportGivenName:!1,personId:!1,personOtherIds:!1,previousNames:!1,sex:!1,standardFamilyName:!0,standardGivenName:!0,status:!1,tennisId:!1,wheelchair:!0}},individualParticipantIds:!0,onlineResources:!1,participantName:!0,participantOtherName:!0,participantId:!0,participantRole:!0,participantStatus:!0,penalties:!1,representing:!0,participantRoleResponsibilities:!1,participantType:!0,person:{addresses:!1,biographicalInformation:!1,birthDate:!1,contacts:!1,nationalityCode:!0,nativeFamilyName:!1,nativeGivenName:!1,onlineResources:!1,otherNames:!0,parentOrganisationId:!1,passportFamilyName:!1,passportGivenName:!1,personId:!1,personOtherIds:!1,previousNames:!1,sex:!1,standardFamilyName:!0,standardGivenName:!0,status:!1,tennisId:!1,wheelchair:!0}}}},o7e={[Dh]:{defaultMatchUpFormat:Cc,allowDeletionWithScoresPresent:{drawDefinitions:!1,structures:!1},requireAllPositionsAssigned:!1,processCodes:{incompleteAssignmentsOnDefault:["RANKING.IGNORE"]},stage:{[Ft]:{stageSequence:{1:{requireAllPositionsAssigned:!0}}}}}},s7e={[Dh]:{requireAllPositionsAssigned:!1,stage:{[Ft]:{stageSequence:{1:{requireAllPositionsAssigned:!0}}}},defaultMatchUpFormat:Cc,matchUpFormats:[{description:"Best of 3 tiebreak sets",matchUpFormat:Cc,categoryNames:[],categoryTypes:[]},{description:"Two tiebreak sets, 7-point match tiebreak at one set all",matchUpFormat:"SET3-S:6/TB7-F:TB7"},{description:"Two tiebreak sets, 10-point match tiebreak at one set all",matchUpFormat:"SET3-S:6/TB7-F:TB10"},{description:"One standard tiebreak set to 6, 7-point tiebreak at 6 games all",matchUpFormat:"SET1-S:6/TB7"},{description:"Best of 3 sets to 4",matchUpFormat:"SET3-S:4/TB7"},{description:"Two out of three short sets to 4 with 5-point tiebreak at 3 games all",matchUpFormat:"SET3-S:4/TB5@3"},{description:"One short set to 4, 7-point tiebreak at 4 games all",matchUpFormat:"SET1-S:4/TB7"},{description:"One short set to 4, 5-point tiebreak at 3 games all",matchUpFormat:"SET1-S:4/TB5@3"},{description:"Two short sets to 4, 10-point match tiebreak at one set all",matchUpFormat:"SET3-S:4/TB7-F:TB10"},{description:"Two short sets to 4, 7-point match tiebreak at one set all",matchUpFormat:"SET3-S:4/TB7-F:TB7"},{description:"One no advantage set to 5, tiebreak to 9 at 4-4",matchUpFormat:"SET1-S:5/TB9@4"},{description:"One set to 6 with deciding game at 5 games all",matchUpFormat:"SET1-S:6NOAD"},{description:"One short set to 4, deciding game is played at 3 games all",matchUpFormat:"SET1-S:4NOAD"},{description:"Two short sets to 4 with deciding game at 3-3, 7-point match tiebreak at one set all",matchUpFormat:"SET3-S:4NOAD-F:TB7"},{description:"8 game pro-set with 7 point tiebreak at 8 games all",matchUpFormat:"SET1-S:8/TB7"},{description:"8 game pro-set with 7 point tiebreak at 7 games all",matchUpFormat:"SET1-S:8/TB7@7"},{description:"Best of 3 10-point tiebreak games",matchUpFormat:"SET3-S:TB10"},{description:"One 10-point tiebreak game",matchUpFormat:"SET1-S:TB10"},{description:"Timed 20 minute game - game based",matchUpFormat:"SET1-S:T20"}]}},l7e={[du]:{seedingProfile:{positioning:vL},validSeedPositions:{ignore:!0},duplicateSeedNumbers:!0,drawSizeProgression:!0,policyName:"ITF SEEDING",seedsCountThresholds:[{drawSize:4,minimumParticipantCount:3,seedsCount:2},{drawSize:16,minimumParticipantCount:12,seedsCount:4},{drawSize:32,minimumParticipantCount:24,seedsCount:8},{drawSize:64,minimumParticipantCount:48,seedsCount:16},{drawSize:128,minimumParticipantCount:97,seedsCount:32},{drawSize:256,minimumParticipantCount:192,seedsCount:64}]}},c7e={POLICY_AVOIDANCE_COUNTRY:t7e,POLICY_POSITION_ACTIONS_DEFAULT:zye,POLICY_POSITION_ACTIONS_DISABLED:r7e,POLICY_POSITION_ACTIONS_NO_MOVEMENT:n7e,POLICY_POSITION_ACTIONS_UNRESTRICTED:i7e,POLICY_PRIVACY_DEFAULT:a7e,POLICY_ROUND_NAMING_DEFAULT:b6,POLICY_SCHEDULING_DEFAULT:cwe,POLICY_SCORING_DEFAULT:o7e,POLICY_SCORING_USTA:s7e,POLICY_SEEDING_ITF:l7e,POLICY_SEEDING_DEFAULT:WIe},u7e={ratingsParameters:ql,matchUpFormats:d3e,countryToFlag:fve,tieFormats:Owe,countries:Vm,policies:c7e,flagIOC:Tze},d7e={};zi(d7e,{activeMatchUpStatuses:()=>$5,auditConstants:()=>N5e,completedMatchUpStatuses:()=>Ga,directingMatchUpStatuses:()=>mge,drawDefinitionConstants:()=>Ege,entryStatusConstants:()=>THe,errorConditionConstants:()=>$je,eventConstants:()=>YHe,extensionConstants:()=>age,flightConstants:()=>B5e,genderConstants:()=>w6,keyValueConstants:()=>LWe,matchUpActionConstants:()=>q3e,matchUpStatusConstants:()=>yge,matchUpTypes:()=>IHe,nonDirectingMatchUpStatuses:()=>gge,particicipantsRequiredMatchUpStatuses:()=>hge,participantConstants:()=>wHe,participantRoles:()=>R6,participantTypes:()=>K1,penaltyConstants:()=>R7e,policyConstants:()=>QGe,positionActionConstants:()=>j3e,ratingConstants:()=>dWe,recoveryTimeRequiredMatchUpStatuses:()=>cHe,requestConstants:()=>S6e,resultConstants:()=>Eje,scaleConstants:()=>LGe,scheduleConstants:()=>zHe,sortingConstants:()=>G5e,surfaceConstants:()=>x7e,tieFormatConstants:()=>R4e,timeItemConstants:()=>jHe,topicConstants:()=>vHe,tournamentConstants:()=>VSe,upcomingMatchUpStatuses:()=>vge,validMatchUpStatuses:()=>fge,venueConstants:()=>F7e});var p7e="Coaching",h7e="Ball Abuse",f7e="Racket Abuse",m7e="Verbal Abuse",g7e="INELIGIBILITY",v7e="Physical Abuse",y7e="Unsportmanlike Conduct",b7e="Dress Code Violation",I7e="Equipment Violation",w7e="Leaving the court",S7e="Failure to complete",T7e="No Show",U7e="Other",D7e="REFUSAL_TO_PLAY",E7e="PROHIBITED_SUBSTANCE",C7e="Puncuality",P7e="Failure to sign in",R7e={COACHING:p7e,BALL_ABUSE:h7e,RACKET_ABUSE:f7e,VERBAL_ABUSE:m7e,PHYSICAL_ABUSE:v7e,INELIGIBILITY:g7e,UNSPORTSMANLIKE_CONDUCT:y7e,PROHIBITED_SUBSTANCE:E7e,DRESS_CODE_VIOLATION:b7e,EQUIMENT_VIOLATION:I7e,LEAVING_THE_COURT:w7e,REFUSAL_TO_PLAY:D7e,FAILURE_TO_COMPLETE:S7e,NO_SHOW:T7e,OTHER:U7e,PUNCTUALITY:C7e,FAILUIRE_TO_SIGN_IN:P7e},M7e="CLAY",N7e="HARD",A7e="GRASS",_7e="CARPET",k7e="ARTIFICIAL",x7e={CLAY:M7e,HARD:N7e,GRASS:A7e,CARPET:_7e,ARTIFICIAL:k7e},O7e="INDOOR",L7e="OUTDOOR",F7e={INDOOR:O7e,OUTDOOR:L7e};const B7e=Tn({WebkitBoxSizing:"border-box",marginInlineEnd:".3em",display:"inline-block",boxSizing:"border-box",position:"relative",borderRadius:2,variants:{variant:{doubles:{width:".75rem"},singles:{width:"1rem"}}}});function $7e({matchUp:t,individualParticipant:e,spacer:i}){var n,r,a;const o=((n=e==null?void 0:e.person)==null?void 0:n.iso2NationalityCode)||"",s=o?(r=u7e.countryToFlag(o))==null?void 0:r.slice(0,4):"",l=document.createElement("span"),c=(a=t==null?void 0:t.matchUpType)==null?void 0:a.toLowerCase();return i||(l.className=B7e({variant:c})),l.innerHTML=i?"":s,l}function w$({individualParticipant:t,composition:e,className:i,matchUp:n,spacer:r,side:a,type:o}){if(o==="scale")return bje({individualParticipant:t,composition:e,className:i,matchUp:n,spacer:r});const s=(e==null?void 0:e.configuration)||{},l=document.createElement("div");return o==="flag"&&s.flags&&$7e({className:i,matchUp:n,individualParticipant:t,spacer:r})||o==="seeding"&&vje({className:i,composition:e,matchUp:n,side:a})||l}const V7e="Qualifier",j7e="BYE",G7e="TBD";function LX(t){var e,i,n,r;const{isWinningSide:a,side:o,sideNumber:s,individualParticipant:l,matchUp:c,composition:u}=t||{},d=a?"winner":void 0,p=t.eventHandlers||{},h=u==null?void 0:u.configuration,f={QUALIFIER:((e=h==null?void 0:h.placeHolders)==null?void 0:e.qualifier)||V7e,BYE:((i=h==null?void 0:h.placeHolders)==null?void 0:i.bye)||j7e,TBD:((n=h==null?void 0:h.placeHolders)==null?void 0:n.tbd)||G7e},m=l==null?void 0:l.participantName,g=S=>{sd(p==null?void 0:p.participantClick)&&(S.stopPropagation(),p.participantClick({individualParticipant:l,pointerEvent:S,matchUp:c,side:o}))},v=document.createElement("div");v.classList.add("tmx-i"),v.setAttribute("sideNumber",s),v.setAttribute("id",l==null?void 0:l.participantId),v.onclick=g;const y=document.createElement("div");y.className=XVe({variant:d});const b=(h==null?void 0:h.flags)&&w$({...t,type:"flag"});if(b)y.appendChild(b);else{const S=w$({type:"scale",...t});S&&y.appendChild(S)}const I=document.createElement("div");if(I.className=JVe({variant:d}),m){const S=document.createElement("span");if(a&&h!=null&&h.winnerColor)S.style.color=typeof h.winnerColor=="string"?h.winnerColor:"green";else if(h!=null&&h.genderColor){const D=(r=l==null?void 0:l.person)==null?void 0:r.sex,E=D==="MALE"&&"#2E86C1"||D==="FEMALE"&&"#AA336A"||"";S.style.color=typeof h.genderColor=="string"?h.genderColor:E}S.innerHTML=m,I.appendChild(S)}else{const S=document.createElement("abbr");S.className=ZVe({variant:h.showAddress?"showAddress":""}),S.innerHTML=(o==null?void 0:o.bye)&&f.BYE||(o==null?void 0:o.qualifier)&&f.QUALIFIER||f.TBD,I.appendChild(S)}const T=w$({...t,className:gje(),type:"seeding"});T&&I.appendChild(T),y.appendChild(I),v.appendChild(y);const w=mje(t);return v.appendChild(w),{element:v}}const H7e=Tn({width:"auto",display:"inline-block",textTransform:"uppercase",fontFamily:"Sharp Sans, Arial, sans-serif",fontSize:"0.625rem",lineHeight:"1rem",marginInline:"0.25rem 0.25rem",paddingInline:"0.25rem 0.25rem",fontWeight:700,borderRadius:"4px",color:"#fff",textAlign:"center",whiteSpace:"nowrap",variants:{variant:{defaulted:{backgroundColor:"#df164c"},retired:{backgroundColor:"#df164c"},walkover:{backgroundColor:"black"},double_walkover:{backgroundColor:"black"}}}});function z7e({matchUpStatus:t}){const e=t==null?void 0:t.toLowerCase(),i=["WALKOVER","DOUBLE_WALKOVER"].includes(t)?"WO":(t==null?void 0:t.slice(0,3))||"",n=document.createElement("div");n.className=H7e({variant:e});const r=document.createElement("abbr");return r.setAttribute("title",t),r.style.textDecoration="none",r.style.borderBottom="none",r.innerHTML=i,n.appendChild(r),n}function q7e(t){return t instanceof Element||t}const W7e=Tn({marginInlineEnd:".5rem",backgroundColor:"pink",marginInlineStart:2,height:40,width:40});function K7e({teamLogo:t}){console.log({teamLogo:t});const e=document.createElement("div");return e.className=W7e(),e}const Y7e=Tn({flexDirection:"column",position:"relative",display:"flex"}),Z7e=Tn({alignItems:"stretch",display:"flex"}),X7e=Tn({marginInlineEnd:".25rem",color:"green"});function J7e({dim:t="20px"}={}){const e=X7e();return`
    <div style="line-height: 0;">
      <svg height="${t}" viewBox="0 0 18 24" width="${t}" xmlns="http://www.w3.org/2000/svg" class="${e}" style="fill: currentcolor;">
        <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"></path>
      </svg>
    </div>
  `}function dTe({initialRoundNumber:t=1,eventHandlers:e,sideContainer:i,composition:n,participant:r,placeholder:a,sideNumber:o,matchUp:s}){var l,c,u;const{winningSide:d,matchUpType:p,isRoundRobin:h,matchUpStatus:f}=s||{},m=n==null?void 0:n.configuration;let g;const v=o?(l=s==null?void 0:s.sides)==null?void 0:l.find(M=>M.sideNumber===o):void 0;r||(r=v==null?void 0:v.participant,g=m!=null&&m.allDrawPositions||m!=null&&m.drawPositions&&v!=null&&v.drawPosition&&((s==null?void 0:s.roundNumber)===t||v!=null&&v.participantFed||h)?v==null?void 0:v.drawPosition:"");const y=p==="DOUBLES",b=y?(c=r==null?void 0:r.individualParticipants)==null?void 0:c[0]:r,I=y&&((u=r==null?void 0:r.individualParticipants)==null?void 0:u[1]),T=o===d||f==="BYE"&&r,w=(m==null?void 0:m.winnerChevron)&&T,S=m==null?void 0:m.teamLogo,D=["RETIRED","DOUBLE_WALKOVER","WALKOVER","DEFAULTED"].includes(f)&&!T,E=m==null?void 0:m.gameScoreOnly,C=document.createElement("div");if(C.className=i&&eje({drawPosition:g,sideNumber:o}),C.classList.add("tmx-p"),C.setAttribute("id",r==null?void 0:r.participantId),S){const M=K7e({teamLogo:S});C.appendChild(M)}const P=document.createElement("div");P.className=QVe({variant:y?"doubles":"singles"});const R=document.createElement("div");R.className=tje({winnerChevron:w,isDoubles:y});const N=LX({individualParticipant:b,eventHandlers:e,isWinningSide:T,composition:n,sideNumber:o,matchUp:s,side:v}).element;if(R.appendChild(N),I){const M=LX({individualParticipant:I,eventHandlers:e,isWinningSide:T,composition:n,sideNumber:o,matchUp:s,side:v}).element;R.appendChild(M)}else y&&a&&q7e(a)&&R.appendChild(a);if(P.appendChild(R),C.appendChild(P),i){const M=document.createElement("div");if(T&&!E){const A=J7e();typeof A=="string"?M.innerHTML=A:M.appendChild(A)}else if(D){const A=z7e({matchUpStatus:f});M.appendChild(A)}C.appendChild(M)}return C}const Q7e=Tn({borderBottom:"solid 1px black",marginInlineStart:"16px",marginInlineEnd:"16px",fontWeight:"bold",width:"460px",height:"1.5em"});function e9e({eventHandlers:t,roundMatchUps:e,roundProfile:i,roundNumber:n,context:r}){var a;const o=document.createElement("div");o.className=Q7e(),o.classList.add("tmx-rh"),o.setAttribute("roundNumber",n);const s=sd(t==null?void 0:t.roundHeaderClick);s&&(o.onclick=d=>t.roundHeaderClick({roundNumber:n,roundProfile:i,roundMatchUps:e,context:r,pointerEvent:d}));const l=s?"":"",c=(a=i==null?void 0:i[n])==null?void 0:a.roundName,u=c&&` <div style="display: flex; flex-direction: row; justify-content: space-between">
        <div>${c}</div>
        <div style="font-weight: bold">${l}</div>
      </div>
  `;return o.innerHTML=u||"",o}const pTe=Tn({flexDirection:"column",display:"flex"}),t9e=Tn({flexDirection:"row",display:"flex"}),hTe=Tn({justifyContent:"space-around",marginInlineStart:"16px",marginInlineEnd:"16px",flexDirection:"column",height:"100%",display:"flex",width:"460px",variants:{variant:{adHoc:{justifyContent:"flex-start"}}}}),i9e=Tn({borderTop:"solid 1px black",marginRight:"-1em",marginLeft:"-1em",paddingTop:".5em",marginTop:".2em",variants:{variant:{0:{marginTop:"1em",borderTop:"none",paddingTop:"0px"}},roundOrder:{first:{marginLeft:"0em"},last:{marginRight:"0em"}}}}),n9e=Tn({fontWeight:"bold",color:"blue",height:"1em"}),FX=Tn({width:"$score$setWidth",display:"inline-block",fontSize:9,variants:{variant:{set:{textAlign:"center"},points:{marginInlineEnd:3}}}}),r9e=Tn({transform:"translateY(-50%)",textTransform:"uppercase",backgroundColor:"#fff",position:"absolute",textAlign:"center",top:"calc(50%)",color:"#bbb",fontSize:0,right:4});function a9e(){return Tn({backgroundColor:"magenta",position:"absolute",opacity:"0.2",height:"100%",width:"100%",top:0})}const o9e=Tn({});function s9e({configuration:t}){const e={backgroundColor:"$matchUpBackgroundColor",WebkitTransition:"all 0.30s linear",boxShadow:"$matchUp$boxShadow",transition:"all 0.30s linear",border:"solid $border",marginBottom:"$space$1",marginTop:"$space$1",position:"relative",display:"grid",width:"100%",borderInlineStartWidth:"$borderWidths$borderInlineStart"};if(t!=null&&t.matchUpHover){const i=typeof t.matchUpHover=="string"?t.matchUpHover:"cyan";e["&:hover"]={backgroundColor:i}}else e["&:hover"]={borderColor:"$borderHover"};return Tn(e)}function l9e({variant:t}){return Tn({borderBottom:"solid 1px lightgray",backgroundColor:"$matchUp",position:"relative",width:"100%",height:"$lineHeights$centerInfo",variants:{variant:{1:{borderBottom:"solid 1px black"},2:{borderBottom:"solid 1px lightgray"}}}})({variant:t})}const c9e=Tn({justifyContent:"center",alignContent:"center",flexDirection:"column",height:"100%",display:"flex"}),u9e=Tn({fontFamily:"Lato,Arial,Helvetica,sans-serif",WebkitFontSmooting:"antialiased",marginInlineStart:"calc(20%)",WebkitBoxOrient:"horizontal",WebKitBoxDirection:"normal",WebkitBoxPack:"center",boxSizing:"inherit",flexDirection:"row",display:"flex"}),BX=Tn({alignContent:"center",boxSizing:"inherit",fontFamily:"Lato",fontWeight:900,fontSize:9});function d9e({eventHandlers:t,entryStatus:e,sideNumber:i,className:n,matchUp:r}){const a=document.createElement("div");sd(t==null?void 0:t.centerInfoClick)&&(a.onclick=u=>t.centerInfoClick({matchUp:r,sideNumber:i,pointerEvent:u})),a.className=Ny(l9e({variant:i}),n),a.classList.add("tmx-ci"),a.setAttribute("sideNumber",i);const o=document.createElement("div");o.className=c9e();const s=document.createElement("div");s.className=u9e();const l=document.createElement("div");l.className=BX(),l.innerHTML=e?"Entry status:&nbsp;":"",s.appendChild(l);const c=document.createElement("div");return c.className=BX(),c.innerHTML=e||"",s.appendChild(c),o.appendChild(s),a.appendChild(o),{element:a}}const eD={scheduleInfo:1.8,centerInfo:1.5,gameScore:2};function p9e({composition:t,isDoubles:e,roundFactor:i=1}){const n=parseInt(window.getComputedStyle(document.body).getPropertyValue("font-size")),r=(t==null?void 0:t.configuration)||{},a=(r==null?void 0:r.connectorWidth)||16,o=r.centerInfo?eD.centerInfo*n:0,s=r.scheduleInfo?eD.scheduleInfo*n:0,l=(60+(r.showAddress?n:0))*(e?1.3:1)+o,c=l*i,u=(l+s)*i;return Tn({"&::before":{borderBlockStart:"$borderWidths$matchUp solid #999",left:-a,width:a,position:"absolute",borderRadius:2,top:-1},"&::after":{width:a,position:"absolute",borderRadius:2,left:"100%"},"&::after, &::before":{borderWidth:"$borderWidths$matchUp",borderColor:"$connector",display:"block",content:""},variants:{isFirstRound:{true:{"&::before":{height:0,width:0,borderWidth:0}}},link:{m1:{"&::after":{borderInlineEnd:"$borderWidths$matchUp solid $connector",borderTopStyle:"solid",height:c,top:-1}},m2:{"&::after":{bottom:"calc(100%)",borderInlineEnd:"$borderWidths$matchUp solid $connector",borderBottomStyle:"solid",height:u}},m0:{"&::after":{borderTopStyle:"solid",borderColor:"$connector",top:-1}},mr:{"&::before":{height:0,width:0,borderWidth:0},"&::after":{height:0,width:0,borderWidth:0}},noProgression:{true:{"&::after":{height:0,width:0,borderWidth:0}}}}}})}const fTe=t=>Tn({display:"flex",alignItems:"center",height:t,justifyContent:"flex-end",backgroundColor:"$matchUp",variants:{sideNumber:{1:{borderBottom:"1px solid $internalDividers"}},fontSize:{small:{fontSize:"smaller",paddingRight:"1em",color:"blue"}}}}),h9e=Tn({lineHeight:"0.75rem",fontSize:"0.625rem",left:"1.1rem",top:".4rem"}),mTe=Tn({lineHeight:"$lineHeights$gameScore",justifyContent:"center",width:"$score$setWidth",position:"relative",textAlign:"center",cursor:"pointer",fontWeight:500,fontSize:"$1",display:"flex",margin:0,variants:{variant:{winner:{color:"$winner!important",fontWeight:700},loser:{color:"$loser!important"}}}}),f9e=Tn({marginInlineEnd:"$space$gameMarginInlineEnd",justifyContent:"flex-end",alignItems:"center",display:"flex"});function m9e({value:t}={}){const e=document.createElement("input");return e.onclick=i=>i.target.select(),e.className=mTe(),e.value=t,e}function g9e({gameScoreOnly:t,scoreStripes:e,set:i,sideNumber:n}){const r=n===(i==null?void 0:i.winningSide)||i!=null&&i.winningSide?"loser":void 0,a=n===2?i.side2Score:i.side1Score,o=i.side2TiebreakScore||i.side1TiebreakScore,s=n===2?i.side2TiebreakScore:i.side1TiebreakScore,l=a===void 0&&s,c=l||a,u=e&&i.setNumber%2?"lightgray":"transparent",d=i.editing?i.editing===n:void 0;let p;if(d)p=m9e({value:c});else if(p=document.createElement("p"),p.className=mTe({variant:r}),p.classList.add("tmx-st"),p.setAttribute("setNumber",i.setNumber),p.style.backgroundColor=u,p.innerHTML=isNaN(c)?"":c,!t){const h=document.createElement("span");h.className=h9e(),h.innerHTML=o&&!l?s:"",p.appendChild(h)}return p}function v9e({participantHeight:t,eventHandlers:e,composition:i,sideNumber:n,matchUp:r}){var a,o,s,l;const c=(a=i==null?void 0:i.configuration)==null?void 0:a.winnerChevron,u=(o=i==null?void 0:i.configuration)==null?void 0:o.gameScoreOnly,d=((s=r==null?void 0:r.score)==null?void 0:s.sets)||[],p=(l=i==null?void 0:i.configuration)==null?void 0:l.scoreBox,h=n===2?t:t-1,f=fTe(h),m=y=>{sd(e==null?void 0:e.scoreClick)&&(y.stopPropagation(),e.scoreClick({pointerEvent:y,matchUp:r}))},g=document.createElement("div");g.className=f({sideNumber:!p&&n,fontSize:"5px"}),g.classList.add("sideScore"),g.classList.add("tmx-scr"),g.onclick=m;const v=document.createElement("div");v.className=f9e();for(const y of d||[]){const b=g9e({gameScoreOnly:u,scoreStripes:c,sideNumber:n,set:y});v.appendChild(b)}return g.appendChild(v),g}const y9e=Tn({height:"$lineHeights$scheduleInfo",borderBottom:"1px solid darkgray",justifyContent:"space-between",backgroundColor:"#F8F9F9",boxSizing:"border-box",paddingRight:"0.2rem",paddingLeft:"0.5rem",alignItems:"center",cursor:"pointer",color:"#7F8080",display:"flex",width:"100%"});var gTe={exports:{}};(function(t,e){(function(i,n){t.exports=n()})(ije,function(){var i=1e3,n=6e4,r=36e5,a="millisecond",o="second",s="minute",l="hour",c="day",u="week",d="month",p="quarter",h="year",f="date",m="Invalid Date",g=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,v=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,y={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(M){var A=["th","st","nd","rd"],_=M%100;return"["+M+(A[(_-20)%10]||A[_]||A[0])+"]"}},b=function(M,A,_){var x=String(M);return!x||x.length>=A?M:""+Array(A+1-x.length).join(_)+M},I={s:b,z:function(M){var A=-M.utcOffset(),_=Math.abs(A),x=Math.floor(_/60),O=_%60;return(A<=0?"+":"-")+b(x,2,"0")+":"+b(O,2,"0")},m:function M(A,_){if(A.date()<_.date())return-M(_,A);var x=12*(_.year()-A.year())+(_.month()-A.month()),O=A.clone().add(x,d),B=_-O<0,F=A.clone().add(x+(B?-1:1),d);return+(-(x+(_-O)/(B?O-F:F-O))||0)},a:function(M){return M<0?Math.ceil(M)||0:Math.floor(M)},p:function(M){return{M:d,y:h,w:u,d:c,D:f,h:l,m:s,s:o,ms:a,Q:p}[M]||String(M||"").toLowerCase().replace(/s$/,"")},u:function(M){return M===void 0}},T="en",w={};w[T]=y;var S="$isDayjsObject",D=function(M){return M instanceof R||!(!M||!M[S])},E=function M(A,_,x){var O;if(!A)return T;if(typeof A=="string"){var B=A.toLowerCase();w[B]&&(O=B),_&&(w[B]=_,O=B);var F=A.split("-");if(!O&&F.length>1)return M(F[0])}else{var G=A.name;w[G]=A,O=G}return!x&&O&&(T=O),O||!x&&T},C=function(M,A){if(D(M))return M.clone();var _=typeof A=="object"?A:{};return _.date=M,_.args=arguments,new R(_)},P=I;P.l=E,P.i=D,P.w=function(M,A){return C(M,{locale:A.$L,utc:A.$u,x:A.$x,$offset:A.$offset})};var R=function(){function M(_){this.$L=E(_.locale,null,!0),this.parse(_),this.$x=this.$x||_.x||{},this[S]=!0}var A=M.prototype;return A.parse=function(_){this.$d=function(x){var O=x.date,B=x.utc;if(O===null)return new Date(NaN);if(P.u(O))return new Date;if(O instanceof Date)return new Date(O);if(typeof O=="string"&&!/Z$/i.test(O)){var F=O.match(g);if(F){var G=F[2]-1||0,H=(F[7]||"0").substring(0,3);return B?new Date(Date.UTC(F[1],G,F[3]||1,F[4]||0,F[5]||0,F[6]||0,H)):new Date(F[1],G,F[3]||1,F[4]||0,F[5]||0,F[6]||0,H)}}return new Date(O)}(_),this.init()},A.init=function(){var _=this.$d;this.$y=_.getFullYear(),this.$M=_.getMonth(),this.$D=_.getDate(),this.$W=_.getDay(),this.$H=_.getHours(),this.$m=_.getMinutes(),this.$s=_.getSeconds(),this.$ms=_.getMilliseconds()},A.$utils=function(){return P},A.isValid=function(){return this.$d.toString()!==m},A.isSame=function(_,x){var O=C(_);return this.startOf(x)<=O&&O<=this.endOf(x)},A.isAfter=function(_,x){return C(_)<this.startOf(x)},A.isBefore=function(_,x){return this.endOf(x)<C(_)},A.$g=function(_,x,O){return P.u(_)?this[x]:this.set(O,_)},A.unix=function(){return Math.floor(this.valueOf()/1e3)},A.valueOf=function(){return this.$d.getTime()},A.startOf=function(_,x){var O=this,B=!!P.u(x)||x,F=P.p(_),G=function(X,oe){var re=P.w(O.$u?Date.UTC(O.$y,oe,X):new Date(O.$y,oe,X),O);return B?re:re.endOf(c)},H=function(X,oe){return P.w(O.toDate()[X].apply(O.toDate("s"),(B?[0,0,0,0]:[23,59,59,999]).slice(oe)),O)},$=this.$W,q=this.$M,z=this.$D,Z="set"+(this.$u?"UTC":"");switch(F){case h:return B?G(1,0):G(31,11);case d:return B?G(1,q):G(0,q+1);case u:var Y=this.$locale().weekStart||0,Q=($<Y?$+7:$)-Y;return G(B?z-Q:z+(6-Q),q);case c:case f:return H(Z+"Hours",0);case l:return H(Z+"Minutes",1);case s:return H(Z+"Seconds",2);case o:return H(Z+"Milliseconds",3);default:return this.clone()}},A.endOf=function(_){return this.startOf(_,!1)},A.$set=function(_,x){var O,B=P.p(_),F="set"+(this.$u?"UTC":""),G=(O={},O[c]=F+"Date",O[f]=F+"Date",O[d]=F+"Month",O[h]=F+"FullYear",O[l]=F+"Hours",O[s]=F+"Minutes",O[o]=F+"Seconds",O[a]=F+"Milliseconds",O)[B],H=B===c?this.$D+(x-this.$W):x;if(B===d||B===h){var $=this.clone().set(f,1);$.$d[G](H),$.init(),this.$d=$.set(f,Math.min(this.$D,$.daysInMonth())).$d}else G&&this.$d[G](H);return this.init(),this},A.set=function(_,x){return this.clone().$set(_,x)},A.get=function(_){return this[P.p(_)]()},A.add=function(_,x){var O,B=this;_=Number(_);var F=P.p(x),G=function(q){var z=C(B);return P.w(z.date(z.date()+Math.round(q*_)),B)};if(F===d)return this.set(d,this.$M+_);if(F===h)return this.set(h,this.$y+_);if(F===c)return G(1);if(F===u)return G(7);var H=(O={},O[s]=n,O[l]=r,O[o]=i,O)[F]||1,$=this.$d.getTime()+_*H;return P.w($,this)},A.subtract=function(_,x){return this.add(-1*_,x)},A.format=function(_){var x=this,O=this.$locale();if(!this.isValid())return O.invalidDate||m;var B=_||"YYYY-MM-DDTHH:mm:ssZ",F=P.z(this),G=this.$H,H=this.$m,$=this.$M,q=O.weekdays,z=O.months,Z=O.meridiem,Y=function(oe,re,me,se){return oe&&(oe[re]||oe(x,B))||me[re].slice(0,se)},Q=function(oe){return P.s(G%12||12,oe,"0")},X=Z||function(oe,re,me){var se=oe<12?"AM":"PM";return me?se.toLowerCase():se};return B.replace(v,function(oe,re){return re||function(me){switch(me){case"YY":return String(x.$y).slice(-2);case"YYYY":return P.s(x.$y,4,"0");case"M":return $+1;case"MM":return P.s($+1,2,"0");case"MMM":return Y(O.monthsShort,$,z,3);case"MMMM":return Y(z,$);case"D":return x.$D;case"DD":return P.s(x.$D,2,"0");case"d":return String(x.$W);case"dd":return Y(O.weekdaysMin,x.$W,q,2);case"ddd":return Y(O.weekdaysShort,x.$W,q,3);case"dddd":return q[x.$W];case"H":return String(G);case"HH":return P.s(G,2,"0");case"h":return Q(1);case"hh":return Q(2);case"a":return X(G,H,!0);case"A":return X(G,H,!1);case"m":return String(H);case"mm":return P.s(H,2,"0");case"s":return String(x.$s);case"ss":return P.s(x.$s,2,"0");case"SSS":return P.s(x.$ms,3,"0");case"Z":return F}return null}(oe)||F.replace(":","")})},A.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},A.diff=function(_,x,O){var B,F=this,G=P.p(x),H=C(_),$=(H.utcOffset()-this.utcOffset())*n,q=this-H,z=function(){return P.m(F,H)};switch(G){case h:B=z()/12;break;case d:B=z();break;case p:B=z()/3;break;case u:B=(q-$)/6048e5;break;case c:B=(q-$)/864e5;break;case l:B=q/r;break;case s:B=q/n;break;case o:B=q/i;break;default:B=q}return O?B:P.a(B)},A.daysInMonth=function(){return this.endOf(d).$D},A.$locale=function(){return w[this.$L]},A.locale=function(_,x){if(!_)return this.$L;var O=this.clone(),B=E(_,x,!0);return B&&(O.$L=B),O},A.clone=function(){return P.w(this.$d,this)},A.toDate=function(){return new Date(this.valueOf())},A.toJSON=function(){return this.isValid()?this.toISOString():null},A.toISOString=function(){return this.$d.toISOString()},A.toString=function(){return this.$d.toUTCString()},M}(),N=R.prototype;return C.prototype=N,[["$ms",a],["$s",o],["$m",s],["$H",l],["$W",c],["$M",d],["$y",h],["$D",f]].forEach(function(M){N[M[1]]=function(A){return this.$g(A,M[0],M[1])}}),C.extend=function(M,A){return M.$i||(M(A,R,C),M.$i=!0),C},C.locale=E,C.isDayjs=D,C.unix=function(M){return C(1e3*M)},C.en=w[T],C.Ls=w,C.p={},C})})(gTe);var b9e=gTe.exports;const I9e=hfe(b9e);function w9e({matchUp:t,eventHandlers:e}){const{scheduledTime:i,scheduledDate:n,venueAbbreviation:r,courtName:a}=(t==null?void 0:t.schedule)||{},{dateTime:{extractDate:o,extractTime:s}}=Z7,l=s(i);let c=o(n),u="ddd D MMMM";l&&(u+=", hh:mm A",c+=`T${l}`);const d=n?I9e(c).format(u):"Not scheduled",p=r&&(a==null?void 0:a.toString().startsWith(r))&&a||r&&a&&`${r} ${a}`||a||r||"",h=document.createElement("div");h.className=y9e(),h.classList.add("tmx-sch"),sd(e==null?void 0:e.scheduleClick)&&(h.onclick=y=>e.scheduleClick({matchUp:t,pointerEvent:y}));const f=document.createElement("div");f.innerHTML=d,h.append(f);const m=y=>{sd(e==null?void 0:e.venueClick)&&(y.stopPropagation(),e.venueClick({pointerEvent:y,matchUp:t}))},g=document.createElement("div");g.style="display: flex; flex-direction: row";const v=document.createElement("div");if(v.style.paddingRight=".2rem",v.onclick=m,v.innerHTML=p,g.append(v),h.append(g),h.onclick){const y=document.createElement("div");y.innerHTML="",g.append(y)}return h}function $X({initialRoundNumber:t=1,eventHandlers:e,composition:i,sideNumber:n,className:r,matchUp:a}){var o,s;const l=(i==null?void 0:i.configuration)||{},c=l==null?void 0:l.scheduleInfo,u=(o=a==null?void 0:a.score)==null?void 0:o.scoreStringSide1,d=((s=i==null?void 0:i.configuration)==null?void 0:s.scoreBox)&&u,p=(a==null?void 0:a.readyToScore)&&(e==null?void 0:e.scoreClick)&&!cTe.checkScoreHasValue({matchUp:a}),h=document.createElement("div");if(h.className=Ny(Y7e(),r),h.classList.add("tmx-sd"),h.setAttribute("sideNumber",n),c&&n===1){const g=w9e({matchUp:a,eventHandlers:e});h.appendChild(g)}const f=document.createElement("div");f.className=Z7e();const m=dTe({sideContainer:!0,initialRoundNumber:t,eventHandlers:e,composition:i,sideNumber:n,matchUp:a});if(f.appendChild(m),d){const g=document.createElement("div");g.style.border="1px solid lightgray",f.appendChild(g)}if(u){const g=v9e({eventHandlers:e,composition:i,sideNumber:n,matchUp:a});f.appendChild(g)}if(p){const g=fTe(),v=b=>{sd(e==null?void 0:e.scoreClick)&&(event.stopPropagation(),e.scoreClick({pointerEvent:b,matchUp:a}))},y=document.createElement("div");y.className=g({sideNumber:!d&&n,fontSize:"small"}),y.onclick=v,y.innerHTML="[Score]",f.appendChild(y)}return h.appendChild(f),h}function vTe(t){const{composition:e,initialRoundNumber:i=1,matchUp:n,moeity:r,selectedMatchUpId:a,searchActive:o}=t,{roundFactor:s,roundNumber:l,finishingRound:c,matchUpType:u,preFeedRound:d,stage:p}=n,h=t.isFinalRound||parseInt(c)===1,f=p==="QUALIFYING"&&h,m=h,g=parseInt(l)===i,v=u==="DOUBLES",y=(o||n.isRoundRobin||n.collectionId||t.isLucky||t.isAdHoc)&&"mr"||m&&"noProgression"||(f||d)&&"m0"||r&&"m1"||"m2",b=p9e({composition:e,isDoubles:v,roundFactor:s})({isFirstRound:g,link:y}),I=(e==null?void 0:e.configuration)||{},{resultsInfo:T,centerInfo:w}=I||{},S=t.eventHandlers||{},D=M=>{sd(S==null?void 0:S.matchUpClick)&&S.matchUpClick({pointerEvent:M,matchUp:n})},E=document.createElement("div");E.className=Ny(e.theme,t==null?void 0:t.className,"matchup",o9e()),E.classList.add("tmx-m"),E.setAttribute("id",n==null?void 0:n.matchUpId),E.onclick=D;const C=document.createElement("div");C.className=s9e({configuration:I});const P=({sideNumber:M})=>{var A,_,x;const O=(x=(_=(A=n==null?void 0:n.sides.find(B=>B.sideNumber===M))==null?void 0:A.participant)==null?void 0:_.entryStatus)==null?void 0:x.replace("_"," ");return d9e({eventHandlers:S,entryStatus:O,sideNumber:M,className:M===2&&b,matchUp:n})},R=$X({initialRoundNumber:i,eventHandlers:S,sideNumber:1,composition:e,matchUp:n}),N=$X({className:!w&&b,initialRoundNumber:i,eventHandlers:S,sideNumber:2,composition:e,matchUp:n});if(C.appendChild(R),w){const M=P({sideNumber:1}),A=P({sideNumber:2});C.appendChild(M.element),C.appendChild(A.element)}if(C.appendChild(N),T){const M=S9e({score:n.score});C.appendChild(M)}if(E.appendChild(C),a===n.matchUpId){const M=document.createElement("div");M.className=a9e(),E.appendChild(M)}return E}function S9e({score:t}){var e;const i=(e=t==null?void 0:t.sets)==null?void 0:e.filter(Boolean).sort((o,s)=>(o.setNumber||0)-(s.setNumber||0)),n=i==null?void 0:i[i.length-1],r=(n==null?void 0:n.side1PointsScore)||(n==null?void 0:n.side2PointsScore),a=document.createElement("div");if(a.className=r9e(),r){const o=document.createElement("div");o.className=FX({variant:"points"}),o.innerHTML="PTS",a.appendChild(o)}for(const o of i||[]){const s=document.createElement("div");s.setAttribute("key",o.setNumber),s.className=FX({variant:"set"}),s.innerHTML=o.setNumber,a.appendChild(s)}return a}function T9e({initialRoundNumber:t=1,selectedMatchUpId:e,eventHandlers:i,isFinalRound:n,isRoundRobin:r,searchActive:a,composition:o,roundFactor:s,roundNumber:l,roundProfile:c,matchUps:u,context:d,isLucky:p}){const h=u.filter(E=>E.roundNumber===l).sort((E,C)=>(E.roundPosition||0)-(C.roundPosition||0)),f=h.every(({roundPosition:E,drawPositions:C})=>!E&&!C),m=(o==null?void 0:o.configuration)||{},g=document.createElement("div");if(g.className=pTe(),g.classList.add("tmx-rd"),g.setAttribute("roundNumber",l),m.roundHeader){const E=e9e({roundProfile:c,roundMatchUps:h,roundNumber:l,eventHandlers:i,context:d});g.appendChild(E)}const v=document.createElement("div");v.className=hTe({variant:f?"adHoc":void 0});let y,b,I;if(r){const E=P=>P.reduce((R,N)=>N+R,0);h.sort((P,R)=>{const N=E(P.drawPositions)-E(R.drawPositions),M=Math.min(...P.drawPositions??[])-Math.min(...R.drawPositions??[]);return N||M});const C=h.reduce((P,R)=>(P[R.structureId]=R.structureName,P),{});y=Object.values(C),b=Object.keys(C),I=Object.keys(Z7.instanceCount(h.map(({structureId:P})=>P))).length}else f&&h.sort((E,C)=>(E.roundOrder??0)-(C.roundOrder??0));const T=I&&h.length/I,w=Object.keys(c).map(E=>parseInt(E)),S=w.indexOf(l),D=S===0&&"first"||S===w.length-1&&"last";return h.forEach((E,C)=>{const P=T&&!(C%T),R=T&&Math.floor(C/T),N=T&&y[R];if(P){const _=document.createElement("div");_.className=i9e({variant:R,roundOrder:D}),v.appendChild(_);const x=document.createElement("div");if(x.className=n9e(),sd(i==null?void 0:i.groupHeaderClick)){const{drawId:O,containerStructureId:B}=h[0];v.onclick=F=>i.groupHeaderClick({drawId:O,structureId:b[R],containerStructureId:B,pointerEvent:F})}l===t&&(x.innerHTML=N),v.appendChild(x)}const M=C%2===0;s?E.roundFactor=s:t>1&&(E.roundFactor=Math.pow(2,l-t));const A=vTe({initialRoundNumber:t,selectedMatchUpId:e,eventHandlers:i,isFinalRound:n,searchActive:a,composition:o,isAdHoc:f,isLucky:p,matchUp:E,moeity:M});v.appendChild(A)}),g.appendChild(v),g}function U9e({initialRoundNumber:t=1,selectedMatchUpId:e,eventHandlers:i,searchActive:n,composition:r,structureId:a,finalColumn:o,matchUps:s,context:l}){var c;const{roundNumbers:u,roundProfile:d,hasOddMatchUpsCount:p,isNotEliminationStructure:h}=cTe.getRoundMatchUps({matchUps:s});a=a||(l==null?void 0:l.structureId)||((c=s==null?void 0:s[0])==null?void 0:c.structureId);const f=s.some(({isRoundRobin:y})=>y),m=p||h,g=document.createElement("div");g.className=t9e(),g.classList.add("tmx-str"),g.setAttribute("id",a);const v=Math.max(...u);for(const y of u){if(y<t)continue;const b=T9e({initialRoundNumber:t,selectedMatchUpId:e,eventHandlers:i,isFinalRound:y===v,isRoundRobin:f,searchActive:n,composition:r,roundNumber:y,roundProfile:d,matchUps:s,context:l,isLucky:m});g.appendChild(b)}if(o){const y=document.createElement("div");y.className=pTe();const b=document.createElement("div");b.className=hTe(),b.appendChild(o),y.appendChild(b),g.appendChild(y)}return g}const VX=Tn({backgroundColor:"$colors$backgroundColor",color:"$colors$color",overflowX:"auto",height:1e3});function D9e({content:t,theme:e}){const i=document.createElement("div");return i.className=e?Ny(VX(),e):VX(),e&&i.classList.add(e),typeof t=="string"?i.innerHTML=t:i.appendChild(t),i}const{createTheme:Dw}=pfe({theme:{lineHeights:{scheduleInfo:`${eD.scheduleInfo}rem`,centerInfo:`${eD.centerInfo}rem`,gameScore:`${eD.gameScore}rem`},borderWidths:{matchUpInline:"1px 1px",matchUp:"1px"},space:{1:"10px",2:"0.375rem",gameMarginInlineEnd:"0.25rem"},fontSizes:{1:"0.875rem"},colors:{internalDividers:"lightgray",backgroundColor:"white",connector:"lightgray",border:"darkgray",color:"black"},participant:{textTransform:"capitalize",minHeight:"2rem",seed:"gray"},score:{setWidth:"1.3rem"}}}),jX=Dw("australian-theme",{colors:{borderHover:"#0091d2",connector:"#999"}}),E9e=Dw("wimbledon-theme",{borderWidths:{borderInlineStart:"10px"},colors:{connector:"transparent",borderHover:"darkgrey",border:"#00703c",matchUp:"#fff"},participant:{textTransform:"uppercase"}}),C9e=Dw("french-theme",{colors:{winnerName:"#01503d!important",winner:"#01503d!important",borderHover:"#0091d2",border:"#F8F9F9"},matchUp:{boxShadow:"0 0 30px 0 hsla(0,0%,89%,9)"}}),P9e=Dw("usopen-theme",{colors:{matchUpBackgroundColor:"#F8F9F9",internalDividers:"darkgray",borderHover:"#0091d2",connector:"#999"}}),GX=Dw("basic-theme",{colors:{internalDividers:"transparent",winner:"#50B649!important",loser:"#E61A1A!important",connector:"#999"},space:{gameMarginInlineEnd:"0.75rem"},participant:{seed:"transparent"},fontSizes:{1:"1.5rem"}}),R9e=Dw("dark-theme",{colors:{backgroundColor:"#333333",borderHover:"#0091d2",color:"white"},participant:{seed:"cyan"}}),M9e=Dw("itf-theme",{colors:{borderHover:"#0091d2",connector:"#999",matchUp:"#fff"},participant:{textTransform:"uppercase",seed:"gray"}}),Y_={Australian:{configuration:{flags:!0},theme:jX},Basic:{configuration:{gameScoreOnly:!0,teamLogo:!1,roundHeader:!0,placeHolders:{tbd:"-",bye:"Bye"}},theme:GX},DrawPositions:{configuration:{gameScoreOnly:!0,drawPositions:!0,teamLogo:!1},theme:GX},French:{configuration:{bracketedSeeds:!0,flags:!0},theme:C9e},Wimbledon:{configuration:{resultsInfo:!0,flags:!0},theme:E9e},"US Open":{configuration:{scoreBox:!0,flags:!0},theme:P9e},ITF:{configuration:{winnerChevron:!0,centerInfo:!0,flags:!0,roundHeader:!0},theme:M9e},National:{configuration:{bracketedSeeds:"square",allDrawPositions:!0,drawPositions:!0,scheduleInfo:!0,roundHeader:!0,showAddress:!0,scaleAttributes:{scaleColor:"red",scaleType:"RATING",scaleName:"WTN",accessor:"wtnRating"}},theme:jX},Night:{configuration:{flags:!0},theme:R9e}};function yI(){h_.close()}function cr(t){const{title:e,content:i,buttons:n,footer:r,onClose:a}=t,s={padding:!e&&!n?"":".5",maxWidth:500};return h_.open({title:e,content:i,footer:r,buttons:n,config:s,onClose:a})}async function N9e({callback:t}){var u;const e={providerId:""},n=(u=(await nE()).data)==null?void 0:u.providers,r=n.map(({value:d})=>({label:d.organisationName,value:d.organisationId})),a=n.map(({value:d})=>d.organisationName),o=()=>{var p;const d=(p=n.find(({value:h})=>h.organisationId===e.providerId))==null?void 0:p.value;d&&Nt(t)&&t(d)},s=d=>{const p=d.target.value,h=p===""||a.includes(p),f=document.getElementById("selectButton");f.disabled=!h,e.providerId=h?p:""},l=d=>{const p=document.getElementById("selectButton");e.providerId=d,p.disabled=!d};cr({title:"Select provider",content:d=>{Cr(d,[{typeAhead:{list:r,callback:l},placeholder:"Type provider name",label:"Provider",field:"provider",width:"100%",onInput:s}])},buttons:[{label:"Cancel",intent:"none",close:!0},{onClick:o,intent:"is-primary",id:"selectButton",label:"Select",disabled:!0,close:!0}]})}var yTe={exports:{}};(function(t,e){(function(i,n){t.exports=n()})(Zd,function(){var i=function(V,W){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(J,ne){J.__proto__=ne}||function(J,ne){for(var le in ne)Object.prototype.hasOwnProperty.call(ne,le)&&(J[le]=ne[le])})(V,W)},n=function(){return(n=Object.assign||function(V){for(var W,J=1,ne=arguments.length;J<ne;J++)for(var le in W=arguments[J])Object.prototype.hasOwnProperty.call(W,le)&&(V[le]=W[le]);return V}).apply(this,arguments)};function r(V,W,J){if(J||arguments.length===2)for(var ne,le=0,ve=W.length;le<ve;le++)!ne&&le in W||((ne=ne||Array.prototype.slice.call(W,0,le))[le]=W[le]);return V.concat(ne||Array.prototype.slice.call(W))}var a=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:Zd,o=Object.keys,s=Array.isArray;function l(V,W){return typeof W!="object"||o(W).forEach(function(J){V[J]=W[J]}),V}typeof Promise>"u"||a.Promise||(a.Promise=Promise);var c=Object.getPrototypeOf,u={}.hasOwnProperty;function d(V,W){return u.call(V,W)}function p(V,W){typeof W=="function"&&(W=W(c(V))),(typeof Reflect>"u"?o:Reflect.ownKeys)(W).forEach(function(J){f(V,J,W[J])})}var h=Object.defineProperty;function f(V,W,J,ne){h(V,W,l(J&&d(J,"get")&&typeof J.get=="function"?{get:J.get,set:J.set,configurable:!0}:{value:J,configurable:!0,writable:!0},ne))}function m(V){return{from:function(W){return V.prototype=Object.create(W.prototype),f(V.prototype,"constructor",V),{extend:p.bind(null,V.prototype)}}}}var g=Object.getOwnPropertyDescriptor,v=[].slice;function y(V,W,J){return v.call(V,W,J)}function b(V,W){return W(V)}function I(V){if(!V)throw new Error("Assertion Failed")}function T(V){a.setImmediate?setImmediate(V):setTimeout(V,0)}function w(V,W){if(typeof W=="string"&&d(V,W))return V[W];if(!W)return V;if(typeof W!="string"){for(var J=[],ne=0,le=W.length;ne<le;++ne){var ve=w(V,W[ne]);J.push(ve)}return J}var we=W.indexOf(".");if(we!==-1){var Ce=V[W.substr(0,we)];return Ce==null?void 0:w(Ce,W.substr(we+1))}}function S(V,W,J){if(V&&W!==void 0&&!("isFrozen"in Object&&Object.isFrozen(V)))if(typeof W!="string"&&"length"in W){I(typeof J!="string"&&"length"in J);for(var ne=0,le=W.length;ne<le;++ne)S(V,W[ne],J[ne])}else{var ve,we,Ce=W.indexOf(".");Ce!==-1?(ve=W.substr(0,Ce),(we=W.substr(Ce+1))===""?J===void 0?s(V)&&!isNaN(parseInt(ve))?V.splice(ve,1):delete V[ve]:V[ve]=J:S(Ce=!(Ce=V[ve])||!d(V,ve)?V[ve]={}:Ce,we,J)):J===void 0?s(V)&&!isNaN(parseInt(W))?V.splice(W,1):delete V[W]:V[W]=J}}function D(V){var W,J={};for(W in V)d(V,W)&&(J[W]=V[W]);return J}var E=[].concat;function C(V){return E.apply([],V)}var nn="BigUint64Array,BigInt64Array,Array,Boolean,String,Date,RegExp,Blob,File,FileList,FileSystemFileHandle,FileSystemDirectoryHandle,ArrayBuffer,DataView,Uint8ClampedArray,ImageBitmap,ImageData,Map,Set,CryptoKey".split(",").concat(C([8,16,32,64].map(function(V){return["Int","Uint","Float"].map(function(W){return W+V+"Array"})}))).filter(function(V){return a[V]}),P=new Set(nn.map(function(V){return a[V]})),R=null;function N(V){return R=new WeakMap,V=function W(J){if(!J||typeof J!="object")return J;var ne=R.get(J);if(ne)return ne;if(s(J)){ne=[],R.set(J,ne);for(var le=0,ve=J.length;le<ve;++le)ne.push(W(J[le]))}else if(P.has(J.constructor))ne=J;else{var we,Ce=c(J);for(we in ne=Ce===Object.prototype?{}:Object.create(Ce),R.set(J,ne),J)d(J,we)&&(ne[we]=W(J[we]))}return ne}(V),R=null,V}var M={}.toString;function A(V){return M.call(V).slice(8,-1)}var _=typeof Symbol<"u"?Symbol.iterator:"@@iterator",x=typeof _=="symbol"?function(V){var W;return V!=null&&(W=V[_])&&W.apply(V)}:function(){return null};function O(V,W){return W=V.indexOf(W),0<=W&&V.splice(W,1),0<=W}var B={};function F(V){var W,J,ne,le;if(arguments.length===1){if(s(V))return V.slice();if(this===B&&typeof V=="string")return[V];if(le=x(V)){for(J=[];!(ne=le.next()).done;)J.push(ne.value);return J}if(V==null)return[V];if(typeof(W=V.length)!="number")return[V];for(J=new Array(W);W--;)J[W]=V[W];return J}for(W=arguments.length,J=new Array(W);W--;)J[W]=arguments[W];return J}var G=typeof Symbol<"u"?function(V){return V[Symbol.toStringTag]==="AsyncFunction"}:function(){return!1},nt=["Unknown","Constraint","Data","TransactionInactive","ReadOnly","Version","NotFound","InvalidState","InvalidAccess","Abort","Timeout","QuotaExceeded","Syntax","DataClone"],ts=["Modify","Bulk","OpenFailed","VersionChange","Schema","Upgrade","InvalidTable","MissingAPI","NoSuchDatabase","InvalidArgument","SubTransaction","Unsupported","Internal","DatabaseClosed","PrematureCommit","ForeignAwait"].concat(nt),H={VersionChanged:"Database version changed by other database connection",DatabaseClosed:"Database has been closed",Abort:"Transaction aborted",TransactionInactive:"Transaction has already completed or failed",MissingAPI:"IndexedDB API missing. Please visit https://tinyurl.com/y2uuvskb"};function $(V,W){this.name=V,this.message=W}function q(V,W){return V+". Errors: "+Object.keys(W).map(function(J){return W[J].toString()}).filter(function(J,ne,le){return le.indexOf(J)===ne}).join(`
`)}function z(V,W,J,ne){this.failures=W,this.failedKeys=ne,this.successCount=J,this.message=q(V,W)}function Z(V,W){this.name="BulkError",this.failures=Object.keys(W).map(function(J){return W[J]}),this.failuresByPos=W,this.message=q(V,this.failures)}m($).from(Error).extend({toString:function(){return this.name+": "+this.message}}),m(z).from($),m(Z).from($);var Y=ts.reduce(function(V,W){return V[W]=W+"Error",V},{}),Q=$,X=ts.reduce(function(V,W){var J=W+"Error";function ne(le,ve){this.name=J,le?typeof le=="string"?(this.message="".concat(le).concat(ve?`
 `+ve:""),this.inner=ve||null):typeof le=="object"&&(this.message="".concat(le.name," ").concat(le.message),this.inner=le):(this.message=H[W]||J,this.inner=null)}return m(ne).from(Q),V[W]=ne,V},{});X.Syntax=SyntaxError,X.Type=TypeError,X.Range=RangeError;var oe=nt.reduce(function(V,W){return V[W+"Error"]=X[W],V},{}),re=ts.reduce(function(V,W){return["Syntax","Type","Range"].indexOf(W)===-1&&(V[W+"Error"]=X[W]),V},{});function me(){}function se(V){return V}function te(V,W){return V==null||V===se?W:function(J){return W(V(J))}}function he(V,W){return function(){V.apply(this,arguments),W.apply(this,arguments)}}function ae(V,W){return V===me?W:function(){var J=V.apply(this,arguments);J!==void 0&&(arguments[0]=J);var ne=this.onsuccess,le=this.onerror;this.onsuccess=null,this.onerror=null;var ve=W.apply(this,arguments);return ne&&(this.onsuccess=this.onsuccess?he(ne,this.onsuccess):ne),le&&(this.onerror=this.onerror?he(le,this.onerror):le),ve!==void 0?ve:J}}function de(V,W){return V===me?W:function(){V.apply(this,arguments);var J=this.onsuccess,ne=this.onerror;this.onsuccess=this.onerror=null,W.apply(this,arguments),J&&(this.onsuccess=this.onsuccess?he(J,this.onsuccess):J),ne&&(this.onerror=this.onerror?he(ne,this.onerror):ne)}}function Ie(V,W){return V===me?W:function(J){var ne=V.apply(this,arguments);l(J,ne);var le=this.onsuccess,ve=this.onerror;return this.onsuccess=null,this.onerror=null,J=W.apply(this,arguments),le&&(this.onsuccess=this.onsuccess?he(le,this.onsuccess):le),ve&&(this.onerror=this.onerror?he(ve,this.onerror):ve),ne===void 0?J===void 0?void 0:J:l(ne,J)}}function De(V,W){return V===me?W:function(){return W.apply(this,arguments)!==!1&&V.apply(this,arguments)}}function Te(V,W){return V===me?W:function(){var J=V.apply(this,arguments);if(J&&typeof J.then=="function"){for(var ne=this,le=arguments.length,ve=new Array(le);le--;)ve[le]=arguments[le];return J.then(function(){return W.apply(ne,ve)})}return W.apply(this,arguments)}}re.ModifyError=z,re.DexieError=$,re.BulkError=Z;var _e=typeof location<"u"&&/^(http|https):\/\/(localhost|127\.0\.0\.1)/.test(location.href);function Ve(V){_e=V}var ot={},St=100,nn=typeof Promise>"u"?[]:function(){var V=Promise.resolve();if(typeof crypto>"u"||!crypto.subtle)return[V,c(V),V];var W=crypto.subtle.digest("SHA-512",new Uint8Array([0]));return[W,c(W),V]}(),nt=nn[0],ts=nn[1],nn=nn[2],ts=ts&&ts.then,Bt=nt&&nt.constructor,Pe=!!nn,et=function(V,W){We.push([V,W]),lt&&(queueMicrotask(tt),lt=!1)},Ee=!0,lt=!0,Ke=[],bt=[],gt=se,Ue={id:"global",global:!0,ref:0,unhandleds:[],onunhandled:me,pgp:!1,env:{},finalize:me},xe=Ue,We=[],st=0,vt=[];function ge(V){if(typeof this!="object")throw new TypeError("Promises must be constructed via new");this._listeners=[],this._lib=!1;var W=this._PSD=xe;if(typeof V!="function"){if(V!==ot)throw new TypeError("Not a function");return this._state=arguments[1],this._value=arguments[2],void(this._state===!1&&$e(this,this._value))}this._state=null,this._value=null,++W.ref,function J(ne,le){try{le(function(ve){if(ne._state===null){if(ve===ne)throw new TypeError("A promise cannot be resolved with itself.");var we=ne._lib&&At();ve&&typeof ve.then=="function"?J(ne,function(Ce,Be){ve instanceof ge?ve._then(Ce,Be):ve.then(Ce,Be)}):(ne._state=!0,ne._value=ve,ke(ne)),we&&ei()}},$e.bind(null,ne))}catch(ve){$e(ne,ve)}}(this,V)}var Se={get:function(){var V=xe,W=Ji;function J(ne,le){var ve=this,we=!V.global&&(V!==xe||W!==Ji),Ce=we&&!vo(),Be=new ge(function(Fe,ze){Ut(ve,new qe(Xs(ne,V,we,Ce),Xs(le,V,we,Ce),Fe,ze,V))});return this._consoleTask&&(Be._consoleTask=this._consoleTask),Be}return J.prototype=ot,J},set:function(V){f(this,"then",V&&V.prototype===ot?Se:{get:function(){return V},set:Se.set})}};function qe(V,W,J,ne,le){this.onFulfilled=typeof V=="function"?V:null,this.onRejected=typeof W=="function"?W:null,this.resolve=J,this.reject=ne,this.psd=le}function $e(V,W){var J,ne;bt.push(W),V._state===null&&(J=V._lib&&At(),W=gt(W),V._state=!1,V._value=W,ne=V,Ke.some(function(le){return le._value===ne._value})||Ke.push(ne),ke(V),J&&ei())}function ke(V){var W=V._listeners;V._listeners=[];for(var J=0,ne=W.length;J<ne;++J)Ut(V,W[J]);var le=V._PSD;--le.ref||le.finalize(),st===0&&(++st,et(function(){--st==0&&vi()},[]))}function Ut(V,W){if(V._state!==null){var J=V._state?W.onFulfilled:W.onRejected;if(J===null)return(V._state?W.resolve:W.reject)(V._value);++W.psd.ref,++st,et(pt,[J,V,W])}else V._listeners.push(W)}function pt(V,W,J){try{var ne,le=W._value;!W._state&&bt.length&&(bt=[]),ne=_e&&W._consoleTask?W._consoleTask.run(function(){return V(le)}):V(le),W._state||bt.indexOf(le)!==-1||function(ve){for(var we=Ke.length;we;)if(Ke[--we]._value===ve._value)return Ke.splice(we,1)}(W),J.resolve(ne)}catch(ve){J.reject(ve)}finally{--st==0&&vi(),--J.psd.ref||J.psd.finalize()}}function tt(){Zo(Ue,function(){At()&&ei()})}function At(){var V=Ee;return lt=Ee=!1,V}function ei(){var V,W,J;do for(;0<We.length;)for(V=We,We=[],J=V.length,W=0;W<J;++W){var ne=V[W];ne[0].apply(null,ne[1])}while(0<We.length);lt=Ee=!0}function vi(){var V=Ke;Ke=[],V.forEach(function(ne){ne._PSD.onunhandled.call(null,ne._value,ne)});for(var W=vt.slice(0),J=W.length;J;)W[--J]()}function Ln(V){return new ge(ot,!1,V)}function gn(V,W){var J=xe;return function(){var ne=At(),le=xe;try{return Ma(J,!0),V.apply(this,arguments)}catch(ve){W&&W(ve)}finally{Ma(le,!1),ne&&ei()}}}p(ge.prototype,{then:Se,_then:function(V,W){Ut(this,new qe(null,null,V,W,xe))},catch:function(V){if(arguments.length===1)return this.then(null,V);var W=V,J=arguments[1];return typeof W=="function"?this.then(null,function(ne){return(ne instanceof W?J:Ln)(ne)}):this.then(null,function(ne){return(ne&&ne.name===W?J:Ln)(ne)})},finally:function(V){return this.then(function(W){return ge.resolve(V()).then(function(){return W})},function(W){return ge.resolve(V()).then(function(){return Ln(W)})})},timeout:function(V,W){var J=this;return V<1/0?new ge(function(ne,le){var ve=setTimeout(function(){return le(new X.Timeout(W))},V);J.then(ne,le).finally(clearTimeout.bind(null,ve))}):this}}),typeof Symbol<"u"&&Symbol.toStringTag&&f(ge.prototype,Symbol.toStringTag,"Dexie.Promise"),Ue.env=tu(),p(ge,{all:function(){var V=F.apply(null,arguments).map(aa);return new ge(function(W,J){V.length===0&&W([]);var ne=V.length;V.forEach(function(le,ve){return ge.resolve(le).then(function(we){V[ve]=we,--ne||W(V)},J)})})},resolve:function(V){return V instanceof ge?V:V&&typeof V.then=="function"?new ge(function(W,J){V.then(W,J)}):new ge(ot,!0,V)},reject:Ln,race:function(){var V=F.apply(null,arguments).map(aa);return new ge(function(W,J){V.map(function(ne){return ge.resolve(ne).then(W,J)})})},PSD:{get:function(){return xe},set:function(V){return xe=V}},totalEchoes:{get:function(){return Ji}},newPSD:na,usePSD:Zo,scheduler:{get:function(){return et},set:function(V){et=V}},rejectionMapper:{get:function(){return gt},set:function(V){gt=V}},follow:function(V,W){return new ge(function(J,ne){return na(function(le,ve){var we=xe;we.unhandleds=[],we.onunhandled=ve,we.finalize=he(function(){var Ce,Be=this;Ce=function(){Be.unhandleds.length===0?le():ve(Be.unhandleds[0])},vt.push(function Fe(){Ce(),vt.splice(vt.indexOf(Fe),1)}),++st,et(function(){--st==0&&vi()},[])},we.finalize),V()},W,J,ne)})}}),Bt&&(Bt.allSettled&&f(ge,"allSettled",function(){var V=F.apply(null,arguments).map(aa);return new ge(function(W){V.length===0&&W([]);var J=V.length,ne=new Array(J);V.forEach(function(le,ve){return ge.resolve(le).then(function(we){return ne[ve]={status:"fulfilled",value:we}},function(we){return ne[ve]={status:"rejected",reason:we}}).then(function(){return--J||W(ne)})})})}),Bt.any&&typeof AggregateError<"u"&&f(ge,"any",function(){var V=F.apply(null,arguments).map(aa);return new ge(function(W,J){V.length===0&&J(new AggregateError([]));var ne=V.length,le=new Array(ne);V.forEach(function(ve,we){return ge.resolve(ve).then(function(Ce){return W(Ce)},function(Ce){le[we]=Ce,--ne||J(new AggregateError(le))})})})}));var Jt={awaits:0,echoes:0,id:0},kr=0,Kn=[],Gt=0,Ji=0,xo=0;function na(V,W,J,ne){var le=xe,ve=Object.create(le);return ve.parent=le,ve.ref=0,ve.global=!1,ve.id=++xo,Ue.env,ve.env=Pe?{Promise:ge,PromiseProp:{value:ge,configurable:!0,writable:!0},all:ge.all,race:ge.race,allSettled:ge.allSettled,any:ge.any,resolve:ge.resolve,reject:ge.reject}:{},W&&l(ve,W),++le.ref,ve.finalize=function(){--this.parent.ref||this.parent.finalize()},ne=Zo(ve,V,J,ne),ve.ref===0&&ve.finalize(),ne}function ra(){return Jt.id||(Jt.id=++kr),++Jt.awaits,Jt.echoes+=St,Jt.id}function vo(){return!!Jt.awaits&&(--Jt.awaits==0&&(Jt.id=0),Jt.echoes=Jt.awaits*St,!0)}function aa(V){return Jt.echoes&&V&&V.constructor===Bt?(ra(),V.then(function(W){return vo(),W},function(W){return vo(),Qi(W)})):V}function fr(){var V=Kn[Kn.length-1];Kn.pop(),Ma(V,!1)}function Ma(V,W){var J,ne=xe;(W?!Jt.echoes||Gt++&&V===xe:!Gt||--Gt&&V===xe)||queueMicrotask(W?(function(le){++Ji,Jt.echoes&&--Jt.echoes!=0||(Jt.echoes=Jt.awaits=Jt.id=0),Kn.push(xe),Ma(le,!0)}).bind(null,V):fr),V!==xe&&(xe=V,ne===Ue&&(Ue.env=tu()),Pe&&(J=Ue.env.Promise,W=V.env,(ne.global||V.global)&&(Object.defineProperty(a,"Promise",W.PromiseProp),J.all=W.all,J.race=W.race,J.resolve=W.resolve,J.reject=W.reject,W.allSettled&&(J.allSettled=W.allSettled),W.any&&(J.any=W.any))))}function tu(){var V=a.Promise;return Pe?{Promise:V,PromiseProp:Object.getOwnPropertyDescriptor(a,"Promise"),all:V.all,race:V.race,allSettled:V.allSettled,any:V.any,resolve:V.resolve,reject:V.reject}:{}}function Zo(V,W,J,ne,le){var ve=xe;try{return Ma(V,!0),W(J,ne,le)}finally{Ma(ve,!1)}}function Xs(V,W,J,ne){return typeof V!="function"?V:function(){var le=xe;J&&ra(),Ma(W,!0);try{return V.apply(this,arguments)}finally{Ma(le,!1),ne&&queueMicrotask(vo)}}}function Os(V){Promise===Bt&&Jt.echoes===0?Gt===0?V():enqueueNativeMicroTask(V):setTimeout(V,0)}(""+ts).indexOf("[native code]")===-1&&(ra=vo=me);var Qi=ge.reject,za="",Pr="Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.",Vi="String expected.",Ls=[],hl="__dbnames",Fs="readonly",mt="readwrite";function hi(V,W){return V?W?function(){return V.apply(this,arguments)&&W.apply(this,arguments)}:V:W}var Nn={type:3,lower:-1/0,lowerOpen:!1,upper:[[]],upperOpen:!1};function xr(V){return typeof V!="string"||/\./.test(V)?function(W){return W}:function(W){return W[V]===void 0&&V in W&&delete(W=N(W))[V],W}}function cs(){throw X.Type()}function pn(V,W){try{var J=Un(V),ne=Un(W);if(J!==ne)return J==="Array"?1:ne==="Array"?-1:J==="binary"?1:ne==="binary"?-1:J==="string"?1:ne==="string"?-1:J==="Date"?1:ne!=="Date"?NaN:-1;switch(J){case"number":case"Date":case"string":return W<V?1:V<W?-1:0;case"binary":return function(le,ve){for(var we=le.length,Ce=ve.length,Be=we<Ce?we:Ce,Fe=0;Fe<Be;++Fe)if(le[Fe]!==ve[Fe])return le[Fe]<ve[Fe]?-1:1;return we===Ce?0:we<Ce?-1:1}(mr(V),mr(W));case"Array":return function(le,ve){for(var we=le.length,Ce=ve.length,Be=we<Ce?we:Ce,Fe=0;Fe<Be;++Fe){var ze=pn(le[Fe],ve[Fe]);if(ze!==0)return ze}return we===Ce?0:we<Ce?-1:1}(V,W)}}catch{}return NaN}function Un(V){var W=typeof V;return W!="object"?W:ArrayBuffer.isView(V)?"binary":(V=A(V),V==="ArrayBuffer"?"binary":V)}function mr(V){return V instanceof Uint8Array?V:ArrayBuffer.isView(V)?new Uint8Array(V.buffer,V.byteOffset,V.byteLength):new Uint8Array(V)}var Vl=(Dn.prototype._trans=function(V,W,J){var ne=this._tx||xe.trans,le=this.name,ve=_e&&typeof console<"u"&&console.createTask&&console.createTask("Dexie: ".concat(V==="readonly"?"read":"write"," ").concat(this.name));function we(Fe,ze,Oe){if(!Oe.schema[le])throw new X.NotFound("Table "+le+" not part of transaction");return W(Oe.idbtrans,Oe)}var Ce=At();try{var Be=ne&&ne.db._novip===this.db._novip?ne===xe.trans?ne._promise(V,we,J):na(function(){return ne._promise(V,we,J)},{trans:ne,transless:xe.transless||xe}):function Fe(ze,Oe,Le,je){if(ze.idbdb&&(ze._state.openComplete||xe.letThrough||ze._vip)){var He=ze._createTransaction(Oe,Le,ze._dbSchema);try{He.create(),ze._state.PR1398_maxLoop=3}catch(Ye){return Ye.name===Y.InvalidState&&ze.isOpen()&&0<--ze._state.PR1398_maxLoop?(console.warn("Dexie: Need to reopen db"),ze.close({disableAutoOpen:!1}),ze.open().then(function(){return Fe(ze,Oe,Le,je)})):Qi(Ye)}return He._promise(Oe,function(Ye,Ge){return na(function(){return xe.trans=He,je(Ye,Ge,He)})}).then(function(Ye){if(Oe==="readwrite")try{He.idbtrans.commit()}catch{}return Oe==="readonly"?Ye:He._completion.then(function(){return Ye})})}if(ze._state.openComplete)return Qi(new X.DatabaseClosed(ze._state.dbOpenError));if(!ze._state.isBeingOpened){if(!ze._state.autoOpen)return Qi(new X.DatabaseClosed);ze.open().catch(me)}return ze._state.dbReadyPromise.then(function(){return Fe(ze,Oe,Le,je)})}(this.db,V,[this.name],we);return ve&&(Be._consoleTask=ve,Be=Be.catch(function(Fe){return console.trace(Fe),Qi(Fe)})),Be}finally{Ce&&ei()}},Dn.prototype.get=function(V,W){var J=this;return V&&V.constructor===Object?this.where(V).first(W):V==null?Qi(new X.Type("Invalid argument to Table.get()")):this._trans("readonly",function(ne){return J.core.get({trans:ne,key:V}).then(function(le){return J.hook.reading.fire(le)})}).then(W)},Dn.prototype.where=function(V){if(typeof V=="string")return new this.db.WhereClause(this,V);if(s(V))return new this.db.WhereClause(this,"[".concat(V.join("+"),"]"));var W=o(V);if(W.length===1)return this.where(W[0]).equals(V[W[0]]);var J=this.schema.indexes.concat(this.schema.primKey).filter(function(Be){if(Be.compound&&W.every(function(ze){return 0<=Be.keyPath.indexOf(ze)})){for(var Fe=0;Fe<W.length;++Fe)if(W.indexOf(Be.keyPath[Fe])===-1)return!1;return!0}return!1}).sort(function(Be,Fe){return Be.keyPath.length-Fe.keyPath.length})[0];if(J&&this.db._maxKey!==za){var we=J.keyPath.slice(0,W.length);return this.where(we).equals(we.map(function(Fe){return V[Fe]}))}!J&&_e&&console.warn("The query ".concat(JSON.stringify(V)," on ").concat(this.name," would benefit from a ")+"compound index [".concat(W.join("+"),"]"));var ne=this.schema.idxByName,le=this.db._deps.indexedDB;function ve(Be,Fe){return le.cmp(Be,Fe)===0}var Ce=W.reduce(function(Le,Fe){var ze=Le[0],Oe=Le[1],Le=ne[Fe],je=V[Fe];return[ze||Le,ze||!Le?hi(Oe,Le&&Le.multi?function(He){return He=w(He,Fe),s(He)&&He.some(function(Ye){return ve(je,Ye)})}:function(He){return ve(je,w(He,Fe))}):Oe]},[null,null]),we=Ce[0],Ce=Ce[1];return we?this.where(we.name).equals(V[we.keyPath]).filter(Ce):J?this.filter(Ce):this.where(W).equals("")},Dn.prototype.filter=function(V){return this.toCollection().and(V)},Dn.prototype.count=function(V){return this.toCollection().count(V)},Dn.prototype.offset=function(V){return this.toCollection().offset(V)},Dn.prototype.limit=function(V){return this.toCollection().limit(V)},Dn.prototype.each=function(V){return this.toCollection().each(V)},Dn.prototype.toArray=function(V){return this.toCollection().toArray(V)},Dn.prototype.toCollection=function(){return new this.db.Collection(new this.db.WhereClause(this))},Dn.prototype.orderBy=function(V){return new this.db.Collection(new this.db.WhereClause(this,s(V)?"[".concat(V.join("+"),"]"):V))},Dn.prototype.reverse=function(){return this.toCollection().reverse()},Dn.prototype.mapToClass=function(V){var W,J=this.db,ne=this.name;function le(){return W!==null&&W.apply(this,arguments)||this}(this.schema.mappedClass=V).prototype instanceof cs&&(function(Be,Fe){if(typeof Fe!="function"&&Fe!==null)throw new TypeError("Class extends value "+String(Fe)+" is not a constructor or null");function ze(){this.constructor=Be}i(Be,Fe),Be.prototype=Fe===null?Object.create(Fe):(ze.prototype=Fe.prototype,new ze)}(le,W=V),Object.defineProperty(le.prototype,"db",{get:function(){return J},enumerable:!1,configurable:!0}),le.prototype.table=function(){return ne},V=le);for(var ve=new Set,we=V.prototype;we;we=c(we))Object.getOwnPropertyNames(we).forEach(function(Be){return ve.add(Be)});function Ce(Be){if(!Be)return Be;var Fe,ze=Object.create(V.prototype);for(Fe in Be)if(!ve.has(Fe))try{ze[Fe]=Be[Fe]}catch{}return ze}return this.schema.readHook&&this.hook.reading.unsubscribe(this.schema.readHook),this.schema.readHook=Ce,this.hook("reading",Ce),V},Dn.prototype.defineClass=function(){return this.mapToClass(function(V){l(this,V)})},Dn.prototype.add=function(V,W){var J=this,ne=this.schema.primKey,le=ne.auto,ve=ne.keyPath,we=V;return ve&&le&&(we=xr(ve)(V)),this._trans("readwrite",function(Ce){return J.core.mutate({trans:Ce,type:"add",keys:W!=null?[W]:null,values:[we]})}).then(function(Ce){return Ce.numFailures?ge.reject(Ce.failures[0]):Ce.lastResult}).then(function(Ce){if(ve)try{S(V,ve,Ce)}catch{}return Ce})},Dn.prototype.update=function(V,W){return typeof V!="object"||s(V)?this.where(":id").equals(V).modify(W):(V=w(V,this.schema.primKey.keyPath),V===void 0?Qi(new X.InvalidArgument("Given object does not contain its primary key")):this.where(":id").equals(V).modify(W))},Dn.prototype.put=function(V,W){var J=this,ne=this.schema.primKey,le=ne.auto,ve=ne.keyPath,we=V;return ve&&le&&(we=xr(ve)(V)),this._trans("readwrite",function(Ce){return J.core.mutate({trans:Ce,type:"put",values:[we],keys:W!=null?[W]:null})}).then(function(Ce){return Ce.numFailures?ge.reject(Ce.failures[0]):Ce.lastResult}).then(function(Ce){if(ve)try{S(V,ve,Ce)}catch{}return Ce})},Dn.prototype.delete=function(V){var W=this;return this._trans("readwrite",function(J){return W.core.mutate({trans:J,type:"delete",keys:[V]})}).then(function(J){return J.numFailures?ge.reject(J.failures[0]):void 0})},Dn.prototype.clear=function(){var V=this;return this._trans("readwrite",function(W){return V.core.mutate({trans:W,type:"deleteRange",range:Nn})}).then(function(W){return W.numFailures?ge.reject(W.failures[0]):void 0})},Dn.prototype.bulkGet=function(V){var W=this;return this._trans("readonly",function(J){return W.core.getMany({keys:V,trans:J}).then(function(ne){return ne.map(function(le){return W.hook.reading.fire(le)})})})},Dn.prototype.bulkAdd=function(V,W,J){var ne=this,le=Array.isArray(W)?W:void 0,ve=(J=J||(le?void 0:W))?J.allKeys:void 0;return this._trans("readwrite",function(we){var Fe=ne.schema.primKey,Ce=Fe.auto,Fe=Fe.keyPath;if(Fe&&le)throw new X.InvalidArgument("bulkAdd(): keys argument invalid on tables with inbound keys");if(le&&le.length!==V.length)throw new X.InvalidArgument("Arguments objects and keys must have the same length");var Be=V.length,Fe=Fe&&Ce?V.map(xr(Fe)):V;return ne.core.mutate({trans:we,type:"add",keys:le,values:Fe,wantResults:ve}).then(function(He){var Oe=He.numFailures,Le=He.results,je=He.lastResult,He=He.failures;if(Oe===0)return ve?Le:je;throw new Z("".concat(ne.name,".bulkAdd(): ").concat(Oe," of ").concat(Be," operations failed"),He)})})},Dn.prototype.bulkPut=function(V,W,J){var ne=this,le=Array.isArray(W)?W:void 0,ve=(J=J||(le?void 0:W))?J.allKeys:void 0;return this._trans("readwrite",function(we){var Fe=ne.schema.primKey,Ce=Fe.auto,Fe=Fe.keyPath;if(Fe&&le)throw new X.InvalidArgument("bulkPut(): keys argument invalid on tables with inbound keys");if(le&&le.length!==V.length)throw new X.InvalidArgument("Arguments objects and keys must have the same length");var Be=V.length,Fe=Fe&&Ce?V.map(xr(Fe)):V;return ne.core.mutate({trans:we,type:"put",keys:le,values:Fe,wantResults:ve}).then(function(He){var Oe=He.numFailures,Le=He.results,je=He.lastResult,He=He.failures;if(Oe===0)return ve?Le:je;throw new Z("".concat(ne.name,".bulkPut(): ").concat(Oe," of ").concat(Be," operations failed"),He)})})},Dn.prototype.bulkUpdate=function(V){var W=this,J=this.core,ne=V.map(function(we){return we.key}),le=V.map(function(we){return we.changes}),ve=[];return this._trans("readwrite",function(we){return J.getMany({trans:we,keys:ne,cache:"clone"}).then(function(Ce){var Be=[],Fe=[];V.forEach(function(Oe,Le){var je=Oe.key,He=Oe.changes,Ye=Ce[Le];if(Ye){for(var Ge=0,Qe=Object.keys(He);Ge<Qe.length;Ge++){var Xe=Qe[Ge],ct=He[Xe];if(Xe===W.schema.primKey.keyPath){if(pn(ct,je)!==0)throw new X.Constraint("Cannot update primary key in bulkUpdate()")}else S(Ye,Xe,ct)}ve.push(Le),Be.push(je),Fe.push(Ye)}});var ze=Be.length;return J.mutate({trans:we,type:"put",keys:Be,values:Fe,updates:{keys:ne,changeSpecs:le}}).then(function(Oe){var Le=Oe.numFailures,je=Oe.failures;if(Le===0)return ze;for(var He=0,Ye=Object.keys(je);He<Ye.length;He++){var Ge,Qe=Ye[He],Xe=ve[Number(Qe)];Xe!=null&&(Ge=je[Qe],delete je[Qe],je[Xe]=Ge)}throw new Z("".concat(W.name,".bulkUpdate(): ").concat(Le," of ").concat(ze," operations failed"),je)})})})},Dn.prototype.bulkDelete=function(V){var W=this,J=V.length;return this._trans("readwrite",function(ne){return W.core.mutate({trans:ne,type:"delete",keys:V})}).then(function(we){var le=we.numFailures,ve=we.lastResult,we=we.failures;if(le===0)return ve;throw new Z("".concat(W.name,".bulkDelete(): ").concat(le," of ").concat(J," operations failed"),we)})},Dn);function Dn(){}function Na(V){function W(we,Ce){if(Ce){for(var Be=arguments.length,Fe=new Array(Be-1);--Be;)Fe[Be-1]=arguments[Be];return J[we].subscribe.apply(null,Fe),V}if(typeof we=="string")return J[we]}var J={};W.addEventType=ve;for(var ne=1,le=arguments.length;ne<le;++ne)ve(arguments[ne]);return W;function ve(we,Ce,Be){if(typeof we!="object"){var Fe;Ce=Ce||De;var ze={subscribers:[],fire:Be=Be||me,subscribe:function(Oe){ze.subscribers.indexOf(Oe)===-1&&(ze.subscribers.push(Oe),ze.fire=Ce(ze.fire,Oe))},unsubscribe:function(Oe){ze.subscribers=ze.subscribers.filter(function(Le){return Le!==Oe}),ze.fire=ze.subscribers.reduce(Ce,Be)}};return J[we]=W[we]=ze}o(Fe=we).forEach(function(Oe){var Le=Fe[Oe];if(s(Le))ve(Oe,Fe[Oe][0],Fe[Oe][1]);else{if(Le!=="asap")throw new X.InvalidArgument("Invalid event config");var je=ve(Oe,se,function(){for(var He=arguments.length,Ye=new Array(He);He--;)Ye[He]=arguments[He];je.subscribers.forEach(function(Ge){T(function(){Ge.apply(null,Ye)})})})}})}}function Yi(V,W){return m(W).from({prototype:V}),W}function Di(V,W){return!(V.filter||V.algorithm||V.or)&&(W?V.justLimit:!V.replayFilter)}function gr(V,W){V.filter=hi(V.filter,W)}function xi(V,W,J){var ne=V.replayFilter;V.replayFilter=ne?function(){return hi(ne(),W())}:W,V.justLimit=J&&!ne}function vr(V,W){if(V.isPrimKey)return W.primaryKey;var J=W.getIndexByKeyPath(V.index);if(!J)throw new X.Schema("KeyPath "+V.index+" on object store "+W.name+" is not indexed");return J}function _t(V,W,J){var ne=vr(V,W.schema);return W.openCursor({trans:J,values:!V.keysOnly,reverse:V.dir==="prev",unique:!!V.unique,query:{index:ne,range:V.range}})}function oi(V,W,J,ne){var le=V.replayFilter?hi(V.filter,V.replayFilter()):V.filter;if(V.or){var ve={},we=function(Ce,Be,Fe){var ze,Oe;le&&!le(Be,Fe,function(Le){return Be.stop(Le)},function(Le){return Be.fail(Le)})||((Oe=""+(ze=Be.primaryKey))=="[object ArrayBuffer]"&&(Oe=""+new Uint8Array(ze)),d(ve,Oe)||(ve[Oe]=!0,W(Ce,Be,Fe)))};return Promise.all([V.or._iterate(we,J),Oi(_t(V,ne,J),V.algorithm,we,!V.keysOnly&&V.valueMapper)])}return Oi(_t(V,ne,J),hi(V.algorithm,le),W,!V.keysOnly&&V.valueMapper)}function Oi(V,W,J,ne){var le=gn(ne?function(ve,we,Ce){return J(ne(ve),we,Ce)}:J);return V.then(function(ve){if(ve)return ve.start(function(){var we=function(){return ve.continue()};W&&!W(ve,function(Ce){return we=Ce},function(Ce){ve.stop(Ce),we=me},function(Ce){ve.fail(Ce),we=me})||le(ve.value,ve,function(Ce){return we=Ce}),we()})})}var nn=Symbol(),si=(ji.prototype.execute=function(V){var W=(W=this.replacePrefix)===null||W===void 0?void 0:W[0];return W&&typeof V=="string"&&V.startsWith(W)?this.replacePrefix[1]+V.substring(W.length):V},ji);function ji(V){Object.assign(this,V)}var ur=(Mi.prototype._read=function(V,W){var J=this._ctx;return J.error?J.table._trans(null,Qi.bind(null,J.error)):J.table._trans("readonly",V).then(W)},Mi.prototype._write=function(V){var W=this._ctx;return W.error?W.table._trans(null,Qi.bind(null,W.error)):W.table._trans("readwrite",V,"locked")},Mi.prototype._addAlgorithm=function(V){var W=this._ctx;W.algorithm=hi(W.algorithm,V)},Mi.prototype._iterate=function(V,W){return oi(this._ctx,V,W,this._ctx.table.core)},Mi.prototype.clone=function(V){var W=Object.create(this.constructor.prototype),J=Object.create(this._ctx);return V&&l(J,V),W._ctx=J,W},Mi.prototype.raw=function(){return this._ctx.valueMapper=null,this},Mi.prototype.each=function(V){var W=this._ctx;return this._read(function(J){return oi(W,V,J,W.table.core)})},Mi.prototype.count=function(V){var W=this;return this._read(function(J){var ne=W._ctx,le=ne.table.core;if(Di(ne,!0))return le.count({trans:J,query:{index:vr(ne,le.schema),range:ne.range}}).then(function(we){return Math.min(we,ne.limit)});var ve=0;return oi(ne,function(){return++ve,!1},J,le).then(function(){return ve})}).then(V)},Mi.prototype.sortBy=function(V,W){var J=V.split(".").reverse(),ne=J[0],le=J.length-1;function ve(Be,Fe){return Fe?ve(Be[J[Fe]],Fe-1):Be[ne]}var we=this._ctx.dir==="next"?1:-1;function Ce(Be,Fe){return Be=ve(Be,le),Fe=ve(Fe,le),Be<Fe?-we:Fe<Be?we:0}return this.toArray(function(Be){return Be.sort(Ce)}).then(W)},Mi.prototype.toArray=function(V){var W=this;return this._read(function(J){var ne=W._ctx;if(ne.dir==="next"&&Di(ne,!0)&&0<ne.limit){var le=ne.valueMapper,ve=vr(ne,ne.table.core.schema);return ne.table.core.query({trans:J,limit:ne.limit,values:!0,query:{index:ve,range:ne.range}}).then(function(Ce){return Ce=Ce.result,le?Ce.map(le):Ce})}var we=[];return oi(ne,function(Ce){return we.push(Ce)},J,ne.table.core).then(function(){return we})},V)},Mi.prototype.offset=function(V){var W=this._ctx;return V<=0||(W.offset+=V,Di(W)?xi(W,function(){var J=V;return function(ne,le){return J===0||(J===1?--J:le(function(){ne.advance(J),J=0}),!1)}}):xi(W,function(){var J=V;return function(){return--J<0}})),this},Mi.prototype.limit=function(V){return this._ctx.limit=Math.min(this._ctx.limit,V),xi(this._ctx,function(){var W=V;return function(J,ne,le){return--W<=0&&ne(le),0<=W}},!0),this},Mi.prototype.until=function(V,W){return gr(this._ctx,function(J,ne,le){return!V(J.value)||(ne(le),W)}),this},Mi.prototype.first=function(V){return this.limit(1).toArray(function(W){return W[0]}).then(V)},Mi.prototype.last=function(V){return this.reverse().first(V)},Mi.prototype.filter=function(V){var W;return gr(this._ctx,function(J){return V(J.value)}),(W=this._ctx).isMatch=hi(W.isMatch,V),this},Mi.prototype.and=function(V){return this.filter(V)},Mi.prototype.or=function(V){return new this.db.WhereClause(this._ctx.table,V,this)},Mi.prototype.reverse=function(){return this._ctx.dir=this._ctx.dir==="prev"?"next":"prev",this._ondirectionchange&&this._ondirectionchange(this._ctx.dir),this},Mi.prototype.desc=function(){return this.reverse()},Mi.prototype.eachKey=function(V){var W=this._ctx;return W.keysOnly=!W.isMatch,this.each(function(J,ne){V(ne.key,ne)})},Mi.prototype.eachUniqueKey=function(V){return this._ctx.unique="unique",this.eachKey(V)},Mi.prototype.eachPrimaryKey=function(V){var W=this._ctx;return W.keysOnly=!W.isMatch,this.each(function(J,ne){V(ne.primaryKey,ne)})},Mi.prototype.keys=function(V){var W=this._ctx;W.keysOnly=!W.isMatch;var J=[];return this.each(function(ne,le){J.push(le.key)}).then(function(){return J}).then(V)},Mi.prototype.primaryKeys=function(V){var W=this._ctx;if(W.dir==="next"&&Di(W,!0)&&0<W.limit)return this._read(function(ne){var le=vr(W,W.table.core.schema);return W.table.core.query({trans:ne,values:!1,limit:W.limit,query:{index:le,range:W.range}})}).then(function(ne){return ne.result}).then(V);W.keysOnly=!W.isMatch;var J=[];return this.each(function(ne,le){J.push(le.primaryKey)}).then(function(){return J}).then(V)},Mi.prototype.uniqueKeys=function(V){return this._ctx.unique="unique",this.keys(V)},Mi.prototype.firstKey=function(V){return this.limit(1).keys(function(W){return W[0]}).then(V)},Mi.prototype.lastKey=function(V){return this.reverse().firstKey(V)},Mi.prototype.distinct=function(){var V=this._ctx,V=V.index&&V.table.schema.idxByName[V.index];if(!V||!V.multi)return this;var W={};return gr(this._ctx,function(le){var ne=le.primaryKey.toString(),le=d(W,ne);return W[ne]=!0,!le}),this},Mi.prototype.modify=function(V){var W=this,J=this._ctx;return this._write(function(ne){var le,ve,we;we=typeof V=="function"?V:(le=o(V),ve=le.length,function(Ge){for(var Qe=!1,Xe=0;Xe<ve;++Xe){var ct=le[Xe],ht=V[ct],It=w(Ge,ct);ht instanceof si?(S(Ge,ct,ht.execute(It)),Qe=!0):It!==ht&&(S(Ge,ct,ht),Qe=!0)}return Qe});function Ce(Ge,ct){var Xe=ct.failures,ct=ct.numFailures;He+=Ge-ct;for(var ht=0,It=o(Xe);ht<It.length;ht++){var jt=It[ht];je.push(Xe[jt])}}var Be=J.table.core,Fe=Be.schema.primaryKey,ze=Fe.outbound,Oe=Fe.extractKey,Le=W.db._options.modifyChunkSize||200,je=[],He=0,Ye=[];return W.clone().primaryKeys().then(function(Ge){function Qe(Xe){var ct=Math.min(Le,Ge.length-Xe);return Be.getMany({trans:ne,keys:Ge.slice(Xe,Xe+ct),cache:"immutable"}).then(function(ht){for(var It=[],jt=[],Pt=ze?[]:null,Kt=[],Rt=0;Rt<ct;++Rt){var Ni=ht[Rt],Ai={value:N(Ni),primKey:Ge[Xe+Rt]};we.call(Ai,Ai.value,Ai)!==!1&&(Ai.value==null?Kt.push(Ge[Xe+Rt]):ze||pn(Oe(Ni),Oe(Ai.value))===0?(jt.push(Ai.value),ze&&Pt.push(Ge[Xe+Rt])):(Kt.push(Ge[Xe+Rt]),It.push(Ai.value)))}var Or=Di(J)&&J.limit===1/0&&(typeof V!="function"||V===Sa)&&{index:J.index,range:J.range};return Promise.resolve(0<It.length&&Be.mutate({trans:ne,type:"add",values:It}).then(function(Cn){for(var oa in Cn.failures)Kt.splice(parseInt(oa),1);Ce(It.length,Cn)})).then(function(){return(0<jt.length||Or&&typeof V=="object")&&Be.mutate({trans:ne,type:"put",keys:Pt,values:jt,criteria:Or,changeSpec:typeof V!="function"&&V}).then(function(Cn){return Ce(jt.length,Cn)})}).then(function(){return(0<Kt.length||Or&&V===Sa)&&Be.mutate({trans:ne,type:"delete",keys:Kt,criteria:Or}).then(function(Cn){return Ce(Kt.length,Cn)})}).then(function(){return Ge.length>Xe+ct&&Qe(Xe+Le)})})}return Qe(0).then(function(){if(0<je.length)throw new z("Error modifying one or more objects",je,He,Ye);return Ge.length})})})},Mi.prototype.delete=function(){var V=this._ctx,W=V.range;return Di(V)&&(V.isPrimKey||W.type===3)?this._write(function(J){var ne=V.table.core.schema.primaryKey,le=W;return V.table.core.count({trans:J,query:{index:ne,range:le}}).then(function(ve){return V.table.core.mutate({trans:J,type:"deleteRange",range:le}).then(function(we){var Ce=we.failures;if(we.lastResult,we.results,we=we.numFailures,we)throw new z("Could not delete some values",Object.keys(Ce).map(function(Be){return Ce[Be]}),ve-we);return ve-we})})}):this.modify(Sa)},Mi);function Mi(){}var Sa=function(V,W){return W.value=null};function jl(V,W){return V<W?-1:V===W?0:1}function Xo(V,W){return W<V?-1:V===W?0:1}function Aa(V,W,J){return V=V instanceof Jo?new V.Collection(V):V,V._ctx.error=new(J||TypeError)(W),V}function Bs(V){return new V.Collection(V,function(){return _d("")}).limit(0)}function Ad(V,W,J,ne){var le,ve,we,Ce,Be,Fe,ze,Oe=J.length;if(!J.every(function(He){return typeof He=="string"}))return Aa(V,Vi);function Le(He){le=He==="next"?function(Ge){return Ge.toUpperCase()}:function(Ge){return Ge.toLowerCase()},ve=He==="next"?function(Ge){return Ge.toLowerCase()}:function(Ge){return Ge.toUpperCase()},we=He==="next"?jl:Xo;var Ye=J.map(function(Ge){return{lower:ve(Ge),upper:le(Ge)}}).sort(function(Ge,Qe){return we(Ge.lower,Qe.lower)});Ce=Ye.map(function(Ge){return Ge.upper}),Be=Ye.map(function(Ge){return Ge.lower}),ze=(Fe=He)==="next"?"":ne}Le("next"),V=new V.Collection(V,function(){return Gl(Ce[0],Be[Oe-1]+ne)}),V._ondirectionchange=function(He){Le(He)};var je=0;return V._addAlgorithm(function(He,Ye,Ge){var Qe=He.key;if(typeof Qe!="string")return!1;var Xe=ve(Qe);if(W(Xe,Be,je))return!0;for(var ct=null,ht=je;ht<Oe;++ht){var It=function(jt,Pt,Kt,Rt,Ni,Ai){for(var Or=Math.min(jt.length,Rt.length),Cn=-1,oa=0;oa<Or;++oa){var yo=Pt[oa];if(yo!==Rt[oa])return Ni(jt[oa],Kt[oa])<0?jt.substr(0,oa)+Kt[oa]+Kt.substr(oa+1):Ni(jt[oa],Rt[oa])<0?jt.substr(0,oa)+Rt[oa]+Kt.substr(oa+1):0<=Cn?jt.substr(0,Cn)+Pt[Cn]+Kt.substr(Cn+1):null;Ni(jt[oa],yo)<0&&(Cn=oa)}return Or<Rt.length&&Ai==="next"?jt+Kt.substr(jt.length):Or<jt.length&&Ai==="prev"?jt.substr(0,Kt.length):Cn<0?null:jt.substr(0,Cn)+Rt[Cn]+Kt.substr(Cn+1)}(Qe,Xe,Ce[ht],Be[ht],we,Fe);It===null&&ct===null?je=ht+1:(ct===null||0<we(ct,It))&&(ct=It)}return Ye(ct!==null?function(){He.continue(ct+ze)}:Ge),!1}),V}function Gl(V,W,J,ne){return{type:2,lower:V,upper:W,lowerOpen:J,upperOpen:ne}}function _d(V){return{type:1,lower:V,upper:V}}var Jo=(Object.defineProperty(Ta.prototype,"Collection",{get:function(){return this._ctx.table.db.Collection},enumerable:!1,configurable:!0}),Ta.prototype.between=function(V,W,J,ne){J=J!==!1,ne=ne===!0;try{return 0<this._cmp(V,W)||this._cmp(V,W)===0&&(J||ne)&&(!J||!ne)?Bs(this):new this.Collection(this,function(){return Gl(V,W,!J,!ne)})}catch{return Aa(this,Pr)}},Ta.prototype.equals=function(V){return V==null?Aa(this,Pr):new this.Collection(this,function(){return _d(V)})},Ta.prototype.above=function(V){return V==null?Aa(this,Pr):new this.Collection(this,function(){return Gl(V,void 0,!0)})},Ta.prototype.aboveOrEqual=function(V){return V==null?Aa(this,Pr):new this.Collection(this,function(){return Gl(V,void 0,!1)})},Ta.prototype.below=function(V){return V==null?Aa(this,Pr):new this.Collection(this,function(){return Gl(void 0,V,!1,!0)})},Ta.prototype.belowOrEqual=function(V){return V==null?Aa(this,Pr):new this.Collection(this,function(){return Gl(void 0,V)})},Ta.prototype.startsWith=function(V){return typeof V!="string"?Aa(this,Vi):this.between(V,V+za,!0,!0)},Ta.prototype.startsWithIgnoreCase=function(V){return V===""?this.startsWith(V):Ad(this,function(W,J){return W.indexOf(J[0])===0},[V],za)},Ta.prototype.equalsIgnoreCase=function(V){return Ad(this,function(W,J){return W===J[0]},[V],"")},Ta.prototype.anyOfIgnoreCase=function(){var V=F.apply(B,arguments);return V.length===0?Bs(this):Ad(this,function(W,J){return J.indexOf(W)!==-1},V,"")},Ta.prototype.startsWithAnyOfIgnoreCase=function(){var V=F.apply(B,arguments);return V.length===0?Bs(this):Ad(this,function(W,J){return J.some(function(ne){return W.indexOf(ne)===0})},V,za)},Ta.prototype.anyOf=function(){var V=this,W=F.apply(B,arguments),J=this._cmp;try{W.sort(J)}catch{return Aa(this,Pr)}if(W.length===0)return Bs(this);var ne=new this.Collection(this,function(){return Gl(W[0],W[W.length-1])});ne._ondirectionchange=function(ve){J=ve==="next"?V._ascending:V._descending,W.sort(J)};var le=0;return ne._addAlgorithm(function(ve,we,Ce){for(var Be=ve.key;0<J(Be,W[le]);)if(++le===W.length)return we(Ce),!1;return J(Be,W[le])===0||(we(function(){ve.continue(W[le])}),!1)}),ne},Ta.prototype.notEqual=function(V){return this.inAnyRange([[-1/0,V],[V,this.db._maxKey]],{includeLowers:!1,includeUppers:!1})},Ta.prototype.noneOf=function(){var V=F.apply(B,arguments);if(V.length===0)return new this.Collection(this);try{V.sort(this._ascending)}catch{return Aa(this,Pr)}var W=V.reduce(function(J,ne){return J?J.concat([[J[J.length-1][1],ne]]):[[-1/0,ne]]},null);return W.push([V[V.length-1],this.db._maxKey]),this.inAnyRange(W,{includeLowers:!1,includeUppers:!1})},Ta.prototype.inAnyRange=function(Qe,W){var J=this,ne=this._cmp,le=this._ascending,ve=this._descending,we=this._min,Ce=this._max;if(Qe.length===0)return Bs(this);if(!Qe.every(function(Xe){return Xe[0]!==void 0&&Xe[1]!==void 0&&le(Xe[0],Xe[1])<=0}))return Aa(this,"First argument to inAnyRange() must be an Array of two-value Arrays [lower,upper] where upper must not be lower than lower",X.InvalidArgument);var Be=!W||W.includeLowers!==!1,Fe=W&&W.includeUppers===!0,ze,Oe=le;function Le(Xe,ct){return Oe(Xe[0],ct[0])}try{(ze=Qe.reduce(function(Xe,ct){for(var ht=0,It=Xe.length;ht<It;++ht){var jt=Xe[ht];if(ne(ct[0],jt[1])<0&&0<ne(ct[1],jt[0])){jt[0]=we(jt[0],ct[0]),jt[1]=Ce(jt[1],ct[1]);break}}return ht===It&&Xe.push(ct),Xe},[])).sort(Le)}catch{return Aa(this,Pr)}var je=0,He=Fe?function(Xe){return 0<le(Xe,ze[je][1])}:function(Xe){return 0<=le(Xe,ze[je][1])},Ye=Be?function(Xe){return 0<ve(Xe,ze[je][0])}:function(Xe){return 0<=ve(Xe,ze[je][0])},Ge=He,Qe=new this.Collection(this,function(){return Gl(ze[0][0],ze[ze.length-1][1],!Be,!Fe)});return Qe._ondirectionchange=function(Xe){Oe=Xe==="next"?(Ge=He,le):(Ge=Ye,ve),ze.sort(Le)},Qe._addAlgorithm(function(Xe,ct,ht){for(var It,jt=Xe.key;Ge(jt);)if(++je===ze.length)return ct(ht),!1;return!He(It=jt)&&!Ye(It)||(J._cmp(jt,ze[je][1])===0||J._cmp(jt,ze[je][0])===0||ct(function(){Oe===le?Xe.continue(ze[je][0]):Xe.continue(ze[je][1])}),!1)}),Qe},Ta.prototype.startsWithAnyOf=function(){var V=F.apply(B,arguments);return V.every(function(W){return typeof W=="string"})?V.length===0?Bs(this):this.inAnyRange(V.map(function(W){return[W,W+za]})):Aa(this,"startsWithAnyOf() only works with strings")},Ta);function Ta(){}function fl(V){return gn(function(W){return Li(W),V(W.target.error),!1})}function Li(V){V.stopPropagation&&V.stopPropagation(),V.preventDefault&&V.preventDefault()}var Oo="storagemutated",lr="x-storagemutated-1",fc=Na(null,Oo),Hh=(us.prototype._lock=function(){return I(!xe.global),++this._reculock,this._reculock!==1||xe.global||(xe.lockOwnerFor=this),this},us.prototype._unlock=function(){if(I(!xe.global),--this._reculock==0)for(xe.global||(xe.lockOwnerFor=null);0<this._blockedFuncs.length&&!this._locked();){var V=this._blockedFuncs.shift();try{Zo(V[1],V[0])}catch{}}return this},us.prototype._locked=function(){return this._reculock&&xe.lockOwnerFor!==this},us.prototype.create=function(V){var W=this;if(!this.mode)return this;var J=this.db.idbdb,ne=this.db._state.dbOpenError;if(I(!this.idbtrans),!V&&!J)switch(ne&&ne.name){case"DatabaseClosedError":throw new X.DatabaseClosed(ne);case"MissingAPIError":throw new X.MissingAPI(ne.message,ne);default:throw new X.OpenFailed(ne)}if(!this.active)throw new X.TransactionInactive;return I(this._completion._state===null),(V=this.idbtrans=V||(this.db.core||J).transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability})).onerror=gn(function(le){Li(le),W._reject(V.error)}),V.onabort=gn(function(le){Li(le),W.active&&W._reject(new X.Abort(V.error)),W.active=!1,W.on("abort").fire(le)}),V.oncomplete=gn(function(){W.active=!1,W._resolve(),"mutatedParts"in V&&fc.storagemutated.fire(V.mutatedParts)}),this},us.prototype._promise=function(V,W,J){var ne=this;if(V==="readwrite"&&this.mode!=="readwrite")return Qi(new X.ReadOnly("Transaction is readonly"));if(!this.active)return Qi(new X.TransactionInactive);if(this._locked())return new ge(function(ve,we){ne._blockedFuncs.push([function(){ne._promise(V,W,J).then(ve,we)},xe])});if(J)return na(function(){var ve=new ge(function(we,Ce){ne._lock();var Be=W(we,Ce,ne);Be&&Be.then&&Be.then(we,Ce)});return ve.finally(function(){return ne._unlock()}),ve._lib=!0,ve});var le=new ge(function(ve,we){var Ce=W(ve,we,ne);Ce&&Ce.then&&Ce.then(ve,we)});return le._lib=!0,le},us.prototype._root=function(){return this.parent?this.parent._root():this},us.prototype.waitFor=function(V){var W,J=this._root(),ne=ge.resolve(V);J._waitingFor?J._waitingFor=J._waitingFor.then(function(){return ne}):(J._waitingFor=ne,J._waitingQueue=[],W=J.idbtrans.objectStore(J.storeNames[0]),function ve(){for(++J._spinCount;J._waitingQueue.length;)J._waitingQueue.shift()();J._waitingFor&&(W.get(-1/0).onsuccess=ve)}());var le=J._waitingFor;return new ge(function(ve,we){ne.then(function(Ce){return J._waitingQueue.push(gn(ve.bind(null,Ce)))},function(Ce){return J._waitingQueue.push(gn(we.bind(null,Ce)))}).finally(function(){J._waitingFor===le&&(J._waitingFor=null)})})},us.prototype.abort=function(){this.active&&(this.active=!1,this.idbtrans&&this.idbtrans.abort(),this._reject(new X.Abort))},us.prototype.table=function(V){var W=this._memoizedTables||(this._memoizedTables={});if(d(W,V))return W[V];var J=this.schema[V];if(!J)throw new X.NotFound("Table "+V+" not part of transaction");return J=new this.db.Table(V,J,this),J.core=this.db.core.table(V),W[V]=J},us);function us(){}function kd(V,W,J,ne,le,ve,we){return{name:V,keyPath:W,unique:J,multi:ne,auto:le,compound:ve,src:(J&&!we?"&":"")+(ne?"*":"")+(le?"++":"")+Qo(W)}}function Qo(V){return typeof V=="string"?V:V?"["+[].join.call(V,"+")+"]":""}function xd(V,W,J){return{name:V,primKey:W,indexes:J,mappedClass:null,idxByName:(ne=function(le){return[le.name,le]},J.reduce(function(le,ve,we){return we=ne(ve,we),we&&(le[we[0]]=we[1]),le},{}))};var ne}var ml=function(V){try{return V.only([[]]),ml=function(){return[[]]},[[]]}catch{return ml=function(){return za},za}};function qa(V){return V==null?function(){}:typeof V=="string"?(W=V).split(".").length===1?function(J){return J[W]}:function(J){return w(J,W)}:function(J){return w(J,V)};var W}function iu(V){return[].slice.call(V)}var ee=0;function be(V){return V==null?":id":typeof V=="string"?V:"[".concat(V.join("+"),"]")}function Ae(V,W,Be){function ne(Ge){if(Ge.type===3)return null;if(Ge.type===4)throw new Error("Cannot convert never type to IDBKeyRange");var je=Ge.lower,He=Ge.upper,Ye=Ge.lowerOpen,Ge=Ge.upperOpen;return je===void 0?He===void 0?null:W.upperBound(He,!!Ge):He===void 0?W.lowerBound(je,!!Ye):W.bound(je,He,!!Ye,!!Ge)}function le(Le){var je,He=Le.name;return{name:He,schema:Le,mutate:function(Ye){var Ge=Ye.trans,Qe=Ye.type,Xe=Ye.keys,ct=Ye.values,ht=Ye.range;return new Promise(function(It,jt){It=gn(It);var Pt=Ge.objectStore(He),Kt=Pt.keyPath==null,Rt=Qe==="put"||Qe==="add";if(!Rt&&Qe!=="delete"&&Qe!=="deleteRange")throw new Error("Invalid operation type: "+Qe);var Ni,Ai=(Xe||ct||{length:1}).length;if(Xe&&ct&&Xe.length!==ct.length)throw new Error("Given keys array must have same length as given values array.");if(Ai===0)return It({numFailures:0,failures:{},results:[],lastResult:void 0});function Or(ds){++yo,Li(ds)}var Cn=[],oa=[],yo=0;if(Qe==="deleteRange"){if(ht.type===4)return It({numFailures:yo,failures:oa,results:[],lastResult:void 0});ht.type===3?Cn.push(Ni=Pt.clear()):Cn.push(Ni=Pt.delete(ne(ht)))}else{var Kt=Rt?Kt?[ct,Xe]:[ct,null]:[Xe,null],bn=Kt[0],Fd=Kt[1];if(Rt)for(var Lo=0;Lo<Ai;++Lo)Cn.push(Ni=Fd&&Fd[Lo]!==void 0?Pt[Qe](bn[Lo],Fd[Lo]):Pt[Qe](bn[Lo])),Ni.onerror=Or;else for(Lo=0;Lo<Ai;++Lo)Cn.push(Ni=Pt[Qe](bn[Lo])),Ni.onerror=Or}function qw(ds){ds=ds.target.result,Cn.forEach(function(Xu,Ww){return Xu.error!=null&&(oa[Ww]=Xu.error)}),It({numFailures:yo,failures:oa,results:Qe==="delete"?Xe:Cn.map(function(Xu){return Xu.result}),lastResult:ds})}Ni.onerror=function(ds){Or(ds),qw(ds)},Ni.onsuccess=qw})},getMany:function(Ye){var Ge=Ye.trans,Qe=Ye.keys;return new Promise(function(Xe,ct){Xe=gn(Xe);for(var ht,It=Ge.objectStore(He),jt=Qe.length,Pt=new Array(jt),Kt=0,Rt=0,Ni=function(Cn){Cn=Cn.target,Pt[Cn._pos]=Cn.result,++Rt===Kt&&Xe(Pt)},Ai=fl(ct),Or=0;Or<jt;++Or)Qe[Or]!=null&&((ht=It.get(Qe[Or]))._pos=Or,ht.onsuccess=Ni,ht.onerror=Ai,++Kt);Kt===0&&Xe(Pt)})},get:function(Ye){var Ge=Ye.trans,Qe=Ye.key;return new Promise(function(Xe,ct){Xe=gn(Xe);var ht=Ge.objectStore(He).get(Qe);ht.onsuccess=function(It){return Xe(It.target.result)},ht.onerror=fl(ct)})},query:(je=Fe,function(Ye){return new Promise(function(Ge,Qe){Ge=gn(Ge);var Xe,ct,ht,Kt=Ye.trans,It=Ye.values,jt=Ye.limit,Ni=Ye.query,Pt=jt===1/0?void 0:jt,Rt=Ni.index,Ni=Ni.range,Kt=Kt.objectStore(He),Rt=Rt.isPrimaryKey?Kt:Kt.index(Rt.name),Ni=ne(Ni);if(jt===0)return Ge({result:[]});je?((Pt=It?Rt.getAll(Ni,Pt):Rt.getAllKeys(Ni,Pt)).onsuccess=function(Ai){return Ge({result:Ai.target.result})},Pt.onerror=fl(Qe)):(Xe=0,ct=!It&&"openKeyCursor"in Rt?Rt.openKeyCursor(Ni):Rt.openCursor(Ni),ht=[],ct.onsuccess=function(Ai){var Or=ct.result;return Or?(ht.push(It?Or.value:Or.primaryKey),++Xe===jt?Ge({result:ht}):void Or.continue()):Ge({result:ht})},ct.onerror=fl(Qe))})}),openCursor:function(Ye){var Ge=Ye.trans,Qe=Ye.values,Xe=Ye.query,ct=Ye.reverse,ht=Ye.unique;return new Promise(function(It,jt){It=gn(It);var Rt=Xe.index,Pt=Xe.range,Kt=Ge.objectStore(He),Kt=Rt.isPrimaryKey?Kt:Kt.index(Rt.name),Rt=ct?ht?"prevunique":"prev":ht?"nextunique":"next",Ni=!Qe&&"openKeyCursor"in Kt?Kt.openKeyCursor(ne(Pt),Rt):Kt.openCursor(ne(Pt),Rt);Ni.onerror=fl(jt),Ni.onsuccess=gn(function(Ai){var Or,Cn,oa,yo,bn=Ni.result;bn?(bn.___id=++ee,bn.done=!1,Or=bn.continue.bind(bn),Cn=(Cn=bn.continuePrimaryKey)&&Cn.bind(bn),oa=bn.advance.bind(bn),yo=function(){throw new Error("Cursor not stopped")},bn.trans=Ge,bn.stop=bn.continue=bn.continuePrimaryKey=bn.advance=function(){throw new Error("Cursor not started")},bn.fail=gn(jt),bn.next=function(){var Fd=this,Lo=1;return this.start(function(){return Lo--?Fd.continue():Fd.stop()}).then(function(){return Fd})},bn.start=function(Fd){function Lo(){if(Ni.result)try{Fd()}catch(ds){bn.fail(ds)}else bn.done=!0,bn.start=function(){throw new Error("Cursor behind last entry")},bn.stop()}var qw=new Promise(function(ds,Xu){ds=gn(ds),Ni.onerror=fl(Xu),bn.fail=Xu,bn.stop=function(Ww){bn.stop=bn.continue=bn.continuePrimaryKey=bn.advance=yo,ds(Ww)}});return Ni.onsuccess=gn(function(ds){Ni.onsuccess=Lo,Lo()}),bn.continue=Or,bn.continuePrimaryKey=Cn,bn.advance=oa,Lo(),qw},It(bn)):It(null)},jt)})},count:function(Ye){var Ge=Ye.query,Qe=Ye.trans,Xe=Ge.index,ct=Ge.range;return new Promise(function(ht,It){var jt=Qe.objectStore(He),Pt=Xe.isPrimaryKey?jt:jt.index(Xe.name),jt=ne(ct),Pt=jt?Pt.count(jt):Pt.count();Pt.onsuccess=gn(function(Kt){return ht(Kt.target.result)}),Pt.onerror=fl(It)})}}}var ve,we,Ce,ze=(we=Be,Ce=iu((ve=V).objectStoreNames),{schema:{name:ve.name,tables:Ce.map(function(Le){return we.objectStore(Le)}).map(function(Le){var je=Le.keyPath,Ge=Le.autoIncrement,He=s(je),Ye={},Ge={name:Le.name,primaryKey:{name:null,isPrimaryKey:!0,outbound:je==null,compound:He,keyPath:je,autoIncrement:Ge,unique:!0,extractKey:qa(je)},indexes:iu(Le.indexNames).map(function(Qe){return Le.index(Qe)}).map(function(ht){var Xe=ht.name,ct=ht.unique,It=ht.multiEntry,ht=ht.keyPath,It={name:Xe,compound:s(ht),keyPath:ht,unique:ct,multiEntry:It,extractKey:qa(ht)};return Ye[be(ht)]=It}),getIndexByKeyPath:function(Qe){return Ye[be(Qe)]}};return Ye[":id"]=Ge.primaryKey,je!=null&&(Ye[be(je)]=Ge.primaryKey),Ge})},hasGetAll:0<Ce.length&&"getAll"in we.objectStore(Ce[0])&&!(typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604)}),Be=ze.schema,Fe=ze.hasGetAll,ze=Be.tables.map(le),Oe={};return ze.forEach(function(Le){return Oe[Le.name]=Le}),{stack:"dbcore",transaction:V.transaction.bind(V),table:function(Le){if(!Oe[Le])throw new Error("Table '".concat(Le,"' not found"));return Oe[Le]},MIN_KEY:-1/0,MAX_KEY:ml(W),schema:Be}}function dt(V,W,J,ne){var le=J.IDBKeyRange;return J.indexedDB,{dbcore:(ne=Ae(W,le,ne),V.dbcore.reduce(function(ve,we){return we=we.create,n(n({},ve),we(ve))},ne))}}function qi(V,ne){var J=ne.db,ne=dt(V._middlewares,J,V._deps,ne);V.core=ne.dbcore,V.tables.forEach(function(le){var ve=le.name;V.core.schema.tables.some(function(we){return we.name===ve})&&(le.core=V.core.table(ve),V[ve]instanceof V.Table&&(V[ve].core=le.core))})}function gi(V,W,J,ne){J.forEach(function(le){var ve=ne[le];W.forEach(function(we){var Ce=function Be(Fe,ze){return g(Fe,ze)||(Fe=c(Fe))&&Be(Fe,ze)}(we,le);(!Ce||"value"in Ce&&Ce.value===void 0)&&(we===V.Transaction.prototype||we instanceof V.Transaction?f(we,le,{get:function(){return this.table(le)},set:function(Be){h(this,le,{value:Be,writable:!0,configurable:!0,enumerable:!0})}}):we[le]=new V.Table(le,ve))})})}function kn(V,W){W.forEach(function(J){for(var ne in J)J[ne]instanceof V.Table&&delete J[ne]})}function ii(V,W){return V._cfg.version-W._cfg.version}function po(V,W,J,ne){var le=V._dbSchema;J.objectStoreNames.contains("$meta")&&!le.$meta&&(le.$meta=xd("$meta",nu("")[0],[]),V._storeNames.push("$meta"));var ve=V._createTransaction("readwrite",V._storeNames,le);ve.create(J),ve._completion.catch(ne);var we=ve._reject.bind(ve),Ce=xe.transless||xe;na(function(){return xe.trans=ve,xe.transless=Ce,W!==0?(qi(V,J),Fe=W,((Be=ve).storeNames.includes("$meta")?Be.table("$meta").get("version").then(function(ze){return ze??Fe}):ge.resolve(Fe)).then(function(ze){return Le=ze,je=ve,He=J,Ye=[],ze=(Oe=V)._versions,Ge=Oe._dbSchema=fo(0,Oe.idbdb,He),(ze=ze.filter(function(Qe){return Qe._cfg.version>=Le})).length!==0?(ze.forEach(function(Qe){Ye.push(function(){var Xe=Ge,ct=Qe._cfg.dbschema;Hl(Oe,Xe,He),Hl(Oe,ct,He),Ge=Oe._dbSchema=ct;var ht=_a(Xe,ct);ht.add.forEach(function(Rt){es(He,Rt[0],Rt[1].primKey,Rt[1].indexes)}),ht.change.forEach(function(Rt){if(Rt.recreate)throw new X.Upgrade("Not yet support for changing primary key");var Ni=He.objectStore(Rt.name);Rt.add.forEach(function(Ai){return Wa(Ni,Ai)}),Rt.change.forEach(function(Ai){Ni.deleteIndex(Ai.name),Wa(Ni,Ai)}),Rt.del.forEach(function(Ai){return Ni.deleteIndex(Ai)})});var It=Qe._cfg.contentUpgrade;if(It&&Qe._cfg.version>Le){qi(Oe,He),je._memoizedTables={};var jt=D(ct);ht.del.forEach(function(Rt){jt[Rt]=Xe[Rt]}),kn(Oe,[Oe.Transaction.prototype]),gi(Oe,[Oe.Transaction.prototype],o(jt),jt),je.schema=jt;var Pt,Kt=G(It);return Kt&&ra(),ht=ge.follow(function(){var Rt;(Pt=It(je))&&Kt&&(Rt=vo.bind(null,null),Pt.then(Rt,Rt))}),Pt&&typeof Pt.then=="function"?ge.resolve(Pt):ht.then(function(){return Pt})}}),Ye.push(function(Xe){var ct,ht,It=Qe._cfg.dbschema;ct=It,ht=Xe,[].slice.call(ht.db.objectStoreNames).forEach(function(jt){return ct[jt]==null&&ht.db.deleteObjectStore(jt)}),kn(Oe,[Oe.Transaction.prototype]),gi(Oe,[Oe.Transaction.prototype],Oe._storeNames,Oe._dbSchema),je.schema=Oe._dbSchema}),Ye.push(function(Xe){Oe.idbdb.objectStoreNames.contains("$meta")&&(Math.ceil(Oe.idbdb.version/10)===Qe._cfg.version?(Oe.idbdb.deleteObjectStore("$meta"),delete Oe._dbSchema.$meta,Oe._storeNames=Oe._storeNames.filter(function(ct){return ct!=="$meta"})):Xe.objectStore("$meta").put(Qe._cfg.version,"version"))})}),function Qe(){return Ye.length?ge.resolve(Ye.shift()(je.idbtrans)).then(Qe):ge.resolve()}().then(function(){ho(Ge,He)})):ge.resolve();var Oe,Le,je,He,Ye,Ge}).catch(we)):(o(le).forEach(function(ze){es(J,ze,le[ze].primKey,le[ze].indexes)}),qi(V,J),void ge.follow(function(){return V.on.populate.fire(ve)}).catch(we));var Be,Fe})}function En(V,W){ho(V._dbSchema,W),W.db.version%10!=0||W.objectStoreNames.contains("$meta")||W.db.createObjectStore("$meta").add(Math.ceil(W.db.version/10-1),"version");var J=fo(0,V.idbdb,W);Hl(V,V._dbSchema,W);for(var ne=0,le=_a(J,V._dbSchema).change;ne<le.length;ne++){var ve=function(we){if(we.change.length||we.recreate)return console.warn("Unable to patch indexes of table ".concat(we.name," because it has changes on the type of index or primary key.")),{value:void 0};var Ce=W.objectStore(we.name);we.add.forEach(function(Be){_e&&console.debug("Dexie upgrade patch: Creating missing index ".concat(we.name,".").concat(Be.src)),Wa(Ce,Be)})}(le[ne]);if(typeof ve=="object")return ve.value}}function _a(V,W){var J,ne={del:[],add:[],change:[]};for(J in V)W[J]||ne.del.push(J);for(J in W){var le=V[J],ve=W[J];if(le){var we={name:J,def:ve,recreate:!1,del:[],add:[],change:[]};if(""+(le.primKey.keyPath||"")!=""+(ve.primKey.keyPath||"")||le.primKey.auto!==ve.primKey.auto)we.recreate=!0,ne.change.push(we);else{var Ce=le.idxByName,Be=ve.idxByName,Fe=void 0;for(Fe in Ce)Be[Fe]||we.del.push(Fe);for(Fe in Be){var ze=Ce[Fe],Oe=Be[Fe];ze?ze.src!==Oe.src&&we.change.push(Oe):we.add.push(Oe)}(0<we.del.length||0<we.add.length||0<we.change.length)&&ne.change.push(we)}}else ne.add.push([J,ve])}return ne}function es(V,W,J,ne){var le=V.db.createObjectStore(W,J.keyPath?{keyPath:J.keyPath,autoIncrement:J.auto}:{autoIncrement:J.auto});return ne.forEach(function(ve){return Wa(le,ve)}),le}function ho(V,W){o(V).forEach(function(J){W.db.objectStoreNames.contains(J)||(_e&&console.debug("Dexie: Creating missing table",J),es(W,J,V[J].primKey,V[J].indexes))})}function Wa(V,W){V.createIndex(W.name,W.keyPath,{unique:W.unique,multiEntry:W.multi})}function fo(V,W,J){var ne={};return y(W.objectStoreNames,0).forEach(function(le){for(var ve=J.objectStore(le),we=kd(Qo(Fe=ve.keyPath),Fe||"",!0,!1,!!ve.autoIncrement,Fe&&typeof Fe!="string",!0),Ce=[],Be=0;Be<ve.indexNames.length;++Be){var ze=ve.index(ve.indexNames[Be]),Fe=ze.keyPath,ze=kd(ze.name,Fe,!!ze.unique,!!ze.multiEntry,!1,Fe&&typeof Fe!="string",!1);Ce.push(ze)}ne[le]=xd(le,we,Ce)}),ne}function Hl(V,W,J){for(var ne=J.db.objectStoreNames,le=0;le<ne.length;++le){var ve=ne[le],we=J.objectStore(ve);V._hasGetAll="getAll"in we;for(var Ce=0;Ce<we.indexNames.length;++Ce){var Be=we.indexNames[Ce],Fe=we.index(Be).keyPath,ze=typeof Fe=="string"?Fe:"["+y(Fe).join("+")+"]";!W[ve]||(Fe=W[ve].idxByName[ze])&&(Fe.name=Be,delete W[ve].idxByName[ze],W[ve].idxByName[Be]=Fe)}}typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&a.WorkerGlobalScope&&a instanceof a.WorkerGlobalScope&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604&&(V._hasGetAll=!1)}function nu(V){return V.split(",").map(function(W,J){var ne=(W=W.trim()).replace(/([&*]|\+\+)/g,""),le=/^\[/.test(ne)?ne.match(/^\[(.*)\]$/)[1].split("+"):ne;return kd(ne,le||null,/\&/.test(W),/\*/.test(W),/\+\+/.test(W),s(le),J===0)})}var xp=(Op.prototype._parseStoresSpec=function(V,W){o(V).forEach(function(J){if(V[J]!==null){var ne=nu(V[J]),le=ne.shift();if(le.unique=!0,le.multi)throw new X.Schema("Primary key cannot be multi-valued");ne.forEach(function(ve){if(ve.auto)throw new X.Schema("Only primary key can be marked as autoIncrement (++)");if(!ve.keyPath)throw new X.Schema("Index must have a name and cannot be an empty string")}),W[J]=xd(J,le,ne)}})},Op.prototype.stores=function(J){var W=this.db;this._cfg.storesSource=this._cfg.storesSource?l(this._cfg.storesSource,J):J;var J=W._versions,ne={},le={};return J.forEach(function(ve){l(ne,ve._cfg.storesSource),le=ve._cfg.dbschema={},ve._parseStoresSpec(ne,le)}),W._dbSchema=le,kn(W,[W._allTables,W,W.Transaction.prototype]),gi(W,[W._allTables,W,W.Transaction.prototype,this._cfg.tables],o(le),le),W._storeNames=o(le),this},Op.prototype.upgrade=function(V){return this._cfg.contentUpgrade=Te(this._cfg.contentUpgrade||me,V),this},Op);function Op(){}function zh(V,W){var J=V._dbNamesDB;return J||(J=V._dbNamesDB=new Ld(hl,{addons:[],indexedDB:V,IDBKeyRange:W})).version(1).stores({dbnames:"name"}),J.table("dbnames")}function $s(V){return V&&typeof V.databases=="function"}function VU(V){return na(function(){return xe.letThrough=!0,V()})}function Fw(V){return!("from"in V)}var Ka=function(V,W){if(!this){var J=new Ka;return V&&"d"in V&&l(J,V),J}l(this,arguments.length?{d:1,from:V,to:1<arguments.length?W:V}:{d:0})};function Kg(V,W,J){var ne=pn(W,J);if(!isNaN(ne)){if(0<ne)throw RangeError();if(Fw(V))return l(V,{from:W,to:J,d:1});var le=V.l,ne=V.r;if(pn(J,V.from)<0)return le?Kg(le,W,J):V.l={from:W,to:J,d:1,l:null,r:null},GU(V);if(0<pn(W,V.to))return ne?Kg(ne,W,J):V.r={from:W,to:J,d:1,l:null,r:null},GU(V);pn(W,V.from)<0&&(V.from=W,V.l=null,V.d=ne?ne.d+1:1),0<pn(J,V.to)&&(V.to=J,V.r=null,V.d=V.l?V.l.d+1:1),J=!V.r,le&&!V.l&&Yg(V,le),ne&&J&&Yg(V,ne)}}function Yg(V,W){Fw(W)||function J(ne,Be){var ve=Be.from,we=Be.to,Ce=Be.l,Be=Be.r;Kg(ne,ve,we),Ce&&J(ne,Ce),Be&&J(ne,Be)}(V,W)}function Zg(V,W){var J=jU(W),ne=J.next();if(ne.done)return!1;for(var le=ne.value,ve=jU(V),we=ve.next(le.from),Ce=we.value;!ne.done&&!we.done;){if(pn(Ce.from,le.to)<=0&&0<=pn(Ce.to,le.from))return!0;pn(le.from,Ce.from)<0?le=(ne=J.next(Ce.from)).value:Ce=(we=ve.next(le.from)).value}return!1}function jU(V){var W=Fw(V)?null:{s:0,n:V};return{next:function(J){for(var ne=0<arguments.length;W;)switch(W.s){case 0:if(W.s=1,ne)for(;W.n.l&&pn(J,W.n.from)<0;)W={up:W,n:W.n.l,s:1};else for(;W.n.l;)W={up:W,n:W.n.l,s:1};case 1:if(W.s=2,!ne||pn(J,W.n.to)<=0)return{value:W.n,done:!1};case 2:if(W.n.r){W.s=3,W={up:W,n:W.n.r,s:0};continue}case 3:W=W.up}return{done:!0}}}}function GU(V){var W,J,ne=(((W=V.r)===null||W===void 0?void 0:W.d)||0)-(((J=V.l)===null||J===void 0?void 0:J.d)||0),le=1<ne?"r":ne<-1?"l":"";le&&(W=le=="r"?"l":"r",J=n({},V),ne=V[le],V.from=ne.from,V.to=ne.to,V[le]=ne[le],J[le]=ne[W],(V[W]=J).d=HU(J)),V.d=HU(V)}function HU(J){var W=J.r,J=J.l;return(W?J?Math.max(W.d,J.d):W.d:J?J.d:0)+1}function Bw(V,W){return o(W).forEach(function(J){V[J]?Yg(V[J],W[J]):V[J]=function ne(le){var ve,we,Ce={};for(ve in le)d(le,ve)&&(we=le[ve],Ce[ve]=!we||typeof we!="object"||P.has(we.constructor)?we:ne(we));return Ce}(W[J])}),V}function zU(V,W){return V.all||W.all||Object.keys(V).some(function(J){return W[J]&&Zg(W[J],V[J])})}p(Ka.prototype,((ts={add:function(V){return Yg(this,V),this},addKey:function(V){return Kg(this,V,V),this},addKeys:function(V){var W=this;return V.forEach(function(J){return Kg(W,J,J)}),this}})[_]=function(){return jU(this)},ts));var Lp={},qU={},$w=!1;function Zy(V){Bw(qU,V),$w||($w=!0,setTimeout(function(){$w=!1,Xg(qU,!(qU={}))},0))}function Xg(V,W){W===void 0&&(W=!1);var J=new Set;if(V.all)for(var ne=0,le=Object.values(Lp);ne<le.length;ne++)qh(we=le[ne],V,J,W);else for(var ve in V){var we,Ce=/^idb\:\/\/(.*)\/(.*)\//.exec(ve);Ce&&(ve=Ce[1],Ce=Ce[2],(we=Lp["idb://".concat(ve,"/").concat(Ce)])&&qh(we,V,J,W))}J.forEach(function(Be){return Be()})}function qh(V,W,J,ne){for(var le=[],ve=0,we=Object.entries(V.queries.query);ve<we.length;ve++){for(var Ce=we[ve],Be=Ce[0],Fe=[],ze=0,Oe=Ce[1];ze<Oe.length;ze++){var Le=Oe[ze];zU(W,Le.obsSet)?Le.subscribers.forEach(function(Ge){return J.add(Ge)}):ne&&Fe.push(Le)}ne&&le.push([Be,Fe])}if(ne)for(var je=0,He=le;je<He.length;je++){var Ye=He[je],Be=Ye[0],Fe=Ye[1];V.queries.query[Be]=Fe}}function UB(V){var W=V._state,J=V._deps.indexedDB;if(W.isBeingOpened||V.idbdb)return W.dbReadyPromise.then(function(){return W.dbOpenError?Qi(W.dbOpenError):V});W.isBeingOpened=!0,W.dbOpenError=null,W.openComplete=!1;var ne=W.openCanceller,le=Math.round(10*V.verno),ve=!1;function we(){if(W.openCanceller!==ne)throw new X.DatabaseClosed("db.open() was cancelled")}function Ce(){return new ge(function(Le,je){if(we(),!J)throw new X.MissingAPI;var He=V.name,Ye=W.autoSchema||!le?J.open(He):J.open(He,le);if(!Ye)throw new X.MissingAPI;Ye.onerror=fl(je),Ye.onblocked=gn(V._fireOnBlocked),Ye.onupgradeneeded=gn(function(Ge){var Qe;ze=Ye.transaction,W.autoSchema&&!V._options.allowEmptyDB?(Ye.onerror=Li,ze.abort(),Ye.result.close(),(Qe=J.deleteDatabase(He)).onsuccess=Qe.onerror=gn(function(){je(new X.NoSuchDatabase("Database ".concat(He," doesnt exist")))})):(ze.onerror=fl(je),Ge=Ge.oldVersion>Math.pow(2,62)?0:Ge.oldVersion,Oe=Ge<1,V.idbdb=Ye.result,ve&&En(V,ze),po(V,Ge/10,ze,je))},je),Ye.onsuccess=gn(function(){ze=null;var Ge,Qe,Xe,ct,ht,It=V.idbdb=Ye.result,jt=y(It.objectStoreNames);if(0<jt.length)try{var Pt=It.transaction((ct=jt).length===1?ct[0]:ct,"readonly");if(W.autoSchema)Qe=It,Xe=Pt,(Ge=V).verno=Qe.version/10,Xe=Ge._dbSchema=fo(0,Qe,Xe),Ge._storeNames=y(Qe.objectStoreNames,0),gi(Ge,[Ge._allTables],o(Xe),Xe);else if(Hl(V,V._dbSchema,Pt),((ht=_a(fo(0,(ht=V).idbdb,Pt),ht._dbSchema)).add.length||ht.change.some(function(Kt){return Kt.add.length||Kt.change.length}))&&!ve)return console.warn("Dexie SchemaDiff: Schema was extended without increasing the number passed to db.version(). Dexie will add missing parts and increment native version number to workaround this."),It.close(),le=It.version+1,ve=!0,Le(Ce());qi(V,Pt)}catch{}Ls.push(V),It.onversionchange=gn(function(Kt){W.vcFired=!0,V.on("versionchange").fire(Kt)}),It.onclose=gn(function(Kt){V.on("close").fire(Kt)}),Oe&&(ht=V._deps,Pt=He,It=ht.indexedDB,ht=ht.IDBKeyRange,$s(It)||Pt===hl||zh(It,ht).put({name:Pt}).catch(me)),Le()},je)}).catch(function(Le){switch(Le==null?void 0:Le.name){case"UnknownError":if(0<W.PR1398_maxLoop)return W.PR1398_maxLoop--,console.warn("Dexie: Workaround for Chrome UnknownError on open()"),Ce();break;case"VersionError":if(0<le)return le=0,Ce()}return ge.reject(Le)})}var Be,Fe=W.dbReadyResolve,ze=null,Oe=!1;return ge.race([ne,(typeof navigator>"u"?ge.resolve():!navigator.userAgentData&&/Safari\//.test(navigator.userAgent)&&!/Chrom(e|ium)\//.test(navigator.userAgent)&&indexedDB.databases?new Promise(function(Le){function je(){return indexedDB.databases().finally(Le)}Be=setInterval(je,100),je()}).finally(function(){return clearInterval(Be)}):Promise.resolve()).then(Ce)]).then(function(){return we(),W.onReadyBeingFired=[],ge.resolve(VU(function(){return V.on.ready.fire(V.vip)})).then(function Le(){if(0<W.onReadyBeingFired.length){var je=W.onReadyBeingFired.reduce(Te,me);return W.onReadyBeingFired=[],ge.resolve(VU(function(){return je(V.vip)})).then(Le)}})}).finally(function(){W.openCanceller===ne&&(W.onReadyBeingFired=null,W.isBeingOpened=!1)}).catch(function(Le){W.dbOpenError=Le;try{ze&&ze.abort()}catch{}return ne===W.openCanceller&&V._close(),Qi(Le)}).finally(function(){W.openComplete=!0,Fe()}).then(function(){var Le;return Oe&&(Le={},V.tables.forEach(function(je){je.schema.indexes.forEach(function(He){He.name&&(Le["idb://".concat(V.name,"/").concat(je.name,"/").concat(He.name)]=new Ka(-1/0,[[[]]]))}),Le["idb://".concat(V.name,"/").concat(je.name,"/")]=Le["idb://".concat(V.name,"/").concat(je.name,"/:dels")]=new Ka(-1/0,[[[]]])}),fc(Oo).fire(Le),Xg(Le,!0)),V})}function Im(V){function W(ve){return V.next(ve)}var J=le(W),ne=le(function(ve){return V.throw(ve)});function le(ve){return function(Be){var Ce=ve(Be),Be=Ce.value;return Ce.done?Be:Be&&typeof Be.then=="function"?Be.then(J,ne):s(Be)?Promise.all(Be).then(J,ne):J(Be)}}return le(W)()}function gl(V,W,J){for(var ne=s(V)?V.slice():[V],le=0;le<J;++le)ne.push(W);return ne}var dM={stack:"dbcore",name:"VirtualIndexMiddleware",level:1,create:function(V){return n(n({},V),{table:function(W){var J=V.table(W),ne=J.schema,le={},ve=[];function we(Oe,Le,je){var He=be(Oe),Ye=le[He]=le[He]||[],Ge=Oe==null?0:typeof Oe=="string"?1:Oe.length,Qe=0<Le,Qe=n(n({},je),{name:Qe?"".concat(He,"(virtual-from:").concat(je.name,")"):je.name,lowLevelIndex:je,isVirtual:Qe,keyTail:Le,keyLength:Ge,extractKey:qa(Oe),unique:!Qe&&je.unique});return Ye.push(Qe),Qe.isPrimaryKey||ve.push(Qe),1<Ge&&we(Ge===2?Oe[0]:Oe.slice(0,Ge-1),Le+1,je),Ye.sort(function(Xe,ct){return Xe.keyTail-ct.keyTail}),Qe}W=we(ne.primaryKey.keyPath,0,ne.primaryKey),le[":id"]=[W];for(var Ce=0,Be=ne.indexes;Ce<Be.length;Ce++){var Fe=Be[Ce];we(Fe.keyPath,0,Fe)}function ze(Oe){var Le,je=Oe.query.index;return je.isVirtual?n(n({},Oe),{query:{index:je.lowLevelIndex,range:(Le=Oe.query.range,je=je.keyTail,{type:Le.type===1?2:Le.type,lower:gl(Le.lower,Le.lowerOpen?V.MAX_KEY:V.MIN_KEY,je),lowerOpen:!0,upper:gl(Le.upper,Le.upperOpen?V.MIN_KEY:V.MAX_KEY,je),upperOpen:!0})}}):Oe}return n(n({},J),{schema:n(n({},ne),{primaryKey:W,indexes:ve,getIndexByKeyPath:function(Oe){return(Oe=le[be(Oe)])&&Oe[0]}}),count:function(Oe){return J.count(ze(Oe))},query:function(Oe){return J.query(ze(Oe))},openCursor:function(Oe){var Le=Oe.query.index,je=Le.keyTail,He=Le.isVirtual,Ye=Le.keyLength;return He?J.openCursor(ze(Oe)).then(function(Qe){return Qe&&Ge(Qe)}):J.openCursor(Oe);function Ge(Qe){return Object.create(Qe,{continue:{value:function(Xe){Xe!=null?Qe.continue(gl(Xe,Oe.reverse?V.MAX_KEY:V.MIN_KEY,je)):Oe.unique?Qe.continue(Qe.key.slice(0,Ye).concat(Oe.reverse?V.MIN_KEY:V.MAX_KEY,je)):Qe.continue()}},continuePrimaryKey:{value:function(Xe,ct){Qe.continuePrimaryKey(gl(Xe,V.MAX_KEY,je),ct)}},primaryKey:{get:function(){return Qe.primaryKey}},key:{get:function(){var Xe=Qe.key;return Ye===1?Xe[0]:Xe.slice(0,Ye)}},value:{get:function(){return Qe.value}}})}}})}})}};function Vw(V,W,J,ne){return J=J||{},ne=ne||"",o(V).forEach(function(le){var ve,we,Ce;d(W,le)?(ve=V[le],we=W[le],typeof ve=="object"&&typeof we=="object"&&ve&&we?(Ce=A(ve))!==A(we)?J[ne+le]=W[le]:Ce==="Object"?Vw(ve,we,J,ne+le+"."):ve!==we&&(J[ne+le]=W[le]):ve!==we&&(J[ne+le]=W[le])):J[ne+le]=void 0}),o(W).forEach(function(le){d(V,le)||(J[ne+le]=W[le])}),J}function WU(V,W){return W.type==="delete"?W.keys:W.keys||W.values.map(V.extractKey)}var KU={stack:"dbcore",name:"HooksMiddleware",level:2,create:function(V){return n(n({},V),{table:function(W){var J=V.table(W),ne=J.schema.primaryKey;return n(n({},J),{mutate:function(le){var ve=xe.trans,we=ve.table(W).hook,Ce=we.deleting,Be=we.creating,Fe=we.updating;switch(le.type){case"add":if(Be.fire===me)break;return ve._promise("readwrite",function(){return ze(le)},!0);case"put":if(Be.fire===me&&Fe.fire===me)break;return ve._promise("readwrite",function(){return ze(le)},!0);case"delete":if(Ce.fire===me)break;return ve._promise("readwrite",function(){return ze(le)},!0);case"deleteRange":if(Ce.fire===me)break;return ve._promise("readwrite",function(){return function Oe(Le,je,He){return J.query({trans:Le,values:!1,query:{index:ne,range:je},limit:He}).then(function(Ye){var Ge=Ye.result;return ze({type:"delete",keys:Ge,trans:Le}).then(function(Qe){return 0<Qe.numFailures?Promise.reject(Qe.failures[0]):Ge.length<He?{failures:[],numFailures:0,lastResult:void 0}:Oe(Le,n(n({},je),{lower:Ge[Ge.length-1],lowerOpen:!0}),He)})})}(le.trans,le.range,1e4)},!0)}return J.mutate(le);function ze(Oe){var Le,je,He,Ye=xe.trans,Ge=Oe.keys||WU(ne,Oe);if(!Ge)throw new Error("Keys missing");return(Oe=Oe.type==="add"||Oe.type==="put"?n(n({},Oe),{keys:Ge}):n({},Oe)).type!=="delete"&&(Oe.values=r([],Oe.values,!0)),Oe.keys&&(Oe.keys=r([],Oe.keys,!0)),Le=J,He=Ge,((je=Oe).type==="add"?Promise.resolve([]):Le.getMany({trans:je.trans,keys:He,cache:"immutable"})).then(function(Qe){var Xe=Ge.map(function(ct,ht){var It,jt,Pt,Kt=Qe[ht],Rt={onerror:null,onsuccess:null};return Oe.type==="delete"?Ce.fire.call(Rt,ct,Kt,Ye):Oe.type==="add"||Kt===void 0?(It=Be.fire.call(Rt,ct,Oe.values[ht],Ye),ct==null&&It!=null&&(Oe.keys[ht]=ct=It,ne.outbound||S(Oe.values[ht],ne.keyPath,ct))):(It=Vw(Kt,Oe.values[ht]),(jt=Fe.fire.call(Rt,It,ct,Kt,Ye))&&(Pt=Oe.values[ht],Object.keys(jt).forEach(function(Ni){d(Pt,Ni)?Pt[Ni]=jt[Ni]:S(Pt,Ni,jt[Ni])}))),Rt});return J.mutate(Oe).then(function(ct){for(var ht=ct.failures,It=ct.results,jt=ct.numFailures,ct=ct.lastResult,Pt=0;Pt<Ge.length;++Pt){var Kt=(It||Ge)[Pt],Rt=Xe[Pt];Kt==null?Rt.onerror&&Rt.onerror(ht[Pt]):Rt.onsuccess&&Rt.onsuccess(Oe.type==="put"&&Qe[Pt]?Oe.values[Pt]:Kt)}return{failures:ht,results:It,numFailures:jt,lastResult:ct}}).catch(function(ct){return Xe.forEach(function(ht){return ht.onerror&&ht.onerror(ct)}),Promise.reject(ct)})})}}})}})}};function jw(V,W,J){try{if(!W||W.keys.length<V.length)return null;for(var ne=[],le=0,ve=0;le<W.keys.length&&ve<V.length;++le)pn(W.keys[le],V[ve])===0&&(ne.push(J?N(W.values[le]):W.values[le]),++ve);return ne.length===V.length?ne:null}catch{return null}}var DB={stack:"dbcore",level:-1,create:function(V){return{table:function(W){var J=V.table(W);return n(n({},J),{getMany:function(ne){if(!ne.cache)return J.getMany(ne);var le=jw(ne.keys,ne.trans._cache,ne.cache==="clone");return le?ge.resolve(le):J.getMany(ne).then(function(ve){return ne.trans._cache={keys:ne.keys,values:ne.cache==="clone"?N(ve):ve},ve})},mutate:function(ne){return ne.type!=="add"&&(ne.trans._cache=null),J.mutate(ne)}})}}}};function pM(V,W){return V.trans.mode==="readonly"&&!!V.subscr&&!V.trans.explicit&&V.trans.db._options.cache!=="disabled"&&!W.schema.primaryKey.outbound}function YU(V,W){switch(V){case"query":return W.values&&!W.unique;case"get":case"getMany":case"count":case"openCursor":return!1}}var EB={stack:"dbcore",level:0,name:"Observability",create:function(V){var W=V.schema.name,J=new Ka(V.MIN_KEY,V.MAX_KEY);return n(n({},V),{transaction:function(ne,le,ve){if(xe.subscr&&le!=="readonly")throw new X.ReadOnly("Readwrite transaction in liveQuery context. Querier source: ".concat(xe.querier));return V.transaction(ne,le,ve)},table:function(ne){function le(je){var je=(He=je.query).index,He=He.range;return[je,new Ka((je=He.lower)!==null&&je!==void 0?je:V.MIN_KEY,(He=He.upper)!==null&&He!==void 0?He:V.MAX_KEY)]}var ve=V.table(ne),we=ve.schema,Ce=we.primaryKey,Be=Ce.extractKey,Fe=Ce.outbound,ze=n(n({},ve),{mutate:function(Le){function je(Rt){return Rt="idb://".concat(W,"/").concat(ne,"/").concat(Rt),Xe[Rt]||(Xe[Rt]=new Ka)}var He,Ye,Ge,Qe=Le.trans,Xe=Le.mutatedParts||(Le.mutatedParts={}),ct=je(""),ht=je(":dels"),It=Le.type,Kt=Le.type==="deleteRange"?[Le.range]:Le.type==="delete"?[Le.keys]:Le.values.length<50?[WU(Ce,Le).filter(function(Rt){return Rt}),Le.values]:[],jt=Kt[0],Pt=Kt[1],Kt=Le.trans._cache;return s(jt)?(ct.addKeys(jt),(Kt=It==="delete"||jt.length===Pt.length?jw(jt,Kt):null)||ht.addKeys(jt),(Kt||Pt)&&(He=je,Ye=Kt,Ge=Pt,we.indexes.forEach(function(Rt){var Ni=He(Rt.name||"");function Ai(Cn){return Cn!=null?Rt.extractKey(Cn):null}function Or(Cn){return Rt.multiEntry&&s(Cn)?Cn.forEach(function(oa){return Ni.addKey(oa)}):Ni.addKey(Cn)}(Ye||Ge).forEach(function(Cn,bn){var yo=Ye&&Ai(Ye[bn]),bn=Ge&&Ai(Ge[bn]);pn(yo,bn)!==0&&(yo!=null&&Or(yo),bn!=null&&Or(bn))})}))):jt?(Pt={from:jt.lower,to:jt.upper},ht.add(Pt),ct.add(Pt)):(ct.add(J),ht.add(J),we.indexes.forEach(function(Rt){return je(Rt.name).add(J)})),ve.mutate(Le).then(function(Rt){return!jt||Le.type!=="add"&&Le.type!=="put"||ct.addKeys(Rt.results),Qe.mutatedParts=Bw(Qe.mutatedParts||{},Xe),Rt})}}),Oe={get:function(Le){return[Ce,new Ka(Le.key)]},getMany:function(Le){return[Ce,new Ka().addKeys(Le.keys)]},count:le,query:le,openCursor:le};return o(Oe).forEach(function(Le){ze[Le]=function(je){var He=xe.subscr,Ye=!!He,Ge=pM(xe,ve)&&YU(Le,je)?je.obsSet={}:He;if(Ye){var Qe=function(Pt){return Pt="idb://".concat(W,"/").concat(ne,"/").concat(Pt),Ge[Pt]||(Ge[Pt]=new Ka)},Xe=Qe(""),ct=Qe(":dels"),He=Oe[Le](je),Ye=He[0],He=He[1];if((Le==="query"&&Ye.isPrimaryKey&&!je.values?ct:Qe(Ye.name||"")).add(He),!Ye.isPrimaryKey){if(Le!=="count"){var ht=Le==="query"&&Fe&&je.values&&ve.query(n(n({},je),{values:!1}));return ve[Le].apply(this,arguments).then(function(Pt){if(Le==="query"){if(Fe&&je.values)return ht.then(function(Ai){return Ai=Ai.result,Xe.addKeys(Ai),Pt});var Kt=je.values?Pt.result.map(Be):Pt.result;(je.values?Xe:ct).addKeys(Kt)}else if(Le==="openCursor"){var Rt=Pt,Ni=je.values;return Rt&&Object.create(Rt,{key:{get:function(){return ct.addKey(Rt.primaryKey),Rt.key}},primaryKey:{get:function(){var Ai=Rt.primaryKey;return ct.addKey(Ai),Ai}},value:{get:function(){return Ni&&Xe.addKey(Rt.primaryKey),Rt.value}}})}return Pt})}ct.add(J)}}return ve[Le].apply(this,arguments)}}),ze}})}};function ru(V,W,J){if(J.numFailures===0)return W;if(W.type==="deleteRange")return null;var ne=W.keys?W.keys.length:"values"in W&&W.values?W.values.length:1;return J.numFailures===ne?null:(W=n({},W),s(W.keys)&&(W.keys=W.keys.filter(function(le,ve){return!(ve in J.failures)})),"values"in W&&s(W.values)&&(W.values=W.values.filter(function(le,ve){return!(ve in J.failures)})),W)}function Wh(V,W){return J=V,((ne=W).lower===void 0||(ne.lowerOpen?0<pn(J,ne.lower):0<=pn(J,ne.lower)))&&(V=V,(W=W).upper===void 0||(W.upperOpen?pn(V,W.upper)<0:pn(V,W.upper)<=0));var J,ne}function hM(V,W,Le,ne,le,ve){if(!Le||Le.length===0)return V;var we=W.query.index,Ce=we.multiEntry,Be=W.query.range,Fe=ne.schema.primaryKey.extractKey,ze=we.extractKey,Oe=(we.lowLevelIndex||we).extractKey,Le=Le.reduce(function(je,He){var Ye=je,Ge=He.type==="add"||He.type==="put"?He.values.filter(function(ht){return ht=ze(ht),Ce&&s(ht)?ht.some(function(It){return Wh(It,Be)}):Wh(ht,Be)}).map(function(ht){return ht=N(ht),ve&&Object.freeze(ht),ht}):[];switch(He.type){case"add":Ye=je.concat(W.values?Ge:Ge.map(function(It){return Fe(It)}));break;case"put":var Qe=new Ka().addKeys(He.values.map(function(It){return Fe(It)})),Ye=je.filter(function(It){return It=W.values?Fe(It):It,!Zg(new Ka(It),Qe)}).concat(W.values?Ge:Ge.map(function(It){return Fe(It)}));break;case"delete":var Xe=new Ka().addKeys(He.keys);Ye=je.filter(function(It){return It=W.values?Fe(It):It,!Zg(new Ka(It),Xe)});break;case"deleteRange":var ct=He.range;Ye=je.filter(function(It){return!Wh(Fe(It),ct)})}return Ye},V);return Le===V?V:(Le.sort(function(je,He){return pn(Oe(je),Oe(He))||pn(Fe(je),Fe(He))}),W.limit&&W.limit<1/0&&(Le.length>W.limit?Le.length=W.limit:V.length===W.limit&&Le.length<W.limit&&(le.dirty=!0)),ve?Object.freeze(Le):Le)}function Od(V,W){return pn(V.lower,W.lower)===0&&pn(V.upper,W.upper)===0&&!!V.lowerOpen==!!W.lowerOpen&&!!V.upperOpen==!!W.upperOpen}function CB(V,W){return function(J,ne,le,ve){if(J===void 0)return ne!==void 0?-1:0;if(ne===void 0)return 1;if((ne=pn(J,ne))===0){if(le&&ve)return 0;if(le)return 1;if(ve)return-1}return ne}(V.lower,W.lower,V.lowerOpen,W.lowerOpen)<=0&&0<=function(J,ne,le,ve){if(J===void 0)return ne!==void 0?1:0;if(ne===void 0)return-1;if((ne=pn(J,ne))===0){if(le&&ve)return 0;if(le)return-1;if(ve)return 1}return ne}(V.upper,W.upper,V.upperOpen,W.upperOpen)}function Jg(V,W,J,ne){V.subscribers.add(J),ne.addEventListener("abort",function(){var le,ve;V.subscribers.delete(J),V.subscribers.size===0&&(le=V,ve=W,setTimeout(function(){le.subscribers.size===0&&O(ve,le)},3e3))})}var PB={stack:"dbcore",level:0,name:"Cache",create:function(V){var W=V.schema.name;return n(n({},V),{transaction:function(J,ne,le){var ve,we,Ce=V.transaction(J,ne,le);return ne==="readwrite"&&(we=(ve=new AbortController).signal,le=function(Be){return function(){if(ve.abort(),ne==="readwrite"){for(var Fe=new Set,ze=0,Oe=J;ze<Oe.length;ze++){var Le=Oe[ze],je=Lp["idb://".concat(W,"/").concat(Le)];if(je){var He=V.table(Le),Ye=je.optimisticOps.filter(function(Ai){return Ai.trans===Ce});if(Ce._explicit&&Be&&Ce.mutatedParts)for(var Ge=0,Qe=Object.values(je.queries.query);Ge<Qe.length;Ge++)for(var Xe=0,ct=(jt=Qe[Ge]).slice();Xe<ct.length;Xe++)zU((Pt=ct[Xe]).obsSet,Ce.mutatedParts)&&(O(jt,Pt),Pt.subscribers.forEach(function(Ai){return Fe.add(Ai)}));else if(0<Ye.length){je.optimisticOps=je.optimisticOps.filter(function(Ai){return Ai.trans!==Ce});for(var ht=0,It=Object.values(je.queries.query);ht<It.length;ht++)for(var jt,Pt,Kt,Rt=0,Ni=(jt=It[ht]).slice();Rt<Ni.length;Rt++)(Pt=Ni[Rt]).res!=null&&Ce.mutatedParts&&(Be&&!Pt.dirty?(Kt=Object.isFrozen(Pt.res),Kt=hM(Pt.res,Pt.req,Ye,He,Pt,Kt),Pt.dirty?(O(jt,Pt),Pt.subscribers.forEach(function(Ai){return Fe.add(Ai)})):Kt!==Pt.res&&(Pt.res=Kt,Pt.promise=ge.resolve({result:Kt}))):(Pt.dirty&&O(jt,Pt),Pt.subscribers.forEach(function(Ai){return Fe.add(Ai)})))}}}Fe.forEach(function(Ai){return Ai()})}}},Ce.addEventListener("abort",le(!1),{signal:we}),Ce.addEventListener("error",le(!1),{signal:we}),Ce.addEventListener("complete",le(!0),{signal:we})),Ce},table:function(J){var ne=V.table(J),le=ne.schema.primaryKey;return n(n({},ne),{mutate:function(ve){var we=xe.trans;if(le.outbound||we.db._options.cache==="disabled"||we.explicit)return ne.mutate(ve);var Ce=Lp["idb://".concat(W,"/").concat(J)];return Ce?(we=ne.mutate(ve),ve.type!=="add"&&ve.type!=="put"||!(50<=ve.values.length||WU(le,ve).some(function(Be){return Be==null}))?(Ce.optimisticOps.push(ve),ve.mutatedParts&&Zy(ve.mutatedParts),we.then(function(Be){0<Be.numFailures&&(O(Ce.optimisticOps,ve),(Be=ru(0,ve,Be))&&Ce.optimisticOps.push(Be),ve.mutatedParts&&Zy(ve.mutatedParts))}),we.catch(function(){O(Ce.optimisticOps,ve),ve.mutatedParts&&Zy(ve.mutatedParts)})):we.then(function(Be){var Fe=ru(0,n(n({},ve),{values:ve.values.map(function(je,Oe){var Le,je=(Le=le.keyPath)!==null&&Le!==void 0&&Le.includes(".")?N(je):n({},je);return S(je,le.keyPath,Be.results[Oe]),je})}),Be);Ce.optimisticOps.push(Fe),queueMicrotask(function(){return ve.mutatedParts&&Zy(ve.mutatedParts)})}),we):ne.mutate(ve)},query:function(ve){if(!pM(xe,ne)||!YU("query",ve))return ne.query(ve);var we=((Fe=xe.trans)===null||Fe===void 0?void 0:Fe.db._options.cache)==="immutable",Oe=xe,Ce=Oe.requery,Be=Oe.signal,Fe=function(He,Ye,Ge,Qe){var Xe=Lp["idb://".concat(He,"/").concat(Ye)];if(!Xe)return[];if(!(Ye=Xe.queries[Ge]))return[null,!1,Xe,null];var ct=Ye[(Qe.query?Qe.query.index.name:null)||""];if(!ct)return[null,!1,Xe,null];switch(Ge){case"query":var ht=ct.find(function(It){return It.req.limit===Qe.limit&&It.req.values===Qe.values&&Od(It.req.query.range,Qe.query.range)});return ht?[ht,!0,Xe,ct]:[ct.find(function(It){return("limit"in It.req?It.req.limit:1/0)>=Qe.limit&&(!Qe.values||It.req.values)&&CB(It.req.query.range,Qe.query.range)}),!1,Xe,ct];case"count":return ht=ct.find(function(It){return Od(It.req.query.range,Qe.query.range)}),[ht,!!ht,Xe,ct]}}(W,J,"query",ve),ze=Fe[0],Oe=Fe[1],Le=Fe[2],je=Fe[3];return ze&&Oe?ze.obsSet=ve.obsSet:(Oe=ne.query(ve).then(function(He){var Ye=He.result;if(ze&&(ze.res=Ye),we){for(var Ge=0,Qe=Ye.length;Ge<Qe;++Ge)Object.freeze(Ye[Ge]);Object.freeze(Ye)}else He.result=N(Ye);return He}).catch(function(He){return je&&ze&&O(je,ze),Promise.reject(He)}),ze={obsSet:ve.obsSet,promise:Oe,subscribers:new Set,type:"query",req:ve,dirty:!1},je?je.push(ze):(je=[ze],(Le=Le||(Lp["idb://".concat(W,"/").concat(J)]={queries:{query:{},count:{}},objs:new Map,optimisticOps:[],unsignaledParts:{}})).queries.query[ve.query.index.name||""]=je)),Jg(ze,je,Ce,Be),ze.promise.then(function(He){return{result:hM(He.result,ve,Le==null?void 0:Le.optimisticOps,ne,ze,we)}})}})}})}};function Kh(V,W){return new Proxy(V,{get:function(J,ne,le){return ne==="db"?W:Reflect.get(J,ne,le)}})}var Ld=(ka.prototype.version=function(V){if(isNaN(V)||V<.1)throw new X.Type("Given version is not a positive number");if(V=Math.round(10*V)/10,this.idbdb||this._state.isBeingOpened)throw new X.Schema("Cannot add version when database is open");this.verno=Math.max(this.verno,V);var W=this._versions,J=W.filter(function(ne){return ne._cfg.version===V})[0];return J||(J=new this.Version(V),W.push(J),W.sort(ii),J.stores({}),this._state.autoSchema=!1,J)},ka.prototype._whenReady=function(V){var W=this;return this.idbdb&&(this._state.openComplete||xe.letThrough||this._vip)?V():new ge(function(J,ne){if(W._state.openComplete)return ne(new X.DatabaseClosed(W._state.dbOpenError));if(!W._state.isBeingOpened){if(!W._state.autoOpen)return void ne(new X.DatabaseClosed);W.open().catch(me)}W._state.dbReadyPromise.then(J,ne)}).then(V)},ka.prototype.use=function(V){var W=V.stack,J=V.create,ne=V.level,le=V.name;return le&&this.unuse({stack:W,name:le}),V=this._middlewares[W]||(this._middlewares[W]=[]),V.push({stack:W,create:J,level:ne??10,name:le}),V.sort(function(ve,we){return ve.level-we.level}),this},ka.prototype.unuse=function(V){var W=V.stack,J=V.name,ne=V.create;return W&&this._middlewares[W]&&(this._middlewares[W]=this._middlewares[W].filter(function(le){return ne?le.create!==ne:!!J&&le.name!==J})),this},ka.prototype.open=function(){var V=this;return Zo(Ue,function(){return UB(V)})},ka.prototype._close=function(){var V=this._state,W=Ls.indexOf(this);if(0<=W&&Ls.splice(W,1),this.idbdb){try{this.idbdb.close()}catch{}this.idbdb=null}V.isBeingOpened||(V.dbReadyPromise=new ge(function(J){V.dbReadyResolve=J}),V.openCanceller=new ge(function(J,ne){V.cancelOpen=ne}))},ka.prototype.close=function(J){var W=(J===void 0?{disableAutoOpen:!0}:J).disableAutoOpen,J=this._state;W?(J.isBeingOpened&&J.cancelOpen(new X.DatabaseClosed),this._close(),J.autoOpen=!1,J.dbOpenError=new X.DatabaseClosed):(this._close(),J.autoOpen=this._options.autoOpen||J.isBeingOpened,J.openComplete=!1,J.dbOpenError=null)},ka.prototype.delete=function(V){var W=this;V===void 0&&(V={disableAutoOpen:!0});var J=0<arguments.length&&typeof arguments[0]!="object",ne=this._state;return new ge(function(le,ve){function we(){W.close(V);var Ce=W._deps.indexedDB.deleteDatabase(W.name);Ce.onsuccess=gn(function(){var Be,Fe,ze;Be=W._deps,Fe=W.name,ze=Be.indexedDB,Be=Be.IDBKeyRange,$s(ze)||Fe===hl||zh(ze,Be).delete(Fe).catch(me),le()}),Ce.onerror=fl(ve),Ce.onblocked=W._fireOnBlocked}if(J)throw new X.InvalidArgument("Invalid closeOptions argument to db.delete()");ne.isBeingOpened?ne.dbReadyPromise.then(we):we()})},ka.prototype.backendDB=function(){return this.idbdb},ka.prototype.isOpen=function(){return this.idbdb!==null},ka.prototype.hasBeenClosed=function(){var V=this._state.dbOpenError;return V&&V.name==="DatabaseClosed"},ka.prototype.hasFailed=function(){return this._state.dbOpenError!==null},ka.prototype.dynamicallyOpened=function(){return this._state.autoSchema},Object.defineProperty(ka.prototype,"tables",{get:function(){var V=this;return o(this._allTables).map(function(W){return V._allTables[W]})},enumerable:!1,configurable:!0}),ka.prototype.transaction=function(){var V=(function(W,J,ne){var le=arguments.length;if(le<2)throw new X.InvalidArgument("Too few arguments");for(var ve=new Array(le-1);--le;)ve[le-1]=arguments[le];return ne=ve.pop(),[W,C(ve),ne]}).apply(this,arguments);return this._transaction.apply(this,V)},ka.prototype._transaction=function(V,W,J){var ne=this,le=xe.trans;le&&le.db===this&&V.indexOf("!")===-1||(le=null);var ve,we,Ce=V.indexOf("?")!==-1;V=V.replace("!","").replace("?","");try{if(we=W.map(function(Fe){if(Fe=Fe instanceof ne.Table?Fe.name:Fe,typeof Fe!="string")throw new TypeError("Invalid table argument to Dexie.transaction(). Only Table or String are allowed");return Fe}),V=="r"||V===Fs)ve=Fs;else{if(V!="rw"&&V!=mt)throw new X.InvalidArgument("Invalid transaction mode: "+V);ve=mt}if(le){if(le.mode===Fs&&ve===mt){if(!Ce)throw new X.SubTransaction("Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY");le=null}le&&we.forEach(function(Fe){if(le&&le.storeNames.indexOf(Fe)===-1){if(!Ce)throw new X.SubTransaction("Table "+Fe+" not included in parent transaction.");le=null}}),Ce&&le&&!le.active&&(le=null)}}catch(Fe){return le?le._promise(null,function(ze,Oe){Oe(Fe)}):Qi(Fe)}var Be=(function Fe(ze,Oe,Le,je,He){return ge.resolve().then(function(){var Ye=xe.transless||xe,Ge=ze._createTransaction(Oe,Le,ze._dbSchema,je);if(Ge.explicit=!0,Ye={trans:Ge,transless:Ye},je)Ge.idbtrans=je.idbtrans;else try{Ge.create(),Ge.idbtrans._explicit=!0,ze._state.PR1398_maxLoop=3}catch(ct){return ct.name===Y.InvalidState&&ze.isOpen()&&0<--ze._state.PR1398_maxLoop?(console.warn("Dexie: Need to reopen db"),ze.close({disableAutoOpen:!1}),ze.open().then(function(){return Fe(ze,Oe,Le,null,He)})):Qi(ct)}var Qe,Xe=G(He);return Xe&&ra(),Ye=ge.follow(function(){var ct;(Qe=He.call(Ge,Ge))&&(Xe?(ct=vo.bind(null,null),Qe.then(ct,ct)):typeof Qe.next=="function"&&typeof Qe.throw=="function"&&(Qe=Im(Qe)))},Ye),(Qe&&typeof Qe.then=="function"?ge.resolve(Qe).then(function(ct){return Ge.active?ct:Qi(new X.PrematureCommit("Transaction committed too early. See http://bit.ly/2kdckMn"))}):Ye.then(function(){return Qe})).then(function(ct){return je&&Ge._resolve(),Ge._completion.then(function(){return ct})}).catch(function(ct){return Ge._reject(ct),Qi(ct)})})}).bind(null,this,ve,we,le,J);return le?le._promise(ve,Be,"lock"):xe.trans?Zo(xe.transless,function(){return ne._whenReady(Be)}):this._whenReady(Be)},ka.prototype.table=function(V){if(!d(this._allTables,V))throw new X.InvalidTable("Table ".concat(V," does not exist"));return this._allTables[V]},ka);function ka(V,W){var J=this;this._middlewares={},this.verno=0;var ne=ka.dependencies;this._options=W=n({addons:ka.addons,autoOpen:!0,indexedDB:ne.indexedDB,IDBKeyRange:ne.IDBKeyRange,cache:"cloned"},W),this._deps={indexedDB:W.indexedDB,IDBKeyRange:W.IDBKeyRange},ne=W.addons,this._dbSchema={},this._versions=[],this._storeNames=[],this._allTables={},this.idbdb=null,this._novip=this;var le,ve,we,Ce,Be,Fe={dbOpenError:null,isBeingOpened:!1,onReadyBeingFired:null,openComplete:!1,dbReadyResolve:me,dbReadyPromise:null,cancelOpen:me,openCanceller:null,autoSchema:!0,PR1398_maxLoop:3,autoOpen:W.autoOpen};Fe.dbReadyPromise=new ge(function(Oe){Fe.dbReadyResolve=Oe}),Fe.openCanceller=new ge(function(Oe,Le){Fe.cancelOpen=Le}),this._state=Fe,this.name=V,this.on=Na(this,"populate","blocked","versionchange","close",{ready:[Te,me]}),this.on.ready.subscribe=b(this.on.ready.subscribe,function(Oe){return function(Le,je){ka.vip(function(){var He,Ye=J._state;Ye.openComplete?(Ye.dbOpenError||ge.resolve().then(Le),je&&Oe(Le)):Ye.onReadyBeingFired?(Ye.onReadyBeingFired.push(Le),je&&Oe(Le)):(Oe(Le),He=J,je||Oe(function Ge(){He.on.ready.unsubscribe(Le),He.on.ready.unsubscribe(Ge)}))})}}),this.Collection=(le=this,Yi(ur.prototype,function(Qe,Ge){this.db=le;var je=Nn,He=null;if(Ge)try{je=Ge()}catch(Xe){He=Xe}var Ye=Qe._ctx,Ge=Ye.table,Qe=Ge.hook.reading.fire;this._ctx={table:Ge,index:Ye.index,isPrimKey:!Ye.index||Ge.schema.primKey.keyPath&&Ye.index===Ge.schema.primKey.name,range:je,keysOnly:!1,dir:"next",unique:"",algorithm:null,filter:null,replayFilter:null,justLimit:!0,isMatch:null,offset:0,limit:1/0,error:He,or:Ye.or,valueMapper:Qe!==se?Qe:null}})),this.Table=(ve=this,Yi(Vl.prototype,function(Oe,Le,je){this.db=ve,this._tx=je,this.name=Oe,this.schema=Le,this.hook=ve._allTables[Oe]?ve._allTables[Oe].hook:Na(null,{creating:[ae,me],reading:[te,se],updating:[Ie,me],deleting:[de,me]})})),this.Transaction=(we=this,Yi(Hh.prototype,function(Oe,Le,je,He,Ye){var Ge=this;this.db=we,this.mode=Oe,this.storeNames=Le,this.schema=je,this.chromeTransactionDurability=He,this.idbtrans=null,this.on=Na(this,"complete","error","abort"),this.parent=Ye||null,this.active=!0,this._reculock=0,this._blockedFuncs=[],this._resolve=null,this._reject=null,this._waitingFor=null,this._waitingQueue=null,this._spinCount=0,this._completion=new ge(function(Qe,Xe){Ge._resolve=Qe,Ge._reject=Xe}),this._completion.then(function(){Ge.active=!1,Ge.on.complete.fire()},function(Qe){var Xe=Ge.active;return Ge.active=!1,Ge.on.error.fire(Qe),Ge.parent?Ge.parent._reject(Qe):Xe&&Ge.idbtrans&&Ge.idbtrans.abort(),Qi(Qe)})})),this.Version=(Ce=this,Yi(xp.prototype,function(Oe){this.db=Ce,this._cfg={version:Oe,storesSource:null,dbschema:{},tables:{},contentUpgrade:null}})),this.WhereClause=(Be=this,Yi(Jo.prototype,function(Oe,Le,je){if(this.db=Be,this._ctx={table:Oe,index:Le===":id"?null:Le,or:je},this._cmp=this._ascending=pn,this._descending=function(He,Ye){return pn(Ye,He)},this._max=function(He,Ye){return 0<pn(He,Ye)?He:Ye},this._min=function(He,Ye){return pn(He,Ye)<0?He:Ye},this._IDBKeyRange=Be._deps.IDBKeyRange,!this._IDBKeyRange)throw new X.MissingAPI})),this.on("versionchange",function(Oe){0<Oe.newVersion?console.warn("Another connection wants to upgrade database '".concat(J.name,"'. Closing db now to resume the upgrade.")):console.warn("Another connection wants to delete database '".concat(J.name,"'. Closing db now to resume the delete request.")),J.close({disableAutoOpen:!1})}),this.on("blocked",function(Oe){!Oe.newVersion||Oe.newVersion<Oe.oldVersion?console.warn("Dexie.delete('".concat(J.name,"') was blocked")):console.warn("Upgrade '".concat(J.name,"' blocked by other connection holding version ").concat(Oe.oldVersion/10))}),this._maxKey=ml(W.IDBKeyRange),this._createTransaction=function(Oe,Le,je,He){return new J.Transaction(Oe,Le,je,J._options.chromeTransactionDurability,He)},this._fireOnBlocked=function(Oe){J.on("blocked").fire(Oe),Ls.filter(function(Le){return Le.name===J.name&&Le!==J&&!Le._state.vcFired}).map(function(Le){return Le.on("versionchange").fire(Oe)})},this.use(DB),this.use(PB),this.use(EB),this.use(dM),this.use(KU);var ze=new Proxy(this,{get:function(Oe,Le,je){if(Le==="_vip")return!0;if(Le==="table")return function(Ye){return Kh(J.table(Ye),ze)};var He=Reflect.get(Oe,Le,je);return He instanceof Vl?Kh(He,ze):Le==="tables"?He.map(function(Ye){return Kh(Ye,ze)}):Le==="_createTransaction"?function(){return Kh(He.apply(this,arguments),ze)}:He}});this.vip=ze,ne.forEach(function(Oe){return Oe(J)})}var Gw,ts=typeof Symbol<"u"&&"observable"in Symbol?Symbol.observable:"@@observable",Hw=(ZU.prototype.subscribe=function(V,W,J){return this._subscribe(V&&typeof V!="function"?V:{next:V,error:W,complete:J})},ZU.prototype[ts]=function(){return this},ZU);function ZU(V){this._subscribe=V}try{Gw={indexedDB:a.indexedDB||a.mozIndexedDB||a.webkitIndexedDB||a.msIndexedDB,IDBKeyRange:a.IDBKeyRange||a.webkitIDBKeyRange}}catch{Gw={indexedDB:null,IDBKeyRange:null}}function zw(V){var W,J=!1,ne=new Hw(function(le){var ve=G(V),we,Ce=!1,Be={},Fe={},ze={get closed(){return Ce},unsubscribe:function(){Ce||(Ce=!0,we&&we.abort(),Oe&&fc.storagemutated.unsubscribe(je))}};le.start&&le.start(ze);var Oe=!1,Le=function(){return Os(He)},je=function(Ye){Bw(Be,Ye),zU(Fe,Be)&&Le()},He=function(){var Ye,Ge,Qe;!Ce&&Gw.indexedDB&&(Be={},Ye={},we&&we.abort(),we=new AbortController,Qe=function(Xe){var ct=At();try{ve&&ra();var ht=na(V,Xe);return ht=ve?ht.finally(vo):ht}finally{ct&&ei()}}(Ge={subscr:Ye,signal:we.signal,requery:Le,querier:V,trans:null}),Promise.resolve(Qe).then(function(Xe){J=!0,W=Xe,Ce||Ge.signal.aborted||(Be={},function(ct){for(var ht in ct)if(d(ct,ht))return;return 1}(Fe=Ye)||Oe||(fc(Oo,je),Oe=!0),Os(function(){return!Ce&&le.next&&le.next(Xe)}))},function(Xe){J=!1,["DatabaseClosedError","AbortError"].includes(Xe==null?void 0:Xe.name)||Ce||Os(function(){Ce||le.error&&le.error(Xe)})}))};return setTimeout(Le,0),ze});return ne.hasValue=function(){return J},ne.getValue=function(){return W},ne}var wm=Ld;function Zu(V){var W=mc;try{mc=!0,fc.storagemutated.fire(V),Xg(V,!0)}finally{mc=W}}p(wm,n(n({},re),{delete:function(V){return new wm(V,{addons:[]}).delete()},exists:function(V){return new wm(V,{addons:[]}).open().then(function(W){return W.close(),!0}).catch("NoSuchDatabaseError",function(){return!1})},getDatabaseNames:function(V){try{return W=wm.dependencies,J=W.indexedDB,W=W.IDBKeyRange,($s(J)?Promise.resolve(J.databases()).then(function(ne){return ne.map(function(le){return le.name}).filter(function(le){return le!==hl})}):zh(J,W).toCollection().primaryKeys()).then(V)}catch{return Qi(new X.MissingAPI)}var W,J},defineClass:function(){return function(V){l(this,V)}},ignoreTransaction:function(V){return xe.trans?Zo(xe.transless,V):V()},vip:VU,async:function(V){return function(){try{var W=Im(V.apply(this,arguments));return W&&typeof W.then=="function"?W:ge.resolve(W)}catch(J){return Qi(J)}}},spawn:function(V,W,J){try{var ne=Im(V.apply(J,W||[]));return ne&&typeof ne.then=="function"?ne:ge.resolve(ne)}catch(le){return Qi(le)}},currentTransaction:{get:function(){return xe.trans||null}},waitFor:function(V,W){return W=ge.resolve(typeof V=="function"?wm.ignoreTransaction(V):V).timeout(W||6e4),xe.trans?xe.trans.waitFor(W):W},Promise:ge,debug:{get:function(){return _e},set:function(V){Ve(V)}},derive:m,extend:l,props:p,override:b,Events:Na,on:fc,liveQuery:zw,extendObservabilitySet:Bw,getByKeyPath:w,setByKeyPath:S,delByKeyPath:function(V,W){typeof W=="string"?S(V,W,void 0):"length"in W&&[].map.call(W,function(J){S(V,J,void 0)})},shallowClone:D,deepClone:N,getObjectDiff:Vw,cmp:pn,asap:T,minKey:-1/0,addons:[],connections:Ls,errnames:Y,dependencies:Gw,cache:Lp,semVer:"4.0.1",version:"4.0.1".split(".").map(function(V){return parseInt(V)}).reduce(function(V,W,J){return V+W/Math.pow(10,2*J)})})),wm.maxKey=ml(wm.dependencies.IDBKeyRange),typeof dispatchEvent<"u"&&typeof addEventListener<"u"&&(fc(Oo,function(V){mc||(V=new CustomEvent(lr,{detail:V}),mc=!0,dispatchEvent(V),mc=!1)}),addEventListener(lr,function(V){V=V.detail,mc||Zu(V)}));var Qg,mc=!1,fM=function(){};return typeof BroadcastChannel<"u"&&((fM=function(){(Qg=new BroadcastChannel(lr)).onmessage=function(V){return V.data&&Zu(V.data)}})(),typeof Qg.unref=="function"&&Qg.unref(),fc(Oo,function(V){mc||Qg.postMessage(V)})),typeof addEventListener<"u"&&(addEventListener("pagehide",function(V){if(!Ld.disableBfCache&&V.persisted){_e&&console.debug("Dexie: handling persisted pagehide"),Qg!=null&&Qg.close();for(var W=0,J=Ls;W<J.length;W++)J[W].close({disableAutoOpen:!1})}}),addEventListener("pageshow",function(V){!Ld.disableBfCache&&V.persisted&&(_e&&console.debug("Dexie: handling persisted pageshow"),fM(),Zu({all:new Ka(-1/0,[[]])}))})),ge.rejectionMapper=function(V,W){return!V||V instanceof $||V instanceof TypeError||V instanceof SyntaxError||!V.name||!oe[V.name]?V:(W=new oe[V.name](W||V.message,V),"stack"in V&&f(W,"stack",{get:function(){return this.inner.stack}}),W)},Ve(_e),n(Ld,Object.freeze({__proto__:null,Dexie:Ld,liveQuery:zw,Entity:cs,cmp:pn,PropModSymbol:nn,PropModification:si,replacePrefix:function(V,W){return new si({replacePrefix:[V,W]})},default:Ld,RangeSet:Ka,mergeRanges:Yg,rangesOverlap:Zg}),{default:Ld}),Ld})})(yTe);var A9e=yTe.exports;const Gj=RP(A9e),HX=Symbol.for("Dexie"),Z_=globalThis[HX]||(globalThis[HX]=Gj);if(Gj.semVer!==Z_.semVer)throw new Error(`Two different versions of Dexie loaded in the same app: ${Gj.semVer} and ${Z_.semVer}`);const xc=function(){const t={};return t.initDB=()=>new Promise((e,i)=>{try{t.dex=new Z_("TMX",{autoOpen:!0}),t.dex.version(2).stores({tournaments:"&tournamentId, tournamentName, startDate, endDate",providers:"&providerId, settings, calendar",idioms:"ioc"}),e()}catch(n){return i(n)}}),t.resetDB=e=>{t.dex.close(),Z_.delete("TMX").then(e,()=>alert("Failed to Reset Database"))},t.findAll=e=>new Promise((i,n)=>{const r=t.dex[e];return r?r.toArray(i,n).catch(n):i([])}),t.findAllTournaments=()=>t.findAll("tournaments"),t.findAllProviders=()=>t.findAll("providers"),t.findAllIdioms=()=>t.findAll("idioms"),t.findWhere=(e,i,n)=>new Promise((r,a)=>t.dex[e].where(i).equals(n).toArray(r,a).catch(a)),t.deleteTournament=e=>new Promise((i,n)=>{t.dex.tournaments.where("tournamentId").equals(e).delete().then(i,n)}),t.deleteProvider=e=>t.dex.providers.where("providerId").equals(e).delete(),t.deleteAllTournamentAttr=e=>t.dex.tournaments.toCollection().modify(i=>delete i[e]).then(()=>console.log("done")),t.findUnique=(e,i,n)=>new Promise((r,a)=>{t.findWhere(e,i,n).then(o=>r(o!=null&&o.length?o[0]:void 0),a)}),t.findProvider=e=>t.findUnique("providers","providerId",e),t.findIdiom=e=>t.findUnique("idioms","ioc",e),t.findTournament=e=>t.findUnique("tournaments","tournamentId",e),t.findProviderTournaments=e=>t.findWhere("tournaments","providerId",e),t.addItem=(e,i)=>new Promise((n,r)=>t.dex[e].put(i).then(n,r).catch(a=>{alert("try again:",a),r(a)})),t.modifyOrAddUnique=(e,i,n,r)=>new Promise((a,o)=>{t.dex[e].where(i).equals(n).modify(s=>Object.assign(s,r)).then(s=>{if(s)return a("exists");t.addItem(e,r).then(a,o)},s=>{console.log({err:s}),o(s)})}),t.addIdiom=e=>t.modifyOrAddUnique("idioms","ioc",e.ioc,e),t.addTournament=e=>t.modifyOrAddUnique("tournaments","tournamentId",e.tournamentId,e),t.addProvider=e=>t.modifyOrAddUnique("providers","providerId",e.providerId,e),t.modify=(e,i,n,r,a)=>new Promise((o,s)=>{t.dex[e].where(i).equals(n).modify(l=>{Object.assign(a,{item:l}),r(a)}).then(o,l=>{console.log("error:",l),s()})}),t}(),t9="3.0.35",ln={socketIo:{tmx:"/tmx"},activeScale:"wtn",hotkeys:!0,scales:{utr:{accessor:"utrRating",scaleType:"RATING",scaleColor:"blue",scaleName:"UTR",fallback:!0},wtn:{accessor:"wtnRating",scaleType:"RATING",scaleColor:"red",scaleName:"WTN",fallback:!0}},serverFirst:!0,version:t9,ioc:"gbr",locations:{geolocate:!0,geoposition:void 0,map:void 0,map_view:"satellite",map_provider:"leaflet"},leaflet:{map:{tileLayer:"http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",attribution:'&copy; <a href="http://openstreetmap.org">OpenStreetMap</a> Contributors',maxZoom:18},satellite:{tileLayer:"https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",attribution:"Tiles &copy; Esri"}},calendar:{start:void 0,end:void 0,category:void 0,first_day:0},scoring:{delegationOfficial:!1,delegation:!0},scoreboard:{matchFormats:{categories:{},singles:"SET3-S:6/TB7",doubles:"SET3-S:6/TB7-F:TB10"},options:{bestof:[1,3,5],setsto:[4,6,8,9],tiebreaksto:[5,7,12],supertiebreakto:[7,10,21]},settings:{singles:{max_sets:3,sets_to_win:2,games_for_set:6,tiebreak_to:7,tiebreaks_at:6,supertiebreak_to:10,final_set_tiebreak:!0,final_set_supertiebreak:!1},doubles:{max_sets:3,sets_to_win:2,games_for_set:6,tiebreak_to:7,tiebreaks_at:6,supertiebreak_to:10,final_set_tiebreak:!1,final_set_supertiebreak:!0}}},printing:{pageSize:"A4"},schedule:{teams:!0,clubs:!0,time24:!0,ioc_codes:!1,default_time:"9:00",scores_in_draw_order:!0,completed_matches_in_search:!1,max_matches_per_court:14,court_identifiers:!0},messages:[],device:{}};async function i9(t){var i,n;(i=ln.log)!=null&&i.verbose&&console.log("%c localSave","color: yellow");const e=(t==null?void 0:t.tournamentRecord)??((n=at.getTournament())==null?void 0:n.tournamentRecord);await xc.addTournament(e),Nt(t==null?void 0:t.callback)&&t.callback()}const n9=Ihe();function bTe(){localStorage.removeItem(n9)}function ITe(){return localStorage.getItem(n9)}function _9e(t){localStorage.setItem(n9,t)}function VF(t){var r,a,o,s,l,c,u,d;const e=((r=t.tournamentName)==null?void 0:r.toLowerCase())||"Error",i=(o=(a=t.onlineResources)==null?void 0:a.find(({name:p,resourceType:h})=>p==="tournamentImage"&&h==="URL"))==null?void 0:o.identifier,n=(c=(l=(s=t.timeItems)==null?void 0:s.find(({itemType:p})=>p==="TMX"))==null?void 0:l.itemValue)==null?void 0:c.offline;return{tournamentId:t.tournamentId,id:t.tournamentId,searchText:e,tournament:{startDate:(u=new Date(t.startDate).toISOString())==null?void 0:u.split("T")[0],endDate:(d=new Date(t.endDate).toISOString())==null?void 0:d.split("T")[0],tournamentName:t.tournamentName,tournamentImageURL:i,offline:n}}}const Ew=t=>{let e;const i=Array.isArray(t)?t:[t];return n=>{if(e&&i.forEach(r=>r.removeFilter(e)),n){const r=n==null?void 0:n.toLowerCase();e=a=>{var o;return(o=a.searchText)==null?void 0:o.includes(r)},i.forEach(a=>a.addFilter(e))}else e=void 0}};function wTe({tournamentRecord:t,callback:e}){var n;const i=(n=zc())==null?void 0:n.provider;i&&!t.parentOrganisation&&(t.parentOrganisation=i),i9({tournamentRecord:t,callback:e})}function k9e({callback:t,autoClose:e=!0}={}){const i=s=>{const l=s.name.split(".").reverse()[0];let c=new FileReader;c.onload=function(u){if(u.target.error){console.log("file error",u.target.error);return}let d=u.target.result;d.length&&(Nt(t)?t(d):console.log(d))},["csv","json"].includes(l)?c.readAsText(s):console.log("not loaded")},n=document.createElement("div");n.className="dzx-dropzone",n.id="tmxDropzone";const r=document.createElement("label");r.className="dzx-inputLabel",r.innerHTML="Drag and Drop files into this zone";const a=document.createElement("input");a.className="dzx-input",a.setAttribute("type","file"),a.setAttribute("accept","application/json"),r.appendChild(a),n.appendChild(r),cr({buttons:[{label:"Cancel",intent:"none",close:!0},{label:"Done"}],title:"Import tournament records",content:n}),["drag","dragstart","dragend","dragover","dragenter","dragleave","drop"].forEach(s=>{n.addEventListener(s,function(l){l.preventDefault(),l.stopPropagation()})});const o="dropone-dragging";n.addEventListener("dragover",function(){this.classList.add(o)},!1),n.addEventListener("dragleave",function(){this.classList.remove(o)},!1),n.addEventListener("drop",function(s){const l=a.getAttribute("multiple");this.classList.remove(o);const c=s.dataTransfer.files,u=new DataTransfer;Array.prototype.forEach.call(c,p=>{if(u.items.add(p),!l)return!1});const d=u.files;Array.from(d).forEach(i),e&&yI()},!1)}function STe({note:t,data:e}){try{return JSON.parse(e)}catch{console.log({message:"falied normal parse",note:t})}}function x9e(t){if(t){if(typeof t=="string")return t;try{return JSON.stringify(t)}catch{return""}}}function O9e(t){const e=t.getData().map(i=>i.tournamentId);k9e({callback:i=>{const n=STe({data:i});if(n){let r,a;n.tournamentId&&n.startDate?a=n:n.tuid&&n.start&&ti({message:"TMX Classic file not converted"}),r=at.setState(a),r.success?KR({tournamentRecord:a,tournamentIds:e,table:t}):console.log(r)}}})}function KR({tournamentRecord:t,tournamentIds:e,table:i,callback:n}){const r=VF(t);(e==null?void 0:e.includes(t.tournamentId))?i==null||i.updateOrAddData([r],!0):i==null||i.addData([r],!0),wTe({tournamentRecord:t}),Nt(n)&&n()}function zX(t){return _i.dateTime.dateValidation.test(t)}const ta=(t,e)=>i=>(i==null?void 0:i.trim().length)>=t&&(!e||e&&(i==null?void 0:i.trim().length)<=e);function Cw(t,e,i){if(!t)return;const n={};for(const r of e||[]){if(!(r!=null&&r.label)||r.hide)continue;const a=document.createElement("button");r.id&&(n[r.id]=a,a.id=r.id),a.style="margin-right: .5em;",a.className="button font-medium",r.intent&&a.classList.add(r.intent),a.innerHTML=r.label,r.disabled&&(a.disabled=!0),a.onclick=o=>{o.stopPropagation(),!o.target.disabled&&Nt(r.onClick)&&r.onClick(),Nt(i)&&i()},t.appendChild(a)}return{elements:n}}const Tt={matchUpsToBroadcast:[],tables:[],ee:null,drawer:null,modal:null,state:{authorized:!1,admin:!1},displayed:{schedule_day:null,draw_event:null},columns:{}},L9e="addCourts",F9e="addFlight",B9e="addDrawDefinition",TTe="addAdHocMatchUps",$9e="addDrawEntries",V9e="addDrawDefinitionExtension",j9e="addDynamicRatings",G9e="addEvent",r9="addEventEntries",H9e="addEventEntryPairs",z9e="addEventExtension",UTe="addIndividualParticipantIds",Hj="addMatchUpScheduleItems",q9e="addOnlineResource",YR="addParticipants",qX="addParticipantTimeItem",DTe="addPlayoffStructures",W9e="addTournamentExtension",K9e="addTournamentTimeItem",Y9e="addVenue",Z9e="attachQualifyingStructure",X9e="attachPolicies",J9e="automatedPlayoffPositioning",a9="bulkScheduleMatchUps",ETe="deleteAdHocMatchUps",Q9e="deleteFlightAndFlightDraw",eKe="deleteEvents",tKe="deleteParticipants",iKe="deleteVenues",nKe="destroyPairEntries",CTe="modifyCourt",rKe="modifyEvent",PTe="modifyEntriesStatus",X_="modifyParticipant",o9="modifyParticipantsSignInStatus",aKe="modifyTieFormmat",oKe="modifyVenue",sKe="proAutoSchedule",RTe="publishEvent",lKe="removeIndividualParticipantIds",cKe="removeStructure",MTe="renameStructures",uKe="resetDrawDefinition",NTe="resetMatchUpLinesUps",ATe="resetScorecard",dKe="setMatchUpFormat",s9="setMatchUpStatus",pKe="setParticipantScaleItems",hKe="setTournamentDates",fKe="setTournamentName",mKe="setTournamentNotes",gKe="unPublishEvent";function _Te({table:t,tournamentRecord:e}){const i={tournamentName:(e==null?void 0:e.tournamentName)||"",startDate:(e==null?void 0:e.startDate)||"",endDate:(e==null?void 0:e.endDate)||""};let n;const r=[{error:"minimum of 5 characters",placeholder:"Tournament name",value:i.tournamentName,validator:ta(5),label:"Tournament name",field:"tournamentName",focus:!0},{placeholder:"YYYY-MM-DD",value:i.startDate,label:"Start date",field:"startDate"},{placeholder:"YYYY-MM-DD",value:i.endDate,label:"End date",field:"endDate"}],a=({tournamentName:m,startDate:g,endDate:v})=>ta(5)(m)&&zX(g)&&zX(v),o=({inputs:m})=>{const g=a({tournamentName:m.tournamentName.value,startDate:m.startDate.value,endDate:m.endDate.value}),v=document.getElementById("saveTournamentEdits");v&&(v.disabled=!g)},s=[{fields:["startDate","endDate"],dateRange:!0},{control:"tournamentName",onInput:o},{onFocusOut:o,control:"startDate"},{onFocusOut:o,control:"endDate"}],l=m=>{n=Cr(m,r,s)},c=()=>ta(5)(n.drawName.value),u=()=>{var y,b;const m=(y=n.tournamentName.value)==null?void 0:y.trim(),g=n.startDate.value,v=n.endDate.value;if(e){const I={...e,tournamentName:m,startDate:g,endDate:v};Wt({tournamentRecord:I,methods:[{method:fKe,params:{tournamentName:m}},{method:hKe,params:{startDate:g,endDate:v}}],callback:S=>{S.success?(t==null||t.updateData([VF(I)],!0),KR({tournamentRecord:I})):console.log({result:S})}})}else if(at.newTournamentRecord({tournamentName:m,startDate:g,endDate:v}).success){const T=zc(),w=(b=at.getTournament())==null?void 0:b.tournamentRecord;if(T!=null&&T.providerId){const S=D=>{var C;const E=(C=D.data)==null?void 0:C.provider;if(w.parentOrganisation=E,E){const P=R=>console.log("sendTournament",R);H1({tournamentRecord:w}).then(()=>{},P)}WX({tournamentRecord:w,table:t})};k2e({providerId:T.providerId}).then(S)}else WX({tournamentRecord:w,table:t})}},d=e?"Save":"Add",p=[{label:"Cancel",intent:"none",close:!0},{disabled:!a(i),id:"saveTournamentEdits",label:d,intent:"is-primary",onClick:u,close:c}],h=(m,g)=>Cw(m,p,g),f=e?"Edit tournament":"New tournament";Tt.drawer.open({title:f,content:l,footer:h,side:Qt,width:"300px"})}function WX({tournamentRecord:t,table:e}){KR({tournamentRecord:t,callback:()=>e==null?void 0:e.addData([VF(t)],!0)})}function vKe({table:t}){const e=t.getData().map(s=>s.tournamentId);let i;const n=s=>i=Cr(s,[{iconLeft:"fa-solid fa-fingerprint",placeholder:"tournamentId",label:"Tournament Id",field:"tournamentId"}]),r=()=>{ti({onClose:()=>Tt.router.navigate("/tournaments"),message:"Tournament not found",intent:"is-warning",pauseOnHover:!0,action:"show"})},a=s=>{var d;const l=i.tournamentId.value,c=(d=s.data.tournamentRecords)==null?void 0:d[l];KR({tournamentRecord:c,tournamentIds:e,table:t,callback:()=>{}})};cr({title:"Login",content:n,buttons:[{label:"Cancel",intent:"none",close:!0},{label:"Load",intent:"is-primary",onClick:()=>{const s=i.tournamentId.value;qO({tournamentId:s}).then(a,r)},close:!0}]})}const S$="font-medium";function zj({target:t,button:e,stateChange:i}){var v;let n=0;const r=()=>(n+=1,`Item${n}`),a=document.createElement("div");e.class&&a.classList.add(e.class),a.classList.add("dropdown"),e.id&&(a.id=e.id),e.align===Qt?(a.classList.add("is-right"),a.style="margin-left: 1em"):a.style="margin-right: 1em";const o=y=>y.classList.contains("is-active"),s=()=>{o(a)&&a.classList.remove("is-active")},l=y=>{if(o(y))y.classList.remove("is-active");else return y.classList.add("is-active"),!0};a.onmouseleave=s,a.onclick=()=>l(a);const c=document.createElement("div");c.classList.add("dropdown-trigger");const u=document.createElement("button");u.className="button font-medium",e.intent&&u.classList.add(e.intent),u.setAttribute("aria-haspopup","true");const d=document.createElement("span");Nt(e.onClick)&&(d.onclick=e.onClick),d.style="margin-right: 1em",d.innerHTML=e.label,u.appendChild(d);const p=document.createElement("span");Nt(e.onClick)&&(p.onclick=e.onClick),p.innerHTML=`
      <span class="icon is-small font-medium">
        <i class="fas fa-angle-down font-medium" aria-hidden="true"></i>
      </span>
  `,u.appendChild(p),c.appendChild(u),a.appendChild(c);const h=document.createElement("div");h.classList.add("dropdown-menu"),h.setAttribute("z-index","99998");const f=document.createElement("div");f.classList.add("dropdown-content");const m=()=>{const y=h.querySelectorAll(".dropdown-item");for(const b of Array.from(y))b.classList.remove("is-active")},g=y=>{const b=document.createElement("a");b.className=S$;const I=y.disabled?"0.4":"1";return b.style=`text-decoration: none; opacity: ${I};`,y.color&&(b.style.color=y.color),b.classList.add("dropdown-item"),y.isActive&&b.classList.add("is-active"),y.value&&(b.value=y.value),y.class&&b.classList.add(y.class),b.onclick=T=>{if(y.disabled)return;y.value&&(u.value=y.value,a.value=y.value),T.stopPropagation(),Nt(y.onClick)&&(Nt(i)&&i(),y.onClick(T)),y.close&&s();const w=o(b);m(),w?d.innerHTML=e.label:(e.selection&&l(b),e.modifyLabel&&y.modifyLabel!==!1&&(d.innerHTML=`${e.append?e.label+": ":""}${(y==null?void 0:y.label)||r()}`))},b.innerHTML=(y==null?void 0:y.label)||r(),b};for(const y of e.options||[])if(y.heading){const b=document.createElement("div");b.style="font-weight: bold",b.classList.add("dropdown-item"),b.classList.add(S$),b.innerHTML=y.heading,f.appendChild(b)}else if(y.divider){const b=document.createElement("hr");b.classList.add("dropdown-divider"),b.classList.add(S$),f.appendChild(b)}else y.hide||f.appendChild(g(y));return(v=e.options)!=null&&v.length&&(e.options[0].value&&(a.value=e.options[0].value),h.appendChild(f)),a.appendChild(h),t&&t.appendChild(a),a}class dc{constructor(e){this.table=e}reloadData(e,i,n){return this.table.dataLoader.load(e,void 0,void 0,void 0,i,n)}langText(){return this.table.modules.localize.getText(...arguments)}langBind(){return this.table.modules.localize.bind(...arguments)}langLocale(){return this.table.modules.localize.getLocale(...arguments)}commsConnections(){return this.table.modules.comms.getConnections(...arguments)}commsSend(){return this.table.modules.comms.send(...arguments)}layoutMode(){return this.table.modules.layout.getMode()}layoutRefresh(e){return this.table.modules.layout.layout(e)}subscribe(){return this.table.eventBus.subscribe(...arguments)}unsubscribe(){return this.table.eventBus.unsubscribe(...arguments)}subscribed(e){return this.table.eventBus.subscribed(e)}subscriptionChange(){return this.table.eventBus.subscriptionChange(...arguments)}dispatch(){return this.table.eventBus.dispatch(...arguments)}chain(){return this.table.eventBus.chain(...arguments)}confirm(){return this.table.eventBus.confirm(...arguments)}dispatchExternal(){return this.table.externalEvents.dispatch(...arguments)}subscribedExternal(e){return this.table.externalEvents.subscribed(e)}subscriptionChangeExternal(){return this.table.externalEvents.subscriptionChange(...arguments)}options(e){return this.table.options[e]}setOption(e,i){return typeof i<"u"&&(this.table.options[e]=i),this.table.options[e]}deprecationCheck(e,i,n){return this.table.deprecationAdvisor.check(e,i,n)}deprecationCheckMsg(e,i){return this.table.deprecationAdvisor.checkMsg(e,i)}deprecationMsg(e){return this.table.deprecationAdvisor.msg(e)}module(e){return this.table.module(e)}}class io{static elVisible(e){return!(e.offsetWidth<=0&&e.offsetHeight<=0)}static elOffset(e){var i=e.getBoundingClientRect();return{top:i.top+window.pageYOffset-document.documentElement.clientTop,left:i.left+window.pageXOffset-document.documentElement.clientLeft}}static retrieveNestedData(e,i,n){var r=e?i.split(e):[i],a=r.length,o;for(let s=0;s<a&&(n=n[r[s]],o=n,!!n);s++);return o}static deepClone(e,i,n=[]){var r={}.__proto__,a=[].__proto__;i||(i=Object.assign(Array.isArray(e)?[]:{},e));for(var o in e){let s=e[o],l,c;s!=null&&typeof s=="object"&&(s.__proto__===r||s.__proto__===a)&&(l=n.findIndex(u=>u.subject===s),l>-1?i[o]=n[l].copy:(c=Object.assign(Array.isArray(s)?[]:{},s),n.unshift({subject:s,copy:c}),i[o]=this.deepClone(s,c,n)))}return i}}let yKe=class kTe extends dc{constructor(e,i,n){super(e),this.element=i,this.container=this._lookupContainer(),this.parent=n,this.reversedX=!1,this.childPopup=null,this.blurable=!1,this.blurCallback=null,this.blurEventsBound=!1,this.renderedCallback=null,this.visible=!1,this.hideable=!0,this.element.classList.add("tabulator-popup-container"),this.blurEvent=this.hide.bind(this,!1),this.escEvent=this._escapeCheck.bind(this),this.destroyBinding=this.tableDestroyed.bind(this),this.destroyed=!1}tableDestroyed(){this.destroyed=!0,this.hide(!0)}_lookupContainer(){var e=this.table.options.popupContainer;return typeof e=="string"?(e=document.querySelector(e),e||console.warn("Menu Error - no container element found matching selector:",this.table.options.popupContainer,"(defaulting to document body)")):e===!0&&(e=this.table.element),e&&!this._checkContainerIsParent(e)&&(e=!1,console.warn("Menu Error - container element does not contain this table:",this.table.options.popupContainer,"(defaulting to document body)")),e||(e=document.body),e}_checkContainerIsParent(e,i=this.table.element){return e===i?!0:i.parentNode?this._checkContainerIsParent(e,i.parentNode):!1}renderCallback(e){this.renderedCallback=e}containerEventCoords(e){var i=!(e instanceof MouseEvent),n=i?e.touches[0].pageX:e.pageX,r=i?e.touches[0].pageY:e.pageY;if(this.container!==document.body){let a=io.elOffset(this.container);n-=a.left,r-=a.top}return{x:n,y:r}}elementPositionCoords(e,i="right"){var n=io.elOffset(e),r,a,o;switch(this.container!==document.body&&(r=io.elOffset(this.container),n.left-=r.left,n.top-=r.top),i){case"right":a=n.left+e.offsetWidth,o=n.top-1;break;case"bottom":a=n.left,o=n.top+e.offsetHeight;break;case"left":a=n.left,o=n.top-1;break;case"top":a=n.left,o=n.top;break;case"center":a=n.left+e.offsetWidth/2,o=n.top+e.offsetHeight/2;break}return{x:a,y:o,offset:n}}show(e,i){var n,r,a,o,s;return this.destroyed||this.table.destroyed?this:(e instanceof HTMLElement?(a=e,s=this.elementPositionCoords(e,i),o=s.offset,n=s.x,r=s.y):typeof e=="number"?(o={top:0,left:0},n=e,r=i):(s=this.containerEventCoords(e),n=s.x,r=s.y,this.reversedX=!1),this.element.style.top=r+"px",this.element.style.left=n+"px",this.container.appendChild(this.element),typeof this.renderedCallback=="function"&&this.renderedCallback(),this._fitToScreen(n,r,a,o,i),this.visible=!0,this.subscribe("table-destroy",this.destroyBinding),this.element.addEventListener("mousedown",l=>{l.stopPropagation()}),this)}_fitToScreen(e,i,n,r,a){var o=this.container===document.body?document.documentElement.scrollTop:this.container.scrollTop;if((e+this.element.offsetWidth>=this.container.offsetWidth||this.reversedX)&&(this.element.style.left="",n?this.element.style.right=this.container.offsetWidth-r.left+"px":this.element.style.right=this.container.offsetWidth-e+"px",this.reversedX=!0),i+this.element.offsetHeight>Math.max(this.container.offsetHeight,o?this.container.scrollHeight:0))if(n)switch(a){case"bottom":this.element.style.top=parseInt(this.element.style.top)-this.element.offsetHeight-n.offsetHeight-1+"px";break;default:this.element.style.top=parseInt(this.element.style.top)-this.element.offsetHeight+n.offsetHeight+1+"px"}else this.element.style.top=parseInt(this.element.style.top)-this.element.offsetHeight+"px"}isVisible(){return this.visible}hideOnBlur(e){return this.blurable=!0,this.visible&&(setTimeout(()=>{this.visible&&(this.table.rowManager.element.addEventListener("scroll",this.blurEvent),this.subscribe("cell-editing",this.blurEvent),document.body.addEventListener("click",this.blurEvent),document.body.addEventListener("contextmenu",this.blurEvent),document.body.addEventListener("mousedown",this.blurEvent),window.addEventListener("resize",this.blurEvent),document.body.addEventListener("keydown",this.escEvent),this.blurEventsBound=!0)},100),this.blurCallback=e),this}_escapeCheck(e){e.keyCode==27&&this.hide()}blockHide(){this.hideable=!1}restoreHide(){this.hideable=!0}hide(e=!1){return this.visible&&this.hideable&&(this.blurable&&this.blurEventsBound&&(document.body.removeEventListener("keydown",this.escEvent),document.body.removeEventListener("click",this.blurEvent),document.body.removeEventListener("contextmenu",this.blurEvent),document.body.removeEventListener("mousedown",this.blurEvent),window.removeEventListener("resize",this.blurEvent),this.table.rowManager.element.removeEventListener("scroll",this.blurEvent),this.unsubscribe("cell-editing",this.blurEvent),this.blurEventsBound=!1),this.childPopup&&this.childPopup.hide(),this.parent&&(this.parent.childPopup=null),this.element.parentNode&&this.element.parentNode.removeChild(this.element),this.visible=!1,this.blurCallback&&!e&&this.blurCallback(),this.unsubscribe("table-destroy",this.destroyBinding)),this}child(e){return this.childPopup&&this.childPopup.hide(),this.childPopup=new kTe(this.table,e,this),this.childPopup}},Wn=class extends dc{constructor(e,i){super(e),this._handler=null}initialize(){}registerTableOption(e,i){this.table.optionsList.register(e,i)}registerColumnOption(e,i){this.table.columnManager.optionsList.register(e,i)}registerTableFunction(e,i){typeof this.table[e]>"u"?this.table[e]=(...n)=>(this.table.initGuard(e),i(...n)):console.warn("Unable to bind table function, name already in use",e)}registerComponentFunction(e,i,n){return this.table.componentFunctionBinder.bind(e,i,n)}registerDataHandler(e,i){this.table.rowManager.registerDataPipelineHandler(e,i),this._handler=e}registerDisplayHandler(e,i){this.table.rowManager.registerDisplayPipelineHandler(e,i),this._handler=e}displayRows(e){var i=this.table.rowManager.displayRows.length-1,n;if(this._handler&&(n=this.table.rowManager.displayPipeline.findIndex(r=>r.handler===this._handler),n>-1&&(i=n)),e&&(i=i+e),this._handler)return i>-1?this.table.rowManager.getDisplayRows(i):this.activeRows()}activeRows(){return this.table.rowManager.activeRows}refreshData(e,i){i||(i=this._handler),i&&this.table.rowManager.refreshActiveData(i,!1,e)}footerAppend(e){return this.table.footerManager.append(e)}footerPrepend(e){return this.table.footerManager.prepend(e)}footerRemove(e){return this.table.footerManager.remove(e)}popup(e,i){return new yKe(this.table,e,i)}alert(e,i){return this.table.alertManager.alert(e,i)}clearAlert(){return this.table.alertManager.clear()}};var bKe={rownum:function(t,e,i,n,r,a){return a.getPosition()}};const x0=class x0 extends Wn{constructor(e){super(e),this.allowedTypes=["","data","download","clipboard","print","htmlOutput"],this.registerColumnOption("accessor"),this.registerColumnOption("accessorParams"),this.registerColumnOption("accessorData"),this.registerColumnOption("accessorDataParams"),this.registerColumnOption("accessorDownload"),this.registerColumnOption("accessorDownloadParams"),this.registerColumnOption("accessorClipboard"),this.registerColumnOption("accessorClipboardParams"),this.registerColumnOption("accessorPrint"),this.registerColumnOption("accessorPrintParams"),this.registerColumnOption("accessorHtmlOutput"),this.registerColumnOption("accessorHtmlOutputParams")}initialize(){this.subscribe("column-layout",this.initializeColumn.bind(this)),this.subscribe("row-data-retrieve",this.transformRow.bind(this))}initializeColumn(e){var i=!1,n={};this.allowedTypes.forEach(r=>{var a="accessor"+(r.charAt(0).toUpperCase()+r.slice(1)),o;e.definition[a]&&(o=this.lookupAccessor(e.definition[a]),o&&(i=!0,n[a]={accessor:o,params:e.definition[a+"Params"]||{}}))}),i&&(e.modules.accessor=n)}lookupAccessor(e){var i=!1;switch(typeof e){case"string":x0.accessors[e]?i=x0.accessors[e]:console.warn("Accessor Error - No such accessor found, ignoring: ",e);break;case"function":i=e;break}return i}transformRow(e,i){var n="accessor"+(i.charAt(0).toUpperCase()+i.slice(1)),r=e.getComponent(),a=io.deepClone(e.data||{});return this.table.columnManager.traverse(function(o){var s,l,c,u;o.modules.accessor&&(l=o.modules.accessor[n]||o.modules.accessor.accessor||!1,l&&(s=o.getFieldValue(a),s!="undefined"&&(u=o.getComponent(),c=typeof l.params=="function"?l.params(s,a,i,u,r):l.params,o.setFieldValue(a,l.accessor(s,a,i,c,u,r)))))}),a}};Je(x0,"moduleName","accessor"),Je(x0,"accessors",bKe);let qj=x0;var IKe={method:"GET"};function Wj(t,e){var i=[];if(e=e||"",Array.isArray(t))t.forEach((r,a)=>{i=i.concat(Wj(r,e?e+"["+a+"]":a))});else if(typeof t=="object")for(var n in t)i=i.concat(Wj(t[n],e?e+"["+n+"]":n));else i.push({key:e,value:t});return i}function wKe(t){var e=Wj(t),i=[];return e.forEach(function(n){i.push(encodeURIComponent(n.key)+"="+encodeURIComponent(n.value))}),i.join("&")}function xTe(t,e,i){return t&&i&&Object.keys(i).length&&(!e.method||e.method.toLowerCase()=="get")&&(e.method="get",t+=(t.includes("?")?"&":"?")+wKe(i)),t}function SKe(t,e,i){var n;return new Promise((r,a)=>{if(t=this.urlGenerator.call(this.table,t,e,i),e.method.toUpperCase()!="GET")if(n=typeof this.table.options.ajaxContentType=="object"?this.table.options.ajaxContentType:this.contentTypeFormatters[this.table.options.ajaxContentType],n){for(var o in n.headers)e.headers||(e.headers={}),typeof e.headers[o]>"u"&&(e.headers[o]=n.headers[o]);e.body=n.body.call(this,t,e,i)}else console.warn("Ajax Error - Invalid ajaxContentType value:",this.table.options.ajaxContentType);t?(typeof e.headers>"u"&&(e.headers={}),typeof e.headers.Accept>"u"&&(e.headers.Accept="application/json"),typeof e.headers["X-Requested-With"]>"u"&&(e.headers["X-Requested-With"]="XMLHttpRequest"),typeof e.mode>"u"&&(e.mode="cors"),e.mode=="cors"?(typeof e.headers.Origin>"u"&&(e.headers.Origin=window.location.origin),typeof e.credentials>"u"&&(e.credentials="same-origin")):typeof e.credentials>"u"&&(e.credentials="include"),fetch(t,e).then(s=>{s.ok?s.json().then(l=>{r(l)}).catch(l=>{a(l),console.warn("Ajax Load Error - Invalid JSON returned",l)}):(console.error("Ajax Load Error - Connection Error: "+s.status,s.statusText),a(s))}).catch(s=>{console.error("Ajax Load Error - Connection Error: ",s),a(s)})):(console.warn("Ajax Load Error - No URL Set"),r([]))})}function Kj(t,e){var i=[];if(e=e||"",Array.isArray(t))t.forEach((r,a)=>{i=i.concat(Kj(r,e?e+"["+a+"]":a))});else if(typeof t=="object")for(var n in t)i=i.concat(Kj(t[n],e?e+"["+n+"]":n));else i.push({key:e,value:t});return i}var TKe={json:{headers:{"Content-Type":"application/json"},body:function(t,e,i){return JSON.stringify(i)}},form:{headers:{},body:function(t,e,i){var n=Kj(i),r=new FormData;return n.forEach(function(a){r.append(a.key,a.value)}),r}}};const Vp=class Vp extends Wn{constructor(e){super(e),this.config={},this.url="",this.urlGenerator=!1,this.params=!1,this.loaderPromise=!1,this.registerTableOption("ajaxURL",!1),this.registerTableOption("ajaxURLGenerator",!1),this.registerTableOption("ajaxParams",{}),this.registerTableOption("ajaxConfig","get"),this.registerTableOption("ajaxContentType","form"),this.registerTableOption("ajaxRequestFunc",!1),this.registerTableOption("ajaxRequesting",function(){}),this.registerTableOption("ajaxResponse",!1),this.contentTypeFormatters=Vp.contentTypeFormatters}initialize(){this.loaderPromise=this.table.options.ajaxRequestFunc||Vp.defaultLoaderPromise,this.urlGenerator=this.table.options.ajaxURLGenerator||Vp.defaultURLGenerator,this.table.options.ajaxURL&&this.setUrl(this.table.options.ajaxURL),this.setDefaultConfig(this.table.options.ajaxConfig),this.registerTableFunction("getAjaxUrl",this.getUrl.bind(this)),this.subscribe("data-loading",this.requestDataCheck.bind(this)),this.subscribe("data-params",this.requestParams.bind(this)),this.subscribe("data-load",this.requestData.bind(this))}requestParams(e,i,n,r){var a=this.table.options.ajaxParams;return a&&(typeof a=="function"&&(a=a.call(this.table)),r=Object.assign(Object.assign({},a),r)),r}requestDataCheck(e,i,n,r){return!!(!e&&this.url||typeof e=="string")}requestData(e,i,n,r,a){var o;return!a&&this.requestDataCheck(e)?(e&&this.setUrl(e),o=this.generateConfig(n),this.sendRequest(this.url,i,o)):a}setDefaultConfig(e={}){this.config=Object.assign({},Vp.defaultConfig),typeof e=="string"?this.config.method=e:Object.assign(this.config,e)}generateConfig(e={}){var i=Object.assign({},this.config);return typeof e=="string"?i.method=e:Object.assign(i,e),i}setUrl(e){this.url=e}getUrl(){return this.url}sendRequest(e,i,n){return this.table.options.ajaxRequesting.call(this.table,e,i)!==!1?this.loaderPromise(e,n,i).then(r=>(this.table.options.ajaxResponse&&(r=this.table.options.ajaxResponse.call(this.table,e,i,r)),r)):Promise.reject()}};Je(Vp,"moduleName","ajax"),Je(Vp,"defaultConfig",IKe),Je(Vp,"defaultURLGenerator",xTe),Je(Vp,"defaultLoaderPromise",SKe),Je(Vp,"contentTypeFormatters",TKe);let Yj=Vp;var UKe={replace:function(t){return this.table.setData(t)},update:function(t){return this.table.updateOrAddData(t)},insert:function(t){return this.table.addData(t)}},DKe={table:function(t){var e=[],i=!0,n=this.table.columnManager.columns,r=[],a=[];return t=t.split(`
`),t.forEach(function(o){e.push(o.split("	"))}),e.length&&!(e.length===1&&e[0].length<2)?(e[0].forEach(function(o){var s=n.find(function(l){return o&&l.definition.title&&o.trim()&&l.definition.title.trim()===o.trim()});s?r.push(s):i=!1}),i||(i=!0,r=[],e[0].forEach(function(o){var s=n.find(function(l){return o&&l.field&&o.trim()&&l.field.trim()===o.trim()});s?r.push(s):i=!1}),i||(r=this.table.columnManager.columnsByIndex)),i&&e.shift(),e.forEach(function(o){var s={};o.forEach(function(l,c){r[c]&&(s[r[c].field]=l)}),a.push(s)}),a):!1}},EKe={copyToClipboard:["ctrl + 67","meta + 67"]},CKe={copyToClipboard:function(t){this.table.modules.edit.currentCell||this.table.modExists("clipboard",!0)&&this.table.modules.clipboard.copy(!1,!0)}},PKe={keybindings:{bindings:EKe,actions:CKe}},ef;let RKe=(ef=class extends Wn{constructor(e){super(e),this.mode=!0,this.pasteParser=function(){},this.pasteAction=function(){},this.customSelection=!1,this.rowRange=!1,this.blocked=!0,this.registerTableOption("clipboard",!1),this.registerTableOption("clipboardCopyStyled",!0),this.registerTableOption("clipboardCopyConfig",!1),this.registerTableOption("clipboardCopyFormatter",!1),this.registerTableOption("clipboardCopyRowRange","active"),this.registerTableOption("clipboardPasteParser","table"),this.registerTableOption("clipboardPasteAction","insert"),this.registerColumnOption("clipboard"),this.registerColumnOption("titleClipboard")}initialize(){this.mode=this.table.options.clipboard,this.rowRange=this.table.options.clipboardCopyRowRange,(this.mode===!0||this.mode==="copy")&&this.table.element.addEventListener("copy",e=>{var i,n,r;this.blocked||(e.preventDefault(),this.customSelection?(i=this.customSelection,this.table.options.clipboardCopyFormatter&&(i=this.table.options.clipboardCopyFormatter("plain",i))):(r=this.table.modules.export.generateExportList(this.table.options.clipboardCopyConfig,this.table.options.clipboardCopyStyled,this.rowRange,"clipboard"),n=this.table.modules.export.generateHTMLTable(r),i=n?this.generatePlainContent(r):"",this.table.options.clipboardCopyFormatter&&(i=this.table.options.clipboardCopyFormatter("plain",i),n=this.table.options.clipboardCopyFormatter("html",n))),window.clipboardData&&window.clipboardData.setData?window.clipboardData.setData("Text",i):e.clipboardData&&e.clipboardData.setData?(e.clipboardData.setData("text/plain",i),n&&e.clipboardData.setData("text/html",n)):e.originalEvent&&e.originalEvent.clipboardData.setData&&(e.originalEvent.clipboardData.setData("text/plain",i),n&&e.originalEvent.clipboardData.setData("text/html",n)),this.dispatchExternal("clipboardCopied",i,n),this.reset())}),(this.mode===!0||this.mode==="paste")&&this.table.element.addEventListener("paste",e=>{this.paste(e)}),this.setPasteParser(this.table.options.clipboardPasteParser),this.setPasteAction(this.table.options.clipboardPasteAction),this.registerTableFunction("copyToClipboard",this.copy.bind(this))}reset(){this.blocked=!0,this.customSelection=!1}generatePlainContent(e){var i=[];return e.forEach(n=>{var r=[];n.columns.forEach(a=>{var o="";if(a)if(n.type==="group"&&(a.value=a.component.getKey()),a.value===null)o="";else switch(typeof a.value){case"object":o=JSON.stringify(a.value);break;case"undefined":o="";break;default:o=a.value}r.push(o)}),i.push(r.join("	"))}),i.join(`
`)}copy(e,i){var n,r;this.blocked=!1,this.customSelection=!1,(this.mode===!0||this.mode==="copy")&&(this.rowRange=e||this.table.options.clipboardCopyRowRange,typeof window.getSelection<"u"&&typeof document.createRange<"u"?(e=document.createRange(),e.selectNodeContents(this.table.element),n=window.getSelection(),n.toString()&&i&&(this.customSelection=n.toString()),n.removeAllRanges(),n.addRange(e)):typeof document.selection<"u"&&typeof document.body.createTextRange<"u"&&(r=document.body.createTextRange(),r.moveToElementText(this.table.element),r.select()),document.execCommand("copy"),n&&n.removeAllRanges())}setPasteAction(e){switch(typeof e){case"string":this.pasteAction=ef.pasteActions[e],this.pasteAction||console.warn("Clipboard Error - No such paste action found:",e);break;case"function":this.pasteAction=e;break}}setPasteParser(e){switch(typeof e){case"string":this.pasteParser=ef.pasteParsers[e],this.pasteParser||console.warn("Clipboard Error - No such paste parser found:",e);break;case"function":this.pasteParser=e;break}}paste(e){var i,n,r;this.checkPasteOrigin(e)&&(i=this.getPasteData(e),n=this.pasteParser.call(this,i),n?(e.preventDefault(),this.table.modExists("mutator")&&(n=this.mutateData(n)),r=this.pasteAction.call(this,n),this.dispatchExternal("clipboardPasted",i,n,r)):this.dispatchExternal("clipboardPasteError",i))}mutateData(e){var i=[];return Array.isArray(e)?e.forEach(n=>{i.push(this.table.modules.mutator.transformRow(n,"clipboard"))}):i=e,i}checkPasteOrigin(e){var i=!0,n=this.confirm("clipboard-paste",[e]);return(n||!["DIV","SPAN"].includes(e.target.tagName))&&(i=!1),i}getPasteData(e){var i;return window.clipboardData&&window.clipboardData.getData?i=window.clipboardData.getData("Text"):e.clipboardData&&e.clipboardData.getData?i=e.clipboardData.getData("text/plain"):e.originalEvent&&e.originalEvent.clipboardData.getData&&(i=e.originalEvent.clipboardData.getData("text/plain")),i}},Je(ef,"moduleName","clipboard"),Je(ef,"moduleExtensions",PKe),Je(ef,"pasteActions",UKe),Je(ef,"pasteParsers",DKe),ef);class MKe{constructor(e){return this._row=e,new Proxy(this,{get:function(i,n,r){return typeof i[n]<"u"?i[n]:i._row.table.componentFunctionBinder.handle("row",i._row,n)}})}getData(e){return this._row.getData(e)}getElement(){return this._row.getElement()}getTable(){return this._row.table}getCells(){var e=[];return this._row.getCells().forEach(function(i){e.push(i.getComponent())}),e}getCell(e){var i=this._row.getCell(e);return i?i.getComponent():!1}_getSelf(){return this._row}}class OTe{constructor(e){return this._cell=e,new Proxy(this,{get:function(i,n,r){return typeof i[n]<"u"?i[n]:i._cell.table.componentFunctionBinder.handle("cell",i._cell,n)}})}getValue(){return this._cell.getValue()}getOldValue(){return this._cell.getOldValue()}getInitialValue(){return this._cell.initialValue}getElement(){return this._cell.getElement()}getRow(){return this._cell.row.getComponent()}getData(e){return this._cell.row.getData(e)}getType(){return"cell"}getField(){return this._cell.column.getField()}getColumn(){return this._cell.column.getComponent()}setValue(e,i){typeof i>"u"&&(i=!0),this._cell.setValue(e,i)}restoreOldValue(){this._cell.setValueActual(this._cell.getOldValue())}restoreInitialValue(){this._cell.setValueActual(this._cell.initialValue)}checkHeight(){this._cell.checkHeight()}getTable(){return this._cell.table}_getSelf(){return this._cell}}class ZR extends dc{constructor(e,i){super(e.table),this.table=e.table,this.column=e,this.row=i,this.element=null,this.value=null,this.initialValue,this.oldValue=null,this.modules={},this.height=null,this.width=null,this.minWidth=null,this.component=null,this.loaded=!1,this.build()}build(){this.generateElement(),this.setWidth(),this._configureCell(),this.setValueActual(this.column.getFieldValue(this.row.data)),this.initialValue=this.value}generateElement(){this.element=document.createElement("div"),this.element.className="tabulator-cell",this.element.setAttribute("role","gridcell"),this.column.isRowHeader&&this.element.classList.add("tabulator-row-header")}_configureCell(){var e=this.element,i=this.column.getField(),n={top:"flex-start",bottom:"flex-end",middle:"center"},r={left:"flex-start",right:"flex-end",center:"center"};if(e.style.textAlign=this.column.hozAlign,this.column.vertAlign&&(e.style.display="inline-flex",e.style.alignItems=n[this.column.vertAlign]||"",this.column.hozAlign&&(e.style.justifyContent=r[this.column.hozAlign]||"")),i&&e.setAttribute("tabulator-field",i),this.column.definition.cssClass){var a=this.column.definition.cssClass.split(" ");a.forEach(o=>{e.classList.add(o)})}this.dispatch("cell-init",this),this.column.visible||this.hide()}_generateContents(){var e;switch(e=this.chain("cell-format",this,null,()=>this.element.innerHTML=this.value),typeof e){case"object":if(e instanceof Node){for(;this.element.firstChild;)this.element.removeChild(this.element.firstChild);this.element.appendChild(e)}else this.element.innerHTML="",e!=null&&console.warn("Format Error - Formatter has returned a type of object, the only valid formatter object return is an instance of Node, the formatter returned:",e);break;case"undefined":this.element.innerHTML="";break;default:this.element.innerHTML=e}}cellRendered(){this.dispatch("cell-rendered",this)}getElement(e){return this.loaded||(this.loaded=!0,e||this.layoutElement()),this.element}getValue(){return this.value}getOldValue(){return this.oldValue}setValue(e,i,n){var r=this.setValueProcessData(e,i,n);r&&(this.dispatch("cell-value-updated",this),this.cellRendered(),this.column.definition.cellEdited&&this.column.definition.cellEdited.call(this.table,this.getComponent()),this.dispatchExternal("cellEdited",this.getComponent()),this.subscribedExternal("dataChanged")&&this.dispatchExternal("dataChanged",this.table.rowManager.getData()))}setValueProcessData(e,i,n){var r=!1;return(this.value!==e||n)&&(r=!0,i&&(e=this.chain("cell-value-changing",[this,e],null,e))),this.setValueActual(e),r&&this.dispatch("cell-value-changed",this),r}setValueActual(e){this.oldValue=this.value,this.value=e,this.dispatch("cell-value-save-before",this),this.column.setFieldValue(this.row.data,e),this.dispatch("cell-value-save-after",this),this.loaded&&this.layoutElement()}layoutElement(){this._generateContents(),this.dispatch("cell-layout",this)}setWidth(){this.width=this.column.width,this.element.style.width=this.column.widthStyled}clearWidth(){this.width="",this.element.style.width=""}getWidth(){return this.width||this.element.offsetWidth}setMinWidth(){this.minWidth=this.column.minWidth,this.element.style.minWidth=this.column.minWidthStyled}setMaxWidth(){this.maxWidth=this.column.maxWidth,this.element.style.maxWidth=this.column.maxWidthStyled}checkHeight(){this.row.reinitializeHeight()}clearHeight(){this.element.style.height="",this.height=null,this.dispatch("cell-height",this,"")}setHeight(){this.height=this.row.height,this.element.style.height=this.row.heightStyled,this.dispatch("cell-height",this,this.row.heightStyled)}getHeight(){return this.height||this.element.offsetHeight}show(){this.element.style.display=this.column.vertAlign?"inline-flex":""}hide(){this.element.style.display="none"}delete(){this.dispatch("cell-delete",this),!this.table.rowManager.redrawBlock&&this.element.parentNode&&this.element.parentNode.removeChild(this.element),this.element=!1,this.column.deleteCell(this),this.row.deleteCell(this),this.calcs={}}getIndex(){return this.row.getCellIndex(this)}getComponent(){return this.component||(this.component=new OTe(this)),this.component}}class LTe{constructor(e){return this._column=e,this.type="ColumnComponent",new Proxy(this,{get:function(i,n,r){return typeof i[n]<"u"?i[n]:i._column.table.componentFunctionBinder.handle("column",i._column,n)}})}getElement(){return this._column.getElement()}getDefinition(){return this._column.getDefinition()}getField(){return this._column.getField()}getTitleDownload(){return this._column.getTitleDownload()}getCells(){var e=[];return this._column.cells.forEach(function(i){e.push(i.getComponent())}),e}isVisible(){return this._column.visible}show(){this._column.isGroup?this._column.columns.forEach(function(e){e.show()}):this._column.show()}hide(){this._column.isGroup?this._column.columns.forEach(function(e){e.hide()}):this._column.hide()}toggle(){this._column.visible?this.hide():this.show()}delete(){return this._column.delete()}getSubColumns(){var e=[];return this._column.columns.length&&this._column.columns.forEach(function(i){e.push(i.getComponent())}),e}getParentColumn(){return this._column.getParentComponent()}_getSelf(){return this._column}scrollTo(e,i){return this._column.table.columnManager.scrollToColumn(this._column,e,i)}getTable(){return this._column.table}move(e,i){var n=this._column.table.columnManager.findColumn(e);n?this._column.table.columnManager.moveColumn(this._column,n,i):console.warn("Move Error - No matching column found:",n)}getNextColumn(){var e=this._column.nextColumn();return e?e.getComponent():!1}getPrevColumn(){var e=this._column.prevColumn();return e?e.getComponent():!1}updateDefinition(e){return this._column.updateDefinition(e)}getWidth(){return this._column.getWidth()}setWidth(e){var i;return e===!0?i=this._column.reinitializeWidth(!0):i=this._column.setWidth(e),this._column.table.columnManager.rerenderColumns(!0),i}}var FTe={title:void 0,field:void 0,columns:void 0,visible:void 0,hozAlign:void 0,vertAlign:void 0,width:void 0,minWidth:40,maxWidth:void 0,maxInitialWidth:void 0,cssClass:void 0,variableHeight:void 0,headerVertical:void 0,headerHozAlign:void 0,headerWordWrap:!1,editableTitle:void 0};const hb=class hb extends dc{constructor(e,i,n){super(i.table),this.definition=e,this.parent=i,this.type="column",this.columns=[],this.cells=[],this.isGroup=!1,this.isRowHeader=n,this.element=this.createElement(),this.contentElement=!1,this.titleHolderElement=!1,this.titleElement=!1,this.groupElement=this.createGroupElement(),this.hozAlign="",this.vertAlign="",this.field="",this.fieldStructure="",this.getFieldValue="",this.setFieldValue="",this.titleDownload=null,this.titleFormatterRendered=!1,this.mapDefinitions(),this.setField(this.definition.field),this.modules={},this.width=null,this.widthStyled="",this.maxWidth=null,this.maxWidthStyled="",this.maxInitialWidth=null,this.minWidth=null,this.minWidthStyled="",this.widthFixed=!1,this.visible=!0,this.component=null,this.definition.columns?(this.isGroup=!0,this.definition.columns.forEach((r,a)=>{var o=new hb(r,this);this.attachColumn(o)}),this.checkColumnVisibility()):i.registerColumnField(this),this._initialize()}createElement(){var e=document.createElement("div");switch(e.classList.add("tabulator-col"),e.setAttribute("role","columnheader"),e.setAttribute("aria-sort","none"),this.isRowHeader&&e.classList.add("tabulator-row-header"),this.table.options.columnHeaderVertAlign){case"middle":e.style.justifyContent="center";break;case"bottom":e.style.justifyContent="flex-end";break}return e}createGroupElement(){var e=document.createElement("div");return e.classList.add("tabulator-col-group-cols"),e}mapDefinitions(){var e=this.table.options.columnDefaults;if(e)for(let i in e)typeof this.definition[i]>"u"&&(this.definition[i]=e[i]);this.definition=this.table.columnManager.optionsList.generate(hb.defaultOptionList,this.definition)}checkDefinition(){Object.keys(this.definition).forEach(e=>{hb.defaultOptionList.indexOf(e)===-1&&console.warn("Invalid column definition option in '"+(this.field||this.definition.title)+"' column:",e)})}setField(e){this.field=e,this.fieldStructure=e?this.table.options.nestedFieldSeparator?e.split(this.table.options.nestedFieldSeparator):[e]:[],this.getFieldValue=this.fieldStructure.length>1?this._getNestedData:this._getFlatData,this.setFieldValue=this.fieldStructure.length>1?this._setNestedData:this._setFlatData}registerColumnPosition(e){this.parent.registerColumnPosition(e)}registerColumnField(e){this.parent.registerColumnField(e)}reRegisterPosition(){this.isGroup?this.columns.forEach(function(e){e.reRegisterPosition()}):this.registerColumnPosition(this)}_initialize(){for(var e=this.definition;this.element.firstChild;)this.element.removeChild(this.element.firstChild);e.headerVertical&&(this.element.classList.add("tabulator-col-vertical"),e.headerVertical==="flip"&&this.element.classList.add("tabulator-col-vertical-flip")),this.contentElement=this._buildColumnHeaderContent(),this.element.appendChild(this.contentElement),this.isGroup?this._buildGroupHeader():this._buildColumnHeader(),this.dispatch("column-init",this)}_buildColumnHeader(){var e=this.definition;if(this.dispatch("column-layout",this),typeof e.visible<"u"&&(e.visible?this.show(!0):this.hide(!0)),e.cssClass){var i=e.cssClass.split(" ");i.forEach(n=>{this.element.classList.add(n)})}e.field&&this.element.setAttribute("tabulator-field",e.field),this.setMinWidth(parseInt(e.minWidth)),e.maxInitialWidth&&(this.maxInitialWidth=parseInt(e.maxInitialWidth)),e.maxWidth&&this.setMaxWidth(parseInt(e.maxWidth)),this.reinitializeWidth(),this.hozAlign=this.definition.hozAlign,this.vertAlign=this.definition.vertAlign,this.titleElement.style.textAlign=this.definition.headerHozAlign}_buildColumnHeaderContent(){var e=document.createElement("div");return e.classList.add("tabulator-col-content"),this.titleHolderElement=document.createElement("div"),this.titleHolderElement.classList.add("tabulator-col-title-holder"),e.appendChild(this.titleHolderElement),this.titleElement=this._buildColumnHeaderTitle(),this.titleHolderElement.appendChild(this.titleElement),e}_buildColumnHeaderTitle(){var e=this.definition,i=document.createElement("div");if(i.classList.add("tabulator-col-title"),e.headerWordWrap&&i.classList.add("tabulator-col-title-wrap"),e.editableTitle){var n=document.createElement("input");n.classList.add("tabulator-title-editor"),n.addEventListener("click",r=>{r.stopPropagation(),n.focus()}),n.addEventListener("mousedown",r=>{r.stopPropagation()}),n.addEventListener("change",()=>{e.title=n.value,this.dispatchExternal("columnTitleChanged",this.getComponent())}),i.appendChild(n),e.field?this.langBind("columns|"+e.field,r=>{n.value=r||e.title||"&nbsp;"}):n.value=e.title||"&nbsp;"}else e.field?this.langBind("columns|"+e.field,r=>{this._formatColumnHeaderTitle(i,r||e.title||"&nbsp;")}):this._formatColumnHeaderTitle(i,e.title||"&nbsp;");return i}_formatColumnHeaderTitle(e,i){var n=this.chain("column-format",[this,i,e],null,()=>i);switch(typeof n){case"object":n instanceof Node?e.appendChild(n):(e.innerHTML="",console.warn("Format Error - Title formatter has returned a type of object, the only valid formatter object return is an instance of Node, the formatter returned:",n));break;case"undefined":e.innerHTML="";break;default:e.innerHTML=n}}_buildGroupHeader(){if(this.element.classList.add("tabulator-col-group"),this.element.setAttribute("role","columngroup"),this.element.setAttribute("aria-title",this.definition.title),this.definition.cssClass){var e=this.definition.cssClass.split(" ");e.forEach(i=>{this.element.classList.add(i)})}this.titleElement.style.textAlign=this.definition.headerHozAlign,this.element.appendChild(this.groupElement)}_getFlatData(e){return e[this.field]}_getNestedData(e){var i=e,n=this.fieldStructure,r=n.length,a;for(let o=0;o<r&&(i=i[n[o]],a=i,!!i);o++);return a}_setFlatData(e,i){this.field&&(e[this.field]=i)}_setNestedData(e,i){var n=e,r=this.fieldStructure,a=r.length;for(let o=0;o<a;o++)if(o==a-1)n[r[o]]=i;else{if(!n[r[o]])if(typeof i<"u")n[r[o]]={};else break;n=n[r[o]]}}attachColumn(e){this.groupElement?(this.columns.push(e),this.groupElement.appendChild(e.getElement()),e.columnRendered()):console.warn("Column Warning - Column being attached to another column instead of column group")}verticalAlign(e,i){var n=this.parent.isGroup?this.parent.getGroupElement().clientHeight:i||this.parent.getHeadersElement().clientHeight;this.element.style.height=n+"px",this.dispatch("column-height",this,this.element.style.height),this.isGroup&&(this.groupElement.style.minHeight=n-this.contentElement.offsetHeight+"px"),this.columns.forEach(function(r){r.verticalAlign(e)})}clearVerticalAlign(){this.element.style.paddingTop="",this.element.style.height="",this.element.style.minHeight="",this.groupElement.style.minHeight="",this.columns.forEach(function(e){e.clearVerticalAlign()}),this.dispatch("column-height",this,"")}getElement(){return this.element}getGroupElement(){return this.groupElement}getField(){return this.field}getTitleDownload(){return this.titleDownload}getFirstColumn(){return this.isGroup?this.columns.length?this.columns[0].getFirstColumn():!1:this}getLastColumn(){return this.isGroup?this.columns.length?this.columns[this.columns.length-1].getLastColumn():!1:this}getColumns(e){var i=[];return e?this.columns.forEach(n=>{i.push(n),i=i.concat(n.getColumns(!0))}):i=this.columns,i}getCells(){return this.cells}getTopColumn(){return this.parent.isGroup?this.parent.getTopColumn():this}getDefinition(e){var i=[];return this.isGroup&&e&&(this.columns.forEach(function(n){i.push(n.getDefinition(!0))}),this.definition.columns=i),this.definition}checkColumnVisibility(){var e=!1;this.columns.forEach(function(i){i.visible&&(e=!0)}),e?(this.show(),this.dispatchExternal("columnVisibilityChanged",this.getComponent(),!1)):this.hide()}show(e,i){this.visible||(this.visible=!0,this.element.style.display="",this.parent.isGroup&&this.parent.checkColumnVisibility(),this.cells.forEach(function(n){n.show()}),!this.isGroup&&this.width===null&&this.reinitializeWidth(),this.table.columnManager.verticalAlignHeaders(),this.dispatch("column-show",this,i),e||this.dispatchExternal("columnVisibilityChanged",this.getComponent(),!0),this.parent.isGroup&&this.parent.matchChildWidths(),this.silent||this.table.columnManager.rerenderColumns())}hide(e,i){this.visible&&(this.visible=!1,this.element.style.display="none",this.table.columnManager.verticalAlignHeaders(),this.parent.isGroup&&this.parent.checkColumnVisibility(),this.cells.forEach(function(n){n.hide()}),this.dispatch("column-hide",this,i),e||this.dispatchExternal("columnVisibilityChanged",this.getComponent(),!1),this.parent.isGroup&&this.parent.matchChildWidths(),this.silent||this.table.columnManager.rerenderColumns())}matchChildWidths(){var e=0;this.contentElement&&this.columns.length&&(this.columns.forEach(function(i){i.visible&&(e+=i.getWidth())}),this.contentElement.style.maxWidth=e-1+"px",this.parent.isGroup&&this.parent.matchChildWidths())}removeChild(e){var i=this.columns.indexOf(e);i>-1&&this.columns.splice(i,1),this.columns.length||this.delete()}setWidth(e){this.widthFixed=!0,this.setWidthActual(e)}setWidthActual(e){isNaN(e)&&(e=Math.floor(this.table.element.clientWidth/100*parseInt(e))),e=Math.max(this.minWidth,e),this.maxWidth&&(e=Math.min(this.maxWidth,e)),this.width=e,this.widthStyled=e?e+"px":"",this.element.style.width=this.widthStyled,this.isGroup||this.cells.forEach(function(i){i.setWidth()}),this.parent.isGroup&&this.parent.matchChildWidths(),this.dispatch("column-width",this),this.subscribedExternal("columnWidth")&&this.dispatchExternal("columnWidth",this.getComponent())}checkCellHeights(){var e=[];this.cells.forEach(function(i){i.row.heightInitialized&&(i.row.getElement().offsetParent!==null?(e.push(i.row),i.row.clearCellHeight()):i.row.heightInitialized=!1)}),e.forEach(function(i){i.calcHeight()}),e.forEach(function(i){i.setCellHeight()})}getWidth(){var e=0;return this.isGroup?this.columns.forEach(function(i){i.visible&&(e+=i.getWidth())}):e=this.width,e}getLeftOffset(){var e=this.element.offsetLeft;return this.parent.isGroup&&(e+=this.parent.getLeftOffset()),e}getHeight(){return Math.ceil(this.element.getBoundingClientRect().height)}setMinWidth(e){this.maxWidth&&e>this.maxWidth&&(e=this.maxWidth,console.warn("the minWidth ("+e+"px) for column '"+this.field+"' cannot be bigger that its maxWidth ("+this.maxWidthStyled+")")),this.minWidth=e,this.minWidthStyled=e?e+"px":"",this.element.style.minWidth=this.minWidthStyled,this.cells.forEach(function(i){i.setMinWidth()})}setMaxWidth(e){this.minWidth&&e<this.minWidth&&(e=this.minWidth,console.warn("the maxWidth ("+e+"px) for column '"+this.field+"' cannot be smaller that its minWidth ("+this.minWidthStyled+")")),this.maxWidth=e,this.maxWidthStyled=e?e+"px":"",this.element.style.maxWidth=this.maxWidthStyled,this.cells.forEach(function(i){i.setMaxWidth()})}delete(){return new Promise((e,i)=>{this.isGroup&&this.columns.forEach(function(r){r.delete()}),this.dispatch("column-delete",this);var n=this.cells.length;for(let r=0;r<n;r++)this.cells[0].delete();this.element.parentNode&&this.element.parentNode.removeChild(this.element),this.element=!1,this.contentElement=!1,this.titleElement=!1,this.groupElement=!1,this.parent.isGroup&&this.parent.removeChild(this),this.table.columnManager.deregisterColumn(this),this.table.columnManager.rerenderColumns(!0),this.dispatch("column-deleted",this),e()})}columnRendered(){this.titleFormatterRendered&&this.titleFormatterRendered(),this.dispatch("column-rendered",this)}generateCell(e){var i=new ZR(this,e);return this.cells.push(i),i}nextColumn(){var e=this.table.columnManager.findColumnIndex(this);return e>-1?this._nextVisibleColumn(e+1):!1}_nextVisibleColumn(e){var i=this.table.columnManager.getColumnByIndex(e);return!i||i.visible?i:this._nextVisibleColumn(e+1)}prevColumn(){var e=this.table.columnManager.findColumnIndex(this);return e>-1?this._prevVisibleColumn(e-1):!1}_prevVisibleColumn(e){var i=this.table.columnManager.getColumnByIndex(e);return!i||i.visible?i:this._prevVisibleColumn(e-1)}reinitializeWidth(e){this.widthFixed=!1,typeof this.definition.width<"u"&&!e&&this.setWidth(this.definition.width),this.dispatch("column-width-fit-before",this),this.fitToData(e),this.dispatch("column-width-fit-after",this)}fitToData(e){if(!this.isGroup){this.widthFixed||(this.element.style.width="",this.cells.forEach(r=>{r.clearWidth()}));var i=this.element.offsetWidth;if((!this.width||!this.widthFixed)&&(this.cells.forEach(r=>{var a=r.getWidth();a>i&&(i=a)}),i)){var n=i+1;this.maxInitialWidth&&!e&&(n=Math.min(n,this.maxInitialWidth)),this.setWidthActual(n)}}}updateDefinition(e){var i;return this.isGroup||this.parent.isGroup?(console.error("Column Update Error - The updateDefinition function is only available on ungrouped columns"),Promise.reject("Column Update Error - The updateDefinition function is only available on columns, not column groups")):(i=Object.assign({},this.getDefinition()),i=Object.assign(i,e),this.table.columnManager.addColumn(i,!1,this).then(n=>(i.field==this.field&&(this.field=!1),this.delete().then(()=>n.getComponent()))))}deleteCell(e){var i=this.cells.indexOf(e);i>-1&&this.cells.splice(i,1)}getComponent(){return this.component||(this.component=new LTe(this)),this.component}getPosition(){return this.table.columnManager.getVisibleColumnsByIndex().indexOf(this)+1}getParentComponent(){return this.parent instanceof hb?this.parent.getComponent():!1}};Je(hb,"defaultOptionList",FTe);let Gb=hb;class jF{constructor(e){return this._row=e,new Proxy(this,{get:function(i,n,r){return typeof i[n]<"u"?i[n]:i._row.table.componentFunctionBinder.handle("row",i._row,n)}})}getData(e){return this._row.getData(e)}getElement(){return this._row.getElement()}getCells(){var e=[];return this._row.getCells().forEach(function(i){e.push(i.getComponent())}),e}getCell(e){var i=this._row.getCell(e);return i?i.getComponent():!1}getIndex(){return this._row.getData("data")[this._row.table.options.index]}getPosition(){return this._row.getPosition()}watchPosition(e){return this._row.watchPosition(e)}delete(){return this._row.delete()}scrollTo(e,i){return this._row.table.rowManager.scrollToRow(this._row,e,i)}move(e,i){this._row.moveToRow(e,i)}update(e){return this._row.updateData(e)}normalizeHeight(){this._row.normalizeHeight(!0)}_getSelf(){return this._row}reformat(){return this._row.reinitialize()}getTable(){return this._row.table}getNextRow(){var e=this._row.nextRow();return e&&e.getComponent()}getPrevRow(){var e=this._row.prevRow();return e&&e.getComponent()}}class wc extends dc{constructor(e,i,n="row"){super(i.table),this.parent=i,this.data={},this.type=n,this.element=!1,this.modules={},this.cells=[],this.height=0,this.heightStyled="",this.manualHeight=!1,this.outerHeight=0,this.initialized=!1,this.heightInitialized=!1,this.position=0,this.positionWatchers=[],this.component=null,this.created=!1,this.setData(e)}create(){this.created||(this.created=!0,this.generateElement())}createElement(){var e=document.createElement("div");e.classList.add("tabulator-row"),e.setAttribute("role","row"),this.element=e}getElement(){return this.create(),this.element}detachElement(){this.element&&this.element.parentNode&&this.element.parentNode.removeChild(this.element)}generateElement(){this.createElement(),this.dispatch("row-init",this)}generateCells(){this.cells=this.table.columnManager.generateCells(this)}initialize(e,i){if(this.create(),!this.initialized||e){for(this.deleteCells();this.element.firstChild;)this.element.removeChild(this.element.firstChild);this.dispatch("row-layout-before",this),this.generateCells(),this.initialized=!0,this.table.columnManager.renderer.renderRowCells(this,i),e&&this.normalizeHeight(),this.dispatch("row-layout",this),this.table.options.rowFormatter&&this.table.options.rowFormatter(this.getComponent()),this.dispatch("row-layout-after",this)}else this.table.columnManager.renderer.rerenderRowCells(this,i)}rendered(){this.cells.forEach(e=>{e.cellRendered()})}reinitializeHeight(){this.heightInitialized=!1,this.element&&this.element.offsetParent!==null&&this.normalizeHeight(!0)}deinitialize(){this.initialized=!1}deinitializeHeight(){this.heightInitialized=!1}reinitialize(e){this.initialized=!1,this.heightInitialized=!1,this.manualHeight||(this.height=0,this.heightStyled=""),this.element&&this.element.offsetParent!==null&&this.initialize(!0),this.dispatch("row-relayout",this)}calcHeight(e){var i=0,n=0;this.table.options.rowHeight?this.height=this.table.options.rowHeight:(n=this.calcMinHeight(),i=this.calcMaxHeight(),e?this.height=Math.max(i,n):this.height=this.manualHeight?this.height:Math.max(i,n)),this.heightStyled=this.height?this.height+"px":"",this.outerHeight=this.element.offsetHeight}calcMinHeight(){return this.table.options.resizableRows?this.element.clientHeight:0}calcMaxHeight(){var e=0;return this.cells.forEach(function(i){var n=i.getHeight();n>e&&(e=n)}),e}setCellHeight(){this.cells.forEach(function(e){e.setHeight()}),this.heightInitialized=!0}clearCellHeight(){this.cells.forEach(function(e){e.clearHeight()})}normalizeHeight(e){e&&!this.table.options.rowHeight&&this.clearCellHeight(),this.calcHeight(e),this.setCellHeight()}setHeight(e,i){(this.height!=e||i)&&(this.manualHeight=!0,this.height=e,this.heightStyled=e?e+"px":"",this.setCellHeight(),this.outerHeight=this.element.offsetHeight,this.subscribedExternal("rowHeight")&&this.dispatchExternal("rowHeight",this.getComponent()))}getHeight(){return this.outerHeight}getWidth(){return this.element.offsetWidth}deleteCell(e){var i=this.cells.indexOf(e);i>-1&&this.cells.splice(i,1)}setData(e){this.data=this.chain("row-data-init-before",[this,e],void 0,e),this.dispatch("row-data-init-after",this)}updateData(e){var i=this.element&&io.elVisible(this.element),n={},r;return new Promise((a,o)=>{typeof e=="string"&&(e=JSON.parse(e)),this.dispatch("row-data-save-before",this),this.subscribed("row-data-changing")&&(n=Object.assign(n,this.data),n=Object.assign(n,e)),r=this.chain("row-data-changing",[this,n,e],null,e);for(let s in r)this.data[s]=r[s];this.dispatch("row-data-save-after",this);for(let s in e)this.table.columnManager.getColumnsByFieldRoot(s).forEach(c=>{let u=this.getCell(c.getField());if(u){let d=c.getFieldValue(r);u.getValue()!==d&&(u.setValueProcessData(d),i&&u.cellRendered())}});i?(this.normalizeHeight(!0),this.table.options.rowFormatter&&this.table.options.rowFormatter(this.getComponent())):(this.initialized=!1,this.height=0,this.heightStyled=""),this.dispatch("row-data-changed",this,i,e),this.dispatchExternal("rowUpdated",this.getComponent()),this.subscribedExternal("dataChanged")&&this.dispatchExternal("dataChanged",this.table.rowManager.getData()),a()})}getData(e){return e?this.chain("row-data-retrieve",[this,e],null,this.data):this.data}getCell(e){var i=!1;return e=this.table.columnManager.findColumn(e),!this.initialized&&this.cells.length===0&&this.generateCells(),i=this.cells.find(function(n){return n.column===e}),i}getCellIndex(e){return this.cells.findIndex(function(i){return i===e})}findCell(e){return this.cells.find(i=>i.element===e)}getCells(){return!this.initialized&&this.cells.length===0&&this.generateCells(),this.cells}nextRow(){var e=this.table.rowManager.nextDisplayRow(this,!0);return e||!1}prevRow(){var e=this.table.rowManager.prevDisplayRow(this,!0);return e||!1}moveToRow(e,i){var n=this.table.rowManager.findRow(e);n?(this.table.rowManager.moveRowActual(this,n,!i),this.table.rowManager.refreshActiveData("display",!1,!0)):console.warn("Move Error - No matching row found:",e)}delete(){return this.dispatch("row-delete",this),this.deleteActual(),Promise.resolve()}deleteActual(e){this.detachModules(),this.table.rowManager.deleteRow(this,e),this.deleteCells(),this.initialized=!1,this.heightInitialized=!1,this.element=!1,this.dispatch("row-deleted",this)}detachModules(){this.dispatch("row-deleting",this)}deleteCells(){var e=this.cells.length;for(let i=0;i<e;i++)this.cells[0].delete()}wipe(){if(this.detachModules(),this.deleteCells(),this.element){for(;this.element.firstChild;)this.element.removeChild(this.element.firstChild);this.element.parentNode&&this.element.parentNode.removeChild(this.element)}this.element=!1,this.modules={}}isDisplayed(){return this.table.rowManager.getDisplayRows().includes(this)}getPosition(){return this.isDisplayed()?this.position:!1}setPosition(e){e!=this.position&&(this.position=e,this.positionWatchers.forEach(i=>{i(this.position)}))}watchPosition(e){this.positionWatchers.push(e),e(this.position)}getGroup(){return this.modules.group||!1}getComponent(){return this.component||(this.component=new jF(this)),this.component}}var NKe={avg:function(t,e,i){var n=0,r=typeof i.precision<"u"?i.precision:2;return t.length&&(n=t.reduce(function(a,o){return Number(a)+Number(o)}),n=n/t.length,n=r!==!1?n.toFixed(r):n),parseFloat(n).toString()},max:function(t,e,i){var n=null,r=typeof i.precision<"u"?i.precision:!1;return t.forEach(function(a){a=Number(a),(a>n||n===null)&&(n=a)}),n!==null?r!==!1?n.toFixed(r):n:""},min:function(t,e,i){var n=null,r=typeof i.precision<"u"?i.precision:!1;return t.forEach(function(a){a=Number(a),(a<n||n===null)&&(n=a)}),n!==null?r!==!1?n.toFixed(r):n:""},sum:function(t,e,i){var n=0,r=typeof i.precision<"u"?i.precision:!1;return t.length&&t.forEach(function(a){a=Number(a),n+=isNaN(a)?0:Number(a)}),r!==!1?n.toFixed(r):n},concat:function(t,e,i){var n=0;return t.length&&(n=t.reduce(function(r,a){return String(r)+String(a)})),n},count:function(t,e,i){var n=0;return t.length&&t.forEach(function(r){r&&n++}),n},unique:function(t,e,i){var n=t.filter((r,a)=>(t||r===0)&&t.indexOf(r)===a);return n.length}};const vv=class vv extends Wn{constructor(e){super(e),this.topCalcs=[],this.botCalcs=[],this.genColumn=!1,this.topElement=this.createElement(),this.botElement=this.createElement(),this.topRow=!1,this.botRow=!1,this.topInitialized=!1,this.botInitialized=!1,this.blocked=!1,this.recalcAfterBlock=!1,this.registerTableOption("columnCalcs",!0),this.registerColumnOption("topCalc"),this.registerColumnOption("topCalcParams"),this.registerColumnOption("topCalcFormatter"),this.registerColumnOption("topCalcFormatterParams"),this.registerColumnOption("bottomCalc"),this.registerColumnOption("bottomCalcParams"),this.registerColumnOption("bottomCalcFormatter"),this.registerColumnOption("bottomCalcFormatterParams")}createElement(){var e=document.createElement("div");return e.classList.add("tabulator-calcs-holder"),e}initialize(){this.genColumn=new Gb({field:"value"},this),this.subscribe("cell-value-changed",this.cellValueChanged.bind(this)),this.subscribe("column-init",this.initializeColumnCheck.bind(this)),this.subscribe("row-deleted",this.rowsUpdated.bind(this)),this.subscribe("scroll-horizontal",this.scrollHorizontal.bind(this)),this.subscribe("row-added",this.rowsUpdated.bind(this)),this.subscribe("column-moved",this.recalcActiveRows.bind(this)),this.subscribe("column-add",this.recalcActiveRows.bind(this)),this.subscribe("data-refreshed",this.recalcActiveRowsRefresh.bind(this)),this.subscribe("table-redraw",this.tableRedraw.bind(this)),this.subscribe("rows-visible",this.visibleRows.bind(this)),this.subscribe("scrollbar-vertical",this.adjustForScrollbar.bind(this)),this.subscribe("redraw-blocked",this.blockRedraw.bind(this)),this.subscribe("redraw-restored",this.restoreRedraw.bind(this)),this.subscribe("table-redrawing",this.resizeHolderWidth.bind(this)),this.subscribe("column-resized",this.resizeHolderWidth.bind(this)),this.subscribe("column-show",this.resizeHolderWidth.bind(this)),this.subscribe("column-hide",this.resizeHolderWidth.bind(this)),this.registerTableFunction("getCalcResults",this.getResults.bind(this)),this.registerTableFunction("recalc",this.userRecalc.bind(this)),this.resizeHolderWidth()}resizeHolderWidth(){this.topElement.style.minWidth=this.table.columnManager.headersElement.offsetWidth+"px"}tableRedraw(e){this.recalc(this.table.rowManager.activeRows),e&&this.redraw()}blockRedraw(){this.blocked=!0,this.recalcAfterBlock=!1}restoreRedraw(){this.blocked=!1,this.recalcAfterBlock&&(this.recalcAfterBlock=!1,this.recalcActiveRowsRefresh())}userRecalc(){this.recalc(this.table.rowManager.activeRows)}blockCheck(){return this.blocked&&(this.recalcAfterBlock=!0),this.blocked}visibleRows(e,i){return this.topRow&&i.unshift(this.topRow),this.botRow&&i.push(this.botRow),i}rowsUpdated(e){this.table.options.groupBy?this.recalcRowGroup(e):this.recalcActiveRows()}recalcActiveRowsRefresh(){this.table.options.groupBy&&this.table.options.dataTreeStartExpanded&&this.table.options.dataTree?this.recalcAll():this.recalcActiveRows()}recalcActiveRows(){this.recalc(this.table.rowManager.activeRows)}cellValueChanged(e){(e.column.definition.topCalc||e.column.definition.bottomCalc)&&(this.table.options.groupBy?((this.table.options.columnCalcs=="table"||this.table.options.columnCalcs=="both")&&this.recalcActiveRows(),this.table.options.columnCalcs!="table"&&this.recalcRowGroup(e.row)):this.recalcActiveRows())}initializeColumnCheck(e){(e.definition.topCalc||e.definition.bottomCalc)&&this.initializeColumn(e)}initializeColumn(e){var i=e.definition,n={topCalcParams:i.topCalcParams||{},botCalcParams:i.bottomCalcParams||{}};if(i.topCalc){switch(typeof i.topCalc){case"string":vv.calculations[i.topCalc]?n.topCalc=vv.calculations[i.topCalc]:console.warn("Column Calc Error - No such calculation found, ignoring: ",i.topCalc);break;case"function":n.topCalc=i.topCalc;break}n.topCalc&&(e.modules.columnCalcs=n,this.topCalcs.push(e),this.table.options.columnCalcs!="group"&&this.initializeTopRow())}if(i.bottomCalc){switch(typeof i.bottomCalc){case"string":vv.calculations[i.bottomCalc]?n.botCalc=vv.calculations[i.bottomCalc]:console.warn("Column Calc Error - No such calculation found, ignoring: ",i.bottomCalc);break;case"function":n.botCalc=i.bottomCalc;break}n.botCalc&&(e.modules.columnCalcs=n,this.botCalcs.push(e),this.table.options.columnCalcs!="group"&&this.initializeBottomRow())}}registerColumnField(){}removeCalcs(){var e=!1;this.topInitialized&&(this.topInitialized=!1,this.topElement.parentNode.removeChild(this.topElement),e=!0),this.botInitialized&&(this.botInitialized=!1,this.footerRemove(this.botElement),e=!0),e&&this.table.rowManager.adjustTableSize()}reinitializeCalcs(){this.topCalcs.length&&this.initializeTopRow(),this.botCalcs.length&&this.initializeBottomRow()}initializeTopRow(){var e=document.createDocumentFragment();this.topInitialized||(e.appendChild(document.createElement("br")),e.appendChild(this.topElement),this.table.columnManager.getContentsElement().insertBefore(e,this.table.columnManager.headersElement.nextSibling),this.topInitialized=!0)}initializeBottomRow(){this.botInitialized||(this.footerPrepend(this.botElement),this.botInitialized=!0)}scrollHorizontal(e){this.botInitialized&&this.botRow&&(this.botElement.scrollLeft=e)}recalc(e){var i,n;if(!this.blockCheck()&&(this.topInitialized||this.botInitialized)){if(i=this.rowsToData(e),this.topInitialized){for(this.topRow&&this.topRow.deleteCells(),n=this.generateRow("top",i),this.topRow=n;this.topElement.firstChild;)this.topElement.removeChild(this.topElement.firstChild);this.topElement.appendChild(n.getElement()),n.initialize(!0)}if(this.botInitialized){for(this.botRow&&this.botRow.deleteCells(),n=this.generateRow("bottom",i),this.botRow=n;this.botElement.firstChild;)this.botElement.removeChild(this.botElement.firstChild);this.botElement.appendChild(n.getElement()),n.initialize(!0)}this.table.rowManager.adjustTableSize(),this.table.modExists("frozenColumns")&&this.table.modules.frozenColumns.layout()}}recalcRowGroup(e){this.recalcGroup(this.table.modules.groupRows.getRowGroup(e))}recalcAll(){if((this.topCalcs.length||this.botCalcs.length)&&(this.table.options.columnCalcs!=="group"&&this.recalcActiveRows(),this.table.options.groupBy&&this.table.options.columnCalcs!=="table")){var e=this.table.modules.groupRows.getChildGroups();e.forEach(i=>{this.recalcGroup(i)})}}recalcGroup(e){var i,n;this.blockCheck()||e&&e.calcs&&(e.calcs.bottom&&(i=this.rowsToData(e.rows),n=this.generateRowData("bottom",i),e.calcs.bottom.updateData(n),e.calcs.bottom.reinitialize()),e.calcs.top&&(i=this.rowsToData(e.rows),n=this.generateRowData("top",i),e.calcs.top.updateData(n),e.calcs.top.reinitialize()))}generateTopRow(e){return this.generateRow("top",this.rowsToData(e))}generateBottomRow(e){return this.generateRow("bottom",this.rowsToData(e))}rowsToData(e){var i=[],n=this.table.options.dataTree&&this.table.options.dataTreeChildColumnCalcs,r=this.table.modules.dataTree;return e.forEach(a=>{var o;i.push(a.getData()),n&&((o=a.modules.dataTree)!=null&&o.open)&&this.rowsToData(r.getFilteredTreeChildren(a)).forEach(s=>{i.push(a)})}),i}generateRow(e,i){var n=this.generateRowData(e,i),r;return this.table.modExists("mutator")&&this.table.modules.mutator.disable(),r=new wc(n,this,"calc"),this.table.modExists("mutator")&&this.table.modules.mutator.enable(),r.getElement().classList.add("tabulator-calcs","tabulator-calcs-"+e),r.component=!1,r.getComponent=()=>(r.component||(r.component=new MKe(r)),r.component),r.generateCells=()=>{var a=[];this.table.columnManager.columnsByIndex.forEach(o=>{this.genColumn.setField(o.getField()),this.genColumn.hozAlign=o.hozAlign,o.definition[e+"CalcFormatter"]&&this.table.modExists("format")?this.genColumn.modules.format={formatter:this.table.modules.format.getFormatter(o.definition[e+"CalcFormatter"]),params:o.definition[e+"CalcFormatterParams"]||{}}:this.genColumn.modules.format={formatter:this.table.modules.format.getFormatter("plaintext"),params:{}},this.genColumn.definition.cssClass=o.definition.cssClass;var s=new ZR(this.genColumn,r);s.getElement(),s.column=o,s.setWidth(),o.cells.push(s),a.push(s),o.visible||s.hide()}),r.cells=a},r}generateRowData(e,i){var n={},r=e=="top"?this.topCalcs:this.botCalcs,a=e=="top"?"topCalc":"botCalc",o,s;return r.forEach(function(l){var c=[];l.modules.columnCalcs&&l.modules.columnCalcs[a]&&(i.forEach(function(u){c.push(l.getFieldValue(u))}),s=a+"Params",o=typeof l.modules.columnCalcs[s]=="function"?l.modules.columnCalcs[s](c,i):l.modules.columnCalcs[s],l.setFieldValue(n,l.modules.columnCalcs[a](c,i,o)))}),n}hasTopCalcs(){return!!this.topCalcs.length}hasBottomCalcs(){return!!this.botCalcs.length}redraw(){this.topRow&&this.topRow.normalizeHeight(!0),this.botRow&&this.botRow.normalizeHeight(!0)}getResults(){var e={},i;return this.table.options.groupBy&&this.table.modExists("groupRows")?(i=this.table.modules.groupRows.getGroups(!0),i.forEach(n=>{e[n.getKey()]=this.getGroupResults(n)})):e={top:this.topRow?this.topRow.getData():{},bottom:this.botRow?this.botRow.getData():{}},e}getGroupResults(e){var i=e._getSelf(),n=e.getSubGroups(),r={},a={};return n.forEach(o=>{r[o.getKey()]=this.getGroupResults(o)}),a={top:i.calcs.top?i.calcs.top.getData():{},bottom:i.calcs.bottom?i.calcs.bottom.getData():{},groups:r},a}adjustForScrollbar(e){this.botRow&&(this.table.rtl?this.botElement.style.paddingLeft=e+"px":this.botElement.style.paddingRight=e+"px")}};Je(vv,"moduleName","columnCalcs"),Je(vv,"calculations",NKe);let Zj=vv;class BTe extends Wn{constructor(e){super(e),this.indent=10,this.field="",this.collapseEl=null,this.expandEl=null,this.branchEl=null,this.elementField=!1,this.startOpen=function(){},this.registerTableOption("dataTree",!1),this.registerTableOption("dataTreeFilter",!0),this.registerTableOption("dataTreeSort",!0),this.registerTableOption("dataTreeElementColumn",!1),this.registerTableOption("dataTreeBranchElement",!0),this.registerTableOption("dataTreeChildIndent",9),this.registerTableOption("dataTreeChildField","_children"),this.registerTableOption("dataTreeCollapseElement",!1),this.registerTableOption("dataTreeExpandElement",!1),this.registerTableOption("dataTreeStartExpanded",!1),this.registerTableOption("dataTreeChildColumnCalcs",!1),this.registerTableOption("dataTreeSelectPropagate",!1),this.registerComponentFunction("row","treeCollapse",this.collapseRow.bind(this)),this.registerComponentFunction("row","treeExpand",this.expandRow.bind(this)),this.registerComponentFunction("row","treeToggle",this.toggleRow.bind(this)),this.registerComponentFunction("row","getTreeParent",this.getTreeParent.bind(this)),this.registerComponentFunction("row","getTreeChildren",this.getRowChildren.bind(this)),this.registerComponentFunction("row","addTreeChild",this.addTreeChildRow.bind(this)),this.registerComponentFunction("row","isTreeExpanded",this.isRowExpanded.bind(this))}initialize(){if(this.table.options.dataTree){var e=null,i=this.table.options;switch(this.field=i.dataTreeChildField,this.indent=i.dataTreeChildIndent,this.options("movableRows")&&console.warn("The movableRows option is not available with dataTree enabled, moving of child rows could result in unpredictable behavior"),i.dataTreeBranchElement?i.dataTreeBranchElement===!0?(this.branchEl=document.createElement("div"),this.branchEl.classList.add("tabulator-data-tree-branch")):typeof i.dataTreeBranchElement=="string"?(e=document.createElement("div"),e.innerHTML=i.dataTreeBranchElement,this.branchEl=e.firstChild):this.branchEl=i.dataTreeBranchElement:(this.branchEl=document.createElement("div"),this.branchEl.classList.add("tabulator-data-tree-branch-empty")),i.dataTreeCollapseElement?typeof i.dataTreeCollapseElement=="string"?(e=document.createElement("div"),e.innerHTML=i.dataTreeCollapseElement,this.collapseEl=e.firstChild):this.collapseEl=i.dataTreeCollapseElement:(this.collapseEl=document.createElement("div"),this.collapseEl.classList.add("tabulator-data-tree-control"),this.collapseEl.tabIndex=0,this.collapseEl.innerHTML="<div class='tabulator-data-tree-control-collapse'></div>"),i.dataTreeExpandElement?typeof i.dataTreeExpandElement=="string"?(e=document.createElement("div"),e.innerHTML=i.dataTreeExpandElement,this.expandEl=e.firstChild):this.expandEl=i.dataTreeExpandElement:(this.expandEl=document.createElement("div"),this.expandEl.classList.add("tabulator-data-tree-control"),this.expandEl.tabIndex=0,this.expandEl.innerHTML="<div class='tabulator-data-tree-control-expand'></div>"),typeof i.dataTreeStartExpanded){case"boolean":this.startOpen=function(n,r){return i.dataTreeStartExpanded};break;case"function":this.startOpen=i.dataTreeStartExpanded;break;default:this.startOpen=function(n,r){return i.dataTreeStartExpanded[r]};break}this.subscribe("row-init",this.initializeRow.bind(this)),this.subscribe("row-layout-after",this.layoutRow.bind(this)),this.subscribe("row-deleted",this.rowDelete.bind(this),0),this.subscribe("row-data-changed",this.rowDataChanged.bind(this),10),this.subscribe("cell-value-updated",this.cellValueChanged.bind(this)),this.subscribe("edit-cancelled",this.cellValueChanged.bind(this)),this.subscribe("column-moving-rows",this.columnMoving.bind(this)),this.subscribe("table-built",this.initializeElementField.bind(this)),this.subscribe("table-redrawing",this.tableRedrawing.bind(this)),this.registerDisplayHandler(this.getRows.bind(this),30)}}tableRedrawing(e){var i;e&&(i=this.table.rowManager.getRows(),i.forEach(n=>{this.reinitializeRowChildren(n)}))}initializeElementField(){var e=this.table.columnManager.getFirstVisibleColumn();this.elementField=this.table.options.dataTreeElementColumn||(e?e.field:!1)}getRowChildren(e){return this.getTreeChildren(e,!0)}columnMoving(){var e=[];return this.table.rowManager.rows.forEach(i=>{e=e.concat(this.getTreeChildren(i,!1,!0))}),e}rowDataChanged(e,i,n){this.redrawNeeded(n)&&(this.initializeRow(e),i&&(this.layoutRow(e),this.refreshData(!0)))}cellValueChanged(e){var i=e.column.getField();i===this.elementField&&this.layoutRow(e.row)}initializeRow(e){var i=e.getData()[this.field],n=Array.isArray(i),r=n||!n&&typeof i=="object"&&i!==null;!r&&e.modules.dataTree&&e.modules.dataTree.branchEl&&e.modules.dataTree.branchEl.parentNode.removeChild(e.modules.dataTree.branchEl),!r&&e.modules.dataTree&&e.modules.dataTree.controlEl&&e.modules.dataTree.controlEl.parentNode.removeChild(e.modules.dataTree.controlEl),e.modules.dataTree={index:e.modules.dataTree?e.modules.dataTree.index:0,open:r?e.modules.dataTree?e.modules.dataTree.open:this.startOpen(e.getComponent(),0):!1,controlEl:e.modules.dataTree&&r?e.modules.dataTree.controlEl:!1,branchEl:e.modules.dataTree&&r?e.modules.dataTree.branchEl:!1,parent:e.modules.dataTree?e.modules.dataTree.parent:!1,children:r}}reinitializeRowChildren(e){var i=this.getTreeChildren(e,!1,!0);i.forEach(function(n){n.reinitialize(!0)})}layoutRow(e){var i=this.elementField?e.getCell(this.elementField):e.getCells()[0],n=i.getElement(),r=e.modules.dataTree;r.branchEl&&(r.branchEl.parentNode&&r.branchEl.parentNode.removeChild(r.branchEl),r.branchEl=!1),r.controlEl&&(r.controlEl.parentNode&&r.controlEl.parentNode.removeChild(r.controlEl),r.controlEl=!1),this.generateControlElement(e,n),e.getElement().classList.add("tabulator-tree-level-"+r.index),r.index&&(this.branchEl?(r.branchEl=this.branchEl.cloneNode(!0),n.insertBefore(r.branchEl,n.firstChild),this.table.rtl?r.branchEl.style.marginRight=(r.branchEl.offsetWidth+r.branchEl.style.marginLeft)*(r.index-1)+r.index*this.indent+"px":r.branchEl.style.marginLeft=(r.branchEl.offsetWidth+r.branchEl.style.marginRight)*(r.index-1)+r.index*this.indent+"px"):this.table.rtl?n.style.paddingRight=parseInt(window.getComputedStyle(n,null).getPropertyValue("padding-right"))+r.index*this.indent+"px":n.style.paddingLeft=parseInt(window.getComputedStyle(n,null).getPropertyValue("padding-left"))+r.index*this.indent+"px")}generateControlElement(e,i){var n=e.modules.dataTree,r=n.controlEl;i=i||e.getCells()[0].getElement(),n.children!==!1&&(n.open?(n.controlEl=this.collapseEl.cloneNode(!0),n.controlEl.addEventListener("click",a=>{a.stopPropagation(),this.collapseRow(e)})):(n.controlEl=this.expandEl.cloneNode(!0),n.controlEl.addEventListener("click",a=>{a.stopPropagation(),this.expandRow(e)})),n.controlEl.addEventListener("mousedown",a=>{a.stopPropagation()}),r&&r.parentNode===i?r.parentNode.replaceChild(n.controlEl,r):i.insertBefore(n.controlEl,i.firstChild))}getRows(e){var i=[];return e.forEach((n,r)=>{var a,o;i.push(n),n instanceof wc&&(n.create(),a=n.modules.dataTree,!a.index&&a.children!==!1&&(o=this.getChildren(n,!1,!0),o.forEach(s=>{s.create(),i.push(s)})))}),i}getChildren(e,i,n){var r=e.modules.dataTree,a=[],o=[];return r.children!==!1&&(r.open||i)&&(Array.isArray(r.children)||(r.children=this.generateChildren(e)),this.table.modExists("filter")&&this.table.options.dataTreeFilter?a=this.table.modules.filter.filter(r.children):a=r.children,this.table.modExists("sort")&&this.table.options.dataTreeSort&&this.table.modules.sort.sort(a,n),a.forEach(s=>{o.push(s);var l=this.getChildren(s,!1,!0);l.forEach(c=>{o.push(c)})})),o}generateChildren(e){var i=[],n=e.getData()[this.field];return Array.isArray(n)||(n=[n]),n.forEach(r=>{var a=new wc(r||{},this.table.rowManager);a.create(),a.modules.dataTree.index=e.modules.dataTree.index+1,a.modules.dataTree.parent=e,a.modules.dataTree.children&&(a.modules.dataTree.open=this.startOpen(a.getComponent(),a.modules.dataTree.index)),i.push(a)}),i}expandRow(e,i){var n=e.modules.dataTree;n.children!==!1&&(n.open=!0,e.reinitialize(),this.refreshData(!0),this.dispatchExternal("dataTreeRowExpanded",e.getComponent(),e.modules.dataTree.index))}collapseRow(e){var i=e.modules.dataTree;i.children!==!1&&(i.open=!1,e.reinitialize(),this.refreshData(!0),this.dispatchExternal("dataTreeRowCollapsed",e.getComponent(),e.modules.dataTree.index))}toggleRow(e){var i=e.modules.dataTree;i.children!==!1&&(i.open?this.collapseRow(e):this.expandRow(e))}isRowExpanded(e){return e.modules.dataTree.open}getTreeParent(e){return e.modules.dataTree.parent?e.modules.dataTree.parent.getComponent():!1}getTreeParentRoot(e){return e.modules.dataTree&&e.modules.dataTree.parent?this.getTreeParentRoot(e.modules.dataTree.parent):e}getFilteredTreeChildren(e){var i=e.modules.dataTree,n=[],r;return i.children&&(Array.isArray(i.children)||(i.children=this.generateChildren(e)),this.table.modExists("filter")&&this.table.options.dataTreeFilter?r=this.table.modules.filter.filter(i.children):r=i.children,r.forEach(a=>{a instanceof wc&&n.push(a)})),n}rowDelete(e){var i=e.modules.dataTree.parent,n;i&&(n=this.findChildIndex(e,i),n!==!1&&i.data[this.field].splice(n,1),i.data[this.field].length||delete i.data[this.field],this.initializeRow(i),this.layoutRow(i)),this.refreshData(!0)}addTreeChildRow(e,i,n,r){var a=!1;typeof i=="string"&&(i=JSON.parse(i)),Array.isArray(e.data[this.field])||(e.data[this.field]=[],e.modules.dataTree.open=this.startOpen(e.getComponent(),e.modules.dataTree.index)),typeof r<"u"&&(a=this.findChildIndex(r,e),a!==!1&&e.data[this.field].splice(n?a:a+1,0,i)),a===!1&&(n?e.data[this.field].unshift(i):e.data[this.field].push(i)),this.initializeRow(e),this.layoutRow(e),this.refreshData(!0)}findChildIndex(e,i){var n=!1;return typeof e=="object"?e instanceof wc?n=e.data:e instanceof jF?n=e._getSelf().data:typeof HTMLElement<"u"&&e instanceof HTMLElement?i.modules.dataTree&&(n=i.modules.dataTree.children.find(r=>r instanceof wc?r.element===e:!1),n&&(n=n.data)):e===null&&(n=!1):typeof e>"u"?n=!1:n=i.data[this.field].find(r=>r.data[this.table.options.index]==e),n&&(Array.isArray(i.data[this.field])&&(n=i.data[this.field].indexOf(n)),n==-1&&(n=!1)),n}getTreeChildren(e,i,n){var r=e.modules.dataTree,a=[];return r&&r.children&&(Array.isArray(r.children)||(r.children=this.generateChildren(e)),r.children.forEach(o=>{o instanceof wc&&(a.push(i?o.getComponent():o),n&&this.getTreeChildren(o,i,n).forEach(s=>{a.push(s)}))})),a}getChildField(){return this.field}redrawNeeded(e){return(this.field?typeof e[this.field]<"u":!1)||(this.elementField?typeof e[this.elementField]<"u":!1)}}Je(BTe,"moduleName","dataTree");function AKe(t,e={},i){var n=e.delimiter?e.delimiter:",",r=[],a=[];t.forEach(o=>{var s=[];switch(o.type){case"group":console.warn("Download Warning - CSV downloader cannot process row groups");break;case"calc":console.warn("Download Warning - CSV downloader cannot process column calculations");break;case"header":o.columns.forEach((l,c)=>{l&&l.depth===1&&(a[c]=typeof l.value>"u"||l.value===null?"":'"'+String(l.value).split('"').join('""')+'"')});break;case"row":o.columns.forEach(l=>{if(l){switch(typeof l.value){case"object":l.value=l.value!==null?JSON.stringify(l.value):"";break;case"undefined":l.value="";break}s.push('"'+String(l.value).split('"').join('""')+'"')}}),r.push(s.join(n));break}}),a.length&&r.unshift(a.join(n)),r=r.join(`
`),e.bom&&(r="\uFEFF"+r),i(r,"text/csv")}function _Ke(t,e,i){var n=[];t.forEach(r=>{var a={};switch(r.type){case"header":break;case"group":console.warn("Download Warning - JSON downloader cannot process row groups");break;case"calc":console.warn("Download Warning - JSON downloader cannot process column calculations");break;case"row":r.columns.forEach(o=>{o&&(a[o.component.getTitleDownload()||o.component.getField()]=o.value)}),n.push(a);break}}),n=JSON.stringify(n,null,"	"),i(n,"application/json")}function kKe(t,e={},i){var n=[],r=[],a={},o=e.rowGroupStyles||{fontStyle:"bold",fontSize:12,cellPadding:6,fillColor:220},s=e.rowCalcStyles||{fontStyle:"bold",fontSize:10,cellPadding:4,fillColor:232},l=e.jsPDF||{},c=e.title?e.title:"";l.orientation||(l.orientation=e.orientation||"landscape"),l.unit||(l.unit="pt"),t.forEach(p=>{switch(p.type){case"header":n.push(u(p));break;case"group":r.push(u(p,o));break;case"calc":r.push(u(p,s));break;case"row":r.push(u(p));break}});function u(p,h){var f=[];return p.columns.forEach(m=>{var g;if(m){switch(typeof m.value){case"object":m.value=m.value!==null?JSON.stringify(m.value):"";break;case"undefined":m.value="";break}g={content:m.value,colSpan:m.width,rowSpan:m.height},h&&(g.styles=h),f.push(g)}}),f}var d=new jspdf.jsPDF(l);e.autoTable&&(typeof e.autoTable=="function"?a=e.autoTable(d)||{}:a=e.autoTable),c&&(a.didDrawPage=function(p){d.text(c,40,30)}),a.head=n,a.body=r,d.autoTable(a),e.documentProcessing&&e.documentProcessing(d),i(d.output("arraybuffer"),"application/pdf")}function xKe(t,e,i){var n=this,r=e.sheetName||"Sheet1",a=XLSX.utils.book_new(),o=new dc(this),s="compress"in e?e.compress:!0,l=e.writeOptions||{bookType:"xlsx",bookSST:!0,compression:s},c;l.type="binary",a.SheetNames=[],a.Sheets={};function u(){var h=[],f=[],m={},g={s:{c:0,r:0},e:{c:t[0]?t[0].columns.reduce((v,y)=>v+(y&&y.width?y.width:1),0):0,r:t.length}};return t.forEach((v,y)=>{var b=[];v.columns.forEach(function(I,T){I?(b.push(!(I.value instanceof Date)&&typeof I.value=="object"?JSON.stringify(I.value):I.value),(I.width>1||I.height>-1)&&(I.height>1||I.width>1)&&f.push({s:{r:y,c:T},e:{r:y+I.height-1,c:T+I.width-1}})):b.push("")}),h.push(b)}),XLSX.utils.sheet_add_aoa(m,h),m["!ref"]=XLSX.utils.encode_range(g),f.length&&(m["!merges"]=f),m}if(e.sheetOnly){i(u());return}if(e.sheets)for(var d in e.sheets)e.sheets[d]===!0?(a.SheetNames.push(d),a.Sheets[d]=u()):(a.SheetNames.push(d),o.commsSend(e.sheets[d],"download","intercept",{type:"xlsx",options:{sheetOnly:!0},active:n.active,intercept:function(h){a.Sheets[d]=h}}));else a.SheetNames.push(r),a.Sheets[r]=u();e.documentProcessing&&(a=e.documentProcessing(a));function p(h){for(var f=new ArrayBuffer(h.length),m=new Uint8Array(f),g=0;g!=h.length;++g)m[g]=h.charCodeAt(g)&255;return f}c=XLSX.write(a,l),i(p(c),"application/octet-stream")}function OKe(t,e,i){this.modExists("export",!0)&&i(this.modules.export.generateHTMLTable(t),"text/html")}function LKe(t,e,i){const n=[];t.forEach(r=>{const a={};switch(r.type){case"header":break;case"group":console.warn("Download Warning - JSON downloader cannot process row groups");break;case"calc":console.warn("Download Warning - JSON downloader cannot process column calculations");break;case"row":r.columns.forEach(o=>{o&&(a[o.component.getTitleDownload()||o.component.getField()]=o.value)}),n.push(JSON.stringify(a));break}}),i(n.join(`
`),"application/x-ndjson")}var FKe={csv:AKe,json:_Ke,jsonLines:LKe,pdf:kKe,xlsx:xKe,html:OKe};const O0=class O0 extends Wn{constructor(e){super(e),this.registerTableOption("downloadEncoder",function(i,n){return new Blob([i],{type:n})}),this.registerTableOption("downloadConfig",{}),this.registerTableOption("downloadRowRange","active"),this.registerColumnOption("download"),this.registerColumnOption("titleDownload")}initialize(){this.deprecatedOptionsCheck(),this.registerTableFunction("download",this.download.bind(this)),this.registerTableFunction("downloadToTab",this.downloadToTab.bind(this))}deprecatedOptionsCheck(){}downloadToTab(e,i,n,r){this.download(e,i,n,r,!0)}download(e,i,n,r,a){var o=!1;function s(c,u){a?a===!0?this.triggerDownload(c,u,e,i,!0):a(c):this.triggerDownload(c,u,e,i)}if(typeof e=="function"?o=e:O0.downloaders[e]?o=O0.downloaders[e]:console.warn("Download Error - No such download type found: ",e),o){var l=this.generateExportList(r);o.call(this.table,l,n||{},s.bind(this))}}generateExportList(e){var i=this.table.modules.export.generateExportList(this.table.options.downloadConfig,!1,e||this.table.options.downloadRowRange,"download"),n=this.table.options.groupHeaderDownload;return n&&!Array.isArray(n)&&(n=[n]),i.forEach(r=>{var a;r.type==="group"&&(a=r.columns[0],n&&n[r.indent]&&(a.value=n[r.indent](a.value,r.component._group.getRowCount(),r.component._group.getData(),r.component)))}),i}triggerDownload(e,i,n,r,a){var o=document.createElement("a"),s=this.table.options.downloadEncoder(e,i);s&&(a?window.open(window.URL.createObjectURL(s)):(r=r||"Tabulator."+(typeof n=="function"?"txt":n),navigator.msSaveOrOpenBlob?navigator.msSaveOrOpenBlob(s,r):(o.setAttribute("href",window.URL.createObjectURL(s)),o.setAttribute("download",r),o.style.display="none",document.body.appendChild(o),o.click(),document.body.removeChild(o))),this.dispatchExternal("downloadComplete"))}commsReceived(e,i,n){switch(i){case"intercept":this.download(n.type,"",n.options,n.active,n.intercept);break}}};Je(O0,"moduleName","download"),Je(O0,"downloaders",FKe);let Xj=O0;function GF(t,e){var i=e.mask,n=typeof e.maskLetterChar<"u"?e.maskLetterChar:"A",r=typeof e.maskNumberChar<"u"?e.maskNumberChar:"9",a=typeof e.maskWildcardChar<"u"?e.maskWildcardChar:"*";function o(s){var l=i[s];typeof l<"u"&&l!==a&&l!==n&&l!==r&&(t.value=t.value+""+l,o(s+1))}t.addEventListener("keydown",s=>{var l=t.value.length,c=s.key;if(s.keyCode>46&&!s.ctrlKey&&!s.metaKey){if(l>=i.length)return s.preventDefault(),s.stopPropagation(),!1;switch(i[l]){case n:if(c.toUpperCase()==c.toLowerCase())return s.preventDefault(),s.stopPropagation(),!1;break;case r:if(isNaN(c))return s.preventDefault(),s.stopPropagation(),!1;break;case a:break;default:if(c!==i[l])return s.preventDefault(),s.stopPropagation(),!1}}}),t.addEventListener("keyup",s=>{s.keyCode>46&&e.maskAutoFill&&o(t.value.length)}),t.placeholder||(t.placeholder=i),e.maskAutoFill&&o(t.value.length)}function BKe(t,e,i,n,r){var a=t.getValue(),o=document.createElement("input");if(o.setAttribute("type",r.search?"search":"text"),o.style.padding="4px",o.style.width="100%",o.style.boxSizing="border-box",r.elementAttributes&&typeof r.elementAttributes=="object")for(let l in r.elementAttributes)l.charAt(0)=="+"?(l=l.slice(1),o.setAttribute(l,o.getAttribute(l)+r.elementAttributes["+"+l])):o.setAttribute(l,r.elementAttributes[l]);o.value=typeof a<"u"?a:"",e(function(){t.getType()==="cell"&&(o.focus({preventScroll:!0}),o.style.height="100%",r.selectContents&&o.select())});function s(l){(a===null||typeof a>"u")&&o.value!==""||o.value!==a?i(o.value)&&(a=o.value):n()}return o.addEventListener("change",s),o.addEventListener("blur",s),o.addEventListener("keydown",function(l){switch(l.keyCode){case 13:s();break;case 27:n();break;case 35:case 36:l.stopPropagation();break}}),r.mask&&GF(o,r),o}function $Ke(t,e,i,n,r){var a=t.getValue(),o=r.verticalNavigation||"hybrid",s=String(a!==null&&typeof a<"u"?a:""),l=document.createElement("textarea"),c=0;if(l.style.display="block",l.style.padding="2px",l.style.height="100%",l.style.width="100%",l.style.boxSizing="border-box",l.style.whiteSpace="pre-wrap",l.style.resize="none",r.elementAttributes&&typeof r.elementAttributes=="object")for(let d in r.elementAttributes)d.charAt(0)=="+"?(d=d.slice(1),l.setAttribute(d,l.getAttribute(d)+r.elementAttributes["+"+d])):l.setAttribute(d,r.elementAttributes[d]);l.value=s,e(function(){t.getType()==="cell"&&(l.focus({preventScroll:!0}),l.style.height="100%",l.scrollHeight,l.style.height=l.scrollHeight+"px",t.getRow().normalizeHeight(),r.selectContents&&l.select())});function u(d){(a===null||typeof a>"u")&&l.value!==""||l.value!==a?(i(l.value)&&(a=l.value),setTimeout(function(){t.getRow().normalizeHeight()},300)):n()}return l.addEventListener("change",u),l.addEventListener("blur",u),l.addEventListener("keyup",function(){l.style.height="";var d=l.scrollHeight;l.style.height=d+"px",d!=c&&(c=d,t.getRow().normalizeHeight())}),l.addEventListener("keydown",function(d){switch(d.keyCode){case 13:d.shiftKey&&r.shiftEnterSubmit&&u();break;case 27:n();break;case 38:(o=="editor"||o=="hybrid"&&l.selectionStart)&&(d.stopImmediatePropagation(),d.stopPropagation());break;case 40:(o=="editor"||o=="hybrid"&&l.selectionStart!==l.value.length)&&(d.stopImmediatePropagation(),d.stopPropagation());break;case 35:case 36:d.stopPropagation();break}}),r.mask&&GF(l,r),l}function VKe(t,e,i,n,r){var a=t.getValue(),o=r.verticalNavigation||"editor",s=document.createElement("input");if(s.setAttribute("type","number"),typeof r.max<"u"&&s.setAttribute("max",r.max),typeof r.min<"u"&&s.setAttribute("min",r.min),typeof r.step<"u"&&s.setAttribute("step",r.step),s.style.padding="4px",s.style.width="100%",s.style.boxSizing="border-box",r.elementAttributes&&typeof r.elementAttributes=="object")for(let u in r.elementAttributes)u.charAt(0)=="+"?(u=u.slice(1),s.setAttribute(u,s.getAttribute(u)+r.elementAttributes["+"+u])):s.setAttribute(u,r.elementAttributes[u]);s.value=a;var l=function(u){c()};e(function(){t.getType()==="cell"&&(s.removeEventListener("blur",l),s.focus({preventScroll:!0}),s.style.height="100%",s.addEventListener("blur",l),r.selectContents&&s.select())});function c(){var u=s.value;!isNaN(u)&&u!==""&&(u=Number(u)),u!==a?i(u)&&(a=u):n()}return s.addEventListener("keydown",function(u){switch(u.keyCode){case 13:c();break;case 27:n();break;case 38:case 40:o=="editor"&&(u.stopImmediatePropagation(),u.stopPropagation());break;case 35:case 36:u.stopPropagation();break}}),r.mask&&GF(s,r),s}function jKe(t,e,i,n,r){var a=t.getValue(),o=document.createElement("input");if(o.setAttribute("type","range"),typeof r.max<"u"&&o.setAttribute("max",r.max),typeof r.min<"u"&&o.setAttribute("min",r.min),typeof r.step<"u"&&o.setAttribute("step",r.step),o.style.padding="4px",o.style.width="100%",o.style.boxSizing="border-box",r.elementAttributes&&typeof r.elementAttributes=="object")for(let l in r.elementAttributes)l.charAt(0)=="+"?(l=l.slice(1),o.setAttribute(l,o.getAttribute(l)+r.elementAttributes["+"+l])):o.setAttribute(l,r.elementAttributes[l]);o.value=a,e(function(){t.getType()==="cell"&&(o.focus({preventScroll:!0}),o.style.height="100%")});function s(){var l=o.value;!isNaN(l)&&l!==""&&(l=Number(l)),l!=a?i(l)&&(a=l):n()}return o.addEventListener("blur",function(l){s()}),o.addEventListener("keydown",function(l){switch(l.keyCode){case 13:s();break;case 27:n();break}}),o}function GKe(t,e,i,n,r){var a=r.format,o=r.verticalNavigation||"editor",s=a?window.DateTime||luxon.DateTime:null,l=t.getValue(),c=document.createElement("input");function u(p){var h;return s.isDateTime(p)?h=p:a==="iso"?h=s.fromISO(String(p)):h=s.fromFormat(String(p),a),h.toFormat("yyyy-MM-dd")}if(c.type="date",c.style.padding="4px",c.style.width="100%",c.style.boxSizing="border-box",r.max&&c.setAttribute("max",a?u(r.max):r.max),r.min&&c.setAttribute("min",a?u(r.min):r.min),r.elementAttributes&&typeof r.elementAttributes=="object")for(let p in r.elementAttributes)p.charAt(0)=="+"?(p=p.slice(1),c.setAttribute(p,c.getAttribute(p)+r.elementAttributes["+"+p])):c.setAttribute(p,r.elementAttributes[p]);l=typeof l<"u"?l:"",a&&(s?l=u(l):console.error("Editor Error - 'date' editor 'format' param is dependant on luxon.js")),c.value=l,e(function(){t.getType()==="cell"&&(c.focus({preventScroll:!0}),c.style.height="100%",r.selectContents&&c.select())});function d(){var p=c.value,h;if((l===null||typeof l>"u")&&p!==""||p!==l){if(p&&a)switch(h=s.fromFormat(String(p),"yyyy-MM-dd"),a){case!0:p=h;break;case"iso":p=h.toISO();break;default:p=h.toFormat(a)}i(p)&&(l=c.value)}else n()}return c.addEventListener("blur",function(p){(p.relatedTarget||p.rangeParent||p.explicitOriginalTarget!==c)&&d()}),c.addEventListener("keydown",function(p){switch(p.keyCode){case 13:d();break;case 27:n();break;case 35:case 36:p.stopPropagation();break;case 38:case 40:o=="editor"&&(p.stopImmediatePropagation(),p.stopPropagation());break}}),c}function HKe(t,e,i,n,r){var a=r.format,o=r.verticalNavigation||"editor",s=a?window.DateTime||luxon.DateTime:null,l,c=t.getValue(),u=document.createElement("input");if(u.type="time",u.style.padding="4px",u.style.width="100%",u.style.boxSizing="border-box",r.elementAttributes&&typeof r.elementAttributes=="object")for(let p in r.elementAttributes)p.charAt(0)=="+"?(p=p.slice(1),u.setAttribute(p,u.getAttribute(p)+r.elementAttributes["+"+p])):u.setAttribute(p,r.elementAttributes[p]);c=typeof c<"u"?c:"",a&&(s?(s.isDateTime(c)?l=c:a==="iso"?l=s.fromISO(String(c)):l=s.fromFormat(String(c),a),c=l.toFormat("HH:mm")):console.error("Editor Error - 'date' editor 'format' param is dependant on luxon.js")),u.value=c,e(function(){t.getType()=="cell"&&(u.focus({preventScroll:!0}),u.style.height="100%",r.selectContents&&u.select())});function d(){var p=u.value,h;if((c===null||typeof c>"u")&&p!==""||p!==c){if(p&&a)switch(h=s.fromFormat(String(p),"hh:mm"),a){case!0:p=h;break;case"iso":p=h.toISO();break;default:p=h.toFormat(a)}i(p)&&(c=u.value)}else n()}return u.addEventListener("blur",function(p){(p.relatedTarget||p.rangeParent||p.explicitOriginalTarget!==u)&&d()}),u.addEventListener("keydown",function(p){switch(p.keyCode){case 13:d();break;case 27:n();break;case 35:case 36:p.stopPropagation();break;case 38:case 40:o=="editor"&&(p.stopImmediatePropagation(),p.stopPropagation());break}}),u}function zKe(t,e,i,n,r){var a=r.format,o=r.verticalNavigation||"editor",s=a?window.DateTime||luxon.DateTime:null,l,c=t.getValue(),u=document.createElement("input");if(u.type="datetime-local",u.style.padding="4px",u.style.width="100%",u.style.boxSizing="border-box",r.elementAttributes&&typeof r.elementAttributes=="object")for(let p in r.elementAttributes)p.charAt(0)=="+"?(p=p.slice(1),u.setAttribute(p,u.getAttribute(p)+r.elementAttributes["+"+p])):u.setAttribute(p,r.elementAttributes[p]);c=typeof c<"u"?c:"",a&&(s?(s.isDateTime(c)?l=c:a==="iso"?l=s.fromISO(String(c)):l=s.fromFormat(String(c),a),c=l.toFormat("yyyy-MM-dd")+"T"+l.toFormat("HH:mm")):console.error("Editor Error - 'date' editor 'format' param is dependant on luxon.js")),u.value=c,e(function(){t.getType()==="cell"&&(u.focus({preventScroll:!0}),u.style.height="100%",r.selectContents&&u.select())});function d(){var p=u.value,h;if((c===null||typeof c>"u")&&p!==""||p!==c){if(p&&a)switch(h=s.fromISO(String(p)),a){case!0:p=h;break;case"iso":p=h.toISO();break;default:p=h.toFormat(a)}i(p)&&(c=u.value)}else n()}return u.addEventListener("blur",function(p){(p.relatedTarget||p.rangeParent||p.explicitOriginalTarget!==u)&&d()}),u.addEventListener("keydown",function(p){switch(p.keyCode){case 13:d();break;case 27:n();break;case 35:case 36:p.stopPropagation();break;case 38:case 40:o=="editor"&&(p.stopImmediatePropagation(),p.stopPropagation());break}}),u}let qKe=class{constructor(e,i,n,r,a,o){this.edit=e,this.table=e.table,this.cell=i,this.params=this._initializeParams(o),this.data=[],this.displayItems=[],this.currentItems=[],this.focusedItem=null,this.input=this._createInputElement(),this.listEl=this._createListElement(),this.initialValues=null,this.isFilter=i.getType()==="header",this.filterTimeout=null,this.filtered=!1,this.typing=!1,this.values=[],this.popup=null,this.listIteration=0,this.lastAction="",this.filterTerm="",this.blurable=!0,this.actions={success:r,cancel:a},this._deprecatedOptionsCheck(),this._initializeValue(),n(this._onRendered.bind(this))}_deprecatedOptionsCheck(){}_initializeValue(){var e=this.cell.getValue();typeof e>"u"&&typeof this.params.defaultValue<"u"&&(e=this.params.defaultValue),this.initialValues=this.params.multiselect?e:[e],this.isFilter&&(this.input.value=this.initialValues?this.initialValues.join(","):"",this.headerFilterInitialListGen())}_onRendered(){var e=this.cell.getElement();function i(n){n.stopPropagation()}this.isFilter||(this.input.style.height="100%",this.input.focus({preventScroll:!0})),e.addEventListener("click",i),setTimeout(()=>{e.removeEventListener("click",i)},1e3),this.input.addEventListener("mousedown",this._preventPopupBlur.bind(this))}_createListElement(){var e=document.createElement("div");return e.classList.add("tabulator-edit-list"),e.addEventListener("mousedown",this._preventBlur.bind(this)),e.addEventListener("keydown",this._inputKeyDown.bind(this)),e}_setListWidth(){var e=this.isFilter?this.input:this.cell.getElement();this.listEl.style.minWidth=e.offsetWidth+"px",this.params.maxWidth&&(this.params.maxWidth===!0?this.listEl.style.maxWidth=e.offsetWidth+"px":typeof this.params.maxWidth=="number"?this.listEl.style.maxWidth=this.params.maxWidth+"px":this.listEl.style.maxWidth=this.params.maxWidth)}_createInputElement(){var e=this.params.elementAttributes,i=document.createElement("input");if(i.setAttribute("type",this.params.clearable?"search":"text"),i.style.padding="4px",i.style.width="100%",i.style.boxSizing="border-box",this.params.autocomplete||(i.style.cursor="default",i.style.caretColor="transparent"),e&&typeof e=="object")for(let n in e)n.charAt(0)=="+"?(n=n.slice(1),i.setAttribute(n,i.getAttribute(n)+e["+"+n])):i.setAttribute(n,e[n]);return this.params.mask&&GF(i,this.params),this._bindInputEvents(i),i}_initializeParams(e){var i=["values","valuesURL","valuesLookup"],n;return e=Object.assign({},e),e.verticalNavigation=e.verticalNavigation||"editor",e.placeholderLoading=typeof e.placeholderLoading>"u"?"Searching ...":e.placeholderLoading,e.placeholderEmpty=typeof e.placeholderEmpty>"u"?"No Results Found":e.placeholderEmpty,e.filterDelay=typeof e.filterDelay>"u"?300:e.filterDelay,e.emptyValue=Object.keys(e).includes("emptyValue")?e.emptyValue:"",n=Object.keys(e).filter(r=>i.includes(r)).length,n?n>1&&console.warn("list editor config error - only one of the values, valuesURL, or valuesLookup options can be set on the same editor"):console.warn("list editor config error - either the values, valuesURL, or valuesLookup option must be set"),e.autocomplete?e.multiselect&&(e.multiselect=!1,console.warn("list editor config error - multiselect option is not available when autocomplete is enabled")):(e.freetext&&(e.freetext=!1,console.warn("list editor config error - freetext option is only available when autocomplete is enabled")),e.filterFunc&&(e.filterFunc=!1,console.warn("list editor config error - filterFunc option is only available when autocomplete is enabled")),e.filterRemote&&(e.filterRemote=!1,console.warn("list editor config error - filterRemote option is only available when autocomplete is enabled")),e.mask&&(e.mask=!1,console.warn("list editor config error - mask option is only available when autocomplete is enabled")),e.allowEmpty&&(e.allowEmpty=!1,console.warn("list editor config error - allowEmpty option is only available when autocomplete is enabled")),e.listOnEmpty&&(e.listOnEmpty=!1,console.warn("list editor config error - listOnEmpty option is only available when autocomplete is enabled"))),e.filterRemote&&!(typeof e.valuesLookup=="function"||e.valuesURL)&&(e.filterRemote=!1,console.warn("list editor config error - filterRemote option should only be used when values list is populated from a remote source")),e}_bindInputEvents(e){e.addEventListener("focus",this._inputFocus.bind(this)),e.addEventListener("click",this._inputClick.bind(this)),e.addEventListener("blur",this._inputBlur.bind(this)),e.addEventListener("keydown",this._inputKeyDown.bind(this)),e.addEventListener("search",this._inputSearch.bind(this)),this.params.autocomplete&&e.addEventListener("keyup",this._inputKeyUp.bind(this))}_inputFocus(e){this.rebuildOptionsList()}_filter(){this.params.filterRemote?(clearTimeout(this.filterTimeout),this.filterTimeout=setTimeout(()=>{this.rebuildOptionsList()},this.params.filterDelay)):this._filterList()}_inputClick(e){e.stopPropagation()}_inputBlur(e){this.blurable&&(this.popup?this.popup.hide():this._resolveValue(!0))}_inputSearch(){this._clearChoices()}_inputKeyDown(e){switch(e.keyCode){case 38:this._keyUp(e);break;case 40:this._keyDown(e);break;case 37:case 39:this._keySide(e);break;case 13:this._keyEnter();break;case 27:this._keyEsc();break;case 36:case 35:this._keyHomeEnd(e);break;case 9:this._keyTab(e);break;default:this._keySelectLetter(e)}}_inputKeyUp(e){switch(e.keyCode){case 38:case 37:case 39:case 40:case 13:case 27:break;default:this._keyAutoCompLetter(e)}}_preventPopupBlur(){this.popup&&this.popup.blockHide(),setTimeout(()=>{this.popup&&this.popup.restoreHide()},10)}_preventBlur(){this.blurable=!1,setTimeout(()=>{this.blurable=!0},10)}_keyTab(e){this.params.autocomplete&&this.lastAction==="typing"?this._resolveValue(!0):this.focusedItem&&this._chooseItem(this.focusedItem,!0)}_keyUp(e){var i=this.displayItems.indexOf(this.focusedItem);(this.params.verticalNavigation=="editor"||this.params.verticalNavigation=="hybrid"&&i)&&(e.stopImmediatePropagation(),e.stopPropagation(),e.preventDefault(),i>0&&this._focusItem(this.displayItems[i-1]))}_keyDown(e){var i=this.displayItems.indexOf(this.focusedItem);(this.params.verticalNavigation=="editor"||this.params.verticalNavigation=="hybrid"&&i<this.displayItems.length-1)&&(e.stopImmediatePropagation(),e.stopPropagation(),e.preventDefault(),i<this.displayItems.length-1&&(i==-1?this._focusItem(this.displayItems[0]):this._focusItem(this.displayItems[i+1])))}_keySide(e){this.params.autocomplete||(e.stopImmediatePropagation(),e.stopPropagation(),e.preventDefault())}_keyEnter(e){this.params.autocomplete&&this.lastAction==="typing"?this._resolveValue(!0):this.focusedItem&&this._chooseItem(this.focusedItem)}_keyEsc(e){this._cancel()}_keyHomeEnd(e){this.params.autocomplete&&e.stopImmediatePropagation()}_keySelectLetter(e){this.params.autocomplete||(e.preventDefault(),e.keyCode>=38&&e.keyCode<=90&&this._scrollToValue(e.keyCode))}_keyAutoCompLetter(e){this._filter(),this.lastAction="typing",this.typing=!0}_scrollToValue(e){clearTimeout(this.filterTimeout);var i=String.fromCharCode(e).toLowerCase();this.filterTerm+=i.toLowerCase();var n=this.displayItems.find(r=>typeof r.label<"u"&&r.label.toLowerCase().startsWith(this.filterTerm));n&&this._focusItem(n),this.filterTimeout=setTimeout(()=>{this.filterTerm=""},800)}_focusItem(e){this.lastAction="focus",this.focusedItem&&this.focusedItem.element&&this.focusedItem.element.classList.remove("focused"),this.focusedItem=e,e&&e.element&&(e.element.classList.add("focused"),e.element.scrollIntoView({behavior:"smooth",block:"nearest",inline:"start"}))}headerFilterInitialListGen(){this._generateOptions(!0)}rebuildOptionsList(){this._generateOptions().then(this._sortOptions.bind(this)).then(this._buildList.bind(this)).then(this._showList.bind(this)).catch(e=>{Number.isInteger(e)||console.error("List generation error",e)})}_filterList(){this._buildList(this._filterOptions()),this._showList()}_generateOptions(e){var i=[],n=++this.listIteration;return this.filtered=!1,this.params.values?i=this.params.values:this.params.valuesURL?i=this._ajaxRequest(this.params.valuesURL,this.input.value):typeof this.params.valuesLookup=="function"?i=this.params.valuesLookup(this.cell,this.input.value):this.params.valuesLookup&&(i=this._uniqueColumnValues(this.params.valuesLookupField)),i instanceof Promise?(e||this._addPlaceholder(this.params.placeholderLoading),i.then().then(r=>this.listIteration===n?this._parseList(r):Promise.reject(n))):Promise.resolve(this._parseList(i))}_addPlaceholder(e){var i=document.createElement("div");typeof e=="function"&&(e=e(this.cell.getComponent(),this.listEl)),e&&(this._clearList(),e instanceof HTMLElement?i=e:(i.classList.add("tabulator-edit-list-placeholder"),i.innerHTML=e),this.listEl.appendChild(i),this._showList())}_ajaxRequest(e,i){var n=this.params.filterRemote?{term:i}:{};return e=xTe(e,{},n),fetch(e).then(r=>r.ok?r.json().catch(a=>(console.warn("List Ajax Load Error - Invalid JSON returned",a),Promise.reject(a))):(console.error("List Ajax Load Error - Connection Error: "+r.status,r.statusText),Promise.reject(r))).catch(r=>(console.error("List Ajax Load Error - Connection Error: ",r),Promise.reject(r)))}_uniqueColumnValues(e){var i={},n=this.table.getData(this.params.valuesLookup),r;return e?r=this.table.columnManager.getColumnByField(e):r=this.cell.getColumn()._getSelf(),r?n.forEach(a=>{var o=r.getFieldValue(a);o!==null&&typeof o<"u"&&o!==""&&(i[o]=!0)}):(console.warn("unable to find matching column to create select lookup list:",e),i=[]),Object.keys(i)}_parseList(e){var i=[];return Array.isArray(e)||(e=Object.entries(e).map(([n,r])=>({label:r,value:n}))),e.forEach(n=>{typeof n!="object"&&(n={label:n,value:n}),this._parseListItem(n,i,0)}),!this.currentItems.length&&this.params.freetext&&(this.input.value=this.initialValues,this.typing=!0,this.lastAction="typing"),this.data=i,i}_parseListItem(e,i,n){var r={};e.options?r=this._parseListGroup(e,n+1):(r={label:e.label,value:e.value,itemParams:e.itemParams,elementAttributes:e.elementAttributes,element:!1,selected:!1,visible:!0,level:n,original:e},this.initialValues&&this.initialValues.indexOf(e.value)>-1&&this._chooseItem(r,!0)),i.push(r)}_parseListGroup(e,i){var n={label:e.label,group:!0,itemParams:e.itemParams,elementAttributes:e.elementAttributes,element:!1,visible:!0,level:i,options:[],original:e};return e.options.forEach(r=>{this._parseListItem(r,n.options,i)}),n}_sortOptions(e){var i;return this.params.sort&&(i=typeof this.params.sort=="function"?this.params.sort:this._defaultSortFunction.bind(this),this._sortGroup(i,e)),e}_sortGroup(e,i){i.sort((n,r)=>e(n.label,r.label,n.value,r.value,n.original,r.original)),i.forEach(n=>{n.group&&this._sortGroup(e,n.options)})}_defaultSortFunction(e,i){var n,r,a,o,s=0,l,c=/(\d+)|(\D+)/g,u=/\d/,d=0;if(this.params.sort==="desc"&&([e,i]=[i,e]),!e&&e!==0)d=!i&&i!==0?0:-1;else if(!i&&i!==0)d=1;else{if(isFinite(e)&&isFinite(i))return e-i;if(n=String(e).toLowerCase(),r=String(i).toLowerCase(),n===r)return 0;if(!(u.test(n)&&u.test(r)))return n>r?1:-1;for(n=n.match(c),r=r.match(c),l=n.length>r.length?r.length:n.length;s<l;)if(a=n[s],o=r[s++],a!==o)return isFinite(a)&&isFinite(o)?(a.charAt(0)==="0"&&(a="."+a),o.charAt(0)==="0"&&(o="."+o),a-o):a>o?1:-1;return n.length>r.length}return d}_filterOptions(){var e=this.params.filterFunc||this._defaultFilterFunc,i=this.input.value;return i?(this.filtered=!0,this.data.forEach(n=>{this._filterItem(e,i,n)})):this.filtered=!1,this.data}_filterItem(e,i,n){var r=!1;return n.group?(n.options.forEach(a=>{this._filterItem(e,i,a)&&(r=!0)}),n.visible=r):n.visible=e(i,n.label,n.value,n.original),n.visible}_defaultFilterFunc(e,i,n,r){return e=String(e).toLowerCase(),i!==null&&typeof i<"u"&&(String(i).toLowerCase().indexOf(e)>-1||String(n).toLowerCase().indexOf(e)>-1)}_clearList(){for(;this.listEl.firstChild;)this.listEl.removeChild(this.listEl.firstChild);this.displayItems=[]}_buildList(e){this._clearList(),e.forEach(i=>{this._buildItem(i)}),this.displayItems.length||this._addPlaceholder(this.params.placeholderEmpty)}_buildItem(e){var i=e.element,n;if(!this.filtered||e.visible){if(!i){if(i=document.createElement("div"),i.tabIndex=0,n=this.params.itemFormatter?this.params.itemFormatter(e.label,e.value,e.original,i):e.label,n instanceof HTMLElement?i.appendChild(n):i.innerHTML=n,e.group?i.classList.add("tabulator-edit-list-group"):i.classList.add("tabulator-edit-list-item"),i.classList.add("tabulator-edit-list-group-level-"+e.level),e.elementAttributes&&typeof e.elementAttributes=="object")for(let r in e.elementAttributes)r.charAt(0)=="+"?(r=r.slice(1),i.setAttribute(r,this.input.getAttribute(r)+e.elementAttributes["+"+r])):i.setAttribute(r,e.elementAttributes[r]);e.group?i.addEventListener("click",this._groupClick.bind(this,e)):i.addEventListener("click",this._itemClick.bind(this,e)),i.addEventListener("mousedown",this._preventBlur.bind(this)),e.element=i}this._styleItem(e),this.listEl.appendChild(i),e.group?e.options.forEach(r=>{this._buildItem(r)}):this.displayItems.push(e)}}_showList(){var e=this.popup&&this.popup.isVisible();if(this.input.parentNode){if(this.params.autocomplete&&this.input.value===""&&!this.params.listOnEmpty){this.popup&&this.popup.hide(!0);return}this._setListWidth(),this.popup||(this.popup=this.edit.popup(this.listEl)),this.popup.show(this.cell.getElement(),"bottom"),e||setTimeout(()=>{this.popup.hideOnBlur(this._resolveValue.bind(this,!0))},10)}}_styleItem(e){e&&e.element&&(e.selected?e.element.classList.add("active"):e.element.classList.remove("active"))}_itemClick(e,i){i.stopPropagation(),this._chooseItem(e)}_groupClick(e,i){i.stopPropagation()}_cancel(){this.popup.hide(!0),this.actions.cancel()}_clearChoices(){this.typing=!0,this.currentItems.forEach(e=>{e.selected=!1,this._styleItem(e)}),this.currentItems=[],this.focusedItem=null}_chooseItem(e,i){var n;this.typing=!1,this.params.multiselect?(n=this.currentItems.indexOf(e),n>-1?(this.currentItems.splice(n,1),e.selected=!1):(this.currentItems.push(e),e.selected=!0),this.input.value=this.currentItems.map(r=>r.label).join(","),this._styleItem(e)):(this.currentItems=[e],e.selected=!0,this.input.value=e.label,this._styleItem(e),i||this._resolveValue()),this._focusItem(e)}_resolveValue(e){var i,n;if(this.popup&&this.popup.hide(!0),this.params.multiselect)i=this.currentItems.map(r=>r.value);else if(e&&this.params.autocomplete&&this.typing)if(this.params.freetext||this.params.allowEmpty&&this.input.value==="")i=this.input.value;else{this.actions.cancel();return}else this.currentItems[0]?i=this.currentItems[0].value:(n=Array.isArray(this.initialValues)?this.initialValues[0]:this.initialValues,n===null||typeof n>"u"||n===""?i=n:i=this.params.emptyValue);i===""&&(i=this.params.emptyValue),this.actions.success(i),this.isFilter&&(this.initialValues=i&&!Array.isArray(i)?[i]:i,this.currentItems=[])}};function WKe(t,e,i,n,r){var a=new qKe(this,t,e,i,n,r);return a.input}function KKe(t,e,i,n,r){var a=this,o=t.getElement(),s=t.getValue(),l=o.getElementsByTagName("svg").length||5,c=o.getElementsByTagName("svg")[0]?o.getElementsByTagName("svg")[0].getAttribute("width"):14,u=[],d=document.createElement("div"),p=document.createElementNS("http://www.w3.org/2000/svg","svg");function h(v){u.forEach(function(y,b){b<v?(a.table.browser=="ie"?y.setAttribute("class","tabulator-star-active"):y.classList.replace("tabulator-star-inactive","tabulator-star-active"),y.innerHTML='<polygon fill="#488CE9" stroke="#014AAE" stroke-width="37.6152" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" points="259.216,29.942 330.27,173.919 489.16,197.007 374.185,309.08 401.33,467.31 259.216,392.612 117.104,467.31 144.25,309.08 29.274,197.007 188.165,173.919 "/>'):(a.table.browser=="ie"?y.setAttribute("class","tabulator-star-inactive"):y.classList.replace("tabulator-star-active","tabulator-star-inactive"),y.innerHTML='<polygon fill="#010155" stroke="#686868" stroke-width="37.6152" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" points="259.216,29.942 330.27,173.919 489.16,197.007 374.185,309.08 401.33,467.31 259.216,392.612 117.104,467.31 144.25,309.08 29.274,197.007 188.165,173.919 "/>')})}function f(v){var y=document.createElement("span"),b=p.cloneNode(!0);u.push(b),y.addEventListener("mouseenter",function(I){I.stopPropagation(),I.stopImmediatePropagation(),h(v)}),y.addEventListener("mousemove",function(I){I.stopPropagation(),I.stopImmediatePropagation()}),y.addEventListener("click",function(I){I.stopPropagation(),I.stopImmediatePropagation(),i(v),o.blur()}),y.appendChild(b),d.appendChild(y)}function m(v){s=v,h(v)}if(o.style.whiteSpace="nowrap",o.style.overflow="hidden",o.style.textOverflow="ellipsis",d.style.verticalAlign="middle",d.style.display="inline-block",d.style.padding="4px",p.setAttribute("width",c),p.setAttribute("height",c),p.setAttribute("viewBox","0 0 512 512"),p.setAttribute("xml:space","preserve"),p.style.padding="0 1px",r.elementAttributes&&typeof r.elementAttributes=="object")for(let v in r.elementAttributes)v.charAt(0)=="+"?(v=v.slice(1),d.setAttribute(v,d.getAttribute(v)+r.elementAttributes["+"+v])):d.setAttribute(v,r.elementAttributes[v]);for(var g=1;g<=l;g++)f(g);return s=Math.min(parseInt(s),l),h(s),d.addEventListener("mousemove",function(v){h(0)}),d.addEventListener("click",function(v){i(0)}),o.addEventListener("blur",function(v){n()}),o.addEventListener("keydown",function(v){switch(v.keyCode){case 39:m(s+1);break;case 37:m(s-1);break;case 13:i(s);break;case 27:n();break}}),d}function YKe(t,e,i,n,r){var a=t.getElement(),o=typeof r.max>"u"?a.getElementsByTagName("div")[0]&&a.getElementsByTagName("div")[0].getAttribute("max")||100:r.max,s=typeof r.min>"u"?a.getElementsByTagName("div")[0]&&a.getElementsByTagName("div")[0].getAttribute("min")||0:r.min,l=(o-s)/100,c=t.getValue()||0,u=document.createElement("div"),d=document.createElement("div"),p,h;function f(){var m=window.getComputedStyle(a,null),g=l*Math.round(d.offsetWidth/((a.clientWidth-parseInt(m.getPropertyValue("padding-left"))-parseInt(m.getPropertyValue("padding-right")))/100))+s;i(g),a.setAttribute("aria-valuenow",g),a.setAttribute("aria-label",c)}if(u.style.position="absolute",u.style.right="0",u.style.top="0",u.style.bottom="0",u.style.width="5px",u.classList.add("tabulator-progress-handle"),d.style.display="inline-block",d.style.position="relative",d.style.height="100%",d.style.backgroundColor="#488CE9",d.style.maxWidth="100%",d.style.minWidth="0%",r.elementAttributes&&typeof r.elementAttributes=="object")for(let m in r.elementAttributes)m.charAt(0)=="+"?(m=m.slice(1),d.setAttribute(m,d.getAttribute(m)+r.elementAttributes["+"+m])):d.setAttribute(m,r.elementAttributes[m]);return a.style.padding="4px 4px",c=Math.min(parseFloat(c),o),c=Math.max(parseFloat(c),s),c=Math.round((c-s)/l),d.style.width=c+"%",a.setAttribute("aria-valuemin",s),a.setAttribute("aria-valuemax",o),d.appendChild(u),u.addEventListener("mousedown",function(m){p=m.screenX,h=d.offsetWidth}),u.addEventListener("mouseover",function(){u.style.cursor="ew-resize"}),a.addEventListener("mousemove",function(m){p&&(d.style.width=h+m.screenX-p+"px")}),a.addEventListener("mouseup",function(m){p&&(m.stopPropagation(),m.stopImmediatePropagation(),p=!1,h=!1,f())}),a.addEventListener("keydown",function(m){switch(m.keyCode){case 39:m.preventDefault(),d.style.width=d.clientWidth+a.clientWidth/100+"px";break;case 37:m.preventDefault(),d.style.width=d.clientWidth-a.clientWidth/100+"px";break;case 9:case 13:f();break;case 27:n();break}}),a.addEventListener("blur",function(){n()}),d}function ZKe(t,e,i,n,r){var a=t.getValue(),o=document.createElement("input"),s=r.tristate,l=typeof r.indeterminateValue>"u"?null:r.indeterminateValue,c=!1,u=Object.keys(r).includes("trueValue"),d=Object.keys(r).includes("falseValue");if(o.setAttribute("type","checkbox"),o.style.marginTop="5px",o.style.boxSizing="border-box",r.elementAttributes&&typeof r.elementAttributes=="object")for(let h in r.elementAttributes)h.charAt(0)=="+"?(h=h.slice(1),o.setAttribute(h,o.getAttribute(h)+r.elementAttributes["+"+h])):o.setAttribute(h,r.elementAttributes[h]);o.value=a,s&&(typeof a>"u"||a===l||a==="")&&(c=!0,o.indeterminate=!0),this.table.browser!="firefox"&&this.table.browser!="safari"&&e(function(){t.getType()==="cell"&&o.focus({preventScroll:!0})}),o.checked=u?a===r.trueValue:a===!0||a==="true"||a==="True"||a===1;function p(h){var f=o.checked;return u&&f?f=r.trueValue:d&&!f&&(f=r.falseValue),s?h?c?l:f:o.checked&&!c?(o.checked=!1,o.indeterminate=!0,c=!0,l):(c=!1,f):f}return o.addEventListener("change",function(h){i(p())}),o.addEventListener("blur",function(h){i(p(!0))}),o.addEventListener("keydown",function(h){h.keyCode==13&&i(p()),h.keyCode==27&&n()}),o}var XKe={input:BKe,textarea:$Ke,number:VKe,range:jKe,date:GKe,time:HKe,datetime:zKe,list:WKe,star:KKe,progress:YKe,tickCross:ZKe};const pD=class pD extends Wn{constructor(e){super(e),this.currentCell=!1,this.mouseClick=!1,this.recursionBlock=!1,this.invalidEdit=!1,this.editedCells=[],this.convertEmptyValues=!1,this.editors=pD.editors,this.registerTableOption("editTriggerEvent","focus"),this.registerTableOption("editorEmptyValue"),this.registerTableOption("editorEmptyValueFunc",this.emptyValueCheck.bind(this)),this.registerColumnOption("editable"),this.registerColumnOption("editor"),this.registerColumnOption("editorParams"),this.registerColumnOption("editorEmptyValue"),this.registerColumnOption("editorEmptyValueFunc"),this.registerColumnOption("cellEditing"),this.registerColumnOption("cellEdited"),this.registerColumnOption("cellEditCancelled"),this.registerTableFunction("getEditedCells",this.getEditedCells.bind(this)),this.registerTableFunction("clearCellEdited",this.clearCellEdited.bind(this)),this.registerTableFunction("navigatePrev",this.navigatePrev.bind(this)),this.registerTableFunction("navigateNext",this.navigateNext.bind(this)),this.registerTableFunction("navigateLeft",this.navigateLeft.bind(this)),this.registerTableFunction("navigateRight",this.navigateRight.bind(this)),this.registerTableFunction("navigateUp",this.navigateUp.bind(this)),this.registerTableFunction("navigateDown",this.navigateDown.bind(this)),this.registerComponentFunction("cell","isEdited",this.cellIsEdited.bind(this)),this.registerComponentFunction("cell","clearEdited",this.clearEdited.bind(this)),this.registerComponentFunction("cell","edit",this.editCell.bind(this)),this.registerComponentFunction("cell","cancelEdit",this.cellCancelEdit.bind(this)),this.registerComponentFunction("cell","navigatePrev",this.navigatePrev.bind(this)),this.registerComponentFunction("cell","navigateNext",this.navigateNext.bind(this)),this.registerComponentFunction("cell","navigateLeft",this.navigateLeft.bind(this)),this.registerComponentFunction("cell","navigateRight",this.navigateRight.bind(this)),this.registerComponentFunction("cell","navigateUp",this.navigateUp.bind(this)),this.registerComponentFunction("cell","navigateDown",this.navigateDown.bind(this))}initialize(){this.subscribe("cell-init",this.bindEditor.bind(this)),this.subscribe("cell-delete",this.clearEdited.bind(this)),this.subscribe("cell-value-changed",this.updateCellClass.bind(this)),this.subscribe("column-layout",this.initializeColumnCheck.bind(this)),this.subscribe("column-delete",this.columnDeleteCheck.bind(this)),this.subscribe("row-deleting",this.rowDeleteCheck.bind(this)),this.subscribe("row-layout",this.rowEditableCheck.bind(this)),this.subscribe("data-refreshing",this.cancelEdit.bind(this)),this.subscribe("clipboard-paste",this.pasteBlocker.bind(this)),this.subscribe("keybinding-nav-prev",this.navigatePrev.bind(this,void 0)),this.subscribe("keybinding-nav-next",this.keybindingNavigateNext.bind(this)),this.subscribe("keybinding-nav-up",this.navigateUp.bind(this,void 0)),this.subscribe("keybinding-nav-down",this.navigateDown.bind(this,void 0)),Object.keys(this.table.options).includes("editorEmptyValue")&&(this.convertEmptyValues=!0)}pasteBlocker(e){if(this.currentCell)return!0}keybindingNavigateNext(e){var i=this.currentCell,n=this.options("tabEndNewRow");i&&(this.navigateNext(i,e)||n&&(i.getElement().firstChild.blur(),this.invalidEdit||(n===!0?n=this.table.addRow({}):typeof n=="function"?n=this.table.addRow(n(i.row.getComponent())):n=this.table.addRow(Object.assign({},n)),n.then(()=>{setTimeout(()=>{i.getComponent().navigateNext()})}))))}cellIsEdited(e){return!!e.modules.edit&&e.modules.edit.edited}cellCancelEdit(e){e===this.currentCell?this.table.modules.edit.cancelEdit():console.warn("Cancel Editor Error - This cell is not currently being edited ")}updateCellClass(e){this.allowEdit(e)?e.getElement().classList.add("tabulator-editable"):e.getElement().classList.remove("tabulator-editable")}clearCellEdited(e){e||(e=this.table.modules.edit.getEditedCells()),Array.isArray(e)||(e=[e]),e.forEach(i=>{this.table.modules.edit.clearEdited(i._getSelf())})}navigatePrev(e=this.currentCell,i){var n,r;if(e){if(i&&i.preventDefault(),n=this.navigateLeft(),n)return!0;if(r=this.table.rowManager.prevDisplayRow(e.row,!0),r&&(n=this.findPrevEditableCell(r,r.cells.length),n))return n.getComponent().edit(),!0}return!1}navigateNext(e=this.currentCell,i){var n,r;if(e){if(i&&i.preventDefault(),n=this.navigateRight(),n)return!0;if(r=this.table.rowManager.nextDisplayRow(e.row,!0),r&&(n=this.findNextEditableCell(r,-1),n))return n.getComponent().edit(),!0}return!1}navigateLeft(e=this.currentCell,i){var n,r;return e&&(i&&i.preventDefault(),n=e.getIndex(),r=this.findPrevEditableCell(e.row,n),r)?(r.getComponent().edit(),!0):!1}navigateRight(e=this.currentCell,i){var n,r;return e&&(i&&i.preventDefault(),n=e.getIndex(),r=this.findNextEditableCell(e.row,n),r)?(r.getComponent().edit(),!0):!1}navigateUp(e=this.currentCell,i){var n,r;return e&&(i&&i.preventDefault(),n=e.getIndex(),r=this.table.rowManager.prevDisplayRow(e.row,!0),r)?(r.cells[n].getComponent().edit(),!0):!1}navigateDown(e=this.currentCell,i){var n,r;return e&&(i&&i.preventDefault(),n=e.getIndex(),r=this.table.rowManager.nextDisplayRow(e.row,!0),r)?(r.cells[n].getComponent().edit(),!0):!1}findNextEditableCell(e,i){var n=!1;if(i<e.cells.length-1)for(var r=i+1;r<e.cells.length;r++){let a=e.cells[r];if(a.column.modules.edit&&io.elVisible(a.getElement())&&this.allowEdit(a)){n=a;break}}return n}findPrevEditableCell(e,i){var n=!1;if(i>0)for(var r=i-1;r>=0;r--){let a=e.cells[r];if(a.column.modules.edit&&io.elVisible(a.getElement())&&this.allowEdit(a)){n=a;break}}return n}initializeColumnCheck(e){typeof e.definition.editor<"u"&&this.initializeColumn(e)}columnDeleteCheck(e){this.currentCell&&this.currentCell.column===e&&this.cancelEdit()}rowDeleteCheck(e){this.currentCell&&this.currentCell.row===e&&this.cancelEdit()}rowEditableCheck(e){e.getCells().forEach(i=>{i.column.modules.edit&&typeof i.column.modules.edit.check=="function"&&this.updateCellClass(i)})}initializeColumn(e){var i=Object.keys(e.definition).includes("editorEmptyValue"),n={editor:!1,blocked:!1,check:e.definition.editable,params:e.definition.editorParams||{},convertEmptyValues:i,editorEmptyValue:e.definition.editorEmptyValue,editorEmptyValueFunc:e.definition.editorEmptyValueFunc};switch(typeof e.definition.editor){case"string":this.editors[e.definition.editor]?n.editor=this.editors[e.definition.editor]:console.warn("Editor Error - No such editor found: ",e.definition.editor);break;case"function":n.editor=e.definition.editor;break;case"boolean":e.definition.editor===!0&&(typeof e.definition.formatter!="function"?this.editors[e.definition.formatter]?n.editor=this.editors[e.definition.formatter]:n.editor=this.editors.input:console.warn("Editor Error - Cannot auto lookup editor for a custom formatter: ",e.definition.formatter));break}n.editor&&(e.modules.edit=n)}getCurrentCell(){return this.currentCell?this.currentCell.getComponent():!1}clearEditor(e){var i=this.currentCell,n;if(this.invalidEdit=!1,i){for(this.currentCell=!1,n=i.getElement(),this.dispatch("edit-editor-clear",i,e),n.classList.remove("tabulator-editing");n.firstChild;)n.removeChild(n.firstChild);i.row.getElement().classList.remove("tabulator-editing"),i.table.element.classList.remove("tabulator-editing")}}cancelEdit(){if(this.currentCell){var e=this.currentCell,i=this.currentCell.getComponent();this.clearEditor(!0),e.setValueActual(e.getValue()),e.cellRendered(),(e.column.definition.editor=="textarea"||e.column.definition.variableHeight)&&e.row.normalizeHeight(!0),e.column.definition.cellEditCancelled&&e.column.definition.cellEditCancelled.call(this.table,i),this.dispatch("edit-cancelled",e),this.dispatchExternal("cellEditCancelled",i)}}bindEditor(e){if(e.column.modules.edit){var i=this,n=e.getElement(!0);this.updateCellClass(e),n.setAttribute("tabindex",0),n.addEventListener("mousedown",function(r){r.button===2?r.preventDefault():i.mouseClick=!0}),this.options("editTriggerEvent")==="dblclick"&&n.addEventListener("dblclick",function(r){n.classList.contains("tabulator-editing")||(n.focus({preventScroll:!0}),i.edit(e,r,!1))}),(this.options("editTriggerEvent")==="focus"||this.options("editTriggerEvent")==="click")&&n.addEventListener("click",function(r){n.classList.contains("tabulator-editing")||(n.focus({preventScroll:!0}),i.edit(e,r,!1))}),this.options("editTriggerEvent")==="focus"&&n.addEventListener("focus",function(r){i.recursionBlock||i.edit(e,r,!1)})}}focusCellNoEvent(e,i){this.recursionBlock=!0,i&&this.table.browser==="ie"||e.getElement().focus({preventScroll:!0}),this.recursionBlock=!1}editCell(e,i){this.focusCellNoEvent(e),this.edit(e,!1,i)}focusScrollAdjust(e){if(this.table.rowManager.getRenderMode()=="virtual"){var i=this.table.rowManager.element.scrollTop,n=this.table.rowManager.element.clientHeight+this.table.rowManager.element.scrollTop,r=e.row.getElement();r.offsetTop<i?this.table.rowManager.element.scrollTop-=i-r.offsetTop:r.offsetTop+r.offsetHeight>n&&(this.table.rowManager.element.scrollTop+=r.offsetTop+r.offsetHeight-n);var a=this.table.rowManager.element.scrollLeft,o=this.table.rowManager.element.clientWidth+this.table.rowManager.element.scrollLeft,s=e.getElement();this.table.modExists("frozenColumns")&&(a+=parseInt(this.table.modules.frozenColumns.leftMargin||0),o-=parseInt(this.table.modules.frozenColumns.rightMargin||0)),this.table.options.renderHorizontal==="virtual"&&(a-=parseInt(this.table.columnManager.renderer.vDomPadLeft),o-=parseInt(this.table.columnManager.renderer.vDomPadLeft)),s.offsetLeft<a?this.table.rowManager.element.scrollLeft-=a-s.offsetLeft:s.offsetLeft+s.offsetWidth>o&&(this.table.rowManager.element.scrollLeft+=s.offsetLeft+s.offsetWidth-o)}}allowEdit(e){var i=!!e.column.modules.edit;if(e.column.modules.edit)switch(typeof e.column.modules.edit.check){case"function":e.row.initialized&&(i=e.column.modules.edit.check(e.getComponent()));break;case"string":i=!!e.row.data[e.column.modules.edit.check];break;case"boolean":i=e.column.modules.edit.check;break}return i}edit(e,i,n){var r=this,a=!0,o=function(){},s=e.getElement(),l=!1,c,u,d;if(this.currentCell){!this.invalidEdit&&this.currentCell!==e&&this.cancelEdit();return}function p(v){if(r.currentCell===e&&!l){var y=r.chain("edit-success",[e,v],!0,!0);return y===!0||r.table.options.validationMode==="highlight"?(l=!0,r.clearEditor(),e.modules.edit||(e.modules.edit={}),e.modules.edit.edited=!0,r.editedCells.indexOf(e)==-1&&r.editedCells.push(e),v=r.transformEmptyValues(v,e),e.setValue(v,!0),y===!0):(l=!0,r.invalidEdit=!0,r.focusCellNoEvent(e,!0),o(),setTimeout(()=>{l=!1},10),!1)}}function h(){r.currentCell===e&&!l&&r.cancelEdit()}function f(v){o=v}if(e.column.modules.edit.blocked)return this.mouseClick=!1,this.blur(s),!1;if(i&&i.stopPropagation(),a=this.allowEdit(e),a||n){if(r.cancelEdit(),r.currentCell=e,this.focusScrollAdjust(e),u=e.getComponent(),this.mouseClick&&(this.mouseClick=!1,e.column.definition.cellClick&&e.column.definition.cellClick.call(this.table,i,u)),e.column.definition.cellEditing&&e.column.definition.cellEditing.call(this.table,u),this.dispatch("cell-editing",e),this.dispatchExternal("cellEditing",u),d=typeof e.column.modules.edit.params=="function"?e.column.modules.edit.params(u):e.column.modules.edit.params,c=e.column.modules.edit.editor.call(r,u,f,p,h,d),this.currentCell&&c!==!1)if(c instanceof Node){for(s.classList.add("tabulator-editing"),e.row.getElement().classList.add("tabulator-editing"),e.table.element.classList.add("tabulator-editing");s.firstChild;)s.removeChild(s.firstChild);s.appendChild(c),o();for(var m=s.children,g=0;g<m.length;g++)m[g].addEventListener("click",function(v){v.stopPropagation()})}else return console.warn("Edit Error - Editor should return an instance of Node, the editor returned:",c),this.blur(s),!1;else return this.blur(s),!1;return!0}else return this.mouseClick=!1,this.blur(s),!1}emptyValueCheck(e){return e===""||e===null||typeof e>"u"}transformEmptyValues(e,i){var n=i.column.modules.edit,r=n.convertEmptyValues||this.convertEmptyValues,a;return r&&(a=n.editorEmptyValueFunc||this.options("editorEmptyValueFunc"),a&&a(e)&&(e=n.convertEmptyValues?n.editorEmptyValue:this.options("editorEmptyValue"))),e}blur(e){this.confirm("edit-blur",[e])||e.blur()}getEditedCells(){var e=[];return this.editedCells.forEach(i=>{e.push(i.getComponent())}),e}clearEdited(e){var i;e.modules.edit&&e.modules.edit.edited&&(e.modules.edit.edited=!1,this.dispatch("edit-edited-clear",e)),i=this.editedCells.indexOf(e),i>-1&&this.editedCells.splice(i,1)}};Je(pD,"moduleName","edit"),Je(pD,"editors",XKe);let Jj=pD;class KX{constructor(e,i,n,r){this.type=e,this.columns=i,this.component=n||!1,this.indent=r||0}}class T${constructor(e,i,n,r,a){this.value=e,this.component=i||!1,this.width=n,this.height=r,this.depth=a}}var JKe={},QKe={visible:function(){return this.rowManager.getVisibleRows(!1,!0)},all:function(){return this.rowManager.rows},selected:function(){return this.modules.selectRow.selectedRows},active:function(){return this.options.pagination?this.rowManager.getDisplayRows(this.rowManager.displayRows.length-2):this.rowManager.getDisplayRows()}};const yv=class yv extends Wn{constructor(e){super(e),this.config={},this.cloneTableStyle=!0,this.colVisProp="",this.colVisPropAttach="",this.registerTableOption("htmlOutputConfig",!1),this.registerColumnOption("htmlOutput"),this.registerColumnOption("titleHtmlOutput")}initialize(){this.registerTableFunction("getHtml",this.getHtml.bind(this))}generateExportList(e,i,n,r){var a,o,s,l;return this.cloneTableStyle=i,this.config=e||{},this.colVisProp=r,this.colVisPropAttach=this.colVisProp.charAt(0).toUpperCase()+this.colVisProp.slice(1),l=yv.columnLookups[n],l&&(s=l.call(this.table),s=s.filter(c=>this.columnVisCheck(c))),a=this.config.columnHeaders!==!1?this.headersToExportRows(this.generateColumnGroupHeaders(s)):[],s&&(s=s.map(c=>c.getComponent())),o=this.bodyToExportRows(this.rowLookup(n),s),a.concat(o)}generateTable(e,i,n,r){var a=this.generateExportList(e,i,n,r);return this.generateTableElement(a)}rowLookup(e){var i=[],n;return typeof e=="function"?e.call(this.table).forEach(r=>{r=this.table.rowManager.findRow(r),r&&i.push(r)}):(n=yv.rowLookups[e]||yv.rowLookups.active,i=n.call(this.table)),Object.assign([],i)}generateColumnGroupHeaders(e){var i=[];return e||(e=this.config.columnGroups!==!1?this.table.columnManager.columns:this.table.columnManager.columnsByIndex),e.forEach(n=>{var r=this.processColumnGroup(n);r&&i.push(r)}),i}processColumnGroup(e){var i=e.columns,n=0,r=e.definition["title"+this.colVisPropAttach]||e.definition.title,a={title:r,column:e,depth:1};if(i.length){if(a.subGroups=[],a.width=0,i.forEach(o=>{var s=this.processColumnGroup(o);s&&(a.width+=s.width,a.subGroups.push(s),s.depth>n&&(n=s.depth))}),a.depth+=n,!a.width)return!1}else if(this.columnVisCheck(e))a.width=1;else return!1;return a}columnVisCheck(e){var i=e.definition[this.colVisProp];return this.config.rowHeaders===!1&&e.isRowHeader?!1:(typeof i=="function"&&(i=i.call(this.table,e.getComponent())),i===!1||i===!0?i:e.visible&&e.field)}headersToExportRows(e){var i=[],n=0,r=[];function a(o,s){var l=n-s;if(typeof i[s]>"u"&&(i[s]=[]),o.height=o.subGroups?1:l-o.depth+1,i[s].push(o),o.height>1)for(let c=1;c<o.height;c++)typeof i[s+c]>"u"&&(i[s+c]=[]),i[s+c].push(!1);if(o.width>1)for(let c=1;c<o.width;c++)i[s].push(!1);o.subGroups&&o.subGroups.forEach(function(c){a(c,s+1)})}return e.forEach(function(o){o.depth>n&&(n=o.depth)}),e.forEach(function(o){a(o,0)}),i.forEach(o=>{var s=[];o.forEach(l=>{if(l){let c=typeof l.title>"u"?"":l.title;s.push(new T$(c,l.column.getComponent(),l.width,l.height,l.depth))}else s.push(null)}),r.push(new KX("header",s))}),r}bodyToExportRows(e,i=[]){var n=[];return i.length===0&&this.table.columnManager.columnsByIndex.forEach(r=>{this.columnVisCheck(r)&&i.push(r.getComponent())}),this.config.columnCalcs!==!1&&this.table.modExists("columnCalcs")&&(this.table.modules.columnCalcs.topInitialized&&e.unshift(this.table.modules.columnCalcs.topRow),this.table.modules.columnCalcs.botInitialized&&e.push(this.table.modules.columnCalcs.botRow)),e=e.filter(r=>{switch(r.type){case"group":return this.config.rowGroups!==!1;case"calc":return this.config.columnCalcs!==!1;case"row":return!(this.table.options.dataTree&&this.config.dataTree===!1&&r.modules.dataTree.parent)}return!0}),e.forEach((r,a)=>{var o=r.getData(this.colVisProp),s=[],l=0;switch(r.type){case"group":l=r.level,s.push(new T$(r.key,r.getComponent(),i.length,1));break;case"calc":case"row":i.forEach(c=>{s.push(new T$(c._column.getFieldValue(o),c,1,1))}),this.table.options.dataTree&&this.config.dataTree!==!1&&(l=r.modules.dataTree.index);break}n.push(new KX(r.type,s,r.getComponent(),l))}),n}generateTableElement(e){var i=document.createElement("table"),n=document.createElement("thead"),r=document.createElement("tbody"),a=this.lookupTableStyles(),o=this.table.options["rowFormatter"+this.colVisPropAttach],s={};return s.rowFormatter=o!==null?o:this.table.options.rowFormatter,this.table.options.dataTree&&this.config.dataTree!==!1&&this.table.modExists("columnCalcs")&&(s.treeElementField=this.table.modules.dataTree.elementField),s.groupHeader=this.table.options["groupHeader"+this.colVisPropAttach],s.groupHeader&&!Array.isArray(s.groupHeader)&&(s.groupHeader=[s.groupHeader]),i.classList.add("tabulator-print-table"),this.mapElementStyles(this.table.columnManager.getHeadersElement(),n,["border-top","border-left","border-right","border-bottom","background-color","color","font-weight","font-family","font-size"]),e.length>1e3&&console.warn("It may take a long time to render an HTML table with more than 1000 rows"),e.forEach((l,c)=>{let u;switch(l.type){case"header":n.appendChild(this.generateHeaderElement(l,s,a));break;case"group":r.appendChild(this.generateGroupElement(l,s,a));break;case"calc":r.appendChild(this.generateCalcElement(l,s,a));break;case"row":u=this.generateRowElement(l,s,a),this.mapElementStyles(c%2&&a.evenRow?a.evenRow:a.oddRow,u,["border-top","border-left","border-right","border-bottom","color","font-weight","font-family","font-size","background-color"]),r.appendChild(u);break}}),n.innerHTML&&i.appendChild(n),i.appendChild(r),this.mapElementStyles(this.table.element,i,["border-top","border-left","border-right","border-bottom"]),i}lookupTableStyles(){var e={};return this.cloneTableStyle&&window.getComputedStyle&&(e.oddRow=this.table.element.querySelector(".tabulator-row-odd:not(.tabulator-group):not(.tabulator-calcs)"),e.evenRow=this.table.element.querySelector(".tabulator-row-even:not(.tabulator-group):not(.tabulator-calcs)"),e.calcRow=this.table.element.querySelector(".tabulator-row.tabulator-calcs"),e.firstRow=this.table.element.querySelector(".tabulator-row:not(.tabulator-group):not(.tabulator-calcs)"),e.firstGroup=this.table.element.getElementsByClassName("tabulator-group")[0],e.firstRow&&(e.styleCells=e.firstRow.getElementsByClassName("tabulator-cell"),e.styleRowHeader=e.firstRow.getElementsByClassName("tabulator-row-header")[0],e.firstCell=e.styleCells[0],e.lastCell=e.styleCells[e.styleCells.length-1])),e}generateHeaderElement(e,i,n){var r=document.createElement("tr");return e.columns.forEach(a=>{if(a){var o=document.createElement("th"),s=a.component._column.definition.cssClass?a.component._column.definition.cssClass.split(" "):[];o.colSpan=a.width,o.rowSpan=a.height,o.innerHTML=a.value,this.cloneTableStyle&&(o.style.boxSizing="border-box"),s.forEach(function(l){o.classList.add(l)}),this.mapElementStyles(a.component.getElement(),o,["text-align","border-left","border-right","background-color","color","font-weight","font-family","font-size"]),this.mapElementStyles(a.component._column.contentElement,o,["padding-top","padding-left","padding-right","padding-bottom"]),a.component._column.visible?this.mapElementStyles(a.component.getElement(),o,["width"]):a.component._column.definition.width&&(o.style.width=a.component._column.definition.width+"px"),a.component._column.parent&&a.component._column.parent.isGroup?this.mapElementStyles(a.component._column.parent.groupElement,o,["border-top"]):this.mapElementStyles(a.component.getElement(),o,["border-top"]),a.component._column.isGroup?this.mapElementStyles(a.component.getElement(),o,["border-bottom"]):this.mapElementStyles(this.table.columnManager.getElement(),o,["border-bottom"]),r.appendChild(o)}}),r}generateGroupElement(e,i,n){var r=document.createElement("tr"),a=document.createElement("td"),o=e.columns[0];return r.classList.add("tabulator-print-table-row"),i.groupHeader&&i.groupHeader[e.indent]?o.value=i.groupHeader[e.indent](o.value,e.component._group.getRowCount(),e.component._group.getData(),e.component):i.groupHeader!==!1&&(o.value=e.component._group.generator(o.value,e.component._group.getRowCount(),e.component._group.getData(),e.component)),a.colSpan=o.width,a.innerHTML=o.value,r.classList.add("tabulator-print-table-group"),r.classList.add("tabulator-group-level-"+e.indent),o.component.isVisible()&&r.classList.add("tabulator-group-visible"),this.mapElementStyles(n.firstGroup,r,["border-top","border-left","border-right","border-bottom","color","font-weight","font-family","font-size","background-color"]),this.mapElementStyles(n.firstGroup,a,["padding-top","padding-left","padding-right","padding-bottom"]),r.appendChild(a),r}generateCalcElement(e,i,n){var r=this.generateRowElement(e,i,n);return r.classList.add("tabulator-print-table-calcs"),this.mapElementStyles(n.calcRow,r,["border-top","border-left","border-right","border-bottom","color","font-weight","font-family","font-size","background-color"]),r}generateRowElement(e,i,n){var r=document.createElement("tr");if(r.classList.add("tabulator-print-table-row"),e.columns.forEach((a,o)=>{if(a){var s=document.createElement("td"),l=a.component._column,c=this.table,u=c.columnManager.findColumnIndex(l),d=a.value,p,h,f={modules:{},getValue:function(){return d},getField:function(){return l.definition.field},getElement:function(){return s},getType:function(){return"cell"},getColumn:function(){return l.getComponent()},getData:function(){return e.component.getData()},getRow:function(){return e.component},getTable:function(){return c},getComponent:function(){return f},column:l},m=l.definition.cssClass?l.definition.cssClass.split(" "):[];if(m.forEach(function(g){s.classList.add(g)}),this.table.modExists("format")&&this.config.formatCells!==!1)d=this.table.modules.format.formatExportValue(f,this.colVisProp);else switch(typeof d){case"object":d=d!==null?JSON.stringify(d):"";break;case"undefined":d="";break}d instanceof Node?s.appendChild(d):s.innerHTML=d,h=["padding-top","padding-left","padding-right","padding-bottom","border-top","border-left","border-right","border-bottom","color","font-weight","font-family","font-size","text-align"],l.isRowHeader?(p=n.styleRowHeader,h.push("background-color")):p=n.styleCells&&n.styleCells[u]?n.styleCells[u]:n.firstCell,p&&(this.mapElementStyles(p,s,h),l.definition.align&&(s.style.textAlign=l.definition.align)),this.table.options.dataTree&&this.config.dataTree!==!1&&(i.treeElementField&&i.treeElementField==l.field||!i.treeElementField&&o==0)&&(e.component._row.modules.dataTree.controlEl&&s.insertBefore(e.component._row.modules.dataTree.controlEl.cloneNode(!0),s.firstChild),e.component._row.modules.dataTree.branchEl&&s.insertBefore(e.component._row.modules.dataTree.branchEl.cloneNode(!0),s.firstChild)),r.appendChild(s),f.modules.format&&f.modules.format.renderedCallback&&f.modules.format.renderedCallback()}}),i.rowFormatter&&e.type==="row"&&this.config.formatCells!==!1){let a=Object.assign(e.component);a.getElement=function(){return r},i.rowFormatter(e.component)}return r}generateHTMLTable(e){var i=document.createElement("div");return i.appendChild(this.generateTableElement(e)),i.innerHTML}getHtml(e,i,n,r){var a=this.generateExportList(n||this.table.options.htmlOutputConfig,i,e,r||"htmlOutput");return this.generateHTMLTable(a)}mapElementStyles(e,i,n){if(this.cloneTableStyle&&e&&i){var r={"background-color":"backgroundColor",color:"fontColor",width:"width","font-weight":"fontWeight","font-family":"fontFamily","font-size":"fontSize","text-align":"textAlign","border-top":"borderTop","border-left":"borderLeft","border-right":"borderRight","border-bottom":"borderBottom","padding-top":"paddingTop","padding-left":"paddingLeft","padding-right":"paddingRight","padding-bottom":"paddingBottom"};if(window.getComputedStyle){var a=window.getComputedStyle(e);n.forEach(function(o){i.style[r[o]]||(i.style[r[o]]=a.getPropertyValue(o))})}}}};Je(yv,"moduleName","export"),Je(yv,"columnLookups",JKe),Je(yv,"rowLookups",QKe);let Qj=yv;var eYe={"=":function(t,e,i,n){return e==t},"<":function(t,e,i,n){return e<t},"<=":function(t,e,i,n){return e<=t},">":function(t,e,i,n){return e>t},">=":function(t,e,i,n){return e>=t},"!=":function(t,e,i,n){return e!=t},regex:function(t,e,i,n){return typeof t=="string"&&(t=new RegExp(t)),t.test(e)},like:function(t,e,i,n){return t===null||typeof t>"u"?e===t:typeof e<"u"&&e!==null?String(e).toLowerCase().indexOf(t.toLowerCase())>-1:!1},keywords:function(t,e,i,n){var r=t.toLowerCase().split(typeof n.separator>"u"?" ":n.separator),a=String(e===null||typeof e>"u"?"":e).toLowerCase(),o=[];return r.forEach(s=>{a.includes(s)&&o.push(!0)}),n.matchAll?o.length===r.length:!!o.length},starts:function(t,e,i,n){return t===null||typeof t>"u"?e===t:typeof e<"u"&&e!==null?String(e).toLowerCase().startsWith(t.toLowerCase()):!1},ends:function(t,e,i,n){return t===null||typeof t>"u"?e===t:typeof e<"u"&&e!==null?String(e).toLowerCase().endsWith(t.toLowerCase()):!1},in:function(t,e,i,n){return Array.isArray(t)?t.length?t.indexOf(e)>-1:!0:(console.warn("Filter Error - filter value is not an array:",t),!1)}};const _m=class _m extends Wn{constructor(e){super(e),this.filterList=[],this.headerFilters={},this.headerFilterColumns=[],this.prevHeaderFilterChangeCheck="",this.prevHeaderFilterChangeCheck="{}",this.changed=!1,this.tableInitialized=!1,this.registerTableOption("filterMode","local"),this.registerTableOption("initialFilter",!1),this.registerTableOption("initialHeaderFilter",!1),this.registerTableOption("headerFilterLiveFilterDelay",300),this.registerTableOption("placeholderHeaderFilter",!1),this.registerColumnOption("headerFilter"),this.registerColumnOption("headerFilterPlaceholder"),this.registerColumnOption("headerFilterParams"),this.registerColumnOption("headerFilterEmptyCheck"),this.registerColumnOption("headerFilterFunc"),this.registerColumnOption("headerFilterFuncParams"),this.registerColumnOption("headerFilterLiveFilter"),this.registerTableFunction("searchRows",this.searchRows.bind(this)),this.registerTableFunction("searchData",this.searchData.bind(this)),this.registerTableFunction("setFilter",this.userSetFilter.bind(this)),this.registerTableFunction("refreshFilter",this.userRefreshFilter.bind(this)),this.registerTableFunction("addFilter",this.userAddFilter.bind(this)),this.registerTableFunction("getFilters",this.getFilters.bind(this)),this.registerTableFunction("setHeaderFilterFocus",this.userSetHeaderFilterFocus.bind(this)),this.registerTableFunction("getHeaderFilterValue",this.userGetHeaderFilterValue.bind(this)),this.registerTableFunction("setHeaderFilterValue",this.userSetHeaderFilterValue.bind(this)),this.registerTableFunction("getHeaderFilters",this.getHeaderFilters.bind(this)),this.registerTableFunction("removeFilter",this.userRemoveFilter.bind(this)),this.registerTableFunction("clearFilter",this.userClearFilter.bind(this)),this.registerTableFunction("clearHeaderFilter",this.userClearHeaderFilter.bind(this)),this.registerComponentFunction("column","headerFilterFocus",this.setHeaderFilterFocus.bind(this)),this.registerComponentFunction("column","reloadHeaderFilter",this.reloadHeaderFilter.bind(this)),this.registerComponentFunction("column","getHeaderFilterValue",this.getHeaderFilterValue.bind(this)),this.registerComponentFunction("column","setHeaderFilterValue",this.setHeaderFilterValue.bind(this))}initialize(){this.subscribe("column-init",this.initializeColumnHeaderFilter.bind(this)),this.subscribe("column-width-fit-before",this.hideHeaderFilterElements.bind(this)),this.subscribe("column-width-fit-after",this.showHeaderFilterElements.bind(this)),this.subscribe("table-built",this.tableBuilt.bind(this)),this.subscribe("placeholder",this.generatePlaceholder.bind(this)),this.table.options.filterMode==="remote"&&this.subscribe("data-params",this.remoteFilterParams.bind(this)),this.registerDataHandler(this.filter.bind(this),10)}tableBuilt(){this.table.options.initialFilter&&this.setFilter(this.table.options.initialFilter),this.table.options.initialHeaderFilter&&this.table.options.initialHeaderFilter.forEach(e=>{var i=this.table.columnManager.findColumn(e.field);if(i)this.setHeaderFilterValue(i,e.value);else return console.warn("Column Filter Error - No matching column found:",e.field),!1}),this.tableInitialized=!0}remoteFilterParams(e,i,n,r){return r.filter=this.getFilters(!0,!0),r}generatePlaceholder(e){if(this.table.options.placeholderHeaderFilter&&Object.keys(this.headerFilters).length)return this.table.options.placeholderHeaderFilter}userSetFilter(e,i,n,r){this.setFilter(e,i,n,r),this.refreshFilter()}userRefreshFilter(){this.refreshFilter()}userAddFilter(e,i,n,r){this.addFilter(e,i,n,r),this.refreshFilter()}userSetHeaderFilterFocus(e){var i=this.table.columnManager.findColumn(e);if(i)this.setHeaderFilterFocus(i);else return console.warn("Column Filter Focus Error - No matching column found:",e),!1}userGetHeaderFilterValue(e){var i=this.table.columnManager.findColumn(e);if(i)return this.getHeaderFilterValue(i);console.warn("Column Filter Error - No matching column found:",e)}userSetHeaderFilterValue(e,i){var n=this.table.columnManager.findColumn(e);if(n)this.setHeaderFilterValue(n,i);else return console.warn("Column Filter Error - No matching column found:",e),!1}userRemoveFilter(e,i,n){this.removeFilter(e,i,n),this.refreshFilter()}userClearFilter(e){this.clearFilter(e),this.refreshFilter()}userClearHeaderFilter(){this.clearHeaderFilter(),this.refreshFilter()}searchRows(e,i,n){return this.search("rows",e,i,n)}searchData(e,i,n){return this.search("data",e,i,n)}initializeColumnHeaderFilter(e){var i=e.definition;i.headerFilter&&this.initializeColumn(e)}initializeColumn(e,i){var n=this,r=e.getField();function a(o){var s=e.modules.filter.tagType=="input"&&e.modules.filter.attrType=="text"||e.modules.filter.tagType=="textarea"?"partial":"match",l="",c="",u;if(typeof e.modules.filter.prevSuccess>"u"||e.modules.filter.prevSuccess!==o){if(e.modules.filter.prevSuccess=o,e.modules.filter.emptyFunc(o))delete n.headerFilters[r];else{switch(e.modules.filter.value=o,typeof e.definition.headerFilterFunc){case"string":_m.filters[e.definition.headerFilterFunc]?(l=e.definition.headerFilterFunc,u=function(d){var p=e.definition.headerFilterFuncParams||{},h=e.getFieldValue(d);return p=typeof p=="function"?p(o,h,d):p,_m.filters[e.definition.headerFilterFunc](o,h,d,p)}):console.warn("Header Filter Error - Matching filter function not found: ",e.definition.headerFilterFunc);break;case"function":u=function(d){var p=e.definition.headerFilterFuncParams||{},h=e.getFieldValue(d);return p=typeof p=="function"?p(o,h,d):p,e.definition.headerFilterFunc(o,h,d,p)},l=u;break}if(!u)switch(s){case"partial":u=function(d){var p=e.getFieldValue(d);return typeof p<"u"&&p!==null?String(p).toLowerCase().indexOf(String(o).toLowerCase())>-1:!1},l="like";break;default:u=function(d){return e.getFieldValue(d)==o},l="="}n.headerFilters[r]={value:o,func:u,type:l}}e.modules.filter.value=o,c=JSON.stringify(n.headerFilters),n.prevHeaderFilterChangeCheck!==c&&(n.prevHeaderFilterChangeCheck=c,n.trackChanges(),n.refreshFilter())}return!0}e.modules.filter={success:a,attrType:!1,tagType:!1,emptyFunc:!1},this.generateHeaderFilterElement(e)}generateHeaderFilterElement(e,i,n){var r=this,a=e.modules.filter.success,o=e.getField(),s,l,c,u,d,p,h,f;e.modules.filter.value=i;function m(){}function g(v){f=v}if(e.modules.filter.headerElement&&e.modules.filter.headerElement.parentNode&&e.contentElement.removeChild(e.modules.filter.headerElement.parentNode),o){switch(e.modules.filter.emptyFunc=e.definition.headerFilterEmptyCheck||function(v){return!v&&v!==0},s=document.createElement("div"),s.classList.add("tabulator-header-filter"),typeof e.definition.headerFilter){case"string":r.table.modules.edit.editors[e.definition.headerFilter]?(l=r.table.modules.edit.editors[e.definition.headerFilter],(e.definition.headerFilter==="tick"||e.definition.headerFilter==="tickCross")&&!e.definition.headerFilterEmptyCheck&&(e.modules.filter.emptyFunc=function(v){return v!==!0&&v!==!1})):console.warn("Filter Error - Cannot build header filter, No such editor found: ",e.definition.editor);break;case"function":l=e.definition.headerFilter;break;case"boolean":e.modules.edit&&e.modules.edit.editor?l=e.modules.edit.editor:e.definition.formatter&&r.table.modules.edit.editors[e.definition.formatter]?(l=r.table.modules.edit.editors[e.definition.formatter],(e.definition.formatter==="tick"||e.definition.formatter==="tickCross")&&!e.definition.headerFilterEmptyCheck&&(e.modules.filter.emptyFunc=function(v){return v!==!0&&v!==!1})):l=r.table.modules.edit.editors.input;break}if(l){if(u={getValue:function(){return typeof i<"u"?i:""},getField:function(){return e.definition.field},getElement:function(){return s},getColumn:function(){return e.getComponent()},getTable:()=>this.table,getType:()=>"header",getRow:function(){return{normalizeHeight:function(){}}}},h=e.definition.headerFilterParams||{},h=typeof h=="function"?h.call(r.table,u):h,c=l.call(this.table.modules.edit,u,g,a,m,h),!c){console.warn("Filter Error - Cannot add filter to "+o+" column, editor returned a value of false");return}if(!(c instanceof Node)){console.warn("Filter Error - Cannot add filter to "+o+" column, editor should return an instance of Node, the editor returned:",c);return}r.langBind("headerFilters|columns|"+e.definition.field,function(v){c.setAttribute("placeholder",typeof v<"u"&&v?v:e.definition.headerFilterPlaceholder||r.langText("headerFilters|default"))}),c.addEventListener("click",function(v){v.stopPropagation(),c.focus()}),c.addEventListener("focus",v=>{var y=this.table.columnManager.contentsElement.scrollLeft,b=this.table.rowManager.element.scrollLeft;y!==b&&(this.table.rowManager.scrollHorizontal(y),this.table.columnManager.scrollHorizontal(y))}),d=!1,p=function(v){d&&clearTimeout(d),d=setTimeout(function(){a(c.value)},r.table.options.headerFilterLiveFilterDelay)},e.modules.filter.headerElement=c,e.modules.filter.attrType=c.hasAttribute("type")?c.getAttribute("type").toLowerCase():"",e.modules.filter.tagType=c.tagName.toLowerCase(),e.definition.headerFilterLiveFilter!==!1&&(e.definition.headerFilter==="autocomplete"||e.definition.headerFilter==="tickCross"||(e.definition.editor==="autocomplete"||e.definition.editor==="tickCross")&&e.definition.headerFilter===!0||(c.addEventListener("keyup",p),c.addEventListener("search",p),e.modules.filter.attrType=="number"&&c.addEventListener("change",function(v){a(c.value)}),e.modules.filter.attrType=="text"&&this.table.browser!=="ie"&&c.setAttribute("type","search")),(e.modules.filter.tagType=="input"||e.modules.filter.tagType=="select"||e.modules.filter.tagType=="textarea")&&c.addEventListener("mousedown",function(v){v.stopPropagation()})),s.appendChild(c),e.contentElement.appendChild(s),n||r.headerFilterColumns.push(e),f&&f()}}else console.warn("Filter Error - Cannot add header filter, column has no field set:",e.definition.title)}hideHeaderFilterElements(){this.headerFilterColumns.forEach(function(e){e.modules.filter&&e.modules.filter.headerElement&&(e.modules.filter.headerElement.style.display="none")})}showHeaderFilterElements(){this.headerFilterColumns.forEach(function(e){e.modules.filter&&e.modules.filter.headerElement&&(e.modules.filter.headerElement.style.display="")})}setHeaderFilterFocus(e){e.modules.filter&&e.modules.filter.headerElement?e.modules.filter.headerElement.focus():console.warn("Column Filter Focus Error - No header filter set on column:",e.getField())}getHeaderFilterValue(e){if(e.modules.filter&&e.modules.filter.headerElement)return e.modules.filter.value;console.warn("Column Filter Error - No header filter set on column:",e.getField())}setHeaderFilterValue(e,i){e&&(e.modules.filter&&e.modules.filter.headerElement?(this.generateHeaderFilterElement(e,i,!0),e.modules.filter.success(i)):console.warn("Column Filter Error - No header filter set on column:",e.getField()))}reloadHeaderFilter(e){e&&(e.modules.filter&&e.modules.filter.headerElement?this.generateHeaderFilterElement(e,e.modules.filter.value,!0):console.warn("Column Filter Error - No header filter set on column:",e.getField()))}refreshFilter(){this.tableInitialized&&(this.table.options.filterMode==="remote"?this.reloadData(null,!1,!1):this.refreshData(!0))}trackChanges(){this.changed=!0,this.dispatch("filter-changed")}hasChanged(){var e=this.changed;return this.changed=!1,e}setFilter(e,i,n,r){this.filterList=[],Array.isArray(e)||(e=[{field:e,type:i,value:n,params:r}]),this.addFilter(e)}addFilter(e,i,n,r){var a=!1;Array.isArray(e)||(e=[{field:e,type:i,value:n,params:r}]),e.forEach(o=>{o=this.findFilter(o),o&&(this.filterList.push(o),a=!0)}),a&&this.trackChanges()}findFilter(e){var i;if(Array.isArray(e))return this.findSubFilters(e);var n=!1;return typeof e.field=="function"?n=function(r){return e.field(r,e.type||{})}:_m.filters[e.type]?(i=this.table.columnManager.getColumnByField(e.field),i?n=function(r){return _m.filters[e.type](e.value,i.getFieldValue(r),r,e.params||{})}:n=function(r){return _m.filters[e.type](e.value,r[e.field],r,e.params||{})}):console.warn("Filter Error - No such filter type found, ignoring: ",e.type),e.func=n,e.func?e:!1}findSubFilters(e){var i=[];return e.forEach(n=>{n=this.findFilter(n),n&&i.push(n)}),i.length?i:!1}getFilters(e,i){var n=[];return e&&(n=this.getHeaderFilters()),i&&n.forEach(function(r){typeof r.type=="function"&&(r.type="function")}),n=n.concat(this.filtersToArray(this.filterList,i)),n}filtersToArray(e,i){var n=[];return e.forEach(r=>{var a;Array.isArray(r)?n.push(this.filtersToArray(r,i)):(a={field:r.field,type:r.type,value:r.value},i&&typeof a.type=="function"&&(a.type="function"),n.push(a))}),n}getHeaderFilters(){var e=[];for(var i in this.headerFilters)e.push({field:i,type:this.headerFilters[i].type,value:this.headerFilters[i].value});return e}removeFilter(e,i,n){Array.isArray(e)||(e=[{field:e,type:i,value:n}]),e.forEach(r=>{var a=-1;typeof r.field=="object"?a=this.filterList.findIndex(o=>r===o):a=this.filterList.findIndex(o=>r.field===o.field&&r.type===o.type&&r.value===o.value),a>-1?this.filterList.splice(a,1):console.warn("Filter Error - No matching filter type found, ignoring: ",r.type)}),this.trackChanges()}clearFilter(e){this.filterList=[],e&&this.clearHeaderFilter(),this.trackChanges()}clearHeaderFilter(){this.headerFilters={},this.prevHeaderFilterChangeCheck="{}",this.headerFilterColumns.forEach(e=>{typeof e.modules.filter.value<"u"&&delete e.modules.filter.value,e.modules.filter.prevSuccess=void 0,this.reloadHeaderFilter(e)}),this.trackChanges()}search(e,i,n,r){var a=[],o=[];return Array.isArray(i)||(i=[{field:i,type:n,value:r}]),i.forEach(s=>{s=this.findFilter(s),s&&o.push(s)}),this.table.rowManager.rows.forEach(s=>{var l=!0;o.forEach(c=>{this.filterRecurse(c,s.getData())||(l=!1)}),l&&a.push(e==="data"?s.getData("data"):s.getComponent())}),a}filter(e,i){var n=[],r=[];return this.subscribedExternal("dataFiltering")&&this.dispatchExternal("dataFiltering",this.getFilters(!0)),this.table.options.filterMode!=="remote"&&(this.filterList.length||Object.keys(this.headerFilters).length)?e.forEach(a=>{this.filterRow(a)&&n.push(a)}):n=e.slice(0),this.subscribedExternal("dataFiltered")&&(n.forEach(a=>{r.push(a.getComponent())}),this.dispatchExternal("dataFiltered",this.getFilters(!0),r)),n}filterRow(e,i){var n=!0,r=e.getData();this.filterList.forEach(o=>{this.filterRecurse(o,r)||(n=!1)});for(var a in this.headerFilters)this.headerFilters[a].func(r)||(n=!1);return n}filterRecurse(e,i){var n=!1;return Array.isArray(e)?e.forEach(r=>{this.filterRecurse(r,i)&&(n=!0)}):n=e.func(i),n}};Je(_m,"moduleName","filter"),Je(_m,"filters",eYe);let eG=_m;function tYe(t,e,i){return this.emptyToSpace(this.sanitizeHTML(t.getValue()))}function iYe(t,e,i){return t.getValue()}function nYe(t,e,i){return t.getElement().style.whiteSpace="pre-wrap",this.emptyToSpace(this.sanitizeHTML(t.getValue()))}function rYe(t,e,i){var n=parseFloat(t.getValue()),r="",a,o,s,l,c,u=e.decimal||".",d=e.thousand||",",p=e.negativeSign||"-",h=e.symbol||"",f=!!e.symbolAfter,m=typeof e.precision<"u"?e.precision:2;if(isNaN(n))return this.emptyToSpace(this.sanitizeHTML(t.getValue()));if(n<0&&(n=Math.abs(n),r=p),a=m!==!1?n.toFixed(m):n,a=String(a).split("."),o=a[0],s=a.length>1?u+a[1]:"",e.thousand!==!1)for(l=/(\d+)(\d{3})/;l.test(o);)o=o.replace(l,"$1"+d+"$2");return c=o+s,r===!0?(c="("+c+")",f?c+h:h+c):f?r+c+h:r+h+c}function aYe(t,e,i){var n=t.getValue(),r=e.urlPrefix||"",a=e.download,o=n,s=document.createElement("a"),l;function c(u,d){var p=u.shift(),h=d[p];return u.length&&typeof h=="object"?c(u,h):h}if(e.labelField&&(l=t.getData(),o=c(e.labelField.split(this.table.options.nestedFieldSeparator),l)),e.label)switch(typeof e.label){case"string":o=e.label;break;case"function":o=e.label(t);break}if(o){if(e.urlField&&(l=t.getData(),n=io.retrieveNestedData(this.table.options.nestedFieldSeparator,e.urlField,l)),e.url)switch(typeof e.url){case"string":n=e.url;break;case"function":n=e.url(t);break}return s.setAttribute("href",r+n),e.target&&s.setAttribute("target",e.target),e.download&&(typeof a=="function"?a=a(t):a=a===!0?"":a,s.setAttribute("download",a)),s.innerHTML=this.emptyToSpace(this.sanitizeHTML(o)),s}else return"&nbsp;"}function oYe(t,e,i){var n=document.createElement("img"),r=t.getValue();switch(e.urlPrefix&&(r=e.urlPrefix+t.getValue()),e.urlSuffix&&(r=r+e.urlSuffix),n.setAttribute("src",r),typeof e.height){case"number":n.style.height=e.height+"px";break;case"string":n.style.height=e.height;break}switch(typeof e.width){case"number":n.style.width=e.width+"px";break;case"string":n.style.width=e.width;break}return n.addEventListener("load",function(){t.getRow().normalizeHeight()}),n}function sYe(t,e,i){var n=t.getValue(),r=t.getElement(),a=e.allowEmpty,o=e.allowTruthy,s=Object.keys(e).includes("trueValue"),l=typeof e.tickElement<"u"?e.tickElement:'<svg enable-background="new 0 0 24 24" height="14" width="14" viewBox="0 0 24 24" xml:space="preserve" ><path fill="#2DC214" clip-rule="evenodd" d="M21.652,3.211c-0.293-0.295-0.77-0.295-1.061,0L9.41,14.34  c-0.293,0.297-0.771,0.297-1.062,0L3.449,9.351C3.304,9.203,3.114,9.13,2.923,9.129C2.73,9.128,2.534,9.201,2.387,9.351  l-2.165,1.946C0.078,11.445,0,11.63,0,11.823c0,0.194,0.078,0.397,0.223,0.544l4.94,5.184c0.292,0.296,0.771,0.776,1.062,1.07  l2.124,2.141c0.292,0.293,0.769,0.293,1.062,0l14.366-14.34c0.293-0.294,0.293-0.777,0-1.071L21.652,3.211z" fill-rule="evenodd"/></svg>',c=typeof e.crossElement<"u"?e.crossElement:'<svg enable-background="new 0 0 24 24" height="14" width="14"  viewBox="0 0 24 24" xml:space="preserve" ><path fill="#CE1515" d="M22.245,4.015c0.313,0.313,0.313,0.826,0,1.139l-6.276,6.27c-0.313,0.312-0.313,0.826,0,1.14l6.273,6.272  c0.313,0.313,0.313,0.826,0,1.14l-2.285,2.277c-0.314,0.312-0.828,0.312-1.142,0l-6.271-6.271c-0.313-0.313-0.828-0.313-1.141,0  l-6.276,6.267c-0.313,0.313-0.828,0.313-1.141,0l-2.282-2.28c-0.313-0.313-0.313-0.826,0-1.14l6.278-6.269  c0.313-0.312,0.313-0.826,0-1.14L1.709,5.147c-0.314-0.313-0.314-0.827,0-1.14l2.284-2.278C4.308,1.417,4.821,1.417,5.135,1.73  L11.405,8c0.314,0.314,0.828,0.314,1.141,0.001l6.276-6.267c0.312-0.312,0.826-0.312,1.141,0L22.245,4.015z"/></svg>';return s&&n===e.trueValue||!s&&(o&&n||n===!0||n==="true"||n==="True"||n===1||n==="1")?(r.setAttribute("aria-checked",!0),l||""):a&&(n==="null"||n===""||n===null||typeof n>"u")?(r.setAttribute("aria-checked","mixed"),""):(r.setAttribute("aria-checked",!1),c||"")}function lYe(t,e,i){var n=window.DateTime||luxon.DateTime,r=e.inputFormat||"yyyy-MM-dd HH:mm:ss",a=e.outputFormat||"dd/MM/yyyy HH:mm:ss",o=typeof e.invalidPlaceholder<"u"?e.invalidPlaceholder:"",s=t.getValue();if(typeof n<"u"){var l;return n.isDateTime(s)?l=s:r==="iso"?l=n.fromISO(String(s)):l=n.fromFormat(String(s),r),l.isValid?(e.timezone&&(l=l.setZone(e.timezone)),l.toFormat(a)):o===!0||!s?s:typeof o=="function"?o(s):o}else console.error("Format Error - 'datetime' formatter is dependant on luxon.js")}function cYe(t,e,i){var n=window.DateTime||luxon.DateTime,r=e.inputFormat||"yyyy-MM-dd HH:mm:ss",a=typeof e.invalidPlaceholder<"u"?e.invalidPlaceholder:"",o=typeof e.suffix<"u"?e.suffix:!1,s=typeof e.unit<"u"?e.unit:"days",l=typeof e.humanize<"u"?e.humanize:!1,c=typeof e.date<"u"?e.date:n.now(),u=t.getValue();if(typeof n<"u"){var d;return n.isDateTime(u)?d=u:r==="iso"?d=n.fromISO(String(u)):d=n.fromFormat(String(u),r),d.isValid?l?d.diff(c,s).toHuman()+(o?" "+o:""):parseInt(d.diff(c,s)[s])+(o?" "+o:""):a===!0?u:typeof a=="function"?a(u):a}else console.error("Format Error - 'datetimediff' formatter is dependant on luxon.js")}function uYe(t,e,i){var n=t.getValue();return typeof e[n]>"u"?(console.warn("Missing display value for "+n),n):e[n]}function dYe(t,e,i){var n=t.getValue(),r=t.getElement(),a=e&&e.stars?e.stars:5,o=document.createElement("span"),s=document.createElementNS("http://www.w3.org/2000/svg","svg"),l='<polygon fill="#FFEA00" stroke="#C1AB60" stroke-width="37.6152" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" points="259.216,29.942 330.27,173.919 489.16,197.007 374.185,309.08 401.33,467.31 259.216,392.612 117.104,467.31 144.25,309.08 29.274,197.007 188.165,173.919 "/>',c='<polygon fill="#D2D2D2" stroke="#686868" stroke-width="37.6152" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" points="259.216,29.942 330.27,173.919 489.16,197.007 374.185,309.08 401.33,467.31 259.216,392.612 117.104,467.31 144.25,309.08 29.274,197.007 188.165,173.919 "/>';o.style.verticalAlign="middle",s.setAttribute("width","14"),s.setAttribute("height","14"),s.setAttribute("viewBox","0 0 512 512"),s.setAttribute("xml:space","preserve"),s.style.padding="0 1px",n=n&&!isNaN(n)?parseInt(n):0,n=Math.max(0,Math.min(n,a));for(var u=1;u<=a;u++){var d=s.cloneNode(!0);d.innerHTML=u<=n?l:c,o.appendChild(d)}return r.style.whiteSpace="nowrap",r.style.overflow="hidden",r.style.textOverflow="ellipsis",r.setAttribute("aria-label",n),o}function pYe(t,e,i){var n=this.sanitizeHTML(t.getValue())||0,r=document.createElement("span"),a=e&&e.max?e.max:100,o=e&&e.min?e.min:0,s=e&&typeof e.color<"u"?e.color:["red","orange","green"],l="#666666",c,u;if(!(isNaN(n)||typeof t.getValue()>"u")){switch(r.classList.add("tabulator-traffic-light"),u=parseFloat(n)<=a?parseFloat(n):a,u=parseFloat(u)>=o?parseFloat(u):o,c=(a-o)/100,u=Math.round((u-o)/c),typeof s){case"string":l=s;break;case"function":l=s(n);break;case"object":if(Array.isArray(s)){var d=100/s.length,p=Math.floor(u/d);p=Math.min(p,s.length-1),p=Math.max(p,0),l=s[p];break}}return r.style.backgroundColor=l,r}}function hYe(t,e={},i){var n=this.sanitizeHTML(t.getValue())||0,r=t.getElement(),a=e.max?e.max:100,o=e.min?e.min:0,s=e.legendAlign?e.legendAlign:"center",l,c,u,d,p;switch(c=parseFloat(n)<=a?parseFloat(n):a,c=parseFloat(c)>=o?parseFloat(c):o,l=(a-o)/100,c=Math.round((c-o)/l),typeof e.color){case"string":u=e.color;break;case"function":u=e.color(n);break;case"object":if(Array.isArray(e.color)){let g=100/e.color.length,v=Math.floor(c/g);v=Math.min(v,e.color.length-1),v=Math.max(v,0),u=e.color[v];break}default:u="#2DC214"}switch(typeof e.legend){case"string":d=e.legend;break;case"function":d=e.legend(n);break;case"boolean":d=n;break;default:d=!1}switch(typeof e.legendColor){case"string":p=e.legendColor;break;case"function":p=e.legendColor(n);break;case"object":if(Array.isArray(e.legendColor)){let g=100/e.legendColor.length,v=Math.floor(c/g);v=Math.min(v,e.legendColor.length-1),v=Math.max(v,0),p=e.legendColor[v]}break;default:p="#000"}r.style.minWidth="30px",r.style.position="relative",r.setAttribute("aria-label",c);var h=document.createElement("div");h.style.display="inline-block",h.style.width=c+"%",h.style.backgroundColor=u,h.style.height="100%",h.setAttribute("data-max",a),h.setAttribute("data-min",o);var f=document.createElement("div");if(f.style.position="relative",f.style.width="100%",f.style.height="100%",d){var m=document.createElement("div");m.style.position="absolute",m.style.top=0,m.style.left=0,m.style.textAlign=s,m.style.width="100%",m.style.color=p,m.innerHTML=d}return i(function(){if(!(t instanceof OTe)){var g=document.createElement("div");g.style.position="absolute",g.style.top="4px",g.style.bottom="4px",g.style.left="4px",g.style.right="4px",r.appendChild(g),r=g}r.appendChild(f),f.appendChild(h),d&&f.appendChild(m)}),""}function fYe(t,e,i){return t.getElement().style.backgroundColor=this.sanitizeHTML(t.getValue()),""}function mYe(t,e,i){return'<svg enable-background="new 0 0 24 24" height="14" width="14" viewBox="0 0 24 24" xml:space="preserve" ><path fill="#2DC214" clip-rule="evenodd" d="M21.652,3.211c-0.293-0.295-0.77-0.295-1.061,0L9.41,14.34  c-0.293,0.297-0.771,0.297-1.062,0L3.449,9.351C3.304,9.203,3.114,9.13,2.923,9.129C2.73,9.128,2.534,9.201,2.387,9.351  l-2.165,1.946C0.078,11.445,0,11.63,0,11.823c0,0.194,0.078,0.397,0.223,0.544l4.94,5.184c0.292,0.296,0.771,0.776,1.062,1.07  l2.124,2.141c0.292,0.293,0.769,0.293,1.062,0l14.366-14.34c0.293-0.294,0.293-0.777,0-1.071L21.652,3.211z" fill-rule="evenodd"/></svg>'}function gYe(t,e,i){return'<svg enable-background="new 0 0 24 24" height="14" width="14" viewBox="0 0 24 24" xml:space="preserve" ><path fill="#CE1515" d="M22.245,4.015c0.313,0.313,0.313,0.826,0,1.139l-6.276,6.27c-0.313,0.312-0.313,0.826,0,1.14l6.273,6.272  c0.313,0.313,0.313,0.826,0,1.14l-2.285,2.277c-0.314,0.312-0.828,0.312-1.142,0l-6.271-6.271c-0.313-0.313-0.828-0.313-1.141,0  l-6.276,6.267c-0.313,0.313-0.828,0.313-1.141,0l-2.282-2.28c-0.313-0.313-0.313-0.826,0-1.14l6.278-6.269  c0.313-0.312,0.313-0.826,0-1.14L1.709,5.147c-0.314-0.313-0.314-0.827,0-1.14l2.284-2.278C4.308,1.417,4.821,1.417,5.135,1.73  L11.405,8c0.314,0.314,0.828,0.314,1.141,0.001l6.276-6.267c0.312-0.312,0.826-0.312,1.141,0L22.245,4.015z"/></svg>'}function vYe(t,e,i){var n=t.getValue(),r=e.size||15,a=r+"px",o,s,l=e.hasOwnProperty("onValue")?e.onValue:!0,c=e.hasOwnProperty("offValue")?e.offValue:!1,u=e.onTruthy?n:n===l;return o=document.createElement("div"),o.classList.add("tabulator-toggle"),u?(o.classList.add("tabulator-toggle-on"),o.style.flexDirection="row-reverse",e.onColor&&(o.style.background=e.onColor)):e.offColor&&(o.style.background=e.offColor),o.style.width=2.5*r+"px",o.style.borderRadius=a,e.clickable&&o.addEventListener("click",d=>{t.setValue(u?c:l)}),s=document.createElement("div"),s.classList.add("tabulator-toggle-switch"),s.style.height=a,s.style.width=a,s.style.borderRadius=a,o.appendChild(s),o}function yYe(t,e,i){var n=document.createElement("span"),r=t.getRow(),a=t.getTable();return r.watchPosition(o=>{e.relativeToPage&&(o+=a.modules.page.getPageSize()*(a.modules.page.getPage()-1)),n.innerText=o}),n}function bYe(t,e,i){return t.getElement().classList.add("tabulator-row-handle"),"<div class='tabulator-row-handle-box'><div class='tabulator-row-handle-bar'></div><div class='tabulator-row-handle-bar'></div><div class='tabulator-row-handle-bar'></div></div>"}var IYe={plaintext:tYe,html:iYe,textarea:nYe,money:rYe,link:aYe,image:oYe,tickCross:sYe,datetime:lYe,datetimediff:cYe,lookup:uYe,star:dYe,traffic:pYe,progress:hYe,color:fYe,buttonTick:mYe,buttonCross:gYe,toggle:vYe,rownum:yYe,handle:bYe};const jd=class jd extends Wn{constructor(e){super(e),this.registerColumnOption("formatter"),this.registerColumnOption("formatterParams"),this.registerColumnOption("formatterPrint"),this.registerColumnOption("formatterPrintParams"),this.registerColumnOption("formatterClipboard"),this.registerColumnOption("formatterClipboardParams"),this.registerColumnOption("formatterHtmlOutput"),this.registerColumnOption("formatterHtmlOutputParams"),this.registerColumnOption("titleFormatter"),this.registerColumnOption("titleFormatterParams")}initialize(){this.subscribe("cell-format",this.formatValue.bind(this)),this.subscribe("cell-rendered",this.cellRendered.bind(this)),this.subscribe("column-layout",this.initializeColumn.bind(this)),this.subscribe("column-format",this.formatHeader.bind(this))}initializeColumn(e){e.modules.format=this.lookupFormatter(e,""),typeof e.definition.formatterPrint<"u"&&(e.modules.format.print=this.lookupFormatter(e,"Print")),typeof e.definition.formatterClipboard<"u"&&(e.modules.format.clipboard=this.lookupFormatter(e,"Clipboard")),typeof e.definition.formatterHtmlOutput<"u"&&(e.modules.format.htmlOutput=this.lookupFormatter(e,"HtmlOutput"))}lookupFormatter(e,i){var n={params:e.definition["formatter"+i+"Params"]||{}},r=e.definition["formatter"+i];switch(typeof r){case"string":jd.formatters[r]?n.formatter=jd.formatters[r]:(console.warn("Formatter Error - No such formatter found: ",r),n.formatter=jd.formatters.plaintext);break;case"function":n.formatter=r;break;default:n.formatter=jd.formatters.plaintext;break}return n}cellRendered(e){e.modules.format&&e.modules.format.renderedCallback&&!e.modules.format.rendered&&(e.modules.format.renderedCallback(),e.modules.format.rendered=!0)}formatHeader(e,i,n){var r,a,o,s;return e.definition.titleFormatter?(r=this.getFormatter(e.definition.titleFormatter),o=l=>{e.titleFormatterRendered=l},s={getValue:function(){return i},getElement:function(){return n},getType:function(){return"header"},getColumn:function(){return e.getComponent()},getTable:()=>this.table},a=e.definition.titleFormatterParams||{},a=typeof a=="function"?a():a,r.call(this,s,a,o)):i}formatValue(e){var i=e.getComponent(),n=typeof e.column.modules.format.params=="function"?e.column.modules.format.params(i):e.column.modules.format.params;function r(a){e.modules.format||(e.modules.format={}),e.modules.format.renderedCallback=a,e.modules.format.rendered=!1}return e.column.modules.format.formatter.call(this,i,n,r)}formatExportValue(e,i){var n=e.column.modules.format[i],r;if(n){let a=function(o){e.modules.format||(e.modules.format={}),e.modules.format.renderedCallback=o,e.modules.format.rendered=!1};return r=typeof n.params=="function"?n.params(e.getComponent()):n.params,n.formatter.call(this,e.getComponent(),r,a)}else return this.formatValue(e)}sanitizeHTML(e){if(e){var i={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"};return String(e).replace(/[&<>"'`=/]/g,function(n){return i[n]})}else return e}emptyToSpace(e){return e===null||typeof e>"u"||e===""?"&nbsp;":e}getFormatter(e){switch(typeof e){case"string":jd.formatters[e]?e=jd.formatters[e]:(console.warn("Formatter Error - No such formatter found: ",e),e=jd.formatters.plaintext);break;case"function":break;default:e=jd.formatters.plaintext;break}return e}};Je(jd,"moduleName","format"),Je(jd,"formatters",IYe);let tG=jd;class $Te extends Wn{constructor(e){super(e),this.leftColumns=[],this.rightColumns=[],this.initializationMode="left",this.active=!1,this.blocked=!0,this.registerColumnOption("frozen")}reset(){this.initializationMode="left",this.leftColumns=[],this.rightColumns=[],this.active=!1}initialize(){this.subscribe("cell-layout",this.layoutCell.bind(this)),this.subscribe("column-init",this.initializeColumn.bind(this)),this.subscribe("column-width",this.layout.bind(this)),this.subscribe("row-layout-after",this.layoutRow.bind(this)),this.subscribe("table-layout",this.layout.bind(this)),this.subscribe("columns-loading",this.reset.bind(this)),this.subscribe("column-add",this.reinitializeColumns.bind(this)),this.subscribe("column-deleted",this.reinitializeColumns.bind(this)),this.subscribe("column-hide",this.reinitializeColumns.bind(this)),this.subscribe("column-show",this.reinitializeColumns.bind(this)),this.subscribe("columns-loaded",this.reinitializeColumns.bind(this)),this.subscribe("table-redraw",this.layout.bind(this)),this.subscribe("layout-refreshing",this.blockLayout.bind(this)),this.subscribe("layout-refreshed",this.unblockLayout.bind(this)),this.subscribe("scrollbar-vertical",this.adjustForScrollbar.bind(this))}blockLayout(){this.blocked=!0}unblockLayout(){this.blocked=!1}layoutCell(e){this.layoutElement(e.element,e.column)}reinitializeColumns(){this.reset(),this.table.columnManager.columnsByIndex.forEach(e=>{this.initializeColumn(e)}),this.layout()}initializeColumn(e){var i={margin:0,edge:!1};e.isGroup||(this.frozenCheck(e)?(i.position=this.initializationMode,this.initializationMode=="left"?this.leftColumns.push(e):this.rightColumns.unshift(e),this.active=!0,e.modules.frozen=i):this.initializationMode="right")}frozenCheck(e){return e.parent.isGroup&&e.definition.frozen&&console.warn("Frozen Column Error - Parent column group must be frozen, not individual columns or sub column groups"),e.parent.isGroup?this.frozenCheck(e.parent):e.definition.frozen}layoutCalcRows(){this.table.modExists("columnCalcs")&&(this.table.modules.columnCalcs.topInitialized&&this.table.modules.columnCalcs.topRow&&this.layoutRow(this.table.modules.columnCalcs.topRow),this.table.modules.columnCalcs.botInitialized&&this.table.modules.columnCalcs.botRow&&this.layoutRow(this.table.modules.columnCalcs.botRow),this.table.modExists("groupRows")&&this.layoutGroupCalcs(this.table.modules.groupRows.getGroups()))}layoutGroupCalcs(e){e.forEach(i=>{i.calcs.top&&this.layoutRow(i.calcs.top),i.calcs.bottom&&this.layoutRow(i.calcs.bottom),i.groupList&&i.groupList.length&&this.layoutGroupCalcs(i.groupList)})}layoutColumnPosition(e){var i=[],n=0,r=0;this.leftColumns.forEach((a,o)=>{if(a.modules.frozen.marginValue=n,a.modules.frozen.margin=a.modules.frozen.marginValue+"px",a.visible&&(n+=a.getWidth()),o==this.leftColumns.length-1?a.modules.frozen.edge=!0:a.modules.frozen.edge=!1,a.parent.isGroup){var s=this.getColGroupParentElement(a);i.includes(s)||(this.layoutElement(s,a),i.push(s)),s.classList.toggle("tabulator-frozen-left",a.modules.frozen.edge&&a.modules.frozen.position==="left"),s.classList.toggle("tabulator-frozen-right",a.modules.frozen.edge&&a.modules.frozen.position==="right")}else this.layoutElement(a.getElement(),a);e&&a.cells.forEach(l=>{this.layoutElement(l.getElement(!0),a)})}),this.rightColumns.forEach((a,o)=>{a.modules.frozen.marginValue=r,a.modules.frozen.margin=a.modules.frozen.marginValue+"px",a.visible&&(r+=a.getWidth()),o==this.rightColumns.length-1?a.modules.frozen.edge=!0:a.modules.frozen.edge=!1,a.parent.isGroup?this.layoutElement(this.getColGroupParentElement(a),a):this.layoutElement(a.getElement(),a),e&&a.cells.forEach(s=>{this.layoutElement(s.getElement(!0),a)})})}getColGroupParentElement(e){return e.parent.isGroup?this.getColGroupParentElement(e.parent):e.getElement()}layout(){this.active&&!this.blocked&&(this.layoutColumnPosition(),this.reinitializeRows(),this.layoutCalcRows())}reinitializeRows(){var e=this.table.rowManager.getVisibleRows(!0),i=this.table.rowManager.getRows().filter(n=>!e.includes(n));i.forEach(n=>{n.deinitialize()}),e.forEach(n=>{n.type==="row"&&this.layoutRow(n)})}layoutRow(e){this.table.options.layout==="fitDataFill"&&this.rightColumns.length&&(this.table.rowManager.getTableElement().style.minWidth="calc(100% - "+this.rightMargin+")"),this.leftColumns.forEach(i=>{var n=e.getCell(i);n&&this.layoutElement(n.getElement(!0),i)}),this.rightColumns.forEach(i=>{var n=e.getCell(i);n&&this.layoutElement(n.getElement(!0),i)})}layoutElement(e,i){var n;i.modules.frozen&&e&&(e.style.position="sticky",this.table.rtl?n=i.modules.frozen.position==="left"?"right":"left":n=i.modules.frozen.position,e.style[n]=i.modules.frozen.margin,e.classList.add("tabulator-frozen"),e.classList.toggle("tabulator-frozen-left",i.modules.frozen.edge&&i.modules.frozen.position==="left"),e.classList.toggle("tabulator-frozen-right",i.modules.frozen.edge&&i.modules.frozen.position==="right"))}adjustForScrollbar(e){this.rightColumns.length&&(this.table.columnManager.getContentsElement().style.width="calc(100% - "+e+"px)")}getFrozenColumns(){return this.leftColumns.concat(this.rightColumns)}_calcSpace(e,i){var n=0;for(let r=0;r<i;r++)e[r].visible&&(n+=e[r].getWidth());return n}}Je($Te,"moduleName","frozenColumns");class VTe extends Wn{constructor(e){super(e),this.topElement=document.createElement("div"),this.rows=[],this.registerComponentFunction("row","freeze",this.freezeRow.bind(this)),this.registerComponentFunction("row","unfreeze",this.unfreezeRow.bind(this)),this.registerComponentFunction("row","isFrozen",this.isRowFrozen.bind(this)),this.registerTableOption("frozenRowsField","id"),this.registerTableOption("frozenRows",!1)}initialize(){var e=document.createDocumentFragment();this.rows=[],this.topElement.classList.add("tabulator-frozen-rows-holder"),e.appendChild(document.createElement("br")),e.appendChild(this.topElement),this.table.columnManager.getContentsElement().insertBefore(e,this.table.columnManager.headersElement.nextSibling),this.subscribe("row-deleting",this.detachRow.bind(this)),this.subscribe("rows-visible",this.visibleRows.bind(this)),this.registerDisplayHandler(this.getRows.bind(this),10),this.table.options.frozenRows&&(this.subscribe("data-processed",this.initializeRows.bind(this)),this.subscribe("row-added",this.initializeRow.bind(this)),this.subscribe("table-redrawing",this.resizeHolderWidth.bind(this)),this.subscribe("column-resized",this.resizeHolderWidth.bind(this)),this.subscribe("column-show",this.resizeHolderWidth.bind(this)),this.subscribe("column-hide",this.resizeHolderWidth.bind(this))),this.resizeHolderWidth()}resizeHolderWidth(){this.topElement.style.minWidth=this.table.columnManager.headersElement.offsetWidth+"px"}initializeRows(){this.table.rowManager.getRows().forEach(e=>{this.initializeRow(e)})}initializeRow(e){var i=this.table.options.frozenRows,n=typeof i;n==="number"?e.getPosition()&&e.getPosition()+this.rows.length<=i&&this.freezeRow(e):n==="function"?i.call(this.table,e.getComponent())&&this.freezeRow(e):Array.isArray(i)&&i.includes(e.data[this.options("frozenRowsField")])&&this.freezeRow(e)}isRowFrozen(e){var i=this.rows.indexOf(e);return i>-1}isFrozen(){return!!this.rows.length}visibleRows(e,i){return this.rows.forEach(n=>{i.push(n)}),i}getRows(e){var i=e.slice(0);return this.rows.forEach(function(n){var r=i.indexOf(n);r>-1&&i.splice(r,1)}),i}freezeRow(e){e.modules.frozen?console.warn("Freeze Error - Row is already frozen"):(e.modules.frozen=!0,this.topElement.appendChild(e.getElement()),e.initialize(),e.normalizeHeight(),this.rows.push(e),this.refreshData(!1,"display"),this.table.rowManager.adjustTableSize(),this.styleRows())}unfreezeRow(e){e.modules.frozen?(e.modules.frozen=!1,this.detachRow(e),this.table.rowManager.adjustTableSize(),this.refreshData(!1,"display"),this.rows.length&&this.styleRows()):console.warn("Freeze Error - Row is already unfrozen")}detachRow(e){var i=this.rows.indexOf(e);if(i>-1){var n=e.getElement();n.parentNode&&n.parentNode.removeChild(n),this.rows.splice(i,1)}}styleRows(e){this.rows.forEach((i,n)=>{this.table.rowManager.styleRow(i,n)})}}Je(VTe,"moduleName","frozenRows");class wYe{constructor(e){return this._group=e,this.type="GroupComponent",new Proxy(this,{get:function(i,n,r){return typeof i[n]<"u"?i[n]:i._group.groupManager.table.componentFunctionBinder.handle("group",i._group,n)}})}getKey(){return this._group.key}getField(){return this._group.field}getElement(){return this._group.element}getRows(){return this._group.getRows(!0)}getSubGroups(){return this._group.getSubGroups(!0)}getParentGroup(){return this._group.parent?this._group.parent.getComponent():!1}isVisible(){return this._group.visible}show(){this._group.show()}hide(){this._group.hide()}toggle(){this._group.toggleVisibility()}scrollTo(e,i){return this._group.groupManager.table.rowManager.scrollToRow(this._group,e,i)}_getSelf(){return this._group}getTable(){return this._group.groupManager.table}}class A0{constructor(e,i,n,r,a,o,s){this.groupManager=e,this.parent=i,this.key=r,this.level=n,this.field=a,this.hasSubGroups=n<e.groupIDLookups.length-1,this.addRow=this.hasSubGroups?this._addRowToGroup:this._addRow,this.type="group",this.old=s,this.rows=[],this.groups=[],this.groupList=[],this.generator=o,this.element=!1,this.elementContents=!1,this.height=0,this.outerHeight=0,this.initialized=!1,this.calcs={},this.initialized=!1,this.modules={},this.arrowElement=!1,this.visible=s?s.visible:typeof e.startOpen[n]<"u"?e.startOpen[n]:e.startOpen[0],this.component=null,this.createElements(),this.addBindings(),this.createValueGroups()}wipe(e){e||(this.groupList.length?this.groupList.forEach(function(i){i.wipe()}):this.rows.forEach(i=>{i.modules&&delete i.modules.group})),this.element=!1,this.arrowElement=!1,this.elementContents=!1}createElements(){var e=document.createElement("div");e.classList.add("tabulator-arrow"),this.element=document.createElement("div"),this.element.classList.add("tabulator-row"),this.element.classList.add("tabulator-group"),this.element.classList.add("tabulator-group-level-"+this.level),this.element.setAttribute("role","rowgroup"),this.arrowElement=document.createElement("div"),this.arrowElement.classList.add("tabulator-group-toggle"),this.arrowElement.appendChild(e),this.groupManager.table.options.movableRows!==!1&&this.groupManager.table.modExists("moveRow")&&this.groupManager.table.modules.moveRow.initializeGroupHeader(this)}createValueGroups(){var e=this.level+1;this.groupManager.allowedValues&&this.groupManager.allowedValues[e]&&this.groupManager.allowedValues[e].forEach(i=>{this._createGroup(i,e)})}addBindings(){var e;this.groupManager.table.options.groupToggleElement&&(e=this.groupManager.table.options.groupToggleElement=="arrow"?this.arrowElement:this.element,e.addEventListener("click",i=>{this.groupManager.table.options.groupToggleElement==="arrow"&&(i.stopPropagation(),i.stopImmediatePropagation()),setTimeout(()=>{this.toggleVisibility()})}))}_createGroup(e,i){var n=i+"_"+e,r=new A0(this.groupManager,this,i,e,this.groupManager.groupIDLookups[i].field,this.groupManager.headerGenerator[i]||this.groupManager.headerGenerator[0],this.old?this.old.groups[n]:!1);this.groups[n]=r,this.groupList.push(r)}_addRowToGroup(e){var i=this.level+1;if(this.hasSubGroups){var n=this.groupManager.groupIDLookups[i].func(e.getData()),r=i+"_"+n;this.groupManager.allowedValues&&this.groupManager.allowedValues[i]?this.groups[r]&&this.groups[r].addRow(e):(this.groups[r]||this._createGroup(n,i),this.groups[r].addRow(e))}}_addRow(e){this.rows.push(e),e.modules.group=this}insertRow(e,i,n){var r=this.conformRowData({});e.updateData(r);var a=this.rows.indexOf(i);a>-1?n?this.rows.splice(a+1,0,e):this.rows.splice(a,0,e):n?this.rows.push(e):this.rows.unshift(e),e.modules.group=this,this.groupManager.table.modExists("columnCalcs")&&this.groupManager.table.options.columnCalcs!="table"&&this.groupManager.table.modules.columnCalcs.recalcGroup(this),this.groupManager.updateGroupRows(!0)}scrollHeader(e){this.arrowElement&&(this.arrowElement.style.marginLeft=e,this.groupList.forEach(function(i){i.scrollHeader(e)}))}getRowIndex(e){}conformRowData(e){return this.field?e[this.field]=this.key:console.warn("Data Conforming Error - Cannot conform row data to match new group as groupBy is a function"),this.parent&&(e=this.parent.conformRowData(e)),e}removeRow(e){var i=this.rows.indexOf(e),n=e.getElement();i>-1&&this.rows.splice(i,1),!this.groupManager.table.options.groupValues&&!this.rows.length?(this.parent?this.parent.removeGroup(this):this.groupManager.removeGroup(this),this.groupManager.updateGroupRows(!0)):(n.parentNode&&n.parentNode.removeChild(n),this.groupManager.blockRedraw||(this.generateGroupHeaderContents(),this.groupManager.table.modExists("columnCalcs")&&this.groupManager.table.options.columnCalcs!="table"&&this.groupManager.table.modules.columnCalcs.recalcGroup(this)))}removeGroup(e){var i=e.level+"_"+e.key,n;this.groups[i]&&(delete this.groups[i],n=this.groupList.indexOf(e),n>-1&&this.groupList.splice(n,1),this.groupList.length||(this.parent?this.parent.removeGroup(this):this.groupManager.removeGroup(this)))}getHeadersAndRows(){var e=[];return e.push(this),this._visSet(),this.calcs.top&&(this.calcs.top.detachElement(),this.calcs.top.deleteCells()),this.calcs.bottom&&(this.calcs.bottom.detachElement(),this.calcs.bottom.deleteCells()),this.visible?this.groupList.length?this.groupList.forEach(function(i){e=e.concat(i.getHeadersAndRows())}):(this.groupManager.table.options.columnCalcs!="table"&&this.groupManager.table.modExists("columnCalcs")&&this.groupManager.table.modules.columnCalcs.hasTopCalcs()&&(this.calcs.top=this.groupManager.table.modules.columnCalcs.generateTopRow(this.rows),e.push(this.calcs.top)),e=e.concat(this.rows),this.groupManager.table.options.columnCalcs!="table"&&this.groupManager.table.modExists("columnCalcs")&&this.groupManager.table.modules.columnCalcs.hasBottomCalcs()&&(this.calcs.bottom=this.groupManager.table.modules.columnCalcs.generateBottomRow(this.rows),e.push(this.calcs.bottom))):!this.groupList.length&&this.groupManager.table.options.columnCalcs!="table"&&this.groupManager.table.modExists("columnCalcs")&&(this.groupManager.table.modules.columnCalcs.hasTopCalcs()&&this.groupManager.table.options.groupClosedShowCalcs&&(this.calcs.top=this.groupManager.table.modules.columnCalcs.generateTopRow(this.rows),e.push(this.calcs.top)),this.groupManager.table.modules.columnCalcs.hasBottomCalcs()&&this.groupManager.table.options.groupClosedShowCalcs&&(this.calcs.bottom=this.groupManager.table.modules.columnCalcs.generateBottomRow(this.rows),e.push(this.calcs.bottom))),e}getData(e,i){var n=[];return this._visSet(),(!e||e&&this.visible)&&this.rows.forEach(r=>{n.push(r.getData(i||"data"))}),n}getRowCount(){var e=0;return this.groupList.length?this.groupList.forEach(i=>{e+=i.getRowCount()}):e=this.rows.length,e}toggleVisibility(){this.visible?this.hide():this.show()}hide(){this.visible=!1,this.groupManager.table.rowManager.getRenderMode()=="basic"&&!this.groupManager.table.options.pagination?(this.element.classList.remove("tabulator-group-visible"),this.groupList.length?this.groupList.forEach(e=>{var i=e.getHeadersAndRows();i.forEach(n=>{n.detachElement()})}):this.rows.forEach(e=>{var i=e.getElement();i.parentNode.removeChild(i)}),this.groupManager.updateGroupRows(!0)):this.groupManager.updateGroupRows(!0),this.groupManager.table.externalEvents.dispatch("groupVisibilityChanged",this.getComponent(),!1)}show(){if(this.visible=!0,this.groupManager.table.rowManager.getRenderMode()=="basic"&&!this.groupManager.table.options.pagination){this.element.classList.add("tabulator-group-visible");var e=this.generateElement();this.groupList.length?this.groupList.forEach(i=>{var n=i.getHeadersAndRows();n.forEach(r=>{var a=r.getElement();e.parentNode.insertBefore(a,e.nextSibling),r.initialize(),e=a})}):this.rows.forEach(i=>{var n=i.getElement();e.parentNode.insertBefore(n,e.nextSibling),i.initialize(),e=n}),this.groupManager.updateGroupRows(!0)}else this.groupManager.updateGroupRows(!0);this.groupManager.table.externalEvents.dispatch("groupVisibilityChanged",this.getComponent(),!0)}_visSet(){var e=[];typeof this.visible=="function"&&(this.rows.forEach(function(i){e.push(i.getData())}),this.visible=this.visible(this.key,this.getRowCount(),e,this.getComponent()))}getRowGroup(e){var i=!1;return this.groupList.length?this.groupList.forEach(function(n){var r=n.getRowGroup(e);r&&(i=r)}):this.rows.find(function(n){return n===e})&&(i=this),i}getSubGroups(e){var i=[];return this.groupList.forEach(function(n){i.push(e?n.getComponent():n)}),i}getRows(e,i){var n=[];return i&&this.groupList.length?this.groupList.forEach(r=>{n=n.concat(r.getRows(e,i))}):this.rows.forEach(function(r){n.push(e?r.getComponent():r)}),n}generateGroupHeaderContents(){var e=[],i=this.getRows(!1,!0);for(i.forEach(function(n){e.push(n.getData())}),this.elementContents=this.generator(this.key,this.getRowCount(),e,this.getComponent());this.element.firstChild;)this.element.removeChild(this.element.firstChild);typeof this.elementContents=="string"?this.element.innerHTML=this.elementContents:this.element.appendChild(this.elementContents),this.element.insertBefore(this.arrowElement,this.element.firstChild)}getPath(e=[]){return e.unshift(this.key),this.parent&&this.parent.getPath(e),e}getElement(){return this.elementContents?this.element:this.generateElement()}generateElement(){this.addBindings=!1,this._visSet(),this.visible?this.element.classList.add("tabulator-group-visible"):this.element.classList.remove("tabulator-group-visible");for(var e=0;e<this.element.childNodes.length;++e)this.element.childNodes[e].parentNode.removeChild(this.element.childNodes[e]);return this.generateGroupHeaderContents(),this.element}detachElement(){this.element&&this.element.parentNode&&this.element.parentNode.removeChild(this.element)}normalizeHeight(){this.setHeight(this.element.clientHeight)}initialize(e){(!this.initialized||e)&&(this.normalizeHeight(),this.initialized=!0)}reinitialize(){this.initialized=!1,this.height=0,io.elVisible(this.element)&&this.initialize(!0)}setHeight(e){this.height!=e&&(this.height=e,this.outerHeight=this.element.offsetHeight)}getHeight(){return this.outerHeight}getGroup(){return this}reinitializeHeight(){}calcHeight(){}setCellHeight(){}clearCellHeight(){}deinitializeHeight(){}rendered(){}getComponent(){return this.component||(this.component=new wYe(this)),this.component}}class jTe extends Wn{constructor(e){super(e),this.groupIDLookups=!1,this.startOpen=[function(){return!1}],this.headerGenerator=[function(){return""}],this.groupList=[],this.allowedValues=!1,this.groups={},this.displayHandler=this.getRows.bind(this),this.blockRedraw=!1,this.registerTableOption("groupBy",!1),this.registerTableOption("groupStartOpen",!0),this.registerTableOption("groupValues",!1),this.registerTableOption("groupUpdateOnCellEdit",!1),this.registerTableOption("groupHeader",!1),this.registerTableOption("groupHeaderPrint",null),this.registerTableOption("groupHeaderClipboard",null),this.registerTableOption("groupHeaderHtmlOutput",null),this.registerTableOption("groupHeaderDownload",null),this.registerTableOption("groupToggleElement","arrow"),this.registerTableOption("groupClosedShowCalcs",!1),this.registerTableFunction("setGroupBy",this.setGroupBy.bind(this)),this.registerTableFunction("setGroupValues",this.setGroupValues.bind(this)),this.registerTableFunction("setGroupStartOpen",this.setGroupStartOpen.bind(this)),this.registerTableFunction("setGroupHeader",this.setGroupHeader.bind(this)),this.registerTableFunction("getGroups",this.userGetGroups.bind(this)),this.registerTableFunction("getGroupedData",this.userGetGroupedData.bind(this)),this.registerComponentFunction("row","getGroup",this.rowGetGroup.bind(this))}initialize(){this.subscribe("table-destroy",this._blockRedrawing.bind(this)),this.subscribe("rows-wipe",this._blockRedrawing.bind(this)),this.subscribe("rows-wiped",this._restore_redrawing.bind(this)),this.table.options.groupBy&&(this.table.options.groupUpdateOnCellEdit&&(this.subscribe("cell-value-updated",this.cellUpdated.bind(this)),this.subscribe("row-data-changed",this.reassignRowToGroup.bind(this),0)),this.subscribe("table-built",this.configureGroupSetup.bind(this)),this.subscribe("row-deleting",this.rowDeleting.bind(this)),this.subscribe("row-deleted",this.rowsUpdated.bind(this)),this.subscribe("scroll-horizontal",this.scrollHeaders.bind(this)),this.subscribe("rows-wipe",this.wipe.bind(this)),this.subscribe("rows-added",this.rowsUpdated.bind(this)),this.subscribe("row-moving",this.rowMoving.bind(this)),this.subscribe("row-adding-index",this.rowAddingIndex.bind(this)),this.subscribe("rows-sample",this.rowSample.bind(this)),this.subscribe("render-virtual-fill",this.virtualRenderFill.bind(this)),this.registerDisplayHandler(this.displayHandler,20),this.initialized=!0)}_blockRedrawing(){this.blockRedraw=!0}_restore_redrawing(){this.blockRedraw=!1}configureGroupSetup(){if(this.table.options.groupBy){var e=this.table.options.groupBy,i=this.table.options.groupStartOpen,n=this.table.options.groupHeader;if(this.allowedValues=this.table.options.groupValues,Array.isArray(e)&&Array.isArray(n)&&e.length>n.length&&console.warn("Error creating group headers, groupHeader array is shorter than groupBy array"),this.headerGenerator=[function(){return""}],this.startOpen=[function(){return!1}],this.langBind("groups|item",(a,o)=>{this.headerGenerator[0]=(s,l,c)=>(typeof s>"u"?"":s)+"<span>("+l+" "+(l===1?a:o.groups.items)+")</span>"}),this.groupIDLookups=[],e)this.table.modExists("columnCalcs")&&this.table.options.columnCalcs!="table"&&this.table.options.columnCalcs!="both"&&this.table.modules.columnCalcs.removeCalcs();else if(this.table.modExists("columnCalcs")&&this.table.options.columnCalcs!="group"){var r=this.table.columnManager.getRealColumns();r.forEach(a=>{a.definition.topCalc&&this.table.modules.columnCalcs.initializeTopRow(),a.definition.bottomCalc&&this.table.modules.columnCalcs.initializeBottomRow()})}Array.isArray(e)||(e=[e]),e.forEach((a,o)=>{var s,l;typeof a=="function"?s=a:(l=this.table.columnManager.getColumnByField(a),l?s=function(c){return l.getFieldValue(c)}:s=function(c){return c[a]}),this.groupIDLookups.push({field:typeof a=="function"?!1:a,func:s,values:this.allowedValues?this.allowedValues[o]:!1})}),i&&(Array.isArray(i)||(i=[i]),i.forEach(a=>{}),this.startOpen=i),n&&(this.headerGenerator=Array.isArray(n)?n:[n])}else this.groupList=[],this.groups={}}rowSample(e,i){if(this.table.options.groupBy){var n=this.getGroups(!1)[0];i.push(n.getRows(!1)[0])}return i}virtualRenderFill(){var e=this.table.rowManager.tableElement,i=this.table.rowManager.getVisibleRows();if(this.table.options.groupBy)i=i.filter(n=>n.type!=="group"),e.style.minWidth=i.length?"":this.table.columnManager.getWidth()+"px";else return i}rowAddingIndex(e,i,n){if(this.table.options.groupBy){this.assignRowToGroup(e);var r=e.modules.group.rows;return r.length>1&&(!i||i&&r.indexOf(i)==-1?n?r[0]!==e&&(i=r[0],this.table.rowManager.moveRowInArray(e.modules.group.rows,e,i,!n)):r[r.length-1]!==e&&(i=r[r.length-1],this.table.rowManager.moveRowInArray(e.modules.group.rows,e,i,!n)):this.table.rowManager.moveRowInArray(e.modules.group.rows,e,i,!n)),i}}trackChanges(){this.dispatch("group-changed")}setGroupBy(e){this.table.options.groupBy=e,this.initialized||this.initialize(),this.configureGroupSetup(),!e&&this.table.modExists("columnCalcs")&&this.table.options.columnCalcs===!0&&this.table.modules.columnCalcs.reinitializeCalcs(),this.refreshData(),this.trackChanges()}setGroupValues(e){this.table.options.groupValues=e,this.configureGroupSetup(),this.refreshData(),this.trackChanges()}setGroupStartOpen(e){this.table.options.groupStartOpen=e,this.configureGroupSetup(),this.table.options.groupBy?(this.refreshData(),this.trackChanges()):console.warn("Grouping Update - cant refresh view, no groups have been set")}setGroupHeader(e){this.table.options.groupHeader=e,this.configureGroupSetup(),this.table.options.groupBy?(this.refreshData(),this.trackChanges()):console.warn("Grouping Update - cant refresh view, no groups have been set")}userGetGroups(e){return this.getGroups(!0)}userGetGroupedData(){return this.table.options.groupBy?this.getGroupedData():this.getData()}rowGetGroup(e){return e.modules.group?e.modules.group.getComponent():!1}rowMoving(e,i,n){if(this.table.options.groupBy){!n&&i instanceof A0&&(i=this.table.rowManager.prevDisplayRow(e)||i);var r=i instanceof A0?i:i.modules.group,a=e instanceof A0?e:e.modules.group;r===a?this.table.rowManager.moveRowInArray(r.rows,e,i,n):(a&&a.removeRow(e),r.insertRow(e,i,n))}}rowDeleting(e){this.table.options.groupBy&&e.modules.group&&e.modules.group.removeRow(e)}rowsUpdated(e){this.table.options.groupBy&&this.updateGroupRows(!0)}cellUpdated(e){this.table.options.groupBy&&this.reassignRowToGroup(e.row)}getRows(e){return this.table.options.groupBy&&this.groupIDLookups.length?(this.dispatchExternal("dataGrouping"),this.generateGroups(e),this.subscribedExternal("dataGrouped")&&this.dispatchExternal("dataGrouped",this.getGroups(!0)),this.updateGroupRows()):e.slice(0)}getGroups(e){var i=[];return this.groupList.forEach(function(n){i.push(e?n.getComponent():n)}),i}getChildGroups(e){var i=[];return e||(e=this),e.groupList.forEach(n=>{n.groupList.length?i=i.concat(this.getChildGroups(n)):i.push(n)}),i}wipe(){this.table.options.groupBy&&(this.groupList.forEach(function(e){e.wipe()}),this.groupList=[],this.groups={})}pullGroupListData(e){var i=[];return e.forEach(n=>{var r={};r.level=0,r.rowCount=0,r.headerContent="";var a=[];n.hasSubGroups?(a=this.pullGroupListData(n.groupList),r.level=n.level,r.rowCount=a.length-n.groupList.length,r.headerContent=n.generator(n.key,r.rowCount,n.rows,n),i.push(r),i=i.concat(a)):(r.level=n.level,r.headerContent=n.generator(n.key,n.rows.length,n.rows,n),r.rowCount=n.getRows().length,i.push(r),n.getRows().forEach(o=>{i.push(o.getData("data"))}))}),i}getGroupedData(){return this.pullGroupListData(this.groupList)}getRowGroup(e){var i=!1;return this.options("dataTree")&&(e=this.table.modules.dataTree.getTreeParentRoot(e)),this.groupList.forEach(n=>{var r=n.getRowGroup(e);r&&(i=r)}),i}countGroups(){return this.groupList.length}generateGroups(e){var i=this.groups;this.groups={},this.groupList=[],this.allowedValues&&this.allowedValues[0]?(this.allowedValues[0].forEach(n=>{this.createGroup(n,0,i)}),e.forEach(n=>{this.assignRowToExistingGroup(n,i)})):e.forEach(n=>{this.assignRowToGroup(n,i)}),Object.values(i).forEach(n=>{n.wipe(!0)})}createGroup(e,i,n){var r=i+"_"+e,a;n=n||[],a=new A0(this,!1,i,e,this.groupIDLookups[0].field,this.headerGenerator[0],n[r]),this.groups[r]=a,this.groupList.push(a)}assignRowToExistingGroup(e,i){var n=this.groupIDLookups[0].func(e.getData()),r="0_"+n;this.groups[r]&&this.groups[r].addRow(e)}assignRowToGroup(e,i){var n=this.groupIDLookups[0].func(e.getData()),r=!this.groups["0_"+n];return r&&this.createGroup(n,0,i),this.groups["0_"+n].addRow(e),!r}reassignRowToGroup(e){if(e.type==="row"){var i=e.modules.group,n=i.getPath(),r=this.getExpectedPath(e),a;a=n.length==r.length&&n.every((o,s)=>o===r[s]),a||(i.removeRow(e),this.assignRowToGroup(e,this.groups),this.refreshData(!0))}}getExpectedPath(e){var i=[],n=e.getData();return this.groupIDLookups.forEach(r=>{i.push(r.func(n))}),i}updateGroupRows(e){var i=[];return this.blockRedraw||(this.groupList.forEach(n=>{i=i.concat(n.getHeadersAndRows())}),e&&this.refreshData(!0)),i}scrollHeaders(e){this.table.options.groupBy&&(this.table.options.renderHorizontal==="virtual"&&(e-=this.table.columnManager.renderer.vDomPadLeft),e=e+"px",this.groupList.forEach(i=>{i.scrollHeader(e)}))}removeGroup(e){var i=e.level+"_"+e.key,n;this.groups[i]&&(delete this.groups[i],n=this.groupList.indexOf(e),n>-1&&this.groupList.splice(n,1))}checkBasicModeGroupHeaderWidth(){var e=this.table.rowManager.tableElement,i=!0;this.table.rowManager.getDisplayRows().forEach((n,r)=>{this.table.rowManager.styleRow(n,r),e.appendChild(n.getElement()),n.initialize(!0),n.type!=="group"&&(i=!1)}),i?e.style.minWidth=this.table.columnManager.getWidth()+"px":e.style.minWidth=""}}Je(jTe,"moduleName","groupRows");var SYe={cellEdit:function(t){t.component.setValueProcessData(t.data.oldValue),t.component.cellRendered()},rowAdd:function(t){t.component.deleteActual(),this.table.rowManager.checkPlaceholder()},rowDelete:function(t){var e=this.table.rowManager.addRowActual(t.data.data,t.data.pos,t.data.index);this.table.options.groupBy&&this.table.modExists("groupRows")&&this.table.modules.groupRows.updateGroupRows(!0),this._rebindRow(t.component,e),this.table.rowManager.checkPlaceholder()},rowMove:function(t){var e=t.data.posFrom-t.data.posTo>0;this.table.rowManager.moveRowActual(t.component,this.table.rowManager.getRowFromPosition(t.data.posFrom),e),this.table.rowManager.regenerateRowPositions(),this.table.rowManager.reRenderInPosition()}},TYe={cellEdit:function(t){t.component.setValueProcessData(t.data.newValue),t.component.cellRendered()},rowAdd:function(t){var e=this.table.rowManager.addRowActual(t.data.data,t.data.pos,t.data.index);this.table.options.groupBy&&this.table.modExists("groupRows")&&this.table.modules.groupRows.updateGroupRows(!0),this._rebindRow(t.component,e),this.table.rowManager.checkPlaceholder()},rowDelete:function(t){t.component.deleteActual(),this.table.rowManager.checkPlaceholder()},rowMove:function(t){this.table.rowManager.moveRowActual(t.component,this.table.rowManager.getRowFromPosition(t.data.posTo),t.data.after),this.table.rowManager.regenerateRowPositions(),this.table.rowManager.reRenderInPosition()}},UYe={undo:["ctrl + 90","meta + 90"],redo:["ctrl + 89","meta + 89"]},DYe={undo:function(t){var e=!1;this.table.options.history&&this.table.modExists("history")&&this.table.modExists("edit")&&(e=this.table.modules.edit.currentCell,e||(t.preventDefault(),this.table.modules.history.undo()))},redo:function(t){var e=!1;this.table.options.history&&this.table.modExists("history")&&this.table.modExists("edit")&&(e=this.table.modules.edit.currentCell,e||(t.preventDefault(),this.table.modules.history.redo()))}},EYe={keybindings:{bindings:UYe,actions:DYe}},tf;let CYe=(tf=class extends Wn{constructor(e){super(e),this.history=[],this.index=-1,this.registerTableOption("history",!1)}initialize(){this.table.options.history&&(this.subscribe("cell-value-updated",this.cellUpdated.bind(this)),this.subscribe("cell-delete",this.clearComponentHistory.bind(this)),this.subscribe("row-delete",this.rowDeleted.bind(this)),this.subscribe("rows-wipe",this.clear.bind(this)),this.subscribe("row-added",this.rowAdded.bind(this)),this.subscribe("row-move",this.rowMoved.bind(this))),this.registerTableFunction("undo",this.undo.bind(this)),this.registerTableFunction("redo",this.redo.bind(this)),this.registerTableFunction("getHistoryUndoSize",this.getHistoryUndoSize.bind(this)),this.registerTableFunction("getHistoryRedoSize",this.getHistoryRedoSize.bind(this)),this.registerTableFunction("clearHistory",this.clear.bind(this))}rowMoved(e,i,n){this.action("rowMove",e,{posFrom:e.getPosition(),posTo:i.getPosition(),to:i,after:n})}rowAdded(e,i,n,r){this.action("rowAdd",e,{data:i,pos:n,index:r})}rowDeleted(e){var i,n;this.table.options.groupBy?(n=e.getComponent().getGroup()._getSelf().rows,i=n.indexOf(e),i&&(i=n[i-1])):(i=e.table.rowManager.getRowIndex(e),i&&(i=e.table.rowManager.rows[i-1])),this.action("rowDelete",e,{data:e.getData(),pos:!i,index:i})}cellUpdated(e){this.action("cellEdit",e,{oldValue:e.oldValue,newValue:e.value})}clear(){this.history=[],this.index=-1}action(e,i,n){this.history=this.history.slice(0,this.index+1),this.history.push({type:e,component:i,data:n}),this.index++}getHistoryUndoSize(){return this.index+1}getHistoryRedoSize(){return this.history.length-(this.index+1)}clearComponentHistory(e){var i=this.history.findIndex(function(n){return n.component===e});i>-1&&(this.history.splice(i,1),i<=this.index&&this.index--,this.clearComponentHistory(e))}undo(){if(this.index>-1){let e=this.history[this.index];return tf.undoers[e.type].call(this,e),this.index--,this.dispatchExternal("historyUndo",e.type,e.component.getComponent(),e.data),!0}else return console.warn(this.options("history")?"History Undo Error - No more history to undo":"History module not enabled"),!1}redo(){if(this.history.length-1>this.index){this.index++;let e=this.history[this.index];return tf.redoers[e.type].call(this,e),this.dispatchExternal("historyRedo",e.type,e.component.getComponent(),e.data),!0}else return console.warn(this.options("history")?"History Redo Error - No more history to redo":"History module not enabled"),!1}_rebindRow(e,i){this.history.forEach(function(n){if(n.component instanceof wc)n.component===e&&(n.component=i);else if(n.component instanceof ZR&&n.component.row===e){var r=n.component.column.getField();r&&(n.component=i.getCell(r))}})}},Je(tf,"moduleName","history"),Je(tf,"moduleExtensions",EYe),Je(tf,"undoers",SYe),Je(tf,"redoers",TYe),tf);class GTe extends Wn{constructor(e){super(e),this.fieldIndex=[],this.hasIndex=!1}initialize(){this.tableElementCheck()}tableElementCheck(){this.table.originalElement&&this.table.originalElement.tagName==="TABLE"&&(this.table.originalElement.childNodes.length?this.parseTable():console.warn("Unable to parse data from empty table tag, Tabulator should be initialized on a div tag unless importing data from a table element."))}parseTable(){var e=this.table.originalElement,i=this.table.options,n=e.getElementsByTagName("th"),r=e.getElementsByTagName("tbody")[0],a=[];this.hasIndex=!1,this.dispatchExternal("htmlImporting"),r=r?r.getElementsByTagName("tr"):[],this._extractOptions(e,i),n.length?this._extractHeaders(n,r):this._generateBlankHeaders(n,r);for(var o=0;o<r.length;o++){var s=r[o],l=s.getElementsByTagName("td"),c={};this.hasIndex||(c[i.index]=o);for(var u=0;u<l.length;u++){var d=l[u];typeof this.fieldIndex[u]<"u"&&(c[this.fieldIndex[u]]=d.innerHTML)}a.push(c)}i.data=a,this.dispatchExternal("htmlImported")}_extractOptions(e,i,n){var r=e.attributes,a=Object.keys(n||i),o={};a.forEach(u=>{o[u.toLowerCase()]=u});for(var s in r){var l=r[s],c;l&&typeof l=="object"&&l.name&&l.name.indexOf("tabulator-")===0&&(c=l.name.replace("tabulator-",""),typeof o[c]<"u"&&(i[o[c]]=this._attribValue(l.value)))}}_attribValue(e){return e==="true"?!0:e==="false"?!1:e}_findCol(e){var i=this.table.options.columns.find(n=>n.title===e);return i||!1}_extractHeaders(e,i){for(var n=0;n<e.length;n++){var r=e[n],a=!1,o=this._findCol(r.textContent),s;o?a=!0:o={title:r.textContent.trim()},o.field||(o.field=r.textContent.trim().toLowerCase().replaceAll(" ","_")),s=r.getAttribute("width"),s&&!o.width&&(o.width=s),this._extractOptions(r,o,this.table.columnManager.optionsList.registeredDefaults),this.fieldIndex[n]=o.field,o.field==this.table.options.index&&(this.hasIndex=!0),a||this.table.options.columns.push(o)}}_generateBlankHeaders(e,i){for(var n=0;n<e.length;n++){var r=e[n],a={title:"",field:"col"+n};this.fieldIndex[n]=a.field;var o=r.getAttribute("width");o&&(a.width=o),this.table.options.columns.push(a)}}}Je(GTe,"moduleName","htmlTableImport");function PYe(t){var e=[],i=0,n=0,r=!1;for(let a=0;a<t.length;a++){let o=t[a],s=t[a+1];if(e[i]||(e[i]=[]),e[i][n]||(e[i][n]=""),o=='"'&&r&&s=='"'){e[i][n]+=o,a++;continue}if(o=='"'){r=!r;continue}if(o==","&&!r){n++;continue}if(o=="\r"&&s==`
`&&!r){n=0,i++,a++;continue}if((o=="\r"||o==`
`)&&!r){n=0,i++;continue}e[i][n]+=o}return e}function RYe(t){try{return JSON.parse(t)}catch(e){return console.warn("JSON Import Error - File contents is invalid JSON",e),Promise.reject()}}function MYe(t){return t}function NYe(t,e){var i=XLSX.read(t),n=i.Sheets[i.SheetNames[0]];return XLSX.utils.sheet_to_json(n,{})}var AYe={csv:PYe,json:RYe,array:MYe,xlsx:NYe};const hD=class hD extends Wn{constructor(e){super(e),this.registerTableOption("importFormat"),this.registerTableOption("importReader","text")}initialize(){this.registerTableFunction("import",this.importFromFile.bind(this)),this.table.options.importFormat&&(this.subscribe("data-loading",this.loadDataCheck.bind(this),10),this.subscribe("data-load",this.loadData.bind(this),10))}loadDataCheck(e){return this.table.options.importFormat&&(typeof e=="string"||Array.isArray(e)&&e.length&&Array.isArray(e))}loadData(e,i,n,r,a){return this.importData(this.lookupImporter(),e).then(this.structureData.bind(this)).catch(o=>(console.error("Import Error:",o||"Unable to import data"),Promise.reject(o)))}lookupImporter(e){var i;return e||(e=this.table.options.importFormat),typeof e=="string"?i=hD.importers[e]:i=e,i||console.error("Import Error - Importer not found:",e),i}importFromFile(e,i,n){var r=this.lookupImporter(e);if(r)return this.pickFile(i,n).then(this.importData.bind(this,r)).then(this.structureData.bind(this)).then(this.setData.bind(this)).catch(a=>(this.dispatch("import-error",a),this.dispatchExternal("importError",a),console.error("Import Error:",a||"Unable to import file"),Promise.reject(a)))}pickFile(e,i){return new Promise((n,r)=>{var a=document.createElement("input");a.type="file",a.accept=e,a.addEventListener("change",o=>{var s=a.files[0],l=new FileReader;switch(this.dispatch("import-importing",a.files),this.dispatchExternal("importImporting",a.files),i||this.table.options.importReader){case"buffer":l.readAsArrayBuffer(s);break;case"binary":l.readAsBinaryString(s);break;case"url":l.readAsDataURL(s);break;case"text":default:l.readAsText(s)}l.onload=c=>{n(l.result)},l.onerror=c=>{console.warn("File Load Error - Unable to read file"),r()}}),this.dispatch("import-choose"),this.dispatchExternal("importChoose"),a.click()})}importData(e,i){var n=e.call(this.table,i);return n instanceof Promise?n:n?Promise.resolve(n):Promise.reject()}structureData(e){var i=[];return Array.isArray(e)&&e.length&&Array.isArray(e[0])?(this.table.options.autoColumns?i=this.structureArrayToObject(e):i=this.structureArrayToColumns(e),i):e}structureArrayToObject(e){var i=e.shift(),n=e.map(r=>{var a={};return i.forEach((o,s)=>{a[o]=r[s]}),a});return n}structureArrayToColumns(e){var i=[],n=this.table.getColumns();return n[0]&&e[0][0]&&n[0].getDefinition().title===e[0][0]&&e.shift(),e.forEach(r=>{var a={};r.forEach((o,s)=>{var l=n[s];l&&(a[l.getField()]=o)}),i.push(a)}),i}setData(e){return this.dispatch("import-imported",e),this.dispatchExternal("importImported",e),this.table.setData(e)}};Je(hD,"moduleName","import"),Je(hD,"importers",AYe);let iG=hD;class HTe extends Wn{constructor(e){super(e),this.eventMap={rowClick:"row-click",rowDblClick:"row-dblclick",rowContext:"row-contextmenu",rowMouseEnter:"row-mouseenter",rowMouseLeave:"row-mouseleave",rowMouseOver:"row-mouseover",rowMouseOut:"row-mouseout",rowMouseMove:"row-mousemove",rowMouseDown:"row-mousedown",rowMouseUp:"row-mouseup",rowTap:"row",rowDblTap:"row",rowTapHold:"row",cellClick:"cell-click",cellDblClick:"cell-dblclick",cellContext:"cell-contextmenu",cellMouseEnter:"cell-mouseenter",cellMouseLeave:"cell-mouseleave",cellMouseOver:"cell-mouseover",cellMouseOut:"cell-mouseout",cellMouseMove:"cell-mousemove",cellMouseDown:"cell-mousedown",cellMouseUp:"cell-mouseup",cellTap:"cell",cellDblTap:"cell",cellTapHold:"cell",headerClick:"column-click",headerDblClick:"column-dblclick",headerContext:"column-contextmenu",headerMouseEnter:"column-mouseenter",headerMouseLeave:"column-mouseleave",headerMouseOver:"column-mouseover",headerMouseOut:"column-mouseout",headerMouseMove:"column-mousemove",headerMouseDown:"column-mousedown",headerMouseUp:"column-mouseup",headerTap:"column",headerDblTap:"column",headerTapHold:"column",groupClick:"group-click",groupDblClick:"group-dblclick",groupContext:"group-contextmenu",groupMouseEnter:"group-mouseenter",groupMouseLeave:"group-mouseleave",groupMouseOver:"group-mouseover",groupMouseOut:"group-mouseout",groupMouseMove:"group-mousemove",groupMouseDown:"group-mousedown",groupMouseUp:"group-mouseup",groupTap:"group",groupDblTap:"group",groupTapHold:"group"},this.subscribers={},this.touchSubscribers={},this.columnSubscribers={},this.touchWatchers={row:{tap:null,tapDbl:null,tapHold:null},cell:{tap:null,tapDbl:null,tapHold:null},column:{tap:null,tapDbl:null,tapHold:null},group:{tap:null,tapDbl:null,tapHold:null}},this.registerColumnOption("headerClick"),this.registerColumnOption("headerDblClick"),this.registerColumnOption("headerContext"),this.registerColumnOption("headerMouseEnter"),this.registerColumnOption("headerMouseLeave"),this.registerColumnOption("headerMouseOver"),this.registerColumnOption("headerMouseOut"),this.registerColumnOption("headerMouseMove"),this.registerColumnOption("headerMouseDown"),this.registerColumnOption("headerMouseUp"),this.registerColumnOption("headerTap"),this.registerColumnOption("headerDblTap"),this.registerColumnOption("headerTapHold"),this.registerColumnOption("cellClick"),this.registerColumnOption("cellDblClick"),this.registerColumnOption("cellContext"),this.registerColumnOption("cellMouseEnter"),this.registerColumnOption("cellMouseLeave"),this.registerColumnOption("cellMouseOver"),this.registerColumnOption("cellMouseOut"),this.registerColumnOption("cellMouseMove"),this.registerColumnOption("cellMouseDown"),this.registerColumnOption("cellMouseUp"),this.registerColumnOption("cellTap"),this.registerColumnOption("cellDblTap"),this.registerColumnOption("cellTapHold")}initialize(){this.initializeExternalEvents(),this.subscribe("column-init",this.initializeColumn.bind(this)),this.subscribe("cell-dblclick",this.cellContentsSelectionFixer.bind(this)),this.subscribe("scroll-horizontal",this.clearTouchWatchers.bind(this)),this.subscribe("scroll-vertical",this.clearTouchWatchers.bind(this))}clearTouchWatchers(){var e=Object.values(this.touchWatchers);e.forEach(i=>{for(let n in i)i[n]=null})}cellContentsSelectionFixer(e,i){var n;if(!(this.table.modExists("edit")&&this.table.modules.edit.currentCell===i)){e.preventDefault();try{document.selection?(n=document.body.createTextRange(),n.moveToElementText(i.getElement()),n.select()):window.getSelection&&(n=document.createRange(),n.selectNode(i.getElement()),window.getSelection().removeAllRanges(),window.getSelection().addRange(n))}catch{}}}initializeExternalEvents(){for(let e in this.eventMap)this.subscriptionChangeExternal(e,this.subscriptionChanged.bind(this,e))}subscriptionChanged(e,i){i?this.subscribers[e]||(this.eventMap[e].includes("-")?(this.subscribers[e]=this.handle.bind(this,e),this.subscribe(this.eventMap[e],this.subscribers[e])):this.subscribeTouchEvents(e)):this.eventMap[e].includes("-")?this.subscribers[e]&&!this.columnSubscribers[e]&&!this.subscribedExternal(e)&&(this.unsubscribe(this.eventMap[e],this.subscribers[e]),delete this.subscribers[e]):this.unsubscribeTouchEvents(e)}subscribeTouchEvents(e){var i=this.eventMap[e];this.touchSubscribers[i+"-touchstart"]||(this.touchSubscribers[i+"-touchstart"]=this.handleTouch.bind(this,i,"start"),this.touchSubscribers[i+"-touchend"]=this.handleTouch.bind(this,i,"end"),this.subscribe(i+"-touchstart",this.touchSubscribers[i+"-touchstart"]),this.subscribe(i+"-touchend",this.touchSubscribers[i+"-touchend"])),this.subscribers[e]=!0}unsubscribeTouchEvents(e){var i=!0,n=this.eventMap[e];if(this.subscribers[e]&&!this.subscribedExternal(e)){delete this.subscribers[e];for(let r in this.eventMap)this.eventMap[r]===n&&this.subscribers[r]&&(i=!1);i&&(this.unsubscribe(n+"-touchstart",this.touchSubscribers[n+"-touchstart"]),this.unsubscribe(n+"-touchend",this.touchSubscribers[n+"-touchend"]),delete this.touchSubscribers[n+"-touchstart"],delete this.touchSubscribers[n+"-touchend"])}}initializeColumn(e){var i=e.definition;for(let n in this.eventMap)i[n]&&(this.subscriptionChanged(n,!0),this.columnSubscribers[n]||(this.columnSubscribers[n]=[]),this.columnSubscribers[n].push(e))}handle(e,i,n){this.dispatchEvent(e,i,n)}handleTouch(e,i,n,r){var a=this.touchWatchers[e];switch(e==="column"&&(e="header"),i){case"start":a.tap=!0,clearTimeout(a.tapHold),a.tapHold=setTimeout(()=>{clearTimeout(a.tapHold),a.tapHold=null,a.tap=null,clearTimeout(a.tapDbl),a.tapDbl=null,this.dispatchEvent(e+"TapHold",n,r)},1e3);break;case"end":a.tap&&(a.tap=null,this.dispatchEvent(e+"Tap",n,r)),a.tapDbl?(clearTimeout(a.tapDbl),a.tapDbl=null,this.dispatchEvent(e+"DblTap",n,r)):a.tapDbl=setTimeout(()=>{clearTimeout(a.tapDbl),a.tapDbl=null},300),clearTimeout(a.tapHold),a.tapHold=null;break}}dispatchEvent(e,i,n){var r=n.getComponent(),a;this.columnSubscribers[e]&&(n instanceof ZR?a=n.column.definition[e]:n instanceof Gb&&(a=n.definition[e]),a&&a(i,r)),this.dispatchExternal(e,i,r)}}Je(HTe,"moduleName","interaction");var _Ye={navPrev:"shift + 9",navNext:9,navUp:38,navDown:40,navLeft:37,navRight:39,scrollPageUp:33,scrollPageDown:34,scrollToStart:36,scrollToEnd:35},kYe={keyBlock:function(t){t.stopPropagation(),t.preventDefault()},scrollPageUp:function(t){var e=this.table.rowManager,i=e.scrollTop-e.element.clientHeight;t.preventDefault(),e.displayRowsCount&&(i>=0?e.element.scrollTop=i:e.scrollToRow(e.getDisplayRows()[0])),this.table.element.focus()},scrollPageDown:function(t){var e=this.table.rowManager,i=e.scrollTop+e.element.clientHeight,n=e.element.scrollHeight;t.preventDefault(),e.displayRowsCount&&(i<=n?e.element.scrollTop=i:e.scrollToRow(e.getDisplayRows()[e.displayRowsCount-1])),this.table.element.focus()},scrollToStart:function(t){var e=this.table.rowManager;t.preventDefault(),e.displayRowsCount&&e.scrollToRow(e.getDisplayRows()[0]),this.table.element.focus()},scrollToEnd:function(t){var e=this.table.rowManager;t.preventDefault(),e.displayRowsCount&&e.scrollToRow(e.getDisplayRows()[e.displayRowsCount-1]),this.table.element.focus()},navPrev:function(t){this.dispatch("keybinding-nav-prev",t)},navNext:function(t){this.dispatch("keybinding-nav-next",t)},navLeft:function(t){this.dispatch("keybinding-nav-left",t)},navRight:function(t){this.dispatch("keybinding-nav-right",t)},navUp:function(t){this.dispatch("keybinding-nav-up",t)},navDown:function(t){this.dispatch("keybinding-nav-down",t)}};const bv=class bv extends Wn{constructor(e){super(e),this.watchKeys=null,this.pressedKeys=null,this.keyupBinding=!1,this.keydownBinding=!1,this.registerTableOption("keybindings",{}),this.registerTableOption("tabEndNewRow",!1)}initialize(){var e=this.table.options.keybindings,i={};this.watchKeys={},this.pressedKeys=[],e!==!1&&(Object.assign(i,bv.bindings),Object.assign(i,e),this.mapBindings(i),this.bindEvents()),this.subscribe("table-destroy",this.clearBindings.bind(this))}mapBindings(e){for(let i in e)bv.actions[i]?e[i]&&(typeof e[i]!="object"&&(e[i]=[e[i]]),e[i].forEach(n=>{var r=Array.isArray(n)?n:[n];r.forEach(a=>{this.mapBinding(i,a)})})):console.warn("Key Binding Error - no such action:",i)}mapBinding(e,i){var n={action:bv.actions[e],keys:[],ctrl:!1,shift:!1,meta:!1},r=i.toString().toLowerCase().split(" ").join("").split("+");r.forEach(a=>{switch(a){case"ctrl":n.ctrl=!0;break;case"shift":n.shift=!0;break;case"meta":n.meta=!0;break;default:a=isNaN(a)?a.toUpperCase().charCodeAt(0):parseInt(a),n.keys.push(a),this.watchKeys[a]||(this.watchKeys[a]=[]),this.watchKeys[a].push(n)}})}bindEvents(){var e=this;this.keyupBinding=function(i){var n=i.keyCode,r=e.watchKeys[n];r&&(e.pressedKeys.push(n),r.forEach(function(a){e.checkBinding(i,a)}))},this.keydownBinding=function(i){var n=i.keyCode,r=e.watchKeys[n];if(r){var a=e.pressedKeys.indexOf(n);a>-1&&e.pressedKeys.splice(a,1)}},this.table.element.addEventListener("keydown",this.keyupBinding),this.table.element.addEventListener("keyup",this.keydownBinding)}clearBindings(){this.keyupBinding&&this.table.element.removeEventListener("keydown",this.keyupBinding),this.keydownBinding&&this.table.element.removeEventListener("keyup",this.keydownBinding)}checkBinding(e,i){var n=!0;return e.ctrlKey==i.ctrl&&e.shiftKey==i.shift&&e.metaKey==i.meta?(i.keys.forEach(r=>{var a=this.pressedKeys.indexOf(r);a==-1&&(n=!1)}),n&&i.action.call(this,e),!0):!1}};Je(bv,"moduleName","keybindings"),Je(bv,"bindings",_Ye),Je(bv,"actions",kYe);let nG=bv;class zTe extends Wn{constructor(e){super(e),this.menuContainer=null,this.nestedMenuBlock=!1,this.currentComponent=null,this.rootPopup=null,this.columnSubscribers={},this.registerTableOption("rowContextMenu",!1),this.registerTableOption("rowClickMenu",!1),this.registerTableOption("rowDblClickMenu",!1),this.registerTableOption("groupContextMenu",!1),this.registerTableOption("groupClickMenu",!1),this.registerTableOption("groupDblClickMenu",!1),this.registerColumnOption("headerContextMenu"),this.registerColumnOption("headerClickMenu"),this.registerColumnOption("headerDblClickMenu"),this.registerColumnOption("headerMenu"),this.registerColumnOption("headerMenuIcon"),this.registerColumnOption("contextMenu"),this.registerColumnOption("clickMenu"),this.registerColumnOption("dblClickMenu")}initialize(){this.deprecatedOptionsCheck(),this.initializeRowWatchers(),this.initializeGroupWatchers(),this.subscribe("column-init",this.initializeColumn.bind(this))}deprecatedOptionsCheck(){}initializeRowWatchers(){this.table.options.rowContextMenu&&(this.subscribe("row-contextmenu",this.loadMenuEvent.bind(this,this.table.options.rowContextMenu)),this.table.on("rowTapHold",this.loadMenuEvent.bind(this,this.table.options.rowContextMenu))),this.table.options.rowClickMenu&&this.subscribe("row-click",this.loadMenuEvent.bind(this,this.table.options.rowClickMenu)),this.table.options.rowDblClickMenu&&this.subscribe("row-dblclick",this.loadMenuEvent.bind(this,this.table.options.rowDblClickMenu))}initializeGroupWatchers(){this.table.options.groupContextMenu&&(this.subscribe("group-contextmenu",this.loadMenuEvent.bind(this,this.table.options.groupContextMenu)),this.table.on("groupTapHold",this.loadMenuEvent.bind(this,this.table.options.groupContextMenu))),this.table.options.groupClickMenu&&this.subscribe("group-click",this.loadMenuEvent.bind(this,this.table.options.groupClickMenu)),this.table.options.groupDblClickMenu&&this.subscribe("group-dblclick",this.loadMenuEvent.bind(this,this.table.options.groupDblClickMenu))}initializeColumn(e){var i=e.definition;i.headerContextMenu&&!this.columnSubscribers.headerContextMenu&&(this.columnSubscribers.headerContextMenu=this.loadMenuTableColumnEvent.bind(this,"headerContextMenu"),this.subscribe("column-contextmenu",this.columnSubscribers.headerContextMenu),this.table.on("headerTapHold",this.loadMenuTableColumnEvent.bind(this,"headerContextMenu"))),i.headerClickMenu&&!this.columnSubscribers.headerClickMenu&&(this.columnSubscribers.headerClickMenu=this.loadMenuTableColumnEvent.bind(this,"headerClickMenu"),this.subscribe("column-click",this.columnSubscribers.headerClickMenu)),i.headerDblClickMenu&&!this.columnSubscribers.headerDblClickMenu&&(this.columnSubscribers.headerDblClickMenu=this.loadMenuTableColumnEvent.bind(this,"headerDblClickMenu"),this.subscribe("column-dblclick",this.columnSubscribers.headerDblClickMenu)),i.headerMenu&&this.initializeColumnHeaderMenu(e),i.contextMenu&&!this.columnSubscribers.contextMenu&&(this.columnSubscribers.contextMenu=this.loadMenuTableCellEvent.bind(this,"contextMenu"),this.subscribe("cell-contextmenu",this.columnSubscribers.contextMenu),this.table.on("cellTapHold",this.loadMenuTableCellEvent.bind(this,"contextMenu"))),i.clickMenu&&!this.columnSubscribers.clickMenu&&(this.columnSubscribers.clickMenu=this.loadMenuTableCellEvent.bind(this,"clickMenu"),this.subscribe("cell-click",this.columnSubscribers.clickMenu)),i.dblClickMenu&&!this.columnSubscribers.dblClickMenu&&(this.columnSubscribers.dblClickMenu=this.loadMenuTableCellEvent.bind(this,"dblClickMenu"),this.subscribe("cell-dblclick",this.columnSubscribers.dblClickMenu))}initializeColumnHeaderMenu(e){var i=e.definition.headerMenuIcon,n;n=document.createElement("span"),n.classList.add("tabulator-header-popup-button"),i?(typeof i=="function"&&(i=i(e.getComponent())),i instanceof HTMLElement?n.appendChild(i):n.innerHTML=i):n.innerHTML="&vellip;",n.addEventListener("click",r=>{r.stopPropagation(),r.preventDefault(),this.loadMenuEvent(e.definition.headerMenu,r,e)}),e.titleElement.insertBefore(n,e.titleElement.firstChild)}loadMenuTableCellEvent(e,i,n){n._cell&&(n=n._cell),n.column.definition[e]&&this.loadMenuEvent(n.column.definition[e],i,n)}loadMenuTableColumnEvent(e,i,n){n._column&&(n=n._column),n.definition[e]&&this.loadMenuEvent(n.definition[e],i,n)}loadMenuEvent(e,i,n){n._group?n=n._group:n._row&&(n=n._row),e=typeof e=="function"?e.call(this.table,i,n.getComponent()):e,this.loadMenu(i,n,e)}loadMenu(e,i,n,r,a){var o=!(e instanceof MouseEvent),s=document.createElement("div"),l;if(s.classList.add("tabulator-menu"),o||e.preventDefault(),!(!n||!n.length)){if(r)l=a.child(s);else{if(this.nestedMenuBlock){if(this.rootPopup)return}else this.nestedMenuBlock=setTimeout(()=>{this.nestedMenuBlock=!1},100);this.rootPopup&&this.rootPopup.hide(),this.rootPopup=l=this.popup(s)}n.forEach(c=>{var u=document.createElement("div"),d=c.label,p=c.disabled;c.separator?u.classList.add("tabulator-menu-separator"):(u.classList.add("tabulator-menu-item"),typeof d=="function"&&(d=d.call(this.table,i.getComponent())),d instanceof Node?u.appendChild(d):u.innerHTML=d,typeof p=="function"&&(p=p.call(this.table,i.getComponent())),p?(u.classList.add("tabulator-menu-item-disabled"),u.addEventListener("click",h=>{h.stopPropagation()})):c.menu&&c.menu.length?u.addEventListener("click",h=>{h.stopPropagation(),this.loadMenu(h,i,c.menu,u,l)}):c.action&&u.addEventListener("click",h=>{c.action(h,i.getComponent())}),c.menu&&c.menu.length&&u.classList.add("tabulator-menu-item-submenu")),s.appendChild(u)}),s.addEventListener("click",c=>{this.rootPopup&&this.rootPopup.hide()}),l.show(r||e),l===this.rootPopup&&(this.rootPopup.hideOnBlur(()=>{this.rootPopup=null,this.currentComponent&&(this.dispatch("menu-closed",n,l),this.dispatchExternal("menuClosed",this.currentComponent.getComponent()),this.currentComponent=null)}),this.currentComponent=i,this.dispatch("menu-opened",n,l),this.dispatchExternal("menuOpened",i.getComponent()))}}}Je(zTe,"moduleName","menu");class qTe extends Wn{constructor(e){super(e),this.placeholderElement=this.createPlaceholderElement(),this.hoverElement=!1,this.checkTimeout=!1,this.checkPeriod=250,this.moving=!1,this.toCol=!1,this.toColAfter=!1,this.startX=0,this.autoScrollMargin=40,this.autoScrollStep=5,this.autoScrollTimeout=!1,this.touchMove=!1,this.moveHover=this.moveHover.bind(this),this.endMove=this.endMove.bind(this),this.registerTableOption("movableColumns",!1)}createPlaceholderElement(){var e=document.createElement("div");return e.classList.add("tabulator-col"),e.classList.add("tabulator-col-placeholder"),e}initialize(){this.table.options.movableColumns&&(this.subscribe("column-init",this.initializeColumn.bind(this)),this.subscribe("alert-show",this.abortMove.bind(this)))}abortMove(){clearTimeout(this.checkTimeout)}initializeColumn(e){var i=this,n={},r;!e.modules.frozen&&!e.isGroup&&!e.isRowHeader&&(r=e.getElement(),n.mousemove=(function(a){e.parent===i.moving.parent&&((i.touchMove?a.touches[0].pageX:a.pageX)-io.elOffset(r).left+i.table.columnManager.contentsElement.scrollLeft>e.getWidth()/2?(i.toCol!==e||!i.toColAfter)&&(r.parentNode.insertBefore(i.placeholderElement,r.nextSibling),i.moveColumn(e,!0)):(i.toCol!==e||i.toColAfter)&&(r.parentNode.insertBefore(i.placeholderElement,r),i.moveColumn(e,!1)))}).bind(i),r.addEventListener("mousedown",function(a){i.touchMove=!1,a.which===1&&(i.checkTimeout=setTimeout(function(){i.startMove(a,e)},i.checkPeriod))}),r.addEventListener("mouseup",function(a){a.which===1&&i.checkTimeout&&clearTimeout(i.checkTimeout)}),i.bindTouchEvents(e)),e.modules.moveColumn=n}bindTouchEvents(e){var i=e.getElement(),n=!1,r,a,o,s,l,c;i.addEventListener("touchstart",u=>{this.checkTimeout=setTimeout(()=>{this.touchMove=!0,r=e.nextColumn(),o=r?r.getWidth()/2:0,a=e.prevColumn(),s=a?a.getWidth()/2:0,l=0,c=0,n=!1,this.startMove(u,e)},this.checkPeriod)},{passive:!0}),i.addEventListener("touchmove",u=>{var d,p;this.moving&&(this.moveHover(u),n||(n=u.touches[0].pageX),d=u.touches[0].pageX-n,d>0?r&&d-l>o&&(p=r,p!==e&&(n=u.touches[0].pageX,p.getElement().parentNode.insertBefore(this.placeholderElement,p.getElement().nextSibling),this.moveColumn(p,!0))):a&&-d-c>s&&(p=a,p!==e&&(n=u.touches[0].pageX,p.getElement().parentNode.insertBefore(this.placeholderElement,p.getElement()),this.moveColumn(p,!1))),p&&(r=p.nextColumn(),l=o,o=r?r.getWidth()/2:0,a=p.prevColumn(),c=s,s=a?a.getWidth()/2:0))},{passive:!0}),i.addEventListener("touchend",u=>{this.checkTimeout&&clearTimeout(this.checkTimeout),this.moving&&this.endMove(u)})}startMove(e,i){var n=i.getElement(),r=this.table.columnManager.getContentsElement(),a=this.table.columnManager.getHeadersElement();this.moving=i,this.startX=(this.touchMove?e.touches[0].pageX:e.pageX)-io.elOffset(n).left,this.table.element.classList.add("tabulator-block-select"),this.placeholderElement.style.width=i.getWidth()+"px",this.placeholderElement.style.height=i.getHeight()+"px",n.parentNode.insertBefore(this.placeholderElement,n),n.parentNode.removeChild(n),this.hoverElement=n.cloneNode(!0),this.hoverElement.classList.add("tabulator-moving"),r.appendChild(this.hoverElement),this.hoverElement.style.left="0",this.hoverElement.style.bottom=r.clientHeight-a.offsetHeight+"px",this.touchMove||(this._bindMouseMove(),document.body.addEventListener("mousemove",this.moveHover),document.body.addEventListener("mouseup",this.endMove)),this.moveHover(e)}_bindMouseMove(){this.table.columnManager.columnsByIndex.forEach(function(e){e.modules.moveColumn.mousemove&&e.getElement().addEventListener("mousemove",e.modules.moveColumn.mousemove)})}_unbindMouseMove(){this.table.columnManager.columnsByIndex.forEach(function(e){e.modules.moveColumn.mousemove&&e.getElement().removeEventListener("mousemove",e.modules.moveColumn.mousemove)})}moveColumn(e,i){var n=this.moving.getCells();this.toCol=e,this.toColAfter=i,i?e.getCells().forEach(function(r,a){var o=r.getElement(!0);o.parentNode&&n[a]&&o.parentNode.insertBefore(n[a].getElement(),o.nextSibling)}):e.getCells().forEach(function(r,a){var o=r.getElement(!0);o.parentNode&&n[a]&&o.parentNode.insertBefore(n[a].getElement(),o)})}endMove(e){(e.which===1||this.touchMove)&&(this._unbindMouseMove(),this.placeholderElement.parentNode.insertBefore(this.moving.getElement(),this.placeholderElement.nextSibling),this.placeholderElement.parentNode.removeChild(this.placeholderElement),this.hoverElement.parentNode.removeChild(this.hoverElement),this.table.element.classList.remove("tabulator-block-select"),this.toCol&&this.table.columnManager.moveColumnActual(this.moving,this.toCol,this.toColAfter),this.moving=!1,this.toCol=!1,this.toColAfter=!1,this.touchMove||(document.body.removeEventListener("mousemove",this.moveHover),document.body.removeEventListener("mouseup",this.endMove)))}moveHover(e){var i=this.table.columnManager.getContentsElement(),n=i.scrollLeft,r=(this.touchMove?e.touches[0].pageX:e.pageX)-io.elOffset(i).left+n,a;this.hoverElement.style.left=r-this.startX+"px",r-n<this.autoScrollMargin&&(this.autoScrollTimeout||(this.autoScrollTimeout=setTimeout(()=>{a=Math.max(0,n-5),this.table.rowManager.getElement().scrollLeft=a,this.autoScrollTimeout=!1},1))),n+i.clientWidth-r<this.autoScrollMargin&&(this.autoScrollTimeout||(this.autoScrollTimeout=setTimeout(()=>{a=Math.min(i.clientWidth,n+5),this.table.rowManager.getElement().scrollLeft=a,this.autoScrollTimeout=!1},1)))}}Je(qTe,"moduleName","moveColumn");var xYe={delete:function(t,e,i){t.delete()}},OYe={insert:function(t,e,i){return this.table.addRow(t.getData(),void 0,e),!0},add:function(t,e,i){return this.table.addRow(t.getData()),!0},update:function(t,e,i){return e?(e.update(t.getData()),!0):!1},replace:function(t,e,i){return e?(this.table.addRow(t.getData(),void 0,e),e.delete(),!0):!1}};const fb=class fb extends Wn{constructor(e){super(e),this.placeholderElement=this.createPlaceholderElement(),this.hoverElement=!1,this.checkTimeout=!1,this.checkPeriod=150,this.moving=!1,this.toRow=!1,this.toRowAfter=!1,this.hasHandle=!1,this.startY=0,this.startX=0,this.moveHover=this.moveHover.bind(this),this.endMove=this.endMove.bind(this),this.tableRowDropEvent=!1,this.touchMove=!1,this.connection=!1,this.connectionSelectorsTables=!1,this.connectionSelectorsElements=!1,this.connectionElements=[],this.connections=[],this.connectedTable=!1,this.connectedRow=!1,this.registerTableOption("movableRows",!1),this.registerTableOption("movableRowsConnectedTables",!1),this.registerTableOption("movableRowsConnectedElements",!1),this.registerTableOption("movableRowsSender",!1),this.registerTableOption("movableRowsReceiver","insert"),this.registerColumnOption("rowHandle")}createPlaceholderElement(){var e=document.createElement("div");return e.classList.add("tabulator-row"),e.classList.add("tabulator-row-placeholder"),e}initialize(){this.table.options.movableRows&&(this.connectionSelectorsTables=this.table.options.movableRowsConnectedTables,this.connectionSelectorsElements=this.table.options.movableRowsConnectedElements,this.connection=this.connectionSelectorsTables||this.connectionSelectorsElements,this.subscribe("cell-init",this.initializeCell.bind(this)),this.subscribe("column-init",this.initializeColumn.bind(this)),this.subscribe("row-init",this.initializeRow.bind(this)))}initializeGroupHeader(e){var i=this,n={};n.mouseup=(function(r){i.tableRowDrop(r,e)}).bind(i),n.mousemove=(function(r){var a;r.pageY-io.elOffset(e.element).top+i.table.rowManager.element.scrollTop>e.getHeight()/2?(i.toRow!==e||!i.toRowAfter)&&(a=e.getElement(),a.parentNode.insertBefore(i.placeholderElement,a.nextSibling),i.moveRow(e,!0)):(i.toRow!==e||i.toRowAfter)&&(a=e.getElement(),a.previousSibling&&(a.parentNode.insertBefore(i.placeholderElement,a),i.moveRow(e,!1)))}).bind(i),e.modules.moveRow=n}initializeRow(e){var i=this,n={},r;n.mouseup=(function(a){i.tableRowDrop(a,e)}).bind(i),n.mousemove=(function(a){var o=e.getElement();a.pageY-io.elOffset(o).top+i.table.rowManager.element.scrollTop>e.getHeight()/2?(i.toRow!==e||!i.toRowAfter)&&(o.parentNode.insertBefore(i.placeholderElement,o.nextSibling),i.moveRow(e,!0)):(i.toRow!==e||i.toRowAfter)&&(o.parentNode.insertBefore(i.placeholderElement,o),i.moveRow(e,!1))}).bind(i),this.hasHandle||(r=e.getElement(),r.addEventListener("mousedown",function(a){a.which===1&&(i.checkTimeout=setTimeout(function(){i.startMove(a,e)},i.checkPeriod))}),r.addEventListener("mouseup",function(a){a.which===1&&i.checkTimeout&&clearTimeout(i.checkTimeout)}),this.bindTouchEvents(e,e.getElement())),e.modules.moveRow=n}initializeColumn(e){e.definition.rowHandle&&this.table.options.movableRows!==!1&&(this.hasHandle=!0)}initializeCell(e){if(e.column.definition.rowHandle&&this.table.options.movableRows!==!1){var i=this,n=e.getElement(!0);n.addEventListener("mousedown",function(r){r.which===1&&(i.checkTimeout=setTimeout(function(){i.startMove(r,e.row)},i.checkPeriod))}),n.addEventListener("mouseup",function(r){r.which===1&&i.checkTimeout&&clearTimeout(i.checkTimeout)}),this.bindTouchEvents(e.row,n)}}bindTouchEvents(e,i){var n=!1,r,a,o,s,l,c;i.addEventListener("touchstart",u=>{this.checkTimeout=setTimeout(()=>{this.touchMove=!0,r=e.nextRow(),o=r?r.getHeight()/2:0,a=e.prevRow(),s=a?a.getHeight()/2:0,l=0,c=0,n=!1,this.startMove(u,e)},this.checkPeriod)},{passive:!0}),this.moving,this.toRow,this.toRowAfter,i.addEventListener("touchmove",u=>{var d,p;this.moving&&(u.preventDefault(),this.moveHover(u),n||(n=u.touches[0].pageY),d=u.touches[0].pageY-n,d>0?r&&d-l>o&&(p=r,p!==e&&(n=u.touches[0].pageY,p.getElement().parentNode.insertBefore(this.placeholderElement,p.getElement().nextSibling),this.moveRow(p,!0))):a&&-d-c>s&&(p=a,p!==e&&(n=u.touches[0].pageY,p.getElement().parentNode.insertBefore(this.placeholderElement,p.getElement()),this.moveRow(p,!1))),p&&(r=p.nextRow(),l=o,o=r?r.getHeight()/2:0,a=p.prevRow(),c=s,s=a?a.getHeight()/2:0))}),i.addEventListener("touchend",u=>{this.checkTimeout&&clearTimeout(this.checkTimeout),this.moving&&(this.endMove(u),this.touchMove=!1)})}_bindMouseMove(){this.table.rowManager.getDisplayRows().forEach(e=>{(e.type==="row"||e.type==="group")&&e.modules.moveRow&&e.modules.moveRow.mousemove&&e.getElement().addEventListener("mousemove",e.modules.moveRow.mousemove)})}_unbindMouseMove(){this.table.rowManager.getDisplayRows().forEach(e=>{(e.type==="row"||e.type==="group")&&e.modules.moveRow&&e.modules.moveRow.mousemove&&e.getElement().removeEventListener("mousemove",e.modules.moveRow.mousemove)})}startMove(e,i){var n=i.getElement();this.setStartPosition(e,i),this.moving=i,this.table.element.classList.add("tabulator-block-select"),this.placeholderElement.style.width=i.getWidth()+"px",this.placeholderElement.style.height=i.getHeight()+"px",this.connection?(this.table.element.classList.add("tabulator-movingrow-sending"),this.connectToTables(i)):(n.parentNode.insertBefore(this.placeholderElement,n),n.parentNode.removeChild(n)),this.hoverElement=n.cloneNode(!0),this.hoverElement.classList.add("tabulator-moving"),this.connection?(document.body.appendChild(this.hoverElement),this.hoverElement.style.left="0",this.hoverElement.style.top="0",this.hoverElement.style.width=this.table.element.clientWidth+"px",this.hoverElement.style.whiteSpace="nowrap",this.hoverElement.style.overflow="hidden",this.hoverElement.style.pointerEvents="none"):(this.table.rowManager.getTableElement().appendChild(this.hoverElement),this.hoverElement.style.left="0",this.hoverElement.style.top="0",this._bindMouseMove()),document.body.addEventListener("mousemove",this.moveHover),document.body.addEventListener("mouseup",this.endMove),this.dispatchExternal("rowMoving",i.getComponent()),this.moveHover(e)}setStartPosition(e,i){var n=this.touchMove?e.touches[0].pageX:e.pageX,r=this.touchMove?e.touches[0].pageY:e.pageY,a,o;a=i.getElement(),this.connection?(o=a.getBoundingClientRect(),this.startX=o.left-n+window.pageXOffset,this.startY=o.top-r+window.pageYOffset):this.startY=r-a.getBoundingClientRect().top}endMove(e){(!e||e.which===1||this.touchMove)&&(this._unbindMouseMove(),this.connection||(this.placeholderElement.parentNode.insertBefore(this.moving.getElement(),this.placeholderElement.nextSibling),this.placeholderElement.parentNode.removeChild(this.placeholderElement)),this.hoverElement.parentNode.removeChild(this.hoverElement),this.table.element.classList.remove("tabulator-block-select"),this.toRow?this.table.rowManager.moveRow(this.moving,this.toRow,this.toRowAfter):this.dispatchExternal("rowMoveCancelled",this.moving.getComponent()),this.moving=!1,this.toRow=!1,this.toRowAfter=!1,document.body.removeEventListener("mousemove",this.moveHover),document.body.removeEventListener("mouseup",this.endMove),this.connection&&(this.table.element.classList.remove("tabulator-movingrow-sending"),this.disconnectFromTables()))}moveRow(e,i){this.toRow=e,this.toRowAfter=i}moveHover(e){this.connection?this.moveHoverConnections.call(this,e):this.moveHoverTable.call(this,e)}moveHoverTable(e){var i=this.table.rowManager.getElement(),n=i.scrollTop,r=(this.touchMove?e.touches[0].pageY:e.pageY)-i.getBoundingClientRect().top+n;this.hoverElement.style.top=Math.min(r-this.startY,this.table.rowManager.element.scrollHeight-this.hoverElement.offsetHeight)+"px"}moveHoverConnections(e){this.hoverElement.style.left=this.startX+(this.touchMove?e.touches[0].pageX:e.pageX)+"px",this.hoverElement.style.top=this.startY+(this.touchMove?e.touches[0].pageY:e.pageY)+"px"}elementRowDrop(e,i,n){this.dispatchExternal("movableRowsElementDrop",e,i,n?n.getComponent():!1)}connectToTables(e){var i;this.connectionSelectorsTables&&(i=this.commsConnections(this.connectionSelectorsTables),this.dispatchExternal("movableRowsSendingStart",i),this.commsSend(this.connectionSelectorsTables,"moveRow","connect",{row:e})),this.connectionSelectorsElements&&(this.connectionElements=[],Array.isArray(this.connectionSelectorsElements)||(this.connectionSelectorsElements=[this.connectionSelectorsElements]),this.connectionSelectorsElements.forEach(n=>{typeof n=="string"?this.connectionElements=this.connectionElements.concat(Array.prototype.slice.call(document.querySelectorAll(n))):this.connectionElements.push(n)}),this.connectionElements.forEach(n=>{var r=a=>{this.elementRowDrop(a,n,this.moving)};n.addEventListener("mouseup",r),n.tabulatorElementDropEvent=r,n.classList.add("tabulator-movingrow-receiving")}))}disconnectFromTables(){var e;this.connectionSelectorsTables&&(e=this.commsConnections(this.connectionSelectorsTables),this.dispatchExternal("movableRowsSendingStop",e),this.commsSend(this.connectionSelectorsTables,"moveRow","disconnect")),this.connectionElements.forEach(i=>{i.classList.remove("tabulator-movingrow-receiving"),i.removeEventListener("mouseup",i.tabulatorElementDropEvent),delete i.tabulatorElementDropEvent})}connect(e,i){return this.connectedTable?(console.warn("Move Row Error - Table cannot accept connection, already connected to table:",this.connectedTable),!1):(this.connectedTable=e,this.connectedRow=i,this.table.element.classList.add("tabulator-movingrow-receiving"),this.table.rowManager.getDisplayRows().forEach(n=>{n.type==="row"&&n.modules.moveRow&&n.modules.moveRow.mouseup&&n.getElement().addEventListener("mouseup",n.modules.moveRow.mouseup)}),this.tableRowDropEvent=this.tableRowDrop.bind(this),this.table.element.addEventListener("mouseup",this.tableRowDropEvent),this.dispatchExternal("movableRowsReceivingStart",i,e),!0)}disconnect(e){e===this.connectedTable?(this.connectedTable=!1,this.connectedRow=!1,this.table.element.classList.remove("tabulator-movingrow-receiving"),this.table.rowManager.getDisplayRows().forEach(i=>{i.type==="row"&&i.modules.moveRow&&i.modules.moveRow.mouseup&&i.getElement().removeEventListener("mouseup",i.modules.moveRow.mouseup)}),this.table.element.removeEventListener("mouseup",this.tableRowDropEvent),this.dispatchExternal("movableRowsReceivingStop",e)):console.warn("Move Row Error - trying to disconnect from non connected table")}dropComplete(e,i,n){var r=!1;if(n){switch(typeof this.table.options.movableRowsSender){case"string":r=fb.senders[this.table.options.movableRowsSender];break;case"function":r=this.table.options.movableRowsSender;break}r?r.call(this,this.moving?this.moving.getComponent():void 0,i?i.getComponent():void 0,e):this.table.options.movableRowsSender&&console.warn("Mover Row Error - no matching sender found:",this.table.options.movableRowsSender),this.dispatchExternal("movableRowsSent",this.moving.getComponent(),i?i.getComponent():void 0,e)}else this.dispatchExternal("movableRowsSentFailed",this.moving.getComponent(),i?i.getComponent():void 0,e);this.endMove()}tableRowDrop(e,i){var n=!1,r=!1;switch(e.stopImmediatePropagation(),typeof this.table.options.movableRowsReceiver){case"string":n=fb.receivers[this.table.options.movableRowsReceiver];break;case"function":n=this.table.options.movableRowsReceiver;break}n?r=n.call(this,this.connectedRow.getComponent(),i?i.getComponent():void 0,this.connectedTable):console.warn("Mover Row Error - no matching receiver found:",this.table.options.movableRowsReceiver),r?this.dispatchExternal("movableRowsReceived",this.connectedRow.getComponent(),i?i.getComponent():void 0,this.connectedTable):this.dispatchExternal("movableRowsReceivedFailed",this.connectedRow.getComponent(),i?i.getComponent():void 0,this.connectedTable),this.commsSend(this.connectedTable,"moveRow","dropcomplete",{row:i,success:r})}commsReceived(e,i,n){switch(i){case"connect":return this.connect(e,n.row);case"disconnect":return this.disconnect(e);case"dropcomplete":return this.dropComplete(e,n.row,n.success)}}};Je(fb,"moduleName","moveRow"),Je(fb,"senders",xYe),Je(fb,"receivers",OYe);let rG=fb;var LYe={};const L0=class L0 extends Wn{constructor(e){super(e),this.allowedTypes=["","data","edit","clipboard"],this.enabled=!0,this.registerColumnOption("mutator"),this.registerColumnOption("mutatorParams"),this.registerColumnOption("mutatorData"),this.registerColumnOption("mutatorDataParams"),this.registerColumnOption("mutatorEdit"),this.registerColumnOption("mutatorEditParams"),this.registerColumnOption("mutatorClipboard"),this.registerColumnOption("mutatorClipboardParams"),this.registerColumnOption("mutateLink")}initialize(){this.subscribe("cell-value-changing",this.transformCell.bind(this)),this.subscribe("cell-value-changed",this.mutateLink.bind(this)),this.subscribe("column-layout",this.initializeColumn.bind(this)),this.subscribe("row-data-init-before",this.rowDataChanged.bind(this)),this.subscribe("row-data-changing",this.rowDataChanged.bind(this))}rowDataChanged(e,i,n){return this.transformRow(i,"data",n)}initializeColumn(e){var i=!1,n={};this.allowedTypes.forEach(r=>{var a="mutator"+(r.charAt(0).toUpperCase()+r.slice(1)),o;e.definition[a]&&(o=this.lookupMutator(e.definition[a]),o&&(i=!0,n[a]={mutator:o,params:e.definition[a+"Params"]||{}}))}),i&&(e.modules.mutate=n)}lookupMutator(e){var i=!1;switch(typeof e){case"string":L0.mutators[e]?i=L0.mutators[e]:console.warn("Mutator Error - No such mutator found, ignoring: ",e);break;case"function":i=e;break}return i}transformRow(e,i,n){var r="mutator"+(i.charAt(0).toUpperCase()+i.slice(1)),a;return this.enabled&&this.table.columnManager.traverse(o=>{var s,l,c;o.modules.mutate&&(s=o.modules.mutate[r]||o.modules.mutate.mutator||!1,s&&(a=o.getFieldValue(typeof n<"u"?n:e),(i=="data"&&!n||typeof a<"u")&&(c=o.getComponent(),l=typeof s.params=="function"?s.params(a,e,i,c):s.params,o.setFieldValue(e,s.mutator(a,e,i,l,c)))))}),e}transformCell(e,i){if(e.column.modules.mutate){var n=e.column.modules.mutate.mutatorEdit||e.column.modules.mutate.mutator||!1,r={};if(n)return r=Object.assign(r,e.row.getData()),e.column.setFieldValue(r,i),n.mutator(i,r,"edit",n.params,e.getComponent())}return i}mutateLink(e){var i=e.column.definition.mutateLink;i&&(Array.isArray(i)||(i=[i]),i.forEach(n=>{var r=e.row.getCell(n);r&&r.setValue(r.getValue(),!0,!0)}))}enable(){this.enabled=!0}disable(){this.enabled=!1}};Je(L0,"moduleName","mutator"),Je(L0,"mutators",LYe);let aG=L0;function FYe(t,e,i,n,r){var a=document.createElement("span"),o=document.createElement("span"),s=document.createElement("span"),l=document.createElement("span"),c=document.createElement("span"),u=document.createElement("span");return this.table.modules.localize.langBind("pagination|counter|showing",d=>{o.innerHTML=d}),this.table.modules.localize.langBind("pagination|counter|of",d=>{l.innerHTML=d}),this.table.modules.localize.langBind("pagination|counter|rows",d=>{u.innerHTML=d}),n?(s.innerHTML=" "+e+"-"+Math.min(e+t-1,n)+" ",c.innerHTML=" "+n+" ",a.appendChild(o),a.appendChild(s),a.appendChild(l),a.appendChild(c),a.appendChild(u)):(s.innerHTML=" 0 ",a.appendChild(o),a.appendChild(s),a.appendChild(u)),a}function BYe(t,e,i,n,r){var a=document.createElement("span"),o=document.createElement("span"),s=document.createElement("span"),l=document.createElement("span"),c=document.createElement("span"),u=document.createElement("span");return this.table.modules.localize.langBind("pagination|counter|showing",d=>{o.innerHTML=d}),s.innerHTML=" "+i+" ",this.table.modules.localize.langBind("pagination|counter|of",d=>{l.innerHTML=d}),c.innerHTML=" "+r+" ",this.table.modules.localize.langBind("pagination|counter|pages",d=>{u.innerHTML=d}),a.appendChild(o),a.appendChild(s),a.appendChild(l),a.appendChild(c),a.appendChild(u),a}var $Ye={rows:FYe,pages:BYe};const fD=class fD extends Wn{constructor(e){super(e),this.mode="local",this.progressiveLoad=!1,this.element=null,this.pageCounterElement=null,this.pageCounter=null,this.size=0,this.page=1,this.count=5,this.max=1,this.remoteRowCountEstimate=null,this.initialLoad=!0,this.dataChanging=!1,this.pageSizes=[],this.registerTableOption("pagination",!1),this.registerTableOption("paginationMode","local"),this.registerTableOption("paginationSize",!1),this.registerTableOption("paginationInitialPage",1),this.registerTableOption("paginationCounter",!1),this.registerTableOption("paginationCounterElement",!1),this.registerTableOption("paginationButtonCount",5),this.registerTableOption("paginationSizeSelector",!1),this.registerTableOption("paginationElement",!1),this.registerTableOption("paginationAddRow","page"),this.registerTableOption("progressiveLoad",!1),this.registerTableOption("progressiveLoadDelay",0),this.registerTableOption("progressiveLoadScrollMargin",0),this.registerTableFunction("setMaxPage",this.setMaxPage.bind(this)),this.registerTableFunction("setPage",this.setPage.bind(this)),this.registerTableFunction("setPageToRow",this.userSetPageToRow.bind(this)),this.registerTableFunction("setPageSize",this.userSetPageSize.bind(this)),this.registerTableFunction("getPageSize",this.getPageSize.bind(this)),this.registerTableFunction("previousPage",this.previousPage.bind(this)),this.registerTableFunction("nextPage",this.nextPage.bind(this)),this.registerTableFunction("getPage",this.getPage.bind(this)),this.registerTableFunction("getPageMax",this.getPageMax.bind(this)),this.registerComponentFunction("row","pageTo",this.setPageToRow.bind(this))}initialize(){this.table.options.pagination?(this.subscribe("row-deleted",this.rowsUpdated.bind(this)),this.subscribe("row-added",this.rowsUpdated.bind(this)),this.subscribe("data-processed",this.initialLoadComplete.bind(this)),this.subscribe("table-built",this.calculatePageSizes.bind(this)),this.subscribe("footer-redraw",this.footerRedraw.bind(this)),this.table.options.paginationAddRow=="page"&&this.subscribe("row-adding-position",this.rowAddingPosition.bind(this)),this.table.options.paginationMode==="remote"&&(this.subscribe("data-params",this.remotePageParams.bind(this)),this.subscribe("data-loaded",this._parseRemoteData.bind(this))),this.table.options.progressiveLoad&&console.error("Progressive Load Error - Pagination and progressive load cannot be used at the same time"),this.registerDisplayHandler(this.restOnRenderBefore.bind(this),40),this.registerDisplayHandler(this.getRows.bind(this),50),this.createElements(),this.initializePageCounter(),this.initializePaginator()):this.table.options.progressiveLoad&&(this.subscribe("data-params",this.remotePageParams.bind(this)),this.subscribe("data-loaded",this._parseRemoteData.bind(this)),this.subscribe("table-built",this.calculatePageSizes.bind(this)),this.subscribe("data-processed",this.initialLoadComplete.bind(this)),this.initializeProgressive(this.table.options.progressiveLoad),this.table.options.progressiveLoad==="scroll"&&this.subscribe("scroll-vertical",this.scrollVertical.bind(this)))}rowAddingPosition(e,i){var n=this.table.rowManager,r=n.getDisplayRows(),a;return i?r.length?a=r[0]:n.activeRows.length&&(a=n.activeRows[n.activeRows.length-1],i=!1):r.length&&(a=r[r.length-1],i=!(r.length<this.size)),{index:a,top:i}}calculatePageSizes(){var e,i;this.table.options.paginationSize?this.size=this.table.options.paginationSize:(e=document.createElement("div"),e.classList.add("tabulator-row"),e.style.visibility="hidden",i=document.createElement("div"),i.classList.add("tabulator-cell"),i.innerHTML="Page Row Test",e.appendChild(i),this.table.rowManager.getTableElement().appendChild(e),this.size=Math.floor(this.table.rowManager.getElement().clientHeight/e.offsetHeight),this.table.rowManager.getTableElement().removeChild(e)),this.dispatchExternal("pageSizeChanged",this.size),this.generatePageSizeSelectList()}initialLoadComplete(){this.initialLoad=!1}remotePageParams(e,i,n,r){return this.initialLoad||(this.progressiveLoad&&!n||!this.progressiveLoad&&!this.dataChanging)&&this.reset(!0),r.page=this.page,this.size&&(r.size=this.size),r}userSetPageToRow(e){return this.table.options.pagination&&(e=this.table.rowManager.findRow(e),e)?this.setPageToRow(e):Promise.reject()}userSetPageSize(e){return this.table.options.pagination?(this.setPageSize(e),this.setPage(1)):!1}scrollVertical(e,i){var n,r,a;!i&&!this.table.dataLoader.loading&&(n=this.table.rowManager.getElement(),r=n.scrollHeight-n.clientHeight-e,a=this.table.options.progressiveLoadScrollMargin||n.clientHeight*2,r<a&&this.nextPage().catch(()=>{}))}restOnRenderBefore(e,i){return i||this.mode==="local"&&this.reset(),e}rowsUpdated(){this.refreshData(!0,"all")}createElements(){var e;this.element=document.createElement("span"),this.element.classList.add("tabulator-paginator"),this.pagesElement=document.createElement("span"),this.pagesElement.classList.add("tabulator-pages"),e=document.createElement("button"),e.classList.add("tabulator-page"),e.setAttribute("type","button"),e.setAttribute("role","button"),e.setAttribute("aria-label",""),e.setAttribute("title",""),this.firstBut=e.cloneNode(!0),this.firstBut.setAttribute("data-page","first"),this.prevBut=e.cloneNode(!0),this.prevBut.setAttribute("data-page","prev"),this.nextBut=e.cloneNode(!0),this.nextBut.setAttribute("data-page","next"),this.lastBut=e.cloneNode(!0),this.lastBut.setAttribute("data-page","last"),this.table.options.paginationSizeSelector&&(this.pageSizeSelect=document.createElement("select"),this.pageSizeSelect.classList.add("tabulator-page-size"))}generatePageSizeSelectList(){var e=[];if(this.pageSizeSelect){if(Array.isArray(this.table.options.paginationSizeSelector))e=this.table.options.paginationSizeSelector,this.pageSizes=e,this.pageSizes.indexOf(this.size)==-1&&e.unshift(this.size);else if(this.pageSizes.indexOf(this.size)==-1){e=[];for(let i=1;i<5;i++)e.push(this.size*i);this.pageSizes=e}else e=this.pageSizes;for(;this.pageSizeSelect.firstChild;)this.pageSizeSelect.removeChild(this.pageSizeSelect.firstChild);e.forEach(i=>{var n=document.createElement("option");n.value=i,i===!0?this.langBind("pagination|all",function(r){n.innerHTML=r}):n.innerHTML=i,this.pageSizeSelect.appendChild(n)}),this.pageSizeSelect.value=this.size}}initializePageCounter(){var e=this.table.options.paginationCounter,i=null;e&&(typeof e=="function"?i=e:i=fD.pageCounters[e],i?(this.pageCounter=i,this.pageCounterElement=document.createElement("span"),this.pageCounterElement.classList.add("tabulator-page-counter")):console.warn("Pagination Error - No such page counter found: ",e))}initializePaginator(e){var i,n;e||(this.langBind("pagination|first",r=>{this.firstBut.innerHTML=r}),this.langBind("pagination|first_title",r=>{this.firstBut.setAttribute("aria-label",r),this.firstBut.setAttribute("title",r)}),this.langBind("pagination|prev",r=>{this.prevBut.innerHTML=r}),this.langBind("pagination|prev_title",r=>{this.prevBut.setAttribute("aria-label",r),this.prevBut.setAttribute("title",r)}),this.langBind("pagination|next",r=>{this.nextBut.innerHTML=r}),this.langBind("pagination|next_title",r=>{this.nextBut.setAttribute("aria-label",r),this.nextBut.setAttribute("title",r)}),this.langBind("pagination|last",r=>{this.lastBut.innerHTML=r}),this.langBind("pagination|last_title",r=>{this.lastBut.setAttribute("aria-label",r),this.lastBut.setAttribute("title",r)}),this.firstBut.addEventListener("click",()=>{this.setPage(1)}),this.prevBut.addEventListener("click",()=>{this.previousPage()}),this.nextBut.addEventListener("click",()=>{this.nextPage()}),this.lastBut.addEventListener("click",()=>{this.setPage(this.max)}),this.table.options.paginationElement&&(this.element=this.table.options.paginationElement),this.pageSizeSelect&&(i=document.createElement("label"),this.langBind("pagination|page_size",r=>{this.pageSizeSelect.setAttribute("aria-label",r),this.pageSizeSelect.setAttribute("title",r),i.innerHTML=r}),this.element.appendChild(i),this.element.appendChild(this.pageSizeSelect),this.pageSizeSelect.addEventListener("change",r=>{this.setPageSize(this.pageSizeSelect.value=="true"?!0:this.pageSizeSelect.value),this.setPage(1)})),this.element.appendChild(this.firstBut),this.element.appendChild(this.prevBut),this.element.appendChild(this.pagesElement),this.element.appendChild(this.nextBut),this.element.appendChild(this.lastBut),this.table.options.paginationElement||(this.table.options.paginationCounter&&(this.table.options.paginationCounterElement?this.table.options.paginationCounterElement instanceof HTMLElement?this.table.options.paginationCounterElement.appendChild(this.pageCounterElement):typeof this.table.options.paginationCounterElement=="string"&&(n=document.querySelector(this.table.options.paginationCounterElement),n?n.appendChild(this.pageCounterElement):console.warn("Pagination Error - Unable to find element matching paginationCounterElement selector:",this.table.options.paginationCounterElement)):this.footerAppend(this.pageCounterElement)),this.footerAppend(this.element)),this.page=this.table.options.paginationInitialPage,this.count=this.table.options.paginationButtonCount),this.mode=this.table.options.paginationMode}initializeProgressive(e){this.initializePaginator(!0),this.mode="progressive_"+e,this.progressiveLoad=!0}trackChanges(){this.dispatch("page-changed")}setMaxRows(e){e?this.max=this.size===!0?1:Math.ceil(e/this.size):this.max=1,this.page>this.max&&(this.page=this.max)}reset(e){this.initialLoad||(this.mode=="local"||e)&&(this.page=1,this.trackChanges())}setMaxPage(e){e=parseInt(e),this.max=e||1,this.page>this.max&&(this.page=this.max,this.trigger())}setPage(e){switch(e){case"first":return this.setPage(1);case"prev":return this.previousPage();case"next":return this.nextPage();case"last":return this.setPage(this.max)}return e=parseInt(e),e>0&&e<=this.max||this.mode!=="local"?(this.page=e,this.trackChanges(),this.trigger()):(console.warn("Pagination Error - Requested page is out of range of 1 - "+this.max+":",e),Promise.reject())}setPageToRow(e){var i=this.displayRows(-1),n=i.indexOf(e);if(n>-1){var r=this.size===!0?1:Math.ceil((n+1)/this.size);return this.setPage(r)}else return console.warn("Pagination Error - Requested row is not visible"),Promise.reject()}setPageSize(e){e!==!0&&(e=parseInt(e)),e>0&&(this.size=e,this.dispatchExternal("pageSizeChanged",e)),this.pageSizeSelect&&this.generatePageSizeSelectList(),this.trackChanges()}_setPageCounter(e,i,n){var r;if(this.pageCounter)switch(this.mode==="remote"&&(i=this.size,n=(this.page-1)*this.size+1,e=this.remoteRowCountEstimate),r=this.pageCounter.call(this,i,n,this.page,e,this.max),typeof r){case"object":if(r instanceof Node){for(;this.pageCounterElement.firstChild;)this.pageCounterElement.removeChild(this.pageCounterElement.firstChild);this.pageCounterElement.appendChild(r)}else this.pageCounterElement.innerHTML="",r!=null&&console.warn("Page Counter Error - Page Counter has returned a type of object, the only valid page counter object return is an instance of Node, the page counter returned:",r);break;case"undefined":this.pageCounterElement.innerHTML="";break;default:this.pageCounterElement.innerHTML=r}}_setPageButtons(){let e=Math.floor((this.count-1)/2),i=Math.ceil((this.count-1)/2),n=this.max-this.page+e+1<this.count?this.max-this.count+1:Math.max(this.page-e,1),r=this.page<=i?Math.min(this.count,this.max):Math.min(this.page+i,this.max);for(;this.pagesElement.firstChild;)this.pagesElement.removeChild(this.pagesElement.firstChild);this.page==1?(this.firstBut.disabled=!0,this.prevBut.disabled=!0):(this.firstBut.disabled=!1,this.prevBut.disabled=!1),this.page==this.max?(this.lastBut.disabled=!0,this.nextBut.disabled=!0):(this.lastBut.disabled=!1,this.nextBut.disabled=!1);for(let a=n;a<=r;a++)a>0&&a<=this.max&&this.pagesElement.appendChild(this._generatePageButton(a));this.footerRedraw()}_generatePageButton(e){var i=document.createElement("button");return i.classList.add("tabulator-page"),e==this.page&&i.classList.add("active"),i.setAttribute("type","button"),i.setAttribute("role","button"),this.langBind("pagination|page_title",n=>{i.setAttribute("aria-label",n+" "+e),i.setAttribute("title",n+" "+e)}),i.setAttribute("data-page",e),i.textContent=e,i.addEventListener("click",n=>{this.setPage(e)}),i}previousPage(){return this.page>1?(this.page--,this.trackChanges(),this.trigger()):(console.warn("Pagination Error - Previous page would be less than page 1:",0),Promise.reject())}nextPage(){return this.page<this.max?(this.page++,this.trackChanges(),this.trigger()):(this.progressiveLoad||console.warn("Pagination Error - Next page would be greater than maximum page of "+this.max+":",this.max+1),Promise.reject())}getPage(){return this.page}getPageMax(){return this.max}getPageSize(e){return this.size}getMode(){return this.mode}getRows(e){var i=0,n,r,a,o,s=e.filter(l=>l.type==="row");if(this.mode=="local"){n=[],this.setMaxRows(e.length),this.size===!0?(r=0,a=e.length):(r=this.size*(this.page-1),a=r+parseInt(this.size)),this._setPageButtons();for(let l=r;l<a;l++){let c=e[l];c&&(n.push(c),c.type==="row"&&(o||(o=c),i++))}return this._setPageCounter(s.length,i,o?s.indexOf(o)+1:0),n}else return this._setPageButtons(),this._setPageCounter(s.length),e.slice(0)}trigger(){var e;switch(this.mode){case"local":return e=this.table.rowManager.scrollLeft,this.refreshData(),this.table.rowManager.scrollHorizontal(e),this.dispatchExternal("pageLoaded",this.getPage()),Promise.resolve();case"remote":return this.dataChanging=!0,this.reloadData(null).finally(()=>{this.dataChanging=!1});case"progressive_load":case"progressive_scroll":return this.reloadData(null,!0);default:return console.warn("Pagination Error - no such pagination mode:",this.mode),Promise.reject()}}_parseRemoteData(e){var i;if(typeof e.last_page>"u"&&console.warn("Remote Pagination Error - Server response missing '"+(this.options("dataReceiveParams").last_page||"last_page")+"' property"),e.data)if(this.max=parseInt(e.last_page)||1,this.remoteRowCountEstimate=typeof e.last_row<"u"?e.last_row:e.last_page*this.size-(this.page==e.last_page?this.size-e.data.length:0),this.progressiveLoad){switch(this.mode){case"progressive_load":this.page==1?this.table.rowManager.setData(e.data,!1,this.page==1):this.table.rowManager.addRows(e.data),this.page<this.max&&setTimeout(()=>{this.nextPage()},this.table.options.progressiveLoadDelay);break;case"progressive_scroll":e=this.page===1?e.data:this.table.rowManager.getData().concat(e.data),this.table.rowManager.setData(e,this.page!==1,this.page==1),i=this.table.options.progressiveLoadScrollMargin||this.table.rowManager.element.clientHeight*2,this.table.rowManager.element.scrollHeight<=this.table.rowManager.element.clientHeight+i&&this.page<this.max&&setTimeout(()=>{this.nextPage()});break}return!1}else this.dispatchExternal("pageLoaded",this.getPage());else console.warn("Remote Pagination Error - Server response missing '"+(this.options("dataReceiveParams").data||"data")+"' property");return e.data}footerRedraw(){var e=this.table.footerManager.containerElement;Math.ceil(e.clientWidth)-e.scrollWidth<0?this.pagesElement.style.display="none":(this.pagesElement.style.display="",Math.ceil(e.clientWidth)-e.scrollWidth<0&&(this.pagesElement.style.display="none"))}};Je(fD,"moduleName","page"),Je(fD,"pageCounters",$Ye);let oG=fD;var VYe={local:function(t,e){var i=localStorage.getItem(t+"-"+e);return i?JSON.parse(i):!1},cookie:function(t,e){var i=document.cookie,n=t+"-"+e,r=i.indexOf(n+"="),a,o;return r>-1&&(i=i.slice(r),a=i.indexOf(";"),a>-1&&(i=i.slice(0,a)),o=i.replace(n+"=","")),o?JSON.parse(o):!1}},jYe={local:function(t,e,i){localStorage.setItem(t+"-"+e,JSON.stringify(i))},cookie:function(t,e,i){var n=new Date;n.setDate(n.getDate()+1e4),document.cookie=t+"-"+e+"="+JSON.stringify(i)+"; expires="+n.toUTCString()}};const ou=class ou extends Wn{constructor(e){super(e),this.mode="",this.id="",this.defWatcherBlock=!1,this.config={},this.readFunc=!1,this.writeFunc=!1,this.registerTableOption("persistence",!1),this.registerTableOption("persistenceID",""),this.registerTableOption("persistenceMode",!0),this.registerTableOption("persistenceReaderFunc",!1),this.registerTableOption("persistenceWriterFunc",!1)}localStorageTest(){var e="_tabulator_test";try{return window.localStorage.setItem(e,e),window.localStorage.removeItem(e),!0}catch{return!1}}initialize(){if(this.table.options.persistence){var e=this.table.options.persistenceMode,i=this.table.options.persistenceID,n;this.mode=e!==!0?e:this.localStorageTest()?"local":"cookie",this.table.options.persistenceReaderFunc?typeof this.table.options.persistenceReaderFunc=="function"?this.readFunc=this.table.options.persistenceReaderFunc:ou.readers[this.table.options.persistenceReaderFunc]?this.readFunc=ou.readers[this.table.options.persistenceReaderFunc]:console.warn("Persistence Read Error - invalid reader set",this.table.options.persistenceReaderFunc):ou.readers[this.mode]?this.readFunc=ou.readers[this.mode]:console.warn("Persistence Read Error - invalid reader set",this.mode),this.table.options.persistenceWriterFunc?typeof this.table.options.persistenceWriterFunc=="function"?this.writeFunc=this.table.options.persistenceWriterFunc:ou.writers[this.table.options.persistenceWriterFunc]?this.writeFunc=ou.writers[this.table.options.persistenceWriterFunc]:console.warn("Persistence Write Error - invalid reader set",this.table.options.persistenceWriterFunc):ou.writers[this.mode]?this.writeFunc=ou.writers[this.mode]:console.warn("Persistence Write Error - invalid writer set",this.mode),this.id="tabulator-"+(i||this.table.element.getAttribute("id")||""),this.config={sort:this.table.options.persistence===!0||this.table.options.persistence.sort,filter:this.table.options.persistence===!0||this.table.options.persistence.filter,headerFilter:this.table.options.persistence===!0||this.table.options.persistence.headerFilter,group:this.table.options.persistence===!0||this.table.options.persistence.group,page:this.table.options.persistence===!0||this.table.options.persistence.page,columns:this.table.options.persistence===!0?["title","width","visible"]:this.table.options.persistence.columns},this.config.page&&(n=this.retrieveData("page"),n&&(typeof n.paginationSize<"u"&&(this.config.page===!0||this.config.page.size)&&(this.table.options.paginationSize=n.paginationSize),typeof n.paginationInitialPage<"u"&&(this.config.page===!0||this.config.page.page)&&(this.table.options.paginationInitialPage=n.paginationInitialPage))),this.config.group&&(n=this.retrieveData("group"),n&&(typeof n.groupBy<"u"&&(this.config.group===!0||this.config.group.groupBy)&&(this.table.options.groupBy=n.groupBy),typeof n.groupStartOpen<"u"&&(this.config.group===!0||this.config.group.groupStartOpen)&&(this.table.options.groupStartOpen=n.groupStartOpen),typeof n.groupHeader<"u"&&(this.config.group===!0||this.config.group.groupHeader)&&(this.table.options.groupHeader=n.groupHeader))),this.config.columns&&(this.table.options.columns=this.load("columns",this.table.options.columns),this.subscribe("column-init",this.initializeColumn.bind(this)),this.subscribe("column-show",this.save.bind(this,"columns")),this.subscribe("column-hide",this.save.bind(this,"columns")),this.subscribe("column-moved",this.save.bind(this,"columns"))),this.subscribe("table-built",this.tableBuilt.bind(this),0),this.subscribe("table-redraw",this.tableRedraw.bind(this)),this.subscribe("filter-changed",this.eventSave.bind(this,"filter")),this.subscribe("filter-changed",this.eventSave.bind(this,"headerFilter")),this.subscribe("sort-changed",this.eventSave.bind(this,"sort")),this.subscribe("group-changed",this.eventSave.bind(this,"group")),this.subscribe("page-changed",this.eventSave.bind(this,"page")),this.subscribe("column-resized",this.eventSave.bind(this,"columns")),this.subscribe("column-width",this.eventSave.bind(this,"columns")),this.subscribe("layout-refreshed",this.eventSave.bind(this,"columns"))}this.registerTableFunction("getColumnLayout",this.getColumnLayout.bind(this)),this.registerTableFunction("setColumnLayout",this.setColumnLayout.bind(this))}eventSave(e){this.config[e]&&this.save(e)}tableBuilt(){var e,i,n;this.config.sort&&(e=this.load("sort"),e&&(this.table.options.initialSort=e)),this.config.filter&&(i=this.load("filter"),i&&(this.table.options.initialFilter=i)),this.config.headerFilter&&(n=this.load("headerFilter"),n&&(this.table.options.initialHeaderFilter=n))}tableRedraw(e){e&&this.config.columns&&this.save("columns")}getColumnLayout(){return this.parseColumns(this.table.columnManager.getColumns())}setColumnLayout(e){return this.table.columnManager.setColumns(this.mergeDefinition(this.table.options.columns,e,!0)),!0}initializeColumn(e){var i,n;this.config.columns&&(this.defWatcherBlock=!0,i=e.getDefinition(),n=this.config.columns===!0?Object.keys(i):this.config.columns,n.forEach(r=>{var a=Object.getOwnPropertyDescriptor(i,r),o=i[r];a&&Object.defineProperty(i,r,{set:s=>{o=s,this.defWatcherBlock||this.save("columns"),a.set&&a.set(s)},get:()=>(a.get&&a.get(),o)})}),this.defWatcherBlock=!1)}load(e,i){var n=this.retrieveData(e);return i&&(n=n?this.mergeDefinition(i,n):i),n}retrieveData(e){return this.readFunc?this.readFunc(this.id,e):!1}mergeDefinition(e,i,n){var r=[];return i=i||[],i.forEach((a,o)=>{var s=this._findColumn(e,a),l;s&&(n?l=Object.keys(a):this.config.columns===!0||this.config.columns==null?(l=Object.keys(s),l.push("width")):l=this.config.columns,l.forEach(c=>{c!=="columns"&&typeof a[c]<"u"&&(s[c]=a[c])}),s.columns&&(s.columns=this.mergeDefinition(s.columns,a.columns)),r.push(s))}),e.forEach((a,o)=>{var s=this._findColumn(i,a);s||(r.length>o?r.splice(o,0,a):r.push(a))}),r}_findColumn(e,i){var n=i.columns?"group":i.field?"field":"object";return e.find(function(r){switch(n){case"group":return r.title===i.title&&r.columns.length===i.columns.length;case"field":return r.field===i.field;case"object":return r===i}})}save(e){var i={};switch(e){case"columns":i=this.parseColumns(this.table.columnManager.getColumns());break;case"filter":i=this.table.modules.filter.getFilters();break;case"headerFilter":i=this.table.modules.filter.getHeaderFilters();break;case"sort":i=this.validateSorters(this.table.modules.sort.getSort());break;case"group":i=this.getGroupConfig();break;case"page":i=this.getPageConfig();break}this.writeFunc&&this.writeFunc(this.id,e,i)}validateSorters(e){return e.forEach(function(i){i.column=i.field,delete i.field}),e}getGroupConfig(){var e={};return this.config.group&&((this.config.group===!0||this.config.group.groupBy)&&(e.groupBy=this.table.options.groupBy),(this.config.group===!0||this.config.group.groupStartOpen)&&(e.groupStartOpen=this.table.options.groupStartOpen),(this.config.group===!0||this.config.group.groupHeader)&&(e.groupHeader=this.table.options.groupHeader)),e}getPageConfig(){var e={};return this.config.page&&((this.config.page===!0||this.config.page.size)&&(e.paginationSize=this.table.modules.page.getPageSize()),(this.config.page===!0||this.config.page.page)&&(e.paginationInitialPage=this.table.modules.page.getPage())),e}parseColumns(e){var i=[],n=["headerContextMenu","headerMenu","contextMenu","clickMenu"];return e.forEach(r=>{var a={},o=r.getDefinition(),s;r.isGroup?(a.title=o.title,a.columns=this.parseColumns(r.getColumns())):(a.field=r.getField(),this.config.columns===!0||this.config.columns==null?(s=Object.keys(o),s.push("width"),s.push("visible")):s=this.config.columns,s.forEach(l=>{switch(l){case"width":a.width=r.getWidth();break;case"visible":a.visible=r.visible;break;default:typeof o[l]!="function"&&n.indexOf(l)===-1&&(a[l]=o[l])}})),i.push(a)}),i}};Je(ou,"moduleName","persistence"),Je(ou,"moduleInitOrder",-10),Je(ou,"readers",VYe),Je(ou,"writers",jYe);let sG=ou;var E2;let GYe=(E2=class extends Wn{constructor(e){super(e),this.columnSubscribers={},this.registerTableOption("rowContextPopup",!1),this.registerTableOption("rowClickPopup",!1),this.registerTableOption("rowDblClickPopup",!1),this.registerTableOption("groupContextPopup",!1),this.registerTableOption("groupClickPopup",!1),this.registerTableOption("groupDblClickPopup",!1),this.registerColumnOption("headerContextPopup"),this.registerColumnOption("headerClickPopup"),this.registerColumnOption("headerDblClickPopup"),this.registerColumnOption("headerPopup"),this.registerColumnOption("headerPopupIcon"),this.registerColumnOption("contextPopup"),this.registerColumnOption("clickPopup"),this.registerColumnOption("dblClickPopup"),this.registerComponentFunction("cell","popup",this._componentPopupCall.bind(this)),this.registerComponentFunction("column","popup",this._componentPopupCall.bind(this)),this.registerComponentFunction("row","popup",this._componentPopupCall.bind(this)),this.registerComponentFunction("group","popup",this._componentPopupCall.bind(this))}initialize(){this.initializeRowWatchers(),this.initializeGroupWatchers(),this.subscribe("column-init",this.initializeColumn.bind(this))}_componentPopupCall(e,i,n){this.loadPopupEvent(i,null,e,n)}initializeRowWatchers(){this.table.options.rowContextPopup&&(this.subscribe("row-contextmenu",this.loadPopupEvent.bind(this,this.table.options.rowContextPopup)),this.table.on("rowTapHold",this.loadPopupEvent.bind(this,this.table.options.rowContextPopup))),this.table.options.rowClickPopup&&this.subscribe("row-click",this.loadPopupEvent.bind(this,this.table.options.rowClickPopup)),this.table.options.rowDblClickPopup&&this.subscribe("row-dblclick",this.loadPopupEvent.bind(this,this.table.options.rowDblClickPopup))}initializeGroupWatchers(){this.table.options.groupContextPopup&&(this.subscribe("group-contextmenu",this.loadPopupEvent.bind(this,this.table.options.groupContextPopup)),this.table.on("groupTapHold",this.loadPopupEvent.bind(this,this.table.options.groupContextPopup))),this.table.options.groupClickPopup&&this.subscribe("group-click",this.loadPopupEvent.bind(this,this.table.options.groupClickPopup)),this.table.options.groupDblClickPopup&&this.subscribe("group-dblclick",this.loadPopupEvent.bind(this,this.table.options.groupDblClickPopup))}initializeColumn(e){var i=e.definition;i.headerContextPopup&&!this.columnSubscribers.headerContextPopup&&(this.columnSubscribers.headerContextPopup=this.loadPopupTableColumnEvent.bind(this,"headerContextPopup"),this.subscribe("column-contextmenu",this.columnSubscribers.headerContextPopup),this.table.on("headerTapHold",this.loadPopupTableColumnEvent.bind(this,"headerContextPopup"))),i.headerClickPopup&&!this.columnSubscribers.headerClickPopup&&(this.columnSubscribers.headerClickPopup=this.loadPopupTableColumnEvent.bind(this,"headerClickPopup"),this.subscribe("column-click",this.columnSubscribers.headerClickPopup)),i.headerDblClickPopup&&!this.columnSubscribers.headerDblClickPopup&&(this.columnSubscribers.headerDblClickPopup=this.loadPopupTableColumnEvent.bind(this,"headerDblClickPopup"),this.subscribe("column-dblclick",this.columnSubscribers.headerDblClickPopup)),i.headerPopup&&this.initializeColumnHeaderPopup(e),i.contextPopup&&!this.columnSubscribers.contextPopup&&(this.columnSubscribers.contextPopup=this.loadPopupTableCellEvent.bind(this,"contextPopup"),this.subscribe("cell-contextmenu",this.columnSubscribers.contextPopup),this.table.on("cellTapHold",this.loadPopupTableCellEvent.bind(this,"contextPopup"))),i.clickPopup&&!this.columnSubscribers.clickPopup&&(this.columnSubscribers.clickPopup=this.loadPopupTableCellEvent.bind(this,"clickPopup"),this.subscribe("cell-click",this.columnSubscribers.clickPopup)),i.dblClickPopup&&!this.columnSubscribers.dblClickPopup&&(this.columnSubscribers.dblClickPopup=this.loadPopupTableCellEvent.bind(this,"dblClickPopup"),this.subscribe("cell-click",this.columnSubscribers.dblClickPopup))}initializeColumnHeaderPopup(e){var i=e.definition.headerPopupIcon,n;n=document.createElement("span"),n.classList.add("tabulator-header-popup-button"),i?(typeof i=="function"&&(i=i(e.getComponent())),i instanceof HTMLElement?n.appendChild(i):n.innerHTML=i):n.innerHTML="&vellip;",n.addEventListener("click",r=>{r.stopPropagation(),r.preventDefault(),this.loadPopupEvent(e.definition.headerPopup,r,e)}),e.titleElement.insertBefore(n,e.titleElement.firstChild)}loadPopupTableCellEvent(e,i,n){n._cell&&(n=n._cell),n.column.definition[e]&&this.loadPopupEvent(n.column.definition[e],i,n)}loadPopupTableColumnEvent(e,i,n){n._column&&(n=n._column),n.definition[e]&&this.loadPopupEvent(n.definition[e],i,n)}loadPopupEvent(e,i,n,r){var a;function o(s){a=s}n._group?n=n._group:n._row&&(n=n._row),e=typeof e=="function"?e.call(this.table,i,n.getComponent(),o):e,this.loadPopup(i,n,e,a,r)}loadPopup(e,i,n,r,a){var o=!(e instanceof MouseEvent),s,l;n instanceof HTMLElement?s=n:(s=document.createElement("div"),s.innerHTML=n),s.classList.add("tabulator-popup"),s.addEventListener("click",c=>{c.stopPropagation()}),o||e.preventDefault(),l=this.popup(s),typeof r=="function"&&l.renderCallback(r),e?l.show(e):l.show(i.getElement(),a||"center"),l.hideOnBlur(()=>{this.dispatchExternal("popupClosed",i.getComponent())}),this.dispatchExternal("popupOpened",i.getComponent())}},Je(E2,"moduleName","popup"),E2);class WTe extends Wn{constructor(e){super(e),this.element=!1,this.manualBlock=!1,this.beforeprintEventHandler=null,this.afterprintEventHandler=null,this.registerTableOption("printAsHtml",!1),this.registerTableOption("printFormatter",!1),this.registerTableOption("printHeader",!1),this.registerTableOption("printFooter",!1),this.registerTableOption("printStyled",!0),this.registerTableOption("printRowRange","visible"),this.registerTableOption("printConfig",{}),this.registerColumnOption("print"),this.registerColumnOption("titlePrint")}initialize(){this.table.options.printAsHtml&&(this.beforeprintEventHandler=this.replaceTable.bind(this),this.afterprintEventHandler=this.cleanup.bind(this),window.addEventListener("beforeprint",this.beforeprintEventHandler),window.addEventListener("afterprint",this.afterprintEventHandler),this.subscribe("table-destroy",this.destroy.bind(this))),this.registerTableFunction("print",this.printFullscreen.bind(this))}destroy(){this.table.options.printAsHtml&&(window.removeEventListener("beforeprint",this.beforeprintEventHandler),window.removeEventListener("afterprint",this.afterprintEventHandler))}replaceTable(){this.manualBlock||(this.element=document.createElement("div"),this.element.classList.add("tabulator-print-table"),this.element.appendChild(this.table.modules.export.generateTable(this.table.options.printConfig,this.table.options.printStyled,this.table.options.printRowRange,"print")),this.table.element.style.display="none",this.table.element.parentNode.insertBefore(this.element,this.table.element))}cleanup(){document.body.classList.remove("tabulator-print-fullscreen-hide"),this.element&&this.element.parentNode&&(this.element.parentNode.removeChild(this.element),this.table.element.style.display="")}printFullscreen(e,i,n){var r=window.scrollX,a=window.scrollY,o=document.createElement("div"),s=document.createElement("div"),l=this.table.modules.export.generateTable(typeof n<"u"?n:this.table.options.printConfig,typeof i<"u"?i:this.table.options.printStyled,e||this.table.options.printRowRange,"print"),c,u;this.manualBlock=!0,this.element=document.createElement("div"),this.element.classList.add("tabulator-print-fullscreen"),this.table.options.printHeader&&(o.classList.add("tabulator-print-header"),c=typeof this.table.options.printHeader=="function"?this.table.options.printHeader.call(this.table):this.table.options.printHeader,typeof c=="string"?o.innerHTML=c:o.appendChild(c),this.element.appendChild(o)),this.element.appendChild(l),this.table.options.printFooter&&(s.classList.add("tabulator-print-footer"),u=typeof this.table.options.printFooter=="function"?this.table.options.printFooter.call(this.table):this.table.options.printFooter,typeof u=="string"?s.innerHTML=u:s.appendChild(u),this.element.appendChild(s)),document.body.classList.add("tabulator-print-fullscreen-hide"),document.body.appendChild(this.element),this.table.options.printFormatter&&this.table.options.printFormatter(this.element,l),window.print(),this.cleanup(),window.scrollTo(r,a),this.manualBlock=!1}}Je(WTe,"moduleName","print");class KTe extends Wn{constructor(e){super(e),this.data=!1,this.blocked=!1,this.origFuncs={},this.currentVersion=0,this.registerTableOption("reactiveData",!1)}initialize(){this.table.options.reactiveData&&(this.subscribe("cell-value-save-before",this.block.bind(this,"cellsave")),this.subscribe("cell-value-save-after",this.unblock.bind(this,"cellsave")),this.subscribe("row-data-save-before",this.block.bind(this,"rowsave")),this.subscribe("row-data-save-after",this.unblock.bind(this,"rowsave")),this.subscribe("row-data-init-after",this.watchRow.bind(this)),this.subscribe("data-processing",this.watchData.bind(this)),this.subscribe("table-destroy",this.unwatchData.bind(this)))}watchData(e){var i=this,n;this.currentVersion++,n=this.currentVersion,this.unwatchData(),this.data=e,this.origFuncs.push=e.push,Object.defineProperty(this.data,"push",{enumerable:!1,configurable:!0,value:function(){var r=Array.from(arguments),a;return!i.blocked&&n===i.currentVersion&&(i.block("data-push"),r.forEach(o=>{i.table.rowManager.addRowActual(o,!1)}),a=i.origFuncs.push.apply(e,arguments),i.unblock("data-push")),a}}),this.origFuncs.unshift=e.unshift,Object.defineProperty(this.data,"unshift",{enumerable:!1,configurable:!0,value:function(){var r=Array.from(arguments),a;return!i.blocked&&n===i.currentVersion&&(i.block("data-unshift"),r.forEach(o=>{i.table.rowManager.addRowActual(o,!0)}),a=i.origFuncs.unshift.apply(e,arguments),i.unblock("data-unshift")),a}}),this.origFuncs.shift=e.shift,Object.defineProperty(this.data,"shift",{enumerable:!1,configurable:!0,value:function(){var r,a;return!i.blocked&&n===i.currentVersion&&(i.block("data-shift"),i.data.length&&(r=i.table.rowManager.getRowFromDataObject(i.data[0]),r&&r.deleteActual()),a=i.origFuncs.shift.call(e),i.unblock("data-shift")),a}}),this.origFuncs.pop=e.pop,Object.defineProperty(this.data,"pop",{enumerable:!1,configurable:!0,value:function(){var r,a;return!i.blocked&&n===i.currentVersion&&(i.block("data-pop"),i.data.length&&(r=i.table.rowManager.getRowFromDataObject(i.data[i.data.length-1]),r&&r.deleteActual()),a=i.origFuncs.pop.call(e),i.unblock("data-pop")),a}}),this.origFuncs.splice=e.splice,Object.defineProperty(this.data,"splice",{enumerable:!1,configurable:!0,value:function(){var r=Array.from(arguments),a=r[0]<0?e.length+r[0]:r[0],o=r[1],s=r[2]?r.slice(2):!1,l,c;if(!i.blocked&&n===i.currentVersion){if(i.block("data-splice"),s&&(l=e[a]?i.table.rowManager.getRowFromDataObject(e[a]):!1,l?s.forEach(d=>{i.table.rowManager.addRowActual(d,!0,l,!0)}):(s=s.slice().reverse(),s.forEach(d=>{i.table.rowManager.addRowActual(d,!0,!1,!0)}))),o!==0){var u=e.slice(a,typeof r[1]>"u"?r[1]:a+o);u.forEach((d,p)=>{var h=i.table.rowManager.getRowFromDataObject(d);h&&h.deleteActual(p!==u.length-1)})}(s||o!==0)&&i.table.rowManager.reRenderInPosition(),c=i.origFuncs.splice.apply(e,arguments),i.unblock("data-splice")}return c}})}unwatchData(){if(this.data!==!1)for(var e in this.origFuncs)Object.defineProperty(this.data,e,{enumerable:!0,configurable:!0,writable:!0,value:this.origFuncs.key})}watchRow(e){var i=e.getData();for(var n in i)this.watchKey(e,i,n);this.table.options.dataTree&&this.watchTreeChildren(e)}watchTreeChildren(e){var i=this,n=e.getData()[this.table.options.dataTreeChildField],r={};n&&(r.push=n.push,Object.defineProperty(n,"push",{enumerable:!1,configurable:!0,value:()=>{if(!i.blocked){i.block("tree-push");var a=r.push.apply(n,arguments);this.rebuildTree(e),i.unblock("tree-push")}return a}}),r.unshift=n.unshift,Object.defineProperty(n,"unshift",{enumerable:!1,configurable:!0,value:()=>{if(!i.blocked){i.block("tree-unshift");var a=r.unshift.apply(n,arguments);this.rebuildTree(e),i.unblock("tree-unshift")}return a}}),r.shift=n.shift,Object.defineProperty(n,"shift",{enumerable:!1,configurable:!0,value:()=>{if(!i.blocked){i.block("tree-shift");var a=r.shift.call(n);this.rebuildTree(e),i.unblock("tree-shift")}return a}}),r.pop=n.pop,Object.defineProperty(n,"pop",{enumerable:!1,configurable:!0,value:()=>{if(!i.blocked){i.block("tree-pop");var a=r.pop.call(n);this.rebuildTree(e),i.unblock("tree-pop")}return a}}),r.splice=n.splice,Object.defineProperty(n,"splice",{enumerable:!1,configurable:!0,value:()=>{if(!i.blocked){i.block("tree-splice");var a=r.splice.apply(n,arguments);this.rebuildTree(e),i.unblock("tree-splice")}return a}}))}rebuildTree(e){this.table.modules.dataTree.initializeRow(e),this.table.modules.dataTree.layoutRow(e),this.table.rowManager.refreshActiveData("tree",!1,!0)}watchKey(e,i,n){var r=this,a=Object.getOwnPropertyDescriptor(i,n),o=i[n],s=this.currentVersion;Object.defineProperty(i,n,{set:l=>{if(o=l,!r.blocked&&s===r.currentVersion){r.block("key");var c={};c[n]=l,e.updateData(c),r.unblock("key")}a.set&&a.set(l)},get:()=>(a.get&&a.get(),o)})}unwatchRow(e){var i=e.getData();for(var n in i)Object.defineProperty(i,n,{value:i[n]})}block(e){this.blocked||(this.blocked=e)}unblock(e){this.blocked===e&&(this.blocked=!1)}}Je(KTe,"moduleName","reactiveData");class YTe extends Wn{constructor(e){super(e),this.startColumn=!1,this.startX=!1,this.startWidth=!1,this.latestX=!1,this.handle=null,this.initialNextColumn=null,this.nextColumn=null,this.initialized=!1,this.registerColumnOption("resizable",!0),this.registerTableOption("resizableColumnFit",!1),this.registerTableOption("resizableColumnGuide",!1)}initialize(){this.subscribe("column-rendered",this.layoutColumnHeader.bind(this))}initializeEventWatchers(){this.initialized||(this.subscribe("cell-rendered",this.layoutCellHandles.bind(this)),this.subscribe("cell-delete",this.deInitializeComponent.bind(this)),this.subscribe("cell-height",this.resizeHandle.bind(this)),this.subscribe("column-moved",this.columnLayoutUpdated.bind(this)),this.subscribe("column-hide",this.deInitializeColumn.bind(this)),this.subscribe("column-show",this.columnLayoutUpdated.bind(this)),this.subscribe("column-width",this.columnWidthUpdated.bind(this)),this.subscribe("column-delete",this.deInitializeComponent.bind(this)),this.subscribe("column-height",this.resizeHandle.bind(this)),this.initialized=!0)}layoutCellHandles(e){e.row.type==="row"&&(this.deInitializeComponent(e),this.initializeColumn("cell",e,e.column,e.element))}layoutColumnHeader(e){e.definition.resizable&&(this.initializeEventWatchers(),this.deInitializeComponent(e),this.initializeColumn("header",e,e,e.element))}columnLayoutUpdated(e){var i=e.prevColumn();this.reinitializeColumn(e),i&&this.reinitializeColumn(i)}columnWidthUpdated(e){e.modules.frozen&&(this.table.modules.frozenColumns.leftColumns.includes(e)?this.table.modules.frozenColumns.leftColumns.forEach(i=>{this.reinitializeColumn(i)}):this.table.modules.frozenColumns.rightColumns.includes(e)&&this.table.modules.frozenColumns.rightColumns.forEach(i=>{this.reinitializeColumn(i)}))}frozenColumnOffset(e){var i=!1;return e.modules.frozen&&(i=e.modules.frozen.marginValue,e.modules.frozen.position==="left"?i+=e.getWidth()-3:i&&(i-=3)),i!==!1?i+"px":!1}reinitializeColumn(e){var i=this.frozenColumnOffset(e);e.cells.forEach(n=>{n.modules.resize&&n.modules.resize.handleEl&&(i&&(n.modules.resize.handleEl.style[e.modules.frozen.position]=i,n.modules.resize.handleEl.style["z-index"]=11),n.element.after(n.modules.resize.handleEl))}),e.modules.resize&&e.modules.resize.handleEl&&(i&&(e.modules.resize.handleEl.style[e.modules.frozen.position]=i),e.element.after(e.modules.resize.handleEl))}initializeColumn(e,i,n,r){var a=this,o=!1,s=n.definition.resizable,l={},c=n.getLastColumn();if(e==="header"&&(o=n.definition.formatter=="textarea"||n.definition.variableHeight,l={variableHeight:o}),(s===!0||s==e)&&this._checkResizability(c)){var u=document.createElement("span");u.className="tabulator-col-resize-handle",u.addEventListener("click",function(p){p.stopPropagation()});var d=function(p){a.startColumn=n,a.initialNextColumn=a.nextColumn=c.nextColumn(),a._mouseDown(p,c,u)};u.addEventListener("mousedown",d),u.addEventListener("touchstart",d,{passive:!0}),u.addEventListener("dblclick",p=>{var h=c.getWidth();p.stopPropagation(),c.reinitializeWidth(!0),h!==c.getWidth()&&(a.dispatch("column-resized",c),a.dispatchExternal("columnResized",c.getComponent()))}),n.modules.frozen&&(u.style.position="sticky",u.style[n.modules.frozen.position]=this.frozenColumnOffset(n)),l.handleEl=u,r.parentNode&&n.visible&&r.after(u)}i.modules.resize=l}deInitializeColumn(e){this.deInitializeComponent(e),e.cells.forEach(i=>{this.deInitializeComponent(i)})}deInitializeComponent(e){var i;e.modules.resize&&(i=e.modules.resize.handleEl,i&&i.parentElement&&i.parentElement.removeChild(i))}resizeHandle(e,i){e.modules.resize&&e.modules.resize.handleEl&&(e.modules.resize.handleEl.style.height=i)}resize(e,i){var n=typeof e.clientX>"u"?e.touches[0].clientX:e.clientX,r=n-this.startX,a=n-this.latestX,o,s;if(this.latestX=n,this.table.rtl&&(r=-r,a=-a),o=i.width==i.minWidth||i.width==i.maxWidth,i.setWidth(this.startWidth+r),s=i.width==i.minWidth||i.width==i.maxWidth,a<0&&(this.nextColumn=this.initialNextColumn),this.table.options.resizableColumnFit&&this.nextColumn&&!(o&&s)){let l=this.nextColumn.getWidth();a>0&&l<=this.nextColumn.minWidth&&(this.nextColumn=this.nextColumn.nextColumn()),this.nextColumn&&this.nextColumn.setWidth(this.nextColumn.getWidth()-a)}this.table.columnManager.rerenderColumns(!0),!this.table.browserSlow&&i.modules.resize&&i.modules.resize.variableHeight&&i.checkCellHeights()}calcGuidePosition(e,i,n){var r=typeof e.clientX>"u"?e.touches[0].clientX:e.clientX,a=n.getBoundingClientRect().x-this.table.element.getBoundingClientRect().x,o=this.table.element.getBoundingClientRect().x,s=i.element.getBoundingClientRect().left-o,l=r-this.startX,c=Math.max(a+l,s+i.minWidth);return i.maxWidth&&(c=Math.min(c,s+i.maxWidth)),c}_checkResizability(e){return e.definition.resizable}_mouseDown(e,i,n){var r=this,a;this.dispatchExternal("columnResizing",i.getComponent()),r.table.options.resizableColumnGuide&&(a=document.createElement("span"),a.classList.add("tabulator-col-resize-guide"),r.table.element.appendChild(a),setTimeout(()=>{a.style.left=r.calcGuidePosition(e,i,n)+"px"})),r.table.element.classList.add("tabulator-block-select");function o(l){r.table.options.resizableColumnGuide?a.style.left=r.calcGuidePosition(l,i,n)+"px":r.resize(l,i)}function s(l){r.table.options.resizableColumnGuide&&(r.resize(l,i),a.remove()),r.startColumn.modules.edit&&(r.startColumn.modules.edit.blocked=!1),r.table.browserSlow&&i.modules.resize&&i.modules.resize.variableHeight&&i.checkCellHeights(),document.body.removeEventListener("mouseup",s),document.body.removeEventListener("mousemove",o),n.removeEventListener("touchmove",o),n.removeEventListener("touchend",s),r.table.element.classList.remove("tabulator-block-select"),r.startWidth!==i.getWidth()&&(r.table.columnManager.verticalAlignHeaders(),r.dispatch("column-resized",i),r.dispatchExternal("columnResized",i.getComponent()))}e.stopPropagation(),r.startColumn.modules.edit&&(r.startColumn.modules.edit.blocked=!0),r.startX=typeof e.clientX>"u"?e.touches[0].clientX:e.clientX,r.latestX=r.startX,r.startWidth=i.getWidth(),document.body.addEventListener("mousemove",o),document.body.addEventListener("mouseup",s),n.addEventListener("touchmove",o,{passive:!0}),n.addEventListener("touchend",s)}}Je(YTe,"moduleName","resizeColumns");class ZTe extends Wn{constructor(e){super(e),this.startColumn=!1,this.startY=!1,this.startHeight=!1,this.handle=null,this.prevHandle=null,this.registerTableOption("resizableRows",!1),this.registerTableOption("resizableRowGuide",!1)}initialize(){this.table.options.resizableRows&&this.subscribe("row-layout-after",this.initializeRow.bind(this))}initializeRow(e){var i=this,n=e.getElement(),r=document.createElement("div");r.className="tabulator-row-resize-handle";var a=document.createElement("div");a.className="tabulator-row-resize-handle prev",r.addEventListener("click",function(l){l.stopPropagation()});var o=function(l){i.startRow=e,i._mouseDown(l,e,r)};r.addEventListener("mousedown",o),r.addEventListener("touchstart",o,{passive:!0}),a.addEventListener("click",function(l){l.stopPropagation()});var s=function(l){var c=i.table.rowManager.prevDisplayRow(e);c&&(i.startRow=c,i._mouseDown(l,c,a))};a.addEventListener("mousedown",s),a.addEventListener("touchstart",s,{passive:!0}),n.appendChild(r),n.appendChild(a)}resize(e,i){i.setHeight(this.startHeight+((typeof e.screenY>"u"?e.touches[0].screenY:e.screenY)-this.startY))}calcGuidePosition(e,i,n){var r=typeof e.screenY>"u"?e.touches[0].screenY:e.screenY,a=n.getBoundingClientRect().y-this.table.element.getBoundingClientRect().y,o=this.table.element.getBoundingClientRect().y,s=i.element.getBoundingClientRect().top-o,l=r-this.startY;return Math.max(a+l,s)}_mouseDown(e,i,n){var r=this,a;r.dispatchExternal("rowResizing",i.getComponent()),r.table.options.resizableRowGuide&&(a=document.createElement("span"),a.classList.add("tabulator-row-resize-guide"),r.table.element.appendChild(a),setTimeout(()=>{a.style.top=r.calcGuidePosition(e,i,n)+"px"})),r.table.element.classList.add("tabulator-block-select");function o(l){r.table.options.resizableRowGuide?a.style.top=r.calcGuidePosition(l,i,n)+"px":r.resize(l,i)}function s(l){r.table.options.resizableRowGuide&&(r.resize(l,i),a.remove()),document.body.removeEventListener("mouseup",o),document.body.removeEventListener("mousemove",o),n.removeEventListener("touchmove",o),n.removeEventListener("touchend",s),r.table.element.classList.remove("tabulator-block-select"),r.dispatchExternal("rowResized",i.getComponent())}e.stopPropagation(),r.startY=typeof e.screenY>"u"?e.touches[0].screenY:e.screenY,r.startHeight=i.getHeight(),document.body.addEventListener("mousemove",o),document.body.addEventListener("mouseup",s),n.addEventListener("touchmove",o,{passive:!0}),n.addEventListener("touchend",s)}}Je(ZTe,"moduleName","resizeRows");class XTe extends Wn{constructor(e){super(e),this.binding=!1,this.visibilityObserver=!1,this.resizeObserver=!1,this.containerObserver=!1,this.tableHeight=0,this.tableWidth=0,this.containerHeight=0,this.containerWidth=0,this.autoResize=!1,this.visible=!1,this.initialized=!1,this.initialRedraw=!1,this.registerTableOption("autoResize",!0)}initialize(){if(this.table.options.autoResize){var e=this.table,i;this.tableHeight=e.element.clientHeight,this.tableWidth=e.element.clientWidth,e.element.parentNode&&(this.containerHeight=e.element.parentNode.clientHeight,this.containerWidth=e.element.parentNode.clientWidth),typeof IntersectionObserver<"u"&&typeof ResizeObserver<"u"&&e.rowManager.getRenderMode()==="virtual"?(this.initializeVisibilityObserver(),this.autoResize=!0,this.resizeObserver=new ResizeObserver(n=>{if(!e.browserMobile||e.browserMobile&&(!e.modules.edit||e.modules.edit&&!e.modules.edit.currentCell)){var r=Math.floor(n[0].contentRect.height),a=Math.floor(n[0].contentRect.width);(this.tableHeight!=r||this.tableWidth!=a)&&(this.tableHeight=r,this.tableWidth=a,e.element.parentNode&&(this.containerHeight=e.element.parentNode.clientHeight,this.containerWidth=e.element.parentNode.clientWidth),this.redrawTable())}}),this.resizeObserver.observe(e.element),i=window.getComputedStyle(e.element),this.table.element.parentNode&&!this.table.rowManager.fixedHeight&&(i.getPropertyValue("max-height")||i.getPropertyValue("min-height"))&&(this.containerObserver=new ResizeObserver(n=>{if(!e.browserMobile||e.browserMobile&&(!e.modules.edit||e.modules.edit&&!e.modules.edit.currentCell)){var r=Math.floor(n[0].contentRect.height),a=Math.floor(n[0].contentRect.width);(this.containerHeight!=r||this.containerWidth!=a)&&(this.containerHeight=r,this.containerWidth=a,this.tableHeight=e.element.clientHeight,this.tableWidth=e.element.clientWidth),this.redrawTable()}}),this.containerObserver.observe(this.table.element.parentNode)),this.subscribe("table-resize",this.tableResized.bind(this))):(this.binding=function(){(!e.browserMobile||e.browserMobile&&(!e.modules.edit||e.modules.edit&&!e.modules.edit.currentCell))&&(e.columnManager.rerenderColumns(!0),e.redraw())},window.addEventListener("resize",this.binding)),this.subscribe("table-destroy",this.clearBindings.bind(this))}}initializeVisibilityObserver(){this.visibilityObserver=new IntersectionObserver(e=>{this.visible=e[0].isIntersecting,this.initialized?this.visible&&(this.redrawTable(this.initialRedraw),this.initialRedraw=!1):(this.initialized=!0,this.initialRedraw=!this.visible)}),this.visibilityObserver.observe(this.table.element)}redrawTable(e){this.initialized&&this.visible&&(this.table.columnManager.rerenderColumns(!0),this.table.redraw(e))}tableResized(){this.table.rowManager.redraw()}clearBindings(){this.binding&&window.removeEventListener("resize",this.binding),this.resizeObserver&&this.resizeObserver.unobserve(this.table.element),this.visibilityObserver&&this.visibilityObserver.unobserve(this.table.element),this.containerObserver&&this.containerObserver.unobserve(this.table.element.parentNode)}}Je(XTe,"moduleName","resizeTable");function HYe(t,e,i){var n=document.createElement("div"),r=t.getRow()._row.modules.responsiveLayout;n.classList.add("tabulator-responsive-collapse-toggle"),n.innerHTML=`<svg class='tabulator-responsive-collapse-toggle-open' viewbox="0 0 24 24">
  <line x1="7" y1="12" x2="17" y2="12" fill="none" stroke-width="3" stroke-linecap="round" />
  <line y1="7" x1="12" y2="17" x2="12" fill="none" stroke-width="3" stroke-linecap="round" />
</svg>

<svg class='tabulator-responsive-collapse-toggle-close' viewbox="0 0 24 24">
  <line x1="7" y1="12" x2="17" y2="12"  fill="none" stroke-width="3" stroke-linecap="round" />
</svg>`,t.getElement().classList.add("tabulator-row-handle");function a(o){var s=r.element;r.open=o,s&&(r.open?(n.classList.add("open"),s.style.display=""):(n.classList.remove("open"),s.style.display="none"))}return n.addEventListener("click",function(o){o.stopImmediatePropagation(),a(!r.open),t.getTable().rowManager.adjustTableSize()}),a(r.open),n}var zYe={format:{formatters:{responsiveCollapse:HYe}}};class lG extends Wn{constructor(e){super(e),this.columns=[],this.hiddenColumns=[],this.mode="",this.index=0,this.collapseFormatter=[],this.collapseStartOpen=!0,this.collapseHandleColumn=!1,this.registerTableOption("responsiveLayout",!1),this.registerTableOption("responsiveLayoutCollapseStartOpen",!0),this.registerTableOption("responsiveLayoutCollapseUseFormatters",!0),this.registerTableOption("responsiveLayoutCollapseFormatter",!1),this.registerColumnOption("responsive")}initialize(){this.table.options.responsiveLayout&&(this.subscribe("column-layout",this.initializeColumn.bind(this)),this.subscribe("column-show",this.updateColumnVisibility.bind(this)),this.subscribe("column-hide",this.updateColumnVisibility.bind(this)),this.subscribe("columns-loaded",this.initializeResponsivity.bind(this)),this.subscribe("column-moved",this.initializeResponsivity.bind(this)),this.subscribe("column-add",this.initializeResponsivity.bind(this)),this.subscribe("column-delete",this.initializeResponsivity.bind(this)),this.subscribe("table-redrawing",this.tableRedraw.bind(this)),this.table.options.responsiveLayout==="collapse"&&(this.subscribe("row-data-changed",this.generateCollapsedRowContent.bind(this)),this.subscribe("row-init",this.initializeRow.bind(this)),this.subscribe("row-layout",this.layoutRow.bind(this))))}tableRedraw(e){["fitColumns","fitDataStretch"].indexOf(this.layoutMode())===-1&&(e||this.update())}initializeResponsivity(){var e=[];this.mode=this.table.options.responsiveLayout,this.collapseFormatter=this.table.options.responsiveLayoutCollapseFormatter||this.formatCollapsedData,this.collapseStartOpen=this.table.options.responsiveLayoutCollapseStartOpen,this.hiddenColumns=[],this.collapseFormatter&&(this.collapseFormatter=this.collapseFormatter.bind(this.table)),this.table.columnManager.columnsByIndex.forEach((i,n)=>{i.modules.responsive&&i.modules.responsive.order&&i.modules.responsive.visible&&(i.modules.responsive.index=n,e.push(i),!i.visible&&this.mode==="collapse"&&this.hiddenColumns.push(i))}),e=e.reverse(),e=e.sort((i,n)=>{var r=n.modules.responsive.order-i.modules.responsive.order;return r||n.modules.responsive.index-i.modules.responsive.index}),this.columns=e,this.mode==="collapse"&&this.generateCollapsedContent();for(let i of this.table.columnManager.columnsByIndex)if(i.definition.formatter=="responsiveCollapse"){this.collapseHandleColumn=i;break}this.collapseHandleColumn&&(this.hiddenColumns.length?this.collapseHandleColumn.show():this.collapseHandleColumn.hide())}initializeColumn(e){var i=e.getDefinition();e.modules.responsive={order:typeof i.responsive>"u"?1:i.responsive,visible:i.visible!==!1}}initializeRow(e){var i;e.type!=="calc"&&(i=document.createElement("div"),i.classList.add("tabulator-responsive-collapse"),e.modules.responsiveLayout={element:i,open:this.collapseStartOpen},this.collapseStartOpen||(i.style.display="none"))}layoutRow(e){var i=e.getElement();e.modules.responsiveLayout&&(i.appendChild(e.modules.responsiveLayout.element),this.generateCollapsedRowContent(e))}updateColumnVisibility(e,i){!i&&e.modules.responsive&&(e.modules.responsive.visible=e.visible,this.initializeResponsivity())}hideColumn(e){var i=this.hiddenColumns.length;e.hide(!1,!0),this.mode==="collapse"&&(this.hiddenColumns.unshift(e),this.generateCollapsedContent(),this.collapseHandleColumn&&!i&&this.collapseHandleColumn.show())}showColumn(e){var i;e.show(!1,!0),e.setWidth(e.getWidth()),this.mode==="collapse"&&(i=this.hiddenColumns.indexOf(e),i>-1&&this.hiddenColumns.splice(i,1),this.generateCollapsedContent(),this.collapseHandleColumn&&!this.hiddenColumns.length&&this.collapseHandleColumn.hide())}update(){for(var e=!0;e;){let i=this.table.modules.layout.getMode()=="fitColumns"?this.table.columnManager.getFlexBaseWidth():this.table.columnManager.getWidth(),n=(this.table.options.headerVisible?this.table.columnManager.element.clientWidth:this.table.element.clientWidth)-i;if(n<0){let r=this.columns[this.index];r?(this.hideColumn(r),this.index++):e=!1}else{let r=this.columns[this.index-1];r&&n>0&&n>=r.getWidth()?(this.showColumn(r),this.index--):e=!1}this.table.rowManager.activeRowsCount||this.table.rowManager.renderEmptyScroll()}}generateCollapsedContent(){var e=this.table.rowManager.getDisplayRows();e.forEach(i=>{this.generateCollapsedRowContent(i)})}generateCollapsedRowContent(e){var i,n;if(e.modules.responsiveLayout){for(i=e.modules.responsiveLayout.element;i.firstChild;)i.removeChild(i.firstChild);n=this.collapseFormatter(this.generateCollapsedRowData(e)),n&&i.appendChild(n),e.calcHeight(!0)}}generateCollapsedRowData(e){var i=e.getData(),n=[],r;return this.hiddenColumns.forEach(a=>{var o=a.getFieldValue(i);if(a.definition.title&&a.field)if(a.modules.format&&this.table.options.responsiveLayoutCollapseUseFormatters){let s=function(l){l()};r={value:!1,data:{},getValue:function(){return o},getData:function(){return i},getType:function(){return"cell"},getElement:function(){return document.createElement("div")},getRow:function(){return e.getComponent()},getColumn:function(){return a.getComponent()},getTable:()=>this.table},n.push({field:a.field,title:a.definition.title,value:a.modules.format.formatter.call(this.table.modules.format,r,a.modules.format.params,s)})}else n.push({field:a.field,title:a.definition.title,value:o})}),n}formatCollapsedData(e){var i=document.createElement("table");return e.forEach(n=>{var r=document.createElement("tr"),a=document.createElement("td"),o=document.createElement("td"),s,l=document.createElement("strong");a.appendChild(l),this.modules.localize.bind("columns|"+n.field,function(c){l.innerHTML=c||n.title}),n.value instanceof Node?(s=document.createElement("div"),s.appendChild(n.value),o.appendChild(s)):o.innerHTML=n.value,r.appendChild(a),r.appendChild(o),i.appendChild(r)}),Object.keys(e).length?i:""}}Je(lG,"moduleName","responsiveLayout"),Je(lG,"moduleExtensions",zYe);function qYe(t,e,i){var n=document.createElement("input"),r=!1;if(n.type="checkbox",n.setAttribute("aria-label","Select Row"),this.table.modExists("selectRow",!0))if(n.addEventListener("click",o=>{o.stopPropagation()}),typeof t.getRow=="function"){var a=t.getRow();a instanceof jF?(n.addEventListener("change",o=>{this.table.options.selectableRowsRangeMode==="click"&&r?r=!1:a.toggleSelect()}),this.table.options.selectableRowsRangeMode==="click"&&n.addEventListener("click",o=>{r=!0,this.table.modules.selectRow.handleComplexRowClick(a._row,o)}),n.checked=a.isSelected&&a.isSelected(),this.table.modules.selectRow.registerRowSelectCheckbox(a,n)):n=""}else n.addEventListener("change",o=>{this.table.modules.selectRow.selectedRows.length?this.table.deselectRow():this.table.selectRow(e.rowRange)}),this.table.modules.selectRow.registerHeaderSelectCheckbox(n);return n}var WYe={format:{formatters:{rowSelection:qYe}}};class cG extends Wn{constructor(e){super(e),this.selecting=!1,this.lastClickedRow=!1,this.selectPrev=[],this.selectedRows=[],this.headerCheckboxElement=null,this.registerTableOption("selectableRows","highlight"),this.registerTableOption("selectableRowsRangeMode","drag"),this.registerTableOption("selectableRowsRollingSelection",!0),this.registerTableOption("selectableRowsPersistence",!0),this.registerTableOption("selectableRowsCheck",function(i,n){return!0}),this.registerTableFunction("selectRow",this.selectRows.bind(this)),this.registerTableFunction("deselectRow",this.deselectRows.bind(this)),this.registerTableFunction("toggleSelectRow",this.toggleRow.bind(this)),this.registerTableFunction("getSelectedRows",this.getSelectedRows.bind(this)),this.registerTableFunction("getSelectedData",this.getSelectedData.bind(this)),this.registerComponentFunction("row","select",this.selectRows.bind(this)),this.registerComponentFunction("row","deselect",this.deselectRows.bind(this)),this.registerComponentFunction("row","toggleSelect",this.toggleRow.bind(this)),this.registerComponentFunction("row","isSelected",this.isRowSelected.bind(this))}initialize(){this.deprecatedOptionsCheck(),this.table.options.selectableRows==="highlight"&&this.table.options.selectableRange&&(this.table.options.selectableRows=!1),this.table.options.selectableRows!==!1&&(this.subscribe("row-init",this.initializeRow.bind(this)),this.subscribe("row-deleting",this.rowDeleted.bind(this)),this.subscribe("rows-wipe",this.clearSelectionData.bind(this)),this.subscribe("rows-retrieve",this.rowRetrieve.bind(this)),this.table.options.selectableRows&&!this.table.options.selectableRowsPersistence&&this.subscribe("data-refreshing",this.deselectRows.bind(this)))}deprecatedOptionsCheck(){}rowRetrieve(e,i){return e==="selected"?this.selectedRows:i}rowDeleted(e){this._deselectRow(e,!0)}clearSelectionData(e){var i=this.selectedRows.length;this.selecting=!1,this.lastClickedRow=!1,this.selectPrev=[],this.selectedRows=[],i&&e!==!0&&this._rowSelectionChanged()}initializeRow(e){var i=this,n=i.checkRowSelectability(e),r=e.getElement(),a=function(){setTimeout(function(){i.selecting=!1},50),document.body.removeEventListener("mouseup",a)};e.modules.select={selected:!1},r.classList.toggle("tabulator-selectable",n),r.classList.toggle("tabulator-unselectable",!n),i.checkRowSelectability(e)&&i.table.options.selectableRows&&i.table.options.selectableRows!="highlight"&&(i.table.options.selectableRowsRangeMode==="click"?r.addEventListener("click",this.handleComplexRowClick.bind(this,e)):(r.addEventListener("click",function(o){(!i.table.modExists("edit")||!i.table.modules.edit.getCurrentCell())&&i.table._clearSelection(),i.selecting||i.toggleRow(e)}),r.addEventListener("mousedown",function(o){if(o.shiftKey)return i.table._clearSelection(),i.selecting=!0,i.selectPrev=[],document.body.addEventListener("mouseup",a),document.body.addEventListener("keyup",a),i.toggleRow(e),!1}),r.addEventListener("mouseenter",function(o){i.selecting&&(i.table._clearSelection(),i.toggleRow(e),i.selectPrev[1]==e&&i.toggleRow(i.selectPrev[0]))}),r.addEventListener("mouseout",function(o){i.selecting&&(i.table._clearSelection(),i.selectPrev.unshift(e))})))}handleComplexRowClick(e,i){if(i.shiftKey){this.table._clearSelection(),this.lastClickedRow=this.lastClickedRow||e;var n=this.table.rowManager.getDisplayRowIndex(this.lastClickedRow),r=this.table.rowManager.getDisplayRowIndex(e),a=n<=r?n:r,o=n>=r?n:r,s=this.table.rowManager.getDisplayRows().slice(0),l=s.splice(a,o-a+1);i.ctrlKey||i.metaKey?(l.forEach(c=>{c!==this.lastClickedRow&&(this.table.options.selectableRows!==!0&&!this.isRowSelected(e)?this.selectedRows.length<this.table.options.selectableRows&&this.toggleRow(c):this.toggleRow(c))}),this.lastClickedRow=e):(this.deselectRows(void 0,!0),this.table.options.selectableRows!==!0&&l.length>this.table.options.selectableRows&&(l=l.slice(0,this.table.options.selectableRows)),this.selectRows(l)),this.table._clearSelection()}else i.ctrlKey||i.metaKey?(this.toggleRow(e),this.lastClickedRow=e):(this.deselectRows(void 0,!0),this.selectRows(e),this.lastClickedRow=e)}checkRowSelectability(e){return e&&e.type==="row"?this.table.options.selectableRowsCheck.call(this.table,e.getComponent()):!1}toggleRow(e){this.checkRowSelectability(e)&&(e.modules.select&&e.modules.select.selected?this._deselectRow(e):this._selectRow(e))}selectRows(e){var i=[],n,r;switch(typeof e){case"undefined":n=this.table.rowManager.rows;break;case"number":n=this.table.rowManager.findRow(e);break;case"string":n=this.table.rowManager.findRow(e),n||(n=this.table.rowManager.getRows(e));break;default:n=e;break}Array.isArray(n)?n.length&&(n.forEach(a=>{r=this._selectRow(a,!0,!0),r&&i.push(r)}),this._rowSelectionChanged(!1,i)):n&&this._selectRow(n,!1,!0)}_selectRow(e,i,n){if(!isNaN(this.table.options.selectableRows)&&this.table.options.selectableRows!==!0&&!n&&this.selectedRows.length>=this.table.options.selectableRows)if(this.table.options.selectableRowsRollingSelection)this._deselectRow(this.selectedRows[0]);else return!1;var r=this.table.rowManager.findRow(e);if(r){if(this.selectedRows.indexOf(r)==-1)return r.getElement().classList.add("tabulator-selected"),r.modules.select||(r.modules.select={}),r.modules.select.selected=!0,r.modules.select.checkboxEl&&(r.modules.select.checkboxEl.checked=!0),this.selectedRows.push(r),this.table.options.dataTreeSelectPropagate&&this.childRowSelection(r,!0),this.dispatchExternal("rowSelected",r.getComponent()),this._rowSelectionChanged(i,r),r}else i||console.warn("Selection Error - No such row found, ignoring selection:"+e)}isRowSelected(e){return this.selectedRows.indexOf(e)!==-1}deselectRows(e,i){var n=[],r,a;switch(typeof e){case"undefined":r=Object.assign([],this.selectedRows);break;case"number":r=this.table.rowManager.findRow(e);break;case"string":r=this.table.rowManager.findRow(e),r||(r=this.table.rowManager.getRows(e));break;default:r=e;break}Array.isArray(r)?r.length&&(r.forEach(o=>{a=this._deselectRow(o,!0,!0),a&&n.push(a)}),this._rowSelectionChanged(i,[],n)):r&&this._deselectRow(r,i,!0)}_deselectRow(e,i){var n=this,r=n.table.rowManager.findRow(e),a,o;if(r){if(a=n.selectedRows.findIndex(function(s){return s==r}),a>-1)return o=r.getElement(),o&&o.classList.remove("tabulator-selected"),r.modules.select||(r.modules.select={}),r.modules.select.selected=!1,r.modules.select.checkboxEl&&(r.modules.select.checkboxEl.checked=!1),n.selectedRows.splice(a,1),this.table.options.dataTreeSelectPropagate&&this.childRowSelection(r,!1),this.dispatchExternal("rowDeselected",r.getComponent()),n._rowSelectionChanged(i,void 0,r),r}else i||console.warn("Deselection Error - No such row found, ignoring selection:"+e)}getSelectedData(){var e=[];return this.selectedRows.forEach(function(i){e.push(i.getData())}),e}getSelectedRows(){var e=[];return this.selectedRows.forEach(function(i){e.push(i.getComponent())}),e}_rowSelectionChanged(e,i=[],n=[]){this.headerCheckboxElement&&(this.selectedRows.length===0?(this.headerCheckboxElement.checked=!1,this.headerCheckboxElement.indeterminate=!1):this.table.rowManager.rows.length===this.selectedRows.length?(this.headerCheckboxElement.checked=!0,this.headerCheckboxElement.indeterminate=!1):(this.headerCheckboxElement.indeterminate=!0,this.headerCheckboxElement.checked=!1)),e||(Array.isArray(i)||(i=[i]),i=i.map(r=>r.getComponent()),Array.isArray(n)||(n=[n]),n=n.map(r=>r.getComponent()),this.dispatchExternal("rowSelectionChanged",this.getSelectedData(),this.getSelectedRows(),i,n))}registerRowSelectCheckbox(e,i){e._row.modules.select||(e._row.modules.select={}),e._row.modules.select.checkboxEl=i}registerHeaderSelectCheckbox(e){this.headerCheckboxElement=e}childRowSelection(e,i){var n=this.table.modules.dataTree.getChildren(e,!0,!0);if(i)for(let r of n)this._selectRow(r,!0);else for(let r of n)this._deselectRow(r,!0)}}Je(cG,"moduleName","selectRow"),Je(cG,"moduleExtensions",WYe);class KYe{constructor(e){return this._range=e,new Proxy(this,{get:function(i,n,r){return typeof i[n]<"u"?i[n]:i._range.table.componentFunctionBinder.handle("range",i._range,n)}})}getElement(){return this._range.element}getData(){return this._range.getData()}getCells(){return this._range.getCells(!0)}getStructuredCells(){return this._range.getStructuredCells()}getRows(){return this._range.getRows().map(e=>e.getComponent())}getColumns(){return this._range.getColumns().map(e=>e.getComponent())}getBounds(){return this._range.getBounds()}getTopEdge(){return this._range.top}getBottomEdge(){return this._range.bottom}getLeftEdge(){return this._range.left}getRightEdge(){return this._range.right}setBounds(e,i){this._range.destroyedGuard("setBounds")&&this._range.setBounds(e&&e._cell,i&&i._cell)}setStartBound(e){this._range.destroyedGuard("setStartBound")&&(this._range.setEndBound(e&&e._cell),this._range.rangeManager.layoutElement())}setEndBound(e){this._range.destroyedGuard("setEndBound")&&(this._range.setEndBound(e&&e._cell),this._range.rangeManager.layoutElement())}clearValues(){this._range.destroyedGuard("clearValues")&&this._range.clearValues()}remove(){this._range.destroyedGuard("remove")&&this._range.destroy(!0)}}let YYe=class extends dc{constructor(e,i,n,r){super(e),this.rangeManager=i,this.element=null,this.initialized=!1,this.initializing={start:!1,end:!1},this.destroyed=!1,this.top=0,this.bottom=0,this.left=0,this.right=0,this.table=e,this.start={row:0,col:0},this.end={row:0,col:0},this.rangeManager.rowHeader&&(this.left=1,this.right=1,this.start.col=1,this.end.col=1),this.initElement(),setTimeout(()=>{this.initBounds(n,r)})}initElement(){this.element=document.createElement("div"),this.element.classList.add("tabulator-range")}initBounds(e,i){this._updateMinMax(),e&&this.setBounds(e,i||e)}setStart(e,i){(this.start.row!==e||this.start.col!==i)&&(this.start.row=e,this.start.col=i,this.initializing.start=!0,this._updateMinMax())}setEnd(e,i){(this.end.row!==e||this.end.col!==i)&&(this.end.row=e,this.end.col=i,this.initializing.end=!0,this._updateMinMax())}setBounds(e,i,n){e&&this.setStartBound(e),this.setEndBound(i||e),this.rangeManager.layoutElement(n)}setStartBound(e){var i,n;e.type==="column"?this.rangeManager.columnSelection&&this.setStart(0,e.getPosition()-1):(i=e.row.position-1,n=e.column.getPosition()-1,e.column===this.rangeManager.rowHeader?this.setStart(i,1):this.setStart(i,n))}setEndBound(e){var i=this._getTableRows().length,n,r,a;e.type==="column"?this.rangeManager.columnSelection&&(this.rangeManager.selecting==="column"?this.setEnd(i-1,e.getPosition()-1):this.rangeManager.selecting==="cell"&&this.setEnd(0,e.getPosition()-1)):(n=e.row.position-1,r=e.column.getPosition()-1,a=e.column===this.rangeManager.rowHeader,this.rangeManager.selecting==="row"?this.setEnd(n,this._getTableColumns().length-1):this.rangeManager.selecting!=="row"&&a?this.setEnd(n,0):this.rangeManager.selecting==="column"?this.setEnd(i-1,r):this.setEnd(n,r))}_updateMinMax(){this.top=Math.min(this.start.row,this.end.row),this.bottom=Math.max(this.start.row,this.end.row),this.left=Math.min(this.start.col,this.end.col),this.right=Math.max(this.start.col,this.end.col),this.initialized?this.dispatchExternal("rangeChanged",this.getComponent()):this.initializing.start&&this.initializing.end&&(this.initialized=!0,this.dispatchExternal("rangeAdded",this.getComponent()))}_getTableColumns(){return this.table.columnManager.getVisibleColumnsByIndex()}_getTableRows(){return this.table.rowManager.getDisplayRows().filter(e=>e.type==="row")}layout(){var e=this.table.rowManager.renderer.vDomTop,i=this.table.rowManager.renderer.vDomBottom,n=this.table.columnManager.renderer.leftCol,r=this.table.columnManager.renderer.rightCol,a,o,s,l,c,u,d,p,h,f;this.table.options.renderHorizontal==="virtual"&&this.rangeManager.rowHeader&&(r+=1),e==null&&(e=0),i==null&&(i=1/0),n==null&&(n=0),r==null&&(r=1/0),this.overlaps(n,e,r,i)&&(a=Math.max(this.top,e),o=Math.min(this.bottom,i),s=Math.max(this.left,n),l=Math.min(this.right,r),c=this.rangeManager.getCell(a,s),u=this.rangeManager.getCell(o,l),d=c.getElement(),p=u.getElement(),h=c.row.getElement(),f=u.row.getElement(),this.element.classList.add("tabulator-range-active"),this.table.rtl?(this.element.style.right=h.offsetWidth-d.offsetLeft-d.offsetWidth+"px",this.element.style.width=d.offsetLeft+d.offsetWidth-p.offsetLeft+"px"):(this.element.style.left=h.offsetLeft+d.offsetLeft+"px",this.element.style.width=p.offsetLeft+p.offsetWidth-d.offsetLeft+"px"),this.element.style.top=h.offsetTop+"px",this.element.style.height=f.offsetTop+f.offsetHeight-h.offsetTop+"px")}atTopLeft(e){return e.row.position-1===this.top&&e.column.getPosition()-1===this.left}atBottomRight(e){return e.row.position-1===this.bottom&&e.column.getPosition()-1===this.right}occupies(e){return this.occupiesRow(e.row)&&this.occupiesColumn(e.column)}occupiesRow(e){return this.top<=e.position-1&&e.position-1<=this.bottom}occupiesColumn(e){return this.left<=e.getPosition()-1&&e.getPosition()-1<=this.right}overlaps(e,i,n,r){return!(this.left>n||e>this.right||this.top>r||i>this.bottom)}getData(){var e=[],i=this.getRows(),n=this.getColumns();return i.forEach(r=>{var a=r.getData(),o={};n.forEach(s=>{o[s.field]=a[s.field]}),e.push(o)}),e}getCells(e,i){var n=[],r=this.getRows(),a=this.getColumns();return e?n=r.map(o=>{var s=[];return o.getCells().forEach(l=>{a.includes(l.column)&&s.push(i?l.getComponent():l)}),s}):r.forEach(o=>{o.getCells().forEach(s=>{a.includes(s.column)&&n.push(i?s.getComponent():s)})}),n}getStructuredCells(){return this.getCells(!0,!0)}getRows(){return this._getTableRows().slice(this.top,this.bottom+1)}getColumns(){return this._getTableColumns().slice(this.left,this.right+1)}clearValues(){var e=this.getCells(),i=this.table.options.selectableRangeClearCellsValue;this.table.blockRedraw(),e.forEach(n=>{n.setValue(i)}),this.table.restoreRedraw()}getBounds(e){var i=this.getCells(!1,e),n={start:null,end:null};return i.length?(n.start=i[0],n.end=i[i.length-1]):console.warn("No bounds defined on range"),n}getComponent(){return this.component||(this.component=new KYe(this)),this.component}destroy(e){this.destroyed=!0,this.element.remove(),e&&this.rangeManager.rangeRemoved(this),this.initialized&&this.dispatchExternal("rangeRemoved",this.getComponent())}destroyedGuard(e){return this.destroyed&&console.warn("You cannot call the "+e+" function on a destroyed range"),!this.destroyed}};var ZYe={rangeJumpUp:["ctrl + 38","meta + 38"],rangeJumpDown:["ctrl + 40","meta + 40"],rangeJumpLeft:["ctrl + 37","meta + 37"],rangeJumpRight:["ctrl + 39","meta + 39"],rangeExpandUp:"shift + 38",rangeExpandDown:"shift + 40",rangeExpandLeft:"shift + 37",rangeExpandRight:"shift + 39",rangeExpandJumpUp:["ctrl + shift + 38","meta + shift + 38"],rangeExpandJumpDown:["ctrl + shift + 40","meta + shift + 40"],rangeExpandJumpLeft:["ctrl + shift + 37","meta + shift + 37"],rangeExpandJumpRight:["ctrl + shift + 39","meta + shift + 39"]},XYe={rangeJumpLeft:function(t){this.dispatch("keybinding-nav-range",t,"left",!0,!1)},rangeJumpRight:function(t){this.dispatch("keybinding-nav-range",t,"right",!0,!1)},rangeJumpUp:function(t){this.dispatch("keybinding-nav-range",t,"up",!0,!1)},rangeJumpDown:function(t){this.dispatch("keybinding-nav-range",t,"down",!0,!1)},rangeExpandLeft:function(t){this.dispatch("keybinding-nav-range",t,"left",!1,!0)},rangeExpandRight:function(t){this.dispatch("keybinding-nav-range",t,"right",!1,!0)},rangeExpandUp:function(t){this.dispatch("keybinding-nav-range",t,"up",!1,!0)},rangeExpandDown:function(t){this.dispatch("keybinding-nav-range",t,"down",!1,!0)},rangeExpandJumpLeft:function(t){this.dispatch("keybinding-nav-range",t,"left",!0,!0)},rangeExpandJumpRight:function(t){this.dispatch("keybinding-nav-range",t,"right",!0,!0)},rangeExpandJumpUp:function(t){this.dispatch("keybinding-nav-range",t,"up",!0,!0)},rangeExpandJumpDown:function(t){this.dispatch("keybinding-nav-range",t,"down",!0,!0)}},JYe={range:function(t){var e=[],i=this.table.modules.selectRange.activeRange,n=!1,r,a,o,s,l;return l=t.length,i&&(r=i.getBounds(),a=r.start,r.start===r.end&&(n=!0),a&&(e=this.table.rowManager.activeRows.slice(),o=e.indexOf(a.row),n?s=t.length:s=e.indexOf(r.end.row)-o+1,o>-1&&(this.table.blockRedraw(),e=e.slice(o,o+s),e.forEach((c,u)=>{c.updateData(t[u%l])}),this.table.restoreRedraw()))),e}},QYe={range:function(t){var e=[],i=[],n=this.table.modules.selectRange.activeRange,r=!1,a,o,s,l,c;return n&&(a=n.getBounds(),o=a.start,a.start===a.end&&(r=!0),o&&(t=t.split(`
`),t.forEach(function(u){e.push(u.split("	"))}),e.length&&(l=this.table.columnManager.getVisibleColumnsByIndex(),c=l.indexOf(o.column),c>-1)))?(r?s=e[0].length:s=l.indexOf(a.end.column)-c+1,l=l.slice(c,c+s),e.forEach(u=>{var d={},p=u.length;l.forEach(function(h,f){d[h.field]=u[f%p]}),i.push(d)}),i):!1}},eZe={range:function(){var t=this.modules.selectRange.selectedColumns();return this.columnManager.rowHeader&&t.unshift(this.columnManager.rowHeader),t}},tZe={range:function(){return this.modules.selectRange.selectedRows()}},iZe={keybindings:{bindings:ZYe,actions:XYe},clipboard:{pasteActions:JYe,pasteParsers:QYe},export:{columnLookups:eZe,rowLookups:tZe}};class ZN extends Wn{constructor(e){super(e),this.selecting="cell",this.mousedown=!1,this.ranges=[],this.overlay=null,this.rowHeader=null,this.layoutChangeTimeout=null,this.columnSelection=!1,this.rowSelection=!1,this.maxRanges=0,this.activeRange=!1,this.blockKeydown=!1,this.keyDownEvent=this._handleKeyDown.bind(this),this.mouseUpEvent=this._handleMouseUp.bind(this),this.registerTableOption("selectableRange",!1),this.registerTableOption("selectableRangeColumns",!1),this.registerTableOption("selectableRangeRows",!1),this.registerTableOption("selectableRangeClearCells",!1),this.registerTableOption("selectableRangeClearCellsValue",void 0),this.registerTableFunction("getRangesData",this.getRangesData.bind(this)),this.registerTableFunction("getRanges",this.getRanges.bind(this)),this.registerTableFunction("addRange",this.addRangeFromComponent.bind(this)),this.registerComponentFunction("cell","getRanges",this.cellGetRanges.bind(this)),this.registerComponentFunction("row","getRanges",this.rowGetRanges.bind(this)),this.registerComponentFunction("column","getRanges",this.colGetRanges.bind(this))}initialize(){this.options("selectableRange")&&(this.options("selectableRows")?console.warn("SelectRange functionality cannot be used in conjunction with row selection"):(this.maxRanges=this.options("selectableRange"),this.initializeTable(),this.initializeWatchers()),this.options("columns").findIndex(e=>e.frozen)>0&&console.warn("Having frozen column in arbitrary position with selectRange option may result in unpredictable behavior."),this.options("columns").filter(e=>e.frozen)>1&&console.warn("Having multiple frozen columns with selectRange option may result in unpredictable behavior."))}initializeTable(){this.overlay=document.createElement("div"),this.overlay.classList.add("tabulator-range-overlay"),this.rangeContainer=document.createElement("div"),this.rangeContainer.classList.add("tabulator-range-container"),this.activeRangeCellElement=document.createElement("div"),this.activeRangeCellElement.classList.add("tabulator-range-cell-active"),this.overlay.appendChild(this.rangeContainer),this.overlay.appendChild(this.activeRangeCellElement),this.table.rowManager.element.addEventListener("keydown",this.keyDownEvent),this.resetRanges(),this.table.rowManager.element.appendChild(this.overlay),this.table.columnManager.element.setAttribute("tabindex",0),this.table.element.classList.add("tabulator-ranges")}initializeWatchers(){this.columnSelection=this.options("selectableRangeColumns"),this.rowSelection=this.options("selectableRangeRows"),this.subscribe("column-init",this.initializeColumn.bind(this)),this.subscribe("column-mousedown",this.handleColumnMouseDown.bind(this)),this.subscribe("column-mousemove",this.handleColumnMouseMove.bind(this)),this.subscribe("column-resized",this.handleColumnResized.bind(this)),this.subscribe("column-width",this.layoutChange.bind(this)),this.subscribe("column-height",this.layoutChange.bind(this)),this.subscribe("column-resized",this.layoutChange.bind(this)),this.subscribe("columns-loaded",this.updateHeaderColumn.bind(this)),this.subscribe("cell-height",this.layoutChange.bind(this)),this.subscribe("cell-rendered",this.renderCell.bind(this)),this.subscribe("cell-mousedown",this.handleCellMouseDown.bind(this)),this.subscribe("cell-mousemove",this.handleCellMouseMove.bind(this)),this.subscribe("cell-click",this.handleCellClick.bind(this)),this.subscribe("cell-editing",this.handleEditingCell.bind(this)),this.subscribe("page-changed",this.redraw.bind(this)),this.subscribe("scroll-vertical",this.layoutChange.bind(this)),this.subscribe("scroll-horizontal",this.layoutChange.bind(this)),this.subscribe("data-destroy",this.tableDestroyed.bind(this)),this.subscribe("data-processed",this.resetRanges.bind(this)),this.subscribe("table-layout",this.layoutElement.bind(this)),this.subscribe("table-redraw",this.redraw.bind(this)),this.subscribe("table-destroy",this.tableDestroyed.bind(this)),this.subscribe("edit-editor-clear",this.finishEditingCell.bind(this)),this.subscribe("edit-blur",this.restoreFocus.bind(this)),this.subscribe("keybinding-nav-prev",this.keyNavigate.bind(this,"left")),this.subscribe("keybinding-nav-next",this.keyNavigate.bind(this,"right")),this.subscribe("keybinding-nav-left",this.keyNavigate.bind(this,"left")),this.subscribe("keybinding-nav-right",this.keyNavigate.bind(this,"right")),this.subscribe("keybinding-nav-up",this.keyNavigate.bind(this,"up")),this.subscribe("keybinding-nav-down",this.keyNavigate.bind(this,"down")),this.subscribe("keybinding-nav-range",this.keyNavigateRange.bind(this))}initializeColumn(e){this.columnSelection&&e.definition.headerSort&&this.options("headerSortClickElement")!=="icon"&&console.warn("Using column headerSort with selectableRangeColumns option may result in unpredictable behavior. Consider using headerSortClickElement: 'icon'."),e.modules.edit}updateHeaderColumn(){var e;this.rowSelection&&(this.rowHeader=this.table.columnManager.getVisibleColumnsByIndex()[0],this.rowHeader&&(this.rowHeader.definition.cssClass=this.rowHeader.definition.cssClass+" tabulator-range-row-header",this.rowHeader.definition.headerSort&&console.warn("Using column headerSort with selectableRangeRows option may result in unpredictable behavior"),this.rowHeader.definition.editor&&console.warn("Using column editor with selectableRangeRows option may result in unpredictable behavior"))),this.table.modules.frozenColumns&&this.table.modules.frozenColumns.active&&(e=this.table.modules.frozenColumns.getFrozenColumns(),(e.length>1||e.length===1&&e[0]!==this.rowHeader)&&console.warn("Using frozen columns that are not the range header in combination with the selectRange option may result in unpredictable behavior"))}getRanges(){return this.ranges.map(e=>e.getComponent())}getRangesData(){return this.ranges.map(e=>e.getData())}addRangeFromComponent(e,i){return e=e?e._cell:null,i=i?i._cell:null,this.addRange(e,i)}cellGetRanges(e){var i=[];return e.column===this.rowHeader?i=this.ranges.filter(n=>n.occupiesRow(e.row)):i=this.ranges.filter(n=>n.occupies(e)),i.map(n=>n.getComponent())}rowGetRanges(e){var i=this.ranges.filter(n=>n.occupiesRow(e));return i.map(n=>n.getComponent())}colGetRanges(e){var i=this.ranges.filter(n=>n.occupiesColumn(e));return i.map(n=>n.getComponent())}_handleMouseUp(e){this.mousedown=!1,document.removeEventListener("mouseup",this.mouseUpEvent)}_handleKeyDown(e){if(!this.blockKeydown&&(!this.table.modules.edit||this.table.modules.edit&&!this.table.modules.edit.currentCell)){if(e.key==="Enter"){if(this.table.modules.edit&&this.table.modules.edit.currentCell)return;this.table.modules.edit.editCell(this.getActiveCell()),e.preventDefault()}(e.key==="Backspace"||e.key==="Delete")&&this.options("selectableRangeClearCells")&&this.activeRange&&this.activeRange.clearValues()}}initializeFocus(e){var i;try{document.selection?(i=document.body.createTextRange(),i.moveToElementText(e.getElement()),i.select()):window.getSelection&&(i=document.createRange(),i.selectNode(e.getElement()),window.getSelection().removeAllRanges(),window.getSelection().addRange(i))}catch{}}restoreFocus(e){return this.table.rowManager.element.focus(),!0}handleColumnResized(e){var i;this.selecting!=="column"&&this.selecting!=="all"||(i=this.ranges.some(n=>n.occupiesColumn(e)),i&&this.ranges.forEach(n=>{var r=n.getColumns(!0);r.forEach(a=>{a!==e&&a.setWidth(e.width)})}))}handleColumnMouseDown(e,i){e.button===2&&(this.selecting==="column"||this.selecting==="all")&&this.activeRange.occupiesColumn(i)||(this.mousedown=!0,document.addEventListener("mouseup",this.mouseUpEvent),this.newSelection(e,i))}handleColumnMouseMove(e,i){i===this.rowHeader||!this.mousedown||this.selecting==="all"||this.activeRange.setBounds(!1,i,!0)}renderCell(e){var i=e.getElement(),n=this.ranges.findIndex(r=>r.occupies(e));i.classList.toggle("tabulator-range-selected",n!==-1),i.classList.toggle("tabulator-range-only-cell-selected",this.ranges.length===1&&this.ranges[0].atTopLeft(e)&&this.ranges[0].atBottomRight(e)),i.dataset.range=n}handleCellMouseDown(e,i){e.button===2&&(this.activeRange.occupies(i)||(this.selecting==="row"||this.selecting==="all")&&this.activeRange.occupiesRow(i.row))||(this.mousedown=!0,document.addEventListener("mouseup",this.mouseUpEvent),this.newSelection(e,i))}handleCellMouseMove(e,i){!this.mousedown||this.selecting==="all"||this.activeRange.setBounds(!1,i,!0)}handleCellClick(e,i){this.initializeFocus(i)}handleEditingCell(e){this.activeRange&&this.activeRange.setBounds(e)}finishEditingCell(){this.blockKeydown=!0,this.table.rowManager.element.focus(),setTimeout(()=>{this.blockKeydown=!1},10)}keyNavigate(e,i){this.navigate(!1,!1,e)&&i.preventDefault()}keyNavigateRange(e,i,n,r){this.navigate(n,r,i)&&e.preventDefault()}navigate(e,i,n){var r=!1,a,o,s,l,c,u;if(this.table.modules.edit&&this.table.modules.edit.currentCell)return!1;if(this.ranges.length>1&&(this.ranges=this.ranges.filter(d=>d===this.activeRange?(d.setEnd(d.start.row,d.start.col),!0):(d.destroy(),!1))),a=this.activeRange,o=i?a.end:a.start,s=o.row,l=o.col,e)switch(n){case"left":l=this.findJumpCellLeft(a.start.row,o.col);break;case"right":l=this.findJumpCellRight(a.start.row,o.col);break;case"up":s=this.findJumpCellUp(o.row,a.start.col);break;case"down":s=this.findJumpCellDown(o.row,a.start.col);break}else{if(i&&(this.selecting==="row"&&(n==="left"||n==="right")||this.selecting==="column"&&(n==="up"||n==="down")))return;switch(n){case"left":l=Math.max(l-1,0);break;case"right":l=Math.min(l+1,this.getTableColumns().length-1);break;case"up":s=Math.max(s-1,0);break;case"down":s=Math.min(s+1,this.getTableRows().length-1);break}}if(r=l!==o.col||s!==o.row,i||a.setStart(s,l),a.setEnd(s,l),i||(this.selecting="cell"),r)return c=this.getRowByRangePos(a.end.row),u=this.getColumnByRangePos(a.end.col),(n==="left"||n==="right")&&u.getElement().parentNode===null?u.getComponent().scrollTo(void 0,!1):(n==="up"||n==="down")&&c.getElement().parentNode===null?c.getComponent().scrollTo(void 0,!1):this.autoScroll(a,c.getElement(),u.getElement()),this.layoutElement(),!0}rangeRemoved(e){this.ranges=this.ranges.filter(i=>i!==e),this.activeRange===e&&(this.ranges.length?this.activeRange=this.ranges[this.ranges.length-1]:this.addRange()),this.layoutElement()}findJumpCell(e,i,n,r){var a;i&&(e=e.reverse());for(let o of e){let s=o.getValue();if(n){if(a=o,s)break}else if(r){if(a=o,s)break}else if(s)a=o;else break}return a}findJumpCellLeft(e,i){var n=this.getRowByRangePos(e),r=n.cells.filter(u=>u.column.visible),a=!r[i].getValue(),o=r[i]?!r[i].getValue():!1,s=i,l=this.rowHeader?r.slice(1,i):r.slice(0,i),c=this.findJumpCell(l,!0,a,o);return c&&(s=c.column.getPosition()-1),s}findJumpCellRight(e,i){var n=this.getRowByRangePos(e),r=n.cells.filter(c=>c.column.visible),a=!r[i].getValue(),o=r[i+1]?!r[i+1].getValue():!1,s=i,l=this.findJumpCell(r.slice(i+1,r.length),!1,a,o);return l&&(s=l.column.getPosition()-1),s}findJumpCellUp(e,i){var n=this.getColumnByRangePos(i),r=n.cells.filter(c=>this.table.rowManager.activeRows.includes(c.row)),a=!r[e].getValue(),o=r[e-1]?!r[e-1].getValue():!1,s=e,l=this.findJumpCell(r.slice(0,s),!0,a,o);return l&&(s=l.row.position-1),s}findJumpCellDown(e,i){var n=this.getColumnByRangePos(i),r=n.cells.filter(c=>this.table.rowManager.activeRows.includes(c.row)),a=!r[e].getValue(),o=r[e+1]?!r[e+1].getValue():!1,s=e,l=this.findJumpCell(r.slice(s+1,r.length),!1,a,o);return l&&(s=l.row.position-1),s}newSelection(e,i){var n;if(i.type==="column"){if(!this.columnSelection)return;if(i===this.rowHeader){n=this.resetRanges(),this.selecting="all";var r,a=this.getCell(-1,-1);this.rowHeader?r=this.getCell(0,1):r=this.getCell(0,0),n.setBounds(r,a);return}else this.selecting="column"}else i.column===this.rowHeader?this.selecting="row":this.selecting="cell";e.shiftKey?this.activeRange.setBounds(!1,i):e.ctrlKey?this.addRange().setBounds(i):this.resetRanges().setBounds(i)}autoScroll(e,i,n){var r=this.table.rowManager.element,a,o,s,l,c;typeof i>"u"&&(i=this.getRowByRangePos(e.end.row).getElement()),typeof n>"u"&&(n=this.getColumnByRangePos(e.end.col).getElement()),this.rowHeader&&(a=this.rowHeader.getElement()),o={left:n.offsetLeft,right:n.offsetLeft+n.offsetWidth,top:i.offsetTop,bottom:i.offsetTop+i.offsetHeight},s={left:r.scrollLeft,right:Math.ceil(r.scrollLeft+r.clientWidth),top:r.scrollTop,bottom:r.scrollTop+r.offsetHeight-this.table.rowManager.scrollbarWidth},a&&(s.left+=a.offsetWidth),l=s.left<o.left&&o.left<s.right&&s.left<o.right&&o.right<s.right,c=s.top<o.top&&o.top<s.bottom&&s.top<o.bottom&&o.bottom<s.bottom,l||(o.left<s.left?(r.scrollLeft=o.left,a&&(r.scrollLeft-=a.offsetWidth)):o.right>s.right&&(r.scrollLeft=o.right-r.clientWidth)),c||(o.top<s.top?r.scrollTop=o.top:o.bottom>s.bottom&&(r.scrollTop=o.bottom-r.clientHeight))}layoutChange(){this.overlay.style.visibility="hidden",clearTimeout(this.layoutChangeTimeout),this.layoutChangeTimeout=setTimeout(this.layoutRanges.bind(this),200)}redraw(e){e&&(this.selecting="cell",this.resetRanges(),this.layoutElement())}layoutElement(e){var i;e?i=this.table.rowManager.getVisibleRows(!0):i=this.table.rowManager.getRows(),i.forEach(n=>{n.type==="row"&&(this.layoutRow(n),n.cells.forEach(r=>this.renderCell(r)))}),this.getTableColumns().forEach(n=>{this.layoutColumn(n)}),this.layoutRanges()}layoutRow(e){var i=e.getElement(),n=!1,r=this.ranges.some(a=>a.occupiesRow(e));this.selecting==="row"?n=r:this.selecting==="all"&&(n=!0),i.classList.toggle("tabulator-range-selected",n),i.classList.toggle("tabulator-range-highlight",r)}layoutColumn(e){var i=e.getElement(),n=!1,r=this.ranges.some(a=>a.occupiesColumn(e));this.selecting==="column"?n=r:this.selecting==="all"&&(n=!0),i.classList.toggle("tabulator-range-selected",n),i.classList.toggle("tabulator-range-highlight",r)}layoutRanges(){var e,i,n;this.table.initialized&&(e=this.getActiveCell(),e&&(i=e.getElement(),n=e.row.getElement(),this.table.rtl?this.activeRangeCellElement.style.right=n.offsetWidth-i.offsetLeft-i.offsetWidth+"px":this.activeRangeCellElement.style.left=n.offsetLeft+i.offsetLeft+"px",this.activeRangeCellElement.style.top=n.offsetTop+"px",this.activeRangeCellElement.style.width=i.offsetWidth+"px",this.activeRangeCellElement.style.height=n.offsetHeight+"px",this.ranges.forEach(r=>r.layout()),this.overlay.style.visibility="visible"))}getCell(e,i){var n;return i<0&&(i=this.getTableColumns().length+i,i<0)?null:(e<0&&(e=this.getTableRows().length+e),n=this.table.rowManager.getRowFromPosition(e+1),n?n.getCells(!1,!0).filter(r=>r.column.visible)[i]:null)}getActiveCell(){return this.getCell(this.activeRange.start.row,this.activeRange.start.col)}getRowByRangePos(e){return this.getTableRows()[e]}getColumnByRangePos(e){return this.getTableColumns()[e]}getTableRows(){return this.table.rowManager.getDisplayRows().filter(e=>e.type==="row")}getTableColumns(){return this.table.columnManager.getVisibleColumnsByIndex()}addRange(e,i){var n;return this.maxRanges!==!0&&this.ranges.length>=this.maxRanges&&this.ranges.shift().destroy(),n=new YYe(this.table,this,e,i),this.activeRange=n,this.ranges.push(n),this.rangeContainer.appendChild(n.element),n}resetRanges(){var e,i,n;return this.ranges.forEach(r=>r.destroy()),this.ranges=[],e=this.addRange(),this.table.rowManager.activeRows.length&&(n=this.table.rowManager.activeRows[0].cells.filter(r=>r.column.visible),i=n[this.rowHeader?1:0],i&&(e.setBounds(i),this.initializeFocus(i))),e}tableDestroyed(){document.removeEventListener("mouseup",this.mouseUpEvent),this.table.rowManager.element.removeEventListener("keydown",this.keyDownEvent)}selectedRows(e){return e?this.activeRange.getRows().map(i=>i.getComponent()):this.activeRange.getRows()}selectedColumns(e){return e?this.activeRange.getColumns().map(i=>i.getComponent()):this.activeRange.getColumns()}}Je(ZN,"moduleName","selectRange"),Je(ZN,"moduleInitOrder",1),Je(ZN,"moduleExtensions",iZe);function nZe(t,e,i,n,r,a,o){var s=o.alignEmptyValues,l=o.decimalSeparator,c=o.thousandSeparator,u=0;if(t=String(t),e=String(e),c&&(t=t.split(c).join(""),e=e.split(c).join("")),l&&(t=t.split(l).join("."),e=e.split(l).join(".")),t=parseFloat(t),e=parseFloat(e),isNaN(t))u=isNaN(e)?0:-1;else if(isNaN(e))u=1;else return t-e;return(s==="top"&&a==="desc"||s==="bottom"&&a==="asc")&&(u*=-1),u}function rZe(t,e,i,n,r,a,o){var s=o.alignEmptyValues,l=0,c;if(!t)l=e?-1:0;else if(!e)l=1;else{switch(typeof o.locale){case"boolean":o.locale&&(c=this.langLocale());break;case"string":c=o.locale;break}return String(t).toLowerCase().localeCompare(String(e).toLowerCase(),c)}return(s==="top"&&a==="desc"||s==="bottom"&&a==="asc")&&(l*=-1),l}function l9(t,e,i,n,r,a,o){var s=window.DateTime||luxon.DateTime,l=o.format||"dd/MM/yyyy HH:mm:ss",c=o.alignEmptyValues,u=0;if(typeof s<"u"){if(s.isDateTime(t)||(l==="iso"?t=s.fromISO(String(t)):t=s.fromFormat(String(t),l)),s.isDateTime(e)||(l==="iso"?e=s.fromISO(String(e)):e=s.fromFormat(String(e),l)),!t.isValid)u=e.isValid?-1:0;else if(!e.isValid)u=1;else return t-e;return(c==="top"&&a==="desc"||c==="bottom"&&a==="asc")&&(u*=-1),u}else console.error("Sort Error - 'datetime' sorter is dependant on luxon.js")}function aZe(t,e,i,n,r,a,o){return o.format||(o.format="dd/MM/yyyy"),l9.call(this,t,e,i,n,r,a,o)}function oZe(t,e,i,n,r,a,o){return o.format||(o.format="HH:mm"),l9.call(this,t,e,i,n,r,a,o)}function sZe(t,e,i,n,r,a,o){var s=t===!0||t==="true"||t==="True"||t===1?1:0,l=e===!0||e==="true"||e==="True"||e===1?1:0;return s-l}function lZe(t,e,i,n,r,a,o){var s=o.type||"length",l=o.alignEmptyValues,c=0;function u(d){var p;switch(s){case"length":p=d.length;break;case"sum":p=d.reduce(function(h,f){return h+f});break;case"max":p=Math.max.apply(null,d);break;case"min":p=Math.min.apply(null,d);break;case"avg":p=d.reduce(function(h,f){return h+f})/d.length;break}return p}if(!Array.isArray(t))c=Array.isArray(e)?-1:0;else if(!Array.isArray(e))c=1;else return u(e)-u(t);return(l==="top"&&a==="desc"||l==="bottom"&&a==="asc")&&(c*=-1),c}function cZe(t,e,i,n,r,a,o){var s=typeof t>"u"?0:1,l=typeof e>"u"?0:1;return s-l}function uZe(t,e,i,n,r,a,o){var s,l,c,u,d=0,p,h=/(\d+)|(\D+)/g,f=/\d/,m=o.alignEmptyValues,g=0;if(!t&&t!==0)g=!e&&e!==0?0:-1;else if(!e&&e!==0)g=1;else{if(isFinite(t)&&isFinite(e))return t-e;if(s=String(t).toLowerCase(),l=String(e).toLowerCase(),s===l)return 0;if(!(f.test(s)&&f.test(l)))return s>l?1:-1;for(s=s.match(h),l=l.match(h),p=s.length>l.length?l.length:s.length;d<p;)if(c=s[d],u=l[d++],c!==u)return isFinite(c)&&isFinite(u)?(c.charAt(0)==="0"&&(c="."+c),u.charAt(0)==="0"&&(u="."+u),c-u):c>u?1:-1;return s.length>l.length}return(m==="top"&&a==="desc"||m==="bottom"&&a==="asc")&&(g*=-1),g}var dZe={number:nZe,string:rZe,date:aZe,time:oZe,datetime:l9,boolean:sZe,array:lZe,exists:cZe,alphanum:uZe};const mb=class mb extends Wn{constructor(e){super(e),this.sortList=[],this.changed=!1,this.registerTableOption("sortMode","local"),this.registerTableOption("initialSort",!1),this.registerTableOption("columnHeaderSortMulti",!0),this.registerTableOption("sortOrderReverse",!1),this.registerTableOption("headerSortElement","<div class='tabulator-arrow'></div>"),this.registerTableOption("headerSortClickElement","header"),this.registerColumnOption("sorter"),this.registerColumnOption("sorterParams"),this.registerColumnOption("headerSort",!0),this.registerColumnOption("headerSortStartingDir"),this.registerColumnOption("headerSortTristate")}initialize(){this.subscribe("column-layout",this.initializeColumn.bind(this)),this.subscribe("table-built",this.tableBuilt.bind(this)),this.registerDataHandler(this.sort.bind(this),20),this.registerTableFunction("setSort",this.userSetSort.bind(this)),this.registerTableFunction("getSorters",this.getSort.bind(this)),this.registerTableFunction("clearSort",this.clearSort.bind(this)),this.table.options.sortMode==="remote"&&this.subscribe("data-params",this.remoteSortParams.bind(this))}tableBuilt(){this.table.options.initialSort&&this.setSort(this.table.options.initialSort)}remoteSortParams(e,i,n,r){var a=this.getSort();return a.forEach(o=>{delete o.column}),r.sort=a,r}userSetSort(e,i){this.setSort(e,i),this.refreshSort()}clearSort(){this.clear(),this.refreshSort()}initializeColumn(e){var i=!1,n,r;switch(typeof e.definition.sorter){case"string":mb.sorters[e.definition.sorter]?i=mb.sorters[e.definition.sorter]:console.warn("Sort Error - No such sorter found: ",e.definition.sorter);break;case"function":i=e.definition.sorter;break}if(e.modules.sort={sorter:i,dir:"none",params:e.definition.sorterParams||{},startingDir:e.definition.headerSortStartingDir||"asc",tristate:e.definition.headerSortTristate},e.definition.headerSort!==!1){switch(n=e.getElement(),n.classList.add("tabulator-sortable"),r=document.createElement("div"),r.classList.add("tabulator-col-sorter"),this.table.options.headerSortClickElement){case"icon":r.classList.add("tabulator-col-sorter-element");break;case"header":n.classList.add("tabulator-col-sorter-element");break;default:n.classList.add("tabulator-col-sorter-element");break}switch(this.table.options.headerSortElement){case"function":break;case"object":r.appendChild(this.table.options.headerSortElement);break;default:r.innerHTML=this.table.options.headerSortElement}e.titleHolderElement.appendChild(r),e.modules.sort.element=r,this.setColumnHeaderSortIcon(e,"none"),this.table.options.headerSortClickElement==="icon"&&r.addEventListener("mousedown",a=>{a.stopPropagation()}),(this.table.options.headerSortClickElement==="icon"?r:n).addEventListener("click",a=>{var o="",s=[],l=!1;if(e.modules.sort){if(e.modules.sort.tristate)e.modules.sort.dir=="none"?o=e.modules.sort.startingDir:e.modules.sort.dir==e.modules.sort.startingDir?o=e.modules.sort.dir=="asc"?"desc":"asc":o="none";else switch(e.modules.sort.dir){case"asc":o="desc";break;case"desc":o="asc";break;default:o=e.modules.sort.startingDir}this.table.options.columnHeaderSortMulti&&(a.shiftKey||a.ctrlKey)?(s=this.getSort(),l=s.findIndex(c=>c.field===e.getField()),l>-1?(s[l].dir=o,l=s.splice(l,1)[0],o!="none"&&s.push(l)):o!="none"&&s.push({column:e,dir:o}),this.setSort(s)):o=="none"?this.clear():this.setSort(e,o),this.refreshSort()}})}}refreshSort(){this.table.options.sortMode==="remote"?this.reloadData(null,!1,!1):this.refreshData(!0)}hasChanged(){var e=this.changed;return this.changed=!1,e}getSort(){var e=this,i=[];return e.sortList.forEach(function(n){n.column&&i.push({column:n.column.getComponent(),field:n.column.getField(),dir:n.dir})}),i}setSort(e,i){var n=this,r=[];Array.isArray(e)||(e=[{column:e,dir:i}]),e.forEach(function(a){var o;o=n.table.columnManager.findColumn(a.column),o?(a.column=o,r.push(a),n.changed=!0):console.warn("Sort Warning - Sort field does not exist and is being ignored: ",a.column)}),n.sortList=r,this.dispatch("sort-changed")}clear(){this.setSort([])}findSorter(e){var i=this.table.rowManager.activeRows[0],n="string",r,a;if(i&&(i=i.getData(),r=e.getField(),r))switch(a=e.getFieldValue(i),typeof a){case"undefined":n="string";break;case"boolean":n="boolean";break;default:!isNaN(a)&&a!==""?n="number":a.match(/((^[0-9]+[a-z]+)|(^[a-z]+[0-9]+))+$/i)&&(n="alphanum");break}return mb.sorters[n]}sort(e,i){var n=this,r=this.table.options.sortOrderReverse?n.sortList.slice().reverse():n.sortList,a=[],o=[];return this.subscribedExternal("dataSorting")&&this.dispatchExternal("dataSorting",n.getSort()),i||n.clearColumnHeaders(),this.table.options.sortMode!=="remote"?(r.forEach(function(s,l){var c;s.column&&(c=s.column.modules.sort,c&&(c.sorter||(c.sorter=n.findSorter(s.column)),s.params=typeof c.params=="function"?c.params(s.column.getComponent(),s.dir):c.params,a.push(s)),i||n.setColumnHeader(s.column,s.dir))}),a.length&&n._sortItems(e,a)):i||r.forEach(function(s,l){n.setColumnHeader(s.column,s.dir)}),this.subscribedExternal("dataSorted")&&(e.forEach(s=>{o.push(s.getComponent())}),this.dispatchExternal("dataSorted",n.getSort(),o)),e}clearColumnHeaders(){this.table.columnManager.getRealColumns().forEach(e=>{e.modules.sort&&(e.modules.sort.dir="none",e.getElement().setAttribute("aria-sort","none"),this.setColumnHeaderSortIcon(e,"none"))})}setColumnHeader(e,i){e.modules.sort.dir=i,e.getElement().setAttribute("aria-sort",i==="asc"?"ascending":"descending"),this.setColumnHeaderSortIcon(e,i)}setColumnHeaderSortIcon(e,i){var n=e.modules.sort.element,r;if(e.definition.headerSort&&typeof this.table.options.headerSortElement=="function"){for(;n.firstChild;)n.removeChild(n.firstChild);r=this.table.options.headerSortElement.call(this.table,e.getComponent(),i),typeof r=="object"?n.appendChild(r):n.innerHTML=r}}_sortItems(e,i){var n=i.length-1;e.sort((r,a)=>{for(var o,s=n;s>=0;s--){let l=i[s];if(o=this._sortRow(r,a,l.column,l.dir,l.params),o!==0)break}return o})}_sortRow(e,i,n,r,a){var o,s,l=r=="asc"?e:i,c=r=="asc"?i:e;return e=n.getFieldValue(l.getData()),i=n.getFieldValue(c.getData()),e=typeof e<"u"?e:"",i=typeof i<"u"?i:"",o=l.getComponent(),s=c.getComponent(),n.modules.sort.sorter.call(this,e,i,o,s,n.getComponent(),r,a)}};Je(mb,"moduleName","sort"),Je(mb,"sorters",dZe);let uG=mb;class pZe{constructor(e,i){this.columnCount=e,this.rowCount=i,this.columnString=[],this.columns=[],this.rows=[]}genColumns(e){var i=Math.max(this.columnCount,Math.max(...e.map(n=>n.length)));this.columnString=[],this.columns=[];for(let n=1;n<=i;n++)this.incrementChar(this.columnString.length-1),this.columns.push(this.columnString.join(""));return this.columns}genRows(e){var i=Math.max(this.rowCount,e.length);this.rows=[];for(let n=1;n<=i;n++)this.rows.push(n);return this.rows}incrementChar(e){let i=this.columnString[e];i?i!=="Z"?this.columnString[e]=String.fromCharCode(this.columnString[e].charCodeAt(0)+1):(this.columnString[e]="A",e?this.incrementChar(e-1):this.columnString.push("A")):this.columnString.push("A")}setRowCount(e){this.rowCount=e}setColumnCount(e){this.columnCount=e}}class JTe{constructor(e){return this._sheet=e,new Proxy(this,{get:function(i,n,r){return typeof i[n]<"u"?i[n]:i._sheet.table.componentFunctionBinder.handle("sheet",i._sheet,n)}})}getTitle(){return this._sheet.title}getKey(){return this._sheet.key}getDefinition(){return this._sheet.getDefinition()}getData(){return this._sheet.getData()}setData(e){return this._sheet.setData(e)}clear(){return this._sheet.clear()}remove(){return this._sheet.remove()}active(){return this._sheet.active()}setTitle(e){return this._sheet.setTitle(e)}setRows(e){return this._sheet.setRows(e)}setColumns(e){return this._sheet.setColumns(e)}}class YX extends dc{constructor(e,i){super(e.table),this.spreadsheetManager=e,this.definition=i,this.title=this.definition.title||"",this.key=this.definition.key||this.definition.title,this.rowCount=this.definition.rows,this.columnCount=this.definition.columns,this.data=this.definition.data||[],this.element=null,this.isActive=!1,this.grid=new pZe(this.columnCount,this.rowCount),this.defaultColumnDefinition={width:100,headerHozAlign:"center",headerSort:!1},this.columnDefinition=Object.assign(this.defaultColumnDefinition,this.options("spreadsheetColumnDefinition")),this.columnDefs=[],this.rowDefs=[],this.columnFields=[],this.columns=[],this.rows=[],this.scrollTop=null,this.scrollLeft=null,this.initialize(),this.dispatchExternal("sheetAdded",this.getComponent())}initialize(){this.initializeElement(),this.initializeColumns(),this.initializeRows()}reinitialize(){this.initializeColumns(),this.initializeRows()}initializeElement(){this.element=document.createElement("div"),this.element.classList.add("tabulator-spreadsheet-tab"),this.element.innerText=this.title,this.element.addEventListener("click",()=>{this.spreadsheetManager.loadSheet(this)})}initializeColumns(){this.grid.setColumnCount(this.columnCount),this.columnFields=this.grid.genColumns(this.data),this.columnDefs=[],this.columnFields.forEach(e=>{var i=Object.assign({},this.columnDefinition);i.field=e,i.title=e,this.columnDefs.push(i)})}initializeRows(){var e;this.grid.setRowCount(this.rowCount),e=this.grid.genRows(this.data),this.rowDefs=[],e.forEach((i,n)=>{var r={_id:i},a=this.data[n];a&&a.forEach((o,s)=>{var l=this.columnFields[s];l&&(r[l]=o)}),this.rowDefs.push(r)})}unload(){this.isActive=!1,this.scrollTop=this.table.rowManager.scrollTop,this.scrollLeft=this.table.rowManager.scrollLeft,this.data=this.getData(!0),this.element.classList.remove("tabulator-spreadsheet-tab-active")}load(){var e=!this.isActive;this.isActive=!0,this.table.blockRedraw(),this.table.setData([]),this.table.setColumns(this.columnDefs),this.table.setData(this.rowDefs),this.table.restoreRedraw(),e&&this.scrollTop!==null&&(this.table.rowManager.element.scrollLeft=this.scrollLeft,this.table.rowManager.element.scrollTop=this.scrollTop),this.element.classList.add("tabulator-spreadsheet-tab-active"),this.dispatchExternal("sheetLoaded",this.getComponent())}getComponent(){return new JTe(this)}getDefinition(){return{title:this.title,key:this.key,rows:this.rowCount,columns:this.columnCount,data:this.getData()}}getData(e){var i=[],n,r,a;return this.rowDefs.forEach(o=>{var s=[];this.columnFields.forEach(l=>{s.push(o[l])}),i.push(s)}),!e&&!this.options("spreadsheetOutputFull")&&(n=i.map(o=>o.findLastIndex(s=>typeof s<"u")+1),r=Math.max(...n),a=n.findLastIndex(o=>o>0)+1,i=i.slice(0,a),i=i.map(o=>o.slice(0,r))),i}setData(e){this.data=e,this.reinitialize(),this.dispatchExternal("sheetUpdated",this.getComponent()),this.isActive&&this.load()}clear(){this.setData([])}setTitle(e){this.title=e,this.element.innerText=e,this.dispatchExternal("sheetUpdated",this.getComponent())}setRows(e){this.rowCount=e,this.initializeRows(),this.dispatchExternal("sheetUpdated",this.getComponent()),this.isActive&&this.load()}setColumns(e){this.columnCount=e,this.reinitialize(),this.dispatchExternal("sheetUpdated",this.getComponent()),this.isActive&&this.load()}remove(){this.spreadsheetManager.removeSheet(this)}destroy(){this.element.parentNode&&this.element.parentNode.removeChild(this.element),this.dispatchExternal("sheetRemoved",this.getComponent())}active(){this.spreadsheetManager.loadSheet(this)}}class QTe extends Wn{constructor(e){super(e),this.sheets=[],this.element=null,this.registerTableOption("spreadsheet",!1),this.registerTableOption("spreadsheetRows",50),this.registerTableOption("spreadsheetColumns",50),this.registerTableOption("spreadsheetColumnDefinition",{}),this.registerTableOption("spreadsheetOutputFull",!1),this.registerTableOption("spreadsheetData",!1),this.registerTableOption("spreadsheetSheets",!1),this.registerTableOption("spreadsheetSheetTabs",!1),this.registerTableOption("spreadsheetSheetTabsElement",!1),this.registerTableFunction("setSheets",this.setSheets.bind(this)),this.registerTableFunction("addSheet",this.addSheet.bind(this)),this.registerTableFunction("getSheets",this.getSheets.bind(this)),this.registerTableFunction("getSheetDefinitions",this.getSheetDefinitions.bind(this)),this.registerTableFunction("setSheetData",this.setSheetData.bind(this)),this.registerTableFunction("getSheet",this.getSheet.bind(this)),this.registerTableFunction("getSheetData",this.getSheetData.bind(this)),this.registerTableFunction("clearSheet",this.clearSheet.bind(this)),this.registerTableFunction("removeSheet",this.removeSheetFunc.bind(this)),this.registerTableFunction("activeSheet",this.activeSheetFunc.bind(this))}initialize(){this.options("spreadsheet")&&(this.subscribe("table-initialized",this.tableInitialized.bind(this)),this.subscribe("data-loaded",this.loadRemoteData.bind(this)),this.table.options.index="_id",this.options("spreadsheetData")&&this.options("spreadsheetSheets")&&(console.warn("You cannot use spreadsheetData and spreadsheetSheets at the same time, ignoring spreadsheetData"),this.table.options.spreadsheetData=!1),this.compatibilityCheck(),this.options("spreadsheetSheetTabs")&&this.initializeTabset())}compatibilityCheck(){this.options("data")&&console.warn("Do not use the data option when working with spreadsheets, use either spreadsheetData or spreadsheetSheets to pass data into the table"),this.options("pagination")&&console.warn("The spreadsheet module is not compatible with the pagination module"),this.options("groupBy")&&console.warn("The spreadsheet module is not compatible with the row grouping module"),this.options("responsiveCollapse")&&console.warn("The spreadsheet module is not compatible with the responsive collapse module")}initializeTabset(){this.element=document.createElement("div"),this.element.classList.add("tabulator-spreadsheet-tabs");var e=this.options("spreadsheetSheetTabsElement");e&&!(e instanceof HTMLElement)&&(e=document.querySelector(e),e||console.warn("Unable to find element matching spreadsheetSheetTabsElement selector:",this.options("spreadsheetSheetTabsElement"))),e?e.appendChild(this.element):this.footerAppend(this.element)}tableInitialized(){this.sheets.length?this.loadSheet(this.sheets[0]):this.options("spreadsheetSheets")?this.loadSheets(this.options("spreadsheetSheets")):this.options("spreadsheetData")&&this.loadData(this.options("spreadsheetData"))}loadRemoteData(e,i,n){return console.log("data",e,i,n),Array.isArray(e)?(this.table.dataLoader.clearAlert(),this.dispatchExternal("dataLoaded",e),!e.length||Array.isArray(e[0])?this.loadData(e):this.loadSheets(e)):console.error(`Spreadsheet Loading Error - Unable to process remote data due to invalid data type 
Expecting: array 
Received: `,typeof e,`
Data:     `,e),!1}loadData(e){var i={data:e};this.loadSheet(this.newSheet(i))}destroySheets(){this.sheets.forEach(e=>{e.destroy()}),this.sheets=[],this.activeSheet=null}loadSheets(e){Array.isArray(e)||(e=[]),this.destroySheets(),e.forEach(i=>{this.newSheet(i)}),this.loadSheet(this.sheets[0])}loadSheet(e){this.activeSheet!==e&&(this.activeSheet&&this.activeSheet.unload(),this.activeSheet=e,e.load())}newSheet(e={}){var i;return e.rows||(e.rows=this.options("spreadsheetRows")),e.columns||(e.columns=this.options("spreadsheetColumns")),i=new YX(this,e),this.sheets.push(i),this.element&&this.element.appendChild(i.element),i}removeSheet(e){var i=this.sheets.indexOf(e),n;this.sheets.length>1?i>-1&&(this.sheets.splice(i,1),e.destroy(),this.activeSheet===e&&(n=this.sheets[i-1]||this.sheets[0],n?this.loadSheet(n):this.activeSheet=null)):console.warn("Unable to remove sheet, at least one sheet must be active")}lookupSheet(e){return e?e instanceof YX?e:e instanceof JTe?e._sheet:this.sheets.find(i=>i.key===e)||!1:this.activeSheet}setSheets(e){return this.loadSheets(e),this.getSheets()}addSheet(e){return this.newSheet(e).getComponent()}getSheetDefinitions(){return this.sheets.map(e=>e.getDefinition())}getSheets(){return this.sheets.map(e=>e.getComponent())}getSheet(e){var i=this.lookupSheet(e);return i?i.getComponent():!1}setSheetData(e,i){e&&!i&&(i=e,e=!1);var n=this.lookupSheet(e);return n?n.setData(i):!1}getSheetData(e){var i=this.lookupSheet(e);return i?i.getData():!1}clearSheet(e){var i=this.lookupSheet(e);return i?i.clear():!1}removeSheetFunc(e){var i=this.lookupSheet(e);i&&this.removeSheet(i)}activeSheetFunc(e){var i=this.lookupSheet(e);return i?this.loadSheet(i):!1}}Je(QTe,"moduleName","spreadsheet");var C2;let hZe=(C2=class extends Wn{constructor(e){super(e),this.tooltipSubscriber=null,this.headerSubscriber=null,this.timeout=null,this.popupInstance=null,this.registerTableOption("tooltipDelay",300),this.registerColumnOption("tooltip"),this.registerColumnOption("headerTooltip")}initialize(){this.deprecatedOptionsCheck(),this.subscribe("column-init",this.initializeColumn.bind(this))}deprecatedOptionsCheck(){}initializeColumn(e){e.definition.headerTooltip&&!this.headerSubscriber&&(this.headerSubscriber=!0,this.subscribe("column-mousemove",this.mousemoveCheck.bind(this,"headerTooltip")),this.subscribe("column-mouseout",this.mouseoutCheck.bind(this,"headerTooltip"))),e.definition.tooltip&&!this.tooltipSubscriber&&(this.tooltipSubscriber=!0,this.subscribe("cell-mousemove",this.mousemoveCheck.bind(this,"tooltip")),this.subscribe("cell-mouseout",this.mouseoutCheck.bind(this,"tooltip")))}mousemoveCheck(e,i,n){var r=e==="tooltip"?n.column.definition.tooltip:n.definition.headerTooltip;r&&(this.clearPopup(),this.timeout=setTimeout(this.loadTooltip.bind(this,i,n,r),this.table.options.tooltipDelay))}mouseoutCheck(e,i,n){this.popupInstance||this.clearPopup()}clearPopup(e,i,n){clearTimeout(this.timeout),this.timeout=null,this.popupInstance&&this.popupInstance.hide()}loadTooltip(e,i,n){var r,a,o;function s(l){a=l}typeof n=="function"&&(n=n(e,i.getComponent(),s)),n instanceof HTMLElement?r=n:(r=document.createElement("div"),n===!0&&(i instanceof ZR?n=i.value:i.definition.field?this.langBind("columns|"+i.definition.field,l=>{r.innerHTML=n=l||i.definition.title}):n=i.definition.title),r.innerHTML=n),(n||n===0||n===!1)&&(r.classList.add("tabulator-tooltip"),r.addEventListener("mousemove",l=>l.preventDefault()),this.popupInstance=this.popup(r),typeof a=="function"&&this.popupInstance.renderCallback(a),o=this.popupInstance.containerEventCoords(e),this.popupInstance.show(o.x+15,o.y+15).hideOnBlur(()=>{this.dispatchExternal("TooltipClosed",i.getComponent()),this.popupInstance=null}),this.dispatchExternal("TooltipOpened",i.getComponent()))}},Je(C2,"moduleName","tooltip"),C2);var fZe={integer:function(t,e,i){return e===""||e===null||typeof e>"u"?!0:(e=Number(e),!isNaN(e)&&isFinite(e)&&Math.floor(e)===e)},float:function(t,e,i){return e===""||e===null||typeof e>"u"?!0:(e=Number(e),!isNaN(e)&&isFinite(e)&&e%1!==0)},numeric:function(t,e,i){return e===""||e===null||typeof e>"u"?!0:!isNaN(e)},string:function(t,e,i){return e===""||e===null||typeof e>"u"?!0:isNaN(e)},alphanumeric:function(t,e,i){if(e===""||e===null||typeof e>"u")return!0;var n=new RegExp(/^[a-z0-9]+$/i);return n.test(e)},max:function(t,e,i){return e===""||e===null||typeof e>"u"?!0:parseFloat(e)<=i},min:function(t,e,i){return e===""||e===null||typeof e>"u"?!0:parseFloat(e)>=i},starts:function(t,e,i){return e===""||e===null||typeof e>"u"?!0:String(e).toLowerCase().startsWith(String(i).toLowerCase())},ends:function(t,e,i){return e===""||e===null||typeof e>"u"?!0:String(e).toLowerCase().endsWith(String(i).toLowerCase())},minLength:function(t,e,i){return e===""||e===null||typeof e>"u"?!0:String(e).length>=i},maxLength:function(t,e,i){return e===""||e===null||typeof e>"u"?!0:String(e).length<=i},in:function(t,e,i){return e===""||e===null||typeof e>"u"?!0:(typeof i=="string"&&(i=i.split("|")),i.indexOf(e)>-1)},regex:function(t,e,i){if(e===""||e===null||typeof e>"u")return!0;var n=new RegExp(i);return n.test(e)},unique:function(t,e,i){if(e===""||e===null||typeof e>"u")return!0;var n=!0,r=t.getData(),a=t.getColumn()._getSelf();return this.table.rowManager.rows.forEach(function(o){var s=o.getData();s!==r&&e==a.getFieldValue(s)&&(n=!1)}),n},required:function(t,e,i){return e!==""&&e!==null&&typeof e<"u"}};const mD=class mD extends Wn{constructor(e){super(e),this.invalidCells=[],this.registerTableOption("validationMode","blocking"),this.registerColumnOption("validator"),this.registerTableFunction("getInvalidCells",this.getInvalidCells.bind(this)),this.registerTableFunction("clearCellValidation",this.userClearCellValidation.bind(this)),this.registerTableFunction("validate",this.userValidate.bind(this)),this.registerComponentFunction("cell","isValid",this.cellIsValid.bind(this)),this.registerComponentFunction("cell","clearValidation",this.clearValidation.bind(this)),this.registerComponentFunction("cell","validate",this.cellValidate.bind(this)),this.registerComponentFunction("column","validate",this.columnValidate.bind(this)),this.registerComponentFunction("row","validate",this.rowValidate.bind(this))}initialize(){this.subscribe("cell-delete",this.clearValidation.bind(this)),this.subscribe("column-layout",this.initializeColumnCheck.bind(this)),this.subscribe("edit-success",this.editValidate.bind(this)),this.subscribe("edit-editor-clear",this.editorClear.bind(this)),this.subscribe("edit-edited-clear",this.editedClear.bind(this))}editValidate(e,i,n){var r=this.table.options.validationMode!=="manual"?this.validate(e.column.modules.validate,e,i):!0;return r!==!0&&setTimeout(()=>{e.getElement().classList.add("tabulator-validation-fail"),this.dispatchExternal("validationFailed",e.getComponent(),i,r)}),r}editorClear(e,i){i&&e.column.modules.validate&&this.cellValidate(e),e.getElement().classList.remove("tabulator-validation-fail")}editedClear(e){e.modules.validate&&(e.modules.validate.invalid=!1)}cellIsValid(e){return e.modules.validate&&e.modules.validate.invalid||!0}cellValidate(e){return this.validate(e.column.modules.validate,e,e.getValue())}columnValidate(e){var i=[];return e.cells.forEach(n=>{this.cellValidate(n)!==!0&&i.push(n.getComponent())}),i.length?i:!0}rowValidate(e){var i=[];return e.cells.forEach(n=>{this.cellValidate(n)!==!0&&i.push(n.getComponent())}),i.length?i:!0}userClearCellValidation(e){e||(e=this.getInvalidCells()),Array.isArray(e)||(e=[e]),e.forEach(i=>{this.clearValidation(i._getSelf())})}userValidate(e){var i=[];return this.table.rowManager.rows.forEach(n=>{n=n.getComponent();var r=n.validate();r!==!0&&(i=i.concat(r))}),i.length?i:!0}initializeColumnCheck(e){typeof e.definition.validator<"u"&&this.initializeColumn(e)}initializeColumn(e){var i=this,n=[],r;e.definition.validator&&(Array.isArray(e.definition.validator)?e.definition.validator.forEach(a=>{r=i._extractValidator(a),r&&n.push(r)}):(r=this._extractValidator(e.definition.validator),r&&n.push(r)),e.modules.validate=n.length?n:!1)}_extractValidator(e){var i,n,r;switch(typeof e){case"string":return r=e.indexOf(":"),r>-1?(i=e.substring(0,r),n=e.substring(r+1)):i=e,this._buildValidator(i,n);case"function":return this._buildValidator(e);case"object":return this._buildValidator(e.type,e.parameters)}}_buildValidator(e,i){var n=typeof e=="function"?e:mD.validators[e];return n?{type:typeof e=="function"?"function":e,func:n,params:i}:(console.warn("Validator Setup Error - No matching validator found:",e),!1)}validate(e,i,n){var r=this,a=[],o=this.invalidCells.indexOf(i);return e&&e.forEach(s=>{s.func.call(r,i.getComponent(),n,s.params)||a.push({type:s.type,parameters:s.params})}),i.modules.validate||(i.modules.validate={}),a.length?(i.modules.validate.invalid=a,this.table.options.validationMode!=="manual"&&i.getElement().classList.add("tabulator-validation-fail"),o==-1&&this.invalidCells.push(i)):(i.modules.validate.invalid=!1,i.getElement().classList.remove("tabulator-validation-fail"),o>-1&&this.invalidCells.splice(o,1)),a.length?a:!0}getInvalidCells(){var e=[];return this.invalidCells.forEach(i=>{e.push(i.getComponent())}),e}clearValidation(e){var i;e.modules.validate&&e.modules.validate.invalid&&(e.getElement().classList.remove("tabulator-validation-fail"),e.modules.validate.invalid=!1,i=this.invalidCells.indexOf(e),i>-1&&this.invalidCells.splice(i,1))}};Je(mD,"moduleName","validate"),Je(mD,"validators",fZe);let dG=mD;var U$=Object.freeze({__proto__:null,AccessorModule:qj,AjaxModule:Yj,ClipboardModule:RKe,ColumnCalcsModule:Zj,DataTreeModule:BTe,DownloadModule:Xj,EditModule:Jj,ExportModule:Qj,FilterModule:eG,FormatModule:tG,FrozenColumnsModule:$Te,FrozenRowsModule:VTe,GroupRowsModule:jTe,HistoryModule:CYe,HtmlTableImportModule:GTe,ImportModule:iG,InteractionModule:HTe,KeybindingsModule:nG,MenuModule:zTe,MoveColumnsModule:qTe,MoveRowsModule:rG,MutatorModule:aG,PageModule:oG,PersistenceModule:sG,PopupModule:GYe,PrintModule:WTe,ReactiveDataModule:KTe,ResizeColumnsModule:YTe,ResizeRowsModule:ZTe,ResizeTableModule:XTe,ResponsiveLayoutModule:lG,SelectRangeModule:ZN,SelectRowModule:cG,SortModule:uG,SpreadsheetModule:QTe,TooltipModule:hZe,ValidateModule:dG}),mZe={debugEventsExternal:!1,debugEventsInternal:!1,debugInvalidOptions:!0,debugInvalidComponentFuncs:!0,debugInitialization:!0,debugDeprecation:!0,height:!1,minHeight:!1,maxHeight:!1,columnHeaderVertAlign:"top",popupContainer:!1,columns:[],columnDefaults:{},rowHeader:!1,data:!1,autoColumns:!1,autoColumnsDefinitions:!1,nestedFieldSeparator:".",footerElement:!1,index:"id",textDirection:"auto",addRowPos:"bottom",headerVisible:!0,renderVertical:"virtual",renderHorizontal:"basic",renderVerticalBuffer:0,scrollToRowPosition:"top",scrollToRowIfVisible:!0,scrollToColumnPosition:"left",scrollToColumnIfVisible:!0,rowFormatter:!1,rowFormatterPrint:null,rowFormatterClipboard:null,rowFormatterHtmlOutput:null,rowHeight:null,placeholder:!1,dataLoader:!0,dataLoaderLoading:!1,dataLoaderError:!1,dataLoaderErrorTimeout:3e3,dataSendParams:{},dataReceiveParams:{}};class eUe{constructor(e,i,n={}){this.table=e,this.msgType=i,this.registeredDefaults=Object.assign({},n)}register(e,i){this.registeredDefaults[e]=i}generate(e,i={}){var n=Object.assign({},this.registeredDefaults),r=this.table.options.debugInvalidOptions||i.debugInvalidOptions===!0;Object.assign(n,e);for(let a in i)n.hasOwnProperty(a)||(r&&console.warn("Invalid "+this.msgType+" option:",a),n[a]=i.key);for(let a in n)a in i?n[a]=i[a]:Array.isArray(n[a])?n[a]=Object.assign([],n[a]):typeof n[a]=="object"&&n[a]!==null?n[a]=Object.assign({},n[a]):typeof n[a]>"u"&&delete n[a];return n}}class HF extends dc{constructor(e){super(e),this.elementVertical=e.rowManager.element,this.elementHorizontal=e.columnManager.element,this.tableElement=e.rowManager.tableElement,this.verticalFillMode="fit"}initialize(){}clearRows(){}clearColumns(){}reinitializeColumnWidths(e){}renderRows(){}renderColumns(){}rerenderRows(e){e&&e()}rerenderColumns(e,i){}renderRowCells(e){}rerenderRowCells(e,i){}scrollColumns(e,i){}scrollRows(e,i){}resize(){}scrollToRow(e){}scrollToRowNearestTop(e){}visibleRows(e){return[]}rows(){return this.table.rowManager.getDisplayRows()}styleRow(e,i){var n=e.getElement();i%2?(n.classList.add("tabulator-row-even"),n.classList.remove("tabulator-row-odd")):(n.classList.add("tabulator-row-odd"),n.classList.remove("tabulator-row-even"))}clear(){this.clearRows(),this.clearColumns()}render(){this.renderRows(),this.renderColumns()}rerender(e){this.rerenderRows(),this.rerenderColumns()}scrollToRowPosition(e,i,n){var r=this.rows().indexOf(e),a=e.getElement(),o=0;return new Promise((s,l)=>{if(r>-1){if(typeof n>"u"&&(n=this.table.options.scrollToRowIfVisible),!n&&io.elVisible(a)&&(o=io.elOffset(a).top-io.elOffset(this.elementVertical).top,o>0&&o<this.elementVertical.clientHeight-a.offsetHeight))return s(),!1;switch(typeof i>"u"&&(i=this.table.options.scrollToRowPosition),i==="nearest"&&(i=this.scrollToRowNearestTop(e)?"top":"bottom"),this.scrollToRow(e),i){case"middle":case"center":this.elementVertical.scrollHeight-this.elementVertical.scrollTop==this.elementVertical.clientHeight?this.elementVertical.scrollTop=this.elementVertical.scrollTop+(a.offsetTop-this.elementVertical.scrollTop)-(this.elementVertical.scrollHeight-a.offsetTop)/2:this.elementVertical.scrollTop=this.elementVertical.scrollTop-this.elementVertical.clientHeight/2;break;case"bottom":this.elementVertical.scrollHeight-this.elementVertical.scrollTop==this.elementVertical.clientHeight?this.elementVertical.scrollTop=this.elementVertical.scrollTop-(this.elementVertical.scrollHeight-a.offsetTop)+a.offsetHeight:this.elementVertical.scrollTop=this.elementVertical.scrollTop-this.elementVertical.clientHeight+a.offsetHeight;break;case"top":this.elementVertical.scrollTop=a.offsetTop;break}s()}else console.warn("Scroll Error - Row not visible"),l("Scroll Error - Row not visible")})}}class gZe extends HF{constructor(e){super(e)}renderRowCells(e,i){const n=document.createDocumentFragment();e.cells.forEach(r=>{n.appendChild(r.getElement())}),e.element.appendChild(n),i||e.cells.forEach(r=>{r.cellRendered()})}reinitializeColumnWidths(e){e.forEach(function(i){i.reinitializeWidth()})}}class vZe extends HF{constructor(e){super(e),this.leftCol=0,this.rightCol=0,this.scrollLeft=0,this.vDomScrollPosLeft=0,this.vDomScrollPosRight=0,this.vDomPadLeft=0,this.vDomPadRight=0,this.fitDataColAvg=0,this.windowBuffer=200,this.visibleRows=null,this.initialized=!1,this.isFitData=!1,this.columns=[]}initialize(){this.compatibilityCheck(),this.layoutCheck(),this.vertScrollListen()}compatibilityCheck(){this.options("layout")=="fitDataTable"&&console.warn("Horizontal Virtual DOM is not compatible with fitDataTable layout mode"),this.options("responsiveLayout")&&console.warn("Horizontal Virtual DOM is not compatible with responsive columns"),this.options("rtl")&&console.warn("Horizontal Virtual DOM is not currently compatible with RTL text direction")}layoutCheck(){this.isFitData=this.options("layout").startsWith("fitData")}vertScrollListen(){this.subscribe("scroll-vertical",this.clearVisRowCache.bind(this)),this.subscribe("data-refreshed",this.clearVisRowCache.bind(this))}clearVisRowCache(){this.visibleRows=null}renderColumns(e,i){this.dataChange()}scrollColumns(e,i){this.scrollLeft!=e&&(this.scrollLeft=e,this.scroll(e-(this.vDomScrollPosLeft+this.windowBuffer)))}calcWindowBuffer(){var e=this.elementVertical.clientWidth;this.table.columnManager.columnsByIndex.forEach(i=>{if(i.visible){var n=i.getWidth();n>e&&(e=n)}}),this.windowBuffer=e*2}rerenderColumns(e,i){var n={cols:this.columns,leftCol:this.leftCol,rightCol:this.rightCol},r=0;e&&!this.initialized||(this.clear(),this.calcWindowBuffer(),this.scrollLeft=this.elementVertical.scrollLeft,this.vDomScrollPosLeft=this.scrollLeft-this.windowBuffer,this.vDomScrollPosRight=this.scrollLeft+this.elementVertical.clientWidth+this.windowBuffer,this.table.columnManager.columnsByIndex.forEach(a=>{var o={},s;a.visible&&(a.modules.frozen||(s=a.getWidth(),o.leftPos=r,o.rightPos=r+s,o.width=s,this.isFitData&&(o.fitDataCheck=a.modules.vdomHoz?a.modules.vdomHoz.fitDataCheck:!0),r+s>this.vDomScrollPosLeft&&r<this.vDomScrollPosRight?(this.leftCol==-1&&(this.leftCol=this.columns.length,this.vDomPadLeft=r),this.rightCol=this.columns.length):this.leftCol!==-1&&(this.vDomPadRight+=s),this.columns.push(a),a.modules.vdomHoz=o,r+=s))}),this.tableElement.style.paddingLeft=this.vDomPadLeft+"px",this.tableElement.style.paddingRight=this.vDomPadRight+"px",this.initialized=!0,i||(!e||this.reinitChanged(n))&&this.reinitializeRows(),this.elementVertical.scrollLeft=this.scrollLeft)}renderRowCells(e){if(this.initialized)this.initializeRow(e);else{const i=document.createDocumentFragment();e.cells.forEach(n=>{i.appendChild(n.getElement())}),e.element.appendChild(i),e.cells.forEach(n=>{n.cellRendered()})}}rerenderRowCells(e,i){this.reinitializeRow(e,i)}reinitializeColumnWidths(e){for(let i=this.leftCol;i<=this.rightCol;i++)this.columns[i].reinitializeWidth()}deinitialize(){this.initialized=!1}clear(){this.columns=[],this.leftCol=-1,this.rightCol=0,this.vDomScrollPosLeft=0,this.vDomScrollPosRight=0,this.vDomPadLeft=0,this.vDomPadRight=0}dataChange(){var e=!1,i,n;if(this.isFitData){if(this.table.columnManager.columnsByIndex.forEach(r=>{!r.definition.width&&r.visible&&(e=!0)}),e&&this.table.rowManager.getDisplayRows().length&&(this.vDomScrollPosRight=this.scrollLeft+this.elementVertical.clientWidth+this.windowBuffer,i=this.chain("rows-sample",[1],[],()=>this.table.rowManager.getDisplayRows())[0],i)){n=i.getElement(),i.generateCells(),this.tableElement.appendChild(n);for(let r=0;r<i.cells.length;r++){let a=i.cells[r];n.appendChild(a.getElement()),a.column.reinitializeWidth()}n.parentNode.removeChild(n),this.rerenderColumns(!1,!0)}}else this.options("layout")==="fitColumns"&&(this.layoutRefresh(),this.rerenderColumns(!1,!0))}reinitChanged(e){var i=!0;return e.cols.length!==this.columns.length||e.leftCol!==this.leftCol||e.rightCol!==this.rightCol?!0:(e.cols.forEach((n,r)=>{n!==this.columns[r]&&(i=!1)}),!i)}reinitializeRows(){var e=this.getVisibleRows(),i=this.table.rowManager.getRows().filter(n=>!e.includes(n));e.forEach(n=>{this.reinitializeRow(n,!0)}),i.forEach(n=>{n.deinitialize()})}getVisibleRows(){return this.visibleRows||(this.visibleRows=this.table.rowManager.getVisibleRows()),this.visibleRows}scroll(e){this.vDomScrollPosLeft+=e,this.vDomScrollPosRight+=e,Math.abs(e)>this.windowBuffer/2?this.rerenderColumns():e>0?(this.addColRight(),this.removeColLeft()):(this.addColLeft(),this.removeColRight())}colPositionAdjust(e,i,n){for(let r=e;r<i;r++){let a=this.columns[r];a.modules.vdomHoz.leftPos+=n,a.modules.vdomHoz.rightPos+=n}}addColRight(){for(var e=!1,i=!0;i;){let n=this.columns[this.rightCol+1];n&&n.modules.vdomHoz.leftPos<=this.vDomScrollPosRight?(e=!0,this.getVisibleRows().forEach(r=>{if(r.type!=="group"){var a=r.getCell(n);r.getElement().insertBefore(a.getElement(),r.getCell(this.columns[this.rightCol]).getElement().nextSibling),a.cellRendered()}}),this.fitDataColActualWidthCheck(n),this.rightCol++,this.getVisibleRows().forEach(r=>{r.type!=="group"&&(r.modules.vdomHoz.rightCol=this.rightCol)}),this.rightCol>=this.columns.length-1?this.vDomPadRight=0:this.vDomPadRight-=n.getWidth()):i=!1}e&&(this.tableElement.style.paddingRight=this.vDomPadRight+"px")}addColLeft(){for(var e=!1,i=!0;i;){let n=this.columns[this.leftCol-1];if(n)if(n.modules.vdomHoz.rightPos>=this.vDomScrollPosLeft){e=!0,this.getVisibleRows().forEach(a=>{if(a.type!=="group"){var o=a.getCell(n);a.getElement().insertBefore(o.getElement(),a.getCell(this.columns[this.leftCol]).getElement()),o.cellRendered()}}),this.leftCol--,this.getVisibleRows().forEach(a=>{a.type!=="group"&&(a.modules.vdomHoz.leftCol=this.leftCol)}),this.leftCol<=0?this.vDomPadLeft=0:this.vDomPadLeft-=n.getWidth();let r=this.fitDataColActualWidthCheck(n);r&&(this.scrollLeft=this.elementVertical.scrollLeft=this.elementVertical.scrollLeft+r,this.vDomPadRight-=r)}else i=!1;else i=!1}e&&(this.tableElement.style.paddingLeft=this.vDomPadLeft+"px")}removeColRight(){for(var e=!1,i=!0;i;){let n=this.columns[this.rightCol];n&&n.modules.vdomHoz.leftPos>this.vDomScrollPosRight?(e=!0,this.getVisibleRows().forEach(r=>{if(r.type!=="group"){var a=r.getCell(n);try{r.getElement().removeChild(a.getElement())}catch(o){console.warn("Could not removeColRight",o.message)}}}),this.vDomPadRight+=n.getWidth(),this.rightCol--,this.getVisibleRows().forEach(r=>{r.type!=="group"&&(r.modules.vdomHoz.rightCol=this.rightCol)})):i=!1}e&&(this.tableElement.style.paddingRight=this.vDomPadRight+"px")}removeColLeft(){for(var e=!1,i=!0;i;){let n=this.columns[this.leftCol];n&&n.modules.vdomHoz.rightPos<this.vDomScrollPosLeft?(e=!0,this.getVisibleRows().forEach(r=>{if(r.type!=="group"){var a=r.getCell(n);try{r.getElement().removeChild(a.getElement())}catch(o){console.warn("Could not removeColLeft",o.message)}}}),this.vDomPadLeft+=n.getWidth(),this.leftCol++,this.getVisibleRows().forEach(r=>{r.type!=="group"&&(r.modules.vdomHoz.leftCol=this.leftCol)})):i=!1}e&&(this.tableElement.style.paddingLeft=this.vDomPadLeft+"px")}fitDataColActualWidthCheck(e){var i,n;return e.modules.vdomHoz.fitDataCheck&&(e.reinitializeWidth(),i=e.getWidth(),n=i-e.modules.vdomHoz.width,n&&(e.modules.vdomHoz.rightPos+=n,e.modules.vdomHoz.width=i,this.colPositionAdjust(this.columns.indexOf(e)+1,this.columns.length,n)),e.modules.vdomHoz.fitDataCheck=!1),n}initializeRow(e){if(e.type!=="group"){e.modules.vdomHoz={leftCol:this.leftCol,rightCol:this.rightCol},this.table.modules.frozenColumns&&this.table.modules.frozenColumns.leftColumns.forEach(i=>{this.appendCell(e,i)});for(let i=this.leftCol;i<=this.rightCol;i++)this.appendCell(e,this.columns[i]);this.table.modules.frozenColumns&&this.table.modules.frozenColumns.rightColumns.forEach(i=>{this.appendCell(e,i)})}}appendCell(e,i){if(i&&i.visible){let n=e.getCell(i);e.getElement().appendChild(n.getElement()),n.cellRendered()}}reinitializeRow(e,i){if(e.type!=="group"&&(i||!e.modules.vdomHoz||e.modules.vdomHoz.leftCol!==this.leftCol||e.modules.vdomHoz.rightCol!==this.rightCol)){for(var n=e.getElement();n.firstChild;)n.removeChild(n.firstChild);this.initializeRow(e)}}}class yZe extends dc{constructor(e){super(e),this.blockHozScrollEvent=!1,this.headersElement=null,this.contentsElement=null,this.rowHeader=null,this.element=null,this.columns=[],this.columnsByIndex=[],this.columnsByField={},this.scrollLeft=0,this.optionsList=new eUe(this.table,"column definition",FTe),this.redrawBlock=!1,this.redrawBlockUpdate=null,this.renderer=null}initialize(){this.initializeRenderer(),this.headersElement=this.createHeadersElement(),this.contentsElement=this.createHeaderContentsElement(),this.element=this.createHeaderElement(),this.contentsElement.insertBefore(this.headersElement,this.contentsElement.firstChild),this.element.insertBefore(this.contentsElement,this.element.firstChild),this.initializeScrollWheelWatcher(),this.subscribe("scroll-horizontal",this.scrollHorizontal.bind(this)),this.subscribe("scrollbar-vertical",this.padVerticalScrollbar.bind(this))}padVerticalScrollbar(e){this.table.rtl?this.headersElement.style.marginLeft=e+"px":this.headersElement.style.marginRight=e+"px"}initializeRenderer(){var e,i={virtual:vZe,basic:gZe};typeof this.table.options.renderHorizontal=="string"?e=i[this.table.options.renderHorizontal]:e=this.table.options.renderHorizontal,e?(this.renderer=new e(this.table,this.element,this.tableElement),this.renderer.initialize()):console.error("Unable to find matching renderer:",this.table.options.renderHorizontal)}createHeadersElement(){var e=document.createElement("div");return e.classList.add("tabulator-headers"),e.setAttribute("role","row"),e}createHeaderContentsElement(){var e=document.createElement("div");return e.classList.add("tabulator-header-contents"),e.setAttribute("role","rowgroup"),e}createHeaderElement(){var e=document.createElement("div");return e.classList.add("tabulator-header"),e.setAttribute("role","rowgroup"),this.table.options.headerVisible||e.classList.add("tabulator-header-hidden"),e}getElement(){return this.element}getContentsElement(){return this.contentsElement}getHeadersElement(){return this.headersElement}scrollHorizontal(e){this.contentsElement.scrollLeft=e,this.scrollLeft=e,this.renderer.scrollColumns(e)}initializeScrollWheelWatcher(){this.contentsElement.addEventListener("wheel",e=>{var i;e.deltaX&&(i=this.contentsElement.scrollLeft+e.deltaX,this.table.rowManager.scrollHorizontal(i),this.table.columnManager.scrollHorizontal(i))})}generateColumnsFromRowData(e){var i=[],n={},r=this.table.options.autoColumns==="full"?e:[e[0]],a=this.table.options.autoColumnsDefinitions;if(e&&e.length){if(r.forEach(o=>{Object.keys(o).forEach((s,l)=>{let c=o[s],u;n[s]?n[s]!==!0&&typeof c<"u"&&(n[s].sorter=this.calculateSorterFromValue(c),n[s]=!0):(u={field:s,title:s,sorter:this.calculateSorterFromValue(c)},i.splice(l,0,u),n[s]=typeof c>"u"?u:!0)})}),a)switch(typeof a){case"function":this.table.options.columns=a.call(this.table,i);break;case"object":Array.isArray(a)?i.forEach(o=>{var s=a.find(l=>l.field===o.field);s&&Object.assign(o,s)}):i.forEach(o=>{a[o.field]&&Object.assign(o,a[o.field])}),this.table.options.columns=i;break}else this.table.options.columns=i;this.setColumns(this.table.options.columns)}}calculateSorterFromValue(e){var i;switch(typeof e){case"undefined":i="string";break;case"boolean":i="boolean";break;case"number":i="number";break;case"object":Array.isArray(e)?i="array":i="string";break;default:!isNaN(e)&&e!==""?i="number":e.match(/((^[0-9]+[a-z]+)|(^[a-z]+[0-9]+))+$/i)?i="alphanum":i="string";break}return i}setColumns(e,i){for(;this.headersElement.firstChild;)this.headersElement.removeChild(this.headersElement.firstChild);this.columns=[],this.columnsByIndex=[],this.columnsByField={},this.dispatch("columns-loading"),this.dispatchExternal("columnsLoading"),this.table.options.rowHeader&&(this.rowHeader=new Gb(this.table.options.rowHeader===!0?{}:this.table.options.rowHeader,this,!0),this.columns.push(this.rowHeader),this.headersElement.appendChild(this.rowHeader.getElement()),this.rowHeader.columnRendered()),e.forEach((n,r)=>{this._addColumn(n)}),this._reIndexColumns(),this.dispatch("columns-loaded"),this.subscribedExternal("columnsLoaded")&&this.dispatchExternal("columnsLoaded",this.getComponents()),this.rerenderColumns(!1,!0),this.redraw(!0)}_addColumn(e,i,n){var r=new Gb(e,this),a=r.getElement(),o=n&&this.findColumnIndex(n);if(i&&this.rowHeader&&(!n||n===this.rowHeader)&&(i=!1,n=this.rowHeader,o=0),n&&o>-1){var s=n.getTopColumn(),l=this.columns.indexOf(s),c=s.getElement();i?(this.columns.splice(l,0,r),c.parentNode.insertBefore(a,c)):(this.columns.splice(l+1,0,r),c.parentNode.insertBefore(a,c.nextSibling))}else i?(this.columns.unshift(r),this.headersElement.insertBefore(r.getElement(),this.headersElement.firstChild)):(this.columns.push(r),this.headersElement.appendChild(r.getElement()));return r.columnRendered(),r}registerColumnField(e){e.definition.field&&(this.columnsByField[e.definition.field]=e)}registerColumnPosition(e){this.columnsByIndex.push(e)}_reIndexColumns(){this.columnsByIndex=[],this.columns.forEach(function(e){e.reRegisterPosition()})}verticalAlignHeaders(){var e=0;this.redrawBlock||(this.headersElement.style.height="",this.columns.forEach(i=>{i.clearVerticalAlign()}),this.columns.forEach(i=>{var n=i.getHeight();n>e&&(e=n)}),this.headersElement.style.height=e+"px",this.columns.forEach(i=>{i.verticalAlign(this.table.options.columnHeaderVertAlign,e)}),this.table.rowManager.adjustTableSize())}findColumn(e){var i;if(typeof e=="object"){if(e instanceof Gb)return e;if(e instanceof LTe)return e._getSelf()||!1;if(typeof HTMLElement<"u"&&e instanceof HTMLElement)return i=[],this.columns.forEach(r=>{i.push(r),i=i.concat(r.getColumns(!0))}),i.find(r=>r.element===e)||!1}else return this.columnsByField[e]||!1;return!1}getColumnByField(e){return this.columnsByField[e]}getColumnsByFieldRoot(e){var i=[];return Object.keys(this.columnsByField).forEach(n=>{var r=this.table.options.nestedFieldSeparator?n.split(this.table.options.nestedFieldSeparator)[0]:n;r===e&&i.push(this.columnsByField[n])}),i}getColumnByIndex(e){return this.columnsByIndex[e]}getFirstVisibleColumn(){var e=this.columnsByIndex.findIndex(i=>i.visible);return e>-1?this.columnsByIndex[e]:!1}getVisibleColumnsByIndex(){return this.columnsByIndex.filter(e=>e.visible)}getColumns(){return this.columns}findColumnIndex(e){return this.columnsByIndex.findIndex(i=>e===i)}getRealColumns(){return this.columnsByIndex}traverse(e){this.columnsByIndex.forEach((i,n)=>{e(i,n)})}getDefinitions(e){var i=[];return this.columnsByIndex.forEach(n=>{(!e||e&&n.visible)&&i.push(n.getDefinition())}),i}getDefinitionTree(){var e=[];return this.columns.forEach(i=>{e.push(i.getDefinition(!0))}),e}getComponents(e){var i=[],n=e?this.columns:this.columnsByIndex;return n.forEach(r=>{i.push(r.getComponent())}),i}getWidth(){var e=0;return this.columnsByIndex.forEach(i=>{i.visible&&(e+=i.getWidth())}),e}moveColumn(e,i,n){i.element.parentNode.insertBefore(e.element,i.element),n&&i.element.parentNode.insertBefore(i.element,e.element),this.moveColumnActual(e,i,n),this.verticalAlignHeaders(),this.table.rowManager.reinitialize()}moveColumnActual(e,i,n){e.parent.isGroup?this._moveColumnInArray(e.parent.columns,e,i,n):this._moveColumnInArray(this.columns,e,i,n),this._moveColumnInArray(this.columnsByIndex,e,i,n,!0),this.rerenderColumns(!0),this.dispatch("column-moved",e,i,n),this.subscribedExternal("columnMoved")&&this.dispatchExternal("columnMoved",e.getComponent(),this.table.columnManager.getComponents())}_moveColumnInArray(e,i,n,r,a){var o=e.indexOf(i),s,l=[];o>-1&&(e.splice(o,1),s=e.indexOf(n),s>-1?r&&(s=s+1):s=o,e.splice(s,0,i),a&&(l=this.chain("column-moving-rows",[i,n,r],null,[])||[],l=l.concat(this.table.rowManager.rows),l.forEach(function(c){if(c.cells.length){var u=c.cells.splice(o,1)[0];c.cells.splice(s,0,u)}})))}scrollToColumn(e,i,n){var r=0,a=e.getLeftOffset(),o=0,s=e.getElement();return new Promise((l,c)=>{if(typeof i>"u"&&(i=this.table.options.scrollToColumnPosition),typeof n>"u"&&(n=this.table.options.scrollToColumnIfVisible),e.visible){switch(i){case"middle":case"center":o=-this.element.clientWidth/2;break;case"right":o=s.clientWidth-this.headersElement.clientWidth;break}if(!n&&a>0&&a+s.offsetWidth<this.element.clientWidth)return!1;r=a+o,r=Math.max(Math.min(r,this.table.rowManager.element.scrollWidth-this.table.rowManager.element.clientWidth),0),this.table.rowManager.scrollHorizontal(r),this.scrollHorizontal(r),l()}else console.warn("Scroll Error - Column not visible"),c("Scroll Error - Column not visible")})}generateCells(e){var i=[];return this.columnsByIndex.forEach(n=>{i.push(n.generateCell(e))}),i}getFlexBaseWidth(){var e=this.table.element.clientWidth,i=0;return this.table.rowManager.element.scrollHeight>this.table.rowManager.element.clientHeight&&(e-=this.table.rowManager.element.offsetWidth-this.table.rowManager.element.clientWidth),this.columnsByIndex.forEach(function(n){var r,a,o;n.visible&&(r=n.definition.width||0,a=parseInt(n.minWidth),typeof r=="string"?r.indexOf("%")>-1?o=e/100*parseInt(r):o=parseInt(r):o=r,i+=o>a?o:a)}),i}addColumn(e,i,n){return new Promise((r,a)=>{var o=this._addColumn(e,i,n);this._reIndexColumns(),this.dispatch("column-add",e,i,n),this.layoutMode()!="fitColumns"&&o.reinitializeWidth(),this.redraw(!0),this.table.rowManager.reinitialize(),this.rerenderColumns(),r(o)})}deregisterColumn(e){var i=e.getField(),n;i&&delete this.columnsByField[i],n=this.columnsByIndex.indexOf(e),n>-1&&this.columnsByIndex.splice(n,1),n=this.columns.indexOf(e),n>-1&&this.columns.splice(n,1),this.verticalAlignHeaders(),this.redraw()}rerenderColumns(e,i){this.redrawBlock?(e===!1||e===!0&&this.redrawBlockUpdate===null)&&(this.redrawBlockUpdate=e):this.renderer.rerenderColumns(e,i)}blockRedraw(){this.redrawBlock=!0,this.redrawBlockUpdate=null}restoreRedraw(){this.redrawBlock=!1,this.verticalAlignHeaders(),this.renderer.rerenderColumns(this.redrawBlockUpdate)}redraw(e){io.elVisible(this.element)&&this.verticalAlignHeaders(),e&&(this.table.rowManager.resetScroll(),this.table.rowManager.reinitialize()),this.confirm("table-redrawing",e)||this.layoutRefresh(e),this.dispatch("table-redraw",e),this.table.footerManager.redraw()}}class bZe extends HF{constructor(e){super(e),this.verticalFillMode="fill",this.scrollTop=0,this.scrollLeft=0,this.scrollTop=0,this.scrollLeft=0}clearRows(){for(var e=this.tableElement;e.firstChild;)e.removeChild(e.firstChild);e.scrollTop=0,e.scrollLeft=0,e.style.minWidth="",e.style.minHeight="",e.style.display="",e.style.visibility=""}renderRows(){var e=this.tableElement,i=!0,n=document.createDocumentFragment(),r=this.rows();r.forEach((a,o)=>{this.styleRow(a,o),a.initialize(!1,!0),a.type!=="group"&&(i=!1),n.appendChild(a.getElement())}),e.appendChild(n),r.forEach(a=>{a.rendered(),a.heightInitialized||a.calcHeight(!0)}),r.forEach(a=>{a.heightInitialized||a.setCellHeight()}),i?e.style.minWidth=this.table.columnManager.getWidth()+"px":e.style.minWidth=""}rerenderRows(e){this.clearRows(),e&&e(),this.renderRows(),this.rows().length||this.table.rowManager.tableEmpty()}scrollToRowNearestTop(e){var i=io.elOffset(e.getElement()).top;return!(Math.abs(this.elementVertical.scrollTop-i)>Math.abs(this.elementVertical.scrollTop+this.elementVertical.clientHeight-i))}scrollToRow(e){var i=e.getElement();this.elementVertical.scrollTop=io.elOffset(i).top-io.elOffset(this.elementVertical).top+this.elementVertical.scrollTop}visibleRows(e){return this.rows()}}class IZe extends HF{constructor(e){super(e),this.verticalFillMode="fill",this.scrollTop=0,this.scrollLeft=0,this.vDomRowHeight=20,this.vDomTop=0,this.vDomBottom=0,this.vDomScrollPosTop=0,this.vDomScrollPosBottom=0,this.vDomTopPad=0,this.vDomBottomPad=0,this.vDomMaxRenderChain=90,this.vDomWindowBuffer=0,this.vDomWindowMinTotalRows=20,this.vDomWindowMinMarginRows=5,this.vDomTopNewRows=[],this.vDomBottomNewRows=[]}clearRows(){for(var e=this.tableElement;e.firstChild;)e.removeChild(e.firstChild);e.style.paddingTop="",e.style.paddingBottom="",e.style.minHeight="",e.style.display="",e.style.visibility="",this.elementVertical.scrollTop=0,this.elementVertical.scrollLeft=0,this.scrollTop=0,this.scrollLeft=0,this.vDomTop=0,this.vDomBottom=0,this.vDomTopPad=0,this.vDomBottomPad=0,this.vDomScrollPosTop=0,this.vDomScrollPosBottom=0}renderRows(){this._virtualRenderFill()}rerenderRows(e){for(var i=this.elementVertical.scrollTop,n=!1,r=!1,a=this.table.rowManager.scrollLeft,o=this.rows(),s=this.vDomTop;s<=this.vDomBottom;s++)if(o[s]){var l=i-o[s].getElement().offsetTop;if(r===!1||Math.abs(l)<r)r=l,n=s;else break}o.forEach(c=>{c.deinitializeHeight()}),e&&e(),this.rows().length?this._virtualRenderFill(n===!1?this.rows.length-1:n,!0,r||0):(this.clear(),this.table.rowManager.tableEmpty()),this.scrollColumns(a)}scrollColumns(e){this.table.rowManager.scrollHorizontal(e)}scrollRows(e,i){var n=e-this.vDomScrollPosTop,r=e-this.vDomScrollPosBottom,a=this.vDomWindowBuffer*2,o=this.rows();if(this.scrollTop=e,-n>a||r>a){var s=this.table.rowManager.scrollLeft;this._virtualRenderFill(Math.floor(this.elementVertical.scrollTop/this.elementVertical.scrollHeight*o.length)),this.scrollColumns(s)}else i?(n<0&&this._addTopRow(o,-n),r<0&&(this.vDomScrollHeight-this.scrollTop>this.vDomWindowBuffer?this._removeBottomRow(o,-r):this.vDomScrollPosBottom=this.scrollTop)):(r>=0&&this._addBottomRow(o,r),n>=0&&(this.scrollTop>this.vDomWindowBuffer?this._removeTopRow(o,n):this.vDomScrollPosTop=this.scrollTop))}resize(){this.vDomWindowBuffer=this.table.options.renderVerticalBuffer||this.elementVertical.clientHeight}scrollToRowNearestTop(e){var i=this.rows().indexOf(e);return!(Math.abs(this.vDomTop-i)>Math.abs(this.vDomBottom-i))}scrollToRow(e){var i=this.rows().indexOf(e);i>-1&&this._virtualRenderFill(i,!0)}visibleRows(e){var i=this.elementVertical.scrollTop,n=this.elementVertical.clientHeight+i,r=!1,a=0,o=0,s=this.rows();if(e)a=this.vDomTop,o=this.vDomBottom;else for(var l=this.vDomTop;l<=this.vDomBottom;l++)if(s[l])if(r)if(n-s[l].getElement().offsetTop>=0)o=l;else break;else if(i-s[l].getElement().offsetTop>=0)a=l;else if(r=!0,n-s[l].getElement().offsetTop>=0)o=l;else break;return s.slice(a,o+1)}_virtualRenderFill(e,i,n){var r=this.tableElement,a=this.elementVertical,o=0,s=0,l=0,c=0,u=0,d=0,p=this.rows(),h=p.length,f=0,m,g,v=[],y=0,b=0,I=this.table.rowManager.fixedHeight,T=this.elementVertical.clientHeight,w=this.table.options.rowHeight,S=!0;if(e=e||0,n=n||0,!e)this.clear();else{for(;r.firstChild;)r.removeChild(r.firstChild);c=(h-e+1)*this.vDomRowHeight,c<T&&(e-=Math.ceil((T-c)/this.vDomRowHeight),e<0&&(e=0)),o=Math.min(Math.max(Math.floor(this.vDomWindowBuffer/this.vDomRowHeight),this.vDomWindowMinMarginRows),e),e-=o}if(h&&io.elVisible(this.elementVertical)){for(this.vDomTop=e,this.vDomBottom=e-1,I||this.table.options.maxHeight?(w&&(b=T/w+this.vDomWindowBuffer/w),b=Math.max(this.vDomWindowMinTotalRows,Math.ceil(b))):b=h;(b==h||s<=T+this.vDomWindowBuffer||y<this.vDomWindowMinTotalRows)&&this.vDomBottom<h-1;){for(v=[],g=document.createDocumentFragment(),d=0;d<b&&this.vDomBottom<h-1;)f=this.vDomBottom+1,m=p[f],this.styleRow(m,f),m.initialize(!1,!0),!m.heightInitialized&&!this.table.options.rowHeight&&m.clearCellHeight(),g.appendChild(m.getElement()),v.push(m),this.vDomBottom++,d++;if(!v.length)break;r.appendChild(g),v.forEach(D=>{D.rendered(),D.heightInitialized||D.calcHeight(!0)}),v.forEach(D=>{D.heightInitialized||D.setCellHeight()}),v.forEach(D=>{l=D.getHeight(),y<o?u+=l:s+=l,l>this.vDomWindowBuffer&&(this.vDomWindowBuffer=l*2),y++}),S=this.table.rowManager.adjustTableSize(),T=this.elementVertical.clientHeight,S&&(I||this.table.options.maxHeight)&&(w=s/y,b=Math.max(this.vDomWindowMinTotalRows,Math.ceil(T/w+this.vDomWindowBuffer/w)))}e?(this.vDomTopPad=i?this.vDomRowHeight*this.vDomTop+n:this.scrollTop-u,this.vDomBottomPad=this.vDomBottom==h-1?0:Math.max(this.vDomScrollHeight-this.vDomTopPad-s-u,0)):(this.vDomTopPad=0,this.vDomRowHeight=Math.floor((s+u)/y),this.vDomBottomPad=this.vDomRowHeight*(h-this.vDomBottom-1),this.vDomScrollHeight=u+s+this.vDomBottomPad-T),r.style.paddingTop=this.vDomTopPad+"px",r.style.paddingBottom=this.vDomBottomPad+"px",i&&(this.scrollTop=this.vDomTopPad+u+n-(this.elementVertical.scrollWidth>this.elementVertical.clientWidth?this.elementVertical.offsetHeight-T:0)),this.scrollTop=Math.min(this.scrollTop,this.elementVertical.scrollHeight-T),this.elementVertical.scrollWidth>this.elementVertical.clientWidth&&i&&(this.scrollTop+=this.elementVertical.offsetHeight-T),this.vDomScrollPosTop=this.scrollTop,this.vDomScrollPosBottom=this.scrollTop,a.scrollTop=this.scrollTop,this.dispatch("render-virtual-fill")}}_addTopRow(e,i){for(var n=this.tableElement,r=[],a=0,o=this.vDomTop-1,s=0,l=!0;l;)if(this.vDomTop){let c=e[o],u,d;c&&s<this.vDomMaxRenderChain?(u=c.getHeight()||this.vDomRowHeight,d=c.initialized,i>=u?(this.styleRow(c,o),n.insertBefore(c.getElement(),n.firstChild),(!c.initialized||!c.heightInitialized)&&r.push(c),c.initialize(),d||(u=c.getElement().offsetHeight,u>this.vDomWindowBuffer&&(this.vDomWindowBuffer=u*2)),i-=u,a+=u,this.vDomTop--,o--,s++):l=!1):l=!1}else l=!1;for(let c of r)c.clearCellHeight();this._quickNormalizeRowHeight(r),a&&(this.vDomTopPad-=a,this.vDomTopPad<0&&(this.vDomTopPad=o*this.vDomRowHeight),o<1&&(this.vDomTopPad=0),n.style.paddingTop=this.vDomTopPad+"px",this.vDomScrollPosTop-=a)}_removeTopRow(e,i){for(var n=[],r=0,a=0,o=!0;o;){let s=e[this.vDomTop],l;s&&a<this.vDomMaxRenderChain?(l=s.getHeight()||this.vDomRowHeight,i>=l?(this.vDomTop++,i-=l,r+=l,n.push(s),a++):o=!1):o=!1}for(let s of n){let l=s.getElement();l.parentNode&&l.parentNode.removeChild(l)}r&&(this.vDomTopPad+=r,this.tableElement.style.paddingTop=this.vDomTopPad+"px",this.vDomScrollPosTop+=this.vDomTop?r:r+this.vDomWindowBuffer)}_addBottomRow(e,i){for(var n=this.tableElement,r=[],a=0,o=this.vDomBottom+1,s=0,l=!0;l;){let c=e[o],u,d;c&&s<this.vDomMaxRenderChain?(u=c.getHeight()||this.vDomRowHeight,d=c.initialized,i>=u?(this.styleRow(c,o),n.appendChild(c.getElement()),(!c.initialized||!c.heightInitialized)&&r.push(c),c.initialize(),d||(u=c.getElement().offsetHeight,u>this.vDomWindowBuffer&&(this.vDomWindowBuffer=u*2)),i-=u,a+=u,this.vDomBottom++,o++,s++):l=!1):l=!1}for(let c of r)c.clearCellHeight();this._quickNormalizeRowHeight(r),a&&(this.vDomBottomPad-=a,(this.vDomBottomPad<0||o==e.length-1)&&(this.vDomBottomPad=0),n.style.paddingBottom=this.vDomBottomPad+"px",this.vDomScrollPosBottom+=a)}_removeBottomRow(e,i){for(var n=[],r=0,a=0,o=!0;o;){let s=e[this.vDomBottom],l;s&&a<this.vDomMaxRenderChain?(l=s.getHeight()||this.vDomRowHeight,i>=l?(this.vDomBottom--,i-=l,r+=l,n.push(s),a++):o=!1):o=!1}for(let s of n){let l=s.getElement();l.parentNode&&l.parentNode.removeChild(l)}r&&(this.vDomBottomPad+=r,this.vDomBottomPad<0&&(this.vDomBottomPad=0),this.tableElement.style.paddingBottom=this.vDomBottomPad+"px",this.vDomScrollPosBottom-=r)}_quickNormalizeRowHeight(e){for(let i of e)i.calcHeight();for(let i of e)i.setCellHeight()}}class wZe extends dc{constructor(e){super(e),this.element=this.createHolderElement(),this.tableElement=this.createTableElement(),this.heightFixer=this.createTableElement(),this.placeholder=null,this.placeholderContents=null,this.firstRender=!1,this.renderMode="virtual",this.fixedHeight=!1,this.rows=[],this.activeRowsPipeline=[],this.activeRows=[],this.activeRowsCount=0,this.displayRows=[],this.displayRowsCount=0,this.scrollTop=0,this.scrollLeft=0,this.redrawBlock=!1,this.redrawBlockRestoreConfig=!1,this.redrawBlockRenderInPosition=!1,this.dataPipeline=[],this.displayPipeline=[],this.scrollbarWidth=0,this.renderer=null}createHolderElement(){var e=document.createElement("div");return e.classList.add("tabulator-tableholder"),e.setAttribute("tabindex",0),e}createTableElement(){var e=document.createElement("div");return e.classList.add("tabulator-table"),e.setAttribute("role","rowgroup"),e}initializePlaceholder(){var e=this.table.options.placeholder;if(typeof e=="function"&&(e=e.call(this.table)),e=this.chain("placeholder",[e],e,e)||e,e){let i=document.createElement("div");if(i.classList.add("tabulator-placeholder"),typeof e=="string"){let n=document.createElement("div");n.classList.add("tabulator-placeholder-contents"),n.innerHTML=e,i.appendChild(n),this.placeholderContents=n}else typeof HTMLElement<"u"&&e instanceof HTMLElement?(i.appendChild(e),this.placeholderContents=e):(console.warn("Invalid placeholder provided, must be string or HTML Element",e),this.el=null);this.placeholder=i}}getElement(){return this.element}getTableElement(){return this.tableElement}initialize(){this.initializePlaceholder(),this.initializeRenderer(),this.element.appendChild(this.tableElement),this.firstRender=!0,this.element.addEventListener("scroll",()=>{var e=this.element.scrollLeft,i=this.scrollLeft>e,n=this.element.scrollTop,r=this.scrollTop>n;this.scrollLeft!=e&&(this.scrollLeft=e,this.dispatch("scroll-horizontal",e,i),this.dispatchExternal("scrollHorizontal",e,i),this._positionPlaceholder()),this.scrollTop!=n&&(this.scrollTop=n,this.renderer.scrollRows(n,r),this.dispatch("scroll-vertical",n,r),this.dispatchExternal("scrollVertical",n,r))})}findRow(e){if(typeof e=="object"){if(e instanceof wc)return e;if(e instanceof jF)return e._getSelf()||!1;if(typeof HTMLElement<"u"&&e instanceof HTMLElement)return this.rows.find(n=>n.getElement()===e)||!1;if(e===null)return!1}else return typeof e>"u"?!1:this.rows.find(n=>n.data[this.table.options.index]==e)||!1;return!1}getRowFromDataObject(e){var i=this.rows.find(n=>n.data===e);return i||!1}getRowFromPosition(e){return this.getDisplayRows().find(i=>i.type==="row"&&i.getPosition()===e&&i.isDisplayed())}scrollToRow(e,i,n){return this.renderer.scrollToRowPosition(e,i,n)}setData(e,i,n){return new Promise((r,a)=>{i&&this.getDisplayRows().length?this.table.options.pagination?this._setDataActual(e,!0):this.reRenderInPosition(()=>{this._setDataActual(e)}):(this.table.options.autoColumns&&n&&this.table.initialized&&this.table.columnManager.generateColumnsFromRowData(e),this.resetScroll(),this._setDataActual(e)),r()})}_setDataActual(e,i){this.dispatchExternal("dataProcessing",e),this._wipeElements(),Array.isArray(e)?(this.dispatch("data-processing",e),e.forEach((n,r)=>{if(n&&typeof n=="object"){var a=new wc(n,this);this.rows.push(a)}else console.warn("Data Loading Warning - Invalid row data detected and ignored, expecting object but received:",n)}),this.refreshActiveData(!1,!1,i),this.dispatch("data-processed",e),this.dispatchExternal("dataProcessed",e)):console.error(`Data Loading Error - Unable to process data due to invalid data type 
Expecting: array 
Received: `,typeof e,`
Data:     `,e)}_wipeElements(){this.dispatch("rows-wipe"),this.destroy(),this.adjustTableSize(),this.dispatch("rows-wiped")}destroy(){this.rows.forEach(e=>{e.wipe()}),this.rows=[],this.activeRows=[],this.activeRowsPipeline=[],this.activeRowsCount=0,this.displayRows=[],this.displayRowsCount=0}deleteRow(e,i){var n=this.rows.indexOf(e),r=this.activeRows.indexOf(e);r>-1&&this.activeRows.splice(r,1),n>-1&&this.rows.splice(n,1),this.setActiveRows(this.activeRows),this.displayRowIterator(a=>{var o=a.indexOf(e);o>-1&&a.splice(o,1)}),i||this.reRenderInPosition(),this.regenerateRowPositions(),this.dispatchExternal("rowDeleted",e.getComponent()),this.displayRowsCount||this.tableEmpty(),this.subscribedExternal("dataChanged")&&this.dispatchExternal("dataChanged",this.getData())}addRow(e,i,n,r){var a=this.addRowActual(e,i,n,r);return a}addRows(e,i,n,r){var a=[];return new Promise((o,s)=>{i=this.findAddRowPos(i),Array.isArray(e)||(e=[e]),(typeof n>"u"&&i||typeof n<"u"&&!i)&&e.reverse(),e.forEach((l,c)=>{var u=this.addRow(l,i,n,!0);a.push(u),this.dispatch("row-added",u,l,i,n)}),this.refreshActiveData(r?"displayPipeline":!1,!1,!0),this.regenerateRowPositions(),this.displayRowsCount&&this._clearPlaceholder(),o(a)})}findAddRowPos(e){return typeof e>"u"&&(e=this.table.options.addRowPos),e==="pos"&&(e=!0),e==="bottom"&&(e=!1),e}addRowActual(e,i,n,r){var a=e instanceof wc?e:new wc(e||{},this),o=this.findAddRowPos(i),s=-1,l,c;return n||(c=this.chain("row-adding-position",[a,o],null,{index:n,top:o}),n=c.index,o=c.top),typeof n<"u"&&(n=this.findRow(n)),n=this.chain("row-adding-index",[a,n,o],null,n),n&&(s=this.rows.indexOf(n)),n&&s>-1?(l=this.activeRows.indexOf(n),this.displayRowIterator(function(u){var d=u.indexOf(n);d>-1&&u.splice(o?d:d+1,0,a)}),l>-1&&this.activeRows.splice(o?l:l+1,0,a),this.rows.splice(o?s:s+1,0,a)):o?(this.displayRowIterator(function(u){u.unshift(a)}),this.activeRows.unshift(a),this.rows.unshift(a)):(this.displayRowIterator(function(u){u.push(a)}),this.activeRows.push(a),this.rows.push(a)),this.setActiveRows(this.activeRows),this.dispatchExternal("rowAdded",a.getComponent()),this.subscribedExternal("dataChanged")&&this.dispatchExternal("dataChanged",this.table.rowManager.getData()),r||this.reRenderInPosition(),a}moveRow(e,i,n){this.dispatch("row-move",e,i,n),this.moveRowActual(e,i,n),this.regenerateRowPositions(),this.dispatch("row-moved",e,i,n),this.dispatchExternal("rowMoved",e.getComponent())}moveRowActual(e,i,n){this.moveRowInArray(this.rows,e,i,n),this.moveRowInArray(this.activeRows,e,i,n),this.displayRowIterator(r=>{this.moveRowInArray(r,e,i,n)}),this.dispatch("row-moving",e,i,n)}moveRowInArray(e,i,n,r){var a,o,s,l;if(i!==n&&(a=e.indexOf(i),a>-1&&(e.splice(a,1),o=e.indexOf(n),o>-1?r?e.splice(o+1,0,i):e.splice(o,0,i):e.splice(a,0,i)),e===this.getDisplayRows())){s=a<o?a:o,l=o>a?o:a+1;for(let c=s;c<=l;c++)e[c]&&this.styleRow(e[c],c)}}clearData(){this.setData([])}getRowIndex(e){return this.findRowIndex(e,this.rows)}getDisplayRowIndex(e){var i=this.getDisplayRows().indexOf(e);return i>-1?i:!1}nextDisplayRow(e,i){var n=this.getDisplayRowIndex(e),r=!1;return n!==!1&&n<this.displayRowsCount-1&&(r=this.getDisplayRows()[n+1]),r&&(!(r instanceof wc)||r.type!="row")?this.nextDisplayRow(r,i):r}prevDisplayRow(e,i){var n=this.getDisplayRowIndex(e),r=!1;return n&&(r=this.getDisplayRows()[n-1]),i&&r&&(!(r instanceof wc)||r.type!="row")?this.prevDisplayRow(r,i):r}findRowIndex(e,i){var n;return e=this.findRow(e),e&&(n=i.indexOf(e),n>-1)?n:!1}getData(e,i){var n=[],r=this.getRows(e);return r.forEach(function(a){a.type=="row"&&n.push(a.getData(i||"data"))}),n}getComponents(e){var i=[],n=this.getRows(e);return n.forEach(function(r){i.push(r.getComponent())}),i}getDataCount(e){var i=this.getRows(e);return i.length}scrollHorizontal(e){this.scrollLeft=e,this.element.scrollLeft=e,this.dispatch("scroll-horizontal",e)}registerDataPipelineHandler(e,i){typeof i<"u"?(this.dataPipeline.push({handler:e,priority:i}),this.dataPipeline.sort((n,r)=>n.priority-r.priority)):console.error("Data pipeline handlers must have a priority in order to be registered")}registerDisplayPipelineHandler(e,i){typeof i<"u"?(this.displayPipeline.push({handler:e,priority:i}),this.displayPipeline.sort((n,r)=>n.priority-r.priority)):console.error("Display pipeline handlers must have a priority in order to be registered")}refreshActiveData(e,i,n){var r=this.table,a="",o=0,s=["all","dataPipeline","display","displayPipeline","end"];if(!this.table.destroyed){if(typeof e=="function")if(o=this.dataPipeline.findIndex(l=>l.handler===e),o>-1)a="dataPipeline",i&&(o==this.dataPipeline.length-1?a="display":o++);else if(o=this.displayPipeline.findIndex(l=>l.handler===e),o>-1)a="displayPipeline",i&&(o==this.displayPipeline.length-1?a="end":o++);else{console.error("Unable to refresh data, invalid handler provided",e);return}else a=e||"all",o=0;if(this.redrawBlock){(!this.redrawBlockRestoreConfig||this.redrawBlockRestoreConfig&&(this.redrawBlockRestoreConfig.stage===a&&o<this.redrawBlockRestoreConfig.index||s.indexOf(a)<s.indexOf(this.redrawBlockRestoreConfig.stage)))&&(this.redrawBlockRestoreConfig={handler:e,skipStage:i,renderInPosition:n,stage:a,index:o});return}else io.elVisible(this.element)?n?this.reRenderInPosition(this.refreshPipelines.bind(this,e,a,o,n)):(this.refreshPipelines(e,a,o,n),e||this.table.columnManager.renderer.renderColumns(),this.renderTable(),r.options.layoutColumnsOnNewData&&this.table.columnManager.redraw(!0)):this.refreshPipelines(e,a,o,n),this.dispatch("data-refreshed")}}refreshPipelines(e,i,n,r){switch(this.dispatch("data-refreshing"),(!e||!this.activeRowsPipeline[0])&&(this.activeRowsPipeline[0]=this.rows.slice(0)),i){case"all":case"dataPipeline":for(let a=n;a<this.dataPipeline.length;a++){let o=this.dataPipeline[a].handler(this.activeRowsPipeline[a].slice(0));this.activeRowsPipeline[a+1]=o||this.activeRowsPipeline[a].slice(0)}this.setActiveRows(this.activeRowsPipeline[this.dataPipeline.length]);case"display":n=0,this.resetDisplayRows();case"displayPipeline":for(let a=n;a<this.displayPipeline.length;a++){let o=this.displayPipeline[a].handler((a?this.getDisplayRows(a-1):this.activeRows).slice(0),r);this.setDisplayRows(o||this.getDisplayRows(a-1).slice(0),a)}case"end":this.regenerateRowPositions()}this.getDisplayRows().length&&this._clearPlaceholder()}regenerateRowPositions(){var e=this.getDisplayRows(),i=1;e.forEach(n=>{n.type==="row"&&(n.setPosition(i),i++)})}setActiveRows(e){this.activeRows=this.activeRows=Object.assign([],e),this.activeRowsCount=this.activeRows.length}resetDisplayRows(){this.displayRows=[],this.displayRows.push(this.activeRows.slice(0)),this.displayRowsCount=this.displayRows[0].length}setDisplayRows(e,i){this.displayRows[i]=e,i==this.displayRows.length-1&&(this.displayRowsCount=this.displayRows[this.displayRows.length-1].length)}getDisplayRows(e){return typeof e>"u"?this.displayRows.length?this.displayRows[this.displayRows.length-1]:[]:this.displayRows[e]||[]}getVisibleRows(e,i){var n=Object.assign([],this.renderer.visibleRows(!i));return e&&(n=this.chain("rows-visible",[i],n,n)),n}displayRowIterator(e){this.activeRowsPipeline.forEach(e),this.displayRows.forEach(e),this.displayRowsCount=this.displayRows[this.displayRows.length-1].length}getRows(e){var i=[];switch(e){case"active":i=this.activeRows;break;case"display":i=this.table.rowManager.getDisplayRows();break;case"visible":i=this.getVisibleRows(!1,!0);break;default:i=this.chain("rows-retrieve",e,null,this.rows)||this.rows}return i}reRenderInPosition(e){this.redrawBlock?e?e():this.redrawBlockRenderInPosition=!0:(this.dispatchExternal("renderStarted"),this.renderer.rerenderRows(e),this.fixedHeight||this.adjustTableSize(),this.scrollBarCheck(),this.dispatchExternal("renderComplete"))}scrollBarCheck(){var e=0;this.element.scrollHeight>this.element.clientHeight&&(e=this.element.offsetWidth-this.element.clientWidth),e!==this.scrollbarWidth&&(this.scrollbarWidth=e,this.dispatch("scrollbar-vertical",e))}initializeRenderer(){var e,i={virtual:IZe,basic:bZe};typeof this.table.options.renderVertical=="string"?e=i[this.table.options.renderVertical]:e=this.table.options.renderVertical,e?(this.renderMode=this.table.options.renderVertical,this.renderer=new e(this.table,this.element,this.tableElement),this.renderer.initialize(),(this.table.element.clientHeight||this.table.options.height)&&!(this.table.options.minHeight&&this.table.options.maxHeight)?this.fixedHeight=!0:this.fixedHeight=!1):console.error("Unable to find matching renderer:",this.table.options.renderVertical)}getRenderMode(){return this.renderMode}renderTable(){this.dispatchExternal("renderStarted"),this.element.scrollTop=0,this._clearTable(),this.displayRowsCount?(this.renderer.renderRows(),this.firstRender&&(this.firstRender=!1,this.fixedHeight||this.adjustTableSize(),this.layoutRefresh(!0))):this.renderEmptyScroll(),this.fixedHeight||this.adjustTableSize(),this.dispatch("table-layout"),this.displayRowsCount||this._showPlaceholder(),this.scrollBarCheck(),this.dispatchExternal("renderComplete")}renderEmptyScroll(){this.placeholder?this.tableElement.style.display="none":this.tableElement.style.minWidth=this.table.columnManager.getWidth()+"px"}_clearTable(){this._clearPlaceholder(),this.scrollTop=0,this.scrollLeft=0,this.renderer.clearRows()}tableEmpty(){this.renderEmptyScroll(),this._showPlaceholder()}checkPlaceholder(){this.displayRowsCount?this._clearPlaceholder():this.tableEmpty()}_showPlaceholder(){this.placeholder&&(this.placeholder&&this.placeholder.parentNode&&this.placeholder.parentNode.removeChild(this.placeholder),this.initializePlaceholder(),this.placeholder.setAttribute("tabulator-render-mode",this.renderMode),this.getElement().appendChild(this.placeholder),this._positionPlaceholder(),this.adjustTableSize())}_clearPlaceholder(){this.placeholder&&this.placeholder.parentNode&&this.placeholder.parentNode.removeChild(this.placeholder),this.tableElement.style.minWidth="",this.tableElement.style.display=""}_positionPlaceholder(){this.placeholder&&this.placeholder.parentNode&&(this.placeholder.style.width=this.table.columnManager.getWidth()+"px",this.placeholderContents.style.width=this.table.rowManager.element.clientWidth+"px",this.placeholderContents.style.marginLeft=this.scrollLeft+"px")}styleRow(e,i){var n=e.getElement();i%2?(n.classList.add("tabulator-row-even"),n.classList.remove("tabulator-row-odd")):(n.classList.add("tabulator-row-odd"),n.classList.remove("tabulator-row-even"))}normalizeHeight(){this.activeRows.forEach(function(e){e.normalizeHeight()})}adjustTableSize(){let e=this.element.clientHeight,i,n=!1;if(this.renderer.verticalFillMode==="fill"){let r=Math.floor(this.table.columnManager.getElement().getBoundingClientRect().height+(this.table.footerManager&&this.table.footerManager.active&&!this.table.footerManager.external?this.table.footerManager.getElement().getBoundingClientRect().height:0));if(this.fixedHeight){i=isNaN(this.table.options.minHeight)?this.table.options.minHeight:this.table.options.minHeight+"px";const a="calc(100% - "+r+"px)";this.element.style.minHeight=i||"calc(100% - "+r+"px)",this.element.style.height=a,this.element.style.maxHeight=a}else this.element.style.height="",this.element.style.height=this.table.element.clientHeight-r+"px",this.element.scrollTop=this.scrollTop;this.renderer.resize(),!this.fixedHeight&&e!=this.element.clientHeight&&(n=!0,this.subscribed("table-resize")?this.dispatch("table-resize"):this.redraw()),this.scrollBarCheck()}return this._positionPlaceholder(),n}reinitialize(){this.rows.forEach(function(e){e.reinitialize(!0)})}blockRedraw(){this.redrawBlock=!0,this.redrawBlockRestoreConfig=!1}restoreRedraw(){this.redrawBlock=!1,this.redrawBlockRestoreConfig?(this.refreshActiveData(this.redrawBlockRestoreConfig.handler,this.redrawBlockRestoreConfig.skipStage,this.redrawBlockRestoreConfig.renderInPosition),this.redrawBlockRestoreConfig=!1):this.redrawBlockRenderInPosition&&this.reRenderInPosition(),this.redrawBlockRenderInPosition=!1}redraw(e){this.adjustTableSize(),this.table.tableWidth=this.table.element.clientWidth,e?this.renderTable():(this.reRenderInPosition(),this.scrollHorizontal(this.scrollLeft))}resetScroll(){if(this.element.scrollLeft=0,this.element.scrollTop=0,this.table.browser==="ie"){var e=document.createEvent("Event");e.initEvent("scroll",!1,!0),this.element.dispatchEvent(e)}else this.element.dispatchEvent(new Event("scroll"))}}class SZe extends dc{constructor(e){super(e),this.active=!1,this.element=this.createElement(),this.containerElement=this.createContainerElement(),this.external=!1}initialize(){this.initializeElement()}createElement(){var e=document.createElement("div");return e.classList.add("tabulator-footer"),e}createContainerElement(){var e=document.createElement("div");return e.classList.add("tabulator-footer-contents"),this.element.appendChild(e),e}initializeElement(){if(this.table.options.footerElement)switch(typeof this.table.options.footerElement){case"string":this.table.options.footerElement[0]==="<"?this.containerElement.innerHTML=this.table.options.footerElement:(this.external=!0,this.containerElement=document.querySelector(this.table.options.footerElement));break;default:this.element=this.table.options.footerElement;break}}getElement(){return this.element}append(e){this.activate(),this.containerElement.appendChild(e),this.table.rowManager.adjustTableSize()}prepend(e){this.activate(),this.element.insertBefore(e,this.element.firstChild),this.table.rowManager.adjustTableSize()}remove(e){e.parentNode.removeChild(e),this.deactivate()}deactivate(e){(!this.element.firstChild||e)&&(this.external||this.element.parentNode.removeChild(this.element),this.active=!1)}activate(){this.active||(this.active=!0,this.external||(this.table.element.appendChild(this.getElement()),this.table.element.style.display=""))}redraw(){this.dispatch("footer-redraw")}}class TZe extends dc{constructor(e){super(e),this.el=null,this.abortClasses=["tabulator-headers","tabulator-table"],this.previousTargets={},this.listeners=["click","dblclick","contextmenu","mouseenter","mouseleave","mouseover","mouseout","mousemove","mouseup","mousedown","touchstart","touchend"],this.componentMap={"tabulator-cell":"cell","tabulator-row":"row","tabulator-group":"group","tabulator-col":"column"},this.pseudoTrackers={row:{subscriber:null,target:null},cell:{subscriber:null,target:null},group:{subscriber:null,target:null},column:{subscriber:null,target:null}},this.pseudoTracking=!1}initialize(){this.el=this.table.element,this.buildListenerMap(),this.bindSubscriptionWatchers()}buildListenerMap(){var e={};this.listeners.forEach(i=>{e[i]={handler:null,components:[]}}),this.listeners=e}bindPseudoEvents(){Object.keys(this.pseudoTrackers).forEach(e=>{this.pseudoTrackers[e].subscriber=this.pseudoMouseEnter.bind(this,e),this.subscribe(e+"-mouseover",this.pseudoTrackers[e].subscriber)}),this.pseudoTracking=!0}pseudoMouseEnter(e,i,n){this.pseudoTrackers[e].target!==n&&(this.pseudoTrackers[e].target&&this.dispatch(e+"-mouseleave",i,this.pseudoTrackers[e].target),this.pseudoMouseLeave(e,i),this.pseudoTrackers[e].target=n,this.dispatch(e+"-mouseenter",i,n))}pseudoMouseLeave(e,i){var n=Object.keys(this.pseudoTrackers),r={row:["cell"],cell:["row"]};n=n.filter(a=>{var o=r[e];return a!==e&&(!o||o&&!o.includes(a))}),n.forEach(a=>{var o=this.pseudoTrackers[a].target;this.pseudoTrackers[a].target&&(this.dispatch(a+"-mouseleave",i,o),this.pseudoTrackers[a].target=null)})}bindSubscriptionWatchers(){var e=Object.keys(this.listeners),i=Object.values(this.componentMap);for(let n of i)for(let r of e){let a=n+"-"+r;this.subscriptionChange(a,this.subscriptionChanged.bind(this,n,r))}this.subscribe("table-destroy",this.clearWatchers.bind(this))}subscriptionChanged(e,i,n){var r=this.listeners[i].components,a=r.indexOf(e),o=!1;n?a===-1&&(r.push(e),o=!0):this.subscribed(e+"-"+i)||a>-1&&(r.splice(a,1),o=!0),(i==="mouseenter"||i==="mouseleave")&&!this.pseudoTracking&&this.bindPseudoEvents(),o&&this.updateEventListeners()}updateEventListeners(){for(let e in this.listeners){let i=this.listeners[e];i.components.length?i.handler||(i.handler=this.track.bind(this,e),this.el.addEventListener(e,i.handler)):i.handler&&(this.el.removeEventListener(e,i.handler),i.handler=null)}}track(e,i){var n=i.composedPath&&i.composedPath()||i.path,r=this.findTargets(n);r=this.bindComponents(e,r),this.triggerEvents(e,i,r),this.pseudoTracking&&(e=="mouseover"||e=="mouseleave")&&!Object.keys(r).length&&this.pseudoMouseLeave("none",i)}findTargets(e){var i={};let n=Object.keys(this.componentMap);for(let r of e){let a=r.classList?[...r.classList]:[];if(a.filter(l=>this.abortClasses.includes(l)).length)break;let s=a.filter(l=>n.includes(l));for(let l of s)i[this.componentMap[l]]||(i[this.componentMap[l]]=r)}return i.group&&i.group===i.row&&delete i.row,i}bindComponents(e,i){var n=Object.keys(i).reverse(),r=this.listeners[e],a={},o={};for(let s of n){let l,c=i[s],u=this.previousTargets[s];if(u&&u.target===c)l=u.component;else switch(s){case"row":case"group":(r.components.includes("row")||r.components.includes("cell")||r.components.includes("group"))&&(l=this.table.rowManager.getVisibleRows(!0).find(p=>p.getElement()===c),i.row&&i.row.parentNode&&i.row.parentNode.closest(".tabulator-row")&&(i[s]=!1));break;case"column":r.components.includes("column")&&(l=this.table.columnManager.findColumn(c));break;case"cell":r.components.includes("cell")&&(a.row instanceof wc?l=a.row.findCell(c):i.row&&console.warn("Event Target Lookup Error - The row this cell is attached to cannot be found, has the table been reinitialized without being destroyed first?"));break}l&&(a[s]=l,o[s]={target:c,component:l})}return this.previousTargets=o,a}triggerEvents(e,i,n){var r=this.listeners[e];for(let a in n)n[a]&&r.components.includes(a)&&this.dispatch(a+"-"+e,i,n[a])}clearWatchers(){for(let e in this.listeners){let i=this.listeners[e];i.handler&&(this.el.removeEventListener(e,i.handler),i.handler=null)}}}class UZe{constructor(e){this.table=e,this.bindings={}}bind(e,i,n){this.bindings[e]||(this.bindings[e]={}),this.bindings[e][i]?console.warn("Unable to bind component handler, a matching function name is already bound",e,i,n):this.bindings[e][i]=n}handle(e,i,n){if(this.bindings[e]&&this.bindings[e][n]&&typeof this.bindings[e][n].bind=="function")return this.bindings[e][n].bind(null,i);n!=="then"&&typeof n=="string"&&!n.startsWith("_")&&this.table.options.debugInvalidComponentFuncs&&console.error("The "+e+" component does not have a "+n+" function, have you checked that you have the correct Tabulator module installed?")}}class DZe extends dc{constructor(e){super(e),this.requestOrder=0,this.loading=!1}initialize(){}load(e,i,n,r,a,o){var s=++this.requestOrder;if(this.table.destroyed)return Promise.resolve();if(this.dispatchExternal("dataLoading",e),e&&(e.indexOf("{")==0||e.indexOf("[")==0)&&(e=JSON.parse(e)),this.confirm("data-loading",[e,i,n,a])){this.loading=!0,a||this.alertLoader(),i=this.chain("data-params",[e,n,a],i||{},i||{}),i=this.mapParams(i,this.table.options.dataSendParams);var l=this.chain("data-load",[e,i,n,a],!1,Promise.resolve([]));return l.then(c=>{if(this.table.destroyed)console.warn("Data Load Response Blocked - Table has been destroyed");else{!Array.isArray(c)&&typeof c=="object"&&(c=this.mapParams(c,this.objectInvert(this.table.options.dataReceiveParams)));var u=this.chain("data-loaded",[c],null,c);s==this.requestOrder?(this.clearAlert(),u!==!1&&(this.dispatchExternal("dataLoaded",u),this.table.rowManager.setData(u,r,typeof o>"u"?!r:o))):console.warn("Data Load Response Blocked - An active data load request was blocked by an attempt to change table data while the request was being made")}}).catch(c=>{console.error("Data Load Error: ",c),this.dispatchExternal("dataLoadError",c),a||this.alertError(),setTimeout(()=>{this.clearAlert()},this.table.options.dataLoaderErrorTimeout)}).finally(()=>{this.loading=!1})}else return this.dispatchExternal("dataLoaded",e),e||(e=[]),this.table.rowManager.setData(e,r,typeof o>"u"?!r:o),Promise.resolve()}mapParams(e,i){var n={};for(let r in e)n[i.hasOwnProperty(r)?i[r]:r]=e[r];return n}objectInvert(e){var i={};for(let n in e)i[e[n]]=n;return i}blockActiveLoad(){this.requestOrder++}alertLoader(){var e=typeof this.table.options.dataLoader=="function"?this.table.options.dataLoader():this.table.options.dataLoader;e&&this.table.alertManager.alert(this.table.options.dataLoaderLoading||this.langText("data|loading"))}alertError(){this.table.alertManager.alert(this.table.options.dataLoaderError||this.langText("data|error"),"error")}clearAlert(){this.table.alertManager.clear()}}class EZe{constructor(e,i,n){this.table=e,this.events={},this.optionsList=i||{},this.subscriptionNotifiers={},this.dispatch=n?this._debugDispatch.bind(this):this._dispatch.bind(this),this.debug=n}subscriptionChange(e,i){this.subscriptionNotifiers[e]||(this.subscriptionNotifiers[e]=[]),this.subscriptionNotifiers[e].push(i),this.subscribed(e)&&this._notifySubscriptionChange(e,!0)}subscribe(e,i){this.events[e]||(this.events[e]=[]),this.events[e].push(i),this._notifySubscriptionChange(e,!0)}unsubscribe(e,i){var n;if(this.events[e])if(i)if(n=this.events[e].findIndex(r=>r===i),n>-1)this.events[e].splice(n,1);else{console.warn("Cannot remove event, no matching event found:",e,i);return}else delete this.events[e];else{console.warn("Cannot remove event, no events set on:",e);return}this._notifySubscriptionChange(e,!1)}subscribed(e){return this.events[e]&&this.events[e].length}_notifySubscriptionChange(e,i){var n=this.subscriptionNotifiers[e];n&&n.forEach(r=>{r(i)})}_dispatch(){var e=Array.from(arguments),i=e.shift(),n;return this.events[i]&&this.events[i].forEach((r,a)=>{let o=r.apply(this.table,e);a||(n=o)}),n}_debugDispatch(){var e=Array.from(arguments),i=e[0];return e[0]="ExternalEvent:"+e[0],(this.debug===!0||this.debug.includes(i))&&console.log(...e),this._dispatch(...arguments)}}class CZe{constructor(e){this.events={},this.subscriptionNotifiers={},this.dispatch=e?this._debugDispatch.bind(this):this._dispatch.bind(this),this.chain=e?this._debugChain.bind(this):this._chain.bind(this),this.confirm=e?this._debugConfirm.bind(this):this._confirm.bind(this),this.debug=e}subscriptionChange(e,i){this.subscriptionNotifiers[e]||(this.subscriptionNotifiers[e]=[]),this.subscriptionNotifiers[e].push(i),this.subscribed(e)&&this._notifySubscriptionChange(e,!0)}subscribe(e,i,n=1e4){this.events[e]||(this.events[e]=[]),this.events[e].push({callback:i,priority:n}),this.events[e].sort((r,a)=>r.priority-a.priority),this._notifySubscriptionChange(e,!0)}unsubscribe(e,i){var n;if(this.events[e]){if(i)if(n=this.events[e].findIndex(r=>r.callback===i),n>-1)this.events[e].splice(n,1);else{console.warn("Cannot remove event, no matching event found:",e,i);return}}else{console.warn("Cannot remove event, no events set on:",e);return}this._notifySubscriptionChange(e,!1)}subscribed(e){return this.events[e]&&this.events[e].length}_chain(e,i,n,r){var a=n;return Array.isArray(i)||(i=[i]),this.subscribed(e)?(this.events[e].forEach((o,s)=>{a=o.callback.apply(this,i.concat([a]))}),a):typeof r=="function"?r():r}_confirm(e,i){var n=!1;return Array.isArray(i)||(i=[i]),this.subscribed(e)&&this.events[e].forEach((r,a)=>{r.callback.apply(this,i)&&(n=!0)}),n}_notifySubscriptionChange(e,i){var n=this.subscriptionNotifiers[e];n&&n.forEach(r=>{r(i)})}_dispatch(){var e=Array.from(arguments),i=e.shift();this.events[i]&&this.events[i].forEach(n=>{n.callback.apply(this,e)})}_debugDispatch(){var e=Array.from(arguments),i=e[0];return e[0]="InternalEvent:"+i,(this.debug===!0||this.debug.includes(i))&&console.log(...e),this._dispatch(...arguments)}_debugChain(){var e=Array.from(arguments),i=e[0];return e[0]="InternalEvent:"+i,(this.debug===!0||this.debug.includes(i))&&console.log(...e),this._chain(...arguments)}_debugConfirm(){var e=Array.from(arguments),i=e[0];return e[0]="InternalEvent:"+i,(this.debug===!0||this.debug.includes(i))&&console.log(...e),this._confirm(...arguments)}}class PZe extends dc{constructor(e){super(e)}_warnUser(){this.options("debugDeprecation")&&console.warn(...arguments)}check(e,i,n){var r="";return typeof this.options(e)<"u"?(r="Deprecated Setup Option - Use of the %c"+e+"%c option is now deprecated",i?(r=r+", Please use the %c"+i+"%c option instead",this._warnUser(r,"font-weight: bold;","font-weight: normal;","font-weight: bold;","font-weight: normal;"),n&&(this.table.options[i]=this.table.options[e])):this._warnUser(r,"font-weight: bold;","font-weight: normal;"),!1):!0}checkMsg(e,i){return typeof this.options(e)<"u"?(this._warnUser("%cDeprecated Setup Option - Use of the %c"+e+" %c option is now deprecated, "+i,"font-weight: normal;","font-weight: bold;","font-weight: normal;"),!1):!0}msg(e){this._warnUser(e)}}function RZe(t,e){e&&this.table.columnManager.renderer.reinitializeColumnWidths(t),this.table.options.responsiveLayout&&this.table.modExists("responsiveLayout",!0)&&this.table.modules.responsiveLayout.update()}function ZX(t,e){t.forEach(function(i){i.reinitializeWidth()}),this.table.options.responsiveLayout&&this.table.modExists("responsiveLayout",!0)&&this.table.modules.responsiveLayout.update()}function MZe(t,e){var i=0,n=this.table.rowManager.element.clientWidth,r=0,a=!1;t.forEach((o,s)=>{o.widthFixed||o.reinitializeWidth(),(this.table.options.responsiveLayout?o.modules.responsive.visible:o.visible)&&(a=o),o.visible&&(i+=o.getWidth())}),a?(r=n-i+a.getWidth(),this.table.options.responsiveLayout&&this.table.modExists("responsiveLayout",!0)&&(a.setWidth(0),this.table.modules.responsiveLayout.update()),r>0?a.setWidth(r):a.reinitializeWidth()):this.table.options.responsiveLayout&&this.table.modExists("responsiveLayout",!0)&&this.table.modules.responsiveLayout.update()}function NZe(t,e){var i=this.table.rowManager.element.getBoundingClientRect().width,n=0,r=0,a=0,o=0,s=[],l=[],c=0,u=0,d=0;function p(f){var m;return typeof f=="string"?f.indexOf("%")>-1?m=i/100*parseInt(f):m=parseInt(f):m=f,m}function h(f,m,g,v){var y=[],b=0,I=0,T=0,w=a,S=0,D=0,E=[];function C(R){return g*(R.column.definition.widthGrow||1)}function P(R){return p(R.width)-g*(R.column.definition.widthShrink||0)}return f.forEach(function(R,N){var M=v?P(R):C(R);R.column.minWidth>=M?y.push(R):R.column.maxWidth&&R.column.maxWidth<M?(R.width=R.column.maxWidth,m-=R.column.maxWidth,w-=v?R.column.definition.widthShrink||1:R.column.definition.widthGrow||1,w&&(g=Math.floor(m/w))):(E.push(R),D+=v?R.column.definition.widthShrink||1:R.column.definition.widthGrow||1)}),y.length?(y.forEach(function(R){b+=v?R.width-R.column.minWidth:R.column.minWidth,R.width=R.column.minWidth}),I=m-b,T=D?Math.floor(I/D):I,S=h(E,I,T,v)):(S=D?m-Math.floor(m/D)*D:m,E.forEach(function(R){R.width=v?P(R):C(R)})),S}this.table.options.responsiveLayout&&this.table.modExists("responsiveLayout",!0)&&this.table.modules.responsiveLayout.update(),this.table.rowManager.element.scrollHeight>this.table.rowManager.element.clientHeight&&(i-=this.table.rowManager.element.offsetWidth-this.table.rowManager.element.clientWidth),t.forEach(function(f){var m,g,v;f.visible&&(m=f.definition.width,g=parseInt(f.minWidth),m?(v=p(m),n+=v>g?v:g,f.definition.widthShrink&&(l.push({column:f,width:v>g?v:g}),c+=f.definition.widthShrink)):(s.push({column:f,width:0}),a+=f.definition.widthGrow||1))}),r=i-n,o=Math.floor(r/a),d=h(s,r,o,!1),s.length&&d>0&&(s[s.length-1].width+=d),s.forEach(function(f){r-=f.width}),u=Math.abs(d)+r,u>0&&c&&(d=h(l,u,Math.floor(u/c),!0)),d&&l.length&&(l[l.length-1].width-=d),s.forEach(function(f){f.column.setWidth(f.width)}),l.forEach(function(f){f.column.setWidth(f.width)})}var AZe={fitData:RZe,fitDataFill:ZX,fitDataTable:ZX,fitDataStretch:MZe,fitColumns:NZe};const F0=class F0 extends Wn{constructor(e){super(e,"layout"),this.mode=null,this.registerTableOption("layout","fitData"),this.registerTableOption("layoutColumnsOnNewData",!1),this.registerColumnOption("widthGrow"),this.registerColumnOption("widthShrink")}initialize(){var e=this.table.options.layout;F0.modes[e]?this.mode=e:(console.warn("Layout Error - invalid mode set, defaulting to 'fitData' : "+e),this.mode="fitData"),this.table.element.setAttribute("tabulator-layout",this.mode),this.subscribe("column-init",this.initializeColumn.bind(this))}initializeColumn(e){e.definition.widthGrow&&(e.definition.widthGrow=Number(e.definition.widthGrow)),e.definition.widthShrink&&(e.definition.widthShrink=Number(e.definition.widthShrink))}getMode(){return this.mode}layout(e){this.dispatch("layout-refreshing"),F0.modes[this.mode].call(this,this.table.columnManager.columnsByIndex,e),this.dispatch("layout-refreshed")}};Je(F0,"moduleName","layout"),Je(F0,"modes",AZe);let pG=F0;var _Ze={default:{groups:{item:"item",items:"items"},columns:{},data:{loading:"Loading",error:"Error"},pagination:{page_size:"Page Size",page_title:"Show Page",first:"First",first_title:"First Page",last:"Last",last_title:"Last Page",prev:"Prev",prev_title:"Prev Page",next:"Next",next_title:"Next Page",all:"All",counter:{showing:"Showing",of:"of",rows:"rows",pages:"pages"}},headerFilters:{default:"filter column...",columns:{}}}};const gD=class gD extends Wn{constructor(e){super(e),this.locale="default",this.lang=!1,this.bindings={},this.langList={},this.registerTableOption("locale",!1),this.registerTableOption("langs",{})}initialize(){this.langList=io.deepClone(gD.langs),this.table.options.columnDefaults.headerFilterPlaceholder!==!1&&this.setHeaderFilterPlaceholder(this.table.options.columnDefaults.headerFilterPlaceholder);for(let e in this.table.options.langs)this.installLang(e,this.table.options.langs[e]);this.setLocale(this.table.options.locale),this.registerTableFunction("setLocale",this.setLocale.bind(this)),this.registerTableFunction("getLocale",this.getLocale.bind(this)),this.registerTableFunction("getLang",this.getLang.bind(this))}setHeaderFilterPlaceholder(e){this.langList.default.headerFilters.default=e}installLang(e,i){this.langList[e]?this._setLangProp(this.langList[e],i):this.langList[e]=i}_setLangProp(e,i){for(let n in i)e[n]&&typeof e[n]=="object"?this._setLangProp(e[n],i[n]):e[n]=i[n]}setLocale(e){e=e||"default";function i(n,r){for(var a in n)typeof n[a]=="object"?(r[a]||(r[a]={}),i(n[a],r[a])):r[a]=n[a]}if(e===!0&&navigator.language&&(e=navigator.language.toLowerCase()),e&&!this.langList[e]){let n=e.split("-")[0];this.langList[n]?(console.warn("Localization Error - Exact matching locale not found, using closest match: ",e,n),e=n):(console.warn("Localization Error - Matching locale not found, using default: ",e),e="default")}this.locale=e,this.lang=io.deepClone(this.langList.default||{}),e!="default"&&i(this.langList[e],this.lang),this.dispatchExternal("localized",this.locale,this.lang),this._executeBindings()}getLocale(e){return this.locale}getLang(e){return e?this.langList[e]:this.lang}getText(e,i){var n=i?e+"|"+i:e,r=n.split("|"),a=this._getLangElement(r,this.locale);return a||""}_getLangElement(e,i){var n=this.lang;return e.forEach(function(r){var a;n&&(a=n[r],typeof a<"u"?n=a:n=!1)}),n}bind(e,i){this.bindings[e]||(this.bindings[e]=[]),this.bindings[e].push(i),i(this.getText(e),this.lang)}_executeBindings(){for(let e in this.bindings)this.bindings[e].forEach(i=>{i(this.getText(e),this.lang)})}};Je(gD,"moduleName","localize"),Je(gD,"langs",_Ze);let hG=gD;class tUe extends Wn{constructor(e){super(e)}initialize(){this.registerTableFunction("tableComms",this.receive.bind(this))}getConnections(e){var i=[],n;return n=this.table.constructor.registry.lookupTable(e),n.forEach(r=>{this.table!==r&&i.push(r)}),i}send(e,i,n,r){var a=this.getConnections(e);a.forEach(o=>{o.tableComms(this.table.element,i,n,r)}),!a.length&&e&&console.warn("Table Connection Error - No tables matching selector found",e)}receive(e,i,n,r){if(this.table.modExists(i))return this.table.modules[i].commsReceived(e,n,r);console.warn("Inter-table Comms Error - no such module:",i)}}Je(tUe,"moduleName","comms");var kZe=Object.freeze({__proto__:null,CommsModule:tUe,LayoutModule:pG,LocalizeModule:hG});const Qu=class Qu{static findTable(e){var i=Qu.registry.lookupTable(e,!0);return Array.isArray(i)&&!i.length?!1:i}};Je(Qu,"registry",{tables:[],register(e){Qu.registry.tables.push(e)},deregister(e){var i=Qu.registry.tables.indexOf(e);i>-1&&Qu.registry.tables.splice(i,1)},lookupTable(e,i){var n=[],r,a;if(typeof e=="string"){if(r=document.querySelectorAll(e),r.length)for(var o=0;o<r.length;o++)a=Qu.registry.matchElement(r[o]),a&&n.push(a)}else typeof HTMLElement<"u"&&e instanceof HTMLElement||e instanceof Qu?(a=Qu.registry.matchElement(e),a&&n.push(a)):Array.isArray(e)?e.forEach(function(s){n=n.concat(Qu.registry.lookupTable(s))}):i||console.warn("Table Connection Error - Invalid Selector",e);return n},matchElement(e){return Qu.registry.tables.find(function(i){return e instanceof Qu?i===e:i.element===e})}});let fG=Qu;const fa=class fa extends fG{constructor(){super()}static initializeModuleBinder(e){fa.modulesRegistered||(fa.modulesRegistered=!0,fa._registerModules(kZe,!0),e&&fa._registerModules(e))}static _extendModule(e,i,n){if(fa.moduleBindings[e]){var r=fa.moduleBindings[e][i];if(r)if(typeof n=="object")for(let a in n)r[a]=n[a];else console.warn("Module Error - Invalid value type, it must be an object");else console.warn("Module Error - property does not exist:",i)}else console.warn("Module Error - module does not exist:",e)}static _registerModules(e,i){var n=Object.values(e);i&&n.forEach(r=>{r.prototype.moduleCore=!0}),fa._registerModule(n)}static _registerModule(e){Array.isArray(e)||(e=[e]),e.forEach(i=>{fa._registerModuleBinding(i),fa._registerModuleExtensions(i)})}static _registerModuleBinding(e){e.moduleName?fa.moduleBindings[e.moduleName]=e:console.error("Unable to bind module, no moduleName defined",e.moduleName)}static _registerModuleExtensions(e){var i=e.moduleExtensions;if(e.moduleExtensions)for(let n in i){let r=i[n];if(fa.moduleBindings[n])for(let a in r)fa._extendModule(n,a,r[a]);else{fa.moduleExtensions[n]||(fa.moduleExtensions[n]={});for(let a in r)fa.moduleExtensions[n][a]||(fa.moduleExtensions[n][a]={}),Object.assign(fa.moduleExtensions[n][a],r[a])}}fa._extendModuleFromQueue(e)}static _extendModuleFromQueue(e){var i=fa.moduleExtensions[e.moduleName];if(i)for(let n in i)fa._extendModule(e.moduleName,n,i[n])}_bindModules(){var e=[],i=[],n=[];this.modules={};for(var r in fa.moduleBindings){let a=fa.moduleBindings[r],o=new a(this);this.modules[r]=o,a.prototype.moduleCore?this.modulesCore.push(o):a.moduleInitOrder?a.moduleInitOrder<0?e.push(o):i.push(o):n.push(o)}e.sort((a,o)=>a.moduleInitOrder>o.moduleInitOrder?1:-1),i.sort((a,o)=>a.moduleInitOrder>o.moduleInitOrder?1:-1),this.modulesRegular=e.concat(n.concat(i))}};Je(fa,"moduleBindings",{}),Je(fa,"moduleExtensions",{}),Je(fa,"modulesRegistered",!1),Je(fa,"defaultModules",!1);let mG=fa;class xZe extends dc{constructor(e){super(e),this.element=this._createAlertElement(),this.msgElement=this._createMsgElement(),this.type=null,this.element.appendChild(this.msgElement)}_createAlertElement(){var e=document.createElement("div");return e.classList.add("tabulator-alert"),e}_createMsgElement(){var e=document.createElement("div");return e.classList.add("tabulator-alert-msg"),e.setAttribute("role","alert"),e}_typeClass(){return"tabulator-alert-state-"+this.type}alert(e,i="msg"){if(e){for(this.clear(),this.dispatch("alert-show",i),this.type=i;this.msgElement.firstChild;)this.msgElement.removeChild(this.msgElement.firstChild);this.msgElement.classList.add(this._typeClass()),typeof e=="function"&&(e=e()),e instanceof HTMLElement?this.msgElement.appendChild(e):this.msgElement.innerHTML=e,this.table.element.appendChild(this.element)}}clear(){this.dispatch("alert-hide",this.type),this.element.parentNode&&this.element.parentNode.removeChild(this.element),this.msgElement.classList.remove(this._typeClass())}}const km=class km extends mG{static extendModule(){km.initializeModuleBinder(),km._extendModule(...arguments)}static registerModule(){km.initializeModuleBinder(),km._registerModule(...arguments)}constructor(e,i,n){super(),km.initializeModuleBinder(n),this.options={},this.columnManager=null,this.rowManager=null,this.footerManager=null,this.alertManager=null,this.vdomHoz=null,this.externalEvents=null,this.eventBus=null,this.interactionMonitor=!1,this.browser="",this.browserSlow=!1,this.browserMobile=!1,this.rtl=!1,this.originalElement=null,this.componentFunctionBinder=new UZe(this),this.dataLoader=!1,this.modules={},this.modulesCore=[],this.modulesRegular=[],this.deprecationAdvisor=new PZe(this),this.optionsList=new eUe(this,"table constructor"),this.initialized=!1,this.destroyed=!1,this.initializeElement(e)&&(this.initializeCoreSystems(i),setTimeout(()=>{this._create()})),this.constructor.registry.register(this)}initializeElement(e){return typeof HTMLElement<"u"&&e instanceof HTMLElement?(this.element=e,!0):typeof e=="string"?(this.element=document.querySelector(e),this.element?!0:(console.error("Tabulator Creation Error - no element found matching selector: ",e),!1)):(console.error("Tabulator Creation Error - Invalid element provided:",e),!1)}initializeCoreSystems(e){this.columnManager=new yZe(this),this.rowManager=new wZe(this),this.footerManager=new SZe(this),this.dataLoader=new DZe(this),this.alertManager=new xZe(this),this._bindModules(),this.options=this.optionsList.generate(km.defaultOptions,e),this._clearObjectPointers(),this._mapDeprecatedFunctionality(),this.externalEvents=new EZe(this,this.options,this.options.debugEventsExternal),this.eventBus=new CZe(this.options.debugEventsInternal),this.interactionMonitor=new TZe(this),this.dataLoader.initialize(),this.footerManager.initialize()}_mapDeprecatedFunctionality(){}_clearSelection(){this.element.classList.add("tabulator-block-select"),window.getSelection?window.getSelection().empty?window.getSelection().empty():window.getSelection().removeAllRanges&&window.getSelection().removeAllRanges():document.selection&&document.selection.empty(),this.element.classList.remove("tabulator-block-select")}_create(){this.externalEvents.dispatch("tableBuilding"),this.eventBus.dispatch("table-building"),this._rtlCheck(),this._buildElement(),this._initializeTable(),this.initialized=!0,this._loadInitialData().finally(()=>{this.eventBus.dispatch("table-initialized"),this.externalEvents.dispatch("tableBuilt")})}_rtlCheck(){var e=window.getComputedStyle(this.element);switch(this.options.textDirection){case"auto":if(e.direction!=="rtl")break;case"rtl":this.element.classList.add("tabulator-rtl"),this.rtl=!0;break;case"ltr":this.element.classList.add("tabulator-ltr");default:this.rtl=!1}}_clearObjectPointers(){this.options.columns=this.options.columns.slice(0),Array.isArray(this.options.data)&&!this.options.reactiveData&&(this.options.data=this.options.data.slice(0))}_buildElement(){var e=this.element,i=this.options,n;if(e.tagName==="TABLE"){this.originalElement=this.element,n=document.createElement("div");var r=e.attributes;for(var a in r)typeof r[a]=="object"&&n.setAttribute(r[a].name,r[a].value);e.parentNode.replaceChild(n,e),this.element=e=n}for(e.classList.add("tabulator"),e.setAttribute("role","grid");e.firstChild;)e.removeChild(e.firstChild);i.height&&(i.height=isNaN(i.height)?i.height:i.height+"px",e.style.height=i.height),i.minHeight!==!1&&(i.minHeight=isNaN(i.minHeight)?i.minHeight:i.minHeight+"px",e.style.minHeight=i.minHeight),i.maxHeight!==!1&&(i.maxHeight=isNaN(i.maxHeight)?i.maxHeight:i.maxHeight+"px",e.style.maxHeight=i.maxHeight)}_initializeTable(){var e=this.element,i=this.options;this.interactionMonitor.initialize(),this.columnManager.initialize(),this.rowManager.initialize(),this._detectBrowser(),this.modulesCore.forEach(n=>{n.initialize()}),e.appendChild(this.columnManager.getElement()),e.appendChild(this.rowManager.getElement()),i.footerElement&&this.footerManager.activate(),i.autoColumns&&i.data&&this.columnManager.generateColumnsFromRowData(this.options.data),this.modulesRegular.forEach(n=>{n.initialize()}),this.columnManager.setColumns(i.columns),this.eventBus.dispatch("table-built")}_loadInitialData(){return this.dataLoader.load(this.options.data).finally(()=>{this.columnManager.verticalAlignHeaders()})}destroy(){var e=this.element;for(this.destroyed=!0,this.constructor.registry.deregister(this),this.eventBus.dispatch("table-destroy"),this.rowManager.destroy();e.firstChild;)e.removeChild(e.firstChild);e.classList.remove("tabulator"),this.externalEvents.dispatch("tableDestroyed")}_detectBrowser(){var e=navigator.userAgent||navigator.vendor||window.opera;e.indexOf("Trident")>-1?(this.browser="ie",this.browserSlow=!0):e.indexOf("Edge")>-1?(this.browser="edge",this.browserSlow=!0):e.indexOf("Firefox")>-1?(this.browser="firefox",this.browserSlow=!1):e.indexOf("Mac OS")>-1?(this.browser="safari",this.browserSlow=!1):(this.browser="other",this.browserSlow=!1),this.browserMobile=/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw-(n|u)|c55\/|capi|ccwa|cdm-|cell|chtm|cldc|cmd-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc-s|devi|dica|dmob|do(c|p)o|ds(12|-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(-|_)|g1 u|g560|gene|gf-5|g-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd-(m|p|t)|hei-|hi(pt|ta)|hp( i|ip)|hs-c|ht(c(-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i-(20|go|ma)|i230|iac( |-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|-[a-w])|libw|lynx|m1-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|-([1-8]|c))|phil|pire|pl(ay|uc)|pn-2|po(ck|rt|se)|prox|psio|pt-g|qa-a|qc(07|12|21|32|60|-[2-7]|i-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h-|oo|p-)|sdk\/|se(c(-|0|1)|47|mc|nd|ri)|sgh-|shar|sie(-|m)|sk-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h-|v-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl-|tdg-|tel(i|m)|tim-|t-mo|to(pl|sh)|ts(70|m-|m3|m5)|tx-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas-|your|zeto|zte-/i.test(e.slice(0,4))}initGuard(e,i){var n,r;return this.options.debugInitialization&&!this.initialized&&(e||(n=new Error().stack.split(`
`),r=n[0]=="Error"?n[2]:n[1],r[0]==" "?e=r.trim().split(" ")[1].split(".")[1]:e=r.trim().split("@")[0]),console.warn("Table Not Initialized - Calling the "+e+" function before the table is initialized may result in inconsistent behavior, Please wait for the `tableBuilt` event before calling this function."+(i?" "+i:""))),this.initialized}blockRedraw(){this.initGuard(),this.eventBus.dispatch("redraw-blocking"),this.rowManager.blockRedraw(),this.columnManager.blockRedraw(),this.eventBus.dispatch("redraw-blocked")}restoreRedraw(){this.initGuard(),this.eventBus.dispatch("redraw-restoring"),this.rowManager.restoreRedraw(),this.columnManager.restoreRedraw(),this.eventBus.dispatch("redraw-restored")}setData(e,i,n){return this.initGuard(!1,"To set initial data please use the 'data' property in the table constructor."),this.dataLoader.load(e,i,n,!1)}clearData(){this.initGuard(),this.dataLoader.blockActiveLoad(),this.rowManager.clearData()}getData(e){return this.rowManager.getData(e)}getDataCount(e){return this.rowManager.getDataCount(e)}replaceData(e,i,n){return this.initGuard(),this.dataLoader.load(e,i,n,!0,!0)}updateData(e){var i=0;return this.initGuard(),new Promise((n,r)=>{this.dataLoader.blockActiveLoad(),typeof e=="string"&&(e=JSON.parse(e)),e&&e.length>0?e.forEach(a=>{var o=this.rowManager.findRow(a[this.options.index]);o?(i++,o.updateData(a).then(()=>{i--,i||n()}).catch(s=>{r("Update Error - Unable to update row",a,s)})):r("Update Error - Unable to find row",a)}):(console.warn("Update Error - No data provided"),r("Update Error - No data provided"))})}addData(e,i,n){return this.initGuard(),new Promise((r,a)=>{this.dataLoader.blockActiveLoad(),typeof e=="string"&&(e=JSON.parse(e)),e?this.rowManager.addRows(e,i,n).then(o=>{var s=[];o.forEach(function(l){s.push(l.getComponent())}),r(s)}):(console.warn("Update Error - No data provided"),a("Update Error - No data provided"))})}updateOrAddData(e){var i=[],n=0;return this.initGuard(),new Promise((r,a)=>{this.dataLoader.blockActiveLoad(),typeof e=="string"&&(e=JSON.parse(e)),e&&e.length>0?e.forEach(o=>{var s=this.rowManager.findRow(o[this.options.index]);n++,s?s.updateData(o).then(()=>{n--,i.push(s.getComponent()),n||r(i)}):this.rowManager.addRows(o).then(l=>{n--,i.push(l[0].getComponent()),n||r(i)})}):(console.warn("Update Error - No data provided"),a("Update Error - No data provided"))})}getRow(e){var i=this.rowManager.findRow(e);return i?i.getComponent():(console.warn("Find Error - No matching row found:",e),!1)}getRowFromPosition(e){var i=this.rowManager.getRowFromPosition(e);return i?i.getComponent():(console.warn("Find Error - No matching row found:",e),!1)}deleteRow(e){var i=[];this.initGuard(),Array.isArray(e)||(e=[e]);for(let n of e){let r=this.rowManager.findRow(n,!0);if(r)i.push(r);else return console.error("Delete Error - No matching row found:",n),Promise.reject("Delete Error - No matching row found")}return i.sort((n,r)=>this.rowManager.rows.indexOf(n)>this.rowManager.rows.indexOf(r)?1:-1),i.forEach(n=>{n.delete()}),this.rowManager.reRenderInPosition(),Promise.resolve()}addRow(e,i,n){return this.initGuard(),typeof e=="string"&&(e=JSON.parse(e)),this.rowManager.addRows(e,i,n,!0).then(r=>r[0].getComponent())}updateOrAddRow(e,i){var n=this.rowManager.findRow(e);return this.initGuard(),typeof i=="string"&&(i=JSON.parse(i)),n?n.updateData(i).then(()=>n.getComponent()):this.rowManager.addRows(i).then(r=>r[0].getComponent())}updateRow(e,i){var n=this.rowManager.findRow(e);return this.initGuard(),typeof i=="string"&&(i=JSON.parse(i)),n?n.updateData(i).then(()=>Promise.resolve(n.getComponent())):(console.warn("Update Error - No matching row found:",e),Promise.reject("Update Error - No matching row found"))}scrollToRow(e,i,n){var r=this.rowManager.findRow(e);return r?this.rowManager.scrollToRow(r,i,n):(console.warn("Scroll Error - No matching row found:",e),Promise.reject("Scroll Error - No matching row found"))}moveRow(e,i,n){var r=this.rowManager.findRow(e);this.initGuard(),r?r.moveToRow(i,n):console.warn("Move Error - No matching row found:",e)}getRows(e){return this.rowManager.getComponents(e)}getRowPosition(e){var i=this.rowManager.findRow(e);return i?i.getPosition():(console.warn("Position Error - No matching row found:",e),!1)}setColumns(e){this.initGuard(!1,"To set initial columns please use the 'columns' property in the table constructor"),this.columnManager.setColumns(e)}getColumns(e){return this.columnManager.getComponents(e)}getColumn(e){var i=this.columnManager.findColumn(e);return i?i.getComponent():(console.warn("Find Error - No matching column found:",e),!1)}getColumnDefinitions(){return this.columnManager.getDefinitionTree()}showColumn(e){var i=this.columnManager.findColumn(e);if(this.initGuard(),i)i.show();else return console.warn("Column Show Error - No matching column found:",e),!1}hideColumn(e){var i=this.columnManager.findColumn(e);if(this.initGuard(),i)i.hide();else return console.warn("Column Hide Error - No matching column found:",e),!1}toggleColumn(e){var i=this.columnManager.findColumn(e);if(this.initGuard(),i)i.visible?i.hide():i.show();else return console.warn("Column Visibility Toggle Error - No matching column found:",e),!1}addColumn(e,i,n){var r=this.columnManager.findColumn(n);return this.initGuard(),this.columnManager.addColumn(e,i,r).then(a=>a.getComponent())}deleteColumn(e){var i=this.columnManager.findColumn(e);return this.initGuard(),i?i.delete():(console.warn("Column Delete Error - No matching column found:",e),Promise.reject())}updateColumnDefinition(e,i){var n=this.columnManager.findColumn(e);return this.initGuard(),n?n.updateDefinition(i):(console.warn("Column Update Error - No matching column found:",e),Promise.reject())}moveColumn(e,i,n){var r=this.columnManager.findColumn(e),a=this.columnManager.findColumn(i);this.initGuard(),r?a?this.columnManager.moveColumn(r,a,n):console.warn("Move Error - No matching column found:",a):console.warn("Move Error - No matching column found:",e)}scrollToColumn(e,i,n){return new Promise((r,a)=>{var o=this.columnManager.findColumn(e);return o?this.columnManager.scrollToColumn(o,i,n):(console.warn("Scroll Error - No matching column found:",e),Promise.reject("Scroll Error - No matching column found"))})}redraw(e){this.initGuard(),this.columnManager.redraw(e),this.rowManager.redraw(e)}setHeight(e){this.options.height=isNaN(e)?e:e+"px",this.element.style.height=this.options.height,this.rowManager.initializeRenderer(),this.rowManager.redraw(!0)}on(e,i){this.externalEvents.subscribe(e,i)}off(e,i){this.externalEvents.unsubscribe(e,i)}dispatchEvent(){var e=Array.from(arguments);e.shift(),this.externalEvents.dispatch(...arguments)}alert(e,i){this.initGuard(),this.alertManager.alert(e,i)}clearAlert(){this.initGuard(),this.alertManager.clear()}modExists(e,i){return this.modules[e]?!0:(i&&console.error("Tabulator Module Not Installed: "+e),!1)}module(e){var i=this.modules[e];return i||console.error("Tabulator module not installed: "+e),i}};Je(km,"defaultOptions",mZe);let gG=km;var i1=gG;class OZe extends i1{static extendModule(){i1.initializeModuleBinder(U$),i1._extendModule(...arguments)}static registerModule(){i1.initializeModuleBinder(U$),i1._registerModule(...arguments)}constructor(e,i,n){super(e,i,U$)}}var Go=OZe;const{MALE:LZe,FEMALE:FZe}=Mp;function BZe(t){var o;const e=t.getValue(),i=t.getRow().getData(),n=i.sex||((o=i.person)==null?void 0:o.sex),r=(n==null?void 0:n.toUpperCase())===LZe&&"#2E86C1"||(n==null?void 0:n.toUpperCase())===FZe&&"#AA336A"||"",a=document.createElement("div");return a.style.color=r,a.innerHTML=e,a}function $Ze(t){return[{visible:t.some(i=>i.drawPosition),field:"drawPosition",title:"Position",headerSort:!1,responsive:!1,editor:!1,maxWidth:100},{formatter:BZe,field:"participantName",title:"Participant",responsive:!1,minWidth:200,widthGrow:2}]}function iUe(t){let{data:e=[]}=t;const{selectedParticipantIds:i,selectionLimit:n=1,targetAttribute:r,placeholder:a,onSelected:o,anchorId:s}=t;e.some(p=>p.participant)&&(e=e.map(({participant:p,...h})=>({...h,participantName:"BYE",...p}))),e.forEach(p=>{var h;return p.searchText=(h=p.participantName)==null?void 0:h.toLowerCase()});const c=$Ze(e),u=document.getElementById(s),d=new Go(u,{placeholder:a||"No options",selectableRows:n,index:r,layout:"fitColumns",reactiveData:!0,maxHeight:350,columns:c,data:e});return Tt.tables||(Tt.tables={}),Tt.tables.selectionTable=d,d.on("tableBuilt",()=>{i!=null&&i.length&&d.selectRow(i)}),d.on("rowSelectionChanged",(p,h)=>{const f=h==null?void 0:h.map(m=>m.getData());Nt(o)&&o(f)}),{table:d}}function c9(t){const{title:e,placeholder:i,options:n,selectionLimit:r}=t,a="selectionControl",o="selectionTable",s=[{label:"Cancel",intent:"is-none",close:!0}],l=()=>{const m=Tt.tables.selectionTable;m==null||m.destroy(),delete Tt.tables.selectionTable},c=`
    <div style='min-height: 420px'>
      <div id='${a}'></div>
      <div id='${o}'></div>
    </div>
  `;cr({title:e,content:c,buttons:s,onClose:l});const u=m=>{var g;(g=m==null?void 0:m[0])!=null&&g.onClick&&(m[0].onClick(),yI())},{table:d}=iUe({targetAttribute:"participantid",selectionLimit:r,data:n,placeholder:i,onSelected:u,anchorId:o}),p=Ew(d),h=[{onKeyDown:m=>m.keyCode===8&&m.target.value.length===1&&p(""),onChange:m=>p(m.target.value),onKeyUp:m=>p(m.target.value),clearSearch:()=>p(""),placeholder:"Search",location:ci,search:!0}],f=document.getElementById(a);Ns({table:d,target:f,items:h})}var Uu="top",Dp="bottom",Ep="right",Du="left",u9="auto",XR=[Uu,Dp,Ep,Du],JS="start",AE="end",VZe="clippingParents",nUe="viewport",n1="popper",jZe="reference",XX=XR.reduce(function(t,e){return t.concat([e+"-"+JS,e+"-"+AE])},[]),rUe=[].concat(XR,[u9]).reduce(function(t,e){return t.concat([e,e+"-"+JS,e+"-"+AE])},[]),GZe="beforeRead",HZe="read",zZe="afterRead",qZe="beforeMain",WZe="main",KZe="afterMain",YZe="beforeWrite",ZZe="write",XZe="afterWrite",JZe=[GZe,HZe,zZe,qZe,WZe,KZe,YZe,ZZe,XZe];function zf(t){return t?(t.nodeName||"").toLowerCase():null}function Ed(t){if(t==null)return window;if(t.toString()!=="[object Window]"){var e=t.ownerDocument;return e&&e.defaultView||window}return t}function bI(t){var e=Ed(t).Element;return t instanceof e||t instanceof Element}function op(t){var e=Ed(t).HTMLElement;return t instanceof e||t instanceof HTMLElement}function d9(t){if(typeof ShadowRoot>"u")return!1;var e=Ed(t).ShadowRoot;return t instanceof e||t instanceof ShadowRoot}function QZe(t){var e=t.state;Object.keys(e.elements).forEach(function(i){var n=e.styles[i]||{},r=e.attributes[i]||{},a=e.elements[i];!op(a)||!zf(a)||(Object.assign(a.style,n),Object.keys(r).forEach(function(o){var s=r[o];s===!1?a.removeAttribute(o):a.setAttribute(o,s===!0?"":s)}))})}function eXe(t){var e=t.state,i={popper:{position:e.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};return Object.assign(e.elements.popper.style,i.popper),e.styles=i,e.elements.arrow&&Object.assign(e.elements.arrow.style,i.arrow),function(){Object.keys(e.elements).forEach(function(n){var r=e.elements[n],a=e.attributes[n]||{},o=Object.keys(e.styles.hasOwnProperty(n)?e.styles[n]:i[n]),s=o.reduce(function(l,c){return l[c]="",l},{});!op(r)||!zf(r)||(Object.assign(r.style,s),Object.keys(a).forEach(function(l){r.removeAttribute(l)}))})}}const aUe={name:"applyStyles",enabled:!0,phase:"write",fn:QZe,effect:eXe,requires:["computeStyles"]};function bf(t){return t.split("-")[0]}var Hb=Math.max,J_=Math.min,QS=Math.round;function vG(){var t=navigator.userAgentData;return t!=null&&t.brands&&Array.isArray(t.brands)?t.brands.map(function(e){return e.brand+"/"+e.version}).join(" "):navigator.userAgent}function oUe(){return!/^((?!chrome|android).)*safari/i.test(vG())}function eT(t,e,i){e===void 0&&(e=!1),i===void 0&&(i=!1);var n=t.getBoundingClientRect(),r=1,a=1;e&&op(t)&&(r=t.offsetWidth>0&&QS(n.width)/t.offsetWidth||1,a=t.offsetHeight>0&&QS(n.height)/t.offsetHeight||1);var o=bI(t)?Ed(t):window,s=o.visualViewport,l=!oUe()&&i,c=(n.left+(l&&s?s.offsetLeft:0))/r,u=(n.top+(l&&s?s.offsetTop:0))/a,d=n.width/r,p=n.height/a;return{width:d,height:p,top:u,right:c+d,bottom:u+p,left:c,x:c,y:u}}function p9(t){var e=eT(t),i=t.offsetWidth,n=t.offsetHeight;return Math.abs(e.width-i)<=1&&(i=e.width),Math.abs(e.height-n)<=1&&(n=e.height),{x:t.offsetLeft,y:t.offsetTop,width:i,height:n}}function sUe(t,e){var i=e.getRootNode&&e.getRootNode();if(t.contains(e))return!0;if(i&&d9(i)){var n=e;do{if(n&&t.isSameNode(n))return!0;n=n.parentNode||n.host}while(n)}return!1}function hg(t){return Ed(t).getComputedStyle(t)}function tXe(t){return["table","td","th"].indexOf(zf(t))>=0}function Wy(t){return((bI(t)?t.ownerDocument:t.document)||window.document).documentElement}function zF(t){return zf(t)==="html"?t:t.assignedSlot||t.parentNode||(d9(t)?t.host:null)||Wy(t)}function JX(t){return!op(t)||hg(t).position==="fixed"?null:t.offsetParent}function iXe(t){var e=/firefox/i.test(vG()),i=/Trident/i.test(vG());if(i&&op(t)){var n=hg(t);if(n.position==="fixed")return null}var r=zF(t);for(d9(r)&&(r=r.host);op(r)&&["html","body"].indexOf(zf(r))<0;){var a=hg(r);if(a.transform!=="none"||a.perspective!=="none"||a.contain==="paint"||["transform","perspective"].indexOf(a.willChange)!==-1||e&&a.willChange==="filter"||e&&a.filter&&a.filter!=="none")return r;r=r.parentNode}return null}function JR(t){for(var e=Ed(t),i=JX(t);i&&tXe(i)&&hg(i).position==="static";)i=JX(i);return i&&(zf(i)==="html"||zf(i)==="body"&&hg(i).position==="static")?e:i||iXe(t)||e}function h9(t){return["top","bottom"].indexOf(t)>=0?"x":"y"}function tD(t,e,i){return Hb(t,J_(e,i))}function nXe(t,e,i){var n=tD(t,e,i);return n>i?i:n}function lUe(){return{top:0,right:0,bottom:0,left:0}}function cUe(t){return Object.assign({},lUe(),t)}function uUe(t,e){return e.reduce(function(i,n){return i[n]=t,i},{})}var rXe=function(e,i){return e=typeof e=="function"?e(Object.assign({},i.rects,{placement:i.placement})):e,cUe(typeof e!="number"?e:uUe(e,XR))};function aXe(t){var e,i=t.state,n=t.name,r=t.options,a=i.elements.arrow,o=i.modifiersData.popperOffsets,s=bf(i.placement),l=h9(s),c=[Du,Ep].indexOf(s)>=0,u=c?"height":"width";if(!(!a||!o)){var d=rXe(r.padding,i),p=p9(a),h=l==="y"?Uu:Du,f=l==="y"?Dp:Ep,m=i.rects.reference[u]+i.rects.reference[l]-o[l]-i.rects.popper[u],g=o[l]-i.rects.reference[l],v=JR(a),y=v?l==="y"?v.clientHeight||0:v.clientWidth||0:0,b=m/2-g/2,I=d[h],T=y-p[u]-d[f],w=y/2-p[u]/2+b,S=tD(I,w,T),D=l;i.modifiersData[n]=(e={},e[D]=S,e.centerOffset=S-w,e)}}function oXe(t){var e=t.state,i=t.options,n=i.element,r=n===void 0?"[data-popper-arrow]":n;r!=null&&(typeof r=="string"&&(r=e.elements.popper.querySelector(r),!r)||sUe(e.elements.popper,r)&&(e.elements.arrow=r))}const sXe={name:"arrow",enabled:!0,phase:"main",fn:aXe,effect:oXe,requires:["popperOffsets"],requiresIfExists:["preventOverflow"]};function tT(t){return t.split("-")[1]}var lXe={top:"auto",right:"auto",bottom:"auto",left:"auto"};function cXe(t,e){var i=t.x,n=t.y,r=e.devicePixelRatio||1;return{x:QS(i*r)/r||0,y:QS(n*r)/r||0}}function QX(t){var e,i=t.popper,n=t.popperRect,r=t.placement,a=t.variation,o=t.offsets,s=t.position,l=t.gpuAcceleration,c=t.adaptive,u=t.roundOffsets,d=t.isFixed,p=o.x,h=p===void 0?0:p,f=o.y,m=f===void 0?0:f,g=typeof u=="function"?u({x:h,y:m}):{x:h,y:m};h=g.x,m=g.y;var v=o.hasOwnProperty("x"),y=o.hasOwnProperty("y"),b=Du,I=Uu,T=window;if(c){var w=JR(i),S="clientHeight",D="clientWidth";if(w===Ed(i)&&(w=Wy(i),hg(w).position!=="static"&&s==="absolute"&&(S="scrollHeight",D="scrollWidth")),w=w,r===Uu||(r===Du||r===Ep)&&a===AE){I=Dp;var E=d&&w===T&&T.visualViewport?T.visualViewport.height:w[S];m-=E-n.height,m*=l?1:-1}if(r===Du||(r===Uu||r===Dp)&&a===AE){b=Ep;var C=d&&w===T&&T.visualViewport?T.visualViewport.width:w[D];h-=C-n.width,h*=l?1:-1}}var P=Object.assign({position:s},c&&lXe),R=u===!0?cXe({x:h,y:m},Ed(i)):{x:h,y:m};if(h=R.x,m=R.y,l){var N;return Object.assign({},P,(N={},N[I]=y?"0":"",N[b]=v?"0":"",N.transform=(T.devicePixelRatio||1)<=1?"translate("+h+"px, "+m+"px)":"translate3d("+h+"px, "+m+"px, 0)",N))}return Object.assign({},P,(e={},e[I]=y?m+"px":"",e[b]=v?h+"px":"",e.transform="",e))}function uXe(t){var e=t.state,i=t.options,n=i.gpuAcceleration,r=n===void 0?!0:n,a=i.adaptive,o=a===void 0?!0:a,s=i.roundOffsets,l=s===void 0?!0:s,c={placement:bf(e.placement),variation:tT(e.placement),popper:e.elements.popper,popperRect:e.rects.popper,gpuAcceleration:r,isFixed:e.options.strategy==="fixed"};e.modifiersData.popperOffsets!=null&&(e.styles.popper=Object.assign({},e.styles.popper,QX(Object.assign({},c,{offsets:e.modifiersData.popperOffsets,position:e.options.strategy,adaptive:o,roundOffsets:l})))),e.modifiersData.arrow!=null&&(e.styles.arrow=Object.assign({},e.styles.arrow,QX(Object.assign({},c,{offsets:e.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:l})))),e.attributes.popper=Object.assign({},e.attributes.popper,{"data-popper-placement":e.placement})}const dXe={name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:uXe,data:{}};var NM={passive:!0};function pXe(t){var e=t.state,i=t.instance,n=t.options,r=n.scroll,a=r===void 0?!0:r,o=n.resize,s=o===void 0?!0:o,l=Ed(e.elements.popper),c=[].concat(e.scrollParents.reference,e.scrollParents.popper);return a&&c.forEach(function(u){u.addEventListener("scroll",i.update,NM)}),s&&l.addEventListener("resize",i.update,NM),function(){a&&c.forEach(function(u){u.removeEventListener("scroll",i.update,NM)}),s&&l.removeEventListener("resize",i.update,NM)}}const hXe={name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect:pXe,data:{}};var fXe={left:"right",right:"left",bottom:"top",top:"bottom"};function XN(t){return t.replace(/left|right|bottom|top/g,function(e){return fXe[e]})}var mXe={start:"end",end:"start"};function eJ(t){return t.replace(/start|end/g,function(e){return mXe[e]})}function f9(t){var e=Ed(t),i=e.pageXOffset,n=e.pageYOffset;return{scrollLeft:i,scrollTop:n}}function m9(t){return eT(Wy(t)).left+f9(t).scrollLeft}function gXe(t,e){var i=Ed(t),n=Wy(t),r=i.visualViewport,a=n.clientWidth,o=n.clientHeight,s=0,l=0;if(r){a=r.width,o=r.height;var c=oUe();(c||!c&&e==="fixed")&&(s=r.offsetLeft,l=r.offsetTop)}return{width:a,height:o,x:s+m9(t),y:l}}function vXe(t){var e,i=Wy(t),n=f9(t),r=(e=t.ownerDocument)==null?void 0:e.body,a=Hb(i.scrollWidth,i.clientWidth,r?r.scrollWidth:0,r?r.clientWidth:0),o=Hb(i.scrollHeight,i.clientHeight,r?r.scrollHeight:0,r?r.clientHeight:0),s=-n.scrollLeft+m9(t),l=-n.scrollTop;return hg(r||i).direction==="rtl"&&(s+=Hb(i.clientWidth,r?r.clientWidth:0)-a),{width:a,height:o,x:s,y:l}}function g9(t){var e=hg(t),i=e.overflow,n=e.overflowX,r=e.overflowY;return/auto|scroll|overlay|hidden/.test(i+r+n)}function dUe(t){return["html","body","#document"].indexOf(zf(t))>=0?t.ownerDocument.body:op(t)&&g9(t)?t:dUe(zF(t))}function iD(t,e){var i;e===void 0&&(e=[]);var n=dUe(t),r=n===((i=t.ownerDocument)==null?void 0:i.body),a=Ed(n),o=r?[a].concat(a.visualViewport||[],g9(n)?n:[]):n,s=e.concat(o);return r?s:s.concat(iD(zF(o)))}function yG(t){return Object.assign({},t,{left:t.x,top:t.y,right:t.x+t.width,bottom:t.y+t.height})}function yXe(t,e){var i=eT(t,!1,e==="fixed");return i.top=i.top+t.clientTop,i.left=i.left+t.clientLeft,i.bottom=i.top+t.clientHeight,i.right=i.left+t.clientWidth,i.width=t.clientWidth,i.height=t.clientHeight,i.x=i.left,i.y=i.top,i}function tJ(t,e,i){return e===nUe?yG(gXe(t,i)):bI(e)?yXe(e,i):yG(vXe(Wy(t)))}function bXe(t){var e=iD(zF(t)),i=["absolute","fixed"].indexOf(hg(t).position)>=0,n=i&&op(t)?JR(t):t;return bI(n)?e.filter(function(r){return bI(r)&&sUe(r,n)&&zf(r)!=="body"}):[]}function IXe(t,e,i,n){var r=e==="clippingParents"?bXe(t):[].concat(e),a=[].concat(r,[i]),o=a[0],s=a.reduce(function(l,c){var u=tJ(t,c,n);return l.top=Hb(u.top,l.top),l.right=J_(u.right,l.right),l.bottom=J_(u.bottom,l.bottom),l.left=Hb(u.left,l.left),l},tJ(t,o,n));return s.width=s.right-s.left,s.height=s.bottom-s.top,s.x=s.left,s.y=s.top,s}function pUe(t){var e=t.reference,i=t.element,n=t.placement,r=n?bf(n):null,a=n?tT(n):null,o=e.x+e.width/2-i.width/2,s=e.y+e.height/2-i.height/2,l;switch(r){case Uu:l={x:o,y:e.y-i.height};break;case Dp:l={x:o,y:e.y+e.height};break;case Ep:l={x:e.x+e.width,y:s};break;case Du:l={x:e.x-i.width,y:s};break;default:l={x:e.x,y:e.y}}var c=r?h9(r):null;if(c!=null){var u=c==="y"?"height":"width";switch(a){case JS:l[c]=l[c]-(e[u]/2-i[u]/2);break;case AE:l[c]=l[c]+(e[u]/2-i[u]/2);break}}return l}function _E(t,e){e===void 0&&(e={});var i=e,n=i.placement,r=n===void 0?t.placement:n,a=i.strategy,o=a===void 0?t.strategy:a,s=i.boundary,l=s===void 0?VZe:s,c=i.rootBoundary,u=c===void 0?nUe:c,d=i.elementContext,p=d===void 0?n1:d,h=i.altBoundary,f=h===void 0?!1:h,m=i.padding,g=m===void 0?0:m,v=cUe(typeof g!="number"?g:uUe(g,XR)),y=p===n1?jZe:n1,b=t.rects.popper,I=t.elements[f?y:p],T=IXe(bI(I)?I:I.contextElement||Wy(t.elements.popper),l,u,o),w=eT(t.elements.reference),S=pUe({reference:w,element:b,strategy:"absolute",placement:r}),D=yG(Object.assign({},b,S)),E=p===n1?D:w,C={top:T.top-E.top+v.top,bottom:E.bottom-T.bottom+v.bottom,left:T.left-E.left+v.left,right:E.right-T.right+v.right},P=t.modifiersData.offset;if(p===n1&&P){var R=P[r];Object.keys(C).forEach(function(N){var M=[Ep,Dp].indexOf(N)>=0?1:-1,A=[Uu,Dp].indexOf(N)>=0?"y":"x";C[N]+=R[A]*M})}return C}function wXe(t,e){e===void 0&&(e={});var i=e,n=i.placement,r=i.boundary,a=i.rootBoundary,o=i.padding,s=i.flipVariations,l=i.allowedAutoPlacements,c=l===void 0?rUe:l,u=tT(n),d=u?s?XX:XX.filter(function(f){return tT(f)===u}):XR,p=d.filter(function(f){return c.indexOf(f)>=0});p.length===0&&(p=d);var h=p.reduce(function(f,m){return f[m]=_E(t,{placement:m,boundary:r,rootBoundary:a,padding:o})[bf(m)],f},{});return Object.keys(h).sort(function(f,m){return h[f]-h[m]})}function SXe(t){if(bf(t)===u9)return[];var e=XN(t);return[eJ(t),e,eJ(e)]}function TXe(t){var e=t.state,i=t.options,n=t.name;if(!e.modifiersData[n]._skip){for(var r=i.mainAxis,a=r===void 0?!0:r,o=i.altAxis,s=o===void 0?!0:o,l=i.fallbackPlacements,c=i.padding,u=i.boundary,d=i.rootBoundary,p=i.altBoundary,h=i.flipVariations,f=h===void 0?!0:h,m=i.allowedAutoPlacements,g=e.options.placement,v=bf(g),y=v===g,b=l||(y||!f?[XN(g)]:SXe(g)),I=[g].concat(b).reduce(function(q,z){return q.concat(bf(z)===u9?wXe(e,{placement:z,boundary:u,rootBoundary:d,padding:c,flipVariations:f,allowedAutoPlacements:m}):z)},[]),T=e.rects.reference,w=e.rects.popper,S=new Map,D=!0,E=I[0],C=0;C<I.length;C++){var P=I[C],R=bf(P),N=tT(P)===JS,M=[Uu,Dp].indexOf(R)>=0,A=M?"width":"height",_=_E(e,{placement:P,boundary:u,rootBoundary:d,altBoundary:p,padding:c}),x=M?N?Ep:Du:N?Dp:Uu;T[A]>w[A]&&(x=XN(x));var O=XN(x),B=[];if(a&&B.push(_[R]<=0),s&&B.push(_[x]<=0,_[O]<=0),B.every(function(q){return q})){E=P,D=!1;break}S.set(P,B)}if(D)for(var F=f?3:1,G=function(z){var Z=I.find(function(Y){var Q=S.get(Y);if(Q)return Q.slice(0,z).every(function(X){return X})});if(Z)return E=Z,"break"},H=F;H>0;H--){var $=G(H);if($==="break")break}e.placement!==E&&(e.modifiersData[n]._skip=!0,e.placement=E,e.reset=!0)}}const UXe={name:"flip",enabled:!0,phase:"main",fn:TXe,requiresIfExists:["offset"],data:{_skip:!1}};function iJ(t,e,i){return i===void 0&&(i={x:0,y:0}),{top:t.top-e.height-i.y,right:t.right-e.width+i.x,bottom:t.bottom-e.height+i.y,left:t.left-e.width-i.x}}function nJ(t){return[Uu,Ep,Dp,Du].some(function(e){return t[e]>=0})}function DXe(t){var e=t.state,i=t.name,n=e.rects.reference,r=e.rects.popper,a=e.modifiersData.preventOverflow,o=_E(e,{elementContext:"reference"}),s=_E(e,{altBoundary:!0}),l=iJ(o,n),c=iJ(s,r,a),u=nJ(l),d=nJ(c);e.modifiersData[i]={referenceClippingOffsets:l,popperEscapeOffsets:c,isReferenceHidden:u,hasPopperEscaped:d},e.attributes.popper=Object.assign({},e.attributes.popper,{"data-popper-reference-hidden":u,"data-popper-escaped":d})}const EXe={name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"],fn:DXe};function CXe(t,e,i){var n=bf(t),r=[Du,Uu].indexOf(n)>=0?-1:1,a=typeof i=="function"?i(Object.assign({},e,{placement:t})):i,o=a[0],s=a[1];return o=o||0,s=(s||0)*r,[Du,Ep].indexOf(n)>=0?{x:s,y:o}:{x:o,y:s}}function PXe(t){var e=t.state,i=t.options,n=t.name,r=i.offset,a=r===void 0?[0,0]:r,o=rUe.reduce(function(u,d){return u[d]=CXe(d,e.rects,a),u},{}),s=o[e.placement],l=s.x,c=s.y;e.modifiersData.popperOffsets!=null&&(e.modifiersData.popperOffsets.x+=l,e.modifiersData.popperOffsets.y+=c),e.modifiersData[n]=o}const RXe={name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:PXe};function MXe(t){var e=t.state,i=t.name;e.modifiersData[i]=pUe({reference:e.rects.reference,element:e.rects.popper,strategy:"absolute",placement:e.placement})}const NXe={name:"popperOffsets",enabled:!0,phase:"read",fn:MXe,data:{}};function AXe(t){return t==="x"?"y":"x"}function _Xe(t){var e=t.state,i=t.options,n=t.name,r=i.mainAxis,a=r===void 0?!0:r,o=i.altAxis,s=o===void 0?!1:o,l=i.boundary,c=i.rootBoundary,u=i.altBoundary,d=i.padding,p=i.tether,h=p===void 0?!0:p,f=i.tetherOffset,m=f===void 0?0:f,g=_E(e,{boundary:l,rootBoundary:c,padding:d,altBoundary:u}),v=bf(e.placement),y=tT(e.placement),b=!y,I=h9(v),T=AXe(I),w=e.modifiersData.popperOffsets,S=e.rects.reference,D=e.rects.popper,E=typeof m=="function"?m(Object.assign({},e.rects,{placement:e.placement})):m,C=typeof E=="number"?{mainAxis:E,altAxis:E}:Object.assign({mainAxis:0,altAxis:0},E),P=e.modifiersData.offset?e.modifiersData.offset[e.placement]:null,R={x:0,y:0};if(w){if(a){var N,M=I==="y"?Uu:Du,A=I==="y"?Dp:Ep,_=I==="y"?"height":"width",x=w[I],O=x+g[M],B=x-g[A],F=h?-D[_]/2:0,G=y===JS?S[_]:D[_],H=y===JS?-D[_]:-S[_],$=e.elements.arrow,q=h&&$?p9($):{width:0,height:0},z=e.modifiersData["arrow#persistent"]?e.modifiersData["arrow#persistent"].padding:lUe(),Z=z[M],Y=z[A],Q=tD(0,S[_],q[_]),X=b?S[_]/2-F-Q-Z-C.mainAxis:G-Q-Z-C.mainAxis,oe=b?-S[_]/2+F+Q+Y+C.mainAxis:H+Q+Y+C.mainAxis,re=e.elements.arrow&&JR(e.elements.arrow),me=re?I==="y"?re.clientTop||0:re.clientLeft||0:0,se=(N=P==null?void 0:P[I])!=null?N:0,te=x+X-se-me,he=x+oe-se,ae=tD(h?J_(O,te):O,x,h?Hb(B,he):B);w[I]=ae,R[I]=ae-x}if(s){var de,Ie=I==="x"?Uu:Du,De=I==="x"?Dp:Ep,Te=w[T],_e=T==="y"?"height":"width",Ve=Te+g[Ie],ot=Te-g[De],St=[Uu,Du].indexOf(v)!==-1,nt=(de=P==null?void 0:P[T])!=null?de:0,Bt=St?Ve:Te-S[_e]-D[_e]-nt+C.altAxis,Pe=St?Te+S[_e]+D[_e]-nt-C.altAxis:ot,et=h&&St?nXe(Bt,Te,Pe):tD(h?Bt:Ve,Te,h?Pe:ot);w[T]=et,R[T]=et-Te}e.modifiersData[n]=R}}const kXe={name:"preventOverflow",enabled:!0,phase:"main",fn:_Xe,requiresIfExists:["offset"]};function xXe(t){return{scrollLeft:t.scrollLeft,scrollTop:t.scrollTop}}function OXe(t){return t===Ed(t)||!op(t)?f9(t):xXe(t)}function LXe(t){var e=t.getBoundingClientRect(),i=QS(e.width)/t.offsetWidth||1,n=QS(e.height)/t.offsetHeight||1;return i!==1||n!==1}function FXe(t,e,i){i===void 0&&(i=!1);var n=op(e),r=op(e)&&LXe(e),a=Wy(e),o=eT(t,r,i),s={scrollLeft:0,scrollTop:0},l={x:0,y:0};return(n||!n&&!i)&&((zf(e)!=="body"||g9(a))&&(s=OXe(e)),op(e)?(l=eT(e,!0),l.x+=e.clientLeft,l.y+=e.clientTop):a&&(l.x=m9(a))),{x:o.left+s.scrollLeft-l.x,y:o.top+s.scrollTop-l.y,width:o.width,height:o.height}}function BXe(t){var e=new Map,i=new Set,n=[];t.forEach(function(a){e.set(a.name,a)});function r(a){i.add(a.name);var o=[].concat(a.requires||[],a.requiresIfExists||[]);o.forEach(function(s){if(!i.has(s)){var l=e.get(s);l&&r(l)}}),n.push(a)}return t.forEach(function(a){i.has(a.name)||r(a)}),n}function $Xe(t){var e=BXe(t);return JZe.reduce(function(i,n){return i.concat(e.filter(function(r){return r.phase===n}))},[])}function VXe(t){var e;return function(){return e||(e=new Promise(function(i){Promise.resolve().then(function(){e=void 0,i(t())})})),e}}function jXe(t){var e=t.reduce(function(i,n){var r=i[n.name];return i[n.name]=r?Object.assign({},r,n,{options:Object.assign({},r.options,n.options),data:Object.assign({},r.data,n.data)}):n,i},{});return Object.keys(e).map(function(i){return e[i]})}var rJ={placement:"bottom",modifiers:[],strategy:"absolute"};function aJ(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];return!e.some(function(n){return!(n&&typeof n.getBoundingClientRect=="function")})}function GXe(t){t===void 0&&(t={});var e=t,i=e.defaultModifiers,n=i===void 0?[]:i,r=e.defaultOptions,a=r===void 0?rJ:r;return function(s,l,c){c===void 0&&(c=a);var u={placement:"bottom",orderedModifiers:[],options:Object.assign({},rJ,a),modifiersData:{},elements:{reference:s,popper:l},attributes:{},styles:{}},d=[],p=!1,h={state:u,setOptions:function(v){var y=typeof v=="function"?v(u.options):v;m(),u.options=Object.assign({},a,u.options,y),u.scrollParents={reference:bI(s)?iD(s):s.contextElement?iD(s.contextElement):[],popper:iD(l)};var b=$Xe(jXe([].concat(n,u.options.modifiers)));return u.orderedModifiers=b.filter(function(I){return I.enabled}),f(),h.update()},forceUpdate:function(){if(!p){var v=u.elements,y=v.reference,b=v.popper;if(aJ(y,b)){u.rects={reference:FXe(y,JR(b),u.options.strategy==="fixed"),popper:p9(b)},u.reset=!1,u.placement=u.options.placement,u.orderedModifiers.forEach(function(C){return u.modifiersData[C.name]=Object.assign({},C.data)});for(var I=0;I<u.orderedModifiers.length;I++){if(u.reset===!0){u.reset=!1,I=-1;continue}var T=u.orderedModifiers[I],w=T.fn,S=T.options,D=S===void 0?{}:S,E=T.name;typeof w=="function"&&(u=w({state:u,options:D,name:E,instance:h})||u)}}}},update:VXe(function(){return new Promise(function(g){h.forceUpdate(),g(u)})}),destroy:function(){m(),p=!0}};if(!aJ(s,l))return h;h.setOptions(c).then(function(g){!p&&c.onFirstUpdate&&c.onFirstUpdate(g)});function f(){u.orderedModifiers.forEach(function(g){var v=g.name,y=g.options,b=y===void 0?{}:y,I=g.effect;if(typeof I=="function"){var T=I({state:u,name:v,instance:h,options:b}),w=function(){};d.push(T||w)}})}function m(){d.forEach(function(g){return g()}),d=[]}return h}}var HXe=[hXe,NXe,dXe,aUe,RXe,UXe,kXe,sXe,EXe],zXe=GXe({defaultModifiers:HXe}),qXe="tippy-box",hUe="tippy-content",WXe="tippy-backdrop",fUe="tippy-arrow",mUe="tippy-svg-arrow",lb={passive:!0,capture:!0},gUe=function(){return document.body};function D$(t,e,i){if(Array.isArray(t)){var n=t[e];return n??(Array.isArray(i)?i[e]:i)}return t}function v9(t,e){var i={}.toString.call(t);return i.indexOf("[object")===0&&i.indexOf(e+"]")>-1}function vUe(t,e){return typeof t=="function"?t.apply(void 0,e):t}function oJ(t,e){if(e===0)return t;var i;return function(n){clearTimeout(i),i=setTimeout(function(){t(n)},e)}}function KXe(t){return t.split(/\s+/).filter(Boolean)}function v0(t){return[].concat(t)}function sJ(t,e){t.indexOf(e)===-1&&t.push(e)}function YXe(t){return t.filter(function(e,i){return t.indexOf(e)===i})}function ZXe(t){return t.split("-")[0]}function Q_(t){return[].slice.call(t)}function lJ(t){return Object.keys(t).reduce(function(e,i){return t[i]!==void 0&&(e[i]=t[i]),e},{})}function nD(){return document.createElement("div")}function qF(t){return["Element","Fragment"].some(function(e){return v9(t,e)})}function XXe(t){return v9(t,"NodeList")}function JXe(t){return v9(t,"MouseEvent")}function QXe(t){return!!(t&&t._tippy&&t._tippy.reference===t)}function eJe(t){return qF(t)?[t]:XXe(t)?Q_(t):Array.isArray(t)?t:Q_(document.querySelectorAll(t))}function E$(t,e){t.forEach(function(i){i&&(i.style.transitionDuration=e+"ms")})}function cJ(t,e){t.forEach(function(i){i&&i.setAttribute("data-state",e)})}function tJe(t){var e,i=v0(t),n=i[0];return n!=null&&(e=n.ownerDocument)!=null&&e.body?n.ownerDocument:document}function iJe(t,e){var i=e.clientX,n=e.clientY;return t.every(function(r){var a=r.popperRect,o=r.popperState,s=r.props,l=s.interactiveBorder,c=ZXe(o.placement),u=o.modifiersData.offset;if(!u)return!0;var d=c==="bottom"?u.top.y:0,p=c==="top"?u.bottom.y:0,h=c==="right"?u.left.x:0,f=c==="left"?u.right.x:0,m=a.top-n+d>l,g=n-a.bottom-p>l,v=a.left-i+h>l,y=i-a.right-f>l;return m||g||v||y})}function C$(t,e,i){var n=e+"EventListener";["transitionend","webkitTransitionEnd"].forEach(function(r){t[n](r,i)})}function uJ(t,e){for(var i=e;i;){var n;if(t.contains(i))return!0;i=i.getRootNode==null||(n=i.getRootNode())==null?void 0:n.host}return!1}var Qh={isTouch:!1},dJ=0;function nJe(){Qh.isTouch||(Qh.isTouch=!0,window.performance&&document.addEventListener("mousemove",yUe))}function yUe(){var t=performance.now();t-dJ<20&&(Qh.isTouch=!1,document.removeEventListener("mousemove",yUe)),dJ=t}function rJe(){var t=document.activeElement;if(QXe(t)){var e=t._tippy;t.blur&&!e.state.isVisible&&t.blur()}}function aJe(){document.addEventListener("touchstart",nJe,lb),window.addEventListener("blur",rJe)}var oJe=typeof window<"u"&&typeof document<"u",sJe=oJe?!!window.msCrypto:!1,lJe={animateFill:!1,followCursor:!1,inlinePositioning:!1,sticky:!1},cJe={allowHTML:!1,animation:"fade",arrow:!0,content:"",inertia:!1,maxWidth:350,role:"tooltip",theme:"",zIndex:9999},Zp=Object.assign({appendTo:gUe,aria:{content:"auto",expanded:"auto"},delay:0,duration:[300,250],getReferenceClientRect:null,hideOnClick:!0,ignoreAttributes:!1,interactive:!1,interactiveBorder:2,interactiveDebounce:0,moveTransition:"",offset:[0,10],onAfterUpdate:function(){},onBeforeUpdate:function(){},onCreate:function(){},onDestroy:function(){},onHidden:function(){},onHide:function(){},onMount:function(){},onShow:function(){},onShown:function(){},onTrigger:function(){},onUntrigger:function(){},onClickOutside:function(){},placement:"top",plugins:[],popperOptions:{},render:null,showOnCreate:!1,touch:!0,trigger:"mouseenter focus",triggerTarget:null},lJe,cJe),uJe=Object.keys(Zp),dJe=function(e){var i=Object.keys(e);i.forEach(function(n){Zp[n]=e[n]})};function bUe(t){var e=t.plugins||[],i=e.reduce(function(n,r){var a=r.name,o=r.defaultValue;if(a){var s;n[a]=t[a]!==void 0?t[a]:(s=Zp[a])!=null?s:o}return n},{});return Object.assign({},t,i)}function pJe(t,e){var i=e?Object.keys(bUe(Object.assign({},Zp,{plugins:e}))):uJe,n=i.reduce(function(r,a){var o=(t.getAttribute("data-tippy-"+a)||"").trim();if(!o)return r;if(a==="content")r[a]=o;else try{r[a]=JSON.parse(o)}catch{r[a]=o}return r},{});return n}function pJ(t,e){var i=Object.assign({},e,{content:vUe(e.content,[t])},e.ignoreAttributes?{}:pJe(t,e.plugins));return i.aria=Object.assign({},Zp.aria,i.aria),i.aria={expanded:i.aria.expanded==="auto"?e.interactive:i.aria.expanded,content:i.aria.content==="auto"?e.interactive?null:"describedby":i.aria.content},i}var hJe=function(){return"innerHTML"};function bG(t,e){t[hJe()]=e}function hJ(t){var e=nD();return t===!0?e.className=fUe:(e.className=mUe,qF(t)?e.appendChild(t):bG(e,t)),e}function fJ(t,e){qF(e.content)?(bG(t,""),t.appendChild(e.content)):typeof e.content!="function"&&(e.allowHTML?bG(t,e.content):t.textContent=e.content)}function IG(t){var e=t.firstElementChild,i=Q_(e.children);return{box:e,content:i.find(function(n){return n.classList.contains(hUe)}),arrow:i.find(function(n){return n.classList.contains(fUe)||n.classList.contains(mUe)}),backdrop:i.find(function(n){return n.classList.contains(WXe)})}}function IUe(t){var e=nD(),i=nD();i.className=qXe,i.setAttribute("data-state","hidden"),i.setAttribute("tabindex","-1");var n=nD();n.className=hUe,n.setAttribute("data-state","hidden"),fJ(n,t.props),e.appendChild(i),i.appendChild(n),r(t.props,t.props);function r(a,o){var s=IG(e),l=s.box,c=s.content,u=s.arrow;o.theme?l.setAttribute("data-theme",o.theme):l.removeAttribute("data-theme"),typeof o.animation=="string"?l.setAttribute("data-animation",o.animation):l.removeAttribute("data-animation"),o.inertia?l.setAttribute("data-inertia",""):l.removeAttribute("data-inertia"),l.style.maxWidth=typeof o.maxWidth=="number"?o.maxWidth+"px":o.maxWidth,o.role?l.setAttribute("role",o.role):l.removeAttribute("role"),(a.content!==o.content||a.allowHTML!==o.allowHTML)&&fJ(c,t.props),o.arrow?u?a.arrow!==o.arrow&&(l.removeChild(u),l.appendChild(hJ(o.arrow))):l.appendChild(hJ(o.arrow)):u&&l.removeChild(u)}return{popper:e,onUpdate:r}}IUe.$$tippy=!0;var fJe=1,AM=[],P$=[];function mJe(t,e){var i=pJ(t,Object.assign({},Zp,bUe(lJ(e)))),n,r,a,o=!1,s=!1,l=!1,c=!1,u,d,p,h=[],f=oJ(te,i.interactiveDebounce),m,g=fJe++,v=null,y=YXe(i.plugins),b={isEnabled:!0,isVisible:!1,isDestroyed:!1,isMounted:!1,isShown:!1},I={id:g,reference:t,popper:nD(),popperInstance:v,props:i,state:b,plugins:y,clearDelayTimeouts:Bt,setProps:Pe,setContent:et,show:Ee,hide:lt,hideWithInteractivity:Ke,enable:St,disable:nt,unmount:bt,destroy:gt};if(!i.render)return I;var T=i.render(I),w=T.popper,S=T.onUpdate;w.setAttribute("data-tippy-root",""),w.id="tippy-"+I.id,I.popper=w,t._tippy=I,w._tippy=I;var D=y.map(function(Ue){return Ue.fn(I)}),E=t.hasAttribute("aria-expanded");return re(),F(),x(),O("onCreate",[I]),i.showOnCreate&&Ve(),w.addEventListener("mouseenter",function(){I.props.interactive&&I.state.isVisible&&I.clearDelayTimeouts()}),w.addEventListener("mouseleave",function(){I.props.interactive&&I.props.trigger.indexOf("mouseenter")>=0&&M().addEventListener("mousemove",f)}),I;function C(){var Ue=I.props.touch;return Array.isArray(Ue)?Ue:[Ue,0]}function P(){return C()[0]==="hold"}function R(){var Ue;return!!((Ue=I.props.render)!=null&&Ue.$$tippy)}function N(){return m||t}function M(){var Ue=N().parentNode;return Ue?tJe(Ue):document}function A(){return IG(w)}function _(Ue){return I.state.isMounted&&!I.state.isVisible||Qh.isTouch||u&&u.type==="focus"?0:D$(I.props.delay,Ue?0:1,Zp.delay)}function x(Ue){Ue===void 0&&(Ue=!1),w.style.pointerEvents=I.props.interactive&&!Ue?"":"none",w.style.zIndex=""+I.props.zIndex}function O(Ue,xe,We){if(We===void 0&&(We=!0),D.forEach(function(vt){vt[Ue]&&vt[Ue].apply(vt,xe)}),We){var st;(st=I.props)[Ue].apply(st,xe)}}function B(){var Ue=I.props.aria;if(Ue.content){var xe="aria-"+Ue.content,We=w.id,st=v0(I.props.triggerTarget||t);st.forEach(function(vt){var ge=vt.getAttribute(xe);if(I.state.isVisible)vt.setAttribute(xe,ge?ge+" "+We:We);else{var Se=ge&&ge.replace(We,"").trim();Se?vt.setAttribute(xe,Se):vt.removeAttribute(xe)}})}}function F(){if(!(E||!I.props.aria.expanded)){var Ue=v0(I.props.triggerTarget||t);Ue.forEach(function(xe){I.props.interactive?xe.setAttribute("aria-expanded",I.state.isVisible&&xe===N()?"true":"false"):xe.removeAttribute("aria-expanded")})}}function G(){M().removeEventListener("mousemove",f),AM=AM.filter(function(Ue){return Ue!==f})}function H(Ue){if(!(Qh.isTouch&&(l||Ue.type==="mousedown"))){var xe=Ue.composedPath&&Ue.composedPath()[0]||Ue.target;if(!(I.props.interactive&&uJ(w,xe))){if(v0(I.props.triggerTarget||t).some(function(We){return uJ(We,xe)})){if(Qh.isTouch||I.state.isVisible&&I.props.trigger.indexOf("click")>=0)return}else O("onClickOutside",[I,Ue]);I.props.hideOnClick===!0&&(I.clearDelayTimeouts(),I.hide(),s=!0,setTimeout(function(){s=!1}),I.state.isMounted||Z())}}}function $(){l=!0}function q(){l=!1}function z(){var Ue=M();Ue.addEventListener("mousedown",H,!0),Ue.addEventListener("touchend",H,lb),Ue.addEventListener("touchstart",q,lb),Ue.addEventListener("touchmove",$,lb)}function Z(){var Ue=M();Ue.removeEventListener("mousedown",H,!0),Ue.removeEventListener("touchend",H,lb),Ue.removeEventListener("touchstart",q,lb),Ue.removeEventListener("touchmove",$,lb)}function Y(Ue,xe){X(Ue,function(){!I.state.isVisible&&w.parentNode&&w.parentNode.contains(w)&&xe()})}function Q(Ue,xe){X(Ue,xe)}function X(Ue,xe){var We=A().box;function st(vt){vt.target===We&&(C$(We,"remove",st),xe())}if(Ue===0)return xe();C$(We,"remove",d),C$(We,"add",st),d=st}function oe(Ue,xe,We){We===void 0&&(We=!1);var st=v0(I.props.triggerTarget||t);st.forEach(function(vt){vt.addEventListener(Ue,xe,We),h.push({node:vt,eventType:Ue,handler:xe,options:We})})}function re(){P()&&(oe("touchstart",se,{passive:!0}),oe("touchend",he,{passive:!0})),KXe(I.props.trigger).forEach(function(Ue){if(Ue!=="manual")switch(oe(Ue,se),Ue){case"mouseenter":oe("mouseleave",he);break;case"focus":oe(sJe?"focusout":"blur",ae);break;case"focusin":oe("focusout",ae);break}})}function me(){h.forEach(function(Ue){var xe=Ue.node,We=Ue.eventType,st=Ue.handler,vt=Ue.options;xe.removeEventListener(We,st,vt)}),h=[]}function se(Ue){var xe,We=!1;if(!(!I.state.isEnabled||de(Ue)||s)){var st=((xe=u)==null?void 0:xe.type)==="focus";u=Ue,m=Ue.currentTarget,F(),!I.state.isVisible&&JXe(Ue)&&AM.forEach(function(vt){return vt(Ue)}),Ue.type==="click"&&(I.props.trigger.indexOf("mouseenter")<0||o)&&I.props.hideOnClick!==!1&&I.state.isVisible?We=!0:Ve(Ue),Ue.type==="click"&&(o=!We),We&&!st&&ot(Ue)}}function te(Ue){var xe=Ue.target,We=N().contains(xe)||w.contains(xe);if(!(Ue.type==="mousemove"&&We)){var st=_e().concat(w).map(function(vt){var ge,Se=vt._tippy,qe=(ge=Se.popperInstance)==null?void 0:ge.state;return qe?{popperRect:vt.getBoundingClientRect(),popperState:qe,props:i}:null}).filter(Boolean);iJe(st,Ue)&&(G(),ot(Ue))}}function he(Ue){var xe=de(Ue)||I.props.trigger.indexOf("click")>=0&&o;if(!xe){if(I.props.interactive){I.hideWithInteractivity(Ue);return}ot(Ue)}}function ae(Ue){I.props.trigger.indexOf("focusin")<0&&Ue.target!==N()||I.props.interactive&&Ue.relatedTarget&&w.contains(Ue.relatedTarget)||ot(Ue)}function de(Ue){return Qh.isTouch?P()!==Ue.type.indexOf("touch")>=0:!1}function Ie(){De();var Ue=I.props,xe=Ue.popperOptions,We=Ue.placement,st=Ue.offset,vt=Ue.getReferenceClientRect,ge=Ue.moveTransition,Se=R()?IG(w).arrow:null,qe=vt?{getBoundingClientRect:vt,contextElement:vt.contextElement||N()}:t,$e={name:"$$tippy",enabled:!0,phase:"beforeWrite",requires:["computeStyles"],fn:function(pt){var tt=pt.state;if(R()){var At=A(),ei=At.box;["placement","reference-hidden","escaped"].forEach(function(vi){vi==="placement"?ei.setAttribute("data-placement",tt.placement):tt.attributes.popper["data-popper-"+vi]?ei.setAttribute("data-"+vi,""):ei.removeAttribute("data-"+vi)}),tt.attributes.popper={}}}},ke=[{name:"offset",options:{offset:st}},{name:"preventOverflow",options:{padding:{top:2,bottom:2,left:5,right:5}}},{name:"flip",options:{padding:5}},{name:"computeStyles",options:{adaptive:!ge}},$e];R()&&Se&&ke.push({name:"arrow",options:{element:Se,padding:3}}),ke.push.apply(ke,(xe==null?void 0:xe.modifiers)||[]),I.popperInstance=zXe(qe,w,Object.assign({},xe,{placement:We,onFirstUpdate:p,modifiers:ke}))}function De(){I.popperInstance&&(I.popperInstance.destroy(),I.popperInstance=null)}function Te(){var Ue=I.props.appendTo,xe,We=N();I.props.interactive&&Ue===gUe||Ue==="parent"?xe=We.parentNode:xe=vUe(Ue,[We]),xe.contains(w)||xe.appendChild(w),I.state.isMounted=!0,Ie()}function _e(){return Q_(w.querySelectorAll("[data-tippy-root]"))}function Ve(Ue){I.clearDelayTimeouts(),Ue&&O("onTrigger",[I,Ue]),z();var xe=_(!0),We=C(),st=We[0],vt=We[1];Qh.isTouch&&st==="hold"&&vt&&(xe=vt),xe?n=setTimeout(function(){I.show()},xe):I.show()}function ot(Ue){if(I.clearDelayTimeouts(),O("onUntrigger",[I,Ue]),!I.state.isVisible){Z();return}if(!(I.props.trigger.indexOf("mouseenter")>=0&&I.props.trigger.indexOf("click")>=0&&["mouseleave","mousemove"].indexOf(Ue.type)>=0&&o)){var xe=_(!1);xe?r=setTimeout(function(){I.state.isVisible&&I.hide()},xe):a=requestAnimationFrame(function(){I.hide()})}}function St(){I.state.isEnabled=!0}function nt(){I.hide(),I.state.isEnabled=!1}function Bt(){clearTimeout(n),clearTimeout(r),cancelAnimationFrame(a)}function Pe(Ue){if(!I.state.isDestroyed){O("onBeforeUpdate",[I,Ue]),me();var xe=I.props,We=pJ(t,Object.assign({},xe,lJ(Ue),{ignoreAttributes:!0}));I.props=We,re(),xe.interactiveDebounce!==We.interactiveDebounce&&(G(),f=oJ(te,We.interactiveDebounce)),xe.triggerTarget&&!We.triggerTarget?v0(xe.triggerTarget).forEach(function(st){st.removeAttribute("aria-expanded")}):We.triggerTarget&&t.removeAttribute("aria-expanded"),F(),x(),S&&S(xe,We),I.popperInstance&&(Ie(),_e().forEach(function(st){requestAnimationFrame(st._tippy.popperInstance.forceUpdate)})),O("onAfterUpdate",[I,Ue])}}function et(Ue){I.setProps({content:Ue})}function Ee(){var Ue=I.state.isVisible,xe=I.state.isDestroyed,We=!I.state.isEnabled,st=Qh.isTouch&&!I.props.touch,vt=D$(I.props.duration,0,Zp.duration);if(!(Ue||xe||We||st)&&!N().hasAttribute("disabled")&&(O("onShow",[I],!1),I.props.onShow(I)!==!1)){if(I.state.isVisible=!0,R()&&(w.style.visibility="visible"),x(),z(),I.state.isMounted||(w.style.transition="none"),R()){var ge=A(),Se=ge.box,qe=ge.content;E$([Se,qe],0)}p=function(){var ke;if(!(!I.state.isVisible||c)){if(c=!0,w.offsetHeight,w.style.transition=I.props.moveTransition,R()&&I.props.animation){var Ut=A(),pt=Ut.box,tt=Ut.content;E$([pt,tt],vt),cJ([pt,tt],"visible")}B(),F(),sJ(P$,I),(ke=I.popperInstance)==null||ke.forceUpdate(),O("onMount",[I]),I.props.animation&&R()&&Q(vt,function(){I.state.isShown=!0,O("onShown",[I])})}},Te()}}function lt(){var Ue=!I.state.isVisible,xe=I.state.isDestroyed,We=!I.state.isEnabled,st=D$(I.props.duration,1,Zp.duration);if(!(Ue||xe||We)&&(O("onHide",[I],!1),I.props.onHide(I)!==!1)){if(I.state.isVisible=!1,I.state.isShown=!1,c=!1,o=!1,R()&&(w.style.visibility="hidden"),G(),Z(),x(!0),R()){var vt=A(),ge=vt.box,Se=vt.content;I.props.animation&&(E$([ge,Se],st),cJ([ge,Se],"hidden"))}B(),F(),I.props.animation?R()&&Y(st,I.unmount):I.unmount()}}function Ke(Ue){M().addEventListener("mousemove",f),sJ(AM,f),f(Ue)}function bt(){I.state.isVisible&&I.hide(),I.state.isMounted&&(De(),_e().forEach(function(Ue){Ue._tippy.unmount()}),w.parentNode&&w.parentNode.removeChild(w),P$=P$.filter(function(Ue){return Ue!==I}),I.state.isMounted=!1,O("onHidden",[I]))}function gt(){I.state.isDestroyed||(I.clearDelayTimeouts(),I.unmount(),me(),delete t._tippy,I.state.isDestroyed=!0,O("onDestroy",[I]))}}function fg(t,e){e===void 0&&(e={});var i=Zp.plugins.concat(e.plugins||[]);aJe();var n=Object.assign({},e,{plugins:i}),r=eJe(t),a=r.reduce(function(o,s){var l=s&&mJe(s,n);return l&&o.push(l),o},[]);return qF(t)?a[0]:a}fg.defaultProps=Zp;fg.setDefaultProps=dJe;fg.currentInput=Qh;Object.assign({},aUe,{effect:function(e){var i=e.state,n={popper:{position:i.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};Object.assign(i.elements.popper.style,n.popper),i.styles=n,i.elements.arrow&&Object.assign(i.elements.arrow.style,n.arrow)}});fg.setDefaultProps({render:IUe});function mJ(t){var i;const e=document.createElement("button");return e.className="button font-medium",t.disabled&&(e.disabled=!0),t.class&&e.classList.add(t.class),t.id&&(e.id=t.id),t.location===Qt?e.style="margin-left: 1em":e.style="margin-right: 1em",t.intent&&e.classList.add(t.intent),(i=t.toolTip)!=null&&i.content&&fg(e,t.toolTip),e.innerHTML=t.label,t.visible===!1&&(e.style.display=Mt),e}const y9=({target:t})=>(e=[])=>{t.style.backgroundColor=e!=null&&e.length?"lightgray":wS;const i=(n,r,a)=>{const o=t.getElementsByClassName(`options_${n}`)[0];o&&(o.style.display=e!=null&&e.length?r:a)};i(Ua,SM,Mt),i(ci,Mt,SM),i(li,Mt,SM),i(Qt,Mt,SM)};function Ns(t){var v;const{table:e,targetClassName:i,items:n=[],onSelection:r}=t;let{target:a}=t;const o=!!a;if(a=a||i&&((v=document.getElementsByClassName(i))==null?void 0:v[0]),!a)return;let s=0,l=0;const c={},u={};let d;if(o){as(a);const y=gJe();Object.assign(c,y.elements),a.appendChild(y.anchor)}const p=Object.assign({},...[Ua,ci,li,Qt,t_].map(y=>{var I;const b=(I=a.getElementsByClassName(`options_${y}`))==null?void 0:I[0];return as(b),{[y]:b}}).filter(Boolean)),h=y9({table:e,target:a}),f=(y,b)=>{Nt(b.onClick)&&(y.stopPropagation(),!b.disabled&&b.onClick(y,e),b.stateChange&&h())},m={onClick:()=>{},location:Qt};for(const y of n){const b={...m};lp(y)&&Object.assign(b,y);const I=p[b.location];if(!I){console.log(b.location,p);continue}if(b.location===Ua&&(s+=1),b.location===t_){if(Nt(b.headerClick)){const T=a.getElementsByClassName("panelHeader")[0];T&&(T.onclick=b.headerClick)}l+=1}if(!b.hide&&(b.input||b.placeholder||b.search)){const T=document.createElement("p");T.style="margin-right: 1em",T.className=`control ${b.search?"has-icons-left has-icons-right":""}`;const w=document.createElement("input");if(b.focus&&(d=w),w.className="input font-medium",w.setAttribute("type","text"),w.setAttribute("autocomplete","off"),w.setAttribute("placeholder",y.placeholder||wS),b.id&&(u[b.id]=w),b.id&&w.setAttribute("id",b.id),b.onKeyDown&&w.addEventListener("keydown",S=>b.onKeyDown(S,b)),b.onChange&&w.addEventListener("change",S=>b.onChange(S,b)),b.onKeyUp&&w.addEventListener("keyup",S=>{b.clearSearch&&S.key==="Escape"&&(S.stopPropagation(),w.value="",b.clearSearch()),b.onKeyUp(S,b)}),b.class&&w.classList.add(b.class),b.visible===!1&&(T.style.display=Mt),b.value&&(w.value=b.value),T.appendChild(w),b.search){const S=document.createElement("span");if(S.className="icon is-small is-left font-medium",S.innerHTML='<i class="fa-solid fa-magnifying-glass"></i>',T.appendChild(S),Nt(b.clearSearch)){const D=document.createElement("span");D.className="icon is-small is-right font-medium",D.innerHTML='<i class="fa-solid fa-circle-xmark" style="color: #dddada; pointer-events: all; cursor: pointer"></i>',D.onclick=E=>{E.stopPropagation(),w.value="",b.clearSearch()},T.appendChild(D)}}if(y.validator){const S=document.createElement("p");S.className="help font-medium",T.appendChild(S),w.addEventListener("input",D=>ufe(y,D,w,S,y.validator))}b.id&&(c[b.id]=T,T.id=b.id),I==null||I.appendChild(T);continue}if(!b.hide&&b.text){const T=document.createElement("div");T.className="font-medium",b.id&&(c[b.id]=T,T.id=b.id),T.innerHTML=b.text,T.onclick=w=>f(w,b),I==null||I.appendChild(T);continue}if(!(!b.id&&(!(b!=null&&b.label)||b.hide))){if(b.options){const T=zj({target:I,button:b,stateChange:h});b.visible===!1&&(T.style.display=Mt),b.id&&(c[b.id]=T)}else if(lp(b.selection)){const{selection:{options:T,actions:w},actionPlacement:S,threshold:D=8,...E}=b;if((T==null?void 0:T.length)<D){T.length&&(S===KY?T.unshift({divider:!0}):T.push({divider:!0})),w.forEach(R=>{const{label:N,...M}=R,A={...M,label:`<p style="font-weight: bold">${N}</p>`};S===KY?T.unshift(A):T.push(A)});const C={...E,options:T},P=zj({target:I,button:C,stateChange:h});C.visible===!1&&(P.style.display=Mt),C.id&&(c[b.id]=P)}else{const C=mJ(b);C.onclick=P=>{P.stopPropagation(),c9({title:"Select team",options:T})},b.id&&(c[b.id]=C),I==null||I.appendChild(C)}}else if(b.tabs){const T=document.createElement("div");T.className="tabs is-toggle is-toggle-rounded";const w=document.createElement("ul");T.appendChild(w),b.tabs.forEach(S=>{const D=document.createElement("li");S.active&&D.classList.add("is-active");const E=document.createElement("a");D.appendChild(E),E.onclick=P=>{w.querySelectorAll("li").forEach(R=>R.classList.remove("is-active")),D.classList.add("is-active"),Nt(S.onClick)&&S.onClick(P,b)};const C=document.createElement("span");C.innerHTML=S.label,E.appendChild(C),w.appendChild(D)}),b.id&&(c[b.id]=T),I.appendChild(T)}else{const T=mJ(b);T.onclick=w=>f(w,b),b.id&&(c[b.id]=T),I==null||I.appendChild(T)}(!(b!=null&&b.label||b.tabs)||b.hide)&&c[b.id]&&(c[b.id].style.display=Mt)}}const g=a.getElementsByClassName("panelHeader")[0];return g&&(g.style.display=l?wS:Mt),e==null||e.on("rowSelectionChanged",(y,b)=>{Nt(r)&&r(b),s&&h(b)}),h(),d&&setTimeout(()=>d.focus(),200),{elements:c,inputs:u}}function gJe(){const t=document.createElement("div");t.className="panel_container flexcol flexcenter";const e=document.createElement("div");e.className="panelHeader options_header",e.style.display=Mt,t.appendChild(e);const i=document.createElement("div");i.className=hhe;const n={optionsOverlay:document.createElement("div"),optionsLeft:document.createElement("div"),optionsCenter:document.createElement("div"),optionsRight:document.createElement("div")};n.optionsOverlay.className="options_overlay",n.optionsCenter.className="options_center",n.optionsRight.className="options_right",n.optionsLeft.className="options_left";for(const r of Object.values(n))i.appendChild(r);return t.appendChild(i),{elements:n,anchor:t,header:e}}const{FIRST_MATCH_LOSER_CONSOLATION:vJe,COMPASS:yJe,ROUND_ROBIN:bJe}=pa,{MALE:IJe,FEMALE:wJe}=ks.genderConstants,{DOUBLES:gJ}=ks.eventConstants,{WTN:_M}=ks.ratingConstants;function SJe(t){const e=t.getData().map(n=>n.tournamentId),i=TJe();for(const n of i)KR({tournamentRecord:n,tournamentIds:e,table:t});return{...wP}}function TJe(){const e=[{venueName:"Super Fast Courts",venueAbbreviation:"SFC",startTime:"08:00",endTime:"20:00",courtsCount:8}];return[{tournamentAttributes:{tournamentId:"tournament-id-1"},participantsProfile:{scaledParticipantsCount:200,idPrefix:"p"},tournamentName:"CourtHive Challenge",drawProfiles:[{category:{categoryName:"U18"},eventName:"U18 Boys Doubles",eventId:"event-id-1",drawId:"draw-id-1",eventType:gJ,gender:IJe,seedsCount:4,drawSize:16},{drawType:vJe,category:{categoryName:"U16"},eventName:"U16 Girls Singles",eventId:"event-id-2",drawId:"draw-id-2",gender:wJe,seedsCount:8,drawSize:32},{category:{ratingType:_M,ratingMin:18,ratingMax:24.99},eventName:"WTN 18-25 SINGLES",scaledParticipantsCount:32,eventId:"event-id-3",drawId:"draw-id-3",seedsCount:8,drawSize:32},{category:{ratingType:_M,ratingMin:18,ratingMax:24.99},eventName:"WTN 18-25 DOUBLES",scaledParticipantsCount:32,eventId:"event-id-4",drawId:"draw-id-4",eventType:gJ,seedsCount:8,drawSize:32}],venueProfiles:e},{tournamentAttributes:{tournamentId:"tournament-id-02"},participantsProfile:{idPrefix:"p"},tournamentName:"Level Based Play",drawProfiles:[{eventName:"WTN 14-19 SINGLES",category:{ratingType:_M,ratingMin:14,ratingMax:19.99},scaledParticipantsCount:32,eventId:"event-id-1",drawId:"draw-id-1",drawType:yJe,seedsCount:8,drawSize:32},{eventName:"WTN 20-26 SINGLES",category:{ratingType:_M,ratingMin:20,ratingMax:25.99},scaledParticipantsCount:16,drawType:bJe,eventId:"event-id-2",drawId:"draw-id-2",seedsCount:4,drawSize:16}],venueProfiles:e}].map(n=>IP.generateTournamentRecord(n).tournamentRecord)}function UJe(t){var s;const e=zc(),i=(s=e==null?void 0:e.roles)==null?void 0:s.includes(FO),n=[{label:"Create new tournament",onClick:()=>_Te({table:t})},{label:"Import tournament",onClick:()=>O9e(t)},i&&{label:"Load by ID",onClick:()=>vKe({table:t})},{divider:!0},{divider:!0},{label:"Example tournaments",onClick:()=>SJe(t),close:!0}].filter(Boolean),r=Ew(t),a=[{label:"Actions",options:n,align:Qt},{onKeyDown:l=>l.keyCode===8&&l.target.value.length===1&&r(""),onChange:l=>r(l.target.value),onKeyUp:l=>r(l.target.value),clearSearch:()=>r(""),placeholder:"Search tournaments",location:ci,search:!0}],o=document.getElementById(phe);Ns({target:o,items:a})}const DJe=t=>e=>{const i=document.createElement("table"),n=e.getValue();i.style.width="400px";const r="4em",a=document.createElement("tr");if(n.offline){const c=e.getRow().getElement();c.style.backgroundColor="lightyellow"}const o=n.tournamentImageURL?`<img src='${n.tournamentImageURL}' style='width: ${r}' alt=''>`:"";let s=(t?"":`<td style='min-width: ${r};'>${o}</td>`)+`<td><div style='margin-left: 1em'><strong style='font-size: 1.5em'>${n.tournamentName}</strong></div><div style='margin-left: 1em'>${n.startDate} / ${n.endDate}</div></td>`;a.innerHTML=s,i.appendChild(a);const l=document.createElement("span");return l.appendChild(i),l};function EJe({providerId:t,tournamentId:e}){const i=()=>Tt.router.navigate(`/tournaments/${e}`),n=r=>{r&&(r.calendar=r.calendar.filter(a=>a.tournamentId!==e),xc.addProvider(r).then(i))};xc.findProvider(t).then(n)}function CJe(t,e,i){if(!t)return;const n=document.createElement("aside");n.classList.add("menu");const r={},a=d=>i&&d.close!==!1?p=>{p.stopPropagation(),i(),d.onClick()}:p=>{p.stopPropagation(),d.onClick()};let o=0;const s=()=>(o+=1,o),l=d=>(d==null?void 0:d.heading)||(d==null?void 0:d.text)||(d==null?void 0:d.label)||`Item ${s()}`,c=d=>{const p=document.createElement("li");if(p.className="font-medium",d.style&&(p.style=d.style),d.onClick){const h=d.fontSize||"1em";if(d.divider){const f=document.createElement("hr");f.classList.add("dropdown-divider"),p.appendChild(f)}else{const f=document.createElement("a"),m=d.disabled?"0.4":"1";f.style=`text-decoration: none; opacity: ${m}; font-size: ${h}`,d.class&&f.classList.add(d.class),d.color&&(f.style.color=d.color),d.heading&&(f.style.fontWeight="bold"),d.disabled||(f.onclick=a(d)),f.innerHTML=l(d),p.appendChild(f)}}else p.innerHTML=l(d),d.disabled||(p.onclick=d.onClick);return p};let u;for(const d of e||[])if(!d.hide){if(d.items){if(d.text){const h=document.createElement("p");h.className="menu-label font-medium",h.innerHTML=d.text,n.appendChild(h)}const p=document.createElement("ul");p.className="menu-list";for(const h of d.items)h.hide||p.appendChild(c(h));n.appendChild(p)}else if(d.type==="input"){const{field:p,inputElement:h}=W1(d);d.focus&&(u=h),r[d.field]=h,n.appendChild(p)}else if(d.type==="divider"){const p=document.createElement("hr");p.classList.add("dropdown-divider"),n.appendChild(p)}}return t.appendChild(n),{focusElement:u}}let rf;function ld(t){rf&&(rf==null||rf.destroy(!0),rf=void 0),t!=null&&t.remove&&t.remove()}function pc(t){var d;const{title:e,options:i,menuItems:n=[],coords:r,callback:a,config:o}=t;let{target:s,items:l}=t;if(!(i!=null&&i.length)&&!(l!=null&&l.length)&&!n)return;ld();const c=document.createElement("div"),u=()=>{l=(l==null?void 0:l.filter(f=>!f.hide&&!f.disabled).map(f=>({...f,onClick:()=>{ld(c),Nt(f.onClick)&&f.onClick()}})))||(i==null?void 0:i.filter(f=>!f.hide&&!f.disabled).map(f=>({text:typeof f=="object"?f.option:f,style:f.style,onClick:()=>{f.subMenu?rf.setContent("IMPLEMENT SUB MENU"):Nt(f.onClick)?(ld(c),f.onClick()):Nt(a)&&(ld(c),a(typeof f=="object"?{...f,coords:r}:f))}})));const p=[{text:e,items:l},...n],{focusElement:h}=CJe(c,p);return h&&h.focus(),c};return s=s||((d=r==null?void 0:r.evt)==null?void 0:d.target),s&&(rf=fg(s,{content:u,theme:"light-border",trigger:"click",...o}),rf.show(),rf.setProps({interactive:!0})),rf}const PJe=t=>e=>{const i=document.createElement("span");i.style.width="100%";const n=e.getValue(),r=()=>{var f;const l=e.getRow(),c=((f=zc())==null?void 0:f.providerId)||l.getData().providerId,u=()=>{l.delete(),c&&EJe({tournamentId:n,providerId:c})},d=()=>xc.deleteTournament(n).then(u,m=>console.log(m)),p=zc();(p==null?void 0:p.provider)||(Tt==null?void 0:Tt.provider)?F2e({providerId:c,tournamentId:n}).then(d,m=>console.log(m)):d()},a=()=>{const u=`<div style='font-size: 2em'>${e.getTable().getData().find(p=>p.tournamentId===n).tournament.tournamentName} will be deleted!</div>`,d=[{onClick:r,intent:"is-danger",label:"Delete",close:!0},{label:"Cancel"}];cr({title:Bo.tr("actions.delete_tournament"),buttons:d,content:u})},o=()=>RJe({table:e.getTable(),tournamentId:n,replaceTableData:t}),s=document.createElement("span");return s.innerHTML="<i class='fa fa-ellipsis-vertical'></i>",i.onclick=l=>{l.stopPropagation(),pc({target:s,items:[{text:"Delete",onClick:a},{text:"Edit",onClick:o}],config:{placement:gp}})},i.appendChild(s),i};function RJe({tournamentId:t,replaceTableData:e,table:i}){const n=zc(),r=n==null?void 0:n.provider,a=()=>{ti({message:"Tournament not found",onClose:()=>{Tt.router.navigate("/tournaments")},intent:"is-warning",pauseOnHover:!0})},o=l=>{l?_Te({table:i,tournamentRecord:l,replaceTableData:e}):a()},s=l=>{var u,d;const c=(d=(u=l==null?void 0:l.data)==null?void 0:u.tournamentRecords)==null?void 0:d[t];o(c)};r?qO({tournamentId:t}).then(s,l=>console.log(l)):xc.findTournament(t).then(o,l=>console.log(l))}function MJe(t){const e=/Mobile/.test(navigator.userAgent),i=(n,r)=>{const a=r.getRow().getData().tournamentId;if(a){at.reset();const o=`/${Fo}/${a}`;Tt.router.navigate(o)}};return[{formatter:DJe(e),cellClick:i,field:"tournament",headerSort:!1,resizable:!0,minWidth:250,widthGrow:3},{formatter:()=>'<div class="button font-medium">Open</div>',cellClick:i,vertAlign:"middle",visible:!e,title:"Open",width:90},{formatter:PJe(t),field:"tournamentId",vertAlign:"middle",headerSort:!1,hozAlign:Qt,width:10}]}function gm({anchorId:t}){const e=Go.findTable(`#${t}`)[0];e&&e.destroy()}function WF(){var t;if(Tt.tables)for(const e of Object.keys(Tt.tables))(t=Tt.tables[e])==null||t.destroy(),delete Tt.tables[e];for(;(Tt.collectionTables||[]).length;)Tt.collectionTables.pop().destroy()}function wUe(){const t=u=>console.log("db Error",{error:u}),e=document.getElementById("dnav");e.style.backgroundColor="";let i;const n=MJe(),r=u=>{gm({anchorId:MV});const d=document.getElementById(MV);i=new Go(d,{height:window.innerHeight*.85,placeholder:"No tournaments",layout:"fitColumns",index:"tournamentId",headerVisible:!1,reactiveData:!0,data:u,columns:n}),i.on("tableBuilt",()=>UJe(i)),i.on("scrollVertical",ld)},a=u=>{u.sort((d,p)=>new Date(p.startDate||p.start)-new Date(d.startDate||d.start)),r(u.map(VF))},o=({tournaments:u,provider:d})=>{const p=u.sort((h,f)=>new Date(f.tournament.startDate)-new Date(h.tournament.startDate)).map(h=>{var g,v,y,b;const f=(v=(g=h.tournament.timeItemValues)==null?void 0:g.TMX)==null?void 0:v.offline;h.tournament.offline=f;const m=(b=(y=h.tournament.onlineResources)==null?void 0:y.find(({name:I,resourceType:T})=>I==="tournamentImage"&&T==="URL"))==null?void 0:b.identifier;return m&&(h.tournament.tournamentImageURL=m),{...h,provider:d}});r(p)},s=zc(),l=(s==null?void 0:s.provider)||(Tt==null?void 0:Tt.provider),c=()=>xc.findAllTournaments().then(a,t);if(l!=null&&l.organisationAbbreviation){const u=d=>{var p;(p=d==null?void 0:d.data)!=null&&p.calendar?o(d.data.calendar):c()};x2e({providerAbbr:l.organisationAbbreviation}).then(u)}else c();return{table:i}}const SUe="leaveTournament",NJe="providerCalendar",AJe="processDirective",_Je="tmxDirective",kJe="tmxMessage";function TUe(t){const e=STe({data:t}),{directive:i,content:n}=e||{};i&&(i===NJe&&n.calendar&&ti({action:{onClick:()=>xJe({providerId:n.providerId,calendar:n.calendar}),text:"Load"},message:"Calendar Received",duration:!1}),i.subKey&&Tt.ee.emit("sendKey",i.subKey))}function xJe({providerId:t,calendar:e}){const i=()=>wUe();t&&e&&xc.addProvider({providerId:t,calendar:e}).then(i)}const qf=Object.create(null);qf.open="0";qf.close="1";qf.ping="2";qf.pong="3";qf.message="4";qf.upgrade="5";qf.noop="6";const JN=Object.create(null);Object.keys(qf).forEach(t=>{JN[qf[t]]=t});const wG={type:"error",data:"parser error"},UUe=typeof Blob=="function"||typeof Blob<"u"&&Object.prototype.toString.call(Blob)==="[object BlobConstructor]",DUe=typeof ArrayBuffer=="function",EUe=t=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(t):t&&t.buffer instanceof ArrayBuffer,b9=({type:t,data:e},i,n)=>UUe&&e instanceof Blob?i?n(e):vJ(e,n):DUe&&(e instanceof ArrayBuffer||EUe(e))?i?n(e):vJ(new Blob([e]),n):n(qf[t]+(e||"")),vJ=(t,e)=>{const i=new FileReader;return i.onload=function(){const n=i.result.split(",")[1];e("b"+(n||""))},i.readAsDataURL(t)};function yJ(t){return t instanceof Uint8Array?t:t instanceof ArrayBuffer?new Uint8Array(t):new Uint8Array(t.buffer,t.byteOffset,t.byteLength)}let R$;function OJe(t,e){if(UUe&&t.data instanceof Blob)return t.data.arrayBuffer().then(yJ).then(e);if(DUe&&(t.data instanceof ArrayBuffer||EUe(t.data)))return e(yJ(t.data));b9(t,!1,i=>{R$||(R$=new TextEncoder),e(R$.encode(i))})}const bJ="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",w1=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(let t=0;t<bJ.length;t++)w1[bJ.charCodeAt(t)]=t;const LJe=t=>{let e=t.length*.75,i=t.length,n,r=0,a,o,s,l;t[t.length-1]==="="&&(e--,t[t.length-2]==="="&&e--);const c=new ArrayBuffer(e),u=new Uint8Array(c);for(n=0;n<i;n+=4)a=w1[t.charCodeAt(n)],o=w1[t.charCodeAt(n+1)],s=w1[t.charCodeAt(n+2)],l=w1[t.charCodeAt(n+3)],u[r++]=a<<2|o>>4,u[r++]=(o&15)<<4|s>>2,u[r++]=(s&3)<<6|l&63;return c},FJe=typeof ArrayBuffer=="function",I9=(t,e)=>{if(typeof t!="string")return{type:"message",data:CUe(t,e)};const i=t.charAt(0);return i==="b"?{type:"message",data:BJe(t.substring(1),e)}:JN[i]?t.length>1?{type:JN[i],data:t.substring(1)}:{type:JN[i]}:wG},BJe=(t,e)=>{if(FJe){const i=LJe(t);return CUe(i,e)}else return{base64:!0,data:t}},CUe=(t,e)=>{switch(e){case"blob":return t instanceof Blob?t:new Blob([t]);case"arraybuffer":default:return t instanceof ArrayBuffer?t:t.buffer}},PUe="",$Je=(t,e)=>{const i=t.length,n=new Array(i);let r=0;t.forEach((a,o)=>{b9(a,!1,s=>{n[o]=s,++r===i&&e(n.join(PUe))})})},VJe=(t,e)=>{const i=t.split(PUe),n=[];for(let r=0;r<i.length;r++){const a=I9(i[r],e);if(n.push(a),a.type==="error")break}return n};function jJe(){return new TransformStream({transform(t,e){OJe(t,i=>{const n=i.length;let r;if(n<126)r=new Uint8Array(1),new DataView(r.buffer).setUint8(0,n);else if(n<65536){r=new Uint8Array(3);const a=new DataView(r.buffer);a.setUint8(0,126),a.setUint16(1,n)}else{r=new Uint8Array(9);const a=new DataView(r.buffer);a.setUint8(0,127),a.setBigUint64(1,BigInt(n))}t.data&&typeof t.data!="string"&&(r[0]|=128),e.enqueue(r),e.enqueue(i)})}})}let M$;function kM(t){return t.reduce((e,i)=>e+i.length,0)}function xM(t,e){if(t[0].length===e)return t.shift();const i=new Uint8Array(e);let n=0;for(let r=0;r<e;r++)i[r]=t[0][n++],n===t[0].length&&(t.shift(),n=0);return t.length&&n<t[0].length&&(t[0]=t[0].slice(n)),i}function GJe(t,e){M$||(M$=new TextDecoder);const i=[];let n=0,r=-1,a=!1;return new TransformStream({transform(o,s){for(i.push(o);;){if(n===0){if(kM(i)<1)break;const l=xM(i,1);a=(l[0]&128)===128,r=l[0]&127,r<126?n=3:r===126?n=1:n=2}else if(n===1){if(kM(i)<2)break;const l=xM(i,2);r=new DataView(l.buffer,l.byteOffset,l.length).getUint16(0),n=3}else if(n===2){if(kM(i)<8)break;const l=xM(i,8),c=new DataView(l.buffer,l.byteOffset,l.length),u=c.getUint32(0);if(u>Math.pow(2,21)-1){s.enqueue(wG);break}r=u*Math.pow(2,32)+c.getUint32(4),n=3}else{if(kM(i)<r)break;const l=xM(i,r);s.enqueue(I9(a?l:M$.decode(l),e)),n=0}if(r===0||r>t){s.enqueue(wG);break}}}})}const RUe=4;function ys(t){if(t)return HJe(t)}function HJe(t){for(var e in ys.prototype)t[e]=ys.prototype[e];return t}ys.prototype.on=ys.prototype.addEventListener=function(t,e){return this._callbacks=this._callbacks||{},(this._callbacks["$"+t]=this._callbacks["$"+t]||[]).push(e),this};ys.prototype.once=function(t,e){function i(){this.off(t,i),e.apply(this,arguments)}return i.fn=e,this.on(t,i),this};ys.prototype.off=ys.prototype.removeListener=ys.prototype.removeAllListeners=ys.prototype.removeEventListener=function(t,e){if(this._callbacks=this._callbacks||{},arguments.length==0)return this._callbacks={},this;var i=this._callbacks["$"+t];if(!i)return this;if(arguments.length==1)return delete this._callbacks["$"+t],this;for(var n,r=0;r<i.length;r++)if(n=i[r],n===e||n.fn===e){i.splice(r,1);break}return i.length===0&&delete this._callbacks["$"+t],this};ys.prototype.emit=function(t){this._callbacks=this._callbacks||{};for(var e=new Array(arguments.length-1),i=this._callbacks["$"+t],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(i){i=i.slice(0);for(var n=0,r=i.length;n<r;++n)i[n].apply(this,e)}return this};ys.prototype.emitReserved=ys.prototype.emit;ys.prototype.listeners=function(t){return this._callbacks=this._callbacks||{},this._callbacks["$"+t]||[]};ys.prototype.hasListeners=function(t){return!!this.listeners(t).length};const zd=typeof self<"u"?self:typeof window<"u"?window:Function("return this")();function MUe(t,...e){return e.reduce((i,n)=>(t.hasOwnProperty(n)&&(i[n]=t[n]),i),{})}const zJe=zd.setTimeout,qJe=zd.clearTimeout;function KF(t,e){e.useNativeTimers?(t.setTimeoutFn=zJe.bind(zd),t.clearTimeoutFn=qJe.bind(zd)):(t.setTimeoutFn=zd.setTimeout.bind(zd),t.clearTimeoutFn=zd.clearTimeout.bind(zd))}const WJe=1.33;function KJe(t){return typeof t=="string"?YJe(t):Math.ceil((t.byteLength||t.size)*WJe)}function YJe(t){let e=0,i=0;for(let n=0,r=t.length;n<r;n++)e=t.charCodeAt(n),e<128?i+=1:e<2048?i+=2:e<55296||e>=57344?i+=3:(n++,i+=4);return i}function ZJe(t){let e="";for(let i in t)t.hasOwnProperty(i)&&(e.length&&(e+="&"),e+=encodeURIComponent(i)+"="+encodeURIComponent(t[i]));return e}function XJe(t){let e={},i=t.split("&");for(let n=0,r=i.length;n<r;n++){let a=i[n].split("=");e[decodeURIComponent(a[0])]=decodeURIComponent(a[1])}return e}class JJe extends Error{constructor(e,i,n){super(e),this.description=i,this.context=n,this.type="TransportError"}}class w9 extends ys{constructor(e){super(),this.writable=!1,KF(this,e),this.opts=e,this.query=e.query,this.socket=e.socket}onError(e,i,n){return super.emitReserved("error",new JJe(e,i,n)),this}open(){return this.readyState="opening",this.doOpen(),this}close(){return(this.readyState==="opening"||this.readyState==="open")&&(this.doClose(),this.onClose()),this}send(e){this.readyState==="open"&&this.write(e)}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(e){const i=I9(e,this.socket.binaryType);this.onPacket(i)}onPacket(e){super.emitReserved("packet",e)}onClose(e){this.readyState="closed",super.emitReserved("close",e)}pause(e){}createUri(e,i={}){return e+"://"+this._hostname()+this._port()+this.opts.path+this._query(i)}_hostname(){const e=this.opts.hostname;return e.indexOf(":")===-1?e:"["+e+"]"}_port(){return this.opts.port&&(this.opts.secure&&+(this.opts.port!==443)||!this.opts.secure&&Number(this.opts.port)!==80)?":"+this.opts.port:""}_query(e){const i=ZJe(e);return i.length?"?"+i:""}}const NUe="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),SG=64,QJe={};let IJ=0,OM=0,wJ;function SJ(t){let e="";do e=NUe[t%SG]+e,t=Math.floor(t/SG);while(t>0);return e}function AUe(){const t=SJ(+new Date);return t!==wJ?(IJ=0,wJ=t):t+"."+SJ(IJ++)}for(;OM<SG;OM++)QJe[NUe[OM]]=OM;let _Ue=!1;try{_Ue=typeof XMLHttpRequest<"u"&&"withCredentials"in new XMLHttpRequest}catch{}const eQe=_Ue;function kUe(t){const e=t.xdomain;try{if(typeof XMLHttpRequest<"u"&&(!e||eQe))return new XMLHttpRequest}catch{}if(!e)try{return new zd[["Active"].concat("Object").join("X")]("Microsoft.XMLHTTP")}catch{}}function tQe(){}const iQe=function(){return new kUe({xdomain:!1}).responseType!=null}();class nQe extends w9{constructor(e){if(super(e),this.polling=!1,typeof location<"u"){const n=location.protocol==="https:";let r=location.port;r||(r=n?"443":"80"),this.xd=typeof location<"u"&&e.hostname!==location.hostname||r!==e.port}const i=e&&e.forceBase64;this.supportsBinary=iQe&&!i,this.opts.withCredentials&&(this.cookieJar=void 0)}get name(){return"polling"}doOpen(){this.poll()}pause(e){this.readyState="pausing";const i=()=>{this.readyState="paused",e()};if(this.polling||!this.writable){let n=0;this.polling&&(n++,this.once("pollComplete",function(){--n||i()})),this.writable||(n++,this.once("drain",function(){--n||i()}))}else i()}poll(){this.polling=!0,this.doPoll(),this.emitReserved("poll")}onData(e){const i=n=>{if(this.readyState==="opening"&&n.type==="open"&&this.onOpen(),n.type==="close")return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(n)};VJe(e,this.socket.binaryType).forEach(i),this.readyState!=="closed"&&(this.polling=!1,this.emitReserved("pollComplete"),this.readyState==="open"&&this.poll())}doClose(){const e=()=>{this.write([{type:"close"}])};this.readyState==="open"?e():this.once("open",e)}write(e){this.writable=!1,$Je(e,i=>{this.doWrite(i,()=>{this.writable=!0,this.emitReserved("drain")})})}uri(){const e=this.opts.secure?"https":"http",i=this.query||{};return this.opts.timestampRequests!==!1&&(i[this.opts.timestampParam]=AUe()),!this.supportsBinary&&!i.sid&&(i.b64=1),this.createUri(e,i)}request(e={}){return Object.assign(e,{xd:this.xd,cookieJar:this.cookieJar},this.opts),new If(this.uri(),e)}doWrite(e,i){const n=this.request({method:"POST",data:e});n.on("success",i),n.on("error",(r,a)=>{this.onError("xhr post error",r,a)})}doPoll(){const e=this.request();e.on("data",this.onData.bind(this)),e.on("error",(i,n)=>{this.onError("xhr poll error",i,n)}),this.pollXhr=e}}class If extends ys{constructor(e,i){super(),KF(this,i),this.opts=i,this.method=i.method||"GET",this.uri=e,this.data=i.data!==void 0?i.data:null,this.create()}create(){var e;const i=MUe(this.opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");i.xdomain=!!this.opts.xd;const n=this.xhr=new kUe(i);try{n.open(this.method,this.uri,!0);try{if(this.opts.extraHeaders){n.setDisableHeaderCheck&&n.setDisableHeaderCheck(!0);for(let r in this.opts.extraHeaders)this.opts.extraHeaders.hasOwnProperty(r)&&n.setRequestHeader(r,this.opts.extraHeaders[r])}}catch{}if(this.method==="POST")try{n.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch{}try{n.setRequestHeader("Accept","*/*")}catch{}(e=this.opts.cookieJar)===null||e===void 0||e.addCookies(n),"withCredentials"in n&&(n.withCredentials=this.opts.withCredentials),this.opts.requestTimeout&&(n.timeout=this.opts.requestTimeout),n.onreadystatechange=()=>{var r;n.readyState===3&&((r=this.opts.cookieJar)===null||r===void 0||r.parseCookies(n)),n.readyState===4&&(n.status===200||n.status===1223?this.onLoad():this.setTimeoutFn(()=>{this.onError(typeof n.status=="number"?n.status:0)},0))},n.send(this.data)}catch(r){this.setTimeoutFn(()=>{this.onError(r)},0);return}typeof document<"u"&&(this.index=If.requestsCount++,If.requests[this.index]=this)}onError(e){this.emitReserved("error",e,this.xhr),this.cleanup(!0)}cleanup(e){if(!(typeof this.xhr>"u"||this.xhr===null)){if(this.xhr.onreadystatechange=tQe,e)try{this.xhr.abort()}catch{}typeof document<"u"&&delete If.requests[this.index],this.xhr=null}}onLoad(){const e=this.xhr.responseText;e!==null&&(this.emitReserved("data",e),this.emitReserved("success"),this.cleanup())}abort(){this.cleanup()}}If.requestsCount=0;If.requests={};if(typeof document<"u"){if(typeof attachEvent=="function")attachEvent("onunload",TJ);else if(typeof addEventListener=="function"){const t="onpagehide"in zd?"pagehide":"unload";addEventListener(t,TJ,!1)}}function TJ(){for(let t in If.requests)If.requests.hasOwnProperty(t)&&If.requests[t].abort()}const S9=typeof Promise=="function"&&typeof Promise.resolve=="function"?e=>Promise.resolve().then(e):(e,i)=>i(e,0),LM=zd.WebSocket||zd.MozWebSocket,UJ=!0,rQe="arraybuffer",DJ=typeof navigator<"u"&&typeof navigator.product=="string"&&navigator.product.toLowerCase()==="reactnative";class aQe extends w9{constructor(e){super(e),this.supportsBinary=!e.forceBase64}get name(){return"websocket"}doOpen(){if(!this.check())return;const e=this.uri(),i=this.opts.protocols,n=DJ?{}:MUe(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(n.headers=this.opts.extraHeaders);try{this.ws=UJ&&!DJ?i?new LM(e,i):new LM(e):new LM(e,i,n)}catch(r){return this.emitReserved("error",r)}this.ws.binaryType=this.socket.binaryType,this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=e=>this.onClose({description:"websocket connection closed",context:e}),this.ws.onmessage=e=>this.onData(e.data),this.ws.onerror=e=>this.onError("websocket error",e)}write(e){this.writable=!1;for(let i=0;i<e.length;i++){const n=e[i],r=i===e.length-1;b9(n,this.supportsBinary,a=>{const o={};try{UJ&&this.ws.send(a)}catch{}r&&S9(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){typeof this.ws<"u"&&(this.ws.close(),this.ws=null)}uri(){const e=this.opts.secure?"wss":"ws",i=this.query||{};return this.opts.timestampRequests&&(i[this.opts.timestampParam]=AUe()),this.supportsBinary||(i.b64=1),this.createUri(e,i)}check(){return!!LM}}class oQe extends w9{get name(){return"webtransport"}doOpen(){typeof WebTransport=="function"&&(this.transport=new WebTransport(this.createUri("https"),this.opts.transportOptions[this.name]),this.transport.closed.then(()=>{this.onClose()}).catch(e=>{this.onError("webtransport error",e)}),this.transport.ready.then(()=>{this.transport.createBidirectionalStream().then(e=>{const i=GJe(Number.MAX_SAFE_INTEGER,this.socket.binaryType),n=e.readable.pipeThrough(i).getReader(),r=jJe();r.readable.pipeTo(e.writable),this.writer=r.writable.getWriter();const a=()=>{n.read().then(({done:s,value:l})=>{s||(this.onPacket(l),a())}).catch(s=>{})};a();const o={type:"open"};this.query.sid&&(o.data=`{"sid":"${this.query.sid}"}`),this.writer.write(o).then(()=>this.onOpen())})}))}write(e){this.writable=!1;for(let i=0;i<e.length;i++){const n=e[i],r=i===e.length-1;this.writer.write(n).then(()=>{r&&S9(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){var e;(e=this.transport)===null||e===void 0||e.close()}}const sQe={websocket:aQe,webtransport:oQe,polling:nQe},lQe=/^(?:(?![^:@\/?#]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,cQe=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function TG(t){if(t.length>2e3)throw"URI too long";const e=t,i=t.indexOf("["),n=t.indexOf("]");i!=-1&&n!=-1&&(t=t.substring(0,i)+t.substring(i,n).replace(/:/g,";")+t.substring(n,t.length));let r=lQe.exec(t||""),a={},o=14;for(;o--;)a[cQe[o]]=r[o]||"";return i!=-1&&n!=-1&&(a.source=e,a.host=a.host.substring(1,a.host.length-1).replace(/;/g,":"),a.authority=a.authority.replace("[","").replace("]","").replace(/;/g,":"),a.ipv6uri=!0),a.pathNames=uQe(a,a.path),a.queryKey=dQe(a,a.query),a}function uQe(t,e){const i=/\/{2,9}/g,n=e.replace(i,"/").split("/");return(e.slice(0,1)=="/"||e.length===0)&&n.splice(0,1),e.slice(-1)=="/"&&n.splice(n.length-1,1),n}function dQe(t,e){const i={};return e.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(n,r,a){r&&(i[r]=a)}),i}let xUe=class y0 extends ys{constructor(e,i={}){super(),this.binaryType=rQe,this.writeBuffer=[],e&&typeof e=="object"&&(i=e,e=null),e?(e=TG(e),i.hostname=e.host,i.secure=e.protocol==="https"||e.protocol==="wss",i.port=e.port,e.query&&(i.query=e.query)):i.host&&(i.hostname=TG(i.host).host),KF(this,i),this.secure=i.secure!=null?i.secure:typeof location<"u"&&location.protocol==="https:",i.hostname&&!i.port&&(i.port=this.secure?"443":"80"),this.hostname=i.hostname||(typeof location<"u"?location.hostname:"localhost"),this.port=i.port||(typeof location<"u"&&location.port?location.port:this.secure?"443":"80"),this.transports=i.transports||["polling","websocket","webtransport"],this.writeBuffer=[],this.prevBufferLen=0,this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,addTrailingSlash:!0,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!1},i),this.opts.path=this.opts.path.replace(/\/$/,"")+(this.opts.addTrailingSlash?"/":""),typeof this.opts.query=="string"&&(this.opts.query=XJe(this.opts.query)),this.id=null,this.upgrades=null,this.pingInterval=null,this.pingTimeout=null,this.pingTimeoutTimer=null,typeof addEventListener=="function"&&(this.opts.closeOnBeforeunload&&(this.beforeunloadEventListener=()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},addEventListener("beforeunload",this.beforeunloadEventListener,!1)),this.hostname!=="localhost"&&(this.offlineEventListener=()=>{this.onClose("transport close",{description:"network connection lost"})},addEventListener("offline",this.offlineEventListener,!1))),this.open()}createTransport(e){const i=Object.assign({},this.opts.query);i.EIO=RUe,i.transport=e,this.id&&(i.sid=this.id);const n=Object.assign({},this.opts,{query:i,socket:this,hostname:this.hostname,secure:this.secure,port:this.port},this.opts.transportOptions[e]);return new sQe[e](n)}open(){let e;if(this.opts.rememberUpgrade&&y0.priorWebsocketSuccess&&this.transports.indexOf("websocket")!==-1)e="websocket";else if(this.transports.length===0){this.setTimeoutFn(()=>{this.emitReserved("error","No transports available")},0);return}else e=this.transports[0];this.readyState="opening";try{e=this.createTransport(e)}catch{this.transports.shift(),this.open();return}e.open(),this.setTransport(e)}setTransport(e){this.transport&&this.transport.removeAllListeners(),this.transport=e,e.on("drain",this.onDrain.bind(this)).on("packet",this.onPacket.bind(this)).on("error",this.onError.bind(this)).on("close",i=>this.onClose("transport close",i))}probe(e){let i=this.createTransport(e),n=!1;y0.priorWebsocketSuccess=!1;const r=()=>{n||(i.send([{type:"ping",data:"probe"}]),i.once("packet",d=>{if(!n)if(d.type==="pong"&&d.data==="probe"){if(this.upgrading=!0,this.emitReserved("upgrading",i),!i)return;y0.priorWebsocketSuccess=i.name==="websocket",this.transport.pause(()=>{n||this.readyState!=="closed"&&(u(),this.setTransport(i),i.send([{type:"upgrade"}]),this.emitReserved("upgrade",i),i=null,this.upgrading=!1,this.flush())})}else{const p=new Error("probe error");p.transport=i.name,this.emitReserved("upgradeError",p)}}))};function a(){n||(n=!0,u(),i.close(),i=null)}const o=d=>{const p=new Error("probe error: "+d);p.transport=i.name,a(),this.emitReserved("upgradeError",p)};function s(){o("transport closed")}function l(){o("socket closed")}function c(d){i&&d.name!==i.name&&a()}const u=()=>{i.removeListener("open",r),i.removeListener("error",o),i.removeListener("close",s),this.off("close",l),this.off("upgrading",c)};i.once("open",r),i.once("error",o),i.once("close",s),this.once("close",l),this.once("upgrading",c),this.upgrades.indexOf("webtransport")!==-1&&e!=="webtransport"?this.setTimeoutFn(()=>{n||i.open()},200):i.open()}onOpen(){if(this.readyState="open",y0.priorWebsocketSuccess=this.transport.name==="websocket",this.emitReserved("open"),this.flush(),this.readyState==="open"&&this.opts.upgrade){let e=0;const i=this.upgrades.length;for(;e<i;e++)this.probe(this.upgrades[e])}}onPacket(e){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")switch(this.emitReserved("packet",e),this.emitReserved("heartbeat"),this.resetPingTimeout(),e.type){case"open":this.onHandshake(JSON.parse(e.data));break;case"ping":this.sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong");break;case"error":const i=new Error("server error");i.code=e.data,this.onError(i);break;case"message":this.emitReserved("data",e.data),this.emitReserved("message",e.data);break}}onHandshake(e){this.emitReserved("handshake",e),this.id=e.sid,this.transport.query.sid=e.sid,this.upgrades=this.filterUpgrades(e.upgrades),this.pingInterval=e.pingInterval,this.pingTimeout=e.pingTimeout,this.maxPayload=e.maxPayload,this.onOpen(),this.readyState!=="closed"&&this.resetPingTimeout()}resetPingTimeout(){this.clearTimeoutFn(this.pingTimeoutTimer),this.pingTimeoutTimer=this.setTimeoutFn(()=>{this.onClose("ping timeout")},this.pingInterval+this.pingTimeout),this.opts.autoUnref&&this.pingTimeoutTimer.unref()}onDrain(){this.writeBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,this.writeBuffer.length===0?this.emitReserved("drain"):this.flush()}flush(){if(this.readyState!=="closed"&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){const e=this.getWritablePackets();this.transport.send(e),this.prevBufferLen=e.length,this.emitReserved("flush")}}getWritablePackets(){if(!(this.maxPayload&&this.transport.name==="polling"&&this.writeBuffer.length>1))return this.writeBuffer;let i=1;for(let n=0;n<this.writeBuffer.length;n++){const r=this.writeBuffer[n].data;if(r&&(i+=KJe(r)),n>0&&i>this.maxPayload)return this.writeBuffer.slice(0,n);i+=2}return this.writeBuffer}write(e,i,n){return this.sendPacket("message",e,i,n),this}send(e,i,n){return this.sendPacket("message",e,i,n),this}sendPacket(e,i,n,r){if(typeof i=="function"&&(r=i,i=void 0),typeof n=="function"&&(r=n,n=null),this.readyState==="closing"||this.readyState==="closed")return;n=n||{},n.compress=n.compress!==!1;const a={type:e,data:i,options:n};this.emitReserved("packetCreate",a),this.writeBuffer.push(a),r&&this.once("flush",r),this.flush()}close(){const e=()=>{this.onClose("forced close"),this.transport.close()},i=()=>{this.off("upgrade",i),this.off("upgradeError",i),e()},n=()=>{this.once("upgrade",i),this.once("upgradeError",i)};return(this.readyState==="opening"||this.readyState==="open")&&(this.readyState="closing",this.writeBuffer.length?this.once("drain",()=>{this.upgrading?n():e()}):this.upgrading?n():e()),this}onError(e){y0.priorWebsocketSuccess=!1,this.emitReserved("error",e),this.onClose("transport error",e)}onClose(e,i){(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")&&(this.clearTimeoutFn(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),typeof removeEventListener=="function"&&(removeEventListener("beforeunload",this.beforeunloadEventListener,!1),removeEventListener("offline",this.offlineEventListener,!1)),this.readyState="closed",this.id=null,this.emitReserved("close",e,i),this.writeBuffer=[],this.prevBufferLen=0)}filterUpgrades(e){const i=[];let n=0;const r=e.length;for(;n<r;n++)~this.transports.indexOf(e[n])&&i.push(e[n]);return i}};xUe.protocol=RUe;function pQe(t,e="",i){let n=t;i=i||typeof location<"u"&&location,t==null&&(t=i.protocol+"//"+i.host),typeof t=="string"&&(t.charAt(0)==="/"&&(t.charAt(1)==="/"?t=i.protocol+t:t=i.host+t),/^(https?|wss?):\/\//.test(t)||(typeof i<"u"?t=i.protocol+"//"+t:t="https://"+t),n=TG(t)),n.port||(/^(http|ws)$/.test(n.protocol)?n.port="80":/^(http|ws)s$/.test(n.protocol)&&(n.port="443")),n.path=n.path||"/";const a=n.host.indexOf(":")!==-1?"["+n.host+"]":n.host;return n.id=n.protocol+"://"+a+":"+n.port+e,n.href=n.protocol+"://"+a+(i&&i.port===n.port?"":":"+n.port),n}const hQe=typeof ArrayBuffer=="function",fQe=t=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(t):t.buffer instanceof ArrayBuffer,OUe=Object.prototype.toString,mQe=typeof Blob=="function"||typeof Blob<"u"&&OUe.call(Blob)==="[object BlobConstructor]",gQe=typeof File=="function"||typeof File<"u"&&OUe.call(File)==="[object FileConstructor]";function T9(t){return hQe&&(t instanceof ArrayBuffer||fQe(t))||mQe&&t instanceof Blob||gQe&&t instanceof File}function QN(t,e){if(!t||typeof t!="object")return!1;if(Array.isArray(t)){for(let i=0,n=t.length;i<n;i++)if(QN(t[i]))return!0;return!1}if(T9(t))return!0;if(t.toJSON&&typeof t.toJSON=="function"&&arguments.length===1)return QN(t.toJSON(),!0);for(const i in t)if(Object.prototype.hasOwnProperty.call(t,i)&&QN(t[i]))return!0;return!1}function vQe(t){const e=[],i=t.data,n=t;return n.data=UG(i,e),n.attachments=e.length,{packet:n,buffers:e}}function UG(t,e){if(!t)return t;if(T9(t)){const i={_placeholder:!0,num:e.length};return e.push(t),i}else if(Array.isArray(t)){const i=new Array(t.length);for(let n=0;n<t.length;n++)i[n]=UG(t[n],e);return i}else if(typeof t=="object"&&!(t instanceof Date)){const i={};for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&(i[n]=UG(t[n],e));return i}return t}function yQe(t,e){return t.data=DG(t.data,e),delete t.attachments,t}function DG(t,e){if(!t)return t;if(t&&t._placeholder===!0){if(typeof t.num=="number"&&t.num>=0&&t.num<e.length)return e[t.num];throw new Error("illegal attachments")}else if(Array.isArray(t))for(let i=0;i<t.length;i++)t[i]=DG(t[i],e);else if(typeof t=="object")for(const i in t)Object.prototype.hasOwnProperty.call(t,i)&&(t[i]=DG(t[i],e));return t}const bQe=["connect","connect_error","disconnect","disconnecting","newListener","removeListener"],IQe=5;var yr;(function(t){t[t.CONNECT=0]="CONNECT",t[t.DISCONNECT=1]="DISCONNECT",t[t.EVENT=2]="EVENT",t[t.ACK=3]="ACK",t[t.CONNECT_ERROR=4]="CONNECT_ERROR",t[t.BINARY_EVENT=5]="BINARY_EVENT",t[t.BINARY_ACK=6]="BINARY_ACK"})(yr||(yr={}));class wQe{constructor(e){this.replacer=e}encode(e){return(e.type===yr.EVENT||e.type===yr.ACK)&&QN(e)?this.encodeAsBinary({type:e.type===yr.EVENT?yr.BINARY_EVENT:yr.BINARY_ACK,nsp:e.nsp,data:e.data,id:e.id}):[this.encodeAsString(e)]}encodeAsString(e){let i=""+e.type;return(e.type===yr.BINARY_EVENT||e.type===yr.BINARY_ACK)&&(i+=e.attachments+"-"),e.nsp&&e.nsp!=="/"&&(i+=e.nsp+","),e.id!=null&&(i+=e.id),e.data!=null&&(i+=JSON.stringify(e.data,this.replacer)),i}encodeAsBinary(e){const i=vQe(e),n=this.encodeAsString(i.packet),r=i.buffers;return r.unshift(n),r}}function EJ(t){return Object.prototype.toString.call(t)==="[object Object]"}class U9 extends ys{constructor(e){super(),this.reviver=e}add(e){let i;if(typeof e=="string"){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");i=this.decodeString(e);const n=i.type===yr.BINARY_EVENT;n||i.type===yr.BINARY_ACK?(i.type=n?yr.EVENT:yr.ACK,this.reconstructor=new SQe(i),i.attachments===0&&super.emitReserved("decoded",i)):super.emitReserved("decoded",i)}else if(T9(e)||e.base64)if(this.reconstructor)i=this.reconstructor.takeBinaryData(e),i&&(this.reconstructor=null,super.emitReserved("decoded",i));else throw new Error("got binary data when not reconstructing a packet");else throw new Error("Unknown type: "+e)}decodeString(e){let i=0;const n={type:Number(e.charAt(0))};if(yr[n.type]===void 0)throw new Error("unknown packet type "+n.type);if(n.type===yr.BINARY_EVENT||n.type===yr.BINARY_ACK){const a=i+1;for(;e.charAt(++i)!=="-"&&i!=e.length;);const o=e.substring(a,i);if(o!=Number(o)||e.charAt(i)!=="-")throw new Error("Illegal attachments");n.attachments=Number(o)}if(e.charAt(i+1)==="/"){const a=i+1;for(;++i&&!(e.charAt(i)===","||i===e.length););n.nsp=e.substring(a,i)}else n.nsp="/";const r=e.charAt(i+1);if(r!==""&&Number(r)==r){const a=i+1;for(;++i;){const o=e.charAt(i);if(o==null||Number(o)!=o){--i;break}if(i===e.length)break}n.id=Number(e.substring(a,i+1))}if(e.charAt(++i)){const a=this.tryParse(e.substr(i));if(U9.isPayloadValid(n.type,a))n.data=a;else throw new Error("invalid payload")}return n}tryParse(e){try{return JSON.parse(e,this.reviver)}catch{return!1}}static isPayloadValid(e,i){switch(e){case yr.CONNECT:return EJ(i);case yr.DISCONNECT:return i===void 0;case yr.CONNECT_ERROR:return typeof i=="string"||EJ(i);case yr.EVENT:case yr.BINARY_EVENT:return Array.isArray(i)&&(typeof i[0]=="number"||typeof i[0]=="string"&&bQe.indexOf(i[0])===-1);case yr.ACK:case yr.BINARY_ACK:return Array.isArray(i)}}destroy(){this.reconstructor&&(this.reconstructor.finishedReconstruction(),this.reconstructor=null)}}class SQe{constructor(e){this.packet=e,this.buffers=[],this.reconPack=e}takeBinaryData(e){if(this.buffers.push(e),this.buffers.length===this.reconPack.attachments){const i=yQe(this.reconPack,this.buffers);return this.finishedReconstruction(),i}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}const TQe=Object.freeze(Object.defineProperty({__proto__:null,Decoder:U9,Encoder:wQe,get PacketType(){return yr},protocol:IQe},Symbol.toStringTag,{value:"Module"}));function Hp(t,e,i){return t.on(e,i),function(){t.off(e,i)}}const UQe=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class LUe extends ys{constructor(e,i,n){super(),this.connected=!1,this.recovered=!1,this.receiveBuffer=[],this.sendBuffer=[],this._queue=[],this._queueSeq=0,this.ids=0,this.acks={},this.flags={},this.io=e,this.nsp=i,n&&n.auth&&(this.auth=n.auth),this._opts=Object.assign({},n),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;const e=this.io;this.subs=[Hp(e,"open",this.onopen.bind(this)),Hp(e,"packet",this.onpacket.bind(this)),Hp(e,"error",this.onerror.bind(this)),Hp(e,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected?this:(this.subEvents(),this.io._reconnecting||this.io.open(),this.io._readyState==="open"&&this.onopen(),this)}open(){return this.connect()}send(...e){return e.unshift("message"),this.emit.apply(this,e),this}emit(e,...i){if(UQe.hasOwnProperty(e))throw new Error('"'+e.toString()+'" is a reserved event name');if(i.unshift(e),this._opts.retries&&!this.flags.fromQueue&&!this.flags.volatile)return this._addToQueue(i),this;const n={type:yr.EVENT,data:i};if(n.options={},n.options.compress=this.flags.compress!==!1,typeof i[i.length-1]=="function"){const o=this.ids++,s=i.pop();this._registerAckCallback(o,s),n.id=o}const r=this.io.engine&&this.io.engine.transport&&this.io.engine.transport.writable;return this.flags.volatile&&(!r||!this.connected)||(this.connected?(this.notifyOutgoingListeners(n),this.packet(n)):this.sendBuffer.push(n)),this.flags={},this}_registerAckCallback(e,i){var n;const r=(n=this.flags.timeout)!==null&&n!==void 0?n:this._opts.ackTimeout;if(r===void 0){this.acks[e]=i;return}const a=this.io.setTimeoutFn(()=>{delete this.acks[e];for(let s=0;s<this.sendBuffer.length;s++)this.sendBuffer[s].id===e&&this.sendBuffer.splice(s,1);i.call(this,new Error("operation has timed out"))},r),o=(...s)=>{this.io.clearTimeoutFn(a),i.apply(this,s)};o.withError=!0,this.acks[e]=o}emitWithAck(e,...i){return new Promise((n,r)=>{const a=(o,s)=>o?r(o):n(s);a.withError=!0,i.push(a),this.emit(e,...i)})}_addToQueue(e){let i;typeof e[e.length-1]=="function"&&(i=e.pop());const n={id:this._queueSeq++,tryCount:0,pending:!1,args:e,flags:Object.assign({fromQueue:!0},this.flags)};e.push((r,...a)=>n!==this._queue[0]?void 0:(r!==null?n.tryCount>this._opts.retries&&(this._queue.shift(),i&&i(r)):(this._queue.shift(),i&&i(null,...a)),n.pending=!1,this._drainQueue())),this._queue.push(n),this._drainQueue()}_drainQueue(e=!1){if(!this.connected||this._queue.length===0)return;const i=this._queue[0];i.pending&&!e||(i.pending=!0,i.tryCount++,this.flags=i.flags,this.emit.apply(this,i.args))}packet(e){e.nsp=this.nsp,this.io._packet(e)}onopen(){typeof this.auth=="function"?this.auth(e=>{this._sendConnectPacket(e)}):this._sendConnectPacket(this.auth)}_sendConnectPacket(e){this.packet({type:yr.CONNECT,data:this._pid?Object.assign({pid:this._pid,offset:this._lastOffset},e):e})}onerror(e){this.connected||this.emitReserved("connect_error",e)}onclose(e,i){this.connected=!1,delete this.id,this.emitReserved("disconnect",e,i),this._clearAcks()}_clearAcks(){Object.keys(this.acks).forEach(e=>{if(!this.sendBuffer.some(n=>String(n.id)===e)){const n=this.acks[e];delete this.acks[e],n.withError&&n.call(this,new Error("socket has been disconnected"))}})}onpacket(e){if(e.nsp===this.nsp)switch(e.type){case yr.CONNECT:e.data&&e.data.sid?this.onconnect(e.data.sid,e.data.pid):this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case yr.EVENT:case yr.BINARY_EVENT:this.onevent(e);break;case yr.ACK:case yr.BINARY_ACK:this.onack(e);break;case yr.DISCONNECT:this.ondisconnect();break;case yr.CONNECT_ERROR:this.destroy();const n=new Error(e.data.message);n.data=e.data.data,this.emitReserved("connect_error",n);break}}onevent(e){const i=e.data||[];e.id!=null&&i.push(this.ack(e.id)),this.connected?this.emitEvent(i):this.receiveBuffer.push(Object.freeze(i))}emitEvent(e){if(this._anyListeners&&this._anyListeners.length){const i=this._anyListeners.slice();for(const n of i)n.apply(this,e)}super.emit.apply(this,e),this._pid&&e.length&&typeof e[e.length-1]=="string"&&(this._lastOffset=e[e.length-1])}ack(e){const i=this;let n=!1;return function(...r){n||(n=!0,i.packet({type:yr.ACK,id:e,data:r}))}}onack(e){const i=this.acks[e.id];typeof i=="function"&&(delete this.acks[e.id],i.withError&&e.data.unshift(null),i.apply(this,e.data))}onconnect(e,i){this.id=e,this.recovered=i&&this._pid===i,this._pid=i,this.connected=!0,this.emitBuffered(),this.emitReserved("connect"),this._drainQueue(!0)}emitBuffered(){this.receiveBuffer.forEach(e=>this.emitEvent(e)),this.receiveBuffer=[],this.sendBuffer.forEach(e=>{this.notifyOutgoingListeners(e),this.packet(e)}),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach(e=>e()),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&this.packet({type:yr.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(e){return this.flags.compress=e,this}get volatile(){return this.flags.volatile=!0,this}timeout(e){return this.flags.timeout=e,this}onAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(e),this}prependAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(e),this}offAny(e){if(!this._anyListeners)return this;if(e){const i=this._anyListeners;for(let n=0;n<i.length;n++)if(e===i[n])return i.splice(n,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(e),this}prependAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(e),this}offAnyOutgoing(e){if(!this._anyOutgoingListeners)return this;if(e){const i=this._anyOutgoingListeners;for(let n=0;n<i.length;n++)if(e===i[n])return i.splice(n,1),this}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(e){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){const i=this._anyOutgoingListeners.slice();for(const n of i)n.apply(this,e.data)}}}function kU(t){t=t||{},this.ms=t.min||100,this.max=t.max||1e4,this.factor=t.factor||2,this.jitter=t.jitter>0&&t.jitter<=1?t.jitter:0,this.attempts=0}kU.prototype.duration=function(){var t=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var e=Math.random(),i=Math.floor(e*this.jitter*t);t=Math.floor(e*10)&1?t+i:t-i}return Math.min(t,this.max)|0};kU.prototype.reset=function(){this.attempts=0};kU.prototype.setMin=function(t){this.ms=t};kU.prototype.setMax=function(t){this.max=t};kU.prototype.setJitter=function(t){this.jitter=t};class EG extends ys{constructor(e,i){var n;super(),this.nsps={},this.subs=[],e&&typeof e=="object"&&(i=e,e=void 0),i=i||{},i.path=i.path||"/socket.io",this.opts=i,KF(this,i),this.reconnection(i.reconnection!==!1),this.reconnectionAttempts(i.reconnectionAttempts||1/0),this.reconnectionDelay(i.reconnectionDelay||1e3),this.reconnectionDelayMax(i.reconnectionDelayMax||5e3),this.randomizationFactor((n=i.randomizationFactor)!==null&&n!==void 0?n:.5),this.backoff=new kU({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(i.timeout==null?2e4:i.timeout),this._readyState="closed",this.uri=e;const r=i.parser||TQe;this.encoder=new r.Encoder,this.decoder=new r.Decoder,this._autoConnect=i.autoConnect!==!1,this._autoConnect&&this.open()}reconnection(e){return arguments.length?(this._reconnection=!!e,this):this._reconnection}reconnectionAttempts(e){return e===void 0?this._reconnectionAttempts:(this._reconnectionAttempts=e,this)}reconnectionDelay(e){var i;return e===void 0?this._reconnectionDelay:(this._reconnectionDelay=e,(i=this.backoff)===null||i===void 0||i.setMin(e),this)}randomizationFactor(e){var i;return e===void 0?this._randomizationFactor:(this._randomizationFactor=e,(i=this.backoff)===null||i===void 0||i.setJitter(e),this)}reconnectionDelayMax(e){var i;return e===void 0?this._reconnectionDelayMax:(this._reconnectionDelayMax=e,(i=this.backoff)===null||i===void 0||i.setMax(e),this)}timeout(e){return arguments.length?(this._timeout=e,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&this.backoff.attempts===0&&this.reconnect()}open(e){if(~this._readyState.indexOf("open"))return this;this.engine=new xUe(this.uri,this.opts);const i=this.engine,n=this;this._readyState="opening",this.skipReconnect=!1;const r=Hp(i,"open",function(){n.onopen(),e&&e()}),a=s=>{this.cleanup(),this._readyState="closed",this.emitReserved("error",s),e?e(s):this.maybeReconnectOnOpen()},o=Hp(i,"error",a);if(this._timeout!==!1){const s=this._timeout,l=this.setTimeoutFn(()=>{r(),a(new Error("timeout")),i.close()},s);this.opts.autoUnref&&l.unref(),this.subs.push(()=>{this.clearTimeoutFn(l)})}return this.subs.push(r),this.subs.push(o),this}connect(e){return this.open(e)}onopen(){this.cleanup(),this._readyState="open",this.emitReserved("open");const e=this.engine;this.subs.push(Hp(e,"ping",this.onping.bind(this)),Hp(e,"data",this.ondata.bind(this)),Hp(e,"error",this.onerror.bind(this)),Hp(e,"close",this.onclose.bind(this)),Hp(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(e){try{this.decoder.add(e)}catch(i){this.onclose("parse error",i)}}ondecoded(e){S9(()=>{this.emitReserved("packet",e)},this.setTimeoutFn)}onerror(e){this.emitReserved("error",e)}socket(e,i){let n=this.nsps[e];return n?this._autoConnect&&!n.active&&n.connect():(n=new LUe(this,e,i),this.nsps[e]=n),n}_destroy(e){const i=Object.keys(this.nsps);for(const n of i)if(this.nsps[n].active)return;this._close()}_packet(e){const i=this.encoder.encode(e);for(let n=0;n<i.length;n++)this.engine.write(i[n],e.options)}cleanup(){this.subs.forEach(e=>e()),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close"),this.engine&&this.engine.close()}disconnect(){return this._close()}onclose(e,i){this.cleanup(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",e,i),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;const e=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{const i=this.backoff.duration();this._reconnecting=!0;const n=this.setTimeoutFn(()=>{e.skipReconnect||(this.emitReserved("reconnect_attempt",e.backoff.attempts),!e.skipReconnect&&e.open(r=>{r?(e._reconnecting=!1,e.reconnect(),this.emitReserved("reconnect_error",r)):e.onreconnect()}))},i);this.opts.autoUnref&&n.unref(),this.subs.push(()=>{this.clearTimeoutFn(n)})}}onreconnect(){const e=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",e)}}const r1={};function eA(t,e){typeof t=="object"&&(e=t,t=void 0),e=e||{};const i=pQe(t,e.path||"/socket.io"),n=i.source,r=i.id,a=i.path,o=r1[r]&&a in r1[r].nsps,s=e.forceNew||e["force new connection"]||e.multiplex===!1||o;let l;return s?l=new EG(n,e):(r1[r]||(r1[r]=new EG(n,e)),l=r1[r]),i.query&&!e.query&&(e.query=i.queryKey),l.socket(i.path,e)}Object.assign(eA,{Manager:EG,Socket:LUe,io:eA,connect:eA});function DQe(){const t=ITe();return t?{authorization:`Bearer ${t}`}:void 0}const ms={timestampOffset:0,socket:void 0},fv={},CG=[];function EQe(t){console.log("tmxMessage:",{data:t})}function FUe(t){const e={transportOptions:{polling:{extraHeaders:DQe()}},"force new connection":!0,reconnectionDelay:1e3,reconnectionAttempts:"Infinity",timeout:2e4};if(ms.socket)console.log("socket exists");else{const n=`${ln.socketPath||"https://courthive.net"}/tmx`;ms.socket=eA.connect(n,e),ms.socket.on("ack",RQe),ms.socket.on(kJe,EQe),ms.socket.on(_Je,TUe),ms.socket.on("connect",()=>CQe(t)),ms.socket.on("disconnect",()=>console.log("disconnect")),ms.socket.on("timestamp",r=>ms.timestampOffset=new Date().getTime()-r.timestamp),ms.socket.on("connect_error",r=>{console.log("connection error:",{data:r}),ti({message:"Connection error",intent:"is-danger"}),YF()})}}function YF(){ms!=null&&ms.socket&&ms.socket.disconnect(),setTimeout(()=>delete ms.socket,1e3)}function D9({data:t,ackCallback:e}){const i=zc(),{email:n}=i||{},r=t.type??"tmx",a=()=>{if(e&&Nt(e)){const s=_i.UUID();t.payload&&Object.assign(t.payload,{ackId:s}),PQe({ackId:s,callback:e})}const o=ms.timestampOffset?new Date().getTime()+ms.timestampOffset:new Date().getTime();Object.assign(t.payload||t,{factoryVersion:gT(),tmxVersion:t9,timestamp:o,userId:n}),BUe(r,t)};if(ms.socket)a();else try{FUe(a)}catch{CG.push({header:r,data:t,ackCallback:e})}}function BUe(t,e){ms.socket.connected?ms.socket.emit(t,e):console.log("socket not connected")}function CQe(t){for(console.log("** connected"),D9({data:{type:"timestamp"}});CG.length;){const e=CG.pop();BUe(e.header,e.data)}Nt(t)&&t()}function PQe({ackId:t,uuid:e,callback:i}){t&&(fv[t]=i),e&&(fv[e]=i)}function RQe(t){t.ackId&&fv[t.ackId]&&(fv[t.ackId](t),delete fv[t.ackId]),t.uuid&&fv[t.uuid]&&(fv[t.uuid](t),delete fv[t.uuid])}var $Ue={exports:{}};(function(t,e){(function(i,n){t.exports=n()})(Zd,function(){var i=1e3,n=6e4,r=36e5,a="millisecond",o="second",s="minute",l="hour",c="day",u="week",d="month",p="quarter",h="year",f="date",m="Invalid Date",g=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,v=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,y={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(M){var A=["th","st","nd","rd"],_=M%100;return"["+M+(A[(_-20)%10]||A[_]||A[0])+"]"}},b=function(M,A,_){var x=String(M);return!x||x.length>=A?M:""+Array(A+1-x.length).join(_)+M},I={s:b,z:function(M){var A=-M.utcOffset(),_=Math.abs(A),x=Math.floor(_/60),O=_%60;return(A<=0?"+":"-")+b(x,2,"0")+":"+b(O,2,"0")},m:function M(A,_){if(A.date()<_.date())return-M(_,A);var x=12*(_.year()-A.year())+(_.month()-A.month()),O=A.clone().add(x,d),B=_-O<0,F=A.clone().add(x+(B?-1:1),d);return+(-(x+(_-O)/(B?O-F:F-O))||0)},a:function(M){return M<0?Math.ceil(M)||0:Math.floor(M)},p:function(M){return{M:d,y:h,w:u,d:c,D:f,h:l,m:s,s:o,ms:a,Q:p}[M]||String(M||"").toLowerCase().replace(/s$/,"")},u:function(M){return M===void 0}},T="en",w={};w[T]=y;var S="$isDayjsObject",D=function(M){return M instanceof R||!(!M||!M[S])},E=function M(A,_,x){var O;if(!A)return T;if(typeof A=="string"){var B=A.toLowerCase();w[B]&&(O=B),_&&(w[B]=_,O=B);var F=A.split("-");if(!O&&F.length>1)return M(F[0])}else{var G=A.name;w[G]=A,O=G}return!x&&O&&(T=O),O||!x&&T},C=function(M,A){if(D(M))return M.clone();var _=typeof A=="object"?A:{};return _.date=M,_.args=arguments,new R(_)},P=I;P.l=E,P.i=D,P.w=function(M,A){return C(M,{locale:A.$L,utc:A.$u,x:A.$x,$offset:A.$offset})};var R=function(){function M(_){this.$L=E(_.locale,null,!0),this.parse(_),this.$x=this.$x||_.x||{},this[S]=!0}var A=M.prototype;return A.parse=function(_){this.$d=function(x){var O=x.date,B=x.utc;if(O===null)return new Date(NaN);if(P.u(O))return new Date;if(O instanceof Date)return new Date(O);if(typeof O=="string"&&!/Z$/i.test(O)){var F=O.match(g);if(F){var G=F[2]-1||0,H=(F[7]||"0").substring(0,3);return B?new Date(Date.UTC(F[1],G,F[3]||1,F[4]||0,F[5]||0,F[6]||0,H)):new Date(F[1],G,F[3]||1,F[4]||0,F[5]||0,F[6]||0,H)}}return new Date(O)}(_),this.init()},A.init=function(){var _=this.$d;this.$y=_.getFullYear(),this.$M=_.getMonth(),this.$D=_.getDate(),this.$W=_.getDay(),this.$H=_.getHours(),this.$m=_.getMinutes(),this.$s=_.getSeconds(),this.$ms=_.getMilliseconds()},A.$utils=function(){return P},A.isValid=function(){return this.$d.toString()!==m},A.isSame=function(_,x){var O=C(_);return this.startOf(x)<=O&&O<=this.endOf(x)},A.isAfter=function(_,x){return C(_)<this.startOf(x)},A.isBefore=function(_,x){return this.endOf(x)<C(_)},A.$g=function(_,x,O){return P.u(_)?this[x]:this.set(O,_)},A.unix=function(){return Math.floor(this.valueOf()/1e3)},A.valueOf=function(){return this.$d.getTime()},A.startOf=function(_,x){var O=this,B=!!P.u(x)||x,F=P.p(_),G=function(X,oe){var re=P.w(O.$u?Date.UTC(O.$y,oe,X):new Date(O.$y,oe,X),O);return B?re:re.endOf(c)},H=function(X,oe){return P.w(O.toDate()[X].apply(O.toDate("s"),(B?[0,0,0,0]:[23,59,59,999]).slice(oe)),O)},$=this.$W,q=this.$M,z=this.$D,Z="set"+(this.$u?"UTC":"");switch(F){case h:return B?G(1,0):G(31,11);case d:return B?G(1,q):G(0,q+1);case u:var Y=this.$locale().weekStart||0,Q=($<Y?$+7:$)-Y;return G(B?z-Q:z+(6-Q),q);case c:case f:return H(Z+"Hours",0);case l:return H(Z+"Minutes",1);case s:return H(Z+"Seconds",2);case o:return H(Z+"Milliseconds",3);default:return this.clone()}},A.endOf=function(_){return this.startOf(_,!1)},A.$set=function(_,x){var O,B=P.p(_),F="set"+(this.$u?"UTC":""),G=(O={},O[c]=F+"Date",O[f]=F+"Date",O[d]=F+"Month",O[h]=F+"FullYear",O[l]=F+"Hours",O[s]=F+"Minutes",O[o]=F+"Seconds",O[a]=F+"Milliseconds",O)[B],H=B===c?this.$D+(x-this.$W):x;if(B===d||B===h){var $=this.clone().set(f,1);$.$d[G](H),$.init(),this.$d=$.set(f,Math.min(this.$D,$.daysInMonth())).$d}else G&&this.$d[G](H);return this.init(),this},A.set=function(_,x){return this.clone().$set(_,x)},A.get=function(_){return this[P.p(_)]()},A.add=function(_,x){var O,B=this;_=Number(_);var F=P.p(x),G=function(q){var z=C(B);return P.w(z.date(z.date()+Math.round(q*_)),B)};if(F===d)return this.set(d,this.$M+_);if(F===h)return this.set(h,this.$y+_);if(F===c)return G(1);if(F===u)return G(7);var H=(O={},O[s]=n,O[l]=r,O[o]=i,O)[F]||1,$=this.$d.getTime()+_*H;return P.w($,this)},A.subtract=function(_,x){return this.add(-1*_,x)},A.format=function(_){var x=this,O=this.$locale();if(!this.isValid())return O.invalidDate||m;var B=_||"YYYY-MM-DDTHH:mm:ssZ",F=P.z(this),G=this.$H,H=this.$m,$=this.$M,q=O.weekdays,z=O.months,Z=O.meridiem,Y=function(oe,re,me,se){return oe&&(oe[re]||oe(x,B))||me[re].slice(0,se)},Q=function(oe){return P.s(G%12||12,oe,"0")},X=Z||function(oe,re,me){var se=oe<12?"AM":"PM";return me?se.toLowerCase():se};return B.replace(v,function(oe,re){return re||function(me){switch(me){case"YY":return String(x.$y).slice(-2);case"YYYY":return P.s(x.$y,4,"0");case"M":return $+1;case"MM":return P.s($+1,2,"0");case"MMM":return Y(O.monthsShort,$,z,3);case"MMMM":return Y(z,$);case"D":return x.$D;case"DD":return P.s(x.$D,2,"0");case"d":return String(x.$W);case"dd":return Y(O.weekdaysMin,x.$W,q,2);case"ddd":return Y(O.weekdaysShort,x.$W,q,3);case"dddd":return q[x.$W];case"H":return String(G);case"HH":return P.s(G,2,"0");case"h":return Q(1);case"hh":return Q(2);case"a":return X(G,H,!0);case"A":return X(G,H,!1);case"m":return String(H);case"mm":return P.s(H,2,"0");case"s":return String(x.$s);case"ss":return P.s(x.$s,2,"0");case"SSS":return P.s(x.$ms,3,"0");case"Z":return F}return null}(oe)||F.replace(":","")})},A.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},A.diff=function(_,x,O){var B,F=this,G=P.p(x),H=C(_),$=(H.utcOffset()-this.utcOffset())*n,q=this-H,z=function(){return P.m(F,H)};switch(G){case h:B=z()/12;break;case d:B=z();break;case p:B=z()/3;break;case u:B=(q-$)/6048e5;break;case c:B=(q-$)/864e5;break;case l:B=q/r;break;case s:B=q/n;break;case o:B=q/i;break;default:B=q}return O?B:P.a(B)},A.daysInMonth=function(){return this.endOf(d).$D},A.$locale=function(){return w[this.$L]},A.locale=function(_,x){if(!_)return this.$L;var O=this.clone(),B=E(_,x,!0);return B&&(O.$L=B),O},A.clone=function(){return P.w(this.$d,this)},A.toDate=function(){return new Date(this.valueOf())},A.toJSON=function(){return this.isValid()?this.toISOString():null},A.toISOString=function(){return this.$d.toISOString()},A.toString=function(){return this.$d.toUTCString()},M}(),N=R.prototype;return C.prototype=N,[["$ms",a],["$s",o],["$m",s],["$H",l],["$W",c],["$M",d],["$y",h],["$D",f]].forEach(function(M){N[M[1]]=function(A){return this.$g(A,M[0],M[1])}}),C.extend=function(M,A){return M.$i||(M(A,R,C),M.$i=!0),C},C.locale=E,C.isDayjs=D,C.unix=function(M){return C(1e3*M)},C.en=w[T],C.Ls=w,C.p={},C})})($Ue);var MQe=$Ue.exports;const E9=RP(MQe);async function Wt(t){var b,I,T,w;const{tournamentRecord:e,methods:i,engine:n=HBe,callback:r}=t,a=zc(),o=S=>{if(e&&CV[n].reset(),Nt(r))return r(S);S.error&&ti({message:S.error.message??"Error",intent:"is-danger"})};if(!Array.isArray(i))return o();const s=CV[n];if(!s)return o();e&&s.setState(e);const l=S=>{var D;return(D=S==null?void 0:S.parentOrganisation)==null?void 0:D.organisationId},c=((b=s.getState())==null?void 0:b.tournamentRecords)??{},u=S=>{var D,E,C;return(C=(E=(D=S.timeItems)==null?void 0:D.find(({itemType:P})=>P==="TMX"))==null?void 0:E.itemValue)==null?void 0:C.offline},d=(I=Object.values(c))==null?void 0:I.map(u).filter(Boolean);if(d.length>1&&!d.every(S=>!S.email||S.email===d[0].email))return ti({message:"Not all linked tournaments are offline",intent:"is-danger"});const h=d.length,f=(T=Object.values(c))==null?void 0:T.map(S=>S.tournamentId),m=_i.unique((w=Object.values(c))==null?void 0:w.map(l)).filter(Boolean);if(m.length>1)return ti({message:"Multiple providers",intent:"is-danger"});const g=new Date().getTime(),v=Object.values(c).every(S=>{const D=E9(S.endDate).endOf("day").valueOf();return D&&D>=g}),y=S=>AQe({offline:h,methods:i,factoryEngine:s,tournamentIds:f,completion:o,saveLocal:S});return v?m.length&&!h?VUe({state:a,providerIds:m,mutate:y}):y(!0):NQe({state:a,providerIds:m,mutate:y})}function NQe({state:t,providerIds:e,mutate:i}){return ti({action:{onClick:()=>e!=null&&e.length?VUe({state:t,providerIds:e,mutate:i}):i(),text:"Modify?"},message:"Not in date range",intent:"is-danger"})}function VUe({state:t,providerIds:e,mutate:i}){var s,l,c,u;if(!t)return Tt.provider=void 0,wB(!1),ti({message:"Not logged in",intent:"is-warning"});const n=!!((s=t==null?void 0:t.providerIds)!=null&&s.includes(e[0])||((l=t==null?void 0:t.provider)==null?void 0:l.organisationId)===e[0]),r=(c=t==null?void 0:t.roles)==null?void 0:c.includes(FO),a=((u=Tt.provider)==null?void 0:u.organisationId)===e[0];return!n&&!r?ti({message:"Not authorized",intent:"is-danger"}):!n&&r&&!a?ti({action:{onClick:()=>(Tt.provider={organisationId:e[0]},i(!1)),text:"Impersonate?"},message:"Super Admin",intent:"is-danger"}):i(!n&&!(r&&a))}function CJ({factoryEngine:t,methods:e}){var n;(n=ln.log)!=null&&n.verbose&&console.log("%c executing locally","color: lightgreen");const i=_i.makeDeepCopy(e);return t.executionQueue(i,!0)||{}}async function N$(t){(t||ln.saveLocal)&&await i9()}async function AQe({offline:t,methods:e,completion:i,factoryEngine:n,tournamentIds:r,saveLocal:a}){var c,u,d,p,h;const o=(u=(c=n.getTournament().tournamentRecord)==null?void 0:c.parentOrganisation)==null?void 0:u.organisationId;if((d=window.dev)!=null&&d.params)for(const f of e)window.dev.params[f.method]&&(f.params={...f.params,...window.dev.params[f.method]});(p=window==null?void 0:window.dev)!=null&&p.getContext().internal&&console.log({methods:e});const s=!ln.serverFirst||!o;let l;if(s||t){if(l=CJ({factoryEngine:n,methods:e}),l.error)return i(l);if(!o||t)return await N$(!0),i(l)}if(o&&(l!=null&&l.success||ln.serverFirst)){const f=async m=>{var v;const g=((v=m==null?void 0:m.error)==null?void 0:v.code)==="ERR_MISSING_TOURNAMENT";if(ln.serverFirst&&(m!=null&&m.success||g))return l=CJ({factoryEngine:n,methods:e}),l.error||await N$(a||g),i(l)};(h=ln.log)!=null&&h.verbose&&console.log("%c invoking remote","color: lightblue"),D9({data:{type:"executionQueue",payload:{methods:e,tournamentIds:r,rollbackOnError:!0}},ackCallback:f}),s&&await N$(a)}if(s)return i(l)}function II(t,e){return Array.from(t.classList).indexOf(e)>=0?t:Bl(t,e)}function Bl(t,e){if(!t)return null;if(t.classList&&Array.from(t.classList).indexOf(e)>=0)return t;for(;t.parentNode;)if(t=t.parentNode,t.classList&&Array.from(t.classList).indexOf(e)>=0)return t;return null}function a1(t,e,i){const n=Bl(t,e);return n==null?void 0:n.getAttribute(i)}function mg(t,e){const i=[];function n(r){r.childNodes.forEach(a=>{a.childNodes.length>0&&n(a),a.classList&&Array.from(a.classList).indexOf(e)>=0&&i.push(a)})}return n(t),i}function _Qe(){ti({intent:"is-success",message:"Success"})}function kQe(t){ti({intent:"is-danger",message:(t==null?void 0:t.message)??"Failure"})}function xQe(){var c,u,d;const t=at.getTournament().tournamentRecord,e=(d=(u=(c=t==null?void 0:t.timeItems)==null?void 0:c.find(({itemType:p})=>p==="TMX"))==null?void 0:u.itemValue)==null?void 0:d.offline,i=t==null?void 0:t.parentOrganisation,n=i==null?void 0:i.organisationId,r=zc();let a;const o=()=>{if(a.action.value==="upload"&&a.replace.checked){const p=at.getTournament().tournamentRecord;return ti({action:{onClick:()=>H1({tournamentRecord:p}).then(_Qe,kQe),text:"Send??"},message:"Upload tournament",intent:"is-danger"})}if(a.action.value==="claim"&&(r!=null&&r.provider)){const p=at.getTournament().tournamentRecord;if(!p.parentOrganisation){p.parentOrganisation=r.provider,at.setState(p);const h=()=>{xc.deleteTournament(p.tournamentId),Tt.router.navigate(`/tournament/${p.tournamentId}/detail`),ti({message:"Tournament claimed",intent:"is-info"})},f=m=>{ti({message:m.message||"Not claimed",intent:"is-danger"})};H1({tournamentRecord:p}).then(h,f)}}a.action.value==="goOffline"&&(r!=null&&r.provider)&&A$({postMutation:h=>{if(h!=null&&h.success){i9();const f=document.getElementById("dnav");f.style.backgroundColor="lightyellow",ti({message:"Offline",intent:"is-info"})}},state:r,offline:!0}),a.action.value==="goOnline"&&(r!=null&&r.provider)&&A$({postMutation:h=>{if(h!=null&&h.success){const f=()=>{xc.deleteTournament(t.tournamentId);const v=document.getElementById("dnav");v.style.backgroundColor="",ti({message:"Online",intent:"is-info"})},m=v=>{console.log({err:v}),A$({state:r,offline:!0})},g=at.getTournament().tournamentRecord;H1({tournamentRecord:g}).then(f,m)}},state:r,offline:!1})},s=[{control:"replace",onChange:({e:p})=>{const h=document.getElementById("go");h.disabled=!p.target.checked}},{control:"action",onChange:({e:p})=>{const h=document.getElementById("replace"),f=Bl(h,"field");f.style.display=p.target.value==="upload"?"block":"none";const m=document.getElementById("go");m.disabled=a.action.value==="upload"}}];cr({title:"Tournament Actions",content:p=>a=Cr(p,[{options:[{label:"-- select action --",close:!0},n&&{label:"Upload tournament",value:"upload",close:!0},{label:"Delete tournament",disabled:!0,value:"delete",close:!0},t&&!n&&(r==null?void 0:r.provider)&&{label:"Claim tournament",value:"claim",close:!0},n&&!e&&{label:"Go offline - standalone mode",value:"goOffline",close:!0},n&&e&&{label:"Go online - exit standalone mode",value:"goOnline",close:!0}].filter(Boolean),label:"Action",field:"action"},{label:"Replace tournament on server",field:"replace",visible:!1,checkbox:!0,id:"replace"}],s),buttons:[{label:"Cancel",intent:"none",close:!0},{label:"Go",id:"go",intent:"is-danger",disabled:!0,onClick:o,close:!0}]})}function A$({postMutation:t,state:e,offline:i}){var a;const n={...(((a=at.getTournamentTimeItem({itemType:"TMX"}))==null?void 0:a.timeItem)??{}).itemValue};i?n.offline={email:e.email}:delete n.offline,Wt({methods:[{method:K9e,params:{removePriorValues:!0,timeItem:{itemType:"TMX",itemValue:n}}}],callback:t})}function jUe(){const t=!window.location.host.startsWith("localhost");!window.location.host.endsWith("github.io")&&t&&window.dev&&(delete window.dev,console.log("%c dev cancelled","color: cyan"))}var GUe=function(t){return String.prototype.normalize?t.normalize("NFKD").replace(/[\u0300-\u036F]/g,""):t};function HUe(t,e){let i=document.createElement("a");i.style.display="none",i.setAttribute("href",e),i.setAttribute("download",t);let n=document.body.appendChild(i);n.click(),n.remove()}function OQe(t,e){let i="data:text/json;charset=utf-8,"+encodeURIComponent(x9e(e));HUe(t,i)}function LQe(t,e){let i="data:text/plain;charset=utf-8,"+encodeURIComponent(e);HUe(t,i)}function FQe(){const t=s=>s.toString()[1]?s:"0"+s,e=s=>{if(!s)return"";const l=new Date(s);return[t(l.getMonth()+1),t(l.getDate()),l.getFullYear()].join("/")},{tournamentInfo:i}=at.getTournamentInfo(),{completedMatchUps:n}=at.tournamentMatchUps({context:{tournamentStartDate:e(i.startDate),tournamentEndDate:e(i.endDate),tournamentEventSource:"CourtHive",tournamentEventType:"Tournament",...i,idType:rI}}),r=n.map(s=>{const{winningSide:l,sides:c,score:u}=s,d=c.find(({sideNumber:f})=>f===l),p=c.find(({sideNumber:f})=>f!==l);return{winnerScore:u[`scoreStringSide${l}`],...s,winners:d,losers:p}}),a={columnAccessors:[""],columnTransform:{"Winner 1 Name":["winners.participant.individualParticipants.0.participantName","winners.participant.participantName"],"Winner 1 Third Party ID":["winners.participant.individualParticipants.0.participantId","winners.participant.participantId"],"Winner 1 City":["winners.participant.individualParticipants.0.addresses.0.city","winners.participant.addresses.0.city"],"Winner 1 State":["winners.participant.individualParticipants.0.addresses.0.state","winners.participant.addresses.0.state"],"Winner 1 Country":["winners.participant.individualParticipants.0.addresses.0.nationalityCode","winners.participant.addresses.0nationalityCode"],"Winner 1 Gender":["winners.participant.individualParticipants.0.person.sex","winners.participant.person.sex"],"Winner 1 DOB":["winners.participant.individualParticipants.0.person.birthDate","winners.participant.person.birthDate"],"Winner 2 Name":["winner.participant.individualParticipants.1.participantName"],"Winner 2 City":["winners.participant.individualParticipants.1.addresses.0.city"],"Winner 2 State":["winners.participant.individualParticipants.1.addresses.0.state"],"Winner 2 Country":["winners.participant.individualParticipants.1.addresses.0.nationalityCode"],"Winner 2 Third Party ID":["winners.participant.individualParticipants.1.participantId"],"Winner 2 Gender":["winners.participant.individualParticipants.1.person.sex"],"Winner 2 DOB":["winners.participant.individualParticipants.1.person.birthDate"],"Loser 1 Name":["losers.participant.individualParticipants.0.participantName","losers.participant.participantName"],"Loser 1 City":["losers.participant.individualParticipants.0.addresses.0.city","losers.participant.addresses.0.city"],"Loser 1 State":["losers.participant.individualParticipants.0.addresses.0.state","losers.participant.addresses.0.state"],"Loser 1 Country":["losers.participant.individualParticipants.0.addresses.0.nationalityCode","losers.participant.addresses.0nationalityCode"],"Loser 1 Third Party ID":["losers.participant.individualParticipants.0.participantId","losers.participant.participantId"],"Loser 1 Gender":["losers.participant.individualParticipants.0.person.sex","winners.participant.person.sex"],"Loser 1 DOB":["losers.participant.individualParticipants.0.person.birthDate","losers.participant.person.birthDate"],"Loser 2 Name":["losers.participant.individualParticipants.1.participantName"],"Loser 2 City":["losers.participant.individualParticipants.1.addresses.0.city"],"Loser 2 State":["losers.participant.individualParticipants.1.addresses.0.state"],"Loser 2 Country":["losers.participant.individualParticipants.1.addresses.0.nationalityCode"],"Loser 2 Third Party ID":["losers.participant.individualParticipants.1.participantId"],"Loser 2 Gender":["losers.participant.individualParticipants.1.person.sex"],"Loser 2 DOB":["losers.participant.individualParticipants.1.person.birthDate"],"Tournament Start Date":["tournamentStartDate"],"Tournament End Date":["tournamentEndDate"],"Tournament Import Source":["tournamentEventSource"],"Tournament Event Type":["tournamentEventType"],"Tournament Name":["tournamentName"],"Draw Name":[nI],"Draw Type":[Yp],"Match ID":["matchUpId"],Score:["winnerScore"],"Id Type":["idType"]}};let o=_i.JSON2CSV(r,a);LQe(`UTR-${i.tournamentId}.csv`,o)}function BQe(){const{tournamentRecord:t}=at.getTournament();if(!t)return;const i=[{label:"Cancel",intent:"none"},{label:rI,intent:"is-warning",onClick:FQe,close:!0},{label:"TODS",intent:"is-primary",onClick:()=>{t?OQe(`${t.tournamentId}.tods.json`,t):ti({message:"Error"})},close:!0}],n=`${Bo.tr("phrases.export")}: ${Bo.tr("trn")}`;cr({title:n,content:t.tournamentName,buttons:i})}function $Qe(t){t.getElement().style.border="1px solid black";const e=t.getValue(),i=document.createElement("div");return i.innerHTML=e||"",i}function xU(t){const{e,table:i,classNames:n=[],className:r,visible:a,columns:o}=t,s=Bl(e.target,"options_right"),l=a?"":Mt,c=a?Mt:"";for(const u of s.children){const d=r?Array.from(u.classList).includes(r):Array.from(u.classList).some(p=>n.includes(p));u.style.display=d?l:c}for(const u of o)i.updateColumnDefinition(u,{formatter:a?$Qe:void 0,editable:a})}function VQe(t,e){xU({columns:["ratings.wtn.wtnRating","ratings.utr.utrRating"],className:"saveRatings",visible:!0,table:e,e:t}),e.showColumn("ratings.utr.utrRating"),e.showColumn("ratings.wtn.wtnRating"),e.redraw(!0)}const zUe=t=>{const e=document.createElement("ul");return t.forEach(i=>{let n=document.createElement("li");if(i.field==="sex")n.innerHTML="<strong>Gender:&nbsp;</strong>"+i.value;else if(lp(i.value)){if(i.value){let r=document.createElement("div");r.innerHTML=`<strong>${i.title}:&nbsp;</strong>`,n.appendChild(r),n.appendChild(i.value)}}else n.innerHTML="<strong>"+i.title+"</strong>:&nbsp;"+i.value;e.appendChild(n)}),Object.keys(t).length?e:""},jQe=(t,e)=>{var i,n;return(n=(i=t.groups)==null?void 0:i.find(r=>{var a;return(a=r.participantRoleResponsibilities)==null?void 0:a.includes(e)}))==null?void 0:n.participantName},GQe=t=>jQe(t,"CLUB"),qUe=(t,e)=>(t.events||[]).map(({eventId:i})=>e==null?void 0:e[i]),WUe=t=>{var e;return((e=Qm.countries.find(i=>i.ioc===t||i.iso===t))==null?void 0:e.label)||""},HQe=/[\p{Lu}]/u,zQe=/[\p{Ll}]/u,PJ=/^[\p{Lu}](?![\p{Lu}])/gu,KUe=/([\p{Alpha}\p{N}_]|$)/u,C9=/[_.\- ]+/,qQe=new RegExp("^"+C9.source),RJ=new RegExp(C9.source+KUe.source,"gu"),MJ=new RegExp("\\d+"+KUe.source,"gu"),WQe=(t,e,i,n)=>{let r=!1,a=!1,o=!1,s=!1;for(let l=0;l<t.length;l++){const c=t[l];s=l>2?t[l-3]==="-":!0,r&&HQe.test(c)?(t=t.slice(0,l)+"-"+t.slice(l),r=!1,o=a,a=!0,l++):a&&o&&zQe.test(c)&&(!s||n)?(t=t.slice(0,l-1)+"-"+t.slice(l-1),o=a,a=!1,r=!0):(r=e(c)===c&&i(c)!==c,o=a,a=i(c)===c&&e(c)!==c)}return t},KQe=(t,e)=>(PJ.lastIndex=0,t.replaceAll(PJ,i=>e(i))),YQe=(t,e)=>(RJ.lastIndex=0,MJ.lastIndex=0,t.replaceAll(MJ,(i,n,r)=>["_","-"].includes(t.charAt(r+i.length))?i:e(i)).replaceAll(RJ,(i,n)=>e(n)));function ZQe(t,e){if(!(typeof t=="string"||Array.isArray(t)))throw new TypeError("Expected the input to be `string | string[]`");if(e={pascalCase:!1,preserveConsecutiveUppercase:!1,...e},Array.isArray(t)?t=t.map(a=>a.trim()).filter(a=>a.length).join("-"):t=t.trim(),t.length===0)return"";const i=e.locale===!1?a=>a.toLowerCase():a=>a.toLocaleLowerCase(e.locale),n=e.locale===!1?a=>a.toUpperCase():a=>a.toLocaleUpperCase(e.locale);return t.length===1?C9.test(t)?"":e.pascalCase?n(t):i(t):(t!==i(t)&&(t=WQe(t,i,n,e.preserveConsecutiveUppercase)),t=t.replace(qQe,""),t=e.preserveConsecutiveUppercase?KQe(t,i):i(t),e.pascalCase&&(t=n(t.charAt(0))+t.slice(1)),YQe(t,n))}const{WTN:XQe,UTR:JQe}=ks.ratingConstants,{SINGLES:NJ}=ks.eventConstants,QQe=(t,e)=>{var h,f,m,g,v,y,b,I,T;const{participantId:i,participantName:n,participantType:r,person:a}=t,{standardFamilyName:o,standardGivenName:s}=a||{},l=(f=(h=t.person)==null?void 0:h.addresses)==null?void 0:f[0],c=l!=null&&l.city&&(l!=null&&l.state)?`${l.city}, ${l.state}`:void 0,u=(v=(g=(m=t.ratings)==null?void 0:m[NJ])==null?void 0:g.find(w=>w.scaleName===JQe))==null?void 0:v.scaleValue,p={wtn:(I=(b=(y=t.ratings)==null?void 0:y[NJ])==null?void 0:b.find(w=>w.scaleName===XQe))==null?void 0:I.scaleValue,utr:u};return{searchText:`${n} ${s} ${o}`.toLowerCase(),sex:ZQe(t.person.sex||"",{pascalCase:!0}),eventIds:t.events.map(({eventId:w})=>w),ioc:WUe((T=t.person)==null?void 0:T.nationalityCode),events:qUe(t,e),penalties:t.penalties||[],tennisId:t.person.tennisId,signedIn:t.signedIn,lastName:o,firstName:s,club:GQe(t),teams:t.teams,participantName:n,participantType:r,participantId:i,participant:t,cityState:c,ratings:p}},Fh=t=>(e,i)=>{const n=e.getDefinition();return t.includes(n.field)?"":i==="asc"&&"<div><i class='fas fa-sort-up'></div>"||i==="desc"&&"<div><i class=' fas fa-sort-down'></div>"||"<div><i class='fas fa-sort'></div>"},{MALE:eet,FEMALE:tet}=Mp,{PAIR:iet}=Yo,Pw=t=>(e,i,n)=>{var d;const r=e.getColumn().getDefinition(),a=r.field==="side1"&&1||r.field==="side2"&&2,o=document.createElement("div"),s=e.getRow().getData(),l=s.winningSide,c=e.getValue(),u=s.participant||(c==null?void 0:c.participant)||s.person&&s;if(u){const p=ln.scales[ln.activeScale],h=m=>dTe({eventHandlers:{participantClick:g=>Nt(t)&&t({...g,event:g.pointerEvent,cell:e})},composition:{configuration:{participantDetail:"TEAM",genderColor:!0,winnerColor:!0,scaleAttributes:p,flag:!1}},matchUp:s.matchUp,participant:m,placeholder:i,sideNumber:a}),f=m=>{var v;const g=document.createElement("div");return g.className="flexrow flexjustifystart",(v=m.individualParticipants)==null||v.forEach((y,b)=>{if(g.appendChild(h(y)),!b){const I=document.createElement("span");I.style.width="1em",I.innerHTML="&nbsp;",g.appendChild(I)}}),g};return n==="sideBySide"&&u.participantType===iet?f(u):h(u)}if(l){const p=r.field===s.winningSide;o.style.color=p?"green":"red"}else{const p=(c==null?void 0:c.sex)||((d=s==null?void 0:s.person)==null?void 0:d.sex),h=p===eet&&"#2E86C1"||p===tet&&"#AA336A"||"";o.style.color=h}return o.innerHTML=(lp(c)?c.participantName:c)||"",o};function net(t){const e=t.getValue();return(e==null?void 0:e.length)||0}function iT(t,e){var r,a,o,s;const i=(t==null?void 0:t.person)||((r=t==null?void 0:t.participant)==null?void 0:r.person),n=(e==null?void 0:e.person)||((a=e==null?void 0:e.participant)==null?void 0:a.person);return i||n?i!=null&&i.standardFamilyName&&!(n!=null&&n.standardFamilyName)||n!=null&&n.standardFamilyName&&!(i!=null&&i.standardFamilyName)||!(i!=null&&i.standardFamilyName)&&!(n!=null&&n.standardFamilyName)?1:(o=i.standardFamilyName)==null?void 0:o.localeCompare(n==null?void 0:n.standardFamilyName):t.participantName&&!e.participantName||e.participantName&&!t.participantName||!(t!=null&&t.participantName)&&!(e!=null&&e.participantName)?1:(s=t==null?void 0:t.participantName)==null?void 0:s.localeCompare(e==null?void 0:e.participantName)}async function YUe({participantIds:t,participantId:e,callback:i}){(e||t)&&Wt({methods:[{params:{participantIds:t||[e]},method:tKe}],callback:a=>{a.success?Nt(i)&&i(a):console.log({result:a})}})}const{COMPETITOR:ret,OFFICIAL:AJ}=Mg,{INDIVIDUAL:aet}=Yo;function ZUe({participant:t,view:e,callback:i}){var m,g,v,y;const n=Qm.countries.map(b=>({label:Qm.countryToFlag(b.iso||"")+" "+b.label,value:b.ioc})),r={nationalityCode:(m=t==null?void 0:t.person)==null?void 0:m.nationalityCode,firstName:(g=t==null?void 0:t.person)==null?void 0:g.standardGivenName,lastName:(v=t==null?void 0:t.person)==null?void 0:v.standardFamilyName,sex:(y=t==null?void 0:t.person)==null?void 0:y.sex};let a;const o=b=>r.nationalityCode=b,s=({firstName:b,lastName:I})=>ta(2)(b||"")&&ta(2)(I||""),l=({inputs:b})=>{const I=s({firstName:b.firstName.value,lastName:b.lastName.value}),T=document.getElementById("saveParticipant");T&&(T.disabled=!I)},c=[{onInput:l,control:"firstName"},{onInput:l,control:"lastName"}],u=b=>{a=Cr(b,[{error:"Please enter a name of at least 3 characters",value:r.firstName||"",validator:ta(2),placeholder:"Given name",label:"First name",field:"firstName",focus:!0},{error:"Please enter a name of at least 3 characters",value:r.lastName||"",validator:ta(2),placeholder:"Family name",label:"Last name",field:"lastName"},{value:void 0,label:"Sex",field:"sex",options:[{label:"Unknown",value:void 0,selected:!r.sex},{label:"Male",value:"MALE",selected:r.sex==="MALE"},{label:"Female",value:"FEMALE",selected:r.sex==="FEMALE"}]},{placeholder:"Birthday",value:r.birthDate||"",label:"Date of birth",field:"birthday",date:!0},{typeAhead:{list:n,callback:o},placeholder:"Country of origin",value:r.nationalityCode||"",field:"nationalityCode",label:"Country"}],c)},d=(b,I)=>Cw(b,[{label:"Cancel",close:!0},{disabled:!s(r),onClick:h,id:"saveParticipant",intent:"is-info",label:"Save",close:!0}],I),p=t?"Edit":"New";Tt.drawer.open({title:`<b style='larger'>${p} participant</b>`,callback:()=>{},width:"300px",side:Qt,content:u,footer:d});function h(){if(!(t!=null&&t.participantId))f();else{const b={nationalityCode:a.nationalityCode.value,standardFamilyName:a.lastName.value,standardGivenName:a.firstName.value,birthdate:a.birthday.value,sex:a.sex.value},I=[{params:{participant:{participantId:t.participantId,person:b}},method:X_}];Wt({methods:I,callback:w=>{w.success?Nt(i)&&i():console.log(w)}})}}function f(){const b=a.firstName.value,I=a.lastName.value,T=a.sex.value,w={participantRole:e===AJ?AJ:ret,participantType:aet,participantId:_i.UUID(),person:{nationalityCode:r.nationalityCode,standardGivenName:b,standardFamilyName:I,sex:T}};Wt({methods:[{params:{participants:[w]},method:YR}],callback:E=>{E.success&&Nt(i)&&i(),!E.success&&console.log(E)}})}return{...wP}}function oet({participantId:t,callback:e}){var n;const i=(n=at.getParticipants({participantFilters:{participantIds:[t]},inContext:!1}).participants)==null?void 0:n[0];if(i)return ZUe({participant:i,callback:e})}const tA=t=>(e,i)=>{const n=Array.from(document.querySelectorAll(".tippy-content"));if(n.length){n.forEach(u=>u.remove());return}const r=e.target.getElementsByClassName("fa-ellipsis-vertical")[0],a=i.getRow(),o=a.getData(),{participantId:s,participantType:l}=o;pc({items:[{hide:l!=="INDIVIDUAL",text:"<i class='fas fa-address-card'></i> Participant profile",onClick:()=>{var u;return console.log("Participant profile",(u=i.getData())==null?void 0:u.participant)}},{hide:l!=="INDIVIDUAL",text:"<i class='fas fa-user'></i> Edit Participant",onClick:()=>{oet({participantId:s,callback:t})}},{text:"<div style='color: red'><i class='fas fa-check-square'></i> Delete participant</div>",onClick:()=>{YUe({participantId:s,callback:d=>{if(d.success)a.delete();else{const p=i.getTable();p.alert(d.error.message||"Cannot Remove Participant"),setTimeout(()=>p.clearAlert(),2500)}}})}}],target:r||e.target,config:{placement:gp}})},{SINGLES:set}=pl,XUe=t=>e=>{const i=e.getColumn().getDefinition(),n=document.createElement("div");n.className="tags";const r=e.getValue(),a=e.getRow().getData(),{participantId:o}=a,s=(l,c)=>{var u;return(u=l==null?void 0:l.eventName)==null?void 0:u.localeCompare(c==null?void 0:c.eventName)};return r.sort(s).forEach(l=>{const c=JUe({def:i,participantId:o,event:l,eventClick:t});n.appendChild(c)}),n};function JUe({matchUpId:t,participantId:e,event:i,eventClick:n}){var a,o;const r=document.createElement("span");return Nt(n)&&(r.onclick=()=>n({eventId:i.eventId,participantId:e,matchUpId:t})),r.className="tag event-pill",(a=i.gender)!=null&&a.toLowerCase().includes("female")?r.classList.add("is-danger"):(o=i.gender)!=null&&o.toLowerCase().includes("male")?r.classList.add("is-link"):r.classList.add("is-primary"),i.eventType===set&&r.classList.add("is-light"),r.innerHTML=i.eventName,r}const cet=t=>e=>{const i=e.getColumn().getDefinition(),n=e.getRow().getData(),{matchUpId:r}=n,a=document.createElement("div");a.className="tags";const o=JUe({def:i,matchUpId:r,event:n,eventClick:t});return a.append(o),a},QUe=t=>e=>{const i=e.getColumn().getDefinition(),n=document.createElement("div");n.className="tags";const r=e.getValue(),a=(o,s)=>{var l;return(l=o==null?void 0:o.participantName)==null?void 0:l.localeCompare(s==null?void 0:s.participantName)};return r.sort(a).forEach(o=>{const s=uet({def:i,team:o,teamClick:t});n.appendChild(s)}),n};function uet({matchUpId:t,team:e,teamClick:i}){const n=document.createElement("span"),{participantId:r,participantName:a}=e;return Nt(i)&&(n.onclick=()=>i({participantId:r,matchUpId:t})),n.className="tag event-pill",n.innerHTML=a,n}const PG=({maxValue:t,decimals:e,field:i})=>(n,r,a)=>{const o=e?/[^0-9.]/g:/[^0-9]/g,s=document.createElement("input");s.style.backgroundColor="lightyellow",s.style.boxSizing="border-box",s.style.textAlign="center",s.style.padding="3px",s.style.height="100%",s.style.width="100%",s.value=n.getValue()||"",r(()=>{s.focus(),s.select()});function l(){let c=s.value;e&&(c=parseFloat(c).toFixed(2)),a(isNaN(c)?void 0:c)}return s.addEventListener("keydown",c=>{c.key==="Tab"&&(c.preventDefault(),c.stopPropagation())}),s.addEventListener("keyup",c=>{const u=c.target.value.replace(o,"")||"";if(c.target.value=u>t?"":u,c.key==="Tab"&&c.shiftKey&&i){const p=Bl(c.target,"tabulator-row").previousSibling,h=p&&mg(p,"tabulator-editable");if(h)for(n of h)n.getAttribute("tabulator-field")===i&&n.focus()}else if((c.key==="Enter"||c.key==="Tab")&&i){const p=Bl(c.target,"tabulator-row").nextSibling,h=p&&mg(p,"tabulator-editable");if(h)for(n of h)n.getAttribute("tabulator-field")===i&&n.focus()}}),s.addEventListener("blur",l),s},_J=t=>Tt.columns[t]!==!1;function ea({eventId:t,drawId:e,structureId:i,renderDraw:n,participantId:r,matchUpId:a,view:o}){var d,p,h,f;const s=(p=(d=at.getTournament())==null?void 0:d.tournamentRecord)==null?void 0:p.tournamentId,l=t&&at.getEvent({eventId:t,drawId:e}).event,c=((h=l==null?void 0:l.drawDefinitions)==null?void 0:h.length)===1&&l.drawDefinitions[0];r&&c&&(e=c.drawId,n=!0),a&&(e=(f=l.drawDefinitions.find(({drawId:m})=>at.allDrawMatchUps({drawId:m,inContext:!1}).matchUps.find(v=>v.matchUpId===a)))==null?void 0:f.drawId,n=!!e);let u=`/${Fo}/${s}/${ob}/${t}`;n&&e?(u+=`/${y1}/${e}`,i&&(u+=`/${PV}/${i}`),[NV,TS,SS].includes(o)&&(u+=`/${RV}/${o}`)):e&&(u+=`/${ehe}/${e}`),Tt.router.navigate(u)}const Hg=()=>"<i class='fa fa-ellipsis-vertical'></i>",{SIGNED_IN:det,SIGNED_OUT:pet}=Yo;function het(t,e){const i=e.getRow().getData().participantId,n=!e.getValue();Wt({methods:[{params:{signInState:n?det:pet,participantIds:[i]},method:o9}],callback:s=>{s.success&&e.setValue(n)}})}const fet=({field:t})=>(e,i,n)=>{const r=document.createElement("input");r.style.backgroundColor="lightyellow",r.style.boxSizing="border-box",r.style.textAlign="center",r.style.padding="3px",r.style.height="100%",r.style.width="100%",r.value=e.getValue()||"",i(()=>{r.focus(),r.select()});function a(){const o=r.value;n(o)}return r.addEventListener("keydown",o=>{o.key==="Tab"&&(o.preventDefault(),o.stopPropagation())}),r.addEventListener("keyup",o=>{if(o.key==="Tab"&&o.shiftKey&&t){const l=Bl(o.target,"tabulator-row").previousSibling,c=l&&mg(l,"tabulator-editable");if(c)for(e of c)e.getAttribute("tabulator-field")===t&&e.focus()}else if((o.key==="Enter"||o.key==="Tab")&&t){const l=Bl(o.target,"tabulator-row").nextSibling,c=l&&mg(l,"tabulator-editable");if(c)for(e of c)e.getAttribute("tabulator-field")===t&&e.focus()}}),r.addEventListener("blur",a),r},_$="fa-check-square",vm=t=>(e,i)=>{const n=i.getTable(),r=n.getColumns(),a=[];for(const o of r){const s=o.getDefinition();if(s.title){const l=document.createElement("i");l.classList.add("fas"),l.classList.add(o.isVisible()?_$:"fa-square");const c=document.createElement("span"),u=document.createElement("span"),d=(t==null?void 0:t[s.field])||s.displayTitle||s.title;u.textContent=" "+d,c.appendChild(l),c.appendChild(u),a.push({label:c,action:function(p){p.stopPropagation(),o.toggle(),Tt.columns[o.getField()]=o.isVisible(),n.redraw(),o.isVisible()?(l.classList.remove("fa-square"),l.classList.add(_$)):(l.classList.remove(_$),l.classList.add("fa-square"))}})}}return a},{WTN:met,UTR:get}=ks.ratingConstants,{FEMALE:vet,MALE:yet}=Mp,kJ="ratings.utr.utrRating",xJ="ratings.wtn.wtnRating";function bet({data:t,replaceTableData:e}){const i=t.some(o=>o.cityState),n=t.some(o=>o.tennisId),r=t.some(o=>{var s;return(s=o.ratings)==null?void 0:s.utr}),a=t.some(o=>{var s;return(s=o.ratings)==null?void 0:s.wtn});return[{cellClick:(o,s)=>s.getRow().toggleSelect(),titleFormatter:"rowSelection",formatter:"rowSelection",headerSort:!1,responsive:!1,hozAlign:ci,width:5},{headerMenu:vm({signedIn:"Sign In Status",sex:"Gender"}),formatter:"rownum",headerSort:!1,hozAlign:ci,width:55},{formatter:"responsiveCollapse",responsive:!1,headerSort:!1,resizable:!1,hozAlign:li,width:50},{formatter:Pw(({event:o,cell:s,...l})=>tA(o)),cellClick:tA,sorter:iT,field:"participant",responsive:!1,resizable:!1,minWidth:200,widthGrow:2,title:"Name"},{editor:fet({field:"tennisId"}),visible:n,field:"tennisId",editable:!1,title:"WTID",width:120},{headerFilter:"input",title:"First Name",field:"firstName",visible:!1,width:150},{headerFilter:"input",title:"Last Name",field:"lastName",visible:!1,width:150},{title:'<i class="fa-solid fa-venus-mars" />',field:"sex",hozAlign:ci,editor:"list",width:80,editorParams:{itemFormatter:(o,s)=>s,values:{Male:yet,Female:vet,"":"Unknown"}}},{title:"Country",field:"ioc",width:130,visible:!1,headerFilter:"input"},{title:"<div class='fa-solid fa-check' style='color: green' />",cellClick:het,formatter:"tickCross",resizable:!1,field:"signedIn",hozAlign:ci,tooltip:!1,width:40},{sorter:(o,s)=>(o.length||0)-((s==null?void 0:s.length)||0),formatter:net,title:"Penalties",field:"penalties",hozAlign:ci,visible:!1,width:130},{headerFilter:"input",title:"Club",field:"club",hozAlign:ci,minWidth:70,editor:!1,visible:!1},{sorter:(o,s)=>{var l,c,u;return(u=(l=o==null?void 0:o[0])==null?void 0:l.eventName)==null?void 0:u.localeCompare((c=s==null?void 0:s[0])==null?void 0:c.eventName)},formatter:XUe(ea),visible:_J("events"),title:"Events",field:"events",hozAlign:ci,minWidth:200,editor:!1,widthGrow:2},{sorter:(o,s)=>{var l,c,u;return(u=(l=o==null?void 0:o[0])==null?void 0:l.participantName)==null?void 0:u.localeCompare((c=s==null?void 0:s[0])==null?void 0:c.participantName)},formatter:QUe(()=>console.log("boo")),visible:_J("teams"),title:"Teams",field:"teams",hozAlign:ci,minWidth:200,editor:!1,widthGrow:2},{visible:!!i,title:"City/State",field:"cityState",minWidth:110},{editor:PG({maxValue:40,decimals:!0,field:xJ}),sorterParams:{alignEmptyValues:"bottom"},responsive:!0,resizable:!1,sorter:"number",field:xJ,editable:!1,visible:!!a,title:met,width:70},{editor:PG({maxValue:16,decimals:!0,field:kJ}),sorterParams:{alignEmptyValues:"bottom"},responsive:!0,resizable:!1,sorter:"number",field:kJ,editable:!1,visible:!!r,title:get,width:70},{cellClick:tA(e),formatter:Hg,responsive:!1,headerSort:!1,hozAlign:Qt,maxWidth:40}]}const{INDIVIDUAL:Iet,GROUP:wet,TEAM:Tet}=Yo,{OFFICIAL:OJ,COMPETITOR:Uet}=Mg;function Det({view:t}={}){let e,i,n,r,a,o;const s={participantRoles:[t===OJ?OJ:Uet]},l=()=>{({participants:n=[],derivedEventInfo:r}=at.getParticipants({withSignInStatus:!0,withScaleValues:!0,participantFilters:s,withEvents:!0,withISO2:!0}));const m=n.filter(({participantType:g})=>g===Iet);return i=n.filter(({participantType:g})=>g===wet),a=n.filter(({participantType:g})=>g===Tet),(m==null?void 0:m.map(g=>QQe(g,r)))||[]},c=()=>{setTimeout(()=>e.replaceData(l()),o?0:1e3)},u=l(),d=bet({data:u,replaceTableData:c}),p=(f,m)=>(_i.isNumeric(f)&&f||0)+(_i.isNumeric(m)&&m||0);return(f=>{var y;gm({anchorId:ZA});const m=document.getElementById(ZA),g=(y=Bl(m,"section"))==null?void 0:y.querySelector(".tabHeader");e=new Go(m,{headerSortElement:Fh(["sex","signedIn","events","teams","ratings.wtn.wtnRating","ratings.utr.utrRating","cityState","tennisId"]),responsiveLayoutCollapseFormatter:zUe,responsiveLayoutCollapseStartOpen:!1,height:window.innerHeight*.86,placeholder:"No participants",responsiveLayout:"collapse",index:"participantId",layout:"fitColumns",reactiveData:!0,columns:d,data:f});const v=b=>`Participants (${b.length})`;e.on("dataChanged",b=>g&&(g.innerHTML=v(b))),e.on("dataFiltered",(b,I)=>{g&&(g.innerHTML=v(I));const T=[],w=[];for(const P of I){const R=P.getData(),{wtn:N,utr:M}=R.ratings;_i.isNumeric(M==null?void 0:M.utrRating)&&w.push(parseFloat(M.utrRating)),_i.isNumeric(N==null?void 0:N.wtnRating)&&T.push(parseFloat(N.wtnRating))}const S=w.reduce(p,0),D=T.reduce(p,0),E=(w.length?S/w.length:0).toFixed(2),C=(T.length?D/T.length:0).toFixed(2);ln.averages&&console.log(`UTR ${E}x`),ln.averages&&console.log(`WTN ${C}x`)}),e.on("scrollVertical",ld),e.on("tableBuilt",()=>o=!0)})(u),{table:e,replaceTableData:c,teamParticipants:a,groupParticipants:i}}function Eet(t,e){xU({className:"saveTennisId",columns:["tennisId"],visible:!0,table:e,e:t}),e.showColumn("tennisId"),e.redraw(!0)}function Cet(t,e){xU({columns:["ratings.wtn.wtnRating","ratings.utr.utrRating"],classNames:["saveRatings","saveTennisId"],visible:!1,table:e,e:t}),e.showColumn("ratings.utr.utrRating"),e.showColumn("ratings.wtn.wtnRating"),e.redraw(!0),at.getParticipants({withScaleValues:!0});const n=e.getData().flatMap(a=>{var f,m,g;const o=(f=a.ratings)==null?void 0:f.wtn,s=o==null?void 0:o.wtnRating,l=o!=null&&o.confidence||s?50:0;let c=l?{...o,wtnRating:s,confidence:l}:"";const u={method:qX,params:{participantId:a.participantId,removePriorValues:!0,timeItem:{itemType:"SCALE.RATING.SINGLES.WTN",itemValue:c}}},d=(g=(m=a.ratings)==null?void 0:m.utr)==null?void 0:g.utrRating,p=d?50:0;c=p?{utrRating:d,confidence:p}:"";const h={method:qX,params:{participantId:a.participantId,removePriorValues:!0,timeItem:{itemType:"SCALE.RATING.SINGLES.UTR",itemValue:c}}};return[u,h]});Wt({methods:n,callback:a=>{a.success||console.log(a)}})}const{COMPETITOR:Pet,OTHER:Ret}=Mg,{TEAM:LJ}=Yo;function e1e({individualParticipantIds:t,participantType:e=LJ,title:i="Edit team",participant:n,refresh:r,table:a}){const o="participantName",s={[o]:n==null?void 0:n[o]};let l;const c=()=>{},u=f=>{l=Cr(f,[{error:"Please enter a name of at least 3 characters",placeholder:"Participant name",value:s[o]||"",validator:ta(3),field:o,onChange:c,label:"Name"}])},d=(f,m)=>Cw(f,[{label:"Cancel",onClick:()=>a==null?void 0:a.deselectRow(),close:!0},{label:"Save",onClick:p,close:!0,intent:"is-info"}],m);Tt.drawer.open({title:`<b style='larger'>${i}</b>`,callback:()=>{},width:"300px",side:Qt,content:u,footer:d});function p(){a==null||a.deselectRow(),n!=null&&n.participantId?console.log("update existing"):h()}function h(){var y;const f=e===LJ?Pet:Ret,m={individualParticipantIds:t||(n==null?void 0:n.individualParticipantIds)||[],participantName:(y=l[o])==null?void 0:y.value,participantRole:f,participantType:e};Wt({methods:[{params:{participants:[m]},method:YR}],callback:b=>{b.success?Nt(r)&&r():console.log({result:b})}})}return{...wP}}const{TEAM:k$}=Yo;function FJ({participants:t,table:e,replaceTableData:i,participantType:n=k$}){const r=({team:s})=>{const c=e.getSelectedData().map(({participantId:p})=>p);e.deselectRow();const u=[{method:UTe,params:{groupingParticipantId:s.participantId,individualParticipantIds:c}}];Wt({methods:u,callback:p=>{p.success&&i()}})},a=()=>{const s=n===k$?"New team":"New Group",c=e.getSelectedData().map(({participantId:u})=>u);e1e({refresh:i,individualParticipantIds:c,participantType:n,table:e,title:s})},o=n===k$?"Create new team":"Create new group";return{options:t.map(s=>({onClick:()=>r({team:s}),label:s.participantName,participant:s,close:!0})),actions:[{onClick:()=>a(),close:!0,label:o}]}}const Met=t=>e=>{if(e.key==="Enter"){const n=t.getSelectedData().map(({participantId:s})=>s),o=t.getData("active").map(({participantId:s})=>s).filter(s=>!n.includes(s));o.length===1&&(t.selectRow(o),e.target.value="",t.clearFilter())}};function Net(t,e){xU({classNames:["saveTennisId","saveRatings"],columns:["tennisId"],visible:!1,table:e,e:t}),e.showColumn("tennisId"),e.redraw(!0);const i=at.getParticipants().participantMap,r=e.getData().map(a=>{const{tennisId:o,participantId:s}=a;if(o!==i[s].participant.person.tennisId)return{params:{participant:{participantId:s,person:{tennisId:o}}},method:X_}}).filter(Boolean);r.length&&Wt({methods:r,callback:o=>{o.success||console.log(o)}})}function t1e(t){let e;const i=l=>{var c,u;return e===Mt?!((c=l==null?void 0:l.eventIds)!=null&&c.length):(u=l==null?void 0:l.eventIds)==null?void 0:u.includes(e)},n=l=>{t.removeFilter(i),e=l,l&&t.addFilter(i)},r=at.getEvents().events||[],a={label:`<span style='font-weight: bold'>${eg}</span>`,onClick:()=>n(),close:!0},o={label:`<span style='font-weight: bold'>${BBe}</span>`,onClick:()=>n(Mt),close:!0};return{eventOptions:[a,o,{divider:!0}].concat(r.map(l=>({onClick:()=>n(l.eventId),label:l.eventName,close:!0}))),events:r}}const{WTN:Aet,UTR:_et}=ks.ratingConstants,{FEMALE:ket,MALE:xet,MIXED:Oet,ANY:Let}=Mp;function Fet({callback:t}){let e;cr({title:"Generate mock players",content:a=>e=Cr(a,[{options:[{label:"Any",value:Let,close:!0},{label:"Female",value:ket,close:!0},{label:"Male",value:xet,close:!0}],label:"Participant gender",field:"gender",value:32},{options:[{label:"8",value:8,close:!0},{label:"16",value:16,close:!0},{label:"32",value:32,close:!0},{label:"64",value:64,close:!0},{label:"128",value:128,close:!0},{label:"256",value:256,close:!0}],label:"Participant count",field:"participantsCount",value:32},{text:"Generate Ratings",header:!0},{label:"WTN",field:"wtnRating",id:"wtnRating",checkbox:!0},{label:"UTR",field:"utrRating",id:"utrRating",checkbox:!0}]),buttons:[{label:"Cancel",intent:"none",close:!0},{label:"Generate",intent:"is-info",close:!0,onClick:()=>{const a=e.participantsCount.value,o=e.wtnRating.checked,s=e.utrRating.checked,l=e.gender.value,c=l===Oet?void 0:l,u=[o&&{ratingType:Aet,ratingMin:14,ratingMax:19.99},s&&{ratingType:_et,ratingMin:8,ratingMax:10}].filter(Boolean),{participants:d}=IP.generateParticipants({participantsCount:parseInt(a),scaleAllParticipants:!0,categories:u,sex:c});Wt({methods:[{method:YR,params:{participants:d}}],callback:t})}}]})}function Bet({callback:t}){let e=r=>{let a=r==null?void 0:r.players;a!=null&&a.length?$et(a):a&&!a.length&&Tt.modal.inform({message:"Sheet Empty: No Player Rows"}),Nt(t)&&t()};const{extension:i}=at.findExtension({discover:!0,name:Pv.REGISTRATION});(i==null?void 0:i.value)||Fet({callback:e})}function $et(t){console.log({registeredPlayers:t})}function Vet({table:t,teamParticipants:e}){let i;const n=s=>s.teams.some(l=>(l==null?void 0:l.participantId)===i),r=s=>{t.removeFilter(n),i=s,s&&t.addFilter(n)};return{teamOptions:[{label:`<span style='font-weight: bold'>${$Be}</span>`,onClick:()=>r(),close:!0},{divider:!0}].concat(e.sort((s,l)=>{var c;return(c=s==null?void 0:s.participantName)==null?void 0:c.localeCompare(l==null?void 0:l.participantName)}).map(s=>({onClick:()=>r(s.participantId),label:s.participantName,close:!0})))}}function i1e(t){const i=t.getSelectedData().filter(r=>{var a;return!((a=r.events)!=null&&a.length)}).map(({participantId:r})=>r),n=()=>{YUe({participantIds:i,callback:a=>{a.success&&t.deleteRow(i)&&t.deselectRow()}})};cr({content:`Delete ${i.length} participants?`,onClose:()=>t.deselectRow(),title:"Delete participants",buttons:[{label:"Cancel",intent:Mt,close:!0},{label:"Delete",id:"deleteDraw",intent:"is-danger",close:!0,onClick:n}]})}const{FEMALE:BJ,MALE:$J,ANY:VJ}=Mp;function jet(t){let e;const i=l=>{var c,u;return((u=(c=l.participant)==null?void 0:c.person)==null?void 0:u.sex)===e},n=l=>{t.removeFilter(i),e=l,l&&t.addFilter(i)},r=[$J,BJ],a={[$J]:"Male",[BJ]:"Female",[VJ]:FBe};return{sexOptions:[{label:`<span style='font-weight: bold'>${a[VJ]}</span>`,onClick:()=>n(),close:!0},{divider:!0}].concat(r.map(l=>({onClick:()=>n(l),label:a[l],close:!0}))),genders:a}}const{SIGNED_IN:Get}=Yo;function Het(t){const e=t.getSelectedData(),i=e.map(({participantId:a})=>a);Wt({methods:[{params:{signInState:Get,participantIds:i},method:o9}],callback:a=>{a.success&&(e.forEach(o=>o.signedIn=!0),t.updateData(e),t.deselectRow())}})}const{INDIVIDUAL:zet,SIGNED_OUT:qet}=Yo;function Wet(t){const i=at.getParticipants({participantFilters:{participantTypes:[zet]},withSignInStatus:!0,withEvents:!0}).participants.filter(a=>a.signedIn&&!a.events.length).map(a=>a.participantId);Wt({methods:[{params:{signInState:qet,participantIds:i},method:o9}],callback:a=>{a.success&&t()}})}function Ket(t){let e=0;if(t.length===0)return e;for(let i=0;i<t.length;i++){let n=t.charCodeAt(i);e=(e<<5)-e+n,e=e&e}return e}const Um={participantName:["full name","name"],participantId:["id","participantid"],person:{standardFamilyName:["last","last name","last_name"],standardGivenName:["first","First Name","first_name"],nationalityCode:["ioc","country","nationality"],address:{city:["city"],state:["state"]},birthDate:["*birth"],sex:["gender","sex"]}};function Yet({data:t,sheetId:e,callback:i}){var c;const r=at.getParticipants().participants.map(({participantId:u})=>u),a=Qm.countries.map(u=>[u.ioc,u.iso]).flat().filter(Boolean),o=[],s=u=>u.map(d=>[d.toLowerCase(),d.toLowerCase().split(" ").join("")]).flat(),l=u=>(d=[])=>{const p=Object.keys(u),h=s(d),f=h.reduce((g,v)=>u[v]||g,void 0),m=!f&&p.filter(g=>h.find(v=>v.startsWith("*")&&g.toLowerCase().includes(v.slice(1))));return f||u[m]};for(const u of t||[]){const d=Object.assign({},...Object.keys(u).map(C=>({[C.toLowerCase()]:u[C]}))),p=l(d),h={participantType:"INDIVIDUAL",participantRole:"COMPETITOR",person:{}};h.participantName=p(Um.participantName);const f=p(["tennis id","tennisid"]);f&&(h.person.tennisId=f);const m=p(Um.person.standardFamilyName),g=p(Um.person.standardGivenName);if(m&&g)h.person.standardFamilyName=m,h.person.standardGivenName=g,h.participantName=`${g} ${m}`;else continue;const v=p(Um.person.address.state),y=p(Um.person.address.city);(y||v)&&(h.person.addresses=[{city:y,state:v}]);const b=p(Um.person.nationalityCode);b&&a.includes(b.toUpperCase())&&(h.person.nationalityCode=b);const I=p(Um.person.birthDate);if(_i.dateTime.dateValidation.test(I)){const C=_i.dateTime.extractDate(I);C&&(h.person.birthDate=C)}const T=p(Um.person.sex);if(T){const C=T.toUpperCase();["MALE","FEMALE"].includes(C)?h.person.sex=C:["F","W","G"].includes(T[0])?h.person.sex="FEMALE":["M","B"].includes(T[0])&&(h.person.sex="MALE")}const w=p(["utr profile"]);if(w){h.onlineResources||(h.onlineResources=[]);const C=(c=w.split("profiles/"))==null?void 0:c.reverse()[0];C&&(h.person.personOtherIds||(h.person.personOtherIds=[]),h.person.personOtherIds.push({uniqueOrganisationName:"UTR",personId:C}),w.startsWith("http")&&h.onlineResources.push({resourceSubType:"PROFILE",identifier:w,name:"UTR Profile",resource:"URL"}))}const S=p(["utr"]);if(S){h.timeItems||(h.timeItems=[]);const C={itemType:"SCALE.RATING.SINGLES.UTR",itemValue:{utrRating:S}};h.timeItems.push(C)}const D=p(["wtn"]);if(D){h.timeItems||(h.timeItems=[]);const C={itemType:"SCALE.RATING.SINGLES.WTN",itemValue:{wtnRating:D}};h.timeItems.push(C)}h.participantId=p(Um.participantId)||`XXX-${Ket(h.participantName)}`,r.includes(h.participantId)||o.push(_i.definedAttributes(h))}o.length?Wt({methods:[{method:YR,params:{participants:o}},{method:W9e,params:{extension:{name:Jpe,value:e}}}],callback:p=>{p.success?(ti({message:`Added ${p.results[0].addedCount} participant(s)`,intent:"is-success"}),Nt(i)&&i()):console.log(p)}}):ti({message:"No new participants found",intent:"is-primary"}),Nt(i)&&i()}const n1e=t=>![null,void 0].includes(t),r1e=({c:t})=>t.map(e=>n1e(e==null?void 0:e.v)?e:{});function jJ({header:t,rows:e,useFormat:i=!1}){const n=c=>tPe(c)&&/Date\((\d+),(\d+),(\d+)\)/.test(c),r=c=>c.f||c.v,a=c=>i||n(c.v)?r(c):c.v,o=(c,u,d)=>({...c,[t[d]]:a(u)}),s=(c,u,d)=>n1e(u.v)?o(c,u,d):c,l=c=>c.reduce((u,d,p)=>s(u,d,p),{});return e.map(r1e).map(l)}function Zet(t){try{const e=t.split("setResponse(")[1].split(");")[0],i=JSON.parse(e),{cols:n,rows:r}=i.table??{},a=n.map(({label:o})=>o.split(" ")[0]);if(a.filter(Boolean).length)return jJ({header:a,rows:r});{const[o,...s]=r,l=r1e(o).map(c=>c.v);return console.log({header:l}),jJ({header:l,rows:s})}}catch{return[]}}async function Xet({sheetId:t}){const e=`https://docs.google.com/spreadsheets/d/${t}/gviz/tq?`;try{const i=await window.fetch(e);return i!=null&&i.ok?i.text():void 0}catch{return}}async function Jet({sheetId:t}){const e=await Xet({sheetId:t});return e?Zet(e):[]}function Qet({callback:t}){const{extension:e}=at.findExtension({discover:!0,name:Jpe}),i=e==null?void 0:e.value;let n;cr({title:"Import participants",buttons:[{label:"Cancel",intent:"is-nothing"},{label:"Submit",intent:"is-primary",onClick:()=>{const s=n.url.value;if(s){const l=s.split("/"),c=l.reduce((h,f)=>!h||f.length>h.length?f:h,void 0),u=!i||i&&c!==i,d=i||l.indexOf("docs.google.com")>0&&l.indexOf("spreadsheets")>0,p=u?c:i;if(d)d?Jet({sheetId:p}).then(h=>Yet({data:h,sheetId:p,callback:t})):ti({message:"URL unchanged",intent:"is-info"});else{const h=Bo.tr("phrases.invalidsheeturl");ti({message:h,intent:"is-danger"}),n.url.value=""}}},close:!0}],content:s=>{n=Cr(s,[{text:"Pull participants from a Google Sheet which has a shared link"},{placeholder:"URL of Google Sheet",value:i,label:"Sheet URL",field:"url"}])}})}const{ALTERNATE:ett,WILDCARD:ttt,DIRECT_ACCEPTANCE:GJ,UNGROUPED:itt}=$u,{MAIN:HJ,QUALIFYING:ntt}=pa,{INDIVIDUAL:rtt}=Yo,{TEAM:zJ,DOUBLES:att}=pl;function ott({callback:t,eventName:e,eventType:i,participantType:n,participantIds:r}={}){const a=[zJ,att].includes(i)&&n===rtt;if(!(r!=null&&r.length)){ti({message:"Nothing to do",intent:"is-info"});return}const s=[{label:"Main",value:HJ,selected:!0},{label:"Qualifying",value:ntt}].map(({label:p,value:h,selected:f})=>({selected:f,label:p,value:h})),l=[{hide:a,label:"Direct Acceptance",value:GJ,selected:!0},{hide:a,label:"Alternate",value:ett},{hide:a,label:"Wildcard",value:ttt},{hide:n===zJ,label:"Ungrouped",value:itt,selected:a}];let c;cr({title:"Add to event",content:p=>c=Cr(p,[{text:`Add ${r.length} participant to ${e}`},{options:s,label:"Event stage",field:"entryStage",value:HJ},{options:l,value:GJ,label:"Entry status",field:"entryStatus"}]),buttons:[{label:"Cancel",intent:Mt,close:!0},{label:"Add",intent:"is-info",close:!0,onClick:()=>{const p=c.entryStatus.value,h=c.entryStage.value;Nt(t)&&t({entryStatus:p,entryStage:h})}}]})}function a1e({event:t,participantType:e,table:i,callback:n}){const r=i.getSelectedData(),{eventId:a,eventName:o,eventType:s}=t,l=r.filter(u=>!u.events.map(d=>d.eventId).includes(a)).map(({participantId:u})=>u);ott({callback:({entryStatus:u,entryStage:d}={})=>{i.deselectRow(),Wt({methods:[{params:{eventId:a,participantIds:l,entryStatus:u,entryStage:d},method:r9}],callback:f=>{f.success?Nt(n)&&n():(console.log({result:f}),f.misMatchedGender&&ti({intent:"is-danger",message:"Invalid gender"}))}})},eventName:o,participantType:e,eventType:s,participantIds:l})}const{ALTERNATE:stt,DIRECT_ACCEPTANCE:ltt,UNGROUPED:ctt,STRUCTURE_SELECTED_STATUSES:utt}=$u,{ANY:Qy,FEMALE:n0,MALE:r0,MIXED:eb}=Mp,{DOUBLES:tv,SINGLES:a0,TEAM:iv}=pl,{INDIVIDUAL:FM,PAIR:qJ}=Yo,{MAIN:dtt}=pa;function ZF({table:t,event:e,participants:i,callback:n}={}){var I,T,w;const r=((I=at.getEvents().events)==null?void 0:I.length)||0,a=((T=at.getTournamentInfo())==null?void 0:T.tournamentInfo)||{},o={eventName:(e==null?void 0:e.eventName)||`Event ${r+1}`,startDate:(e==null?void 0:e.startDate)??a.startDate,endDate:(e==null?void 0:e.endDate)??a.endDate,eventType:(e==null?void 0:e.eventType)||a0,gender:(e==null?void 0:e.gender)||Qy},s=(w=e==null?void 0:e.entries)==null?void 0:w.filter(({entryStatus:S})=>[...utt,stt].includes(S)).map(({participantId:S})=>S),l=s?at.getParticipants({participantFilters:{participantIds:s},withIndividualParticipants:!0}).participants:[],c=[],u=l.reduce((S,D)=>{var C,P;const E=(C=D.person)!=null&&C.sex?[D.person.sex]:((P=D.individualParticpants)==null?void 0:P.map(R=>{var N;return(N=R.person)==null?void 0:N.sex}))||[];return c.push(E),S.includes(D.participantType)?S:S.concat(D.participantType)},[]);let d,p;const h=i==null?void 0:i[0].participantType;if(i!=null&&i.length){o.eventType=h===FM&&a0||h===qJ&&tv||iv,h===FM&&(d=[a0,tv,iv]),h===qJ&&(d=[tv]),h===iv&&(d=[iv]);const S=h===FM&&_i.unique(i.map(D=>{var E,C;return(C=(E=D.participant)==null?void 0:E.person)==null?void 0:C.sex}));p=[Qy],S.length===1?(S[0]===n0&&p.push(n0),S[0]===r0&&p.push(r0),o.gender=S[0]):S.length>1&&p.push(eb)}if(c.length){p=[Qy],e.gender&&!e.gender===Qy&&p.push(e.gender),e.eventType===tv&&!p.includes(eb)&&p.push(eb);const S=_i.unique(...c);S.length===1&&!p.includes(S[0])&&p.push(...S)}else e&&(p=[Qy,r0,eb,n0]);const f=()=>{},m=[{fields:["startDate","endDate"],minDate:a.startDate,maxDate:a.endDate,dateRange:!0}],g=S=>Cr(S,[{error:"minimum of 5 characters",validator:ta(5),placeholder:"Event name",value:o.eventName,onChange:f,selectOnFocus:!0,label:"Event name",field:"eventName",focus:!0},{disabled:u.length,value:o.eventType,field:"eventType",label:"Format",options:[{hide:d&&!d.includes(a0),selected:o.eventType===a0,label:"Singles",value:a0},{hide:d&&!d.includes(tv),selected:o.eventType===tv,label:"Doubles",value:tv},{hide:d&&!d.includes(iv),selected:o.eventType===iv,label:"Team",value:iv}],onChange:f},{value:o.gender,label:"Gender",field:"gender",options:[{hide:p&&!p.includes(r0),selected:o.gender===r0,label:"Male",value:r0},{hide:p&&!p.includes(n0),selected:o.gender===n0,label:"Female",value:n0},{selected:o.gender===Qy,label:"Any",value:Qy},{hide:p&&!p.includes(eb),selected:o.gender===eb,label:"Mixed",value:eb}],onChange:f},{value:(e==null?void 0:e.startDate)??a.startDate,placeholder:"YYYY-MM-DD",label:"Start date",field:"startDate"},{value:(e==null?void 0:e.endDate)??a.endDate,placeholder:"YYYY-MM-DD",label:"End date",field:"endDate"},{hide:e||i,divider:!0}],m),v=()=>{const S=Tt.drawer.attributes.content.eventName.value,D=Tt.drawer.attributes.content.eventType.value,E=Tt.drawer.attributes.content.startDate.value,C=Tt.drawer.attributes.content.endDate.value,P=Tt.drawer.attributes.content.gender.value,R={eventName:S,eventType:D,gender:P,startDate:E,endDate:C},N=M=>{var A,_,x;if(t==null||t.deselectRow(),M.success){const O=(_=(A=M.results)==null?void 0:A[0])==null?void 0:_.event;Nt(n)&&n({...M,event:O,eventUpdates:R})}else M.error&&(ti({intent:"is-warning",message:((x=M.error)==null?void 0:x.message)||"Error"}),Nt(n)&&n())};if(e){const M=e.eventId;Wt({methods:[{method:rKe,params:{eventId:M,eventUpdates:R}}],callback:N})}else{const M=_i.UUID(),A=[{method:G9e,params:{event:{eventId:M,eventName:S,eventType:D,gender:P,startDate:E,endDate:C}}}];if(i!=null&&i.length){const _=i.map(({participantId:B})=>B),x=h===FM&&[tv,iv].includes(D)?ctt:ltt,O={params:{eventId:M,participantIds:_,entryStatus:x,entryStage:dtt},method:r9};A.push(O)}Wt({methods:A,callback:N})}},y=(S,D)=>Cw(S,[{label:"Cancel",onClick:()=>t==null?void 0:t.deselectRow(),close:!0},{label:"Save",onClick:v,close:!0,intent:"is-info"}],D),b=e!=null&&e.eventId?"Edit event":"Add event";Tt.drawer.open({title:`<b style='larger'>${b}</b>`,width:"300px",side:Qt,content:g,footer:y})}const ek=(t,e)=>{const i=t.getSelectedData(),n=t.getData("active").map(o=>o.participantId),r=i.filter(o=>n.includes(o.participantId));ZF({table:t,callback:o=>{var s,l;if(t.deselectRow(),o!=null&&o.success){const c=(l=(s=o==null?void 0:o.results[0])==null?void 0:s.event)==null?void 0:l.eventId;Nt(e)?e({eventId:c}):c&&ea({eventId:c})}else Nt(e)&&e()},participants:r})},{INDIVIDUAL:WJ,TEAM:KJ,GROUP:YJ}=Yo,{OFFICIAL:ZJ}=Mg,o1e=t=>[{label:"Individuals",value:WJ,isActive:t===WJ,close:!0},{label:"Officials",value:ZJ,isActive:t===ZJ,close:!0},{label:"Groups",value:YJ,isActive:t===YJ,close:!0},{label:"Teams",value:KJ,isActive:t===KJ,close:!0}].map(e=>({...e,onClick:()=>{if(e.value!==t){const n=`/tournament/${at.getTournament().tournamentRecord.tournamentId}/${kf}/${e.value}`;Tt.router.navigate(n)}}})),{INDIVIDUAL:ptt,GROUP:htt}=Yo,{OFFICIAL:ftt}=Mg,{ANY:mtt}=Mp;function gtt({view:t}){var E,C,P;const{table:e,replaceTableData:i,teamParticipants:n,groupParticipants:r}=Det({view:t}),a=Ew(e),{eventOptions:o,events:s}=t1e(e),{sexOptions:l,genders:c}=jet(e),{teamOptions:u}=Vet({table:e,teamParticipants:n}),d=()=>Qet({callback:i}),p=()=>{Bet({callback:()=>{i(),e==null||e.redraw(!0)},showNotice:!0})},h=t===ftt?"Officials":"Individuals",{extension:f}=at.findExtension({discover:!0,name:Pv.REGISTRATION}),m=f==null?void 0:f.value,g=zc(),v=((E=g==null?void 0:g.roles)==null?void 0:E.includes("superadmin"))||((C=g==null?void 0:g.permissions)==null?void 0:C.includes("editTennisId")),y=[{onClick:()=>Wet(i),label:"Sign out players not approved for events",close:!0},{onClick:R=>VQe(R,e),label:"Edit ratings",close:!0},{onClick:R=>Eet(R,e),hide:!v,label:"Edit WTID",close:!0},{divider:!0},{heading:"Add participants"},{hide:m,label:"Generate mock participants",onClick:p,close:!0},{label:"Import from Google sheet",onClick:d,close:!0},{onClick:()=>ZUe({callback:i,view:t}),label:"New participant",close:!0}],b=s.map(R=>({onClick:()=>a1e({event:R,participantType:ptt,table:e,callback:i}),label:R.eventName,close:!0})).concat([{divider:!0},{label:'<p style="font-weight: bold">Create new event</p>',onClick:()=>ek(e,i),close:!0}]),I=FJ({participants:r,participantType:htt,replaceTableData:i,table:e}),T=FJ({participants:n,table:e,replaceTableData:i}),w=Met(e),S=[{onKeyDown:R=>{R.keyCode===8&&R.target.value.length===1&&a(""),w(R)},onChange:R=>a(R.target.value),onKeyUp:R=>a(R.target.value),clearSearch:()=>a(""),placeholder:"Search participants",location:Ua,search:!0},{options:b,label:"Add to event",hide:!s.length,intent:"is-none",location:Ua},{onClick:()=>ek(e,i),label:"Create event",hide:s.length,intent:"is-info",location:Ua},{selection:T,label:"Add to team",intent:"is-none",location:Ua},{selection:I,label:"Add to group",intent:"is-none",location:Ua},{onClick:()=>Het(e),intent:"is-primary",location:Ua,label:"Sign in"},{onClick:()=>i1e(e),label:"Delete selected",intent:"is-danger",stateChange:!0,location:Ua},{onKeyDown:R=>{R.keyCode===8&&R.target.value.length===1&&a(""),w(R)},onChange:R=>a(R.target.value),onKeyUp:R=>a(R.target.value),clearSearch:()=>a(""),placeholder:"Search participants",location:ci,search:!0},{hide:(s||[]).length<1,options:o,label:eg,modifyLabel:!0,selection:!0,location:ci},{label:(P=u[0])==null?void 0:P.label,options:u,modifyLabel:!0,selection:!0,location:ci},{options:l,label:c[mtt],modifyLabel:!0,selection:!0,location:ci},{options:o1e(t),label:h,intent:"is-info",modifyLabel:!0,location:Qt,selection:!0,align:Qt},{options:y,label:"Actions",selection:!1,location:Qt,align:Qt},{onClick:R=>Net(R,e),class:"saveTennisId",intent:"is-primary",label:"Save WTID",location:Qt,visible:!1},{onClick:R=>Cet(R,e),label:"Save ratings",intent:"is-primary",class:"saveRatings",location:Qt,visible:!1}],D=document.getElementById(f4);Ns({table:e,target:D,items:S})}function vtt(t,e){const{individualParticipantIds:i,individualParticipants:n,participantName:r,participantType:a,participantId:o,representing:s}=t,l=(i==null?void 0:i.length)||0;return{events:qUe(t,e),eventIds:t.events.map(({eventId:c})=>c),searchText:r.toLowerCase(),representing:WUe(s),individualParticipants:n,participantName:r,participantType:a,participantId:o,membersCount:l}}function ytt({table:t,team:e}){const n=t.getSelectedData().map(({participantId:o})=>o);t.deselectRow();const r=[{method:lKe,params:{groupingParticipantId:e.participantId,individualParticipantIds:n,suppressErrors:!0}}];Wt({methods:r,callback:o=>{o.success&&t.deleteRow(n)}})}const{ALTERNATE_PARTICIPANT:btt,ASSIGN_PARTICIPANT:Itt,QUALIFYING_PARTICIPANT:wtt,SWAP_PARTICIPANTS:Stt}=KI,Ttt={[btt]:{selections:"availableAlternates",targetAttribute:"participantId",param:"alternateParticipantId",title:"Assign alternate"},[Itt]:{selections:"participantsAvailable",targetAttribute:"participantId",title:"Select participant"},[wtt]:{selections:"qualifyingParticipants",targetAttribute:"participantId",param:"qualifyingParticipantId",title:"Assign qualifier"},[Stt]:{selections:"availableAssignments",targetAttribute:"drawPosition",title:"Swap draw positions",param:"drawPositions"},selectParticipants:{selections:"participantsAvailable",targetAttribute:"participantId",title:"Select participants"}};function QR({title:t="Select participant",selectedParticipantIds:e,selectionLimit:i,activeOnEnter:n,selectOnEnter:r,onSelection:a,update:o,action:s}){const l=Ttt[s.type];if(!(l!=null&&l.targetAttribute))return;let c,u;const d=()=>{var R;const E=l.targetAttribute,C=l.param||l.targetAttribute,P=Array.isArray(c)?(R=c[0])==null?void 0:R[E]:c==null?void 0:c[E];P&&(s.type==="SWAP"?(s.payload.drawPositions.push(P),a({[C]:s.payload.drawPositions})):a({[C]:P,selected:c}))},p="selectionControl",h="selectionTable",f=[{label:"Cancel",intent:"is-none",close:!0},{hide:i===1,label:"Select",intent:"is-info",onClick:d,close:!0}],m=()=>{const E=Tt.tables.selectionTable;E==null||E.destroy(),delete Tt.tables.selectionTable},g=`
    <div style='min-height: 420px'>
      <div id='${p}'></div>
      <div id='${h}'></div>
    </div>
  `;o?o({title:t,content:g,buttons:f,onClose:m}):cr({title:t,content:g,buttons:f,onClose:m});const v=E=>{c=E,i&&(c==null?void 0:c.length)===i&&(yI(),d())},y=s[l.selections],{table:b}=iUe({selectedParticipantIds:e,targetAttribute:l.targetAttribute,selectionLimit:i,onSelected:v,anchorId:h,data:y}),I=Ew(b),T=()=>{const E=b.getData("active");if(E.length===1){if(r)c=E[0],yI(),d();else if(n){const C=(c==null?void 0:c.map(R=>R.participantId))||[],P=E[0].participantId;C.includes(P)||(Array.isArray(c)?c.push(E[0]):c=E,b.selectRow([P]),u.participantSearch.value="")}}},S=[{onKeyDown:E=>{E.keyCode===8&&E.target.value.length===1&&I(""),E.key==="Enter"&&T()},onChange:E=>I(E.target.value),onKeyUp:E=>I(E.target.value),clearSearch:()=>I(""),placeholder:"Search entries",id:"participantSearch",location:ci,search:!0,focus:!0}],D=document.getElementById(p);u=Ns({table:b,target:D,items:S}).inputs}const{ASSIGN_PARTICIPANT:Utt}=KI,x$=_i.extractAttributes,Dtt=t=>{const e=document.createElement("div"),i=document.createElement("div");i.className="tableControl",i.style.marginBottom="1em",e.appendChild(i);const n="1px solid #333",r=document.createElement("div");r.style.backgroundColor="white",r.style.border=n,r.style.width="99%",e.className=$O,e.style.display=Mt,e.style.boxSizing="border-box",e.style.paddingLeft="10px",e.style.borderTop=n,e.style.borderBotom=n,e.appendChild(r),t.getElement().appendChild(e);const a=t.getData(),o=d=>{const p={};return d==null?void 0:d.map(h=>{var m;const f=((m=h.person)==null?void 0:m.sex)||"OTHER";return p[f]||(p[f]=0),p[f]+=1,{...h,order:p[f]}})},s=o(a.individualParticipants),l=new Go(r,{placeholder:"No individual participants",index:"participantId",layout:"fitColumns",movableRows:!0,maxHeight:400,data:s,columns:[{cellClick:(d,p)=>p.getRow().toggleSelect(),titleFormatter:"rowSelection",formatter:"rowSelection",headerSort:!1,responsive:!1,hozAlign:ci,width:5},{title:"Order",headerSort:!1,field:"order",width:70},{title:"Name",field:"participantName",formatter:Pw()},{title:"Gender",field:"person.sex",width:100}]});l.on("scrollVertical",ld),l.on("rowMoved",d=>{const p=d.getTable(),f=p.getData().map((v,y)=>({...v,order:y+1})).map(({participantId:v})=>v),m=[{params:{participant:{participantId:a.participantId,individualParticipantIds:f}},method:X_}];Wt({methods:m,callback:v=>{if(v.success){const y=p.getRows(),b=y.map(T=>T.getData()),I=o(b);y.forEach((T,w)=>T.update(I[w]))}}})}),Ns({table:l,target:i,items:[{onClick:()=>ytt({table:l,team:a}),label:"Delete selected",intent:"is-danger",stateChange:!0,location:Ua},{onClick:()=>{var g;const d=v=>{if(v.participantId){const y=v.selected,b=(v.selected?v.selected.map(x$("participantId")):[v.participantId]).filter(Boolean),I=(a.individualParticipants??[]).map(x$("participantId")).concat(b);if(b!=null&&b.length){const T=[{method:UTe,params:{groupingParticipantId:a.participantId,individualParticipantIds:b}},{params:{participant:{participantId:a.participantId,individualParticipantIds:I}},method:X_}];Wt({methods:T,callback:S=>{S.success&&(a.individualParticipants=(a.individualParticipants??[]).concat(y),a.membersCount=a.individualParticipants.length,t.update(a),t.getTable().redraw(!0))}})}}},p=((g=a.individualParticipants)==null?void 0:g.map(x$("participantId")))||[],{participants:h}=at.getParticipants({participantFilters:{participantTypes:["INDIVIDUAL"]},withISO2:!0}),f=h.filter(({participantId:v})=>!p.includes(v));QR({title:"Select players to add",activeOnEnter:!0,selectionLimit:99,onSelection:d,action:{type:Utt,participantsAvailable:f}})},label:"Add players",intent:"is-primary",location:Qt}]})},P9="&#9660;",s1e=" &#9654;",df="&#8964;",l1e=` <span class='tabulator-responsive-collapse-toggle-close toggleCaret'> ${P9} </span>`,c1e=`<span class='tabulator-responsive-collapse-toggle-open toggleCaret'> ${s1e} </span>`,u1e=$O;function zb(t,e){const i=e.getRow(),n=i._row.element.getElementsByClassName(u1e)[0];if(n){const r=n.style.display!==Mt;n.style.display=r?Mt:"";const o=i.getCells().find(s=>s.getColumn().getDefinition().field===ghe)._cell.element;return o&&(o.innerHTML=r?c1e:l1e),{open:!r}}}function R9(t){const i=t.getRow()._row.element.getElementsByClassName(u1e)[0];return(i==null?void 0:i.style.display)!==Mt?c1e:l1e}const{GROUP:Ett}=Yo;function Ctt({view:t,replaceTableData:e}){const i=(n,r)=>{zb(n,r).open};return[{cellClick:(n,r)=>r.getRow().toggleSelect(),titleFormatter:"rowSelection",formatter:"rowSelection",responsive:!1,headerSort:!1,hozAlign:ci,width:5},{formatter:"responsiveCollapse",width:50,minWidth:50,hozAlign:li,resizable:!1,headerSort:!1},{headerMenu:vm({matchUpsCount:"Total MatchUps",membersCount:"Individuals",winLoss:"Win/Loss"}),formatter:"rownum",headerSort:!1,hozAlign:ci,width:55},{cellClick:(n,r)=>i(n,r),field:"participantName",title:"Name",minWidth:200,widthGrow:1},{sorter:(n,r)=>{var a,o,s;return(s=(a=n==null?void 0:n[0])==null?void 0:a.eventName)==null?void 0:s.localeCompare((o=r==null?void 0:r[0])==null?void 0:o.eventName)},formatter:XUe(ea),visible:t!==Ett,hozAlign:ci,field:"events",title:"Events",minWidth:300,editor:!1,widthGrow:2},{title:'<div class="event_icon opponents_header" />',headerTooltip:"Individuals",headerHozAlign:li,field:"membersCount",hozAlign:li,headerSort:!0,visible:!0,width:50},{title:'<div class="event_icon matches_header" />',headerTooltip:"Total MatchUps",headerHozAlign:li,field:"matchUpsCount",hozAlign:li,headerSort:!0,visible:!0,width:50},{title:'<div class="event_icon winloss_header" />',headerTooltip:"Win/Loss",headerHozAlign:li,field:"winLoss",hozAlign:li,headerSort:!0,visible:!0,width:50},{field:"representing",title:"Representing",visible:!1,minWidth:200},{cellClick:i,formatter:R9,responsive:!1,headerSort:!1,hozAlign:Qt,field:ghe,width:20},{cellClick:tA(e),formatter:Hg,responsive:!1,headerSort:!1,hozAlign:Qt,width:20}]}const{TEAM:O$}=Yo;function Ptt({view:t}={}){let e,i,n,r;const a=()=>({participants:i,derivedEventInfo:n}=at.getParticipants({participantFilters:{participantTypes:[t||O$]},withIndividualParticipants:!0,withScaleValues:!0,withEvents:!0,withISO2:!0}),i.map(u=>vtt(u,n))),o=()=>{setTimeout(()=>e.replaceData(a()),r?0:1e3)},s=Ctt({view:t});return(c=>{var p;gm({anchorId:QA});const u=document.getElementById(QA),d=(p=Bl(u,"section"))==null?void 0:p.querySelector(".tabHeader");e=new Go(u,{headerSortElement:Fh(["events","membersCount","matchUpsCount","winLoss"]),responsiveLayoutCollapseFormatter:zUe,responsiveLayoutCollapseStartOpen:!1,minHeight:window.innerHeight*.81,height:window.innerHeight*.86,placeholder:"No team participants",rowFormatter:Dtt,responsiveLayout:"collapse",index:"participantId",layout:"fitColumns",reactiveData:!0,data:c,columns:s}),e.on("dataChanged",h=>{const f=t===O$?"Teams":"Groups";d&&(d.innerHTML=`${f} (${h.length})`)}),e.on("dataFiltered",(h,f)=>{const m=t===O$?"Teams":"Groups";d&&(d.innerHTML=`${m} (${f.length})`)}),e.on("scrollVertical",ld),e.on("tableBuilt",()=>r=!0)})(a()),{table:e,replaceTableData:o}}const Rtt={country:{personAttribute:"nationalityCode"},city:{accessor:"person.addresses.city"}};function Mtt({callback:t}={}){const e=[{label:Bo.tr("cnt"),value:"country"},{label:"City",value:"city"}],i="-";cr({title:"Create Team",content:a=>Cr(a,[{options:[{label:"Select attribute",value:i},...e],label:"Attribute",field:"selection",value:""}]),buttons:[{label:"Cancel",intent:"none",close:!0},{label:"Create",intent:"is-primary",onClick:({content:a})=>{const o=a==null?void 0:a.selection.value;if(!o||o===i)return;const s=Rtt[o],l=at.createTeamsFromParticipantAttributes({...s,addParticipants:!1});if(l.newParticipants){const c=[{params:{participants:l.newParticipants},method:YR}];Wt({methods:c,callback:t})}},close:!0}],onClose:()=>{}})}const{TEAM:XJ}=Yo;function Ntt({view:t}){const{table:e,replaceTableData:i}=Ptt({view:t}),n=Ew(e),{eventOptions:r,events:a}=t1e(e),o=[{label:"New team",onClick:()=>e1e({title:"New team",refresh:i})},{label:"Generate teams",onClick:()=>Mtt({callback:i})}],l=[{label:'<p style="font-weight: bold">Create new event</p>',onClick:()=>ek(e,i),close:!0},{divider:!0}].concat(a.filter(({eventType:p})=>p===XJ).map(p=>({onClick:()=>a1e({event:p,participantType:XJ,table:e,callback:i}),label:p.eventName,close:!0}))),c=t==="GROUP"?"Groups":"Teams",u=[{onKeyDown:p=>p.keyCode===8&&p.target.value.length===1&&n(""),onChange:p=>n(p.target.value),onKeyUp:p=>n(p.target.value),clearSearch:()=>n(""),placeholder:"Search teams",location:Ua,search:!0},{options:l,label:"Add to event",hide:!a.length,intent:"is-none",location:Ua},{onClick:()=>ek(e,i),label:"Create event",hide:a.length,intent:"is-info",location:Ua},{onClick:()=>i1e(e),label:"Delete selected",intent:"is-danger",stateChange:!0,location:Ua},{onKeyDown:p=>p.keyCode===8&&p.target.value.length===1&&n(""),onChange:p=>n(p.target.value),onKeyUp:p=>n(p.target.value),clearSearch:()=>n(""),placeholder:"Search teams",location:ci,search:!0},{hide:r.length<2,options:r,modifyLabel:!0,label:eg,location:ci,selection:!0},{options:o1e(t),label:c,modifyLabel:!0,intent:"is-info",location:Qt,selection:!0,align:Qt},{options:o,label:"Actions",selection:!1,location:Qt,align:Qt}],d=document.getElementById(I4);Ns({table:e,target:d,items:u})}const{INDIVIDUAL:Att,TEAM:_tt,GROUP:ktt}=Yo;function xtt({participantView:t=Att}={}){const e=t.toUpperCase(),i=[_tt,ktt].includes(e),n=document.getElementById("individuals"),r=document.getElementById("participantGroupings");i?(n.style.display=Mt,r.style.display=""):(r.style.display=Mt,n.style.display=""),i?Ntt({view:e}):gtt({view:e})}const{TEAM:Ott}=pl,OU=t=>{var A,_,x,O,B;const{potentialParticipants:e,matchUpType:i,matchUpId:n,eventName:r,roundName:a,schedule:o,eventId:s,drawId:l,gender:c,sides:u,...d}=t,{scheduledDate:p,scheduledTime:h,courtName:f}=o||{},m=F=>{var G;return((G=F.person)==null?void 0:G.standardFamilyName)||F.participantName},g=(e==null?void 0:e.map(F=>({participantName:F.map(m).filter(Boolean).join(" or ")})))||[],v=((A=u==null?void 0:u[0])==null?void 0:A.participant)||g.shift(),y=((_=u==null?void 0:u[1])==null?void 0:_.participant)||g.shift(),b={participantName:v==null?void 0:v.participantName,sex:(x=v==null?void 0:v.person)==null?void 0:x.sex,participant:v},I={participantName:y==null?void 0:y.participantName,sex:(O=y==null?void 0:y.person)==null?void 0:O.sex,participant:y},T=u.flatMap(({participant:F})=>{var G;return(G=F==null?void 0:F.individualParticipantIds)!=null&&G.length?F.individualParticipantIds:F==null?void 0:F.participantId}).filter(Boolean),w=d.winningSide===1&&"side1"||d.winningSide===2&&"side2"||void 0,S=!!d.winningSide,D=!!(d.winningSide||d.readyToScore),E=(B=d.score)==null?void 0:B.scoreStringSide1,C=u.flatMap(F=>{var H,$,q;const G=(H=F.participant)==null?void 0:H.person;return G?[G.standardGivenName,G.standardFamilyName]:(q=($=F.participant)==null?void 0:$.individualParticipants)==null?void 0:q.map(({person:z})=>[z.standardGivenName,z.standardFamilyName])}).filter(Boolean).join(" ").toLowerCase(),P=GUe([C,v==null?void 0:v.participantName,y==null?void 0:y.participantName].filter(Boolean).join(" ")).toLowerCase(),R=t.collectionId?Ott:i,N=t.competitiveness?{competitiveness:t.competitiveness}:t.competitiveProfile,M={score:E,matchUpStatus:t.matchUpStatus,readyToScore:D,complete:S,winningSide:w};return{matchUpStatus:t.matchUpStatus,individualParticipantIds:T,flight:t.drawName,competitiveProfile:N,scheduledDate:p,readyToScore:D,scheduledTime:h,matchUpType:i,scoreDetail:M,winningSide:w,searchText:P,courtName:f,eventName:r,eventType:R,matchUpId:n,roundName:a,complete:S,eventId:s,matchUp:t,gender:c,drawId:l,side1:b,side2:I,score:E}};function d1e(t,e){const i=t.target.id;t.dataTransfer.setData("itemid",i),e&&(t.dataTransfer.setData("itemtype",zBe),t.dataTransfer.setDragImage(Tt.dragMatch,10,10)),t.dataTransfer.effectAllowed="move"}const{MALE:Ltt,FEMALE:Ftt}=Mp;function Btt(t){function e(a){const o=document.createElement("div"),s=a.getValue(),l=lp(s)&&(s==null?void 0:s.sex)===Ltt&&"#2E86C1"||(s==null?void 0:s.sex)===Ftt&&"#AA336A"||"";return o.style.color=l,o.innerHTML=(lp(s)?s.participantName:s)||"",o}function i(a){const o=document.createElement("div");return o.innerHTML=a.getValue(),o}function n(a){const o=a.getElement();return o.classList.add("tag"),o.classList.add("is-info"),o.classList.add("is-light"),(t==null?void 0:t.length)||0}const r=(a,o)=>{var s;return a.participantName&&!o.participantName||o.participantName&&!a.participantName||!(a!=null&&a.participantName)&&!(o!=null&&o.participantName)?1:(s=a==null?void 0:a.participantName)==null?void 0:s.localeCompare(o==null?void 0:o.participantName)};return[{titleFormatter:n,formatter:"rownum",headerSort:!1,hozAlign:li,frozen:!0,width:55},{formatter:i,field:"eventName",resizable:!1,title:"Event",visible:!0,minWidth:250},{title:"Flight",field:"flight"},{formatter:i,field:"roundName",resizable:!1,title:"Round",minWidth:90},{formatter:e,sorter:r,responsive:!1,resizable:!1,title:"Side 1",minWidth:120,field:"side1"},{formatter:e,sorter:r,responsive:!1,resizable:!1,title:"Side 2",minWidth:120,field:"side2"},{field:"matchUp.matchUpFormat",title:"Scoring Format",formatter:i,responsive:!1,resizable:!1,minWidth:100}]}const JJ=Object.keys(nhe);function $tt(t,e){return JJ.indexOf(t.issue)-JJ.indexOf(e.issue)}function tk(t){var o;const e=t.getData(),i=e.flatMap(s=>Object.values(s).filter(lp)).filter(s=>s.matchUpId),{courtIssues:n,rowIssues:r}=My.proConflicts({matchUps:i});n&&((o=Object.keys(n))!=null&&o.length),e!=null&&e.length&&t.updateData(e);const a=t.getColumns()[0].getCells();r!=null&&r.length&&r.forEach((s,l)=>{const c=l+1,u=a.find(d=>d.getData().rowNumber===c);if(u){u.getElement().classList.forEach(p=>{p.startsWith("matchup")&&u.getElement().classList.remove(p)});const d=u.getData();if(s.length){const p=s.sort($tt);d.issues=p;const h=nhe[p[0].issue];u.getElement().classList.add(h)}else u.getElement().style.backgroundColor="white",d.issues=[]}else console.log("control cell not found",{rowNumber:c})})}function Vtt(t,e){var m;t.preventDefault();const i=t.dataTransfer.getData("itemid"),n=Go.findTable("#tournamentSchedule")[0],a=n.getData().flatMap(g=>Object.values(g).filter(v=>v.matchUpId)).find(g=>g.matchUpId===i)||{};if(!((m=a==null?void 0:a.schedule)!=null&&m.courtId))return;let o;const s=n.getData().find(g=>(o=Object.keys(g).find(v=>{if(lp(g[v]))return g[v].matchUpId===i}),o)),{courtId:l,courtOrder:c,venueId:u}=a.schedule;s[o]={schedule:{courtOrder:c,courtId:l,venueId:u}},n.updateData([s]),delete a.schedule.scheduledDate,delete a.schedule.scheduledTime,delete a.schedule.courtOrder,delete a.schedule.courtId,delete a.schedule.venueId;const d={scheduledTime:"",scheduledDate:"",courtOrder:"",venueId:"",courtId:""},p=[{method:Hj,params:{tournamentId:a.tournamentId,matchUpId:a.matchUpId,schedule:d,drawId:a.drawId}}];Wt({methods:p,engine:YA,callback:g=>!g.success&&console.log({result:g})}),a.schedule=d;const f=OU(a);e.addRow(f,!0),tk(n)}const{SINGLES:jtt,DOUBLES:Gtt}=pl;function Htt({scheduledDate:t}={}){let e=t,i,n,r;function a(d){const p=d.getElement(),f=d.getData().matchUp.matchUpId;p.id=f,p.addEventListener("dragstart",m=>d1e(m,!0)),p.draggable=!0}function o({scheduledDate:d}){var m;const p=((m=My.allCompetitionMatchUps({matchUpFilters:{matchUpStatuses:ks.upcomingMatchUpStatuses,matchUpTypes:[jtt,Gtt]},nextMatchUps:!0}).matchUps)==null?void 0:m.filter(g=>{var v,y;return!((v=g.schedule)!=null&&v.courtId)&&!((y=g.sides)!=null&&y.some(({bye:b})=>b))}))||[],h=d||e;return i=p.filter(g=>{var v;return!((v=g.schedule)!=null&&v.scheduledDate)||g.schedule.scheduledDate===h}),{rowMatchUps:i.map(OU)}}function s({scheduledDate:d}={}){return setTimeout(()=>{const{rowMatchUps:h=[]}=o({scheduledDate:d});r&&r.replaceData(h)},n?0:1e3),{unscheduledMatchUps:i}}const l=Btt(i);gm({anchorId:Mb});const c=document.getElementById(Mb),{rowMatchUps:u=[]}=o({scheduledDate:e});return r=new Go(c,{headerSortElement:Fh(["flight"]),placeholder:"No unscheduled matches",rowFormatter:a,layout:"fitDataStretch",index:"matchUpId",data:u,height:250,columns:l}),r.on("tableBuilt",()=>{n=!0;const d=c.getElementsByClassName("tabulator-tableholder")[0];d.addEventListener("drop",p=>Vtt(p,r)),d.ondragover=p=>p.preventDefault(),d.draggable=!0}),r.on("dataChanged",d=>{const p=r.getColumns()[0]._getSelf().titleElement;p.innerHTML=`${d.length}`}),r.on("dataFiltered",(d,p)=>{const h=r.getColumns()[0]._getSelf().titleElement;h.innerHTML=`${p.length}`}),r.on("rowClick",(d,p)=>{const h=p.getData();console.log({matchUp:h})}),{table:r,replaceTableData:s,unscheduledMatchUps:i}}function M9(t,e){return t?_i.dateTime.convertTime(t,e):""}function ztt(t){const e=M9(t,!0).split(":");return+e[0]*60*60+ +e[1]*60+(+e[2]||0)}function QJ(t){return t.toString()[1]?t:"0"+t}function qtt(t,e){let i=Math.floor(t/3600),n=Math.floor((t-i*(60*60))/60);return e&&(n=0,i+=1,i>23&&(i=0)),`${QJ(i)}:${QJ(n)}`}function eQ(t,e,i,n){return new(i||(i=Promise))(function(r,a){function o(c){try{l(n.next(c))}catch(u){a(u)}}function s(c){try{l(n.throw(c))}catch(u){a(u)}}function l(c){var u;c.done?r(c.value):(u=c.value,u instanceof i?u:new i(function(d){d(u)})).then(o,s)}l((n=n.apply(t,e||[])).next())})}const tQ=(t,e)=>{const{touches:i}=t,{clientX:n,clientY:r}=t;if(!e)return;const{left:a,top:o}=e.getBoundingClientRect();let s={x:0,y:0};if(i===void 0)s={x:n-a,y:r-o};else if(i!==void 0&&i.length>0&&Object.keys(i).length>0){const{clientX:l,clientY:c}=i[0];s={x:l-a,y:c-o}}return Object.keys(s).length!==0||s.constructor!==Object?s:void 0},Fn=(t,e)=>!!t&&t.classList.contains(e),$d=(t,e,i)=>{if(!t)return;const n=new CustomEvent(e,{detail:i});t.dispatchEvent(n)},L$=(t,e,i)=>((n,r)=>Math.round(n/r)*r)(t,e*i),BM=(t,e)=>Array.from({length:Number(e)-Number(t)+1},(i,n)=>Number(t)+n),F$=(t,e)=>Array.from({length:Number(e)-Number(t)+1},(i,n)=>Number(e)-n).reverse(),$M=t=>{t&&typeof t=="function"&&t()},B$=(t="")=>{const e=t.replace(/(AM|PM|am|pm)/,n=>` ${n}`),i=new Date(`September 20, 2000 ${e}`);return`${i.getHours().toString().padStart(2,"0")}:${i.getMinutes().toString().padStart(2,"0")}`},Ju=(t,e,i,n)=>{if(!t)return{hour:"12",minutes:"00",type:e==="24h"?void 0:"PM"};const{value:r}=t;if(i){if(typeof i=="boolean"&&i){const[d,p]=new Date().toLocaleTimeString().split(":");if(/[a-z]/i.test(p)&&e==="12h"){const[h,f]=p.split(" ");return{hour:Number(d)<=9?`0${Number(d)}`:d,minutes:h,type:f}}return{hour:Number(d)<=9?`0${Number(d)}`:d,minutes:p,type:void 0}}{const{time:d,locales:p,preventClockType:h}=i;let f=d;if(d||(f=new Date),h&&n){const[v,y]=new Date(f).toLocaleTimeString().split(":");if(/[a-z]/i.test(y)){const[b,I]=y.split(" ");return{hour:v,minutes:b,type:I}}return{hour:Number(v)<=9?`0${Number(v)}`:v,minutes:y,type:void 0}}const[m,g]=new Date(f).toLocaleTimeString(p,{timeStyle:"short"}).split(":");if(/[a-z]/i.test(g)&&e==="12h"){const[v,y]=g.split(" ");return{hour:Number(m)<=9?`0${Number(m)}`:m,minutes:v,type:y}}if(e==="12h"){const[v,y]=new Date(`1970-01-01T${m}:${g}Z`).toLocaleTimeString("en-US",{timeZone:"UTC",hour12:!0,hour:"numeric",minute:"numeric"}).split(":"),[b,I]=y.split(" ");return{hour:Number(v)<=9?`0${Number(v)}`:m,minutes:b,type:I}}return{hour:Number(m)<=9?`0${Number(m)}`:m,minutes:g,type:void 0}}}if(r===""||!r)return{hour:"12",minutes:"00",type:e==="24h"?void 0:"PM"};const[a,o]=r.split(" "),[s,l]=a.split(":");if(/[a-z]/i.test(a))return{error:"The input contains invalid letters or whitespace."};if(r.includes(" ")){if(!o)return{error:`The input contains invalid letters or whitespace.
        Problem is with input length (max 5), currentLength: ${r.length}.`,currentLength:r.length};if(r.length>8||o!=="AM"&&o!=="PM")return{error:`The input contains invalid letters or whitespace.
        Problem is with input length (max 8), currentLength: ${r.length} or invalid type (PM or AM), currentType: ${o}.`,currentLength:r.length,currentType:o}}let c=Number(l);const u=Number(s);return c<10?c=`0${c}`:c===0&&(c="00"),e==="12h"?u>12||c>59||c<0||u===0||o!=="AM"&&o!=="PM"?{error:`The input contains invalid letters or numbers. Problem is with hour which should be less than 13 and higher or equal 0, currentHour: ${u}. Minutes should be less than 60 and higher or equal 0, currentMinutes: ${Number(c)} or invalid type (PM or AM), currentType: ${o}.`,currentHour:u,currentMin:c,currentType:o}:{hour:u<10?`0${u}`:u.toString(),minutes:c.toString(),type:o}:u<0||u>23||c>59?{error:`The input contains invalid numbers. Problem is with hour which should be less than 24 and higher or equal 0, currentHour: ${u}. Minutes should be less than 60 and higher or equal 0, currentMinutes: ${Number(c)}`,currentHour:u,currentMin:c}:{hour:u<10?`0${u}`:u.toString(),minutes:c.toString()}},mv=(t,e,i)=>{const n=Number(t);return e==="hour"?i!=="24h"?n>0&&n<=12:n>=0&&n<=23:e==="minutes"?n>=0&&n<=59:void 0},VM=(t,e,i,n)=>{if(t){if(Array.isArray(t)&&t.length>0)return!t.map(r=>mv(r,e,i)).some(r=>r===!1);if(typeof t=="string"||typeof t=="number"){const r=mv(t,e,i),a=n==null?void 0:n.map(Number).includes(Number(t));return!(!r||a)}}};function XF(t,e){e===void 0&&(e={});var i=e.insertAt;if(t&&typeof document<"u"){var n=document.head||document.getElementsByTagName("head")[0],r=document.createElement("style");r.type="text/css",i==="top"&&n.firstChild?n.insertBefore(r,n.firstChild):n.appendChild(r),r.styleSheet?r.styleSheet.cssText=t:r.appendChild(document.createTextNode(t))}}XF(`:export {
  cranepurple800: #5c1349;
  cranepurple900: #4e0d3a;
  cranepurple700: #71135c;
  cranered400: #f7363e;
  white: #fff;
  purple: #6200ee;
  opacity: opacity 0.15s linear;
}

.timepicker-ui * {
  box-sizing: border-box !important;
}
.timepicker-ui-modal {
  font-family: "Roboto", sans-serif;
  position: fixed;
  opacity: 0;
  top: 0;
  bottom: 0;
  left: 0;
  right: 0;
  background-color: rgba(156, 155, 155, 0.6);
  z-index: 5000;
  pointer-events: none;
}
.timepicker-ui-modal.show {
  pointer-events: auto;
}
.timepicker-ui-modal.removed {
  top: auto;
  bottom: auto;
  left: auto;
  right: auto;
  background-color: transparent;
}
.timepicker-ui-measure {
  position: absolute;
  top: -9999px;
  width: 3.125rem;
  height: 3.125rem;
  overflow: scroll;
}
.timepicker-ui-wrapper, .timepicker-ui-wrapper.mobile {
  position: fixed;
  z-index: 5001;
  width: 328px;
  height: 500px;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  background-color: #fff;
  border-radius: 4px;
  box-shadow: 0px 3px 5px -1px rgba(0, 0, 0, 0.2), 0px 5px 8px 0px rgba(0, 0, 0, 0.14), 0px 1px 14px 0px rgba(0, 0, 0, 0.12);
  display: flex;
  flex-direction: column;
  outline: none;
}
@media screen and (min-width: 320px) and (max-width: 825px) and (orientation: landscape) {
  .timepicker-ui-wrapper:not(.timepicker-ui-wrapper + .mobile) {
    flex-direction: row;
    height: 360px;
    width: 584px;
  }
}
@media screen and (max-width: 330px) and (orientation: portrait) {
  .timepicker-ui-wrapper:not(.timepicker-ui-wrapper + .mobile) {
    width: 315px;
  }
}
.timepicker-ui-wrapper.mobile {
  height: 218px;
}
@media screen and (max-width: 330px) {
  .timepicker-ui-wrapper.mobile {
    width: 315px;
  }
}
.timepicker-ui-header, .timepicker-ui-header.mobile {
  padding-top: 52px;
  padding-bottom: 36px;
  padding-right: 24px;
  padding-left: 24px;
  height: 104px;
  display: flex;
  flex-direction: row;
  justify-content: center;
  align-items: center;
  position: relative;
  height: 100%;
}
.timepicker-ui-header.mobile {
  padding-bottom: 0;
  padding-top: 35px;
}
@media screen and (min-width: 320px) and (max-width: 825px) and (orientation: landscape) {
  .timepicker-ui-header:not(.timepicker-ui-header + .mobile) {
    height: auto;
    flex-direction: column;
  }
}
.timepicker-ui-select-time, .timepicker-ui-select-time.mobile {
  text-transform: uppercase;
  position: absolute;
  top: 16px;
  left: 24px;
  font-size: 12px;
  color: #a9a9a9;
}
.timepicker-ui-body {
  height: 256px;
  width: 256px;
  margin: 0 auto;
  position: relative;
  border-radius: 100%;
}
@media screen and (min-width: 320px) and (max-width: 825px) and (orientation: landscape) {
  .timepicker-ui-body {
    padding-right: 0;
    padding-left: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    margin-top: 23px;
  }
}
@media screen and (min-width: 320px) and (max-width: 825px) and (orientation: landscape) {
  .timepicker-ui-wrapper-landspace {
    display: flex;
    flex-direction: column;
    width: 100%;
  }
}
.timepicker-ui-footer, .timepicker-ui-footer-mobile {
  height: 76px;
  display: flex;
  justify-content: space-between;
  margin-bottom: 4px;
}
@media screen and (min-width: 320px) and (max-width: 825px) and (orientation: landscape) {
  .timepicker-ui-footer:not(.timepicker-ui-footer + .mobile) {
    justify-content: flex-end;
  }
}
.timepicker-ui-footer.mobile {
  align-items: flex-start;
}
.timepicker-ui-clock-face {
  background-color: #e0e0e0;
  height: 100%;
  width: 100%;
  border-radius: 100%;
  position: relative;
}
@media screen and (min-width: 320px) and (max-width: 825px) and (orientation: landscape) {
  .timepicker-ui-clock-face {
    height: 256px;
    width: 256px;
    top: 15px;
  }
}
.timepicker-ui-dot {
  position: absolute;
  top: 50%;
  left: 50%;
  user-select: none;
  touch-action: none;
  transform: translate(-50%, -50%);
  background-color: #6200ee;
  height: 8px;
  width: 8px;
  border-radius: 100%;
}
.timepicker-ui-tips-wrapper {
  height: 100%;
  width: 100%;
}
.timepicker-ui-tips-wrapper-24h {
  position: absolute;
  height: 160px;
  width: 160px;
  z-index: 0;
  transform: translate(-50%, -50%);
  left: 50%;
  top: 50%;
  border-radius: 50%;
}
.timepicker-ui-tips-wrapper-24h-disabled {
  pointer-events: none;
  touch-action: none;
  user-select: none;
}
.timepicker-ui-hour-time-12, .timepicker-ui-minutes-time, .timepicker-ui-hour-time-24 {
  position: absolute;
  width: 32px;
  height: 32px;
  text-align: center;
  cursor: pointer;
  font-size: 17.6px;
  display: flex;
  justify-content: center;
  align-items: center;
  touch-action: none;
  user-select: none;
}
.timepicker-ui-hour-time-12 span, .timepicker-ui-minutes-time span, .timepicker-ui-hour-time-24 span {
  touch-action: none;
  user-select: none;
}
.timepicker-ui-hour-time-12 {
  display: block;
  display: flex;
  justify-content: center;
  align-items: center;
}
.timepicker-ui-wrapper-time, .timepicker-ui-wrapper-time.mobile {
  display: flex;
  margin-right: 10px;
  height: 100%;
  justify-content: center;
  align-items: center;
}
@media screen and (min-width: 320px) and (max-width: 825px) and (orientation: landscape) {
  .timepicker-ui-wrapper-time:not(.timepicker-ui-wrapper-time + .mobile) {
    margin-right: 0;
    height: auto;
  }
}
.timepicker-ui-wrapper-time-24h {
  margin-right: 0px;
}
.timepicker-ui-wrapper-time.mobile {
  position: relative;
}
.timepicker-ui-hour, .timepicker-ui-minutes, .timepicker-ui-hour.mobile, .timepicker-ui-minutes.mobile {
  display: flex;
  justify-content: center;
  align-items: center;
  font-size: 51.2px;
  background-color: #e4e4e4;
  border-radius: 7px;
  cursor: pointer;
  transition: all 0.3s ease;
  outline: none;
  border: 2px solid transparent;
  padding: 10px;
  width: 96px;
  text-align: center;
}
.timepicker-ui-hour:focus-visible, .timepicker-ui-minutes:focus-visible, .timepicker-ui-hour.mobile:focus-visible, .timepicker-ui-minutes.mobile:focus-visible {
  outline: auto;
}
.timepicker-ui-hour:hover, .timepicker-ui-hour.active, .timepicker-ui-minutes:hover, .timepicker-ui-minutes.active, .timepicker-ui-hour.mobile:hover, .timepicker-ui-hour.mobile.active, .timepicker-ui-minutes.mobile:hover, .timepicker-ui-minutes.mobile.active {
  color: #6200ee;
  background-color: #ece0fd;
}
.timepicker-ui-hour::-webkit-outer-spin-button, .timepicker-ui-hour::-webkit-inner-spin-button, .timepicker-ui-minutes::-webkit-outer-spin-button, .timepicker-ui-minutes::-webkit-inner-spin-button, .timepicker-ui-hour.mobile::-webkit-outer-spin-button, .timepicker-ui-hour.mobile::-webkit-inner-spin-button, .timepicker-ui-minutes.mobile::-webkit-outer-spin-button, .timepicker-ui-minutes.mobile::-webkit-inner-spin-button {
  -webkit-appearance: none !important;
  margin: 0 !important;
}
.timepicker-ui-hour[type=number], .timepicker-ui-minutes[type=number], .timepicker-ui-hour.mobile[type=number], .timepicker-ui-minutes.mobile[type=number] {
  -moz-appearance: textfield !important;
}
.timepicker-ui-hour, .timepicker-ui-minutes {
  outline: none;
  border: 2px solid transparent;
}
.timepicker-ui-hour[contenteditable=true]:focus, .timepicker-ui-hour[contenteditable=true]:active, .timepicker-ui-minutes[contenteditable=true]:focus, .timepicker-ui-minutes[contenteditable=true]:active {
  border: 2px solid #6200ee;
  outline-color: #6200ee;
  user-select: all;
}
.timepicker-ui-hour.mobile, .timepicker-ui-minutes.mobile {
  height: 70px;
  outline: none;
  border: 2px solid transparent;
}
.timepicker-ui-hour.mobile[contenteditable=true]:focus, .timepicker-ui-hour.mobile[contenteditable=true]:active, .timepicker-ui-minutes.mobile[contenteditable=true]:focus, .timepicker-ui-minutes.mobile[contenteditable=true]:active {
  border: 2px solid #6200ee;
  outline-color: #6200ee;
  user-select: all;
}
.timepicker-ui-dots, .timepicker-ui-dots.mobile {
  padding-left: 5px;
  padding-right: 5px;
  display: flex;
  justify-content: center;
  align-items: center;
  font-size: 57.6px;
  user-select: none;
  touch-action: none;
}
.timepicker-ui-wrapper-type-time, .timepicker-ui-wrapper-type-time.mobile {
  display: flex;
  flex-direction: column;
  height: 80px;
  justify-content: center;
  align-items: center;
  font-size: 16px;
  font-weight: 500;
  color: #787878;
}
@media screen and (min-width: 320px) and (max-width: 825px) and (orientation: landscape) {
  .timepicker-ui-wrapper-type-time {
    flex-direction: row;
    width: 100%;
  }
}
.timepicker-ui-wrapper-type-time.mobile {
  height: 70px;
}
.timepicker-ui-am, .timepicker-ui-pm, .timepicker-ui-am.mobile, .timepicker-ui-pm.mobile {
  display: flex;
  justify-content: center;
  align-items: center;
  border: 2px solid #d6d6d6;
  transition: all 0.3s ease;
  cursor: pointer;
  width: 100%;
  height: 100%;
}
.timepicker-ui-am:hover, .timepicker-ui-am.active, .timepicker-ui-pm:hover, .timepicker-ui-pm.active, .timepicker-ui-am.mobile:hover, .timepicker-ui-am.mobile.active, .timepicker-ui-pm.mobile:hover, .timepicker-ui-pm.mobile.active {
  color: #6200ee;
  background-color: #ece0fd;
}
.timepicker-ui-am.active, .timepicker-ui-pm.active, .timepicker-ui-am.mobile.active, .timepicker-ui-pm.mobile.active {
  pointer-events: none;
}
@media screen and (min-width: 320px) and (max-width: 825px) and (orientation: landscape) {
  .timepicker-ui-am:not(.timepicker-ui-am + .mobile), .timepicker-ui-pm:not(.timepicker-ui-pm + .mobile) {
    width: 50%;
    height: 44px;
  }
}
.timepicker-ui-am, .timepicker-ui-am.mobile {
  border-top-left-radius: 7px;
  border-top-right-radius: 7px;
  border-bottom-width: 0.3752px;
}
.timepicker-ui-am.mobile {
  border-bottom-left-radius: 0;
}
@media screen and (min-width: 320px) and (max-width: 825px) and (orientation: landscape) {
  .timepicker-ui-am:not(.timepicker-ui-am + .mobile) {
    border-top-left-radius: 7px;
    border-bottom-left-radius: 7px;
    border-top-right-radius: 0;
    border-top-width: 1.5008px;
    border-right-width: 0.3752px;
  }
}
.timepicker-ui-pm, .timepicker-ui-pm.mobile {
  border-bottom-left-radius: 7px;
  border-bottom-right-radius: 7px;
  border-top-width: 0.3752px;
  width: 54px;
}
.timepicker-ui-pm.mobile {
  border-top-right-radius: 0;
}
@media screen and (min-width: 320px) and (max-width: 825px) and (orientation: landscape) {
  .timepicker-ui-pm:not(.timepicker-ui-pm + .mobile) {
    border-bottom-right-radius: 7px;
    border-top-right-radius: 7px;
    border-bottom-left-radius: 0;
    border-bottom-width: 1.5008px;
    border-left-width: 0.3752px;
    width: 50%;
    height: 44px;
  }
}
.timepicker-ui-cancel-btn, .timepicker-ui-ok-btn, .timepicker-ui-cancel-btn.mobile, .timepicker-ui-ok.btn-mobile {
  color: #6200ee;
  text-transform: uppercase;
  border-radius: 7px;
  background-color: transparent;
  text-align: center;
  font-size: 15.2px;
  padding-top: 9px;
  padding-bottom: 9px;
  font-weight: 500;
  transition: all 0.3s ease;
  cursor: pointer;
}
.timepicker-ui-cancel-btn:hover, .timepicker-ui-ok-btn:hover, .timepicker-ui-cancel-btn.mobile:hover, .timepicker-ui-ok.btn-mobile:hover {
  background-color: #d6d6d6;
}
.timepicker-ui-cancel-btn, .timepicker-ui-cancel-btn.mobile {
  width: 72px;
  margin-right: 4px;
}
.timepicker-ui-ok-btn, .timepicker-ui-ok-btn.mobile {
  width: 64px;
  margin-left: 4px;
}
.timepicker-ui-wrapper-btn, .timepicker-ui-keyboard-icon, .timepicker-ui-wrapper-btn-mobile, .timepicker-ui-keyboard-icon-mobile {
  display: flex;
  justify-content: center;
  align-items: center;
}
.timepicker-ui-keyboard-icon-wrapper, .timepicker-ui-keyboard-icon-wrapper.mobile {
  width: 44px;
  height: 44px;
  position: relative;
  bottom: -26px;
  left: 12px;
  transition: all 0.3s ease;
}
.timepicker-ui-keyboard-icon-wrapper:hover .timepicker-ui-keyboard-icon, .timepicker-ui-keyboard-icon-wrapper:hover .timepicker-ui-keyboard-icon.mobile, .timepicker-ui-keyboard-icon-wrapper.mobile:hover .timepicker-ui-keyboard-icon, .timepicker-ui-keyboard-icon-wrapper.mobile:hover .timepicker-ui-keyboard-icon.mobile {
  background-color: #d6d6d6;
  border-radius: 7px;
}
.timepicker-ui-keyboard-icon-wrapper.mobile {
  bottom: -5px;
}
.timepicker-ui-keyboard-icon, .timepicker-ui-keyboard-icon.mobile {
  padding: 12px;
  cursor: pointer;
  transition: all 0.3s ease;
  color: #4e545a;
  height: 44px;
  width: 44px;
}
.timepicker-ui-keyboard-icon:hover, .timepicker-ui-keyboard-icon.mobile:hover {
  color: #6200ee;
}
@media screen and (min-width: 320px) and (max-width: 825px) and (orientation: landscape) {
  .timepicker-ui-keyboard-icon-wrapper, .timepicker-ui-keyboard-icon-wrapper.mobile {
    position: absolute;
    bottom: 8px;
  }
}
.timepicker-ui-wrapper-btn, .timepicker-ui-wrapper-btn.mobile {
  margin-right: 8px;
  position: relative;
  bottom: -14px;
}
.timepicker-ui-hour-text, .timepicker-ui-minute-text, .timepicker-ui-hour-text.mobile, .timepicker-ui-minute-text.mobile {
  position: absolute;
  bottom: 6px;
  font-size: 12.8px;
  color: #a9a9a9;
  left: 0;
}
.timepicker-ui-minute-text, .timepicker-ui-minute-text.mobile {
  left: 120px;
}
.timepicker-ui-clock-hand {
  position: absolute;
  background-color: #6200ee;
  bottom: 50%;
  height: 40%;
  left: calc(50% - 1px);
  transform-origin: center bottom 0;
  width: 2px;
}
.timepicker-ui-clock-hand-24h {
  height: 23%;
}
.timepicker-ui-circle-hand {
  position: absolute;
  transform: translate(-48%, -50%);
  width: 4px;
  height: 4px;
  border-radius: 100%;
  transition: all 0.2s ease;
  height: 46px;
  width: 46px;
  box-sizing: border-box !important;
  background-color: #6200ee;
}
.timepicker-ui-circle-hand.small-circle {
  height: 36px;
  width: 36px;
  box-sizing: border-box !important;
}
.timepicker-ui-circle-hand-24h {
  transform: translate(-50%, -50%);
  height: 32px;
  width: 32px;
  top: 4px;
  left: 1px;
}
.timepicker-ui-value-tips, .timepicker-ui-value-tips-24h {
  width: 100%;
  height: 100%;
  display: flex;
  justify-content: center;
  align-items: center;
  transition: 0.3s ease color;
  border-radius: 50%;
  outline: none;
}
.timepicker-ui-value-tips:focus, .timepicker-ui-value-tips-24h:focus {
  background: rgba(143, 143, 143, 0.315);
  box-shadow: 0px 3px 5px -1px rgba(0, 0, 0, 0.2), 0px 5px 8px 0px rgba(0, 0, 0, 0.14), 0px 1px 14px 0px rgba(0, 0, 0, 0.12);
}
.timepicker-ui-value-tips.active, .timepicker-ui-value-tips-24h.active {
  color: #fff;
  transition: none;
}
.timepicker-ui-clock-animation {
  animation: clockanimation 350ms linear;
}
.timepicker-ui-open-element.disabled {
  pointer-events: none;
  touch-action: none;
  user-select: none;
}
.timepicker-ui-tips-animation {
  transition: transform 400ms cubic-bezier(0.4, 0, 0.2, 1) 0ms, height 400ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;
}
.timepicker-ui-tips-disabled {
  color: rgba(156, 155, 155, 0.6);
  pointer-events: none;
}

.opacity {
  transition: opacity 0.15s linear;
}
.opacity.show {
  opacity: 1;
}

.invalid-value {
  border-color: #d50000 !important;
  color: #d50000 !important;
}
.invalid-value:hover, .invalid-value:focus, .invalid-value:active {
  border-color: #d50000 !important;
  color: #d50000 !important;
}

@keyframes clockanimation {
  0% {
    opacity: 0;
    transform: scale(0.8);
  }
  to {
    opacity: 1;
    transform: scale(1);
  }
}
.timepicker-ui-invalid-format {
  border: 2px solid red;
  color: red;
}

.timepicker-ui-invalid-text {
  color: red;
}`);XF(`:export {
  cranepurple800: #5c1349;
  cranepurple900: #4e0d3a;
  cranepurple700: #71135c;
  cranered400: #f7363e;
  white: #fff;
  purple: #6200ee;
  opacity: opacity 0.15s linear;
}

.timepicker-ui-wrapper.crane-straight, .timepicker-ui-wrapper.mobile.crane-straight {
  border-radius: 0;
  background-color: #4e0d3a;
  color: #fff;
}
.timepicker-ui-wrapper.crane-straight.radius, .timepicker-ui-wrapper.mobile.crane-straight.radius {
  border-radius: 1.25rem;
}
.timepicker-ui-select-time.crane-straight, .timepicker-ui-select-time.mobile.crane-straight {
  color: #e5e5e5;
}
.timepicker-ui-clock-face.crane-straight, .timepicker-ui-clock-face.mobile.crane-straight {
  background-color: #71135c;
}
.timepicker-ui-dot.crane-straight, .timepicker-ui-dot.mobile.crane-straight {
  background-color: #f7363e;
}
.timepicker-ui-hour.crane-straight, .timepicker-ui-minutes.crane-straight, .timepicker-ui-hour.mobile.crane-straight, .timepicker-ui-minutes.mobile.crane-straight {
  background-color: #71135c;
  border-radius: 0;
  color: #fff;
}
.timepicker-ui-hour.crane-straight.radius, .timepicker-ui-minutes.crane-straight.radius, .timepicker-ui-hour.mobile.crane-straight.radius, .timepicker-ui-minutes.mobile.crane-straight.radius {
  border-radius: 1.25rem;
}
.timepicker-ui-hour.crane-straight:hover, .timepicker-ui-hour.crane-straight.active, .timepicker-ui-minutes.crane-straight:hover, .timepicker-ui-minutes.crane-straight.active, .timepicker-ui-hour.mobile.crane-straight:hover, .timepicker-ui-hour.mobile.crane-straight.active, .timepicker-ui-minutes.mobile.crane-straight:hover, .timepicker-ui-minutes.mobile.crane-straight.active {
  background-color: #f7363e;
}
.timepicker-ui-hour.mobile.crane-straight[contenteditable=true]:focus, .timepicker-ui-hour.mobile.crane-straight[contenteditable=true]:active, .timepicker-ui-minutes.mobile.crane-straight[contenteditable=true]:focus, .timepicker-ui-minutes.mobile.crane-straight[contenteditable=true]:active {
  border-color: #fff;
  outline-color: #fff;
}
.timepicker-ui-dots.crane-straight, .timepicker-ui-dots.mobile.crane-straight {
  color: #fff;
}
.timepicker-ui-wrapper-type-time.crane-straight, .timepicker-ui-wrapper-type-time.mobile.crane-straight {
  color: #fff;
}
.timepicker-ui-am.crane-straight, .timepicker-ui-pm.crane-straight, .timepicker-ui-am.mobile.crane-straight, .timepicker-ui-pm.mobile.crane-straight {
  border: 0.125rem solid transparent;
  border-radius: 0;
  background-color: #71135c;
}
.timepicker-ui-am:hover.crane-straight, .timepicker-ui-am.active.crane-straight, .timepicker-ui-pm:hover.crane-straight, .timepicker-ui-pm.active.crane-straight, .timepicker-ui-am.mobile:hover.crane-straight, .timepicker-ui-am.mobile.active.crane-straight, .timepicker-ui-pm.mobile:hover.crane-straight, .timepicker-ui-pm.mobile.active.crane-straight {
  color: #fff;
  background-color: #f7363e;
}
.timepicker-ui-am.crane-straight.radius {
  border-top-left-radius: 1.25rem;
  border-top-right-radius: 1.25rem;
}
.timepicker-ui-pm.crane-straight.radius {
  border-bottom-left-radius: 1.25rem;
  border-bottom-right-radius: 1.25rem;
}
@media screen and (min-width: 320px) and (max-width: 826px) and (orientation: landscape) {
  .timepicker-ui-am:not(.timepicker-ui-am + .mobile).crane-straight.radius {
    border-bottom-left-radius: 1.25rem;
    border-top-right-radius: 0;
    border-bottom-right-radius: 0;
  }
}
@media screen and (min-width: 320px) and (max-width: 826px) and (orientation: landscape) {
  .timepicker-ui-pm:not(.timepicker-ui-pm + .mobile).crane-straight.radius {
    border-bottom-right-radius: 1.25rem;
    border-top-right-radius: 1.25rem;
    border-bottom-left-radius: 0;
    border-top-left-radius: 0;
  }
}
@media screen and (min-width: 320px) and (max-width: 767px) and (orientation: landscape) {
  .timepicker-ui-am.mobile.crane-straight.radius {
    border-bottom-left-radius: 0rem;
    border-bottom-right-radius: 0rem;
  }
}
@media screen and (min-width: 320px) and (max-width: 767px) and (orientation: landscape) {
  .timepicker-ui-pm.mobile.crane-straight.radius {
    border-top-left-radius: 0rem;
    border-top-right-radius: 0rem;
  }
}
.timepicker-ui-cancel-btn.crane-straight, .timepicker-ui-ok-btn.crane-straight, .timepicker-ui-cancel-btn.mobile.crane-straight, .timepicker-ui-ok-btn.mobile.crane-straight {
  color: #fff;
  border-radius: 0rem;
}
.timepicker-ui-cancel-btn.crane-straight.radius, .timepicker-ui-ok-btn.crane-straight.radius, .timepicker-ui-cancel-btn.mobile.crane-straight.radius, .timepicker-ui-ok-btn.mobile.crane-straight.radius {
  border-radius: 0.8125rem;
}
.timepicker-ui-cancel-btn:hover.crane-straight, .timepicker-ui-ok-btn:hover.crane-straight, .timepicker-ui-cancel-btn.mobile:hover.crane-straight, .timepicker-ui-ok-btn.mobile:hover.crane-straight {
  background-color: #f7363e;
}
.timepicker-ui-keyboard-icon-wrapper.crane-straight, .timepicker-ui-keyboard-icon-wrapper.mobile.crane-straight {
  color: #fff;
}
.timepicker-ui-keyboard-icon-wrapper.crane-straight.radius, .timepicker-ui-keyboard-icon-wrapper.mobile.crane-straight.radius {
  border-radius: 1.25rem;
}
.timepicker-ui-keyboard-icon-wrapper.crane-straight:hover .timepicker-ui-keyboard-icon, .timepicker-ui-keyboard-icon-wrapper.crane-straight:hover .timepicker-ui-keyboard-icon.mobile, .timepicker-ui-keyboard-icon-wrapper.mobile.crane-straight:hover .timepicker-ui-keyboard-icon, .timepicker-ui-keyboard-icon-wrapper.mobile.crane-straight:hover .timepicker-ui-keyboard-icon.mobile {
  background-color: #f7363e;
  color: #fff;
  border-radius: 0;
}
.timepicker-ui-keyboard-icon-wrapper.crane-straight.radius:hover .timepicker-ui-keyboard-icon, .timepicker-ui-keyboard-icon-wrapper.crane-straight.radius:hover .timepicker-ui-keyboard-icon.mobile, .timepicker-ui-keyboard-icon-wrapper.mobile.crane-straight.radius:hover .timepicker-ui-keyboard-icon, .timepicker-ui-keyboard-icon-wrapper.mobile.crane-straight.radius:hover .timepicker-ui-keyboard-icon.mobile {
  border-radius: 0.875rem;
}
.timepicker-ui-keyboard-icon.crane-straight:hover, .timepicker-ui-keyboard-icon.mobile.crane-straight:hover {
  color: #fff;
}
.timepicker-ui-keyboard-icon.crane-straight:hover.radius, .timepicker-ui-keyboard-icon.mobile.crane-straight:hover.radius {
  border-radius: 1.25rem;
}
.timepicker-ui-clock-hand.crane-straight {
  background-color: #f7363e;
}
.timepicker-ui-circle-hand.crane-straight {
  border-color: #f7363e;
  background-color: #f7363e;
}
.timepicker-ui-value-tips.crane-straight {
  color: #fff;
}`);XF(`:export {
  cranepurple800: #5c1349;
  cranepurple900: #4e0d3a;
  cranepurple700: #71135c;
  cranered400: #f7363e;
  white: #fff;
  purple: #6200ee;
  opacity: opacity 0.15s linear;
}

.timepicker-ui-hour-time-12.m3, .timepicker-ui-hour-time-24.m3 {
  color: #1a1c18;
}
.timepicker-ui-wrapper.m3 {
  border-radius: 35px;
  background-color: #e5eadc;
  box-shadow: unset;
}
.timepicker-ui-hour.active.m3, .timepicker-ui-minutes.active.m3 {
  background-color: #b8f397;
  color: #042100;
}
.timepicker-ui-minutes.m3, .timepicker-ui-hour.m3 {
  background-color: #dfe4d6;
}
.timepicker-ui-minutes:hover.m3, .timepicker-ui-hour:hover.m3 {
  color: #386a20;
}
.timepicker-ui-clock-face.m3 {
  background-color: #dfe4d6;
}
.timepicker-ui-clock-hand.m3, .timepicker-ui-dot.m3, .timepicker-ui-circle-hand.m3 {
  background-color: #386a20 !important;
}
.timepicker-ui-cancel-btn.m3, .timepicker-ui-ok-btn.m3 {
  color: #386a20;
}
.timepicker-ui-cancel-btn:hover.m3, .timepicker-ui-ok-btn:hover.m3 {
  background-color: #dfe4d6;
}
.timepicker-ui-wrapper-type-time.m3 {
  color: #6b7165;
}
.timepicker-ui-am.m3, .timepicker-ui-am.m3, .timepicker-ui-pm.m3, .timepicker-ui-pm.m3 {
  border-color: #74796e;
  border-width: 1px;
}
.timepicker-ui-am.m3, .timepicker-ui-am.m3 {
  border-bottom-width: 0px;
}
.timepicker-ui-am:hover.m3, .timepicker-ui-am.active.m3, .timepicker-ui-pm:hover.m3, .timepicker-ui-pm.active.m3 {
  background-color: #bbebeb;
  color: #002021;
}
.timepicker-ui-hour.mobile:hover.m3, .timepicker-ui-minutes.mobile:hover.m3 {
  background-color: #dfe4d6;
}`);var S1=`:export {
  cranepurple800: #5c1349;
  cranepurple900: #4e0d3a;
  cranepurple700: #71135c;
  cranered400: #f7363e;
  white: #fff;
  purple: #6200ee;
  opacity: opacity 0.15s linear;
}`;XF(S1);const Wtt={amLabel:"AM",animation:!0,appendModalSelector:"",backdrop:!0,cancelLabel:"CANCEL",editable:!1,enableScrollbar:!1,enableSwitchIcon:!1,mobileTimeLabel:"Enter Time",focusInputAfterCloseModal:!1,hourMobileLabel:"Hour",iconTemplate:'<i class="material-icons timepicker-ui-keyboard-icon">keyboard</i>',iconTemplateMobile:'<i class="material-icons timepicker-ui-keyboard-icon">schedule</i>',incrementHours:1,incrementMinutes:1,minuteMobileLabel:"Minute",mobile:!1,okLabel:"OK",pmLabel:"PM",timeLabel:"Select Time",switchToMinutesAfterSelectHour:!1,theme:"basic",clockType:"12h",disabledTime:void 0,currentTime:void 0,focusTrap:!0,delayHandler:300},$$="mousedown mouseup mousemove mouseleave mouseover touchstart touchmove touchend",iQ=["00","13","14","15","16","17","18","19","20","21","22","23"],o0=["12","1","2","3","4","5","6","7","8","9","10","11"],tb=["00","05","10","15","20","25","30","35","40","45","50","55"];class Dm{constructor(e){this.clean=()=>{var i,n;const r=(i=this.tipsWrapper)===null||i===void 0?void 0:i.querySelectorAll("span.timepicker-ui-hour-time-12"),a=(n=this.tipsWrapper)===null||n===void 0?void 0:n.querySelectorAll("span.timepicker-ui-minutes-time");this._removeClasses(r),this._removeClasses(a)},this.create=()=>{var i;if(!(this.clockFace&&this.array&&this.classToAdd&&this.tipsWrapper))return;const n=(this.clockFace.offsetWidth-32)/2,r=(this.clockFace.offsetHeight-32)/2,a=n-9;this.tipsWrapper.innerHTML="",(i=this.array)===null||i===void 0||i.forEach((o,s)=>{var l,c,u,d,p,h;const f=s*(360/this.array.length)*(Math.PI/180),m=document.createElement("span"),g=document.createElement("span");g.innerHTML=o,this.disabledTime&&(Array.isArray(this.disabledTime)&&(!((l=this.disabledTime)===null||l===void 0)&&l.includes(o))&&(g.classList.add("timepicker-ui-tips-disabled"),m.classList.add("timepicker-ui-tips-disabled")),this.hour===this.disabledTime.removedStartedHour&&(!((u=(c=this.disabledTime)===null||c===void 0?void 0:c.startMinutes)===null||u===void 0)&&u.includes(o))&&(g.classList.add("timepicker-ui-tips-disabled"),m.classList.add("timepicker-ui-tips-disabled"),g.tabIndex=-1),this.hour===this.disabledTime.removedEndHour&&(!((p=(d=this.disabledTime)===null||d===void 0?void 0:d.endMinutes)===null||p===void 0)&&p.includes(o))&&(g.classList.add("timepicker-ui-tips-disabled"),m.classList.add("timepicker-ui-tips-disabled"),g.tabIndex=-1)),this.clockType==="24h"?(g.classList.add("timepicker-ui-value-tips-24h"),Fn(g,"timepicker-ui-tips-disabled")||(g.tabIndex=0)):(g.classList.add("timepicker-ui-value-tips"),Fn(g,"timepicker-ui-tips-disabled")||(g.tabIndex=0)),m.classList.add(this.classToAdd),this.theme==="crane-straight"&&(m.classList.add("crane-straight"),g.classList.add("crane-straight")),this.theme==="m3"&&(m.classList.add("m3"),g.classList.add("m3")),m.style.left=n+Math.sin(f)*a-m.offsetWidth+"px",m.style.bottom=r+Math.cos(f)*a-m.offsetHeight+"px",m.appendChild(g),(h=this.tipsWrapper)===null||h===void 0||h.appendChild(m)})},this.updateDisable=i=>{var n,r;const a=(n=this.tipsWrapper)===null||n===void 0?void 0:n.querySelectorAll("span.timepicker-ui-hour-time-12"),o=(r=this.tipsWrapper)===null||r===void 0?void 0:r.querySelectorAll("span.timepicker-ui-minutes-time");if(this._removeClasses(a),this._removeClasses(o),i!=null&&i.hoursToUpdate&&a&&this._addClassesWithIncludes(a,i.hoursToUpdate),(i==null?void 0:i.minutesToUpdate)&&o){const{actualHour:s,removedEndHour:l,removedStartedHour:c,startMinutes:u,endMinutes:d}=i.minutesToUpdate;l===s&&d.length>0?this._addClassesWithIncludes(o,d):Number(s)>Number(c)&&Number(s)<Number(l)&&this._addClasses(o),c===s&&u.length>0?this._addClassesWithIncludes(o,u):Number(s)>Number(c)&&Number(s)<Number(l)&&this._addClasses(o)}if(i){const{amHours:s,pmHours:l,activeMode:c,startMinutes:u,endMinutes:d,removedAmHour:p,removedPmHour:h,actualHour:f}=i.minutesToUpdate;if(!s||!l)return;a&&(s&&c==="AM"&&this._addClassesWithIncludes(a,s),l&&c==="PM"&&this._addClassesWithIncludes(a,l)),o&&u&&d&&(c==="AM"&&(d[0]==="00"&&d.length===1&&u.length===0&&Number(f)>=Number(s[0])&&this._addClasses(o),u.length===0&&d.length>1&&Number(f)>=Number(p)&&this._addClasses(o),u.length>0&&d.length>1&&d[0]==="00"&&(Number(p)===Number(f)?this._addClassesWithIncludes(o,u):Number(f)>Number(p)&&this._addClasses(o)),d[0]==="00"&&d.length===1&&u.length>0&&(Number(p)===Number(f)?this._addClassesWithIncludes(o,u):Number(f)>Number(p)&&this._addClasses(o))),c==="PM"&&(f<Number(h)&&this._addClasses(o),f===h&&this._addClassesWithIncludes(o,d),d.length>0&&Number(f)===h-1&&this._addClassesWithIncludes(o,d)))}},this._removeClasses=i=>{i==null||i.forEach(({classList:n,children:r})=>{n.remove("timepicker-ui-tips-disabled"),r[0].classList.remove("timepicker-ui-tips-disabled"),r[0].tabIndex=0})},this._addClasses=i=>{i==null||i.forEach(({classList:n,children:r})=>{n.add("timepicker-ui-tips-disabled"),r[0].classList.add("timepicker-ui-tips-disabled"),r[0].tabIndex=-1})},this._addClassesWithIncludes=(i,n)=>{i==null||i.forEach(({classList:r,children:a,textContent:o})=>{n!=null&&n.includes(o)&&(r.add("timepicker-ui-tips-disabled"),a[0].classList.add("timepicker-ui-tips-disabled"),a[0].tabIndex=-1)})},this.array=e==null?void 0:e.array,this.classToAdd=e==null?void 0:e.classToAdd,this.clockFace=e==null?void 0:e.clockFace,this.tipsWrapper=e==null?void 0:e.tipsWrapper,this.theme=e==null?void 0:e.theme,this.clockType=e==null?void 0:e.clockType,this.disabledTime=e==null?void 0:e.disabledTime,this.hour=e==null?void 0:e.hour}}const nQ=(t,e)=>{let i;return(...n)=>{clearTimeout(i),i=setTimeout(()=>{t(...n)},e)}};class Ktt{constructor(e,i){var n,r,a;this.create=()=>{this._updateInputValueWithCurrentTimeOnStart(),this._checkDisabledValuesOnStart(),this._setTimepickerClassToElement(),this._setInputClassToInputElement(),this._setDataOpenToInputIfDosentExistInWrapper(),this._setClassTopOpenElement(),this._handleOpenOnEnterFocus(),this._handleOpenOnClick(),this._getDisableTime()},this.open=o=>{this.create(),this._eventsBundle(),$M(o)},this.close=()=>nQ((...o)=>{var s;if(o.length>2||!this.modalElement)return;const[l]=o.filter(u=>typeof u=="boolean"),[c]=o.filter(u=>typeof u=="function");l&&(this._handleOkButton(),(s=this.okButton)===null||s===void 0||s.click()),this._isTouchMouseMove=!1,$$.split(" ").map(u=>document.removeEventListener(u,this._mutliEventsMoveHandler,!1)),document.removeEventListener("mousedown",this._eventsClickMobileHandler),document.removeEventListener("touchstart",this._eventsClickMobileHandler),document.removeEventListener("keypress",this._handleEscClick),this.wrapper.removeEventListener("keydown",this._focusTrapHandler),this._options.enableSwitchIcon&&(this.keyboardClockIcon.removeEventListener("touchstart",this._handlerViewChange()),this.keyboardClockIcon.removeEventListener("mousedown",this._handlerViewChange())),this._removeAnimationToClose(),this.openElement.forEach(u=>u==null?void 0:u.classList.remove("disabled")),setTimeout(()=>{document.body.style.overflowY="",document.body.style.paddingRight=""},400),this.openElement.forEach(u=>u==null?void 0:u.classList.remove("disabled")),setTimeout(()=>{var u;this._options.focusInputAfterCloseModal&&((u=this.input)===null||u===void 0||u.focus()),this.modalElement!==null&&(this.modalElement.remove(),this._isModalRemove=!0)},300),$M(c)},this._options.delayHandler||300),this.destroy=o=>{$$.split(" ").map(s=>document.removeEventListener(s,this._mutliEventsMoveHandler,!1)),document.removeEventListener("mousedown",this._eventsClickMobileHandler),document.removeEventListener("touchstart",this._eventsClickMobileHandler),this._options.enableSwitchIcon&&this.keyboardClockIcon&&(this.keyboardClockIcon.removeEventListener("touchstart",this._handlerViewChange()),this.keyboardClockIcon.removeEventListener("mousedown",this._handlerViewChange())),this._cloned=this._element.cloneNode(!0),this._element.after(this._cloned),this._element.remove(),this._element=null,this._element===null&&$M(o),this._element=this._cloned},this.update=(o,s)=>{this._options=Object.assign(Object.assign({},this._options),o.options),this._checkMobileOption(),o.create&&this.create(),$M(s)},this._preventClockTypeByCurrentTime=()=>{var o,s,l,c,u;if(typeof((o=this._options)===null||o===void 0?void 0:o.currentTime)!="boolean"&&(!((l=(s=this._options)===null||s===void 0?void 0:s.currentTime)===null||l===void 0)&&l.preventClockType)||typeof((c=this._options)===null||c===void 0?void 0:c.currentTime)=="boolean"&&(!((u=this._options)===null||u===void 0)&&u.currentTime)){const{currentTime:d,clockType:p}=this._options,{type:h}=Ju(this.input,p,d,!0);this._options.clockType=h?"12h":"24h"}},this._updateInputValueWithCurrentTimeOnStart=()=>{var o,s,l,c,u;if(typeof((o=this._options)===null||o===void 0?void 0:o.currentTime)!="boolean"&&(!((l=(s=this._options)===null||s===void 0?void 0:s.currentTime)===null||l===void 0)&&l.updateInput)||typeof((c=this._options)===null||c===void 0?void 0:c.currentTime)=="boolean"&&(!((u=this._options)===null||u===void 0)&&u.currentTime)){const{hour:d,minutes:p,type:h}=Ju(this.input,this._options.clockType,this._options.currentTime);this.input.value=h?`${d}:${p} ${h}`:`${d}:${p}`}},this._setTheme=()=>{var o,s;const l=(o=this.modalElement)===null||o===void 0?void 0:o.querySelectorAll("div"),c=[...(s=this.modalElement)===null||s===void 0?void 0:s.querySelectorAll("input"),...l],{theme:u}=this._options;u==="crane-straight"?c.forEach(d=>d.classList.add("crane-straight")):u==="crane-radius"?c.forEach(d=>d.classList.add("crane-straight","radius")):u==="m3"&&c.forEach(d=>d.classList.add("m3"))},this._setInputClassToInputElement=()=>{var o;Fn(this.input,"timepicker-ui-input")||(o=this.input)===null||o===void 0||o.classList.add("timepicker-ui-input")},this._setDataOpenToInputIfDosentExistInWrapper=()=>{var o;this.openElementData===null&&((o=this.input)===null||o===void 0||o.setAttribute("data-open","timepicker-ui-input"))},this._setClassTopOpenElement=()=>{this.openElement.forEach(o=>o==null?void 0:o.classList.add("timepicker-ui-open-element"))},this._removeBackdrop=()=>{var o;this._options.backdrop||((o=this.modalElement)===null||o===void 0||o.classList.add("removed"),this.openElement.forEach(s=>s==null?void 0:s.classList.add("disabled")))},this._setNormalizeClass=()=>{var o,s;const l=(o=this.modalElement)===null||o===void 0?void 0:o.querySelectorAll("div");(s=this.modalElement)===null||s===void 0||s.classList.add("timepicker-ui-normalize"),l==null||l.forEach(c=>c.classList.add("timepicker-ui-normalize"))},this._setFlexEndToFooterIfNoKeyboardIcon=()=>{!this._options.enableSwitchIcon&&this.footer&&(this.footer.style.justifyContent="flex-end")},this._eventsBundle=()=>{var o,s,l,c,u,d,p,h,f,m,g,v,y;if(this._isModalRemove){if(this._handleEscClick(),this._setErrorHandler(),this._removeErrorHandler(),this.openElement.forEach(b=>b==null?void 0:b.classList.add("disabled")),(o=this.input)===null||o===void 0||o.blur(),this._setScrollbarOrNot(),this._setModalTemplate(),this._setNormalizeClass(),this._removeBackdrop(),this._setBgColorToCirleWithHourTips(),this._setOnStartCSSClassesIfClockType24h(),this._setClassActiveToHourOnOpen(),this.clockFace!==null){const b=new Dm({array:o0,classToAdd:"timepicker-ui-hour-time-12",clockFace:this.clockFace,tipsWrapper:this.tipsWrapper,theme:this._options.theme,disabledTime:!((l=(s=this._disabledTime)===null||s===void 0?void 0:s.value)===null||l===void 0)&&l.isInterval?(c=this._disabledTime)===null||c===void 0?void 0:c.value.rangeArrHour:(d=(u=this._disabledTime)===null||u===void 0?void 0:u.value)===null||d===void 0?void 0:d.hours,clockType:"12h",hour:this.hour.value});b.create(),this._options.clockType==="24h"?new Dm({array:iQ,classToAdd:"timepicker-ui-hour-time-24",clockFace:this.tipsWrapperFor24h,tipsWrapper:this.tipsWrapperFor24h,theme:this._options.theme,clockType:"24h",disabledTime:!((h=(p=this._disabledTime)===null||p===void 0?void 0:p.value)===null||h===void 0)&&h.isInterval?(f=this._disabledTime)===null||f===void 0?void 0:f.value.rangeArrHour:(g=(m=this._disabledTime)===null||m===void 0?void 0:m.value)===null||g===void 0?void 0:g.hours,hour:this.hour.value}).create():(((v=this._disabledTime)===null||v===void 0?void 0:v.value.startType)===((y=this._disabledTime)===null||y===void 0?void 0:y.value.endType)?setTimeout(()=>{var I,T,w,S,D,E,C,P;((I=this._disabledTime)===null||I===void 0?void 0:I.value.startType)===((T=this.activeTypeMode)===null||T===void 0?void 0:T.textContent)&&b.updateDisable({hoursToUpdate:(S=(w=this._disabledTime)===null||w===void 0?void 0:w.value)===null||S===void 0?void 0:S.rangeArrHour,minutesToUpdate:{endMinutes:(D=this._disabledTime)===null||D===void 0?void 0:D.value.endMinutes,removedEndHour:(E=this._disabledTime)===null||E===void 0?void 0:E.value.removedEndHour,removedStartedHour:(C=this._disabledTime)===null||C===void 0?void 0:C.value.removedStartedHour,actualHour:this.hour.value,startMinutes:(P=this._disabledTime)===null||P===void 0?void 0:P.value.startMinutes}})},300):setTimeout(()=>{var I,T,w;b.updateDisable({minutesToUpdate:{actualHour:this.hour.value,pmHours:(I=this._disabledTime)===null||I===void 0?void 0:I.value.pmHours,amHours:(T=this._disabledTime)===null||T===void 0?void 0:T.value.amHours,activeMode:(w=this.activeTypeMode)===null||w===void 0?void 0:w.textContent}})},300),b.updateDisable())}this._setFlexEndToFooterIfNoKeyboardIcon(),setTimeout(()=>{this._setTheme()},0),this._setAnimationToOpen(),this._getInputValueOnOpenAndSet(),this._toggleClassActiveToValueTips(this.hour.value),this._isMobileView||(this._setTransformToCircleWithSwitchesHour(this.hour.value),this._handleAnimationClock()),this._handleMinutesEvents(),this._handleHourEvents(),this._options.clockType!=="24h"&&(this._handleAmClick(),this._handlePmClick()),this.clockFace&&this._handleMoveHand(),this._handleCancelButton(),this._handleOkButton(),this.modalElement&&(this._setShowClassToBackdrop(),this._handleBackdropClick()),this._handleIconChangeView(),this._handleClickOnHourMobile(),this._options.focusTrap&&this._focusTrapHandler()}},this._handleOpenOnClick=()=>{this.openElement.forEach(o=>this._clickTouchEvents.forEach(s=>o==null?void 0:o.addEventListener(s,()=>this._eventsBundle())))},this._getInputValueOnOpenAndSet=()=>{var o,s;const l=Ju(this.input,this._options.clockType,this._options.currentTime);if(l===void 0)return this.hour.value="12",this.minutes.value="00",$d(this._element,"show",{hour:this.hour.value,minutes:this.minutes.value,type:(o=this.activeTypeMode)===null||o===void 0?void 0:o.dataset.type,degreesHours:this._degreesHours,degreesMinutes:this._degreesMinutes}),void(this._options.clockType!=="24h"&&this.AM.classList.add("active"));let[c,u,d]=this.input.value.split(":").join(" ").split(" ");this.input.value.length===0&&(c=l.hour,u=l.minutes,d=l.type),this.hour.value=c,this.minutes.value=u;const p=document.querySelector(`[data-type='${d}']`);this._options.clockType!=="24h"&&p&&p.classList.add("active"),$d(this._element,"show",Object.assign(Object.assign({},l),{type:(s=this.activeTypeMode)===null||s===void 0?void 0:s.dataset.type,degreesHours:this._degreesHours,degreesMinutes:this._degreesMinutes}))},this._handleCancelButton=()=>{this._clickTouchEvents.forEach(o=>{this.cancelButton.addEventListener(o,()=>{var s;const l=Ju(this.input,this._options.clockType);$d(this._element,"cancel",Object.assign(Object.assign({},l),{hourNotAccepted:this.hour.value,minutesNotAccepted:this.minutes.value,type:(s=this.activeTypeMode)===null||s===void 0?void 0:s.dataset.type,degreesHours:this._degreesHours,degreesMinutes:this._degreesMinutes})),this.close()()})})},this._handleOkButton=()=>{this._clickTouchEvents.forEach(o=>{var s;(s=this.okButton)===null||s===void 0||s.addEventListener(o,()=>{var l,c,u;const{clockType:d,disabledTime:p}=this._options,h=mv(this.hour.value,"hour",d),f=mv(this.minutes.value,"minutes",d);let m;const g=VM(this.hour.value,"hour",d,p==null?void 0:p.hours),v=VM(this.minutes.value,"minutes",d,p==null?void 0:p.minutes);if(p!=null&&p.interval&&(m=((y,b,I,T)=>{const w=I?B$(`${y}:${b} ${I}`.trim()):`${y}:${b}`.trim();let S,D;if(I){const[E,C]=T.trim().split("-").map(P=>P.trim());S=B$(E),D=B$(C)}else{const[E,C]=T.trim().split("-"),P=R=>R.trim().split(":").map(N=>Number(N)<=9?`0${Number(N)}`:N).join(":");S=P(E),D=P(C)}return w<S||w>D})(this.hour.value,this.minutes.value,(l=this.activeTypeMode)===null||l===void 0?void 0:l.textContent,p.interval)),m===!1||h===!1||f===!1||g===!1||v===!1)return m!==!1&&f&&v||this.minutes.classList.add("invalid-value"),void(m!==!1&&h&&g||this.hour.classList.add("invalid-value"));this.input.value=`${this.hour.value}:${this.minutes.value} ${this._options.clockType==="24h"?"":(c=this.activeTypeMode)===null||c===void 0?void 0:c.dataset.type}`.trimEnd(),$d(this._element,"accept",{hour:this.hour.value,minutes:this.minutes.value,type:(u=this.activeTypeMode)===null||u===void 0?void 0:u.dataset.type,degreesHours:this._degreesHours,degreesMinutes:this._degreesMinutes}),this.close()()})})},this._setShowClassToBackdrop=()=>{this._options.backdrop&&setTimeout(()=>{this.modalElement.classList.add("show")},300)},this._handleBackdropClick=()=>{var o;(o=this.modalElement)===null||o===void 0||o.addEventListener("click",s=>{var l;const c=s.target;if(!Fn(c,"timepicker-ui-modal"))return;const u=Ju(this.input,this._options.clockType);$d(this._element,"cancel",Object.assign(Object.assign({},u),{hourNotAccepted:this.hour.value,minutesNotAccepted:this.minutes.value,type:(l=this.activeTypeMode)===null||l===void 0?void 0:l.dataset.type,degreesHours:this._degreesHours,degreesMinutes:this._degreesMinutes})),this.close()()})},this._setBgColorToCirleWithHourTips=()=>{if(!this._options)return;const{mobile:o,theme:s}=this._options;o||this.circle===null||(this.circle.style.backgroundColor=s==="crane-straight"||s==="crane-radius"?S1.cranered400:S1.purple)},this._setBgColorToCircleWithMinutesTips=()=>{const{theme:o}=this._options;this.minutes.value&&tb.includes(this.minutes.value)&&(this.circle.style.backgroundColor=o==="crane-straight"||o==="crane-radius"?S1.cranered400:S1.purple,this.circle.classList.remove("small-circle"))},this._removeBgColorToCirleWithMinutesTips=()=>{this.minutes.value&&tb.includes(this.minutes.value)||(this.circle.style.backgroundColor="",this.circle.classList.add("small-circle"))},this._setTimepickerClassToElement=()=>{var o;(o=this._element)===null||o===void 0||o.classList.add("timepicker-ui")},this._setClassActiveToHourOnOpen=()=>{var o;this._options.mobile||this._isMobileView||(o=this.hour)===null||o===void 0||o.classList.add("active")},this._setMinutesToClock=o=>{var s,l,c,u,d;this.clockFace!==null&&this._setTransformToCircleWithSwitchesMinutes(o),this._removeBgColorToCirleWithMinutesTips();const p=!((l=(s=this._disabledTime)===null||s===void 0?void 0:s.value)===null||l===void 0)&&l.minutes?(u=(c=this._disabledTime)===null||c===void 0?void 0:c.value)===null||u===void 0?void 0:u.minutes:(d=this._disabledTime)===null||d===void 0?void 0:d.value,h=new Dm({array:tb,classToAdd:"timepicker-ui-minutes-time",clockFace:this.clockFace,tipsWrapper:this.tipsWrapper,theme:this._options.theme,disabledTime:p,hour:this.hour.value,clockType:this._options.clockType});h.create(),this._options.clockType==="12h"&&h.updateDisable(),this._toggleClassActiveToValueTips(o),this._options.clockType==="24h"&&(this.tipsWrapperFor24h.innerHTML="")},this._setHoursToClock=o=>{var s,l,c,u,d;if(this.clockFace!==null){this._setTransformToCircleWithSwitchesHour(o),this._setBgColorToCirleWithHourTips();const p=!((l=(s=this._disabledTime)===null||s===void 0?void 0:s.value)===null||l===void 0)&&l.isInterval?(c=this._disabledTime)===null||c===void 0?void 0:c.value.rangeArrHour:(d=(u=this._disabledTime)===null||u===void 0?void 0:u.value)===null||d===void 0?void 0:d.hours,h=new Dm({array:o0,classToAdd:"timepicker-ui-hour-time-12",clockFace:this.clockFace,tipsWrapper:this.tipsWrapper,theme:this._options.theme,disabledTime:p,clockType:"12h",hour:this.hour.value});h.create(),this._options.clockType==="24h"?new Dm({array:iQ,classToAdd:"timepicker-ui-hour-time-24",clockFace:this.tipsWrapperFor24h,tipsWrapper:this.tipsWrapperFor24h,theme:this._options.theme,clockType:"24h",disabledTime:p,hour:this.hour.value}).create():h.updateDisable(),this._toggleClassActiveToValueTips(o)}},this._setTransformToCircleWithSwitchesHour=o=>{const s=Number(o);let l=s>12?30*s-360:30*s;l===360&&(l=0),l>360||(this.clockHand.style.transform=`rotateZ(${l}deg)`)},this._setTransformToCircleWithSwitchesMinutes=o=>{const s=6*Number(o);s>360||(this.clockHand.style.transform=`rotateZ(${s}deg)`)},this._handleAmClick=()=>{this._clickTouchEvents.forEach(o=>{this.AM.addEventListener(o,s=>{var l,c,u,d;if(s.target.classList.add("active"),this.PM.classList.remove("active"),this._options.clockType==="12h"&&((l=this._options.disabledTime)===null||l===void 0?void 0:l.interval)){const p=new Dm({clockFace:this.clockFace,tipsWrapper:this.tipsWrapper,array:Fn(this.hour,"active")?o0:tb});((c=this._disabledTime)===null||c===void 0?void 0:c.value.startType)===((u=this._disabledTime)===null||u===void 0?void 0:u.value.endType)?setTimeout(()=>{var h,f,m,g;((h=this._disabledTime)===null||h===void 0?void 0:h.value.startType)===((f=this.activeTypeMode)===null||f===void 0?void 0:f.textContent)?p.updateDisable(Object.assign({hoursToUpdate:(g=(m=this._disabledTime)===null||m===void 0?void 0:m.value)===null||g===void 0?void 0:g.rangeArrHour},this._getDestructuringObj())):p.clean()},300):setTimeout(()=>{p.updateDisable(Object.assign({},this._getDestructuringObj(!0)))},300),p.updateDisable()}$d(this._element,"selectamtypemode",{hour:this.hour.value,minutes:this.minutes.value,type:(d=this.activeTypeMode)===null||d===void 0?void 0:d.dataset.type,degreesHours:this._degreesHours,degreesMinutes:this._degreesMinutes})})})},this._handlePmClick=()=>{this._clickTouchEvents.forEach(o=>{this.PM.addEventListener(o,s=>{var l,c,u,d;if(s.target.classList.add("active"),this.AM.classList.remove("active"),this._options.clockType==="12h"&&((l=this._options.disabledTime)===null||l===void 0?void 0:l.interval)){const p=new Dm({clockFace:this.clockFace,tipsWrapper:this.tipsWrapper,array:Fn(this.hour,"active")?o0:tb});((c=this._disabledTime)===null||c===void 0?void 0:c.value.startType)===((u=this._disabledTime)===null||u===void 0?void 0:u.value.endType)?setTimeout(()=>{var h,f,m,g;((h=this._disabledTime)===null||h===void 0?void 0:h.value.startType)===((f=this.activeTypeMode)===null||f===void 0?void 0:f.textContent)?p.updateDisable(Object.assign({hoursToUpdate:(g=(m=this._disabledTime)===null||m===void 0?void 0:m.value)===null||g===void 0?void 0:g.rangeArrHour},this._getDestructuringObj())):p.clean()},300):setTimeout(()=>{p.updateDisable(Object.assign({},this._getDestructuringObj(!0)))},300)}$d(this._element,"selectpmtypemode",{hour:this.hour.value,minutes:this.minutes.value,type:(d=this.activeTypeMode)===null||d===void 0?void 0:d.dataset.type,degreesHours:this._degreesHours,degreesMinutes:this._degreesMinutes})})})},this._handleAnimationClock=()=>{this._options.animation&&setTimeout(()=>{var o;(o=this.clockFace)===null||o===void 0||o.classList.add("timepicker-ui-clock-animation"),setTimeout(()=>{var s;(s=this.clockFace)===null||s===void 0||s.classList.remove("timepicker-ui-clock-animation")},600)},150)},this._handleAnimationSwitchTipsMode=()=>{this.clockHand.classList.add("timepicker-ui-tips-animation"),setTimeout(()=>{var o;(o=this.clockHand)===null||o===void 0||o.classList.remove("timepicker-ui-tips-animation")},401)},this._handleClasses24h=(o,s)=>{var l;const c=o.target;this.hourTips&&this._options.clockType==="24h"&&(Number(c.textContent)>12||Number(c.textContent)===0?this._setCircleClockClasses24h():this._removeCircleClockClasses24h(),this._options.mobile||(l=this.tipsWrapperFor24h)===null||l===void 0||l.classList.remove("timepicker-ui-tips-wrapper-24h-disabled")),c&&s&&(s.value=c.value.replace(/\D+/g,""),s.click())},this._handleHourEvents=()=>{var o,s;this._inputEvents.forEach(l=>{var c;(c=this.hour)===null||c===void 0||c.addEventListener(l,u=>{var d,p,h,f,m;const g=u.target;if(this.clockFace!==null&&this._handleAnimationSwitchTipsMode(),this._options.clockType==="24h"&&(Number(g.value)>12||Number(g.value)===0?this._setCircleClockClasses24h():this._removeCircleClockClasses24h(),this._options.mobile||(d=this.tipsWrapperFor24h)===null||d===void 0||d.classList.remove("timepicker-ui-tips-wrapper-24h-disabled")),this._setHoursToClock(g.value),g.classList.add("active"),this.minutes.classList.remove("active"),this._options.clockType==="12h"&&((p=this._options.disabledTime)===null||p===void 0?void 0:p.interval)){const v=new Dm({clockFace:this.clockFace,tipsWrapper:this.tipsWrapper,array:Fn(this.hour,"active")?o0:tb});((h=this._disabledTime)===null||h===void 0?void 0:h.value.startType)===((f=this._disabledTime)===null||f===void 0?void 0:f.value.endType)?setTimeout(()=>{var y,b,I,T;((y=this._disabledTime)===null||y===void 0?void 0:y.value.startType)===((b=this.activeTypeMode)===null||b===void 0?void 0:b.textContent)?v.updateDisable(Object.assign({hoursToUpdate:(T=(I=this._disabledTime)===null||I===void 0?void 0:I.value)===null||T===void 0?void 0:T.rangeArrHour},this._getDestructuringObj())):v.clean()},300):setTimeout(()=>{v.updateDisable(Object.assign({},this._getDestructuringObj(!0)))},300)}$d(this._element,"selecthourmode",{hour:this.hour.value,minutes:this.minutes.value,type:(m=this.activeTypeMode)===null||m===void 0?void 0:m.dataset.type,degreesHours:this._degreesHours,degreesMinutes:this._degreesMinutes}),this.clockFace!==null&&this.circle.classList.remove("small-circle")})}),(o=this.hour)===null||o===void 0||o.addEventListener("blur",l=>this._handleClasses24h(l,this.hour)),(s=this.hour)===null||s===void 0||s.addEventListener("focus",l=>this._handleClasses24h(l,this.hour))},this._handleMinutesEvents=()=>{var o,s;this._inputEvents.forEach(l=>{this.minutes.addEventListener(l,c=>{var u,d,p,h,f,m;const g=c.target;if(this.clockFace!==null&&(this._handleAnimationSwitchTipsMode(),this._setMinutesToClock(g.value)),this._options.clockType==="24h"&&(this._removeCircleClockClasses24h(),this._options.mobile||(u=this.tipsWrapperFor24h)===null||u===void 0||u.classList.add("timepicker-ui-tips-wrapper-24h-disabled")),g.classList.add("active"),(d=this.hour)===null||d===void 0||d.classList.remove("active"),this._options.clockType==="12h"&&((p=this._options.disabledTime)===null||p===void 0?void 0:p.interval)){const v=new Dm({clockFace:this.clockFace,tipsWrapper:this.tipsWrapper,array:Fn(this.hour,"active")?o0:tb});((h=this._disabledTime)===null||h===void 0?void 0:h.value.startType)===((f=this._disabledTime)===null||f===void 0?void 0:f.value.endType)?setTimeout(()=>{var y,b,I;((y=this._disabledTime)===null||y===void 0?void 0:y.value.startType)===((b=this.activeTypeMode)===null||b===void 0?void 0:b.textContent)?v.updateDisable(Object.assign({hoursToUpdate:(I=this._disabledTime)===null||I===void 0?void 0:I.value.rangeArrHour},this._getDestructuringObj())):v.clean()},300):setTimeout(()=>{v.updateDisable(Object.assign({},this._getDestructuringObj(!0)))},300)}$d(this._element,"selectminutemode",{hour:this.hour.value,minutes:this.minutes.value,type:(m=this.activeTypeMode)===null||m===void 0?void 0:m.dataset.type,degreesHours:this._degreesHours,degreesMinutes:this._degreesMinutes})})}),(o=this.minutes)===null||o===void 0||o.addEventListener("blur",l=>this._handleClasses24h(l,this.minutes)),(s=this.minutes)===null||s===void 0||s.addEventListener("focus",l=>this._handleClasses24h(l,this.minutes))},this._handleEventToMoveHand=o=>{var s,l,c,u,d,p,h,f,m,g,v,y,b,I,T,w,S,D,E,C,P,R,N,M,A,_,x,O,B,F,G,H,$,q,z,Z,Y,Q,X,oe,re,me,se,te,he,ae,de,Ie,De,Te,_e,Ve,ot,St,nt,Bt,Pe,et,Ee,lt,Ke,bt;const{target:gt,type:Ue,touches:xe}=o,We=gt,{incrementMinutes:st,incrementHours:vt,switchToMinutesAfterSelectHour:ge}=this._options;if(!tQ(o,this.clockFace))return;const Se=tQ(o,this.clockFace),qe=this.clockFace.offsetWidth/2,$e=Se&&Math.atan2(Se.y-qe,Se.x-qe);if(Ue==="mouseup"||Ue==="touchend")return this._isTouchMouseMove=!1,void(ge&&(Fn(We,"timepicker-ui-value-tips")||Fn(We,"timepicker-ui-value-tips-24h")||Fn(We,"timepicker-ui-tips-wrapper"))&&this.minutes.click());if(Ue!=="mousedown"&&Ue!=="mousemove"&&Ue!=="touchmove"&&Ue!=="touchstart"||Ue!=="mousedown"&&Ue!=="touchstart"&&Ue!=="touchmove"||((Fn(We,"timepicker-ui-clock-face")||Fn(We,"timepicker-ui-circle-hand")||Fn(We,"timepicker-ui-hour-time-12")||Fn(We,"timepicker-ui-minutes-time")||Fn(We,"timepicker-ui-clock-hand")||Fn(We,"timepicker-ui-value-tips")||Fn(We,"timepicker-ui-value-tips-24h")||Fn(We,"timepicker-ui-tips-wrapper")||Fn(We,"timepicker-ui-tips-wrapper-24h"))&&!Fn(We,"timepicker-ui-tips-disabled")?(o.preventDefault(),this._isTouchMouseMove=!0):this._isTouchMouseMove=!1),!this._isTouchMouseMove)return;if(this.minutesTips!==null){this.minutes.classList.add("active");let pt,tt=$e&&L$(Math.trunc(180*$e/Math.PI)+90,st,6);if(tt===void 0)return;if(tt<0?(pt=Math.round(360+tt/6)%60,tt=360+6*Math.round(tt/6)):(pt=Math.round(tt/6)%60,tt=6*Math.round(tt/6)),(s=this._disabledTime)===null||s===void 0?void 0:s.value.isInterval){if(((d=this._disabledTime)===null||d===void 0?void 0:d.value.endType)===((p=this._disabledTime)===null||p===void 0?void 0:p.value.startType)){if(!((m=(f=(h=this._disabledTime)===null||h===void 0?void 0:h.value)===null||f===void 0?void 0:f.endMinutes)===null||m===void 0)&&m.includes(pt<=9?`0${pt}`:`${pt}`)&&this.hour.value===((v=(g=this._disabledTime)===null||g===void 0?void 0:g.value)===null||v===void 0?void 0:v.removedEndHour)&&((y=this._disabledTime)===null||y===void 0?void 0:y.value.endType)===((b=this.activeTypeMode)===null||b===void 0?void 0:b.textContent)||!((w=(T=(I=this._disabledTime)===null||I===void 0?void 0:I.value)===null||T===void 0?void 0:T.startMinutes)===null||w===void 0)&&w.includes(pt<=9?`0${pt}`:`${pt}`)&&this.hour.value===((D=(S=this._disabledTime)===null||S===void 0?void 0:S.value)===null||D===void 0?void 0:D.removedStartedHour)&&((E=this._disabledTime)===null||E===void 0?void 0:E.value.startType)===((C=this.activeTypeMode)===null||C===void 0?void 0:C.textContent))return}else if(((P=this.activeTypeMode)===null||P===void 0?void 0:P.textContent)===((R=this._disabledTime)===null||R===void 0?void 0:R.value.endType)&&(!((A=(M=(N=this._disabledTime)===null||N===void 0?void 0:N.value)===null||M===void 0?void 0:M.endMinutes)===null||A===void 0)&&A.includes(pt<=9?`0${pt}`:`${pt}`)&&((_=this._disabledTime)===null||_===void 0?void 0:_.value.removedPmHour)===this.hour.value||!((x=this._disabledTime)===null||x===void 0)&&x.value.pmHours.map(Number).includes(Number(this.hour.value)))||((O=this.activeTypeMode)===null||O===void 0?void 0:O.textContent)===((B=this._disabledTime)===null||B===void 0?void 0:B.value.startType)&&(!((H=(G=(F=this._disabledTime)===null||F===void 0?void 0:F.value)===null||G===void 0?void 0:G.startMinutes)===null||H===void 0)&&H.includes(pt<=9?`0${pt}`:`${pt}`)&&(($=this._disabledTime)===null||$===void 0?void 0:$.value.removedAmHour)===this.hour.value||!((q=this._disabledTime)===null||q===void 0)&&q.value.amHours.map(Number).includes(Number(this.hour.value))))return}else if(!((u=(c=(l=this._disabledTime)===null||l===void 0?void 0:l.value)===null||c===void 0?void 0:c.minutes)===null||u===void 0)&&u.includes(pt<=9?`0${pt}`:`${pt}`))return;this.minutes.value=pt>=10?`${pt}`:`0${pt}`,this.clockHand.style.transform=`rotateZ(${tt}deg)`,this._degreesMinutes=tt,this._toggleClassActiveToValueTips(this.minutes.value),this._removeBgColorToCirleWithMinutesTips(),this._setBgColorToCircleWithMinutesTips(),$d(this._element,"update",Object.assign(Object.assign({},Ju(this.input,this._options.clockType)),{degreesHours:this._degreesHours,degreesMinutes:this._degreesMinutes,eventType:Ue,type:(z=this.activeTypeMode)===null||z===void 0?void 0:z.dataset.type}))}const ke=xe?xe[0]:void 0,Ut=xe&&ke?document.elementFromPoint(ke.clientX,ke.clientY):null;if(this.hourTips!==null){if((Z=this.hour)===null||Z===void 0||Z.classList.add("active"),!Fn(Ut||We,"timepicker-ui-value-tips-24h")&&!Fn(Ut||We,"timepicker-ui-tips-disabled")&&(Fn(Ut||We,"timepicker-ui-value-tips")||Fn(Ut||We,"timepicker-ui-tips-wrapper"))){let pt,tt=$e&&L$(Math.trunc(180*$e/Math.PI)+90,vt,30);if(this._degreesHours=tt,tt===void 0)return;tt<0?(pt=Math.round(360+tt/30)%12,tt=360+tt):(pt=Math.round(tt/30)%12,(pt===0||pt>12)&&(pt=12));const At=!((Y=this._disabledTime)===null||Y===void 0)&&Y.value.isInterval?"rangeArrHour":"hours";if(((Q=this._disabledTime)===null||Q===void 0?void 0:Q.value.endType)===((oe=(X=this._disabledTime)===null||X===void 0?void 0:X.value)===null||oe===void 0?void 0:oe.startType)){if(typeof((me=(re=this._disabledTime)===null||re===void 0?void 0:re.value)===null||me===void 0?void 0:me.endType)=="string"){if(((te=(se=this._disabledTime)===null||se===void 0?void 0:se.value)===null||te===void 0?void 0:te.endType)===((he=this.activeTypeMode)===null||he===void 0?void 0:he.textContent)&&((de=(ae=this._disabledTime)===null||ae===void 0?void 0:ae.value)===null||de===void 0?void 0:de.startType)===((Ie=this.activeTypeMode)===null||Ie===void 0?void 0:Ie.textContent)&&(!((Te=(De=this._disabledTime)===null||De===void 0?void 0:De.value[At])===null||Te===void 0)&&Te.includes(pt.toString())))return}else if(!((Ve=(_e=this._disabledTime)===null||_e===void 0?void 0:_e.value[At])===null||Ve===void 0)&&Ve.includes(pt.toString()))return}else if(((ot=this._disabledTime)===null||ot===void 0?void 0:ot.value.startType)===((St=this.activeTypeMode)===null||St===void 0?void 0:St.textContent)&&(!((nt=this._disabledTime)===null||nt===void 0)&&nt.value.amHours.includes(pt.toString()))||((Bt=this._disabledTime)===null||Bt===void 0?void 0:Bt.value.endType)===((Pe=this.activeTypeMode)===null||Pe===void 0?void 0:Pe.textContent)&&(!((et=this._disabledTime)===null||et===void 0)&&et.value.pmHours.includes(pt.toString())))return;this.clockHand.style.transform=`rotateZ(${tt}deg)`,this.hour.value=pt>9?`${pt}`:`0${pt}`,this._removeCircleClockClasses24h(),this._toggleClassActiveToValueTips(pt)}if((Fn(Ut||We,"timepicker-ui-value-tips-24h")||Fn(Ut||We,"timepicker-ui-tips-wrapper-24h"))&&!Fn(Ut||We,"timepicker-ui-tips-disabled")){let pt,tt=$e&&L$(Math.trunc(180*$e/Math.PI)+90,vt,30);if(this._degreesHours=tt,tt===void 0)return;tt<0?(pt=Math.round(360+tt/30)%24,tt=360+tt):(pt=Math.round(tt/30)+12,pt===12&&(pt="00"));const At=!((Ee=this._disabledTime)===null||Ee===void 0)&&Ee.value.isInterval?"rangeArrHour":"hours";if(!((Ke=(lt=this._disabledTime)===null||lt===void 0?void 0:lt.value[At])===null||Ke===void 0)&&Ke.includes(pt.toString()))return;this._setCircleClockClasses24h(),this.clockHand.style.transform=`rotateZ(${tt}deg)`,this.hour.value=`${pt}`,this._toggleClassActiveToValueTips(pt)}$d(this._element,"update",Object.assign(Object.assign({},Ju(this.input,this._options.clockType)),{degreesHours:this._degreesHours,degreesMinutes:this._degreesMinutes,eventType:Ue,type:(bt=this.activeTypeMode)===null||bt===void 0?void 0:bt.dataset.type}))}},this._toggleClassActiveToValueTips=o=>{const s=this.allValueTips.find(l=>Number(l.innerText)===Number(o));this.allValueTips.map(l=>l.classList.remove("active")),s!==void 0&&s.classList.add("active")},this._handleMoveHand=()=>{this._options.mobile||this._isMobileView||$$.split(" ").forEach(o=>{o==="touchstart"||o==="touchmove"||o==="touchend"?document.addEventListener(o,this._mutliEventsMoveHandler,{passive:!1}):document.addEventListener(o,this._mutliEventsMoveHandler,!1)})},this._setModalTemplate=()=>{if(!this._options)return;const{appendModalSelector:o}=this._options;if(o!==""&&o){const s=document==null?void 0:document.querySelector(o);s==null||s.insertAdjacentHTML("beforeend",this.modalTemplate)}else document.body.insertAdjacentHTML("afterend",this.modalTemplate)},this._setScrollbarOrNot=()=>{this._options.enableScrollbar?setTimeout(()=>{document.body.style.overflowY="",document.body.style.paddingRight=""},400):(document.body.style.paddingRight=`${(()=>{const o=document.createElement("div");o.className="timepicker-ui-measure",document.body.appendChild(o);const s=o.getBoundingClientRect().width-o.clientWidth;return document.body.removeChild(o),s})()}px`,document.body.style.overflowY="hidden")},this._setAnimationToOpen=()=>{var o,s;(o=this.modalElement)===null||o===void 0||o.classList.add("opacity"),this._options.animation?setTimeout(()=>{var l;(l=this.modalElement)===null||l===void 0||l.classList.add("show")},150):(s=this.modalElement)===null||s===void 0||s.classList.add("show")},this._removeAnimationToClose=()=>{var o;this.modalElement&&(this._options.animation?setTimeout(()=>{var s;(s=this.modalElement)===null||s===void 0||s.classList.remove("show")},150):(o=this.modalElement)===null||o===void 0||o.classList.remove("show"))},this._handlerViewChange=()=>nQ(()=>{var o,s,l,c;const{clockType:u}=this._options;if(Fn(this.modalElement,"mobile")){const d=mv(this.hour.value,"hour",u),p=mv(this.minutes.value,"minutes",u);if(d===!1||p===!1)return p||this.minutes.classList.add("invalid-value"),void(d||(s=this.hour)===null||s===void 0||s.classList.add("invalid-value"));d===!0&&p===!0&&(p&&this.minutes.classList.remove("invalid-value"),d&&((l=this.hour)===null||l===void 0||l.classList.remove("invalid-value"))),this.close()(),this._isMobileView=!1,this._options.mobile=!1;const h=this.hour.value,f=this.minutes.value,m=(c=this.activeTypeMode)===null||c===void 0?void 0:c.dataset.type;setTimeout(()=>{this.destroy(),this.update({options:{mobile:!1}}),setTimeout(()=>{if(this.open(),this.hour.value=h,this.minutes.value=f,this._options.clockType==="12h"){const g=m==="PM"?"AM":"PM";this[m==="PM"?"PM":"AM"].classList.add("active"),this[g].classList.remove("active")}this._setTransformToCircleWithSwitchesHour(this.hour.value),this._toggleClassActiveToValueTips(this.hour.value),Number(this.hour.value)>12||Number(this.hour.value)===0?this._setCircleClockClasses24h():this._removeCircleClockClasses24h()},300)},300)}else{this.close()(),this._isMobileView=!0,this._options.mobile=!0;const d=this.hour.value,p=this.minutes.value,h=(o=this.activeTypeMode)===null||o===void 0?void 0:o.dataset.type;setTimeout(()=>{this.destroy(),this.update({options:{mobile:!0}}),setTimeout(()=>{if(this.open(),this.hour.value=d,this.minutes.value=p,this._options.clockType==="12h"){const f=h==="PM"?"AM":"PM";this[h==="PM"?"PM":"AM"].classList.add("active"),this[f].classList.remove("active")}},300)},300)}},this._options.delayHandler||300),this._handleIconChangeView=()=>eQ(this,void 0,void 0,function*(){this._options.enableSwitchIcon&&(/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)?this.keyboardClockIcon.addEventListener("touchstart",this._handlerViewChange()):this.keyboardClockIcon.addEventListener("click",this._handlerViewChange()))}),this._handlerClickHourMinutes=o=>eQ(this,void 0,void 0,function*(){var s,l;if(!this.modalElement)return;const{clockType:c,editable:u}=this._options,d=o.target,p=mv(this.hour.value,"hour",c),h=mv(this.minutes.value,"minutes",c);u&&(Fn(d,"timepicker-ui-hour")||Fn(d,"timepicker-ui-minutes")?p!==!1&&h!==!1||(h||this.minutes.classList.add("invalid-value"),p||(l=this.hour)===null||l===void 0||l.classList.add("invalid-value")):p===!0&&h===!0&&(h&&this.minutes.classList.remove("invalid-value"),p&&((s=this.hour)===null||s===void 0||s.classList.remove("invalid-value"))))}),this._handleClickOnHourMobile=()=>{document.addEventListener("mousedown",this._eventsClickMobileHandler),document.addEventListener("touchstart",this._eventsClickMobileHandler)},this._handleKeyPress=o=>{o.key==="Escape"&&this.modalElement&&this.close()()},this._handleEscClick=()=>{document.addEventListener("keydown",this._handleKeyPress)},this._focusTrapHandler=()=>{setTimeout(()=>{var o,s;const l=(o=this.wrapper)===null||o===void 0?void 0:o.querySelectorAll('div[tabindex="0"]:not([disabled])'),c=(s=this.wrapper)===null||s===void 0?void 0:s.querySelectorAll('input[tabindex="0"]:not([disabled])');if(!l||l.length<=0||c.length<=0)return;const u=[...c,...l],d=u[0],p=u[u.length-1];this.wrapper.focus(),this.wrapper.addEventListener("keydown",({key:h,shiftKey:f,target:m})=>{const g=m;if(h==="Tab"&&(f?document.activeElement===d&&p.focus():document.activeElement===p&&d.focus()),h==="Enter"&&(Fn(g,"timepicker-ui-minutes")&&this.minutes.click(),Fn(g,"timepicker-ui-hour")&&this.hour.click(),Fn(g,"timepicker-ui-cancel-btn")&&this.cancelButton.click(),Fn(g,"timepicker-ui-ok-btn")&&this.okButton.click(),Fn(g,"timepicker-ui-keyboard-icon-wrapper")&&this.keyboardClockIcon.click(),Fn(g,"timepicker-ui-am")&&this.AM.click(),Fn(g,"timepicker-ui-pm")&&this.PM.click(),Fn(g,"timepicker-ui-value-tips")||Fn(g,"timepicker-ui-value-tips-24h"))){const{left:v,top:y,x:b,y:I,width:T,height:w}=g.getBoundingClientRect(),S=document.elementFromPoint(b,I);(()=>{var E;const C=new MouseEvent("mousedown",{clientX:v+T/2,clientY:y+w/2,cancelable:!0,bubbles:!0});Fn(S,"timepicker-ui-value-tips-24h")?S==null||S.dispatchEvent(C):(E=S==null?void 0:S.childNodes[0])===null||E===void 0||E.dispatchEvent(C),this._isTouchMouseMove=!1})()}setTimeout(()=>{this.wrapper.addEventListener("mousedown",()=>document.activeElement.blur())},100)})},301)},this._handleOpenOnEnterFocus=()=>{this.input.addEventListener("keydown",({target:o,key:s})=>{o.disabled||s==="Enter"&&this.open()})},this._element=e,this._cloned=null,this._options=((o,s)=>Object.assign(Object.assign({},s),o))(Object.assign(Object.assign({},i),(o=>{if(!o)return;const s=JSON.parse(JSON.stringify(o)),l=Object.keys(s);return Object.values(s).reduce((c,u,d)=>(Number(u)?c[l[d]]=Number(u):c[l[d]]=u==="true"||u==="false"?JSON.parse(u):u,c),{})})((n=this._element)===null||n===void 0?void 0:n.dataset)),Wtt),this._isTouchMouseMove=!1,this._degreesHours=30*Number(Ju((r=this._element)===null||r===void 0?void 0:r.querySelector("input"),this._options.clockType).hour),this._degreesMinutes=6*Number(Ju((a=this._element)===null||a===void 0?void 0:a.querySelector("input"),this._options.clockType).minutes),this._isMobileView=!1,this._mutliEventsMove=o=>this._handleEventToMoveHand(o),this._mutliEventsMoveHandler=this._mutliEventsMove.bind(this),this._eventsClickMobile=o=>this._handlerClickHourMinutes(o),this._eventsClickMobileHandler=this._eventsClickMobile.bind(this),this._checkMobileOption(),this._clickTouchEvents=["click","mousedown","touchstart"],this._inputEvents=["change",...this._clickTouchEvents],this._disabledTime=null,this._preventClockTypeByCurrentTime(),this._isModalRemove=!0}get modalTemplate(){return this._options.mobile&&this._isMobileView?(e=>{const{mobileTimeLabel:i,amLabel:n,pmLabel:r,cancelLabel:a,okLabel:o,iconTemplateMobile:s,minuteMobileLabel:l,hourMobileLabel:c,enableSwitchIcon:u,animation:d,clockType:p}=e;return`
  <div class="timepicker-ui-modal normalize mobile" role="dialog" style='transition:${d?"opacity 0.15s linear":"none"}'>
    <div class="timepicker-ui-wrapper mobile" tabindex="0">
      <div class="timepicker-ui-header mobile">
        <div class="timepicker-ui-select-time mobile">${i}</div>
        <div class="timepicker-ui-wrapper-time mobile">
          <input class="timepicker-ui-hour mobile" tabindex="0" type="number" min="0" max="${p==="12h"?"12":"23"}" />
          <div class="timepicker-ui-hour-text mobile">${c}</div>
          <div class="timepicker-ui-dots mobile">:</div>  
          <div class="timepicker-ui-minute-text mobile">${l}</div>
          <input class="timepicker-ui-minutes mobile" tabindex="0" type="number" min="0" max="59" /> 
        </div>
  ${p!=="24h"?`<div class="timepicker-ui-wrapper-type-time mobile">
          <div class="timepicker-ui-type-mode timepicker-ui-am mobile" data-type="AM" tabindex="0">${n}</div>    
          <div class="timepicker-ui-type-mode timepicker-ui-pm mobile" data-type="PM" tabindex="0">${r}</div>    
        </div>`:""}
      </div>
      <div class="timepicker-ui-footer mobile" data-view="mobile">
      ${u?`
      <div class="timepicker-ui-keyboard-icon-wrapper mobile" role="button" aria-pressed="false" data-view="desktop" tabindex="0">
      ${s}
      </div>`:""}
      <div class="timepicker-ui-wrapper-btn mobile">
        <div class="timepicker-ui-cancel-btn mobile" role="button" aria-pressed="false" tabindex="0">${a}</div>
        <div class="timepicker-ui-ok-btn mobile" role="button" aria-pressed="false" tabindex="0">${o}</div>
      </div>
      </div>
    </div>  
  </div>`})(this._options):(e=>{const{iconTemplate:i,timeLabel:n,amLabel:r,pmLabel:a,cancelLabel:o,okLabel:s,enableSwitchIcon:l,animation:c,clockType:u,editable:d}=e;return`
  <div class="timepicker-ui-modal normalize" role="dialog" style='transition:${c?"opacity 0.15s linear":"none"}'>
    <div class="timepicker-ui-wrapper" tabindex="0">
      <div class="timepicker-ui-header">
        <div class="timepicker-ui-select-time">${n}</div>
        <div class="timepicker-ui-wrapper-time ${u==="24h"?"timepicker-ui-wrapper-time-24h":""}">
          <input ${d?"":"readonly"} class="timepicker-ui-hour" tabindex="0" type="number" min="0" max="${u==="12h"?"12":"23"}" />
          <div class="timepicker-ui-dots">:</div>    
          <input ${d?"":"readonly"} class="timepicker-ui-minutes" tabindex="0" type="number" min="0" max="59" /> 
        </div>
      ${u!=="24h"?`
      <div class="timepicker-ui-wrapper-type-time">
        <div class="timepicker-ui-type-mode timepicker-ui-am" tabindex="0" role="button" data-type="AM">${r}</div>    
        <div class="timepicker-ui-type-mode timepicker-ui-pm" tabindex="0" role="button" data-type="PM">${a}</div>    
      </div>
      `:""}
      </div>
      <div class="timepicker-ui-wrapper-landspace">
        <div class="timepicker-ui-body">
          <div class="timepicker-ui-clock-face">
            <div class="timepicker-ui-dot"></div>
            <div class="timepicker-ui-clock-hand">
              <div class="timepicker-ui-circle-hand"></div>
            </div>
            <div class="timepicker-ui-tips-wrapper"></div>
            ${u==="24h"?'<div class="timepicker-ui-tips-wrapper-24h"></div>':""}
          </div>
        </div>
        <div class="timepicker-ui-footer">
        ${l?`
      <div class="timepicker-ui-keyboard-icon-wrapper" tabindex="0" role="button" aria-pressed="false" data-view="desktop">
        ${i}
      </div>`:""}
        <div class="timepicker-ui-wrapper-btn" >
          <div class="timepicker-ui-cancel-btn" tabindex="0" role="button" aria-pressed="false">${o}</div>
          <div class="timepicker-ui-ok-btn" tabindex="0" role="button" aria-pressed="false">${s}</div>
        </div>
        </div>
      </div>
    </div>  
  </div>`})(this._options)}get modalElement(){return document.querySelector(".timepicker-ui-modal")}get clockFace(){return document.querySelector(".timepicker-ui-clock-face")}get input(){var e;return(e=this._element)===null||e===void 0?void 0:e.querySelector("input")}get clockHand(){return document.querySelector(".timepicker-ui-clock-hand")}get circle(){return document.querySelector(".timepicker-ui-circle-hand")}get tipsWrapper(){return document.querySelector(".timepicker-ui-tips-wrapper")}get tipsWrapperFor24h(){return document.querySelector(".timepicker-ui-tips-wrapper-24h")}get minutes(){return document.querySelector(".timepicker-ui-minutes")}get hour(){return document.querySelector(".timepicker-ui-hour")}get AM(){return document.querySelector(".timepicker-ui-am")}get PM(){return document.querySelector(".timepicker-ui-pm")}get minutesTips(){return document.querySelector(".timepicker-ui-minutes-time")}get hourTips(){return document.querySelector(".timepicker-ui-hour-time-12")}get allValueTips(){return[...document.querySelectorAll(".timepicker-ui-value-tips"),...document.querySelectorAll(".timepicker-ui-value-tips-24h")]}get openElementData(){var e;const i=(e=this._element)===null||e===void 0?void 0:e.querySelectorAll("[data-open]");if((i==null?void 0:i.length)>0){const n=[];return i.forEach(({dataset:r})=>{var a;return n.push((a=r.open)!==null&&a!==void 0?a:"")}),[...new Set(n)]}return null}get openElement(){var e,i;return this.openElementData===null?((e=this.input)===null||e===void 0||e.setAttribute("data-open","timepicker-ui-input"),[this.input]):(i=this.openElementData.map(n=>{var r;return(r=this._element)===null||r===void 0?void 0:r.querySelectorAll(`[data-open='${n}']`)})[0])!==null&&i!==void 0?i:""}get cancelButton(){return document.querySelector(".timepicker-ui-cancel-btn")}get okButton(){return document.querySelector(".timepicker-ui-ok-btn")}get activeTypeMode(){return document.querySelector(".timepicker-ui-type-mode.active")}get keyboardClockIcon(){return document.querySelector(".timepicker-ui-keyboard-icon-wrapper")}get footer(){return document.querySelector(".timepicker-ui-footer")}get wrapper(){return document.querySelector(".timepicker-ui-wrapper")}_checkDisabledValuesOnStart(){if(!this._options.disabledTime||this._options.disabledTime.interval)return;const{disabledTime:{hours:e,minutes:i},clockType:n}=this._options,r=!e||VM(e,"hour",n),a=!i||VM(i,"minutes",n);if(!r||!a)throw new Error("You set wrong hours or minutes in disabled option")}_checkMobileOption(){this._isMobileView=!!this._options.mobile,this._options.mobile&&(this._options.editable=!0)}_getDisableTime(){this._disabledTime=(e=>{if(!e)return;const{disabledTime:i,clockType:n}=e;if(!i||Object.keys(i).length<=0||i.constructor.name!=="Object")return;const{hours:r,interval:a,minutes:o}=i;if(a){delete i.hours,delete i.minutes;const[s,l]=a.toString().split("-"),{hour:c,minutes:u,type:d}=Ju({value:s.trimEnd()},n),{hour:p,minutes:h,type:f}=Ju({value:l.trimEnd().trimStart()},n);let m=BM(c,p).map(b=>b==="00"||Number(b)===0?`0${Number(b)}`:`${Number(b)}`);const g=[],v=Number(u),y=Number(h);if(f===d)return v>0&&y<=0?(g.push(m[0],m[m.length-1]),m=m.slice(1,-1)):y<59&&y>0&&v<=0?(g.push(void 0,m[m.length-1]),m=m.slice(0,-1)):y>0&&v>0?(g.push(m[0],m[m.length-1]),m=m.slice(1,-1)):y===0&&v===0&&(g.push(void 0,m[m.length-1]),m.pop()),{value:{removedStartedHour:Number(g[0])<=9?`0${g[0]}`:g[0],removedEndHour:Number(g[1])<=9?`0${g[1]}`:g[1],rangeArrHour:m,isInterval:!0,startMinutes:BM(u,59).map(b=>Number(b)<=9?`0${b}`:`${b}`),endMinutes:F$(0,h).map(b=>Number(b)<=9?`0${b}`:`${b}`),endType:f,startType:d}};{const b=BM(c,12).map(String),I=F$(1,p).map(String),T=[],w=[];return v>0&&y<=0?(T.push(I[I.length-1]),w.push(b[0]),I.splice(-1,1),b.splice(0,1)):y<59&&y>0&&v<=0?(w.push(b[0]),T.push(I[I.length-1]),I.splice(-1,1)):y>0&&v>0?(T.push(I[I.length-1]),w.push(b[0]),I.splice(-1,1),b.splice(0,1)):y===0&&v===0&&(T.push(I[I.length-1]),w.push(b[0]),I.pop()),{value:{isInterval:!0,endType:f,startType:d,pmHours:I,amHours:b,startMinutes:Number(u)===0?[]:BM(u,59).map(S=>Number(S)<=9?`0${S}`:`${S}`),endMinutes:F$(0,h).map(S=>Number(S)<=9?`0${S}`:`${S}`),removedAmHour:Number(w[0])<=9?`0${w[0]}`:w[0],removedPmHour:Number(T[0])<=9?`0${T[0]}`:T[0]}}}}return r==null||r.forEach(s=>{if(n==="12h"&&Number(s)>12)throw new Error("The disabled hours value has to be less than 13");if(n==="24h"&&Number(s)>23)throw new Error("The disabled hours value has to be less than 24")}),o==null||o.forEach(s=>{if(Number(s)>59)throw new Error("The disabled minutes value has to be less than 60")}),{value:{hours:r==null?void 0:r.map(s=>s==="00"||Number(s)===0?`0${Number(s)}`:`${Number(s)}`),minutes:o==null?void 0:o.map(s=>Number(s)<=9?`0${s}`:`${s}`)}}})(this._options)}_removeCircleClockClasses24h(){var e,i;(e=this.circle)===null||e===void 0||e.classList.remove("timepicker-ui-circle-hand-24h"),(i=this.clockHand)===null||i===void 0||i.classList.remove("timepicker-ui-clock-hand-24h")}_setCircleClockClasses24h(){var e,i;this.circle&&((e=this.circle)===null||e===void 0||e.classList.add("timepicker-ui-circle-hand-24h")),this.clockHand&&((i=this.clockHand)===null||i===void 0||i.classList.add("timepicker-ui-clock-hand-24h"))}_setErrorHandler(){var e,i,n,r;const{error:a,currentHour:o,currentMin:s,currentType:l,currentLength:c}=Ju(this.input,this._options.clockType);if(a){const u=document.createElement("div");throw(e=this.input)===null||e===void 0||e.classList.add("timepicker-ui-invalid-format"),u.classList.add("timepicker-ui-invalid-text"),u.innerHTML="<b>Invalid Time Format</b>",!((i=this.input)===null||i===void 0)&&i.parentElement&&((n=this.input)===null||n===void 0?void 0:n.parentElement.querySelector(".timepicker-ui-invalid-text"))===null&&((r=this.input)===null||r===void 0||r.after(u)),$d(this._element,"geterror",{error:a,currentHour:o,currentMin:s,currentType:l,currentLength:c}),new Error(`Invalid Time Format: ${a}`)}}_removeErrorHandler(){var e,i;(e=this.input)===null||e===void 0||e.classList.remove("timepicker-ui-invalid-format");const n=(i=this._element)===null||i===void 0?void 0:i.querySelector(".timepicker-ui-invalid-text");n&&n.remove()}_setOnStartCSSClassesIfClockType24h(){if(this._options.clockType==="24h"){let{hour:e}=Ju(this.input,this._options.clockType,this._options.currentTime);this.input.value.length>0&&(e=this.input.value.split(":")[0]),(Number(e)>12||Number(e)===0)&&this._setCircleClockClasses24h()}}_getDestructuringObj(e){var i;const{endMinutes:n,removedEndHour:r,removedStartedHour:a,startMinutes:o,pmHours:s,amHours:l,removedAmHour:c,removedPmHour:u}=this._disabledTime.value;return e?{minutesToUpdate:{actualHour:this.hour.value,pmHours:s,amHours:l,activeMode:(i=this.activeTypeMode)===null||i===void 0?void 0:i.textContent,startMinutes:o,endMinutes:n,removedAmHour:c,removedPmHour:u}}:{minutesToUpdate:{endMinutes:n,removedEndHour:r,removedStartedHour:a,actualHour:this.hour.value,startMinutes:o}}}}function p1e({time:t,options:e,callback:i}={}){const n=document.getElementById("timepicker"),r=document.getElementById("timevalue");r.value=Ytt(t);const a=new Ktt(document.getElementById("timepicker"),{switchToMinutesAfterSelectHour:!0,clockType:"12h",...e});a.create(),a.open(),n.addEventListener("accept",()=>{const o=r.value;Nt(i)&&i({time:o}),a.destroy()})}function Ytt(t,e){var n;let i=Ztt(t||((n=e==null?void 0:e.schedule)==null?void 0:n.default_time));return i.ampm?t:(i.hours>12?(i.hours-=12,i.ampm="PM"):i.hours==="12"?i.ampm="PM":(i.hours==="00"&&(i.hours="12"),i.ampm="AM"),`${i.hours||"12"}:${i.minutes||"00"} ${i.ampm}`)}function Ztt(t){t=t||"00:00";let e={},i={};return{0:e.time,1:e.ampm}=t&&t.split(" ")||"",{0:i.hours,1:i.minutes}=e.time&&e.time.split(":")||"",i.ampm=e.ampm,i}const{AFTER_REST:rQ,FOLLOWED_BY:aQ,NEXT_AVAILABLE:oQ,NOT_BEFORE:sQ,TO_BE_ANNOUNCED:lQ}=bx;function h1e({e:t,cell:e,callback:i,matchUpId:n}={}){const r=e.getRow().getData(),a=h=>{const f=Object.values(r).filter(y=>y==null?void 0:y.matchUpId),g=[{params:{matchUpIds:n?[n]:f.map(({matchUpId:y})=>y),schedule:h},method:a9}];Wt({methods:g,callback:y=>{y.success&&Nt(i)&&i(h)}})},o=()=>a({scheduledTime:"",timeModifiers:[]}),s=({time:h})=>{const m=_i.dateTime.convertTime(h,!0);a({scheduledTime:m})},l=()=>{const f=e.getTable().getData();let m;const g=f.flatMap((I,T)=>{if(!m&&!(I.rowId===r.rowId&&(m=T+1,T)))return Object.values(I).flatMap(w=>{var S;return(S=w==null?void 0:w.schedule)==null?void 0:S.scheduledTime})}).filter(Boolean).map(ztt),v=Math.max(...g,0),y=m>1,b=v&&qtt(v,y)||"8:00 AM";p1e({time:b,callback:s})},c=h=>a({timeModifiers:[h]}),d=[{option:n?"Set match time":"Set match times",onClick:l},{option:XU[aQ],onClick:()=>c(aQ)},{option:XU[oQ],onClick:()=>c(oQ)},{option:XU[sQ],onClick:()=>c(sQ)},{option:XU[rQ],onClick:()=>c(rQ)},{option:XU[lQ],onClick:()=>c(lQ)},{option:"Clear time settings",onClick:o}],p=t.target;pc({options:d,target:p,config:{placement:Qt}})}function Xtt({column:t,courtInfo:e}){const i=e.courtId;cr({title:"Rename Court",content:a=>Cr(a,[{value:e.courtName,label:"Court Name",field:"courtName"}]),buttons:[{label:"Cancel",intent:"none",close:!0},{label:"Rename",intent:"is-primary",onClick:({content:a})=>{const o=a==null?void 0:a.courtName.value;o.length&&o!==e.courtName&&Wt({methods:[{method:CTe,params:{courtId:i,modifications:{courtName:o}}}],callback:c=>{c.success?t.updateDefinition({title:o}):console.log({result:c})}})},close:!0}]})}function Jtt(t,e,i){const r=[{option:`${Bo.tr("remove")} court identifiers`,onClick:o},{option:Bo.tr("rename"),onClick:()=>Xtt({column:e,courtInfo:i})}],a=t.target;pc({options:r,target:a});function o(){console.log("toggle court identifiers",{column:e})}}function Qtt(t,e){t.preventDefault();const i=t.dataTransfer.getData("itemid"),n=e.getTable(),r=n.getData(),a=e.getRow().getData();let o=n.getData().flatMap(E=>Object.values(E).filter(C=>C.matchUpId)),s=o.find(E=>E.matchUpId===i);s||(s=Go.findTable(`#${Mb}`)[0].getData().map(P=>P.matchUp).find(P=>P.matchUpId===i)||{});const l=document.getElementById(rhe).value,{courtOrder:c,courtId:u,venueId:d}=s.schedule||{},p=t.currentTarget,h=p.id;if(i===h)return;const f=s.schedule,m=h&&o.find(E=>E.matchUpId===h),g=p.getAttribute("venueId"),v=p.getAttribute("courtId"),y=p.getAttribute("courtOrder"),b=Object.keys(a).find(E=>{var M;if(!lp(a[E]))return;const C=((M=a[E])==null?void 0:M.schedule)||{},{courtOrder:P,courtId:R,venueId:N}=C;return(P==null?void 0:P.toString())===y.toString()&&N===g&&R===v});let I;const T=r.find(E=>(I=Object.keys(E).find(C=>{var A;if(!lp(E[C]))return;const P=((A=E[C])==null?void 0:A.schedule)||{},{courtOrder:R,courtId:N,venueId:M}=P;return R===c&&M===d&&N===u}),I)),w=({scheduledTime:E="",timeModifiers:C=[]}={})=>{const P={courtOrder:y,scheduledDate:l,venueId:g,courtId:v,scheduledTime:E,timeModifiers:C},R=[{method:Hj,params:{tournamentId:s==null?void 0:s.tournamentId,matchUpId:s==null?void 0:s.matchUpId,schedule:P,drawId:s==null?void 0:s.drawId}}];Wt({methods:R,engine:YA,callback:M=>!M.success&&console.log({result:M})}),s.schedule=P},S={scheduledDate:f==null?void 0:f.scheduledDate,scheduledTime:f==null?void 0:f.scheduledTime,timeModifiers:f==null?void 0:f.timeModifiers,courtOrder:c,venueId:d,courtId:u},D=()=>{const E=[{method:Hj,params:{tournamentId:m==null?void 0:m.tournamentId,matchUpId:m==null?void 0:m.matchUpId,schedule:S,drawId:m==null?void 0:m.drawId}}];Wt({methods:E,engine:YA,callback:P=>!P.success&&console.log({result:P})}),m?m.schedule=S:console.log("missing targetMatchUp")};if(h==="")T?(w(),T[I]={schedule:{courtOrder:c,venueId:d,courtId:u}},T.rowId==a.rowId?(T[b]=s,n.updateData([T])):(a[b]=s,n.updateData([T,a]))):(Go.findTable(`#${Mb}`)[0].deleteRow(i),w(),a[b]=s,n.updateData([a]));else if(!T&&m){const E=Go.findTable(`#${Mb}`)[0];E.deleteRow(i),w(),a[b]=s,n.updateData([a]),E.addRow(OU(m),!0),D()}else{const E=m==null?void 0:m.schedule;w({scheduledTime:E==null?void 0:E.scheduledTime,timeModifiers:E==null?void 0:E.timeModifiers}),D(),T.rowId==a.rowId?(T[I]=m,T[b]=s,n.updateData([T])):(T[I]=m,a[b]=s,n.updateData([T,a]))}tk(n)}const{SCHEDULE_STATE:eit,SCHEDULE_ERROR:tit,SCHEDULE_WARNING:iit,SCHEDULE_CONFLICT:nit}=ks.scheduleConstants;function f1e(t){var N;const e=document.createElement("span");if(!t.getColumn().getDefinition().field)return e.className="schedule-cell",e;const n=t.getValue(),{potentialParticipants:r,eventName:a="",roundName:o="",schedule:s={},matchUpStatus:l,winningSide:c,matchUpId:u,sides:d}=n||{},{courtOrder:p="",scheduledTime:h="",courtId:f="",timeModifiers:m,venueId:g=""}=s;if(e.setAttribute("courtOrder",p),e.setAttribute("courtId",f),e.setAttribute("venueId",g),e.className="schedule-cell dragdrop",e.ondragover=M=>M.preventDefault(),u)if(e.draggable=!0,e.id=u,c)e.classList.add("matchup-complete");else{const M=s[eit];l==="IN_PROGRESS"?e.classList.add("matchup-inprogress"):M===nit?e.classList.add("matchup-conflict"):M===ihe?e.classList.add("matchup-issue"):M===iit?e.classList.add("matchup-warning"):M===tit&&e.classList.add("matchup-error")}if(e.addEventListener("drop",M=>Qtt(M,t)),e.addEventListener("dragstart",d1e),!u)return e;const v=`${a} ${o}`,y=M=>{var A,_;return((_=(A=M.person)==null?void 0:A.standardFamilyName)==null?void 0:_.toUpperCase())||M.participantName},b=r==null?void 0:r.map(M=>M==null?void 0:M.map(A=>`<span class='potential nowrap'>${y(A)}</span>`).join('<span style="font-weight: bold">&nbsp;or&nbsp;</span>')),I=M=>{var _,x;const A=(x=(_=d==null?void 0:d.find(O=>M===O.sideNumber))==null?void 0:_.participant)==null?void 0:x.participantName;if(A)return c===M?`<span style='font-weight: bold'>${A}</span>`:A},T=I(1)||(b==null?void 0:b.shift())||"Unkown",w=I(2)||(b==null?void 0:b.shift())||"Unknown";e.id=u;const S=document.createElement("div");S.className="header flexrow",S.innerHTML=((m==null?void 0:m[0])&&YBe[m[0]]+"&nbsp;"||"")+M9(h),e.appendChild(S);const D=document.createElement("div");D.className="catround",D.innerHTML=v,e.appendChild(D);const E=document.createElement("div");E.className="scheduled_teams";const C=document.createElement("div");C.className="scheduled_team",C.style="font-size: 1em",C.innerHTML=T,E.appendChild(C);const P=document.createElement("div");P.className="divider",P.innerHTML="vs.",E.appendChild(P);const R=document.createElement("div");if(R.className="scheduled_team",R.style="font-size: 1em",R.innerHTML=w,E.appendChild(R),c){const M=document.createElement("div");M.innerHTML=((N=n.score)==null?void 0:N.scoreStringSide1)||"",E.appendChild(M)}return e.appendChild(E),e}function rit({values:t,valueChange:e,isValid:i}){const n=(o,s)=>l=>l.length>=o&&(!s||s&&l.length<=s),r=o=>!isNaN(o),a=o=>e(o);return[{error:"Please enter a name of at least 5 characters",placeholder:"Venue name",value:t.venueName||"",validator:n(5),label:"Venue name",field:"venueName",focus:!0,onChange:a},{error:"Please enter an abbreviation of 2-6 characters",value:t.venueAbbreviation||"",validator:n(2,6),field:"venueAbbreviation",label:"Abbreviation",onChange:a},{error:"Must be a whole number",value:t.courtsCount||"",validator:r,label:"Number of courts",field:"courtsCount",onChange:a}]}function ait(t){return{venueAbbreviation:t==null?void 0:t.venueAbbreviation.value,courtsCount:t==null?void 0:t.courtsCount.value,venueName:t==null?void 0:t.venueName.value}}const oit=t=>{const e=ait(Tt.drawer.attributes.content),{venueName:i,venueAbbreviation:n,courtsCount:r}=e,a=_i.UUID();if(!i||!n||!r){ti({message:"Invalid values",intent:"is-danger"});return}const o=[{params:{venue:{venueName:i,venueAbbreviation:n,venueId:a},returnDetails:!0},method:Y9e},{params:{courtsCount:parseInt(r),venueId:a,venueAbbreviationRoot:!0},method:L9e}];Wt({methods:o,callback:l=>{if(l!=null&&l.success&&Nt(t)){const{venue:c}=at.findVenue({venueId:a});c&&t({...l,venue:c})}}})};function m1e(t){const e=()=>{},i=s=>s&&!isNaN(s),n=({inputs:s})=>{const l=!!(ta(2,6)(s.venueAbbreviation.value)&&i(s.courtsCount.value)&&ta(5)(s.venueName.value)),c=document.getElementById("addVenueButton");c&&(c.disabled=!l)},r=[{control:"venueAbbreviation",onInput:n},{control:"courtsCount",onInput:n},{control:"venueName",onInput:n}],a=s=>Cr(s,rit({values:{},valueChange:e}),r),o=(s,l)=>Cw(s,[{label:"Cancel",close:!0},{onClick:()=>oit(t),id:"addVenueButton",intent:"is-info",disabled:!0,label:"Add",close:!0}],l);Tt.drawer.open({title:"<b style='larger'>Add venue</b>",width:"300px",side:Qt,content:a,footer:o})}function sit({courtsData:t,count:e}){const i=r=>{r.stopPropagation(),r.preventDefault(),m1e(g1e)},n=r=>{if(!r)return t!=null&&t.length?"<p style='font-weight: normal; color: lightblue'>Add venue</p>":"<button class='button is-danger'>Add venue</button>"};return e>0?_i.generateRange(0,e).map(r=>({headerClick:a=>r===0&&i(a),title:n(r),headerHozAlign:li,formatter:f1e,headerSort:!1,resizable:!1,minWidth:150})):[]}function lit({notice:t,notes:e,callback:i}){let n;cr({title:"Order of play",buttons:[{label:"Cancel",intent:"is-nothing"},{label:"Save",intent:"is-info",onClick:()=>{const s=n.notice.value,l=n.notes.value;typeof i=="function"&&i({notice:s,notes:l})},close:!0}],content:s=>{n=Cr(s,[{placeholder:"appears on PDF Header",value:t,label:"Schedule notice",field:"notice"},{placeholder:"appears on PDF Footer",value:e,label:"Umpire notes",field:"notes"}])}})}const{NOT_BEFORE:cQ}=bx;function cit(t,e){var r;const i=e.getRow().getData(),n=Object.values(i).filter(a=>a==null?void 0:a.matchUpId);(r=i.issues)!=null&&r.length&&console.log({issues:i.issues}),n.length&&h1e({e:t,cell:e,rowData:i,callback:o=>{if(lp(o)){const s=e.getTable(),l=s.getData().find(c=>c.rowId===i.rowId);Object.values(l).forEach(c=>{var u;c.matchUpId&&(o.scheduledTime&&(c.schedule.scheduledTime=M9(o.scheduledTime),((u=c.schedule.timeModifiers)==null?void 0:u[0])!==cQ&&(c.schedule.timeModifiers=[])),o.timeModifiers&&(c.schedule.scheduledTime&&o.timeModifiers[0]!==cQ&&(c.schedule.scheduledTime=""),c.schedule.timeModifiers=o.timeModifiers))}),s.updateData([l])}}})}function uit(){function t(n){const r=n.getElement();return r.classList.add("tag"),r.classList.add("is-info"),r.classList.add("is-light"),'<i class="fa-regular fa-note-sticky"></i>'}function e(n){n.getElement().style.backgroundColor="white";const r=document.createElement("span"),a=n.getRow().getData();return r.innerHTML=a.rowNumber,r}return{titleFormatter:t,formatter:e,headerClick:()=>{lit({notes:"",notice:"",callback:n});function n(r){console.log({result:r})}},cellClick:cit,headerSort:!1,resizable:!1,hozAlign:li,frozen:!0,width:55}}function dit({courtsData:t,courtPrefix:e}){const i=(l,c)=>{const u=c.getColumn().getDefinition().field,{drawId:d,matchUpId:p}=c.getData()[u];h1e({e:l,cell:c,matchUpId:p,callback:()=>{var v,y;const f=(y=(v=at.allTournamentMatchUps({matchUpFilters:{drawIds:[d],matchUpIds:[p]},nextMatchUps:!0}))==null?void 0:v.matchUps)==null?void 0:y[0],m=c.getRow().getData();m[u]=f,c.getTable().updateData([m])}})},n=qBe-(t==null?void 0:t.length)||0,r=n<=0?1:n,a=sit({courtsData:t,count:r}),o=uit(),s=(l,c)=>({headerClick:(u,d)=>Jtt(u,d,l),cellClick:i,field:`${e}${c}`,title:l.courtName,headerHozAlign:li,formatter:f1e,headerSort:!1,resizable:!1,hozAlign:li,minWidth:150});return[o].concat(t==null?void 0:t.map(s),a)}function pit({scheduledDate:t}={}){let e,i,n,r=[];const a=({scheduledDate:d})=>{const p={localPerspective:!0,scheduledDate:d},h=My.competitionScheduleMatchUps({courtCompletedMatchUps:!0,withCourtGridRows:!0,minCourtGridRows:10,nextMatchUps:!0,matchUpFilters:p}),{dateMatchUps:f=[],completedMatchUps:m=[],courtsData:g,courtPrefix:v="C|",rows:y,groupInfo:b}=h,I=f.concat(...m),T=dit({courtsData:g,courtPrefix:v});return y==null||y.forEach((w,S)=>{w.rowId=`rowId-${S+1}`,w.rowNumber=S+1}),{rows:y,columns:T,matchUps:I,courtsCount:(g==null?void 0:g.length)??0,courtsData:g,groupInfo:b}},o=({scheduledDate:d}={})=>{setTimeout(()=>{const{rows:h,matchUps:f,columns:m,courtsData:g}=a({scheduledDate:d}),v=g==null?void 0:g.map(b=>b.courtId);_i.intersection(r,v).length===(v==null?void 0:v.length)||(i.setColumns(m),r=v),n=!0,i==null||i.replaceData(h),i.matchUps=f},e?0:1e3)};gm({anchorId:JA});const s=document.getElementById(JA),{rows:l=[],columns:c=[],courtsCount:u}=a({scheduledDate:t});return r=c.map(d=>d==null?void 0:d.courtId).filter(Boolean),i=new Go(s,{height:window.innerHeight*.84,renderHorizontal:"virtual",placeholder:"No courts",index:"rowId",data:l,columns:c}),i.on("scrollVertical",ld),i.on("tableBuilt",()=>{tk(i),e=!0}),i.on("dataProcessed",()=>{n&&(n=!1,tk(i))}),{table:i,replaceTableData:o,courtsCount:u}}function hit({updateUnscheduledTable:t,updateScheduleTable:e,scheduledDate:i,table:n}){const a=[{params:{matchUps:n.getData("active").map(s=>s.matchUp),scheduledDate:i},method:sKe}];Wt({methods:a,callback:s=>{s.success&&(t(),e({scheduledDate:i}))},engine:YA})}function fit({scheduledDate:t,target:e,roundNameFilter:i,eventIdFilter:n,callback:r}){const a=My.competitionScheduleMatchUps({courtCompletedMatchUps:!0}),{dateMatchUps:o=[],completedMatchUps:s=[]}=a,c=o.concat(...s).filter(({schedule:m})=>m.scheduledDate||m.scheduledTime||m.courtId),u=c.filter(({schedule:m})=>m.scheduledDate===t);let d=[{disabled:!u.length,option:"Clear scheduled matches",onClick:f},{disabled:!u.length,option:"Clear all matches",onClick:h},{disabled:!c.length,option:"Clear all days",onClick:p}];d.filter(m=>!m.disabled).length&&pc({target:e,options:d,config:{placement:gp}});function p(){f({all:!0})}function h(){f({completed:!0})}function f({all:m,completed:g}={}){let v=c.filter(({schedule:w})=>w.scheduledDate===t).filter(({roundName:w})=>!i||i===w).filter(({eventId:w})=>!n||n===w);g||(v=v==null?void 0:v.filter(({matchUpStatus:w,winningSide:S})=>w!=="COMPLETED"&&!S));const b=(m?c:v).map(w=>w.matchUpId);Wt({methods:[{method:a9,params:{schedule:{courtId:"",scheduledDate:"",courtOrder:"",scheduledTime:"",venueId:""},matchUpIds:b}}],callback:w=>{w.success&&Nt(r)&&r()}})}}function mit({updateUnscheduledTable:t,updateScheduleTable:e,toggleUnscheduled:i,flightNameFilter:n,roundNameFilter:r,controlAnchor:a,eventIdFilter:o,scheduledDate:s,matchUps:l=[],table:c}){const u=_=>{s=_},d=_=>_.eventId===o,p=_=>{c.removeFilter(d),o=_,_&&c.addFilter(d)},h=at.getEvents().events||[],m=[{label:eg,onClick:()=>p(),close:!0}].concat(h.map(_=>({onClick:()=>p(_.eventId),label:_.eventName,close:!0}))),g=_=>_.roundName===r,v=_i.unique(l.map(_=>_.roundName)),y=_=>{c.removeFilter(g),r=_,_&&c.addFilter(g)},I=[{label:WY,onClick:()=>y(),close:!0}].concat(v.map(_=>({onClick:()=>y(_),label:_,close:!0}))),T=_=>_.flight===n,w=_i.unique(l.map(_=>_.drawName)),S=_=>{c.removeFilter(T),n=_,_&&c.addFilter(T)},E=[{label:ZD,onClick:()=>S(),close:!0}].concat(w.map(_=>({onClick:()=>S(_),label:_,close:!0}))),C=()=>{t()&&e({scheduledDate:s}),console.log("clear filters ?")},P=_=>{const x=Bl(_.target,"dropdown");fit({target:x||(_==null?void 0:_.target),callback:C,roundNameFilter:r,eventIdFilter:o,scheduledDate:s,eventFilter:d,roundFilter:g})},R=Ew(c),M=[{onClick:()=>hit({scheduledDate:s,table:c,updateScheduleTable:e,updateUnscheduledTable:t}),label:"Auto schedule",intent:"is-primary",id:"autoSchedule",close:!0},{label:"Clear schedule",onClick:P,intent:"is-warning",id:"clearSchedule",close:!0}],A=[{onKeyDown:_=>_.keyCode===8&&_.target.value.length===1&&R(""),onChange:_=>R(_.target.value),onKeyUp:_=>R(_.target.value),clearSearch:()=>R(""),placeholder:"Search participants",location:ci,search:!0},{hide:m.length<2,options:m,id:"eventOptions",label:eg,modifyLabel:!0,location:ci,selection:!0},{hide:I.length<2,options:I,id:"roundOptions",label:WY,modifyLabel:!0,location:ci,selection:!0},{hide:E.length<2,options:E,id:"flightOptions",label:ZD,modifyLabel:!0,location:ci,selection:!0},{options:M,label:"Actions",selection:!1,location:Qt,align:Qt},{onClick:i,id:"doneScheduling",intent:"is-info",label:"Done"}];return Ns({target:a,items:A}).elements,{updateScheduledDate:u}}function git({toggleUnscheduled:t,schedulingActive:e,controlAnchor:i,scheduledDate:n,courtsCount:r,setDate:a}={}){if(!i)return;let o;const s=f=>E9(f).format("dddd MMM D"),{startDate:l,endDate:c}=My.getCompetitionDateRange(),d=_i.generateDateRange(l,c).map(f=>({onClick:()=>Nt(a)&&a(f),isActive:f===n,label:s(f),value:f,close:!0})),p=()=>{},h=[{clearSearch:()=>p(),placeholder:"Search participants",id:"searchParticipants",visible:!!r,location:ci,search:!0},{options:[{label:"Team ",onClick:()=>console.log("team clicked"),close:!0}],label:"Highlight team",visible:!!r,id:"highlightTeam",location:ci,align:ci},{visible:!!r&&!e,onClick:t,label:"Schedule matches",id:"scheduleMatchUps",intent:"is-primary",location:Qt},{label:s(n||l),value:n||l,id:rhe,options:d,modifyLabel:!0,intent:"is-info",location:Qt,align:Qt}];return o=Ns({target:i,items:h}).elements,{elements:o}}function g1e({scheduledDate:t}){let e;const i=document.getElementById(dhe),n=document.getElementById(m4),r=document.getElementById(g4);n.style.paddingBottom="1em",r.style.paddingBottom="1em";let a=Tt.state.schedulingActive;i.style.display=a?"":Mt,t=t||My.getCompetitionDateRange().startDate;const{replaceTableData:o,table:s,unscheduledMatchUps:l}=Htt({scheduledDate:t}),c=()=>{a=!a,Tt.state.schedulingActive=a,i.style.display=a?"":Mt,e!=null&&e.scheduleMatchUps&&(e.scheduleMatchUps.style.display=a?Mt:"")},{replaceTableData:u,table:d,courtsCount:p}=pit({scheduledDate:t}),{updateScheduledDate:h}=mit({controlAnchor:n,matchUps:l,table:s,updateUnscheduledTable:o,updateScheduleTable:u,toggleUnscheduled:c,scheduledDate:t});e=git({table:d,unscheduledMatchUps:l,updateScheduleTable:u,toggleUnscheduled:c,schedulingActive:a,controlAnchor:r,scheduledDate:t,courtsCount:p,setDate:m=>{Tt.displayed.schedule_day=m,o({scheduledDate:m}),u({scheduledDate:m}),h&&h(m)}}).elements}const{SUBSTITUTION:uQ,PENALTY:dQ,REMOVE_PARTICIPANT:pQ,REPLACE_PARTICIPANT:hQ}=i3,{POLICY_TYPE_MATCHUP_ACTIONS:vit}=Iy,{ASSIGN_PARTICIPANT:RG}=KI,{TEAM:yit,DOUBLES:v1e}=pl,bit=_i.extractAttributes;function kE(t,e,i,n){var v;if(!e)return;const r=Array.from(document.querySelectorAll(".tippy-content"));if(r.length){r.forEach(y=>y.remove());return}const o=e.getRow().getData(),s=e.getColumn().getDefinition(),l=o.matchUpType===v1e,c=o.eventType===yit,{matchUpId:u,drawId:d}=o,p=s.field==="side1"&&1||s.field==="side2"&&2,{validActions:h}=at.matchUpActions({matchUpId:u,drawId:d,sideNumber:p,policyDefinitions:{[vit]:{substituteAfterCompleted:!0,substituteWithoutScore:!0}}}),f=(v=n==null?void 0:n.individualParticipant)==null?void 0:v.participantId,m={[RG]:{params:{data:o,sideNumber:p,callback:i,isTeam:c,isDoubles:l},text:"Assign participant",method:V$},[dQ]:{onClick:()=>console.log({data:o}),text:"Assess penalty"},[pQ]:{params:{data:o,sideNumber:p,callback:i,isTeam:c,isDoubles:l,clickedParticipantId:f},text:"Remove participant",method:Iit},[hQ]:{params:{data:o,sideNumber:p,callback:i,isTeam:c,isDoubles:l,clickedParticipantId:f},text:"Replace participant",method:V$},[uQ]:{params:{data:o,sideNumber:p,callback:i,isTeam:c,isDoubles:l,clickedParticipantId:f},method:V$,text:"Substitution"}},g=h.filter(({type:y})=>[RG,dQ,pQ,hQ,uQ].includes(y)).map(y=>{const b=m[y.type];return{onClick:()=>{Nt(b.method)?b.method({...b.params,action:y}):Nt(b.onClick)&&b.onClick()},text:b.text}});g.length===1?g[0].onClick():g.length>0&&(t!=null&&t.target)&&pc({items:g,target:t.target,config:{placement:gp}})}function Iit(t){const{action:e,callback:i,clickedParticipantId:n}=t;e.payload.participantId=n;const r=[{method:e.method,params:e.payload}];Wt({methods:r,callback:o=>Nt(i)&&i(o)})}function V$(t){var m;const{sideNumber:e,callback:i,isTeam:n,isDoubles:r,data:a}=t,o=t.action.availableParticipants,s=a.matchUp.matchUpType,l=a.matchUp.sides.find(g=>e===g.sideNumber),c=(m=l==null?void 0:l.participant)==null?void 0:m.individualParticipantIds,u=t.clickedParticipantId;QR({selectedParticipantIds:c,selectOnEnter:!0,selectionLimit:s===v1e&&!u?2:1,onSelection:g=>{if(g.participantId||g.selected){const v=[];(Array.isArray(g.selected)?g.selected.map(bit("participantId")):[g.participantId]).filter(Boolean).forEach(I=>{v.push({params:{...t.action.payload,substituteParticipantId:I,newParticipantId:I,existingParticipantId:u,participantId:I},method:t.action.method})}),Wt({methods:v,callback:I=>{Nt(i)&&i(I)}})}},action:{type:RG,participantsAvailable:o},title:n&&r?"Doubles: Select participants":void 0})}function y1e(t,e){return t.pctSpread&&!e.pctSpread?-1:e.pctSpread&&!t.pctSpread?1:!t.pctSpread&&!e.pctSpread?0:e.pctSpread-t.pctSpread}function b1e(t){var o;const e=t.getRow().getData();if(!((o=e.competitiveProfile)!=null&&o.competitiveness))return"";const{competitiveProfile:i,score:n}=e,r=document.createElement("span"),a={COMPETITIVE:"green",DECISIVE:"magenta",ROUTINE:"blue"};if(n){const{competitiveness:s}=i;r.style.color=a[s],r.style.fontSize="smaller",r.innerHTML=s}return r}function N9(t){const e=t.getRow().getData();if(!e.readyToScore)return;const i=e.matchUp.matchUpStatus==="WALKOVER",n=document.createElement("span");return n.classList.add("scoreCell"),e.score?(n.style="font-size: smaller",n.innerHTML=e.score):i?n.innerHTML="WO":(n.style="color: blue; font-size: smaller",n.innerHTML="Enter score"),n}function fQ(t){const e=document.createElement("div");return e.style="font-weight: bold",e.innerHTML=t.getValue(),e}function I1e(t){const{matchUpId:e,schedule:i,callback:n}=t;Wt({methods:[{params:{matchUpIds:[e],schedule:i},method:a9}],callback:o=>{o.success&&Nt(n)&&n()}})}function A9({pointerEvent:t,cell:e,matchUp:i,callback:n}){var p,h,f,m;const r=Array.from(document.querySelectorAll(".tippy-content"));if(r.length){r.forEach(g=>g.remove());return}const a=!(i!=null&&i.roundPosition)&&!(i!=null&&i.drawPositions),o=e&&t.target.getElementsByClassName("fa-ellipsis-vertical")[0],s=(e==null?void 0:e.getRow().getData())||i,l=()=>{Nt(n)&&n(s)},c=((p=i==null?void 0:i.schedule)==null?void 0:p.scheduledTime)||((h=i==null?void 0:i.schedule)==null?void 0:h.scheduledDate)||((f=i==null?void 0:i.schedule)==null?void 0:f.venueId)||((m=i==null?void 0:i.schedule)==null?void 0:m.courtId),d=[{onClick:()=>{const g={scheduledDate:"",scheduledTime:"",courtId:"",venueId:""},v=()=>{if(!e)return;e.getRow().update({...s,...g,courtName:"",venueName:""})};I1e({matchUpId:i.matchUpId,schedule:g,callback:v})},text:"Clear schedule",hide:!c},{onClick:l,text:"Schedule"},{onClick:l,text:"Start time"},{onClick:l,text:"End time"},{onClick:l,text:"Set referee"}];a&&d.push({onClick:()=>wit({...i,callback:l}),text:"Delete match",color:"red"}),pc({items:d,target:o||t.target,config:{placement:gp}})}function wit({drawId:t,structureId:e,matchUpId:i,callback:n}){Wt({methods:[{method:ETe,params:{matchUpIds:[i],removeIncomplete:!0,removeCompleted:!0,structureId:e,drawId:t}}],callback:o=>{o.success?Nt(n)&&n():console.log({postMutationError:o.error})}})}const mQ=t=>e=>{const i=document.createElement("div");return i.className="has-text-warning-dark",i.innerHTML="Select participant",(e.getValue().participantName&&Pw(t)(e,i))??i},jM=t=>({cell:e,event:i,...n})=>{kE(i,e,a=>{if(a.success){const o=e.getRow(),{drawId:s,matchUpId:l}=t,c=at.findMatchUp({drawId:s,matchUpId:l}).matchUp,u=o.getData().matchUp.collectionId,p=c.tieMatchUps.filter(f=>f.collectionId===u).map(f=>OU({...f,dualMatchUp:t})),h=e.getTable();h.updateData(p),h.redraw(!0)}},n)},MG=function(){let t,e={elapsed:1e5,held:void 0,touched:void 0,holdTime:800,holdAction:void 0,holdActions:{}};const i={};let n={};const r=(d,p)=>d.filter(h=>p.indexOf(h)!==-1).filter((h,f,m)=>m.indexOf(h)===f);e.reset=()=>(n={},e),e.register=(d,p,h,f)=>(typeof h=="function"&&(n[p]||(n[p]={},i[p]=[]),n[p][d]={fx:h,delay:f},i[p]=Object.keys(n[p])),e),e.deRegister=(d,p)=>(n[p]&&(delete n[p][d],i[p]=Object.keys(n[p])),e),e.call=(d,p,...h)=>{var f,m;return(m=(f=n==null?void 0:n[p])==null?void 0:f[d])==null?void 0:m.fx(...h)},e.trigger=(d,p,h,f)=>n[p][d].fx(h,f,p),e.list=()=>console.log(n);const a="ontouchstart"in document.documentElement?"touchstart":"click";document.addEventListener(a,d=>s({evt:d,evnt:"tap"})),document.addEventListener("change",d=>s({evt:d,evnt:"change"})),document.addEventListener("click",d=>s({evt:d,evnt:"click"})),document.addEventListener("mouseover",d=>s({evt:d,evnt:"mouseover",stopPropagation:!1})),document.addEventListener("mouseout",d=>s({evt:d,evnt:"mouseout",stopPropagation:!1})),document.addEventListener("keyup",d=>s({evt:d,evnt:"keyup",stopPropagation:!1}));let o=0;function s({evt:d,evnt:p,stopPropagation:h=!0}){h&&d.stopPropagation();const f={x:d.clientX,y:d.clientY,pageX:d.pageX,pageY:d.pageY};let m=Array.from(d.target.classList),g=m.length&&i[p]?r(m,i[p]):[];if(g.length){let v=new Date().getTime();e.elapsed=v-o,o=v,g.forEach(y=>{l({cls:y,evt:d,evnt:p,mouse:f})})}}function l({cls:d,evt:p,evnt:h,mouse:f}){let m=p.target;n[h][d].fx(m,f,h,p)}document.addEventListener("touchstart",d=>{e.touched=d.target,e.coords=[d.touches[0].clientX,d.touches[0].clientY],e.touched&&(t=setTimeout(function(){u()},e.holdTime))},!1),document.addEventListener("touchend",function(){c()},!1),document.addEventListener("touchmove",function(d){e.touched!==d.target&&c()},!1);function c(){clearTimeout(t)}function u(){typeof e.holdAction=="function"&&(e.held=e.touched,e.holdAction(e.held,e.coords))}return function(){let d=!1,p,h="";function f(){clearTimeout(p),d=!0,h!=="can-touch"&&(h="can-touch",document.documentElement.classList.add(h)),p=setTimeout(function(){d=!1},500)}function m(){!d&&h==="can-touch"&&(d=!1,h="",document.documentElement.classList.remove("can-touch"))}document.addEventListener("touchstart",f,!1),document.addEventListener("mouseover",m,!1)}(),e}(),Sit=""+new URL("completed-DD-jSIm6.png",import.meta.url).href;function w1e(t){return Object.assign({},...Object.keys(t).map(e=>({[e]:{id:t[e],element:document.getElementById(t[e])}})))}const Tit=function(){let t={};t.display=({muid:l,teams:c})=>{let u={scoreboard:"sbId"},{ids:d,html:p}=e({muid:l,teams:c});return cr({content:p,config:{maxWidth:450}}),Object.assign(d,u),w1e(d)};function e({muid:l,teams:c,round_name:u,match:d}){let p={root:"sb-root",actions:"sb-actions",favorite:"sb-favorite",scoring:"sb-scoring",delegate:"sb-delegate",docs:"sb-docs",clear:"sb-clear",cancel:"sb-cancel",accept:"sb-accept",p1action:"sb-p1action",p2action:"sb-p2action",p1scores:"sb-p1scores",p2scores:"sb-p2score",round_name:"sb-round-name",p1scores_e:"sb-p1scores-e",p2scores_e:"sb-p2scores-e",p1selector:"sb-p1selector",p2selector:"sb-p2selector",p1tiebreak:"sb-p1tiebreak",p2tiebreak:"sb-p2tiebreak",details:"sb-details"},h=i();Object.assign(p,h.ids);let f=`
         <div id="${p.root}" class="scoreboard noselect muid ${p.root}" muid='${l}'>
            <div class='scorebox'>
               <div class='info'>
                  <span class="info-text">
                     <span class="round_name" id='${p.round_name}'>${u||""}</span>
                  </span>
                  <div id='${p.favorite}' class='fav favoriteMatch' style='display: none'></div>
                  <div id='${p.scoring}' class='options' style='display: none'>-</div>
               </div>
               <div class='sbox'>
                  <div class='sbcol flexgrow'> 
                     <div class="opponent opponent0">
                        <div class="opponent-name">
                           <div class="name-detail">
                              ${o({team:c[0],index:0})}
                              ${o({team:c[0],index:1})}
                           </div>
                        </div>
                     </div>
               
                     <div class="opponent opponent1">
                        <div class="opponent-name">
                           <div class="name-detail">
                              ${o({team:c[1],index:0})}
                              ${o({team:c[1],index:1})}
                           </div>
                        </div>
                     </div>
                  </div>

                  <div class='sbcol'> 
                     <div class="opponent opponent0">
                        <div id="${p.p1scores}" class="opponent-scores"></div>
                        <div id="${p.p1selector}" class="score-selector"></div>
                        <div class="score-selector tbinput"> <input id="${p.p1tiebreak}"> </div>
                        <div id="${p.p1scores_e}" class="opponent-scores"></div>
                     </div>
               
                     <div class="opponent opponent1">
                        <div id="${p.p2scores}" class="opponent-scores"></div>
                        <div id="${p.p2selector}" class="score-selector"></div>
                        <div class="score-selector tbinput"> <input id="${p.p2tiebreak}"> </div>
                        <div id="${p.p2scores_e}" class="opponent-scores"></div>
                     </div>
                  </div>

                  <div class='sbcol'>
                     <div class="opponent opponent0">
                        <div id="${p.p1action}" class="score-action"></div>
                     </div>
                     <div class="opponent opponent1">
                        <div id="${p.p2action}" class="score-action"></div>
                     </div>
                  </div>

                  <div class='sbcol'>
                     <div class="opponent opponent0">&nbsp;</div>
                     <div class="opponent opponent1">&nbsp;</div>
                  </div>

               </div>
               <div class="info">
                  <span class="info-text"> <span id="${p.details}" class="court">${r(d)}</span> </span>
                  <div id='${p.delegate}' class='options' style='display: none'>&#x25B7;</div>
               </div>
            </div>

            ${h.html}

            <div id='${p.actions}' class="scoreboard-action">
               <div class="edit flexcol">
                  <div class="frame">
                     <div class="scoreboard-actions">
                        <button id='${p.cancel}' class='btn dismiss'>${Bo.tr("actions.cancel")}</button>
                        <button id='${p.clear}' class='btn dismiss'>${Bo.tr("clr")}</button>
                        <button id='${p.accept}' class='btn accept'>${Bo.tr("apt")}</button>
                     </div>
                  </div>
               </div>
            </div>

         </div>
      `;return{ids:p,html:f}}function i(){let l={edit_scoring:"sbcfg-edit",bestof:"sbcfg-bestof",setsto:"sbcfg-setsto",tiebreaksat:"sbcfg-tiebreasat",tiebreaksto:"sbcfg-tiebreaksto",finalset:"sbcfg-finalset",supertiebreakto:"sbcfg-supertbto",stb2:"sbcfg-stb2"},c=`
            <div id='${l.edit_scoring}' class="scoreboard-config scoreboard-action">
               <div class="edit configure sb_flexrow">
                  <div class='flexcol' style='width: 25%'>
                     <div style='text-align: right'>${Bo.tr("scoring_format.bestof")}</div>
                     <div style='text-align: right'>${Bo.tr("scoring_format.tbat")}</div>
                     <div style='text-align: right'>${Bo.tr("scoring_format.finalset")}</div>
                  </div>
                  <div class='flexcol' style='width: 25%'>
                     <div id="${l.bestof}" class="score-selector"></div>
                     <div id="${l.tiebreaksat}" class="score-selector"></div>
                     <div id="${l.finalset}" class="score-selector"></div>
                  </div>
                  <div class='flexcol' style='width: 25%'>
                     <div style='text-align: right'>${Bo.tr("scoring_format.setsto")}</div>
                     <div style='text-align: right'>${Bo.tr("scoring_format.tbto")}</div>
                     <div id='${l.stb2}' style='text-align: right'>${Bo.tr("scoring_format.superto")}</div>
                  </div>
                  <div class='flexcol' style='width: 25%'>
                     <div id="${l.setsto}" class="score-selector"></div>
                     <div id="${l.tiebreaksto}" class="score-selector"></div>
                     <div id="${l.supertiebreakto}" class="score-selector"></div>
                  </div>
               </div>
            </div>
      `;return{ids:l,html:c}}const n=(l,c)=>{let u=parseInt(l,10),d=Math.floor(u/3600),p=Math.floor((u-d*3600)/60),h=u-d*3600-p*60,f=!c||(c==null?void 0:c.display_seconds),m=!c||(c==null?void 0:c.pad_hours);return d<10&&m&&(d="0"+d),p<10&&(p="0"+p),h<10&&(h="0"+h),f?d+":"+p+":"+h:d+":"+p};function r(l){if(!l)return"";if(l.status)return l.status;if(!l.schedule)return"";let c=a(l.schedule);if(c)return`Duration ${c}`;let u=`${l.schedule.time_prefix||""}${l.schedule.time||""}`,d=`${l.schedule.court||""}${u?" / "+u:""}`;return l.winner_index===void 0?d:""}function a(l){if(!l.start||!l.end)return"";let c=s(l.end)-s(l.start);return n(c,{pad_hours:!1,display_seconds:!1})}function o({team:l,index:c=0}){var p,h;if(c===1)return"";const u=(p=l.person)==null?void 0:p.nationalityCode;return`
         <div class="team_player">
            <span class="pad">${u?(h=Qm.countryToFlag(u))==null?void 0:h.slice(0,4):""}</span>
            <span class="pad">${l.participantName}</span>
            <span class="pad"></span>
         </div>
      `}function s(l){let c=l.split(":");return c[0]*60*60+c[1]*60}return t}();function S1e(t,e){if(!t||!e)return;let i=Object.keys(t),n=Object.keys(e);for(let r of i)if(n.indexOf(r)>=0){let a=e[r],o=t[r];typeof a=="object"&&typeof o!="function"&&a.constructor!==Array?S1e(t[r],e[r]):e[r]=t[r]}}function T1e(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}function Uit(t){return t.length===1&&(t=Dit(t)),{left:function(e,i,n,r){for(n==null&&(n=0),r==null&&(r=e.length);n<r;){var a=n+r>>>1;t(e[a],i)<0?n=a+1:r=a}return n},right:function(e,i,n,r){for(n==null&&(n=0),r==null&&(r=e.length);n<r;){var a=n+r>>>1;t(e[a],i)>0?r=a:n=a+1}return n}}}function Dit(t){return function(e,i){return T1e(t(e),i)}}Uit(T1e);var Eit={value:function(){}};function U1e(){for(var t=0,e=arguments.length,i={},n;t<e;++t){if(!(n=arguments[t]+"")||n in i||/[\s.]/.test(n))throw new Error("illegal type: "+n);i[n]=[]}return new iA(i)}function iA(t){this._=t}function Cit(t,e){return t.trim().split(/^|\s+/).map(function(i){var n="",r=i.indexOf(".");if(r>=0&&(n=i.slice(r+1),i=i.slice(0,r)),i&&!e.hasOwnProperty(i))throw new Error("unknown type: "+i);return{type:i,name:n}})}iA.prototype=U1e.prototype={constructor:iA,on:function(t,e){var i=this._,n=Cit(t+"",i),r,a=-1,o=n.length;if(arguments.length<2){for(;++a<o;)if((r=(t=n[a]).type)&&(r=Pit(i[r],t.name)))return r;return}if(e!=null&&typeof e!="function")throw new Error("invalid callback: "+e);for(;++a<o;)if(r=(t=n[a]).type)i[r]=gQ(i[r],t.name,e);else if(e==null)for(r in i)i[r]=gQ(i[r],t.name,null);return this},copy:function(){var t={},e=this._;for(var i in e)t[i]=e[i].slice();return new iA(t)},call:function(t,e){if((r=arguments.length-2)>0)for(var i=new Array(r),n=0,r,a;n<r;++n)i[n]=arguments[n+2];if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(a=this._[t],n=0,r=a.length;n<r;++n)a[n].value.apply(e,i)},apply:function(t,e,i){if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(var n=this._[t],r=0,a=n.length;r<a;++r)n[r].value.apply(e,i)}};function Pit(t,e){for(var i=0,n=t.length,r;i<n;++i)if((r=t[i]).name===e)return r.value}function gQ(t,e,i){for(var n=0,r=t.length;n<r;++n)if(t[n].name===e){t[n]=Eit,t=t.slice(0,n).concat(t.slice(n+1));break}return i!=null&&t.push({name:e,value:i}),t}var NG="http://www.w3.org/1999/xhtml";const vQ={svg:"http://www.w3.org/2000/svg",xhtml:NG,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function JF(t){var e=t+="",i=e.indexOf(":");return i>=0&&(e=t.slice(0,i))!=="xmlns"&&(t=t.slice(i+1)),vQ.hasOwnProperty(e)?{space:vQ[e],local:t}:t}function Rit(t){return function(){var e=this.ownerDocument,i=this.namespaceURI;return i===NG&&e.documentElement.namespaceURI===NG?e.createElement(t):e.createElementNS(i,t)}}function Mit(t){return function(){return this.ownerDocument.createElementNS(t.space,t.local)}}function D1e(t){var e=JF(t);return(e.local?Mit:Rit)(e)}function Nit(){}function _9(t){return t==null?Nit:function(){return this.querySelector(t)}}function Ait(t){typeof t!="function"&&(t=_9(t));for(var e=this._groups,i=e.length,n=new Array(i),r=0;r<i;++r)for(var a=e[r],o=a.length,s=n[r]=new Array(o),l,c,u=0;u<o;++u)(l=a[u])&&(c=t.call(l,l.__data__,u,a))&&("__data__"in l&&(c.__data__=l.__data__),s[u]=c);return new Cd(n,this._parents)}function _it(){return[]}function E1e(t){return t==null?_it:function(){return this.querySelectorAll(t)}}function kit(t){typeof t!="function"&&(t=E1e(t));for(var e=this._groups,i=e.length,n=[],r=[],a=0;a<i;++a)for(var o=e[a],s=o.length,l,c=0;c<s;++c)(l=o[c])&&(n.push(t.call(l,l.__data__,c,o)),r.push(l));return new Cd(n,r)}function C1e(t){return function(){return this.matches(t)}}function xit(t){typeof t!="function"&&(t=C1e(t));for(var e=this._groups,i=e.length,n=new Array(i),r=0;r<i;++r)for(var a=e[r],o=a.length,s=n[r]=[],l,c=0;c<o;++c)(l=a[c])&&t.call(l,l.__data__,c,a)&&s.push(l);return new Cd(n,this._parents)}function P1e(t){return new Array(t.length)}function Oit(){return new Cd(this._enter||this._groups.map(P1e),this._parents)}function ik(t,e){this.ownerDocument=t.ownerDocument,this.namespaceURI=t.namespaceURI,this._next=null,this._parent=t,this.__data__=e}ik.prototype={constructor:ik,appendChild:function(t){return this._parent.insertBefore(t,this._next)},insertBefore:function(t,e){return this._parent.insertBefore(t,e)},querySelector:function(t){return this._parent.querySelector(t)},querySelectorAll:function(t){return this._parent.querySelectorAll(t)}};function Lit(t){return function(){return t}}var yQ="$";function Fit(t,e,i,n,r,a){for(var o=0,s,l=e.length,c=a.length;o<c;++o)(s=e[o])?(s.__data__=a[o],n[o]=s):i[o]=new ik(t,a[o]);for(;o<l;++o)(s=e[o])&&(r[o]=s)}function Bit(t,e,i,n,r,a,o){var s,l,c={},u=e.length,d=a.length,p=new Array(u),h;for(s=0;s<u;++s)(l=e[s])&&(p[s]=h=yQ+o.call(l,l.__data__,s,e),h in c?r[s]=l:c[h]=l);for(s=0;s<d;++s)h=yQ+o.call(t,a[s],s,a),(l=c[h])?(n[s]=l,l.__data__=a[s],c[h]=null):i[s]=new ik(t,a[s]);for(s=0;s<u;++s)(l=e[s])&&c[p[s]]===l&&(r[s]=l)}function $it(t,e){if(!t)return h=new Array(this.size()),c=-1,this.each(function(w){h[++c]=w}),h;var i=e?Bit:Fit,n=this._parents,r=this._groups;typeof t!="function"&&(t=Lit(t));for(var a=r.length,o=new Array(a),s=new Array(a),l=new Array(a),c=0;c<a;++c){var u=n[c],d=r[c],p=d.length,h=t.call(u,u&&u.__data__,c,n),f=h.length,m=s[c]=new Array(f),g=o[c]=new Array(f),v=l[c]=new Array(p);i(u,d,m,g,v,h,e);for(var y=0,b=0,I,T;y<f;++y)if(I=m[y]){for(y>=b&&(b=y+1);!(T=g[b])&&++b<f;);I._next=T||null}}return o=new Cd(o,n),o._enter=s,o._exit=l,o}function Vit(){return new Cd(this._exit||this._groups.map(P1e),this._parents)}function jit(t,e,i){var n=this.enter(),r=this,a=this.exit();return n=typeof t=="function"?t(n):n.append(t+""),e!=null&&(r=e(r)),i==null?a.remove():i(a),n&&r?n.merge(r).order():r}function Git(t){for(var e=this._groups,i=t._groups,n=e.length,r=i.length,a=Math.min(n,r),o=new Array(n),s=0;s<a;++s)for(var l=e[s],c=i[s],u=l.length,d=o[s]=new Array(u),p,h=0;h<u;++h)(p=l[h]||c[h])&&(d[h]=p);for(;s<n;++s)o[s]=e[s];return new Cd(o,this._parents)}function Hit(){for(var t=this._groups,e=-1,i=t.length;++e<i;)for(var n=t[e],r=n.length-1,a=n[r],o;--r>=0;)(o=n[r])&&(a&&o.compareDocumentPosition(a)^4&&a.parentNode.insertBefore(o,a),a=o);return this}function zit(t){t||(t=qit);function e(d,p){return d&&p?t(d.__data__,p.__data__):!d-!p}for(var i=this._groups,n=i.length,r=new Array(n),a=0;a<n;++a){for(var o=i[a],s=o.length,l=r[a]=new Array(s),c,u=0;u<s;++u)(c=o[u])&&(l[u]=c);l.sort(e)}return new Cd(r,this._parents).order()}function qit(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}function Wit(){var t=arguments[0];return arguments[0]=this,t.apply(null,arguments),this}function Kit(){var t=new Array(this.size()),e=-1;return this.each(function(){t[++e]=this}),t}function Yit(){for(var t=this._groups,e=0,i=t.length;e<i;++e)for(var n=t[e],r=0,a=n.length;r<a;++r){var o=n[r];if(o)return o}return null}function Zit(){var t=0;return this.each(function(){++t}),t}function Xit(){return!this.node()}function Jit(t){for(var e=this._groups,i=0,n=e.length;i<n;++i)for(var r=e[i],a=0,o=r.length,s;a<o;++a)(s=r[a])&&t.call(s,s.__data__,a,r);return this}function Qit(t){return function(){this.removeAttribute(t)}}function ent(t){return function(){this.removeAttributeNS(t.space,t.local)}}function tnt(t,e){return function(){this.setAttribute(t,e)}}function int(t,e){return function(){this.setAttributeNS(t.space,t.local,e)}}function nnt(t,e){return function(){var i=e.apply(this,arguments);i==null?this.removeAttribute(t):this.setAttribute(t,i)}}function rnt(t,e){return function(){var i=e.apply(this,arguments);i==null?this.removeAttributeNS(t.space,t.local):this.setAttributeNS(t.space,t.local,i)}}function ant(t,e){var i=JF(t);if(arguments.length<2){var n=this.node();return i.local?n.getAttributeNS(i.space,i.local):n.getAttribute(i)}return this.each((e==null?i.local?ent:Qit:typeof e=="function"?i.local?rnt:nnt:i.local?int:tnt)(i,e))}function R1e(t){return t.ownerDocument&&t.ownerDocument.defaultView||t.document&&t||t.defaultView}function ont(t){return function(){this.style.removeProperty(t)}}function snt(t,e,i){return function(){this.style.setProperty(t,e,i)}}function lnt(t,e,i){return function(){var n=e.apply(this,arguments);n==null?this.style.removeProperty(t):this.style.setProperty(t,n,i)}}function cnt(t,e,i){return arguments.length>1?this.each((e==null?ont:typeof e=="function"?lnt:snt)(t,e,i??"")):nT(this.node(),t)}function nT(t,e){return t.style.getPropertyValue(e)||R1e(t).getComputedStyle(t,null).getPropertyValue(e)}function unt(t){return function(){delete this[t]}}function dnt(t,e){return function(){this[t]=e}}function pnt(t,e){return function(){var i=e.apply(this,arguments);i==null?delete this[t]:this[t]=i}}function hnt(t,e){return arguments.length>1?this.each((e==null?unt:typeof e=="function"?pnt:dnt)(t,e)):this.node()[t]}function M1e(t){return t.trim().split(/^|\s+/)}function k9(t){return t.classList||new N1e(t)}function N1e(t){this._node=t,this._names=M1e(t.getAttribute("class")||"")}N1e.prototype={add:function(t){var e=this._names.indexOf(t);e<0&&(this._names.push(t),this._node.setAttribute("class",this._names.join(" ")))},remove:function(t){var e=this._names.indexOf(t);e>=0&&(this._names.splice(e,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(t){return this._names.indexOf(t)>=0}};function A1e(t,e){for(var i=k9(t),n=-1,r=e.length;++n<r;)i.add(e[n])}function _1e(t,e){for(var i=k9(t),n=-1,r=e.length;++n<r;)i.remove(e[n])}function fnt(t){return function(){A1e(this,t)}}function mnt(t){return function(){_1e(this,t)}}function gnt(t,e){return function(){(e.apply(this,arguments)?A1e:_1e)(this,t)}}function vnt(t,e){var i=M1e(t+"");if(arguments.length<2){for(var n=k9(this.node()),r=-1,a=i.length;++r<a;)if(!n.contains(i[r]))return!1;return!0}return this.each((typeof e=="function"?gnt:e?fnt:mnt)(i,e))}function ynt(){this.textContent=""}function bnt(t){return function(){this.textContent=t}}function Int(t){return function(){var e=t.apply(this,arguments);this.textContent=e??""}}function wnt(t){return arguments.length?this.each(t==null?ynt:(typeof t=="function"?Int:bnt)(t)):this.node().textContent}function Snt(){this.innerHTML=""}function Tnt(t){return function(){this.innerHTML=t}}function Unt(t){return function(){var e=t.apply(this,arguments);this.innerHTML=e??""}}function Dnt(t){return arguments.length?this.each(t==null?Snt:(typeof t=="function"?Unt:Tnt)(t)):this.node().innerHTML}function Ent(){this.nextSibling&&this.parentNode.appendChild(this)}function Cnt(){return this.each(Ent)}function Pnt(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function Rnt(){return this.each(Pnt)}function Mnt(t){var e=typeof t=="function"?t:D1e(t);return this.select(function(){return this.appendChild(e.apply(this,arguments))})}function Nnt(){return null}function Ant(t,e){var i=typeof t=="function"?t:D1e(t),n=e==null?Nnt:typeof e=="function"?e:_9(e);return this.select(function(){return this.insertBefore(i.apply(this,arguments),n.apply(this,arguments)||null)})}function _nt(){var t=this.parentNode;t&&t.removeChild(this)}function knt(){return this.each(_nt)}function xnt(){var t=this.cloneNode(!1),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function Ont(){var t=this.cloneNode(!0),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function Lnt(t){return this.select(t?Ont:xnt)}function Fnt(t){return arguments.length?this.property("__data__",t):this.node().__data__}var k1e={};if(typeof document<"u"){var Bnt=document.documentElement;"onmouseenter"in Bnt||(k1e={mouseenter:"mouseover",mouseleave:"mouseout"})}function $nt(t,e,i){return t=x1e(t,e,i),function(n){var r=n.relatedTarget;(!r||r!==this&&!(r.compareDocumentPosition(this)&8))&&t.call(this,n)}}function x1e(t,e,i){return function(n){try{t.call(this,this.__data__,e,i)}finally{}}}function Vnt(t){return t.trim().split(/^|\s+/).map(function(e){var i="",n=e.indexOf(".");return n>=0&&(i=e.slice(n+1),e=e.slice(0,n)),{type:e,name:i}})}function jnt(t){return function(){var e=this.__on;if(e){for(var i=0,n=-1,r=e.length,a;i<r;++i)a=e[i],(!t.type||a.type===t.type)&&a.name===t.name?this.removeEventListener(a.type,a.listener,a.capture):e[++n]=a;++n?e.length=n:delete this.__on}}}function Gnt(t,e,i){var n=k1e.hasOwnProperty(t.type)?$nt:x1e;return function(r,a,o){var s=this.__on,l,c=n(e,a,o);if(s){for(var u=0,d=s.length;u<d;++u)if((l=s[u]).type===t.type&&l.name===t.name){this.removeEventListener(l.type,l.listener,l.capture),this.addEventListener(l.type,l.listener=c,l.capture=i),l.value=e;return}}this.addEventListener(t.type,c,i),l={type:t.type,name:t.name,value:e,listener:c,capture:i},s?s.push(l):this.__on=[l]}}function Hnt(t,e,i){var n=Vnt(t+""),r,a=n.length,o;if(arguments.length<2){var s=this.node().__on;if(s){for(var l=0,c=s.length,u;l<c;++l)for(r=0,u=s[l];r<a;++r)if((o=n[r]).type===u.type&&o.name===u.name)return u.value}return}for(s=e?Gnt:jnt,i==null&&(i=!1),r=0;r<a;++r)this.each(s(n[r],e,i));return this}function O1e(t,e,i){var n=R1e(t),r=n.CustomEvent;typeof r=="function"?r=new r(e,i):(r=n.document.createEvent("Event"),i?(r.initEvent(e,i.bubbles,i.cancelable),r.detail=i.detail):r.initEvent(e,!1,!1)),t.dispatchEvent(r)}function znt(t,e){return function(){return O1e(this,t,e)}}function qnt(t,e){return function(){return O1e(this,t,e.apply(this,arguments))}}function Wnt(t,e){return this.each((typeof e=="function"?qnt:znt)(t,e))}var L1e=[null];function Cd(t,e){this._groups=t,this._parents=e}function eM(){return new Cd([[document.documentElement]],L1e)}Cd.prototype=eM.prototype={constructor:Cd,select:Ait,selectAll:kit,filter:xit,data:$it,enter:Oit,exit:Vit,join:jit,merge:Git,order:Hit,sort:zit,call:Wit,nodes:Kit,node:Yit,size:Zit,empty:Xit,each:Jit,attr:ant,style:cnt,property:hnt,classed:vnt,text:wnt,html:Dnt,raise:Cnt,lower:Rnt,append:Mnt,insert:Ant,remove:knt,clone:Lnt,datum:Fnt,on:Hnt,dispatch:Wnt};function Knt(t){return typeof t=="string"?new Cd([[document.querySelector(t)]],[document.documentElement]):new Cd([[t]],L1e)}function x9(t,e,i){t.prototype=e.prototype=i,i.constructor=t}function F1e(t,e){var i=Object.create(t.prototype);for(var n in e)i[n]=e[n];return i}function tM(){}var xE=.7,nk=1/xE,z0="\\s*([+-]?\\d+)\\s*",OE="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)\\s*",wf="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)%\\s*",Ynt=/^#([0-9a-f]{3,8})$/,Znt=new RegExp("^rgb\\("+[z0,z0,z0]+"\\)$"),Xnt=new RegExp("^rgb\\("+[wf,wf,wf]+"\\)$"),Jnt=new RegExp("^rgba\\("+[z0,z0,z0,OE]+"\\)$"),Qnt=new RegExp("^rgba\\("+[wf,wf,wf,OE]+"\\)$"),ert=new RegExp("^hsl\\("+[OE,wf,wf]+"\\)$"),trt=new RegExp("^hsla\\("+[OE,wf,wf,OE]+"\\)$"),bQ={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};x9(tM,LE,{copy:function(t){return Object.assign(new this.constructor,this,t)},displayable:function(){return this.rgb().displayable()},hex:IQ,formatHex:IQ,formatHsl:irt,formatRgb:wQ,toString:wQ});function IQ(){return this.rgb().formatHex()}function irt(){return B1e(this).formatHsl()}function wQ(){return this.rgb().formatRgb()}function LE(t){var e,i;return t=(t+"").trim().toLowerCase(),(e=Ynt.exec(t))?(i=e[1].length,e=parseInt(e[1],16),i===6?SQ(e):i===3?new cd(e>>8&15|e>>4&240,e>>4&15|e&240,(e&15)<<4|e&15,1):i===8?GM(e>>24&255,e>>16&255,e>>8&255,(e&255)/255):i===4?GM(e>>12&15|e>>8&240,e>>8&15|e>>4&240,e>>4&15|e&240,((e&15)<<4|e&15)/255):null):(e=Znt.exec(t))?new cd(e[1],e[2],e[3],1):(e=Xnt.exec(t))?new cd(e[1]*255/100,e[2]*255/100,e[3]*255/100,1):(e=Jnt.exec(t))?GM(e[1],e[2],e[3],e[4]):(e=Qnt.exec(t))?GM(e[1]*255/100,e[2]*255/100,e[3]*255/100,e[4]):(e=ert.exec(t))?DQ(e[1],e[2]/100,e[3]/100,1):(e=trt.exec(t))?DQ(e[1],e[2]/100,e[3]/100,e[4]):bQ.hasOwnProperty(t)?SQ(bQ[t]):t==="transparent"?new cd(NaN,NaN,NaN,0):null}function SQ(t){return new cd(t>>16&255,t>>8&255,t&255,1)}function GM(t,e,i,n){return n<=0&&(t=e=i=NaN),new cd(t,e,i,n)}function nrt(t){return t instanceof tM||(t=LE(t)),t?(t=t.rgb(),new cd(t.r,t.g,t.b,t.opacity)):new cd}function AG(t,e,i,n){return arguments.length===1?nrt(t):new cd(t,e,i,n??1)}function cd(t,e,i,n){this.r=+t,this.g=+e,this.b=+i,this.opacity=+n}x9(cd,AG,F1e(tM,{brighter:function(t){return t=t==null?nk:Math.pow(nk,t),new cd(this.r*t,this.g*t,this.b*t,this.opacity)},darker:function(t){return t=t==null?xE:Math.pow(xE,t),new cd(this.r*t,this.g*t,this.b*t,this.opacity)},rgb:function(){return this},displayable:function(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:TQ,formatHex:TQ,formatRgb:UQ,toString:UQ}));function TQ(){return"#"+j$(this.r)+j$(this.g)+j$(this.b)}function UQ(){var t=this.opacity;return t=isNaN(t)?1:Math.max(0,Math.min(1,t)),(t===1?"rgb(":"rgba(")+Math.max(0,Math.min(255,Math.round(this.r)||0))+", "+Math.max(0,Math.min(255,Math.round(this.g)||0))+", "+Math.max(0,Math.min(255,Math.round(this.b)||0))+(t===1?")":", "+t+")")}function j$(t){return t=Math.max(0,Math.min(255,Math.round(t)||0)),(t<16?"0":"")+t.toString(16)}function DQ(t,e,i,n){return n<=0?t=e=i=NaN:i<=0||i>=1?t=e=NaN:e<=0&&(t=NaN),new af(t,e,i,n)}function B1e(t){if(t instanceof af)return new af(t.h,t.s,t.l,t.opacity);if(t instanceof tM||(t=LE(t)),!t)return new af;if(t instanceof af)return t;t=t.rgb();var e=t.r/255,i=t.g/255,n=t.b/255,r=Math.min(e,i,n),a=Math.max(e,i,n),o=NaN,s=a-r,l=(a+r)/2;return s?(e===a?o=(i-n)/s+(i<n)*6:i===a?o=(n-e)/s+2:o=(e-i)/s+4,s/=l<.5?a+r:2-a-r,o*=60):s=l>0&&l<1?0:o,new af(o,s,l,t.opacity)}function rrt(t,e,i,n){return arguments.length===1?B1e(t):new af(t,e,i,n??1)}function af(t,e,i,n){this.h=+t,this.s=+e,this.l=+i,this.opacity=+n}x9(af,rrt,F1e(tM,{brighter:function(t){return t=t==null?nk:Math.pow(nk,t),new af(this.h,this.s,this.l*t,this.opacity)},darker:function(t){return t=t==null?xE:Math.pow(xE,t),new af(this.h,this.s,this.l*t,this.opacity)},rgb:function(){var t=this.h%360+(this.h<0)*360,e=isNaN(t)||isNaN(this.s)?0:this.s,i=this.l,n=i+(i<.5?i:1-i)*e,r=2*i-n;return new cd(G$(t>=240?t-240:t+120,r,n),G$(t,r,n),G$(t<120?t+240:t-120,r,n),this.opacity)},displayable:function(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl:function(){var t=this.opacity;return t=isNaN(t)?1:Math.max(0,Math.min(1,t)),(t===1?"hsl(":"hsla(")+(this.h||0)+", "+(this.s||0)*100+"%, "+(this.l||0)*100+"%"+(t===1?")":", "+t+")")}}));function G$(t,e,i){return(t<60?e+(i-e)*t/60:t<180?i:t<240?e+(i-e)*(240-t)/60:e)*255}function $1e(t){return function(){return t}}function art(t,e){return function(i){return t+i*e}}function ort(t,e,i){return t=Math.pow(t,i),e=Math.pow(e,i)-t,i=1/i,function(n){return Math.pow(t+n*e,i)}}function srt(t){return(t=+t)==1?V1e:function(e,i){return i-e?ort(e,i,t):$1e(isNaN(e)?i:e)}}function V1e(t,e){var i=e-t;return i?art(t,i):$1e(isNaN(t)?e:t)}const EQ=function t(e){var i=srt(e);function n(r,a){var o=i((r=AG(r)).r,(a=AG(a)).r),s=i(r.g,a.g),l=i(r.b,a.b),c=V1e(r.opacity,a.opacity);return function(u){return r.r=o(u),r.g=s(u),r.b=l(u),r.opacity=c(u),r+""}}return n.gamma=t,n}(1);function gv(t,e){return t=+t,e=+e,function(i){return t*(1-i)+e*i}}var _G=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,H$=new RegExp(_G.source,"g");function lrt(t){return function(){return t}}function crt(t){return function(e){return t(e)+""}}function urt(t,e){var i=_G.lastIndex=H$.lastIndex=0,n,r,a,o=-1,s=[],l=[];for(t=t+"",e=e+"";(n=_G.exec(t))&&(r=H$.exec(e));)(a=r.index)>i&&(a=e.slice(i,a),s[o]?s[o]+=a:s[++o]=a),(n=n[0])===(r=r[0])?s[o]?s[o]+=r:s[++o]=r:(s[++o]=null,l.push({i:o,x:gv(n,r)})),i=H$.lastIndex;return i<e.length&&(a=e.slice(i),s[o]?s[o]+=a:s[++o]=a),s.length<2?l[0]?crt(l[0].x):lrt(e):(e=l.length,function(c){for(var u=0,d;u<e;++u)s[(d=l[u]).i]=d.x(c);return s.join("")})}var CQ=180/Math.PI,kG={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function j1e(t,e,i,n,r,a){var o,s,l;return(o=Math.sqrt(t*t+e*e))&&(t/=o,e/=o),(l=t*i+e*n)&&(i-=t*l,n-=e*l),(s=Math.sqrt(i*i+n*n))&&(i/=s,n/=s,l/=s),t*n<e*i&&(t=-t,e=-e,l=-l,o=-o),{translateX:r,translateY:a,rotate:Math.atan2(e,t)*CQ,skewX:Math.atan(l)*CQ,scaleX:o,scaleY:s}}var o1,z$,PQ,HM;function drt(t){return t==="none"?kG:(o1||(o1=document.createElement("DIV"),z$=document.documentElement,PQ=document.defaultView),o1.style.transform=t,t=PQ.getComputedStyle(z$.appendChild(o1),null).getPropertyValue("transform"),z$.removeChild(o1),t=t.slice(7,-1).split(","),j1e(+t[0],+t[1],+t[2],+t[3],+t[4],+t[5]))}function prt(t){return t==null||(HM||(HM=document.createElementNS("http://www.w3.org/2000/svg","g")),HM.setAttribute("transform",t),!(t=HM.transform.baseVal.consolidate()))?kG:(t=t.matrix,j1e(t.a,t.b,t.c,t.d,t.e,t.f))}function G1e(t,e,i,n){function r(c){return c.length?c.pop()+" ":""}function a(c,u,d,p,h,f){if(c!==d||u!==p){var m=h.push("translate(",null,e,null,i);f.push({i:m-4,x:gv(c,d)},{i:m-2,x:gv(u,p)})}else(d||p)&&h.push("translate("+d+e+p+i)}function o(c,u,d,p){c!==u?(c-u>180?u+=360:u-c>180&&(c+=360),p.push({i:d.push(r(d)+"rotate(",null,n)-2,x:gv(c,u)})):u&&d.push(r(d)+"rotate("+u+n)}function s(c,u,d,p){c!==u?p.push({i:d.push(r(d)+"skewX(",null,n)-2,x:gv(c,u)}):u&&d.push(r(d)+"skewX("+u+n)}function l(c,u,d,p,h,f){if(c!==d||u!==p){var m=h.push(r(h)+"scale(",null,",",null,")");f.push({i:m-4,x:gv(c,d)},{i:m-2,x:gv(u,p)})}else(d!==1||p!==1)&&h.push(r(h)+"scale("+d+","+p+")")}return function(c,u){var d=[],p=[];return c=t(c),u=t(u),a(c.translateX,c.translateY,u.translateX,u.translateY,d,p),o(c.rotate,u.rotate,d,p),s(c.skewX,u.skewX,d,p),l(c.scaleX,c.scaleY,u.scaleX,u.scaleY,d,p),c=u=null,function(h){for(var f=-1,m=p.length,g;++f<m;)d[(g=p[f]).i]=g.x(h);return d.join("")}}}var hrt=G1e(drt,"px, ","px)","deg)"),frt=G1e(prt,", ",")",")"),rT=0,T1=0,s1=0,H1e=1e3,rk,U1,ak=0,wI=0,QF=0,FE=typeof performance=="object"&&performance.now?performance:Date,z1e=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(t){setTimeout(t,17)};function eB(){return wI||(z1e(mrt),wI=FE.now()+QF)}function mrt(){wI=0}function ok(){this._call=this._time=this._next=null}ok.prototype=q1e.prototype={constructor:ok,restart:function(t,e,i){if(typeof t!="function")throw new TypeError("callback is not a function");i=(i==null?eB():+i)+(e==null?0:+e),!this._next&&U1!==this&&(U1?U1._next=this:rk=this,U1=this),this._call=t,this._time=i,xG()},stop:function(){this._call&&(this._call=null,this._time=1/0,xG())}};function q1e(t,e,i){var n=new ok;return n.restart(t,e,i),n}function grt(){eB(),++rT;for(var t=rk,e;t;)(e=wI-t._time)>=0&&t._call.call(null,e),t=t._next;--rT}function RQ(){wI=(ak=FE.now())+QF,rT=T1=0;try{grt()}finally{rT=0,yrt(),wI=0}}function vrt(){var t=FE.now(),e=t-ak;e>H1e&&(QF-=e,ak=t)}function yrt(){for(var t,e=rk,i,n=1/0;e;)e._call?(n>e._time&&(n=e._time),t=e,e=e._next):(i=e._next,e._next=null,e=t?t._next=i:rk=i);U1=t,xG(n)}function xG(t){if(!rT){T1&&(T1=clearTimeout(T1));var e=t-wI;e>24?(t<1/0&&(T1=setTimeout(RQ,t-FE.now()-QF)),s1&&(s1=clearInterval(s1))):(s1||(ak=FE.now(),s1=setInterval(vrt,H1e)),rT=1,z1e(RQ))}}function MQ(t,e,i){var n=new ok;return e=e==null?0:+e,n.restart(function(r){n.stop(),t(r+e)},e,i),n}var brt=U1e("start","end","cancel","interrupt"),Irt=[],W1e=0,NQ=1,OG=2,nA=3,AQ=4,LG=5,rA=6;function tB(t,e,i,n,r,a){var o=t.__transition;if(!o)t.__transition={};else if(i in o)return;wrt(t,i,{name:e,index:n,group:r,on:brt,tween:Irt,time:a.time,delay:a.delay,duration:a.duration,ease:a.ease,timer:null,state:W1e})}function O9(t,e){var i=Bh(t,e);if(i.state>W1e)throw new Error("too late; already scheduled");return i}function zg(t,e){var i=Bh(t,e);if(i.state>nA)throw new Error("too late; already running");return i}function Bh(t,e){var i=t.__transition;if(!i||!(i=i[e]))throw new Error("transition not found");return i}function wrt(t,e,i){var n=t.__transition,r;n[e]=i,i.timer=q1e(a,0,i.time);function a(c){i.state=NQ,i.timer.restart(o,i.delay,i.time),i.delay<=c&&o(c-i.delay)}function o(c){var u,d,p,h;if(i.state!==NQ)return l();for(u in n)if(h=n[u],h.name===i.name){if(h.state===nA)return MQ(o);h.state===AQ?(h.state=rA,h.timer.stop(),h.on.call("interrupt",t,t.__data__,h.index,h.group),delete n[u]):+u<e&&(h.state=rA,h.timer.stop(),h.on.call("cancel",t,t.__data__,h.index,h.group),delete n[u])}if(MQ(function(){i.state===nA&&(i.state=AQ,i.timer.restart(s,i.delay,i.time),s(c))}),i.state=OG,i.on.call("start",t,t.__data__,i.index,i.group),i.state===OG){for(i.state=nA,r=new Array(p=i.tween.length),u=0,d=-1;u<p;++u)(h=i.tween[u].value.call(t,t.__data__,i.index,i.group))&&(r[++d]=h);r.length=d+1}}function s(c){for(var u=c<i.duration?i.ease.call(null,c/i.duration):(i.timer.restart(l),i.state=LG,1),d=-1,p=r.length;++d<p;)r[d].call(t,u);i.state===LG&&(i.on.call("end",t,t.__data__,i.index,i.group),l())}function l(){i.state=rA,i.timer.stop(),delete n[e];for(var c in n)return;delete t.__transition}}function Srt(t,e){var i=t.__transition,n,r,a=!0,o;if(i){e=e==null?null:e+"";for(o in i){if((n=i[o]).name!==e){a=!1;continue}r=n.state>OG&&n.state<LG,n.state=rA,n.timer.stop(),n.on.call(r?"interrupt":"cancel",t,t.__data__,n.index,n.group),delete i[o]}a&&delete t.__transition}}function Trt(t){return this.each(function(){Srt(this,t)})}function Urt(t,e){var i,n;return function(){var r=zg(this,t),a=r.tween;if(a!==i){n=i=a;for(var o=0,s=n.length;o<s;++o)if(n[o].name===e){n=n.slice(),n.splice(o,1);break}}r.tween=n}}function Drt(t,e,i){var n,r;if(typeof i!="function")throw new Error;return function(){var a=zg(this,t),o=a.tween;if(o!==n){r=(n=o).slice();for(var s={name:e,value:i},l=0,c=r.length;l<c;++l)if(r[l].name===e){r[l]=s;break}l===c&&r.push(s)}a.tween=r}}function Ert(t,e){var i=this._id;if(t+="",arguments.length<2){for(var n=Bh(this.node(),i).tween,r=0,a=n.length,o;r<a;++r)if((o=n[r]).name===t)return o.value;return null}return this.each((e==null?Urt:Drt)(i,t,e))}function L9(t,e,i){var n=t._id;return t.each(function(){var r=zg(this,n);(r.value||(r.value={}))[e]=i.apply(this,arguments)}),function(r){return Bh(r,n).value[e]}}function K1e(t,e){var i;return(typeof e=="number"?gv:e instanceof LE?EQ:(i=LE(e))?(e=i,EQ):urt)(t,e)}function Crt(t){return function(){this.removeAttribute(t)}}function Prt(t){return function(){this.removeAttributeNS(t.space,t.local)}}function Rrt(t,e,i){var n,r=i+"",a;return function(){var o=this.getAttribute(t);return o===r?null:o===n?a:a=e(n=o,i)}}function Mrt(t,e,i){var n,r=i+"",a;return function(){var o=this.getAttributeNS(t.space,t.local);return o===r?null:o===n?a:a=e(n=o,i)}}function Nrt(t,e,i){var n,r,a;return function(){var o,s=i(this),l;return s==null?void this.removeAttribute(t):(o=this.getAttribute(t),l=s+"",o===l?null:o===n&&l===r?a:(r=l,a=e(n=o,s)))}}function Art(t,e,i){var n,r,a;return function(){var o,s=i(this),l;return s==null?void this.removeAttributeNS(t.space,t.local):(o=this.getAttributeNS(t.space,t.local),l=s+"",o===l?null:o===n&&l===r?a:(r=l,a=e(n=o,s)))}}function _rt(t,e){var i=JF(t),n=i==="transform"?frt:K1e;return this.attrTween(t,typeof e=="function"?(i.local?Art:Nrt)(i,n,L9(this,"attr."+t,e)):e==null?(i.local?Prt:Crt)(i):(i.local?Mrt:Rrt)(i,n,e))}function krt(t,e){return function(i){this.setAttribute(t,e.call(this,i))}}function xrt(t,e){return function(i){this.setAttributeNS(t.space,t.local,e.call(this,i))}}function Ort(t,e){var i,n;function r(){var a=e.apply(this,arguments);return a!==n&&(i=(n=a)&&xrt(t,a)),i}return r._value=e,r}function Lrt(t,e){var i,n;function r(){var a=e.apply(this,arguments);return a!==n&&(i=(n=a)&&krt(t,a)),i}return r._value=e,r}function Frt(t,e){var i="attr."+t;if(arguments.length<2)return(i=this.tween(i))&&i._value;if(e==null)return this.tween(i,null);if(typeof e!="function")throw new Error;var n=JF(t);return this.tween(i,(n.local?Ort:Lrt)(n,e))}function Brt(t,e){return function(){O9(this,t).delay=+e.apply(this,arguments)}}function $rt(t,e){return e=+e,function(){O9(this,t).delay=e}}function Vrt(t){var e=this._id;return arguments.length?this.each((typeof t=="function"?Brt:$rt)(e,t)):Bh(this.node(),e).delay}function jrt(t,e){return function(){zg(this,t).duration=+e.apply(this,arguments)}}function Grt(t,e){return e=+e,function(){zg(this,t).duration=e}}function Hrt(t){var e=this._id;return arguments.length?this.each((typeof t=="function"?jrt:Grt)(e,t)):Bh(this.node(),e).duration}function zrt(t,e){if(typeof e!="function")throw new Error;return function(){zg(this,t).ease=e}}function qrt(t){var e=this._id;return arguments.length?this.each(zrt(e,t)):Bh(this.node(),e).ease}function Wrt(t){typeof t!="function"&&(t=C1e(t));for(var e=this._groups,i=e.length,n=new Array(i),r=0;r<i;++r)for(var a=e[r],o=a.length,s=n[r]=[],l,c=0;c<o;++c)(l=a[c])&&t.call(l,l.__data__,c,a)&&s.push(l);return new gg(n,this._parents,this._name,this._id)}function Krt(t){if(t._id!==this._id)throw new Error;for(var e=this._groups,i=t._groups,n=e.length,r=i.length,a=Math.min(n,r),o=new Array(n),s=0;s<a;++s)for(var l=e[s],c=i[s],u=l.length,d=o[s]=new Array(u),p,h=0;h<u;++h)(p=l[h]||c[h])&&(d[h]=p);for(;s<n;++s)o[s]=e[s];return new gg(o,this._parents,this._name,this._id)}function Yrt(t){return(t+"").trim().split(/^|\s+/).every(function(e){var i=e.indexOf(".");return i>=0&&(e=e.slice(0,i)),!e||e==="start"})}function Zrt(t,e,i){var n,r,a=Yrt(e)?O9:zg;return function(){var o=a(this,t),s=o.on;s!==n&&(r=(n=s).copy()).on(e,i),o.on=r}}function Xrt(t,e){var i=this._id;return arguments.length<2?Bh(this.node(),i).on.on(t):this.each(Zrt(i,t,e))}function Jrt(t){return function(){var e=this.parentNode;for(var i in this.__transition)if(+i!==t)return;e&&e.removeChild(this)}}function Qrt(){return this.on("end.remove",Jrt(this._id))}function eat(t){var e=this._name,i=this._id;typeof t!="function"&&(t=_9(t));for(var n=this._groups,r=n.length,a=new Array(r),o=0;o<r;++o)for(var s=n[o],l=s.length,c=a[o]=new Array(l),u,d,p=0;p<l;++p)(u=s[p])&&(d=t.call(u,u.__data__,p,s))&&("__data__"in u&&(d.__data__=u.__data__),c[p]=d,tB(c[p],e,i,p,c,Bh(u,i)));return new gg(a,this._parents,e,i)}function tat(t){var e=this._name,i=this._id;typeof t!="function"&&(t=E1e(t));for(var n=this._groups,r=n.length,a=[],o=[],s=0;s<r;++s)for(var l=n[s],c=l.length,u,d=0;d<c;++d)if(u=l[d]){for(var p=t.call(u,u.__data__,d,l),h,f=Bh(u,i),m=0,g=p.length;m<g;++m)(h=p[m])&&tB(h,e,i,m,p,f);a.push(p),o.push(u)}return new gg(a,o,e,i)}var iat=eM.prototype.constructor;function nat(){return new iat(this._groups,this._parents)}function rat(t,e){var i,n,r;return function(){var a=nT(this,t),o=(this.style.removeProperty(t),nT(this,t));return a===o?null:a===i&&o===n?r:r=e(i=a,n=o)}}function Y1e(t){return function(){this.style.removeProperty(t)}}function aat(t,e,i){var n,r=i+"",a;return function(){var o=nT(this,t);return o===r?null:o===n?a:a=e(n=o,i)}}function oat(t,e,i){var n,r,a;return function(){var o=nT(this,t),s=i(this),l=s+"";return s==null&&(l=s=(this.style.removeProperty(t),nT(this,t))),o===l?null:o===n&&l===r?a:(r=l,a=e(n=o,s))}}function sat(t,e){var i,n,r,a="style."+e,o="end."+a,s;return function(){var l=zg(this,t),c=l.on,u=l.value[a]==null?s||(s=Y1e(e)):void 0;(c!==i||r!==u)&&(n=(i=c).copy()).on(o,r=u),l.on=n}}function lat(t,e,i){var n=(t+="")=="transform"?hrt:K1e;return e==null?this.styleTween(t,rat(t,n)).on("end.style."+t,Y1e(t)):typeof e=="function"?this.styleTween(t,oat(t,n,L9(this,"style."+t,e))).each(sat(this._id,t)):this.styleTween(t,aat(t,n,e),i).on("end.style."+t,null)}function cat(t,e,i){return function(n){this.style.setProperty(t,e.call(this,n),i)}}function uat(t,e,i){var n,r;function a(){var o=e.apply(this,arguments);return o!==r&&(n=(r=o)&&cat(t,o,i)),n}return a._value=e,a}function dat(t,e,i){var n="style."+(t+="");if(arguments.length<2)return(n=this.tween(n))&&n._value;if(e==null)return this.tween(n,null);if(typeof e!="function")throw new Error;return this.tween(n,uat(t,e,i??""))}function pat(t){return function(){this.textContent=t}}function hat(t){return function(){var e=t(this);this.textContent=e??""}}function fat(t){return this.tween("text",typeof t=="function"?hat(L9(this,"text",t)):pat(t==null?"":t+""))}function mat(t){return function(e){this.textContent=t.call(this,e)}}function gat(t){var e,i;function n(){var r=t.apply(this,arguments);return r!==i&&(e=(i=r)&&mat(r)),e}return n._value=t,n}function vat(t){var e="text";if(arguments.length<1)return(e=this.tween(e))&&e._value;if(t==null)return this.tween(e,null);if(typeof t!="function")throw new Error;return this.tween(e,gat(t))}function yat(){for(var t=this._name,e=this._id,i=Z1e(),n=this._groups,r=n.length,a=0;a<r;++a)for(var o=n[a],s=o.length,l,c=0;c<s;++c)if(l=o[c]){var u=Bh(l,e);tB(l,t,i,c,o,{time:u.time+u.delay+u.duration,delay:0,duration:u.duration,ease:u.ease})}return new gg(n,this._parents,t,i)}function bat(){var t,e,i=this,n=i._id,r=i.size();return new Promise(function(a,o){var s={value:o},l={value:function(){--r===0&&a()}};i.each(function(){var c=zg(this,n),u=c.on;u!==t&&(e=(t=u).copy(),e._.cancel.push(s),e._.interrupt.push(s),e._.end.push(l)),c.on=e})})}var Iat=0;function gg(t,e,i,n){this._groups=t,this._parents=e,this._name=i,this._id=n}function Z1e(){return++Iat}var s0=eM.prototype;gg.prototype={constructor:gg,select:eat,selectAll:tat,filter:Wrt,merge:Krt,selection:nat,transition:yat,call:s0.call,nodes:s0.nodes,node:s0.node,size:s0.size,empty:s0.empty,each:s0.each,on:Xrt,attr:_rt,attrTween:Frt,style:lat,styleTween:dat,text:fat,textTween:vat,remove:Qrt,tween:Ert,delay:Vrt,duration:Hrt,ease:qrt,end:bat};function wat(t){return((t*=2)<=1?t*t*t:(t-=2)*t*t+2)/2}var FG={time:null,delay:0,duration:250,ease:wat};function Sat(t,e){for(var i;!(i=t.__transition)||!(i=i[e]);)if(!(t=t.parentNode))return FG.time=eB(),FG;return i}function Tat(t){var e,i;t instanceof gg?(e=t._id,t=t._name):(e=Z1e(),(i=FG).time=eB(),t=t==null?null:t+"");for(var n=this._groups,r=n.length,a=0;a<r;++a)for(var o=n[a],s=o.length,l,c=0;c<s;++c)(l=o[c])&&tB(l,t,e,c,o,i||Sat(l,e));return new gg(n,this._parents,t,e)}eM.prototype.interrupt=Trt;eM.prototype.transition=Tat;var Vd="$";function sk(){}sk.prototype=X1e.prototype={constructor:sk,has:function(t){return Vd+t in this},get:function(t){return this[Vd+t]},set:function(t,e){return this[Vd+t]=e,this},remove:function(t){var e=Vd+t;return e in this&&delete this[e]},clear:function(){for(var t in this)t[0]===Vd&&delete this[t]},keys:function(){var t=[];for(var e in this)e[0]===Vd&&t.push(e.slice(1));return t},values:function(){var t=[];for(var e in this)e[0]===Vd&&t.push(this[e]);return t},entries:function(){var t=[];for(var e in this)e[0]===Vd&&t.push({key:e.slice(1),value:this[e]});return t},size:function(){var t=0;for(var e in this)e[0]===Vd&&++t;return t},empty:function(){for(var t in this)if(t[0]===Vd)return!1;return!0},each:function(t){for(var e in this)e[0]===Vd&&t(this[e],e.slice(1),this)}};function X1e(t,e){var i=new sk;if(t instanceof sk)t.each(function(s,l){i.set(l,s)});else if(Array.isArray(t)){var n=-1,r=t.length,a;if(e==null)for(;++n<r;)i.set(n,t[n]);else for(;++n<r;)i.set(e(a=t[n],n,t),a)}else if(t)for(var o in t)i.set(o,t[o]);return i}function _Q(){}var ib=X1e.prototype;_Q.prototype={constructor:_Q,has:ib.has,add:function(t){return t+="",this[Vd+t]=t,this},remove:ib.remove,clear:ib.clear,values:ib.keys,size:ib.size,empty:ib.empty,each:ib.each};function LU(){return Math.random()}(function t(e){function i(n,r){return n=n==null?0:+n,r=r==null?1:+r,arguments.length===1?(r=n,n=0):r-=n,function(){return e()*r+n}}return i.source=t,i})(LU);const Uat=function t(e){function i(n,r){var a,o;return n=n==null?0:+n,r=r==null?1:+r,function(){var s;if(a!=null)s=a,a=null;else do a=e()*2-1,s=e()*2-1,o=a*a+s*s;while(!o||o>1);return n+r*s*Math.sqrt(-2*Math.log(o)/o)}}return i.source=t,i}(LU);(function t(e){function i(){var n=Uat.source(e).apply(this,arguments);return function(){return Math.exp(n())}}return i.source=t,i})(LU);const Dat=function t(e){function i(n){return function(){for(var r=0,a=0;a<n;++a)r+=e();return r}}return i.source=t,i}(LU);(function t(e){function i(n){var r=Dat.source(e)(n);return function(){return r()/n}}return i.source=t,i})(LU);(function t(e){function i(n){return function(){return-Math.log(1-e())/n}}return i.source=t,i})(LU);function lk(){this._=null}function iB(t){t.U=t.C=t.L=t.R=t.P=t.N=null}lk.prototype={constructor:lk,insert:function(t,e){var i,n,r;if(t){if(e.P=t,e.N=t.N,t.N&&(t.N.P=e),t.N=e,t.R){for(t=t.R;t.L;)t=t.L;t.L=e}else t.R=e;i=t}else this._?(t=kQ(this._),e.P=null,e.N=t,t.P=t.L=e,i=t):(e.P=e.N=null,this._=e,i=null);for(e.L=e.R=null,e.U=i,e.C=!0,t=e;i&&i.C;)n=i.U,i===n.L?(r=n.R,r&&r.C?(i.C=r.C=!1,n.C=!0,t=n):(t===i.R&&(l1(this,i),t=i,i=t.U),i.C=!1,n.C=!0,c1(this,n))):(r=n.L,r&&r.C?(i.C=r.C=!1,n.C=!0,t=n):(t===i.L&&(c1(this,i),t=i,i=t.U),i.C=!1,n.C=!0,l1(this,n))),i=t.U;this._.C=!1},remove:function(t){t.N&&(t.N.P=t.P),t.P&&(t.P.N=t.N),t.N=t.P=null;var e=t.U,i,n=t.L,r=t.R,a,o;if(n?r?a=kQ(r):a=n:a=r,e?e.L===t?e.L=a:e.R=a:this._=a,n&&r?(o=a.C,a.C=t.C,a.L=n,n.U=a,a!==r?(e=a.U,a.U=t.U,t=a.R,e.L=t,a.R=r,r.U=a):(a.U=e,e=a,t=a.R)):(o=t.C,t=a),t&&(t.U=e),!o){if(t&&t.C){t.C=!1;return}do{if(t===this._)break;if(t===e.L){if(i=e.R,i.C&&(i.C=!1,e.C=!0,l1(this,e),i=e.R),i.L&&i.L.C||i.R&&i.R.C){(!i.R||!i.R.C)&&(i.L.C=!1,i.C=!0,c1(this,i),i=e.R),i.C=e.C,e.C=i.R.C=!1,l1(this,e),t=this._;break}}else if(i=e.L,i.C&&(i.C=!1,e.C=!0,c1(this,e),i=e.L),i.L&&i.L.C||i.R&&i.R.C){(!i.L||!i.L.C)&&(i.R.C=!1,i.C=!0,l1(this,i),i=e.L),i.C=e.C,e.C=i.L.C=!1,c1(this,e),t=this._;break}i.C=!0,t=e,e=e.U}while(!t.C);t&&(t.C=!1)}}};function l1(t,e){var i=e,n=e.R,r=i.U;r?r.L===i?r.L=n:r.R=n:t._=n,n.U=r,i.U=n,i.R=n.L,i.R&&(i.R.U=i),n.L=i}function c1(t,e){var i=e,n=e.L,r=i.U;r?r.L===i?r.L=n:r.R=n:t._=n,n.U=r,i.U=n,i.L=n.R,i.L&&(i.L.U=i),n.R=i}function kQ(t){for(;t.L;)t=t.L;return t}function D1(t,e,i,n){var r=[null,null],a=zl.push(r)-1;return r.left=t,r.right=e,i&&ck(r,t,e,i),n&&ck(r,e,t,n),od[t.index].halfedges.push(a),od[e.index].halfedges.push(a),r}function u1(t,e,i){var n=[e,i];return n.left=t,n}function ck(t,e,i,n){!t[0]&&!t[1]?(t[0]=n,t.left=e,t.right=i):t.left===i?t[1]=n:t[0]=n}function Eat(t,e,i,n,r){var a=t[0],o=t[1],s=a[0],l=a[1],c=o[0],u=o[1],d=0,p=1,h=c-s,f=u-l,m;if(m=e-s,!(!h&&m>0)){if(m/=h,h<0){if(m<d)return;m<p&&(p=m)}else if(h>0){if(m>p)return;m>d&&(d=m)}if(m=n-s,!(!h&&m<0)){if(m/=h,h<0){if(m>p)return;m>d&&(d=m)}else if(h>0){if(m<d)return;m<p&&(p=m)}if(m=i-l,!(!f&&m>0)){if(m/=f,f<0){if(m<d)return;m<p&&(p=m)}else if(f>0){if(m>p)return;m>d&&(d=m)}if(m=r-l,!(!f&&m<0)){if(m/=f,f<0){if(m>p)return;m>d&&(d=m)}else if(f>0){if(m<d)return;m<p&&(p=m)}return!(d>0)&&!(p<1)||(d>0&&(t[0]=[s+d*h,l+d*f]),p<1&&(t[1]=[s+p*h,l+p*f])),!0}}}}}function Cat(t,e,i,n,r){var a=t[1];if(a)return!0;var o=t[0],s=t.left,l=t.right,c=s[0],u=s[1],d=l[0],p=l[1],h=(c+d)/2,f=(u+p)/2,m,g;if(p===u){if(h<e||h>=n)return;if(c>d){if(!o)o=[h,i];else if(o[1]>=r)return;a=[h,r]}else{if(!o)o=[h,r];else if(o[1]<i)return;a=[h,i]}}else if(m=(c-d)/(p-u),g=f-m*h,m<-1||m>1)if(c>d){if(!o)o=[(i-g)/m,i];else if(o[1]>=r)return;a=[(r-g)/m,r]}else{if(!o)o=[(r-g)/m,r];else if(o[1]<i)return;a=[(i-g)/m,i]}else if(u<p){if(!o)o=[e,m*e+g];else if(o[0]>=n)return;a=[n,m*n+g]}else{if(!o)o=[n,m*n+g];else if(o[0]<e)return;a=[e,m*e+g]}return t[0]=o,t[1]=a,!0}function Pat(t,e,i,n){for(var r=zl.length,a;r--;)(!Cat(a=zl[r],t,e,i,n)||!Eat(a,t,e,i,n)||!(Math.abs(a[0][0]-a[1][0])>mo||Math.abs(a[0][1]-a[1][1])>mo))&&delete zl[r]}function Rat(t){return od[t.index]={site:t,halfedges:[]}}function Mat(t,e){var i=t.site,n=e.left,r=e.right;return i===r&&(r=n,n=i),r?Math.atan2(r[1]-n[1],r[0]-n[0]):(i===n?(n=e[1],r=e[0]):(n=e[0],r=e[1]),Math.atan2(n[0]-r[0],r[1]-n[1]))}function J1e(t,e){return e[+(e.left!==t.site)]}function Nat(t,e){return e[+(e.left===t.site)]}function Aat(){for(var t=0,e=od.length,i,n,r,a;t<e;++t)if((i=od[t])&&(a=(n=i.halfedges).length)){var o=new Array(a),s=new Array(a);for(r=0;r<a;++r)o[r]=r,s[r]=Mat(i,zl[n[r]]);for(o.sort(function(l,c){return s[c]-s[l]}),r=0;r<a;++r)s[r]=n[o[r]];for(r=0;r<a;++r)n[r]=s[r]}}function _at(t,e,i,n){var r=od.length,a,o,s,l,c,u,d,p,h,f,m,g,v=!0;for(a=0;a<r;++a)if(o=od[a]){for(s=o.site,c=o.halfedges,l=c.length;l--;)zl[c[l]]||c.splice(l,1);for(l=0,u=c.length;l<u;)f=Nat(o,zl[c[l]]),m=f[0],g=f[1],d=J1e(o,zl[c[++l%u]]),p=d[0],h=d[1],(Math.abs(m-p)>mo||Math.abs(g-h)>mo)&&(c.splice(l,0,zl.push(u1(s,f,Math.abs(m-t)<mo&&n-g>mo?[t,Math.abs(p-t)<mo?h:n]:Math.abs(g-n)<mo&&i-m>mo?[Math.abs(h-n)<mo?p:i,n]:Math.abs(m-i)<mo&&g-e>mo?[i,Math.abs(p-i)<mo?h:e]:Math.abs(g-e)<mo&&m-t>mo?[Math.abs(h-e)<mo?p:t,e]:null))-1),++u);u&&(v=!1)}if(v){var y,b,I,T=1/0;for(a=0,v=null;a<r;++a)(o=od[a])&&(s=o.site,y=s[0]-t,b=s[1]-e,I=y*y+b*b,I<T&&(T=I,v=o));if(v){var w=[t,e],S=[t,n],D=[i,n],E=[i,e];v.halfedges.push(zl.push(u1(s=v.site,w,S))-1,zl.push(u1(s,S,D))-1,zl.push(u1(s,D,E))-1,zl.push(u1(s,E,w))-1)}}for(a=0;a<r;++a)(o=od[a])&&(o.halfedges.length||delete od[a])}var Q1e=[],F9;function kat(){iB(this),this.x=this.y=this.arc=this.site=this.cy=null}function _0(t){var e=t.P,i=t.N;if(!(!e||!i)){var n=e.site,r=t.site,a=i.site;if(n!==a){var o=r[0],s=r[1],l=n[0]-o,c=n[1]-s,u=a[0]-o,d=a[1]-s,p=2*(l*d-c*u);if(!(p>=-Bat)){var h=l*l+c*c,f=u*u+d*d,m=(d*h-c*f)/p,g=(l*f-u*h)/p,v=Q1e.pop()||new kat;v.arc=t,v.site=r,v.x=m+o,v.y=(v.cy=g+s)+Math.sqrt(m*m+g*g),t.circle=v;for(var y=null,b=BE._;b;)if(v.y<b.y||v.y===b.y&&v.x<=b.x)if(b.L)b=b.L;else{y=b.P;break}else if(b.R)b=b.R;else{y=b;break}BE.insert(y,v),y||(F9=v)}}}}function q0(t){var e=t.circle;e&&(e.P||(F9=e.N),BE.remove(e),Q1e.push(e),iB(e),t.circle=null)}var eDe=[];function xat(){iB(this),this.edge=this.site=this.circle=null}function xQ(t){var e=eDe.pop()||new xat;return e.site=t,e}function q$(t){q0(t),W0.remove(t),eDe.push(t),iB(t)}function Oat(t){var e=t.circle,i=e.x,n=e.cy,r=[i,n],a=t.P,o=t.N,s=[t];q$(t);for(var l=a;l.circle&&Math.abs(i-l.circle.x)<mo&&Math.abs(n-l.circle.cy)<mo;)a=l.P,s.unshift(l),q$(l),l=a;s.unshift(l),q0(l);for(var c=o;c.circle&&Math.abs(i-c.circle.x)<mo&&Math.abs(n-c.circle.cy)<mo;)o=c.N,s.push(c),q$(c),c=o;s.push(c),q0(c);var u=s.length,d;for(d=1;d<u;++d)c=s[d],l=s[d-1],ck(c.edge,l.site,c.site,r);l=s[0],c=s[u-1],c.edge=D1(l.site,c.site,null,r),_0(l),_0(c)}function Lat(t){for(var e=t[0],i=t[1],n,r,a,o,s=W0._;s;)if(a=tDe(s,i)-e,a>mo)s=s.L;else if(o=e-Fat(s,i),o>mo){if(!s.R){n=s;break}s=s.R}else{a>-mo?(n=s.P,r=s):o>-mo?(n=s,r=s.N):n=r=s;break}Rat(t);var l=xQ(t);if(W0.insert(n,l),!(!n&&!r)){if(n===r){q0(n),r=xQ(n.site),W0.insert(l,r),l.edge=r.edge=D1(n.site,l.site),_0(n),_0(r);return}if(!r){l.edge=D1(n.site,l.site);return}q0(n),q0(r);var c=n.site,u=c[0],d=c[1],p=t[0]-u,h=t[1]-d,f=r.site,m=f[0]-u,g=f[1]-d,v=2*(p*g-h*m),y=p*p+h*h,b=m*m+g*g,I=[(g*y-h*b)/v+u,(p*b-m*y)/v+d];ck(r.edge,c,f,I),l.edge=D1(c,t,null,I),r.edge=D1(t,f,null,I),_0(n),_0(r)}}function tDe(t,e){var i=t.site,n=i[0],r=i[1],a=r-e;if(!a)return n;var o=t.P;if(!o)return-1/0;i=o.site;var s=i[0],l=i[1],c=l-e;if(!c)return s;var u=s-n,d=1/a-1/c,p=u/c;return d?(-p+Math.sqrt(p*p-2*d*(u*u/(-2*c)-l+c/2+r-a/2)))/d+n:(n+s)/2}function Fat(t,e){var i=t.N;if(i)return tDe(i,e);var n=t.site;return n[1]===e?n[0]:1/0}var mo=1e-6,Bat=1e-12,W0,od,BE,zl;function $at(t,e,i){return(t[0]-i[0])*(e[1]-t[1])-(t[0]-e[0])*(i[1]-t[1])}function Vat(t,e){return e[1]-t[1]||e[0]-t[0]}function OQ(t,e){var i=t.sort(Vat).pop(),n,r,a;for(zl=[],od=new Array(t.length),W0=new lk,BE=new lk;;)if(a=F9,i&&(!a||i[1]<a.y||i[1]===a.y&&i[0]<a.x))(i[0]!==n||i[1]!==r)&&(Lat(i),n=i[0],r=i[1]),i=t.pop();else if(a)Oat(a.arc);else break;if(Aat(),e){var o=+e[0][0],s=+e[0][1],l=+e[1][0],c=+e[1][1];Pat(o,s,l,c),_at(o,s,l,c)}this.edges=zl,this.cells=od,W0=BE=zl=od=null}OQ.prototype={constructor:OQ,polygons:function(){var t=this.edges;return this.cells.map(function(e){var i=e.halfedges.map(function(n){return J1e(e,t[n])});return i.data=e.site.data,i})},triangles:function(){var t=[],e=this.edges;return this.cells.forEach(function(i,n){if(s=(a=i.halfedges).length)for(var r=i.site,a,o=-1,s,l,c=e[a[s-1]],u=c.left===r?c.right:c.left;++o<s;)l=u,c=e[a[o]],u=c.left===r?c.right:c.left,l&&u&&n<l.index&&n<u.index&&$at(r,l,u)<0&&t.push([r.data,l.data,u.data])}),t},links:function(){return this.edges.filter(function(t){return t.right}).map(function(t){return{source:t.left.data,target:t.right.data}})},find:function(t,e,i){for(var n=this,r,a=n._found||0,o=n.cells.length,s;!(s=n.cells[a]);)if(++a>=o)return null;var l=t-s.site[0],c=e-s.site[1],u=l*l+c*c;do s=n.cells[r=a],a=null,s.halfedges.forEach(function(d){var p=n.edges[d],h=p.left;if(!((h===s.site||!h)&&!(h=p.right))){var f=t-h[0],m=e-h[1],g=f*f+m*m;g<u&&(u=g,a=h.index)}});while(a!==null);return n._found=r,i==null||u<=i*i?s.site:null}};function E1(t,e,i){this.k=t,this.x=e,this.y=i}E1.prototype={constructor:E1,scale:function(t){return t===1?this:new E1(this.k*t,this.x,this.y)},translate:function(t,e){return t===0&e===0?this:new E1(this.k,this.x+this.k*t,this.y+this.k*e)},apply:function(t){return[t[0]*this.k+this.x,t[1]*this.k+this.y]},applyX:function(t){return t*this.k+this.x},applyY:function(t){return t*this.k+this.y},invert:function(t){return[(t[0]-this.x)/this.k,(t[1]-this.y)/this.k]},invertX:function(t){return(t-this.x)/this.k},invertY:function(t){return(t-this.y)/this.k},rescaleX:function(t){return t.copy().domain(t.range().map(this.invertX,this).map(t.invert,t))},rescaleY:function(t){return t.copy().domain(t.range().map(this.invertY,this).map(t.invert,t))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};E1.prototype;const jat=function(){let t={};t.jsonTODS=i=>{let n={bestOf:e(i.max_sets)};if(i.max_sets&&parseInt(i.max_sets)===1&&i.final_set_supertiebreak)n.setFormat={tiebreakSet:{tiebreakTo:i.supertiebreak_to}};else{const r=e(i.games_for_set),a=e(i.tiereaks_at),o=a>r?r:a;n.setFormat={setTo:r,tiebreakAt:o,tiebreakFormat:{tiebreakTo:e(i.tiebreak_to)}},i.final_set_supertiebreak&&(n.finalSetFormat={tiebreakSet:{tiebreakTo:i.supertiebreak_to}})}return n};function e(i){return!isNaN(Number(i))&&Number(i)}return t}(),iDe=function(){let t={};function e(o,s){let l=parseInt(o);return isNaN(l)?s:l}function i({source:o={},objects:s=[]}){let l=Object.assign({},o);return s&&!Array.isArray(s)&&(s=[s]),s=s.filter(c=>c),s.forEach(c=>{if(typeof c!="object")return;Object.keys(c).forEach(d=>l[d]=l[d]!==void 0?l[d]:c[d])}),l}t.setsToWin=o=>o&&Math.ceil(o/2)||1,t.tiebreakTo=(o,s)=>{var u,d,p,h;let l=(d=(u=o==null?void 0:o.setFormat)==null?void 0:u.tiebreakFormat)==null?void 0:d.tiebreakTo,c=(h=(p=o==null?void 0:o.finalSetFormat)==null?void 0:p.tiebreakFormat)==null?void 0:h.tiebreakTo;return s?c:l},t.matchFormat=n;function n(o){return(o||"SET3-S:6/TB7").slice(3)}t.getExistingScores=({match:o})=>{if(o!=null&&o.score)return r({string_score:o.score,winner_index:o.winner_index,matchFormat:o.matchFormat})},t.generateMatchFormat=({cfg_obj:o})=>{let s=o.bestof.ddlb.getValue(),l=e(s),c=iDe.setsToWin(l),u={max_sets:l,sets_to_win:c,games_for_set:e(o.setsto.ddlb.getValue()),tiebreaks_at:e(o.tiebreaksat.ddlb.getValue())||"",tiebreak_to:e(o.tiebreaksto.ddlb.getValue()),supertiebreak_to:e(o.supertiebreakto.ddlb.getValue()),final_set_supertiebreak:o.finalset.ddlb.getValue()!=="N"};return{matchFormat:_f.stringify(jat.jsonTODS(u)),score_format:u}},t.getScoringFormat=({e:o,match:s})=>{var u,d;let l=(s==null?void 0:s.format)||((o==null?void 0:o.format)==="D"?"doubles":"singles"),c=[s==null?void 0:s.score_format,(u=s==null?void 0:s.match)==null?void 0:u.score_format,(d=o.scoring_format)==null?void 0:d[l],o.score_format];return i({objects:c})},t.defaultMatchFormat=({format:o,category:s,env:l})=>{let c=l.scoreboard.matchFormats,u={S:"singles",D:"doubles"};return Object.keys(u).indexOf(o)>=0&&(o=u[o]),o&&s&&c.categories[s]&&c.categories[s][o]?c.categories[s][o]:o&&c[o]?c[o]:c.singles},t.convertStringScore=r;function r({string_score:o,winner_index:s,split:l=" ",matchFormat:c}){if(!o)return[];o=s?a(o):o;let u=null,d=/(\d+)/,p=/(\d+)\((\d+)\)/,h=_f.parse(c),f=o.split(l).filter(m=>m).map(m=>{if(m.indexOf("/")>0){let y=m.split("/").map(b=>d.exec(b)?{games:+d.exec(b)[1]}:void 0).filter(b=>b);if(y.length===2)return y}let g=null,v=m.split("-").map(y=>{let b;return p.test(y)?(g=+p.exec(y)[2],b={games:+p.exec(y)[1]}):d.test(y)?b={games:+d.exec(y)[1]}:u=y,b||void 0});if(v=v.filter(y=>y),g!==null){let y=Math.min(...v.map(b=>b.games));v.forEach(b=>{+b.games==+y?b.tiebreak=g:b.spacer=g})}return v});if(f=f.filter(m=>m&&m.length===2),f.forEach(m=>{var y;let g=h&&(h.finalSetFormat||h.setFormat),v=(y=g==null?void 0:g.tiebreakSet)==null?void 0:y.tiebreakTo;(m[0].games>=v||m[1].games>=v)&&(m[0].supertiebreak=m[0].games,m[1].supertiebreak=m[1].games,delete m[0].games,delete m[1].games)}),s!==void 0&&(f.winner_index=s),u){if(u==="Cancelled"&&(f.cancelled=!0),u==="Abandoned"&&(f.abandoned=!0),u==="INC."&&(f.incomplete=!0),u==="INT."&&(f.interrupted=!0),u==="LIVE"&&(f.live=!0),u==="TIME"&&(f.time=!0),u==="DEF."&&(f.default=!0),u==="W.O."&&(f.walkover=!0),!f.length)return f;s!==void 0&&(f[f.length-1][1-s].outcome=u,f[f.length-1].outcome=u,f.outome=u)}return f}t.reverseScore=a;function a(o,s=" "){let l=null;if(o){let d=o.split(s).map(c).join(s);return l?`${l} ${d}`:d}function c(d){let p=d.indexOf("/")>0?"/":"-",h=d.split(p).map(u).reverse().filter(y=>y),f=h.map(y=>y.games),m=h.map(y=>y.tiebreak).filter(y=>y),g=m.length===1?`(${m[0]})`:"";return`${m.length<2?f.join(p):f.map((y,b)=>`${y}(${m[b]})`).join(p)}${g}`}function u(d){let p=/(\d+)/,h=/(\d+)\((\d+)\)/;if(h.test(d))return{games:h.exec(d)[1],tiebreak:h.exec(d)[2]};if(p.test(d))return{games:p.exec(d)[1]};l=d}}return t}(),hs=function(){let t={};function e(l,c){let u=1;if(Array.from(l.classList).indexOf(c)>=0)return{elem:l,depth:u};for(;l.parentNode;){if(l=l.parentNode,l.classList&&Array.from(l.classList).indexOf(c)>=0)return{elem:l,depth:u};u+=1}return{elem:null,depth:0}}const i="span:first-of-type";t.DropDown=n;function n({element:l,onChange:c,css_class:u,id:d,locked:p,max:h,maxFx:f,value_attribute:m=!0,background:g}){var v,y,b,I,T;!l&&d&&(l=document.getElementById(d)),this.id=d,this.val="",this.max=h,this.maxFx=f,this.el=l,this.locked=p,this.background=g||"",this.bordercolor="",this.labelcolor="#000",this.class=u,this.value_attribute=m,this.list=(v=this.el)==null?void 0:v.querySelector(".dd_state"),this.options=(y=this.el)==null?void 0:y.querySelector(".options"),this.label=(b=this.el)==null?void 0:b.querySelector("div:first-of-type"),this.opts=((I=this.list)==null?void 0:I.querySelectorAll("li"))||[],this.selection=((T=this.list)==null?void 0:T.querySelector(i))||void 0,typeof c=="function"&&(this.onChange=c),this.initEvents()}function r(l){l.el&&(l.el.ddclick||(l.el.ddclick=!0,l.el.addEventListener("click",c=>{if(l.locked)return;let{elem:u,depth:d}=e(c.target,"dd_state"),{elem:p,depth:h}=e(c.target,"dd_option"),f=u&&Array.from(u.classList).indexOf("active")>=0;if(l.max&&!p&&l.opts&&l.opts.length>l.max&&l.maxFx&&typeof l.maxFx=="function"){l.maxFx(l.options);return}t.closeAllDropDowns(l.class),u&&(!h||d<h)&&u.classList[f?"remove":"add"]("active"),c.stopPropagation()})))}function a(l){Array.from(l.opts).forEach(c=>{c.addEventListener("click",()=>{l.list.classList.remove("active");let u=c.querySelector(i),d=u.getAttribute("value");l.selection.innerHTML=u.innerHTML;let p=l.val!=d;l.val=d,p&&l.onChange&&(l.onChange(d),l.selectionBackground(),l.labelColor())})})}function o(l,c){return`<li class='dd_option' title='${l.title||""}'><span value="${l.value}" style="${c||""}">${l.key}</span></li>`}n.prototype={initEvents(){let l=this;r(l),a(l)},getLabel(){return this.selection.innerHTML},getValue(){return this.val},setId(l){this.id=l},getId(){return this.id},lock(){this.locked=!0},unlock(){this.locked=!1},setOptions(l,c=""){if(!Array.isArray(l)||!l.length||!this.list)return;let u=this.list.querySelector("ul");if(u)return this.max&&l&&l.length>this.max&&t.closeAllDropDowns(this.class),u.innerHTML=l.map(d=>o(d,c)).join(""),this.options=l,this.opts=this.list.querySelectorAll("li"),a(this),this},getOptions(){return Array.from(this.opts).map(l=>{let c=l.querySelector(i);return{key:c.innerHTML,value:c.getAttribute("value")}})},setLabel(l,c,u,d){this.selection&&(this.selection.innerHTML=l,this.selectionBackground(c),this.labelColor(u),this.borderColor(d))},setValue(l,c,u,d){let p=Array.from(this.opts).filter(f=>f.querySelector(i).getAttribute("value")==l),h=p.length?p[0].querySelector("span").innerHTML:l;this.val=l,this.selection&&(this.selection.innerHTML=h,this.selectionBackground(c),this.labelColor(u),this.borderColor(d))},selectionBackground(l){this.selection&&(l&&(this.background=l),this.background?(this.selection.classList.remove("novalue"),this.selection.classList.remove("hasvalue"),this.selection.style.background=this.background):this.locked?(this.value_attribute&&this.selection.classList.add("hasvalue"),this.selection.classList.remove("novalue")):this.val?(this.selection.style.background="",this.value_attribute&&this.selection.classList.add("hasvalue"),this.selection.classList.remove("novalue")):(this.selection.style.background="",this.selection.classList.add("novalue"),this.selection.classList.remove("hasvalue")))},labelColor(l){l&&(this.labelcolor=l),this.label.style.color=this.labelcolor},borderColor(l){l&&(this.bordercolor=l),this.bordercolor&&this.options&&this.options.style&&(this.options.style.border=`1px solid ${this.bordercolor}`)}};let s=(l,c=[],u,d=!0,p,h)=>{let f=u!==void 0&&c[u]?c[u].key:"",m=d?"style='border: 1px solid #000;'":"",g=c.map(v=>o(v,p)).join("");return`
         <div class='dd-label'>${l}</div>
         <div class='options' ${m}>
            <ul>
               <li class='dd_state'>
                  <span class='active'>${f}</span>
                  <div>
                     <ul class='${h?"floatleft":""}'>
                     ${g}
                     </ul>
                  </div>
               </li>
            </ul>
         </div>`};return t.attachDropDown=({element:l,id:c,label:u="",options:d,selected:p=0,css_class:h,border:f,style:m,floatleft:g,display:v="flex"})=>{!c&&!l||(l=l||document.getElementById(c),l&&(l.style.display=v,l.classList.add(h||"dd"),l.innerHTML=s(u,d,p,f,m,g)))},t.closeAllDropDowns=()=>{let l=document.querySelectorAll("li.dd_state.active");Array.from(l).forEach(c=>{c.classList.remove("active")})},document.addEventListener("click",()=>t.closeAllDropDowns()),t}(),LQ=(t,e)=>{let i=parseInt(t);return isNaN(i)?e:i},FQ=1500;function BQ({elem:t,type:e,duration:i=800,height:n=80,visible:r}){let a=Knt(t);o();function o(){let s=a.select("."+e),l=s.style("display"),c=l==="none"?"flex":"none";r===!0&&l==="none"||r===void 0&&c==="flex"?(s.style("height","0px"),s.style("display",c).transition().duration(i).style("height",`${n}px`)):(r===!1&&l==="flex"||r===void 0&&c==="none")&&s.transition().duration(i).style("height","0px").transition().duration(0).style("display","none")}}const Gat=function(){let t={numericFx:void 0,enterFx:void 0};document.addEventListener("keyup",a=>{if(a.key&&a.key==="Enter"&&t.enterFx&&typeof t.enterFx=="function"&&t.enterFx(),a.key&&t.numericFx&&typeof t.numericFx=="function"){let o=["0","1","2","3","4","5","6","7","8","9"].indexOf(a.key),s=[")","!","@","#","$","%","^","&","*",")"].indexOf(a.key);o>=0?t.numericFx(o):s>=0&&t.numericFx(s,1)}});let e={};MG.register("setClick","tap",i);function i(a){let o=II(a,"set_number");if(!o)return;let s=o.getAttribute("setnum"),l=II(a,"muid").getAttribute("muid");e[l]&&typeof e[l]=="function"&&e[l](s)}let n={auto_score:!0},r={bestof:[1,3,5],setsto:[4,6,8],tiebreaksto:[5,7,12],supertiebreakto:[7,10,21]};return t.options=a=>{if(!a)return r;S1e(a,r)},t.setMatchScore=({muid:a,lock:o,match:s,teams:l,grouped:c,callback:u,round_name:d,matchFormat:p,existing_scores:h,auto_score:f=!0})=>{var gt,Ue,xe,We,st,vt;n.auto_score=f;let m={...n},g=_f.parse(p||"SET3-S:6/TB7");if(!g)return;let v=(gt=g==null?void 0:g.setFormat)==null?void 0:gt.tiebreakAt,y=(Ue=g==null?void 0:g.setFormat)==null?void 0:Ue.setTo,b=g.bestOf,I=iDe.setsToWin(b),T=g.finalSetFormat||g.setFormat,w=(xe=T==null?void 0:T.tiebreakSet)==null?void 0:xe.tiebreakTo,S=(st=(We=g==null?void 0:g.setFormat)==null?void 0:We.tiebreakFormat)==null?void 0:st.tiebreakTo,D=(vt=g==null?void 0:g.finalSetFormat)==null?void 0:vt.tiebreakSet,E,C,P,R,N,M=Tit.display({muid:a,teams:l});M.details.element.style.display="none",d&&(M.round_name.element.innerHTML=d),M.details.element.innerHTML=Hat(s),M.scoring.element.style.display=o?"none":"inline",M.favorite.element.style.display=o?"inline":"none",a&&(e[a]=ge=>{o||(R.length-ge>1&&(R=R.slice(0,R.length-1),ge=R.length-1,Te()),Pe({selected_set:ge}),A(!0),O(),M.scoring.element.style.display="inline",M.edit_scoring.element.style.display="inline")});let A=ge=>{let Se=ge&&!o;N=Se,BQ({elem:M.actions.element,type:"edit",height:50,visible:Se}),M.scoring.element.style.display=N||o?"none":"inline",M.edit_scoring.element.style.display=N?"none":"inline"};bt({sobj:M,changeFx:F}),z(),$(),Z(),x();function _(){return[]}function x(){if(R=h?_():[],N=!1,P=!1,t.enterFx=()=>{N&&H()},O(),q(),E=Ve(!c)!==void 0?R.length:Math.max(0,R.length-1),h&&(Object.keys(h).length||h.length||h.walkover||h.default)){let Se=R.length?R[R.length-1]:void 0;if(R.interrupted)M.p1action.ddlb.setValue(" "),M.p2action.ddlb.setValue("interrupted"),M.p1action.ddlb.lock(),M.p2action.ddlb.lock(),A(!0),Se&&re(Se[0].games,Se[1].games)&&(E+=1);else if(R.abandoned)M.p1action.ddlb.setValue(" "),M.p2action.ddlb.setValue("abandoned"),M.p1action.ddlb.lock(),M.p2action.ddlb.lock(),A(!0);else if(R.cancelled)M.p1action.ddlb.setValue(" "),M.p2action.ddlb.setValue("cancelled"),M.p1action.ddlb.lock(),M.p2action.ddlb.lock(),A(!0);else if(R.incomplete)M.p1action.ddlb.setValue(" "),M.p2action.ddlb.setValue("incomplete"),M.p1action.ddlb.lock(),M.p2action.ddlb.lock(),A(!0),Se&&re(Se[0].games,Se[1].games)&&(E+=1);else if(R.live)M.p1action.ddlb.setValue(" "),M.p2action.ddlb.setValue("live"),M.p1action.ddlb.lock(),M.p2action.ddlb.lock(),A(!0),Se&&re(Se[0].games,Se[1].games)&&(E+=1),m.auto_score=!1;else if(R.retired){let qe=h.winner_index!==void 0?1-h.winner_index:void 0;M.p1action.ddlb.setValue(qe===0?"retired":"winner"),M.p2action.ddlb.setValue(qe===1?"retired":"winner"),M.p1action.ddlb.lock(),M.p2action.ddlb.lock(),A(!1),B(1-qe)}else if(R.time){let qe=h.winner_index!==void 0?1-h.winner_index:void 0;M.p1action.ddlb.setValue(qe===0?"time":"winner"),M.p2action.ddlb.setValue(qe===1?"time":"winner"),M.p1action.ddlb.lock(),M.p2action.ddlb.lock(),A(!1),B(1-qe)}else if(R.default){let qe=h.winner_index!==void 0?1-h.winner_index:void 0;M.p1action.ddlb.setValue(qe===0?"defaulted":"winner"),M.p2action.ddlb.setValue(qe===1?"defaulted":"winner"),M.p1action.ddlb.lock(),M.p2action.ddlb.lock(),A(!1),B(1-qe)}else if(R.walkover){let qe=h.winner_index!==void 0?1-h.winner_index:void 0;M.p1action.ddlb.setValue(qe===0?"walkover":"winner"),M.p2action.ddlb.setValue(qe===1?"walkover":"winner"),M.p1action.ddlb.lock(),M.p2action.ddlb.lock(),A(!0),B(1-qe)}else A(!1)}else M.p1action.ddlb.setValue(" "),M.p2action.ddlb.setValue(" ");(R.time||R.retired||R.default||R.walkover)&&(E=void 0),Pe({selected_set:E,actions:!c})}function O(){Array.from(M.root.element.querySelectorAll(".victor")).forEach(Se=>Se.classList.remove("victor")),o||Te()}function B(ge){Array.from(M.root.element.querySelectorAll(`.opponent${ge}`)).forEach($e=>$e.classList.add("victor")),Array.from(M.root.element.querySelectorAll(`.opponent${ge} .hasvalue`)).forEach($e=>$e.classList.add("victor"))}function F(){O(),E=0,R=[],lt(),Ee(),q(),t.enterFx=void 0,M.p2action.ddlb.setValue(" "),M.p1action.ddlb.setValue(" "),m.auto_score=n.auto_score,Pe({selected_set:E})}function G(ge){let Se={bestOf:b,setFormat:{setTo:y,tiebreakAt:v,tiebreakFormat:{tiebreakTo:S}}};D&&(Se.finalSetFormat={tiebreakSet:{tiebreakTo:w}});const qe=_f.stringify(Se);if(ge){const $e=R.map((ke,Ut)=>_i.definedAttributes({side1TiebreakScore:ke[0].supertiebreak,side2TiebreakScore:ke[1].supertiebreak,side1score:ke[0].games,side2score:ke[1].games,setNumber:Ut+1}));ge.sets=$e,ge.set_scores=R,ge.matchUpFormat=qe}ge&&typeof u=="function"&&u(ge),t.numericFx=void 0,t.enterFx=void 0,document.body.style.overflow=null,yI()}function H(){t.numericFx=void 0,t.enterFx=void 0,Ve(),G(et())}function $(){M.cancel.element.addEventListener("click",()=>G(),!1),M.accept.element.addEventListener("click",H,!1),M.clear.element.addEventListener("click",F,!1),M.scoring.element.addEventListener("click",ge,!1);function ge(){let qe=M.scoring.element.innerHTML==="-";qe||(M.edit_scoring.element.style.overflow="hidden"),M.scoring.element.innerHTML=qe?"&#x25A2;":"-",Se(M.edit_scoring.element,qe)}function Se(qe,$e){let ke=800;BQ({elem:qe,type:"edit",height:100,visible:$e,duration:ke}),$e&&setTimeout(function(){qe.style.overflow="visible"},ke)}}function q(){let ge=[{key:"-",value:""}],Se=y===v?y+2:y+1;_i.generateRange(0,Se).forEach(pt=>ge.push({key:pt,value:pt}));let qe=pt=>se(0,pt),$e=pt=>se(1,pt);hs.attachDropDown({id:M.p1selector.id,options:ge,border:!1}),hs.attachDropDown({id:M.p2selector.id,options:ge,border:!1}),M.p1selector.ddlb=new hs.DropDown({element:M.p1selector.element,onChange:qe,id:M.p1selector.id,value_attribute:!1}),M.p2selector.ddlb=new hs.DropDown({element:M.p2selector.element,onChange:$e,id:M.p2selector.id,value_attribute:!1}),o&&(M.p1selector.ddlb.lock(),M.p2selector.ddlb.lock()),M.p1selector.ddlb.selectionBackground(),M.p2selector.ddlb.selectionBackground();let ke;t.numericFx=(pt,tt=0)=>{ke=new Date().getTime(),M.p1tiebreak.element.style.display==="none"&&pt<Se?(tt?M.p1selector.ddlb.setValue(pt):M.p2selector.ddlb.setValue(pt),se(1-tt,pt)):setTimeout(function(){Ut()},FQ)};function Ut(){if(new Date().getTime()-ke>FQ){let tt=+M.p1tiebreak.element.value,At=+M.p2tiebreak.element.value;(tt!=""||At!="")&&(C?X(tt,At,!0):Q(tt,At,!0))}}}function z(){let ge=[{key:" ",value:""},{key:"-",value:" "},{key:"RET.",value:"retired"},{key:"TIME",value:"time"},{key:"W.O.",value:"walkover"},{key:"DEF.",value:"defaulted"},{key:"INT.",value:"interrupted"},{key:"INC.",value:"incomplete"},{key:"CCL",value:"cancelled"},{key:"ABD",value:"abandoned"},{key:"LIVE",value:"live"},{key:`<div class='link'><img src='${Sit}' class='completed_icon'></div>`,value:"winner"}],Se=$e=>Ke(0,$e),qe=$e=>Ke(1,$e);hs.attachDropDown({id:M.p1action.id,options:ge,border:!1,floatleft:!0}),hs.attachDropDown({id:M.p2action.id,options:ge,border:!1,floatleft:!0}),M.p1action.ddlb=new hs.DropDown({element:M.p1action.element,onChange:Se,id:M.p1action.id}),M.p2action.ddlb=new hs.DropDown({element:M.p2action.element,onChange:qe,id:M.p2action.id}),o&&(M.p1action.ddlb.lock(),M.p2action.ddlb.lock()),M.p1action.ddlb.selectionBackground(),M.p2action.ddlb.selectionBackground()}function Z(){let ge=qe=>Y(qe,0),Se=qe=>Y(qe,1);M.p1tiebreak.element.addEventListener("keyup",ge,!1),M.p2tiebreak.element.addEventListener("keyup",Se,!1)}function Y(ge,Se,qe){let $e=+M.p1tiebreak.element.value,ke=+M.p2tiebreak.element.value;(ge.which===13||qe)&&($e!=""||ke!="")&&(C?X($e,ke,!0):Q($e,ke,!0));let Ut=M[Se?"p2tiebreak":"p1tiebreak"].element.value.match(/-?\d+\.?\d*/),pt=Ut&&!isNaN(Ut[0])?parseInt(Ut[0].toString().slice(-2)):void 0,tt=C?w:S,At=pt===void 0||pt==""||pt+2<tt?tt:pt+2;M[Se?"p2tiebreak":"p1tiebreak"].element.value=pt!==void 0?pt:"",m.auto_score&&!de()&&(M[Se?"p1tiebreak":"p2tiebreak"].element.value=At)}function Q(ge,Se,qe){let $e=R.length,ke=$e>E?$e-1:E-1;R!=null&&R[ke]&&(R[ke][0][ge<Se?"tiebreak":"spacer"]=ge<Se?ge:Se,R[ke][1][Se<ge?"tiebreak":"spacer"]=Se<ge?Se:ge,qe&&oe())}function X(ge,Se,qe){if(ge<w&&Se<w)return;let $e=[{supertiebreak:ge},{supertiebreak:Se}],ke=R.length;ke&&R[ke-1][0].supertiebreak!==void 0?R[ke-1]=$e:R.push($e),qe&&oe()}function oe(){lt(),Ve()!==void 0&&A(!0),Pe({selected_set:E})}function re(ge,Se){let qe=Math.abs(ge-Se);return!v&&(+ge===y||+Se===y)?!0:qe>=2&&(+ge>=y||+Se>=y)}function me(ge,Se){return v?+ge===v+1&&+Se===v||+ge===v&&+Se===v+1:!1}function se(ge,Se){if(Se===""){M.p1selector.ddlb.setValue(""),M.p2selector.ddlb.setValue(""),R[E]=[{games:0},{games:0}];return}Ie()&&Te();let qe=!1;lt(),he()&&(E=R.length-1,M.p1action.ddlb.setValue(" "),M.p2action.ddlb.setValue(" "),Ee());let $e=M.p1selector.ddlb.getValue(),ke=M.p2selector.ddlb.getValue();m.auto_score?ge===0&&ke===""?(ke=pt(Se),M.p2selector.ddlb.setValue(ke)):ge===1&&$e===""?($e=pt(Se),M.p1selector.ddlb.setValue($e)):v?(+$e===v+1&&+ke===v+1&&Ut(v),+$e===v+1&&+ke<v-1&&Ut(v),+ke===v+1&&+$e<v-1&&Ut(v)):+$e===y&&+ke===y&&Ut(y-1):ge===0&&!ke?(ke=0,M.p2selector.ddlb.setValue(ke)):ge===1&&!$e&&($e=0,M.p1selector.ddlb.setValue($e)),R[E]=[{games:LQ($e)||0},{games:LQ(ke)||0}],!re($e,ke)&&!me($e,ke)?(R=R.slice(0,E+1),Pe({selected_set:E})):(me($e,ke)&&(qe=!0),Ve(),te($e,ke,qe));function Ut(tt){ge?($e=tt,M.p1selector.ddlb.setValue($e)):(ke=tt,M.p2selector.ddlb.setValue(ke))}function pt(tt){return tt===""?"":v?((+tt===v||+tt===v+1)&&(qe=!0),+tt===v-1||+tt===v?parseInt(v||0)+1:+tt<v?y:v):+tt===y?y-1:(+tt===y-1,y)}}function te(ge,Se,qe){qe&&!o&&(M.p1tiebreak.element.style.display="inline",M.p2tiebreak.element.style.display="inline",M[ge>Se?"p1tiebreak":"p2tiebreak"].element.disabled=!0,M[ge>Se?"p2tiebreak":"p1tiebreak"].element.disabled=!1,M[ge>Se?"p2tiebreak":"p1tiebreak"].element.focus(),A(!1));let $e=ge!==""&&Se!=="",ke=Ve()===void 0&&de()===void 0;$e&&ke&&E+1<b&&(E+=1),Pe({selected_set:E,tiebreak:qe})}function he(){let ge=M.p1action.ddlb.getValue(),Se=M.p2action.ddlb.getValue();return ge==="winner"||Se==="winner"}function ae(){let ge=M.p1action.ddlb.getValue(),Se=M.p2action.ddlb.getValue();if(["cancelled","incomplete","abandoned"].indexOf(ge)>=0||["cancelled","incomplete","abandoned"].indexOf(Se)>=0)return!1}function de(){let ge=M.p1action.ddlb.getValue(),Se=M.p2action.ddlb.getValue();if(["time","retired","defaulted","walkover"].indexOf(ge)>=0)return 0;if(["time","retired","defaulted","walkover"].indexOf(Se)>=0)return 1}function Ie(){let ge=M.p1action.ddlb.getValue(),Se=M.p2action.ddlb.getValue();return["interrupted"].indexOf(ge)>=0||["interrupted"].indexOf(Se)>=0}function De(){let ge=M.p1action.ddlb.getValue(),Se=M.p2action.ddlb.getValue();return["live"].indexOf(ge)>=0||["live"].indexOf(Se)>=0}function Te(){De()||(M.p1action.ddlb.setValue(" "),M.p2action.ddlb.setValue(" ")),M.p1action.ddlb.unlock(),M.p2action.ddlb.unlock()}function _e(){return R.length?R.map(Se=>{let qe=isNaN(Se[0].games)?Se[0].games:+Se[0].games,$e=isNaN(Se[1].games)?Se[1].games:+Se[1].games;if(qe!==void 0&&$e!==void 0&&qe!==""&&$e!==""){if(me(qe,$e)&&Se[0].tiebreak===void 0&&Se[1].tiebreak===void 0)return[0,0];const ke=+qe===y&&+qe==+$e+1,Ut=+$e===y&&+$e==+qe+1;if(v)if(!v||y===v){if(ke)return[0,0];if(+$e===y&&+$e==+qe+1)return[0,0]}else{if(ke)return[1,0];if(Ut)return[0,1]}else{if(+qe===y&&+qe==+$e+1)return[1,0];if(+$e===y&&+$e==+qe+1)return[0,1]}if(qe>$e&&qe>=y)return[1,0];if($e>qe&&$e>=y)return[0,1]}else if(Se[0].supertiebreak!==void 0&&Se[1].supertiebreak!==void 0){if(Se[0].supertiebreak>Se[1].supertiebreak+1&&Se[0].supertiebreak>=w)return[1,0];if(Se[1].supertiebreak>Se[0].supertiebreak+1&&Se[1].supertiebreak>=w)return[0,1]}return[0,0]}).reduce((Se,qe)=>[Se[0]+qe[0],Se[1]+qe[1]]):[0,0]}function Ve(ge=!0){if(!R.length)return;let Se=_e();if(+Se[0]==+Se[1]&&!De()&&!Ie()&&!ae()&&de()===void 0)return;let qe=Math.max(...Se),$e=Math.max(I,Math.floor(R.length/2)+1);if(qe<$e)return;const ke=Se[0]>=$e&&1||(Se[1]>=$e?2:void 0);if(ke===void 0&&!De()&&!Ie()&&!ae()&&de()===void 0){A(!1);return}return M.p1tiebreak.element.style.display!=="inline"&&ge&&A(!0),M[ke===1?"p1action":"p2action"].ddlb.setValue("winner"),M[ke===2?"p1action":"p2action"].ddlb.setValue(""),M[ke===2?"p1action":"p2action"].ddlb.lock(),B(ke-1),E=R.length,ke-1}function ot(ge){let Se=R.length;return+ge===R.length-1&&Se&&R[Se-1][0].supertiebreak!==void 0?R[Se-1]:!1}function St(ge,Se){return D?Ve(Se)!==void 0&&ot(ge)?!0:nt(ge):!1}function nt(ge){let Se=_e();if(+Se[0]==+Se[1]&&+Se[0]+1===I&&+ge==+R.length)return!0}function Bt(ge,Se,qe){return Se||P||ge===void 0?!1:R.length===0?!0:!((Ve(qe)!==void 0||de()!==void 0)&&(ge===void 0||+ge===R.length))}function Pe({selected_set:ge,tiebreak:Se,actions:qe}){C=St(ge,qe);let $e=Bt(ge,Se||C,qe);if(!$e&&!C&&(ge=R.length),E=Math.min(b-1,+ge),$e&&lt(),C&&!o){let ei=nt(ge);M.p1tiebreak.element.style.display="inline",M.p2tiebreak.element.style.display="inline",M.p1tiebreak.element.disabled=!1,M.p2tiebreak.element.disabled=!1,ei||(M.p1action.ddlb.setValue(" "),M.p2action.ddlb.setValue(" "),A(!1));let vi=ot(ge);vi&&(M.p1tiebreak.element.value=vi[0].supertiebreak,M.p2tiebreak.element.value=vi[1].supertiebreak)}let ke=R[ge],Ut=o?R:R.slice(0,+ge),pt=R.slice(+ge+1);o&&!R.length&&(Ut=[[{games:0},{games:0}]]);let tt=Ut.map((ei,vi)=>zM({setnum:vi,score:ei[0]})).join(""),At=Ut.map((ei,vi)=>zM({setnum:vi,score:ei[1]})).join("");M.p1scores.element.innerHTML=tt,M.p2scores.element.innerHTML=At,M.p1selector.ddlb.setValue(ke?ke[0].games+"":""),M.p2selector.ddlb.setValue(ke?ke[1].games+"":""),M.p1selector.element.style.display=$e&&!P&&!o?"flex":"none",M.p2selector.element.style.display=$e&&!P&&!o?"flex":"none",tt=pt.map((ei,vi)=>zM({setnum:+ge+1+vi,score:ei[0]})).join(""),At=pt.map((ei,vi)=>zM({setnum:+ge+1+vi,score:ei[1]})).join(""),M.p1scores_e.element.innerHTML=tt,M.p2scores_e.element.innerHTML=At}function et(){const ge=M.p1action.ddlb.getValue(),Se=M.p2action.ddlb.getValue(),qe=ge==="winner"&&1||Se==="winner"&&2||void 0;let $e=[1,2].includes(qe),ke=R.map(pt=>{if(pt[0].supertiebreak)return`[${pt[0].supertiebreak}-${pt[1].supertiebreak}]`;let tt=pt[0].tiebreak,At=pt[1].tiebreak,ei=tt!==void 0||At!==void 0?`(${[tt,At].filter(vi=>vi>=0).join("-")})`:"";return`${pt[0].games}-${pt[1].games}${ei}`}).join(" "),Ut;return[1,2].includes(qe)&&(Ut="COMPLETED"),(ge==="retired"||Se==="retired")&&(Ut="RETIRED"),(ge==="time"||Se==="time")&&(ke+=" TIME"),(ge==="walkover"||Se==="walkover")&&(Ut="WALKOVER",$e=!0),(ge==="defaulted"||Se==="defaulted")&&(Ut="DEFAULTED",$e=!0),(ge==="abandoned"||Se==="abandoned")&&(Ut="ABANDONED",$e=!0,ke=""),(ge==="interrupted"||Se==="interrupted")&&(Ut="SUSPENDED",$e=!1),(ge==="live"||Se==="live")&&(Ut="IN_PROGRESS",$e=!1),(ge==="cancelled"||Se==="cancelled")&&(Ut="CANCELLED",$e=!1),(ge==="incomplete"||Se==="incomplete")&&(Ut="ABANDONED",$e=!1),{matchUpStatus:Ut,winningSide:qe,complete:$e,score:ke}}function Ee(){P=!1,M.p1selector.ddlb.unlock(),M.p2selector.ddlb.unlock(),M.p1action.ddlb.unlock(),M.p2action.ddlb.unlock()}function lt(){M.p1tiebreak.element.value="",M.p2tiebreak.element.value="",M.p1tiebreak.element.style.display="none",M.p2tiebreak.element.style.display="none"}function Ke(ge,Se){let qe=M.p1action.ddlb.getValue(),$e=M.p2action.ddlb.getValue(),ke=Ve(),Ut=ge?qe:$e;if(m.auto_score=n.auto_score,Se===""){ke!==void 0&&(R=[],E=0,M[ge?"p2action":"p1action"].ddlb.setValue(" ")),M[ge?"p1action":"p2action"].ddlb.setValue(" "),Ee();let pt=R.length;if(pt){let tt=R[pt-1];!me(tt[0].games,tt[1].games)&&!re(tt[0].games,tt[1].games)&&(E=pt-1)}Pe({selected_set:E})}else["interrupted","cancelled","incomplete","abandoned"].indexOf(Se)>=0?(M[ge?"p1action":"p2action"].ddlb.setValue(" "),Pe({selected_set:E}),A(!0)):Se==="live"?(m.auto_score=!1,M[ge?"p1action":"p2action"].ddlb.setValue(" "),Pe({selected_set:E}),A(!0)):Se==="winner"&&Ut==="winner"?(ke===void 0&&M[ge?"p1action":"p2action"].ddlb.setValue("retired"),Pe({selected_set:E}),A(!0)):["time","retired","walkover","defaulted"].indexOf(Se)>=0?(A(!0),ke!==void 0?(M[ke?"p2action":"p1action"].ddlb.setValue("winner"),M[ke?"p1action":"p2action"].ddlb.setValue(" "),M[ke?"p2action":"p1action"].ddlb.unlock(),M[ke?"p1action":"p2action"].ddlb.lock()):(M.p1tiebreak.element.disabled=!1,M.p2tiebreak.element.disabled=!1,M[ge?"p1action":"p2action"].ddlb.setValue("winner"),M[ge?"p1action":"p2action"].ddlb.unlock(),M[ge?"p2action":"p1action"].ddlb.lock(),(Se==="time"||Se==="retired"||Se==="defaulted")&&(ke!==void 0&&M[ge?"p2action":"p1action"].ddlb.setValue(" "),E=R.length),(Se==="time"||Se==="retired")&&!R.length&&M[ge?"p2action":"p1action"].ddlb.setValue("walkover"),Se==="walkover"&&(R=[],E=0),Pe({selected_set:E}))):Se==="winner"&&(ke===void 0?M[ge?"p1action":"p2action"].ddlb.setValue(R.length?"retired":"walkover"):M[ge?"p1action":"p2action"].ddlb.setValue(" "),M[ge?"p1action":"p2action"].ddlb.lock(),P=!0,M.p1selector.ddlb.lock(),M.p2selector.ddlb.lock(),Pe({selected_set:E}))}function bt({sobj:ge,changeFx:Se}){hs.attachDropDown({id:ge.bestof.id,options:ke(r.bestof)}),ge.bestof.ddlb=new hs.DropDown({element:ge.bestof.element,id:ge.bestof.id,onChange:Ut}),ge.bestof.ddlb.setValue(b,"white"),hs.attachDropDown({id:ge.setsto.id,options:ke(r.setsto)}),ge.setsto.ddlb=new hs.DropDown({element:ge.setsto.element,id:ge.setsto.id,onChange:At}),ge.setsto.ddlb.setValue(y,"white");let qe=y,$e=tt(qe);hs.attachDropDown({id:ge.tiebreaksat.id,options:$e}),ge.tiebreaksat.ddlb=new hs.DropDown({element:ge.tiebreaksat.element,id:ge.tiebreaksat.id,onChange:ei}),ge.tiebreaksat.ddlb.setValue(v&&v<qe?v:qe,"white"),ge.tiebreaksat.ddlb.setValue(v||"","white"),hs.attachDropDown({id:ge.tiebreaksto.id,options:ke(r.tiebreaksto)}),ge.tiebreaksto.ddlb=new hs.DropDown({element:ge.tiebreaksto.element,id:ge.tiebreaksto.id,onChange:vi}),ge.tiebreaksto.ddlb.setValue(S,"white"),hs.attachDropDown({id:ge.finalset.id,options:[{key:Bo.tr("scoring.normal"),value:"N"},{key:Bo.tr("scoring.supertiebreak"),value:"S"}]}),ge.finalset.ddlb=new hs.DropDown({element:ge.finalset.element,id:ge.finalset.id,onChange:Ln}),ge.finalset.ddlb.selectionBackground(),ge.finalset.ddlb.setValue(D?"S":"N","white"),hs.attachDropDown({id:ge.supertiebreakto.id,options:ke(r.supertiebreakto)}),ge.supertiebreakto.ddlb=new hs.DropDown({element:ge.supertiebreakto.element,id:ge.supertiebreakto.id,onChange:gn}),ge.supertiebreakto.ddlb.selectionBackground(),ge.supertiebreakto.ddlb.setValue(w||10,"white"),pt(D);function ke(Jt){return!Jt||!Array.isArray(Jt)?{}:Jt.map(kr=>({key:kr,value:kr}))}function Ut(Jt){b=parseInt(Jt),I=Math.ceil(Jt/2),D=!1,ge.finalset.ddlb.setValue("N","white"),pt(D),typeof Se=="function"&&Se()}function pt(Jt){ge.stb2.element.style.opacity=Jt?1:0,ge.supertiebreakto.element.style.opacity=Jt?1:0}function tt(Jt){return[{key:Bo.tr("none"),value:""},{key:`${Jt-1}-${Jt-1}`,value:Jt-1},{key:`${Jt}-${Jt}`,value:Jt}]}function At(Jt){y=parseInt(Jt),v=parseInt(Jt);let kr=tt(Jt);ge.tiebreaksat.ddlb.setOptions(kr),ge.tiebreaksat.ddlb.setValue(Jt,"white"),typeof Se=="function"&&Se()}function ei(Jt){v=parseInt(Jt),typeof Se=="function"&&Se()}function vi(Jt){S=parseInt(Jt),typeof Se=="function"&&Se()}function Ln(Jt){w=ge.supertiebreakto.ddlb.getValue()||10,D=Jt==="S"?{tiebreakTo:w}:!1,pt(D),typeof Se=="function"&&Se()}function gn(Jt){w=parseInt(Jt),typeof Se=="function"&&Se()}}},t}();function zM({setnum:t,score:e={games:0}}){let i=e.tiebreak!==void 0&&e.tiebreak||e.spacer!==void 0&&e.spacer||"",n=e.supertiebreak!==void 0?e.supertiebreak:e.games;return`
      <div class="set score set_number setClick" setnum="${t!==void 0?t:""}">
         <div class="setscore setClick">${n}</div>
         <div class="tbscore" ${e.spacer!==void 0?'style="opacity: 0"':""}>${i}</div>
      </div>
   `}function Hat(t){if(!t)return"";if(t.status)return t.status;if(!t.schedule)return"";let e=qat(t.schedule);if(e)return`Duration ${e}`;let i=`${t.schedule.time_prefix||""}${t.schedule.time||""}`,n=`${t.schedule.court||""}${i?" / "+i:""}`;return t.winner_index===void 0?n:""}const zat=(t,e)=>{let i=parseInt(t,10),n=Math.floor(i/3600),r=Math.floor((i-n*3600)/60),a=i-n*3600-r*60,o=!e||(e==null?void 0:e.display_seconds),s=!e||(e==null?void 0:e.pad_hours);return n<10&&s&&(n="0"+n),r<10&&(r="0"+r),a<10&&(a="0"+a),o?n+":"+r+":"+a:n+":"+r};function qat(t){if(!t.start||!t.end)return"";let e=$Q(t.end)-$Q(t.start);return zat(e,{pad_hours:!1,display_seconds:!1})}function $Q(t){let e=t.split(":");return e[0]*60*60+e[1]*60}function nB({matchUpId:t,callback:e}){var o;const{matchUp:i}=at.findMatchUp({matchUpId:t}),n=s=>{const{matchUpStatus:l,winningSide:c,score:u}=s,d=u&&at.parseScoreString({scoreString:u}),p=[{method:s9,params:{allowChangePropagation:!0,drawId:i.drawId,outcome:{score:{sets:d},matchUpStatus:l,winningSide:c},matchUpId:t}}];Wt({methods:p,callback:f=>{yI(),Nt(e)&&e({...f,outcome:s})}})},r=i.sides.map(s=>s.participant),a=((o=i.score)==null?void 0:o.sets)||[];Gat.setMatchScore({delegation:ln.scoring.delegation,round_name:i.roundName||"",matchFormat:i.matchUpFormat,callback:n,muid:i.matchUpId,existing_scores:a,teams:r})}function Wat(t,e){const i=e.getRow(),n=i.getData(),{matchUpId:r,readyToScore:a}=n;a&&nB({matchUpId:r,callback:s=>{var l;if(s.success){const{matchUpStatus:c,sets:u,matchUpFormat:d,score:p,winningSide:h}=s.outcome;Object.assign(n,{matchUpStatus:c,sets:u,matchUpFormat:d,score:p}),n.winningSide=h&&`side${h}`,i.update(n),e.getTable().redraw(!0);const m=(l=s.results.find(({methodName:g})=>g===s9))==null?void 0:l.tieMatchUpResult;oot(m)}else console.log({result:s})}})}function Kat({matchUp:t}){var r,a,o,s,l,c;const e=((o=(a=(r=t.sides)==null?void 0:r.find(u=>u.sideNumber===1))==null?void 0:a.participant)==null?void 0:o.participantName)||"Side 1",i=((c=(l=(s=t.sides)==null?void 0:s.find(u=>u.sideNumber===2))==null?void 0:l.participant)==null?void 0:c.participantName)||"Side 2",n=(u,d)=>{var p;return(p=u==null?void 0:u.participantName)==null?void 0:p.localeCompare(d==null?void 0:d.participantName)};return[{formatter:mQ(jM(t)),cellClick:(u,d)=>jM(t)({event:u,cell:d}),sorter:n,title:e,responsive:!1,minWidth:100,field:"side1",widthGrow:2},{formatter:mQ(jM(t)),cellClick:(u,d)=>jM(t)({event:u,cell:d}),sorter:n,title:i,responsive:!1,minWidth:100,field:"side2",widthGrow:2},{formatter:N9,cellClick:Wat,responsive:!1,title:"Score",field:"score",width:140},{field:"matchUpStatus",title:"Status",width:150}]}function Yat({matchUp:t,tableElement:e,collectionMatchUps:i}){const n=i.map(o=>OU({...o,dualMatchUp:t})),r=Kat({matchUp:t});return{table:new Go(e,{responsiveLayoutCollapseStartOpen:!1,responsiveLayout:"collapse",placeholder:"No matches",reactiveData:!0,layout:"fitColumns",index:"matchUpId",columns:r,data:n})}}function nDe({side1:t,side2:e,side1Score:i,side2Score:n}){const r=document.createElement("div");r.className="overlay-content-overview";const a=document.createElement("div");a.className="overlay-content-body";const o=Zat({side1Score:i,side2Score:n});return a.appendChild(t),a.appendChild(o),a.appendChild(e),r.appendChild(a),r}function uk({participantName:t,justify:e="start"}){const i=document.createElement("div");i.className=`matchup-side justify-${e}`;const n=document.createElement("div");return n.className="side-name",n.innerHTML=t,i.appendChild(n),i}function Zat({side1Score:t,side2Score:e}){const i=document.createElement("div");i.className="score-box";const n=document.createElement("div");n.className="score-flex";const r=document.createElement("div");return r.className="score-vs",r.innerHTML="vs",n.appendChild(t),n.appendChild(r),n.appendChild(e),i.appendChild(n),i}function dk({winningSide:t,sets:e,sideNumber:i,id:n}){var l;const r=`side${i}Score`,a=((l=e==null?void 0:e[0])==null?void 0:l[r])||0,o=document.createElement("span");return n&&(o.id=n),o.className="side-score",i===1?o.style.paddingLeft="1rem":o.style.paddingRight="1rem",i===t&&o.classList.add("has-text-success"),o.innerHTML=a,o}let rDe;function aDe({title:t,content:e,footer:i}={}){if(!e||!i)return;const n=document.getElementById(QD);n&&as(n);const r=document.createElement("div");r.className="overlay noselect",r.id=QD;const a=document.createElement("div");a.className="overlay-center-align",r.appendChild(a);const o=document.createElement("div");if(o.className="overlay-root",a.appendChild(o),t){const u=Jat({title:t});o.appendChild(u)}const s=document.createElement("div");s.className="overlay-content",typeof e=="string"?s.innerHTML=e:e&&s.appendChild(e),o.appendChild(s);const l=document.createElement("div");l.className="overlay-footer",typeof i=="string"?l.innerHTML=i:i&&l.appendChild(i),o.appendChild(l),document.body.appendChild(r),rDe=window.scrollY||document.documentElement.scrollTop;const c=document.getElementById("root");c.style.display=Mt}function Xat({content:t}){var i,n;const e=(n=(i=document.getElementById(QD))==null?void 0:i.getElementsByClassName("overlay-content"))==null?void 0:n[0];e&&(as(e),typeof t=="string"?e.innerHTML=t:t&&e.appendChild(t))}function Jat({title:t}){const e=document.createElement("h2");return e.className="overlay-header",e.innerHTML=`
    <div class="overlay-header-content">
      <h1 class="overlay-title">${t}</h1> 
    </div>
  `,e}function oDe(){const t=document.getElementById("root");t.style.display="inline",window.scrollTo({top:rDe});let e=document.getElementById(QD);as(e);let i=0;for(;i<5&&e;)e.remove(),i+=1,e=document.getElementById(QD)}const sDe=[{key:"custom",name:"Custom",desc:""},{key:"standard",name:"Standard Advantage",format:"SET3-S:6/TB7",desc:"Best of 3 Sets to 6 with Advantage"},{key:"atpd",name:"Standard Doubles",format:"SET3-S:6/TB7-F:TB10",desc:"Best of 3 Sets to 6, no Ad",desc2:"Final Set Tiebreak to 10"},{key:"standard1",name:"One Standard Set",format:"SET1-S:6/TB7",desc:"1 Set to 6 Games, Tiebreak to 7"},{key:"wimbledon2018",name:"Wimbledon 2018",format:"SET5-S:6/TB7-F:6",desc:"Best of 5 tiebreak sets, final set no tiebreak"},{key:"wimbledon2019",name:"Wimbledon 2019",format:"SET5-S:6/TB7-F:6/TB7@12",desc:"Best of 5 tiebreak sets, final set tiebreak at 12"},{key:"Aus2019",name:"Australian Open 2019",format:"SET5-S:6/TB7-F:6/TB10",desc:"Best of 5 tiebreak sets, final set tiebreak at 12"},{key:"short",name:"Short Sets TB7@4",format:"SET3-S:4/TB7",desc:"Best of 3 Sets to 4, tiebreak to 7 at 4-4"},{key:"short1",name:"Fast 4",format:"SET3-S:4/TB5@3",desc:"Best of 3 Sets to 4, tiebreak to 5 at 3-3"},{key:"short2",name:"One Short Set TB7",format:"SET1-S:4/TB7",desc:"One Set to 4, tiebreak to 7 at 4-4"},{key:"short3",name:"One Short Set TB5",format:"SET1-S:4/TB5@3",desc:"One Set to 4, tiebreak to 5 at 3-3"},{key:"short4",name:"Short Sets w/ 3rd TB10",format:"SET3-S:4/TB7-F:TB10",desc:"Best of 3 Sets to 4 Games, tiebreak to 10",desc2:"3rd Set Tiebreak to 7"},{key:"short5",name:"Short Sets w/ 3rd TB7",format:"SET3-S:4/TB7-F:TB7",desc:"Best of 3 Sets to 4 Games, tiebreak to 7",desc2:"3rd Set Tiebreak to 7"},{key:"pro",name:"Pro Set",format:"SET1-S:8/TB7",desc:"One Set to 8 with Advantage, tiebreak at 8-8"},{key:"cps",name:"College Pro Set",format:"SET1-S:8/TB7@7"},{key:"tbsets1",name:"Best of 3 TB7",format:"SET3-S:TB7",desc:"Two tiebreak sets",desc2:"7-point match tiebreak at one set all"},{key:"tbsets2",name:"Best of 3 TB10",format:"SET3-S:TB10",desc:"Best of 3 tiebreaks to 10"},{key:"tbsets3",name:"One Tiebreak to 10",format:"SET1-S:TB10",desc:"One Match Tiebreak to 10 with Advantage"},{key:"tbsets4",name:"Two TB7 w/ 3rd TB10",format:"SET3-S:TB7-F:TB10",desc:"Two 7 point tiebreak sets",desc2:"10 point tiebreak at one set all"},{key:"timed10",name:"Timed 10 minute game - game based",format:"SET1-S:T10"}];let nb,Ya;const aA="Timed set",C1="Tiebreak",BG="No-Ad",cu="Set",rD="Ad",Vs={setFormat:{descriptor:"Best of",bestOf:3,advantage:rD,what:cu,setTo:6,tiebreakAt:6,tiebreakTo:7,winBy:2,minutes:10},finalSetFormat:{descriptor:"Final set",advantage:rD,what:cu,setTo:6,tiebreakAt:6,tiebreakTo:7,winBy:2,minutes:10}};function VQ(t){var a;const e=t?"finalSetFormat":"setFormat",i=Vs[e].what,n={setTo:Vs[e].setTo};return i===cu&&Vs[e].advantage===BG&&(n.NoAD=!0),i===cu&&((a=document.getElementById(t?"finalSetTiebreak":"setTiebreak"))==null?void 0:a.checked)&&(n.tiebreakAt=Vs[e].tiebreakAt,n.tiebreakFormat={tiebreakTo:Vs[e].tiebreakTo},i===cu&&Vs[e].winBy===1&&(n.tiebreakFormat.NoAD=!0)),i===aA&&(n.minutes=Vs[e].minutes,n.timed=!0),i===C1&&(n.tiebreakSet={tiebreakTo:Vs[e].tiebreakTo},Vs[e].winBy===1&&(n.tiebreakSet.NoAD=!0)),n}function lDe(){var o;const t=VQ();Ya={bestOf:Vs.setFormat.bestOf,setFormat:t},((o=document.getElementById("finalSetOption"))==null?void 0:o.checked)&&(Ya.finalSetFormat=VQ(1));const i=_k.scoreGovernor.stringifyMatchUpFormat(Ya),n=!!sDe.find(s=>s.format===i),r=document.getElementById("matchUpFormatSelector"),a=r==null?void 0:r.querySelectorAll("option");return Array.from(a).forEach(s=>{s.selected=!n&&s.value==="Custom"||s.value===i}),i}function P1(t){const e=t||lDe(),i=document.getElementById("matchUpFormatString");i.innerHTML=e}const rb=(t,e)=>e&&t.finalSetFormat||t.setFormat,b0=[{getValue:t=>t.bestOf>1?"Best of":"Exactly",options:["Best of","Exactly"],id:"descriptor",value:"Best of",finalSet:!1},{getValue:t=>t.bestOf,finalSet:!1,id:"bestOf",options:[1,3,5],onChange:"pluralize",value:3},{getValue:(t,e)=>{const i=rb(t,e),n=i!=null&&i.NoAD?BG:rD;return i!=null&&i.timed||i!=null&&i.tiebreakSet?void 0:n},options:[rD,BG],defaultValue:rD,id:"advantage",whats:[cu]},{getValue:(t,e)=>{const i=rb(t,e);return i||console.log({pmf:t}),i!=null&&i.timed?aA:i!=null&&i.tiebreakSet?C1:cu},options:[cu,C1,aA],finalSetLabel:`${cu}${df}`,onChange:"changeWhat",pluralize:!0,id:"what"},{getValue:(t,e)=>rb(t,e).setTo,options:[1,2,3,4,5,6,7,8,9],onChange:"changeCount",defaultValue:6,whats:[cu],prefix:"to ",id:"setTo"},{getValue:(t,e)=>{var n,r;const i=rb(t,e);return((n=i.tiebreakFormat)==null?void 0:n.tiebreakTo)||((r=i.tiebreakSet)==null?void 0:r.tiebreakTo)},options:[5,7,9,10,12],whats:[cu,C1],id:"tiebreakTo",defaultValue:7,prefix:"TB to ",tbSet:!0,value:7,tb:!0},{getValue:(t,e)=>rb(t,e).tiebreakAt,options:t=>{const e=Vs[t?"finalSetFormat":"setFormat"].setTo;return e>1?[e-1,e]:[]},id:"tiebreakAt",defaultValue:6,whats:[cu],prefix:"@",value:6,tb:!0},{getValue:(t,e)=>{var n;const i=rb(t,e);if(i.tiebreakFormat)return(n=i.tiebreakFormat)!=null&&n.NoAD?1:2},whats:[cu,C1],prefix:"Win by ",options:[1,2],defaultValue:2,tbSet:!0,id:"winBy",tb:!0},{getValue:(t,e)=>{const i=rb(t,e);return i.timed&&i.minutes||void 0},options:[10,15,20,25,30,45,60,90],whats:[aA],suffix:" Minutes",defaultValue:10,id:"minutes",timed:!0}],jQ={changeWhat:(t,e,i)=>{const n=i===cu,r=e?"finalSetTiebreakToggle":"setTiebreakToggle",a=document.getElementById(r);a.style.display=n?"":Mt,b0.forEach(o=>{if(o.whats){const{prefix:s="",suffix:l="",pluralize:c}=o,u=o.whats.includes(i),d=e?`${o.id}-${e}`:o.id,p=document.getElementById(d);if(p.style.display===Mt&&u){const h=Ya.bestOf,f=!e&&c&&h>1?"s":"",m=o.defaultValue;p.innerHTML=`${s}${m}${f}${l}${df}`}p.style.display=u?"":Mt}})},changeCount:(t,e,i)=>{const n=e?`tiebreakAt-${e}`:"tiebreakAt";Vs[e?"finalSetFormat":"setFormat"].tiebreakAt=i;const r=document.getElementById(n);r.innerHTML=`@${i}${df}`},pluralize:(t,e,i)=>{const n=Vs[e?"finalSetFormat":"setFormat"].what,r=e?`what-${e}`:"what",a=document.getElementById(r),o=i>1?"s":"";a.innerHTML=`${n}${o}${df}`}};function B9({existingMatchUpFormat:t="SET3-S:6/TB7",callback:e}={}){var T;nb=t,Ya=_f.parse(nb);const i=()=>{const w=lDe();Nt(e)&&e(w)};let n,r,a,o,s;const l=[{onClick:()=>e(),label:"Cancel",intent:"none",close:!0},{label:"Select",intent:"is-info",close:!0,onClick:i}],c="switch is-rounded is-danger",u=document.createElement("div"),d=document.createElement("div");d.id="matchUpFormatString",d.innerHTML=nb,d.style.fontSize="1.5em",d.style.color="blue",d.style.marginBottom="1em",u.appendChild(d);const p=document.createElement("div");p.style.marginBlockEnd="1em";const h={id:"matchUpFormatSelector",options:sDe.map(w=>({selected:w.format===nb,value:w.format,label:w.name}))},{field:f,inputElement:m}=W1(h);m.onchange=w=>{nb=w.target.value,P1(nb),Ya=_f.parse(nb),Vs.setFormat=Ya.setFormat,Vs.setFormat.bestOf=Ya.bestOf,Ya.finalSetFormat&&(Vs.finalSetFormat=Ya.finalSetFormat);const S=Ya.finalSetFormat;n.style.display=S?"":Mt,r.style.display=S?"":Mt,a.checked=S,s.checked=!!(S!=null&&S.tiebreakFormat),o.checked=Ya.setFormat.tiebreakFormat,b0.forEach(D=>{if(D.getValue){const E=D.getValue(Ya),C=document.getElementById(D.id);if(C&&E){const{prefix:P="",suffix:R="",pluralize:N}=D,M=Ya.bestOf,A=N&&M>1?"s":"";C.innerHTML=`${P}${E}${A}${R}${df}`,C.style.display=""}else C&&(C.style.display=Mt);if(S){const P=D.getValue(Ya,!0),R=document.getElementById(`${D.id}-1`);if(R&&P){const{prefix:N="",suffix:M="",pluralize:A}=D,_=Ya.bestOf,x=A&&_>1?"s":"";R.innerHTML=`${N}${P}${x}${M}${df}`,R.style.display=""}else R&&(R.style.display=Mt)}}})},p.appendChild(f),u.appendChild(p);const g=document.createElement("div");b0.map(w=>{const S=w.getValue(Ya);return GQ({...w,value:S})}).forEach(w=>g.appendChild(w)),g.id="setFormat",u.appendChild(g);const v=document.createElement("div");v.className="field",v.style.fontSize="1em",o=document.createElement("input"),o.className=c,o.name="setTiebreak",o.id="setTiebreak",o.type="checkbox",o.checked=Ya.tiebreakFormat,o.onchange=w=>{const S=w.target.checked;b0.filter(({tb:D})=>D).forEach(D=>{const E=document.getElementById(D.id);if(E.style.display===Mt&&S){const{prefix:C="",suffix:P="",pluralize:R,defaultValue:N}=D,M=Ya.bestOf,A=R&&M>1?"s":"";E.innerHTML=`${C}${N}${A}${P}${df}`}E.style.display=S?"":Mt}),P1()},v.appendChild(o);const y=document.createElement("label");y.setAttribute("for","setTiebreak"),y.id="setTiebreakToggle",y.innerHTML="Tiebreak",y.style.marginRight="1em",v.appendChild(y),a=document.createElement("input"),a.className="switch is-rounded is-info",a.type="checkbox",a.name="finalSetOption",a.checked=!!Ya.finalSetFormat,a.id="finalSetOption",a.onchange=w=>{const S=w.target.checked;n.style.display=S?"":Mt,r.style.display=S?"":Mt,P1()},v.appendChild(a);const b=document.createElement("label");b.setAttribute("for","finalSetOption"),b.innerHTML="Final set",v.appendChild(b),u.appendChild(v),n=document.createElement("div"),n.style.display=Ya.finalSetFormat?"":Mt,n.id="finalSetFormat",[{label:"<div style='font-weight: bold'>Final set</div>",options:[]}].concat(b0.map(w=>{const S=w.getValue(Ya,!0);return{...w,value:S}})).filter(w=>w.finalSet!==!1).map(w=>GQ({...w,index:1})).forEach(w=>n.appendChild(w)),u.appendChild(n),r=document.createElement("div"),r.style.display=Ya.finalSetFormat?"":Mt,r.className="field",r.style.fontSize="1em",s=document.createElement("input"),s.className=c,s.name="finalSetTiebreak",s.id="finalSetTiebreak",s.type="checkbox",s.checked=(T=Ya.finalSetFormat)==null?void 0:T.tiebreakFormat,r.onchange=w=>{const S=w.target.checked;b0.filter(({tb:D})=>D).forEach(D=>{const E=document.getElementById(`${D.id}-1`);if(E.style.display===Mt&&S){const{prefix:C="",suffix:P="",pluralize:R,defaultValue:N}=D,M=Ya.bestOf,A=R&&M>1?"s":"";E.innerHTML=`${C}${N}${A}${P}${df}`}E.style.display=S?"":Mt}),P1()},r.appendChild(s);const I=document.createElement("label");I.setAttribute("for","finalSetTiebreak"),I.id="finalSetTiebreakToggle",I.innerHTML="Tiebreak",I.style.marginRight="1em",r.appendChild(I),u.appendChild(r),cr({title:"Score format",content:u,buttons:l})}function Qat({index:t,finalSetLabel:e,label:i,prefix:n="",suffix:r="",value:a,pluralize:o}){const s=!t&&o&&Vs.setFormat.bestOf>1?"s":"";return i||t&&e||`${n}${a}${s}${r}${df}`}function GQ(t){const{id:e,initiallyHidden:i,index:n,value:r}=t,a=document.createElement("button");return a.className="mfcButton",a.id=n?`${e}-${n}`:e,a.innerHTML=Qat(t),a.onclick=o=>eot({e:o,button:a,...t}),a.style.display=r||t.label?"":Mt,i&&(a.style.display=Mt),a}function eot(t){const{e,id:i,button:n,pluralize:r,options:a,onChange:o,index:s,prefix:l="",suffix:c=""}=t,u=Vs.setFormat.bestOf,d=!s&&r&&u>1?"s":"",h=(Nt(a)?a(s):a).map(f=>({text:`${f}${d}`,onClick:()=>{n.innerHTML=`${l}${f}${d}${c}${df}`,o&&Nt(jQ[o])&&jQ[o](e,s,f),Vs[s?"finalSetFormat":"setFormat"][i]=f,P1()}}));pc({items:h,target:e.target,config:{arrow:!1,offset:[0,0]}})}function tot(){return[{rowHandle:!0,formatter:"handle",width:30,minWidth:30},{cellClick:(e,i)=>i.getRow().toggleSelect(),titleFormatter:"rowSelection",formatter:"rowSelection",responsive:!1,hozAlign:ci,width:5},{formatter:"responsiveCollapse",responsive:!1,resizable:!1,hozAlign:li,width:50},{editorParams:{selectContents:!0},field:"collectionName",minWidth:200,title:"Name",editor:!0},{field:"matchUpCount",editor:"number",title:"#",width:70,editorParams:{elementAttributes:{maxlength:2},selectContents:!0,mask:"99",step:1,max:20,min:0}},{field:"matchUpType",editor:"list",title:"Type",width:100,editorParams:{values:["Singles","Doubles"]}},{title:"Gender",field:"gender",editor:"list",width:100,editorParams:{values:["Male","Female","Any"]}},{cellClick:(e,i)=>{const n=i.getRow(),r=n.getData();B9({callback:o=>{o&&(Object.assign(r,{matchUpFormat:o}),n.update(r),i.getTable().redraw(!0))},existingMatchUpFormat:r.matchUpFormat})},title:"Score format",field:D4,minWidth:150},{title:"Award type",field:"awardType",editor:"list",width:150,editorParams:{values:[w4,S4,U4,T4]}},{field:"awardValue",editor:"number",title:"Value",width:70,editorParams:{elementAttributes:{maxlength:2},selectContents:!0,mask:"99",step:1,max:99,min:0}}]}function HQ(t){return(t==null?void 0:t[0].toUpperCase())+(t==null?void 0:t.substring(1).toLowerCase())||""}function iot({tableElement:t,tieFormat:e}){var a;const i=(((a=e==null?void 0:e.collectionDefinitions)==null?void 0:a.sort((o,s)=>o.collectionOrder-s.collectionOrder))||[]).map(o=>{const{collectionValue:s,matchUpValue:l,scoreValue:c,setValue:u,matchUpType:d,gender:p}=o,h=_i.isConvertableInteger(s)&&w4||_i.isConvertableInteger(c)&&T4||_i.isConvertableInteger(u)&&U4||S4,f=s??c??u??l;return{...o,matchUpType:HQ(d),gender:HQ(p),awardValue:f,awardType:h}}),n=tot();return{table:new Go(t,{responsiveLayoutCollapseStartOpen:!1,columnDefaults:{headerSort:!1},placeholder:"No collections",responsiveLayout:"collapse",index:"collectionId",reactiveData:!0,layout:"fitColumns",movableRows:!0,minHeight:200,columns:n,data:i})}}function cDe(t){var r,a,o;const e=(r=t==null?void 0:t.winCriteria)==null?void 0:r.valueGoal,i=(a=t==null?void 0:t.collectionDefinitions)!=null&&a.length?((o=t==null?void 0:t.winCriteria)==null?void 0:o.aggregateValue)&&"Aggregate value":"none";return`<div style="font-weight: bold">Win criteria: <span class="has-text-success">${e||i}</span></div>`}function uDe({title:t,tieFormat:e,onClose:i}){const{content:n,inputs:r,elements:a,table:o}=not({tieFormat:e}),s=u=>{const d=r.tieFormatName.value,p=u.map(f=>_i.definedAttributes({collectionValue:f.awardType===w4?f.awardValue:void 0,matchUpValue:f.awardType===S4?f.awardValue:void 0,scoreValue:f.awardType===T4?f.awardValue:void 0,setValue:f.awardType===U4?f.awardValue:void 0,matchUpType:f.matchUpType.toUpperCase(),collectionName:f.collectionName,matchUpFormat:f.matchUpFormat,gender:f.gender.toUpperCase(),collectionId:f.collectionId,matchUpCount:f.matchUpCount})),h=at.calculateWinCriteria({collectionDefinitions:p});return{collectionDefinitions:p,tieFormatName:d,winCriteria:h}};o.on("dataChanged",()=>{const u=s(o.getData());a.winCriteria.innerHTML=cDe(u)});const c=aot({table:o,onClose:u=>{var p;const d=s(u);Nt(i)&&i(((p=d==null?void 0:d.collectionDefinitions)==null?void 0:p.length)&&d)}});return aDe({title:t,content:n,footer:c})}function not({tieFormat:t}){const e=document.createElement("div");e.className="overlay-content-container",e.style.backgroundColor="white";const i=document.createElement("div"),{table:n}=iot({tieFormat:t,tableElement:i}),r=rot();e.appendChild(r);const a=document.createElement("div");e.appendChild(a),e.appendChild(i);const o=()=>{const u=n==null?void 0:n.getSelectedData().map(({collectionId:d})=>d);n==null||n.deleteRow(u)},s=[{value:(t==null?void 0:t.tieFormatName)||"Custom scorecard",error:"minimum of 5 characters",placeholder:"Scorecard name",validator:ta(5),field:"tieFormatName",id:"tieFormatName",location:ci},{text:cDe(t),id:"winCriteria",location:ci},{onClick:o,label:"Delete selected",intent:"is-danger",stateChange:!0,location:Ua},{onClick:()=>{const d={collectionName:`Collection ${n.getData().length+1}`,collectionId:_i.UUID(),awardType:"Match value",matchUpFormat:"SET3-S:6/TB7",matchUpType:"Singles",matchUpCount:1,gender:"Any",awardValue:1};n.addRow(d)},label:"Add collection",intent:"is-info",location:Qt}],{elements:l,inputs:c}=Ns({table:n,target:a,items:s});return{content:e,table:n,elements:l,inputs:c}}function rot(t){const e=document.createElement("div");e.className="overlay-content-overview";const i=document.createElement("div");return i.className="overlay-content-body",e.appendChild(i),e}function aot({table:t,onClose:e}){const i=()=>{t.destroy(),oDe()},n=document.createElement("button");n.className="button is-warning is-light",n.onclick=i,n.innerHTML="Cancel";const r=document.createElement("button");r.className="button is-info button-spacer",r.onclick=o=>{o.preventDefault(),o.stopPropagation();const s=t.getData();i(),Nt(e)&&e(s)},r.innerHTML="Done";const a=document.createElement("div");return a.className="overlay-footer-wrap",a.appendChild(n),a.appendChild(r),a}function dDe({matchUpId:t,structureId:e,eventId:i,drawId:n,callback:r}){const{tieFormat:a}=at.getTieFormat({structureId:e,matchUpId:t,eventId:i,drawId:n});uDe({title:"Edit scorecard",tieFormat:a,onClose:s=>{var l,c;if(s){(l=s.collectionDefinitions)==null||l.forEach((f,m)=>f.collectionOrder=m+1);const u={collectionName:!0,collectionOrder:!0};if(!((c=iP.compareTieFormats({descendant:s,ancestor:a,considerations:u}))==null?void 0:c.different)){ti({intent:"is-info",message:"No changes"});return}Wt({methods:[{method:aKe,params:{modifiedTieFormat:s,considerations:u,structureId:e,matchUpId:t,drawId:n}}],callback:f=>{var m;return f.success?(ti({intent:"is-success",message:"Scorecard updated"}),Nt(r)&&r()):ti({intent:"is-danger",message:((m=f.error)==null?void 0:m.message)||"Error"})}})}}})}const qM="has-text-success",pDe="tieSide1",hDe="tieSide2";function rB({title:t,drawId:e,matchUpId:i,onClose:n}){var l;const r=at.findMatchUp({drawId:e,matchUpId:i,participantsProfile:{withISO2:!0}}),a=r.matchUp;if(!a||r.error||!t||!Array.isArray((l=a==null?void 0:a.tieFormat)==null?void 0:l.collectionDefinitions))return;const o=aB({matchUp:a}),s=sot({title:t,drawId:e,matchUpId:i,onClose:n});return aDe({title:t,content:o,footer:s})}function aB({matchUp:t}){var d;const e=document.createElement("div");e.className="overlay-content-container";const i=uk({participantName:zQ({matchUp:t,sideNumber:1}),justify:"end"}),n=uk({participantName:zQ({matchUp:t,sideNumber:2}),justify:"start"}),{winningSide:r,score:a}=t,o=(a==null?void 0:a.sets)||[],s=dk({winningSide:r,sets:o,sideNumber:1,id:pDe}),l=dk({winningSide:r,sets:o,sideNumber:2,id:hDe}),c=nDe({side1:i,side2:n,side1Score:s,side2Score:l});e.appendChild(c),Tt.collectionTables||(Tt.collectionTables=[]);const u=((d=t.tieFormat.collectionDefinitions)==null?void 0:d.sort((p,h)=>p.collectionOrder-h.collectionOrder))||[];for(const p of u){const h=t.tieMatchUps.filter(y=>y.collectionId===p.collectionId),f=document.createElement("div");f.className="collection";const m=document.createElement("div");m.className="title is-4",m.innerHTML=p.collectionName,f.appendChild(m);const g=document.createElement("div");f.appendChild(g);const{table:v}=Yat({matchUp:t,tableElement:g,collectionMatchUps:h});Tt.collectionTables.push(v),e.appendChild(f)}return e}function oot(t){var r,a;const e=(a=(r=t==null?void 0:t.score)==null?void 0:r.sets)==null?void 0:a[0];if(!e)return;const i=document.getElementById(pDe),n=document.getElementById(hDe);i.classList.remove(qM),n.classList.remove(qM),i.innerHTML=e.side1Score,n.innerHTML=e.side2Score,t.winningSide===1&&i.classList.add(qM),t.winningSide===2&&n.classList.add(qM)}function zQ({matchUp:t,sideNumber:e}){var i,n;return(n=(i=t.sides.find(r=>r.sideNumber===e))==null?void 0:i.participant)==null?void 0:n.participantName}function sot({title:t,drawId:e,matchUpId:i,onClose:n}){const r=document.createElement("button");r.className="button is-warning is-light",r.onclick=()=>{dDe({matchUpId:i,drawId:e,callback:()=>rB({title:t,drawId:e,matchUpId:i,onClose:()=>console.log("closed")})})},r.innerHTML="Edit scorecard";const a=u=>{var d;if(u.success){const p=(d=at.findMatchUp({drawId:e,matchUpId:i}))==null?void 0:d.matchUp,h=aB({matchUp:p});Xat({content:h})}},o=document.createElement("button");o.className="button is-warning is-light button-spacer",o.innerHTML="Remove players",o.onclick=()=>{Wt({methods:[{params:{drawId:e,matchUpId:i,inheritance:!1},method:NTe}],callback:a})};const s=document.createElement("button");s.className="button is-info is-light button-spacer",s.innerHTML="Clear results",s.onclick=()=>{Wt({methods:[{params:{drawId:e,matchUpId:i},method:ATe}],callback:a})};const l=document.createElement("button");l.className="button is-info button-spacer",l.onclick=u=>{for(u.preventDefault(),u.stopPropagation();Tt.collectionTables.length;)Tt.collectionTables.pop().destroy();oDe(),Nt(n)&&n()},l.innerHTML="Done";const c=document.createElement("div");return c.className="overlay-footer-wrap",c.appendChild(r),c.appendChild(o),c.appendChild(s),c.appendChild(l),c}const{TEAM:lot}=Yo,cot=(t,e)=>(i,n)=>{var u;const r=n.getRow().getData(),{matchUpId:a,readyToScore:o,matchUpType:s,drawId:l,eventName:c}=r.matchUp;if(s===lot)rB({title:c,matchUpId:a,drawId:l,onClose:()=>t()});else if(o||(u=r.matchUp.score)!=null&&u.scoreStringSide1)if(ln.hotkeys){e({e:i,cell:n,replaceTableData:t});const d=document.querySelectorAll(".activeScoreCell");for(const p of Array.from(d))p.classList.remove("activeScoreCell");i.target.classList.contains("tabulator-cell")?i.target.firstChild.classList.add("activeScoreCell"):i.target.classList.add("activeScoreCell")}else nB({matchUpId:a,callback:t})};function fDe(t,e){if(!t.score&&!e.score){if(t.readyToScore&&!e.readyToScore)return-1;if(e.readyToScore&&!t.readyToScore)return 1}return t.score&&!e.score?-1:e.score&&!t.score?1:0}const qQ={fn:t=>({name:"dynamicContent",default:!0,onShow(){typeof t.props.dynContent=="function"&&t.setContent(t.props.dynContent(t.reference))}})},yb={"o-route":QT,"p-route":kf,"e-route":qp,"m-route":r4,"s-route":Qv,"v-route":a4},WQ={"o-route":"Overview","p-route":"Participants","e-route":"Events","m-route":"MatchUps","s-route":"Schedule","v-route":"Venues"};function uot(){var o,s,l,c;const t=`
  <div class="side-bar collapse">
    <ul class="features-list">
      <span class="features-item-text">Overview</span>
      <span class="features-item-text">Participants</span>
      <span class="features-item-text">Events</span>
      <span class="features-item-text">Matches</span>
      <span class="features-item-text">Schedule</span>
      <span class="features-item-text">Venues</span>
    </ul>
  </div>
`,e=document.getElementById("navText");e.innerHTML=t;const i=Object.keys(yb),n=(c=(l=(s=(o=Tt.router)==null?void 0:o.current)==null?void 0:s[0])==null?void 0:l.data)==null?void 0:c.selectedTab,r=u=>document.querySelector(".side-bar").classList.contains("collapse")?u:"",a=document.getElementById("o-route");fg(a,{dynContent:()=>!ln.device.isMobile&&r(WQ["o-route"]),onShow:u=>!!u.props.content,plugins:[qQ],placement:gp,arrow:!1}),i.forEach(u=>{const d=document.getElementById(u);fg(d,{dynContent:()=>!ln.device.isMobile&&r(WQ["o-route"]),onShow:p=>!!p.props.content,plugins:[qQ],placement:gp,arrow:!1}),(n===yb[u]||!n&&yb[u]===kf)&&(d.style.color="blue"),d.onclick=()=>{var f,m;document.querySelectorAll(".nav-icon").forEach(g=>g.style.color=""),d.style.color="blue";const p=(m=(f=at.getTournament())==null?void 0:f.tournamentRecord)==null?void 0:m.tournamentId,h=`/${Fo}/${p}/${yb[u]}`;Tt.router.navigate(h)}})}function $9(t){document.querySelectorAll(".nav-icon").forEach(i=>i.style.color=""),Object.keys(yb).forEach(i=>{const n=document.getElementById(i);(t===yb[i]||!t&&yb[i]===kf)&&(n.style.color="blue")})}function dot({data:t,replaceTableData:e,setFocusData:i}){const n=(c,u)=>{var m,g;const p=u.getRow().getData(),{courtName:h,scheduledDate:f}=p;if(h&&f){const v=(g=(m=at.getTournament())==null?void 0:m.tournamentRecord)==null?void 0:g.tournamentId,y=`/${Fo}/${v}/${Qv}/${f}`;Tt.router.navigate(y),$9(Qv)}},r=(c,u)=>{const d=u.getValue();p1e({time:d,callback:({time:h})=>{const m=_i.dateTime.convertTime(h,!0),g=u.getRow(),v=g.getData(),{matchUpId:y}=v;m!==d&&I1e({matchUpId:y,schedule:{scheduledTime:m},callback:()=>{console.log("callback"),g.update({...v,scheduledTime:m})}})}})},a=()=>e(),o=t.some(c=>c.courtName),s=(c,u)=>kE(c,u,a),l=c=>{const u=document.createElement("div");u.className="has-text-warning-dark",u.innerHTML="Select participant";const d=({event:h,...f})=>{kE(h,c,a,f)};return c.getValue().participantName&&Pw(d)(c,u)};return[{cellClick:(c,u)=>u.getRow().toggleSelect(),titleFormatter:"rowSelection",formatter:"rowSelection",headerSort:!1,responsive:!1,hozAlign:ci,width:5},{headerMenu:vm({duration:"Duration",complete:"Complete"}),formatter:"rownum",headerSort:!1,hozAlign:ci,width:55},{formatter:cet(ea),field:"eventId",title:"Event",visible:!0,minWidth:200,widthGrow:1},{title:"Flight",visible:!1,minWidth:150,field:"flight",widthGrow:1},{field:"matchUpType",titleFormatter:fQ,title:"Type",minWidth:90},{field:"roundName",title:"Round",titleFormatter:fQ,minWidth:90},{cellClick:n,field:"scheduledDate",title:"Date",width:110},{cellClick:n,visible:!!o,field:"courtName",title:"Court",width:100},{cellClick:r,field:"scheduledTime",visible:!0,title:"Time",width:70},{formatter:l,cellClick:s,sorter:iT,responsive:!1,title:"Side 1",minWidth:180,field:"side1",widthGrow:1},{formatter:l,cellClick:s,sorter:iT,responsive:!1,title:"Side 2",minWidth:180,field:"side2",widthGrow:1},{cellClick:cot(e,i),formatter:N9,sorter:fDe,field:"scoreDetail",responsive:!1,title:"Score",width:140},{sorter:y1e,formatter:b1e,field:"competitiveProfile",responsive:!1,title:"Profile",visible:!1,width:140},{title:"<div class='fa-solid fa-check' style='color: green' />",formatter:"tickCross",field:"complete",hozAlign:ci,tooltip:!1,width:40},{field:"matchUp.matchUpStatus",title:"Status",width:150},{title:"<div class='fa-solid fa-clock' style='color: blue' />",headerSort:!1,field:"duration",visible:!1,width:70},{cellClick:(c,u)=>A9({pointerEvent:c,cell:u,...u.getData()}),formatter:Hg,responsive:!1,headerSort:!1,hozAlign:Qt,widthGrow:0,width:50}]}const W$=typeof navigator<"u"?navigator.userAgent.toLowerCase().indexOf("firefox")>0:!1;function K$(t,e,i,n){t.addEventListener?t.addEventListener(e,i,n):t.attachEvent&&t.attachEvent("on".concat(e),i)}function d1(t,e,i,n){t.removeEventListener?t.removeEventListener(e,i,n):t.detachEvent&&t.detachEvent("on".concat(e),i)}function mDe(t,e){const i=e.slice(0,e.length-1);for(let n=0;n<i.length;n++)i[n]=t[i[n].toLowerCase()];return i}function gDe(t){typeof t!="string"&&(t=""),t=t.replace(/\s/g,"");const e=t.split(",");let i=e.lastIndexOf("");for(;i>=0;)e[i-1]+=",",e.splice(i,1),i=e.lastIndexOf("");return e}function pot(t,e){const i=t.length>=e.length?t:e,n=t.length>=e.length?e:t;let r=!0;for(let a=0;a<i.length;a++)n.indexOf(i[a])===-1&&(r=!1);return r}const $E={backspace:8,"":8,tab:9,clear:12,enter:13,"":13,return:13,esc:27,escape:27,space:32,left:37,up:38,right:39,down:40,del:46,delete:46,ins:45,insert:45,home:36,end:35,pageup:33,pagedown:34,capslock:20,num_0:96,num_1:97,num_2:98,num_3:99,num_4:100,num_5:101,num_6:102,num_7:103,num_8:104,num_9:105,num_multiply:106,num_add:107,num_enter:108,num_subtract:109,num_decimal:110,num_divide:111,"":20,",":188,".":190,"/":191,"`":192,"-":W$?173:189,"=":W$?61:187,";":W$?59:186,"'":222,"[":219,"]":221,"\\":220},Wf={"":16,shift:16,"":18,alt:18,option:18,"":17,ctrl:17,control:17,"":91,cmd:91,command:91},$G={16:"shiftKey",18:"altKey",17:"ctrlKey",91:"metaKey",shiftKey:16,ctrlKey:17,altKey:18,metaKey:91},yl={16:!1,18:!1,17:!1,91:!1},To={};for(let t=1;t<20;t++)$E["f".concat(t)]=111+t;let Oa=[],aD=null,vDe="all";const Am=new Map,iM=t=>$E[t.toLowerCase()]||Wf[t.toLowerCase()]||t.toUpperCase().charCodeAt(0),hot=t=>Object.keys($E).find(e=>$E[e]===t),fot=t=>Object.keys(Wf).find(e=>Wf[e]===t);function yDe(t){vDe=t||"all"}function VE(){return vDe||"all"}function mot(){return Oa.slice(0)}function got(){return Oa.map(t=>hot(t)||fot(t)||String.fromCharCode(t))}function vot(){const t=[];return Object.keys(To).forEach(e=>{To[e].forEach(i=>{let{key:n,scope:r,mods:a,shortcut:o}=i;t.push({scope:r,shortcut:o,mods:a,keys:n.split("+").map(s=>iM(s))})})}),t}function yot(t){const e=t.target||t.srcElement,{tagName:i}=e;let n=!0;const r=i==="INPUT"&&!["checkbox","radio","range","button","file","reset","submit","color"].includes(e.type);return(e.isContentEditable||(r||i==="TEXTAREA"||i==="SELECT")&&!e.readOnly)&&(n=!1),n}function bot(t){return typeof t=="string"&&(t=iM(t)),Oa.indexOf(t)!==-1}function Iot(t,e){let i,n;t||(t=VE());for(const r in To)if(Object.prototype.hasOwnProperty.call(To,r))for(i=To[r],n=0;n<i.length;)i[n].scope===t?i.splice(n,1).forEach(o=>{let{element:s}=o;return V9(s)}):n++;VE()===t&&yDe(e||"all")}function wot(t){let e=t.keyCode||t.which||t.charCode;const i=Oa.indexOf(e);if(i>=0&&Oa.splice(i,1),t.key&&t.key.toLowerCase()==="meta"&&Oa.splice(0,Oa.length),(e===93||e===224)&&(e=91),e in yl){yl[e]=!1;for(const n in Wf)Wf[n]===e&&(pf[n]=!1)}}function bDe(t){if(typeof t>"u")Object.keys(To).forEach(r=>{Array.isArray(To[r])&&To[r].forEach(a=>WM(a)),delete To[r]}),V9(null);else if(Array.isArray(t))t.forEach(r=>{r.key&&WM(r)});else if(typeof t=="object")t.key&&WM(t);else if(typeof t=="string"){for(var e=arguments.length,i=new Array(e>1?e-1:0),n=1;n<e;n++)i[n-1]=arguments[n];let[r,a]=i;typeof r=="function"&&(a=r,r=""),WM({key:t,scope:r,method:a,splitKey:"+"})}}const WM=t=>{let{key:e,scope:i,method:n,splitKey:r="+"}=t;gDe(e).forEach(o=>{const s=o.split(r),l=s.length,c=s[l-1],u=c==="*"?"*":iM(c);if(!To[u])return;i||(i=VE());const d=l>1?mDe(Wf,s):[],p=[];To[u]=To[u].filter(h=>{const m=(n?h.method===n:!0)&&h.scope===i&&pot(h.mods,d);return m&&p.push(h.element),!m}),p.forEach(h=>V9(h))})};function KQ(t,e,i,n){if(e.element!==n)return;let r;if(e.scope===i||e.scope==="all"){r=e.mods.length>0;for(const a in yl)Object.prototype.hasOwnProperty.call(yl,a)&&(!yl[a]&&e.mods.indexOf(+a)>-1||yl[a]&&e.mods.indexOf(+a)===-1)&&(r=!1);(e.mods.length===0&&!yl[16]&&!yl[18]&&!yl[17]&&!yl[91]||r||e.shortcut==="*")&&(e.keys=[],e.keys=e.keys.concat(Oa),e.method(t,e)===!1&&(t.preventDefault?t.preventDefault():t.returnValue=!1,t.stopPropagation&&t.stopPropagation(),t.cancelBubble&&(t.cancelBubble=!0)))}}function YQ(t,e){const i=To["*"];let n=t.keyCode||t.which||t.charCode;if(!pf.filter.call(this,t))return;if((n===93||n===224)&&(n=91),Oa.indexOf(n)===-1&&n!==229&&Oa.push(n),["ctrlKey","altKey","shiftKey","metaKey"].forEach(s=>{const l=$G[s];t[s]&&Oa.indexOf(l)===-1?Oa.push(l):!t[s]&&Oa.indexOf(l)>-1?Oa.splice(Oa.indexOf(l),1):s==="metaKey"&&t[s]&&Oa.length===3&&(t.ctrlKey||t.shiftKey||t.altKey||(Oa=Oa.slice(Oa.indexOf(l))))}),n in yl){yl[n]=!0;for(const s in Wf)Wf[s]===n&&(pf[s]=!0);if(!i)return}for(const s in yl)Object.prototype.hasOwnProperty.call(yl,s)&&(yl[s]=t[$G[s]]);t.getModifierState&&!(t.altKey&&!t.ctrlKey)&&t.getModifierState("AltGraph")&&(Oa.indexOf(17)===-1&&Oa.push(17),Oa.indexOf(18)===-1&&Oa.push(18),yl[17]=!0,yl[18]=!0);const r=VE();if(i)for(let s=0;s<i.length;s++)i[s].scope===r&&(t.type==="keydown"&&i[s].keydown||t.type==="keyup"&&i[s].keyup)&&KQ(t,i[s],r,e);if(!(n in To))return;const a=To[n],o=a.length;for(let s=0;s<o;s++)if((t.type==="keydown"&&a[s].keydown||t.type==="keyup"&&a[s].keyup)&&a[s].key){const l=a[s],{splitKey:c}=l,u=l.key.split(c),d=[];for(let p=0;p<u.length;p++)d.push(iM(u[p]));d.sort().join("")===Oa.sort().join("")&&KQ(t,l,r,e)}}function pf(t,e,i){Oa=[];const n=gDe(t);let r=[],a="all",o=document,s=0,l=!1,c=!0,u="+",d=!1,p=!1;for(i===void 0&&typeof e=="function"&&(i=e),Object.prototype.toString.call(e)==="[object Object]"&&(e.scope&&(a=e.scope),e.element&&(o=e.element),e.keyup&&(l=e.keyup),e.keydown!==void 0&&(c=e.keydown),e.capture!==void 0&&(d=e.capture),typeof e.splitKey=="string"&&(u=e.splitKey),e.single===!0&&(p=!0)),typeof e=="string"&&(a=e),p&&bDe(t,a);s<n.length;s++)t=n[s].split(u),r=[],t.length>1&&(r=mDe(Wf,t)),t=t[t.length-1],t=t==="*"?"*":iM(t),t in To||(To[t]=[]),To[t].push({keyup:l,keydown:c,scope:a,mods:r,shortcut:n[s],method:i,key:n[s],splitKey:u,element:o});if(typeof o<"u"&&window){if(!Am.has(o)){const h=function(){let m=arguments.length>0&&arguments[0]!==void 0?arguments[0]:window.event;return YQ(m,o)},f=function(){let m=arguments.length>0&&arguments[0]!==void 0?arguments[0]:window.event;YQ(m,o),wot(m)};Am.set(o,{keydownListener:h,keyupListenr:f,capture:d}),K$(o,"keydown",h,d),K$(o,"keyup",f,d)}if(!aD){const h=()=>{Oa=[]};aD={listener:h,capture:d},K$(window,"focus",h,d)}}}function Sot(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"all";Object.keys(To).forEach(i=>{To[i].filter(r=>r.scope===e&&r.shortcut===t).forEach(r=>{r&&r.method&&r.method()})})}function V9(t){const e=Object.values(To).flat();if(e.findIndex(n=>{let{element:r}=n;return r===t})<0){const{keydownListener:n,keyupListenr:r,capture:a}=Am.get(t)||{};n&&r&&(d1(t,"keyup",r,a),d1(t,"keydown",n,a),Am.delete(t))}if((e.length<=0||Am.size<=0)&&(Object.keys(Am).forEach(r=>{const{keydownListener:a,keyupListenr:o,capture:s}=Am.get(r)||{};a&&o&&(d1(r,"keyup",o,s),d1(r,"keydown",a,s),Am.delete(r))}),Am.clear(),Object.keys(To).forEach(r=>delete To[r]),aD)){const{listener:r,capture:a}=aD;d1(window,"focus",r,a),aD=null}}const Y$={getPressedKeyString:got,setScope:yDe,getScope:VE,deleteScope:Iot,getPressedKeyCodes:mot,getAllKeyCodes:vot,isPressed:bot,filter:yot,trigger:Sot,unbind:bDe,keyMap:$E,modifier:Wf,modifierMap:$G};for(const t in Y$)Object.prototype.hasOwnProperty.call(Y$,t)&&(pf[t]=Y$[t]);if(typeof window<"u"){const t=window.hotkeys;pf.noConflict=e=>(e&&window.hotkeys===pf&&(window.hotkeys=t),pf),window.hotkeys=pf}const{HOTKEYS:Tot,SIDE1KEYS:Uot,MODIFIERS:Dot}=p3;function Eot(){let t,e;const i=n=>{e=void 0,t=n};return pf(Tot+",esc",(n,r)=>{var a;if(t){const o=t.cell.getElement(),s=(a=o.classList)!=null&&a.contains("tabulator-cell")?o.firstChild:o;n.preventDefault();const l=t.cell.getRow().getData();e||(e=l.matchUp);const c=pf.shift,u=c?r.key.split(r.splitKey)[1]:r.key;u==="esc"&&(t.replaceTableData(),t=void 0);const d=Uot.some(p=>p===u)&&(c?2:1)||void 0;if(d||Dot.includes(u)){const{matchUpFormat:p,matchUpStatus:h,score:f,sets:m,winningSide:g}=e,{matchUpStatus:v,scoreString:y,winningSide:b,sets:I,updated:T}=Mv.keyValueScore({scoreString:f==null?void 0:f.scoreStringSide1,shiftFirst:!0,sets:m||[],matchUpStatus:h,matchUpFormat:p,winningSide:g,lowSide:d,value:u});T&&(e={matchUpId:l.matchUp.matchUpId,drawId:l.matchUp.drawId,score:{scoreStringSide1:y},matchUpStatus:v,winningSide:b,sets:I,matchUpFormat:p,updated:T},s.innerText=y||"Enter score")}}if(t&&r.key==="enter"){const o=Mv.generateScoreString({sets:e.sets,reversed:!0}),s=Mv.generateScoreString({sets:e.sets}),l={matchUpStatus:e.matchUpStatus,winningSide:e.winningSide,score:{sets:e.sets,scoreStringSide1:s,scoreStringSide2:o}};Cot({callback:t.replaceTableData,matchUpId:e.matchUpId,drawId:e.drawId,outcome:l}),t=void 0}}),{setFocusData:i}}function Cot({outcome:t,callback:e,matchUpId:i,drawId:n}){const{matchUpStatus:r,winningSide:a,score:o}=t;Wt({methods:[{method:s9,params:{outcome:{matchUpStatus:r,winningSide:a,score:o},matchUpId:i,drawId:n}}],callback:c=>{Nt(e)&&e({...c,outcome:t})}})}function Pot(){let t;const{setFocusData:e}=Eot(),i=()=>(at.allTournamentMatchUps({participantsProfile:{withISO2:!0,withScaleValues:!0},contextProfile:{withCompetitiveness:!0}}).matchUps||[]).filter(({matchUpStatus:l})=>l!=="BYE").map(OU),n=()=>{t.replaceData(i())},r=i(),a=dot({data:r,replaceTableData:n,setFocusData:e});return(s=>{var u;gm({anchorId:XA});const l=document.getElementById(XA),c=(u=Bl(l,"section"))==null?void 0:u.querySelector(".tabHeader");t=new Go(l,{headerSortElement:Fh(["complete","duration","score","scheduledTime"]),height:window.innerHeight*.85,placeholder:"No matches",layout:"fitColumns",reactiveData:!0,index:"matchUpId",columns:a,data:s}),t.on("dataFiltered",(d,p)=>{var y,b;const h=p.map(I=>I.getData().matchUp);c&&(c.innerHTML=`Matches (${h.length})`);const f=document.getElementById("wtnPredictiveAccuracy"),m=at.getPredictiveAccuracy({valueAccessor:"wtnRating",scaleName:"WTN",zoneMargin:2.5,matchUps:h});(y=m==null?void 0:m.accuracy)!=null&&y.percent?(f.style.display="",f.innerHTML=`WTN ${m.accuracy.percent}%`):f.style.display=Mt;const g=document.getElementById("utrPredictiveAccuracy"),v=at.getPredictiveAccuracy({valueAccessor:"utrRating",singlesForDoubles:!0,scaleName:"UTR",zoneMargin:1,matchUps:h});(b=v==null?void 0:v.accuracy)!=null&&b.percent?(g.style.display="",g.innerHTML=`UTR ${v.accuracy.percent}%`):g.style.display=Mt})})(r),{table:t,data:r,replaceTableData:n}}function pk(t){ln.activeScale=t}const{TEAM_EVENT:ZQ,SINGLES:XQ,DOUBLES:JQ}=pl,{TEAM:Rot}=Yo;function Mot(){const t=new Map,e={elements:{},options:{}},{data:i,table:n,replaceTableData:r}=Pot(),a=at.getEvents().events||[],o=document.getElementById(s4);o.style.display=Mt,e.options.flight=kot({matchUpFilters:t,events:a,table:n});const s=xot({matchUpFilters:t,components:e,events:a,table:n}),l=Aot({table:n,matchUpFilters:t,statsPanel:o}),c=Not({table:n,matchUpFilters:t,data:i}),u=_ot({matchUpFilters:t,table:n}),d=m=>{var g;return(g=m.searchText)==null?void 0:g.includes(t.get("searchText"))},p=m=>{m||n==null||n.removeFilter(d),t.set("searchText",m),m&&(n==null||n.addFilter(d))},h=[{onClick:()=>n==null?void 0:n.deselectRow(),label:"Schedule",stateChange:!0,location:Ua},{onKeyDown:m=>m.keyCode===8&&m.target.value.length===1&&p(""),onKeyUp:m=>p(m.target.value),clearSearch:()=>{n==null||n.removeFilter(d),t.set("searchText",""),n==null||n.removeFilter()},placeholder:"Search matches",location:ci,search:!0},{hide:s.length<4,options:s,id:"eventOptions",label:eg,modifyLabel:!0,selection:!0,location:ci},{options:e.options.flight.flightOptions,hide:!t.get("eventIdFilter")||e.options.flight.flightOptions.length<3,label:ZD,id:"flightOptions",modifyLabel:!0,selection:!0,location:ci},{hide:l.length<3,options:l,modifyLabel:!0,label:Zpe,location:ci,selection:!0},{options:u,label:Ype,modifyLabel:!0,selection:!0,location:ci},{hide:c.length<4,options:c,modifyLabel:!0,label:Xpe,selection:!0,location:ci},{onClick:()=>{pk(tE),r()},id:"wtnPredictiveAccuracy",intent:"is-danger",location:Qt,text:"WTN %",hide:!0},{onClick:()=>{pk(rI),r()},id:"utrPredictiveAccuracy",intent:"is-info",location:Qt,text:"UTR %",hide:!0}],f=document.getElementById(v4);e.elements=Ns({table:n,target:f,items:h}).elements}function Not({table:t,matchUpFilters:e,data:i}){const n=s=>s.matchUpType===e.get("matchUpTypeFilter"),r=s=>{t==null||t.removeFilter(n),e.set("matchUpTypeFilter",s),s&&(t==null||t.addFilter(n))},a={label:`<span style='font-weight: bold'>${Xpe}</span>`,onClick:()=>r(),close:!0},o=i.reduce((s,l)=>(s.includes(l.matchUpType)||s.push(l.matchUpType),s),[]);return[a,{divider:!0},o.includes(XQ)&&{label:"Singles",close:!0,onClick:()=>r(XQ)},o.includes(JQ)&&{label:"Doubles",close:!0,onClick:()=>r(JQ)},o.includes(ZQ)&&{label:"Team",close:!0,onClick:()=>r(ZQ)}].filter(Boolean)}function Aot({table:t,matchUpFilters:e,statsPanel:i}){const n=at.getParticipants({participantFilters:{participantTypes:[Rot]}}).participants||[],r=Object.assign({},...n.map(l=>({[l.participantId]:l.individualParticipantIds}))),a=l=>l.individualParticipantIds.some(c=>{var u;return(u=r[e.get("teamIdFilter")])==null?void 0:u.includes(c)}),o=l=>{if(e.get("teamIdFilter")&&(t==null||t.removeFilter(a)),e.set("teamIdFilter",l),l){t==null||t.addFilter(a);const{teamStats:c}=at.getParticipantStats({teamParticipantId:l});if(c!=null&&c.participantName){i.style.display="";const u=uk({participantName:c.participantName,justify:"end"}),d=uk({participantName:"Opponents",justify:"start"}),p=[{side1Score:c.matchUps[0],side2Score:c.matchUps[1]}],h=dk({sets:p,sideNumber:1}),f=dk({sets:p,sideNumber:2});as(i),i.appendChild(nDe({side1:u,side2:d,side1Score:h,side2Score:f}))}}else i.style.display=Mt};return[{label:`<span style='font-weight: bold'>${Zpe}</span>`,onClick:()=>o(),close:!0},{divider:!0}].concat(n.sort((l,c)=>{var u;return(u=l==null?void 0:l.participantName)==null?void 0:u.localeCompare(c==null?void 0:c.participantName)}).map(l=>({onClick:()=>o(l.participantId),label:l.participantName,close:!0})))}function _ot({matchUpFilters:t,table:e}){const i=a=>{const o=t.get("matchUpStatusFilter");if(o==="readyToScore")return a.scoreDetail.readyToScore&&!a.scoreDetail.score&&!a.scoreDetail.winningSide;if(o==="complete")return a.scoreDetail.winningSide||["DOUBLE_WALKOVER","DOUBLE_DEFAULT","CANCELLED","ABANDONED"].includes(a.scoreDetail.matchUpStatus)},n=a=>{e==null||e.removeFilter(i),t.set("matchUpStatusFilter",a),a&&(e==null||e.addFilter(i))};return[{label:`<span style='font-weight: bold'>${Ype}</span>`,onClick:()=>n(),close:!0},{divider:!0},{label:"Ready to score",close:!0,onClick:()=>n("readyToScore")},{label:"Complete",close:!0,onClick:()=>n("complete")}]}function kot({matchUpFilters:t,events:e,table:i}){const n=l=>l.drawId===t.get("drawIdFilter"),r=l=>{i==null||i.removeFilter(n),t.set("drawIdFilter",l),l&&(i==null||i.addFilter(n))},a={label:`<span style='font-weight: bold'>${ZD}</span>`,onClick:()=>r(),close:!0},o=l=>{var c;return(c=l.drawDefinitions)==null?void 0:c.map(({drawId:u,drawName:d})=>({onClick:()=>r(u),label:d,close:!0}))},s=[a,{divider:!0}].concat(e.flatMap(o)).filter(Boolean);return{flightFilter:n,flightOptions:s,allFlights:a,mapFlightOptions:o}}function xot({matchUpFilters:t,table:e,events:i,components:n}){const r=s=>s.eventId===t.get("eventIdFilter"),a=s=>{if(e==null||e.removeFilter(r),t.set("eventIdFilter",s),e==null||e.removeFilter(n.options.flight.flightFilter),t.set("drawIdFilter",void 0),s){e==null||e.addFilter(r),n.options.flight.flightOptions=[n.options.flight.allFlights,{divider:!0}].concat(n.options.flight.mapFlightOptions(i.find(u=>s===u.eventId))).filter(Boolean);const l={options:n.options.flight.flightOptions,label:ZD,id:"flightOptions",modifyLabel:!0,selection:!0,location:ci},c=zj({button:l});n.elements.flightOptions.replaceWith(c),n.elements.flightOptions=c,n.elements.flightOptions.style.display=n.options.flight.flightOptions.length<3?Mt:""}else n.elements.flightOptions.style.display=Mt};return[{label:`<span style='font-weight: bold'>${eg}</span>`,onClick:()=>a(),close:!0},{divider:!0}].concat(i.map(s=>({onClick:()=>a(s.eventId),label:s.eventName,close:!0})))}function Oot(){var r,a;const t=at.getTournamentInfo().tournamentInfo;if((a=(r=t==null?void 0:t.timeItemValues)==null?void 0:r.TMX)==null?void 0:a.offline){const o=document.getElementById("dnav");o.style.backgroundColor="lightyellow"}const i=document.getElementById("provider");i&&(i.onclick=()=>Tt.router.navigate("/tournaments"));const n=document.getElementById("pageTitle");n&&(t!=null&&t.tournamentName)?(as(n),n.innerHTML=`<div class='tmx-title'>${t==null?void 0:t.tournamentName}</div>`):Tt.router.navigate("/tournaments")}function IDe(t){var o;const{venueName:e,venueAbbreviation:i,addresses:n,venueId:r,courts:a}=t;return{hasLocation:(o=n==null?void 0:n[0])==null?void 0:o.longitude,courtsCount:(a==null?void 0:a.length)||0,scheduledMatchUpsCount:0,address:n==null?void 0:n[0],availableTime:"",venueAbbreviation:i,venueName:e,venueId:r,courts:a,venue:t}}function Lot(){function t(i){return i.getValue()?'<i class="fa-solid fa-check" style="color: green"></i>':'<i class="fa-solid fa-xmark"></i>'}const e=()=>console.log("Court actions");return[{cellClick:(i,n)=>n.getRow().toggleSelect(),titleFormatter:"rowSelection",formatter:"rowSelection",headerSort:!1,responsive:!1,hozAlign:ci,width:5},{headerMenu:vm({floodlit:"Lights"}),formatter:"rownum",headerSort:!1,hozAlign:li,width:55},{title:"Court Name",field:"courtName",editor:!0},{title:"Scheduled Time",field:"scheduledTime"},{title:"Unscheduled Time",field:"unscheduledTime"},{title:"In/Out",field:"indoorOutdoor"},{title:"Surface",field:"surfaceType"},{title:'<i class="fa-regular fa-lightbulb"></i>',formatter:t,headerTooltip:"Lights",field:"floodlit",width:50},{cellClick:e,formatter:Hg,responsive:!1,headerSort:!1,hozAlign:Qt,width:50}]}function Fot(t){const e=document.createElement("div"),i=document.createElement("div");i.className="tableControl",i.style.marginBottom="1em";const n=[{label:"Delete selected",intent:"is-danger",stateChange:!0,location:Ua},{label:"Add courts",location:Qt,align:Qt}];e.appendChild(i);const r="1px solid #333",a=document.createElement("div");a.style.backgroundColor="white",a.style.border=r,a.style.width="99%",e.className=$O,e.style.display=Mt,e.style.boxSizing="border-box",e.style.paddingLeft="10px",e.style.borderTop=r,e.style.borderBotom=r,e.appendChild(a),t.getElement().appendChild(e);const o=Lot(),s=new Go(a,{headerSortElement:Fh(["courtName","scheduledTime","unscheduledTime","floodlit","surfaceType","indoorOutdoor"]),data:t.getData().courts,placeholder:"No courts",layout:"fitColumns",index:"courtId",maxHeight:400,columns:o});Ns({table:s,target:i,items:n}),s.on("scrollVertical",ld),s.on("cellEdited",l=>{const c=l.getRow().getData(),u=l.getValue();if(u.length){const d=h=>{h.success?console.log("success",{result:h}):console.log({result:h})},p=[{method:CTe,params:{courtId:c.courtId,modifications:{courtName:u}}}];Wt({methods:p,callback:d})}else console.log("INVALID VALUE")})}const j9=/[-+]?([1-8]?\d(\.\d+)?|90(\.0+)?)\s*,\s*[-+]?(180(\.0+)?|((1[0-7]\d)|([1-9]?\d))(\.\d+)?)$/;function Bot(t){let e=t.split("/");if(e[2]==="www.openstreetmap.org"){let i=e.slice(4).join(",");return j9.test(i)?{latitude:e[4],longitude:e[5]}:{}}return{}}function $ot(t){const i=t.split("/").reduce((o,s)=>s&&s[0]==="@"?s:o,void 0),n=i==null?void 0:i.split(","),r=n==null?void 0:n[0].slice(1),a=n==null?void 0:n[1];return{latitude:r,longitude:a}}function Vot(t){let e=t.split(",");return j9.test(t)?{latitude:e[0],longitude:e[1]}:{}}function jot(t){let e=t.split("=");if(e.length>1){let i=e[1].split(","),n=[i[0],i[1]].join(",");return j9.test(n)?{latitude:i[0],longitude:i[1]}:{}}return{}}var VG={exports:{}};/* @preserve
 * Leaflet 1.9.4, a JS library for interactive maps. https://leafletjs.com
 * (c) 2010-2023 Vladimir Agafonkin, (c) 2010-2011 CloudMade
 */(function(t,e){(function(i,n){n(e)})(Zd,function(i){var n="1.9.4";function r(U){var k,j,K,ie;for(j=1,K=arguments.length;j<K;j++){ie=arguments[j];for(k in ie)U[k]=ie[k]}return U}var a=Object.create||function(){function U(){}return function(k){return U.prototype=k,new U}}();function o(U,k){var j=Array.prototype.slice;if(U.bind)return U.bind.apply(U,j.call(arguments,1));var K=j.call(arguments,2);return function(){return U.apply(k,K.length?K.concat(j.call(arguments)):arguments)}}var s=0;function l(U){return"_leaflet_id"in U||(U._leaflet_id=++s),U._leaflet_id}function c(U,k,j){var K,ie,ye,Ne;return Ne=function(){K=!1,ie&&(ye.apply(j,ie),ie=!1)},ye=function(){K?ie=arguments:(U.apply(j,arguments),setTimeout(Ne,k),K=!0)},ye}function u(U,k,j){var K=k[1],ie=k[0],ye=K-ie;return U===K&&j?U:((U-ie)%ye+ye)%ye+ie}function d(){return!1}function p(U,k){if(k===!1)return U;var j=Math.pow(10,k===void 0?6:k);return Math.round(U*j)/j}function h(U){return U.trim?U.trim():U.replace(/^\s+|\s+$/g,"")}function f(U){return h(U).split(/\s+/)}function m(U,k){Object.prototype.hasOwnProperty.call(U,"options")||(U.options=U.options?a(U.options):{});for(var j in k)U.options[j]=k[j];return U.options}function g(U,k,j){var K=[];for(var ie in U)K.push(encodeURIComponent(j?ie.toUpperCase():ie)+"="+encodeURIComponent(U[ie]));return(!k||k.indexOf("?")===-1?"?":"&")+K.join("&")}var v=/\{ *([\w_ -]+) *\}/g;function y(U,k){return U.replace(v,function(j,K){var ie=k[K];if(ie===void 0)throw new Error("No value provided for variable "+j);return typeof ie=="function"&&(ie=ie(k)),ie})}var b=Array.isArray||function(U){return Object.prototype.toString.call(U)==="[object Array]"};function I(U,k){for(var j=0;j<U.length;j++)if(U[j]===k)return j;return-1}var T="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=";function w(U){return window["webkit"+U]||window["moz"+U]||window["ms"+U]}var S=0;function D(U){var k=+new Date,j=Math.max(0,16-(k-S));return S=k+j,window.setTimeout(U,j)}var E=window.requestAnimationFrame||w("RequestAnimationFrame")||D,C=window.cancelAnimationFrame||w("CancelAnimationFrame")||w("CancelRequestAnimationFrame")||function(U){window.clearTimeout(U)};function P(U,k,j){if(j&&E===D)U.call(k);else return E.call(window,o(U,k))}function R(U){U&&C.call(window,U)}var N={__proto__:null,extend:r,create:a,bind:o,get lastId(){return s},stamp:l,throttle:c,wrapNum:u,falseFn:d,formatNum:p,trim:h,splitWords:f,setOptions:m,getParamString:g,template:y,isArray:b,indexOf:I,emptyImageUrl:T,requestFn:E,cancelFn:C,requestAnimFrame:P,cancelAnimFrame:R};function M(){}M.extend=function(U){var k=function(){m(this),this.initialize&&this.initialize.apply(this,arguments),this.callInitHooks()},j=k.__super__=this.prototype,K=a(j);K.constructor=k,k.prototype=K;for(var ie in this)Object.prototype.hasOwnProperty.call(this,ie)&&ie!=="prototype"&&ie!=="__super__"&&(k[ie]=this[ie]);return U.statics&&r(k,U.statics),U.includes&&(A(U.includes),r.apply(null,[K].concat(U.includes))),r(K,U),delete K.statics,delete K.includes,K.options&&(K.options=j.options?a(j.options):{},r(K.options,U.options)),K._initHooks=[],K.callInitHooks=function(){if(!this._initHooksCalled){j.callInitHooks&&j.callInitHooks.call(this),this._initHooksCalled=!0;for(var ye=0,Ne=K._initHooks.length;ye<Ne;ye++)K._initHooks[ye].call(this)}},k},M.include=function(U){var k=this.prototype.options;return r(this.prototype,U),U.options&&(this.prototype.options=k,this.mergeOptions(U.options)),this},M.mergeOptions=function(U){return r(this.prototype.options,U),this},M.addInitHook=function(U){var k=Array.prototype.slice.call(arguments,1),j=typeof U=="function"?U:function(){this[U].apply(this,k)};return this.prototype._initHooks=this.prototype._initHooks||[],this.prototype._initHooks.push(j),this};function A(U){if(!(typeof L>"u"||!L||!L.Mixin)){U=b(U)?U:[U];for(var k=0;k<U.length;k++)U[k]===L.Mixin.Events&&console.warn("Deprecated include of L.Mixin.Events: this property will be removed in future releases, please inherit from L.Evented instead.",new Error().stack)}}var _={on:function(U,k,j){if(typeof U=="object")for(var K in U)this._on(K,U[K],k);else{U=f(U);for(var ie=0,ye=U.length;ie<ye;ie++)this._on(U[ie],k,j)}return this},off:function(U,k,j){if(!arguments.length)delete this._events;else if(typeof U=="object")for(var K in U)this._off(K,U[K],k);else{U=f(U);for(var ie=arguments.length===1,ye=0,Ne=U.length;ye<Ne;ye++)ie?this._off(U[ye]):this._off(U[ye],k,j)}return this},_on:function(U,k,j,K){if(typeof k!="function"){console.warn("wrong listener type: "+typeof k);return}if(this._listens(U,k,j)===!1){j===this&&(j=void 0);var ie={fn:k,ctx:j};K&&(ie.once=!0),this._events=this._events||{},this._events[U]=this._events[U]||[],this._events[U].push(ie)}},_off:function(U,k,j){var K,ie,ye;if(this._events&&(K=this._events[U],!!K)){if(arguments.length===1){if(this._firingCount)for(ie=0,ye=K.length;ie<ye;ie++)K[ie].fn=d;delete this._events[U];return}if(typeof k!="function"){console.warn("wrong listener type: "+typeof k);return}var Ne=this._listens(U,k,j);if(Ne!==!1){var Ze=K[Ne];this._firingCount&&(Ze.fn=d,this._events[U]=K=K.slice()),K.splice(Ne,1)}}},fire:function(U,k,j){if(!this.listens(U,j))return this;var K=r({},k,{type:U,target:this,sourceTarget:k&&k.sourceTarget||this});if(this._events){var ie=this._events[U];if(ie){this._firingCount=this._firingCount+1||1;for(var ye=0,Ne=ie.length;ye<Ne;ye++){var Ze=ie[ye],rt=Ze.fn;Ze.once&&this.off(U,rt,Ze.ctx),rt.call(Ze.ctx||this,K)}this._firingCount--}}return j&&this._propagateEvent(K),this},listens:function(U,k,j,K){typeof U!="string"&&console.warn('"string" type argument expected');var ie=k;typeof k!="function"&&(K=!!k,ie=void 0,j=void 0);var ye=this._events&&this._events[U];if(ye&&ye.length&&this._listens(U,ie,j)!==!1)return!0;if(K){for(var Ne in this._eventParents)if(this._eventParents[Ne].listens(U,k,j,K))return!0}return!1},_listens:function(U,k,j){if(!this._events)return!1;var K=this._events[U]||[];if(!k)return!!K.length;j===this&&(j=void 0);for(var ie=0,ye=K.length;ie<ye;ie++)if(K[ie].fn===k&&K[ie].ctx===j)return ie;return!1},once:function(U,k,j){if(typeof U=="object")for(var K in U)this._on(K,U[K],k,!0);else{U=f(U);for(var ie=0,ye=U.length;ie<ye;ie++)this._on(U[ie],k,j,!0)}return this},addEventParent:function(U){return this._eventParents=this._eventParents||{},this._eventParents[l(U)]=U,this},removeEventParent:function(U){return this._eventParents&&delete this._eventParents[l(U)],this},_propagateEvent:function(U){for(var k in this._eventParents)this._eventParents[k].fire(U.type,r({layer:U.target,propagatedFrom:U.target},U),!0)}};_.addEventListener=_.on,_.removeEventListener=_.clearAllEventListeners=_.off,_.addOneTimeEventListener=_.once,_.fireEvent=_.fire,_.hasEventListeners=_.listens;var x=M.extend(_);function O(U,k,j){this.x=j?Math.round(U):U,this.y=j?Math.round(k):k}var B=Math.trunc||function(U){return U>0?Math.floor(U):Math.ceil(U)};O.prototype={clone:function(){return new O(this.x,this.y)},add:function(U){return this.clone()._add(F(U))},_add:function(U){return this.x+=U.x,this.y+=U.y,this},subtract:function(U){return this.clone()._subtract(F(U))},_subtract:function(U){return this.x-=U.x,this.y-=U.y,this},divideBy:function(U){return this.clone()._divideBy(U)},_divideBy:function(U){return this.x/=U,this.y/=U,this},multiplyBy:function(U){return this.clone()._multiplyBy(U)},_multiplyBy:function(U){return this.x*=U,this.y*=U,this},scaleBy:function(U){return new O(this.x*U.x,this.y*U.y)},unscaleBy:function(U){return new O(this.x/U.x,this.y/U.y)},round:function(){return this.clone()._round()},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},floor:function(){return this.clone()._floor()},_floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.clone()._ceil()},_ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},trunc:function(){return this.clone()._trunc()},_trunc:function(){return this.x=B(this.x),this.y=B(this.y),this},distanceTo:function(U){U=F(U);var k=U.x-this.x,j=U.y-this.y;return Math.sqrt(k*k+j*j)},equals:function(U){return U=F(U),U.x===this.x&&U.y===this.y},contains:function(U){return U=F(U),Math.abs(U.x)<=Math.abs(this.x)&&Math.abs(U.y)<=Math.abs(this.y)},toString:function(){return"Point("+p(this.x)+", "+p(this.y)+")"}};function F(U,k,j){return U instanceof O?U:b(U)?new O(U[0],U[1]):U==null?U:typeof U=="object"&&"x"in U&&"y"in U?new O(U.x,U.y):new O(U,k,j)}function G(U,k){if(U)for(var j=k?[U,k]:U,K=0,ie=j.length;K<ie;K++)this.extend(j[K])}G.prototype={extend:function(U){var k,j;if(!U)return this;if(U instanceof O||typeof U[0]=="number"||"x"in U)k=j=F(U);else if(U=H(U),k=U.min,j=U.max,!k||!j)return this;return!this.min&&!this.max?(this.min=k.clone(),this.max=j.clone()):(this.min.x=Math.min(k.x,this.min.x),this.max.x=Math.max(j.x,this.max.x),this.min.y=Math.min(k.y,this.min.y),this.max.y=Math.max(j.y,this.max.y)),this},getCenter:function(U){return F((this.min.x+this.max.x)/2,(this.min.y+this.max.y)/2,U)},getBottomLeft:function(){return F(this.min.x,this.max.y)},getTopRight:function(){return F(this.max.x,this.min.y)},getTopLeft:function(){return this.min},getBottomRight:function(){return this.max},getSize:function(){return this.max.subtract(this.min)},contains:function(U){var k,j;return typeof U[0]=="number"||U instanceof O?U=F(U):U=H(U),U instanceof G?(k=U.min,j=U.max):k=j=U,k.x>=this.min.x&&j.x<=this.max.x&&k.y>=this.min.y&&j.y<=this.max.y},intersects:function(U){U=H(U);var k=this.min,j=this.max,K=U.min,ie=U.max,ye=ie.x>=k.x&&K.x<=j.x,Ne=ie.y>=k.y&&K.y<=j.y;return ye&&Ne},overlaps:function(U){U=H(U);var k=this.min,j=this.max,K=U.min,ie=U.max,ye=ie.x>k.x&&K.x<j.x,Ne=ie.y>k.y&&K.y<j.y;return ye&&Ne},isValid:function(){return!!(this.min&&this.max)},pad:function(U){var k=this.min,j=this.max,K=Math.abs(k.x-j.x)*U,ie=Math.abs(k.y-j.y)*U;return H(F(k.x-K,k.y-ie),F(j.x+K,j.y+ie))},equals:function(U){return U?(U=H(U),this.min.equals(U.getTopLeft())&&this.max.equals(U.getBottomRight())):!1}};function H(U,k){return!U||U instanceof G?U:new G(U,k)}function $(U,k){if(U)for(var j=k?[U,k]:U,K=0,ie=j.length;K<ie;K++)this.extend(j[K])}$.prototype={extend:function(U){var k=this._southWest,j=this._northEast,K,ie;if(U instanceof z)K=U,ie=U;else if(U instanceof $){if(K=U._southWest,ie=U._northEast,!K||!ie)return this}else return U?this.extend(Z(U)||q(U)):this;return!k&&!j?(this._southWest=new z(K.lat,K.lng),this._northEast=new z(ie.lat,ie.lng)):(k.lat=Math.min(K.lat,k.lat),k.lng=Math.min(K.lng,k.lng),j.lat=Math.max(ie.lat,j.lat),j.lng=Math.max(ie.lng,j.lng)),this},pad:function(U){var k=this._southWest,j=this._northEast,K=Math.abs(k.lat-j.lat)*U,ie=Math.abs(k.lng-j.lng)*U;return new $(new z(k.lat-K,k.lng-ie),new z(j.lat+K,j.lng+ie))},getCenter:function(){return new z((this._southWest.lat+this._northEast.lat)/2,(this._southWest.lng+this._northEast.lng)/2)},getSouthWest:function(){return this._southWest},getNorthEast:function(){return this._northEast},getNorthWest:function(){return new z(this.getNorth(),this.getWest())},getSouthEast:function(){return new z(this.getSouth(),this.getEast())},getWest:function(){return this._southWest.lng},getSouth:function(){return this._southWest.lat},getEast:function(){return this._northEast.lng},getNorth:function(){return this._northEast.lat},contains:function(U){typeof U[0]=="number"||U instanceof z||"lat"in U?U=Z(U):U=q(U);var k=this._southWest,j=this._northEast,K,ie;return U instanceof $?(K=U.getSouthWest(),ie=U.getNorthEast()):K=ie=U,K.lat>=k.lat&&ie.lat<=j.lat&&K.lng>=k.lng&&ie.lng<=j.lng},intersects:function(U){U=q(U);var k=this._southWest,j=this._northEast,K=U.getSouthWest(),ie=U.getNorthEast(),ye=ie.lat>=k.lat&&K.lat<=j.lat,Ne=ie.lng>=k.lng&&K.lng<=j.lng;return ye&&Ne},overlaps:function(U){U=q(U);var k=this._southWest,j=this._northEast,K=U.getSouthWest(),ie=U.getNorthEast(),ye=ie.lat>k.lat&&K.lat<j.lat,Ne=ie.lng>k.lng&&K.lng<j.lng;return ye&&Ne},toBBoxString:function(){return[this.getWest(),this.getSouth(),this.getEast(),this.getNorth()].join(",")},equals:function(U,k){return U?(U=q(U),this._southWest.equals(U.getSouthWest(),k)&&this._northEast.equals(U.getNorthEast(),k)):!1},isValid:function(){return!!(this._southWest&&this._northEast)}};function q(U,k){return U instanceof $?U:new $(U,k)}function z(U,k,j){if(isNaN(U)||isNaN(k))throw new Error("Invalid LatLng object: ("+U+", "+k+")");this.lat=+U,this.lng=+k,j!==void 0&&(this.alt=+j)}z.prototype={equals:function(U,k){if(!U)return!1;U=Z(U);var j=Math.max(Math.abs(this.lat-U.lat),Math.abs(this.lng-U.lng));return j<=(k===void 0?1e-9:k)},toString:function(U){return"LatLng("+p(this.lat,U)+", "+p(this.lng,U)+")"},distanceTo:function(U){return Q.distance(this,Z(U))},wrap:function(){return Q.wrapLatLng(this)},toBounds:function(U){var k=180*U/40075017,j=k/Math.cos(Math.PI/180*this.lat);return q([this.lat-k,this.lng-j],[this.lat+k,this.lng+j])},clone:function(){return new z(this.lat,this.lng,this.alt)}};function Z(U,k,j){return U instanceof z?U:b(U)&&typeof U[0]!="object"?U.length===3?new z(U[0],U[1],U[2]):U.length===2?new z(U[0],U[1]):null:U==null?U:typeof U=="object"&&"lat"in U?new z(U.lat,"lng"in U?U.lng:U.lon,U.alt):k===void 0?null:new z(U,k,j)}var Y={latLngToPoint:function(U,k){var j=this.projection.project(U),K=this.scale(k);return this.transformation._transform(j,K)},pointToLatLng:function(U,k){var j=this.scale(k),K=this.transformation.untransform(U,j);return this.projection.unproject(K)},project:function(U){return this.projection.project(U)},unproject:function(U){return this.projection.unproject(U)},scale:function(U){return 256*Math.pow(2,U)},zoom:function(U){return Math.log(U/256)/Math.LN2},getProjectedBounds:function(U){if(this.infinite)return null;var k=this.projection.bounds,j=this.scale(U),K=this.transformation.transform(k.min,j),ie=this.transformation.transform(k.max,j);return new G(K,ie)},infinite:!1,wrapLatLng:function(U){var k=this.wrapLng?u(U.lng,this.wrapLng,!0):U.lng,j=this.wrapLat?u(U.lat,this.wrapLat,!0):U.lat,K=U.alt;return new z(j,k,K)},wrapLatLngBounds:function(U){var k=U.getCenter(),j=this.wrapLatLng(k),K=k.lat-j.lat,ie=k.lng-j.lng;if(K===0&&ie===0)return U;var ye=U.getSouthWest(),Ne=U.getNorthEast(),Ze=new z(ye.lat-K,ye.lng-ie),rt=new z(Ne.lat-K,Ne.lng-ie);return new $(Ze,rt)}},Q=r({},Y,{wrapLng:[-180,180],R:6371e3,distance:function(U,k){var j=Math.PI/180,K=U.lat*j,ie=k.lat*j,ye=Math.sin((k.lat-U.lat)*j/2),Ne=Math.sin((k.lng-U.lng)*j/2),Ze=ye*ye+Math.cos(K)*Math.cos(ie)*Ne*Ne,rt=2*Math.atan2(Math.sqrt(Ze),Math.sqrt(1-Ze));return this.R*rt}}),X=6378137,oe={R:X,MAX_LATITUDE:85.0511287798,project:function(U){var k=Math.PI/180,j=this.MAX_LATITUDE,K=Math.max(Math.min(j,U.lat),-j),ie=Math.sin(K*k);return new O(this.R*U.lng*k,this.R*Math.log((1+ie)/(1-ie))/2)},unproject:function(U){var k=180/Math.PI;return new z((2*Math.atan(Math.exp(U.y/this.R))-Math.PI/2)*k,U.x*k/this.R)},bounds:function(){var U=X*Math.PI;return new G([-U,-U],[U,U])}()};function re(U,k,j,K){if(b(U)){this._a=U[0],this._b=U[1],this._c=U[2],this._d=U[3];return}this._a=U,this._b=k,this._c=j,this._d=K}re.prototype={transform:function(U,k){return this._transform(U.clone(),k)},_transform:function(U,k){return k=k||1,U.x=k*(this._a*U.x+this._b),U.y=k*(this._c*U.y+this._d),U},untransform:function(U,k){return k=k||1,new O((U.x/k-this._b)/this._a,(U.y/k-this._d)/this._c)}};function me(U,k,j,K){return new re(U,k,j,K)}var se=r({},Q,{code:"EPSG:3857",projection:oe,transformation:function(){var U=.5/(Math.PI*oe.R);return me(U,.5,-U,.5)}()}),te=r({},se,{code:"EPSG:900913"});function he(U){return document.createElementNS("http://www.w3.org/2000/svg",U)}function ae(U,k){var j="",K,ie,ye,Ne,Ze,rt;for(K=0,ye=U.length;K<ye;K++){for(Ze=U[K],ie=0,Ne=Ze.length;ie<Ne;ie++)rt=Ze[ie],j+=(ie?"L":"M")+rt.x+" "+rt.y;j+=k?Gt.svg?"z":"x":""}return j||"M0 0"}var de=document.documentElement.style,Ie="ActiveXObject"in window,De=Ie&&!document.addEventListener,Te="msLaunchUri"in navigator&&!("documentMode"in document),_e=Kn("webkit"),Ve=Kn("android"),ot=Kn("android 2")||Kn("android 3"),St=parseInt(/WebKit\/([0-9]+)|$/.exec(navigator.userAgent)[1],10),nt=Ve&&Kn("Google")&&St<537&&!("AudioNode"in window),Bt=!!window.opera,Pe=!Te&&Kn("chrome"),et=Kn("gecko")&&!_e&&!Bt&&!Ie,Ee=!Pe&&Kn("safari"),lt=Kn("phantom"),Ke="OTransition"in de,bt=navigator.platform.indexOf("Win")===0,gt=Ie&&"transition"in de,Ue="WebKitCSSMatrix"in window&&"m11"in new window.WebKitCSSMatrix&&!ot,xe="MozPerspective"in de,We=!window.L_DISABLE_3D&&(gt||Ue||xe)&&!Ke&&!lt,st=typeof orientation<"u"||Kn("mobile"),vt=st&&_e,ge=st&&Ue,Se=!window.PointerEvent&&window.MSPointerEvent,qe=!!(window.PointerEvent||Se),$e="ontouchstart"in window||!!window.TouchEvent,ke=!window.L_NO_TOUCH&&($e||qe),Ut=st&&Bt,pt=st&&et,tt=(window.devicePixelRatio||window.screen.deviceXDPI/window.screen.logicalXDPI)>1,At=function(){var U=!1;try{var k=Object.defineProperty({},"passive",{get:function(){U=!0}});window.addEventListener("testPassiveEventSupport",d,k),window.removeEventListener("testPassiveEventSupport",d,k)}catch{}return U}(),ei=function(){return!!document.createElement("canvas").getContext}(),vi=!!(document.createElementNS&&he("svg").createSVGRect),Ln=!!vi&&function(){var U=document.createElement("div");return U.innerHTML="<svg/>",(U.firstChild&&U.firstChild.namespaceURI)==="http://www.w3.org/2000/svg"}(),gn=!vi&&function(){try{var U=document.createElement("div");U.innerHTML='<v:shape adj="1"/>';var k=U.firstChild;return k.style.behavior="url(#default#VML)",k&&typeof k.adj=="object"}catch{return!1}}(),Jt=navigator.platform.indexOf("Mac")===0,kr=navigator.platform.indexOf("Linux")===0;function Kn(U){return navigator.userAgent.toLowerCase().indexOf(U)>=0}var Gt={ie:Ie,ielt9:De,edge:Te,webkit:_e,android:Ve,android23:ot,androidStock:nt,opera:Bt,chrome:Pe,gecko:et,safari:Ee,phantom:lt,opera12:Ke,win:bt,ie3d:gt,webkit3d:Ue,gecko3d:xe,any3d:We,mobile:st,mobileWebkit:vt,mobileWebkit3d:ge,msPointer:Se,pointer:qe,touch:ke,touchNative:$e,mobileOpera:Ut,mobileGecko:pt,retina:tt,passiveEvents:At,canvas:ei,svg:vi,vml:gn,inlineSvg:Ln,mac:Jt,linux:kr},Ji=Gt.msPointer?"MSPointerDown":"pointerdown",xo=Gt.msPointer?"MSPointerMove":"pointermove",na=Gt.msPointer?"MSPointerUp":"pointerup",ra=Gt.msPointer?"MSPointerCancel":"pointercancel",vo={touchstart:Ji,touchmove:xo,touchend:na,touchcancel:ra},aa={touchstart:Vi,touchmove:Pr,touchend:Pr,touchcancel:Pr},fr={},Ma=!1;function tu(U,k,j){return k==="touchstart"&&za(),aa[k]?(j=aa[k].bind(this,j),U.addEventListener(vo[k],j,!1),j):(console.warn("wrong event specified:",k),d)}function Zo(U,k,j){if(!vo[k]){console.warn("wrong event specified:",k);return}U.removeEventListener(vo[k],j,!1)}function Xs(U){fr[U.pointerId]=U}function Os(U){fr[U.pointerId]&&(fr[U.pointerId]=U)}function Qi(U){delete fr[U.pointerId]}function za(){Ma||(document.addEventListener(Ji,Xs,!0),document.addEventListener(xo,Os,!0),document.addEventListener(na,Qi,!0),document.addEventListener(ra,Qi,!0),Ma=!0)}function Pr(U,k){if(k.pointerType!==(k.MSPOINTER_TYPE_MOUSE||"mouse")){k.touches=[];for(var j in fr)k.touches.push(fr[j]);k.changedTouches=[k],U(k)}}function Vi(U,k){k.MSPOINTER_TYPE_TOUCH&&k.pointerType===k.MSPOINTER_TYPE_TOUCH&&qa(k),Pr(U,k)}function Ls(U){var k={},j,K;for(K in U)j=U[K],k[K]=j&&j.bind?j.bind(U):j;return U=k,k.type="dblclick",k.detail=2,k.isTrusted=!1,k._simulated=!0,k}var hl=200;function Fs(U,k){U.addEventListener("dblclick",k);var j=0,K;function ie(ye){if(ye.detail!==1){K=ye.detail;return}if(!(ye.pointerType==="mouse"||ye.sourceCapabilities&&!ye.sourceCapabilities.firesTouchEvents)){var Ne=ee(ye);if(!(Ne.some(function(rt){return rt instanceof HTMLLabelElement&&rt.attributes.for})&&!Ne.some(function(rt){return rt instanceof HTMLInputElement||rt instanceof HTMLSelectElement}))){var Ze=Date.now();Ze-j<=hl?(K++,K===2&&k(Ls(ye))):K=1,j=Ze}}}return U.addEventListener("click",ie),{dblclick:k,simDblclick:ie}}function mt(U,k){U.removeEventListener("dblclick",k.dblclick),U.removeEventListener("click",k.simDblclick)}var hi=Oi(["transform","webkitTransform","OTransform","MozTransform","msTransform"]),Nn=Oi(["webkitTransition","transition","OTransition","MozTransition","msTransition"]),xr=Nn==="webkitTransition"||Nn==="OTransition"?Nn+"End":"transitionend";function cs(U){return typeof U=="string"?document.getElementById(U):U}function pn(U,k){var j=U.style[k]||U.currentStyle&&U.currentStyle[k];if((!j||j==="auto")&&document.defaultView){var K=document.defaultView.getComputedStyle(U,null);j=K?K[k]:null}return j==="auto"?null:j}function Un(U,k,j){var K=document.createElement(U);return K.className=k||"",j&&j.appendChild(K),K}function mr(U){var k=U.parentNode;k&&k.removeChild(U)}function Vl(U){for(;U.firstChild;)U.removeChild(U.firstChild)}function Dn(U){var k=U.parentNode;k&&k.lastChild!==U&&k.appendChild(U)}function Na(U){var k=U.parentNode;k&&k.firstChild!==U&&k.insertBefore(U,k.firstChild)}function Yi(U,k){if(U.classList!==void 0)return U.classList.contains(k);var j=vr(U);return j.length>0&&new RegExp("(^|\\s)"+k+"(\\s|$)").test(j)}function Di(U,k){if(U.classList!==void 0)for(var j=f(k),K=0,ie=j.length;K<ie;K++)U.classList.add(j[K]);else if(!Yi(U,k)){var ye=vr(U);xi(U,(ye?ye+" ":"")+k)}}function gr(U,k){U.classList!==void 0?U.classList.remove(k):xi(U,h((" "+vr(U)+" ").replace(" "+k+" "," ")))}function xi(U,k){U.className.baseVal===void 0?U.className=k:U.className.baseVal=k}function vr(U){return U.correspondingElement&&(U=U.correspondingElement),U.className.baseVal===void 0?U.className:U.className.baseVal}function _t(U,k){"opacity"in U.style?U.style.opacity=k:"filter"in U.style&&oi(U,k)}function oi(U,k){var j=!1,K="DXImageTransform.Microsoft.Alpha";try{j=U.filters.item(K)}catch{if(k===1)return}k=Math.round(k*100),j?(j.Enabled=k!==100,j.Opacity=k):U.style.filter+=" progid:"+K+"(opacity="+k+")"}function Oi(U){for(var k=document.documentElement.style,j=0;j<U.length;j++)if(U[j]in k)return U[j];return!1}function nn(U,k,j){var K=k||new O(0,0);U.style[hi]=(Gt.ie3d?"translate("+K.x+"px,"+K.y+"px)":"translate3d("+K.x+"px,"+K.y+"px,0)")+(j?" scale("+j+")":"")}function si(U,k){U._leaflet_pos=k,Gt.any3d?nn(U,k):(U.style.left=k.x+"px",U.style.top=k.y+"px")}function ji(U){return U._leaflet_pos||new O(0,0)}var ur,Mi,Sa;if("onselectstart"in document)ur=function(){Li(window,"selectstart",qa)},Mi=function(){lr(window,"selectstart",qa)};else{var jl=Oi(["userSelect","WebkitUserSelect","OUserSelect","MozUserSelect","msUserSelect"]);ur=function(){if(jl){var U=document.documentElement.style;Sa=U[jl],U[jl]="none"}},Mi=function(){jl&&(document.documentElement.style[jl]=Sa,Sa=void 0)}}function Xo(){Li(window,"dragstart",qa)}function Aa(){lr(window,"dragstart",qa)}var Bs,Ad;function Gl(U){for(;U.tabIndex===-1;)U=U.parentNode;U.style&&(_d(),Bs=U,Ad=U.style.outlineStyle,U.style.outlineStyle="none",Li(window,"keydown",_d))}function _d(){Bs&&(Bs.style.outlineStyle=Ad,Bs=void 0,Ad=void 0,lr(window,"keydown",_d))}function Jo(U){do U=U.parentNode;while((!U.offsetWidth||!U.offsetHeight)&&U!==document.body);return U}function Ta(U){var k=U.getBoundingClientRect();return{x:k.width/U.offsetWidth||1,y:k.height/U.offsetHeight||1,boundingClientRect:k}}var fl={__proto__:null,TRANSFORM:hi,TRANSITION:Nn,TRANSITION_END:xr,get:cs,getStyle:pn,create:Un,remove:mr,empty:Vl,toFront:Dn,toBack:Na,hasClass:Yi,addClass:Di,removeClass:gr,setClass:xi,getClass:vr,setOpacity:_t,testProp:Oi,setTransform:nn,setPosition:si,getPosition:ji,get disableTextSelection(){return ur},get enableTextSelection(){return Mi},disableImageDrag:Xo,enableImageDrag:Aa,preventOutline:Gl,restoreOutline:_d,getSizedParentNode:Jo,getScale:Ta};function Li(U,k,j,K){if(k&&typeof k=="object")for(var ie in k)us(U,ie,k[ie],j);else{k=f(k);for(var ye=0,Ne=k.length;ye<Ne;ye++)us(U,k[ye],j,K)}return this}var Oo="_leaflet_events";function lr(U,k,j,K){if(arguments.length===1)fc(U),delete U[Oo];else if(k&&typeof k=="object")for(var ie in k)kd(U,ie,k[ie],j);else if(k=f(k),arguments.length===2)fc(U,function(Ze){return I(k,Ze)!==-1});else for(var ye=0,Ne=k.length;ye<Ne;ye++)kd(U,k[ye],j,K);return this}function fc(U,k){for(var j in U[Oo]){var K=j.split(/\d/)[0];(!k||k(K))&&kd(U,K,null,null,j)}}var Hh={mouseenter:"mouseover",mouseleave:"mouseout",wheel:!("onwheel"in window)&&"mousewheel"};function us(U,k,j,K){var ie=k+l(j)+(K?"_"+l(K):"");if(U[Oo]&&U[Oo][ie])return this;var ye=function(Ze){return j.call(K||U,Ze||window.event)},Ne=ye;!Gt.touchNative&&Gt.pointer&&k.indexOf("touch")===0?ye=tu(U,k,ye):Gt.touch&&k==="dblclick"?ye=Fs(U,ye):"addEventListener"in U?k==="touchstart"||k==="touchmove"||k==="wheel"||k==="mousewheel"?U.addEventListener(Hh[k]||k,ye,Gt.passiveEvents?{passive:!1}:!1):k==="mouseenter"||k==="mouseleave"?(ye=function(Ze){Ze=Ze||window.event,qi(U,Ze)&&Ne(Ze)},U.addEventListener(Hh[k],ye,!1)):U.addEventListener(k,Ne,!1):U.attachEvent("on"+k,ye),U[Oo]=U[Oo]||{},U[Oo][ie]=ye}function kd(U,k,j,K,ie){ie=ie||k+l(j)+(K?"_"+l(K):"");var ye=U[Oo]&&U[Oo][ie];if(!ye)return this;!Gt.touchNative&&Gt.pointer&&k.indexOf("touch")===0?Zo(U,k,ye):Gt.touch&&k==="dblclick"?mt(U,ye):"removeEventListener"in U?U.removeEventListener(Hh[k]||k,ye,!1):U.detachEvent("on"+k,ye),U[Oo][ie]=null}function Qo(U){return U.stopPropagation?U.stopPropagation():U.originalEvent?U.originalEvent._stopped=!0:U.cancelBubble=!0,this}function xd(U){return us(U,"wheel",Qo),this}function ml(U){return Li(U,"mousedown touchstart dblclick contextmenu",Qo),U._leaflet_disable_click=!0,this}function qa(U){return U.preventDefault?U.preventDefault():U.returnValue=!1,this}function iu(U){return qa(U),Qo(U),this}function ee(U){if(U.composedPath)return U.composedPath();for(var k=[],j=U.target;j;)k.push(j),j=j.parentNode;return k}function be(U,k){if(!k)return new O(U.clientX,U.clientY);var j=Ta(k),K=j.boundingClientRect;return new O((U.clientX-K.left)/j.x-k.clientLeft,(U.clientY-K.top)/j.y-k.clientTop)}var Ae=Gt.linux&&Gt.chrome?window.devicePixelRatio:Gt.mac?window.devicePixelRatio*3:window.devicePixelRatio>0?2*window.devicePixelRatio:1;function dt(U){return Gt.edge?U.wheelDeltaY/2:U.deltaY&&U.deltaMode===0?-U.deltaY/Ae:U.deltaY&&U.deltaMode===1?-U.deltaY*20:U.deltaY&&U.deltaMode===2?-U.deltaY*60:U.deltaX||U.deltaZ?0:U.wheelDelta?(U.wheelDeltaY||U.wheelDelta)/2:U.detail&&Math.abs(U.detail)<32765?-U.detail*20:U.detail?U.detail/-32765*60:0}function qi(U,k){var j=k.relatedTarget;if(!j)return!0;try{for(;j&&j!==U;)j=j.parentNode}catch{return!1}return j!==U}var gi={__proto__:null,on:Li,off:lr,stopPropagation:Qo,disableScrollPropagation:xd,disableClickPropagation:ml,preventDefault:qa,stop:iu,getPropagationPath:ee,getMousePosition:be,getWheelDelta:dt,isExternalTarget:qi,addListener:Li,removeListener:lr},kn=x.extend({run:function(U,k,j,K){this.stop(),this._el=U,this._inProgress=!0,this._duration=j||.25,this._easeOutPower=1/Math.max(K||.5,.2),this._startPos=ji(U),this._offset=k.subtract(this._startPos),this._startTime=+new Date,this.fire("start"),this._animate()},stop:function(){this._inProgress&&(this._step(!0),this._complete())},_animate:function(){this._animId=P(this._animate,this),this._step()},_step:function(U){var k=+new Date-this._startTime,j=this._duration*1e3;k<j?this._runFrame(this._easeOut(k/j),U):(this._runFrame(1),this._complete())},_runFrame:function(U,k){var j=this._startPos.add(this._offset.multiplyBy(U));k&&j._round(),si(this._el,j),this.fire("step")},_complete:function(){R(this._animId),this._inProgress=!1,this.fire("end")},_easeOut:function(U){return 1-Math.pow(1-U,this._easeOutPower)}}),ii=x.extend({options:{crs:se,center:void 0,zoom:void 0,minZoom:void 0,maxZoom:void 0,layers:[],maxBounds:void 0,renderer:void 0,zoomAnimation:!0,zoomAnimationThreshold:4,fadeAnimation:!0,markerZoomAnimation:!0,transform3DLimit:8388608,zoomSnap:1,zoomDelta:1,trackResize:!0},initialize:function(U,k){k=m(this,k),this._handlers=[],this._layers={},this._zoomBoundLayers={},this._sizeChanged=!0,this._initContainer(U),this._initLayout(),this._onResize=o(this._onResize,this),this._initEvents(),k.maxBounds&&this.setMaxBounds(k.maxBounds),k.zoom!==void 0&&(this._zoom=this._limitZoom(k.zoom)),k.center&&k.zoom!==void 0&&this.setView(Z(k.center),k.zoom,{reset:!0}),this.callInitHooks(),this._zoomAnimated=Nn&&Gt.any3d&&!Gt.mobileOpera&&this.options.zoomAnimation,this._zoomAnimated&&(this._createAnimProxy(),Li(this._proxy,xr,this._catchTransitionEnd,this)),this._addLayers(this.options.layers)},setView:function(U,k,j){if(k=k===void 0?this._zoom:this._limitZoom(k),U=this._limitCenter(Z(U),k,this.options.maxBounds),j=j||{},this._stop(),this._loaded&&!j.reset&&j!==!0){j.animate!==void 0&&(j.zoom=r({animate:j.animate},j.zoom),j.pan=r({animate:j.animate,duration:j.duration},j.pan));var K=this._zoom!==k?this._tryAnimatedZoom&&this._tryAnimatedZoom(U,k,j.zoom):this._tryAnimatedPan(U,j.pan);if(K)return clearTimeout(this._sizeTimer),this}return this._resetView(U,k,j.pan&&j.pan.noMoveStart),this},setZoom:function(U,k){return this._loaded?this.setView(this.getCenter(),U,{zoom:k}):(this._zoom=U,this)},zoomIn:function(U,k){return U=U||(Gt.any3d?this.options.zoomDelta:1),this.setZoom(this._zoom+U,k)},zoomOut:function(U,k){return U=U||(Gt.any3d?this.options.zoomDelta:1),this.setZoom(this._zoom-U,k)},setZoomAround:function(U,k,j){var K=this.getZoomScale(k),ie=this.getSize().divideBy(2),ye=U instanceof O?U:this.latLngToContainerPoint(U),Ne=ye.subtract(ie).multiplyBy(1-1/K),Ze=this.containerPointToLatLng(ie.add(Ne));return this.setView(Ze,k,{zoom:j})},_getBoundsCenterZoom:function(U,k){k=k||{},U=U.getBounds?U.getBounds():q(U);var j=F(k.paddingTopLeft||k.padding||[0,0]),K=F(k.paddingBottomRight||k.padding||[0,0]),ie=this.getBoundsZoom(U,!1,j.add(K));if(ie=typeof k.maxZoom=="number"?Math.min(k.maxZoom,ie):ie,ie===1/0)return{center:U.getCenter(),zoom:ie};var ye=K.subtract(j).divideBy(2),Ne=this.project(U.getSouthWest(),ie),Ze=this.project(U.getNorthEast(),ie),rt=this.unproject(Ne.add(Ze).divideBy(2).add(ye),ie);return{center:rt,zoom:ie}},fitBounds:function(U,k){if(U=q(U),!U.isValid())throw new Error("Bounds are not valid.");var j=this._getBoundsCenterZoom(U,k);return this.setView(j.center,j.zoom,k)},fitWorld:function(U){return this.fitBounds([[-90,-180],[90,180]],U)},panTo:function(U,k){return this.setView(U,this._zoom,{pan:k})},panBy:function(U,k){if(U=F(U).round(),k=k||{},!U.x&&!U.y)return this.fire("moveend");if(k.animate!==!0&&!this.getSize().contains(U))return this._resetView(this.unproject(this.project(this.getCenter()).add(U)),this.getZoom()),this;if(this._panAnim||(this._panAnim=new kn,this._panAnim.on({step:this._onPanTransitionStep,end:this._onPanTransitionEnd},this)),k.noMoveStart||this.fire("movestart"),k.animate!==!1){Di(this._mapPane,"leaflet-pan-anim");var j=this._getMapPanePos().subtract(U).round();this._panAnim.run(this._mapPane,j,k.duration||.25,k.easeLinearity)}else this._rawPanBy(U),this.fire("move").fire("moveend");return this},flyTo:function(U,k,j){if(j=j||{},j.animate===!1||!Gt.any3d)return this.setView(U,k,j);this._stop();var K=this.project(this.getCenter()),ie=this.project(U),ye=this.getSize(),Ne=this._zoom;U=Z(U),k=k===void 0?Ne:k;var Ze=Math.max(ye.x,ye.y),rt=Ze*this.getZoomScale(Ne,k),Dt=ie.distanceTo(K)||1,ni=1.42,rn=ni*ni;function tr(ps){var mM=ps?-1:1,YCe=ps?rt:Ze,ZCe=rt*rt-Ze*Ze+mM*rn*rn*Dt*Dt,XCe=2*YCe*rn*Dt,RB=ZCe/XCe,OK=Math.sqrt(RB*RB+1)-RB,JCe=OK<1e-9?-18:Math.log(OK);return JCe}function gc(ps){return(Math.exp(ps)-Math.exp(-ps))/2}function Js(ps){return(Math.exp(ps)+Math.exp(-ps))/2}function Bd(ps){return gc(ps)/Js(ps)}var au=tr(0);function Kw(ps){return Ze*(Js(au)/Js(au+ni*ps))}function zCe(ps){return Ze*(Js(au)*Bd(au+ni*ps)-gc(au))/rn}function qCe(ps){return 1-Math.pow(1-ps,1.5)}var WCe=Date.now(),kK=(tr(1)-au)/ni,KCe=j.duration?1e3*j.duration:1e3*kK*.8;function xK(){var ps=(Date.now()-WCe)/KCe,mM=qCe(ps)*kK;ps<=1?(this._flyToFrame=P(xK,this),this._move(this.unproject(K.add(ie.subtract(K).multiplyBy(zCe(mM)/Dt)),Ne),this.getScaleZoom(Ze/Kw(mM),Ne),{flyTo:!0})):this._move(U,k)._moveEnd(!0)}return this._moveStart(!0,j.noMoveStart),xK.call(this),this},flyToBounds:function(U,k){var j=this._getBoundsCenterZoom(U,k);return this.flyTo(j.center,j.zoom,k)},setMaxBounds:function(U){return U=q(U),this.listens("moveend",this._panInsideMaxBounds)&&this.off("moveend",this._panInsideMaxBounds),U.isValid()?(this.options.maxBounds=U,this._loaded&&this._panInsideMaxBounds(),this.on("moveend",this._panInsideMaxBounds)):(this.options.maxBounds=null,this)},setMinZoom:function(U){var k=this.options.minZoom;return this.options.minZoom=U,this._loaded&&k!==U&&(this.fire("zoomlevelschange"),this.getZoom()<this.options.minZoom)?this.setZoom(U):this},setMaxZoom:function(U){var k=this.options.maxZoom;return this.options.maxZoom=U,this._loaded&&k!==U&&(this.fire("zoomlevelschange"),this.getZoom()>this.options.maxZoom)?this.setZoom(U):this},panInsideBounds:function(U,k){this._enforcingBounds=!0;var j=this.getCenter(),K=this._limitCenter(j,this._zoom,q(U));return j.equals(K)||this.panTo(K,k),this._enforcingBounds=!1,this},panInside:function(U,k){k=k||{};var j=F(k.paddingTopLeft||k.padding||[0,0]),K=F(k.paddingBottomRight||k.padding||[0,0]),ie=this.project(this.getCenter()),ye=this.project(U),Ne=this.getPixelBounds(),Ze=H([Ne.min.add(j),Ne.max.subtract(K)]),rt=Ze.getSize();if(!Ze.contains(ye)){this._enforcingBounds=!0;var Dt=ye.subtract(Ze.getCenter()),ni=Ze.extend(ye).getSize().subtract(rt);ie.x+=Dt.x<0?-ni.x:ni.x,ie.y+=Dt.y<0?-ni.y:ni.y,this.panTo(this.unproject(ie),k),this._enforcingBounds=!1}return this},invalidateSize:function(U){if(!this._loaded)return this;U=r({animate:!1,pan:!0},U===!0?{animate:!0}:U);var k=this.getSize();this._sizeChanged=!0,this._lastCenter=null;var j=this.getSize(),K=k.divideBy(2).round(),ie=j.divideBy(2).round(),ye=K.subtract(ie);return!ye.x&&!ye.y?this:(U.animate&&U.pan?this.panBy(ye):(U.pan&&this._rawPanBy(ye),this.fire("move"),U.debounceMoveend?(clearTimeout(this._sizeTimer),this._sizeTimer=setTimeout(o(this.fire,this,"moveend"),200)):this.fire("moveend")),this.fire("resize",{oldSize:k,newSize:j}))},stop:function(){return this.setZoom(this._limitZoom(this._zoom)),this.options.zoomSnap||this.fire("viewreset"),this._stop()},locate:function(U){if(U=this._locateOptions=r({timeout:1e4,watch:!1},U),!("geolocation"in navigator))return this._handleGeolocationError({code:0,message:"Geolocation not supported."}),this;var k=o(this._handleGeolocationResponse,this),j=o(this._handleGeolocationError,this);return U.watch?this._locationWatchId=navigator.geolocation.watchPosition(k,j,U):navigator.geolocation.getCurrentPosition(k,j,U),this},stopLocate:function(){return navigator.geolocation&&navigator.geolocation.clearWatch&&navigator.geolocation.clearWatch(this._locationWatchId),this._locateOptions&&(this._locateOptions.setView=!1),this},_handleGeolocationError:function(U){if(this._container._leaflet_id){var k=U.code,j=U.message||(k===1?"permission denied":k===2?"position unavailable":"timeout");this._locateOptions.setView&&!this._loaded&&this.fitWorld(),this.fire("locationerror",{code:k,message:"Geolocation error: "+j+"."})}},_handleGeolocationResponse:function(U){if(this._container._leaflet_id){var k=U.coords.latitude,j=U.coords.longitude,K=new z(k,j),ie=K.toBounds(U.coords.accuracy*2),ye=this._locateOptions;if(ye.setView){var Ne=this.getBoundsZoom(ie);this.setView(K,ye.maxZoom?Math.min(Ne,ye.maxZoom):Ne)}var Ze={latlng:K,bounds:ie,timestamp:U.timestamp};for(var rt in U.coords)typeof U.coords[rt]=="number"&&(Ze[rt]=U.coords[rt]);this.fire("locationfound",Ze)}},addHandler:function(U,k){if(!k)return this;var j=this[U]=new k(this);return this._handlers.push(j),this.options[U]&&j.enable(),this},remove:function(){if(this._initEvents(!0),this.options.maxBounds&&this.off("moveend",this._panInsideMaxBounds),this._containerId!==this._container._leaflet_id)throw new Error("Map container is being reused by another instance");try{delete this._container._leaflet_id,delete this._containerId}catch{this._container._leaflet_id=void 0,this._containerId=void 0}this._locationWatchId!==void 0&&this.stopLocate(),this._stop(),mr(this._mapPane),this._clearControlPos&&this._clearControlPos(),this._resizeRequest&&(R(this._resizeRequest),this._resizeRequest=null),this._clearHandlers(),this._loaded&&this.fire("unload");var U;for(U in this._layers)this._layers[U].remove();for(U in this._panes)mr(this._panes[U]);return this._layers=[],this._panes=[],delete this._mapPane,delete this._renderer,this},createPane:function(U,k){var j="leaflet-pane"+(U?" leaflet-"+U.replace("Pane","")+"-pane":""),K=Un("div",j,k||this._mapPane);return U&&(this._panes[U]=K),K},getCenter:function(){return this._checkIfLoaded(),this._lastCenter&&!this._moved()?this._lastCenter.clone():this.layerPointToLatLng(this._getCenterLayerPoint())},getZoom:function(){return this._zoom},getBounds:function(){var U=this.getPixelBounds(),k=this.unproject(U.getBottomLeft()),j=this.unproject(U.getTopRight());return new $(k,j)},getMinZoom:function(){return this.options.minZoom===void 0?this._layersMinZoom||0:this.options.minZoom},getMaxZoom:function(){return this.options.maxZoom===void 0?this._layersMaxZoom===void 0?1/0:this._layersMaxZoom:this.options.maxZoom},getBoundsZoom:function(U,k,j){U=q(U),j=F(j||[0,0]);var K=this.getZoom()||0,ie=this.getMinZoom(),ye=this.getMaxZoom(),Ne=U.getNorthWest(),Ze=U.getSouthEast(),rt=this.getSize().subtract(j),Dt=H(this.project(Ze,K),this.project(Ne,K)).getSize(),ni=Gt.any3d?this.options.zoomSnap:1,rn=rt.x/Dt.x,tr=rt.y/Dt.y,gc=k?Math.max(rn,tr):Math.min(rn,tr);return K=this.getScaleZoom(gc,K),ni&&(K=Math.round(K/(ni/100))*(ni/100),K=k?Math.ceil(K/ni)*ni:Math.floor(K/ni)*ni),Math.max(ie,Math.min(ye,K))},getSize:function(){return(!this._size||this._sizeChanged)&&(this._size=new O(this._container.clientWidth||0,this._container.clientHeight||0),this._sizeChanged=!1),this._size.clone()},getPixelBounds:function(U,k){var j=this._getTopLeftPoint(U,k);return new G(j,j.add(this.getSize()))},getPixelOrigin:function(){return this._checkIfLoaded(),this._pixelOrigin},getPixelWorldBounds:function(U){return this.options.crs.getProjectedBounds(U===void 0?this.getZoom():U)},getPane:function(U){return typeof U=="string"?this._panes[U]:U},getPanes:function(){return this._panes},getContainer:function(){return this._container},getZoomScale:function(U,k){var j=this.options.crs;return k=k===void 0?this._zoom:k,j.scale(U)/j.scale(k)},getScaleZoom:function(U,k){var j=this.options.crs;k=k===void 0?this._zoom:k;var K=j.zoom(U*j.scale(k));return isNaN(K)?1/0:K},project:function(U,k){return k=k===void 0?this._zoom:k,this.options.crs.latLngToPoint(Z(U),k)},unproject:function(U,k){return k=k===void 0?this._zoom:k,this.options.crs.pointToLatLng(F(U),k)},layerPointToLatLng:function(U){var k=F(U).add(this.getPixelOrigin());return this.unproject(k)},latLngToLayerPoint:function(U){var k=this.project(Z(U))._round();return k._subtract(this.getPixelOrigin())},wrapLatLng:function(U){return this.options.crs.wrapLatLng(Z(U))},wrapLatLngBounds:function(U){return this.options.crs.wrapLatLngBounds(q(U))},distance:function(U,k){return this.options.crs.distance(Z(U),Z(k))},containerPointToLayerPoint:function(U){return F(U).subtract(this._getMapPanePos())},layerPointToContainerPoint:function(U){return F(U).add(this._getMapPanePos())},containerPointToLatLng:function(U){var k=this.containerPointToLayerPoint(F(U));return this.layerPointToLatLng(k)},latLngToContainerPoint:function(U){return this.layerPointToContainerPoint(this.latLngToLayerPoint(Z(U)))},mouseEventToContainerPoint:function(U){return be(U,this._container)},mouseEventToLayerPoint:function(U){return this.containerPointToLayerPoint(this.mouseEventToContainerPoint(U))},mouseEventToLatLng:function(U){return this.layerPointToLatLng(this.mouseEventToLayerPoint(U))},_initContainer:function(U){var k=this._container=cs(U);if(k){if(k._leaflet_id)throw new Error("Map container is already initialized.")}else throw new Error("Map container not found.");Li(k,"scroll",this._onScroll,this),this._containerId=l(k)},_initLayout:function(){var U=this._container;this._fadeAnimated=this.options.fadeAnimation&&Gt.any3d,Di(U,"leaflet-container"+(Gt.touch?" leaflet-touch":"")+(Gt.retina?" leaflet-retina":"")+(Gt.ielt9?" leaflet-oldie":"")+(Gt.safari?" leaflet-safari":"")+(this._fadeAnimated?" leaflet-fade-anim":""));var k=pn(U,"position");k!=="absolute"&&k!=="relative"&&k!=="fixed"&&k!=="sticky"&&(U.style.position="relative"),this._initPanes(),this._initControlPos&&this._initControlPos()},_initPanes:function(){var U=this._panes={};this._paneRenderers={},this._mapPane=this.createPane("mapPane",this._container),si(this._mapPane,new O(0,0)),this.createPane("tilePane"),this.createPane("overlayPane"),this.createPane("shadowPane"),this.createPane("markerPane"),this.createPane("tooltipPane"),this.createPane("popupPane"),this.options.markerZoomAnimation||(Di(U.markerPane,"leaflet-zoom-hide"),Di(U.shadowPane,"leaflet-zoom-hide"))},_resetView:function(U,k,j){si(this._mapPane,new O(0,0));var K=!this._loaded;this._loaded=!0,k=this._limitZoom(k),this.fire("viewprereset");var ie=this._zoom!==k;this._moveStart(ie,j)._move(U,k)._moveEnd(ie),this.fire("viewreset"),K&&this.fire("load")},_moveStart:function(U,k){return U&&this.fire("zoomstart"),k||this.fire("movestart"),this},_move:function(U,k,j,K){k===void 0&&(k=this._zoom);var ie=this._zoom!==k;return this._zoom=k,this._lastCenter=U,this._pixelOrigin=this._getNewPixelOrigin(U),K?j&&j.pinch&&this.fire("zoom",j):((ie||j&&j.pinch)&&this.fire("zoom",j),this.fire("move",j)),this},_moveEnd:function(U){return U&&this.fire("zoomend"),this.fire("moveend")},_stop:function(){return R(this._flyToFrame),this._panAnim&&this._panAnim.stop(),this},_rawPanBy:function(U){si(this._mapPane,this._getMapPanePos().subtract(U))},_getZoomSpan:function(){return this.getMaxZoom()-this.getMinZoom()},_panInsideMaxBounds:function(){this._enforcingBounds||this.panInsideBounds(this.options.maxBounds)},_checkIfLoaded:function(){if(!this._loaded)throw new Error("Set map center and zoom first.")},_initEvents:function(U){this._targets={},this._targets[l(this._container)]=this;var k=U?lr:Li;k(this._container,"click dblclick mousedown mouseup mouseover mouseout mousemove contextmenu keypress keydown keyup",this._handleDOMEvent,this),this.options.trackResize&&k(window,"resize",this._onResize,this),Gt.any3d&&this.options.transform3DLimit&&(U?this.off:this.on).call(this,"moveend",this._onMoveEnd)},_onResize:function(){R(this._resizeRequest),this._resizeRequest=P(function(){this.invalidateSize({debounceMoveend:!0})},this)},_onScroll:function(){this._container.scrollTop=0,this._container.scrollLeft=0},_onMoveEnd:function(){var U=this._getMapPanePos();Math.max(Math.abs(U.x),Math.abs(U.y))>=this.options.transform3DLimit&&this._resetView(this.getCenter(),this.getZoom())},_findEventTargets:function(U,k){for(var j=[],K,ie=k==="mouseout"||k==="mouseover",ye=U.target||U.srcElement,Ne=!1;ye;){if(K=this._targets[l(ye)],K&&(k==="click"||k==="preclick")&&this._draggableMoved(K)){Ne=!0;break}if(K&&K.listens(k,!0)&&(ie&&!qi(ye,U)||(j.push(K),ie))||ye===this._container)break;ye=ye.parentNode}return!j.length&&!Ne&&!ie&&this.listens(k,!0)&&(j=[this]),j},_isClickDisabled:function(U){for(;U&&U!==this._container;){if(U._leaflet_disable_click)return!0;U=U.parentNode}},_handleDOMEvent:function(U){var k=U.target||U.srcElement;if(!(!this._loaded||k._leaflet_disable_events||U.type==="click"&&this._isClickDisabled(k))){var j=U.type;j==="mousedown"&&Gl(k),this._fireDOMEvent(U,j)}},_mouseEvents:["click","dblclick","mouseover","mouseout","contextmenu"],_fireDOMEvent:function(U,k,j){if(U.type==="click"){var K=r({},U);K.type="preclick",this._fireDOMEvent(K,K.type,j)}var ie=this._findEventTargets(U,k);if(j){for(var ye=[],Ne=0;Ne<j.length;Ne++)j[Ne].listens(k,!0)&&ye.push(j[Ne]);ie=ye.concat(ie)}if(ie.length){k==="contextmenu"&&qa(U);var Ze=ie[0],rt={originalEvent:U};if(U.type!=="keypress"&&U.type!=="keydown"&&U.type!=="keyup"){var Dt=Ze.getLatLng&&(!Ze._radius||Ze._radius<=10);rt.containerPoint=Dt?this.latLngToContainerPoint(Ze.getLatLng()):this.mouseEventToContainerPoint(U),rt.layerPoint=this.containerPointToLayerPoint(rt.containerPoint),rt.latlng=Dt?Ze.getLatLng():this.layerPointToLatLng(rt.layerPoint)}for(Ne=0;Ne<ie.length;Ne++)if(ie[Ne].fire(k,rt,!0),rt.originalEvent._stopped||ie[Ne].options.bubblingMouseEvents===!1&&I(this._mouseEvents,k)!==-1)return}},_draggableMoved:function(U){return U=U.dragging&&U.dragging.enabled()?U:this,U.dragging&&U.dragging.moved()||this.boxZoom&&this.boxZoom.moved()},_clearHandlers:function(){for(var U=0,k=this._handlers.length;U<k;U++)this._handlers[U].disable()},whenReady:function(U,k){return this._loaded?U.call(k||this,{target:this}):this.on("load",U,k),this},_getMapPanePos:function(){return ji(this._mapPane)||new O(0,0)},_moved:function(){var U=this._getMapPanePos();return U&&!U.equals([0,0])},_getTopLeftPoint:function(U,k){var j=U&&k!==void 0?this._getNewPixelOrigin(U,k):this.getPixelOrigin();return j.subtract(this._getMapPanePos())},_getNewPixelOrigin:function(U,k){var j=this.getSize()._divideBy(2);return this.project(U,k)._subtract(j)._add(this._getMapPanePos())._round()},_latLngToNewLayerPoint:function(U,k,j){var K=this._getNewPixelOrigin(j,k);return this.project(U,k)._subtract(K)},_latLngBoundsToNewLayerBounds:function(U,k,j){var K=this._getNewPixelOrigin(j,k);return H([this.project(U.getSouthWest(),k)._subtract(K),this.project(U.getNorthWest(),k)._subtract(K),this.project(U.getSouthEast(),k)._subtract(K),this.project(U.getNorthEast(),k)._subtract(K)])},_getCenterLayerPoint:function(){return this.containerPointToLayerPoint(this.getSize()._divideBy(2))},_getCenterOffset:function(U){return this.latLngToLayerPoint(U).subtract(this._getCenterLayerPoint())},_limitCenter:function(U,k,j){if(!j)return U;var K=this.project(U,k),ie=this.getSize().divideBy(2),ye=new G(K.subtract(ie),K.add(ie)),Ne=this._getBoundsOffset(ye,j,k);return Math.abs(Ne.x)<=1&&Math.abs(Ne.y)<=1?U:this.unproject(K.add(Ne),k)},_limitOffset:function(U,k){if(!k)return U;var j=this.getPixelBounds(),K=new G(j.min.add(U),j.max.add(U));return U.add(this._getBoundsOffset(K,k))},_getBoundsOffset:function(U,k,j){var K=H(this.project(k.getNorthEast(),j),this.project(k.getSouthWest(),j)),ie=K.min.subtract(U.min),ye=K.max.subtract(U.max),Ne=this._rebound(ie.x,-ye.x),Ze=this._rebound(ie.y,-ye.y);return new O(Ne,Ze)},_rebound:function(U,k){return U+k>0?Math.round(U-k)/2:Math.max(0,Math.ceil(U))-Math.max(0,Math.floor(k))},_limitZoom:function(U){var k=this.getMinZoom(),j=this.getMaxZoom(),K=Gt.any3d?this.options.zoomSnap:1;return K&&(U=Math.round(U/K)*K),Math.max(k,Math.min(j,U))},_onPanTransitionStep:function(){this.fire("move")},_onPanTransitionEnd:function(){gr(this._mapPane,"leaflet-pan-anim"),this.fire("moveend")},_tryAnimatedPan:function(U,k){var j=this._getCenterOffset(U)._trunc();return(k&&k.animate)!==!0&&!this.getSize().contains(j)?!1:(this.panBy(j,k),!0)},_createAnimProxy:function(){var U=this._proxy=Un("div","leaflet-proxy leaflet-zoom-animated");this._panes.mapPane.appendChild(U),this.on("zoomanim",function(k){var j=hi,K=this._proxy.style[j];nn(this._proxy,this.project(k.center,k.zoom),this.getZoomScale(k.zoom,1)),K===this._proxy.style[j]&&this._animatingZoom&&this._onZoomTransitionEnd()},this),this.on("load moveend",this._animMoveEnd,this),this._on("unload",this._destroyAnimProxy,this)},_destroyAnimProxy:function(){mr(this._proxy),this.off("load moveend",this._animMoveEnd,this),delete this._proxy},_animMoveEnd:function(){var U=this.getCenter(),k=this.getZoom();nn(this._proxy,this.project(U,k),this.getZoomScale(k,1))},_catchTransitionEnd:function(U){this._animatingZoom&&U.propertyName.indexOf("transform")>=0&&this._onZoomTransitionEnd()},_nothingToAnimate:function(){return!this._container.getElementsByClassName("leaflet-zoom-animated").length},_tryAnimatedZoom:function(U,k,j){if(this._animatingZoom)return!0;if(j=j||{},!this._zoomAnimated||j.animate===!1||this._nothingToAnimate()||Math.abs(k-this._zoom)>this.options.zoomAnimationThreshold)return!1;var K=this.getZoomScale(k),ie=this._getCenterOffset(U)._divideBy(1-1/K);return j.animate!==!0&&!this.getSize().contains(ie)?!1:(P(function(){this._moveStart(!0,j.noMoveStart||!1)._animateZoom(U,k,!0)},this),!0)},_animateZoom:function(U,k,j,K){this._mapPane&&(j&&(this._animatingZoom=!0,this._animateToCenter=U,this._animateToZoom=k,Di(this._mapPane,"leaflet-zoom-anim")),this.fire("zoomanim",{center:U,zoom:k,noUpdate:K}),this._tempFireZoomEvent||(this._tempFireZoomEvent=this._zoom!==this._animateToZoom),this._move(this._animateToCenter,this._animateToZoom,void 0,!0),setTimeout(o(this._onZoomTransitionEnd,this),250))},_onZoomTransitionEnd:function(){this._animatingZoom&&(this._mapPane&&gr(this._mapPane,"leaflet-zoom-anim"),this._animatingZoom=!1,this._move(this._animateToCenter,this._animateToZoom,void 0,!0),this._tempFireZoomEvent&&this.fire("zoom"),delete this._tempFireZoomEvent,this.fire("move"),this._moveEnd(!0))}});function po(U,k){return new ii(U,k)}var En=M.extend({options:{position:"topright"},initialize:function(U){m(this,U)},getPosition:function(){return this.options.position},setPosition:function(U){var k=this._map;return k&&k.removeControl(this),this.options.position=U,k&&k.addControl(this),this},getContainer:function(){return this._container},addTo:function(U){this.remove(),this._map=U;var k=this._container=this.onAdd(U),j=this.getPosition(),K=U._controlCorners[j];return Di(k,"leaflet-control"),j.indexOf("bottom")!==-1?K.insertBefore(k,K.firstChild):K.appendChild(k),this._map.on("unload",this.remove,this),this},remove:function(){return this._map?(mr(this._container),this.onRemove&&this.onRemove(this._map),this._map.off("unload",this.remove,this),this._map=null,this):this},_refocusOnMap:function(U){this._map&&U&&U.screenX>0&&U.screenY>0&&this._map.getContainer().focus()}}),_a=function(U){return new En(U)};ii.include({addControl:function(U){return U.addTo(this),this},removeControl:function(U){return U.remove(),this},_initControlPos:function(){var U=this._controlCorners={},k="leaflet-",j=this._controlContainer=Un("div",k+"control-container",this._container);function K(ie,ye){var Ne=k+ie+" "+k+ye;U[ie+ye]=Un("div",Ne,j)}K("top","left"),K("top","right"),K("bottom","left"),K("bottom","right")},_clearControlPos:function(){for(var U in this._controlCorners)mr(this._controlCorners[U]);mr(this._controlContainer),delete this._controlCorners,delete this._controlContainer}});var es=En.extend({options:{collapsed:!0,position:"topright",autoZIndex:!0,hideSingleBase:!1,sortLayers:!1,sortFunction:function(U,k,j,K){return j<K?-1:K<j?1:0}},initialize:function(U,k,j){m(this,j),this._layerControlInputs=[],this._layers=[],this._lastZIndex=0,this._handlingClick=!1,this._preventClick=!1;for(var K in U)this._addLayer(U[K],K);for(K in k)this._addLayer(k[K],K,!0)},onAdd:function(U){this._initLayout(),this._update(),this._map=U,U.on("zoomend",this._checkDisabledLayers,this);for(var k=0;k<this._layers.length;k++)this._layers[k].layer.on("add remove",this._onLayerChange,this);return this._container},addTo:function(U){return En.prototype.addTo.call(this,U),this._expandIfNotCollapsed()},onRemove:function(){this._map.off("zoomend",this._checkDisabledLayers,this);for(var U=0;U<this._layers.length;U++)this._layers[U].layer.off("add remove",this._onLayerChange,this)},addBaseLayer:function(U,k){return this._addLayer(U,k),this._map?this._update():this},addOverlay:function(U,k){return this._addLayer(U,k,!0),this._map?this._update():this},removeLayer:function(U){U.off("add remove",this._onLayerChange,this);var k=this._getLayer(l(U));return k&&this._layers.splice(this._layers.indexOf(k),1),this._map?this._update():this},expand:function(){Di(this._container,"leaflet-control-layers-expanded"),this._section.style.height=null;var U=this._map.getSize().y-(this._container.offsetTop+50);return U<this._section.clientHeight?(Di(this._section,"leaflet-control-layers-scrollbar"),this._section.style.height=U+"px"):gr(this._section,"leaflet-control-layers-scrollbar"),this._checkDisabledLayers(),this},collapse:function(){return gr(this._container,"leaflet-control-layers-expanded"),this},_initLayout:function(){var U="leaflet-control-layers",k=this._container=Un("div",U),j=this.options.collapsed;k.setAttribute("aria-haspopup",!0),ml(k),xd(k);var K=this._section=Un("section",U+"-list");j&&(this._map.on("click",this.collapse,this),Li(k,{mouseenter:this._expandSafely,mouseleave:this.collapse},this));var ie=this._layersLink=Un("a",U+"-toggle",k);ie.href="#",ie.title="Layers",ie.setAttribute("role","button"),Li(ie,{keydown:function(ye){ye.keyCode===13&&this._expandSafely()},click:function(ye){qa(ye),this._expandSafely()}},this),j||this.expand(),this._baseLayersList=Un("div",U+"-base",K),this._separator=Un("div",U+"-separator",K),this._overlaysList=Un("div",U+"-overlays",K),k.appendChild(K)},_getLayer:function(U){for(var k=0;k<this._layers.length;k++)if(this._layers[k]&&l(this._layers[k].layer)===U)return this._layers[k]},_addLayer:function(U,k,j){this._map&&U.on("add remove",this._onLayerChange,this),this._layers.push({layer:U,name:k,overlay:j}),this.options.sortLayers&&this._layers.sort(o(function(K,ie){return this.options.sortFunction(K.layer,ie.layer,K.name,ie.name)},this)),this.options.autoZIndex&&U.setZIndex&&(this._lastZIndex++,U.setZIndex(this._lastZIndex)),this._expandIfNotCollapsed()},_update:function(){if(!this._container)return this;Vl(this._baseLayersList),Vl(this._overlaysList),this._layerControlInputs=[];var U,k,j,K,ie=0;for(j=0;j<this._layers.length;j++)K=this._layers[j],this._addItem(K),k=k||K.overlay,U=U||!K.overlay,ie+=K.overlay?0:1;return this.options.hideSingleBase&&(U=U&&ie>1,this._baseLayersList.style.display=U?"":"none"),this._separator.style.display=k&&U?"":"none",this},_onLayerChange:function(U){this._handlingClick||this._update();var k=this._getLayer(l(U.target)),j=k.overlay?U.type==="add"?"overlayadd":"overlayremove":U.type==="add"?"baselayerchange":null;j&&this._map.fire(j,k)},_createRadioElement:function(U,k){var j='<input type="radio" class="leaflet-control-layers-selector" name="'+U+'"'+(k?' checked="checked"':"")+"/>",K=document.createElement("div");return K.innerHTML=j,K.firstChild},_addItem:function(U){var k=document.createElement("label"),j=this._map.hasLayer(U.layer),K;U.overlay?(K=document.createElement("input"),K.type="checkbox",K.className="leaflet-control-layers-selector",K.defaultChecked=j):K=this._createRadioElement("leaflet-base-layers_"+l(this),j),this._layerControlInputs.push(K),K.layerId=l(U.layer),Li(K,"click",this._onInputClick,this);var ie=document.createElement("span");ie.innerHTML=" "+U.name;var ye=document.createElement("span");k.appendChild(ye),ye.appendChild(K),ye.appendChild(ie);var Ne=U.overlay?this._overlaysList:this._baseLayersList;return Ne.appendChild(k),this._checkDisabledLayers(),k},_onInputClick:function(){if(!this._preventClick){var U=this._layerControlInputs,k,j,K=[],ie=[];this._handlingClick=!0;for(var ye=U.length-1;ye>=0;ye--)k=U[ye],j=this._getLayer(k.layerId).layer,k.checked?K.push(j):k.checked||ie.push(j);for(ye=0;ye<ie.length;ye++)this._map.hasLayer(ie[ye])&&this._map.removeLayer(ie[ye]);for(ye=0;ye<K.length;ye++)this._map.hasLayer(K[ye])||this._map.addLayer(K[ye]);this._handlingClick=!1,this._refocusOnMap()}},_checkDisabledLayers:function(){for(var U=this._layerControlInputs,k,j,K=this._map.getZoom(),ie=U.length-1;ie>=0;ie--)k=U[ie],j=this._getLayer(k.layerId).layer,k.disabled=j.options.minZoom!==void 0&&K<j.options.minZoom||j.options.maxZoom!==void 0&&K>j.options.maxZoom},_expandIfNotCollapsed:function(){return this._map&&!this.options.collapsed&&this.expand(),this},_expandSafely:function(){var U=this._section;this._preventClick=!0,Li(U,"click",qa),this.expand();var k=this;setTimeout(function(){lr(U,"click",qa),k._preventClick=!1})}}),ho=function(U,k,j){return new es(U,k,j)},Wa=En.extend({options:{position:"topleft",zoomInText:'<span aria-hidden="true">+</span>',zoomInTitle:"Zoom in",zoomOutText:'<span aria-hidden="true">&#x2212;</span>',zoomOutTitle:"Zoom out"},onAdd:function(U){var k="leaflet-control-zoom",j=Un("div",k+" leaflet-bar"),K=this.options;return this._zoomInButton=this._createButton(K.zoomInText,K.zoomInTitle,k+"-in",j,this._zoomIn),this._zoomOutButton=this._createButton(K.zoomOutText,K.zoomOutTitle,k+"-out",j,this._zoomOut),this._updateDisabled(),U.on("zoomend zoomlevelschange",this._updateDisabled,this),j},onRemove:function(U){U.off("zoomend zoomlevelschange",this._updateDisabled,this)},disable:function(){return this._disabled=!0,this._updateDisabled(),this},enable:function(){return this._disabled=!1,this._updateDisabled(),this},_zoomIn:function(U){!this._disabled&&this._map._zoom<this._map.getMaxZoom()&&this._map.zoomIn(this._map.options.zoomDelta*(U.shiftKey?3:1))},_zoomOut:function(U){!this._disabled&&this._map._zoom>this._map.getMinZoom()&&this._map.zoomOut(this._map.options.zoomDelta*(U.shiftKey?3:1))},_createButton:function(U,k,j,K,ie){var ye=Un("a",j,K);return ye.innerHTML=U,ye.href="#",ye.title=k,ye.setAttribute("role","button"),ye.setAttribute("aria-label",k),ml(ye),Li(ye,"click",iu),Li(ye,"click",ie,this),Li(ye,"click",this._refocusOnMap,this),ye},_updateDisabled:function(){var U=this._map,k="leaflet-disabled";gr(this._zoomInButton,k),gr(this._zoomOutButton,k),this._zoomInButton.setAttribute("aria-disabled","false"),this._zoomOutButton.setAttribute("aria-disabled","false"),(this._disabled||U._zoom===U.getMinZoom())&&(Di(this._zoomOutButton,k),this._zoomOutButton.setAttribute("aria-disabled","true")),(this._disabled||U._zoom===U.getMaxZoom())&&(Di(this._zoomInButton,k),this._zoomInButton.setAttribute("aria-disabled","true"))}});ii.mergeOptions({zoomControl:!0}),ii.addInitHook(function(){this.options.zoomControl&&(this.zoomControl=new Wa,this.addControl(this.zoomControl))});var fo=function(U){return new Wa(U)},Hl=En.extend({options:{position:"bottomleft",maxWidth:100,metric:!0,imperial:!0},onAdd:function(U){var k="leaflet-control-scale",j=Un("div",k),K=this.options;return this._addScales(K,k+"-line",j),U.on(K.updateWhenIdle?"moveend":"move",this._update,this),U.whenReady(this._update,this),j},onRemove:function(U){U.off(this.options.updateWhenIdle?"moveend":"move",this._update,this)},_addScales:function(U,k,j){U.metric&&(this._mScale=Un("div",k,j)),U.imperial&&(this._iScale=Un("div",k,j))},_update:function(){var U=this._map,k=U.getSize().y/2,j=U.distance(U.containerPointToLatLng([0,k]),U.containerPointToLatLng([this.options.maxWidth,k]));this._updateScales(j)},_updateScales:function(U){this.options.metric&&U&&this._updateMetric(U),this.options.imperial&&U&&this._updateImperial(U)},_updateMetric:function(U){var k=this._getRoundNum(U),j=k<1e3?k+" m":k/1e3+" km";this._updateScale(this._mScale,j,k/U)},_updateImperial:function(U){var k=U*3.2808399,j,K,ie;k>5280?(j=k/5280,K=this._getRoundNum(j),this._updateScale(this._iScale,K+" mi",K/j)):(ie=this._getRoundNum(k),this._updateScale(this._iScale,ie+" ft",ie/k))},_updateScale:function(U,k,j){U.style.width=Math.round(this.options.maxWidth*j)+"px",U.innerHTML=k},_getRoundNum:function(U){var k=Math.pow(10,(Math.floor(U)+"").length-1),j=U/k;return j=j>=10?10:j>=5?5:j>=3?3:j>=2?2:1,k*j}}),nu=function(U){return new Hl(U)},xp='<svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="12" height="8" viewBox="0 0 12 8" class="leaflet-attribution-flag"><path fill="#4C7BE1" d="M0 0h12v4H0z"/><path fill="#FFD500" d="M0 4h12v3H0z"/><path fill="#E0BC00" d="M0 7h12v1H0z"/></svg>',Op=En.extend({options:{position:"bottomright",prefix:'<a href="https://leafletjs.com" title="A JavaScript library for interactive maps">'+(Gt.inlineSvg?xp+" ":"")+"Leaflet</a>"},initialize:function(U){m(this,U),this._attributions={}},onAdd:function(U){U.attributionControl=this,this._container=Un("div","leaflet-control-attribution"),ml(this._container);for(var k in U._layers)U._layers[k].getAttribution&&this.addAttribution(U._layers[k].getAttribution());return this._update(),U.on("layeradd",this._addAttribution,this),this._container},onRemove:function(U){U.off("layeradd",this._addAttribution,this)},_addAttribution:function(U){U.layer.getAttribution&&(this.addAttribution(U.layer.getAttribution()),U.layer.once("remove",function(){this.removeAttribution(U.layer.getAttribution())},this))},setPrefix:function(U){return this.options.prefix=U,this._update(),this},addAttribution:function(U){return U?(this._attributions[U]||(this._attributions[U]=0),this._attributions[U]++,this._update(),this):this},removeAttribution:function(U){return U?(this._attributions[U]&&(this._attributions[U]--,this._update()),this):this},_update:function(){if(this._map){var U=[];for(var k in this._attributions)this._attributions[k]&&U.push(k);var j=[];this.options.prefix&&j.push(this.options.prefix),U.length&&j.push(U.join(", ")),this._container.innerHTML=j.join(' <span aria-hidden="true">|</span> ')}}});ii.mergeOptions({attributionControl:!0}),ii.addInitHook(function(){this.options.attributionControl&&new Op().addTo(this)});var zh=function(U){return new Op(U)};En.Layers=es,En.Zoom=Wa,En.Scale=Hl,En.Attribution=Op,_a.layers=ho,_a.zoom=fo,_a.scale=nu,_a.attribution=zh;var $s=M.extend({initialize:function(U){this._map=U},enable:function(){return this._enabled?this:(this._enabled=!0,this.addHooks(),this)},disable:function(){return this._enabled?(this._enabled=!1,this.removeHooks(),this):this},enabled:function(){return!!this._enabled}});$s.addTo=function(U,k){return U.addHandler(k,this),this};var VU={Events:_},Fw=Gt.touch?"touchstart mousedown":"mousedown",Ka=x.extend({options:{clickTolerance:3},initialize:function(U,k,j,K){m(this,K),this._element=U,this._dragStartTarget=k||U,this._preventOutline=j},enable:function(){this._enabled||(Li(this._dragStartTarget,Fw,this._onDown,this),this._enabled=!0)},disable:function(){this._enabled&&(Ka._dragging===this&&this.finishDrag(!0),lr(this._dragStartTarget,Fw,this._onDown,this),this._enabled=!1,this._moved=!1)},_onDown:function(U){if(this._enabled&&(this._moved=!1,!Yi(this._element,"leaflet-zoom-anim"))){if(U.touches&&U.touches.length!==1){Ka._dragging===this&&this.finishDrag();return}if(!(Ka._dragging||U.shiftKey||U.which!==1&&U.button!==1&&!U.touches)&&(Ka._dragging=this,this._preventOutline&&Gl(this._element),Xo(),ur(),!this._moving)){this.fire("down");var k=U.touches?U.touches[0]:U,j=Jo(this._element);this._startPoint=new O(k.clientX,k.clientY),this._startPos=ji(this._element),this._parentScale=Ta(j);var K=U.type==="mousedown";Li(document,K?"mousemove":"touchmove",this._onMove,this),Li(document,K?"mouseup":"touchend touchcancel",this._onUp,this)}}},_onMove:function(U){if(this._enabled){if(U.touches&&U.touches.length>1){this._moved=!0;return}var k=U.touches&&U.touches.length===1?U.touches[0]:U,j=new O(k.clientX,k.clientY)._subtract(this._startPoint);!j.x&&!j.y||Math.abs(j.x)+Math.abs(j.y)<this.options.clickTolerance||(j.x/=this._parentScale.x,j.y/=this._parentScale.y,qa(U),this._moved||(this.fire("dragstart"),this._moved=!0,Di(document.body,"leaflet-dragging"),this._lastTarget=U.target||U.srcElement,window.SVGElementInstance&&this._lastTarget instanceof window.SVGElementInstance&&(this._lastTarget=this._lastTarget.correspondingUseElement),Di(this._lastTarget,"leaflet-drag-target")),this._newPos=this._startPos.add(j),this._moving=!0,this._lastEvent=U,this._updatePosition())}},_updatePosition:function(){var U={originalEvent:this._lastEvent};this.fire("predrag",U),si(this._element,this._newPos),this.fire("drag",U)},_onUp:function(){this._enabled&&this.finishDrag()},finishDrag:function(U){gr(document.body,"leaflet-dragging"),this._lastTarget&&(gr(this._lastTarget,"leaflet-drag-target"),this._lastTarget=null),lr(document,"mousemove touchmove",this._onMove,this),lr(document,"mouseup touchend touchcancel",this._onUp,this),Aa(),Mi();var k=this._moved&&this._moving;this._moving=!1,Ka._dragging=!1,k&&this.fire("dragend",{noInertia:U,distance:this._newPos.distanceTo(this._startPos)})}});function Kg(U,k,j){var K,ie=[1,4,2,8],ye,Ne,Ze,rt,Dt,ni,rn,tr;for(ye=0,ni=U.length;ye<ni;ye++)U[ye]._code=qh(U[ye],k);for(Ze=0;Ze<4;Ze++){for(rn=ie[Ze],K=[],ye=0,ni=U.length,Ne=ni-1;ye<ni;Ne=ye++)rt=U[ye],Dt=U[Ne],rt._code&rn?Dt._code&rn||(tr=Xg(Dt,rt,rn,k,j),tr._code=qh(tr,k),K.push(tr)):(Dt._code&rn&&(tr=Xg(Dt,rt,rn,k,j),tr._code=qh(tr,k),K.push(tr)),K.push(rt));U=K}return U}function Yg(U,k){var j,K,ie,ye,Ne,Ze,rt,Dt,ni;if(!U||U.length===0)throw new Error("latlngs not passed");gl(U)||(console.warn("latlngs are not flat! Only the first ring will be used"),U=U[0]);var rn=Z([0,0]),tr=q(U),gc=tr.getNorthWest().distanceTo(tr.getSouthWest())*tr.getNorthEast().distanceTo(tr.getNorthWest());gc<1700&&(rn=Zg(U));var Js=U.length,Bd=[];for(j=0;j<Js;j++){var au=Z(U[j]);Bd.push(k.project(Z([au.lat-rn.lat,au.lng-rn.lng])))}for(Ze=rt=Dt=0,j=0,K=Js-1;j<Js;K=j++)ie=Bd[j],ye=Bd[K],Ne=ie.y*ye.x-ye.y*ie.x,rt+=(ie.x+ye.x)*Ne,Dt+=(ie.y+ye.y)*Ne,Ze+=Ne*3;Ze===0?ni=Bd[0]:ni=[rt/Ze,Dt/Ze];var Kw=k.unproject(F(ni));return Z([Kw.lat+rn.lat,Kw.lng+rn.lng])}function Zg(U){for(var k=0,j=0,K=0,ie=0;ie<U.length;ie++){var ye=Z(U[ie]);k+=ye.lat,j+=ye.lng,K++}return Z([k/K,j/K])}var jU={__proto__:null,clipPolygon:Kg,polygonCenter:Yg,centroid:Zg};function GU(U,k){if(!k||!U.length)return U.slice();var j=k*k;return U=qU(U,j),U=zU(U,j),U}function HU(U,k,j){return Math.sqrt(Im(U,k,j,!0))}function Bw(U,k,j){return Im(U,k,j)}function zU(U,k){var j=U.length,K=typeof Uint8Array<"u"?Uint8Array:Array,ie=new K(j);ie[0]=ie[j-1]=1,Lp(U,ie,k,0,j-1);var ye,Ne=[];for(ye=0;ye<j;ye++)ie[ye]&&Ne.push(U[ye]);return Ne}function Lp(U,k,j,K,ie){var ye=0,Ne,Ze,rt;for(Ze=K+1;Ze<=ie-1;Ze++)rt=Im(U[Ze],U[K],U[ie],!0),rt>ye&&(Ne=Ze,ye=rt);ye>j&&(k[Ne]=1,Lp(U,k,j,K,Ne),Lp(U,k,j,Ne,ie))}function qU(U,k){for(var j=[U[0]],K=1,ie=0,ye=U.length;K<ye;K++)UB(U[K],U[ie])>k&&(j.push(U[K]),ie=K);return ie<ye-1&&j.push(U[ye-1]),j}var $w;function Zy(U,k,j,K,ie){var ye=K?$w:qh(U,j),Ne=qh(k,j),Ze,rt,Dt;for($w=Ne;;){if(!(ye|Ne))return[U,k];if(ye&Ne)return!1;Ze=ye||Ne,rt=Xg(U,k,Ze,j,ie),Dt=qh(rt,j),Ze===ye?(U=rt,ye=Dt):(k=rt,Ne=Dt)}}function Xg(U,k,j,K,ie){var ye=k.x-U.x,Ne=k.y-U.y,Ze=K.min,rt=K.max,Dt,ni;return j&8?(Dt=U.x+ye*(rt.y-U.y)/Ne,ni=rt.y):j&4?(Dt=U.x+ye*(Ze.y-U.y)/Ne,ni=Ze.y):j&2?(Dt=rt.x,ni=U.y+Ne*(rt.x-U.x)/ye):j&1&&(Dt=Ze.x,ni=U.y+Ne*(Ze.x-U.x)/ye),new O(Dt,ni,ie)}function qh(U,k){var j=0;return U.x<k.min.x?j|=1:U.x>k.max.x&&(j|=2),U.y<k.min.y?j|=4:U.y>k.max.y&&(j|=8),j}function UB(U,k){var j=k.x-U.x,K=k.y-U.y;return j*j+K*K}function Im(U,k,j,K){var ie=k.x,ye=k.y,Ne=j.x-ie,Ze=j.y-ye,rt=Ne*Ne+Ze*Ze,Dt;return rt>0&&(Dt=((U.x-ie)*Ne+(U.y-ye)*Ze)/rt,Dt>1?(ie=j.x,ye=j.y):Dt>0&&(ie+=Ne*Dt,ye+=Ze*Dt)),Ne=U.x-ie,Ze=U.y-ye,K?Ne*Ne+Ze*Ze:new O(ie,ye)}function gl(U){return!b(U[0])||typeof U[0][0]!="object"&&typeof U[0][0]<"u"}function dM(U){return console.warn("Deprecated use of _flat, please use L.LineUtil.isFlat instead."),gl(U)}function Vw(U,k){var j,K,ie,ye,Ne,Ze,rt,Dt;if(!U||U.length===0)throw new Error("latlngs not passed");gl(U)||(console.warn("latlngs are not flat! Only the first ring will be used"),U=U[0]);var ni=Z([0,0]),rn=q(U),tr=rn.getNorthWest().distanceTo(rn.getSouthWest())*rn.getNorthEast().distanceTo(rn.getNorthWest());tr<1700&&(ni=Zg(U));var gc=U.length,Js=[];for(j=0;j<gc;j++){var Bd=Z(U[j]);Js.push(k.project(Z([Bd.lat-ni.lat,Bd.lng-ni.lng])))}for(j=0,K=0;j<gc-1;j++)K+=Js[j].distanceTo(Js[j+1])/2;if(K===0)Dt=Js[0];else for(j=0,ye=0;j<gc-1;j++)if(Ne=Js[j],Ze=Js[j+1],ie=Ne.distanceTo(Ze),ye+=ie,ye>K){rt=(ye-K)/ie,Dt=[Ze.x-rt*(Ze.x-Ne.x),Ze.y-rt*(Ze.y-Ne.y)];break}var au=k.unproject(F(Dt));return Z([au.lat+ni.lat,au.lng+ni.lng])}var WU={__proto__:null,simplify:GU,pointToSegmentDistance:HU,closestPointOnSegment:Bw,clipSegment:Zy,_getEdgeIntersection:Xg,_getBitCode:qh,_sqClosestPointOnSegment:Im,isFlat:gl,_flat:dM,polylineCenter:Vw},KU={project:function(U){return new O(U.lng,U.lat)},unproject:function(U){return new z(U.y,U.x)},bounds:new G([-180,-90],[180,90])},jw={R:6378137,R_MINOR:6356752314245179e-9,bounds:new G([-2003750834279e-5,-1549657073972e-5],[2003750834279e-5,1876465623138e-5]),project:function(U){var k=Math.PI/180,j=this.R,K=U.lat*k,ie=this.R_MINOR/j,ye=Math.sqrt(1-ie*ie),Ne=ye*Math.sin(K),Ze=Math.tan(Math.PI/4-K/2)/Math.pow((1-Ne)/(1+Ne),ye/2);return K=-j*Math.log(Math.max(Ze,1e-10)),new O(U.lng*k*j,K)},unproject:function(U){for(var k=180/Math.PI,j=this.R,K=this.R_MINOR/j,ie=Math.sqrt(1-K*K),ye=Math.exp(-U.y/j),Ne=Math.PI/2-2*Math.atan(ye),Ze=0,rt=.1,Dt;Ze<15&&Math.abs(rt)>1e-7;Ze++)Dt=ie*Math.sin(Ne),Dt=Math.pow((1-Dt)/(1+Dt),ie/2),rt=Math.PI/2-2*Math.atan(ye*Dt)-Ne,Ne+=rt;return new z(Ne*k,U.x*k/j)}},DB={__proto__:null,LonLat:KU,Mercator:jw,SphericalMercator:oe},pM=r({},Q,{code:"EPSG:3395",projection:jw,transformation:function(){var U=.5/(Math.PI*jw.R);return me(U,.5,-U,.5)}()}),YU=r({},Q,{code:"EPSG:4326",projection:KU,transformation:me(1/180,1,-1/180,.5)}),EB=r({},Y,{projection:KU,transformation:me(1,0,-1,0),scale:function(U){return Math.pow(2,U)},zoom:function(U){return Math.log(U)/Math.LN2},distance:function(U,k){var j=k.lng-U.lng,K=k.lat-U.lat;return Math.sqrt(j*j+K*K)},infinite:!0});Y.Earth=Q,Y.EPSG3395=pM,Y.EPSG3857=se,Y.EPSG900913=te,Y.EPSG4326=YU,Y.Simple=EB;var ru=x.extend({options:{pane:"overlayPane",attribution:null,bubblingMouseEvents:!0},addTo:function(U){return U.addLayer(this),this},remove:function(){return this.removeFrom(this._map||this._mapToAdd)},removeFrom:function(U){return U&&U.removeLayer(this),this},getPane:function(U){return this._map.getPane(U?this.options[U]||U:this.options.pane)},addInteractiveTarget:function(U){return this._map._targets[l(U)]=this,this},removeInteractiveTarget:function(U){return delete this._map._targets[l(U)],this},getAttribution:function(){return this.options.attribution},_layerAdd:function(U){var k=U.target;if(k.hasLayer(this)){if(this._map=k,this._zoomAnimated=k._zoomAnimated,this.getEvents){var j=this.getEvents();k.on(j,this),this.once("remove",function(){k.off(j,this)},this)}this.onAdd(k),this.fire("add"),k.fire("layeradd",{layer:this})}}});ii.include({addLayer:function(U){if(!U._layerAdd)throw new Error("The provided object is not a Layer.");var k=l(U);return this._layers[k]?this:(this._layers[k]=U,U._mapToAdd=this,U.beforeAdd&&U.beforeAdd(this),this.whenReady(U._layerAdd,U),this)},removeLayer:function(U){var k=l(U);return this._layers[k]?(this._loaded&&U.onRemove(this),delete this._layers[k],this._loaded&&(this.fire("layerremove",{layer:U}),U.fire("remove")),U._map=U._mapToAdd=null,this):this},hasLayer:function(U){return l(U)in this._layers},eachLayer:function(U,k){for(var j in this._layers)U.call(k,this._layers[j]);return this},_addLayers:function(U){U=U?b(U)?U:[U]:[];for(var k=0,j=U.length;k<j;k++)this.addLayer(U[k])},_addZoomLimit:function(U){(!isNaN(U.options.maxZoom)||!isNaN(U.options.minZoom))&&(this._zoomBoundLayers[l(U)]=U,this._updateZoomLevels())},_removeZoomLimit:function(U){var k=l(U);this._zoomBoundLayers[k]&&(delete this._zoomBoundLayers[k],this._updateZoomLevels())},_updateZoomLevels:function(){var U=1/0,k=-1/0,j=this._getZoomSpan();for(var K in this._zoomBoundLayers){var ie=this._zoomBoundLayers[K].options;U=ie.minZoom===void 0?U:Math.min(U,ie.minZoom),k=ie.maxZoom===void 0?k:Math.max(k,ie.maxZoom)}this._layersMaxZoom=k===-1/0?void 0:k,this._layersMinZoom=U===1/0?void 0:U,j!==this._getZoomSpan()&&this.fire("zoomlevelschange"),this.options.maxZoom===void 0&&this._layersMaxZoom&&this.getZoom()>this._layersMaxZoom&&this.setZoom(this._layersMaxZoom),this.options.minZoom===void 0&&this._layersMinZoom&&this.getZoom()<this._layersMinZoom&&this.setZoom(this._layersMinZoom)}});var Wh=ru.extend({initialize:function(U,k){m(this,k),this._layers={};var j,K;if(U)for(j=0,K=U.length;j<K;j++)this.addLayer(U[j])},addLayer:function(U){var k=this.getLayerId(U);return this._layers[k]=U,this._map&&this._map.addLayer(U),this},removeLayer:function(U){var k=U in this._layers?U:this.getLayerId(U);return this._map&&this._layers[k]&&this._map.removeLayer(this._layers[k]),delete this._layers[k],this},hasLayer:function(U){var k=typeof U=="number"?U:this.getLayerId(U);return k in this._layers},clearLayers:function(){return this.eachLayer(this.removeLayer,this)},invoke:function(U){var k=Array.prototype.slice.call(arguments,1),j,K;for(j in this._layers)K=this._layers[j],K[U]&&K[U].apply(K,k);return this},onAdd:function(U){this.eachLayer(U.addLayer,U)},onRemove:function(U){this.eachLayer(U.removeLayer,U)},eachLayer:function(U,k){for(var j in this._layers)U.call(k,this._layers[j]);return this},getLayer:function(U){return this._layers[U]},getLayers:function(){var U=[];return this.eachLayer(U.push,U),U},setZIndex:function(U){return this.invoke("setZIndex",U)},getLayerId:function(U){return l(U)}}),hM=function(U,k){return new Wh(U,k)},Od=Wh.extend({addLayer:function(U){return this.hasLayer(U)?this:(U.addEventParent(this),Wh.prototype.addLayer.call(this,U),this.fire("layeradd",{layer:U}))},removeLayer:function(U){return this.hasLayer(U)?(U in this._layers&&(U=this._layers[U]),U.removeEventParent(this),Wh.prototype.removeLayer.call(this,U),this.fire("layerremove",{layer:U})):this},setStyle:function(U){return this.invoke("setStyle",U)},bringToFront:function(){return this.invoke("bringToFront")},bringToBack:function(){return this.invoke("bringToBack")},getBounds:function(){var U=new $;for(var k in this._layers){var j=this._layers[k];U.extend(j.getBounds?j.getBounds():j.getLatLng())}return U}}),CB=function(U,k){return new Od(U,k)},Jg=M.extend({options:{popupAnchor:[0,0],tooltipAnchor:[0,0],crossOrigin:!1},initialize:function(U){m(this,U)},createIcon:function(U){return this._createIcon("icon",U)},createShadow:function(U){return this._createIcon("shadow",U)},_createIcon:function(U,k){var j=this._getIconUrl(U);if(!j){if(U==="icon")throw new Error("iconUrl not set in Icon options (see the docs).");return null}var K=this._createImg(j,k&&k.tagName==="IMG"?k:null);return this._setIconStyles(K,U),(this.options.crossOrigin||this.options.crossOrigin==="")&&(K.crossOrigin=this.options.crossOrigin===!0?"":this.options.crossOrigin),K},_setIconStyles:function(U,k){var j=this.options,K=j[k+"Size"];typeof K=="number"&&(K=[K,K]);var ie=F(K),ye=F(k==="shadow"&&j.shadowAnchor||j.iconAnchor||ie&&ie.divideBy(2,!0));U.className="leaflet-marker-"+k+" "+(j.className||""),ye&&(U.style.marginLeft=-ye.x+"px",U.style.marginTop=-ye.y+"px"),ie&&(U.style.width=ie.x+"px",U.style.height=ie.y+"px")},_createImg:function(U,k){return k=k||document.createElement("img"),k.src=U,k},_getIconUrl:function(U){return Gt.retina&&this.options[U+"RetinaUrl"]||this.options[U+"Url"]}});function PB(U){return new Jg(U)}var Kh=Jg.extend({options:{iconUrl:"marker-icon.png",iconRetinaUrl:"marker-icon-2x.png",shadowUrl:"marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],tooltipAnchor:[16,-28],shadowSize:[41,41]},_getIconUrl:function(U){return typeof Kh.imagePath!="string"&&(Kh.imagePath=this._detectIconPath()),(this.options.imagePath||Kh.imagePath)+Jg.prototype._getIconUrl.call(this,U)},_stripUrl:function(U){var k=function(j,K,ie){var ye=K.exec(j);return ye&&ye[ie]};return U=k(U,/^url\((['"])?(.+)\1\)$/,2),U&&k(U,/^(.*)marker-icon\.png$/,1)},_detectIconPath:function(){var U=Un("div","leaflet-default-icon-path",document.body),k=pn(U,"background-image")||pn(U,"backgroundImage");if(document.body.removeChild(U),k=this._stripUrl(k),k)return k;var j=document.querySelector('link[href$="leaflet.css"]');return j?j.href.substring(0,j.href.length-11-1):""}}),Ld=$s.extend({initialize:function(U){this._marker=U},addHooks:function(){var U=this._marker._icon;this._draggable||(this._draggable=new Ka(U,U,!0)),this._draggable.on({dragstart:this._onDragStart,predrag:this._onPreDrag,drag:this._onDrag,dragend:this._onDragEnd},this).enable(),Di(U,"leaflet-marker-draggable")},removeHooks:function(){this._draggable.off({dragstart:this._onDragStart,predrag:this._onPreDrag,drag:this._onDrag,dragend:this._onDragEnd},this).disable(),this._marker._icon&&gr(this._marker._icon,"leaflet-marker-draggable")},moved:function(){return this._draggable&&this._draggable._moved},_adjustPan:function(U){var k=this._marker,j=k._map,K=this._marker.options.autoPanSpeed,ie=this._marker.options.autoPanPadding,ye=ji(k._icon),Ne=j.getPixelBounds(),Ze=j.getPixelOrigin(),rt=H(Ne.min._subtract(Ze).add(ie),Ne.max._subtract(Ze).subtract(ie));if(!rt.contains(ye)){var Dt=F((Math.max(rt.max.x,ye.x)-rt.max.x)/(Ne.max.x-rt.max.x)-(Math.min(rt.min.x,ye.x)-rt.min.x)/(Ne.min.x-rt.min.x),(Math.max(rt.max.y,ye.y)-rt.max.y)/(Ne.max.y-rt.max.y)-(Math.min(rt.min.y,ye.y)-rt.min.y)/(Ne.min.y-rt.min.y)).multiplyBy(K);j.panBy(Dt,{animate:!1}),this._draggable._newPos._add(Dt),this._draggable._startPos._add(Dt),si(k._icon,this._draggable._newPos),this._onDrag(U),this._panRequest=P(this._adjustPan.bind(this,U))}},_onDragStart:function(){this._oldLatLng=this._marker.getLatLng(),this._marker.closePopup&&this._marker.closePopup(),this._marker.fire("movestart").fire("dragstart")},_onPreDrag:function(U){this._marker.options.autoPan&&(R(this._panRequest),this._panRequest=P(this._adjustPan.bind(this,U)))},_onDrag:function(U){var k=this._marker,j=k._shadow,K=ji(k._icon),ie=k._map.layerPointToLatLng(K);j&&si(j,K),k._latlng=ie,U.latlng=ie,U.oldLatLng=this._oldLatLng,k.fire("move",U).fire("drag",U)},_onDragEnd:function(U){R(this._panRequest),delete this._oldLatLng,this._marker.fire("moveend").fire("dragend",U)}}),ka=ru.extend({options:{icon:new Kh,interactive:!0,keyboard:!0,title:"",alt:"Marker",zIndexOffset:0,opacity:1,riseOnHover:!1,riseOffset:250,pane:"markerPane",shadowPane:"shadowPane",bubblingMouseEvents:!1,autoPanOnFocus:!0,draggable:!1,autoPan:!1,autoPanPadding:[50,50],autoPanSpeed:10},initialize:function(U,k){m(this,k),this._latlng=Z(U)},onAdd:function(U){this._zoomAnimated=this._zoomAnimated&&U.options.markerZoomAnimation,this._zoomAnimated&&U.on("zoomanim",this._animateZoom,this),this._initIcon(),this.update()},onRemove:function(U){this.dragging&&this.dragging.enabled()&&(this.options.draggable=!0,this.dragging.removeHooks()),delete this.dragging,this._zoomAnimated&&U.off("zoomanim",this._animateZoom,this),this._removeIcon(),this._removeShadow()},getEvents:function(){return{zoom:this.update,viewreset:this.update}},getLatLng:function(){return this._latlng},setLatLng:function(U){var k=this._latlng;return this._latlng=Z(U),this.update(),this.fire("move",{oldLatLng:k,latlng:this._latlng})},setZIndexOffset:function(U){return this.options.zIndexOffset=U,this.update()},getIcon:function(){return this.options.icon},setIcon:function(U){return this.options.icon=U,this._map&&(this._initIcon(),this.update()),this._popup&&this.bindPopup(this._popup,this._popup.options),this},getElement:function(){return this._icon},update:function(){if(this._icon&&this._map){var U=this._map.latLngToLayerPoint(this._latlng).round();this._setPos(U)}return this},_initIcon:function(){var U=this.options,k="leaflet-zoom-"+(this._zoomAnimated?"animated":"hide"),j=U.icon.createIcon(this._icon),K=!1;j!==this._icon&&(this._icon&&this._removeIcon(),K=!0,U.title&&(j.title=U.title),j.tagName==="IMG"&&(j.alt=U.alt||"")),Di(j,k),U.keyboard&&(j.tabIndex="0",j.setAttribute("role","button")),this._icon=j,U.riseOnHover&&this.on({mouseover:this._bringToFront,mouseout:this._resetZIndex}),this.options.autoPanOnFocus&&Li(j,"focus",this._panOnFocus,this);var ie=U.icon.createShadow(this._shadow),ye=!1;ie!==this._shadow&&(this._removeShadow(),ye=!0),ie&&(Di(ie,k),ie.alt=""),this._shadow=ie,U.opacity<1&&this._updateOpacity(),K&&this.getPane().appendChild(this._icon),this._initInteraction(),ie&&ye&&this.getPane(U.shadowPane).appendChild(this._shadow)},_removeIcon:function(){this.options.riseOnHover&&this.off({mouseover:this._bringToFront,mouseout:this._resetZIndex}),this.options.autoPanOnFocus&&lr(this._icon,"focus",this._panOnFocus,this),mr(this._icon),this.removeInteractiveTarget(this._icon),this._icon=null},_removeShadow:function(){this._shadow&&mr(this._shadow),this._shadow=null},_setPos:function(U){this._icon&&si(this._icon,U),this._shadow&&si(this._shadow,U),this._zIndex=U.y+this.options.zIndexOffset,this._resetZIndex()},_updateZIndex:function(U){this._icon&&(this._icon.style.zIndex=this._zIndex+U)},_animateZoom:function(U){var k=this._map._latLngToNewLayerPoint(this._latlng,U.zoom,U.center).round();this._setPos(k)},_initInteraction:function(){if(this.options.interactive&&(Di(this._icon,"leaflet-interactive"),this.addInteractiveTarget(this._icon),Ld)){var U=this.options.draggable;this.dragging&&(U=this.dragging.enabled(),this.dragging.disable()),this.dragging=new Ld(this),U&&this.dragging.enable()}},setOpacity:function(U){return this.options.opacity=U,this._map&&this._updateOpacity(),this},_updateOpacity:function(){var U=this.options.opacity;this._icon&&_t(this._icon,U),this._shadow&&_t(this._shadow,U)},_bringToFront:function(){this._updateZIndex(this.options.riseOffset)},_resetZIndex:function(){this._updateZIndex(0)},_panOnFocus:function(){var U=this._map;if(U){var k=this.options.icon.options,j=k.iconSize?F(k.iconSize):F(0,0),K=k.iconAnchor?F(k.iconAnchor):F(0,0);U.panInside(this._latlng,{paddingTopLeft:K,paddingBottomRight:j.subtract(K)})}},_getPopupAnchor:function(){return this.options.icon.options.popupAnchor},_getTooltipAnchor:function(){return this.options.icon.options.tooltipAnchor}});function Gw(U,k){return new ka(U,k)}var ts=ru.extend({options:{stroke:!0,color:"#3388ff",weight:3,opacity:1,lineCap:"round",lineJoin:"round",dashArray:null,dashOffset:null,fill:!1,fillColor:null,fillOpacity:.2,fillRule:"evenodd",interactive:!0,bubblingMouseEvents:!0},beforeAdd:function(U){this._renderer=U.getRenderer(this)},onAdd:function(){this._renderer._initPath(this),this._reset(),this._renderer._addPath(this)},onRemove:function(){this._renderer._removePath(this)},redraw:function(){return this._map&&this._renderer._updatePath(this),this},setStyle:function(U){return m(this,U),this._renderer&&(this._renderer._updateStyle(this),this.options.stroke&&U&&Object.prototype.hasOwnProperty.call(U,"weight")&&this._updateBounds()),this},bringToFront:function(){return this._renderer&&this._renderer._bringToFront(this),this},bringToBack:function(){return this._renderer&&this._renderer._bringToBack(this),this},getElement:function(){return this._path},_reset:function(){this._project(),this._update()},_clickTolerance:function(){return(this.options.stroke?this.options.weight/2:0)+(this._renderer.options.tolerance||0)}}),Hw=ts.extend({options:{fill:!0,radius:10},initialize:function(U,k){m(this,k),this._latlng=Z(U),this._radius=this.options.radius},setLatLng:function(U){var k=this._latlng;return this._latlng=Z(U),this.redraw(),this.fire("move",{oldLatLng:k,latlng:this._latlng})},getLatLng:function(){return this._latlng},setRadius:function(U){return this.options.radius=this._radius=U,this.redraw()},getRadius:function(){return this._radius},setStyle:function(U){var k=U&&U.radius||this._radius;return ts.prototype.setStyle.call(this,U),this.setRadius(k),this},_project:function(){this._point=this._map.latLngToLayerPoint(this._latlng),this._updateBounds()},_updateBounds:function(){var U=this._radius,k=this._radiusY||U,j=this._clickTolerance(),K=[U+j,k+j];this._pxBounds=new G(this._point.subtract(K),this._point.add(K))},_update:function(){this._map&&this._updatePath()},_updatePath:function(){this._renderer._updateCircle(this)},_empty:function(){return this._radius&&!this._renderer._bounds.intersects(this._pxBounds)},_containsPoint:function(U){return U.distanceTo(this._point)<=this._radius+this._clickTolerance()}});function ZU(U,k){return new Hw(U,k)}var zw=Hw.extend({initialize:function(U,k,j){if(typeof k=="number"&&(k=r({},j,{radius:k})),m(this,k),this._latlng=Z(U),isNaN(this.options.radius))throw new Error("Circle radius cannot be NaN");this._mRadius=this.options.radius},setRadius:function(U){return this._mRadius=U,this.redraw()},getRadius:function(){return this._mRadius},getBounds:function(){var U=[this._radius,this._radiusY||this._radius];return new $(this._map.layerPointToLatLng(this._point.subtract(U)),this._map.layerPointToLatLng(this._point.add(U)))},setStyle:ts.prototype.setStyle,_project:function(){var U=this._latlng.lng,k=this._latlng.lat,j=this._map,K=j.options.crs;if(K.distance===Q.distance){var ie=Math.PI/180,ye=this._mRadius/Q.R/ie,Ne=j.project([k+ye,U]),Ze=j.project([k-ye,U]),rt=Ne.add(Ze).divideBy(2),Dt=j.unproject(rt).lat,ni=Math.acos((Math.cos(ye*ie)-Math.sin(k*ie)*Math.sin(Dt*ie))/(Math.cos(k*ie)*Math.cos(Dt*ie)))/ie;(isNaN(ni)||ni===0)&&(ni=ye/Math.cos(Math.PI/180*k)),this._point=rt.subtract(j.getPixelOrigin()),this._radius=isNaN(ni)?0:rt.x-j.project([Dt,U-ni]).x,this._radiusY=rt.y-Ne.y}else{var rn=K.unproject(K.project(this._latlng).subtract([this._mRadius,0]));this._point=j.latLngToLayerPoint(this._latlng),this._radius=this._point.x-j.latLngToLayerPoint(rn).x}this._updateBounds()}});function wm(U,k,j){return new zw(U,k,j)}var Zu=ts.extend({options:{smoothFactor:1,noClip:!1},initialize:function(U,k){m(this,k),this._setLatLngs(U)},getLatLngs:function(){return this._latlngs},setLatLngs:function(U){return this._setLatLngs(U),this.redraw()},isEmpty:function(){return!this._latlngs.length},closestLayerPoint:function(U){for(var k=1/0,j=null,K=Im,ie,ye,Ne=0,Ze=this._parts.length;Ne<Ze;Ne++)for(var rt=this._parts[Ne],Dt=1,ni=rt.length;Dt<ni;Dt++){ie=rt[Dt-1],ye=rt[Dt];var rn=K(U,ie,ye,!0);rn<k&&(k=rn,j=K(U,ie,ye))}return j&&(j.distance=Math.sqrt(k)),j},getCenter:function(){if(!this._map)throw new Error("Must add layer to map before using getCenter()");return Vw(this._defaultShape(),this._map.options.crs)},getBounds:function(){return this._bounds},addLatLng:function(U,k){return k=k||this._defaultShape(),U=Z(U),k.push(U),this._bounds.extend(U),this.redraw()},_setLatLngs:function(U){this._bounds=new $,this._latlngs=this._convertLatLngs(U)},_defaultShape:function(){return gl(this._latlngs)?this._latlngs:this._latlngs[0]},_convertLatLngs:function(U){for(var k=[],j=gl(U),K=0,ie=U.length;K<ie;K++)j?(k[K]=Z(U[K]),this._bounds.extend(k[K])):k[K]=this._convertLatLngs(U[K]);return k},_project:function(){var U=new G;this._rings=[],this._projectLatlngs(this._latlngs,this._rings,U),this._bounds.isValid()&&U.isValid()&&(this._rawPxBounds=U,this._updateBounds())},_updateBounds:function(){var U=this._clickTolerance(),k=new O(U,U);this._rawPxBounds&&(this._pxBounds=new G([this._rawPxBounds.min.subtract(k),this._rawPxBounds.max.add(k)]))},_projectLatlngs:function(U,k,j){var K=U[0]instanceof z,ie=U.length,ye,Ne;if(K){for(Ne=[],ye=0;ye<ie;ye++)Ne[ye]=this._map.latLngToLayerPoint(U[ye]),j.extend(Ne[ye]);k.push(Ne)}else for(ye=0;ye<ie;ye++)this._projectLatlngs(U[ye],k,j)},_clipPoints:function(){var U=this._renderer._bounds;if(this._parts=[],!(!this._pxBounds||!this._pxBounds.intersects(U))){if(this.options.noClip){this._parts=this._rings;return}var k=this._parts,j,K,ie,ye,Ne,Ze,rt;for(j=0,ie=0,ye=this._rings.length;j<ye;j++)for(rt=this._rings[j],K=0,Ne=rt.length;K<Ne-1;K++)Ze=Zy(rt[K],rt[K+1],U,K,!0),Ze&&(k[ie]=k[ie]||[],k[ie].push(Ze[0]),(Ze[1]!==rt[K+1]||K===Ne-2)&&(k[ie].push(Ze[1]),ie++))}},_simplifyPoints:function(){for(var U=this._parts,k=this.options.smoothFactor,j=0,K=U.length;j<K;j++)U[j]=GU(U[j],k)},_update:function(){this._map&&(this._clipPoints(),this._simplifyPoints(),this._updatePath())},_updatePath:function(){this._renderer._updatePoly(this)},_containsPoint:function(U,k){var j,K,ie,ye,Ne,Ze,rt=this._clickTolerance();if(!this._pxBounds||!this._pxBounds.contains(U))return!1;for(j=0,ye=this._parts.length;j<ye;j++)for(Ze=this._parts[j],K=0,Ne=Ze.length,ie=Ne-1;K<Ne;ie=K++)if(!(!k&&K===0)&&HU(U,Ze[ie],Ze[K])<=rt)return!0;return!1}});function Qg(U,k){return new Zu(U,k)}Zu._flat=dM;var mc=Zu.extend({options:{fill:!0},isEmpty:function(){return!this._latlngs.length||!this._latlngs[0].length},getCenter:function(){if(!this._map)throw new Error("Must add layer to map before using getCenter()");return Yg(this._defaultShape(),this._map.options.crs)},_convertLatLngs:function(U){var k=Zu.prototype._convertLatLngs.call(this,U),j=k.length;return j>=2&&k[0]instanceof z&&k[0].equals(k[j-1])&&k.pop(),k},_setLatLngs:function(U){Zu.prototype._setLatLngs.call(this,U),gl(this._latlngs)&&(this._latlngs=[this._latlngs])},_defaultShape:function(){return gl(this._latlngs[0])?this._latlngs[0]:this._latlngs[0][0]},_clipPoints:function(){var U=this._renderer._bounds,k=this.options.weight,j=new O(k,k);if(U=new G(U.min.subtract(j),U.max.add(j)),this._parts=[],!(!this._pxBounds||!this._pxBounds.intersects(U))){if(this.options.noClip){this._parts=this._rings;return}for(var K=0,ie=this._rings.length,ye;K<ie;K++)ye=Kg(this._rings[K],U,!0),ye.length&&this._parts.push(ye)}},_updatePath:function(){this._renderer._updatePoly(this,!0)},_containsPoint:function(U){var k=!1,j,K,ie,ye,Ne,Ze,rt,Dt;if(!this._pxBounds||!this._pxBounds.contains(U))return!1;for(ye=0,rt=this._parts.length;ye<rt;ye++)for(j=this._parts[ye],Ne=0,Dt=j.length,Ze=Dt-1;Ne<Dt;Ze=Ne++)K=j[Ne],ie=j[Ze],K.y>U.y!=ie.y>U.y&&U.x<(ie.x-K.x)*(U.y-K.y)/(ie.y-K.y)+K.x&&(k=!k);return k||Zu.prototype._containsPoint.call(this,U,!0)}});function fM(U,k){return new mc(U,k)}var V=Od.extend({initialize:function(U,k){m(this,k),this._layers={},U&&this.addData(U)},addData:function(U){var k=b(U)?U:U.features,j,K,ie;if(k){for(j=0,K=k.length;j<K;j++)ie=k[j],(ie.geometries||ie.geometry||ie.features||ie.coordinates)&&this.addData(ie);return this}var ye=this.options;if(ye.filter&&!ye.filter(U))return this;var Ne=W(U,ye);return Ne?(Ne.feature=Be(U),Ne.defaultOptions=Ne.options,this.resetStyle(Ne),ye.onEachFeature&&ye.onEachFeature(U,Ne),this.addLayer(Ne)):this},resetStyle:function(U){return U===void 0?this.eachLayer(this.resetStyle,this):(U.options=r({},U.defaultOptions),this._setLayerStyle(U,this.options.style),this)},setStyle:function(U){return this.eachLayer(function(k){this._setLayerStyle(k,U)},this)},_setLayerStyle:function(U,k){U.setStyle&&(typeof k=="function"&&(k=k(U.feature)),U.setStyle(k))}});function W(U,k){var j=U.type==="Feature"?U.geometry:U,K=j?j.coordinates:null,ie=[],ye=k&&k.pointToLayer,Ne=k&&k.coordsToLatLng||ne,Ze,rt,Dt,ni;if(!K&&!j)return null;switch(j.type){case"Point":return Ze=Ne(K),J(ye,U,Ze,k);case"MultiPoint":for(Dt=0,ni=K.length;Dt<ni;Dt++)Ze=Ne(K[Dt]),ie.push(J(ye,U,Ze,k));return new Od(ie);case"LineString":case"MultiLineString":return rt=le(K,j.type==="LineString"?0:1,Ne),new Zu(rt,k);case"Polygon":case"MultiPolygon":return rt=le(K,j.type==="Polygon"?1:2,Ne),new mc(rt,k);case"GeometryCollection":for(Dt=0,ni=j.geometries.length;Dt<ni;Dt++){var rn=W({geometry:j.geometries[Dt],type:"Feature",properties:U.properties},k);rn&&ie.push(rn)}return new Od(ie);case"FeatureCollection":for(Dt=0,ni=j.features.length;Dt<ni;Dt++){var tr=W(j.features[Dt],k);tr&&ie.push(tr)}return new Od(ie);default:throw new Error("Invalid GeoJSON object.")}}function J(U,k,j,K){return U?U(k,j):new ka(j,K&&K.markersInheritOptions&&K)}function ne(U){return new z(U[1],U[0],U[2])}function le(U,k,j){for(var K=[],ie=0,ye=U.length,Ne;ie<ye;ie++)Ne=k?le(U[ie],k-1,j):(j||ne)(U[ie]),K.push(Ne);return K}function ve(U,k){return U=Z(U),U.alt!==void 0?[p(U.lng,k),p(U.lat,k),p(U.alt,k)]:[p(U.lng,k),p(U.lat,k)]}function we(U,k,j,K){for(var ie=[],ye=0,Ne=U.length;ye<Ne;ye++)ie.push(k?we(U[ye],gl(U[ye])?0:k-1,j,K):ve(U[ye],K));return!k&&j&&ie.length>0&&ie.push(ie[0].slice()),ie}function Ce(U,k){return U.feature?r({},U.feature,{geometry:k}):Be(k)}function Be(U){return U.type==="Feature"||U.type==="FeatureCollection"?U:{type:"Feature",properties:{},geometry:U}}var Fe={toGeoJSON:function(U){return Ce(this,{type:"Point",coordinates:ve(this.getLatLng(),U)})}};ka.include(Fe),zw.include(Fe),Hw.include(Fe),Zu.include({toGeoJSON:function(U){var k=!gl(this._latlngs),j=we(this._latlngs,k?1:0,!1,U);return Ce(this,{type:(k?"Multi":"")+"LineString",coordinates:j})}}),mc.include({toGeoJSON:function(U){var k=!gl(this._latlngs),j=k&&!gl(this._latlngs[0]),K=we(this._latlngs,j?2:k?1:0,!0,U);return k||(K=[K]),Ce(this,{type:(j?"Multi":"")+"Polygon",coordinates:K})}}),Wh.include({toMultiPoint:function(U){var k=[];return this.eachLayer(function(j){k.push(j.toGeoJSON(U).geometry.coordinates)}),Ce(this,{type:"MultiPoint",coordinates:k})},toGeoJSON:function(U){var k=this.feature&&this.feature.geometry&&this.feature.geometry.type;if(k==="MultiPoint")return this.toMultiPoint(U);var j=k==="GeometryCollection",K=[];return this.eachLayer(function(ie){if(ie.toGeoJSON){var ye=ie.toGeoJSON(U);if(j)K.push(ye.geometry);else{var Ne=Be(ye);Ne.type==="FeatureCollection"?K.push.apply(K,Ne.features):K.push(Ne)}}}),j?Ce(this,{geometries:K,type:"GeometryCollection"}):{type:"FeatureCollection",features:K}}});function ze(U,k){return new V(U,k)}var Oe=ze,Le=ru.extend({options:{opacity:1,alt:"",interactive:!1,crossOrigin:!1,errorOverlayUrl:"",zIndex:1,className:""},initialize:function(U,k,j){this._url=U,this._bounds=q(k),m(this,j)},onAdd:function(){this._image||(this._initImage(),this.options.opacity<1&&this._updateOpacity()),this.options.interactive&&(Di(this._image,"leaflet-interactive"),this.addInteractiveTarget(this._image)),this.getPane().appendChild(this._image),this._reset()},onRemove:function(){mr(this._image),this.options.interactive&&this.removeInteractiveTarget(this._image)},setOpacity:function(U){return this.options.opacity=U,this._image&&this._updateOpacity(),this},setStyle:function(U){return U.opacity&&this.setOpacity(U.opacity),this},bringToFront:function(){return this._map&&Dn(this._image),this},bringToBack:function(){return this._map&&Na(this._image),this},setUrl:function(U){return this._url=U,this._image&&(this._image.src=U),this},setBounds:function(U){return this._bounds=q(U),this._map&&this._reset(),this},getEvents:function(){var U={zoom:this._reset,viewreset:this._reset};return this._zoomAnimated&&(U.zoomanim=this._animateZoom),U},setZIndex:function(U){return this.options.zIndex=U,this._updateZIndex(),this},getBounds:function(){return this._bounds},getElement:function(){return this._image},_initImage:function(){var U=this._url.tagName==="IMG",k=this._image=U?this._url:Un("img");if(Di(k,"leaflet-image-layer"),this._zoomAnimated&&Di(k,"leaflet-zoom-animated"),this.options.className&&Di(k,this.options.className),k.onselectstart=d,k.onmousemove=d,k.onload=o(this.fire,this,"load"),k.onerror=o(this._overlayOnError,this,"error"),(this.options.crossOrigin||this.options.crossOrigin==="")&&(k.crossOrigin=this.options.crossOrigin===!0?"":this.options.crossOrigin),this.options.zIndex&&this._updateZIndex(),U){this._url=k.src;return}k.src=this._url,k.alt=this.options.alt},_animateZoom:function(U){var k=this._map.getZoomScale(U.zoom),j=this._map._latLngBoundsToNewLayerBounds(this._bounds,U.zoom,U.center).min;nn(this._image,j,k)},_reset:function(){var U=this._image,k=new G(this._map.latLngToLayerPoint(this._bounds.getNorthWest()),this._map.latLngToLayerPoint(this._bounds.getSouthEast())),j=k.getSize();si(U,k.min),U.style.width=j.x+"px",U.style.height=j.y+"px"},_updateOpacity:function(){_t(this._image,this.options.opacity)},_updateZIndex:function(){this._image&&this.options.zIndex!==void 0&&this.options.zIndex!==null&&(this._image.style.zIndex=this.options.zIndex)},_overlayOnError:function(){this.fire("error");var U=this.options.errorOverlayUrl;U&&this._url!==U&&(this._url=U,this._image.src=U)},getCenter:function(){return this._bounds.getCenter()}}),je=function(U,k,j){return new Le(U,k,j)},He=Le.extend({options:{autoplay:!0,loop:!0,keepAspectRatio:!0,muted:!1,playsInline:!0},_initImage:function(){var U=this._url.tagName==="VIDEO",k=this._image=U?this._url:Un("video");if(Di(k,"leaflet-image-layer"),this._zoomAnimated&&Di(k,"leaflet-zoom-animated"),this.options.className&&Di(k,this.options.className),k.onselectstart=d,k.onmousemove=d,k.onloadeddata=o(this.fire,this,"load"),U){for(var j=k.getElementsByTagName("source"),K=[],ie=0;ie<j.length;ie++)K.push(j[ie].src);this._url=j.length>0?K:[k.src];return}b(this._url)||(this._url=[this._url]),!this.options.keepAspectRatio&&Object.prototype.hasOwnProperty.call(k.style,"objectFit")&&(k.style.objectFit="fill"),k.autoplay=!!this.options.autoplay,k.loop=!!this.options.loop,k.muted=!!this.options.muted,k.playsInline=!!this.options.playsInline;for(var ye=0;ye<this._url.length;ye++){var Ne=Un("source");Ne.src=this._url[ye],k.appendChild(Ne)}}});function Ye(U,k,j){return new He(U,k,j)}var Ge=Le.extend({_initImage:function(){var U=this._image=this._url;Di(U,"leaflet-image-layer"),this._zoomAnimated&&Di(U,"leaflet-zoom-animated"),this.options.className&&Di(U,this.options.className),U.onselectstart=d,U.onmousemove=d}});function Qe(U,k,j){return new Ge(U,k,j)}var Xe=ru.extend({options:{interactive:!1,offset:[0,0],className:"",pane:void 0,content:""},initialize:function(U,k){U&&(U instanceof z||b(U))?(this._latlng=Z(U),m(this,k)):(m(this,U),this._source=k),this.options.content&&(this._content=this.options.content)},openOn:function(U){return U=arguments.length?U:this._source._map,U.hasLayer(this)||U.addLayer(this),this},close:function(){return this._map&&this._map.removeLayer(this),this},toggle:function(U){return this._map?this.close():(arguments.length?this._source=U:U=this._source,this._prepareOpen(),this.openOn(U._map)),this},onAdd:function(U){this._zoomAnimated=U._zoomAnimated,this._container||this._initLayout(),U._fadeAnimated&&_t(this._container,0),clearTimeout(this._removeTimeout),this.getPane().appendChild(this._container),this.update(),U._fadeAnimated&&_t(this._container,1),this.bringToFront(),this.options.interactive&&(Di(this._container,"leaflet-interactive"),this.addInteractiveTarget(this._container))},onRemove:function(U){U._fadeAnimated?(_t(this._container,0),this._removeTimeout=setTimeout(o(mr,void 0,this._container),200)):mr(this._container),this.options.interactive&&(gr(this._container,"leaflet-interactive"),this.removeInteractiveTarget(this._container))},getLatLng:function(){return this._latlng},setLatLng:function(U){return this._latlng=Z(U),this._map&&(this._updatePosition(),this._adjustPan()),this},getContent:function(){return this._content},setContent:function(U){return this._content=U,this.update(),this},getElement:function(){return this._container},update:function(){this._map&&(this._container.style.visibility="hidden",this._updateContent(),this._updateLayout(),this._updatePosition(),this._container.style.visibility="",this._adjustPan())},getEvents:function(){var U={zoom:this._updatePosition,viewreset:this._updatePosition};return this._zoomAnimated&&(U.zoomanim=this._animateZoom),U},isOpen:function(){return!!this._map&&this._map.hasLayer(this)},bringToFront:function(){return this._map&&Dn(this._container),this},bringToBack:function(){return this._map&&Na(this._container),this},_prepareOpen:function(U){var k=this._source;if(!k._map)return!1;if(k instanceof Od){k=null;var j=this._source._layers;for(var K in j)if(j[K]._map){k=j[K];break}if(!k)return!1;this._source=k}if(!U)if(k.getCenter)U=k.getCenter();else if(k.getLatLng)U=k.getLatLng();else if(k.getBounds)U=k.getBounds().getCenter();else throw new Error("Unable to get source layer LatLng.");return this.setLatLng(U),this._map&&this.update(),!0},_updateContent:function(){if(this._content){var U=this._contentNode,k=typeof this._content=="function"?this._content(this._source||this):this._content;if(typeof k=="string")U.innerHTML=k;else{for(;U.hasChildNodes();)U.removeChild(U.firstChild);U.appendChild(k)}this.fire("contentupdate")}},_updatePosition:function(){if(this._map){var U=this._map.latLngToLayerPoint(this._latlng),k=F(this.options.offset),j=this._getAnchor();this._zoomAnimated?si(this._container,U.add(j)):k=k.add(U).add(j);var K=this._containerBottom=-k.y,ie=this._containerLeft=-Math.round(this._containerWidth/2)+k.x;this._container.style.bottom=K+"px",this._container.style.left=ie+"px"}},_getAnchor:function(){return[0,0]}});ii.include({_initOverlay:function(U,k,j,K){var ie=k;return ie instanceof U||(ie=new U(K).setContent(k)),j&&ie.setLatLng(j),ie}}),ru.include({_initOverlay:function(U,k,j,K){var ie=j;return ie instanceof U?(m(ie,K),ie._source=this):(ie=k&&!K?k:new U(K,this),ie.setContent(j)),ie}});var ct=Xe.extend({options:{pane:"popupPane",offset:[0,7],maxWidth:300,minWidth:50,maxHeight:null,autoPan:!0,autoPanPaddingTopLeft:null,autoPanPaddingBottomRight:null,autoPanPadding:[5,5],keepInView:!1,closeButton:!0,autoClose:!0,closeOnEscapeKey:!0,className:""},openOn:function(U){return U=arguments.length?U:this._source._map,!U.hasLayer(this)&&U._popup&&U._popup.options.autoClose&&U.removeLayer(U._popup),U._popup=this,Xe.prototype.openOn.call(this,U)},onAdd:function(U){Xe.prototype.onAdd.call(this,U),U.fire("popupopen",{popup:this}),this._source&&(this._source.fire("popupopen",{popup:this},!0),this._source instanceof ts||this._source.on("preclick",Qo))},onRemove:function(U){Xe.prototype.onRemove.call(this,U),U.fire("popupclose",{popup:this}),this._source&&(this._source.fire("popupclose",{popup:this},!0),this._source instanceof ts||this._source.off("preclick",Qo))},getEvents:function(){var U=Xe.prototype.getEvents.call(this);return(this.options.closeOnClick!==void 0?this.options.closeOnClick:this._map.options.closePopupOnClick)&&(U.preclick=this.close),this.options.keepInView&&(U.moveend=this._adjustPan),U},_initLayout:function(){var U="leaflet-popup",k=this._container=Un("div",U+" "+(this.options.className||"")+" leaflet-zoom-animated"),j=this._wrapper=Un("div",U+"-content-wrapper",k);if(this._contentNode=Un("div",U+"-content",j),ml(k),xd(this._contentNode),Li(k,"contextmenu",Qo),this._tipContainer=Un("div",U+"-tip-container",k),this._tip=Un("div",U+"-tip",this._tipContainer),this.options.closeButton){var K=this._closeButton=Un("a",U+"-close-button",k);K.setAttribute("role","button"),K.setAttribute("aria-label","Close popup"),K.href="#close",K.innerHTML='<span aria-hidden="true">&#215;</span>',Li(K,"click",function(ie){qa(ie),this.close()},this)}},_updateLayout:function(){var U=this._contentNode,k=U.style;k.width="",k.whiteSpace="nowrap";var j=U.offsetWidth;j=Math.min(j,this.options.maxWidth),j=Math.max(j,this.options.minWidth),k.width=j+1+"px",k.whiteSpace="",k.height="";var K=U.offsetHeight,ie=this.options.maxHeight,ye="leaflet-popup-scrolled";ie&&K>ie?(k.height=ie+"px",Di(U,ye)):gr(U,ye),this._containerWidth=this._container.offsetWidth},_animateZoom:function(U){var k=this._map._latLngToNewLayerPoint(this._latlng,U.zoom,U.center),j=this._getAnchor();si(this._container,k.add(j))},_adjustPan:function(){if(this.options.autoPan){if(this._map._panAnim&&this._map._panAnim.stop(),this._autopanning){this._autopanning=!1;return}var U=this._map,k=parseInt(pn(this._container,"marginBottom"),10)||0,j=this._container.offsetHeight+k,K=this._containerWidth,ie=new O(this._containerLeft,-j-this._containerBottom);ie._add(ji(this._container));var ye=U.layerPointToContainerPoint(ie),Ne=F(this.options.autoPanPadding),Ze=F(this.options.autoPanPaddingTopLeft||Ne),rt=F(this.options.autoPanPaddingBottomRight||Ne),Dt=U.getSize(),ni=0,rn=0;ye.x+K+rt.x>Dt.x&&(ni=ye.x+K-Dt.x+rt.x),ye.x-ni-Ze.x<0&&(ni=ye.x-Ze.x),ye.y+j+rt.y>Dt.y&&(rn=ye.y+j-Dt.y+rt.y),ye.y-rn-Ze.y<0&&(rn=ye.y-Ze.y),(ni||rn)&&(this.options.keepInView&&(this._autopanning=!0),U.fire("autopanstart").panBy([ni,rn]))}},_getAnchor:function(){return F(this._source&&this._source._getPopupAnchor?this._source._getPopupAnchor():[0,0])}}),ht=function(U,k){return new ct(U,k)};ii.mergeOptions({closePopupOnClick:!0}),ii.include({openPopup:function(U,k,j){return this._initOverlay(ct,U,k,j).openOn(this),this},closePopup:function(U){return U=arguments.length?U:this._popup,U&&U.close(),this}}),ru.include({bindPopup:function(U,k){return this._popup=this._initOverlay(ct,this._popup,U,k),this._popupHandlersAdded||(this.on({click:this._openPopup,keypress:this._onKeyPress,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!0),this},unbindPopup:function(){return this._popup&&(this.off({click:this._openPopup,keypress:this._onKeyPress,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!1,this._popup=null),this},openPopup:function(U){return this._popup&&(this instanceof Od||(this._popup._source=this),this._popup._prepareOpen(U||this._latlng)&&this._popup.openOn(this._map)),this},closePopup:function(){return this._popup&&this._popup.close(),this},togglePopup:function(){return this._popup&&this._popup.toggle(this),this},isPopupOpen:function(){return this._popup?this._popup.isOpen():!1},setPopupContent:function(U){return this._popup&&this._popup.setContent(U),this},getPopup:function(){return this._popup},_openPopup:function(U){if(!(!this._popup||!this._map)){iu(U);var k=U.layer||U.target;if(this._popup._source===k&&!(k instanceof ts)){this._map.hasLayer(this._popup)?this.closePopup():this.openPopup(U.latlng);return}this._popup._source=k,this.openPopup(U.latlng)}},_movePopup:function(U){this._popup.setLatLng(U.latlng)},_onKeyPress:function(U){U.originalEvent.keyCode===13&&this._openPopup(U)}});var It=Xe.extend({options:{pane:"tooltipPane",offset:[0,0],direction:"auto",permanent:!1,sticky:!1,opacity:.9},onAdd:function(U){Xe.prototype.onAdd.call(this,U),this.setOpacity(this.options.opacity),U.fire("tooltipopen",{tooltip:this}),this._source&&(this.addEventParent(this._source),this._source.fire("tooltipopen",{tooltip:this},!0))},onRemove:function(U){Xe.prototype.onRemove.call(this,U),U.fire("tooltipclose",{tooltip:this}),this._source&&(this.removeEventParent(this._source),this._source.fire("tooltipclose",{tooltip:this},!0))},getEvents:function(){var U=Xe.prototype.getEvents.call(this);return this.options.permanent||(U.preclick=this.close),U},_initLayout:function(){var U="leaflet-tooltip",k=U+" "+(this.options.className||"")+" leaflet-zoom-"+(this._zoomAnimated?"animated":"hide");this._contentNode=this._container=Un("div",k),this._container.setAttribute("role","tooltip"),this._container.setAttribute("id","leaflet-tooltip-"+l(this))},_updateLayout:function(){},_adjustPan:function(){},_setPosition:function(U){var k,j,K=this._map,ie=this._container,ye=K.latLngToContainerPoint(K.getCenter()),Ne=K.layerPointToContainerPoint(U),Ze=this.options.direction,rt=ie.offsetWidth,Dt=ie.offsetHeight,ni=F(this.options.offset),rn=this._getAnchor();Ze==="top"?(k=rt/2,j=Dt):Ze==="bottom"?(k=rt/2,j=0):Ze==="center"?(k=rt/2,j=Dt/2):Ze==="right"?(k=0,j=Dt/2):Ze==="left"?(k=rt,j=Dt/2):Ne.x<ye.x?(Ze="right",k=0,j=Dt/2):(Ze="left",k=rt+(ni.x+rn.x)*2,j=Dt/2),U=U.subtract(F(k,j,!0)).add(ni).add(rn),gr(ie,"leaflet-tooltip-right"),gr(ie,"leaflet-tooltip-left"),gr(ie,"leaflet-tooltip-top"),gr(ie,"leaflet-tooltip-bottom"),Di(ie,"leaflet-tooltip-"+Ze),si(ie,U)},_updatePosition:function(){var U=this._map.latLngToLayerPoint(this._latlng);this._setPosition(U)},setOpacity:function(U){this.options.opacity=U,this._container&&_t(this._container,U)},_animateZoom:function(U){var k=this._map._latLngToNewLayerPoint(this._latlng,U.zoom,U.center);this._setPosition(k)},_getAnchor:function(){return F(this._source&&this._source._getTooltipAnchor&&!this.options.sticky?this._source._getTooltipAnchor():[0,0])}}),jt=function(U,k){return new It(U,k)};ii.include({openTooltip:function(U,k,j){return this._initOverlay(It,U,k,j).openOn(this),this},closeTooltip:function(U){return U.close(),this}}),ru.include({bindTooltip:function(U,k){return this._tooltip&&this.isTooltipOpen()&&this.unbindTooltip(),this._tooltip=this._initOverlay(It,this._tooltip,U,k),this._initTooltipInteractions(),this._tooltip.options.permanent&&this._map&&this._map.hasLayer(this)&&this.openTooltip(),this},unbindTooltip:function(){return this._tooltip&&(this._initTooltipInteractions(!0),this.closeTooltip(),this._tooltip=null),this},_initTooltipInteractions:function(U){if(!(!U&&this._tooltipHandlersAdded)){var k=U?"off":"on",j={remove:this.closeTooltip,move:this._moveTooltip};this._tooltip.options.permanent?j.add=this._openTooltip:(j.mouseover=this._openTooltip,j.mouseout=this.closeTooltip,j.click=this._openTooltip,this._map?this._addFocusListeners():j.add=this._addFocusListeners),this._tooltip.options.sticky&&(j.mousemove=this._moveTooltip),this[k](j),this._tooltipHandlersAdded=!U}},openTooltip:function(U){return this._tooltip&&(this instanceof Od||(this._tooltip._source=this),this._tooltip._prepareOpen(U)&&(this._tooltip.openOn(this._map),this.getElement?this._setAriaDescribedByOnLayer(this):this.eachLayer&&this.eachLayer(this._setAriaDescribedByOnLayer,this))),this},closeTooltip:function(){if(this._tooltip)return this._tooltip.close()},toggleTooltip:function(){return this._tooltip&&this._tooltip.toggle(this),this},isTooltipOpen:function(){return this._tooltip.isOpen()},setTooltipContent:function(U){return this._tooltip&&this._tooltip.setContent(U),this},getTooltip:function(){return this._tooltip},_addFocusListeners:function(){this.getElement?this._addFocusListenersOnLayer(this):this.eachLayer&&this.eachLayer(this._addFocusListenersOnLayer,this)},_addFocusListenersOnLayer:function(U){var k=typeof U.getElement=="function"&&U.getElement();k&&(Li(k,"focus",function(){this._tooltip._source=U,this.openTooltip()},this),Li(k,"blur",this.closeTooltip,this))},_setAriaDescribedByOnLayer:function(U){var k=typeof U.getElement=="function"&&U.getElement();k&&k.setAttribute("aria-describedby",this._tooltip._container.id)},_openTooltip:function(U){if(!(!this._tooltip||!this._map)){if(this._map.dragging&&this._map.dragging.moving()&&!this._openOnceFlag){this._openOnceFlag=!0;var k=this;this._map.once("moveend",function(){k._openOnceFlag=!1,k._openTooltip(U)});return}this._tooltip._source=U.layer||U.target,this.openTooltip(this._tooltip.options.sticky?U.latlng:void 0)}},_moveTooltip:function(U){var k=U.latlng,j,K;this._tooltip.options.sticky&&U.originalEvent&&(j=this._map.mouseEventToContainerPoint(U.originalEvent),K=this._map.containerPointToLayerPoint(j),k=this._map.layerPointToLatLng(K)),this._tooltip.setLatLng(k)}});var Pt=Jg.extend({options:{iconSize:[12,12],html:!1,bgPos:null,className:"leaflet-div-icon"},createIcon:function(U){var k=U&&U.tagName==="DIV"?U:document.createElement("div"),j=this.options;if(j.html instanceof Element?(Vl(k),k.appendChild(j.html)):k.innerHTML=j.html!==!1?j.html:"",j.bgPos){var K=F(j.bgPos);k.style.backgroundPosition=-K.x+"px "+-K.y+"px"}return this._setIconStyles(k,"icon"),k},createShadow:function(){return null}});function Kt(U){return new Pt(U)}Jg.Default=Kh;var Rt=ru.extend({options:{tileSize:256,opacity:1,updateWhenIdle:Gt.mobile,updateWhenZooming:!0,updateInterval:200,zIndex:1,bounds:null,minZoom:0,maxZoom:void 0,maxNativeZoom:void 0,minNativeZoom:void 0,noWrap:!1,pane:"tilePane",className:"",keepBuffer:2},initialize:function(U){m(this,U)},onAdd:function(){this._initContainer(),this._levels={},this._tiles={},this._resetView()},beforeAdd:function(U){U._addZoomLimit(this)},onRemove:function(U){this._removeAllTiles(),mr(this._container),U._removeZoomLimit(this),this._container=null,this._tileZoom=void 0},bringToFront:function(){return this._map&&(Dn(this._container),this._setAutoZIndex(Math.max)),this},bringToBack:function(){return this._map&&(Na(this._container),this._setAutoZIndex(Math.min)),this},getContainer:function(){return this._container},setOpacity:function(U){return this.options.opacity=U,this._updateOpacity(),this},setZIndex:function(U){return this.options.zIndex=U,this._updateZIndex(),this},isLoading:function(){return this._loading},redraw:function(){if(this._map){this._removeAllTiles();var U=this._clampZoom(this._map.getZoom());U!==this._tileZoom&&(this._tileZoom=U,this._updateLevels()),this._update()}return this},getEvents:function(){var U={viewprereset:this._invalidateAll,viewreset:this._resetView,zoom:this._resetView,moveend:this._onMoveEnd};return this.options.updateWhenIdle||(this._onMove||(this._onMove=c(this._onMoveEnd,this.options.updateInterval,this)),U.move=this._onMove),this._zoomAnimated&&(U.zoomanim=this._animateZoom),U},createTile:function(){return document.createElement("div")},getTileSize:function(){var U=this.options.tileSize;return U instanceof O?U:new O(U,U)},_updateZIndex:function(){this._container&&this.options.zIndex!==void 0&&this.options.zIndex!==null&&(this._container.style.zIndex=this.options.zIndex)},_setAutoZIndex:function(U){for(var k=this.getPane().children,j=-U(-1/0,1/0),K=0,ie=k.length,ye;K<ie;K++)ye=k[K].style.zIndex,k[K]!==this._container&&ye&&(j=U(j,+ye));isFinite(j)&&(this.options.zIndex=j+U(-1,1),this._updateZIndex())},_updateOpacity:function(){if(this._map&&!Gt.ielt9){_t(this._container,this.options.opacity);var U=+new Date,k=!1,j=!1;for(var K in this._tiles){var ie=this._tiles[K];if(!(!ie.current||!ie.loaded)){var ye=Math.min(1,(U-ie.loaded)/200);_t(ie.el,ye),ye<1?k=!0:(ie.active?j=!0:this._onOpaqueTile(ie),ie.active=!0)}}j&&!this._noPrune&&this._pruneTiles(),k&&(R(this._fadeFrame),this._fadeFrame=P(this._updateOpacity,this))}},_onOpaqueTile:d,_initContainer:function(){this._container||(this._container=Un("div","leaflet-layer "+(this.options.className||"")),this._updateZIndex(),this.options.opacity<1&&this._updateOpacity(),this.getPane().appendChild(this._container))},_updateLevels:function(){var U=this._tileZoom,k=this.options.maxZoom;if(U!==void 0){for(var j in this._levels)j=Number(j),this._levels[j].el.children.length||j===U?(this._levels[j].el.style.zIndex=k-Math.abs(U-j),this._onUpdateLevel(j)):(mr(this._levels[j].el),this._removeTilesAtZoom(j),this._onRemoveLevel(j),delete this._levels[j]);var K=this._levels[U],ie=this._map;return K||(K=this._levels[U]={},K.el=Un("div","leaflet-tile-container leaflet-zoom-animated",this._container),K.el.style.zIndex=k,K.origin=ie.project(ie.unproject(ie.getPixelOrigin()),U).round(),K.zoom=U,this._setZoomTransform(K,ie.getCenter(),ie.getZoom()),d(K.el.offsetWidth),this._onCreateLevel(K)),this._level=K,K}},_onUpdateLevel:d,_onRemoveLevel:d,_onCreateLevel:d,_pruneTiles:function(){if(this._map){var U,k,j=this._map.getZoom();if(j>this.options.maxZoom||j<this.options.minZoom){this._removeAllTiles();return}for(U in this._tiles)k=this._tiles[U],k.retain=k.current;for(U in this._tiles)if(k=this._tiles[U],k.current&&!k.active){var K=k.coords;this._retainParent(K.x,K.y,K.z,K.z-5)||this._retainChildren(K.x,K.y,K.z,K.z+2)}for(U in this._tiles)this._tiles[U].retain||this._removeTile(U)}},_removeTilesAtZoom:function(U){for(var k in this._tiles)this._tiles[k].coords.z===U&&this._removeTile(k)},_removeAllTiles:function(){for(var U in this._tiles)this._removeTile(U)},_invalidateAll:function(){for(var U in this._levels)mr(this._levels[U].el),this._onRemoveLevel(Number(U)),delete this._levels[U];this._removeAllTiles(),this._tileZoom=void 0},_retainParent:function(U,k,j,K){var ie=Math.floor(U/2),ye=Math.floor(k/2),Ne=j-1,Ze=new O(+ie,+ye);Ze.z=+Ne;var rt=this._tileCoordsToKey(Ze),Dt=this._tiles[rt];return Dt&&Dt.active?(Dt.retain=!0,!0):(Dt&&Dt.loaded&&(Dt.retain=!0),Ne>K?this._retainParent(ie,ye,Ne,K):!1)},_retainChildren:function(U,k,j,K){for(var ie=2*U;ie<2*U+2;ie++)for(var ye=2*k;ye<2*k+2;ye++){var Ne=new O(ie,ye);Ne.z=j+1;var Ze=this._tileCoordsToKey(Ne),rt=this._tiles[Ze];if(rt&&rt.active){rt.retain=!0;continue}else rt&&rt.loaded&&(rt.retain=!0);j+1<K&&this._retainChildren(ie,ye,j+1,K)}},_resetView:function(U){var k=U&&(U.pinch||U.flyTo);this._setView(this._map.getCenter(),this._map.getZoom(),k,k)},_animateZoom:function(U){this._setView(U.center,U.zoom,!0,U.noUpdate)},_clampZoom:function(U){var k=this.options;return k.minNativeZoom!==void 0&&U<k.minNativeZoom?k.minNativeZoom:k.maxNativeZoom!==void 0&&k.maxNativeZoom<U?k.maxNativeZoom:U},_setView:function(U,k,j,K){var ie=Math.round(k);this.options.maxZoom!==void 0&&ie>this.options.maxZoom||this.options.minZoom!==void 0&&ie<this.options.minZoom?ie=void 0:ie=this._clampZoom(ie);var ye=this.options.updateWhenZooming&&ie!==this._tileZoom;(!K||ye)&&(this._tileZoom=ie,this._abortLoading&&this._abortLoading(),this._updateLevels(),this._resetGrid(),ie!==void 0&&this._update(U),j||this._pruneTiles(),this._noPrune=!!j),this._setZoomTransforms(U,k)},_setZoomTransforms:function(U,k){for(var j in this._levels)this._setZoomTransform(this._levels[j],U,k)},_setZoomTransform:function(U,k,j){var K=this._map.getZoomScale(j,U.zoom),ie=U.origin.multiplyBy(K).subtract(this._map._getNewPixelOrigin(k,j)).round();Gt.any3d?nn(U.el,ie,K):si(U.el,ie)},_resetGrid:function(){var U=this._map,k=U.options.crs,j=this._tileSize=this.getTileSize(),K=this._tileZoom,ie=this._map.getPixelWorldBounds(this._tileZoom);ie&&(this._globalTileRange=this._pxBoundsToTileRange(ie)),this._wrapX=k.wrapLng&&!this.options.noWrap&&[Math.floor(U.project([0,k.wrapLng[0]],K).x/j.x),Math.ceil(U.project([0,k.wrapLng[1]],K).x/j.y)],this._wrapY=k.wrapLat&&!this.options.noWrap&&[Math.floor(U.project([k.wrapLat[0],0],K).y/j.x),Math.ceil(U.project([k.wrapLat[1],0],K).y/j.y)]},_onMoveEnd:function(){!this._map||this._map._animatingZoom||this._update()},_getTiledPixelBounds:function(U){var k=this._map,j=k._animatingZoom?Math.max(k._animateToZoom,k.getZoom()):k.getZoom(),K=k.getZoomScale(j,this._tileZoom),ie=k.project(U,this._tileZoom).floor(),ye=k.getSize().divideBy(K*2);return new G(ie.subtract(ye),ie.add(ye))},_update:function(U){var k=this._map;if(k){var j=this._clampZoom(k.getZoom());if(U===void 0&&(U=k.getCenter()),this._tileZoom!==void 0){var K=this._getTiledPixelBounds(U),ie=this._pxBoundsToTileRange(K),ye=ie.getCenter(),Ne=[],Ze=this.options.keepBuffer,rt=new G(ie.getBottomLeft().subtract([Ze,-Ze]),ie.getTopRight().add([Ze,-Ze]));if(!(isFinite(ie.min.x)&&isFinite(ie.min.y)&&isFinite(ie.max.x)&&isFinite(ie.max.y)))throw new Error("Attempted to load an infinite number of tiles");for(var Dt in this._tiles){var ni=this._tiles[Dt].coords;(ni.z!==this._tileZoom||!rt.contains(new O(ni.x,ni.y)))&&(this._tiles[Dt].current=!1)}if(Math.abs(j-this._tileZoom)>1){this._setView(U,j);return}for(var rn=ie.min.y;rn<=ie.max.y;rn++)for(var tr=ie.min.x;tr<=ie.max.x;tr++){var gc=new O(tr,rn);if(gc.z=this._tileZoom,!!this._isValidTile(gc)){var Js=this._tiles[this._tileCoordsToKey(gc)];Js?Js.current=!0:Ne.push(gc)}}if(Ne.sort(function(au,Kw){return au.distanceTo(ye)-Kw.distanceTo(ye)}),Ne.length!==0){this._loading||(this._loading=!0,this.fire("loading"));var Bd=document.createDocumentFragment();for(tr=0;tr<Ne.length;tr++)this._addTile(Ne[tr],Bd);this._level.el.appendChild(Bd)}}}},_isValidTile:function(U){var k=this._map.options.crs;if(!k.infinite){var j=this._globalTileRange;if(!k.wrapLng&&(U.x<j.min.x||U.x>j.max.x)||!k.wrapLat&&(U.y<j.min.y||U.y>j.max.y))return!1}if(!this.options.bounds)return!0;var K=this._tileCoordsToBounds(U);return q(this.options.bounds).overlaps(K)},_keyToBounds:function(U){return this._tileCoordsToBounds(this._keyToTileCoords(U))},_tileCoordsToNwSe:function(U){var k=this._map,j=this.getTileSize(),K=U.scaleBy(j),ie=K.add(j),ye=k.unproject(K,U.z),Ne=k.unproject(ie,U.z);return[ye,Ne]},_tileCoordsToBounds:function(U){var k=this._tileCoordsToNwSe(U),j=new $(k[0],k[1]);return this.options.noWrap||(j=this._map.wrapLatLngBounds(j)),j},_tileCoordsToKey:function(U){return U.x+":"+U.y+":"+U.z},_keyToTileCoords:function(U){var k=U.split(":"),j=new O(+k[0],+k[1]);return j.z=+k[2],j},_removeTile:function(U){var k=this._tiles[U];k&&(mr(k.el),delete this._tiles[U],this.fire("tileunload",{tile:k.el,coords:this._keyToTileCoords(U)}))},_initTile:function(U){Di(U,"leaflet-tile");var k=this.getTileSize();U.style.width=k.x+"px",U.style.height=k.y+"px",U.onselectstart=d,U.onmousemove=d,Gt.ielt9&&this.options.opacity<1&&_t(U,this.options.opacity)},_addTile:function(U,k){var j=this._getTilePos(U),K=this._tileCoordsToKey(U),ie=this.createTile(this._wrapCoords(U),o(this._tileReady,this,U));this._initTile(ie),this.createTile.length<2&&P(o(this._tileReady,this,U,null,ie)),si(ie,j),this._tiles[K]={el:ie,coords:U,current:!0},k.appendChild(ie),this.fire("tileloadstart",{tile:ie,coords:U})},_tileReady:function(U,k,j){k&&this.fire("tileerror",{error:k,tile:j,coords:U});var K=this._tileCoordsToKey(U);j=this._tiles[K],j&&(j.loaded=+new Date,this._map._fadeAnimated?(_t(j.el,0),R(this._fadeFrame),this._fadeFrame=P(this._updateOpacity,this)):(j.active=!0,this._pruneTiles()),k||(Di(j.el,"leaflet-tile-loaded"),this.fire("tileload",{tile:j.el,coords:U})),this._noTilesToLoad()&&(this._loading=!1,this.fire("load"),Gt.ielt9||!this._map._fadeAnimated?P(this._pruneTiles,this):setTimeout(o(this._pruneTiles,this),250)))},_getTilePos:function(U){return U.scaleBy(this.getTileSize()).subtract(this._level.origin)},_wrapCoords:function(U){var k=new O(this._wrapX?u(U.x,this._wrapX):U.x,this._wrapY?u(U.y,this._wrapY):U.y);return k.z=U.z,k},_pxBoundsToTileRange:function(U){var k=this.getTileSize();return new G(U.min.unscaleBy(k).floor(),U.max.unscaleBy(k).ceil().subtract([1,1]))},_noTilesToLoad:function(){for(var U in this._tiles)if(!this._tiles[U].loaded)return!1;return!0}});function Ni(U){return new Rt(U)}var Ai=Rt.extend({options:{minZoom:0,maxZoom:18,subdomains:"abc",errorTileUrl:"",zoomOffset:0,tms:!1,zoomReverse:!1,detectRetina:!1,crossOrigin:!1,referrerPolicy:!1},initialize:function(U,k){this._url=U,k=m(this,k),k.detectRetina&&Gt.retina&&k.maxZoom>0?(k.tileSize=Math.floor(k.tileSize/2),k.zoomReverse?(k.zoomOffset--,k.minZoom=Math.min(k.maxZoom,k.minZoom+1)):(k.zoomOffset++,k.maxZoom=Math.max(k.minZoom,k.maxZoom-1)),k.minZoom=Math.max(0,k.minZoom)):k.zoomReverse?k.minZoom=Math.min(k.maxZoom,k.minZoom):k.maxZoom=Math.max(k.minZoom,k.maxZoom),typeof k.subdomains=="string"&&(k.subdomains=k.subdomains.split("")),this.on("tileunload",this._onTileRemove)},setUrl:function(U,k){return this._url===U&&k===void 0&&(k=!0),this._url=U,k||this.redraw(),this},createTile:function(U,k){var j=document.createElement("img");return Li(j,"load",o(this._tileOnLoad,this,k,j)),Li(j,"error",o(this._tileOnError,this,k,j)),(this.options.crossOrigin||this.options.crossOrigin==="")&&(j.crossOrigin=this.options.crossOrigin===!0?"":this.options.crossOrigin),typeof this.options.referrerPolicy=="string"&&(j.referrerPolicy=this.options.referrerPolicy),j.alt="",j.src=this.getTileUrl(U),j},getTileUrl:function(U){var k={r:Gt.retina?"@2x":"",s:this._getSubdomain(U),x:U.x,y:U.y,z:this._getZoomForUrl()};if(this._map&&!this._map.options.crs.infinite){var j=this._globalTileRange.max.y-U.y;this.options.tms&&(k.y=j),k["-y"]=j}return y(this._url,r(k,this.options))},_tileOnLoad:function(U,k){Gt.ielt9?setTimeout(o(U,this,null,k),0):U(null,k)},_tileOnError:function(U,k,j){var K=this.options.errorTileUrl;K&&k.getAttribute("src")!==K&&(k.src=K),U(j,k)},_onTileRemove:function(U){U.tile.onload=null},_getZoomForUrl:function(){var U=this._tileZoom,k=this.options.maxZoom,j=this.options.zoomReverse,K=this.options.zoomOffset;return j&&(U=k-U),U+K},_getSubdomain:function(U){var k=Math.abs(U.x+U.y)%this.options.subdomains.length;return this.options.subdomains[k]},_abortLoading:function(){var U,k;for(U in this._tiles)if(this._tiles[U].coords.z!==this._tileZoom&&(k=this._tiles[U].el,k.onload=d,k.onerror=d,!k.complete)){k.src=T;var j=this._tiles[U].coords;mr(k),delete this._tiles[U],this.fire("tileabort",{tile:k,coords:j})}},_removeTile:function(U){var k=this._tiles[U];if(k)return k.el.setAttribute("src",T),Rt.prototype._removeTile.call(this,U)},_tileReady:function(U,k,j){if(!(!this._map||j&&j.getAttribute("src")===T))return Rt.prototype._tileReady.call(this,U,k,j)}});function Or(U,k){return new Ai(U,k)}var Cn=Ai.extend({defaultWmsParams:{service:"WMS",request:"GetMap",layers:"",styles:"",format:"image/jpeg",transparent:!1,version:"1.1.1"},options:{crs:null,uppercase:!1},initialize:function(U,k){this._url=U;var j=r({},this.defaultWmsParams);for(var K in k)K in this.options||(j[K]=k[K]);k=m(this,k);var ie=k.detectRetina&&Gt.retina?2:1,ye=this.getTileSize();j.width=ye.x*ie,j.height=ye.y*ie,this.wmsParams=j},onAdd:function(U){this._crs=this.options.crs||U.options.crs,this._wmsVersion=parseFloat(this.wmsParams.version);var k=this._wmsVersion>=1.3?"crs":"srs";this.wmsParams[k]=this._crs.code,Ai.prototype.onAdd.call(this,U)},getTileUrl:function(U){var k=this._tileCoordsToNwSe(U),j=this._crs,K=H(j.project(k[0]),j.project(k[1])),ie=K.min,ye=K.max,Ne=(this._wmsVersion>=1.3&&this._crs===YU?[ie.y,ie.x,ye.y,ye.x]:[ie.x,ie.y,ye.x,ye.y]).join(","),Ze=Ai.prototype.getTileUrl.call(this,U);return Ze+g(this.wmsParams,Ze,this.options.uppercase)+(this.options.uppercase?"&BBOX=":"&bbox=")+Ne},setParams:function(U,k){return r(this.wmsParams,U),k||this.redraw(),this}});function oa(U,k){return new Cn(U,k)}Ai.WMS=Cn,Or.wms=oa;var yo=ru.extend({options:{padding:.1},initialize:function(U){m(this,U),l(this),this._layers=this._layers||{}},onAdd:function(){this._container||(this._initContainer(),Di(this._container,"leaflet-zoom-animated")),this.getPane().appendChild(this._container),this._update(),this.on("update",this._updatePaths,this)},onRemove:function(){this.off("update",this._updatePaths,this),this._destroyContainer()},getEvents:function(){var U={viewreset:this._reset,zoom:this._onZoom,moveend:this._update,zoomend:this._onZoomEnd};return this._zoomAnimated&&(U.zoomanim=this._onAnimZoom),U},_onAnimZoom:function(U){this._updateTransform(U.center,U.zoom)},_onZoom:function(){this._updateTransform(this._map.getCenter(),this._map.getZoom())},_updateTransform:function(U,k){var j=this._map.getZoomScale(k,this._zoom),K=this._map.getSize().multiplyBy(.5+this.options.padding),ie=this._map.project(this._center,k),ye=K.multiplyBy(-j).add(ie).subtract(this._map._getNewPixelOrigin(U,k));Gt.any3d?nn(this._container,ye,j):si(this._container,ye)},_reset:function(){this._update(),this._updateTransform(this._center,this._zoom);for(var U in this._layers)this._layers[U]._reset()},_onZoomEnd:function(){for(var U in this._layers)this._layers[U]._project()},_updatePaths:function(){for(var U in this._layers)this._layers[U]._update()},_update:function(){var U=this.options.padding,k=this._map.getSize(),j=this._map.containerPointToLayerPoint(k.multiplyBy(-U)).round();this._bounds=new G(j,j.add(k.multiplyBy(1+U*2)).round()),this._center=this._map.getCenter(),this._zoom=this._map.getZoom()}}),bn=yo.extend({options:{tolerance:0},getEvents:function(){var U=yo.prototype.getEvents.call(this);return U.viewprereset=this._onViewPreReset,U},_onViewPreReset:function(){this._postponeUpdatePaths=!0},onAdd:function(){yo.prototype.onAdd.call(this),this._draw()},_initContainer:function(){var U=this._container=document.createElement("canvas");Li(U,"mousemove",this._onMouseMove,this),Li(U,"click dblclick mousedown mouseup contextmenu",this._onClick,this),Li(U,"mouseout",this._handleMouseOut,this),U._leaflet_disable_events=!0,this._ctx=U.getContext("2d")},_destroyContainer:function(){R(this._redrawRequest),delete this._ctx,mr(this._container),lr(this._container),delete this._container},_updatePaths:function(){if(!this._postponeUpdatePaths){var U;this._redrawBounds=null;for(var k in this._layers)U=this._layers[k],U._update();this._redraw()}},_update:function(){if(!(this._map._animatingZoom&&this._bounds)){yo.prototype._update.call(this);var U=this._bounds,k=this._container,j=U.getSize(),K=Gt.retina?2:1;si(k,U.min),k.width=K*j.x,k.height=K*j.y,k.style.width=j.x+"px",k.style.height=j.y+"px",Gt.retina&&this._ctx.scale(2,2),this._ctx.translate(-U.min.x,-U.min.y),this.fire("update")}},_reset:function(){yo.prototype._reset.call(this),this._postponeUpdatePaths&&(this._postponeUpdatePaths=!1,this._updatePaths())},_initPath:function(U){this._updateDashArray(U),this._layers[l(U)]=U;var k=U._order={layer:U,prev:this._drawLast,next:null};this._drawLast&&(this._drawLast.next=k),this._drawLast=k,this._drawFirst=this._drawFirst||this._drawLast},_addPath:function(U){this._requestRedraw(U)},_removePath:function(U){var k=U._order,j=k.next,K=k.prev;j?j.prev=K:this._drawLast=K,K?K.next=j:this._drawFirst=j,delete U._order,delete this._layers[l(U)],this._requestRedraw(U)},_updatePath:function(U){this._extendRedrawBounds(U),U._project(),U._update(),this._requestRedraw(U)},_updateStyle:function(U){this._updateDashArray(U),this._requestRedraw(U)},_updateDashArray:function(U){if(typeof U.options.dashArray=="string"){var k=U.options.dashArray.split(/[, ]+/),j=[],K,ie;for(ie=0;ie<k.length;ie++){if(K=Number(k[ie]),isNaN(K))return;j.push(K)}U.options._dashArray=j}else U.options._dashArray=U.options.dashArray},_requestRedraw:function(U){this._map&&(this._extendRedrawBounds(U),this._redrawRequest=this._redrawRequest||P(this._redraw,this))},_extendRedrawBounds:function(U){if(U._pxBounds){var k=(U.options.weight||0)+1;this._redrawBounds=this._redrawBounds||new G,this._redrawBounds.extend(U._pxBounds.min.subtract([k,k])),this._redrawBounds.extend(U._pxBounds.max.add([k,k]))}},_redraw:function(){this._redrawRequest=null,this._redrawBounds&&(this._redrawBounds.min._floor(),this._redrawBounds.max._ceil()),this._clear(),this._draw(),this._redrawBounds=null},_clear:function(){var U=this._redrawBounds;if(U){var k=U.getSize();this._ctx.clearRect(U.min.x,U.min.y,k.x,k.y)}else this._ctx.save(),this._ctx.setTransform(1,0,0,1,0,0),this._ctx.clearRect(0,0,this._container.width,this._container.height),this._ctx.restore()},_draw:function(){var U,k=this._redrawBounds;if(this._ctx.save(),k){var j=k.getSize();this._ctx.beginPath(),this._ctx.rect(k.min.x,k.min.y,j.x,j.y),this._ctx.clip()}this._drawing=!0;for(var K=this._drawFirst;K;K=K.next)U=K.layer,(!k||U._pxBounds&&U._pxBounds.intersects(k))&&U._updatePath();this._drawing=!1,this._ctx.restore()},_updatePoly:function(U,k){if(this._drawing){var j,K,ie,ye,Ne=U._parts,Ze=Ne.length,rt=this._ctx;if(Ze){for(rt.beginPath(),j=0;j<Ze;j++){for(K=0,ie=Ne[j].length;K<ie;K++)ye=Ne[j][K],rt[K?"lineTo":"moveTo"](ye.x,ye.y);k&&rt.closePath()}this._fillStroke(rt,U)}}},_updateCircle:function(U){if(!(!this._drawing||U._empty())){var k=U._point,j=this._ctx,K=Math.max(Math.round(U._radius),1),ie=(Math.max(Math.round(U._radiusY),1)||K)/K;ie!==1&&(j.save(),j.scale(1,ie)),j.beginPath(),j.arc(k.x,k.y/ie,K,0,Math.PI*2,!1),ie!==1&&j.restore(),this._fillStroke(j,U)}},_fillStroke:function(U,k){var j=k.options;j.fill&&(U.globalAlpha=j.fillOpacity,U.fillStyle=j.fillColor||j.color,U.fill(j.fillRule||"evenodd")),j.stroke&&j.weight!==0&&(U.setLineDash&&U.setLineDash(k.options&&k.options._dashArray||[]),U.globalAlpha=j.opacity,U.lineWidth=j.weight,U.strokeStyle=j.color,U.lineCap=j.lineCap,U.lineJoin=j.lineJoin,U.stroke())},_onClick:function(U){for(var k=this._map.mouseEventToLayerPoint(U),j,K,ie=this._drawFirst;ie;ie=ie.next)j=ie.layer,j.options.interactive&&j._containsPoint(k)&&(!(U.type==="click"||U.type==="preclick")||!this._map._draggableMoved(j))&&(K=j);this._fireEvent(K?[K]:!1,U)},_onMouseMove:function(U){if(!(!this._map||this._map.dragging.moving()||this._map._animatingZoom)){var k=this._map.mouseEventToLayerPoint(U);this._handleMouseHover(U,k)}},_handleMouseOut:function(U){var k=this._hoveredLayer;k&&(gr(this._container,"leaflet-interactive"),this._fireEvent([k],U,"mouseout"),this._hoveredLayer=null,this._mouseHoverThrottled=!1)},_handleMouseHover:function(U,k){if(!this._mouseHoverThrottled){for(var j,K,ie=this._drawFirst;ie;ie=ie.next)j=ie.layer,j.options.interactive&&j._containsPoint(k)&&(K=j);K!==this._hoveredLayer&&(this._handleMouseOut(U),K&&(Di(this._container,"leaflet-interactive"),this._fireEvent([K],U,"mouseover"),this._hoveredLayer=K)),this._fireEvent(this._hoveredLayer?[this._hoveredLayer]:!1,U),this._mouseHoverThrottled=!0,setTimeout(o(function(){this._mouseHoverThrottled=!1},this),32)}},_fireEvent:function(U,k,j){this._map._fireDOMEvent(k,j||k.type,U)},_bringToFront:function(U){var k=U._order;if(k){var j=k.next,K=k.prev;if(j)j.prev=K;else return;K?K.next=j:j&&(this._drawFirst=j),k.prev=this._drawLast,this._drawLast.next=k,k.next=null,this._drawLast=k,this._requestRedraw(U)}},_bringToBack:function(U){var k=U._order;if(k){var j=k.next,K=k.prev;if(K)K.next=j;else return;j?j.prev=K:K&&(this._drawLast=K),k.prev=null,k.next=this._drawFirst,this._drawFirst.prev=k,this._drawFirst=k,this._requestRedraw(U)}}});function Fd(U){return Gt.canvas?new bn(U):null}var Lo=function(){try{return document.namespaces.add("lvml","urn:schemas-microsoft-com:vml"),function(U){return document.createElement("<lvml:"+U+' class="lvml">')}}catch{}return function(U){return document.createElement("<"+U+' xmlns="urn:schemas-microsoft.com:vml" class="lvml">')}}(),qw={_initContainer:function(){this._container=Un("div","leaflet-vml-container")},_update:function(){this._map._animatingZoom||(yo.prototype._update.call(this),this.fire("update"))},_initPath:function(U){var k=U._container=Lo("shape");Di(k,"leaflet-vml-shape "+(this.options.className||"")),k.coordsize="1 1",U._path=Lo("path"),k.appendChild(U._path),this._updateStyle(U),this._layers[l(U)]=U},_addPath:function(U){var k=U._container;this._container.appendChild(k),U.options.interactive&&U.addInteractiveTarget(k)},_removePath:function(U){var k=U._container;mr(k),U.removeInteractiveTarget(k),delete this._layers[l(U)]},_updateStyle:function(U){var k=U._stroke,j=U._fill,K=U.options,ie=U._container;ie.stroked=!!K.stroke,ie.filled=!!K.fill,K.stroke?(k||(k=U._stroke=Lo("stroke")),ie.appendChild(k),k.weight=K.weight+"px",k.color=K.color,k.opacity=K.opacity,K.dashArray?k.dashStyle=b(K.dashArray)?K.dashArray.join(" "):K.dashArray.replace(/( *, *)/g," "):k.dashStyle="",k.endcap=K.lineCap.replace("butt","flat"),k.joinstyle=K.lineJoin):k&&(ie.removeChild(k),U._stroke=null),K.fill?(j||(j=U._fill=Lo("fill")),ie.appendChild(j),j.color=K.fillColor||K.color,j.opacity=K.fillOpacity):j&&(ie.removeChild(j),U._fill=null)},_updateCircle:function(U){var k=U._point.round(),j=Math.round(U._radius),K=Math.round(U._radiusY||j);this._setPath(U,U._empty()?"M0 0":"AL "+k.x+","+k.y+" "+j+","+K+" 0,"+65535*360)},_setPath:function(U,k){U._path.v=k},_bringToFront:function(U){Dn(U._container)},_bringToBack:function(U){Na(U._container)}},ds=Gt.vml?Lo:he,Xu=yo.extend({_initContainer:function(){this._container=ds("svg"),this._container.setAttribute("pointer-events","none"),this._rootGroup=ds("g"),this._container.appendChild(this._rootGroup)},_destroyContainer:function(){mr(this._container),lr(this._container),delete this._container,delete this._rootGroup,delete this._svgSize},_update:function(){if(!(this._map._animatingZoom&&this._bounds)){yo.prototype._update.call(this);var U=this._bounds,k=U.getSize(),j=this._container;(!this._svgSize||!this._svgSize.equals(k))&&(this._svgSize=k,j.setAttribute("width",k.x),j.setAttribute("height",k.y)),si(j,U.min),j.setAttribute("viewBox",[U.min.x,U.min.y,k.x,k.y].join(" ")),this.fire("update")}},_initPath:function(U){var k=U._path=ds("path");U.options.className&&Di(k,U.options.className),U.options.interactive&&Di(k,"leaflet-interactive"),this._updateStyle(U),this._layers[l(U)]=U},_addPath:function(U){this._rootGroup||this._initContainer(),this._rootGroup.appendChild(U._path),U.addInteractiveTarget(U._path)},_removePath:function(U){mr(U._path),U.removeInteractiveTarget(U._path),delete this._layers[l(U)]},_updatePath:function(U){U._project(),U._update()},_updateStyle:function(U){var k=U._path,j=U.options;k&&(j.stroke?(k.setAttribute("stroke",j.color),k.setAttribute("stroke-opacity",j.opacity),k.setAttribute("stroke-width",j.weight),k.setAttribute("stroke-linecap",j.lineCap),k.setAttribute("stroke-linejoin",j.lineJoin),j.dashArray?k.setAttribute("stroke-dasharray",j.dashArray):k.removeAttribute("stroke-dasharray"),j.dashOffset?k.setAttribute("stroke-dashoffset",j.dashOffset):k.removeAttribute("stroke-dashoffset")):k.setAttribute("stroke","none"),j.fill?(k.setAttribute("fill",j.fillColor||j.color),k.setAttribute("fill-opacity",j.fillOpacity),k.setAttribute("fill-rule",j.fillRule||"evenodd")):k.setAttribute("fill","none"))},_updatePoly:function(U,k){this._setPath(U,ae(U._parts,k))},_updateCircle:function(U){var k=U._point,j=Math.max(Math.round(U._radius),1),K=Math.max(Math.round(U._radiusY),1)||j,ie="a"+j+","+K+" 0 1,0 ",ye=U._empty()?"M0 0":"M"+(k.x-j)+","+k.y+ie+j*2+",0 "+ie+-j*2+",0 ";this._setPath(U,ye)},_setPath:function(U,k){U._path.setAttribute("d",k)},_bringToFront:function(U){Dn(U._path)},_bringToBack:function(U){Na(U._path)}});Gt.vml&&Xu.include(qw);function Ww(U){return Gt.svg||Gt.vml?new Xu(U):null}ii.include({getRenderer:function(U){var k=U.options.renderer||this._getPaneRenderer(U.options.pane)||this.options.renderer||this._renderer;return k||(k=this._renderer=this._createRenderer()),this.hasLayer(k)||this.addLayer(k),k},_getPaneRenderer:function(U){if(U==="overlayPane"||U===void 0)return!1;var k=this._paneRenderers[U];return k===void 0&&(k=this._createRenderer({pane:U}),this._paneRenderers[U]=k),k},_createRenderer:function(U){return this.options.preferCanvas&&Fd(U)||Ww(U)}});var EK=mc.extend({initialize:function(U,k){mc.prototype.initialize.call(this,this._boundsToLatLngs(U),k)},setBounds:function(U){return this.setLatLngs(this._boundsToLatLngs(U))},_boundsToLatLngs:function(U){return U=q(U),[U.getSouthWest(),U.getNorthWest(),U.getNorthEast(),U.getSouthEast()]}});function jCe(U,k){return new EK(U,k)}Xu.create=ds,Xu.pointsToPath=ae,V.geometryToLayer=W,V.coordsToLatLng=ne,V.coordsToLatLngs=le,V.latLngToCoords=ve,V.latLngsToCoords=we,V.getFeature=Ce,V.asFeature=Be,ii.mergeOptions({boxZoom:!0});var CK=$s.extend({initialize:function(U){this._map=U,this._container=U._container,this._pane=U._panes.overlayPane,this._resetStateTimeout=0,U.on("unload",this._destroy,this)},addHooks:function(){Li(this._container,"mousedown",this._onMouseDown,this)},removeHooks:function(){lr(this._container,"mousedown",this._onMouseDown,this)},moved:function(){return this._moved},_destroy:function(){mr(this._pane),delete this._pane},_resetState:function(){this._resetStateTimeout=0,this._moved=!1},_clearDeferredResetState:function(){this._resetStateTimeout!==0&&(clearTimeout(this._resetStateTimeout),this._resetStateTimeout=0)},_onMouseDown:function(U){if(!U.shiftKey||U.which!==1&&U.button!==1)return!1;this._clearDeferredResetState(),this._resetState(),ur(),Xo(),this._startPoint=this._map.mouseEventToContainerPoint(U),Li(document,{contextmenu:iu,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseMove:function(U){this._moved||(this._moved=!0,this._box=Un("div","leaflet-zoom-box",this._container),Di(this._container,"leaflet-crosshair"),this._map.fire("boxzoomstart")),this._point=this._map.mouseEventToContainerPoint(U);var k=new G(this._point,this._startPoint),j=k.getSize();si(this._box,k.min),this._box.style.width=j.x+"px",this._box.style.height=j.y+"px"},_finish:function(){this._moved&&(mr(this._box),gr(this._container,"leaflet-crosshair")),Mi(),Aa(),lr(document,{contextmenu:iu,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseUp:function(U){if(!(U.which!==1&&U.button!==1)&&(this._finish(),!!this._moved)){this._clearDeferredResetState(),this._resetStateTimeout=setTimeout(o(this._resetState,this),0);var k=new $(this._map.containerPointToLatLng(this._startPoint),this._map.containerPointToLatLng(this._point));this._map.fitBounds(k).fire("boxzoomend",{boxZoomBounds:k})}},_onKeyDown:function(U){U.keyCode===27&&(this._finish(),this._clearDeferredResetState(),this._resetState())}});ii.addInitHook("addHandler","boxZoom",CK),ii.mergeOptions({doubleClickZoom:!0});var PK=$s.extend({addHooks:function(){this._map.on("dblclick",this._onDoubleClick,this)},removeHooks:function(){this._map.off("dblclick",this._onDoubleClick,this)},_onDoubleClick:function(U){var k=this._map,j=k.getZoom(),K=k.options.zoomDelta,ie=U.originalEvent.shiftKey?j-K:j+K;k.options.doubleClickZoom==="center"?k.setZoom(ie):k.setZoomAround(U.containerPoint,ie)}});ii.addInitHook("addHandler","doubleClickZoom",PK),ii.mergeOptions({dragging:!0,inertia:!0,inertiaDeceleration:3400,inertiaMaxSpeed:1/0,easeLinearity:.2,worldCopyJump:!1,maxBoundsViscosity:0});var RK=$s.extend({addHooks:function(){if(!this._draggable){var U=this._map;this._draggable=new Ka(U._mapPane,U._container),this._draggable.on({dragstart:this._onDragStart,drag:this._onDrag,dragend:this._onDragEnd},this),this._draggable.on("predrag",this._onPreDragLimit,this),U.options.worldCopyJump&&(this._draggable.on("predrag",this._onPreDragWrap,this),U.on("zoomend",this._onZoomEnd,this),U.whenReady(this._onZoomEnd,this))}Di(this._map._container,"leaflet-grab leaflet-touch-drag"),this._draggable.enable(),this._positions=[],this._times=[]},removeHooks:function(){gr(this._map._container,"leaflet-grab"),gr(this._map._container,"leaflet-touch-drag"),this._draggable.disable()},moved:function(){return this._draggable&&this._draggable._moved},moving:function(){return this._draggable&&this._draggable._moving},_onDragStart:function(){var U=this._map;if(U._stop(),this._map.options.maxBounds&&this._map.options.maxBoundsViscosity){var k=q(this._map.options.maxBounds);this._offsetLimit=H(this._map.latLngToContainerPoint(k.getNorthWest()).multiplyBy(-1),this._map.latLngToContainerPoint(k.getSouthEast()).multiplyBy(-1).add(this._map.getSize())),this._viscosity=Math.min(1,Math.max(0,this._map.options.maxBoundsViscosity))}else this._offsetLimit=null;U.fire("movestart").fire("dragstart"),U.options.inertia&&(this._positions=[],this._times=[])},_onDrag:function(U){if(this._map.options.inertia){var k=this._lastTime=+new Date,j=this._lastPos=this._draggable._absPos||this._draggable._newPos;this._positions.push(j),this._times.push(k),this._prunePositions(k)}this._map.fire("move",U).fire("drag",U)},_prunePositions:function(U){for(;this._positions.length>1&&U-this._times[0]>50;)this._positions.shift(),this._times.shift()},_onZoomEnd:function(){var U=this._map.getSize().divideBy(2),k=this._map.latLngToLayerPoint([0,0]);this._initialWorldOffset=k.subtract(U).x,this._worldWidth=this._map.getPixelWorldBounds().getSize().x},_viscousLimit:function(U,k){return U-(U-k)*this._viscosity},_onPreDragLimit:function(){if(!(!this._viscosity||!this._offsetLimit)){var U=this._draggable._newPos.subtract(this._draggable._startPos),k=this._offsetLimit;U.x<k.min.x&&(U.x=this._viscousLimit(U.x,k.min.x)),U.y<k.min.y&&(U.y=this._viscousLimit(U.y,k.min.y)),U.x>k.max.x&&(U.x=this._viscousLimit(U.x,k.max.x)),U.y>k.max.y&&(U.y=this._viscousLimit(U.y,k.max.y)),this._draggable._newPos=this._draggable._startPos.add(U)}},_onPreDragWrap:function(){var U=this._worldWidth,k=Math.round(U/2),j=this._initialWorldOffset,K=this._draggable._newPos.x,ie=(K-k+j)%U+k-j,ye=(K+k+j)%U-k-j,Ne=Math.abs(ie+j)<Math.abs(ye+j)?ie:ye;this._draggable._absPos=this._draggable._newPos.clone(),this._draggable._newPos.x=Ne},_onDragEnd:function(U){var k=this._map,j=k.options,K=!j.inertia||U.noInertia||this._times.length<2;if(k.fire("dragend",U),K)k.fire("moveend");else{this._prunePositions(+new Date);var ie=this._lastPos.subtract(this._positions[0]),ye=(this._lastTime-this._times[0])/1e3,Ne=j.easeLinearity,Ze=ie.multiplyBy(Ne/ye),rt=Ze.distanceTo([0,0]),Dt=Math.min(j.inertiaMaxSpeed,rt),ni=Ze.multiplyBy(Dt/rt),rn=Dt/(j.inertiaDeceleration*Ne),tr=ni.multiplyBy(-rn/2).round();!tr.x&&!tr.y?k.fire("moveend"):(tr=k._limitOffset(tr,k.options.maxBounds),P(function(){k.panBy(tr,{duration:rn,easeLinearity:Ne,noMoveStart:!0,animate:!0})}))}}});ii.addInitHook("addHandler","dragging",RK),ii.mergeOptions({keyboard:!0,keyboardPanDelta:80});var MK=$s.extend({keyCodes:{left:[37],right:[39],down:[40],up:[38],zoomIn:[187,107,61,171],zoomOut:[189,109,54,173]},initialize:function(U){this._map=U,this._setPanDelta(U.options.keyboardPanDelta),this._setZoomDelta(U.options.zoomDelta)},addHooks:function(){var U=this._map._container;U.tabIndex<=0&&(U.tabIndex="0"),Li(U,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.on({focus:this._addHooks,blur:this._removeHooks},this)},removeHooks:function(){this._removeHooks(),lr(this._map._container,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.off({focus:this._addHooks,blur:this._removeHooks},this)},_onMouseDown:function(){if(!this._focused){var U=document.body,k=document.documentElement,j=U.scrollTop||k.scrollTop,K=U.scrollLeft||k.scrollLeft;this._map._container.focus(),window.scrollTo(K,j)}},_onFocus:function(){this._focused=!0,this._map.fire("focus")},_onBlur:function(){this._focused=!1,this._map.fire("blur")},_setPanDelta:function(U){var k=this._panKeys={},j=this.keyCodes,K,ie;for(K=0,ie=j.left.length;K<ie;K++)k[j.left[K]]=[-1*U,0];for(K=0,ie=j.right.length;K<ie;K++)k[j.right[K]]=[U,0];for(K=0,ie=j.down.length;K<ie;K++)k[j.down[K]]=[0,U];for(K=0,ie=j.up.length;K<ie;K++)k[j.up[K]]=[0,-1*U]},_setZoomDelta:function(U){var k=this._zoomKeys={},j=this.keyCodes,K,ie;for(K=0,ie=j.zoomIn.length;K<ie;K++)k[j.zoomIn[K]]=U;for(K=0,ie=j.zoomOut.length;K<ie;K++)k[j.zoomOut[K]]=-U},_addHooks:function(){Li(document,"keydown",this._onKeyDown,this)},_removeHooks:function(){lr(document,"keydown",this._onKeyDown,this)},_onKeyDown:function(U){if(!(U.altKey||U.ctrlKey||U.metaKey)){var k=U.keyCode,j=this._map,K;if(k in this._panKeys){if(!j._panAnim||!j._panAnim._inProgress)if(K=this._panKeys[k],U.shiftKey&&(K=F(K).multiplyBy(3)),j.options.maxBounds&&(K=j._limitOffset(F(K),j.options.maxBounds)),j.options.worldCopyJump){var ie=j.wrapLatLng(j.unproject(j.project(j.getCenter()).add(K)));j.panTo(ie)}else j.panBy(K)}else if(k in this._zoomKeys)j.setZoom(j.getZoom()+(U.shiftKey?3:1)*this._zoomKeys[k]);else if(k===27&&j._popup&&j._popup.options.closeOnEscapeKey)j.closePopup();else return;iu(U)}}});ii.addInitHook("addHandler","keyboard",MK),ii.mergeOptions({scrollWheelZoom:!0,wheelDebounceTime:40,wheelPxPerZoomLevel:60});var NK=$s.extend({addHooks:function(){Li(this._map._container,"wheel",this._onWheelScroll,this),this._delta=0},removeHooks:function(){lr(this._map._container,"wheel",this._onWheelScroll,this)},_onWheelScroll:function(U){var k=dt(U),j=this._map.options.wheelDebounceTime;this._delta+=k,this._lastMousePos=this._map.mouseEventToContainerPoint(U),this._startTime||(this._startTime=+new Date);var K=Math.max(j-(+new Date-this._startTime),0);clearTimeout(this._timer),this._timer=setTimeout(o(this._performZoom,this),K),iu(U)},_performZoom:function(){var U=this._map,k=U.getZoom(),j=this._map.options.zoomSnap||0;U._stop();var K=this._delta/(this._map.options.wheelPxPerZoomLevel*4),ie=4*Math.log(2/(1+Math.exp(-Math.abs(K))))/Math.LN2,ye=j?Math.ceil(ie/j)*j:ie,Ne=U._limitZoom(k+(this._delta>0?ye:-ye))-k;this._delta=0,this._startTime=null,Ne&&(U.options.scrollWheelZoom==="center"?U.setZoom(k+Ne):U.setZoomAround(this._lastMousePos,k+Ne))}});ii.addInitHook("addHandler","scrollWheelZoom",NK);var GCe=600;ii.mergeOptions({tapHold:Gt.touchNative&&Gt.safari&&Gt.mobile,tapTolerance:15});var AK=$s.extend({addHooks:function(){Li(this._map._container,"touchstart",this._onDown,this)},removeHooks:function(){lr(this._map._container,"touchstart",this._onDown,this)},_onDown:function(U){if(clearTimeout(this._holdTimeout),U.touches.length===1){var k=U.touches[0];this._startPos=this._newPos=new O(k.clientX,k.clientY),this._holdTimeout=setTimeout(o(function(){this._cancel(),this._isTapValid()&&(Li(document,"touchend",qa),Li(document,"touchend touchcancel",this._cancelClickPrevent),this._simulateEvent("contextmenu",k))},this),GCe),Li(document,"touchend touchcancel contextmenu",this._cancel,this),Li(document,"touchmove",this._onMove,this)}},_cancelClickPrevent:function U(){lr(document,"touchend",qa),lr(document,"touchend touchcancel",U)},_cancel:function(){clearTimeout(this._holdTimeout),lr(document,"touchend touchcancel contextmenu",this._cancel,this),lr(document,"touchmove",this._onMove,this)},_onMove:function(U){var k=U.touches[0];this._newPos=new O(k.clientX,k.clientY)},_isTapValid:function(){return this._newPos.distanceTo(this._startPos)<=this._map.options.tapTolerance},_simulateEvent:function(U,k){var j=new MouseEvent(U,{bubbles:!0,cancelable:!0,view:window,screenX:k.screenX,screenY:k.screenY,clientX:k.clientX,clientY:k.clientY});j._simulated=!0,k.target.dispatchEvent(j)}});ii.addInitHook("addHandler","tapHold",AK),ii.mergeOptions({touchZoom:Gt.touch,bounceAtZoomLimits:!0});var _K=$s.extend({addHooks:function(){Di(this._map._container,"leaflet-touch-zoom"),Li(this._map._container,"touchstart",this._onTouchStart,this)},removeHooks:function(){gr(this._map._container,"leaflet-touch-zoom"),lr(this._map._container,"touchstart",this._onTouchStart,this)},_onTouchStart:function(U){var k=this._map;if(!(!U.touches||U.touches.length!==2||k._animatingZoom||this._zooming)){var j=k.mouseEventToContainerPoint(U.touches[0]),K=k.mouseEventToContainerPoint(U.touches[1]);this._centerPoint=k.getSize()._divideBy(2),this._startLatLng=k.containerPointToLatLng(this._centerPoint),k.options.touchZoom!=="center"&&(this._pinchStartLatLng=k.containerPointToLatLng(j.add(K)._divideBy(2))),this._startDist=j.distanceTo(K),this._startZoom=k.getZoom(),this._moved=!1,this._zooming=!0,k._stop(),Li(document,"touchmove",this._onTouchMove,this),Li(document,"touchend touchcancel",this._onTouchEnd,this),qa(U)}},_onTouchMove:function(U){if(!(!U.touches||U.touches.length!==2||!this._zooming)){var k=this._map,j=k.mouseEventToContainerPoint(U.touches[0]),K=k.mouseEventToContainerPoint(U.touches[1]),ie=j.distanceTo(K)/this._startDist;if(this._zoom=k.getScaleZoom(ie,this._startZoom),!k.options.bounceAtZoomLimits&&(this._zoom<k.getMinZoom()&&ie<1||this._zoom>k.getMaxZoom()&&ie>1)&&(this._zoom=k._limitZoom(this._zoom)),k.options.touchZoom==="center"){if(this._center=this._startLatLng,ie===1)return}else{var ye=j._add(K)._divideBy(2)._subtract(this._centerPoint);if(ie===1&&ye.x===0&&ye.y===0)return;this._center=k.unproject(k.project(this._pinchStartLatLng,this._zoom).subtract(ye),this._zoom)}this._moved||(k._moveStart(!0,!1),this._moved=!0),R(this._animRequest);var Ne=o(k._move,k,this._center,this._zoom,{pinch:!0,round:!1},void 0);this._animRequest=P(Ne,this,!0),qa(U)}},_onTouchEnd:function(){if(!this._moved||!this._zooming){this._zooming=!1;return}this._zooming=!1,R(this._animRequest),lr(document,"touchmove",this._onTouchMove,this),lr(document,"touchend touchcancel",this._onTouchEnd,this),this._map.options.zoomAnimation?this._map._animateZoom(this._center,this._map._limitZoom(this._zoom),!0,this._map.options.zoomSnap):this._map._resetView(this._center,this._map._limitZoom(this._zoom))}});ii.addInitHook("addHandler","touchZoom",_K),ii.BoxZoom=CK,ii.DoubleClickZoom=PK,ii.Drag=RK,ii.Keyboard=MK,ii.ScrollWheelZoom=NK,ii.TapHold=AK,ii.TouchZoom=_K,i.Bounds=G,i.Browser=Gt,i.CRS=Y,i.Canvas=bn,i.Circle=zw,i.CircleMarker=Hw,i.Class=M,i.Control=En,i.DivIcon=Pt,i.DivOverlay=Xe,i.DomEvent=gi,i.DomUtil=fl,i.Draggable=Ka,i.Evented=x,i.FeatureGroup=Od,i.GeoJSON=V,i.GridLayer=Rt,i.Handler=$s,i.Icon=Jg,i.ImageOverlay=Le,i.LatLng=z,i.LatLngBounds=$,i.Layer=ru,i.LayerGroup=Wh,i.LineUtil=WU,i.Map=ii,i.Marker=ka,i.Mixin=VU,i.Path=ts,i.Point=O,i.PolyUtil=jU,i.Polygon=mc,i.Polyline=Zu,i.Popup=ct,i.PosAnimation=kn,i.Projection=DB,i.Rectangle=EK,i.Renderer=yo,i.SVG=Xu,i.SVGOverlay=Ge,i.TileLayer=Ai,i.Tooltip=It,i.Transformation=re,i.Util=N,i.VideoOverlay=He,i.bind=o,i.bounds=H,i.canvas=Fd,i.circle=wm,i.circleMarker=ZU,i.control=_a,i.divIcon=Kt,i.extend=r,i.featureGroup=CB,i.geoJSON=ze,i.geoJson=Oe,i.gridLayer=Ni,i.icon=PB,i.imageOverlay=je,i.latLng=Z,i.latLngBounds=q,i.layerGroup=hM,i.map=po,i.marker=Gw,i.point=F,i.polygon=fM,i.polyline=Qg,i.popup=ht,i.rectangle=jCe,i.setOptions=m,i.stamp=l,i.svg=Ww,i.svgOverlay=Qe,i.tileLayer=Or,i.tooltip=jt,i.transformation=me,i.version=n,i.videoOverlay=Ye;var HCe=window.L;i.noConflict=function(){return window.L=HCe,this},window.L=i})})(VG,VG.exports);var oA=VG.exports;function Got(){try{return navigator||window.navigator}catch{return}}function Hot({coords:t,callback:e}){let i=16;(!(t!=null&&t.latitude)||!(t!=null&&t.longitude))&&(t={latitude:0,longitude:0},i=2);let n={map:"latLongMap",link:"latLonglink"},a=`
         <div style='min-height: 150px'>
         <h2 class='tmx-title'>Enter map URL</h2>
         <div class='flexcenter'>${Bo.tr("phrases.addgooglemap")}</div>
         <div class='flexcenter flexcol'>
            <input id='${n.link}' value='' style='text-align: center; width: 25em; margin: 1em;'>
            <div class='flexrow' style='margin-top: 1em; margin-bottom: 1em;'>
            </div>
         </div>
         <div class='location_detail_body' style='min-width: 350px; min-height: 350px;'>
            <div id='${n.map}' class='location_map' style='width: 100%; height: 100%; min-width: 350px; min-height: 350px;'>
         </div>
      `;const l=[{label:"Cancel",intent:"none",close:!0},{onClick:m,intent:"is-warning",label:"Clear"},{onClick:()=>{!t.latitude||!t.longitude?c():m(t)},intent:"is-primary",label:"View",close:!1},{onClick:()=>{(!t.latitude||!t.longitude)&&c(),Nt(e)&&e(t)},intent:"is-info",label:"Submit",close:!0}],c=()=>{const g=d.link.element.value,v=$ot(g)||Vot(g)||Bot(g)||jot(g);v.latitude?m(v):g&&v.latitude===void 0&&ti({message:"Invalid URL"})},u=g=>{g.which===13&&c()};cr({content:a,buttons:l});const d=w1e(n);let{map:p,marker:h}=zot({successElement:d.map.element,mapElementId:d.map.id,coords:t,zoom:i});d.link.element.value="",d.link.element.focus(),d.link.element.addEventListener("keyup",u),p&&(p.on("click",g=>f({latitude:g.latlng.lat,longitude:g.latlng.lng})),p.on("contextmenu",g=>console.log("Coordinates: "+g.latlng.toString())));function f({latitude:g,longitude:v}){t={latitude:g,longitude:v};let y=new oA.LatLng(g,v);h.setLatLng(y)}function m({latitude:g=0,longitude:v=0}={}){if(g&&v)return t={latitude:+g,longitude:+v},p.setView([+g,+v],16),!0;t={latitude:0,longitude:0},p.fitWorld()}}function zot({successElement:t,mapElementId:e,coords:i,zoom:n}){let r=Got();if(!(r!=null&&r.onLine))return{};if(n=n===void 0?16:n,i.latitude!==void 0&&i.longitude!==void 0)return t&&(t.style.display="inline"),a(i.latitude,i.longitude,n);return{};function a(o,s,l){if(isNaN(o)||isNaN(s))return{};let c=ln.locations.map_view||"map",u=oA.tileLayer(ln.leaflet[c].tileLayer,{attribution:ln.leaflet[c].attribution,maxZoom:ln.leaflet[c].maxZoom??16}),d=oA.map(e).fitWorld().addLayer(u);(o||s)&&d.setView([+o,+s],l);let p=oA.marker([+o,+s]).addTo(d);return setTimeout(function(){d.invalidateSize()},300),{map:d,marker:p}}}function qot(t,e){const i=e.getRow().getData(),{latitude:n,longitude:r}=(i==null?void 0:i.address)||{};Hot({coords:{latitude:n,longitude:r},callback:(o={})=>{i.address||(i.address={});const s=i.venue;s.addresses||(s.addresses=[]),s.addresses.length?Object.assign(s.addresses[0],{latitude:o.latitude,longitude:o.longitude}):s.addresses.push({latitude:o.latitude,longitude:o.longitude});const l=u=>{var d,p;if((p=(d=u.results)==null?void 0:d[0])!=null&&p.success){const h=e.getTable();i.address.latitude=o.latitude,i.address.longitude=o.longitude,i.hasLocation=o.latitude&&o.longitude,h.updateData([i])}},c=[{method:oKe,params:{venueId:i.venueId,modifications:{addresses:s.addresses}}}];Wt({methods:c,callback:l})}})}function Wot(){const t=()=>console.log("Venue actions"),e=i=>i.getValue()?'<i class="fa-sharp fa-solid fa-location-dot" style="color: blue"></i>':"?";return[{cellClick:(i,n)=>n.getRow().toggleSelect(),titleFormatter:"rowSelection",formatter:"rowSelection",headerSort:!1,responsive:!1,hozAlign:ci,width:5},{headerMenu:vm({scheduledMatchUpsCount:"Scheduled matches",availableTime:"Time Available",courtsCount:"Number of courts",hasLocation:"Location"}),formatter:"rownum",headerSort:!1,hozAlign:li,width:55},{cellClick:zb,field:"venueAbbreviation",title:"Abbr",visible:!0,width:120},{cellClick:zb,field:"venueName",title:"Venue",visible:!0,minWidth:200,widthGrow:3},{title:'<div class="event_icon surface_header"></div>',headerTooltip:"Number of courts",headerHozAlign:li,field:"courtsCount",hozAlign:li,headerSort:!0,visible:!0,width:50},{title:"Scheduled",headerTooltip:"Scheduled matches",field:"scheduledMatchUpsCount",headerHozAlign:li,headerSort:!0,hozAlign:li,visible:!0,minWidth:120},{title:"Time",headerHozAlign:li,field:"availableTime",headerSort:!0,hozAlign:li,visible:!0,minWidth:120},{title:'<i class="fa-sharp fa-solid fa-location-dot"></i>',formatter:e,headerTooltip:"Location",headerHozAlign:li,cellClick:qot,field:"hasLocation",headerSort:!1,hozAlign:li,visible:!0,width:50},{cellClick:zb,formatter:R9,responsive:!1,headerSort:!1,hozAlign:Qt,field:"isOpen",width:20},{cellClick:t,formatter:Hg,responsive:!1,headerSort:!1,hozAlign:Qt,width:50}]}function Kot({table:t}={}){const e=()=>{const{venues:r}=My.getVenuesAndCourts();return{rows:r.map(IDe)}},i=()=>{const{rows:r}=e();t==null||t.replaceData(r)},n=Wot();if(t)i();else{gm({anchorId:e_});const r=document.getElementById(e_),{rows:a}=e();t=new Go(r,{headerSortElement:Fh(["scheduledMatchUpsCount","venueAbbreviation","availableTime","courtsCount","venueName"]),minHeight:window.innerHeight*.81,rowFormatter:Fot,placeholder:"No venues",layout:"fitColumns",reactiveData:!0,index:"venueId",columns:n,data:a}),t.on("scrollVertical",ld),t.on("cellEdited",o=>{const s=o.getColumn().getDefinition(),l=o.getRow().getData(),c=o.getValue();console.log({cell:o,row:l,value:c,def:s})})}return{table:t,replaceTableData:i}}function Yot({table:t,updateVenueRow:e,controlAnchor:i}={}){return i?Ns({table:t,target:i,items:[{onClick:()=>{const a=t.getSelectedData().map(({venueId:l})=>l);Wt({methods:[{method:iKe,params:{venueIds:a,force:!0}}],callback:l=>l.success&&t.deleteRow(a)})},label:"Delete selected",intent:"is-danger",stateChange:!0,location:Ua},{label:"Add venue",onClick:()=>m1e(e),location:Qt,id:"addVenue",intent:"none"}]}).elements:void 0}function Zot(){const t=document.getElementById(y4),{table:e}=Kot();Yot({table:e,controlAnchor:t,updateVenueRow:({venue:n})=>{e.updateOrAddData([IDe(n)])}})}const{POLICY_TYPE_AVOIDANCE:QQ}=Iy;function wDe({eventId:t,drawId:e}){var i,n,r;return(r=(n=(i=at.getPolicyDefinitions({policyTypes:[QQ],eventId:t,drawId:e}))==null?void 0:i.policyDefinitions)==null?void 0:n[QQ])==null?void 0:r.policyAttributes}const jG={city:[{key:"person.addresses.city"},{key:"individualParticipants.person.addresses.city"}],state:[{key:"person.addresses.state"},{key:"individualParticipants.person.addresses.state"}],postal:[{key:"person.addresses.postalCode",significantCharacters:5},{key:"individualParticipants.person.addresses.postalCode",significantCharacters:5}],iso:[{key:"person.addresses.country"},{key:"individualParticipants.person.addresses.country"}],groups:[{directive:"groupParticipants"}],pairs:[{directive:"pairParticipants"}],teams:[{directive:"teamParticipants"}]};function Xot({event:t}){const e=wDe({eventId:t.eventId}),i=(e==null?void 0:e.map(r=>Object.keys(jG).find(a=>jG[a].some(s=>s.directive&&s.directive===r.directive||s.key&&s.key===r.key))).filter(Boolean))??[];return{items:[{text:"Select rules"},{checked:i.includes("pairs"),label:"Doubles pairs",id:"avoidancePairs",checkbox:!0,field:"pairs"},{checked:i.includes("groups"),id:"avoidanceGroups",checkbox:!0,label:"Groups",field:"groups"},{checked:i.includes("teams"),id:"avoidanceTeams",checkbox:!0,label:"Teams",field:"teams"},{checked:i.includes("iso"),id:"avoidanceCountry",label:"Country",checkbox:!0,field:"iso"},{checked:i==null?void 0:i.includes("city"),id:"avoidancedCity",checkbox:!0,label:"City",field:"city"},{checked:i.includes("state"),id:"avoidancedState",checkbox:!0,label:"State",field:"state"},{checked:i.includes("zip"),id:"avoidancedPostal",label:"Postal code",checkbox:!0,field:"zip"},{label:"Postal code digits",visible:!1,field:"zip"}]}}function SDe({eventId:t}){const e=at.getEvent({eventId:t}).event;if(!e)return;const{items:i}=Xot({event:e});let n;const r=!0,a=u=>n=Cr(u,i),s=[{label:"Cancel",intent:Mt,close:!0},{label:"Save",id:"setAvoidances",intent:"is-info",onClick:()=>{const d=Object.keys(n).filter(f=>n[f].checked).flatMap(f=>jG[f]).filter(Boolean);Wt({methods:[{method:X9e,params:{policyDefinitions:{avoidance:{policyAttributes:d}},allowReplacement:!0,eventId:t}}],callback:f=>{if(f.success){const m="is-success",g=document.getElementById("editAvoidances");g&&(d.length?g.classList.add(m):g.classList.remove(m))}else ti({message:"Error",intent:"is-danger"})}})},close:r}],l="Set avoidances",c=(u,d)=>Cw(u,s,d);Tt.drawer.open({title:l,content:a,footer:c,side:Qt,width:"300px"})}const{WTN:Jot,UTR:Qot}=ks.ratingConstants,{TEAM:est}=ks.eventConstants,{QUALIFYING:eee}=pa;function oB({entry:t,derivedDrawInfo:e,participants:i,participant:n,eventType:r,categoryName:a,eventId:o}){var y,b,I,T,w,S,D,E,C,P,R,N,M,A,_;n=n||(i==null?void 0:i.find(x=>x.participantId===t.participantId));const s=((y=n==null?void 0:n.draws)==null?void 0:y.filter(x=>x.eventId===o).map(x=>({...x,drawName:e[x.drawId].drawName})))??[],l=(I=(b=n==null?void 0:n.person)==null?void 0:b.addresses)==null?void 0:I[0],c=l?`${l.city}, ${l.state}`:void 0,u=r===est?"AVERAGE":r,d=(S=(w=(T=n==null?void 0:n.ratings)==null?void 0:T[u])==null?void 0:w.find(x=>x.scaleName===Jot))==null?void 0:S.scaleValue,p=(C=(E=(D=n==null?void 0:n.ratings)==null?void 0:D[u])==null?void 0:E.find(x=>x.scaleName===Qot))==null?void 0:C.scaleValue,h={wtn:d,utr:p},f=(N=(R=(P=n==null?void 0:n.rankings)==null?void 0:P[r])==null?void 0:R.find(x=>x.scaleName===a))==null?void 0:N.scaleValue,m=t.entryStage===eee?`${o}${eee}`:o,g=(_=(A=(M=n==null?void 0:n.seedings)==null?void 0:M[r])==null?void 0:A.find(x=>x.scaleName===m))==null?void 0:_.scaleValue,v=vhe[t.entryStatus];return{searchText:n==null?void 0:n.participantName.toLowerCase(),participant:n,seedNumber:g,cityState:c,...t,ranking:f,ratings:h,flights:s,status:v}}function zp(t){return _i.isConvertableInteger(t)&&parseInt(t)>=0}const TDe=(t,e)=>i=>zp(i)&&i>=t&&i<=e,{ORGANISER_ACCEPTANCE:tst,DIRECT_ACCEPTANCE:ist,SPECIAL_EXEMPT:nst,JUNIOR_EXEMPT:rst,WILDCARD:ast}=$u,{MAIN:ost}=pa,hk=(t=ost)=>[`${t}.${ist}`,`${t}.${tst}`,`${t}.${nst}`,`${t}.${rst}`,`${t}.${ast}`],{MAIN:tee}=pa;function GG(t,e=tee){return t.entries.filter(({entryStage:i=tee,entryStatus:n})=>hk(e).includes(`${i}.${n}`)).length}const{FEED_IN:sst,LUCKY_DRAW:lst,MAIN:cst,QUALIFYING:ust,ROUND_ROBIN:iee,ROUND_ROBIN_WITH_PLAYOFF:KM}=pa;function dst({event:t,isQualifying:e,maxQualifiers:i}){const n=e?ust:cst,r=({fields:p,inputs:h})=>{var T;const f=h[pv].value||0,m=zp(f)?parseInt(f):0,g=GG(t,n),v=h.qualifiersCount.value||0,y=zp(v)?parseInt(v):0,b=i||e&&m<g||m<g+y;b&&(h[bc].value=o4);const I=(T=mg(p[bc],"help"))==null?void 0:T[0];I.style.display=b?"":Mt;for(const w of h[bc].options)w.label===bc&&(w.disabled=b)},a=({drawType:p,fields:h,inputs:f})=>{const m=i?f[pv].value:GG(t,n),g=f.qualifiersCount.value||1,v=zp(g)&&parseInt(g)||i?1:0,y=e&&!i?m:parseInt(m)+v,b=(i||[lst,sst,iee,KM].includes(p))&&y||_i.nextPowerOf2(y);return f[pv].value=b,r({fields:h,inputs:f}),b},o=({fields:p,inputs:h})=>{let f=parseInt(h[pv].value);const m=h.qualifiersCount.value;zp(m)&&parseInt(m)<1&&(h.qualifiersCount.value=i?1:0);const g=document.getElementById("generateDraw");let v=h.qualifiersCount.value;if(g.disabled=!1,i&&zp(v)&&parseInt(v)>i)h.qualifiersCount.value=i;else if(!i){const y=h[Yp].value;f=a({drawType:y,fields:p,inputs:h})}v=h.qualifiersCount.value,g&&(!zp(v)||f<=parseInt(v))&&(g.disabled=!0)},s=({e:p,fields:h,inputs:f})=>{const m=f[V1].value,g=p.target.value;i||a({drawType:g,fields:h,inputs:f}),r({fields:h,inputs:f}),h[f0].style.display=g===KM&&m===j1?"":Mt,h[V1].style.display=g===KM?"":Mt;const v=[iee,KM].includes(g);h[lf].style.display=v?"":Mt},l=({fields:p,inputs:h})=>{const f=document.getElementById("generateDraw"),m=h[pv].value||0,g=TDe(2,128)(m);f.disabled=!g;const v=zp(m)?parseInt(m):0,{validGroupSizes:y}=at.getValidGroupSizes({drawSize:v,groupSizeLimit:8}),b=y.map(w=>({label:w,value:w})),I=h[lf],T=y.includes(v)?4:y[0];as(I),L4(I,{options:b,value:T}),r({fields:p,inputs:h})},c=({e:p,fields:h})=>{const f=p.target.value;h[f0].style.display=f===j1?"":Mt,h[a_].style.display=f===j1?"":Mt},u=({inputs:p})=>{const h=parseInt(p[lf].value),f=p[f0].options,m=Array.from(f).map(v=>parseInt(v.value)),g=Math.max(...m);g>h?_i.generateRange(h+1,g+1).reverse().forEach(v=>{p[f0].remove(v-2)}):g<h&&_i.generateRange(g+1,h+1).forEach(v=>p[f0].add(new Option(v,v)))},d=({inputs:p,name:h})=>{const f=p[h].value,m=document.getElementById("generateDraw"),g=ta(4)(f);m.disabled=!g};return[{onInput:({inputs:p})=>d({inputs:p,name:nI}),control:nI},{onInput:({inputs:p})=>d({inputs:p,name:eE}),control:eE},{onChange:u,control:lf},{onChange:s,control:Yp},{onChange:c,control:V1},{onInput:l,control:pv},{onInput:o,control:r_}]}const{AD_HOC:pst,COMPASS:hst,CURTIS:fst,DOUBLE_ELIMINATION:mst,FEED_IN_CHAMPIONSHIP:gst,FEED_IN:vst,FIRST_MATCH_LOSER_CONSOLATION:yst,FIRST_ROUND_LOSER_CONSOLATION:bst,LUCKY_DRAW:Ist,OLYMPIC:wst,PLAY_OFF:Sst,ROUND_ROBIN:Tst,ROUND_ROBIN_WITH_PLAYOFF:Ust,SINGLE_ELIMINATION:Dst}=pa;function UDe({isPlayoff:t,isQualifying:e}={}){return[{label:"Ad-hoc",value:pst,hide:e},{label:"Compass",value:hst,hide:e},{label:"Curtis consolation",value:fst,hide:e},{label:"Double elimination",value:mst,hide:t||e},{label:"Elimination: fed consolation",value:gst,hide:e},{label:"First match loser consolation",value:yst,hide:e},{label:"First round loser consolation",value:bst,hide:e},{label:"Lucky",value:Ist,hide:t||e},{label:"Olympic",value:wst,hide:e},{label:"Playoff",value:Sst,hide:e},{label:"Round robin w/ playoff",value:Ust,hide:t||e},{label:"Round robin",value:Tst},{label:"Single elimination",value:Dst},{label:"Staggered Entry",value:vst,hide:t||e}]}const{POLICY_TYPE_SCORING:Est}=Iy,{MAIN:Cst}=pa,Pst={[Est]:{requireAllPositionsAssigned:!1,stage:{[Cst]:{stageSequence:{1:{requireAllPositionsAssigned:!0}}}},defaultMatchUpFormat:"SET3-S:6/TB7",matchUpFormats:[{categoryNames:[],categoryTypes:[],description:"Best of 3 sets with 7-point tiebreak at 6-6",matchUpFormat:"SET3-S:6/TB7"},{description:"Two tiebreak sets, 7-point match tiebreak at one set all",matchUpFormat:"SET3-S:6/TB7-F:TB7"},{description:"Two tiebreak sets, 10-point match tiebreak at one set all",matchUpFormat:"SET3-S:6/TB7-F:TB10"},{description:"One set set to 6, 7-point tiebreak at 6-6",matchUpFormat:"SET1-S:6/TB7"},{description:"Best of 3 sets to 4",matchUpFormat:"SET3-S:4/TB7"},{description:"Two out of three sets to 4 with 5-point tiebreak at 3-3",matchUpFormat:"SET3-S:4/TB5@3"},{description:"One set to 4, 7-point tiebreak at 4-4",matchUpFormat:"SET1-S:4/TB7"},{description:"One set to 4, 5-point tiebreak at 3-3",matchUpFormat:"SET1-S:4/TB5@3"},{description:"Two sets to 4, 10-point match tiebreak at one set all",matchUpFormat:"SET3-S:4/TB7-F:TB10"},{description:"Two sets to 4, 7-point match tiebreak at one set all",matchUpFormat:"SET3-S:4/TB7-F:TB7"},{description:"One set to 5, tiebreak to 9 at 4-4",matchUpFormat:"SET1-S:5/TB9@4"},{description:"One set to 6 with deciding game at 5-5",matchUpFormat:"SET1-S:6NOAD"},{description:"One set to 4, deciding game is played at 3-3",matchUpFormat:"SET1-S:4NOAD"},{description:"8 game pro-set with 7 point tiebreak at 8-8",matchUpFormat:"SET1-S:8/TB7"},{description:"8 game pro-set with 7 point tiebreak at 7-7",matchUpFormat:"SET1-S:8/TB7@7"},{description:"Best of 3 10-point tiebreak games",matchUpFormat:"SET3-S:TB10"},{description:"Timed 20 minute game - game based",matchUpFormat:"SET1-S:T20G"},{description:"Timed 20 minute game - point based",matchUpFormat:"SET1-S:T20P"},{description:"Aggregate Points - Four 10 minute quarters",matchUpFormat:"SET4-S:T10P"}]}},{ROUND_ROBIN:Rst,ROUND_ROBIN_WITH_PLAYOFF:nee,SINGLE_ELIMINATION:Mst,QUALIFYING:Nst,MAIN:ree}=pa,{DOMINANT_DUO:Ast,COLLEGE_DEFAULT:_st,LAVER_CUP:kst}=ks.tieFormatConstants,{POLICY_TYPE_SCORING:xst}=Iy,{TEAM:aee}=pl,{ENTRY_PROFILE:Ost}=ks.extensionConstants;function Lst({event:t,drawId:e,isQualifying:i,structureId:n}){var w,S,D,E,C,P;const r=i?Nst:ree,a=((w=t.drawDefinitions)==null?void 0:w.length)||0;let o=Mst;const s=e&&((S=t.drawDefinitions)==null?void 0:S.find(R=>R.drawId===e)),l=n&&((D=at.getPositionAssignments({drawId:e,structureId:n}))==null?void 0:D.positionAssignments),c=(C=(E=at.findExtension({element:s,name:Ost}))==null?void 0:E.extension)==null?void 0:C.value,u=n?1:0,d=!n&&((P=c==null?void 0:c[ree])==null?void 0:P.qualifiersCount)||u,p="Qualifying",h=(l==null?void 0:l.length)||_i.nextPowerOf2(GG(t,r)),f=[{label:"Custom",value:n_}].concat(Pst[xst].matchUpFormats.map(({matchUpFormat:R,description:N})=>({selected:R==="SET3-S:6/TB7",value:R,label:N}))),m=[{label:"Dominant Duo",value:Ast,selected:!0},{label:"College Default",value:_st},{label:"Laver Cup",value:kst},{label:"Custom",value:n_}],{validGroupSizes:g}=at.getValidGroupSizes({drawSize:32,groupSizeLimit:8}),v=g.map(R=>({label:R,value:R})),y=[{label:"Group winners",value:ZBe},{label:"Group positions",value:yhe},{label:"Top finishers",value:j1}],b=[{label:"2",value:2},{label:"3",value:3},{label:"4",value:4}],I=[{label:bc,value:bc,selected:!n,disabled:!!n},{label:o4,value:!1,selected:n}];return{items:[{error:"minimum of 4 characters",placeholder:"Display name of the structure",validator:ta(4),label:"Structure name",value:p,field:eE,selectOnFocus:!0,hide:!i},{error:"minimum of 4 characters",placeholder:"Display name of the draw",value:`Draw ${a+1}`,validator:ta(4),selectOnFocus:!0,hide:i,label:"Draw name",field:nI,focus:!0},{options:UDe({isQualifying:i}),label:"Draw Type",field:Yp,value:o},{error:"Must be in range 2-128",validator:TDe(2,128),selectOnFocus:!0,label:"Draw size",value:h,field:pv},{visible:[Rst,nee].includes(o),options:v,label:"Group size",field:lf,value:4},{visible:[nee].includes(o),options:y,label:"Playoff Type",field:V1},{label:"Advance per group",options:b,field:f0,visible:!1},{label:"2nd playoff from remaining",field:a_,id:a_,checkbox:!0,visible:!1},{help:{text:"Automation disabled",visible:!1},options:I,label:"Creation",field:bc,value:""},{hide:t.eventType===aee,options:f,field:D4,label:"Score format",value:""},{hide:t.eventType!==aee,options:m,field:"tieFormatName",label:"Scorecard",value:""},{disabled:i&&!n,validator:zp,field:r_,value:d,selectOnFocus:!0,label:"Qualifiers"}],structurePositionAssignments:l}}function oee({eventId:t,drawOptions:e,callback:i}){var o,s;const n=ln.scales[(o=ln.activeScale)==null?void 0:o.toLowerCase()],r={scaleAccessor:n==null?void 0:n.accessor,scaleName:n==null?void 0:n.scaleName},a=at.generateDrawDefinition({...e,...r,ignoreStageSpace:!0});if(a.success){const l=a.drawDefinition;Wt({methods:[{method:B9e,params:{eventId:t,drawDefinition:l,allowReplacement:!0}}],callback:d=>Nt(i)&&i({drawDefinition:l,...d})})}else a.error&&ti({message:((s=a.error)==null?void 0:s.message)||"Error",intent:"is-warning",pauseOnHover:!0})}const{POLICY_TYPE_SEEDING:Fst}=Iy,{SEPARATE:Bst}=pa,{SEEDING:$st}=PT,DDe={[Fst]:{validSeedPositions:{ignore:!0},duplicateSeedNumbers:!0,drawSizeProgression:!0,seedingProfile:Bst,policyName:$st,seedsCountThresholds:[{drawSize:4,minimumParticipantCount:3,seedsCount:2},{drawSize:16,minimumParticipantCount:12,seedsCount:4},{drawSize:32,minimumParticipantCount:24,seedsCount:8},{drawSize:64,minimumParticipantCount:48,seedsCount:16},{drawSize:128,minimumParticipantCount:96,seedsCount:32},{drawSize:256,minimumParticipantCount:192,seedsCount:64}]}},{AD_HOC:Vst,FEED_IN:jst,LUCKY_DRAW:Gst,MAIN:Hst,QUALIFYING:zst,ROUND_ROBIN:see,ROUND_ROBIN_WITH_PLAYOFF:lee}=pa,{TIME_TENNIS_PRO_CIRCUIT:qst}=ks.tieFormatConstants,{DIRECT_ENTRY_STATUSES:cee}=$u,{POLICY_TYPE_ROUND_NAMING:Wst}=Iy;function uee({drawName:t,matchUpFormat:e,isQualifying:i,structureId:n,callback:r,inputs:a,drawId:o,event:s}){var P,R,N,M,A,_,x,O,B;const l=a[Yp].options[a[Yp].selectedIndex].getAttribute("value");e=e||((P=a[D4])==null?void 0:P.value);const c=(R=a[eE])==null?void 0:R.value,u=(N=a.tieFormatName)==null?void 0:N.value,d=(M=a[nI])==null?void 0:M.value,p=a[pv].value||0,h=parseInt(a[lf].value),f=_i.isConvertableInteger(p)&&parseInt(p),m=[Gst,jst,see,lee].includes(l)&&f||_i.nextPowerOf2(f),g=s.entries.filter(({entryStage:F,entryStatus:G})=>F===zst&&cee.includes(G)),v=i&&g.length?g:s.entries.filter(({entryStage:F,entryStatus:G})=>(!F||F===Hst)&&cee.includes(G)),y=m<v.length?!1:a[bc].value===bc,b=s.eventId,I={drawEntries:v,automated:y,eventId:b,drawId:o},T=parseInt(((A=a.advancePerGroup)==null?void 0:A.value)||0),w=(_=a[a_])==null?void 0:_.checked,S=(x=a[V1])==null?void 0:x.value;let D;if(l===lee){const F=[];if(S===j1){const G=[_i.generateRange(1,T+1)];if(w){const H=_i.generateRange(T+1,h+1);H.length&&G.push(H)}G.forEach((H,$)=>{F.push({structureName:`Playoff ${$+1}`,finishingPositions:H})})}else S===yhe&&_i.generateRange(1,h+1).forEach(G=>{F.push({structureName:`Playoff ${G}`,finishingPositions:[G]})});D={groupSize:h},F.length&&(D.playoffGroups=F)}else l===see?D={groupSize:h}:l===Vst&&Object.assign(I,{roundsCount:1});const E=(O=at.getSeedsCount({participantsCount:v==null?void 0:v.length,policyDefinitions:DDe,drawSizeProgression:!0}))==null?void 0:O.seedsCount,C=zp(a[r_].value)&&parseInt((B=a[r_])==null?void 0:B.value)||0;if(n){const F=at.generateQualifyingStructure({qualifyingPositions:C,targetStructureId:n,structureOptions:D,matchUpFormat:e,structureName:c,automated:y,drawSize:m,drawType:l,drawId:o});if(F.success){const G=[{method:Z9e,params:{structure:F.structure,link:F.link,eventId:b,drawId:o}}];Wt({methods:G,callback:$=>{var q;return Nt(r)&&r({...F,...(q=$.results)==null?void 0:q[0]})}})}return}if(i?(I.drawName=t,I.qualifyingProfiles=[{structureProfiles:[{qualifyingPositions:C,structureOptions:D,matchUpFormat:e,structureName:c,seedsCount:E,drawSize:m,drawType:l}]}]):(C&&(I.qualifiersCount=C,I.qualifyingPlaceholder=!0),Object.assign(I,{seedingScaleName:b,structureOptions:D,matchUpFormat:e,seedsCount:E,drawName:d,drawSize:m,drawType:l})),f)if(u===n_)uDe({title:"Custom scorecard",onClose:G=>{G&&(I.tieFormat=G,oee({drawOptions:I,eventId:b,callback:r}))}});else{if(I.tieFormatName=u,u===qst){const F={[Wst]:{namingConventions:{round:"Day"},affixes:{roundNumber:"D"},policyName:"TTPro 4 Day"}};I.policyDefinitions={...F}}oee({drawOptions:I,eventId:b,callback:r})}else ti({message:"Invalid draw size",intent:"is-warning",pauseOnHover:!0})}function aT({eventId:t,callback:e,drawId:i,drawName:n,structureId:r,isQualifying:a}){const o=at.getEvent({eventId:t}).event;if(!o)return;const{items:s,structurePositionAssignments:l}=Lst({event:o,drawId:i,isQualifying:a,structureId:r}),c=dst({maxQualifiers:l==null?void 0:l.length,isQualifying:a,event:o});let u;const d=v=>{u=Cr(v,s,c)},p=()=>a?ta(4)(u[eE].value):ta(4)(u[nI].value),f=[{label:"Cancel",intent:Mt,close:!0},{label:"Generate",id:"generateDraw",intent:"is-primary",onClick:()=>{var v;p()?((v=u.matchUpFormat)==null?void 0:v.value)===n_?B9({callback:b=>{b&&uee({event:o,inputs:u,callback:e,structureId:r,matchUpFormat:b,drawId:i,drawName:n,isQualifying:a})}}):uee({event:o,inputs:u,callback:e,structureId:r,drawId:i,drawName:n,isQualifying:a}):ti({message:"Missing Draw name",intent:"is-danger"})},close:p}],m="Configure draw",g=(v,y)=>Cw(v,f,y);Tt.drawer.open({title:m,content:d,footer:g,side:Qt,width:"300px"})}const Z$={high:[80,100],medium:[60,80],low:[40,60]},{ratingsParameters:Kst}=Qm,dee=t=>(e,i)=>{const n=Kst[t];if(!n)return 0;const{accessor:r,ascending:a}=n,o=!a,s=pee(e),l=pee(i);if(s<l)return 1;if(l<s)return-1;const c=(e==null?void 0:e[r])||0,u=(i==null?void 0:i[r])||0;return o?c-u:u-c};function pee(t){const e=fk(t.confidence??100);return e==="high"&&100||e==="medium"&&80||e==="low"&&60||0}function fk(t){return parseInt(t)>=Z$.high[0]?"high":parseInt(t)>=Z$.medium[0]?"medium":parseInt(t)>=Z$.low[0]?"low":"unrated"}const{ratingsParameters:Yst}=Qm,hee=t=>e=>{const i=Yst[t],{accessor:n}=i,r=e.getValue(),a=(r==null?void 0:r.confidence)??100,o=r==null?void 0:r[n],s=fk(a),l=document.createElement("span"),c={medium:"darkgreen",low:"lightblue",high:"blue"};return l.style.color=c[s],l.innerHTML=o??"",l},{SINGLES:Zst}=pl,Xst=t=>e=>{const i=e.getColumn().getDefinition(),n=document.createElement("div");n.className="tags";const r=l=>t({...l,renderDraw:!0}),a=e.getValue(),o=e.getRow().getData(),{participantId:s}=o;return a==null||a.forEach(l=>{const c=Jst({def:i,participantId:s,flight:l,flightClick:r});n.appendChild(c)}),n};function Jst({flight:t,flightClick:e}){var n,r;const i=document.createElement("span");return Nt(e)&&(i.onclick=()=>e(t)),i.className="tag event-pill",(n=t.gender)!=null&&n.toLowerCase().includes("female")?i.classList.add("is-danger"):(r=t.gender)!=null&&r.toLowerCase().includes("male")?i.classList.add("is-link"):i.classList.add("is-primary"),t.eventType===Zst&&i.classList.add("is-light"),i.innerHTML=t.drawName,i}const{MAIN:Qst,QUALIFYING:X$}=pa,{DIRECT_ACCEPTANCE:fee}=$u;function EDe({participantIds:t,group:e,eventId:i,drawId:n,callback:r}){Wt({methods:[{method:PTe,params:{autoEntryPositions:!0,participantIds:t,entryStatus:e===ed&&fee||e===X$&&fee||e,entryStage:e===X$?X$:Qst,eventId:i,drawId:n}}],callback:r})}const{ALTERNATE:mee,DIRECT_ACCEPTANCE:gee,WITHDRAWN:vee,UNGROUPED:elt}=$u,{QUALIFYING:yee}=pa,tlt=(t,e,i)=>(n,r)=>{const{participant:a}=r.getRow().getData(),o=c=>()=>{const u=p=>{var h;if(p.success){const f=r.getRow(),m=c===ed?gee:c;(h=Tt.tables[m])==null||h.addRow(f.getData()),f.delete()}else console.log({result:p})},d=[a.participantId];EDe({participantIds:d,callback:u,eventId:e,drawId:i,group:c})},s=()=>{const c=at.destroyPairEntry({participantIds:[a.participantId],autoEntryPositions:!0,eventId:e,drawId:i});console.log({result:c})};let l=[{onClick:o(gee),option:"Move to accepted",action:ed},{onClick:o(yee),option:"Move to qualifying",action:yee},{onClick:o(mee),option:"Move to alternates",action:mee},{onClick:s,option:"Unpair players",action:elt},{onClick:o(vee),option:"Withdraw participant",action:vee}].filter(c=>t.includes(c.action));if(l.length){const c=n.target;pc({options:l,target:c,config:{placement:gp}})}},{WTN:J$,UTR:Q$}=ks.ratingConstants;function ilt({entries:t,exclude:e=[],eventId:i,drawId:n,actions:r=[],drawCreated:a}={}){const o=t.find(p=>{var h,f;return(f=(h=p.participant)==null?void 0:h.teams)==null?void 0:f.length}),s=t.find(p=>{var h;return(h=p.ratings)==null?void 0:h.utr}),l=t.find(p=>{var h;return(h=p.ratings)==null?void 0:h.wtn}),c=t.find(p=>p.cityState),u=t.find(p=>p.seedNumber),d=t.find(p=>p.ranking);return[{cellClick:(p,h)=>h.getRow().toggleSelect(),titleFormatter:"rowSelection",formatter:"rowSelection",visible:!a,headerSort:!1,responsive:!1,hozAlign:ci,width:5},{headerMenu:vm(),formatter:"rownum",headerSort:!1,hozAlign:ci,width:55},{formatter:"responsiveCollapse",responsive:!1,headerSort:!1,hozAlign:li,resizable:!1,width:50},{formatter:p=>Pw()(p,void 0,"sideBySide"),field:"participant",responsive:!1,resizable:!1,minWidth:200,widthGrow:1,title:"Name"},{sorterParams:{alignEmptyValues:"bottom"},visible:!!d,resizable:!1,sorter:"number",field:"ranking",title:"Rank",width:70},{formatter:hee(J$),sorter:dee(J$),visible:!!l,field:"ratings.wtn",resizable:!1,title:J$,width:70},{formatter:hee(Q$),sorter:dee(Q$),visible:!!s,field:"ratings.utr",resizable:!1,title:Q$,width:70},{sorter:(p,h)=>{var f,m,g;return(g=(f=p==null?void 0:p[0])==null?void 0:f.participantName)==null?void 0:g.localeCompare((m=h==null?void 0:h[0])==null?void 0:m.participantName)},formatter:QUe(()=>console.log("boo")),field:"participant.teams",visible:!!o,title:"Teams",responsive:!1,resizable:!1,minWidth:100},{visible:!!c,title:"City/State",field:"cityState",responsive:!1,resizable:!1,minWidth:100},{editor:PG({maxValue:(t==null?void 0:t.length)||0,field:"seedNumber"}),sorterParams:{alignEmptyValues:"bottom"},visible:!!u,field:"seedNumber",hozAlign:li,resizable:!1,sorter:"number",editable:!1,title:"Seed",maxWidth:70},{formatter:Xst(ea),title:"Flights",responsive:!0,field:"flights",minWidth:100,widthGrow:1},{responsive:!1,resizable:!1,title:"Status",field:"status",maxWidth:80},{cellClick:tlt(r,i,n),formatter:Hg,responsive:!1,headerSort:!1,hozAlign:Qt,maxWidth:40}].filter(({field:p})=>Array.isArray(e)&&!(e!=null&&e.includes(p)))}function CDe(){const t=at.getTournament().tournamentRecord.tournamentId,e=`/${Fo}/${t}/${qp}`;Tt.router.navigate(e)}function PDe(t,e){xU({classNames:["saveSeeding","cancelManualSeeding"],columns:["seedNumber"],visible:!1,table:e,e:t})}const{SEEDING:nlt}=PT;function RDe({scaleItemsWithParticipantIds:t,scaleBasis:e,eventId:i,callback:n}){Wt({methods:[{method:pKe,params:{scaleItemsWithParticipantIds:t,removePriorValues:!0,context:{scaleAttributes:{scaleType:nlt},scaleBasis:{scaleType:e},eventId:i}}}],callback:o=>{o.success&&Nt(n)&&n()}})}const{QUALIFYING:bee}=pa,{SEEDING:rlt,MANUAL:alt}=PT;function MDe({event:t,rows:e,callback:i}){const{eventId:n,eventType:r}=t,a=e.map(({entryStage:o,participantId:s,seedNumber:l})=>{const c=o===bee?`${n}${bee}`:n;return{participantId:s,scaleItems:[{scaleValue:l,scaleType:rlt,scaleName:c,eventType:r}]}});RDe({scaleItemsWithParticipantIds:a,scaleBasis:alt,eventId:n,callback:i})}function NDe({table:t}){const e=t.getRows();let i;for(const n of e){const r=n.getData();i=r.entryStage,r.seedNumber=void 0,n.update(r)}return i}function olt({event:t,table:e}){NDe({table:e});const i=e.getData();MDe({event:t,rows:i})}const{DIRECT_ACCEPTANCE:slt}=$u,{QUALIFYING:Iee}=pa,wee=t=>e=>{const i=t==null?void 0:t.eventId;return{class:"cancelManualSeeding",intent:"is-warning",location:Qt,label:"Cancel",visible:!1,onClick:r=>{var f,m;PDe(r,e);const a=NDe({table:e}),o=(f=at.getEvent({eventId:i}))==null?void 0:f.event,l=((m=o.entries)==null?void 0:m.filter(g=>g.entryStage===a&&g.entryStatus===slt)).map(({participantId:g})=>g),{participants:c}=at.getParticipants({participantFilters:{participantIds:l},withScaleValues:!0}),u=a===Iee?`${i}${Iee}`:i,d=c.map(g=>{var y,b,I;const v=(I=(b=(y=g==null?void 0:g.seedings)==null?void 0:y[o.eventType])==null?void 0:b.find(T=>T.scaleName===u))==null?void 0:I.scaleValue;if(v)return{participantId:g.participantId,seedNumber:v}}).filter(Boolean),p=Object.assign({},...d.map(g=>({[g.participantId]:g}))),h=e.getRows();for(const g of h){const v=g.getData(),y=v.participantId;p[y]&&(v.seedNumber=p[y].seedNumber,g.update(v))}}}};function llt(t,e){xU({classNames:["saveSeeding","cancelManualSeeding"],columns:["seedNumber"],visible:!0,table:e,e:t}),e.showColumn("seedNumber"),e.redraw(!0)}const{QUALIFYING:YM,MAIN:clt}=pa,{SEEDING:ult,RATING:dlt}=PT,{ratingsParameters:See}=Qm;function plt({event:t,group:e,table:i,field:n}){const{eventId:r,eventType:a}=t,{seedsCount:o,stageEntries:s}=at.getEntriesAndSeedsCount({stage:e===YM?YM:clt,policyDefinitions:DDe,eventId:r}),[l,c]=n.split("."),u=c?!See[c.toUpperCase()].ascending:!1,d=See[c.toUpperCase()].accessor,p=D=>{var E;return((E=D.ratings)==null?void 0:E[c])||{confidence:0,[d]:1/0}},h=D=>{var E;return((E=p(D))==null?void 0:E[d])||0},f=(D,E)=>(l==="ratings"&&u?h(D)-h(E):h(E)-h(D))||D-E,m=i.getData(),g={high:[],medium:[],low:[]};let v=0;for(const D of m){const E=p(D);E[d]&&(v+=1);const C=E.confidence??100;fk(C)==="high"?g.high.push(D):fk(C)==="medium"?g.medium.push(D):g.low.push(D)}const b=(Nt(f)&&[].concat(g.high.toSorted(f),g.medium.toSorted(f),g.low.toSorted(f))).slice(0,Math.min(v,o)),I=e===YM?`${r}${YM}`:r,T={scaleType:ult,scaleName:I,eventType:a},{scaleItemsWithParticipantIds:w}=at.generateSeedingScaleItems({scaleAttributes:T,scaledEntries:b,stageEntries:s,seedsCount:o,scaleName:I});RDe({scaleItemsWithParticipantIds:w,scaleBasis:dlt,eventId:r,callback:()=>{const D=Object.assign({},...b.map((C,P)=>({[C.participantId]:P+1}))),E=i.getRows();i.showColumn("seedNumber"),i.redraw(!0);for(const C of E){const P=C.getData(),R=D[P.participantId];P.seedNumber=R,C.update(P)}}})}const Tee=(t,e)=>i=>{const n={ranking:"Seed by ranking","ratings.wtn":"Seed by WTN","ratings.utr":"Seed by UTR"},r=i.getColumns().map(o=>o.getDefinition()).filter(o=>["ratings.wtn","ratings.utr"].includes(o.field)),a=[{label:"Manual seeding",onClick:o=>llt(o,i),close:!0},{label:"Clear seeding",onClick:()=>olt({event:t,table:i}),close:!0}].concat(...r.map(o=>({onClick:()=>plt({event:t,group:e,table:i,field:o.field}),label:n[o.field],value:o.field,close:!0})));return{class:"seedingOptions",label:"Seeding",selection:!1,location:Qt,align:Qt,options:a}},hlt=(t,e,i,n)=>{const a=t.getSelectedData().filter(u=>{var d;return!((d=u.events)!=null&&d.length)}).map(({participantId:u})=>u),[o,s]=e.split(".");Wt({methods:[{method:PTe,params:{ignoreAssignment:!0,participantIds:a,entryStatus:s,entryStage:o,eventId:i,drawId:n}}],callback:u=>{if(t.deselectRow(),u.success){const d=t.getRows();for(const p of d){const h=p.getData();a.includes(h.participantId)&&(h.status=vhe[s],p.update(h))}}else console.log(u.error)}})},flt=(t,e,i)=>n=>{const r=t.map(a=>({onClick:()=>hlt(n,a,e,i),label:a,value:a,close:!0}));return{location:Ua,label:"Change status",options:r}},mlt=(t,e=0)=>{const i=`${t} <span class='${ahe}'>${e}</span>`;return{location:t_,text:i}},I0=({target:t,table:e,close:i})=>{var r,a,o;if(!t)return;const n=Bl(t,ub);if(n){const s=(r=n.getElementsByClassName("toggle"))==null?void 0:r[0],l=(a=n.getElementsByClassName(hhe))==null?void 0:a[0],c=(o=n.getElementsByClassName(fhe))==null?void 0:o[0];if(s){const u=i||s.innerHTML.charCodeAt(0)===9660;l.style.display=u?Mt:wS,c.style.display=u?Mt:wS,s.parentNode.innerHTML=`<span class='toggle' style='color: white'>${u?s1e:P9}</span>`,u||e.redraw(!0)}}},glt=t=>{const e=i=>I0({target:i.target,table:t});return{headerClick:e,text:`<span class='toggle' style='color: white'>${P9}</span>`,location:t_,onClick:e}},p1=({heading:t,count:e})=>[mlt(t,e),i=>glt(i)],vlt=(t,e,i)=>(n,r="Search participants")=>{let a,o;const s=l=>{var u;const c=e&&II(n.element,"tableClass");if(c){const d=(u=mg(c,"controlBar"))==null?void 0:u[0];if(d){const p=mg(d,"search");Array.from(p).forEach(h=>h.value=l)}}a=e&&n.getSelectedData().map(d=>d[e]),n.removeFilter(o),o=d=>{var p;return((p=d.searchText)==null?void 0:p.includes(l==null?void 0:l.toLowerCase()))||(a==null?void 0:a.length)&&a.includes(d[e])},l&&n.addFilter(o)};return{onKeyDown:l=>{l.keyCode===8&&l.target.value.length===1&&s(""),(l.key==="Enter"||l.keyCode===13)&&Nt(i)&&i(n)&&s("")},onChange:l=>s(l.target.value),onKeyUp:l=>s(l.target.value),location:t||ci,class:"search",search:!0,placeholder:r}},Uee=t=>e=>({label:"Save seeding",class:"saveSeeding",intent:"is-info",location:Qt,visible:!1,onClick:n=>{PDe(n,e);const r=e.getData();MDe({event:t,rows:r})}}),{UNGROUPED:Dee}=$u,{DOUBLES:ylt}=pl,blt=(t,e)=>i=>{const n=r=>{const a=r.getSelectedData(),o=a.filter(c=>{var u;return!((u=c.events)!=null&&u.length)}).map(({participantId:c})=>c);Wt({methods:[{method:nKe,params:{removeGroupParticipant:!0,participantIds:o,eventId:t,drawId:e}}],callback:c=>{var u;if(c!=null&&c.error)r.deselectRow();else{r.deleteRow(o);const p=(u=II(r.element,"tableClass").getElementsByClassName("controlBar"))==null?void 0:u[0];p&&setTimeout(()=>y9({table:r,target:p})(),100);const h=a.flatMap(({participant:g})=>g==null?void 0:g.individualParticipantIds),{participants:f}=at.getParticipants({participantFilters:{participantIds:h}}),m=f.map(g=>oB({entry:{participantId:g.participantId,entryStatus:Dee},eventType:ylt,participant:g}));Tt.tables[Dee].updateOrAddData(m)}}})};return{onClick:()=>n(i),label:"Destroy pairs",intent:"is-danger",location:Ua}},Ilt=(t,e)=>{const n=t.getSelectedData().map(({participantId:s})=>s),r=e.entries.filter(({participantId:s})=>n.includes(s)),a=[{method:F9e,params:{eventId:e.eventId,drawName:"Flight",drawEntries:r}}];Wt({methods:a,callback:s=>{s.success?t.deselectRow():console.log(s.error)}})},wlt=(t,e)=>i=>({onClick:()=>Ilt(i,t),label:"Add flight",location:Ua,hide:e}),Slt=(t,e,i,n)=>{const a=t.getSelectedData().filter(s=>{var l;return!((l=s.events)!=null&&l.length)}).map(({participantId:s})=>s);EDe({participantIds:a,group:e,eventId:i,drawId:n,callback:s=>{if(s!=null&&s.success){const c=t.getData().filter(({participantId:u})=>a.includes(u));Tt.tables[e].updateOrAddData(c),t.deleteRow(a)}else t.deselectRow(),ti({message:s.error.message??"Error moving participants",intent:"is-danger"})}})},ZM=(t,e,i)=>n=>{const r=t.map(a=>({onClick:()=>Slt(n,a,e,i),stateChange:!0,label:a,value:a,close:!0}));return{label:"Move participants",location:Ua,options:r}},{ASSIGN_PARTICIPANT:Tlt}=KI,e2=(t,e)=>i=>({label:"Add entries",class:"addEntries",location:Qt,onClick:()=>{const{entries:r=[],eventId:a,eventType:o}=t,s=(r||[]).map(({participantId:p})=>p),l=t.eventType==="TEAM"&&"TEAM"||t.eventType==="DOUBLES"&&"PAIR"||"INDIVIDUAL",c=at.getParticipants({inContext:!0,participantFilters:{participantTypes:[l]},withISO2:!0}).participants.filter(p=>!s.includes(p.participantId));QR({title:"Select participants to add",activeOnEnter:!0,selectionLimit:99,onSelection:({selected:p})=>{if(!(p!=null&&p.length))return;const h=p.map(({participantId:y})=>y),f=e===SP?"QUALIFYING":"MAIN",m="DIRECT_ACCEPTANCE";Wt({methods:[{params:{eventId:a,participantIds:h,entryStatus:m,entryStage:f},method:r9}],callback:y=>{if(y.success){const{participants:b,derivedDrawInfo:I}=at.getParticipants({participantFilters:{participantIds:h},withIndividualParticipants:!0,withScaleValues:!0,withDraws:!0}),T=h.map(w=>oB({entry:{participantId:w,entryStage:f,entryStatus:m},derivedDrawInfo:I,participants:b,eventType:o,eventId:a}));i.addRow(T)}}})},action:{type:Tlt,participantsAvailable:c}})}}),{ALTERNATE:t2,UNGROUPED:Ult}=$u,{MAIN:Dlt}=pa,{DOUBLES:Eee}=pl,Elt=(t,e=!0)=>{const{eventId:i,eventType:n,gender:r}=t,a=(l,c)=>{const u=c.getSelectedData().map(m=>m.participantId);if(u.length!==2)return;const p=[_i.UUID()],h=[{method:H9e,params:{participantIdPairs:[u],allowDuplicateParticipantIdPairs:!0,entryStatus:t2,entryStage:Dlt,eventId:i,uuids:p}}];Wt({methods:h,callback:m=>{var g,v,y;if(m.success){c.deleteRow(u),c.clearFilter();const b=II(c.element,"tableClass");if(b){const w=(g=mg(b,"controlBar"))==null?void 0:g[0];if(w){const S=mg(w,"search");Array.from(S).forEach(D=>D.value="")}}const I=m.results[0].newParticipantIds,{participants:[T]}=at.getParticipants({participantFilters:{participantIds:I},withIndividualParticipants:!0,withISO2:!0});if(T){const w=oB({entry:{participantId:T.participantId,entryStatus:t2},eventType:Eee,participant:T});Tt.tables[t2].updateOrAddData([w]);const D=(v=II(l.target,"tableClass").getElementsByClassName("controlBar"))==null?void 0:v[0];D&&setTimeout(()=>y9({table:c,target:D})(),100)}else console.log("participant not found",{participantIds:I,methods:h,result:m})}else((y=m.error)==null?void 0:y.code)==="ERR_INVALID_PARTICIPANT_IDS"?(ti({intent:"is-danger",message:r==="MIXED"?"Genders must be mixed":"Invalid pairing"}),c.deselectRow()):console.log({methods:h,result:m})}})};return{createPairButton:{hide:n!==Eee,label:"Create pair",onClick:a,intent:"is-info",location:Ua,id:"create-pair",visible:!1},createPairFromSelected:l=>{const c=(l==null?void 0:l.length)===2;if(c&&e){const u=Tt.tables[Ult];a({target:u.element},u)}else{const u=document.getElementById("create-pair");u&&(u.style.display=c?"":Mt)}}}},{DIRECT_ACCEPTANCE:Clt}=$u,{MAIN:Plt}=pa,Rlt=(t,e,i)=>{const r=t.getSelectedData().filter(s=>{var l;return!((l=s.events)!=null&&l.length)}).map(({participantId:s})=>s);Wt({methods:[{method:$9e,params:{entryStatus:Clt,ignoreStageSpace:!0,entryStage:Plt,participantIds:r,eventId:e,drawId:i}}],callback:s=>{s.success?t.deselectRow():console.log(s.error)}})},Mlt=(t,e)=>i=>{var r;const n=(t.drawDefinitions||[]).filter(Boolean).map(({drawName:a,drawId:o})=>({onClick:()=>Rlt(i,t.eventId,o),stateChange:!0,label:a,value:o,close:!0}));return{hide:!((r=t.drawDefinitions)!=null&&r.length)||e,label:"Add to draw",location:Ua,options:n}},{DIRECT_ACCEPTANCE:Nlt,ALTERNATE:Yh,UNGROUPED:Cee,WITHDRAWN:Zh}=$u,{MAIN:l0,QUALIFYING:nv}=pa,{SINGLES:Alt,DOUBLES:Pee}=pl;function _lt({drawDefinition:t,event:e,entryData:i,hasFlights:n}){const r=v=>i.filter(({entryStage:y=l0,entryStatus:b})=>v.includes(`${y}.${b}`)),a=!!t,o=t==null?void 0:t.drawId,s=e==null?void 0:e.eventId,l={[ed]:[Yh,Zh],[nv]:[ed,Yh,Zh],[Yh]:[ed,nv,Zh],[Zh]:[Yh]},{createPairFromSelected:c}=Elt(e),u=n?[]:["flights"],d=v=>{const y=v.getData("active"),b=y.map(({participantId:I})=>I);if(y.length===1)return v.selectRow(b),!0;y.length===2&&v.selectRow(b)},p=r(hk(l0)),h=r([`${nv}.${Nlt}`]),f=r([`${l0}.${Yh}`]),m=r([`${l0}.${Cee}`]),g=r([`${l0}.${Zh}`]);return[{placeholder:"No accepted participants",items:[ZM(l[ed],s,o),flt(hk(l0),s,o),Mlt(e,o),wlt(e,o),...p1({heading:"Accepted",count:p.length}),!a&&Tee(e,ed),wee(e),Uee(e),!a&&e2(e,ed)],actions:l[ed],anchorId:c4,entries:p,group:ed,excludeColumns:u,drawCreated:a,togglePanel:I0},{placeholder:"No qualifying participants",items:[...p1({heading:"Qualifying",count:h.length}),ZM(l[nv],s,o),!a&&Tee(e,nv),wee(e),Uee(e),!a&&e2(e,nv)],actions:[ed,Yh,Zh],anchorId:d4,entries:h,group:nv,excludeColumns:u,drawCreated:a,togglePanel:I0},{items:[...p1({heading:"Alternates",count:f.length}),ZM(l[Yh],s,o),(e==null?void 0:e.eventType)===Pee&&blt(s,o),!a&&e2(e,Yh)],actions:[ed,nv,Zh],excludeColumns:["seedNumber","flights"],placeholder:"No alternates",anchorId:u4,entries:f,group:Yh,drawCreated:a,togglePanel:I0},{hide:!!([Alt].includes(e==null?void 0:e.eventType)||a),items:[...p1({heading:"Ungrouped",count:m.length}),vlt(ci,"participantId",d)],placeholder:"No ungrouped participants",excludeColumns:["seedNumber","flights"],onSelection:(e==null?void 0:e.eventType)===Pee&&c,anchorId:p4,entries:m,actions:[Zh],group:Cee,drawCreated:a,togglePanel:I0},{items:[...p1({heading:"Withdrawn",count:g.length}),!a&&ZM(l[Zh],s,o)],placeholder:"No withdrawn participants",excludeColumns:["seedNumber","flights"],anchorId:h4,entries:g,actions:[Yh],hide:a,group:Zh,collapsed:!0,drawCreated:a,togglePanel:I0}]}function Ree({eventId:t,drawId:e,headerElement:i}){var l,c,u,d,p;(!t||t==="undefined")&&Tt.router.navigate("/");let n;const r=h=>{n&&Object.values(Tt.tables).forEach(m=>m.removeFilter(n));const f=h==null?void 0:h.toLowerCase();n=m=>{var g;return(g=m.searchText)==null?void 0:g.includes(f)},h?Object.values(Tt.tables).forEach(m=>m.addFilter(n)):n=void 0},a=()=>{var T,w,S;const{event:h,drawDefinition:f}=at.getEvent({eventId:t,drawId:e});if(i&&(i.innerHTML=h==null?void 0:h.eventName),!h)return{error:"EVENT_NOT_FOUND"};const{participants:m,derivedDrawInfo:g}=at.getParticipants({participantFilters:{eventIds:[t]},withIndividualParticipants:!0,withScaleValues:!0,withDraws:!0,withISO2:!0})??{},v=((T=h==null?void 0:h.drawDefinitions)==null?void 0:T.length)>1,y=((w=h.category)==null?void 0:w.categoryName)??((S=h.category)==null?void 0:S.ageCategoryCode),b=((f==null?void 0:f.entries)||(h==null?void 0:h.entries)||[]).map(D=>oB({eventType:h.eventType,derivedDrawInfo:g,categoryName:y,participants:m,eventId:t,entry:D})),{events:I}=at.getEvents();return{tableData:_lt({event:h,drawDefinition:f,participants:m,entryData:b,hasFlights:v}),events:I,event:h}},o=h=>{for(const f of h){const{entries:m,group:g,anchorId:v,placeholder:y,excludeColumns:b,actions:I,drawCreated:T}=f,w=document.getElementById(v);if(w){w.style.display=f.hide?Mt:wS,as(w);const S=document.createElement("div");S.className=`${KBe} flexcol flexcenter`,w.appendChild(S);const D=document.createElement("div");D.className=`${fhe} flexcol flexcenter`,w.appendChild(D);const E=new Go(D,{headerSortElement:Fh(["ratings.utr","ratings.wtn","seedNumber","ranking","cityState","status","flights"]),columns:ilt({actions:I,exclude:b,entries:m,eventId:t,drawId:e,drawCreated:T}),responsiveLayout:"collapse",index:"participantId",layout:"fitColumns",reactiveData:!0,height:"400px",data:m,placeholder:y});Tt.tables[g]=E;const C=Bl(w,ub);E.on("tableBuilt",()=>{var R;const P=(R=f.items)==null?void 0:R.map(N=>Nt(N)?N(E):N);Ns({target:S,table:E,items:P,onSelection:f.onSelection}),!m.length&&f.togglePanel&&f.togglePanel({target:C,table:E,close:!0})}),E.on("dataChanged",()=>{var A,_;const N=(_=((A=II(E.element,"tableClass").getElementsByClassName("controlBar"))==null?void 0:A[0]).getElementsByClassName(ahe))==null?void 0:_[0],M=E.getData().length;f.togglePanel&&!M&&f.togglePanel({target:C,table:E,close:!0}),N&&(N.innerHTML=M||0)})}}},s=a();if(!s.error){const h="All entries",f=document.getElementById(TP),m={label:h,onClick:()=>ea({eventId:t}),close:!0},g=(s.event.drawDefinitions||[]).map(C=>({onClick:()=>ea({eventId:t,drawId:C.drawId}),label:C==null?void 0:C.drawName,close:!0})).concat([{divider:!0},m]),v={label:eg,onClick:CDe,close:!0},y=s.events.map(C=>({onClick:()=>ea({eventId:C.eventId}),label:C.eventName,close:!0})).concat([{divider:!0},v]),b=C=>{var P;C.success&&ea({eventId:t,drawId:(P=C.drawDefinition)==null?void 0:P.drawId,renderDraw:!0})},I={label:"<div style='font-weight: bold'>Add draw</div>",onClick:()=>aT({eventId:t,callback:b})},T=(l=s.event.drawDefinitions)==null?void 0:l.map(C=>({onClick:()=>ea({eventId:t,drawId:C==null?void 0:C.drawId,renderDraw:!0}),label:C==null?void 0:C.drawName,close:!0})).concat([{divider:!0},I]),w=(d=(u=(c=s.event)==null?void 0:c.drawDefinitions)==null?void 0:u.find(C=>(C==null?void 0:C.drawId)===e))==null?void 0:d.drawName,S=({eventId:C})=>{console.log("generateFlights",{eventId:C})},D=(p=wDe({eventId:t}))!=null&&p.length?"is-success":Mt,E=[{onKeyDown:C=>C.keyCode===8&&C.target.value.length===1&&r(""),onChange:C=>r(C.target.value),onKeyUp:C=>r(C.target.value),clearSearch:()=>r(""),placeholder:"Search entries",location:ci,search:!0},{label:s.event.eventName,options:y.length>1&&y,location:ci},{label:w||h,options:g,location:ci},{onClick:()=>ea({eventId:t,drawId:e,renderDraw:!0}),label:"View draw",intent:"is-info",location:Qt,hide:!e},{onClick:()=>SDe({eventId:t}),intent:D,id:"editAvoidances",label:"Avoidances",location:Qt},{onClick:()=>S({eventId:t,callback:()=>{}}),label:"Flights",location:Qt,hide:e,intent:Mt},{options:(T==null?void 0:T.length)>2&&T,hide:((T==null?void 0:T.length)||0)<3||e,intent:"is-info",location:Qt,label:"Draws",align:Qt},{onClick:()=>aT({eventId:t,callback:b}),hide:(T==null?void 0:T.length)>2||e,intent:"is-info",label:"Add draw",location:Qt}];Ns({target:f,items:E}),o(s.tableData)}}function klt({drawId:t,callback:e}){var c,u;const i=(u=(c=at.getEvent({drawId:t}))==null?void 0:c.drawDefinition)==null?void 0:u.structures;if(!(i!=null&&i.length))return;const n=i.map(({structureName:d,structureId:p})=>({text:`${d}:`,fieldPair:{error:"minimum 4 characters",validator:ta(4),placeholder:d,field:p,id:p}}));let r;const a=()=>{const d=i.map(({structureId:f})=>{var m;return((m=r[f])==null?void 0:m.value)&&{structureId:f,structureName:r[f].value.trim()}}).filter(Boolean);Wt({methods:[{params:{drawId:t,structureDetails:d},method:MTe}],callback:f=>{f.success&&(ti({message:"Structure renamed",intent:"is-success"}),Nt(e)&&e())}})},o=()=>{const d=i.map(({structureId:m})=>{var g;return(g=r[m])==null?void 0:g.value}).filter(Boolean),p=d.every(ta(4)),h=document.getElementById("renameStructures"),f=d.length&&p;h&&(h.disabled=!f)},s=i.map(({structureId:d})=>({control:d,onInput:o}));cr({title:"Edit structure names",content:d=>r=Cr(d,n,s),buttons:[{label:"Cancel",intent:Mt,close:!0},{label:"Rename",id:"renameStructures",disabled:!0,intent:"is-info",close:!0,onClick:a}]})}function xlt({drawId:t,structure:e,callback:i}){const r=Object.values(e.roundMatchUps).flat().reduce((d,p)=>{const{structureName:h,structureId:f}=p;return d[f]||(d[f]={structureName:h,structureId:f}),d},{}),a=Object.values(r).map(({structureName:d,structureId:p})=>({text:`${d}:`,fieldPair:{error:"minimum 4 characters",validator:ta(4),placeholder:d,field:p,id:p}}));let o;const s=()=>{const d=Object.values(r).map(({structureId:f})=>{var m;return((m=o[f])==null?void 0:m.value)&&{structureId:f,structureName:o[f].value.trim()}}).filter(Boolean);Wt({methods:[{params:{drawId:t,structureDetails:d},method:MTe}],callback:f=>{f.success&&(ti({message:"Groups renamed",intent:"is-success"}),Nt(i)&&i())}})},l=()=>{const d=Object.values(r).map(({structureId:m})=>{var g;return(g=o[m])==null?void 0:g.value}).filter(Boolean),p=d.every(ta(4)),h=document.getElementById("renameGroups"),f=d.length&&p;h&&(h.disabled=!f)},c=Object.values(r).map(({structureId:d})=>({control:d,onInput:l}));cr({title:"Edit group names",content:d=>o=Cr(d,a,c),buttons:[{label:"Cancel",intent:Mt,close:!0},{label:"Rename",id:"renameGroups",disabled:!0,intent:"is-info",close:!0,onClick:s}]})}const{ROUND_ROBIN:Mee,SINGLE_ELIMINATION:Olt}=pa;function Llt({callback:t,drawId:e,structureId:i,playoffFinishingPositionRanges:n}){const r=S=>`finishingPosition-${S}`,a=n.map(({finishingPosition:S,finishingPositionRange:D})=>({field:r(S),id:r(S),label:S,checkbox:!0,fieldPair:{text:`Creates playoff for positions ${D}`,width:"400px"}}));if(!a||a.length<1){ti({message:"No playoff positions available",intent:"is-danger"});return}const o={value:i_,label:"Playoff name",field:"structureName",id:"structureName"},s=UDe({isPlayoff:!0}),l={value:Olt,options:s,label:"Draw type",field:Yp,id:Yp},{validGroupSizes:c}=at.getValidGroupSizes({drawSize:4,groupSizeLimit:8}),d={options:c.map(S=>({label:S,value:S})),label:"Group size",field:lf,visible:!1,value:4},p="Positions to be played off:",h={text:`${p} None`,id:"selectedPlayoffRange"},m=[o,l,d,h,{text:"Select group finishing positions. Selections must be sequential"}].concat(a);let g;const v=()=>{const D=n.filter(({finishingPosition:M})=>{var A;return(A=g[r(M)])==null?void 0:A.checked}).map(({finishingPosition:M})=>M),E=g.structureName.value,C=g[Yp].value,P={finishingPositions:D,structureName:E,drawType:C};if(C===Mee){const M=parseInt(g[lf].value);P.structureOptions={groupSize:M}}Wt({methods:[{params:{drawId:e,structureId:i,playoffGroups:[P],playoffStructureNameBase:i_},method:DTe}],callback:M=>{var A;M.success?(ti({message:"Structure added",intent:"is-success"}),Nt(t)&&t()):(console.log({result:M}),ti({message:((A=M.error)==null?void 0:A.message)||"Error",intent:"is-danger"}))}})},y=S=>`${Math.min(...S)}-${Math.max(...S)}`,b=()=>{const S=n.filter(({finishingPosition:B})=>{var F;return(F=g[r(B)])==null?void 0:F.checked}).map(({finishingPositions:B})=>B).flat(),D=n.map(({finishingPosition:B})=>g[r(B)].checked),E=n.map(({finishingPosition:B})=>g[r(B)].checked&&B).filter(Boolean),C=E.map((B,F)=>(E[F+1]||B)-B).every(B=>B<2),P=D.filter(Boolean).length,R=document.getElementById("addStructure"),N=P&&C;R&&(R.disabled=!N);const M=document.getElementById("selectedPlayoffRange");if(M){const B=N?y(S):"None";M.innerHTML=`${p} ${B}`}const{validGroupSizes:A}=at.getValidGroupSizes({drawSize:(S==null?void 0:S.length)||4,groupSizeLimit:8}),_=A.map(B=>({label:B,value:B})),x=g[lf],O=A.includes(4)?4:A[0];as(x),L4(x,{options:_,value:O})},I=({e:S,fields:D})=>{const E=S.target.value,C=[Mee].includes(E);D[lf].style.display=C?"":Mt},T=n.map(({finishingPosition:S})=>({control:r(S),onChange:b})).concat([{onChange:I,control:Yp}]);cr({title:"Add playoff structure",content:S=>g=Cr(S,m,T),buttons:[{label:"Cancel",intent:Mt,close:!0},{label:"Add",id:"addStructure",intent:"is-info",disabled:!0,close:!0,onClick:v}]})}function Flt({drawId:t,structureId:e,callback:i}){var f,m;const n=at.getAvailablePlayoffProfiles({drawId:t,structureId:e}),r=g=>g.finishingPositions.reduce((v,y)=>(v||0)+(y||0));if(!n.playoffRoundsRanges&&((f=n.finishingPositionsAvailable)!=null&&f.length))return Llt({...n,drawId:t,structureId:e,callback:i});const a=(m=n.playoffRoundsRanges)==null?void 0:m.sort((g,v)=>r(g)-r(v)).map(({finishingPositionRange:g})=>({label:g,field:g,id:g,checkbox:!0,fieldPair:{field:`${g}-name`,placeholder:`${i_} ${g}`,id:`${g}-name`,width:"350px"}}));if(!a||a.length<1){ti({message:"No playoff positions available",intent:"is-danger"});return}const o=g=>{a.forEach(({label:v,fieldPair:y})=>{const b=document.getElementById(y.id);b&&(b.placeholder=`${g} ${v}`)})},l=[{onChange:g=>o(g.target.value),onKeyDown:g=>g.key==="Tab"&&o(g.target.value),value:i_,label:"Name base",field:"nameBase",id:"nameBase"}].concat(a);let c;const u=()=>{const g=n.playoffRoundsRanges.filter(w=>{var S;return(S=c[w.finishingPositionRange])==null?void 0:S.checked}),v=c.nameBase.value,y={},b=g.map(({roundNumber:w,finishingPositionRange:S})=>{var E;const D=(E=c[`${S}-name`])==null?void 0:E.value;return D&&(y[`0-${w}`]={name:D}),{[w]:1}});Wt({methods:[{params:{drawId:t,structureId:e,playoffAttributes:y,roundProfiles:b,playoffStructureNameBase:v},method:DTe}],callback:w=>{var S;w.success?(ti({message:"Structure(s) added",intent:"is-success"}),Nt(i)&&i()):ti({message:((S=w.error)==null?void 0:S.message)||"Error",intent:"is-danger"})}})},d=()=>{const g=n.playoffRoundsRanges.filter(y=>{var b;return(b=c[y.finishingPositionRange])==null?void 0:b.checked}),v=document.getElementById("addStructure");v&&(v.disabled=!g.length)},p=n.playoffRoundsRanges.map(({finishingPositionRange:g})=>({control:g,onChange:d}));cr({title:"Add playoff structures",content:g=>c=Cr(g,l,p),buttons:[{label:"Cancel",intent:Mt,close:!0},{label:"Add",id:"addStructure",disabled:!0,intent:"is-info",close:!0,onClick:u}]})}const{FINISHING_POSITIONS:Blt,CONTAINER:$lt}=pa;function Vlt({drawData:t,eventId:e,structureId:i,updateControlBar:n}){var u,d,p;const r=t.drawId,a=(d=(u=at.getAvailablePlayoffProfiles({drawId:r,structureId:i}))==null?void 0:u.playoffRounds)==null?void 0:d.length,o=(p=at.isValidForQualifying({drawId:r,structureId:i}))==null?void 0:p.valid,s=()=>{aT({callback:h=>{if(h.success){const f=h.structure.structureId;ea({eventId:e,drawId:r,structureId:f,renderDraw:!0})}},drawName:"Qualifying",isQualifying:!0,structureId:i,eventId:e,drawId:r})},l=t.structures.find(h=>h.structureId===i),c=(l==null?void 0:l.structureType)===$lt;return t.structures.sort((h,f)=>_i.structureSort(h,f,{mode:Blt})).map(h=>({onClick:()=>{ea({eventId:e,drawId:r,structureId:h.structureId,renderDraw:!0})},label:h.structureName,close:!0})).concat([{divider:!0},{onClick:()=>klt({drawId:r,callback:()=>n(!0)}),label:"Edit structure names",modifyLabel:!1,close:!0},{onClick:()=>xlt({drawId:r,structure:l,callback:h=>console.log(h)}),label:"Edit group names",hide:!c,modifyLabel:!1,close:!0},{onClick:()=>s(),hide:!o,label:"Add qualifying",modifyLabel:!1,close:!0},{onClick:()=>Flt({drawId:r,structureId:i,callback:()=>n(!0)}),hide:!a,label:"Add playoffs",modifyLabel:!1,close:!0}])}const oT=(t,e)=>i=>{const n=(i||"").trim().split(" ").length;return n>=t&&(!e||e&&n<=e)};function sB(t){var h;const{eventData:e,drawIds:i,callback:n}=t,r=t.eventId??e.eventInfo.eventId,a=i.length===1&&((h=e==null?void 0:e.drawsData)==null?void 0:h.find(f=>i.includes(f.drawId)).drawName),o=a?`Delete ${a}`:"Delete flights";let s;const l=()=>{const f={auditReason:s.drawDeletionReason.value},m=i.map(v=>({params:{eventId:r,drawId:v,auditData:f,force:!0},method:Q9e}));Wt({methods:m,callback:v=>n?n(v):ea({eventId:r})})},c=[{text:"Please provide a reason for draw deletion."},{placeholder:"Explanation",field:"drawDeletionReason",validator:oT(5),error:"Five word minimum",autocomplete:"on",focus:!0},{text:"This action cannot be undone!"}],d=[{control:"drawDeletionReason",onInput:({inputs:f})=>{const m=f.drawDeletionReason.value,g=oT(5)(m),v=document.getElementById("deleteDraw");v&&(v.disabled=!g)}}];cr({title:o,content:f=>s=Cr(f,c,d),buttons:[{label:"Cancel",intent:Mt,close:!0},{label:"Delete",id:"deleteDraw",disabled:!0,intent:"is-danger",close:!0,onClick:l}]})}function jlt({eventData:t,drawIds:e}){var d;const i=t.eventInfo.eventId,n=e.length===1&&((d=t==null?void 0:t.drawsData)==null?void 0:d.find(p=>e.includes(p.drawId)).drawName),r=n?`Delete ${n}`:"Delete flights";let a;const o=()=>{const p={auditReason:a.drawDeletionReason.value},h=e.map(m=>({params:{eventId:i,drawId:m,auditData:p},method:uKe}));Wt({methods:h,callback:m=>m.success&&ea({eventId:i,drawId:e[0]})})},s=[{text:"Please provide a reason for resetting draws."},{placeholder:"Explanation",field:"drawDeletionReason",validator:oT(5),error:"Five word minimum",autocomplete:"on",focus:!0},{text:"This action cannot be undone!"}],c=[{control:"drawDeletionReason",onInput:({inputs:p})=>{const h=p.drawDeletionReason.value,f=oT(5)(h),m=document.getElementById("deleteDraw");m&&(m.disabled=!f)}}];cr({title:r,content:p=>a=Cr(p,s,c),buttons:[{label:"Cancel",intent:Mt,close:!0},{label:"Delete",id:"deleteDraw",disabled:!0,intent:"is-danger",close:!0,onClick:o}]})}function Glt({structureId:t,drawId:e}){const i=at.getMatchUpFormat({drawId:e,structureId:t}).matchUpFormat;B9({callback:r=>{r&&(r===i?ti({message:"No changes",intent:"is-warning"}):Wt({methods:[{params:{matchUpFormat:r,structureId:t,drawId:e},method:dKe}],callback:s=>s.success&&ti({message:"Scoring changed"})}))},existingMatchUpFormat:i})}function Hlt({drawId:t,eventId:e,structureId:i}){const n=[{params:{drawId:t,structureId:i,force:!0},method:cKe}],r=l=>{var c;l.success?ea({eventId:e,drawId:t,renderDraw:!0}):ti({message:((c=l.error)==null?void 0:c.message)||"Error",intent:"is-danger "})};cr({title:"Remove structure",buttons:[{intent:"is-danger",onClick:()=>Wt({methods:n,callback:r}),label:"Remove",close:!0},{label:"Cancel"}],content:"<div style='font-size: 2em'>Structure will be removed!</div>"})}const{TEAM:Nee}=pl;function zlt({structureName:t,dualMatchUp:e,structureId:i,eventData:n,drawData:r,drawId:a}){var d,p;const o=(d=r.structures)==null?void 0:d.find(h=>h.stage===SP),s=(p=r.structures)==null?void 0:p.find(h=>h.structureId===i),l=n.eventInfo.eventId,c=()=>{var v;const h=e.matchUpId,f=(v=at.findMatchUp({drawId:a,matchUpId:h}))==null?void 0:v.matchUp,m=aB({matchUp:f}),g=document.getElementById(Ih);as(g),g.appendChild(m)},u=[{hide:n.eventInfo.eventType!==Nee,onClick:()=>dDe({matchUpId:e.matchUpId,structureId:i,eventId:l,drawId:a,callback:c}),label:"Edit scorecard",close:!0},{hide:n.eventInfo.eventType===Nee,onClick:()=>Glt({structureId:i,eventId:l,drawId:a}),label:`Edit ${t} scoring`,close:!0},{hide:(s==null?void 0:s.stage)==="MAIN"&&s.stageSequence===1&&!o,onClick:()=>Hlt({drawId:a,eventId:l,structureId:i}),label:"Remove structure",close:!0},{onClick:()=>sB({eventData:n,drawIds:[a]}),label:"Delete draw"},{onClick:()=>jlt({eventData:n,drawIds:[a]}),label:"Reset draw"}];if(e){const h=e.matchUpId;u.push({divider:!0});const f=b=>b.success&&c(),g={label:"Remove players",onClick:()=>{var T;((T=at.findMatchUp({matchUpId:h,drawId:a}).matchUp.tieMatchUps)==null?void 0:T.some(at.checkScoreHasValue))?ti({message:"Cannot remove when scores are present",intent:"is-warning",pauseOnHover:!0}):Wt({methods:[{params:{drawId:a,matchUpId:h,inheritance:!1},method:NTe}],callback:f})},close:!0};u.push(g);const y={label:"Clear results",onClick:()=>{Wt({methods:[{params:{drawId:a,matchUpId:h},method:ATe}],callback:f})},close:!0};u.push(y)}return u}function qlt({eventData:t}){const e=t.drawsData.map(({drawId:s,drawName:l})=>({label:l,checkbox:!0,field:s,id:s}));let i;const n=()=>{const s=t.drawsData.filter(({drawId:l})=>{var c;return(c=i[l])==null?void 0:c.checked}).map(({drawId:l})=>l);setTimeout(()=>sB({eventData:t,drawIds:s}),200)},r=()=>{const s=t.drawsData.filter(({drawId:c})=>{var u;return(u=i[c])==null?void 0:u.checked}).length,l=document.getElementById("deleteSelected");l&&(l.disabled=!s)},a=t.drawsData.map(({drawId:s})=>({onChange:r,control:s}));cr({title:"Delete flights",content:s=>i=Cr(s,e,a),buttons:[{label:"Cancel",intent:Mt,close:!0},{label:"Delete",id:"deleteSelected",intent:"is-danger",disabled:!0,close:!0,onClick:n}]})}function Wlt({eventData:t,drawId:e}){const i=()=>{const o=s=>{var l,c;if(s.drawDefinition){const u=(c=(l=s.drawDefinition.structures)==null?void 0:l[0])==null?void 0:c.structureId,d=t.eventInfo.eventId,p=s.drawDefinition.drawId;ea({eventId:d,drawId:p,structureId:u,renderDraw:!0})}};aT({eventId:t.eventInfo.eventId,callback:o})},n=()=>qlt({eventData:t}),r=t.drawsData.length>1&&{onClick:n,label:"Delete flights",modifyLabel:!1,close:!0},a=t.drawsData.length&&{onClick:()=>ea({eventId:t.eventInfo.eventId,drawId:e}),label:"View entries",modifyLabel:!1,close:!0};return t.drawsData.map(o=>({onClick:()=>{var u,d;const s=(d=(u=o.structures)==null?void 0:u[0])==null?void 0:d.structureId,l=t.eventInfo.eventId,c=o.drawId;ea({eventId:l,drawId:c,structureId:s,renderDraw:!0})},label:o.drawName,close:!0})).concat([{divider:!0},a,r,{label:"Add flight",modifyLabel:!1,onClick:i}]).filter(Boolean)}function Klt(){return{eventOptions:(at.getEvents().events??[]).map(i=>({onClick:()=>{var r,a,o,s;const n=at.getEventData({eventId:i.eventId});if(!((a=(r=n==null?void 0:n.eventData)==null?void 0:r.drawsData)!=null&&a.length))ea({eventId:i.eventId});else{const l=(s=(o=n.eventData.drawsData)==null?void 0:o[0])==null?void 0:s.drawId;ea({eventId:n.eventData.eventInfo.eventId,drawId:l,renderDraw:!0})}},label:i.eventName,close:!0})).concat([{divider:!0},{label:`<div style='font-weight: bold'>${eg}</div>`,onClick:CDe,close:!0}])}}const{TEAM:Ylt}=pl;function ADe({updateParticipantFilter:t,updateControlBar:e,structureId:i,eventData:n,matchUps:r,eventId:a,drawId:o}){var f,m,g;const{eventOptions:s}=Klt(),l=Wlt({eventData:n,drawId:o}),c=(f=n==null?void 0:n.drawsData)==null?void 0:f.find(v=>v.drawId===o),u=(g=(m=c==null?void 0:c.structures)==null?void 0:m.find(v=>v.structureId===i))==null?void 0:g.structureName,d=(r==null?void 0:r.length)===1&&n.eventInfo.eventType===Ylt,p=Vlt({updateControlBar:e,structureId:i,drawData:c,eventId:a}),h=zlt({dualMatchUp:d&&r[0],structureName:u,structureId:i,eventData:n,drawData:c,drawId:o});return[{onKeyDown:v=>v.keyCode===8&&v.target.value.length===1&&t(""),onChange:v=>t(v.target.value),onKeyUp:v=>t(v.target.value),clearSearch:()=>t(""),placeholder:"Participant name",location:ci,search:!0},{options:s.length>1?s:void 0,label:n.eventInfo.eventName,modifyLabel:!0,location:ci},{options:l.length>1?l:void 0,label:c.drawName,modifyLabel:!0,location:ci},{options:p.length>1?p:void 0,label:u,modifyLabel:!0,location:ci},{options:h,intent:"is-info",label:"Actions",location:Qt,align:Qt}]}function G9({eventId:t,drawId:e,structureId:i,updateDisplay:n}){var m,g;const r=at.getEventData({eventId:t}).eventData,a=(m=r==null?void 0:r.drawsData)==null?void 0:m.find(v=>v.drawId===e),o=(a==null?void 0:a.structures)||[];i=i||((g=o==null?void 0:o[0])==null?void 0:g.structureId);const s=o.find(v=>v.structureId===i),{roundMatchUps:l}=_i.makeDeepCopy(s||{}),c=Object.values(l||{}).flat();let u;const d=v=>{var y;return(y=v.searchText)==null?void 0:y.includes(u)},h=ADe({updateControlBar:G9,updateParticipantFilter:v=>{v||Object.values(Tt.tables).filter(Boolean).forEach(y=>y.clearFilter()),u=v==null?void 0:v.toLowerCase(),v&&Object.values(Tt.tables).filter(Boolean).forEach(y=>y.addFilter(d)),typeof n=="function"&&n({participantFilter:u})},structureId:i,eventData:r,drawData:a,matchUps:c,eventId:t,drawId:e}),f=document.getElementById(TP);Ns({target:f,items:h})}function Zlt(t){for(const e of Array.from(document.querySelectorAll(".tmx-tm")).filter(i=>i.innerHTML===t.innerHTML))e.style.fontWeight="bold",e.style.color="#ed0c76"}function Xlt(t){for(const e of Array.from(document.querySelectorAll(".tmx-tm")).filter(i=>i.innerHTML===t.innerHTML))e.style.fontWeight="",e.style.color=""}function _De({drawId:t,roundNumber:e,structure:i,structureId:n,callback:r}={}){n=n||(i==null?void 0:i.structureId);const a=at.allDrawMatchUps({matchUpFilters:{structureIds:[n]},drawId:t}).matchUps||[],o=a.reduce((f,m)=>{const g=m.roundNumber;return g&&!f.includes(g)&&f.push(g),f},[]);if(e=e||o.length&&o[o.length-1],!e)return;let s;const c=[{label:"Cancel",intent:"none",close:!0},{label:"Delete",intent:"is-danger",close:!0,onClick:()=>{const f=a.filter(v=>{if(v.roundNumber===e)return v.winningSide&&s.completed.checked||v.sides.some(({participantId:y})=>y)&&!v.winningSide&&s.unscored.checked?!0:v.sides.every(({participantId:y})=>!y)&&s.empties.checked}).map(({matchUpId:v})=>v),m=[{params:{removeCompleted:s.completed.checked,removeIncomplete:s.unscored.checked,removeUnassigned:s.empties.checked,structureId:n,matchUpIds:f,drawId:t},method:ETe}],g=v=>{v.success?Nt(r)&&r({refresh:!0}):console.log({postMutationError:v.error})};f.length&&Wt({methods:m,callback:g})}}],p=[{text:"Round number",fieldPair:{options:o.map(f=>({label:f,value:f})),field:"roundNumber",value:e,id:"roundNumber"}},{spacer:!0},{label:"Remove empty (TBD) matches",intent:"is-success",checkbox:!0,field:"empties",checked:!0,id:"empties"},{label:"Remove incomplete/unscored matches",intent:"is-danger",field:"unscored",checkbox:!0,id:"unscored"},{label:"Remove completed matches",intent:"is-danger",field:"completed",id:"completed",checkbox:!0,color:"red"}];cr({title:"Delete matches",content:f=>s=Cr(f,p),buttons:c})}function kDe({drawId:t,structure:e,structureId:i,roundNumber:n,callback:r}={}){i=i||(e==null?void 0:e.structureId);const a=at.allDrawMatchUps({matchUpFilters:{structureIds:[i]},drawId:t}).matchUps||[],o=a.reduce((v,y)=>{const b=y.roundNumber;return b&&!v.includes(b)&&v.push(b),v},[]),s=Math.max(...o,1);a.length?o.push(s+1):o.length||o.push(1);let l;const u=[{label:"Cancel",intent:"none",close:!0},{label:"Add",intent:"is-success",close:!0,onClick:()=>{var w;const v=parseInt(l.roundNumber.value),y=l.matchUpsCount.value==="Auto"?void 0:parseInt(l.matchUpsCount.value),b=at.generateAdHocMatchUps({roundNumber:v,matchUpsCount:y,structureId:i,drawId:t});if(!((w=b.matchUps)!=null&&w.length))return;const I=[{method:TTe,params:{matchUps:b.matchUps,structureId:i,drawId:t}}];Wt({methods:I,callback:S=>{S.success?Nt(r)&&r({refresh:!0}):console.log(S.error)}})}}],p={text:"Round number:",fieldPair:{options:o.map(v=>({label:v,value:v})),field:"roundNumber",value:n,id:"roundNumber"}},f={text:"Number to add:",fieldPair:{options:["Auto",1,5,10].map(v=>({label:v,value:v})),field:"matchUpsCount",id:"matchUpsCount",value:"Auto"}},m=[p,{spacer:!0},f];cr({title:"Add matches",content:v=>l=Cr(v,m),buttons:u})}const{ASSIGN_PARTICIPANT:Jlt}=KI;function H9({drawId:t,structure:e,structureId:i,callback:n}={}){i=i||(e==null?void 0:e.structureId);let r,a;const o=at.allDrawMatchUps({matchUpFilters:{structureIds:[i]},drawId:t}).matchUps||[],s=o.reduce((v,y)=>{const b=y.roundNumber;return b&&!v.includes(b)&&v.push(b),v},[]),l=s[s.length-1],c=Math.max(...s,1);o.length&&s.push(c+1);const u=({matchUps:v,roundResults:y})=>{const b=[{params:{structureId:i,matchUps:v,drawId:t},method:TTe}];if(y!=null&&y.length)for(const T of y){const w=T==null?void 0:T.modifiedScaleValues;b.push({params:{modifiedScaleValues:w,replacePriorValues:!0},method:j9e})}Wt({methods:b,callback:T=>{T.success?Nt(n)&&n({refresh:!0}):console.log(T.error)}})},d=v=>{var w;const y=a.wtn.checked&&"wtn"||a.utr.checked&&"utr"||"",{accessor:b,scaleName:I}=ln.scales[y]??{};pk(y);const T=at.drawMatic({updateParticipantRatings:!0,dynamicRatings:!0,refreshRatings:!0,participantIds:v,scaleAccessor:b,scaleName:I,drawId:t});(w=T.matchUps)!=null&&w.length&&u(T)},p=({participantIds:v})=>{const y=at.getParticipants({participantFilters:{participantIds:v}}).participants,b=l?o.filter(({roundNumber:S,sides:D})=>S===l&&(D==null?void 0:D.some(({participantId:E})=>E))).map(({sides:S})=>S.map(({participantId:D})=>D)).flat():[],I=b.length?b:v;QR({title:"Confirm player selection",selectedParticipantIds:I,activeOnEnter:!0,selectionLimit:99,onSelection:S=>{var E;const D=(E=S.selected)==null?void 0:E.map(({participantId:C})=>C);d(D)},action:{type:Jlt,participantsAvailable:y},update:r})},f=[{label:"Cancel",intent:"none",close:!0},{label:"Add round",intent:"is-success",close:!1,onClick:()=>{var v;if(a[bc].value===bc){const{drawDefinition:y}=at.getEvent({drawId:t}),b=y.entries.filter(({entryStatus:I,entryStage:T})=>!["WITHDRAWN","UNGROUPED"].includes(I)&&(!T||T===e.stage)).map(({participantId:I})=>I);p({participantIds:b})}else{yI();const y=at.generateAdHocMatchUps({newRound:!0,structureId:i,drawId:t});if(!((v=y.matchUps)!=null&&v.length))return;u(y)}}}],m=[{field:bc,value:bc,options:[{label:bc,value:bc,selected:!0},{label:o4,value:!1}]},{options:[{text:"WTN",field:"wtn",checked:ln.activeScale===tE},{text:"UTR",field:"utr",checked:ln.activeScale===rI},{text:"None",field:"none",checked:!ln.activeScale}],onClick:v=>console.log({x:v}),label:"Level of play",field:"levelOfPlay",id:"levelOfPlay",radio:!0}];r=cr({title:"Add round",content:v=>a=Cr(v,m),structure:e,buttons:f}).update}const xDe="Delete matches",ODe="Add matches",LDe="Add round";function Qlt({structure:t,drawId:e,callback:i}){if(!at.isAdHoc({structure:t}))return{};const n=()=>i({refresh:!0});return{label:"Round actions",options:[{onClick:()=>kDe({drawId:e,structure:t,callback:n}),label:ODe,color:"blue"},{onClick:()=>H9({drawId:e,structure:t,newRound:!0,callback:n}),label:LDe,color:"blue"},{label:xDe,color:"red",onClick:()=>_De({drawId:e,structure:t,callback:n})}],selection:!1,location:Qt,align:Qt}}const{CONTAINER:ect}=pa;function tct({callback:t,structure:e,existingView:i}){const n=s=>i!==s&&t({refresh:!0,view:s}),r=(e==null?void 0:e.structureType)===ect,a=at.isAdHoc({structure:e}),o=[];return o.push({active:!i||i===NV,onClick:()=>n(NV),label:a?"Columns":"Draw",close:!0}),o.push({active:i===TS,onClick:()=>n(TS),label:"Table",close:!0}),(a||r)&&o.push({active:i===SS,onClick:()=>n(SS),label:"Stats",close:!0}),{tabs:o}}const{MAIN:ict,QUALIFYING:nct,VOLUNTARY_CONSOLATION:rct}=pa;function z9({updateDisplay:t,callback:e,structure:i,drawId:n,existingView:r}){var h;const a=document.getElementById(l4),{sourceStructuresComplete:o,hasDrawFeedProfile:s}=i??{},l=!((i==null?void 0:i.stage)===ict&&(i==null?void 0:i.stageSequence)===1)&&(i==null?void 0:i.stage)!==nct&&s,c=at.isAdHoc({structure:i}),u=[];if(l){const f=()=>{const g={params:{structureId:i.sourceStructureIds[0],drawId:n},method:J9e};Wt({methods:[g],callback:y=>{y.success&&typeof t=="function"&&t()}})},m=(h=i.positionAssignments)==null?void 0:h.filter(({participantId:g})=>g).length;u.push({intent:o?"is-primary":Mt,disabled:o!==!0,visible:!m,onClick:f,label:"Auto position",location:Qt})}const d=({refresh:f,view:m})=>typeof e=="function"&&e({refresh:f,view:m});if(c){const f=Qlt({structure:i,drawId:n,callback:e});u.push(f)}(i==null?void 0:i.stage)===rct&&console.log("voluntary controlBar with [View participants]");const p=tct({structure:i,existingView:r,drawId:n,callback:d}).tabs;u.push({onClick:()=>d({refresh:!0,view:"participants"}),id:"roundDisplayTabs",location:ci,tabs:p}),u.length&&Ns({target:a,items:u})}function lB(){[l4,she,lhe].forEach(t=>{const e=document.getElementById(t);e&&as(e)})}const act=t=>t.reduce((e,i)=>e+parseFloat(i),0),Aee=t=>parseFloat((act(t)/t.length).toFixed(2));function _ee({participantResult:t,drawPosition:e,participantId:i,participantMap:n}={}){var d,p;const r=`${(t==null?void 0:t.pointsWon)||0}/${(t==null?void 0:t.pointsLost)||0}`,a=`${(t==null?void 0:t.gamesWon)||0}/${(t==null?void 0:t.gamesLost)||0}`,o=`${(t==null?void 0:t.setsWon)||0}/${(t==null?void 0:t.setsLost)||0}`,s=(t==null?void 0:t.groupOrder)||(t==null?void 0:t.provisionalOrder),l=(d=t==null?void 0:t.pressureScores)!=null&&d.length?Aee(t.pressureScores):0,c=(p=t==null?void 0:t.ratingVariation)!=null&&p.length?Aee(t.ratingVariation):0,u=n[i];return{participantName:u.participantName,groupName:u.groupName,...t,averageVariation:c,averagePressure:l,participantId:i,pointsResult:r,drawPosition:e,participant:u,gamesResult:a,setsResult:o,order:s}}function HG(t,e){return!t&&!e||t&&!e?-1:e&&!t?1:t-e}function c0(t){const e=t.getValue();return e&&`${(parseFloat(e)*100).toFixed(0)}%`}function kee(t,e){return!t&&!e||t&&!e?-1:e&&!t?1:e-t}function oct(){return[{headerMenu:vm({}),field:"drawPosition",headerSort:!1,hozAlign:ci,width:55},{formatter:"responsiveCollapse",hozAlign:li,responsive:!1,headerSort:!1,resizable:!1,width:50},{formatter:Pw(({event:t,cell:e,...i})=>console.log("cell clicked",{event:t,cell:e,undefined:void 0,params:i})),sorter:iT,field:"participantName",responsive:!1,resizable:!1,maxWidth:400,minWidth:200,widthGrow:2,title:"Name"},{headerHozAlign:li,headerWordWrap:!0,title:"Match W/L",hozAlign:li,maxWidth:80,field:"result"},{formatter:c0,headerHozAlign:li,headerWordWrap:!0,field:"matchUpsPct",title:"Match Win%",hozAlign:li,maxWidth:80},{headerHozAlign:li,headerWordWrap:!0,field:"setsResult",title:"Sets W/L",hozAlign:li,maxWidth:80},{formatter:c0,headerHozAlign:li,headerWordWrap:!0,title:"Set Win%",hozAlign:li,field:"setsPct",maxWidth:80},{headerHozAlign:li,headerWordWrap:!0,field:"gamesResult",title:"Games W/L",hozAlign:li,maxWidth:80},{formatter:c0,headerHozAlign:li,headerWordWrap:!0,title:"Game Win%",hozAlign:li,field:"gamesPct",maxWidth:80},{headerHozAlign:li,headerWordWrap:!0,field:"pointsResult",title:"Points W/L",hozAlign:li,maxWidth:80},{formatter:c0,headerHozAlign:li,headerWordWrap:!0,title:"Points Win%",field:"pointsPct",hozAlign:li,maxWidth:80},{formatter:c0,field:"averageVariation",headerHozAlign:li,sorter:kee,hozAlign:li,maxWidth:70,title:"RV"},{formatter:c0,field:"averagePressure",headerHozAlign:li,sorter:kee,hozAlign:li,maxWidth:70,title:"PS"},{headerHozAlign:li,field:"pressureOrder",sorter:HG,title:"PS#",hozAlign:li,maxWidth:80},{headerHozAlign:li,sorter:HG,hozAlign:li,title:"Order",field:"order",maxWidth:80},{field:"groupName",visible:!1,title:"Group"}]}async function FDe({eventId:t,drawId:e,structureId:i}){let n,r,a,o;const s=y=>(y??[]).reduce((b,I)=>(b[I.participantId]=I,b),{}),l={},c=()=>{var w,S;const{participants:y,eventData:b}=at.getEventData({participantsProfile:{withScaleValues:!0},allParticipantResults:!0,pressureRating:!0,refreshResults:!0,eventId:t}),I=(w=b==null?void 0:b.drawsData)==null?void 0:w.find(D=>D.drawId===e);return r=(S=I==null?void 0:I.structures)==null?void 0:S.find(D=>D.structureId===i),o||(o=s(y)),(r!=null&&r.roundMatchUps?Object.values(r.roundMatchUps).flat():[]).forEach(({sides:D,structureName:E,structureId:C})=>{l[C]=E,D.forEach(P=>{P.participantId&&(o[P.participantId].groupName=E)})}),((r==null?void 0:r.participantResults)??[]).filter(D=>{var C;const E=o[D.participantId];return!a||((C=E==null?void 0:E.participantName)==null?void 0:C.toLowerCase().includes(a==null?void 0:a.toLowerCase()))})},u=c(),d=()=>u==null?void 0:u.map(y=>_ee({...y,participantMap:o})).sort((y,b)=>HG(y.order,b.order)),p=()=>{var y;return(y=c())==null?void 0:y.map(b=>_ee({...b,participantMap:o}))},h=y=>{(y==null?void 0:y.participantFilter)!==void 0&&(a=y.participantFilter),n.replaceData(p())},f=d(),m=oct();return(y=>{gm({anchorId:Ih});const b=document.getElementById(Ih),I=Object.values(l).length>1?["groupName"]:void 0;n=new Go(b,{headerSortElement:Fh(["averageVariation","averagePressure","participantName","pressureOrder","pointsResult","gamesResult","matchUpsPct","setsResult","pointsPct","gamesPct","setsPct","result","order"]),responsiveLayoutCollapseStartOpen:!1,height:window.innerHeight*.85,groupHeader:[T=>T],placeholder:"No participants",responsiveLayout:"collapse",layout:"fitColumns",reactiveData:!0,index:"matchUpId",groupBy:I,columns:m,data:y})})(f),z9({structure:r,drawId:e,existingView:SS,callback:({refresh:y,view:b}={})=>{lB(),b?ea({eventId:t,drawId:e,structureId:i,renderDraw:!0,view:b}):jE({eventId:t,drawId:e,structureId:i,redraw:y,roundsView:b})}}),G9({eventId:t,drawId:e,structureId:i,updateDisplay:h}),{table:n,replaceTableData:h}}function sct({structure:t,drawId:e,callback:i}){const n=document.createElement("div");n.className="flexcol flexcenter",n.style.width="100%",n.style.height="300px";const r=document.createElement("button");r.onclick=o=>{o.stopPropagation(),o.preventDefault(),H9({newRound:!0,structure:t,callback:i,drawId:e})},r.className="button is-info",r.innerHTML="Generate round",n.appendChild(r);const a=document.getElementById(Ih);a&&a.appendChild(n)}function lct({drawData:t,eventId:e,drawId:i}){const n=document.createElement("div");n.className="flexcol flexcenter",n.style.width="100%",n.style.height="300px";const r=document.createElement("button");r.onclick=o=>{o.stopPropagation(),o.preventDefault();const s=t.drawName;aT({callback:l=>{var u,d,p;const c=(p=(d=(u=l.drawDefinition)==null?void 0:u.structures)==null?void 0:d.find(({stage:h})=>h===SP))==null?void 0:p.structureId;ea({eventId:e,drawId:i,structureId:c,renderDraw:!0})},isQualifying:!0,drawName:s,eventId:e,drawId:i})},r.className="button is-info",r.innerHTML="Generate qualifying",n.appendChild(r);const a=document.getElementById(Ih);a&&a.appendChild(n)}const xee={ALTERNATE:"Assign alternate",ASSIGN:"Assign participant",BYE:"Assign BYE",REMOVE_PARTICIPANT:"Remove assignment",REMOVE:"Remove assignment",QUALIFIER:"Assign qualifier",SEED_VALUE:"Assign seed",SWAP:"Swap draw positions",WITHDRAW:"Withdraw participant"};function cct({pointerEvent:t,actions:e,callback:i}){const n=t.target,r=o=>{["WITHDRAW","BYE","REMOVE","REMOVE_PARTICIPANT"].includes(o.type)&&uct({action:o,callback:i}),["ASSIGN","ALTERNATE","SWAP","QUALIFIER"].includes(o.type)&&dct({action:o,callback:i}),["SEED_VALUE"].includes(o.type)&&pct({target:n,action:o,callback:i})},a=e==null?void 0:e.filter(({type:o})=>xee[o]).map(o=>({option:xee[o.type]||o.type,onClick:()=>r(o)}));a!=null&&a.length&&pc({options:a,target:n,config:{arrow:!1,offset:[0,0]}})}function uct({action:t,callback:e}){const i=r=>r.success?e():console.log({result:r}),n=[{method:t.method,params:t.payload}];Wt({methods:n,callback:i})}function dct({action:t,callback:e}){QR({action:t,onSelection:n=>{const r=o=>o.success?e():console.log({result:o}),a=[{params:{...t.payload,...n},method:t.method}];Wt({methods:a,callback:r})},selectOnEnter:!0})}function pct({target:t,action:e,callback:i}){let n;function r(o){if((o==null?void 0:o.key)==="Enter"){const s=o.target.value;if(_i.isConvertableInteger(s)){const l=u=>u.success?i():console.log({result:u}),c=[{params:{...e.payload,seedValue:s},method:e.method}];Wt({methods:c,callback:l})}n.destroy()}}n=pc({menuItems:[{label:"Assign seed number ",validator:zp,placeholder:"Seed number",field:"seedNumber",id:"seedNumber",type:"input",focus:!0,onKeyDown:r}],target:t,config:{arrow:!1,offset:[0,0]}})}function hct(t){var a,o,s,l;const{structureId:e,drawId:i}=(t==null?void 0:t.context)??t,n=(l=(s=(o=(a=t.eventData)==null?void 0:a.drawsData)==null?void 0:o.find(c=>c.drawId===i))==null?void 0:s.structures)==null?void 0:l.find(c=>c.structureId===e),r=[];if(at.isAdHoc({structure:n})){const c=[{onClick:()=>kDe({...t}),text:ODe,color:"blue"},{onClick:()=>H9({...t,structure:n,roundNumber:void 0,newRound:!0}),text:LDe,color:"blue"},{onClick:()=>_De({...t}),text:xDe,color:"red"}];r.push(...c)}t!=null&&t.pointerEvent&&r.length&&pc({items:r,target:t.pointerEvent.target,config:{placement:gp}})}const{TEAM:fct}=Yo;function mct({callback:t,drawId:e,eventData:i}){var u;const n=(u=i==null?void 0:i.drawsData)==null?void 0:u.flatMap(({structures:d})=>d.flatMap(p=>{var h;return[(h=p.structures)==null?void 0:h.flatMap(f=>Object.values(f.roundMatchUps||{}).flat()),...Object.values(p.roundMatchUps||{}).flat()]}).filter(Boolean)),r=_i.createMap(n,"matchUpId"),a=d=>{const p=a1(d.pointerEvent.target,"tmx-m","id");return r[p]},o=d=>parseInt(a1(d.pointerEvent.target,"tmx-sd","sideNumber")),s=d=>a1(d.pointerEvent.target,"tmx-str","id"),l=d=>parseInt(a1(d.pointerEvent.target,"tmx-rd","roundNumber"));return{centerInfoClick:()=>console.log("centerInfo click"),roundHeaderClick:d=>{const p=l(d),h=s(d);return hct({pointerEvent:d.pointerEvent,roundNumber:p,structureId:h,eventData:i,callback:t,drawId:e})},scheduleClick:d=>{if(d!=null&&d.pointerEvent){d.pointerEvent.stopPropagation();const p=a1(d.pointerEvent.target,"tmx-m","id"),h=r[p];A9({pointerEvent:d.pointerEvent,matchUp:h,callback:t})}},venueClick:d=>{var h,f,m,g;const p=a(d);if(d!=null&&d.pointerEvent&&((h=p==null?void 0:p.schedule)!=null&&h.venueId)){const v=p.schedule.venueId,y=(g=(m=(f=at.findVenue({venueId:v}))==null?void 0:f.venue)==null?void 0:m.addresses)==null?void 0:g[0],{latitude:b,longitude:I}=y||{};if(!b||!I)return;const T=`https://www.google.com/maps/@?api=1&map_action=map&center=${b}%2C${I}&zoom=18&basemap=satellite`,w=`https://bing.com/maps/default.aspx?cp=${b}~${I}&lvl=17&style=h`,S=E=>{const C=E&&b&&I&&(E==="google"&&T||w);C&&window.open(C,"_blank")};pc({items:[{heading:"Venue Location"},{divider:"divider"},{onClick:()=>S("google"),hide:!b||!I,text:"Open in Google Maps"},{onClick:()=>S("bing"),hide:!b||!I,text:"Open in Bing Maps"}],target:d.pointerEvent.target,config:{placement:gp}})}},matchUpClick:d=>console.log("matchUpClick",d),scoreClick:d=>{var g;const p=o(d),h=a(d),{validActions:f}=at.matchUpActions({matchUpId:h.matchUpId,drawId:h.drawId,sideNumber:p})||{},m=f==null?void 0:f.find(({type:v})=>v==="SCORE");if(m)if(h.matchUpType===fct){const v=()=>t(),y=(g=i==null?void 0:i.eventInfo)==null?void 0:g.eventName,{matchUpId:b,drawId:I}=h;rB({title:y,drawId:I,matchUpId:b,onClose:v})}else nB({matchUpId:m.payload.matchUpId,callback:t})},participantClick:d=>{var g;const p=a(d),h=o(d),f=d.side||((g=p.sides)==null?void 0:g.find(v=>v.sideNumber===h)),{validActions:m}=p.drawId&&at.positionActions({sideNumber:h||(f==null?void 0:f.sideNumber),structureId:p==null?void 0:p.structureId,drawPosition:f==null?void 0:f.drawPosition,matchUpId:p==null?void 0:p.matchUpId,drawId:p==null?void 0:p.drawId,policyDefinitions:{positionActions:{}}})||{};cct({...d,actions:m,callback:t})}}}var Oee=11;function gct(t,e){var i=e.attributes,n,r,a,o,s;if(!(e.nodeType===Oee||t.nodeType===Oee)){for(var l=i.length-1;l>=0;l--)n=i[l],r=n.name,a=n.namespaceURI,o=n.value,a?(r=n.localName||r,s=t.getAttributeNS(a,r),s!==o&&(n.prefix==="xmlns"&&(r=n.name),t.setAttributeNS(a,r,o))):(s=t.getAttribute(r),s!==o&&t.setAttribute(r,o));for(var c=t.attributes,u=c.length-1;u>=0;u--)n=c[u],r=n.name,a=n.namespaceURI,a?(r=n.localName||r,e.hasAttributeNS(a,r)||t.removeAttributeNS(a,r)):e.hasAttribute(r)||t.removeAttribute(r)}}var XM,vct="http://www.w3.org/1999/xhtml",Eu=typeof document>"u"?void 0:document,yct=!!Eu&&"content"in Eu.createElement("template"),bct=!!Eu&&Eu.createRange&&"createContextualFragment"in Eu.createRange();function Ict(t){var e=Eu.createElement("template");return e.innerHTML=t,e.content.childNodes[0]}function wct(t){XM||(XM=Eu.createRange(),XM.selectNode(Eu.body));var e=XM.createContextualFragment(t);return e.childNodes[0]}function Sct(t){var e=Eu.createElement("body");return e.innerHTML=t,e.childNodes[0]}function Tct(t){return t=t.trim(),yct?Ict(t):bct?wct(t):Sct(t)}function JM(t,e){var i=t.nodeName,n=e.nodeName,r,a;return i===n?!0:(r=i.charCodeAt(0),a=n.charCodeAt(0),r<=90&&a>=97?i===n.toUpperCase():a<=90&&r>=97?n===i.toUpperCase():!1)}function Uct(t,e){return!e||e===vct?Eu.createElement(t):Eu.createElementNS(e,t)}function Dct(t,e){for(var i=t.firstChild;i;){var n=i.nextSibling;e.appendChild(i),i=n}return e}function i2(t,e,i){t[i]!==e[i]&&(t[i]=e[i],t[i]?t.setAttribute(i,""):t.removeAttribute(i))}var Lee={OPTION:function(t,e){var i=t.parentNode;if(i){var n=i.nodeName.toUpperCase();n==="OPTGROUP"&&(i=i.parentNode,n=i&&i.nodeName.toUpperCase()),n==="SELECT"&&!i.hasAttribute("multiple")&&(t.hasAttribute("selected")&&!e.selected&&(t.setAttribute("selected","selected"),t.removeAttribute("selected")),i.selectedIndex=-1)}i2(t,e,"selected")},INPUT:function(t,e){i2(t,e,"checked"),i2(t,e,"disabled"),t.value!==e.value&&(t.value=e.value),e.hasAttribute("value")||t.removeAttribute("value")},TEXTAREA:function(t,e){var i=e.value;t.value!==i&&(t.value=i);var n=t.firstChild;if(n){var r=n.nodeValue;if(r==i||!i&&r==t.placeholder)return;n.nodeValue=i}},SELECT:function(t,e){if(!e.hasAttribute("multiple")){for(var i=-1,n=0,r=t.firstChild,a,o;r;)if(o=r.nodeName&&r.nodeName.toUpperCase(),o==="OPTGROUP")a=r,r=a.firstChild;else{if(o==="OPTION"){if(r.hasAttribute("selected")){i=n;break}n++}r=r.nextSibling,!r&&a&&(r=a.nextSibling,a=null)}t.selectedIndex=i}}},h1=1,Fee=11,Bee=3,$ee=8;function rv(){}function Ect(t){if(t)return t.getAttribute&&t.getAttribute("id")||t.id}function Cct(t){return function(i,n,r){if(r||(r={}),typeof n=="string")if(i.nodeName==="#document"||i.nodeName==="HTML"||i.nodeName==="BODY"){var a=n;n=Eu.createElement("html"),n.innerHTML=a}else n=Tct(n);else n.nodeType===Fee&&(n=n.firstElementChild);var o=r.getNodeKey||Ect,s=r.onBeforeNodeAdded||rv,l=r.onNodeAdded||rv,c=r.onBeforeElUpdated||rv,u=r.onElUpdated||rv,d=r.onBeforeNodeDiscarded||rv,p=r.onNodeDiscarded||rv,h=r.onBeforeElChildrenUpdated||rv,f=r.skipFromChildren||rv,m=r.addChild||function(x,O){return x.appendChild(O)},g=r.childrenOnly===!0,v=Object.create(null),y=[];function b(x){y.push(x)}function I(x,O){if(x.nodeType===h1)for(var B=x.firstChild;B;){var F=void 0;O&&(F=o(B))?b(F):(p(B),B.firstChild&&I(B,O)),B=B.nextSibling}}function T(x,O,B){d(x)!==!1&&(O&&O.removeChild(x),p(x),I(x,B))}function w(x){if(x.nodeType===h1||x.nodeType===Fee)for(var O=x.firstChild;O;){var B=o(O);B&&(v[B]=O),w(O),O=O.nextSibling}}w(i);function S(x){l(x);for(var O=x.firstChild;O;){var B=O.nextSibling,F=o(O);if(F){var G=v[F];G&&JM(O,G)?(O.parentNode.replaceChild(G,O),E(G,O)):S(O)}else S(O);O=B}}function D(x,O,B){for(;O;){var F=O.nextSibling;(B=o(O))?b(B):T(O,x,!0),O=F}}function E(x,O,B){var F=o(O);F&&delete v[F],!(!B&&(c(x,O)===!1||(t(x,O),u(x),h(x,O)===!1)))&&(x.nodeName!=="TEXTAREA"?C(x,O):Lee.TEXTAREA(x,O))}function C(x,O){var B=f(x,O),F=O.firstChild,G=x.firstChild,H,$,q,z,Z;e:for(;F;){for(z=F.nextSibling,H=o(F);!B&&G;){if(q=G.nextSibling,F.isSameNode&&F.isSameNode(G)){F=z,G=q;continue e}$=o(G);var Y=G.nodeType,Q=void 0;if(Y===F.nodeType&&(Y===h1?(H?H!==$&&((Z=v[H])?q===Z?Q=!1:(x.insertBefore(Z,G),$?b($):T(G,x,!0),G=Z,$=o(G)):Q=!1):$&&(Q=!1),Q=Q!==!1&&JM(G,F),Q&&E(G,F)):(Y===Bee||Y==$ee)&&(Q=!0,G.nodeValue!==F.nodeValue&&(G.nodeValue=F.nodeValue))),Q){F=z,G=q;continue e}$?b($):T(G,x,!0),G=q}if(H&&(Z=v[H])&&JM(Z,F))B||m(x,Z),E(Z,F);else{var X=s(F);X!==!1&&(X&&(F=X),F.actualize&&(F=F.actualize(x.ownerDocument||Eu)),m(x,F),S(F))}F=z,G=q}D(x,G,$);var oe=Lee[x.nodeName];oe&&oe(x,O)}var P=i,R=P.nodeType,N=n.nodeType;if(!g){if(R===h1)N===h1?JM(i,n)||(p(i),P=Dct(i,Uct(n.nodeName,n.namespaceURI))):P=n;else if(R===Bee||R===$ee){if(N===R)return P.nodeValue!==n.nodeValue&&(P.nodeValue=n.nodeValue),P;P=n}}if(P===n)p(i);else{if(n.isSameNode&&n.isSameNode(P))return;if(E(P,n,g),y)for(var M=0,A=y.length;M<A;M++){var _=v[y[M]];_&&T(_,_.parentNode,!1)}}return!g&&P!==i&&i.parentNode&&(P.actualize&&(P=P.actualize(i.ownerDocument||Eu)),i.parentNode.replaceChild(P,i)),P}}var Pct=Cct(gct);const{DOUBLES:Rct,TEAM:Vee}=pl;function jE({eventId:t,drawId:e,structureId:i,roundsView:n,redraw:r}){var R,N,M,A,_,x;const a=at.getEvents().events;if(!(a!=null&&a.length))return;let o;MG.register("tmx-tm","mouseover",Zlt),MG.register("tmx-tm","mouseout",Xlt);let s,l,c,u,d,p,h,f,m;const g=()=>{var O,B,F,G;u=(O=at.getEventData({participantsProfile:{convertExtensions:!0,withScaleValues:!0,withGroupings:!0,withISO2:!0,withIOC:!0},includePositionAssignments:!0,eventId:t}))==null?void 0:O.eventData,d=(B=u==null?void 0:u.eventInfo)==null?void 0:B.eventType,h=(F=u==null?void 0:u.drawsData)==null?void 0:F.find(H=>H.drawId===e),c=(h==null?void 0:h.structures)||[],i=i||((G=c==null?void 0:c[0])==null?void 0:G.structureId),p=c.find(H=>H.structureId===i),o=at.isAdHoc({structure:p}),{roundMatchUps:l,stage:m}=_i.makeDeepCopy(p||{}),f=Object.values(l||{}).flat(),o&&f.sort(_i.matchUpScheduleSort)};WF(),g();const v=({refresh:O,view:B}={})=>{const F=O||s;lB(),B?ea({eventId:t,drawId:e,structureId:i,renderDraw:!0,view:B}):jE({eventId:t,drawId:e,structureId:i,redraw:F,roundsView:B})},y=(f==null?void 0:f.length)===1&&u.eventInfo.eventType===Vee,b=mct({eventData:u,callback:v,drawId:e}),I=(N=(R=u.eventInfo)==null?void 0:R.display)==null?void 0:N.compositionName,T=(A=(M=u.eventInfo)==null?void 0:M.display)==null?void 0:A.configuration,w=Y_[I]||ln.composition||Y_[d===Rct&&"National"||d===Vee&&"Basic"||"National"];w.configuration.flags=!1,Object.assign(w.configuration,T),w.configuration.scaleAttributes&&(w.configuration.scaleAttributes=ln.scales[ln.activeScale]),ln.composition||(w.configuration.genderColor=!0,w.configuration.showAddress=void 0,w.configuration.allDrawPositions=!0,w.configuration.drawPositions=!0),w.configuration.roundHeader=!0;const S=document.getElementById(Ih);r&&as(S);const D=()=>{var O,B;if(!y){for(const F of Object.keys((p==null?void 0:p.roundMatchUps)??{}))p.roundMatchUps[F]=(O=l==null?void 0:l[F])==null?void 0:O.filter(({sides:G})=>(G==null?void 0:G.some(({participant:$})=>$==null?void 0:$.participantName.toLowerCase().includes(s)))||!s);if(f.length)if(n===TS)BDe({matchUps:f,eventData:u});else if(n===SS)FDe({eventId:t,drawId:e,structureId:i});else{const F=D9e({content:U9e({context:{drawId:e,structureId:i},searchActive:s,matchUps:f,eventHandlers:b,composition:w,structure:p}),theme:w.theme}),G=$=>{var q;return(q=$==null?void 0:$.classList)!=null&&q.contains("tmx-p")?$:Bl($,"tmx-p")},H=S.firstChild;H?Pct(H,F,{addChild:function($,q){var z,Z,Y,Q,X,oe,re;if(q.classList){const me=$.firstChild,se=q.getAttribute("id"),te=![null,"undefined",void 0].includes(se),he=(Z=(z=$.firstChild)==null?void 0:z.getAttribute)==null?void 0:Z.call(z,"id"),ae=![null,"undefined",void 0].includes(he);try{if(!te&&!ae){ln.renderLog&&console.log("condition 0");const de=(Y=G(me))==null?void 0:Y.nextSibling;de!=null&&de.getAttribute("id")&&((Q=G(me))!=null&&Q.getAttribute("id"))&&de.parentElement.removeChild(de)}else te&&ae&&se&&he&&se!==he?(ln.renderLog&&console.log("condition 1"),$.removeChild($.firstChild)):(X=q.classList)!=null&&X.contains("tmx-p")&&!ae?(ln.renderLog&&console.log("condition 2"),$.removeChild($.firstChild)):(re=(oe=$.firstChild)==null?void 0:oe.classList)!=null&&re.contains("tmx-p")&&$.firstChild.getAttribute("id")!=="undefined"&&q.getAttribute("id")==="undefined"?(ln.renderLog&&console.log("condition 3"),$.removeChild($.firstChild)):!te&&ae?ln.renderLog&&console.log("condition 4"):console.log({incomingId:te,existingId:ae,incomingIdValue:se,existingIdValue:he})}catch(de){console.log({err:de})}}$.appendChild(q)}}):S.appendChild(F)}else if(m===SP)lct({drawData:h,drawId:e,eventId:t});else if(o)sct({structure:p,drawId:e,callback:v});else{const F=(B=c==null?void 0:c[0])==null?void 0:B.structureId;return jE({eventId:t,drawId:e,structureId:F,redraw:!0})}}};z9({updateDisplay:()=>{g(),D()},drawId:e,structure:p,existingView:n,callback:v});const C=document.getElementById(TP),P=O=>{O&&g();const B=H=>{var $;return($=H.searchText)==null?void 0:$.includes(s)},G=ADe({updateParticipantFilter:H=>{H||Object.values(Tt.tables).filter(Boolean).forEach($=>$.clearFilter()),s=H==null?void 0:H.toLowerCase(),H&&Object.values(Tt.tables).filter(Boolean).forEach($=>$.addFilter(B)),as(S),D()},updateControlBar:P,structureId:i,eventData:u,drawData:h,matchUps:f,eventId:t,drawId:e});Ns({target:C,items:G})};if(!h){console.log("no draw data",{eventData:u,drawData:h});return}if(i=i||((x=(_=h.structures)==null?void 0:_[0])==null?void 0:x.structureId),!i){console.log("structure not found");return}if(y){const O=aB({matchUp:f[0],participantFilter:s});O&&S.appendChild(O)}else D();P()}function Mct(t,e,i,n){const r=e>1?"items":"item";return t+`<span style='color:blue; margin-left:10px;'>(${e} ${r})</span>`}const{TEAM:Nct}=Yo,Act=t=>(e,i)=>{const r=i.getRow().getData(),{matchUpId:a,readyToScore:o,matchUpType:s,drawId:l,eventName:c}=r.matchUp;s===Nct?rB({title:c,matchUpId:a,drawId:l,onClose:()=>t()}):(o||Mv.checkScoreHasValue(r.matchUp))&&nB({matchUpId:a,callback:()=>{t()}})};function _ct({data:t,replaceTableData:e}){const i=(s,l)=>{var h,f;const u=l.getRow().getData(),{courtName:d,scheduledDate:p}=u;if(d&&p){const m=(f=(h=at.getTournament())==null?void 0:h.tournamentRecord)==null?void 0:f.tournamentId,g=`/${Fo}/${m}/${Qv}/${p}`;Tt.router.navigate(g)}},n=()=>e(),r=t.some(s=>s.courtName),a=(s,l)=>kE(s,l,n),o=s=>{const l=document.createElement("div");l.className="has-text-warning-dark",l.innerHTML="Select participant";const c=({event:d,...p})=>{kE(d,s,n,p)};return s.getValue().participantName&&Pw(c)(s,l)};return[{cellClick:(s,l)=>l.getRow().toggleSelect(),titleFormatter:"rowSelection",formatter:"rowSelection",headerSort:!1,responsive:!1,hozAlign:ci,width:5},{formatter:"responsiveCollapse",headerSort:!1,resizable:!1,hozAlign:li,minWidth:50,width:50},{headerMenu:vm({duration:"Duration",complete:"Complete"}),formatter:"rownum",headerSort:!1,hozAlign:ci,width:55},{title:"Flight",visible:!1,minWidth:150,field:"flight",widthGrow:1},{cellClick:i,field:"scheduledDate",title:"Date",width:110},{cellClick:i,visible:!!r,field:"courtName",title:"Court",width:100},{cellClick:i,field:"scheduleTime",headerSort:!1,visible:!1,title:"Time",width:70},{formatter:o,cellClick:a,sorter:iT,responsive:!1,title:"Side 1",minWidth:180,field:"side1",widthGrow:1},{formatter:o,cellClick:a,sorter:iT,responsive:!1,title:"Side 2",minWidth:180,field:"side2",widthGrow:1},{cellClick:Act(e),formatter:N9,sorter:fDe,field:"scoreDetail",responsive:!1,title:"Score",width:140},{sorter:y1e,formatter:b1e,field:"competitiveProfile",responsive:!1,title:"Profile",visible:!1,width:140},{title:"<div class='fa-solid fa-check' style='color: green' />",formatter:"tickCross",field:"complete",hozAlign:ci,tooltip:!1,width:40},{field:"matchUp.matchUpStatus",title:"Status",width:150},{title:"<div class='fa-solid fa-clock' style='color: blue' />",headerSort:!1,field:"duration",visible:!1,width:70},{cellClick:(s,l)=>A9({pointerEvent:s,...l.getData()}),formatter:Hg,responsive:!1,headerSort:!1,hozAlign:Qt,widthGrow:0,width:50}]}const{TEAM:kct}=pl,jee=t=>{var A,_,x,O,B;const{potentialParticipants:e,structureName:i,matchUpType:n,roundNumber:r,matchUpId:a,roundName:o,schedule:s,eventId:l,drawId:c,sides:u,...d}=t,{scheduledDate:p,scheduleTime:h,courtName:f}=s||{},m=F=>{var G;return((G=F.person)==null?void 0:G.standardFamilyName)||F.participantName},g=(e==null?void 0:e.map(F=>({participantName:F.map(m).filter(Boolean).join(" or ")})))||[],v=((A=u==null?void 0:u[0])==null?void 0:A.participant)||g.shift(),y=((_=u==null?void 0:u[1])==null?void 0:_.participant)||g.shift(),b={participantName:v==null?void 0:v.participantName,sex:(x=v==null?void 0:v.person)==null?void 0:x.sex,participant:v},I={participantName:y==null?void 0:y.participantName,sex:(O=y==null?void 0:y.person)==null?void 0:O.sex,participant:y},T=u.flatMap(({participant:F})=>{var G;return(G=F==null?void 0:F.individualParticipantIds)!=null&&G.length?F.individualParticipantIds:F==null?void 0:F.participantId}).filter(Boolean),w=d.winningSide===1&&"side1"||d.winningSide===2&&"side2"||void 0,S=!!d.winningSide,D=!!(d.winningSide||d.readyToScore),E=(B=d.score)==null?void 0:B.scoreStringSide1,C=u.flatMap(F=>{var H,$,q;const G=(H=F.participant)==null?void 0:H.person;return G?[G.standardGivenName,G.standardFamilyName]:(q=($=F.participant)==null?void 0:$.individualParticipants)==null?void 0:q.map(({person:z})=>[z.standardGivenName,z.standardFamilyName])}).filter(Boolean).join(" ").toLowerCase(),P=GUe([C,v==null?void 0:v.participantName,y==null?void 0:y.participantName].filter(Boolean).join(" ")).toLowerCase(),R=t.collectionId?kct:n,N=t.competitiveness?{competitiveness:t.competitiveness}:t.competitiveProfile,M={score:E,matchUpStatus:t.matchUpStatus,readyToScore:D,complete:S,winningSide:w};return{matchUpStatus:t.matchUpStatus,individualParticipantIds:T,flight:t.drawName,competitiveProfile:N,structureName:i,scheduledDate:p,readyToScore:D,scheduleTime:h,matchUpType:n,scoreDetail:M,winningSide:w,roundNumber:r,searchText:P,courtName:f,eventType:R,matchUpId:a,roundName:o,complete:S,eventId:l,matchUp:t,drawId:c,side1:b,side2:I,score:E}},{CONTAINER:xct}=pa;async function BDe({eventId:t,drawId:e,structureId:i,matchUps:n,eventData:r}){let a,o,s,l;const c=()=>{var I,T;const y=at.getEventData({eventId:t}).eventData,b=(I=y==null?void 0:y.drawsData)==null?void 0:I.find(w=>w.drawId===e);return o=(T=b==null?void 0:b.structures)==null?void 0:T.find(w=>w.structureId===i),l=(o==null?void 0:o.structureType)===xct,(at.allTournamentMatchUps({matchUpFilters:{drawIds:[e],structureIds:[i]},participantsProfile:{withISO2:!0,withScaleValues:!0},contextProfile:{withCompetitiveness:!0}}).matchUps||[]).filter(({matchUpStatus:w})=>w!=="BYE").filter(({sides:w})=>!s||w.find(S=>{var D,E;return(E=(D=S.participant)==null?void 0:D.participantName)==null?void 0:E.toLowerCase().includes(s==null?void 0:s.toLowerCase())}))};n||(n=await c()),r&&n.forEach(y=>y.eventName=r.eventInfo.eventName);const u=()=>n.map(jee),d=()=>c().map(jee),p=y=>{y!=null&&y.participantFilter&&(s=y.participantFilter),a.replaceData(d())},h=u(),f=_ct({data:h,replaceTableData:p}),m=l?["roundName","structureName"]:["roundName"];return(y=>{gm({anchorId:Ih});const b=document.getElementById(Ih);a=new Go(b,{groupHeader:[Mct,I=>I],headerSortElement:Fh(["complete","duration","score"]),responsiveLayoutCollapseStartOpen:!1,height:window.innerHeight*.85,responsiveLayout:"collapse",placeholder:"No matches",layout:"fitColumns",reactiveData:!0,index:"matchUpId",groupBy:m,columns:f,data:y})})(h),z9({structure:o,drawId:e,existingView:TS,callback:({refresh:y,view:b}={})=>{lB(),b?ea({eventId:t,drawId:e,structureId:i,renderDraw:!0,view:b}):jE({eventId:t,drawId:e,structureId:i,redraw:y,roundsView:b})}}),G9({eventId:t,drawId:e,structureId:i,updateDisplay:p}),{table:a,replaceTableData:p}}function QM({eventId:t,renderDraw:e}={}){const i=document.getElementById(che),n=document.getElementById(ohe),r=document.getElementById(Ih),a=document.getElementById(uhe);a&&(a.style.display=t||e?"":Mt),i&&(i.style.display=t&&!e?"":Mt),n&&(n.style.display=t||e?Mt:""),r&&(r.style.display=e?"":Mt)}function Oct({eventId:t,drawId:e,headerElement:i}){const{event:n,drawDefinition:r}=at.getEvent({eventId:t,drawId:e});return n&&r?(i.innerHTML=n.eventName,{success:!0}):{}}const $De=t=>({drawDefinition:e,scaleValues:i})=>{var h,f,m,g,v,y,b;const{drawId:n,drawName:r,drawType:a,entries:o,matchUpFormat:s,tieFormat:l}=e,c=at.getPublishState({drawId:n}).publishState,u=(h=c==null?void 0:c.status)==null?void 0:h.published,d=(f=o==null?void 0:o.filter(({entryStatus:I})=>I!=="WITHDRAWN"))==null?void 0:f.length,p=(m=at.getAssignedParticipantIds({drawDefinition:e}).assignedParticipantIds)==null?void 0:m.filter(Boolean);return{entries:(p==null?void 0:p.length)??d??0,matchUpFormat:s,tieFormat:l,utrAvg:(v=(g=i==null?void 0:i.ratingsStats)==null?void 0:g.UTR)==null?void 0:v.avg,wtnAvg:(b=(y=i==null?void 0:i.ratingsStats)==null?void 0:y.WTN)==null?void 0:b.avg,published:u,drawName:r,drawType:a,eventId:t,drawId:n}},{MAIN:Gee}=pa;function VDe({event:t,scaleValues:e}){var m,g,v;const{drawDefinitions:i=[],eventName:n,entries:r,eventId:a}=t,o=at.allEventMatchUps({inContext:!0,eventId:a}).matchUps,s=_O.getPublishState({event:t}).publishState,l=i.length,c=((m=r.filter(({entryStage:y=Gee,entryStatus:b})=>hk(Gee).includes(`${y}.${b}`)))==null?void 0:m.length)||0,u=(o==null?void 0:o.length)||0,d=((g=o==null?void 0:o.filter(({winningSide:y,schedule:b})=>!y&&(b==null?void 0:b.scheduledTime)))==null?void 0:g.length)||0,p=((v=o.filter(({winningSide:y})=>y))==null?void 0:v.length)||0,h=i.map(y=>{var b;return $De(a)({drawDefinition:y,scaleValues:(b=e==null?void 0:e.draws)==null?void 0:b[y.drawId]})}),f=[n].concat(i.map(({drawName:y})=>y||"")).join(" ").toLowerCase();return{published:s==null?void 0:s.status.published,scheduledMatchUpsCount:d,completedMatchUpsCount:p,matchUpsCount:u,entriesCount:c,drawsCount:l,searchText:f,drawDefs:h,eventId:a,event:t}}function jDe({eventRow:t,drawsTable:e,drawIds:i}){e.deleteRow(i);const n=t==null?void 0:t.getData();if(n){const r=at.allEventMatchUps({eventId:n.eventId,inContext:!1}).matchUps;n.drawDefs=n.drawDefs.filter(a=>!i.includes(a.drawId)),n.matchUpsCount=(r==null?void 0:r.length)||0,n.drawsCount-=i.length}}const GDe=t=>(e,i)=>{const n=i.getRow().getData(),r=n.published?[n.drawId]:void 0,a=n.published?void 0:[n.drawId],s=[{method:RTe,params:{eventId:n.eventId,drawIdsToAdd:a,drawIdsToRemove:r,eventDataParams:{participantsProfile:{withScaleValues:!0},pressureRating:!0,refreshResults:!0}}}];Wt({methods:s,callback:c=>{var u;if(c!=null&&c.success){i.getRow().update({published:!n.published});const d=t.getData().eventId,p=at.getPublishState({eventId:d}).publishState,h=(u=p==null?void 0:p.status)==null?void 0:u.published;t.update({published:h})}else ti({message:c.error.message,intent:"is-danger"})}})},HDe=t=>t.getValue()?'<i class="fa-solid fa-eye" style="color: blue">':'<i class="fa-solid fa-eye-slash" style="color: red">';function zDe(t){var M,A;const{eventId:e,drawId:i,callback:n}=t,r=(M=at.findExtension({name:Pv.DISPLAY,discover:!0,eventId:e,drawId:i}).extension)==null?void 0:M.value,a=(r==null?void 0:r.admin)??r,o=["Wimbledon","French","ITF"],s="saveDisplaySettings",l={compositionName:(a==null?void 0:a.compositionName)??((A=ln.composition)==null?void 0:A.compositionName)??"Australian",configuration:(a==null?void 0:a.configuration)??{},composition:void 0,inputs:void 0},c=_i.dateTime.extractDate(new Date().toISOString()),u="drawId",p=[{onlineResources:[{link:"https://www.google.com",label:"Google"}],venueName:"Club Courts",venueAbbreviation:"CC",startTime:"08:00",endTime:"20:00",courtsCount:6,venueId:"venueId"}],h=[{eventName:"WTN 14-19 SINGLES",category:{ratingType:"WTN",ratingMin:14,ratingMax:19.99},drawId:u,generate:!0,drawSize:4}],f=[{scheduleDate:c,venues:[{rounds:[{drawId:u,winnerFinishingPositionRange:"1-2"}],venueId:p[0].venueId}]}],m={withScaleValues:!0},g=IP.generateTournamentRecord({scheduleCompletedMatchUps:!0,completeAllMatchUps:!0,participantsProfile:m,autoSchedule:!0,schedulingProfile:f,venueProfiles:p,drawProfiles:h,startDate:c}).tournamentRecord,y=iP.allTournamentMatchUps({tournamentRecord:g}).matchUps.find(_=>_.matchUpType==="SINGLES"),b=document.createElement("div");b.style.maxWidth="500px";const I=document.createElement("div");b.appendChild(I);const T=({compositionName:_,configuration:x})=>{as(I),l.composition=Y_[_],l.composition.configuration.flags=void 0,Object.assign(l.composition.configuration,x),l.composition.genderColor=!0,l.composition.compositionName=_;const O=vTe({isLucky:!0,composition:l.composition,matchUp:y});I.appendChild(O)};T(l);const w=Object.keys(Y_).filter(_=>_!=="Night").map(_=>({selected:_===l.compositionName,label:_,value:_})),S=l.configuration.participantDetail,D=[{label:"None",value:"NONE",selected:!S},{label:"Address",value:"ADDRESS",selected:S==="ADDRESS"},{label:"Team",value:"TEAM",selected:S==="TEAM"}],E=()=>{l.compositionName=l.inputs.composition.value,l.configuration.scheduleInfo=!o.includes(l.compositionName)&&l.inputs.showSchedule.checked,l.configuration.participantDetail=l.inputs.detail.value,T(l)},C=[{options:w,label:"Composition",field:"composition",onChange:E},{controlVisible:!o.includes(l.compositionName),checked:l.configuration.scheduleInfo,controlId:"scheduleToggle",label:"Show Schedule",field:"showSchedule",id:"showSchedule",checkbox:!0,onChange:E},{options:D,label:"Detail",field:"detail",onChange:E}],P=document.createElement("div");b.appendChild(P);const R=[{onChange:({e:_})=>{const x=!o.includes(_.target.value),O=document.getElementById("scheduleToggle");O.style.display=x?"block":Mt},control:"composition"}];l.inputs=Cr(P,C,R),cr({title:"Edit display settings",buttons:[{label:"Cancel",intent:Mt,close:!0},{label:"Save",id:s,intent:"is-info",close:!0,onClick:()=>{var G,H;const _=()=>{},O={value:{...(H=(G=at.findExtension({name:Pv.DISPLAY,discover:!0,eventId:e,drawId:i}))==null?void 0:G.extension)==null?void 0:H.value,compositionName:l.composition.compositionName,configuration:l.configuration},name:Pv.DISPLAY};Wt({methods:[{method:i?V9e:z9e,params:{eventId:e,drawId:i,extension:O}}],callback:_}),Nt(n)&&n(l.composition),ln.composition=l.composition}}],content:b})}const Lct=t=>(e,i)=>{const n=Array.from(document.querySelectorAll(".tippy-content"));if(n.length){n.forEach(h=>h.remove());return}const r=e.target.getElementsByClassName("fa-ellipsis-vertical")[0],a=i.getRow(),o=a==null?void 0:a.getData(),{published:s,drawId:l,eventId:c}=o;pc({items:[{onClick:()=>zDe({drawId:o.drawId}),text:"Display settings"},{text:s?"Unpublish":"Publish",onClick:()=>{GDe(t)(e,i)}},{onClick:()=>{sB({eventId:c,drawIds:[l],callback:f=>{var m;f.success||(m=f.error)!=null&&m.message&&ti({message:f.error.message,intent:"is-danger"}),jDe({eventRow:t,drawsTable:i.getTable(),drawIds:[l]})}})},text:"Delete"},{text:"Edit"}],target:r||e.target,config:{placement:gp}})};function Fct(t,e){const i=(a,o)=>{const{eventId:s,drawId:l}=o.getRow().getData();ea({eventId:s,drawId:l,renderDraw:!0})},n=t.find(a=>a.utrAvg),r=t.find(a=>a.wtnAvg);return[{cellClick:(a,o)=>o.getRow().toggleSelect(),titleFormatter:"rowSelection",formatter:"rowSelection",headerSort:!1,responsive:!1,hozAlign:ci,width:5},{headerMenu:vm({entries:"Entries",wtnAvg:"WTN avg",utrAvg:"UTR avg"}),headerSort:!1,formatter:"rownum",hozAlign:li,width:55},{title:'<i class="fa-solid fa-eye"></i>',cellClick:GDe(e),formatter:HDe,headerSort:!1,field:"published",width:55},{title:"Draw Name",field:nI,cellClick:i},{title:"Draw Type",field:Yp,cellClick:i},{title:'<div class="event_icon opponents_header" />',field:"entries",width:50},{visible:!!r,field:"wtnAvg",title:tE,width:80},{visible:!!n,field:"utrAvg",title:rI,width:80},{cellClick:Lct(e),formatter:Hg,responsive:!1,headerSort:!1,hozAlign:Qt}]}const Bct=t=>e=>{const i=document.createElement("div"),n=document.createElement("div");n.className="tableControl",n.style.marginBottom="1em";const r=e.getData().drawDefs;i.appendChild(n);const a=document.createElement("div");a.style.backgroundColor="white";const o="1px solid #333";a.style.border=o,a.style.width="99%",i.style.borderBotom=o,i.style.boxSizing="border-box",i.style.borderTop=o,i.style.paddingLeft="10px",i.className=$O,i.style.display=Mt,i.appendChild(a),e.getElement().appendChild(i);const s=Fct(r,e),l=new Go(a,{headerSortElement:Fh(["entries"]),placeholder:"No draws",layout:"fitColumns",index:"drawId",maxHeight:400,columns:s,data:r});l.on("scrollVertical",ld);const c=e.getData().event,u=c.eventId;t(u,l);const d=()=>{const g=l.getSelectedData().map(({drawId:y})=>y);l.deselectRow(),sB({eventId:u,drawIds:g,callback:y=>{var b;if(!y.success){(b=y.error)!=null&&b.message&&ti({message:y.error.message,intent:"is-danger"});return}jDe({eventRow:e,drawsTable:l,drawIds:g})}})},p=m=>{var g;if(m.success){l==null||l.addRow($De(u)({drawDefinition:m.drawDefinition}));const v=e==null?void 0:e.getData();if(a.style.display="",v)if(!v.matchUpsCount)ea({eventId:u,drawId:(g=m.drawDefinition)==null?void 0:g.drawId,renderDraw:!0});else{const y=at.allDrawMatchUps({drawId:m.drawDefinition.drawId,inContext:!1,eventId:u}).matchUps;v.matchUpsCount+=(y==null?void 0:y.length)||0,v.drawsCount+=1}}},h=({success:m,eventUpdates:g})=>{if(m){const v=e==null?void 0:e.getData();Object.assign(v.event,g),e.update(v)}};Ns({table:l,target:n,items:[{onClick:d,label:"Delete selected",intent:"is-danger",stateChange:!0,location:Ua},{onClick:()=>ea({eventId:u}),label:"View entries",intent:"is-info",location:ci},{onClick:()=>SDe({eventId:u}),id:"editAvoidances",label:"Avoidances",location:ci},{onClick:()=>ZF({event:c,callback:h}),label:"Edit event",location:Qt},{onClick:()=>aT({eventId:u,callback:p}),intent:"is-primary",label:"Add draw",location:Qt}]})},qDe=t=>(e,i)=>{const n=i.getRow().getData(),r=n.eventId,a=!n.published,o=n.published?gKe:RTe;t.get(r).getRows().forEach(u=>u.update({published:a})),Wt({methods:[{method:o,params:{eventId:r,eventDataParams:{participantsProfile:{withScaleValues:!0},pressureRating:!0,refreshResults:!0}}}],callback:u=>{u!=null&&u.success?i.getRow().update({published:!n.published}):ti({message:u.error.message,intent:"is-danger"})}})};function WDe(t){const{eventIds:e,callback:i}=t,n=e.length>1?"Delete Events":"Delete Event";let r;const a=()=>{const u={auditReason:r.eventDeletionReason.value};Wt({methods:[{method:eKe,params:{eventIds:e,auditData:u}}],callback:i})},o=[{text:"Please provide a reason for event deletion."},{placeholder:"Explanation",field:"eventDeletionReason",validator:oT(5),error:"Five word minimum",autocomplete:"on",focus:!0},{text:"This action cannot be undone!"}],l=[{control:"eventDeletionReason",onInput:({inputs:u})=>{const d=u.eventDeletionReason.value,p=oT(5)(d),h=document.getElementById("deleteEvent");h&&(h.disabled=!p)}}];cr({title:n,content:u=>r=Cr(u,o,l),buttons:[{label:"Cancel",intent:Mt,close:!0},{label:"Delete",id:"deleteEvent",disabled:!0,intent:"is-danger",close:!0,onClick:a}]})}const $ct=t=>(e,i)=>{const n=Array.from(document.querySelectorAll(".tippy-content"));if(n.length){n.forEach(h=>h.remove());return}const r=e.target.getElementsByClassName("fa-ellipsis-vertical")[0],a=i.getRow().getData(),o=i.getRow(),s=o==null?void 0:o.getData(),l=s==null?void 0:s.published,c=({success:h,eventUpdates:f})=>{h&&(Object.assign(s.event,f),o.update(s))};pc({items:[{onClick:()=>zDe({eventId:a.eventId}),text:"Display settings"},{text:l?"Unpublish":"Publish",onClick:()=>{qDe(t)(e,i)}},{onClick:()=>{const h=[a.eventId];return WDe({eventIds:h,callback:m=>{const g=i.getTable();m.success&&(g==null||g.deleteRow(h))}})},text:"Delete"},{onClick:()=>ZF({event:a.event,callback:c}),text:"Edit"}],target:r||e.target,config:{placement:gp}})};function Vct(t){const e=(n,r)=>{n.stopPropagation();const a=r.getRow().getData().eventId;ea({eventId:a})},i=(n,r)=>{const a=r.getRow().getData();if(a.drawDefs.length===1){const o=a.eventId,s=a.drawDefs[0].drawId;ea({eventId:o,drawId:s,renderDraw:!0})}else zb(n,r)};return[{cellClick:(n,r)=>r.getRow().toggleSelect(),titleFormatter:"rowSelection",formatter:"rowSelection",headerSort:!1,hozAlign:ci,width:5},{headerMenu:vm({completedMatchUpsCount:"Completed MatchUps",scheduledMatchUpsCount:"Scheduled MatchUps",entriesCount:"Accepted entries",matchUpsCount:"Total matches",drawsCount:"Number of draws",published:"Published"}),formatter:"rownum",headerSort:!1,hozAlign:li,width:55},{title:'<i class="fa-solid fa-eye"></i>',cellClick:qDe(t),formatter:HDe,headerSort:!1,field:"published",width:55},{field:"event.eventName",cellClick:i,title:"Event",minWidth:200,visible:!0,widthGrow:3},{field:"event.eventType",title:"Type",visible:!0},{field:"event.gender",title:"Gender",visible:!0},{title:'<div class="event_icon drawsize_header" />',headerTooltip:"Number of Draws",cellClick:zb,headerHozAlign:li,field:"drawsCount",hozAlign:li,headerSort:!0,visible:!0,width:45},{title:'<div class="event_icon opponents_header" />',headerTooltip:"Accepted Entries",headerHozAlign:li,field:"entriesCount",cellClick:e,hozAlign:li,headerSort:!0,visible:!0,width:50},{title:'<div class="event_icon matches_header" />',headerTooltip:"Total MatchUps",headerHozAlign:li,field:"matchUpsCount",hozAlign:li,headerSort:!0,visible:!0,width:50},{title:'<div class="event_icon time_header" />',headerTooltip:"Scheduled MatchUps",field:"scheduledMatchUpsCount",headerHozAlign:li,hozAlign:li,headerSort:!0,visible:!0,width:50},{title:'<div class="event_icon rank_header" />',headerTooltip:"Completed MatchUps",field:"completedMatchUpsCount",headerHozAlign:li,hozAlign:li,headerSort:!0,visible:!0,width:50},{cellClick:zb,formatter:R9,responsive:!1,headerSort:!1,hozAlign:Qt,field:"isOpen",width:20},{cellClick:$ct(t),formatter:Hg,responsive:!1,headerSort:!1,hozAlign:Qt,width:20}]}function jct(){let t;const e=new Map,i=(s,l)=>{e.has(s)||e.set(s,l)},n=()=>{var l;const s=at.getEvents({withScaleValues:!0});return(l=s==null?void 0:s.events)==null?void 0:l.map(c=>{var u;return VDe({event:c,scaleValues:(u=s.eventScaleValues)==null?void 0:u[c.eventId]})})},r=()=>{t.replaceData(n())},a=Vct(e);return(s=>{var u;gm({anchorId:JD});const l=document.getElementById(JD),c=(u=Bl(l,"section"))==null?void 0:u.querySelector(".tabHeader");c!=null&&c.innerHTML&&(c.innerHTML=`Events (${s.length})`),t=new Go(l,{columnDefaults:{},headerSortElement:Fh(["scheduledMatchUpsCount","completedMatchUpsCount","matchUpsCount","entriesCount","drawsCount"]),rowFormatter:Bct(i),height:window.innerHeight*.8,placeholder:"No events",layout:"fitColumns",reactiveData:!0,index:"eventId",columns:a,data:s}),t.on("scrollVertical",ld),t.on("dataChanged",d=>{c&&(c.innerHTML=`Events (${d.length})`)}),t.on("dataFiltered",(d,p)=>{c&&(c.innerHTML=`Events (${p.length})`)})})(n()),{table:t,replaceTableData:r}}function Gct(){var u,d,p;const t=(u=at.getPublishState().publishState)==null?void 0:u.tournament,{table:e}=jct(),i=h=>{if(h!=null&&h.event){const f=VDe({event:h.event});e==null||e.updateOrAddData([f])}},n=Ew(e),r=()=>{const h=e==null?void 0:e.getSelectedData().map(({eventId:m})=>m);return WDe({eventIds:h,callback:m=>m.success&&(e==null?void 0:e.deleteRow(h))})},a=h=>h?"Unpublish":"Publish",o=h=>`${a(h)} OOP`,s=h=>{var f,m;if(h!=null&&h.success){const g=(f=at.getPublishState().publishState)==null?void 0:f.tournament,v=document.getElementById("oopButton");v.innerText=o((m=g==null?void 0:g.orderOfPlay)==null?void 0:m.published),v.classList.toggle("is-primary")}},l=[{onClick:r,label:"Delete selected",intent:"is-danger",stateChange:!0,location:Ua},{onKeyDown:h=>h.keyCode===8&&h.target.value.length===1&&n(""),onChange:h=>n(h.target.value),onKeyUp:h=>n(h.target.value),clearSearch:()=>n(""),placeholder:"Search events",location:ci,search:!0},{onClick:()=>Hct(s),label:o((d=t==null?void 0:t.orderOfPlay)==null?void 0:d.published),intent:(p=t==null?void 0:t.orderOfPlay)!=null&&p.published?"is-primary":"",id:"oopButton",location:Qt},{onClick:()=>ZF({callback:i}),label:"Add event",location:Qt}],c=document.getElementById(b4);Ns({table:e,target:c,items:l})}function Hct(t){var a,o;const e=(a=at.getPublishState().publishState)==null?void 0:a.tournament,r=[{method:((o=e==null?void 0:e.orderOfPlay)==null?void 0:o.published)?"unPublishOrderOfPlay":"publishOrderOfPlay"}];Wt({methods:r,callback:t})}function zct(t){var o;const{eventId:e,drawId:i,structureId:n,renderDraw:r,roundsView:a="roundsColumns"}=t;if($9(qp),WF(),lB(),e||i){const s=document.getElementById(JD),l=(o=Bl(s,"section"))==null?void 0:o.querySelector(".tabHeader");i&&r?Oct({eventId:e,drawId:i,headerElement:l}).success?(a===TS?BDe({eventId:e,drawId:i,structureId:n,roundsView:a}):a===SS?FDe({eventId:e,drawId:i,structureId:n,roundsView:a}):jE({eventId:e,drawId:i,structureId:n,redraw:!0,roundsView:a}),QM({renderDraw:r})):(Ree({eventId:e,drawId:i}),QM({eventId:e})):(Ree({eventId:e,drawId:i,headerElement:l}),QM({eventId:e}))}else Gct(),QM({eventId:e})}function qct({callback:t}){var p,h;let e,i=!1;const n=at.getTournament().tournamentRecord,r=(h=(p=n==null?void 0:n.onlineResources)==null?void 0:p.find(({name:f,resourceType:m})=>f==="tournamentImage"&&m==="URL"))==null?void 0:h.identifier,a=()=>{const f=document.getElementById("tournamentImagePreview");f.style.display=Mt,o(!0)},o=f=>{const m=document.getElementById("createButton"),g=f?!1:!i&&e.tournamentImage.value;m.disabled=g},s=()=>{o(!1),i=!1;const f=document.getElementById("tournamentImagePreview");f.onload=()=>(i=!0)&&o(),f.src=e.tournamentImage.value,f.style.display=""},l=f=>e=Cr(f,[{onKeyUp:m=>m.key==="Enter"&&s(),onChange:()=>e.tournamentImage.value?s():a(),label:"Web address of online image",value:r,placeholder:"Image URL",field:"tournamentImage",autocomplete:"off"}]),c=document.createElement("div");l(c);const u=document.createElement("img");u.id="tournamentImagePreview",u.onload=()=>i=!0,r&&(u.src=r),u.style.width="100%",c.appendChild(u),cr({title:"Tournament image",content:c,buttons:[{label:"Cancel",intent:"none",close:!0},{onClick:()=>{const f=e.tournamentImage.value;Wt({methods:[{method:q9e,params:{onlineResource:{resourceSubType:"IMAGE",name:"tournamentImage",resourceType:"URL",identifier:f}}}],callback:v=>{v.success&&(ti({message:"Tournament image updated",intent:"is-success"}),Nt(t)&&t(f))}})},intent:"is-primary",id:"createButton",disabled:!0,label:"Save",close:!0}]})}var KDe=typeof global=="object"&&global&&global.Object===Object&&global,Wct=typeof self=="object"&&self&&self.Object===Object&&self,ym=KDe||Wct||Function("return this")(),hy=ym.Symbol,YDe=Object.prototype,Kct=YDe.hasOwnProperty,Yct=YDe.toString,f1=hy?hy.toStringTag:void 0;function Zct(t){var e=Kct.call(t,f1),i=t[f1];try{t[f1]=void 0;var n=!0}catch{}var r=Yct.call(t);return n&&(e?t[f1]=i:delete t[f1]),r}var Xct=Object.prototype,Jct=Xct.toString;function Qct(t){return Jct.call(t)}var eut="[object Null]",tut="[object Undefined]",Hee=hy?hy.toStringTag:void 0;function FU(t){return t==null?t===void 0?tut:eut:Hee&&Hee in Object(t)?Zct(t):Qct(t)}function vg(t){return t!=null&&typeof t=="object"}var SI=Array.isArray;function Ky(t){var e=typeof t;return t!=null&&(e=="object"||e=="function")}function ZDe(t){return t}var iut="[object AsyncFunction]",nut="[object Function]",rut="[object GeneratorFunction]",aut="[object Proxy]";function q9(t){if(!Ky(t))return!1;var e=FU(t);return e==nut||e==rut||e==iut||e==aut}var n2=ym["__core-js_shared__"],zee=function(){var t=/[^.]+$/.exec(n2&&n2.keys&&n2.keys.IE_PROTO||"");return t?"Symbol(src)_1."+t:""}();function out(t){return!!zee&&zee in t}var sut=Function.prototype,lut=sut.toString;function Rw(t){if(t!=null){try{return lut.call(t)}catch{}try{return t+""}catch{}}return""}var cut=/[\\^$.*+?()[\]{}|]/g,uut=/^\[object .+?Constructor\]$/,dut=Function.prototype,put=Object.prototype,hut=dut.toString,fut=put.hasOwnProperty,mut=RegExp("^"+hut.call(fut).replace(cut,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function gut(t){if(!Ky(t)||out(t))return!1;var e=q9(t)?mut:uut;return e.test(Rw(t))}function vut(t,e){return t==null?void 0:t[e]}function Mw(t,e){var i=vut(t,e);return gut(i)?i:void 0}var zG=Mw(ym,"WeakMap"),qee=Object.create,yut=function(){function t(){}return function(e){if(!Ky(e))return{};if(qee)return qee(e);t.prototype=e;var i=new t;return t.prototype=void 0,i}}();function but(t,e,i){switch(i.length){case 0:return t.call(e);case 1:return t.call(e,i[0]);case 2:return t.call(e,i[0],i[1]);case 3:return t.call(e,i[0],i[1],i[2])}return t.apply(e,i)}function XDe(t,e){var i=-1,n=t.length;for(e||(e=Array(n));++i<n;)e[i]=t[i];return e}var Iut=800,wut=16,Sut=Date.now;function Tut(t){var e=0,i=0;return function(){var n=Sut(),r=wut-(n-i);if(i=n,r>0){if(++e>=Iut)return arguments[0]}else e=0;return t.apply(void 0,arguments)}}function Uut(t){return function(){return t}}var mk=function(){try{var t=Mw(Object,"defineProperty");return t({},"",{}),t}catch{}}(),Dut=mk?function(t,e){return mk(t,"toString",{configurable:!0,enumerable:!1,value:Uut(e),writable:!0})}:ZDe;const Eut=Dut;var Cut=Tut(Eut);function Put(t,e){for(var i=-1,n=t==null?0:t.length;++i<n&&e(t[i],i,t)!==!1;);return t}var Rut=9007199254740991,Mut=/^(?:0|[1-9]\d*)$/;function JDe(t,e){var i=typeof t;return e=e??Rut,!!e&&(i=="number"||i!="symbol"&&Mut.test(t))&&t>-1&&t%1==0&&t<e}function W9(t,e,i){e=="__proto__"&&mk?mk(t,e,{configurable:!0,enumerable:!0,value:i,writable:!0}):t[e]=i}function nM(t,e){return t===e||t!==t&&e!==e}var Nut=Object.prototype,Aut=Nut.hasOwnProperty;function QDe(t,e,i){var n=t[e];(!(Aut.call(t,e)&&nM(n,i))||i===void 0&&!(e in t))&&W9(t,e,i)}function rM(t,e,i,n){var r=!i;i||(i={});for(var a=-1,o=e.length;++a<o;){var s=e[a],l=n?n(i[s],t[s],s,i,t):void 0;l===void 0&&(l=t[s]),r?W9(i,s,l):QDe(i,s,l)}return i}var Wee=Math.max;function _ut(t,e,i){return e=Wee(e===void 0?t.length-1:e,0),function(){for(var n=arguments,r=-1,a=Wee(n.length-e,0),o=Array(a);++r<a;)o[r]=n[e+r];r=-1;for(var s=Array(e+1);++r<e;)s[r]=n[r];return s[e]=i(o),but(t,this,s)}}function kut(t,e){return Cut(_ut(t,e,ZDe),t+"")}var xut=9007199254740991;function eEe(t){return typeof t=="number"&&t>-1&&t%1==0&&t<=xut}function cB(t){return t!=null&&eEe(t.length)&&!q9(t)}function Out(t,e,i){if(!Ky(i))return!1;var n=typeof e;return(n=="number"?cB(i)&&JDe(e,i.length):n=="string"&&e in i)?nM(i[e],t):!1}function Lut(t){return kut(function(e,i){var n=-1,r=i.length,a=r>1?i[r-1]:void 0,o=r>2?i[2]:void 0;for(a=t.length>3&&typeof a=="function"?(r--,a):void 0,o&&Out(i[0],i[1],o)&&(a=r<3?void 0:a,r=1),e=Object(e);++n<r;){var s=i[n];s&&t(e,s,n,a)}return e})}var Fut=Object.prototype;function K9(t){var e=t&&t.constructor,i=typeof e=="function"&&e.prototype||Fut;return t===i}function But(t,e){for(var i=-1,n=Array(t);++i<t;)n[i]=e(i);return n}var $ut="[object Arguments]";function Kee(t){return vg(t)&&FU(t)==$ut}var tEe=Object.prototype,Vut=tEe.hasOwnProperty,jut=tEe.propertyIsEnumerable,Gut=Kee(function(){return arguments}())?Kee:function(t){return vg(t)&&Vut.call(t,"callee")&&!jut.call(t,"callee")};const qG=Gut;function Hut(){return!1}var iEe=typeof exports=="object"&&exports&&!exports.nodeType&&exports,Yee=iEe&&typeof module=="object"&&module&&!module.nodeType&&module,zut=Yee&&Yee.exports===iEe,Zee=zut?ym.Buffer:void 0,qut=Zee?Zee.isBuffer:void 0,GE=qut||Hut,Wut="[object Arguments]",Kut="[object Array]",Yut="[object Boolean]",Zut="[object Date]",Xut="[object Error]",Jut="[object Function]",Qut="[object Map]",edt="[object Number]",tdt="[object Object]",idt="[object RegExp]",ndt="[object Set]",rdt="[object String]",adt="[object WeakMap]",odt="[object ArrayBuffer]",sdt="[object DataView]",ldt="[object Float32Array]",cdt="[object Float64Array]",udt="[object Int8Array]",ddt="[object Int16Array]",pdt="[object Int32Array]",hdt="[object Uint8Array]",fdt="[object Uint8ClampedArray]",mdt="[object Uint16Array]",gdt="[object Uint32Array]",Za={};Za[ldt]=Za[cdt]=Za[udt]=Za[ddt]=Za[pdt]=Za[hdt]=Za[fdt]=Za[mdt]=Za[gdt]=!0;Za[Wut]=Za[Kut]=Za[odt]=Za[Yut]=Za[sdt]=Za[Zut]=Za[Xut]=Za[Jut]=Za[Qut]=Za[edt]=Za[tdt]=Za[idt]=Za[ndt]=Za[rdt]=Za[adt]=!1;function vdt(t){return vg(t)&&eEe(t.length)&&!!Za[FU(t)]}function Y9(t){return function(e){return t(e)}}var nEe=typeof exports=="object"&&exports&&!exports.nodeType&&exports,oD=nEe&&typeof module=="object"&&module&&!module.nodeType&&module,ydt=oD&&oD.exports===nEe,r2=ydt&&KDe.process,sT=function(){try{var t=oD&&oD.require&&oD.require("util").types;return t||r2&&r2.binding&&r2.binding("util")}catch{}}(),Xee=sT&&sT.isTypedArray,Z9=Xee?Y9(Xee):vdt,bdt=Object.prototype,Idt=bdt.hasOwnProperty;function rEe(t,e){var i=SI(t),n=!i&&qG(t),r=!i&&!n&&GE(t),a=!i&&!n&&!r&&Z9(t),o=i||n||r||a,s=o?But(t.length,String):[],l=s.length;for(var c in t)(e||Idt.call(t,c))&&!(o&&(c=="length"||r&&(c=="offset"||c=="parent")||a&&(c=="buffer"||c=="byteLength"||c=="byteOffset")||JDe(c,l)))&&s.push(c);return s}function aEe(t,e){return function(i){return t(e(i))}}var wdt=aEe(Object.keys,Object),Sdt=Object.prototype,Tdt=Sdt.hasOwnProperty;function Udt(t){if(!K9(t))return wdt(t);var e=[];for(var i in Object(t))Tdt.call(t,i)&&i!="constructor"&&e.push(i);return e}function X9(t){return cB(t)?rEe(t):Udt(t)}function Ddt(t){var e=[];if(t!=null)for(var i in Object(t))e.push(i);return e}var Edt=Object.prototype,Cdt=Edt.hasOwnProperty;function Pdt(t){if(!Ky(t))return Ddt(t);var e=K9(t),i=[];for(var n in t)n=="constructor"&&(e||!Cdt.call(t,n))||i.push(n);return i}function aM(t){return cB(t)?rEe(t,!0):Pdt(t)}var HE=Mw(Object,"create");function Rdt(){this.__data__=HE?HE(null):{},this.size=0}function Mdt(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e}var Ndt="__lodash_hash_undefined__",Adt=Object.prototype,_dt=Adt.hasOwnProperty;function kdt(t){var e=this.__data__;if(HE){var i=e[t];return i===Ndt?void 0:i}return _dt.call(e,t)?e[t]:void 0}var xdt=Object.prototype,Odt=xdt.hasOwnProperty;function Ldt(t){var e=this.__data__;return HE?e[t]!==void 0:Odt.call(e,t)}var Fdt="__lodash_hash_undefined__";function Bdt(t,e){var i=this.__data__;return this.size+=this.has(t)?0:1,i[t]=HE&&e===void 0?Fdt:e,this}function TI(t){var e=-1,i=t==null?0:t.length;for(this.clear();++e<i;){var n=t[e];this.set(n[0],n[1])}}TI.prototype.clear=Rdt;TI.prototype.delete=Mdt;TI.prototype.get=kdt;TI.prototype.has=Ldt;TI.prototype.set=Bdt;function $dt(){this.__data__=[],this.size=0}function uB(t,e){for(var i=t.length;i--;)if(nM(t[i][0],e))return i;return-1}var Vdt=Array.prototype,jdt=Vdt.splice;function Gdt(t){var e=this.__data__,i=uB(e,t);if(i<0)return!1;var n=e.length-1;return i==n?e.pop():jdt.call(e,i,1),--this.size,!0}function Hdt(t){var e=this.__data__,i=uB(e,t);return i<0?void 0:e[i][1]}function zdt(t){return uB(this.__data__,t)>-1}function qdt(t,e){var i=this.__data__,n=uB(i,t);return n<0?(++this.size,i.push([t,e])):i[n][1]=e,this}function qg(t){var e=-1,i=t==null?0:t.length;for(this.clear();++e<i;){var n=t[e];this.set(n[0],n[1])}}qg.prototype.clear=$dt;qg.prototype.delete=Gdt;qg.prototype.get=Hdt;qg.prototype.has=zdt;qg.prototype.set=qdt;var zE=Mw(ym,"Map");function Wdt(){this.size=0,this.__data__={hash:new TI,map:new(zE||qg),string:new TI}}function Kdt(t){var e=typeof t;return e=="string"||e=="number"||e=="symbol"||e=="boolean"?t!=="__proto__":t===null}function dB(t,e){var i=t.__data__;return Kdt(e)?i[typeof e=="string"?"string":"hash"]:i.map}function Ydt(t){var e=dB(this,t).delete(t);return this.size-=e?1:0,e}function Zdt(t){return dB(this,t).get(t)}function Xdt(t){return dB(this,t).has(t)}function Jdt(t,e){var i=dB(this,t),n=i.size;return i.set(t,e),this.size+=i.size==n?0:1,this}function Nw(t){var e=-1,i=t==null?0:t.length;for(this.clear();++e<i;){var n=t[e];this.set(n[0],n[1])}}Nw.prototype.clear=Wdt;Nw.prototype.delete=Ydt;Nw.prototype.get=Zdt;Nw.prototype.has=Xdt;Nw.prototype.set=Jdt;function oEe(t,e){for(var i=-1,n=e.length,r=t.length;++i<n;)t[r+i]=e[i];return t}var Qdt=aEe(Object.getPrototypeOf,Object);const J9=Qdt;var ept="[object Object]",tpt=Function.prototype,ipt=Object.prototype,sEe=tpt.toString,npt=ipt.hasOwnProperty,rpt=sEe.call(Object);function apt(t){if(!vg(t)||FU(t)!=ept)return!1;var e=J9(t);if(e===null)return!0;var i=npt.call(e,"constructor")&&e.constructor;return typeof i=="function"&&i instanceof i&&sEe.call(i)==rpt}function opt(){this.__data__=new qg,this.size=0}function spt(t){var e=this.__data__,i=e.delete(t);return this.size=e.size,i}function lpt(t){return this.__data__.get(t)}function cpt(t){return this.__data__.has(t)}var upt=200;function dpt(t,e){var i=this.__data__;if(i instanceof qg){var n=i.__data__;if(!zE||n.length<upt-1)return n.push([t,e]),this.size=++i.size,this;i=this.__data__=new Nw(n)}return i.set(t,e),this.size=i.size,this}function Sf(t){var e=this.__data__=new qg(t);this.size=e.size}Sf.prototype.clear=opt;Sf.prototype.delete=spt;Sf.prototype.get=lpt;Sf.prototype.has=cpt;Sf.prototype.set=dpt;function ppt(t,e){return t&&rM(e,X9(e),t)}function hpt(t,e){return t&&rM(e,aM(e),t)}var lEe=typeof exports=="object"&&exports&&!exports.nodeType&&exports,Jee=lEe&&typeof module=="object"&&module&&!module.nodeType&&module,fpt=Jee&&Jee.exports===lEe,Qee=fpt?ym.Buffer:void 0,ete=Qee?Qee.allocUnsafe:void 0;function cEe(t,e){if(e)return t.slice();var i=t.length,n=ete?ete(i):new t.constructor(i);return t.copy(n),n}function mpt(t,e){for(var i=-1,n=t==null?0:t.length,r=0,a=[];++i<n;){var o=t[i];e(o,i,t)&&(a[r++]=o)}return a}function uEe(){return[]}var gpt=Object.prototype,vpt=gpt.propertyIsEnumerable,tte=Object.getOwnPropertySymbols,Q9=tte?function(t){return t==null?[]:(t=Object(t),mpt(tte(t),function(e){return vpt.call(t,e)}))}:uEe;function ypt(t,e){return rM(t,Q9(t),e)}var bpt=Object.getOwnPropertySymbols,dEe=bpt?function(t){for(var e=[];t;)oEe(e,Q9(t)),t=J9(t);return e}:uEe;function Ipt(t,e){return rM(t,dEe(t),e)}function pEe(t,e,i){var n=e(t);return SI(t)?n:oEe(n,i(t))}function WG(t){return pEe(t,X9,Q9)}function wpt(t){return pEe(t,aM,dEe)}var KG=Mw(ym,"DataView"),YG=Mw(ym,"Promise"),ZG=Mw(ym,"Set"),ite="[object Map]",Spt="[object Object]",nte="[object Promise]",rte="[object Set]",ate="[object WeakMap]",ote="[object DataView]",Tpt=Rw(KG),Upt=Rw(zE),Dpt=Rw(YG),Ept=Rw(ZG),Cpt=Rw(zG),cb=FU;(KG&&cb(new KG(new ArrayBuffer(1)))!=ote||zE&&cb(new zE)!=ite||YG&&cb(YG.resolve())!=nte||ZG&&cb(new ZG)!=rte||zG&&cb(new zG)!=ate)&&(cb=function(t){var e=FU(t),i=e==Spt?t.constructor:void 0,n=i?Rw(i):"";if(n)switch(n){case Tpt:return ote;case Upt:return ite;case Dpt:return nte;case Ept:return rte;case Cpt:return ate}return e});const qE=cb;var Ppt=Object.prototype,Rpt=Ppt.hasOwnProperty;function Mpt(t){var e=t.length,i=new t.constructor(e);return e&&typeof t[0]=="string"&&Rpt.call(t,"index")&&(i.index=t.index,i.input=t.input),i}var gk=ym.Uint8Array;function eK(t){var e=new t.constructor(t.byteLength);return new gk(e).set(new gk(t)),e}function Npt(t,e){var i=e?eK(t.buffer):t.buffer;return new t.constructor(i,t.byteOffset,t.byteLength)}var Apt=/\w*$/;function _pt(t){var e=new t.constructor(t.source,Apt.exec(t));return e.lastIndex=t.lastIndex,e}var ste=hy?hy.prototype:void 0,lte=ste?ste.valueOf:void 0;function kpt(t){return lte?Object(lte.call(t)):{}}function hEe(t,e){var i=e?eK(t.buffer):t.buffer;return new t.constructor(i,t.byteOffset,t.length)}var xpt="[object Boolean]",Opt="[object Date]",Lpt="[object Map]",Fpt="[object Number]",Bpt="[object RegExp]",$pt="[object Set]",Vpt="[object String]",jpt="[object Symbol]",Gpt="[object ArrayBuffer]",Hpt="[object DataView]",zpt="[object Float32Array]",qpt="[object Float64Array]",Wpt="[object Int8Array]",Kpt="[object Int16Array]",Ypt="[object Int32Array]",Zpt="[object Uint8Array]",Xpt="[object Uint8ClampedArray]",Jpt="[object Uint16Array]",Qpt="[object Uint32Array]";function eht(t,e,i){var n=t.constructor;switch(e){case Gpt:return eK(t);case xpt:case Opt:return new n(+t);case Hpt:return Npt(t,i);case zpt:case qpt:case Wpt:case Kpt:case Ypt:case Zpt:case Xpt:case Jpt:case Qpt:return hEe(t,i);case Lpt:return new n;case Fpt:case Vpt:return new n(t);case Bpt:return _pt(t);case $pt:return new n;case jpt:return kpt(t)}}function fEe(t){return typeof t.constructor=="function"&&!K9(t)?yut(J9(t)):{}}var tht="[object Map]";function iht(t){return vg(t)&&qE(t)==tht}var cte=sT&&sT.isMap,nht=cte?Y9(cte):iht,rht="[object Set]";function aht(t){return vg(t)&&qE(t)==rht}var ute=sT&&sT.isSet,oht=ute?Y9(ute):aht,sht=1,lht=2,cht=4,mEe="[object Arguments]",uht="[object Array]",dht="[object Boolean]",pht="[object Date]",hht="[object Error]",gEe="[object Function]",fht="[object GeneratorFunction]",mht="[object Map]",ght="[object Number]",vEe="[object Object]",vht="[object RegExp]",yht="[object Set]",bht="[object String]",Iht="[object Symbol]",wht="[object WeakMap]",Sht="[object ArrayBuffer]",Tht="[object DataView]",Uht="[object Float32Array]",Dht="[object Float64Array]",Eht="[object Int8Array]",Cht="[object Int16Array]",Pht="[object Int32Array]",Rht="[object Uint8Array]",Mht="[object Uint8ClampedArray]",Nht="[object Uint16Array]",Aht="[object Uint32Array]",xa={};xa[mEe]=xa[uht]=xa[Sht]=xa[Tht]=xa[dht]=xa[pht]=xa[Uht]=xa[Dht]=xa[Eht]=xa[Cht]=xa[Pht]=xa[mht]=xa[ght]=xa[vEe]=xa[vht]=xa[yht]=xa[bht]=xa[Iht]=xa[Rht]=xa[Mht]=xa[Nht]=xa[Aht]=!0;xa[hht]=xa[gEe]=xa[wht]=!1;function sA(t,e,i,n,r,a){var o,s=e&sht,l=e&lht,c=e&cht;if(i&&(o=r?i(t,n,r,a):i(t)),o!==void 0)return o;if(!Ky(t))return t;var u=SI(t);if(u){if(o=Mpt(t),!s)return XDe(t,o)}else{var d=qE(t),p=d==gEe||d==fht;if(GE(t))return cEe(t,s);if(d==vEe||d==mEe||p&&!r){if(o=l||p?{}:fEe(t),!s)return l?Ipt(t,hpt(o,t)):ypt(t,ppt(o,t))}else{if(!xa[d])return r?t:{};o=eht(t,d,s)}}a||(a=new Sf);var h=a.get(t);if(h)return h;a.set(t,o),oht(t)?t.forEach(function(g){o.add(sA(g,e,i,g,t,a))}):nht(t)&&t.forEach(function(g,v){o.set(v,sA(g,e,i,v,t,a))});var f=c?l?wpt:WG:l?aM:X9,m=u?void 0:f(t);return Put(m||t,function(g,v){m&&(v=g,g=t[v]),QDe(o,v,sA(g,e,i,v,t,a))}),o}var _ht=1,kht=4;function K0(t){return sA(t,_ht|kht)}var xht="__lodash_hash_undefined__";function Oht(t){return this.__data__.set(t,xht),this}function Lht(t){return this.__data__.has(t)}function vk(t){var e=-1,i=t==null?0:t.length;for(this.__data__=new Nw;++e<i;)this.add(t[e])}vk.prototype.add=vk.prototype.push=Oht;vk.prototype.has=Lht;function Fht(t,e){for(var i=-1,n=t==null?0:t.length;++i<n;)if(e(t[i],i,t))return!0;return!1}function Bht(t,e){return t.has(e)}var $ht=1,Vht=2;function yEe(t,e,i,n,r,a){var o=i&$ht,s=t.length,l=e.length;if(s!=l&&!(o&&l>s))return!1;var c=a.get(t),u=a.get(e);if(c&&u)return c==e&&u==t;var d=-1,p=!0,h=i&Vht?new vk:void 0;for(a.set(t,e),a.set(e,t);++d<s;){var f=t[d],m=e[d];if(n)var g=o?n(m,f,d,e,t,a):n(f,m,d,t,e,a);if(g!==void 0){if(g)continue;p=!1;break}if(h){if(!Fht(e,function(v,y){if(!Bht(h,y)&&(f===v||r(f,v,i,n,a)))return h.push(y)})){p=!1;break}}else if(!(f===m||r(f,m,i,n,a))){p=!1;break}}return a.delete(t),a.delete(e),p}function jht(t){var e=-1,i=Array(t.size);return t.forEach(function(n,r){i[++e]=[r,n]}),i}function Ght(t){var e=-1,i=Array(t.size);return t.forEach(function(n){i[++e]=n}),i}var Hht=1,zht=2,qht="[object Boolean]",Wht="[object Date]",Kht="[object Error]",Yht="[object Map]",Zht="[object Number]",Xht="[object RegExp]",Jht="[object Set]",Qht="[object String]",eft="[object Symbol]",tft="[object ArrayBuffer]",ift="[object DataView]",dte=hy?hy.prototype:void 0,a2=dte?dte.valueOf:void 0;function nft(t,e,i,n,r,a,o){switch(i){case ift:if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)return!1;t=t.buffer,e=e.buffer;case tft:return!(t.byteLength!=e.byteLength||!a(new gk(t),new gk(e)));case qht:case Wht:case Zht:return nM(+t,+e);case Kht:return t.name==e.name&&t.message==e.message;case Xht:case Qht:return t==e+"";case Yht:var s=jht;case Jht:var l=n&Hht;if(s||(s=Ght),t.size!=e.size&&!l)return!1;var c=o.get(t);if(c)return c==e;n|=zht,o.set(t,e);var u=yEe(s(t),s(e),n,r,a,o);return o.delete(t),u;case eft:if(a2)return a2.call(t)==a2.call(e)}return!1}var rft=1,aft=Object.prototype,oft=aft.hasOwnProperty;function sft(t,e,i,n,r,a){var o=i&rft,s=WG(t),l=s.length,c=WG(e),u=c.length;if(l!=u&&!o)return!1;for(var d=l;d--;){var p=s[d];if(!(o?p in e:oft.call(e,p)))return!1}var h=a.get(t),f=a.get(e);if(h&&f)return h==e&&f==t;var m=!0;a.set(t,e),a.set(e,t);for(var g=o;++d<l;){p=s[d];var v=t[p],y=e[p];if(n)var b=o?n(y,v,p,e,t,a):n(v,y,p,t,e,a);if(!(b===void 0?v===y||r(v,y,i,n,a):b)){m=!1;break}g||(g=p=="constructor")}if(m&&!g){var I=t.constructor,T=e.constructor;I!=T&&"constructor"in t&&"constructor"in e&&!(typeof I=="function"&&I instanceof I&&typeof T=="function"&&T instanceof T)&&(m=!1)}return a.delete(t),a.delete(e),m}var lft=1,pte="[object Arguments]",hte="[object Array]",eN="[object Object]",cft=Object.prototype,fte=cft.hasOwnProperty;function uft(t,e,i,n,r,a){var o=SI(t),s=SI(e),l=o?hte:qE(t),c=s?hte:qE(e);l=l==pte?eN:l,c=c==pte?eN:c;var u=l==eN,d=c==eN,p=l==c;if(p&&GE(t)){if(!GE(e))return!1;o=!0,u=!1}if(p&&!u)return a||(a=new Sf),o||Z9(t)?yEe(t,e,i,n,r,a):nft(t,e,l,i,n,r,a);if(!(i&lft)){var h=u&&fte.call(t,"__wrapped__"),f=d&&fte.call(e,"__wrapped__");if(h||f){var m=h?t.value():t,g=f?e.value():e;return a||(a=new Sf),r(m,g,i,n,a)}}return p?(a||(a=new Sf),sft(t,e,i,n,r,a)):!1}function bEe(t,e,i,n,r){return t===e?!0:t==null||e==null||!vg(t)&&!vg(e)?t!==t&&e!==e:uft(t,e,i,n,bEe,r)}function dft(t){return function(e,i,n){for(var r=-1,a=Object(e),o=n(e),s=o.length;s--;){var l=o[t?s:++r];if(i(a[l],l,a)===!1)break}return e}}var pft=dft();function XG(t,e,i){(i!==void 0&&!nM(t[e],i)||i===void 0&&!(e in t))&&W9(t,e,i)}function hft(t){return vg(t)&&cB(t)}function JG(t,e){if(!(e==="constructor"&&typeof t[e]=="function")&&e!="__proto__")return t[e]}function fft(t){return rM(t,aM(t))}function mft(t,e,i,n,r,a,o){var s=JG(t,i),l=JG(e,i),c=o.get(l);if(c){XG(t,i,c);return}var u=a?a(s,l,i+"",t,e,o):void 0,d=u===void 0;if(d){var p=SI(l),h=!p&&GE(l),f=!p&&!h&&Z9(l);u=l,p||h||f?SI(s)?u=s:hft(s)?u=XDe(s):h?(d=!1,u=cEe(l,!0)):f?(d=!1,u=hEe(l,!0)):u=[]:apt(l)||qG(l)?(u=s,qG(s)?u=fft(s):(!Ky(s)||q9(s))&&(u=fEe(l))):d=!1}d&&(o.set(l,u),r(u,l,n,a,o),o.delete(l)),XG(t,i,u)}function IEe(t,e,i,n,r){t!==e&&pft(e,function(a,o){if(r||(r=new Sf),Ky(a))mft(t,e,o,i,IEe,n,r);else{var s=n?n(JG(t,o),a,o+"",t,e,r):void 0;s===void 0&&(s=a),XG(t,o,s)}},aM)}function tK(t,e){return bEe(t,e)}var kv=Lut(function(t,e,i){IEe(t,e,i)}),Si=(t=>(t[t.TYPE=3]="TYPE",t[t.LEVEL=12]="LEVEL",t[t.ATTRIBUTE=13]="ATTRIBUTE",t[t.BLOT=14]="BLOT",t[t.INLINE=7]="INLINE",t[t.BLOCK=11]="BLOCK",t[t.BLOCK_BLOT=10]="BLOCK_BLOT",t[t.INLINE_BLOT=6]="INLINE_BLOT",t[t.BLOCK_ATTRIBUTE=9]="BLOCK_ATTRIBUTE",t[t.INLINE_ATTRIBUTE=5]="INLINE_ATTRIBUTE",t[t.ANY=15]="ANY",t))(Si||{});class Kf{constructor(e,i,n={}){this.attrName=e,this.keyName=i;const r=Si.TYPE&Si.ATTRIBUTE;this.scope=n.scope!=null?n.scope&Si.LEVEL|r:Si.ATTRIBUTE,n.whitelist!=null&&(this.whitelist=n.whitelist)}static keys(e){return Array.from(e.attributes).map(i=>i.name)}add(e,i){return this.canAdd(e,i)?(e.setAttribute(this.keyName,i),!0):!1}canAdd(e,i){return this.whitelist==null?!0:typeof i=="string"?this.whitelist.indexOf(i.replace(/["']/g,""))>-1:this.whitelist.indexOf(i)>-1}remove(e){e.removeAttribute(this.keyName)}value(e){const i=e.getAttribute(this.keyName);return this.canAdd(e,i)&&i?i:""}}class Y0 extends Error{constructor(e){e="[Parchment] "+e,super(e),this.message=e,this.name=this.constructor.name}}const wEe=class QG{constructor(){this.attributes={},this.classes={},this.tags={},this.types={}}static find(e,i=!1){if(e==null)return null;if(this.blots.has(e))return this.blots.get(e)||null;if(i){let n=null;try{n=e.parentNode}catch{return null}return this.find(n,i)}return null}create(e,i,n){const r=this.query(i);if(r==null)throw new Y0(`Unable to create ${i} blot`);const a=r,o=i instanceof Node||i.nodeType===Node.TEXT_NODE?i:a.create(n),s=new a(e,o,n);return QG.blots.set(s.domNode,s),s}find(e,i=!1){return QG.find(e,i)}query(e,i=Si.ANY){let n;return typeof e=="string"?n=this.types[e]||this.attributes[e]:e instanceof Text||e.nodeType===Node.TEXT_NODE?n=this.types.text:typeof e=="number"?e&Si.LEVEL&Si.BLOCK?n=this.types.block:e&Si.LEVEL&Si.INLINE&&(n=this.types.inline):e instanceof Element&&((e.getAttribute("class")||"").split(/\s+/).some(r=>(n=this.classes[r],!!n)),n=n||this.tags[e.tagName]),n==null?null:"scope"in n&&i&Si.LEVEL&n.scope&&i&Si.TYPE&n.scope?n:null}register(...e){return e.map(i=>{const n="blotName"in i,r="attrName"in i;if(!n&&!r)throw new Y0("Invalid definition");if(n&&i.blotName==="abstract")throw new Y0("Cannot register abstract class");const a=n?i.blotName:r?i.attrName:void 0;return this.types[a]=i,r?typeof i.keyName=="string"&&(this.attributes[i.keyName]=i):n&&(i.className&&(this.classes[i.className]=i),i.tagName&&(Array.isArray(i.tagName)?i.tagName=i.tagName.map(o=>o.toUpperCase()):i.tagName=i.tagName.toUpperCase(),(Array.isArray(i.tagName)?i.tagName:[i.tagName]).forEach(o=>{(this.tags[o]==null||i.className==null)&&(this.tags[o]=i)}))),i})}};wEe.blots=new WeakMap;let lT=wEe;function mte(t,e){return(t.getAttribute("class")||"").split(/\s+/).filter(i=>i.indexOf(`${e}-`)===0)}class gft extends Kf{static keys(e){return(e.getAttribute("class")||"").split(/\s+/).map(i=>i.split("-").slice(0,-1).join("-"))}add(e,i){return this.canAdd(e,i)?(this.remove(e),e.classList.add(`${this.keyName}-${i}`),!0):!1}remove(e){mte(e,this.keyName).forEach(i=>{e.classList.remove(i)}),e.classList.length===0&&e.removeAttribute("class")}value(e){const i=(mte(e,this.keyName)[0]||"").slice(this.keyName.length+1);return this.canAdd(e,i)?i:""}}const $h=gft;function o2(t){const e=t.split("-"),i=e.slice(1).map(n=>n[0].toUpperCase()+n.slice(1)).join("");return e[0]+i}class vft extends Kf{static keys(e){return(e.getAttribute("style")||"").split(";").map(i=>i.split(":")[0].trim())}add(e,i){return this.canAdd(e,i)?(e.style[o2(this.keyName)]=i,!0):!1}remove(e){e.style[o2(this.keyName)]="",e.getAttribute("style")||e.removeAttribute("style")}value(e){const i=e.style[o2(this.keyName)];return this.canAdd(e,i)?i:""}}const Yy=vft;class yft{constructor(e){this.attributes={},this.domNode=e,this.build()}attribute(e,i){i?e.add(this.domNode,i)&&(e.value(this.domNode)!=null?this.attributes[e.attrName]=e:delete this.attributes[e.attrName]):(e.remove(this.domNode),delete this.attributes[e.attrName])}build(){this.attributes={};const e=lT.find(this.domNode);if(e==null)return;const i=Kf.keys(this.domNode),n=$h.keys(this.domNode),r=Yy.keys(this.domNode);i.concat(n).concat(r).forEach(a=>{const o=e.scroll.query(a,Si.ATTRIBUTE);o instanceof Kf&&(this.attributes[o.attrName]=o)})}copy(e){Object.keys(this.attributes).forEach(i=>{const n=this.attributes[i].value(this.domNode);e.format(i,n)})}move(e){this.copy(e),Object.keys(this.attributes).forEach(i=>{this.attributes[i].remove(this.domNode)}),this.attributes={}}values(){return Object.keys(this.attributes).reduce((e,i)=>(e[i]=this.attributes[i].value(this.domNode),e),{})}}const pB=yft,SEe=class{constructor(e,i){this.scroll=e,this.domNode=i,lT.blots.set(i,this),this.prev=null,this.next=null}static create(e){if(this.tagName==null)throw new Y0("Blot definition missing tagName");let i,n;return Array.isArray(this.tagName)?(typeof e=="string"?(n=e.toUpperCase(),parseInt(n,10).toString()===n&&(n=parseInt(n,10))):typeof e=="number"&&(n=e),typeof n=="number"?i=document.createElement(this.tagName[n-1]):n&&this.tagName.indexOf(n)>-1?i=document.createElement(n):i=document.createElement(this.tagName[0])):i=document.createElement(this.tagName),this.className&&i.classList.add(this.className),i}get statics(){return this.constructor}attach(){}clone(){const e=this.domNode.cloneNode(!1);return this.scroll.create(e)}detach(){this.parent!=null&&this.parent.removeChild(this),lT.blots.delete(this.domNode)}deleteAt(e,i){this.isolate(e,i).remove()}formatAt(e,i,n,r){const a=this.isolate(e,i);if(this.scroll.query(n,Si.BLOT)!=null&&r)a.wrap(n,r);else if(this.scroll.query(n,Si.ATTRIBUTE)!=null){const o=this.scroll.create(this.statics.scope);a.wrap(o),o.format(n,r)}}insertAt(e,i,n){const r=n==null?this.scroll.create("text",i):this.scroll.create(i,n),a=this.split(e);this.parent.insertBefore(r,a||void 0)}isolate(e,i){const n=this.split(e);if(n==null)throw new Error("Attempt to isolate at end");return n.split(i),n}length(){return 1}offset(e=this.parent){return this.parent==null||this===e?0:this.parent.children.offset(this)+this.parent.offset(e)}optimize(e){this.statics.requiredContainer&&!(this.parent instanceof this.statics.requiredContainer)&&this.wrap(this.statics.requiredContainer.blotName)}remove(){this.domNode.parentNode!=null&&this.domNode.parentNode.removeChild(this.domNode),this.detach()}replaceWith(e,i){const n=typeof e=="string"?this.scroll.create(e,i):e;return this.parent!=null&&(this.parent.insertBefore(n,this.next||void 0),this.remove()),n}split(e,i){return e===0?this:this.next}update(e,i){}wrap(e,i){const n=typeof e=="string"?this.scroll.create(e,i):e;if(this.parent!=null&&this.parent.insertBefore(n,this.next||void 0),typeof n.appendChild!="function")throw new Y0(`Cannot wrap ${e}`);return n.appendChild(this),n}};SEe.blotName="abstract";let TEe=SEe;const UEe=class extends TEe{static value(e){return!0}index(e,i){return this.domNode===e||this.domNode.compareDocumentPosition(e)&Node.DOCUMENT_POSITION_CONTAINED_BY?Math.min(i,1):-1}position(e,i){let n=Array.from(this.parent.domNode.childNodes).indexOf(this.domNode);return e>0&&(n+=1),[this.parent.domNode,n]}value(){return{[this.statics.blotName]:this.statics.value(this.domNode)||!0}}};UEe.scope=Si.INLINE_BLOT;let bft=UEe;const Wl=bft;class Ift{constructor(){this.head=null,this.tail=null,this.length=0}append(...e){if(this.insertBefore(e[0],null),e.length>1){const i=e.slice(1);this.append(...i)}}at(e){const i=this.iterator();let n=i();for(;n&&e>0;)e-=1,n=i();return n}contains(e){const i=this.iterator();let n=i();for(;n;){if(n===e)return!0;n=i()}return!1}indexOf(e){const i=this.iterator();let n=i(),r=0;for(;n;){if(n===e)return r;r+=1,n=i()}return-1}insertBefore(e,i){e!=null&&(this.remove(e),e.next=i,i!=null?(e.prev=i.prev,i.prev!=null&&(i.prev.next=e),i.prev=e,i===this.head&&(this.head=e)):this.tail!=null?(this.tail.next=e,e.prev=this.tail,this.tail=e):(e.prev=null,this.head=this.tail=e),this.length+=1)}offset(e){let i=0,n=this.head;for(;n!=null;){if(n===e)return i;i+=n.length(),n=n.next}return-1}remove(e){this.contains(e)&&(e.prev!=null&&(e.prev.next=e.next),e.next!=null&&(e.next.prev=e.prev),e===this.head&&(this.head=e.next),e===this.tail&&(this.tail=e.prev),this.length-=1)}iterator(e=this.head){return()=>{const i=e;return e!=null&&(e=e.next),i}}find(e,i=!1){const n=this.iterator();let r=n();for(;r;){const a=r.length();if(e<a||i&&e===a&&(r.next==null||r.next.length()!==0))return[r,e];e-=a,r=n()}return[null,0]}forEach(e){const i=this.iterator();let n=i();for(;n;)e(n),n=i()}forEachAt(e,i,n){if(i<=0)return;const[r,a]=this.find(e);let o=e-a;const s=this.iterator(r);let l=s();for(;l&&o<e+i;){const c=l.length();e>o?n(l,e-o,Math.min(i,o+c-e)):n(l,0,Math.min(c,e+i-o)),o+=c,l=s()}}map(e){return this.reduce((i,n)=>(i.push(e(n)),i),[])}reduce(e,i){const n=this.iterator();let r=n();for(;r;)i=e(i,r),r=n();return i}}function gte(t,e){const i=e.find(t);if(i)return i;try{return e.create(t)}catch{const n=e.create(Si.INLINE);return Array.from(t.childNodes).forEach(r=>{n.domNode.appendChild(r)}),t.parentNode&&t.parentNode.replaceChild(n.domNode,t),n.attach(),n}}const DEe=class uv extends TEe{constructor(e,i){super(e,i),this.uiNode=null,this.build()}appendChild(e){this.insertBefore(e)}attach(){super.attach(),this.children.forEach(e=>{e.attach()})}attachUI(e){this.uiNode!=null&&this.uiNode.remove(),this.uiNode=e,uv.uiClass&&this.uiNode.classList.add(uv.uiClass),this.uiNode.setAttribute("contenteditable","false"),this.domNode.insertBefore(this.uiNode,this.domNode.firstChild)}build(){this.children=new Ift,Array.from(this.domNode.childNodes).filter(e=>e!==this.uiNode).reverse().forEach(e=>{try{const i=gte(e,this.scroll);this.insertBefore(i,this.children.head||void 0)}catch(i){if(i instanceof Y0)return;throw i}})}deleteAt(e,i){if(e===0&&i===this.length())return this.remove();this.children.forEachAt(e,i,(n,r,a)=>{n.deleteAt(r,a)})}descendant(e,i=0){const[n,r]=this.children.find(i);return e.blotName==null&&e(n)||e.blotName!=null&&n instanceof e?[n,r]:n instanceof uv?n.descendant(e,r):[null,-1]}descendants(e,i=0,n=Number.MAX_VALUE){let r=[],a=n;return this.children.forEachAt(i,n,(o,s,l)=>{(e.blotName==null&&e(o)||e.blotName!=null&&o instanceof e)&&r.push(o),o instanceof uv&&(r=r.concat(o.descendants(e,s,a))),a-=l}),r}detach(){this.children.forEach(e=>{e.detach()}),super.detach()}enforceAllowedChildren(){let e=!1;this.children.forEach(i=>{e||this.statics.allowedChildren.some(n=>i instanceof n)||(i.statics.scope===Si.BLOCK_BLOT?(i.next!=null&&this.splitAfter(i),i.prev!=null&&this.splitAfter(i.prev),i.parent.unwrap(),e=!0):i instanceof uv?i.unwrap():i.remove())})}formatAt(e,i,n,r){this.children.forEachAt(e,i,(a,o,s)=>{a.formatAt(o,s,n,r)})}insertAt(e,i,n){const[r,a]=this.children.find(e);if(r)r.insertAt(a,i,n);else{const o=n==null?this.scroll.create("text",i):this.scroll.create(i,n);this.appendChild(o)}}insertBefore(e,i){e.parent!=null&&e.parent.children.remove(e);let n=null;this.children.insertBefore(e,i||null),e.parent=this,i!=null&&(n=i.domNode),(this.domNode.parentNode!==e.domNode||this.domNode.nextSibling!==n)&&this.domNode.insertBefore(e.domNode,n),e.attach()}length(){return this.children.reduce((e,i)=>e+i.length(),0)}moveChildren(e,i){this.children.forEach(n=>{e.insertBefore(n,i)})}optimize(e){if(super.optimize(e),this.enforceAllowedChildren(),this.uiNode!=null&&this.uiNode!==this.domNode.firstChild&&this.domNode.insertBefore(this.uiNode,this.domNode.firstChild),this.children.length===0)if(this.statics.defaultChild!=null){const i=this.scroll.create(this.statics.defaultChild.blotName);this.appendChild(i)}else this.remove()}path(e,i=!1){const[n,r]=this.children.find(e,i),a=[[this,e]];return n instanceof uv?a.concat(n.path(r,i)):(n!=null&&a.push([n,r]),a)}removeChild(e){this.children.remove(e)}replaceWith(e,i){const n=typeof e=="string"?this.scroll.create(e,i):e;return n instanceof uv&&this.moveChildren(n),super.replaceWith(n)}split(e,i=!1){if(!i){if(e===0)return this;if(e===this.length())return this.next}const n=this.clone();return this.parent&&this.parent.insertBefore(n,this.next||void 0),this.children.forEachAt(e,this.length(),(r,a,o)=>{const s=r.split(a,i);s!=null&&n.appendChild(s)}),n}splitAfter(e){const i=this.clone();for(;e.next!=null;)i.appendChild(e.next);return this.parent&&this.parent.insertBefore(i,this.next||void 0),i}unwrap(){this.parent&&this.moveChildren(this.parent,this.next||void 0),this.remove()}update(e,i){const n=[],r=[];e.forEach(a=>{a.target===this.domNode&&a.type==="childList"&&(n.push(...a.addedNodes),r.push(...a.removedNodes))}),r.forEach(a=>{if(a.parentNode!=null&&a.tagName!=="IFRAME"&&document.body.compareDocumentPosition(a)&Node.DOCUMENT_POSITION_CONTAINED_BY)return;const o=this.scroll.find(a);o!=null&&(o.domNode.parentNode==null||o.domNode.parentNode===this.domNode)&&o.detach()}),n.filter(a=>a.parentNode===this.domNode&&a!==this.uiNode).sort((a,o)=>a===o?0:a.compareDocumentPosition(o)&Node.DOCUMENT_POSITION_FOLLOWING?1:-1).forEach(a=>{let o=null;a.nextSibling!=null&&(o=this.scroll.find(a.nextSibling));const s=gte(a,this.scroll);(s.next!==o||s.next==null)&&(s.parent!=null&&s.parent.removeChild(this),this.insertBefore(s,o||void 0))}),this.enforceAllowedChildren()}};DEe.uiClass="";let wft=DEe;const dh=wft;function Sft(t,e){if(Object.keys(t).length!==Object.keys(e).length)return!1;for(const i in t)if(t[i]!==e[i])return!1;return!0}const w0=class S0 extends dh{static create(e){return super.create(e)}static formats(e,i){const n=i.query(S0.blotName);if(!(n!=null&&e.tagName===n.tagName)){if(typeof this.tagName=="string")return!0;if(Array.isArray(this.tagName))return e.tagName.toLowerCase()}}constructor(e,i){super(e,i),this.attributes=new pB(this.domNode)}format(e,i){if(e===this.statics.blotName&&!i)this.children.forEach(n=>{n instanceof S0||(n=n.wrap(S0.blotName,!0)),this.attributes.copy(n)}),this.unwrap();else{const n=this.scroll.query(e,Si.INLINE);if(n==null)return;n instanceof Kf?this.attributes.attribute(n,i):i&&(e!==this.statics.blotName||this.formats()[e]!==i)&&this.replaceWith(e,i)}}formats(){const e=this.attributes.values(),i=this.statics.formats(this.domNode,this.scroll);return i!=null&&(e[this.statics.blotName]=i),e}formatAt(e,i,n,r){this.formats()[n]!=null||this.scroll.query(n,Si.ATTRIBUTE)?this.isolate(e,i).format(n,r):super.formatAt(e,i,n,r)}optimize(e){super.optimize(e);const i=this.formats();if(Object.keys(i).length===0)return this.unwrap();const n=this.next;n instanceof S0&&n.prev===this&&Sft(i,n.formats())&&(n.moveChildren(this),n.remove())}replaceWith(e,i){const n=super.replaceWith(e,i);return this.attributes.copy(n),n}update(e,i){super.update(e,i),e.some(n=>n.target===this.domNode&&n.type==="attributes")&&this.attributes.build()}wrap(e,i){const n=super.wrap(e,i);return n instanceof S0&&this.attributes.move(n),n}};w0.allowedChildren=[w0,Wl],w0.blotName="inline",w0.scope=Si.INLINE_BLOT,w0.tagName="SPAN";let Tft=w0;const iK=Tft,T0=class eH extends dh{static create(e){return super.create(e)}static formats(e,i){const n=i.query(eH.blotName);if(!(n!=null&&e.tagName===n.tagName)){if(typeof this.tagName=="string")return!0;if(Array.isArray(this.tagName))return e.tagName.toLowerCase()}}constructor(e,i){super(e,i),this.attributes=new pB(this.domNode)}format(e,i){const n=this.scroll.query(e,Si.BLOCK);n!=null&&(n instanceof Kf?this.attributes.attribute(n,i):e===this.statics.blotName&&!i?this.replaceWith(eH.blotName):i&&(e!==this.statics.blotName||this.formats()[e]!==i)&&this.replaceWith(e,i))}formats(){const e=this.attributes.values(),i=this.statics.formats(this.domNode,this.scroll);return i!=null&&(e[this.statics.blotName]=i),e}formatAt(e,i,n,r){this.scroll.query(n,Si.BLOCK)!=null?this.format(n,r):super.formatAt(e,i,n,r)}insertAt(e,i,n){if(n==null||this.scroll.query(i,Si.INLINE)!=null)super.insertAt(e,i,n);else{const r=this.split(e);if(r!=null){const a=this.scroll.create(i,n);r.parent.insertBefore(a,r)}else throw new Error("Attempt to insertAt after block boundaries")}}replaceWith(e,i){const n=super.replaceWith(e,i);return this.attributes.copy(n),n}update(e,i){super.update(e,i),e.some(n=>n.target===this.domNode&&n.type==="attributes")&&this.attributes.build()}};T0.blotName="block",T0.scope=Si.BLOCK_BLOT,T0.tagName="P",T0.allowedChildren=[iK,T0,Wl];let Uft=T0;const WE=Uft,tH=class extends dh{checkMerge(){return this.next!==null&&this.next.statics.blotName===this.statics.blotName}deleteAt(e,i){super.deleteAt(e,i),this.enforceAllowedChildren()}formatAt(e,i,n,r){super.formatAt(e,i,n,r),this.enforceAllowedChildren()}insertAt(e,i,n){super.insertAt(e,i,n),this.enforceAllowedChildren()}optimize(e){super.optimize(e),this.children.length>0&&this.next!=null&&this.checkMerge()&&(this.next.moveChildren(this),this.next.remove())}};tH.blotName="container",tH.scope=Si.BLOCK_BLOT;let Dft=tH;const hB=Dft;class Eft extends Wl{static formats(e,i){}format(e,i){super.formatAt(0,this.length(),e,i)}formatAt(e,i,n,r){e===0&&i===this.length()?this.format(n,r):super.formatAt(e,i,n,r)}formats(){return this.statics.formats(this.domNode,this.scroll)}}const Nd=Eft,Cft={attributes:!0,characterData:!0,characterDataOldValue:!0,childList:!0,subtree:!0},Pft=100,U0=class extends dh{constructor(e,i){super(null,i),this.registry=e,this.scroll=this,this.build(),this.observer=new MutationObserver(n=>{this.update(n)}),this.observer.observe(this.domNode,Cft),this.attach()}create(e,i){return this.registry.create(this,e,i)}find(e,i=!1){const n=this.registry.find(e,i);return n?n.scroll===this?n:i?this.find(n.scroll.domNode.parentNode,!0):null:null}query(e,i=Si.ANY){return this.registry.query(e,i)}register(...e){return this.registry.register(...e)}build(){this.scroll!=null&&super.build()}detach(){super.detach(),this.observer.disconnect()}deleteAt(e,i){this.update(),e===0&&i===this.length()?this.children.forEach(n=>{n.remove()}):super.deleteAt(e,i)}formatAt(e,i,n,r){this.update(),super.formatAt(e,i,n,r)}insertAt(e,i,n){this.update(),super.insertAt(e,i,n)}optimize(e=[],i={}){super.optimize(i);const n=i.mutationsMap||new WeakMap;let r=Array.from(this.observer.takeRecords());for(;r.length>0;)e.push(r.pop());const a=(l,c=!0)=>{l==null||l===this||l.domNode.parentNode!=null&&(n.has(l.domNode)||n.set(l.domNode,[]),c&&a(l.parent))},o=l=>{n.has(l.domNode)&&(l instanceof dh&&l.children.forEach(o),n.delete(l.domNode),l.optimize(i))};let s=e;for(let l=0;s.length>0;l+=1){if(l>=Pft)throw new Error("[Parchment] Maximum optimize iterations reached");for(s.forEach(c=>{const u=this.find(c.target,!0);u!=null&&(u.domNode===c.target&&(c.type==="childList"?(a(this.find(c.previousSibling,!1)),Array.from(c.addedNodes).forEach(d=>{const p=this.find(d,!1);a(p,!1),p instanceof dh&&p.children.forEach(h=>{a(h,!1)})})):c.type==="attributes"&&a(u.prev)),a(u))}),this.children.forEach(o),s=Array.from(this.observer.takeRecords()),r=s.slice();r.length>0;)e.push(r.pop())}}update(e,i={}){e=e||this.observer.takeRecords();const n=new WeakMap;e.map(r=>{const a=this.find(r.target,!0);return a==null?null:n.has(a.domNode)?(n.get(a.domNode).push(r),null):(n.set(a.domNode,[r]),a)}).forEach(r=>{r!=null&&r!==this&&n.has(r.domNode)&&r.update(n.get(r.domNode)||[],i)}),i.mutationsMap=n,n.has(this.domNode)&&super.update(n.get(this.domNode),i),this.optimize(e,i)}};U0.blotName="scroll",U0.defaultChild=WE,U0.allowedChildren=[WE,hB],U0.scope=Si.BLOCK_BLOT,U0.tagName="DIV";let Rft=U0;const nK=Rft,iH=class EEe extends Wl{static create(e){return document.createTextNode(e)}static value(e){return e.data}constructor(e,i){super(e,i),this.text=this.statics.value(this.domNode)}deleteAt(e,i){this.domNode.data=this.text=this.text.slice(0,e)+this.text.slice(e+i)}index(e,i){return this.domNode===e?i:-1}insertAt(e,i,n){n==null?(this.text=this.text.slice(0,e)+i+this.text.slice(e),this.domNode.data=this.text):super.insertAt(e,i,n)}length(){return this.text.length}optimize(e){super.optimize(e),this.text=this.statics.value(this.domNode),this.text.length===0?this.remove():this.next instanceof EEe&&this.next.prev===this&&(this.insertAt(this.length(),this.next.value()),this.next.remove())}position(e,i=!1){return[this.domNode,e]}split(e,i=!1){if(!i){if(e===0)return this;if(e===this.length())return this.next}const n=this.scroll.create(this.domNode.splitText(e));return this.parent.insertBefore(n,this.next||void 0),this.text=this.statics.value(this.domNode),n}update(e,i){e.some(n=>n.type==="characterData"&&n.target===this.domNode)&&(this.text=this.statics.value(this.domNode))}value(){return this.text}};iH.blotName="text",iH.scope=Si.INLINE_BLOT;let Mft=iH;const yk=Mft,Nft=Object.freeze(Object.defineProperty({__proto__:null,Attributor:Kf,AttributorStore:pB,BlockBlot:WE,ClassAttributor:$h,ContainerBlot:hB,EmbedBlot:Nd,InlineBlot:iK,LeafBlot:Wl,ParentBlot:dh,Registry:lT,Scope:Si,ScrollBlot:nK,StyleAttributor:Yy,TextBlot:yk},Symbol.toStringTag,{value:"Module"}));var nH={exports:{}},ud=-1,Pc=1,js=0;function KE(t,e,i,n,r){if(t===e)return t?[[js,t]]:[];if(i!=null){var a=$ft(t,e,i);if(a)return a}var o=rK(t,e),s=t.substring(0,o);t=t.substring(o),e=e.substring(o),o=fB(t,e);var l=t.substring(t.length-o);t=t.substring(0,t.length-o),e=e.substring(0,e.length-o);var c=Aft(t,e);return s&&c.unshift([js,s]),l&&c.push([js,l]),aK(c,r),n&&xft(c),c}function Aft(t,e){var i;if(!t)return[[Pc,e]];if(!e)return[[ud,t]];var n=t.length>e.length?t:e,r=t.length>e.length?e:t,a=n.indexOf(r);if(a!==-1)return i=[[Pc,n.substring(0,a)],[js,r],[Pc,n.substring(a+r.length)]],t.length>e.length&&(i[0][0]=i[2][0]=ud),i;if(r.length===1)return[[ud,t],[Pc,e]];var o=kft(t,e);if(o){var s=o[0],l=o[1],c=o[2],u=o[3],d=o[4],p=KE(s,c),h=KE(l,u);return p.concat([[js,d]],h)}return _ft(t,e)}function _ft(t,e){for(var i=t.length,n=e.length,r=Math.ceil((i+n)/2),a=r,o=2*r,s=new Array(o),l=new Array(o),c=0;c<o;c++)s[c]=-1,l[c]=-1;s[a+1]=0,l[a+1]=0;for(var u=i-n,d=u%2!==0,p=0,h=0,f=0,m=0,g=0;g<r;g++){for(var v=-g+p;v<=g-h;v+=2){var y=a+v,b;v===-g||v!==g&&s[y-1]<s[y+1]?b=s[y+1]:b=s[y-1]+1;for(var I=b-v;b<i&&I<n&&t.charAt(b)===e.charAt(I);)b++,I++;if(s[y]=b,b>i)h+=2;else if(I>n)p+=2;else if(d){var T=a+u-v;if(T>=0&&T<o&&l[T]!==-1){var w=i-l[T];if(b>=w)return vte(t,e,b,I)}}}for(var S=-g+f;S<=g-m;S+=2){var T=a+S,w;S===-g||S!==g&&l[T-1]<l[T+1]?w=l[T+1]:w=l[T-1]+1;for(var D=w-S;w<i&&D<n&&t.charAt(i-w-1)===e.charAt(n-D-1);)w++,D++;if(l[T]=w,w>i)m+=2;else if(D>n)f+=2;else if(!d){var y=a+u-S;if(y>=0&&y<o&&s[y]!==-1){var b=s[y],I=a+b-y;if(w=i-w,b>=w)return vte(t,e,b,I)}}}}return[[ud,t],[Pc,e]]}function vte(t,e,i,n){var r=t.substring(0,i),a=e.substring(0,n),o=t.substring(i),s=e.substring(n),l=KE(r,a),c=KE(o,s);return l.concat(c)}function rK(t,e){if(!t||!e||t.charAt(0)!==e.charAt(0))return 0;for(var i=0,n=Math.min(t.length,e.length),r=n,a=0;i<r;)t.substring(a,r)==e.substring(a,r)?(i=r,a=i):n=r,r=Math.floor((n-i)/2+i);return CEe(t.charCodeAt(r-1))&&r--,r}function yte(t,e){var i=t.length,n=e.length;if(i==0||n==0)return 0;i>n?t=t.substring(i-n):i<n&&(e=e.substring(0,i));var r=Math.min(i,n);if(t==e)return r;for(var a=0,o=1;;){var s=t.substring(r-o),l=e.indexOf(s);if(l==-1)return a;o+=l,(l==0||t.substring(r-o)==e.substring(0,o))&&(a=o,o++)}}function fB(t,e){if(!t||!e||t.slice(-1)!==e.slice(-1))return 0;for(var i=0,n=Math.min(t.length,e.length),r=n,a=0;i<r;)t.substring(t.length-r,t.length-a)==e.substring(e.length-r,e.length-a)?(i=r,a=i):n=r,r=Math.floor((n-i)/2+i);return PEe(t.charCodeAt(t.length-r))&&r--,r}function kft(t,e){var i=t.length>e.length?t:e,n=t.length>e.length?e:t;if(i.length<4||n.length*2<i.length)return null;function r(h,f,m){for(var g=h.substring(m,m+Math.floor(h.length/4)),v=-1,y="",b,I,T,w;(v=f.indexOf(g,v+1))!==-1;){var S=rK(h.substring(m),f.substring(v)),D=fB(h.substring(0,m),f.substring(0,v));y.length<D+S&&(y=f.substring(v-D,v)+f.substring(v,v+S),b=h.substring(0,m-D),I=h.substring(m+S),T=f.substring(0,v-D),w=f.substring(v+S))}return y.length*2>=h.length?[b,I,T,w,y]:null}var a=r(i,n,Math.ceil(i.length/4)),o=r(i,n,Math.ceil(i.length/2)),s;if(!a&&!o)return null;o?a?s=a[4].length>o[4].length?a:o:s=o:s=a;var l,c,u,d;t.length>e.length?(l=s[0],c=s[1],u=s[2],d=s[3]):(u=s[0],d=s[1],l=s[2],c=s[3]);var p=s[4];return[l,c,u,d,p]}function xft(t){for(var e=!1,i=[],n=0,r=null,a=0,o=0,s=0,l=0,c=0;a<t.length;)t[a][0]==js?(i[n++]=a,o=l,s=c,l=0,c=0,r=t[a][1]):(t[a][0]==Pc?l+=t[a][1].length:c+=t[a][1].length,r&&r.length<=Math.max(o,s)&&r.length<=Math.max(l,c)&&(t.splice(i[n-1],0,[ud,r]),t[i[n-1]+1][0]=Pc,n--,n--,a=n>0?i[n-1]:-1,o=0,s=0,l=0,c=0,r=null,e=!0)),a++;for(e&&aK(t),Fft(t),a=1;a<t.length;){if(t[a-1][0]==ud&&t[a][0]==Pc){var u=t[a-1][1],d=t[a][1],p=yte(u,d),h=yte(d,u);p>=h?(p>=u.length/2||p>=d.length/2)&&(t.splice(a,0,[js,d.substring(0,p)]),t[a-1][1]=u.substring(0,u.length-p),t[a+1][1]=d.substring(p),a++):(h>=u.length/2||h>=d.length/2)&&(t.splice(a,0,[js,u.substring(0,h)]),t[a-1][0]=Pc,t[a-1][1]=d.substring(0,d.length-h),t[a+1][0]=ud,t[a+1][1]=u.substring(h),a++),a++}a++}}var bte=/[^a-zA-Z0-9]/,Ite=/\s/,wte=/[\r\n]/,Oft=/\n\r?\n$/,Lft=/^\r?\n\r?\n/;function Fft(t){function e(h,f){if(!h||!f)return 6;var m=h.charAt(h.length-1),g=f.charAt(0),v=m.match(bte),y=g.match(bte),b=v&&m.match(Ite),I=y&&g.match(Ite),T=b&&m.match(wte),w=I&&g.match(wte),S=T&&h.match(Oft),D=w&&f.match(Lft);return S||D?5:T||w?4:v&&!b&&I?3:b||I?2:v||y?1:0}for(var i=1;i<t.length-1;){if(t[i-1][0]==js&&t[i+1][0]==js){var n=t[i-1][1],r=t[i][1],a=t[i+1][1],o=fB(n,r);if(o){var s=r.substring(r.length-o);n=n.substring(0,n.length-o),r=s+r.substring(0,r.length-o),a=s+a}for(var l=n,c=r,u=a,d=e(n,r)+e(r,a);r.charAt(0)===a.charAt(0);){n+=r.charAt(0),r=r.substring(1)+a.charAt(0),a=a.substring(1);var p=e(n,r)+e(r,a);p>=d&&(d=p,l=n,c=r,u=a)}t[i-1][1]!=l&&(l?t[i-1][1]=l:(t.splice(i-1,1),i--),t[i][1]=c,u?t[i+1][1]=u:(t.splice(i+1,1),i--))}i++}}function aK(t,e){t.push([js,""]);for(var i=0,n=0,r=0,a="",o="",s;i<t.length;){if(i<t.length-1&&!t[i][1]){t.splice(i,1);continue}switch(t[i][0]){case Pc:r++,o+=t[i][1],i++;break;case ud:n++,a+=t[i][1],i++;break;case js:var l=i-r-n-1;if(e){if(l>=0&&MEe(t[l][1])){var c=t[l][1].slice(-1);if(t[l][1]=t[l][1].slice(0,-1),a=c+a,o=c+o,!t[l][1]){t.splice(l,1),i--;var u=l-1;t[u]&&t[u][0]===Pc&&(r++,o=t[u][1]+o,u--),t[u]&&t[u][0]===ud&&(n++,a=t[u][1]+a,u--),l=u}}if(REe(t[i][1])){var c=t[i][1].charAt(0);t[i][1]=t[i][1].slice(1),a+=c,o+=c}}if(i<t.length-1&&!t[i][1]){t.splice(i,1);break}if(a.length>0||o.length>0){a.length>0&&o.length>0&&(s=rK(o,a),s!==0&&(l>=0?t[l][1]+=o.substring(0,s):(t.splice(0,0,[js,o.substring(0,s)]),i++),o=o.substring(s),a=a.substring(s)),s=fB(o,a),s!==0&&(t[i][1]=o.substring(o.length-s)+t[i][1],o=o.substring(0,o.length-s),a=a.substring(0,a.length-s)));var d=r+n;a.length===0&&o.length===0?(t.splice(i-d,d),i=i-d):a.length===0?(t.splice(i-d,d,[Pc,o]),i=i-d+1):o.length===0?(t.splice(i-d,d,[ud,a]),i=i-d+1):(t.splice(i-d,d,[ud,a],[Pc,o]),i=i-d+2)}i!==0&&t[i-1][0]===js?(t[i-1][1]+=t[i][1],t.splice(i,1)):i++,r=0,n=0,a="",o="";break}}t[t.length-1][1]===""&&t.pop();var p=!1;for(i=1;i<t.length-1;)t[i-1][0]===js&&t[i+1][0]===js&&(t[i][1].substring(t[i][1].length-t[i-1][1].length)===t[i-1][1]?(t[i][1]=t[i-1][1]+t[i][1].substring(0,t[i][1].length-t[i-1][1].length),t[i+1][1]=t[i-1][1]+t[i+1][1],t.splice(i-1,1),p=!0):t[i][1].substring(0,t[i+1][1].length)==t[i+1][1]&&(t[i-1][1]+=t[i+1][1],t[i][1]=t[i][1].substring(t[i+1][1].length)+t[i+1][1],t.splice(i+1,1),p=!0)),i++;p&&aK(t,e)}function CEe(t){return t>=55296&&t<=56319}function PEe(t){return t>=56320&&t<=57343}function REe(t){return PEe(t.charCodeAt(0))}function MEe(t){return CEe(t.charCodeAt(t.length-1))}function Bft(t){for(var e=[],i=0;i<t.length;i++)t[i][1].length>0&&e.push(t[i]);return e}function s2(t,e,i,n){return MEe(t)||REe(n)?null:Bft([[js,t],[ud,e],[Pc,i],[js,n]])}function $ft(t,e,i){var n=typeof i=="number"?{index:i,length:0}:i.oldRange,r=typeof i=="number"?null:i.newRange,a=t.length,o=e.length;if(n.length===0&&(r===null||r.length===0)){var s=n.index,l=t.slice(0,s),c=t.slice(s),u=r?r.index:null;e:{var d=s+o-a;if(u!==null&&u!==d||d<0||d>o)break e;var p=e.slice(0,d),h=e.slice(d);if(h!==c)break e;var f=Math.min(s,d),m=l.slice(0,f),g=p.slice(0,f);if(m!==g)break e;var v=l.slice(f),y=p.slice(f);return s2(m,v,y,c)}e:{if(u!==null&&u!==s)break e;var b=s,p=e.slice(0,b),h=e.slice(b);if(p!==l)break e;var I=Math.min(a-b,o-b),T=c.slice(c.length-I),w=h.slice(h.length-I);if(T!==w)break e;var v=c.slice(0,c.length-I),y=h.slice(0,h.length-I);return s2(l,v,y,T)}}if(n.length>0&&r&&r.length===0)e:{var m=t.slice(0,n.index),T=t.slice(n.index+n.length),f=m.length,I=T.length;if(o<f+I)break e;var g=e.slice(0,f),w=e.slice(o-I);if(m!==g||T!==w)break e;var v=t.slice(f,a-I),y=e.slice(f,o-I);return s2(m,v,y,T)}return null}function mB(t,e,i,n){return KE(t,e,i,n,!0)}mB.INSERT=Pc;mB.DELETE=ud;mB.EQUAL=js;var Vft=mB,bk={exports:{}};bk.exports;(function(t,e){var i=200,n="__lodash_hash_undefined__",r=9007199254740991,a="[object Arguments]",o="[object Array]",s="[object Boolean]",l="[object Date]",c="[object Error]",u="[object Function]",d="[object GeneratorFunction]",p="[object Map]",h="[object Number]",f="[object Object]",m="[object Promise]",g="[object RegExp]",v="[object Set]",y="[object String]",b="[object Symbol]",I="[object WeakMap]",T="[object ArrayBuffer]",w="[object DataView]",S="[object Float32Array]",D="[object Float64Array]",E="[object Int8Array]",C="[object Int16Array]",P="[object Int32Array]",R="[object Uint8Array]",N="[object Uint8ClampedArray]",M="[object Uint16Array]",A="[object Uint32Array]",_=/[\\^$.*+?()[\]{}|]/g,x=/\w*$/,O=/^\[object .+?Constructor\]$/,B=/^(?:0|[1-9]\d*)$/,F={};F[a]=F[o]=F[T]=F[w]=F[s]=F[l]=F[S]=F[D]=F[E]=F[C]=F[P]=F[p]=F[h]=F[f]=F[g]=F[v]=F[y]=F[b]=F[R]=F[N]=F[M]=F[A]=!0,F[c]=F[u]=F[I]=!1;var G=typeof Zd=="object"&&Zd&&Zd.Object===Object&&Zd,H=typeof self=="object"&&self&&self.Object===Object&&self,$=G||H||Function("return this")(),q=e&&!e.nodeType&&e,z=q&&!0&&t&&!t.nodeType&&t,Z=z&&z.exports===q;function Y(ee,be){return ee.set(be[0],be[1]),ee}function Q(ee,be){return ee.add(be),ee}function X(ee,be){for(var Ae=-1,dt=ee?ee.length:0;++Ae<dt&&be(ee[Ae],Ae,ee)!==!1;);return ee}function oe(ee,be){for(var Ae=-1,dt=be.length,qi=ee.length;++Ae<dt;)ee[qi+Ae]=be[Ae];return ee}function re(ee,be,Ae,dt){var qi=-1,gi=ee?ee.length:0;for(dt&&gi&&(Ae=ee[++qi]);++qi<gi;)Ae=be(Ae,ee[qi],qi,ee);return Ae}function me(ee,be){for(var Ae=-1,dt=Array(ee);++Ae<ee;)dt[Ae]=be(Ae);return dt}function se(ee,be){return ee==null?void 0:ee[be]}function te(ee){var be=!1;if(ee!=null&&typeof ee.toString!="function")try{be=!!(ee+"")}catch{}return be}function he(ee){var be=-1,Ae=Array(ee.size);return ee.forEach(function(dt,qi){Ae[++be]=[qi,dt]}),Ae}function ae(ee,be){return function(Ae){return ee(be(Ae))}}function de(ee){var be=-1,Ae=Array(ee.size);return ee.forEach(function(dt){Ae[++be]=dt}),Ae}var Ie=Array.prototype,De=Function.prototype,Te=Object.prototype,_e=$["__core-js_shared__"],Ve=function(){var ee=/[^.]+$/.exec(_e&&_e.keys&&_e.keys.IE_PROTO||"");return ee?"Symbol(src)_1."+ee:""}(),ot=De.toString,St=Te.hasOwnProperty,nt=Te.toString,Bt=RegExp("^"+ot.call(St).replace(_,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Pe=Z?$.Buffer:void 0,et=$.Symbol,Ee=$.Uint8Array,lt=ae(Object.getPrototypeOf,Object),Ke=Object.create,bt=Te.propertyIsEnumerable,gt=Ie.splice,Ue=Object.getOwnPropertySymbols,xe=Pe?Pe.isBuffer:void 0,We=ae(Object.keys,Object),st=ur($,"DataView"),vt=ur($,"Map"),ge=ur($,"Promise"),Se=ur($,"Set"),qe=ur($,"WeakMap"),$e=ur(Object,"create"),ke=Jo(st),Ut=Jo(vt),pt=Jo(ge),tt=Jo(Se),At=Jo(qe),ei=et?et.prototype:void 0,vi=ei?ei.valueOf:void 0;function Ln(ee){var be=-1,Ae=ee?ee.length:0;for(this.clear();++be<Ae;){var dt=ee[be];this.set(dt[0],dt[1])}}function gn(){this.__data__=$e?$e(null):{}}function Jt(ee){return this.has(ee)&&delete this.__data__[ee]}function kr(ee){var be=this.__data__;if($e){var Ae=be[ee];return Ae===n?void 0:Ae}return St.call(be,ee)?be[ee]:void 0}function Kn(ee){var be=this.__data__;return $e?be[ee]!==void 0:St.call(be,ee)}function Gt(ee,be){var Ae=this.__data__;return Ae[ee]=$e&&be===void 0?n:be,this}Ln.prototype.clear=gn,Ln.prototype.delete=Jt,Ln.prototype.get=kr,Ln.prototype.has=Kn,Ln.prototype.set=Gt;function Ji(ee){var be=-1,Ae=ee?ee.length:0;for(this.clear();++be<Ae;){var dt=ee[be];this.set(dt[0],dt[1])}}function xo(){this.__data__=[]}function na(ee){var be=this.__data__,Ae=hi(be,ee);if(Ae<0)return!1;var dt=be.length-1;return Ae==dt?be.pop():gt.call(be,Ae,1),!0}function ra(ee){var be=this.__data__,Ae=hi(be,ee);return Ae<0?void 0:be[Ae][1]}function vo(ee){return hi(this.__data__,ee)>-1}function aa(ee,be){var Ae=this.__data__,dt=hi(Ae,ee);return dt<0?Ae.push([ee,be]):Ae[dt][1]=be,this}Ji.prototype.clear=xo,Ji.prototype.delete=na,Ji.prototype.get=ra,Ji.prototype.has=vo,Ji.prototype.set=aa;function fr(ee){var be=-1,Ae=ee?ee.length:0;for(this.clear();++be<Ae;){var dt=ee[be];this.set(dt[0],dt[1])}}function Ma(){this.__data__={hash:new Ln,map:new(vt||Ji),string:new Ln}}function tu(ee){return ji(this,ee).delete(ee)}function Zo(ee){return ji(this,ee).get(ee)}function Xs(ee){return ji(this,ee).has(ee)}function Os(ee,be){return ji(this,ee).set(ee,be),this}fr.prototype.clear=Ma,fr.prototype.delete=tu,fr.prototype.get=Zo,fr.prototype.has=Xs,fr.prototype.set=Os;function Qi(ee){this.__data__=new Ji(ee)}function za(){this.__data__=new Ji}function Pr(ee){return this.__data__.delete(ee)}function Vi(ee){return this.__data__.get(ee)}function Ls(ee){return this.__data__.has(ee)}function hl(ee,be){var Ae=this.__data__;if(Ae instanceof Ji){var dt=Ae.__data__;if(!vt||dt.length<i-1)return dt.push([ee,be]),this;Ae=this.__data__=new fr(dt)}return Ae.set(ee,be),this}Qi.prototype.clear=za,Qi.prototype.delete=Pr,Qi.prototype.get=Vi,Qi.prototype.has=Ls,Qi.prototype.set=hl;function Fs(ee,be){var Ae=Oo(ee)||Li(ee)?me(ee.length,String):[],dt=Ae.length,qi=!!dt;for(var gi in ee)(be||St.call(ee,gi))&&!(qi&&(gi=="length"||Bs(gi,dt)))&&Ae.push(gi);return Ae}function mt(ee,be,Ae){var dt=ee[be];(!(St.call(ee,be)&&fl(dt,Ae))||Ae===void 0&&!(be in ee))&&(ee[be]=Ae)}function hi(ee,be){for(var Ae=ee.length;Ae--;)if(fl(ee[Ae][0],be))return Ae;return-1}function Nn(ee,be){return ee&&Oi(be,ml(be),ee)}function xr(ee,be,Ae,dt,qi,gi,kn){var ii;if(dt&&(ii=gi?dt(ee,qi,gi,kn):dt(ee)),ii!==void 0)return ii;if(!Qo(ee))return ee;var po=Oo(ee);if(po){if(ii=jl(ee),!be)return oi(ee,ii)}else{var En=Sa(ee),_a=En==u||En==d;if(Hh(ee))return Dn(ee,be);if(En==f||En==a||_a&&!gi){if(te(ee))return gi?ee:{};if(ii=Xo(_a?{}:ee),!be)return nn(ee,Nn(ii,ee))}else{if(!F[En])return gi?ee:{};ii=Aa(ee,En,xr,be)}}kn||(kn=new Qi);var es=kn.get(ee);if(es)return es;if(kn.set(ee,ii),!po)var ho=Ae?si(ee):ml(ee);return X(ho||ee,function(Wa,fo){ho&&(fo=Wa,Wa=ee[fo]),mt(ii,fo,xr(Wa,be,Ae,dt,fo,ee,kn))}),ii}function cs(ee){return Qo(ee)?Ke(ee):{}}function pn(ee,be,Ae){var dt=be(ee);return Oo(ee)?dt:oe(dt,Ae(ee))}function Un(ee){return nt.call(ee)}function mr(ee){if(!Qo(ee)||Gl(ee))return!1;var be=us(ee)||te(ee)?Bt:O;return be.test(Jo(ee))}function Vl(ee){if(!_d(ee))return We(ee);var be=[];for(var Ae in Object(ee))St.call(ee,Ae)&&Ae!="constructor"&&be.push(Ae);return be}function Dn(ee,be){if(be)return ee.slice();var Ae=new ee.constructor(ee.length);return ee.copy(Ae),Ae}function Na(ee){var be=new ee.constructor(ee.byteLength);return new Ee(be).set(new Ee(ee)),be}function Yi(ee,be){var Ae=be?Na(ee.buffer):ee.buffer;return new ee.constructor(Ae,ee.byteOffset,ee.byteLength)}function Di(ee,be,Ae){var dt=be?Ae(he(ee),!0):he(ee);return re(dt,Y,new ee.constructor)}function gr(ee){var be=new ee.constructor(ee.source,x.exec(ee));return be.lastIndex=ee.lastIndex,be}function xi(ee,be,Ae){var dt=be?Ae(de(ee),!0):de(ee);return re(dt,Q,new ee.constructor)}function vr(ee){return vi?Object(vi.call(ee)):{}}function _t(ee,be){var Ae=be?Na(ee.buffer):ee.buffer;return new ee.constructor(Ae,ee.byteOffset,ee.length)}function oi(ee,be){var Ae=-1,dt=ee.length;for(be||(be=Array(dt));++Ae<dt;)be[Ae]=ee[Ae];return be}function Oi(ee,be,Ae,dt){Ae||(Ae={});for(var qi=-1,gi=be.length;++qi<gi;){var kn=be[qi],ii=dt?dt(Ae[kn],ee[kn],kn,Ae,ee):void 0;mt(Ae,kn,ii===void 0?ee[kn]:ii)}return Ae}function nn(ee,be){return Oi(ee,Mi(ee),be)}function si(ee){return pn(ee,ml,Mi)}function ji(ee,be){var Ae=ee.__data__;return Ad(be)?Ae[typeof be=="string"?"string":"hash"]:Ae.map}function ur(ee,be){var Ae=se(ee,be);return mr(Ae)?Ae:void 0}var Mi=Ue?ae(Ue,Object):qa,Sa=Un;(st&&Sa(new st(new ArrayBuffer(1)))!=w||vt&&Sa(new vt)!=p||ge&&Sa(ge.resolve())!=m||Se&&Sa(new Se)!=v||qe&&Sa(new qe)!=I)&&(Sa=function(ee){var be=nt.call(ee),Ae=be==f?ee.constructor:void 0,dt=Ae?Jo(Ae):void 0;if(dt)switch(dt){case ke:return w;case Ut:return p;case pt:return m;case tt:return v;case At:return I}return be});function jl(ee){var be=ee.length,Ae=ee.constructor(be);return be&&typeof ee[0]=="string"&&St.call(ee,"index")&&(Ae.index=ee.index,Ae.input=ee.input),Ae}function Xo(ee){return typeof ee.constructor=="function"&&!_d(ee)?cs(lt(ee)):{}}function Aa(ee,be,Ae,dt){var qi=ee.constructor;switch(be){case T:return Na(ee);case s:case l:return new qi(+ee);case w:return Yi(ee,dt);case S:case D:case E:case C:case P:case R:case N:case M:case A:return _t(ee,dt);case p:return Di(ee,dt,Ae);case h:case y:return new qi(ee);case g:return gr(ee);case v:return xi(ee,dt,Ae);case b:return vr(ee)}}function Bs(ee,be){return be=be??r,!!be&&(typeof ee=="number"||B.test(ee))&&ee>-1&&ee%1==0&&ee<be}function Ad(ee){var be=typeof ee;return be=="string"||be=="number"||be=="symbol"||be=="boolean"?ee!=="__proto__":ee===null}function Gl(ee){return!!Ve&&Ve in ee}function _d(ee){var be=ee&&ee.constructor,Ae=typeof be=="function"&&be.prototype||Te;return ee===Ae}function Jo(ee){if(ee!=null){try{return ot.call(ee)}catch{}try{return ee+""}catch{}}return""}function Ta(ee){return xr(ee,!0,!0)}function fl(ee,be){return ee===be||ee!==ee&&be!==be}function Li(ee){return fc(ee)&&St.call(ee,"callee")&&(!bt.call(ee,"callee")||nt.call(ee)==a)}var Oo=Array.isArray;function lr(ee){return ee!=null&&kd(ee.length)&&!us(ee)}function fc(ee){return xd(ee)&&lr(ee)}var Hh=xe||iu;function us(ee){var be=Qo(ee)?nt.call(ee):"";return be==u||be==d}function kd(ee){return typeof ee=="number"&&ee>-1&&ee%1==0&&ee<=r}function Qo(ee){var be=typeof ee;return!!ee&&(be=="object"||be=="function")}function xd(ee){return!!ee&&typeof ee=="object"}function ml(ee){return lr(ee)?Fs(ee):Vl(ee)}function qa(){return[]}function iu(){return!1}t.exports=Ta})(bk,bk.exports);var NEe=bk.exports,Ik={exports:{}};Ik.exports;(function(t,e){var i=200,n="__lodash_hash_undefined__",r=1,a=2,o=9007199254740991,s="[object Arguments]",l="[object Array]",c="[object AsyncFunction]",u="[object Boolean]",d="[object Date]",p="[object Error]",h="[object Function]",f="[object GeneratorFunction]",m="[object Map]",g="[object Number]",v="[object Null]",y="[object Object]",b="[object Promise]",I="[object Proxy]",T="[object RegExp]",w="[object Set]",S="[object String]",D="[object Symbol]",E="[object Undefined]",C="[object WeakMap]",P="[object ArrayBuffer]",R="[object DataView]",N="[object Float32Array]",M="[object Float64Array]",A="[object Int8Array]",_="[object Int16Array]",x="[object Int32Array]",O="[object Uint8Array]",B="[object Uint8ClampedArray]",F="[object Uint16Array]",G="[object Uint32Array]",H=/[\\^$.*+?()[\]{}|]/g,$=/^\[object .+?Constructor\]$/,q=/^(?:0|[1-9]\d*)$/,z={};z[N]=z[M]=z[A]=z[_]=z[x]=z[O]=z[B]=z[F]=z[G]=!0,z[s]=z[l]=z[P]=z[u]=z[R]=z[d]=z[p]=z[h]=z[m]=z[g]=z[y]=z[T]=z[w]=z[S]=z[C]=!1;var Z=typeof Zd=="object"&&Zd&&Zd.Object===Object&&Zd,Y=typeof self=="object"&&self&&self.Object===Object&&self,Q=Z||Y||Function("return this")(),X=e&&!e.nodeType&&e,oe=X&&!0&&t&&!t.nodeType&&t,re=oe&&oe.exports===X,me=re&&Z.process,se=function(){try{return me&&me.binding&&me.binding("util")}catch{}}(),te=se&&se.isTypedArray;function he(ee,be){for(var Ae=-1,dt=ee==null?0:ee.length,qi=0,gi=[];++Ae<dt;){var kn=ee[Ae];be(kn,Ae,ee)&&(gi[qi++]=kn)}return gi}function ae(ee,be){for(var Ae=-1,dt=be.length,qi=ee.length;++Ae<dt;)ee[qi+Ae]=be[Ae];return ee}function de(ee,be){for(var Ae=-1,dt=ee==null?0:ee.length;++Ae<dt;)if(be(ee[Ae],Ae,ee))return!0;return!1}function Ie(ee,be){for(var Ae=-1,dt=Array(ee);++Ae<ee;)dt[Ae]=be(Ae);return dt}function De(ee){return function(be){return ee(be)}}function Te(ee,be){return ee.has(be)}function _e(ee,be){return ee==null?void 0:ee[be]}function Ve(ee){var be=-1,Ae=Array(ee.size);return ee.forEach(function(dt,qi){Ae[++be]=[qi,dt]}),Ae}function ot(ee,be){return function(Ae){return ee(be(Ae))}}function St(ee){var be=-1,Ae=Array(ee.size);return ee.forEach(function(dt){Ae[++be]=dt}),Ae}var nt=Array.prototype,Bt=Function.prototype,Pe=Object.prototype,et=Q["__core-js_shared__"],Ee=Bt.toString,lt=Pe.hasOwnProperty,Ke=function(){var ee=/[^.]+$/.exec(et&&et.keys&&et.keys.IE_PROTO||"");return ee?"Symbol(src)_1."+ee:""}(),bt=Pe.toString,gt=RegExp("^"+Ee.call(lt).replace(H,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Ue=re?Q.Buffer:void 0,xe=Q.Symbol,We=Q.Uint8Array,st=Pe.propertyIsEnumerable,vt=nt.splice,ge=xe?xe.toStringTag:void 0,Se=Object.getOwnPropertySymbols,qe=Ue?Ue.isBuffer:void 0,$e=ot(Object.keys,Object),ke=Mi(Q,"DataView"),Ut=Mi(Q,"Map"),pt=Mi(Q,"Promise"),tt=Mi(Q,"Set"),At=Mi(Q,"WeakMap"),ei=Mi(Object,"create"),vi=Jo(ke),Ln=Jo(Ut),gn=Jo(pt),Jt=Jo(tt),kr=Jo(At),Kn=xe?xe.prototype:void 0,Gt=Kn?Kn.valueOf:void 0;function Ji(ee){var be=-1,Ae=ee==null?0:ee.length;for(this.clear();++be<Ae;){var dt=ee[be];this.set(dt[0],dt[1])}}function xo(){this.__data__=ei?ei(null):{},this.size=0}function na(ee){var be=this.has(ee)&&delete this.__data__[ee];return this.size-=be?1:0,be}function ra(ee){var be=this.__data__;if(ei){var Ae=be[ee];return Ae===n?void 0:Ae}return lt.call(be,ee)?be[ee]:void 0}function vo(ee){var be=this.__data__;return ei?be[ee]!==void 0:lt.call(be,ee)}function aa(ee,be){var Ae=this.__data__;return this.size+=this.has(ee)?0:1,Ae[ee]=ei&&be===void 0?n:be,this}Ji.prototype.clear=xo,Ji.prototype.delete=na,Ji.prototype.get=ra,Ji.prototype.has=vo,Ji.prototype.set=aa;function fr(ee){var be=-1,Ae=ee==null?0:ee.length;for(this.clear();++be<Ae;){var dt=ee[be];this.set(dt[0],dt[1])}}function Ma(){this.__data__=[],this.size=0}function tu(ee){var be=this.__data__,Ae=Dn(be,ee);if(Ae<0)return!1;var dt=be.length-1;return Ae==dt?be.pop():vt.call(be,Ae,1),--this.size,!0}function Zo(ee){var be=this.__data__,Ae=Dn(be,ee);return Ae<0?void 0:be[Ae][1]}function Xs(ee){return Dn(this.__data__,ee)>-1}function Os(ee,be){var Ae=this.__data__,dt=Dn(Ae,ee);return dt<0?(++this.size,Ae.push([ee,be])):Ae[dt][1]=be,this}fr.prototype.clear=Ma,fr.prototype.delete=tu,fr.prototype.get=Zo,fr.prototype.has=Xs,fr.prototype.set=Os;function Qi(ee){var be=-1,Ae=ee==null?0:ee.length;for(this.clear();++be<Ae;){var dt=ee[be];this.set(dt[0],dt[1])}}function za(){this.size=0,this.__data__={hash:new Ji,map:new(Ut||fr),string:new Ji}}function Pr(ee){var be=ur(this,ee).delete(ee);return this.size-=be?1:0,be}function Vi(ee){return ur(this,ee).get(ee)}function Ls(ee){return ur(this,ee).has(ee)}function hl(ee,be){var Ae=ur(this,ee),dt=Ae.size;return Ae.set(ee,be),this.size+=Ae.size==dt?0:1,this}Qi.prototype.clear=za,Qi.prototype.delete=Pr,Qi.prototype.get=Vi,Qi.prototype.has=Ls,Qi.prototype.set=hl;function Fs(ee){var be=-1,Ae=ee==null?0:ee.length;for(this.__data__=new Qi;++be<Ae;)this.add(ee[be])}function mt(ee){return this.__data__.set(ee,n),this}function hi(ee){return this.__data__.has(ee)}Fs.prototype.add=Fs.prototype.push=mt,Fs.prototype.has=hi;function Nn(ee){var be=this.__data__=new fr(ee);this.size=be.size}function xr(){this.__data__=new fr,this.size=0}function cs(ee){var be=this.__data__,Ae=be.delete(ee);return this.size=be.size,Ae}function pn(ee){return this.__data__.get(ee)}function Un(ee){return this.__data__.has(ee)}function mr(ee,be){var Ae=this.__data__;if(Ae instanceof fr){var dt=Ae.__data__;if(!Ut||dt.length<i-1)return dt.push([ee,be]),this.size=++Ae.size,this;Ae=this.__data__=new Qi(dt)}return Ae.set(ee,be),this.size=Ae.size,this}Nn.prototype.clear=xr,Nn.prototype.delete=cs,Nn.prototype.get=pn,Nn.prototype.has=Un,Nn.prototype.set=mr;function Vl(ee,be){var Ae=Li(ee),dt=!Ae&&fl(ee),qi=!Ae&&!dt&&lr(ee),gi=!Ae&&!dt&&!qi&&xd(ee),kn=Ae||dt||qi||gi,ii=kn?Ie(ee.length,String):[],po=ii.length;for(var En in ee)(be||lt.call(ee,En))&&!(kn&&(En=="length"||qi&&(En=="offset"||En=="parent")||gi&&(En=="buffer"||En=="byteLength"||En=="byteOffset")||Aa(En,po)))&&ii.push(En);return ii}function Dn(ee,be){for(var Ae=ee.length;Ae--;)if(Ta(ee[Ae][0],be))return Ae;return-1}function Na(ee,be,Ae){var dt=be(ee);return Li(ee)?dt:ae(dt,Ae(ee))}function Yi(ee){return ee==null?ee===void 0?E:v:ge&&ge in Object(ee)?Sa(ee):_d(ee)}function Di(ee){return Qo(ee)&&Yi(ee)==s}function gr(ee,be,Ae,dt,qi){return ee===be?!0:ee==null||be==null||!Qo(ee)&&!Qo(be)?ee!==ee&&be!==be:xi(ee,be,Ae,dt,gr,qi)}function xi(ee,be,Ae,dt,qi,gi){var kn=Li(ee),ii=Li(be),po=kn?l:Xo(ee),En=ii?l:Xo(be);po=po==s?y:po,En=En==s?y:En;var _a=po==y,es=En==y,ho=po==En;if(ho&&lr(ee)){if(!lr(be))return!1;kn=!0,_a=!1}if(ho&&!_a)return gi||(gi=new Nn),kn||xd(ee)?Oi(ee,be,Ae,dt,qi,gi):nn(ee,be,po,Ae,dt,qi,gi);if(!(Ae&r)){var Wa=_a&&lt.call(ee,"__wrapped__"),fo=es&&lt.call(be,"__wrapped__");if(Wa||fo){var Hl=Wa?ee.value():ee,nu=fo?be.value():be;return gi||(gi=new Nn),qi(Hl,nu,Ae,dt,gi)}}return ho?(gi||(gi=new Nn),si(ee,be,Ae,dt,qi,gi)):!1}function vr(ee){if(!kd(ee)||Ad(ee))return!1;var be=Hh(ee)?gt:$;return be.test(Jo(ee))}function _t(ee){return Qo(ee)&&us(ee.length)&&!!z[Yi(ee)]}function oi(ee){if(!Gl(ee))return $e(ee);var be=[];for(var Ae in Object(ee))lt.call(ee,Ae)&&Ae!="constructor"&&be.push(Ae);return be}function Oi(ee,be,Ae,dt,qi,gi){var kn=Ae&r,ii=ee.length,po=be.length;if(ii!=po&&!(kn&&po>ii))return!1;var En=gi.get(ee);if(En&&gi.get(be))return En==be;var _a=-1,es=!0,ho=Ae&a?new Fs:void 0;for(gi.set(ee,be),gi.set(be,ee);++_a<ii;){var Wa=ee[_a],fo=be[_a];if(dt)var Hl=kn?dt(fo,Wa,_a,be,ee,gi):dt(Wa,fo,_a,ee,be,gi);if(Hl!==void 0){if(Hl)continue;es=!1;break}if(ho){if(!de(be,function(nu,xp){if(!Te(ho,xp)&&(Wa===nu||qi(Wa,nu,Ae,dt,gi)))return ho.push(xp)})){es=!1;break}}else if(!(Wa===fo||qi(Wa,fo,Ae,dt,gi))){es=!1;break}}return gi.delete(ee),gi.delete(be),es}function nn(ee,be,Ae,dt,qi,gi,kn){switch(Ae){case R:if(ee.byteLength!=be.byteLength||ee.byteOffset!=be.byteOffset)return!1;ee=ee.buffer,be=be.buffer;case P:return!(ee.byteLength!=be.byteLength||!gi(new We(ee),new We(be)));case u:case d:case g:return Ta(+ee,+be);case p:return ee.name==be.name&&ee.message==be.message;case T:case S:return ee==be+"";case m:var ii=Ve;case w:var po=dt&r;if(ii||(ii=St),ee.size!=be.size&&!po)return!1;var En=kn.get(ee);if(En)return En==be;dt|=a,kn.set(ee,be);var _a=Oi(ii(ee),ii(be),dt,qi,gi,kn);return kn.delete(ee),_a;case D:if(Gt)return Gt.call(ee)==Gt.call(be)}return!1}function si(ee,be,Ae,dt,qi,gi){var kn=Ae&r,ii=ji(ee),po=ii.length,En=ji(be),_a=En.length;if(po!=_a&&!kn)return!1;for(var es=po;es--;){var ho=ii[es];if(!(kn?ho in be:lt.call(be,ho)))return!1}var Wa=gi.get(ee);if(Wa&&gi.get(be))return Wa==be;var fo=!0;gi.set(ee,be),gi.set(be,ee);for(var Hl=kn;++es<po;){ho=ii[es];var nu=ee[ho],xp=be[ho];if(dt)var Op=kn?dt(xp,nu,ho,be,ee,gi):dt(nu,xp,ho,ee,be,gi);if(!(Op===void 0?nu===xp||qi(nu,xp,Ae,dt,gi):Op)){fo=!1;break}Hl||(Hl=ho=="constructor")}if(fo&&!Hl){var zh=ee.constructor,$s=be.constructor;zh!=$s&&"constructor"in ee&&"constructor"in be&&!(typeof zh=="function"&&zh instanceof zh&&typeof $s=="function"&&$s instanceof $s)&&(fo=!1)}return gi.delete(ee),gi.delete(be),fo}function ji(ee){return Na(ee,ml,jl)}function ur(ee,be){var Ae=ee.__data__;return Bs(be)?Ae[typeof be=="string"?"string":"hash"]:Ae.map}function Mi(ee,be){var Ae=_e(ee,be);return vr(Ae)?Ae:void 0}function Sa(ee){var be=lt.call(ee,ge),Ae=ee[ge];try{ee[ge]=void 0;var dt=!0}catch{}var qi=bt.call(ee);return dt&&(be?ee[ge]=Ae:delete ee[ge]),qi}var jl=Se?function(ee){return ee==null?[]:(ee=Object(ee),he(Se(ee),function(be){return st.call(ee,be)}))}:qa,Xo=Yi;(ke&&Xo(new ke(new ArrayBuffer(1)))!=R||Ut&&Xo(new Ut)!=m||pt&&Xo(pt.resolve())!=b||tt&&Xo(new tt)!=w||At&&Xo(new At)!=C)&&(Xo=function(ee){var be=Yi(ee),Ae=be==y?ee.constructor:void 0,dt=Ae?Jo(Ae):"";if(dt)switch(dt){case vi:return R;case Ln:return m;case gn:return b;case Jt:return w;case kr:return C}return be});function Aa(ee,be){return be=be??o,!!be&&(typeof ee=="number"||q.test(ee))&&ee>-1&&ee%1==0&&ee<be}function Bs(ee){var be=typeof ee;return be=="string"||be=="number"||be=="symbol"||be=="boolean"?ee!=="__proto__":ee===null}function Ad(ee){return!!Ke&&Ke in ee}function Gl(ee){var be=ee&&ee.constructor,Ae=typeof be=="function"&&be.prototype||Pe;return ee===Ae}function _d(ee){return bt.call(ee)}function Jo(ee){if(ee!=null){try{return Ee.call(ee)}catch{}try{return ee+""}catch{}}return""}function Ta(ee,be){return ee===be||ee!==ee&&be!==be}var fl=Di(function(){return arguments}())?Di:function(ee){return Qo(ee)&&lt.call(ee,"callee")&&!st.call(ee,"callee")},Li=Array.isArray;function Oo(ee){return ee!=null&&us(ee.length)&&!Hh(ee)}var lr=qe||iu;function fc(ee,be){return gr(ee,be)}function Hh(ee){if(!kd(ee))return!1;var be=Yi(ee);return be==h||be==f||be==c||be==I}function us(ee){return typeof ee=="number"&&ee>-1&&ee%1==0&&ee<=o}function kd(ee){var be=typeof ee;return ee!=null&&(be=="object"||be=="function")}function Qo(ee){return ee!=null&&typeof ee=="object"}var xd=te?De(te):_t;function ml(ee){return Oo(ee)?Vl(ee):oi(ee)}function qa(){return[]}function iu(){return!1}t.exports=fc})(Ik,Ik.exports);var AEe=Ik.exports,oK={};Object.defineProperty(oK,"__esModule",{value:!0});const jft=NEe,Gft=AEe;var rH;(function(t){function e(a={},o={},s=!1){typeof a!="object"&&(a={}),typeof o!="object"&&(o={});let l=jft(o);s||(l=Object.keys(l).reduce((c,u)=>(l[u]!=null&&(c[u]=l[u]),c),{}));for(const c in a)a[c]!==void 0&&o[c]===void 0&&(l[c]=a[c]);return Object.keys(l).length>0?l:void 0}t.compose=e;function i(a={},o={}){typeof a!="object"&&(a={}),typeof o!="object"&&(o={});const s=Object.keys(a).concat(Object.keys(o)).reduce((l,c)=>(Gft(a[c],o[c])||(l[c]=o[c]===void 0?null:o[c]),l),{});return Object.keys(s).length>0?s:void 0}t.diff=i;function n(a={},o={}){a=a||{};const s=Object.keys(o).reduce((l,c)=>(o[c]!==a[c]&&a[c]!==void 0&&(l[c]=o[c]),l),{});return Object.keys(a).reduce((l,c)=>(a[c]!==o[c]&&o[c]===void 0&&(l[c]=null),l),s)}t.invert=n;function r(a,o,s=!1){if(typeof a!="object")return o;if(typeof o!="object")return;if(!s)return o;const l=Object.keys(o).reduce((c,u)=>(a[u]===void 0&&(c[u]=o[u]),c),{});return Object.keys(l).length>0?l:void 0}t.transform=r})(rH||(rH={}));oK.default=rH;var gB={};Object.defineProperty(gB,"__esModule",{value:!0});var aH;(function(t){function e(i){return typeof i.delete=="number"?i.delete:typeof i.retain=="number"?i.retain:typeof i.retain=="object"&&i.retain!==null?1:typeof i.insert=="string"?i.insert.length:1}t.length=e})(aH||(aH={}));gB.default=aH;var sK={};Object.defineProperty(sK,"__esModule",{value:!0});const Ste=gB;class Hft{constructor(e){this.ops=e,this.index=0,this.offset=0}hasNext(){return this.peekLength()<1/0}next(e){e||(e=1/0);const i=this.ops[this.index];if(i){const n=this.offset,r=Ste.default.length(i);if(e>=r-n?(e=r-n,this.index+=1,this.offset=0):this.offset+=e,typeof i.delete=="number")return{delete:e};{const a={};return i.attributes&&(a.attributes=i.attributes),typeof i.retain=="number"?a.retain=e:typeof i.retain=="object"&&i.retain!==null?a.retain=i.retain:typeof i.insert=="string"?a.insert=i.insert.substr(n,e):a.insert=i.insert,a}}else return{retain:1/0}}peek(){return this.ops[this.index]}peekLength(){return this.ops[this.index]?Ste.default.length(this.ops[this.index])-this.offset:1/0}peekType(){const e=this.ops[this.index];return e?typeof e.delete=="number"?"delete":typeof e.retain=="number"||typeof e.retain=="object"&&e.retain!==null?"retain":"insert":"retain"}rest(){if(this.hasNext()){if(this.offset===0)return this.ops.slice(this.index);{const e=this.offset,i=this.index,n=this.next(),r=this.ops.slice(this.index);return this.offset=e,this.index=i,[n].concat(r)}}else return[]}}sK.default=Hft;(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.AttributeMap=e.OpIterator=e.Op=void 0;const i=Vft,n=NEe,r=AEe,a=oK;e.AttributeMap=a.default;const o=gB;e.Op=o.default;const s=sK;e.OpIterator=s.default;const l="\0",c=(d,p)=>{if(typeof d!="object"||d===null)throw new Error(`cannot retain a ${typeof d}`);if(typeof p!="object"||p===null)throw new Error(`cannot retain a ${typeof p}`);const h=Object.keys(d)[0];if(!h||h!==Object.keys(p)[0])throw new Error(`embed types not matched: ${h} != ${Object.keys(p)[0]}`);return[h,d[h],p[h]]};class u{constructor(p){Array.isArray(p)?this.ops=p:p!=null&&Array.isArray(p.ops)?this.ops=p.ops:this.ops=[]}static registerEmbed(p,h){this.handlers[p]=h}static unregisterEmbed(p){delete this.handlers[p]}static getHandler(p){const h=this.handlers[p];if(!h)throw new Error(`no handlers for embed type "${p}"`);return h}insert(p,h){const f={};return typeof p=="string"&&p.length===0?this:(f.insert=p,h!=null&&typeof h=="object"&&Object.keys(h).length>0&&(f.attributes=h),this.push(f))}delete(p){return p<=0?this:this.push({delete:p})}retain(p,h){if(typeof p=="number"&&p<=0)return this;const f={retain:p};return h!=null&&typeof h=="object"&&Object.keys(h).length>0&&(f.attributes=h),this.push(f)}push(p){let h=this.ops.length,f=this.ops[h-1];if(p=n(p),typeof f=="object"){if(typeof p.delete=="number"&&typeof f.delete=="number")return this.ops[h-1]={delete:f.delete+p.delete},this;if(typeof f.delete=="number"&&p.insert!=null&&(h-=1,f=this.ops[h-1],typeof f!="object"))return this.ops.unshift(p),this;if(r(p.attributes,f.attributes)){if(typeof p.insert=="string"&&typeof f.insert=="string")return this.ops[h-1]={insert:f.insert+p.insert},typeof p.attributes=="object"&&(this.ops[h-1].attributes=p.attributes),this;if(typeof p.retain=="number"&&typeof f.retain=="number")return this.ops[h-1]={retain:f.retain+p.retain},typeof p.attributes=="object"&&(this.ops[h-1].attributes=p.attributes),this}}return h===this.ops.length?this.ops.push(p):this.ops.splice(h,0,p),this}chop(){const p=this.ops[this.ops.length-1];return p&&typeof p.retain=="number"&&!p.attributes&&this.ops.pop(),this}filter(p){return this.ops.filter(p)}forEach(p){this.ops.forEach(p)}map(p){return this.ops.map(p)}partition(p){const h=[],f=[];return this.forEach(m=>{(p(m)?h:f).push(m)}),[h,f]}reduce(p,h){return this.ops.reduce(p,h)}changeLength(){return this.reduce((p,h)=>h.insert?p+o.default.length(h):h.delete?p-h.delete:p,0)}length(){return this.reduce((p,h)=>p+o.default.length(h),0)}slice(p=0,h=1/0){const f=[],m=new s.default(this.ops);let g=0;for(;g<h&&m.hasNext();){let v;g<p?v=m.next(p-g):(v=m.next(h-g),f.push(v)),g+=o.default.length(v)}return new u(f)}compose(p){const h=new s.default(this.ops),f=new s.default(p.ops),m=[],g=f.peek();if(g!=null&&typeof g.retain=="number"&&g.attributes==null){let y=g.retain;for(;h.peekType()==="insert"&&h.peekLength()<=y;)y-=h.peekLength(),m.push(h.next());g.retain-y>0&&f.next(g.retain-y)}const v=new u(m);for(;h.hasNext()||f.hasNext();)if(f.peekType()==="insert")v.push(f.next());else if(h.peekType()==="delete")v.push(h.next());else{const y=Math.min(h.peekLength(),f.peekLength()),b=h.next(y),I=f.next(y);if(I.retain){const T={};if(typeof b.retain=="number")T.retain=typeof I.retain=="number"?y:I.retain;else if(typeof I.retain=="number")b.retain==null?T.insert=b.insert:T.retain=b.retain;else{const S=b.retain==null?"insert":"retain",[D,E,C]=c(b[S],I.retain),P=u.getHandler(D);T[S]={[D]:P.compose(E,C,S==="retain")}}const w=a.default.compose(b.attributes,I.attributes,typeof b.retain=="number");if(w&&(T.attributes=w),v.push(T),!f.hasNext()&&r(v.ops[v.ops.length-1],T)){const S=new u(h.rest());return v.concat(S).chop()}}else typeof I.delete=="number"&&(typeof b.retain=="number"||typeof b.retain=="object"&&b.retain!==null)&&v.push(I)}return v.chop()}concat(p){const h=new u(this.ops.slice());return p.ops.length>0&&(h.push(p.ops[0]),h.ops=h.ops.concat(p.ops.slice(1))),h}diff(p,h){if(this.ops===p.ops)return new u;const f=[this,p].map(b=>b.map(I=>{if(I.insert!=null)return typeof I.insert=="string"?I.insert:l;const T=b===p?"on":"with";throw new Error("diff() called "+T+" non-document")}).join("")),m=new u,g=i(f[0],f[1],h,!0),v=new s.default(this.ops),y=new s.default(p.ops);return g.forEach(b=>{let I=b[1].length;for(;I>0;){let T=0;switch(b[0]){case i.INSERT:T=Math.min(y.peekLength(),I),m.push(y.next(T));break;case i.DELETE:T=Math.min(I,v.peekLength()),v.next(T),m.delete(T);break;case i.EQUAL:T=Math.min(v.peekLength(),y.peekLength(),I);const w=v.next(T),S=y.next(T);r(w.insert,S.insert)?m.retain(T,a.default.diff(w.attributes,S.attributes)):m.push(S).delete(T);break}I-=T}}),m.chop()}eachLine(p,h=`
`){const f=new s.default(this.ops);let m=new u,g=0;for(;f.hasNext();){if(f.peekType()!=="insert")return;const v=f.peek(),y=o.default.length(v)-f.peekLength(),b=typeof v.insert=="string"?v.insert.indexOf(h,y)-y:-1;if(b<0)m.push(f.next());else if(b>0)m.push(f.next(b));else{if(p(m,f.next(1).attributes||{},g)===!1)return;g+=1,m=new u}}m.length()>0&&p(m,{},g)}invert(p){const h=new u;return this.reduce((f,m)=>{if(m.insert)h.delete(o.default.length(m));else{if(typeof m.retain=="number"&&m.attributes==null)return h.retain(m.retain),f+m.retain;if(m.delete||typeof m.retain=="number"){const g=m.delete||m.retain;return p.slice(f,f+g).forEach(y=>{m.delete?h.push(y):m.retain&&m.attributes&&h.retain(o.default.length(y),a.default.invert(m.attributes,y.attributes))}),f+g}else if(typeof m.retain=="object"&&m.retain!==null){const g=p.slice(f,f+1),v=new s.default(g.ops).next(),[y,b,I]=c(m.retain,v.insert),T=u.getHandler(y);return h.retain({[y]:T.invert(b,I)},a.default.invert(m.attributes,v.attributes)),f+1}}return f},0),h.chop()}transform(p,h=!1){if(h=!!h,typeof p=="number")return this.transformPosition(p,h);const f=p,m=new s.default(this.ops),g=new s.default(f.ops),v=new u;for(;m.hasNext()||g.hasNext();)if(m.peekType()==="insert"&&(h||g.peekType()!=="insert"))v.retain(o.default.length(m.next()));else if(g.peekType()==="insert")v.push(g.next());else{const y=Math.min(m.peekLength(),g.peekLength()),b=m.next(y),I=g.next(y);if(b.delete)continue;if(I.delete)v.push(I);else{const T=b.retain,w=I.retain;let S=typeof w=="object"&&w!==null?w:y;if(typeof T=="object"&&T!==null&&typeof w=="object"&&w!==null){const D=Object.keys(T)[0];if(D===Object.keys(w)[0]){const E=u.getHandler(D);E&&(S={[D]:E.transform(T[D],w[D],h)})}}v.retain(S,a.default.transform(b.attributes,I.attributes,h))}}return v.chop()}transformPosition(p,h=!1){h=!!h;const f=new s.default(this.ops);let m=0;for(;f.hasNext()&&m<=p;){const g=f.peekLength(),v=f.peekType();if(f.next(),v==="delete"){p-=Math.min(g,p-m);continue}else v==="insert"&&(m<p||!h)&&(p+=g);m+=g}return p}}u.Op=o.default,u.OpIterator=s.default,u.AttributeMap=a.default,u.handlers={},e.default=u,t.exports=u,t.exports.default=u})(nH,nH.exports);var Jd=nH.exports;const Ii=RP(Jd);class Vh extends Nd{static value(){}optimize(){(this.prev||this.next)&&this.remove()}length(){return 0}value(){return""}}Vh.blotName="break";Vh.tagName="BR";let Ah=class extends yk{};function vB(t){return t.replace(/[&<>"']/g,e=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"})[e])}const Jh=class Jh extends iK{static compare(e,i){const n=Jh.order.indexOf(e),r=Jh.order.indexOf(i);return n>=0||r>=0?n-r:e===i?0:e<i?-1:1}formatAt(e,i,n,r){if(Jh.compare(this.statics.blotName,n)<0&&this.scroll.query(n,Si.BLOT)){const a=this.isolate(e,i);r&&a.wrap(n,r)}else super.formatAt(e,i,n,r)}optimize(e){if(super.optimize(e),this.parent instanceof Jh&&Jh.compare(this.statics.blotName,this.parent.statics.blotName)>0){const i=this.parent.isolate(this.offset(),this.length());this.moveChildren(i),i.wrap(this)}}};Je(Jh,"allowedChildren",[Jh,Vh,Nd,Ah]),Je(Jh,"order",["cursor","inline","link","underline","strike","italic","bold","script","code"]);let Yf=Jh;const Tte=1;class Cl extends WE{constructor(){super(...arguments);Je(this,"cache",{})}delta(){return this.cache.delta==null&&(this.cache.delta=_Ee(this)),this.cache.delta}deleteAt(i,n){super.deleteAt(i,n),this.cache={}}formatAt(i,n,r,a){n<=0||(this.scroll.query(r,Si.BLOCK)?i+n===this.length()&&this.format(r,a):super.formatAt(i,Math.min(n,this.length()-i-1),r,a),this.cache={})}insertAt(i,n,r){if(r!=null){super.insertAt(i,n,r),this.cache={};return}if(n.length===0)return;const a=n.split(`
`),o=a.shift();o.length>0&&(i<this.length()-1||this.children.tail==null?super.insertAt(Math.min(i,this.length()-1),o):this.children.tail.insertAt(this.children.tail.length(),o),this.cache={});let s=this;a.reduce((l,c)=>(s=s.split(l,!0),s.insertAt(0,c),c.length),i+o.length)}insertBefore(i,n){const{head:r}=this.children;super.insertBefore(i,n),r instanceof Vh&&r.remove(),this.cache={}}length(){return this.cache.length==null&&(this.cache.length=super.length()+Tte),this.cache.length}moveChildren(i,n){super.moveChildren(i,n),this.cache={}}optimize(i){super.optimize(i),this.cache={}}path(i){return super.path(i,!0)}removeChild(i){super.removeChild(i),this.cache={}}split(i){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(n&&(i===0||i>=this.length()-Tte)){const a=this.clone();return i===0?(this.parent.insertBefore(a,this),this):(this.parent.insertBefore(a,this.next),a)}const r=super.split(i,n);return this.cache={},r}}Cl.blotName="block";Cl.tagName="P";Cl.defaultChild=Vh;Cl.allowedChildren=[Vh,Yf,Nd,Ah];class Kd extends Nd{attach(){super.attach(),this.attributes=new pB(this.domNode)}delta(){return new Ii().insert(this.value(),{...this.formats(),...this.attributes.values()})}format(e,i){const n=this.scroll.query(e,Si.BLOCK_ATTRIBUTE);n!=null&&this.attributes.attribute(n,i)}formatAt(e,i,n,r){this.format(n,r)}insertAt(e,i,n){if(n!=null){super.insertAt(e,i,n);return}const r=i.split(`
`),a=r.pop(),o=r.map(l=>{const c=this.scroll.create(Cl.blotName);return c.insertAt(0,l),c}),s=this.split(e);o.forEach(l=>{this.parent.insertBefore(l,s)}),a&&this.parent.insertBefore(this.scroll.create("text",a),s)}}Kd.scope=Si.BLOCK_BLOT;function _Ee(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return t.descendants(Wl).reduce((i,n)=>n.length()===0?i:i.insert(n.value(),qd(n,{},e)),new Ii).insert(`
`,qd(t))}function qd(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;return t==null||("formats"in t&&typeof t.formats=="function"&&(e={...e,...t.formats()},i&&delete e["code-token"]),t.parent==null||t.parent.statics.blotName==="scroll"||t.parent.statics.scope!==t.statics.scope)?e:qd(t.parent,e,i)}const Gd=class Gd extends Nd{static value(){}constructor(e,i,n){super(e,i),this.selection=n,this.textNode=document.createTextNode(Gd.CONTENTS),this.domNode.appendChild(this.textNode),this.savedLength=0}detach(){this.parent!=null&&this.parent.removeChild(this)}format(e,i){if(this.savedLength!==0){super.format(e,i);return}let n=this,r=0;for(;n!=null&&n.statics.scope!==Si.BLOCK_BLOT;)r+=n.offset(n.parent),n=n.parent;n!=null&&(this.savedLength=Gd.CONTENTS.length,n.optimize(),n.formatAt(r,Gd.CONTENTS.length,e,i),this.savedLength=0)}index(e,i){return e===this.textNode?0:super.index(e,i)}length(){return this.savedLength}position(){return[this.textNode,this.textNode.data.length]}remove(){super.remove(),this.parent=null}restore(){if(this.selection.composing||this.parent==null)return null;const e=this.selection.getNativeRange();for(;this.domNode.lastChild!=null&&this.domNode.lastChild!==this.textNode;)this.domNode.parentNode.insertBefore(this.domNode.lastChild,this.domNode);const i=this.prev instanceof Ah?this.prev:null,n=i?i.length():0,r=this.next instanceof Ah?this.next:null,a=r?r.text:"",{textNode:o}=this,s=o.data.split(Gd.CONTENTS).join("");o.data=Gd.CONTENTS;let l;if(i)l=i,(s||r)&&(i.insertAt(i.length(),s+a),r&&r.remove());else if(r)l=r,r.insertAt(0,s);else{const c=document.createTextNode(s);l=this.scroll.create(c),this.parent.insertBefore(l,this)}if(this.remove(),e){const c=(p,h)=>i&&p===i.domNode?h:p===o?n+h-1:r&&p===r.domNode?n+s.length+h:null,u=c(e.start.node,e.start.offset),d=c(e.end.node,e.end.offset);if(u!==null&&d!==null)return{startNode:l.domNode,startOffset:u,endNode:l.domNode,endOffset:d}}return null}update(e,i){if(e.some(n=>n.type==="characterData"&&n.target===this.textNode)){const n=this.restore();n&&(i.range=n)}}optimize(e){super.optimize(e);let{parent:i}=this;for(;i;){if(i.domNode.tagName==="A"){this.savedLength=Gd.CONTENTS.length,i.isolate(this.offset(i),this.length()).unwrap(),this.savedLength=0;break}i=i.parent}}value(){return""}};Je(Gd,"blotName","cursor"),Je(Gd,"className","ql-cursor"),Je(Gd,"tagName","span"),Je(Gd,"CONTENTS","\uFEFF");let cT=Gd;var kEe={exports:{}};(function(t){var e=Object.prototype.hasOwnProperty,i="~";function n(){}Object.create&&(n.prototype=Object.create(null),new n().__proto__||(i=!1));function r(l,c,u){this.fn=l,this.context=c,this.once=u||!1}function a(l,c,u,d,p){if(typeof u!="function")throw new TypeError("The listener must be a function");var h=new r(u,d||l,p),f=i?i+c:c;return l._events[f]?l._events[f].fn?l._events[f]=[l._events[f],h]:l._events[f].push(h):(l._events[f]=h,l._eventsCount++),l}function o(l,c){--l._eventsCount===0?l._events=new n:delete l._events[c]}function s(){this._events=new n,this._eventsCount=0}s.prototype.eventNames=function(){var c=[],u,d;if(this._eventsCount===0)return c;for(d in u=this._events)e.call(u,d)&&c.push(i?d.slice(1):d);return Object.getOwnPropertySymbols?c.concat(Object.getOwnPropertySymbols(u)):c},s.prototype.listeners=function(c){var u=i?i+c:c,d=this._events[u];if(!d)return[];if(d.fn)return[d.fn];for(var p=0,h=d.length,f=new Array(h);p<h;p++)f[p]=d[p].fn;return f},s.prototype.listenerCount=function(c){var u=i?i+c:c,d=this._events[u];return d?d.fn?1:d.length:0},s.prototype.emit=function(c,u,d,p,h,f){var m=i?i+c:c;if(!this._events[m])return!1;var g=this._events[m],v=arguments.length,y,b;if(g.fn){switch(g.once&&this.removeListener(c,g.fn,void 0,!0),v){case 1:return g.fn.call(g.context),!0;case 2:return g.fn.call(g.context,u),!0;case 3:return g.fn.call(g.context,u,d),!0;case 4:return g.fn.call(g.context,u,d,p),!0;case 5:return g.fn.call(g.context,u,d,p,h),!0;case 6:return g.fn.call(g.context,u,d,p,h,f),!0}for(b=1,y=new Array(v-1);b<v;b++)y[b-1]=arguments[b];g.fn.apply(g.context,y)}else{var I=g.length,T;for(b=0;b<I;b++)switch(g[b].once&&this.removeListener(c,g[b].fn,void 0,!0),v){case 1:g[b].fn.call(g[b].context);break;case 2:g[b].fn.call(g[b].context,u);break;case 3:g[b].fn.call(g[b].context,u,d);break;case 4:g[b].fn.call(g[b].context,u,d,p);break;default:if(!y)for(T=1,y=new Array(v-1);T<v;T++)y[T-1]=arguments[T];g[b].fn.apply(g[b].context,y)}}return!0},s.prototype.on=function(c,u,d){return a(this,c,u,d,!1)},s.prototype.once=function(c,u,d){return a(this,c,u,d,!0)},s.prototype.removeListener=function(c,u,d,p){var h=i?i+c:c;if(!this._events[h])return this;if(!u)return o(this,h),this;var f=this._events[h];if(f.fn)f.fn===u&&(!p||f.once)&&(!d||f.context===d)&&o(this,h);else{for(var m=0,g=[],v=f.length;m<v;m++)(f[m].fn!==u||p&&!f[m].once||d&&f[m].context!==d)&&g.push(f[m]);g.length?this._events[h]=g.length===1?g[0]:g:o(this,h)}return this},s.prototype.removeAllListeners=function(c){var u;return c?(u=i?i+c:c,this._events[u]&&o(this,u)):(this._events=new n,this._eventsCount=0),this},s.prototype.off=s.prototype.removeListener,s.prototype.addListener=s.prototype.on,s.prefixed=i,s.EventEmitter=s,t.exports=s})(kEe);var zft=kEe.exports;const qft=RP(zft),oH=new WeakMap,sH=["error","warn","log","info"];let lH="warn";function xEe(t){if(lH&&sH.indexOf(t)<=sH.indexOf(lH)){for(var e=arguments.length,i=new Array(e>1?e-1:0),n=1;n<e;n++)i[n-1]=arguments[n];console[t](...i)}}function Wg(t){return sH.reduce((e,i)=>(e[i]=xEe.bind(console,i,t),e),{})}Wg.level=t=>{lH=t};xEe.level=Wg.level;const l2=Wg("quill:events"),Wft=["selectionchange","mousedown","mouseup","click"];Wft.forEach(t=>{document.addEventListener(t,function(){for(var e=arguments.length,i=new Array(e),n=0;n<e;n++)i[n]=arguments[n];Array.from(document.querySelectorAll(".ql-container")).forEach(r=>{const a=oH.get(r);a&&a.emitter&&a.emitter.handleDOM(...i)})})});class mi extends qft{constructor(){super(),this.domListeners={},this.on("error",l2.error)}emit(){for(var e=arguments.length,i=new Array(e),n=0;n<e;n++)i[n]=arguments[n];return l2.log.call(l2,...i),super.emit(...i)}handleDOM(e){for(var i=arguments.length,n=new Array(i>1?i-1:0),r=1;r<i;r++)n[r-1]=arguments[r];(this.domListeners[e.type]||[]).forEach(a=>{let{node:o,handler:s}=a;(e.target===o||o.contains(e.target))&&s(e,...n)})}listenDOM(e,i,n){this.domListeners[e]||(this.domListeners[e]=[]),this.domListeners[e].push({node:i,handler:n})}}Je(mi,"events",{EDITOR_CHANGE:"editor-change",SCROLL_BEFORE_UPDATE:"scroll-before-update",SCROLL_BLOT_MOUNT:"scroll-blot-mount",SCROLL_BLOT_UNMOUNT:"scroll-blot-unmount",SCROLL_OPTIMIZE:"scroll-optimize",SCROLL_UPDATE:"scroll-update",SCROLL_EMBED_UPDATE:"scroll-embed-update",SELECTION_CHANGE:"selection-change",TEXT_CHANGE:"text-change",COMPOSITION_BEFORE_START:"composition-before-start",COMPOSITION_START:"composition-start",COMPOSITION_BEFORE_END:"composition-before-end",COMPOSITION_END:"composition-end"}),Je(mi,"sources",{API:"api",SILENT:"silent",USER:"user"});const c2=Wg("quill:selection");class UI{constructor(e){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;this.index=e,this.length=i}}class Kft{constructor(e,i){this.emitter=i,this.scroll=e,this.composing=!1,this.mouseDown=!1,this.root=this.scroll.domNode,this.cursor=this.scroll.create("cursor",this),this.savedRange=new UI(0,0),this.lastRange=this.savedRange,this.lastNative=null,this.handleComposition(),this.handleDragging(),this.emitter.listenDOM("selectionchange",document,()=>{!this.mouseDown&&!this.composing&&setTimeout(this.update.bind(this,mi.sources.USER),1)}),this.emitter.on(mi.events.SCROLL_BEFORE_UPDATE,()=>{if(!this.hasFocus())return;const n=this.getNativeRange();n!=null&&n.start.node!==this.cursor.textNode&&this.emitter.once(mi.events.SCROLL_UPDATE,(r,a)=>{try{this.root.contains(n.start.node)&&this.root.contains(n.end.node)&&this.setNativeRange(n.start.node,n.start.offset,n.end.node,n.end.offset);const o=a.some(s=>s.type==="characterData"||s.type==="childList"||s.type==="attributes"&&s.target===this.root);this.update(o?mi.sources.SILENT:r)}catch{}})}),this.emitter.on(mi.events.SCROLL_OPTIMIZE,(n,r)=>{if(r.range){const{startNode:a,startOffset:o,endNode:s,endOffset:l}=r.range;this.setNativeRange(a,o,s,l),this.update(mi.sources.SILENT)}}),this.update(mi.sources.SILENT)}handleComposition(){this.emitter.on(mi.events.COMPOSITION_BEFORE_START,()=>{this.composing=!0}),this.emitter.on(mi.events.COMPOSITION_END,()=>{if(this.composing=!1,this.cursor.parent){const e=this.cursor.restore();if(!e)return;setTimeout(()=>{this.setNativeRange(e.startNode,e.startOffset,e.endNode,e.endOffset)},1)}})}handleDragging(){this.emitter.listenDOM("mousedown",document.body,()=>{this.mouseDown=!0}),this.emitter.listenDOM("mouseup",document.body,()=>{this.mouseDown=!1,this.update(mi.sources.USER)})}focus(){this.hasFocus()||(this.root.focus({preventScroll:!0}),this.setRange(this.savedRange))}format(e,i){this.scroll.update();const n=this.getNativeRange();if(!(n==null||!n.native.collapsed||this.scroll.query(e,Si.BLOCK))){if(n.start.node!==this.cursor.textNode){const r=this.scroll.find(n.start.node,!1);if(r==null)return;if(r instanceof Wl){const a=r.split(n.start.offset);r.parent.insertBefore(this.cursor,a)}else r.insertBefore(this.cursor,n.start.node);this.cursor.attach()}this.cursor.format(e,i),this.scroll.optimize(),this.setNativeRange(this.cursor.textNode,this.cursor.textNode.data.length),this.update()}}getBounds(e){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;const n=this.scroll.length();e=Math.min(e,n-1),i=Math.min(e+i,n-1)-e;let r,[a,o]=this.scroll.leaf(e);if(a==null)return null;if(i>0&&o===a.length()){const[u]=this.scroll.leaf(e+1);if(u){const[d]=this.scroll.line(e),[p]=this.scroll.line(e+1);d===p&&(a=u,o=0)}}[r,o]=a.position(o,!0);const s=document.createRange();if(i>0)return s.setStart(r,o),[a,o]=this.scroll.leaf(e+i),a==null?null:([r,o]=a.position(o,!0),s.setEnd(r,o),s.getBoundingClientRect());let l="left",c;if(r instanceof Text){if(!r.data.length)return null;o<r.data.length?(s.setStart(r,o),s.setEnd(r,o+1)):(s.setStart(r,o-1),s.setEnd(r,o),l="right"),c=s.getBoundingClientRect()}else{if(!(a.domNode instanceof Element))return null;c=a.domNode.getBoundingClientRect(),o>0&&(l="right")}return{bottom:c.top+c.height,height:c.height,left:c[l],right:c[l],top:c.top,width:0}}getNativeRange(){const e=document.getSelection();if(e==null||e.rangeCount<=0)return null;const i=e.getRangeAt(0);if(i==null)return null;const n=this.normalizeNative(i);return c2.info("getNativeRange",n),n}getRange(){const e=this.scroll.domNode;if("isConnected"in e&&!e.isConnected)return[null,null];const i=this.getNativeRange();return i==null?[null,null]:[this.normalizedToRange(i),i]}hasFocus(){return document.activeElement===this.root||document.activeElement!=null&&u2(this.root,document.activeElement)}normalizedToRange(e){const i=[[e.start.node,e.start.offset]];e.native.collapsed||i.push([e.end.node,e.end.offset]);const n=i.map(o=>{const[s,l]=o,c=this.scroll.find(s,!0),u=c.offset(this.scroll);return l===0?u:c instanceof Wl?u+c.index(s,l):u+c.length()}),r=Math.min(Math.max(...n),this.scroll.length()-1),a=Math.min(r,...n);return new UI(a,r-a)}normalizeNative(e){if(!u2(this.root,e.startContainer)||!e.collapsed&&!u2(this.root,e.endContainer))return null;const i={start:{node:e.startContainer,offset:e.startOffset},end:{node:e.endContainer,offset:e.endOffset},native:e};return[i.start,i.end].forEach(n=>{let{node:r,offset:a}=n;for(;!(r instanceof Text)&&r.childNodes.length>0;)if(r.childNodes.length>a)r=r.childNodes[a],a=0;else if(r.childNodes.length===a)r=r.lastChild,r instanceof Text?a=r.data.length:r.childNodes.length>0?a=r.childNodes.length:a=r.childNodes.length+1;else break;n.node=r,n.offset=a}),i}rangeToNative(e){const i=this.scroll.length(),n=(r,a)=>{r=Math.min(i-1,r);const[o,s]=this.scroll.leaf(r);return o?o.position(s,a):[null,-1]};return[...n(e.index,!1),...n(e.index+e.length,!0)]}setNativeRange(e,i){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:e,r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:i,a=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!1;if(c2.info("setNativeRange",e,i,n,r),e!=null&&(this.root.parentNode==null||e.parentNode==null||n.parentNode==null))return;const o=document.getSelection();if(o!=null)if(e!=null){this.hasFocus()||this.root.focus({preventScroll:!0});const{native:s}=this.getNativeRange()||{};if(s==null||a||e!==s.startContainer||i!==s.startOffset||n!==s.endContainer||r!==s.endOffset){e instanceof Element&&e.tagName==="BR"&&(i=Array.from(e.parentNode.childNodes).indexOf(e),e=e.parentNode),n instanceof Element&&n.tagName==="BR"&&(r=Array.from(n.parentNode.childNodes).indexOf(n),n=n.parentNode);const l=document.createRange();l.setStart(e,i),l.setEnd(n,r),o.removeAllRanges(),o.addRange(l)}}else o.removeAllRanges(),this.root.blur()}setRange(e){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:mi.sources.API;if(typeof i=="string"&&(n=i,i=!1),c2.info("setRange",e),e!=null){const r=this.rangeToNative(e);this.setNativeRange(...r,i)}else this.setNativeRange(null);this.update(n)}update(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:mi.sources.USER;const i=this.lastRange,[n,r]=this.getRange();if(this.lastRange=n,this.lastNative=r,this.lastRange!=null&&(this.savedRange=this.lastRange),!tK(i,this.lastRange)){if(!this.composing&&r!=null&&r.native.collapsed&&r.start.node!==this.cursor.textNode){const o=this.cursor.restore();o&&this.setNativeRange(o.startNode,o.startOffset,o.endNode,o.endOffset)}const a=[mi.events.SELECTION_CHANGE,K0(this.lastRange),K0(i),e];this.emitter.emit(mi.events.EDITOR_CHANGE,...a),e!==mi.sources.SILENT&&this.emitter.emit(...a)}}}function u2(t,e){try{e.parentNode}catch{return!1}return t.contains(e)}const Yft=/^[ -~]*$/;class Zft{constructor(e){this.scroll=e,this.delta=this.getDelta()}applyDelta(e){this.scroll.update();let i=this.scroll.length();this.scroll.batchStart();const n=Ute(e),r=new Ii;return Jft(n.ops.slice()).reduce((o,s)=>{const l=Jd.Op.length(s);let c=s.attributes||{},u=!1,d=!1;if(s.insert!=null){if(r.retain(l),typeof s.insert=="string"){const f=s.insert;d=!f.endsWith(`
`)&&(i<=o||!!this.scroll.descendant(Kd,o)[0]),this.scroll.insertAt(o,f);const[m,g]=this.scroll.line(o);let v=kv({},qd(m));if(m instanceof Cl){const[y]=m.descendant(Wl,g);y&&(v=kv(v,qd(y)))}c=Jd.AttributeMap.diff(v,c)||{}}else if(typeof s.insert=="object"){const f=Object.keys(s.insert)[0];if(f==null)return o;const m=this.scroll.query(f,Si.INLINE)!=null;if(m)(i<=o||this.scroll.descendant(Kd,o)[0])&&(d=!0);else if(o>0){const[g,v]=this.scroll.descendant(Wl,o-1);g instanceof Ah?g.value()[v]!==`
`&&(u=!0):g instanceof Nd&&g.statics.scope===Si.INLINE_BLOT&&(u=!0)}if(this.scroll.insertAt(o,f,s.insert[f]),m){const[g]=this.scroll.descendant(Wl,o);if(g){const v=kv({},qd(g));c=Jd.AttributeMap.diff(v,c)||{}}}}i+=l}else if(r.push(s),s.retain!==null&&typeof s.retain=="object"){const f=Object.keys(s.retain)[0];if(f==null)return o;this.scroll.updateEmbedAt(o,f,s.retain[f])}Object.keys(c).forEach(f=>{this.scroll.formatAt(o,l,f,c[f])});const p=u?1:0,h=d?1:0;return i+=p+h,r.retain(p),r.delete(h),o+l+p+h},0),r.reduce((o,s)=>typeof s.delete=="number"?(this.scroll.deleteAt(o,s.delete),o):o+Jd.Op.length(s),0),this.scroll.batchEnd(),this.scroll.optimize(),this.update(n)}deleteText(e,i){return this.scroll.deleteAt(e,i),this.update(new Ii().retain(e).delete(i))}formatLine(e,i){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};this.scroll.update(),Object.keys(n).forEach(a=>{this.scroll.lines(e,Math.max(i,1)).forEach(o=>{o.format(a,n[a])})}),this.scroll.optimize();const r=new Ii().retain(e).retain(i,K0(n));return this.update(r)}formatText(e,i){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.keys(n).forEach(a=>{this.scroll.formatAt(e,i,a,n[a])});const r=new Ii().retain(e).retain(i,K0(n));return this.update(r)}getContents(e,i){return this.delta.slice(e,e+i)}getDelta(){return this.scroll.lines().reduce((e,i)=>e.concat(i.delta()),new Ii)}getFormat(e){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=[],r=[];i===0?this.scroll.path(e).forEach(s=>{const[l]=s;l instanceof Cl?n.push(l):l instanceof Wl&&r.push(l)}):(n=this.scroll.lines(e,i),r=this.scroll.descendants(Wl,e,i));const[a,o]=[n,r].map(s=>{const l=s.shift();if(l==null)return{};let c=qd(l);for(;Object.keys(c).length>0;){const u=s.shift();if(u==null)return c;c=Xft(qd(u),c)}return c});return{...a,...o}}getHTML(e,i){const[n,r]=this.scroll.line(e);if(n){const a=n.length();return n.length()>=r+i&&!(r===0&&i===a)?YE(n,r,i,!0):YE(this.scroll,e,i,!0)}return""}getText(e,i){return this.getContents(e,i).filter(n=>typeof n.insert=="string").map(n=>n.insert).join("")}insertContents(e,i){const n=Ute(i),r=new Ii().retain(e).concat(n);return this.scroll.insertContents(e,n),this.update(r)}insertEmbed(e,i,n){return this.scroll.insertAt(e,i,n),this.update(new Ii().retain(e).insert({[i]:n}))}insertText(e,i){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return i=i.replace(/\r\n/g,`
`).replace(/\r/g,`
`),this.scroll.insertAt(e,i),Object.keys(n).forEach(r=>{this.scroll.formatAt(e,i.length,r,n[r])}),this.update(new Ii().retain(e).insert(i,K0(n)))}isBlank(){if(this.scroll.children.length===0)return!0;if(this.scroll.children.length>1)return!1;const e=this.scroll.children.head;if((e==null?void 0:e.statics.blotName)!==Cl.blotName)return!1;const i=e;return i.children.length>1?!1:i.children.head instanceof Vh}removeFormat(e,i){const n=this.getText(e,i),[r,a]=this.scroll.line(e+i);let o=0,s=new Ii;r!=null&&(o=r.length()-a,s=r.delta().slice(a,a+o-1).insert(`
`));const c=this.getContents(e,i+o).diff(new Ii().insert(n).concat(s)),u=new Ii().retain(e).concat(c);return this.applyDelta(u)}update(e){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:void 0;const r=this.delta;if(i.length===1&&i[0].type==="characterData"&&i[0].target.data.match(Yft)&&this.scroll.find(i[0].target)){const a=this.scroll.find(i[0].target),o=qd(a),s=a.offset(this.scroll),l=i[0].oldValue.replace(cT.CONTENTS,""),c=new Ii().insert(l),u=new Ii().insert(a.value()),d=n&&{oldRange:Dte(n.oldRange,-s),newRange:Dte(n.newRange,-s)};e=new Ii().retain(s).concat(c.diff(u,d)).reduce((h,f)=>f.insert?h.insert(f.insert,o):h.push(f),new Ii),this.delta=r.compose(e)}else this.delta=this.getDelta(),(!e||!tK(r.compose(e),this.delta))&&(e=r.diff(this.delta,n));return e}}function D0(t,e,i){if(t.length===0){const[h]=d2(i.pop());return e<=0?`</li></${h}>`:`</li></${h}>${D0([],e-1,i)}`}const[{child:n,offset:r,length:a,indent:o,type:s},...l]=t,[c,u]=d2(s);if(o>e)return i.push(s),o===e+1?`<${c}><li${u}>${YE(n,r,a)}${D0(l,o,i)}`:`<${c}><li>${D0(t,e+1,i)}`;const d=i[i.length-1];if(o===e&&s===d)return`</li><li${u}>${YE(n,r,a)}${D0(l,o,i)}`;const[p]=d2(i.pop());return`</li></${p}>${D0(t,e-1,i)}`}function YE(t,e,i){let n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;if("html"in t&&typeof t.html=="function")return t.html(e,i);if(t instanceof Ah)return vB(t.value().slice(e,e+i));if(t instanceof dh){if(t.statics.blotName==="list-container"){const c=[];return t.children.forEachAt(e,i,(u,d,p)=>{const h="formats"in u&&typeof u.formats=="function"?u.formats():{};c.push({child:u,offset:d,length:p,indent:h.indent||0,type:h.list})}),D0(c,-1,[])}const r=[];if(t.children.forEachAt(e,i,(c,u,d)=>{r.push(YE(c,u,d))}),n||t.statics.blotName==="list")return r.join("");const{outerHTML:a,innerHTML:o}=t.domNode,[s,l]=a.split(`>${o}<`);return s==="<table"?`<table style="border: 1px solid #000;">${r.join("")}<${l}`:`${s}>${r.join("")}<${l}`}return t.domNode instanceof Element?t.domNode.outerHTML:""}function Xft(t,e){return Object.keys(e).reduce((i,n)=>{if(t[n]==null)return i;const r=e[n];return r===t[n]?i[n]=r:Array.isArray(r)?r.indexOf(t[n])<0?i[n]=r.concat([t[n]]):i[n]=r:i[n]=[r,t[n]],i},{})}function d2(t){const e=t==="ordered"?"ol":"ul";switch(t){case"checked":return[e,' data-list="checked"'];case"unchecked":return[e,' data-list="unchecked"'];default:return[e,""]}}function Ute(t){return t.reduce((e,i)=>{if(typeof i.insert=="string"){const n=i.insert.replace(/\r\n/g,`
`).replace(/\r/g,`
`);return e.insert(n,i.attributes)}return e.push(i)},new Ii)}function Dte(t,e){let{index:i,length:n}=t;return new UI(i+e,n)}function Jft(t){const e=[];return t.forEach(i=>{typeof i.insert=="string"?i.insert.split(`
`).forEach((r,a)=>{a&&e.push({insert:`
`,attributes:i.attributes}),r&&e.push({insert:r,attributes:i.attributes})}):e.push(i)}),e}class jh{constructor(e){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.quill=e,this.options=i}}Je(jh,"DEFAULTS",{});const tN="\uFEFF";class lK extends Nd{constructor(e,i){super(e,i),this.contentNode=document.createElement("span"),this.contentNode.setAttribute("contenteditable","false"),Array.from(this.domNode.childNodes).forEach(n=>{this.contentNode.appendChild(n)}),this.leftGuard=document.createTextNode(tN),this.rightGuard=document.createTextNode(tN),this.domNode.appendChild(this.leftGuard),this.domNode.appendChild(this.contentNode),this.domNode.appendChild(this.rightGuard)}index(e,i){return e===this.leftGuard?0:e===this.rightGuard?1:super.index(e,i)}restore(e){let i=null,n;const r=e.data.split(tN).join("");if(e===this.leftGuard)if(this.prev instanceof Ah){const a=this.prev.length();this.prev.insertAt(a,r),i={startNode:this.prev.domNode,startOffset:a+r.length}}else n=document.createTextNode(r),this.parent.insertBefore(this.scroll.create(n),this),i={startNode:n,startOffset:r.length};else e===this.rightGuard&&(this.next instanceof Ah?(this.next.insertAt(0,r),i={startNode:this.next.domNode,startOffset:r.length}):(n=document.createTextNode(r),this.parent.insertBefore(this.scroll.create(n),this.next),i={startNode:n,startOffset:r.length}));return e.data=tN,i}update(e,i){e.forEach(n=>{if(n.type==="characterData"&&(n.target===this.leftGuard||n.target===this.rightGuard)){const r=this.restore(n.target);r&&(i.range=r)}})}}class Qft{constructor(e,i){Je(this,"isComposing",!1);this.scroll=e,this.emitter=i,this.setupListeners()}setupListeners(){this.scroll.domNode.addEventListener("compositionstart",e=>{this.isComposing||this.handleCompositionStart(e)}),this.scroll.domNode.addEventListener("compositionend",e=>{this.isComposing&&queueMicrotask(()=>{this.handleCompositionEnd(e)})})}handleCompositionStart(e){const i=e.target instanceof Node?this.scroll.find(e.target,!0):null;i&&!(i instanceof lK)&&(this.emitter.emit(mi.events.COMPOSITION_BEFORE_START,e),this.scroll.batchStart(),this.emitter.emit(mi.events.COMPOSITION_START,e),this.isComposing=!0)}handleCompositionEnd(e){this.emitter.emit(mi.events.COMPOSITION_BEFORE_END,e),this.scroll.batchEnd(),this.emitter.emit(mi.events.COMPOSITION_END,e),this.isComposing=!1}}const vD=class vD{constructor(e,i){Je(this,"modules",{});this.quill=e,this.options=i}init(){Object.keys(this.options.modules).forEach(e=>{this.modules[e]==null&&this.addModule(e)})}addModule(e){const i=this.quill.constructor.import(`modules/${e}`);return this.modules[e]=new i(this.quill,this.options.modules[e]||{}),this.modules[e]}};Je(vD,"DEFAULTS",{modules:{}}),Je(vD,"themes",{default:vD});let uT=vD;const emt=t=>t.parentElement||t.getRootNode().host||null,tmt=t=>{const e=t.getBoundingClientRect(),i="offsetWidth"in t&&Math.abs(e.width)/t.offsetWidth||1,n="offsetHeight"in t&&Math.abs(e.height)/t.offsetHeight||1;return{top:e.top,right:e.left+t.clientWidth*i,bottom:e.top+t.clientHeight*n,left:e.left}},iN=t=>{const e=parseInt(t,10);return Number.isNaN(e)?0:e},Ete=(t,e,i,n,r,a)=>t<i&&e>n?0:t<i?-(i-t+r):e>n?e-t>n-i?t+r-i:e-n+a:0,imt=(t,e)=>{var a,o,s;const i=t.ownerDocument;let n=e,r=t;for(;r;){const l=r===i.body,c=l?{top:0,right:((a=window.visualViewport)==null?void 0:a.width)??i.documentElement.clientWidth,bottom:((o=window.visualViewport)==null?void 0:o.height)??i.documentElement.clientHeight,left:0}:tmt(r),u=getComputedStyle(r),d=Ete(n.left,n.right,c.left,c.right,iN(u.scrollPaddingLeft),iN(u.scrollPaddingRight)),p=Ete(n.top,n.bottom,c.top,c.bottom,iN(u.scrollPaddingTop),iN(u.scrollPaddingBottom));if(d||p)if(l)(s=i.defaultView)==null||s.scrollBy(d,p);else{const{scrollLeft:h,scrollTop:f}=r;p&&(r.scrollTop+=p),d&&(r.scrollLeft+=d);const m=r.scrollLeft-h,g=r.scrollTop-f;n={left:n.left-m,top:n.top-g,right:n.right-m,bottom:n.bottom-g}}r=l||u.position==="fixed"?null:emt(r)}},nmt=100,rmt=["block","break","cursor","inline","scroll","text"],amt=(t,e,i)=>{const n=new lT;return rmt.forEach(r=>{const a=e.query(r);a&&n.register(a)}),t.forEach(r=>{let a=e.query(r);a||i.error(`Cannot register "${r}" specified in "formats" config. Are you sure it was registered?`);let o=0;for(;a;)if(n.register(a),a="blotName"in a?a.requiredContainer??null:null,o+=1,o>nmt){i.error(`Cycle detected in registering blot requiredContainer: "${r}"`);break}}),n},Z0=Wg("quill"),nN=new lT;dh.uiClass="ql-ui";const jp=class jp{static debug(e){e===!0&&(e="log"),Wg.level(e)}static find(e){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;return oH.get(e)||nN.find(e,i)}static import(e){return this.imports[e]==null&&Z0.error(`Cannot import ${e}. Are you sure it was registered?`),this.imports[e]}static register(e,i){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;if(typeof e!="string"){const r="attrName"in e?e.attrName:e.blotName;typeof r=="string"?this.register(`formats/${r}`,e,i):Object.keys(e).forEach(a=>{this.register(a,e[a],i)})}else this.imports[e]!=null&&!n&&Z0.warn(`Overwriting ${e} with`,i),this.imports[e]=i,(e.startsWith("blots/")||e.startsWith("formats/"))&&i&&typeof i!="boolean"&&i.blotName!=="abstract"&&nN.register(i),typeof i.register=="function"&&i.register(nN)}constructor(e){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(this.options=omt(e,i),this.container=this.options.container,this.container==null){Z0.error("Invalid Quill container",e);return}this.options.debug&&jp.debug(this.options.debug);const n=this.container.innerHTML.trim();this.container.classList.add("ql-container"),this.container.innerHTML="",oH.set(this.container,this),this.root=this.addContainer("ql-editor"),this.root.classList.add("ql-blank"),this.emitter=new mi;const r=nK.blotName,a=this.options.registry.query(r);if(!a||!("blotName"in a))throw new Error(`Cannot initialize Quill without "${r}" blot`);if(this.scroll=new a(this.options.registry,this.root,{emitter:this.emitter}),this.editor=new Zft(this.scroll),this.selection=new Kft(this.scroll,this.emitter),this.composition=new Qft(this.scroll,this.emitter),this.theme=new this.options.theme(this,this.options),this.keyboard=this.theme.addModule("keyboard"),this.clipboard=this.theme.addModule("clipboard"),this.history=this.theme.addModule("history"),this.uploader=this.theme.addModule("uploader"),this.theme.addModule("input"),this.theme.addModule("uiNode"),this.theme.init(),this.emitter.on(mi.events.EDITOR_CHANGE,o=>{o===mi.events.TEXT_CHANGE&&this.root.classList.toggle("ql-blank",this.editor.isBlank())}),this.emitter.on(mi.events.SCROLL_UPDATE,(o,s)=>{const l=this.selection.lastRange,[c]=this.selection.getRange(),u=l&&c?{oldRange:l,newRange:c}:void 0;$p.call(this,()=>this.editor.update(null,s,u),o)}),this.emitter.on(mi.events.SCROLL_EMBED_UPDATE,(o,s)=>{const l=this.selection.lastRange,[c]=this.selection.getRange(),u=l&&c?{oldRange:l,newRange:c}:void 0;$p.call(this,()=>{const d=new Ii().retain(o.offset(this)).retain({[o.statics.blotName]:s});return this.editor.update(d,[],u)},jp.sources.USER)}),n){const o=this.clipboard.convert({html:`${n}<p><br></p>`,text:`
`});this.setContents(o)}this.history.clear(),this.options.placeholder&&this.root.setAttribute("data-placeholder",this.options.placeholder),this.options.readOnly&&this.disable(),this.allowReadOnlyEdits=!1}addContainer(e){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;if(typeof e=="string"){const n=e;e=document.createElement("div"),e.classList.add(n)}return this.container.insertBefore(e,i),e}blur(){this.selection.setRange(null)}deleteText(e,i,n){return[e,i,,n]=Em(e,i,n),$p.call(this,()=>this.editor.deleteText(e,i),n,e,-1*i)}disable(){this.enable(!1)}editReadOnly(e){this.allowReadOnlyEdits=!0;const i=e();return this.allowReadOnlyEdits=!1,i}enable(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;this.scroll.enable(e),this.container.classList.toggle("ql-disabled",!e)}focus(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.selection.focus(),e.preventScroll||this.scrollSelectionIntoView()}format(e,i){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:mi.sources.API;return $p.call(this,()=>{const r=this.getSelection(!0);let a=new Ii;if(r==null)return a;if(this.scroll.query(e,Si.BLOCK))a=this.editor.formatLine(r.index,r.length,{[e]:i});else{if(r.length===0)return this.selection.format(e,i),a;a=this.editor.formatText(r.index,r.length,{[e]:i})}return this.setSelection(r,mi.sources.SILENT),a},n)}formatLine(e,i,n,r,a){let o;return[e,i,o,a]=Em(e,i,n,r,a),$p.call(this,()=>this.editor.formatLine(e,i,o),a,e,0)}formatText(e,i,n,r,a){let o;return[e,i,o,a]=Em(e,i,n,r,a),$p.call(this,()=>this.editor.formatText(e,i,o),a,e,0)}getBounds(e){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=null;if(typeof e=="number"?n=this.selection.getBounds(e,i):n=this.selection.getBounds(e.index,e.length),!n)return null;const r=this.container.getBoundingClientRect();return{bottom:n.bottom-r.top,height:n.height,left:n.left-r.left,right:n.right-r.left,top:n.top-r.top,width:n.width}}getContents(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.getLength()-e;return[e,i]=Em(e,i),this.editor.getContents(e,i)}getFormat(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.getSelection(!0),i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return typeof e=="number"?this.editor.getFormat(e,i):this.editor.getFormat(e.index,e.length)}getIndex(e){return e.offset(this.scroll)}getLength(){return this.scroll.length()}getLeaf(e){return this.scroll.leaf(e)}getLine(e){return this.scroll.line(e)}getLines(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Number.MAX_VALUE;return typeof e!="number"?this.scroll.lines(e.index,e.length):this.scroll.lines(e,i)}getModule(e){return this.theme.modules[e]}getSelection(){return(arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1)&&this.focus(),this.update(),this.selection.getRange()[0]}getSemanticHTML(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,i=arguments.length>1?arguments[1]:void 0;return typeof e=="number"&&(i=i??this.getLength()-e),[e,i]=Em(e,i),this.editor.getHTML(e,i)}getText(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,i=arguments.length>1?arguments[1]:void 0;return typeof e=="number"&&(i=i??this.getLength()-e),[e,i]=Em(e,i),this.editor.getText(e,i)}hasFocus(){return this.selection.hasFocus()}insertEmbed(e,i,n){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:jp.sources.API;return $p.call(this,()=>this.editor.insertEmbed(e,i,n),r,e)}insertText(e,i,n,r,a){let o;return[e,,o,a]=Em(e,0,n,r,a),$p.call(this,()=>this.editor.insertText(e,i,o),a,e,i.length)}isEnabled(){return this.scroll.isEnabled()}off(){return this.emitter.off(...arguments)}on(){return this.emitter.on(...arguments)}once(){return this.emitter.once(...arguments)}removeFormat(){const[e,i,,n]=Em(...arguments);return $p.call(this,()=>this.editor.removeFormat(e,i),n,e)}scrollRectIntoView(e){imt(this.root,e)}scrollIntoView(){console.warn("Quill#scrollIntoView() has been deprecated and will be removed in the near future. Please use Quill#scrollSelectionIntoView() instead."),this.scrollSelectionIntoView()}scrollSelectionIntoView(){const e=this.selection.lastRange,i=e&&this.selection.getBounds(e.index,e.length);i&&this.scrollRectIntoView(i)}setContents(e){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:mi.sources.API;return $p.call(this,()=>{e=new Ii(e);const n=this.getLength(),r=this.editor.deleteText(0,n),a=this.editor.insertContents(0,e),o=this.editor.deleteText(this.getLength()-1,1);return r.compose(a).compose(o)},i)}setSelection(e,i,n){e==null?this.selection.setRange(null,i||jp.sources.API):([e,i,,n]=Em(e,i,n),this.selection.setRange(new UI(Math.max(0,e),i),n),n!==mi.sources.SILENT&&this.scrollSelectionIntoView())}setText(e){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:mi.sources.API;const n=new Ii().insert(e);return this.setContents(n,i)}update(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:mi.sources.USER;const i=this.scroll.update(e);return this.selection.update(e),i}updateContents(e){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:mi.sources.API;return $p.call(this,()=>(e=new Ii(e),this.editor.applyDelta(e)),i,!0)}};Je(jp,"DEFAULTS",{bounds:null,modules:{clipboard:!0,keyboard:!0,history:!0,uploader:!0},placeholder:"",readOnly:!1,registry:nN,theme:"default"}),Je(jp,"events",mi.events),Je(jp,"sources",mi.sources),Je(jp,"version","2.0.0-rc.4"),Je(jp,"imports",{delta:Ii,parchment:Nft,"core/module":jh,"core/theme":uT});let wt=jp;function Cte(t){return typeof t=="string"?document.querySelector(t):t}function p2(t){return Object.entries(t??{}).reduce((e,i)=>{let[n,r]=i;return{...e,[n]:r===!0?{}:r}},{})}function Pte(t){return Object.fromEntries(Object.entries(t).filter(e=>e[1]!==void 0))}function omt(t,e){const i=Cte(t);if(!i)throw new Error("Invalid Quill container");const r=!e.theme||e.theme===wt.DEFAULTS.theme?uT:wt.import(`themes/${e.theme}`);if(!r)throw new Error(`Invalid theme ${e.theme}. Did you register it?`);const{modules:a,...o}=wt.DEFAULTS,{modules:s,...l}=r.DEFAULTS,c=kv({},p2(a),p2(s),p2(e.modules));c!=null&&c.toolbar&&c.toolbar.constructor!==Object&&(c.toolbar={container:c.toolbar});const u={...o,...Pte(l),...Pte(e)};let d=e.registry;return d?e.formats&&Z0.warn('Ignoring "formats" option because "registry" is specified'):d=e.formats?amt(e.formats,u.registry,Z0):u.registry,{...u,registry:d,container:i,theme:r,modules:Object.entries(c).reduce((p,h)=>{let[f,m]=h;if(!m)return p;const g=wt.import(`modules/${f}`);return g==null?(Z0.error(`Cannot load ${f} module. Are you sure you registered it?`),p):{...p,[f]:kv({},g.DEFAULTS||{},m)}},{}),bounds:Cte(u.bounds)}}function $p(t,e,i,n){if(!this.isEnabled()&&e===mi.sources.USER&&!this.allowReadOnlyEdits)return new Ii;let r=i==null?null:this.getSelection();const a=this.editor.delta,o=t();if(r!=null&&(i===!0&&(i=r.index),n==null?r=Rte(r,o,e):n!==0&&(r=Rte(r,i,n,e)),this.setSelection(r,mi.sources.SILENT)),o.length()>0){const s=[mi.events.TEXT_CHANGE,o,a,e];this.emitter.emit(mi.events.EDITOR_CHANGE,...s),e!==mi.sources.SILENT&&this.emitter.emit(...s)}return o}function Em(t,e,i,n,r){let a={};return typeof t.index=="number"&&typeof t.length=="number"?typeof e!="number"?(r=n,n=i,i=e,e=t.length,t=t.index):(e=t.length,t=t.index):typeof e!="number"&&(r=n,n=i,i=e,e=0),typeof i=="object"?(a=i,r=n):typeof i=="string"&&(n!=null?a[i]=n:r=i),r=r||mi.sources.API,[t,e,a,r]}function Rte(t,e,i,n){const r=typeof i=="number"?i:0;if(t==null)return null;let a,o;return e&&typeof e.transformPosition=="function"?[a,o]=[t.index,t.index+t.length].map(s=>e.transformPosition(s,n!==mi.sources.USER)):[a,o]=[t.index,t.index+t.length].map(s=>s<e||s===e&&n===mi.sources.USER?s:r>=0?s+r:Math.max(e,s+r)),new UI(a,o-a)}class Aw extends hB{}function Mte(t){return t instanceof Cl||t instanceof Kd}function Nte(t){return typeof t.updateContent=="function"}class E0 extends nK{constructor(e,i,n){let{emitter:r}=n;super(e,i),this.emitter=r,this.batch=!1,this.optimize(),this.enable(),this.domNode.addEventListener("dragstart",a=>this.handleDragStart(a))}batchStart(){Array.isArray(this.batch)||(this.batch=[])}batchEnd(){if(!this.batch)return;const e=this.batch;this.batch=!1,this.update(e)}emitMount(e){this.emitter.emit(mi.events.SCROLL_BLOT_MOUNT,e)}emitUnmount(e){this.emitter.emit(mi.events.SCROLL_BLOT_UNMOUNT,e)}emitEmbedUpdate(e,i){this.emitter.emit(mi.events.SCROLL_EMBED_UPDATE,e,i)}deleteAt(e,i){const[n,r]=this.line(e),[a]=this.line(e+i);if(super.deleteAt(e,i),a!=null&&n!==a&&r>0){if(n instanceof Kd||a instanceof Kd){this.optimize();return}const o=a.children.head instanceof Vh?null:a.children.head;n.moveChildren(a,o),n.remove()}this.optimize()}enable(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;this.domNode.setAttribute("contenteditable",e?"true":"false")}formatAt(e,i,n,r){super.formatAt(e,i,n,r),this.optimize()}insertAt(e,i,n){if(e>=this.length())if(n==null||this.scroll.query(i,Si.BLOCK)==null){const r=this.scroll.create(this.statics.defaultChild.blotName);this.appendChild(r),n==null&&i.endsWith(`
`)?r.insertAt(0,i.slice(0,-1),n):r.insertAt(0,i,n)}else{const r=this.scroll.create(i,n);this.appendChild(r)}else super.insertAt(e,i,n);this.optimize()}insertBefore(e,i){if(e.statics.scope===Si.INLINE_BLOT){const n=this.scroll.create(this.statics.defaultChild.blotName);n.appendChild(e),super.insertBefore(n,i)}else super.insertBefore(e,i)}insertContents(e,i){const n=this.deltaToRenderBlocks(i.concat(new Ii().insert(`
`))),r=n.pop();if(r==null)return;this.batchStart();const a=n.shift();if(a){const l=a.type==="block"&&(a.delta.length()===0||!this.descendant(Kd,e)[0]&&e<this.length()),c=a.type==="block"?a.delta:new Ii().insert({[a.key]:a.value});h2(this,e,c);const u=a.type==="block"?1:0,d=e+c.length()+u;l&&this.insertAt(d-1,`
`);const p=qd(this.line(e)[0]),h=Jd.AttributeMap.diff(p,a.attributes)||{};Object.keys(h).forEach(f=>{this.formatAt(d-1,1,f,h[f])}),e=d}let[o,s]=this.children.find(e);if(n.length&&(o&&(o=o.split(s),s=0),n.forEach(l=>{if(l.type==="block"){const c=this.createBlock(l.attributes,o||void 0);h2(c,0,l.delta)}else{const c=this.create(l.key,l.value);this.insertBefore(c,o||void 0),Object.keys(l.attributes).forEach(u=>{c.format(u,l.attributes[u])})}})),r.type==="block"&&r.delta.length()){const l=o?o.offset(o.scroll)+s:this.length();h2(this,l,r.delta)}this.batchEnd(),this.optimize()}isEnabled(){return this.domNode.getAttribute("contenteditable")==="true"}leaf(e){const i=this.path(e).pop();if(!i)return[null,-1];const[n,r]=i;return n instanceof Wl?[n,r]:[null,-1]}line(e){return e===this.length()?this.line(e-1):this.descendant(Mte,e)}lines(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Number.MAX_VALUE;const n=(r,a,o)=>{let s=[],l=o;return r.children.forEachAt(a,o,(c,u,d)=>{Mte(c)?s.push(c):c instanceof hB&&(s=s.concat(n(c,u,l))),l-=d}),s};return n(this,e,i)}optimize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.batch||(super.optimize(e,i),e.length>0&&this.emitter.emit(mi.events.SCROLL_OPTIMIZE,e,i))}path(e){return super.path(e).slice(1)}remove(){}update(e){if(this.batch){Array.isArray(e)&&(this.batch=this.batch.concat(e));return}let i=mi.sources.USER;typeof e=="string"&&(i=e),Array.isArray(e)||(e=this.observer.takeRecords()),e=e.filter(n=>{let{target:r}=n;const a=this.find(r,!0);return a&&!Nte(a)}),e.length>0&&this.emitter.emit(mi.events.SCROLL_BEFORE_UPDATE,i,e),super.update(e.concat([])),e.length>0&&this.emitter.emit(mi.events.SCROLL_UPDATE,i,e)}updateEmbedAt(e,i,n){const[r]=this.descendant(a=>a instanceof Kd,e);r&&r.statics.blotName===i&&Nte(r)&&r.updateContent(n)}handleDragStart(e){e.preventDefault()}deltaToRenderBlocks(e){const i=[];let n=new Ii;return e.forEach(r=>{const a=r==null?void 0:r.insert;if(a)if(typeof a=="string"){const o=a.split(`
`);o.slice(0,-1).forEach(l=>{n.insert(l,r.attributes),i.push({type:"block",delta:n,attributes:r.attributes??{}}),n=new Ii});const s=o[o.length-1];s&&n.insert(s,r.attributes)}else{const o=Object.keys(a)[0];if(!o)return;this.query(o,Si.INLINE)?n.push(r):(n.length()&&i.push({type:"block",delta:n,attributes:{}}),n=new Ii,i.push({type:"blockEmbed",key:o,value:a[o],attributes:r.attributes??{}}))}}),n.length()&&i.push({type:"block",delta:n,attributes:{}}),i}createBlock(e,i){let n;const r={};Object.entries(e).forEach(s=>{let[l,c]=s;this.query(l,Si.BLOCK&Si.BLOT)!=null?n=l:r[l]=c});const a=this.create(n||this.statics.defaultChild.blotName,n?e[n]:void 0);this.insertBefore(a,i||void 0);const o=a.length();return Object.entries(r).forEach(s=>{let[l,c]=s;a.formatAt(0,o,l,c)}),a}}Je(E0,"blotName","scroll"),Je(E0,"className","ql-editor"),Je(E0,"tagName","DIV"),Je(E0,"defaultChild",Cl),Je(E0,"allowedChildren",[Cl,Kd,Aw]);function h2(t,e,i){i.reduce((n,r)=>{const a=Jd.Op.length(r);let o=r.attributes||{};if(r.insert!=null){if(typeof r.insert=="string"){const s=r.insert;t.insertAt(n,s);const[l]=t.descendant(Wl,n),c=qd(l);o=Jd.AttributeMap.diff(c,o)||{}}else if(typeof r.insert=="object"){const s=Object.keys(r.insert)[0];if(s==null)return n;if(t.insertAt(n,s,r.insert[s]),t.scroll.query(s,Si.INLINE)!=null){const[c]=t.descendant(Wl,n),u=qd(c);o=Jd.AttributeMap.diff(u,o)||{}}}}return Object.keys(o).forEach(s=>{t.formatAt(n,a,s,o[s])}),n+a},e)}const cK={scope:Si.BLOCK,whitelist:["right","center","justify"]},smt=new Kf("align","align",cK),OEe=new $h("align","ql-align",cK),LEe=new Yy("align","text-align",cK);class FEe extends Yy{value(e){let i=super.value(e);return i.startsWith("rgb(")?(i=i.replace(/^[^\d]+/,"").replace(/[^\d]+$/,""),`#${i.split(",").map(r=>`00${parseInt(r,10).toString(16)}`.slice(-2)).join("")}`):i}}const lmt=new $h("color","ql-color",{scope:Si.INLINE}),uK=new FEe("color","color",{scope:Si.INLINE}),cmt=new $h("background","ql-bg",{scope:Si.INLINE}),dK=new FEe("background","background-color",{scope:Si.INLINE});class _w extends Aw{static create(e){const i=super.create(e);return i.setAttribute("spellcheck","false"),i}code(e,i){return this.children.map(n=>n.length()<=1?"":n.domNode.innerText).join(`
`).slice(e,e+i)}html(e,i){return`<pre>
${vB(this.code(e,i))}
</pre>`}}class Yl extends Cl{static register(){wt.register(_w)}}Je(Yl,"TAB","  ");class pK extends Yf{}pK.blotName="code";pK.tagName="CODE";Yl.blotName="code-block";Yl.className="ql-code-block";Yl.tagName="DIV";_w.blotName="code-block-container";_w.className="ql-code-block-container";_w.tagName="DIV";_w.allowedChildren=[Yl];Yl.allowedChildren=[Ah,Vh,cT];Yl.requiredContainer=_w;const hK={scope:Si.BLOCK,whitelist:["rtl"]},BEe=new Kf("direction","dir",hK),$Ee=new $h("direction","ql-direction",hK),VEe=new Yy("direction","direction",hK),jEe={scope:Si.INLINE,whitelist:["serif","monospace"]},GEe=new $h("font","ql-font",jEe);class umt extends Yy{value(e){return super.value(e).replace(/["']/g,"")}}const HEe=new umt("font","font-family",jEe),zEe=new $h("size","ql-size",{scope:Si.INLINE,whitelist:["small","large","huge"]}),qEe=new Yy("size","font-size",{scope:Si.INLINE,whitelist:["10px","18px","32px"]}),dmt=Wg("quill:keyboard"),pmt=/Mac/i.test(navigator.platform)?"metaKey":"ctrlKey";class yB extends jh{static match(e,i){return["altKey","ctrlKey","metaKey","shiftKey"].some(n=>!!i[n]!==e[n]&&i[n]!==null)?!1:i.key===e.key||i.key===e.which}constructor(e,i){super(e,i),this.bindings={},Object.keys(this.options.bindings).forEach(n=>{this.options.bindings[n]&&this.addBinding(this.options.bindings[n])}),this.addBinding({key:"Enter",shiftKey:null},this.handleEnter),this.addBinding({key:"Enter",metaKey:null,ctrlKey:null,altKey:null},()=>{}),/Firefox/i.test(navigator.userAgent)?(this.addBinding({key:"Backspace"},{collapsed:!0},this.handleBackspace),this.addBinding({key:"Delete"},{collapsed:!0},this.handleDelete)):(this.addBinding({key:"Backspace"},{collapsed:!0,prefix:/^.?$/},this.handleBackspace),this.addBinding({key:"Delete"},{collapsed:!0,suffix:/^.?$/},this.handleDelete)),this.addBinding({key:"Backspace"},{collapsed:!1},this.handleDeleteRange),this.addBinding({key:"Delete"},{collapsed:!1},this.handleDeleteRange),this.addBinding({key:"Backspace",altKey:null,ctrlKey:null,metaKey:null,shiftKey:null},{collapsed:!0,offset:0},this.handleBackspace),this.listen()}addBinding(e){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const r=fmt(e);if(r==null){dmt.warn("Attempted to add invalid keyboard binding",r);return}typeof i=="function"&&(i={handler:i}),typeof n=="function"&&(n={handler:n}),(Array.isArray(r.key)?r.key:[r.key]).forEach(o=>{const s={...r,key:o,...i,...n};this.bindings[s.key]=this.bindings[s.key]||[],this.bindings[s.key].push(s)})}listen(){this.quill.root.addEventListener("keydown",e=>{if(e.defaultPrevented||e.isComposing)return;const n=(this.bindings[e.key]||[]).concat(this.bindings[e.which]||[]).filter(g=>yB.match(e,g));if(n.length===0)return;const r=wt.find(e.target,!0);if(r&&r.scroll!==this.quill.scroll)return;const a=this.quill.getSelection();if(a==null||!this.quill.hasFocus())return;const[o,s]=this.quill.getLine(a.index),[l,c]=this.quill.getLeaf(a.index),[u,d]=a.length===0?[l,c]:this.quill.getLeaf(a.index+a.length),p=l instanceof yk?l.value().slice(0,c):"",h=u instanceof yk?u.value().slice(d):"",f={collapsed:a.length===0,empty:a.length===0&&o.length()<=1,format:this.quill.getFormat(a),line:o,offset:s,prefix:p,suffix:h,event:e};n.some(g=>{if(g.collapsed!=null&&g.collapsed!==f.collapsed||g.empty!=null&&g.empty!==f.empty||g.offset!=null&&g.offset!==f.offset)return!1;if(Array.isArray(g.format)){if(g.format.every(v=>f.format[v]==null))return!1}else if(typeof g.format=="object"&&!Object.keys(g.format).every(v=>g.format[v]===!0?f.format[v]!=null:g.format[v]===!1?f.format[v]==null:tK(g.format[v],f.format[v])))return!1;return g.prefix!=null&&!g.prefix.test(f.prefix)||g.suffix!=null&&!g.suffix.test(f.suffix)?!1:g.handler.call(this,a,f,g)!==!0})&&e.preventDefault()})}handleBackspace(e,i){const n=/[\uD800-\uDBFF][\uDC00-\uDFFF]$/.test(i.prefix)?2:1;if(e.index===0||this.quill.getLength()<=1)return;let r={};const[a]=this.quill.getLine(e.index);let o=new Ii().retain(e.index-n).delete(n);if(i.offset===0){const[s]=this.quill.getLine(e.index-1);if(s&&!(s.statics.blotName==="block"&&s.length()<=1)){const c=a.formats(),u=this.quill.getFormat(e.index-1,1);if(r=Jd.AttributeMap.diff(c,u)||{},Object.keys(r).length>0){const d=new Ii().retain(e.index+a.length()-2).retain(1,r);o=o.compose(d)}}}this.quill.updateContents(o,wt.sources.USER),this.quill.focus()}handleDelete(e,i){const n=/^[\uD800-\uDBFF][\uDC00-\uDFFF]/.test(i.suffix)?2:1;if(e.index>=this.quill.getLength()-n)return;let r={};const[a]=this.quill.getLine(e.index);let o=new Ii().retain(e.index).delete(n);if(i.offset>=a.length()-1){const[s]=this.quill.getLine(e.index+1);if(s){const l=a.formats(),c=this.quill.getFormat(e.index,1);r=Jd.AttributeMap.diff(l,c)||{},Object.keys(r).length>0&&(o=o.retain(s.length()-1).retain(1,r))}}this.quill.updateContents(o,wt.sources.USER),this.quill.focus()}handleDeleteRange(e){fK({range:e,quill:this.quill}),this.quill.focus()}handleEnter(e,i){const n=Object.keys(i.format).reduce((a,o)=>(this.quill.scroll.query(o,Si.BLOCK)&&!Array.isArray(i.format[o])&&(a[o]=i.format[o]),a),{}),r=new Ii().retain(e.index).delete(e.length).insert(`
`,n);this.quill.updateContents(r,wt.sources.USER),this.quill.setSelection(e.index+1,wt.sources.SILENT),this.quill.focus()}}const hmt={bindings:{bold:f2("bold"),italic:f2("italic"),underline:f2("underline"),indent:{key:"Tab",format:["blockquote","indent","list"],handler(t,e){return e.collapsed&&e.offset!==0?!0:(this.quill.format("indent","+1",wt.sources.USER),!1)}},outdent:{key:"Tab",shiftKey:!0,format:["blockquote","indent","list"],handler(t,e){return e.collapsed&&e.offset!==0?!0:(this.quill.format("indent","-1",wt.sources.USER),!1)}},"outdent backspace":{key:"Backspace",collapsed:!0,shiftKey:null,metaKey:null,ctrlKey:null,altKey:null,format:["indent","list"],offset:0,handler(t,e){e.format.indent!=null?this.quill.format("indent","-1",wt.sources.USER):e.format.list!=null&&this.quill.format("list",!1,wt.sources.USER)}},"indent code-block":Ate(!0),"outdent code-block":Ate(!1),"remove tab":{key:"Tab",shiftKey:!0,collapsed:!0,prefix:/\t$/,handler(t){this.quill.deleteText(t.index-1,1,wt.sources.USER)}},tab:{key:"Tab",handler(t,e){if(e.format.table)return!0;this.quill.history.cutoff();const i=new Ii().retain(t.index).delete(t.length).insert("	");return this.quill.updateContents(i,wt.sources.USER),this.quill.history.cutoff(),this.quill.setSelection(t.index+1,wt.sources.SILENT),!1}},"blockquote empty enter":{key:"Enter",collapsed:!0,format:["blockquote"],empty:!0,handler(){this.quill.format("blockquote",!1,wt.sources.USER)}},"list empty enter":{key:"Enter",collapsed:!0,format:["list"],empty:!0,handler(t,e){const i={list:!1};e.format.indent&&(i.indent=!1),this.quill.formatLine(t.index,t.length,i,wt.sources.USER)}},"checklist enter":{key:"Enter",collapsed:!0,format:{list:"checked"},handler(t){const[e,i]=this.quill.getLine(t.index),n={...e.formats(),list:"checked"},r=new Ii().retain(t.index).insert(`
`,n).retain(e.length()-i-1).retain(1,{list:"unchecked"});this.quill.updateContents(r,wt.sources.USER),this.quill.setSelection(t.index+1,wt.sources.SILENT),this.quill.scrollSelectionIntoView()}},"header enter":{key:"Enter",collapsed:!0,format:["header"],suffix:/^$/,handler(t,e){const[i,n]=this.quill.getLine(t.index),r=new Ii().retain(t.index).insert(`
`,e.format).retain(i.length()-n-1).retain(1,{header:null});this.quill.updateContents(r,wt.sources.USER),this.quill.setSelection(t.index+1,wt.sources.SILENT),this.quill.scrollSelectionIntoView()}},"table backspace":{key:"Backspace",format:["table"],collapsed:!0,offset:0,handler(){}},"table delete":{key:"Delete",format:["table"],collapsed:!0,suffix:/^$/,handler(){}},"table enter":{key:"Enter",shiftKey:null,format:["table"],handler(t){const e=this.quill.getModule("table");if(e){const[i,n,r,a]=e.getTable(t),o=mmt(i,n,r,a);if(o==null)return;let s=i.offset();if(o<0){const l=new Ii().retain(s).insert(`
`);this.quill.updateContents(l,wt.sources.USER),this.quill.setSelection(t.index+1,t.length,wt.sources.SILENT)}else if(o>0){s+=i.length();const l=new Ii().retain(s).insert(`
`);this.quill.updateContents(l,wt.sources.USER),this.quill.setSelection(s,wt.sources.USER)}}}},"table tab":{key:"Tab",shiftKey:null,format:["table"],handler(t,e){const{event:i,line:n}=e,r=n.offset(this.quill.scroll);i.shiftKey?this.quill.setSelection(r-1,wt.sources.USER):this.quill.setSelection(r+n.length(),wt.sources.USER)}},"list autofill":{key:" ",shiftKey:null,collapsed:!0,format:{"code-block":!1,blockquote:!1,table:!1},prefix:/^\s*?(\d+\.|-|\*|\[ ?\]|\[x\])$/,handler(t,e){if(this.quill.scroll.query("list")==null)return!0;const{length:i}=e.prefix,[n,r]=this.quill.getLine(t.index);if(r>i)return!0;let a;switch(e.prefix.trim()){case"[]":case"[ ]":a="unchecked";break;case"[x]":a="checked";break;case"-":case"*":a="bullet";break;default:a="ordered"}this.quill.insertText(t.index," ",wt.sources.USER),this.quill.history.cutoff();const o=new Ii().retain(t.index-r).delete(i+1).retain(n.length()-2-r).retain(1,{list:a});return this.quill.updateContents(o,wt.sources.USER),this.quill.history.cutoff(),this.quill.setSelection(t.index-i,wt.sources.SILENT),!1}},"code exit":{key:"Enter",collapsed:!0,format:["code-block"],prefix:/^$/,suffix:/^\s*$/,handler(t){const[e,i]=this.quill.getLine(t.index);let n=2,r=e;for(;r!=null&&r.length()<=1&&r.formats()["code-block"];)if(r=r.prev,n-=1,n<=0){const a=new Ii().retain(t.index+e.length()-i-2).retain(1,{"code-block":null}).delete(1);return this.quill.updateContents(a,wt.sources.USER),this.quill.setSelection(t.index-1,wt.sources.SILENT),!1}return!0}},"embed left":rN("ArrowLeft",!1),"embed left shift":rN("ArrowLeft",!0),"embed right":rN("ArrowRight",!1),"embed right shift":rN("ArrowRight",!0),"table down":_te(!1),"table up":_te(!0)}};yB.DEFAULTS=hmt;function Ate(t){return{key:"Tab",shiftKey:!t,format:{"code-block":!0},handler(e,i){let{event:n}=i;const r=this.quill.scroll.query("code-block"),{TAB:a}=r;if(e.length===0&&!n.shiftKey){this.quill.insertText(e.index,a,wt.sources.USER),this.quill.setSelection(e.index+a.length,wt.sources.SILENT);return}const o=e.length===0?this.quill.getLines(e.index,1):this.quill.getLines(e);let{index:s,length:l}=e;o.forEach((c,u)=>{t?(c.insertAt(0,a),u===0?s+=a.length:l+=a.length):c.domNode.textContent.startsWith(a)&&(c.deleteAt(0,a.length),u===0?s-=a.length:l-=a.length)}),this.quill.update(wt.sources.USER),this.quill.setSelection(s,l,wt.sources.SILENT)}}}function rN(t,e){return{key:t,shiftKey:e,altKey:null,[t==="ArrowLeft"?"prefix":"suffix"]:/^$/,handler(n){let{index:r}=n;t==="ArrowRight"&&(r+=n.length+1);const[a]=this.quill.getLeaf(r);return a instanceof Nd?(t==="ArrowLeft"?e?this.quill.setSelection(n.index-1,n.length+1,wt.sources.USER):this.quill.setSelection(n.index-1,wt.sources.USER):e?this.quill.setSelection(n.index,n.length+1,wt.sources.USER):this.quill.setSelection(n.index+n.length+1,wt.sources.USER),!1):!0}}}function f2(t){return{key:t[0],shortKey:!0,handler(e,i){this.quill.format(t,!i.format[t],wt.sources.USER)}}}function _te(t){return{key:t?"ArrowUp":"ArrowDown",collapsed:!0,format:["table"],handler(e,i){const n=t?"prev":"next",r=i.line,a=r.parent[n];if(a!=null){if(a.statics.blotName==="table-row"){let o=a.children.head,s=r;for(;s.prev!=null;)s=s.prev,o=o.next;const l=o.offset(this.quill.scroll)+Math.min(i.offset,o.length()-1);this.quill.setSelection(l,0,wt.sources.USER)}}else{const o=r.table()[n];o!=null&&(t?this.quill.setSelection(o.offset(this.quill.scroll)+o.length()-1,0,wt.sources.USER):this.quill.setSelection(o.offset(this.quill.scroll),0,wt.sources.USER))}return!1}}}function fmt(t){if(typeof t=="string"||typeof t=="number")t={key:t};else if(typeof t=="object")t=K0(t);else return null;return t.shortKey&&(t[pmt]=t.shortKey,delete t.shortKey),t}function fK(t){let{quill:e,range:i}=t;const n=e.getLines(i);let r={};if(n.length>1){const a=n[0].formats(),o=n[n.length-1].formats();r=Jd.AttributeMap.diff(o,a)||{}}e.deleteText(i,wt.sources.USER),Object.keys(r).length>0&&e.formatLine(i.index,1,r,wt.sources.USER),e.setSelection(i.index,wt.sources.SILENT)}function mmt(t,e,i,n){return e.prev==null&&e.next==null?i.prev==null&&i.next==null?n===0?-1:1:i.prev==null?-1:1:e.prev==null?-1:e.next==null?1:null}const gmt=/font-weight:\s*normal/,vmt=["P","OL","UL"],kte=t=>t&&vmt.includes(t.tagName),ymt=t=>{Array.from(t.querySelectorAll("br")).filter(e=>kte(e.previousElementSibling)&&kte(e.nextElementSibling)).forEach(e=>{var i;(i=e.parentNode)==null||i.removeChild(e)})},bmt=t=>{Array.from(t.querySelectorAll('b[style*="font-weight"]')).filter(e=>{var i;return(i=e.getAttribute("style"))==null?void 0:i.match(gmt)}).forEach(e=>{var n;const i=t.createDocumentFragment();i.append(...e.childNodes),(n=e.parentNode)==null||n.replaceChild(i,e)})};function Imt(t){t.querySelector('[id^="docs-internal-guid-"]')&&(bmt(t),ymt(t))}const wmt=/\bmso-list:[^;]*ignore/i,Smt=/\bmso-list:[^;]*\bl(\d+)/i,Tmt=/\bmso-list:[^;]*\blevel(\d+)/i,Umt=(t,e)=>{const i=t.getAttribute("style"),n=i==null?void 0:i.match(Smt);if(!n)return null;const r=Number(n[1]),a=i==null?void 0:i.match(Tmt),o=a?Number(a[1]):1,s=new RegExp(`@list l${r}:level${o}\\s*\\{[^\\}]*mso-level-number-format:\\s*([\\w-]+)`,"i"),l=e.match(s),c=l&&l[1]==="bullet"?"bullet":"ordered";return{id:r,indent:o,type:c,element:t}},Dmt=t=>{var o,s;const e=Array.from(t.querySelectorAll("[style*=mso-list]")),i=[],n=[];e.forEach(l=>{(l.getAttribute("style")||"").match(wmt)?i.push(l):n.push(l)}),i.forEach(l=>{var c;return(c=l.parentNode)==null?void 0:c.removeChild(l)});const r=t.documentElement.innerHTML,a=n.map(l=>Umt(l,r)).filter(l=>l);for(;a.length;){const l=[];let c=a.shift();for(;c;)l.push(c),c=a.length&&((o=a[0])==null?void 0:o.element)===c.element.nextElementSibling&&a[0].id===c.id?a.shift():null;const u=document.createElement("ul");l.forEach(h=>{const f=document.createElement("li");f.setAttribute("data-list",h.type),h.indent>1&&f.setAttribute("class",`ql-indent-${h.indent-1}`),f.innerHTML=h.element.innerHTML,u.appendChild(f)});const d=(s=l[0])==null?void 0:s.element,{parentNode:p}=d??{};d&&(p==null||p.replaceChild(u,d)),l.slice(1).forEach(h=>{let{element:f}=h;p==null||p.removeChild(f)})}};function Emt(t){t.documentElement.getAttribute("xmlns:w")==="urn:schemas-microsoft-com:office:word"&&Dmt(t)}const Cmt=[Emt,Imt],Pmt=t=>{t.documentElement&&Cmt.forEach(e=>{e(t)})},Rmt=Wg("quill:clipboard"),Mmt=[[Node.TEXT_NODE,jmt],[Node.TEXT_NODE,Ote],["br",xmt],[Node.ELEMENT_NODE,Ote],[Node.ELEMENT_NODE,kmt],[Node.ELEMENT_NODE,_mt],[Node.ELEMENT_NODE,$mt],["li",Fmt],["ol, ul",Bmt],["pre",Omt],["tr",Vmt],["b",m2("bold")],["i",m2("italic")],["strike",m2("strike")],["style",Lmt]],Nmt=[smt,BEe].reduce((t,e)=>(t[e.keyName]=e,t),{}),xte=[LEe,dK,uK,VEe,HEe,qEe].reduce((t,e)=>(t[e.keyName]=e,t),{});class WEe extends jh{constructor(e,i){super(e,i),this.quill.root.addEventListener("copy",n=>this.onCaptureCopy(n,!1)),this.quill.root.addEventListener("cut",n=>this.onCaptureCopy(n,!0)),this.quill.root.addEventListener("paste",this.onCapturePaste.bind(this)),this.matchers=[],Mmt.concat(this.options.matchers??[]).forEach(n=>{let[r,a]=n;this.addMatcher(r,a)})}addMatcher(e,i){this.matchers.push([e,i])}convert(e){let{html:i,text:n}=e,r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(r[Yl.blotName])return new Ii().insert(n||"",{[Yl.blotName]:r[Yl.blotName]});if(!i)return new Ii().insert(n||"",r);const a=this.convertHTML(i);return oM(a,`
`)&&(a.ops[a.ops.length-1].attributes==null||r.table)?a.compose(new Ii().retain(a.length()-1).delete(1)):a}normalizeHTML(e){Pmt(e)}convertHTML(e){const i=new DOMParser().parseFromString(e,"text/html");this.normalizeHTML(i);const n=i.body,r=new WeakMap,[a,o]=this.prepareMatching(n,r);return mK(this.quill.scroll,n,a,o,r)}dangerouslyPasteHTML(e,i){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:wt.sources.API;if(typeof e=="string"){const r=this.convert({html:e,text:""});this.quill.setContents(r,i),this.quill.setSelection(0,wt.sources.SILENT)}else{const r=this.convert({html:i,text:""});this.quill.updateContents(new Ii().retain(e).concat(r),n),this.quill.setSelection(e+r.length(),wt.sources.SILENT)}}onCaptureCopy(e){var o,s;let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(e.defaultPrevented)return;e.preventDefault();const[n]=this.quill.selection.getRange();if(n==null)return;const{html:r,text:a}=this.onCopy(n,i);(o=e.clipboardData)==null||o.setData("text/plain",a),(s=e.clipboardData)==null||s.setData("text/html",r),i&&fK({range:n,quill:this.quill})}normalizeURIList(e){return e.split(/\r?\n/).filter(i=>i[0]!=="#").join(`
`)}onCapturePaste(e){var o,s,l,c,u;if(e.defaultPrevented||!this.quill.isEnabled())return;e.preventDefault();const i=this.quill.getSelection(!0);if(i==null)return;const n=(o=e.clipboardData)==null?void 0:o.getData("text/html");let r=(s=e.clipboardData)==null?void 0:s.getData("text/plain");if(!n&&!r){const d=(l=e.clipboardData)==null?void 0:l.getData("text/uri-list");d&&(r=this.normalizeURIList(d))}const a=Array.from(((c=e.clipboardData)==null?void 0:c.files)||[]);if(!n&&a.length>0){this.quill.uploader.upload(i,a);return}if(n&&a.length>0){const d=new DOMParser().parseFromString(n,"text/html");if(d.body.childElementCount===1&&((u=d.body.firstElementChild)==null?void 0:u.tagName)==="IMG"){this.quill.uploader.upload(i,a);return}}this.onPaste(i,{html:n,text:r})}onCopy(e){const i=this.quill.getText(e);return{html:this.quill.getSemanticHTML(e),text:i}}onPaste(e,i){let{text:n,html:r}=i;const a=this.quill.getFormat(e.index),o=this.convert({text:n,html:r},a);Rmt.log("onPaste",o,{text:n,html:r});const s=new Ii().retain(e.index).delete(e.length).concat(o);this.quill.updateContents(s,wt.sources.USER),this.quill.setSelection(s.length()-e.length,wt.sources.SILENT),this.quill.scrollSelectionIntoView()}prepareMatching(e,i){const n=[],r=[];return this.matchers.forEach(a=>{const[o,s]=a;switch(o){case Node.TEXT_NODE:r.push(s);break;case Node.ELEMENT_NODE:n.push(s);break;default:Array.from(e.querySelectorAll(o)).forEach(l=>{if(i.has(l)){const c=i.get(l);c==null||c.push(s)}else i.set(l,[s])});break}}),[n,r]}}Je(WEe,"DEFAULTS",{matchers:[]});function kw(t,e,i,n){return n.query(e)?t.reduce((r,a)=>{if(!a.insert)return r;if(a.attributes&&a.attributes[e])return r.push(a);const o=i?{[e]:i}:{};return r.insert(a.insert,{...o,...a.attributes})},new Ii):t}function oM(t,e){let i="";for(let n=t.ops.length-1;n>=0&&i.length<e.length;--n){const r=t.ops[n];if(typeof r.insert!="string")break;i=r.insert+i}return i.slice(-1*e.length)===e}function Uv(t,e){if(!(t instanceof Element))return!1;const i=e.query(t);return i&&i.prototype instanceof Nd?!1:["address","article","blockquote","canvas","dd","div","dl","dt","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","header","iframe","li","main","nav","ol","output","p","pre","section","table","td","tr","ul","video"].includes(t.tagName.toLowerCase())}function Amt(t,e){return t.previousElementSibling&&t.nextElementSibling&&!Uv(t.previousElementSibling,e)&&!Uv(t.nextElementSibling,e)}const aN=new WeakMap;function KEe(t){return t==null?!1:(aN.has(t)||(t.tagName==="PRE"?aN.set(t,!0):aN.set(t,KEe(t.parentNode))),aN.get(t))}function mK(t,e,i,n,r){return e.nodeType===e.TEXT_NODE?n.reduce((a,o)=>o(e,a,t),new Ii):e.nodeType===e.ELEMENT_NODE?Array.from(e.childNodes||[]).reduce((a,o)=>{let s=mK(t,o,i,n,r);return o.nodeType===e.ELEMENT_NODE&&(s=i.reduce((l,c)=>c(o,l,t),s),s=(r.get(o)||[]).reduce((l,c)=>c(o,l,t),s)),a.concat(s)},new Ii):new Ii}function m2(t){return(e,i,n)=>kw(i,t,!0,n)}function _mt(t,e,i){const n=Kf.keys(t),r=$h.keys(t),a=Yy.keys(t),o={};return n.concat(r).concat(a).forEach(s=>{let l=i.query(s,Si.ATTRIBUTE);l!=null&&(o[l.attrName]=l.value(t),o[l.attrName])||(l=Nmt[s],l!=null&&(l.attrName===s||l.keyName===s)&&(o[l.attrName]=l.value(t)||void 0),l=xte[s],l!=null&&(l.attrName===s||l.keyName===s)&&(l=xte[s],o[l.attrName]=l.value(t)||void 0))}),Object.entries(o).reduce((s,l)=>{let[c,u]=l;return kw(s,c,u,i)},e)}function kmt(t,e,i){const n=i.query(t);if(n==null)return e;if(n.prototype instanceof Nd){const r={},a=n.value(t);if(a!=null)return r[n.blotName]=a,new Ii().insert(r,n.formats(t,i))}else if(n.prototype instanceof WE&&!oM(e,`
`)&&e.insert(`
`),"blotName"in n&&"formats"in n&&typeof n.formats=="function")return kw(e,n.blotName,n.formats(t,i),i);return e}function xmt(t,e){return oM(e,`
`)||e.insert(`
`),e}function Omt(t,e,i){const n=i.query("code-block"),r=n&&"formats"in n&&typeof n.formats=="function"?n.formats(t,i):!0;return kw(e,"code-block",r,i)}function Lmt(){return new Ii}function Fmt(t,e,i){const n=i.query(t);if(n==null||n.blotName!=="list"||!oM(e,`
`))return e;let r=-1,a=t.parentNode;for(;a!=null;)["OL","UL"].includes(a.tagName)&&(r+=1),a=a.parentNode;return r<=0?e:e.reduce((o,s)=>s.insert?s.attributes&&typeof s.attributes.indent=="number"?o.push(s):o.insert(s.insert,{indent:r,...s.attributes||{}}):o,new Ii)}function Bmt(t,e,i){const n=t.tagName==="OL"?"ordered":"bullet";return kw(e,"list",n,i)}function Ote(t,e,i){if(!oM(e,`
`)){if(Uv(t,i)&&(t.childNodes.length>0||t instanceof HTMLParagraphElement))return e.insert(`
`);if(e.length()>0&&t.nextSibling){let n=t.nextSibling;for(;n!=null;){if(Uv(n,i))return e.insert(`
`);const r=i.query(n);if(r&&r.prototype instanceof Kd)return e.insert(`
`);n=n.firstChild}}}return e}function $mt(t,e,i){var a;const n={},r=t.style||{};return r.fontStyle==="italic"&&(n.italic=!0),r.textDecoration==="underline"&&(n.underline=!0),r.textDecoration==="line-through"&&(n.strike=!0),((a=r.fontWeight)!=null&&a.startsWith("bold")||parseInt(r.fontWeight,10)>=700)&&(n.bold=!0),e=Object.entries(n).reduce((o,s)=>{let[l,c]=s;return kw(o,l,c,i)},e),parseFloat(r.textIndent||0)>0?new Ii().insert("	").concat(e):e}function Vmt(t,e,i){var r,a;const n=((r=t.parentElement)==null?void 0:r.tagName)==="TABLE"?t.parentElement:(a=t.parentElement)==null?void 0:a.parentElement;if(n!=null){const s=Array.from(n.querySelectorAll("tr")).indexOf(t)+1;return kw(e,"table",s,i)}return e}function jmt(t,e,i){var r;let n=t.data;if(((r=t.parentElement)==null?void 0:r.tagName)==="O:P")return e.insert(n.trim());if(!KEe(t)){if(n.trim().length===0&&n.includes(`
`)&&!Amt(t,i))return e;const a=(o,s)=>{const l=s.replace(/[^\u00a0]/g,"");return l.length<1&&o?" ":l};n=n.replace(/\r\n/g," ").replace(/\n/g," "),n=n.replace(/\s\s+/g,a.bind(a,!0)),(t.previousSibling==null&&t.parentElement!=null&&Uv(t.parentElement,i)||t.previousSibling instanceof Element&&Uv(t.previousSibling,i))&&(n=n.replace(/^\s+/,a.bind(a,!1))),(t.nextSibling==null&&t.parentElement!=null&&Uv(t.parentElement,i)||t.nextSibling instanceof Element&&Uv(t.nextSibling,i))&&(n=n.replace(/\s+$/,a.bind(a,!1)))}return e.insert(n)}class YEe extends jh{constructor(i,n){super(i,n);Je(this,"lastRecorded",0);Je(this,"ignoreChange",!1);Je(this,"stack",{undo:[],redo:[]});Je(this,"currentRange",null);this.quill.on(wt.events.EDITOR_CHANGE,(r,a,o,s)=>{r===wt.events.SELECTION_CHANGE?a&&s!==wt.sources.SILENT&&(this.currentRange=a):r===wt.events.TEXT_CHANGE&&(this.ignoreChange||(!this.options.userOnly||s===wt.sources.USER?this.record(a,o):this.transform(a)),this.currentRange=cH(this.currentRange,a))}),this.quill.keyboard.addBinding({key:"z",shortKey:!0},this.undo.bind(this)),this.quill.keyboard.addBinding({key:["z","Z"],shortKey:!0,shiftKey:!0},this.redo.bind(this)),/Win/i.test(navigator.platform)&&this.quill.keyboard.addBinding({key:"y",shortKey:!0},this.redo.bind(this)),this.quill.root.addEventListener("beforeinput",r=>{r.inputType==="historyUndo"?(this.undo(),r.preventDefault()):r.inputType==="historyRedo"&&(this.redo(),r.preventDefault())})}change(i,n){if(this.stack[i].length===0)return;const r=this.stack[i].pop();if(!r)return;const a=this.quill.getContents(),o=r.delta.invert(a);this.stack[n].push({delta:o,range:cH(r.range,o)}),this.lastRecorded=0,this.ignoreChange=!0,this.quill.updateContents(r.delta,wt.sources.USER),this.ignoreChange=!1,this.restoreSelection(r)}clear(){this.stack={undo:[],redo:[]}}cutoff(){this.lastRecorded=0}record(i,n){if(i.ops.length===0)return;this.stack.redo=[];let r=i.invert(n),a=this.currentRange;const o=Date.now();if(this.lastRecorded+this.options.delay>o&&this.stack.undo.length>0){const s=this.stack.undo.pop();s&&(r=r.compose(s.delta),a=s.range)}else this.lastRecorded=o;r.length()!==0&&(this.stack.undo.push({delta:r,range:a}),this.stack.undo.length>this.options.maxStack&&this.stack.undo.shift())}redo(){this.change("redo","undo")}transform(i){Lte(this.stack.undo,i),Lte(this.stack.redo,i)}undo(){this.change("undo","redo")}restoreSelection(i){if(i.range)this.quill.setSelection(i.range,wt.sources.USER);else{const n=Hmt(this.quill.scroll,i.delta);this.quill.setSelection(n,wt.sources.USER)}}}Je(YEe,"DEFAULTS",{delay:1e3,maxStack:100,userOnly:!1});function Lte(t,e){let i=e;for(let n=t.length-1;n>=0;n-=1){const r=t[n];t[n]={delta:i.transform(r.delta,!0),range:r.range&&cH(r.range,i)},i=r.delta.transform(i),t[n].delta.length()===0&&t.splice(n,1)}}function Gmt(t,e){const i=e.ops[e.ops.length-1];return i==null?!1:i.insert!=null?typeof i.insert=="string"&&i.insert.endsWith(`
`):i.attributes!=null?Object.keys(i.attributes).some(n=>t.query(n,Si.BLOCK)!=null):!1}function Hmt(t,e){const i=e.reduce((r,a)=>r+(a.delete||0),0);let n=e.length()-i;return Gmt(t,e)&&(n-=1),n}function cH(t,e){if(!t)return t;const i=e.transformPosition(t.index),n=e.transformPosition(t.index+t.length);return{index:i,length:n-i}}class ZEe extends jh{constructor(e,i){super(e,i),e.root.addEventListener("drop",n=>{var o;n.preventDefault();let r=null;if(document.caretRangeFromPoint)r=document.caretRangeFromPoint(n.clientX,n.clientY);else if(document.caretPositionFromPoint){const s=document.caretPositionFromPoint(n.clientX,n.clientY);r=document.createRange(),r.setStart(s.offsetNode,s.offset),r.setEnd(s.offsetNode,s.offset)}const a=r&&e.selection.normalizeNative(r);if(a){const s=e.selection.normalizedToRange(a);(o=n.dataTransfer)!=null&&o.files&&this.upload(s,n.dataTransfer.files)}})}upload(e,i){const n=[];Array.from(i).forEach(r=>{var a;r&&((a=this.options.mimetypes)!=null&&a.includes(r.type))&&n.push(r)}),n.length>0&&this.options.handler.call(this,e,n)}}ZEe.DEFAULTS={mimetypes:["image/png","image/jpeg"],handler(t,e){const i=e.map(n=>new Promise(r=>{const a=new FileReader;a.onload=o=>{r(o.target.result)},a.readAsDataURL(n)}));Promise.all(i).then(n=>{const r=n.reduce((a,o)=>a.insert({image:o}),new Ii().retain(t.index).delete(t.length));this.quill.updateContents(r,mi.sources.USER),this.quill.setSelection(t.index+n.length,mi.sources.SILENT)})}};const zmt=["insertText","insertReplacementText"];class qmt extends jh{constructor(e,i){super(e,i),e.root.addEventListener("beforeinput",n=>{this.handleBeforeInput(n)}),/Android/i.test(navigator.userAgent)||e.on(wt.events.COMPOSITION_BEFORE_START,()=>{this.handleCompositionStart()})}deleteRange(e){fK({range:e,quill:this.quill})}replaceText(e){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";if(e.length===0)return!1;if(i){const n=this.quill.getFormat(e.index,1);this.deleteRange(e),this.quill.updateContents(new Ii().retain(e.index).insert(i,n),wt.sources.USER)}else this.deleteRange(e);return this.quill.setSelection(e.index+i.length,0,wt.sources.SILENT),!0}handleBeforeInput(e){if(this.quill.composition.isComposing||e.defaultPrevented||!zmt.includes(e.inputType))return;const i=e.getTargetRanges?e.getTargetRanges()[0]:null;if(!i||i.collapsed===!0)return;const n=Wmt(e);if(n==null)return;const r=this.quill.selection.normalizeNative(i),a=r?this.quill.selection.normalizedToRange(r):null;a&&this.replaceText(a,n)&&e.preventDefault()}handleCompositionStart(){const e=this.quill.getSelection();e&&this.replaceText(e)}}function Wmt(t){var e;return typeof t.data=="string"?t.data:(e=t.dataTransfer)!=null&&e.types.includes("text/plain")?t.dataTransfer.getData("text/plain"):null}const Kmt=/Mac/i.test(navigator.platform),Ymt=100,Zmt=t=>!!(t.key==="ArrowLeft"||t.key==="ArrowRight"||t.key==="ArrowUp"||t.key==="ArrowDown"||t.key==="Home"||Kmt&&t.key==="a"&&t.ctrlKey===!0);class Xmt extends jh{constructor(i,n){super(i,n);Je(this,"isListening",!1);Je(this,"selectionChangeDeadline",0);this.handleArrowKeys(),this.handleNavigationShortcuts()}handleArrowKeys(){this.quill.keyboard.addBinding({key:["ArrowLeft","ArrowRight"],offset:0,shiftKey:null,handler(i,n){let{line:r,event:a}=n;if(!(r instanceof dh)||!r.uiNode)return!0;const o=getComputedStyle(r.domNode).direction==="rtl";return o&&a.key!=="ArrowRight"||!o&&a.key!=="ArrowLeft"?!0:(this.quill.setSelection(i.index-1,i.length+(a.shiftKey?1:0),wt.sources.USER),!1)}})}handleNavigationShortcuts(){this.quill.root.addEventListener("keydown",i=>{!i.defaultPrevented&&Zmt(i)&&this.ensureListeningToSelectionChange()})}ensureListeningToSelectionChange(){if(this.selectionChangeDeadline=Date.now()+Ymt,this.isListening)return;this.isListening=!0;const i=()=>{this.isListening=!1,Date.now()<=this.selectionChangeDeadline&&this.handleSelectionChange()};document.addEventListener("selectionchange",i,{once:!0})}handleSelectionChange(){const i=document.getSelection();if(!i)return;const n=i.getRangeAt(0);if(n.collapsed!==!0||n.startOffset!==0)return;const r=this.quill.scroll.find(n.startContainer);if(!(r instanceof dh)||!r.uiNode)return;const a=document.createRange();a.setStartAfter(r.uiNode),a.setEndAfter(r.uiNode),i.removeAllRanges(),i.addRange(a)}}wt.register({"blots/block":Cl,"blots/block/embed":Kd,"blots/break":Vh,"blots/container":Aw,"blots/cursor":cT,"blots/embed":lK,"blots/inline":Yf,"blots/scroll":E0,"blots/text":Ah,"modules/clipboard":WEe,"modules/history":YEe,"modules/keyboard":yB,"modules/uploader":ZEe,"modules/input":qmt,"modules/uiNode":Xmt});class Jmt extends $h{add(e,i){let n=0;if(i==="+1"||i==="-1"){const r=this.value(e)||0;n=i==="+1"?r+1:r-1}else typeof i=="number"&&(n=i);return n===0?(this.remove(e),!0):super.add(e,n.toString())}canAdd(e,i){return super.canAdd(e,i)||super.canAdd(e,parseInt(i,10))}value(e){return parseInt(super.value(e),10)||void 0}}const Qmt=new Jmt("indent","ql-indent",{scope:Si.BLOCK,whitelist:[1,2,3,4,5,6,7,8]});class uH extends Cl{}Je(uH,"blotName","blockquote"),Je(uH,"tagName","blockquote");var pN;let egt=(pN=class extends Cl{static formats(e){return this.tagName.indexOf(e.tagName)+1}},Je(pN,"blotName","header"),Je(pN,"tagName",["H1","H2","H3","H4","H5","H6"]),pN);class sM extends Aw{}sM.blotName="list-container";sM.tagName="OL";class lM extends Cl{static create(e){const i=super.create();return i.setAttribute("data-list",e),i}static formats(e){return e.getAttribute("data-list")||void 0}static register(){wt.register(sM)}constructor(e,i){super(e,i);const n=i.ownerDocument.createElement("span"),r=a=>{if(!e.isEnabled())return;const o=this.statics.formats(i,e);o==="checked"?(this.format("list","unchecked"),a.preventDefault()):o==="unchecked"&&(this.format("list","checked"),a.preventDefault())};n.addEventListener("mousedown",r),n.addEventListener("touchstart",r),this.attachUI(n)}format(e,i){e===this.statics.blotName&&i?this.domNode.setAttribute("data-list",i):super.format(e,i)}}lM.blotName="list";lM.tagName="LI";sM.allowedChildren=[lM];lM.requiredContainer=sM;class ZE extends Yf{static create(){return super.create()}static formats(){return!0}optimize(e){super.optimize(e),this.domNode.tagName!==this.statics.tagName[0]&&this.replaceWith(this.statics.blotName)}}Je(ZE,"blotName","bold"),Je(ZE,"tagName",["STRONG","B"]);class dH extends ZE{}Je(dH,"blotName","italic"),Je(dH,"tagName",["EM","I"]);class Dv extends Yf{static create(e){const i=super.create(e);return i.setAttribute("href",this.sanitize(e)),i.setAttribute("rel","noopener noreferrer"),i.setAttribute("target","_blank"),i}static formats(e){return e.getAttribute("href")}static sanitize(e){return XEe(e,this.PROTOCOL_WHITELIST)?e:this.SANITIZED_URL}format(e,i){e!==this.statics.blotName||!i?super.format(e,i):this.domNode.setAttribute("href",this.constructor.sanitize(i))}}Je(Dv,"blotName","link"),Je(Dv,"tagName","A"),Je(Dv,"SANITIZED_URL","about:blank"),Je(Dv,"PROTOCOL_WHITELIST",["http","https","mailto","tel","sms"]);function XEe(t,e){const i=document.createElement("a");i.href=t;const n=i.href.slice(0,i.href.indexOf(":"));return e.indexOf(n)>-1}class pH extends Yf{static create(e){return e==="super"?document.createElement("sup"):e==="sub"?document.createElement("sub"):super.create(e)}static formats(e){if(e.tagName==="SUB")return"sub";if(e.tagName==="SUP")return"super"}}Je(pH,"blotName","script"),Je(pH,"tagName",["SUB","SUP"]);class hH extends ZE{}Je(hH,"blotName","strike"),Je(hH,"tagName",["S","STRIKE"]);class fH extends Yf{}Je(fH,"blotName","underline"),Je(fH,"tagName","U");class lA extends lK{static create(e){if(window.katex==null)throw new Error("Formula module requires KaTeX.");const i=super.create(e);return typeof e=="string"&&(window.katex.render(e,i,{throwOnError:!1,errorColor:"#f00"}),i.setAttribute("data-value",e)),i}static value(e){return e.getAttribute("data-value")}html(){const{formula:e}=this.value();return`<span>${e}</span>`}}Je(lA,"blotName","formula"),Je(lA,"className","ql-formula"),Je(lA,"tagName","SPAN");const Fte=["alt","height","width"];var hN;let tgt=(hN=class extends Nd{static create(e){const i=super.create(e);return typeof e=="string"&&i.setAttribute("src",this.sanitize(e)),i}static formats(e){return Fte.reduce((i,n)=>(e.hasAttribute(n)&&(i[n]=e.getAttribute(n)),i),{})}static match(e){return/\.(jpe?g|gif|png)$/.test(e)||/^data:image\/.+;base64/.test(e)}static sanitize(e){return XEe(e,["http","https","data"])?e:"//:0"}static value(e){return e.getAttribute("src")}format(e,i){Fte.indexOf(e)>-1?i?this.domNode.setAttribute(e,i):this.domNode.removeAttribute(e):super.format(e,i)}},Je(hN,"blotName","image"),Je(hN,"tagName","IMG"),hN);const Bte=["height","width"];class cA extends Kd{static create(e){const i=super.create(e);return i.setAttribute("frameborder","0"),i.setAttribute("allowfullscreen","true"),i.setAttribute("src",this.sanitize(e)),i}static formats(e){return Bte.reduce((i,n)=>(e.hasAttribute(n)&&(i[n]=e.getAttribute(n)),i),{})}static sanitize(e){return Dv.sanitize(e)}static value(e){return e.getAttribute("src")}format(e,i){Bte.indexOf(e)>-1?i?this.domNode.setAttribute(e,i):this.domNode.removeAttribute(e):super.format(e,i)}html(){const{video:e}=this.value();return`<a href="${e}">${e}</a>`}}Je(cA,"blotName","video"),Je(cA,"className","ql-video"),Je(cA,"tagName","IFRAME");const R1=new $h("code-token","hljs",{scope:Si.INLINE});class yg extends Yf{static formats(e,i){for(;e!=null&&e!==i.domNode;){if(e.classList&&e.classList.contains(Yl.className))return super.formats(e,i);e=e.parentNode}}constructor(e,i,n){super(e,i,n),R1.add(this.domNode,n)}format(e,i){e!==yg.blotName?super.format(e,i):i?R1.add(this.domNode,i):(R1.remove(this.domNode),this.domNode.classList.remove(this.statics.className))}optimize(){super.optimize(...arguments),R1.value(this.domNode)||this.unwrap()}}yg.blotName="code-token";yg.className="ql-token";class Wd extends Yl{static create(e){const i=super.create(e);return typeof e=="string"&&i.setAttribute("data-language",e),i}static formats(e){return e.getAttribute("data-language")||"plain"}static register(){}format(e,i){e===this.statics.blotName&&i?this.domNode.setAttribute("data-language",i):super.format(e,i)}replaceWith(e,i){return this.formatAt(0,this.length(),yg.blotName,!1),super.replaceWith(e,i)}}class sD extends _w{attach(){super.attach(),this.forceNext=!1,this.scroll.emitMount(this)}format(e,i){e===Wd.blotName&&(this.forceNext=!0,this.children.forEach(n=>{n.format(e,i)}))}formatAt(e,i,n,r){n===Wd.blotName&&(this.forceNext=!0),super.formatAt(e,i,n,r)}highlight(e){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(this.children.head==null)return;const r=`${Array.from(this.domNode.childNodes).filter(o=>o!==this.uiNode).map(o=>o.textContent).join(`
`)}
`,a=Wd.formats(this.children.head.domNode);if(i||this.forceNext||this.cachedText!==r){if(r.trim().length>0||this.cachedText==null){const o=this.children.reduce((l,c)=>l.concat(_Ee(c,!1)),new Ii),s=e(r,a);o.diff(s).reduce((l,c)=>{let{retain:u,attributes:d}=c;return u?(d&&Object.keys(d).forEach(p=>{[Wd.blotName,yg.blotName].includes(p)&&this.formatAt(l,u,p,d[p])}),l+u):l},0)}this.cachedText=r,this.forceNext=!1}}html(e,i){const[n]=this.children.find(e);return`<pre data-language="${n?Wd.formats(n.domNode):"plain"}">
${vB(this.code(e,i))}
</pre>`}optimize(e){if(super.optimize(e),this.parent!=null&&this.children.head!=null&&this.uiNode!=null){const i=Wd.formats(this.children.head.domNode);i!==this.uiNode.value&&(this.uiNode.value=i)}}}sD.allowedChildren=[Wd];Wd.requiredContainer=sD;Wd.allowedChildren=[yg,cT,Ah,Vh];const igt=(t,e,i)=>{if(typeof t.versionString=="string"){const n=t.versionString.split(".")[0];if(parseInt(n,10)>=11)return t.highlight(i,{language:e}).value}return t.highlight(e,i).value};class JEe extends jh{static register(){wt.register(yg,!0),wt.register(Wd,!0),wt.register(sD,!0)}constructor(e,i){if(super(e,i),this.options.hljs==null)throw new Error("Syntax module requires highlight.js. Please include the library on the page before Quill.");this.languages=this.options.languages.reduce((n,r)=>{let{key:a}=r;return n[a]=!0,n},{}),this.highlightBlot=this.highlightBlot.bind(this),this.initListener(),this.initTimer()}initListener(){this.quill.on(wt.events.SCROLL_BLOT_MOUNT,e=>{if(!(e instanceof sD))return;const i=this.quill.root.ownerDocument.createElement("select");this.options.languages.forEach(n=>{let{key:r,label:a}=n;const o=i.ownerDocument.createElement("option");o.textContent=a,o.setAttribute("value",r),i.appendChild(o)}),i.addEventListener("change",()=>{e.format(Wd.blotName,i.value),this.quill.root.focus(),this.highlight(e,!0)}),e.uiNode==null&&(e.attachUI(i),e.children.head&&(i.value=Wd.formats(e.children.head.domNode)))})}initTimer(){let e=null;this.quill.on(wt.events.SCROLL_OPTIMIZE,()=>{e&&clearTimeout(e),e=setTimeout(()=>{this.highlight(),e=null},this.options.interval)})}highlight(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(this.quill.selection.composing)return;this.quill.update(wt.sources.USER);const n=this.quill.getSelection();(e==null?this.quill.scroll.descendants(sD):[e]).forEach(a=>{a.highlight(this.highlightBlot,i)}),this.quill.update(wt.sources.SILENT),n!=null&&this.quill.setSelection(n,wt.sources.SILENT)}highlightBlot(e){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"plain";if(i=this.languages[i]?i:"plain",i==="plain")return vB(e).split(`
`).reduce((r,a,o)=>(o!==0&&r.insert(`
`,{[Yl.blotName]:i}),r.insert(a)),new Ii);const n=this.quill.root.ownerDocument.createElement("div");return n.classList.add(Yl.className),n.innerHTML=igt(this.options.hljs,i,e),mK(this.quill.scroll,n,[(r,a)=>{const o=R1.value(r);return o?a.compose(new Ii().retain(a.length(),{[yg.blotName]:o})):a}],[(r,a)=>r.data.split(`
`).reduce((o,s,l)=>(l!==0&&o.insert(`
`,{[Yl.blotName]:i}),o.insert(s)),a)],new WeakMap)}}JEe.DEFAULTS={hljs:window.hljs,interval:1e3,languages:[{key:"plain",label:"Plain"},{key:"bash",label:"Bash"},{key:"cpp",label:"C++"},{key:"cs",label:"C#"},{key:"css",label:"CSS"},{key:"diff",label:"Diff"},{key:"xml",label:"HTML/XML"},{key:"java",label:"Java"},{key:"javascript",label:"JavaScript"},{key:"markdown",label:"Markdown"},{key:"php",label:"PHP"},{key:"python",label:"Python"},{key:"ruby",label:"Ruby"},{key:"sql",label:"SQL"}]};const yD=class yD extends Cl{static create(e){const i=super.create();return e?i.setAttribute("data-row",e):i.setAttribute("data-row",gK()),i}static formats(e){if(e.hasAttribute("data-row"))return e.getAttribute("data-row")}cellOffset(){return this.parent?this.parent.children.indexOf(this):-1}format(e,i){e===yD.blotName&&i?this.domNode.setAttribute("data-row",i):super.format(e,i)}row(){return this.parent}rowOffset(){return this.row()?this.row().rowOffset():-1}table(){return this.row()&&this.row().table()}};Je(yD,"blotName","table"),Je(yD,"tagName","TD");let Wp=yD;class bg extends Aw{checkMerge(){if(super.checkMerge()&&this.next.children.head!=null){const e=this.children.head.formats(),i=this.children.tail.formats(),n=this.next.children.head.formats(),r=this.next.children.tail.formats();return e.table===i.table&&e.table===n.table&&e.table===r.table}return!1}optimize(e){super.optimize(e),this.children.forEach(i=>{if(i.next==null)return;const n=i.formats(),r=i.next.formats();if(n.table!==r.table){const a=this.splitAfter(i);a&&a.optimize(),this.prev&&this.prev.optimize()}})}rowOffset(){return this.parent?this.parent.children.indexOf(this):-1}table(){return this.parent&&this.parent.parent}}Je(bg,"blotName","table-row"),Je(bg,"tagName","TR");class Tf extends Aw{}Je(Tf,"blotName","table-body"),Je(Tf,"tagName","TBODY");class dT extends Aw{balanceCells(){const e=this.descendants(bg),i=e.reduce((n,r)=>Math.max(r.children.length,n),0);e.forEach(n=>{new Array(i-n.children.length).fill(0).forEach(()=>{let r;n.children.head!=null&&(r=Wp.formats(n.children.head.domNode));const a=this.scroll.create(Wp.blotName,r);n.appendChild(a),a.optimize()})})}cells(e){return this.rows().map(i=>i.children.at(e))}deleteColumn(e){const[i]=this.descendant(Tf);i==null||i.children.head==null||i.children.forEach(n=>{const r=n.children.at(e);r!=null&&r.remove()})}insertColumn(e){const[i]=this.descendant(Tf);i==null||i.children.head==null||i.children.forEach(n=>{const r=n.children.at(e),a=Wp.formats(n.children.head.domNode),o=this.scroll.create(Wp.blotName,a);n.insertBefore(o,r)})}insertRow(e){const[i]=this.descendant(Tf);if(i==null||i.children.head==null)return;const n=gK(),r=this.scroll.create(bg.blotName);i.children.head.children.forEach(()=>{const o=this.scroll.create(Wp.blotName,n);r.appendChild(o)});const a=i.children.at(e);i.insertBefore(r,a)}rows(){const e=this.children.head;return e==null?[]:e.children.map(i=>i)}}Je(dT,"blotName","table-container"),Je(dT,"tagName","TABLE");dT.allowedChildren=[Tf];Tf.requiredContainer=dT;Tf.allowedChildren=[bg];bg.requiredContainer=Tf;bg.allowedChildren=[Wp];Wp.requiredContainer=bg;function gK(){return`row-${Math.random().toString(36).slice(2,6)}`}class ngt extends jh{static register(){wt.register(Wp),wt.register(bg),wt.register(Tf),wt.register(dT)}constructor(){super(...arguments),this.listenBalanceCells()}balanceTables(){this.quill.scroll.descendants(dT).forEach(e=>{e.balanceCells()})}deleteColumn(){const[e,,i]=this.getTable();i!=null&&(e.deleteColumn(i.cellOffset()),this.quill.update(wt.sources.USER))}deleteRow(){const[,e]=this.getTable();e!=null&&(e.remove(),this.quill.update(wt.sources.USER))}deleteTable(){const[e]=this.getTable();if(e==null)return;const i=e.offset();e.remove(),this.quill.update(wt.sources.USER),this.quill.setSelection(i,wt.sources.SILENT)}getTable(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.quill.getSelection();if(e==null)return[null,null,null,-1];const[i,n]=this.quill.getLine(e.index);if(i==null||i.statics.blotName!==Wp.blotName)return[null,null,null,-1];const r=i.parent;return[r.parent.parent,r,i,n]}insertColumn(e){const i=this.quill.getSelection();if(!i)return;const[n,r,a]=this.getTable(i);if(a==null)return;const o=a.cellOffset();n.insertColumn(o+e),this.quill.update(wt.sources.USER);let s=r.rowOffset();e===0&&(s+=1),this.quill.setSelection(i.index+s,i.length,wt.sources.SILENT)}insertColumnLeft(){this.insertColumn(0)}insertColumnRight(){this.insertColumn(1)}insertRow(e){const i=this.quill.getSelection();if(!i)return;const[n,r,a]=this.getTable(i);if(a==null)return;const o=r.rowOffset();n.insertRow(o+e),this.quill.update(wt.sources.USER),e>0?this.quill.setSelection(i,wt.sources.SILENT):this.quill.setSelection(i.index+r.children.length,i.length,wt.sources.SILENT)}insertRowAbove(){this.insertRow(0)}insertRowBelow(){this.insertRow(1)}insertTable(e,i){const n=this.quill.getSelection();if(n==null)return;const r=new Array(e).fill(0).reduce(a=>{const o=new Array(i).fill(`
`).join("");return a.insert(o,{table:gK()})},new Ii().retain(n.index));this.quill.updateContents(r,wt.sources.USER),this.quill.setSelection(n.index,wt.sources.SILENT),this.balanceTables()}listenBalanceCells(){this.quill.on(wt.events.SCROLL_OPTIMIZE,e=>{e.some(i=>["TD","TR","TBODY","TABLE"].includes(i.target.tagName)?(this.quill.once(wt.events.TEXT_CHANGE,(n,r,a)=>{a===wt.sources.USER&&this.balanceTables()}),!0):!1)})}}const $te=Wg("quill:toolbar");let vK=class extends jh{constructor(e,i){var n,r;if(super(e,i),Array.isArray(this.options.container)){const a=document.createElement("div");a.setAttribute("role","toolbar"),rgt(a,this.options.container),(r=(n=e.container)==null?void 0:n.parentNode)==null||r.insertBefore(a,e.container),this.container=a}else typeof this.options.container=="string"?this.container=document.querySelector(this.options.container):this.container=this.options.container;if(!(this.container instanceof HTMLElement)){$te.error("Container required for toolbar",this.options);return}this.container.classList.add("ql-toolbar"),this.controls=[],this.handlers={},this.options.handlers&&Object.keys(this.options.handlers).forEach(a=>{var s;const o=(s=this.options.handlers)==null?void 0:s[a];o&&this.addHandler(a,o)}),Array.from(this.container.querySelectorAll("button, select")).forEach(a=>{this.attach(a)}),this.quill.on(wt.events.EDITOR_CHANGE,()=>{const[a]=this.quill.selection.getRange();this.update(a)})}addHandler(e,i){this.handlers[e]=i}attach(e){let i=Array.from(e.classList).find(r=>r.indexOf("ql-")===0);if(!i)return;if(i=i.slice(3),e.tagName==="BUTTON"&&e.setAttribute("type","button"),this.handlers[i]==null&&this.quill.scroll.query(i)==null){$te.warn("ignoring attaching to nonexistent format",i,e);return}const n=e.tagName==="SELECT"?"change":"click";e.addEventListener(n,r=>{let a;if(e.tagName==="SELECT"){if(e.selectedIndex<0)return;const s=e.options[e.selectedIndex];s.hasAttribute("selected")?a=!1:a=s.value||!1}else e.classList.contains("ql-active")?a=!1:a=e.value||!e.hasAttribute("value"),r.preventDefault();this.quill.focus();const[o]=this.quill.selection.getRange();if(this.handlers[i]!=null)this.handlers[i].call(this,a);else if(this.quill.scroll.query(i).prototype instanceof Nd){if(a=prompt(`Enter ${i}`),!a)return;this.quill.updateContents(new Ii().retain(o.index).delete(o.length).insert({[i]:a}),wt.sources.USER)}else this.quill.format(i,a,wt.sources.USER);this.update(o)}),this.controls.push([i,e])}update(e){const i=e==null?{}:this.quill.getFormat(e);this.controls.forEach(n=>{const[r,a]=n;if(a.tagName==="SELECT"){let o=null;if(e==null)o=null;else if(i[r]==null)o=a.querySelector("option[selected]");else if(!Array.isArray(i[r])){let s=i[r];typeof s=="string"&&(s=s.replace(/"/g,'\\"')),o=a.querySelector(`option[value="${s}"]`)}o==null?(a.value="",a.selectedIndex=-1):o.selected=!0}else if(e==null)a.classList.remove("ql-active"),a.setAttribute("aria-pressed","false");else if(a.hasAttribute("value")){const o=i[r],s=o===a.getAttribute("value")||o!=null&&o.toString()===a.getAttribute("value")||o==null&&!a.getAttribute("value");a.classList.toggle("ql-active",s),a.setAttribute("aria-pressed",s.toString())}else{const o=i[r]!=null;a.classList.toggle("ql-active",o),a.setAttribute("aria-pressed",o.toString())}})}};vK.DEFAULTS={};function Vte(t,e,i){const n=document.createElement("button");n.setAttribute("type","button"),n.classList.add(`ql-${e}`),n.setAttribute("aria-pressed","false"),i!=null?(n.value=i,n.setAttribute("aria-label",`${e}: ${i}`)):n.setAttribute("aria-label",e),t.appendChild(n)}function rgt(t,e){Array.isArray(e[0])||(e=[e]),e.forEach(i=>{const n=document.createElement("span");n.classList.add("ql-formats"),i.forEach(r=>{if(typeof r=="string")Vte(n,r);else{const a=Object.keys(r)[0],o=r[a];Array.isArray(o)?agt(n,a,o):Vte(n,a,o)}}),t.appendChild(n)})}function agt(t,e,i){const n=document.createElement("select");n.classList.add(`ql-${e}`),i.forEach(r=>{const a=document.createElement("option");r!==!1?a.setAttribute("value",String(r)):a.setAttribute("selected","selected"),n.appendChild(a)}),t.appendChild(n)}vK.DEFAULTS={container:null,handlers:{clean(){const t=this.quill.getSelection();if(t!=null)if(t.length===0){const e=this.quill.getFormat();Object.keys(e).forEach(i=>{this.quill.scroll.query(i,Si.INLINE)!=null&&this.quill.format(i,!1,wt.sources.USER)})}else this.quill.removeFormat(t,wt.sources.USER)},direction(t){const{align:e}=this.quill.getFormat();t==="rtl"&&e==null?this.quill.format("align","right",wt.sources.USER):!t&&e==="right"&&this.quill.format("align",!1,wt.sources.USER),this.quill.format("direction",t,wt.sources.USER)},indent(t){const e=this.quill.getSelection(),i=this.quill.getFormat(e),n=parseInt(i.indent||0,10);if(t==="+1"||t==="-1"){let r=t==="+1"?1:-1;i.direction==="rtl"&&(r*=-1),this.quill.format("indent",n+r,wt.sources.USER)}},link(t){t===!0&&(t=prompt("Enter link URL:")),this.quill.format("link",t,wt.sources.USER)},list(t){const e=this.quill.getSelection(),i=this.quill.getFormat(e);t==="check"?i.list==="checked"||i.list==="unchecked"?this.quill.format("list",!1,wt.sources.USER):this.quill.format("list","unchecked",wt.sources.USER):this.quill.format("list",t,wt.sources.USER)}}};const ogt='<svg viewbox="0 0 18 18"><line class="ql-stroke" x1="3" x2="15" y1="9" y2="9"/><line class="ql-stroke" x1="3" x2="13" y1="14" y2="14"/><line class="ql-stroke" x1="3" x2="9" y1="4" y2="4"/></svg>',sgt='<svg viewbox="0 0 18 18"><line class="ql-stroke" x1="15" x2="3" y1="9" y2="9"/><line class="ql-stroke" x1="14" x2="4" y1="14" y2="14"/><line class="ql-stroke" x1="12" x2="6" y1="4" y2="4"/></svg>',lgt='<svg viewbox="0 0 18 18"><line class="ql-stroke" x1="15" x2="3" y1="9" y2="9"/><line class="ql-stroke" x1="15" x2="5" y1="14" y2="14"/><line class="ql-stroke" x1="15" x2="9" y1="4" y2="4"/></svg>',cgt='<svg viewbox="0 0 18 18"><line class="ql-stroke" x1="15" x2="3" y1="9" y2="9"/><line class="ql-stroke" x1="15" x2="3" y1="14" y2="14"/><line class="ql-stroke" x1="15" x2="3" y1="4" y2="4"/></svg>',ugt='<svg viewbox="0 0 18 18"><g class="ql-fill ql-color-label"><polygon points="6 6.868 6 6 5 6 5 7 5.942 7 6 6.868"/><rect height="1" width="1" x="4" y="4"/><polygon points="6.817 5 6 5 6 6 6.38 6 6.817 5"/><rect height="1" width="1" x="2" y="6"/><rect height="1" width="1" x="3" y="5"/><rect height="1" width="1" x="4" y="7"/><polygon points="4 11.439 4 11 3 11 3 12 3.755 12 4 11.439"/><rect height="1" width="1" x="2" y="12"/><rect height="1" width="1" x="2" y="9"/><rect height="1" width="1" x="2" y="15"/><polygon points="4.63 10 4 10 4 11 4.192 11 4.63 10"/><rect height="1" width="1" x="3" y="8"/><path d="M10.832,4.2L11,4.582V4H10.708A1.948,1.948,0,0,1,10.832,4.2Z"/><path d="M7,4.582L7.168,4.2A1.929,1.929,0,0,1,7.292,4H7V4.582Z"/><path d="M8,13H7.683l-0.351.8a1.933,1.933,0,0,1-.124.2H8V13Z"/><rect height="1" width="1" x="12" y="2"/><rect height="1" width="1" x="11" y="3"/><path d="M9,3H8V3.282A1.985,1.985,0,0,1,9,3Z"/><rect height="1" width="1" x="2" y="3"/><rect height="1" width="1" x="6" y="2"/><rect height="1" width="1" x="3" y="2"/><rect height="1" width="1" x="5" y="3"/><rect height="1" width="1" x="9" y="2"/><rect height="1" width="1" x="15" y="14"/><polygon points="13.447 10.174 13.469 10.225 13.472 10.232 13.808 11 14 11 14 10 13.37 10 13.447 10.174"/><rect height="1" width="1" x="13" y="7"/><rect height="1" width="1" x="15" y="5"/><rect height="1" width="1" x="14" y="6"/><rect height="1" width="1" x="15" y="8"/><rect height="1" width="1" x="14" y="9"/><path d="M3.775,14H3v1H4V14.314A1.97,1.97,0,0,1,3.775,14Z"/><rect height="1" width="1" x="14" y="3"/><polygon points="12 6.868 12 6 11.62 6 12 6.868"/><rect height="1" width="1" x="15" y="2"/><rect height="1" width="1" x="12" y="5"/><rect height="1" width="1" x="13" y="4"/><polygon points="12.933 9 13 9 13 8 12.495 8 12.933 9"/><rect height="1" width="1" x="9" y="14"/><rect height="1" width="1" x="8" y="15"/><path d="M6,14.926V15H7V14.316A1.993,1.993,0,0,1,6,14.926Z"/><rect height="1" width="1" x="5" y="15"/><path d="M10.668,13.8L10.317,13H10v1h0.792A1.947,1.947,0,0,1,10.668,13.8Z"/><rect height="1" width="1" x="11" y="15"/><path d="M14.332,12.2a1.99,1.99,0,0,1,.166.8H15V12H14.245Z"/><rect height="1" width="1" x="14" y="15"/><rect height="1" width="1" x="15" y="11"/></g><polyline class="ql-stroke" points="5.5 13 9 5 12.5 13"/><line class="ql-stroke" x1="11.63" x2="6.38" y1="11" y2="11"/></svg>',dgt='<svg viewbox="0 0 18 18"><rect class="ql-fill ql-stroke" height="3" width="3" x="4" y="5"/><rect class="ql-fill ql-stroke" height="3" width="3" x="11" y="5"/><path class="ql-even ql-fill ql-stroke" d="M7,8c0,4.031-3,5-3,5"/><path class="ql-even ql-fill ql-stroke" d="M14,8c0,4.031-3,5-3,5"/></svg>',pgt='<svg viewbox="0 0 18 18"><path class="ql-stroke" d="M5,4H9.5A2.5,2.5,0,0,1,12,6.5v0A2.5,2.5,0,0,1,9.5,9H5A0,0,0,0,1,5,9V4A0,0,0,0,1,5,4Z"/><path class="ql-stroke" d="M5,9h5.5A2.5,2.5,0,0,1,13,11.5v0A2.5,2.5,0,0,1,10.5,14H5a0,0,0,0,1,0,0V9A0,0,0,0,1,5,9Z"/></svg>',hgt='<svg class="" viewbox="0 0 18 18"><line class="ql-stroke" x1="5" x2="13" y1="3" y2="3"/><line class="ql-stroke" x1="6" x2="9.35" y1="12" y2="3"/><line class="ql-stroke" x1="11" x2="15" y1="11" y2="15"/><line class="ql-stroke" x1="15" x2="11" y1="11" y2="15"/><rect class="ql-fill" height="1" rx="0.5" ry="0.5" width="7" x="2" y="14"/></svg>',jte='<svg viewbox="0 0 18 18"><polyline class="ql-even ql-stroke" points="5 7 3 9 5 11"/><polyline class="ql-even ql-stroke" points="13 7 15 9 13 11"/><line class="ql-stroke" x1="10" x2="8" y1="5" y2="13"/></svg>',fgt='<svg viewbox="0 0 18 18"><line class="ql-color-label ql-stroke ql-transparent" x1="3" x2="15" y1="15" y2="15"/><polyline class="ql-stroke" points="5.5 11 9 3 12.5 11"/><line class="ql-stroke" x1="11.63" x2="6.38" y1="9" y2="9"/></svg>',mgt='<svg viewbox="0 0 18 18"><polygon class="ql-stroke ql-fill" points="3 11 5 9 3 7 3 11"/><line class="ql-stroke ql-fill" x1="15" x2="11" y1="4" y2="4"/><path class="ql-fill" d="M11,3a3,3,0,0,0,0,6h1V3H11Z"/><rect class="ql-fill" height="11" width="1" x="11" y="4"/><rect class="ql-fill" height="11" width="1" x="13" y="4"/></svg>',ggt='<svg viewbox="0 0 18 18"><polygon class="ql-stroke ql-fill" points="15 12 13 10 15 8 15 12"/><line class="ql-stroke ql-fill" x1="9" x2="5" y1="4" y2="4"/><path class="ql-fill" d="M5,3A3,3,0,0,0,5,9H6V3H5Z"/><rect class="ql-fill" height="11" width="1" x="5" y="4"/><rect class="ql-fill" height="11" width="1" x="7" y="4"/></svg>',vgt='<svg viewbox="0 0 18 18"><path class="ql-fill" d="M11.759,2.482a2.561,2.561,0,0,0-3.53.607A7.656,7.656,0,0,0,6.8,6.2C6.109,9.188,5.275,14.677,4.15,14.927a1.545,1.545,0,0,0-1.3-.933A0.922,0.922,0,0,0,2,15.036S1.954,16,4.119,16s3.091-2.691,3.7-5.553c0.177-.826.36-1.726,0.554-2.6L8.775,6.2c0.381-1.421.807-2.521,1.306-2.676a1.014,1.014,0,0,0,1.02.56A0.966,0.966,0,0,0,11.759,2.482Z"/><rect class="ql-fill" height="1.6" rx="0.8" ry="0.8" width="5" x="5.15" y="6.2"/><path class="ql-fill" d="M13.663,12.027a1.662,1.662,0,0,1,.266-0.276q0.193,0.069.456,0.138a2.1,2.1,0,0,0,.535.069,1.075,1.075,0,0,0,.767-0.3,1.044,1.044,0,0,0,.314-0.8,0.84,0.84,0,0,0-.238-0.619,0.8,0.8,0,0,0-.594-0.239,1.154,1.154,0,0,0-.781.3,4.607,4.607,0,0,0-.781,1q-0.091.15-.218,0.346l-0.246.38c-0.068-.288-0.137-0.582-0.212-0.885-0.459-1.847-2.494-.984-2.941-0.8-0.482.2-.353,0.647-0.094,0.529a0.869,0.869,0,0,1,1.281.585c0.217,0.751.377,1.436,0.527,2.038a5.688,5.688,0,0,1-.362.467,2.69,2.69,0,0,1-.264.271q-0.221-.08-0.471-0.147a2.029,2.029,0,0,0-.522-0.066,1.079,1.079,0,0,0-.768.3A1.058,1.058,0,0,0,9,15.131a0.82,0.82,0,0,0,.832.852,1.134,1.134,0,0,0,.787-0.3,5.11,5.11,0,0,0,.776-0.993q0.141-.219.215-0.34c0.046-.076.122-0.194,0.223-0.346a2.786,2.786,0,0,0,.918,1.726,2.582,2.582,0,0,0,2.376-.185c0.317-.181.212-0.565,0-0.494A0.807,0.807,0,0,1,14.176,15a5.159,5.159,0,0,1-.913-2.446l0,0Q13.487,12.24,13.663,12.027Z"/></svg>',ygt='<svg viewBox="0 0 18 18"><path class="ql-fill" d="M10,4V14a1,1,0,0,1-2,0V10H3v4a1,1,0,0,1-2,0V4A1,1,0,0,1,3,4V8H8V4a1,1,0,0,1,2,0Zm6.06787,9.209H14.98975V7.59863a.54085.54085,0,0,0-.605-.60547h-.62744a1.01119,1.01119,0,0,0-.748.29688L11.645,8.56641a.5435.5435,0,0,0-.022.8584l.28613.30762a.53861.53861,0,0,0,.84717.0332l.09912-.08789a1.2137,1.2137,0,0,0,.2417-.35254h.02246s-.01123.30859-.01123.60547V13.209H12.041a.54085.54085,0,0,0-.605.60547v.43945a.54085.54085,0,0,0,.605.60547h4.02686a.54085.54085,0,0,0,.605-.60547v-.43945A.54085.54085,0,0,0,16.06787,13.209Z"/></svg>',bgt='<svg viewBox="0 0 18 18"><path class="ql-fill" d="M16.73975,13.81445v.43945a.54085.54085,0,0,1-.605.60547H11.855a.58392.58392,0,0,1-.64893-.60547V14.0127c0-2.90527,3.39941-3.42187,3.39941-4.55469a.77675.77675,0,0,0-.84717-.78125,1.17684,1.17684,0,0,0-.83594.38477c-.2749.26367-.561.374-.85791.13184l-.4292-.34082c-.30811-.24219-.38525-.51758-.1543-.81445a2.97155,2.97155,0,0,1,2.45361-1.17676,2.45393,2.45393,0,0,1,2.68408,2.40918c0,2.45312-3.1792,2.92676-3.27832,3.93848h2.79443A.54085.54085,0,0,1,16.73975,13.81445ZM9,3A.99974.99974,0,0,0,8,4V8H3V4A1,1,0,0,0,1,4V14a1,1,0,0,0,2,0V10H8v4a1,1,0,0,0,2,0V4A.99974.99974,0,0,0,9,3Z"/></svg>',Igt='<svg viewbox="0 0 18 18"><line class="ql-stroke" x1="7" x2="13" y1="4" y2="4"/><line class="ql-stroke" x1="5" x2="11" y1="14" y2="14"/><line class="ql-stroke" x1="8" x2="10" y1="14" y2="4"/></svg>',wgt='<svg viewbox="0 0 18 18"><rect class="ql-stroke" height="10" width="12" x="3" y="4"/><circle class="ql-fill" cx="6" cy="7" r="1"/><polyline class="ql-even ql-fill" points="5 12 5 11 7 9 8 10 11 7 13 9 13 12 5 12"/></svg>',Sgt='<svg viewbox="0 0 18 18"><line class="ql-stroke" x1="3" x2="15" y1="14" y2="14"/><line class="ql-stroke" x1="3" x2="15" y1="4" y2="4"/><line class="ql-stroke" x1="9" x2="15" y1="9" y2="9"/><polyline class="ql-fill ql-stroke" points="3 7 3 11 5 9 3 7"/></svg>',Tgt='<svg viewbox="0 0 18 18"><line class="ql-stroke" x1="3" x2="15" y1="14" y2="14"/><line class="ql-stroke" x1="3" x2="15" y1="4" y2="4"/><line class="ql-stroke" x1="9" x2="15" y1="9" y2="9"/><polyline class="ql-stroke" points="5 7 5 11 3 9 5 7"/></svg>',Ugt='<svg viewbox="0 0 18 18"><line class="ql-stroke" x1="7" x2="11" y1="7" y2="11"/><path class="ql-even ql-stroke" d="M8.9,4.577a3.476,3.476,0,0,1,.36,4.679A3.476,3.476,0,0,1,4.577,8.9C3.185,7.5,2.035,6.4,4.217,4.217S7.5,3.185,8.9,4.577Z"/><path class="ql-even ql-stroke" d="M13.423,9.1a3.476,3.476,0,0,0-4.679-.36,3.476,3.476,0,0,0,.36,4.679c1.392,1.392,2.5,2.542,4.679.36S14.815,10.5,13.423,9.1Z"/></svg>',Dgt='<svg viewbox="0 0 18 18"><line class="ql-stroke" x1="6" x2="15" y1="4" y2="4"/><line class="ql-stroke" x1="6" x2="15" y1="9" y2="9"/><line class="ql-stroke" x1="6" x2="15" y1="14" y2="14"/><line class="ql-stroke" x1="3" x2="3" y1="4" y2="4"/><line class="ql-stroke" x1="3" x2="3" y1="9" y2="9"/><line class="ql-stroke" x1="3" x2="3" y1="14" y2="14"/></svg>',Egt='<svg class="" viewbox="0 0 18 18"><line class="ql-stroke" x1="9" x2="15" y1="4" y2="4"/><polyline class="ql-stroke" points="3 4 4 5 6 3"/><line class="ql-stroke" x1="9" x2="15" y1="14" y2="14"/><polyline class="ql-stroke" points="3 14 4 15 6 13"/><line class="ql-stroke" x1="9" x2="15" y1="9" y2="9"/><polyline class="ql-stroke" points="3 9 4 10 6 8"/></svg>',Cgt='<svg viewbox="0 0 18 18"><line class="ql-stroke" x1="7" x2="15" y1="4" y2="4"/><line class="ql-stroke" x1="7" x2="15" y1="9" y2="9"/><line class="ql-stroke" x1="7" x2="15" y1="14" y2="14"/><line class="ql-stroke ql-thin" x1="2.5" x2="4.5" y1="5.5" y2="5.5"/><path class="ql-fill" d="M3.5,6A0.5,0.5,0,0,1,3,5.5V3.085l-0.276.138A0.5,0.5,0,0,1,2.053,3c-0.124-.247-0.023-0.324.224-0.447l1-.5A0.5,0.5,0,0,1,4,2.5v3A0.5,0.5,0,0,1,3.5,6Z"/><path class="ql-stroke ql-thin" d="M4.5,10.5h-2c0-.234,1.85-1.076,1.85-2.234A0.959,0.959,0,0,0,2.5,8.156"/><path class="ql-stroke ql-thin" d="M2.5,14.846a0.959,0.959,0,0,0,1.85-.109A0.7,0.7,0,0,0,3.75,14a0.688,0.688,0,0,0,.6-0.736,0.959,0.959,0,0,0-1.85-.109"/></svg>',Pgt='<svg viewbox="0 0 18 18"><path class="ql-fill" d="M15.5,15H13.861a3.858,3.858,0,0,0,1.914-2.975,1.8,1.8,0,0,0-1.6-1.751A1.921,1.921,0,0,0,12.021,11.7a0.50013,0.50013,0,1,0,.957.291h0a0.914,0.914,0,0,1,1.053-.725,0.81,0.81,0,0,1,.744.762c0,1.076-1.16971,1.86982-1.93971,2.43082A1.45639,1.45639,0,0,0,12,15.5a0.5,0.5,0,0,0,.5.5h3A0.5,0.5,0,0,0,15.5,15Z"/><path class="ql-fill" d="M9.65,5.241a1,1,0,0,0-1.409.108L6,7.964,3.759,5.349A1,1,0,0,0,2.192,6.59178Q2.21541,6.6213,2.241,6.649L4.684,9.5,2.241,12.35A1,1,0,0,0,3.71,13.70722q0.02557-.02768.049-0.05722L6,11.036,8.241,13.65a1,1,0,1,0,1.567-1.24277Q9.78459,12.3777,9.759,12.35L7.316,9.5,9.759,6.651A1,1,0,0,0,9.65,5.241Z"/></svg>',Rgt='<svg viewbox="0 0 18 18"><path class="ql-fill" d="M15.5,7H13.861a4.015,4.015,0,0,0,1.914-2.975,1.8,1.8,0,0,0-1.6-1.751A1.922,1.922,0,0,0,12.021,3.7a0.5,0.5,0,1,0,.957.291,0.917,0.917,0,0,1,1.053-.725,0.81,0.81,0,0,1,.744.762c0,1.077-1.164,1.925-1.934,2.486A1.423,1.423,0,0,0,12,7.5a0.5,0.5,0,0,0,.5.5h3A0.5,0.5,0,0,0,15.5,7Z"/><path class="ql-fill" d="M9.651,5.241a1,1,0,0,0-1.41.108L6,7.964,3.759,5.349a1,1,0,1,0-1.519,1.3L4.683,9.5,2.241,12.35a1,1,0,1,0,1.519,1.3L6,11.036,8.241,13.65a1,1,0,0,0,1.519-1.3L7.317,9.5,9.759,6.651A1,1,0,0,0,9.651,5.241Z"/></svg>',Mgt='<svg viewbox="0 0 18 18"><line class="ql-stroke ql-thin" x1="15.5" x2="2.5" y1="8.5" y2="9.5"/><path class="ql-fill" d="M9.007,8C6.542,7.791,6,7.519,6,6.5,6,5.792,7.283,5,9,5c1.571,0,2.765.679,2.969,1.309a1,1,0,0,0,1.9-.617C13.356,4.106,11.354,3,9,3,6.2,3,4,4.538,4,6.5a3.2,3.2,0,0,0,.5,1.843Z"/><path class="ql-fill" d="M8.984,10C11.457,10.208,12,10.479,12,11.5c0,0.708-1.283,1.5-3,1.5-1.571,0-2.765-.679-2.969-1.309a1,1,0,1,0-1.9.617C4.644,13.894,6.646,15,9,15c2.8,0,5-1.538,5-3.5a3.2,3.2,0,0,0-.5-1.843Z"/></svg>',Ngt='<svg viewbox="0 0 18 18"><rect class="ql-stroke" height="12" width="12" x="3" y="3"/><rect class="ql-fill" height="2" width="3" x="5" y="5"/><rect class="ql-fill" height="2" width="4" x="9" y="5"/><g class="ql-fill ql-transparent"><rect height="2" width="3" x="5" y="8"/><rect height="2" width="4" x="9" y="8"/><rect height="2" width="3" x="5" y="11"/><rect height="2" width="4" x="9" y="11"/></g></svg>',Agt='<svg viewbox="0 0 18 18"><path class="ql-stroke" d="M5,3V9a4.012,4.012,0,0,0,4,4H9a4.012,4.012,0,0,0,4-4V3"/><rect class="ql-fill" height="1" rx="0.5" ry="0.5" width="12" x="3" y="15"/></svg>',_gt='<svg viewbox="0 0 18 18"><rect class="ql-stroke" height="12" width="12" x="3" y="3"/><rect class="ql-fill" height="12" width="1" x="5" y="3"/><rect class="ql-fill" height="12" width="1" x="12" y="3"/><rect class="ql-fill" height="2" width="8" x="5" y="8"/><rect class="ql-fill" height="1" width="3" x="3" y="5"/><rect class="ql-fill" height="1" width="3" x="3" y="7"/><rect class="ql-fill" height="1" width="3" x="3" y="10"/><rect class="ql-fill" height="1" width="3" x="3" y="12"/><rect class="ql-fill" height="1" width="3" x="12" y="5"/><rect class="ql-fill" height="1" width="3" x="12" y="7"/><rect class="ql-fill" height="1" width="3" x="12" y="10"/><rect class="ql-fill" height="1" width="3" x="12" y="12"/></svg>',XE={align:{"":ogt,center:sgt,right:lgt,justify:cgt},background:ugt,blockquote:dgt,bold:pgt,clean:hgt,code:jte,"code-block":jte,color:fgt,direction:{"":mgt,rtl:ggt},formula:vgt,header:{1:ygt,2:bgt},italic:Igt,image:wgt,indent:{"+1":Sgt,"-1":Tgt},link:Ugt,list:{bullet:Dgt,check:Egt,ordered:Cgt},script:{sub:Pgt,super:Rgt},strike:Mgt,table:Ngt,underline:Agt,video:_gt},kgt='<svg viewbox="0 0 18 18"><polygon class="ql-stroke" points="7 11 9 13 11 11 7 11"/><polygon class="ql-stroke" points="7 7 9 5 11 7 7 7"/></svg>';let Gte=0;function Hte(t,e){t.setAttribute(e,`${t.getAttribute(e)!=="true"}`)}class bB{constructor(e){this.select=e,this.container=document.createElement("span"),this.buildPicker(),this.select.style.display="none",this.select.parentNode.insertBefore(this.container,this.select),this.label.addEventListener("mousedown",()=>{this.togglePicker()}),this.label.addEventListener("keydown",i=>{switch(i.key){case"Enter":this.togglePicker();break;case"Escape":this.escape(),i.preventDefault();break}}),this.select.addEventListener("change",this.update.bind(this))}togglePicker(){this.container.classList.toggle("ql-expanded"),Hte(this.label,"aria-expanded"),Hte(this.options,"aria-hidden")}buildItem(e){const i=document.createElement("span");i.tabIndex="0",i.setAttribute("role","button"),i.classList.add("ql-picker-item");const n=e.getAttribute("value");return n&&i.setAttribute("data-value",n),e.textContent&&i.setAttribute("data-label",e.textContent),i.addEventListener("click",()=>{this.selectItem(i,!0)}),i.addEventListener("keydown",r=>{switch(r.key){case"Enter":this.selectItem(i,!0),r.preventDefault();break;case"Escape":this.escape(),r.preventDefault();break}}),i}buildLabel(){const e=document.createElement("span");return e.classList.add("ql-picker-label"),e.innerHTML=kgt,e.tabIndex="0",e.setAttribute("role","button"),e.setAttribute("aria-expanded","false"),this.container.appendChild(e),e}buildOptions(){const e=document.createElement("span");e.classList.add("ql-picker-options"),e.setAttribute("aria-hidden","true"),e.tabIndex="-1",e.id=`ql-picker-options-${Gte}`,Gte+=1,this.label.setAttribute("aria-controls",e.id),this.options=e,Array.from(this.select.options).forEach(i=>{const n=this.buildItem(i);e.appendChild(n),i.selected===!0&&this.selectItem(n)}),this.container.appendChild(e)}buildPicker(){Array.from(this.select.attributes).forEach(e=>{this.container.setAttribute(e.name,e.value)}),this.container.classList.add("ql-picker"),this.label=this.buildLabel(),this.buildOptions()}escape(){this.close(),setTimeout(()=>this.label.focus(),1)}close(){this.container.classList.remove("ql-expanded"),this.label.setAttribute("aria-expanded","false"),this.options.setAttribute("aria-hidden","true")}selectItem(e){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;const n=this.container.querySelector(".ql-selected");e!==n&&(n!=null&&n.classList.remove("ql-selected"),e!=null&&(e.classList.add("ql-selected"),this.select.selectedIndex=Array.from(e.parentNode.children).indexOf(e),e.hasAttribute("data-value")?this.label.setAttribute("data-value",e.getAttribute("data-value")):this.label.removeAttribute("data-value"),e.hasAttribute("data-label")?this.label.setAttribute("data-label",e.getAttribute("data-label")):this.label.removeAttribute("data-label"),i&&(this.select.dispatchEvent(new Event("change")),this.close())))}update(){let e;if(this.select.selectedIndex>-1){const n=this.container.querySelector(".ql-picker-options").children[this.select.selectedIndex];e=this.select.options[this.select.selectedIndex],this.selectItem(n)}else this.selectItem(null);const i=e!=null&&e!==this.select.querySelector("option[selected]");this.label.classList.toggle("ql-active",i)}}class QEe extends bB{constructor(e,i){super(e),this.label.innerHTML=i,this.container.classList.add("ql-color-picker"),Array.from(this.container.querySelectorAll(".ql-picker-item")).slice(0,7).forEach(n=>{n.classList.add("ql-primary")})}buildItem(e){const i=super.buildItem(e);return i.style.backgroundColor=e.getAttribute("value")||"",i}selectItem(e,i){super.selectItem(e,i);const n=this.label.querySelector(".ql-color-label"),r=e&&e.getAttribute("data-value")||"";n&&(n.tagName==="line"?n.style.stroke=r:n.style.fill=r)}}class eCe extends bB{constructor(e,i){super(e),this.container.classList.add("ql-icon-picker"),Array.from(this.container.querySelectorAll(".ql-picker-item")).forEach(n=>{n.innerHTML=i[n.getAttribute("data-value")||""]}),this.defaultItem=this.container.querySelector(".ql-selected"),this.selectItem(this.defaultItem)}selectItem(e,i){super.selectItem(e,i);const n=e||this.defaultItem;if(n!=null){if(this.label.innerHTML===n.innerHTML)return;this.label.innerHTML=n.innerHTML}}}const xgt=t=>{const{overflowY:e}=getComputedStyle(t,null);return e!=="visible"&&e!=="clip"};class tCe{constructor(e,i){this.quill=e,this.boundsContainer=i||document.body,this.root=e.addContainer("ql-tooltip"),this.root.innerHTML=this.constructor.TEMPLATE,xgt(this.quill.root)&&this.quill.root.addEventListener("scroll",()=>{this.root.style.marginTop=`${-1*this.quill.root.scrollTop}px`}),this.hide()}hide(){this.root.classList.add("ql-hidden")}position(e){const i=e.left+e.width/2-this.root.offsetWidth/2,n=e.bottom+this.quill.root.scrollTop;this.root.style.left=`${i}px`,this.root.style.top=`${n}px`,this.root.classList.remove("ql-flip");const r=this.boundsContainer.getBoundingClientRect(),a=this.root.getBoundingClientRect();let o=0;if(a.right>r.right&&(o=r.right-a.right,this.root.style.left=`${i+o}px`),a.left<r.left&&(o=r.left-a.left,this.root.style.left=`${i+o}px`),a.bottom>r.bottom){const s=a.bottom-a.top,l=e.bottom-e.top+s;this.root.style.top=`${n-l}px`,this.root.classList.add("ql-flip")}return o}show(){this.root.classList.remove("ql-editing"),this.root.classList.remove("ql-hidden")}}const Ogt=[!1,"center","right","justify"],Lgt=["#000000","#e60000","#ff9900","#ffff00","#008a00","#0066cc","#9933ff","#ffffff","#facccc","#ffebcc","#ffffcc","#cce8cc","#cce0f5","#ebd6ff","#bbbbbb","#f06666","#ffc266","#ffff66","#66b966","#66a3e0","#c285ff","#888888","#a10000","#b26b00","#b2b200","#006100","#0047b2","#6b24b2","#444444","#5c0000","#663d00","#666600","#003700","#002966","#3d1466"],Fgt=[!1,"serif","monospace"],Bgt=["1","2","3",!1],$gt=["small",!1,"large","huge"];class cM extends uT{constructor(e,i){super(e,i);const n=r=>{if(!document.body.contains(e.root)){document.body.removeEventListener("click",n);return}this.tooltip!=null&&!this.tooltip.root.contains(r.target)&&document.activeElement!==this.tooltip.textbox&&!this.quill.hasFocus()&&this.tooltip.hide(),this.pickers!=null&&this.pickers.forEach(a=>{a.container.contains(r.target)||a.close()})};e.emitter.listenDOM("click",document.body,n)}addModule(e){const i=super.addModule(e);return e==="toolbar"&&this.extendToolbar(i),i}buildButtons(e,i){Array.from(e).forEach(n=>{(n.getAttribute("class")||"").split(/\s+/).forEach(a=>{if(a.startsWith("ql-")&&(a=a.slice(3),i[a]!=null))if(a==="direction")n.innerHTML=i[a][""]+i[a].rtl;else if(typeof i[a]=="string")n.innerHTML=i[a];else{const o=n.value||"";o!=null&&i[a][o]&&(n.innerHTML=i[a][o])}})})}buildPickers(e,i){this.pickers=Array.from(e).map(r=>{if(r.classList.contains("ql-align")&&(r.querySelector("option")==null&&m1(r,Ogt),typeof i.align=="object"))return new eCe(r,i.align);if(r.classList.contains("ql-background")||r.classList.contains("ql-color")){const a=r.classList.contains("ql-background")?"background":"color";return r.querySelector("option")==null&&m1(r,Lgt,a==="background"?"#ffffff":"#000000"),new QEe(r,i[a])}return r.querySelector("option")==null&&(r.classList.contains("ql-font")?m1(r,Fgt):r.classList.contains("ql-header")?m1(r,Bgt):r.classList.contains("ql-size")&&m1(r,$gt)),new bB(r)});const n=()=>{this.pickers.forEach(r=>{r.update()})};this.quill.on(mi.events.EDITOR_CHANGE,n)}}cM.DEFAULTS=kv({},uT.DEFAULTS,{modules:{toolbar:{handlers:{formula(){this.quill.theme.tooltip.edit("formula")},image(){let t=this.container.querySelector("input.ql-image[type=file]");t==null&&(t=document.createElement("input"),t.setAttribute("type","file"),t.setAttribute("accept",this.quill.uploader.options.mimetypes.join(", ")),t.classList.add("ql-image"),t.addEventListener("change",()=>{const e=this.quill.getSelection(!0);this.quill.uploader.upload(e,t.files),t.value=""}),this.container.appendChild(t)),t.click()},video(){this.quill.theme.tooltip.edit("video")}}}}});class iCe extends tCe{constructor(e,i){super(e,i),this.textbox=this.root.querySelector('input[type="text"]'),this.listen()}listen(){this.textbox.addEventListener("keydown",e=>{e.key==="Enter"?(this.save(),e.preventDefault()):e.key==="Escape"&&(this.cancel(),e.preventDefault())})}cancel(){this.hide(),this.restoreFocus()}edit(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"link",i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;if(this.root.classList.remove("ql-hidden"),this.root.classList.add("ql-editing"),this.textbox==null)return;i!=null?this.textbox.value=i:e!==this.root.getAttribute("data-mode")&&(this.textbox.value="");const n=this.quill.getBounds(this.quill.selection.savedRange);n!=null&&this.position(n),this.textbox.select(),this.textbox.setAttribute("placeholder",this.textbox.getAttribute(`data-${e}`)||""),this.root.setAttribute("data-mode",e)}restoreFocus(){this.quill.focus({preventScroll:!0})}save(){let{value:e}=this.textbox;switch(this.root.getAttribute("data-mode")){case"link":{const{scrollTop:i}=this.quill.root;this.linkRange?(this.quill.formatText(this.linkRange,"link",e,mi.sources.USER),delete this.linkRange):(this.restoreFocus(),this.quill.format("link",e,mi.sources.USER)),this.quill.root.scrollTop=i;break}case"video":e=Vgt(e);case"formula":{if(!e)break;const i=this.quill.getSelection(!0);if(i!=null){const n=i.index+i.length;this.quill.insertEmbed(n,this.root.getAttribute("data-mode"),e,mi.sources.USER),this.root.getAttribute("data-mode")==="formula"&&this.quill.insertText(n+1," ",mi.sources.USER),this.quill.setSelection(n+2,mi.sources.USER)}break}}this.textbox.value="",this.hide()}}function Vgt(t){let e=t.match(/^(?:(https?):\/\/)?(?:(?:www|m)\.)?youtube\.com\/watch.*v=([a-zA-Z0-9_-]+)/)||t.match(/^(?:(https?):\/\/)?(?:(?:www|m)\.)?youtu\.be\/([a-zA-Z0-9_-]+)/);return e?`${e[1]||"https"}://www.youtube.com/embed/${e[2]}?showinfo=0`:(e=t.match(/^(?:(https?):\/\/)?(?:www\.)?vimeo\.com\/(\d+)/))?`${e[1]||"https"}://player.vimeo.com/video/${e[2]}/`:t}function m1(t,e){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;e.forEach(n=>{const r=document.createElement("option");n===i?r.setAttribute("selected","selected"):r.setAttribute("value",String(n)),t.appendChild(r)})}const jgt=[["bold","italic","link"],[{header:1},{header:2},"blockquote"]];class nCe extends iCe{constructor(e,i){super(e,i),this.quill.on(mi.events.EDITOR_CHANGE,(n,r,a,o)=>{if(n===mi.events.SELECTION_CHANGE)if(r!=null&&r.length>0&&o===mi.sources.USER){this.show(),this.root.style.left="0px",this.root.style.width="",this.root.style.width=`${this.root.offsetWidth}px`;const s=this.quill.getLines(r.index,r.length);if(s.length===1){const l=this.quill.getBounds(r);l!=null&&this.position(l)}else{const l=s[s.length-1],c=this.quill.getIndex(l),u=Math.min(l.length()-1,r.index+r.length-c),d=this.quill.getBounds(new UI(c,u));d!=null&&this.position(d)}}else document.activeElement!==this.textbox&&this.quill.hasFocus()&&this.hide()})}listen(){super.listen(),this.root.querySelector(".ql-close").addEventListener("click",()=>{this.root.classList.remove("ql-editing")}),this.quill.on(mi.events.SCROLL_OPTIMIZE,()=>{setTimeout(()=>{if(this.root.classList.contains("ql-hidden"))return;const e=this.quill.getSelection();if(e!=null){const i=this.quill.getBounds(e);i!=null&&this.position(i)}},1)})}cancel(){this.show()}position(e){const i=super.position(e),n=this.root.querySelector(".ql-tooltip-arrow");return n.style.marginLeft="",i!==0&&(n.style.marginLeft=`${-1*i-n.offsetWidth/2}px`),i}}Je(nCe,"TEMPLATE",['<span class="ql-tooltip-arrow"></span>','<div class="ql-tooltip-editor">','<input type="text" data-formula="e=mc^2" data-link="https://quilljs.com" data-video="Embed URL">','<a class="ql-close"></a>',"</div>"].join(""));class rCe extends cM{constructor(e,i){i.modules.toolbar!=null&&i.modules.toolbar.container==null&&(i.modules.toolbar.container=jgt),super(e,i),this.quill.container.classList.add("ql-bubble")}extendToolbar(e){this.tooltip=new nCe(this.quill,this.options.bounds),e.container!=null&&(this.tooltip.root.appendChild(e.container),this.buildButtons(e.container.querySelectorAll("button"),XE),this.buildPickers(e.container.querySelectorAll("select"),XE))}}rCe.DEFAULTS=kv({},cM.DEFAULTS,{modules:{toolbar:{handlers:{link(t){t?this.quill.theme.tooltip.edit():this.quill.format("link",!1)}}}}});const Ggt=[[{header:["1","2","3",!1]}],["bold","italic","underline","link"],[{list:"ordered"},{list:"bullet"}],["clean"]];class aCe extends iCe{constructor(){super(...arguments);Je(this,"preview",this.root.querySelector("a.ql-preview"))}listen(){super.listen(),this.root.querySelector("a.ql-action").addEventListener("click",i=>{this.root.classList.contains("ql-editing")?this.save():this.edit("link",this.preview.textContent),i.preventDefault()}),this.root.querySelector("a.ql-remove").addEventListener("click",i=>{if(this.linkRange!=null){const n=this.linkRange;this.restoreFocus(),this.quill.formatText(n,"link",!1,mi.sources.USER),delete this.linkRange}i.preventDefault(),this.hide()}),this.quill.on(mi.events.SELECTION_CHANGE,(i,n,r)=>{if(i!=null){if(i.length===0&&r===mi.sources.USER){const[a,o]=this.quill.scroll.descendant(Dv,i.index);if(a!=null){this.linkRange=new UI(i.index-o,a.length());const s=Dv.formats(a.domNode);this.preview.textContent=s,this.preview.setAttribute("href",s),this.show();const l=this.quill.getBounds(this.linkRange);l!=null&&this.position(l);return}}else delete this.linkRange;this.hide()}})}show(){super.show(),this.root.removeAttribute("data-mode")}}Je(aCe,"TEMPLATE",['<a class="ql-preview" rel="noopener noreferrer" target="_blank" href="about:blank"></a>','<input type="text" data-formula="e=mc^2" data-link="https://quilljs.com" data-video="Embed URL">','<a class="ql-action"></a>','<a class="ql-remove"></a>'].join(""));class oCe extends cM{constructor(e,i){i.modules.toolbar!=null&&i.modules.toolbar.container==null&&(i.modules.toolbar.container=Ggt),super(e,i),this.quill.container.classList.add("ql-snow")}extendToolbar(e){e.container!=null&&(e.container.classList.add("ql-snow"),this.buildButtons(e.container.querySelectorAll("button"),XE),this.buildPickers(e.container.querySelectorAll("select"),XE),this.tooltip=new aCe(this.quill,this.options.bounds),e.container.querySelector(".ql-link")&&this.quill.keyboard.addBinding({key:"k",shortKey:!0},(i,n)=>{e.handlers.link.call(e,!n.format.link)}))}}oCe.DEFAULTS=kv({},cM.DEFAULTS,{modules:{toolbar:{handlers:{link(t){if(t){const e=this.quill.getSelection();if(e==null||e.length===0)return;let i=this.quill.getText(e);/^\S+@\S+\.\S+$/.test(i)&&i.indexOf("mailto:")!==0&&(i=`mailto:${i}`);const{tooltip:n}=this.quill.theme;n.edit("link",i)}else this.quill.format("link",!1)}}}}});wt.register({"attributors/attribute/direction":BEe,"attributors/class/align":OEe,"attributors/class/background":cmt,"attributors/class/color":lmt,"attributors/class/direction":$Ee,"attributors/class/font":GEe,"attributors/class/size":zEe,"attributors/style/align":LEe,"attributors/style/background":dK,"attributors/style/color":uK,"attributors/style/direction":VEe,"attributors/style/font":HEe,"attributors/style/size":qEe},!0);wt.register({"formats/align":OEe,"formats/direction":$Ee,"formats/indent":Qmt,"formats/background":dK,"formats/color":uK,"formats/font":GEe,"formats/size":zEe,"formats/blockquote":uH,"formats/code-block":Yl,"formats/header":egt,"formats/list":lM,"formats/bold":ZE,"formats/code":pK,"formats/italic":dH,"formats/link":Dv,"formats/script":pH,"formats/strike":hH,"formats/underline":fH,"formats/formula":lA,"formats/image":tgt,"formats/video":cA,"modules/syntax":JEe,"modules/table":ngt,"modules/toolbar":vK,"themes/bubble":rCe,"themes/snow":oCe,"ui/icons":XE,"ui/picker":bB,"ui/icon-picker":eCe,"ui/color-picker":QEe,"ui/tooltip":tCe},!0);function Hgt({controlAnchor:t}){const e={editing:!1};return Ns({target:t,items:[{label:"Tournament image",onClick:qct,id:"tournamentImage",location:Qt,intent:"none"},{label:"Edit overview",onClick:()=>{var o;const r=document.getElementById("editOverview");r.innerHTML=e.editing?"Edit overview":"Save overview";const a=document.getElementById("notes");if(e.editing){a.previousElementSibling.remove(),a.style.border="none";const s=a.querySelector(".ql-editor"),c=((o=s==null?void 0:s.innerText)==null?void 0:o.replace(`
`,""))?s.innerHTML:"";as(a),a.innerHTML=c,Wt({methods:[{method:mKe,params:{notes:c}}]})}else{a.style.border=".5px solid",a.style.borderTop="";const s=new wt("#notes",{modules:{toolbar:[[{header:[1,2,3,4,5,6,!1]}],[{font:[]}],["bold","italic","underline"],[{color:[]},{background:[]}],[{list:"ordered"},{list:"bullet"}],[{align:[]}],["blockquote","code-block","link","video"],["clean"]]},theme:"snow"});Tt.quill=s}e.editing=!e.editing},id:"editOverview",location:Qt,intent:"none"}]}).elements}function zgt({tournamentName:t}){var o;const e=document.getElementById(QT);e.style.minHeight=`${window.innerHeight*.9}px`,as(e);const i=document.createElement("div");i.style.fontWeight="bold",i.className="block",i.innerHTML=ln.device.isMobile?t??"Tournament overview":"Tournament overview",e.appendChild(i);const n=document.createElement("div");e.appendChild(n);const r=(o=at.getTournament().tournamentRecord)==null?void 0:o.notes,a=document.createElement("div");a.className="ql-container ql-snow",a.style.border="none",a.innerHTML=r??"",a.id="notes",e.appendChild(a),Hgt({controlAnchor:n})}let pT;function IB(t){oN($1,t),oN(XD,t),oN(bh,t),oN(BO,t);const e=document.getElementById("trnynav"),i=document.getElementById("dnav");[$1,bh].includes(t)?(e.style.display=t===$1?"":Mt,i.style.display=""):i.style.display=Mt}function oN(t,e){const i=t===e,n=document.getElementById(t);n&&(n.style.display=i?"flex":"none")}const g2=()=>{const t=document.getElementById("dnav");t.style.display=Mt,pT=XD,IB(XD)},qgt=t=>{pT=t,IB($1)},Wgt=()=>{const t=document.getElementById("pageTitle");t&&(t.innerHTML="<div class='tmx-title'>Tournaments</div>"),pT=bh,IB(pT)},Kgt=()=>{pT=BO,IB(pT)};function Ygt({config:t}={}){const{tournamentRecord:e}=at.getTournament();(e==null?void 0:e.tournamentId)===t.tournamentId?sCe(t):(Tt.ee.emit(SUe,Tt.tournamentId),xc.findTournament(t.tournamentId).then(i=>mH({tournamentRecord:i,config:t})))}function v2({config:t}){qgt(Fo),Oot(),$9(t.selectedTab),sCe(t)}function sCe(t){var i;const{selectedTab:e=kf}=t;bhe(e)&&(e===kf&&xtt({participantView:t.participantView}),e===Qv&&g1e({scheduledDate:t.scheduledDate}),e===QT&&zgt({tournamentName:(i=at.getTournamentInfo().tournamentInfo)==null?void 0:i.tournamentName}),e===qp&&zct(t),e===r4&&Mot(),e===a4&&Zot())}function mH({tournamentRecord:t,config:e}){var o,s,l;const i=zc(),n=(i==null?void 0:i.provider)||(Tt==null?void 0:Tt.provider),r=()=>{ti({message:"Tournament not found",onClose:()=>{Tt.router.navigate("/tournaments")},intent:"is-warning",pauseOnHover:!0})},a=c=>{var d,p;const u=(p=(d=c==null?void 0:c.data)==null?void 0:d.tournamentRecords)==null?void 0:p[e.tournamentId];u?(at.setState(u),v2({config:e})):r()};if(n){const c=()=>{t?(at.setState(t),v2({config:e})):r()};if(e.tournamentId){if((l=(s=(o=t==null?void 0:t.timeItems)==null?void 0:o.find(({itemType:d})=>d==="TMX"))==null?void 0:s.itemValue)==null?void 0:l.offline)return c();qO({tournamentId:e.tournamentId}).then(a,c)}}else at.setState(t),v2({config:e})}const zte={addDrawDefinition:t=>bo("addDrawDefinition",t),addMatchUps:t=>bo("addMatchUps",t),addParticipants:t=>bo("addParticipants",t),addVenue:t=>bo("addVenue",t),deletedDrawIds:t=>bo("deletedDrawIds",t),deletedMatchUpIds:t=>bo("deletedMatchUpIds",t),deleteVenue:t=>bo("deleteVenue",t),modifyDrawDefinition:t=>bo("modifyDrawDefinition",t),modifyDrawEntries:t=>bo("modifyDrawEntries",t),modifyEventEntries:t=>bo("modifyEventEntries",t),modifyMatchUp:t=>bo("modifyMatchUp",t),modifyParticipants:t=>bo("modifyParticipants",t),modifyPositionAssignments:t=>bo("modifyPositionAssignments",t),modifySeedAssignments:t=>bo("modifySeedAssignments",t),modifyVenue:t=>bo("modifyVenue",t),publishEvent:t=>bo("publishEvent",t),publishEventSeeding:t=>bo("publishEventSeeding",t),publishOrderOfPlay:t=>bo("publishOrderOfPlay",t),unPublishEvent:t=>bo("unPublishEvent",t),unPublishEventSeeding:t=>bo("unPublishEventSeeding",t),unPublishOrderOfPlay:t=>bo("unPublishOrderOfPlay",t),updateInContextMatchUp:t=>bo("updateInContextMatchUp",t),modifyTournamentDetail:t=>bo("modifyTournamentDetail",t)};function bo(t,e){var i,n,r;return typeof((n=(i=window.dev)==null?void 0:i.subs)==null?void 0:n[t])=="function"?window.dev.subs[t](e):(window.dev.allSubscriptions||((r=window.dev.subs)==null?void 0:r[t]))&&console.log(t,e)}function lCe(){if(!window.dev)console.log("%c dev initialized","color: yellow"),window.dev={};else return;const t=()=>console.log("set window.socketURL for messaging"),e=r=>{var o;if(!Array.isArray(r)){ti({message:"missing methods array",intent:"is-danger"});return}((o=at.getTournament().tournamentRecord)==null?void 0:o.tournamentId)?Wt({methods:r,callback:l=>{var c;if(l!=null&&l.success){ti({message:"success",intent:"is-success"});const u=at.getTournament().tournamentRecord;mH({tournamentRecord:u,config:{selectedTab:Fo}})}else ti({message:((c=l==null?void 0:l.error)==null?void 0:c.message)??"error",intent:"is-danger"}),console.log({result:l})}}):ti({message:"missing tournament",intent:"is-danger"})},i=r=>{qO({tournamentId:r}).then(a=>{var o,s;if(a!=null&&a.error)console.log({error:a.error});else{const l=(s=(o=a==null?void 0:a.data)==null?void 0:o.tournamentRecords)==null?void 0:s[r];l&&mH({tournamentRecord:l,config:{selectedTab:Fo}})}})},n=Object.assign({},...Object.keys(zte).map(r=>({[r]:!1})));sN({getProviders:nE,getProvider:r=>nE().then(a=>{var o;return console.log((o=a==null?void 0:a.data)==null?void 0:o.providers.find(s=>s.value.organisationName.toLowerCase().includes(r.toLowerCase())))}),getTournament:()=>{var r;return(r=at.getTournament())==null?void 0:r.tournamentRecord},getContext:B0.getDevContext,tournamentEngine:at,context:B0.setDevContext,generateMockTournament:Xgt,modifyTournament:e,fetchTournament:i,sendTournament:H1,getLoginState:zc,factory:CV,baseApi:ju,dayjs:E9,help:t,subs:n}),sN({connectSocket:FUe,disconnectSocket:YF,emitTmx:D9}),sN({tmx2db:xc,load:Zgt,exportTournamentRecord:BQe}),sN({env:ln,tournamentContext:Tt}),B0.setSubscriptions({subscriptions:zte})}function sN(t){if(lp(window.dev))try{Object.keys(t).forEach(e=>window.dev[e]=t[e])}catch{console.log("production environment")}}function Zgt(t){if(typeof t=="object"){const e=t.tournamentRecord||t;(e==null?void 0:e.tournamentId)&&cCe(e)}}function Xgt(t){const{tournamentRecord:e,error:i}=IP.generateTournamentRecord(t);i?console.log({error:i}):cCe(e)}function cCe(t){const e=t==null?void 0:t.tournamentId;wTe({tournamentRecord:t,callback:()=>Tt.router.navigate(`/${Fo}/${e}`)})}class M1 extends Error{}M1.prototype.name="InvalidTokenError";function Jgt(t){return decodeURIComponent(atob(t).replace(/(.)/g,(e,i)=>{let n=i.charCodeAt(0).toString(16).toUpperCase();return n.length<2&&(n="0"+n),"%"+n}))}function Qgt(t){let e=t.replace(/-/g,"+").replace(/_/g,"/");switch(e.length%4){case 0:break;case 2:e+="==";break;case 3:e+="=";break;default:throw new Error("base64 string is not of the correct length")}try{return Jgt(e)}catch{return atob(e)}}function evt(t,e){if(typeof t!="string")throw new M1("Invalid token specified: must be a string");e||(e={});const i=e.header===!0?0:1,n=t.split(".")[i];if(typeof n!="string")throw new M1(`Invalid token specified: missing part #${i+1}`);let r;try{r=Qgt(n)}catch(a){throw new M1(`Invalid token specified: invalid base64 for part #${i+1} (${a.message})`)}try{return JSON.parse(r)}catch(a){throw new M1(`Invalid token specified: invalid json for part #${i+1} (${a.message})`)}}function uCe(t){var r,a;if(!t||t==="undefined"){jUe();return}let e;try{e=evt(t)}catch{bTe();return}const i=new Date;return(e==null?void 0:e.exp)<i.getTime()/1e3?yK():(((r=e==null?void 0:e.permissions)!=null&&r.includes("devMode")||(a=e==null?void 0:e.roles)!=null&&a.includes("develope"))&&lCe(),e)}function qte(t){var m;const{callback:e,provider:i}=t||{},n=(m=i==null?void 0:i.onlineResources)==null?void 0:m.find(g=>g.name==="providerImage"&&g.resourceType==="URL"&&g.resourceSubType==="IMAGE");let r,a;const o=i||{},s=()=>{const g=document.getElementById("providerImagePreview");g.style.display=Mt},l=()=>{c({inputs:r}),a=!1;const g=document.getElementById("providerImagePreview");g.onload=()=>(a=!0)&&c({inputs:r}),g.src=r.tournamentImage.value,g.style.display=""},c=({inputs:g})=>{const v=(a||!g.tournamentImage.value||a===void 0)&&ta(10)(g.providerName.value)&&ta(3)(g.providerAbbr.value)&&(!g.providerId.value.length||ta(36)(g.providerId.value)),y=document.getElementById("createButton");y&&(y.disabled=!v)},u=[{control:"providerAbbr",onInput:c},{control:"providerName",onInput:c},{control:"providerId",onInput:c}],d=g=>{var v,y;return r=Cr(g,[{value:o.organisationName,placeholder:"Provider name",validator:ta(10),label:"Provider Name",field:"providerName",autocomplete:"off"},{value:o.organisationAbbreviation,placeholder:"Abbreviation",validator:ta(3),label:"Abbreviation",field:"providerAbbr",autocomplete:"off"},{placeholder:"NOT REQUIRED - automatically generated",value:((v=t==null?void 0:t.provider)==null?void 0:v.organisationId)??"",disabled:(y=t==null?void 0:t.provider)==null?void 0:y.organisationId,label:"Provider ID",autocomplete:"off",field:"providerId"},{onKeyUp:b=>b.key==="Enter"&&l(),onChange:()=>r.tournamentImage.value?l():s(),label:"Web address of online image",value:n==null?void 0:n.identifier,placeholder:"Image URL",field:"tournamentImage",autocomplete:"off"}],u)},p=document.createElement("div");d(p);const h=document.createElement("img");h.id="providerImagePreview",h.style.width="100%",p.appendChild(h);const f=()=>{var T;const g=r.providerAbbr.value,v=r.providerName.value,y=((T=t==null?void 0:t.provider)==null?void 0:T.organisationId)||r.providerId.value||_i.UUID(),b={organisationAbbreviation:g,organisationName:v,organisationId:y};if(a){const S={resourceSubType:"IMAGE",name:"providerImage",resourceType:"URL",identifier:r.tournamentImage.value};b.onlineResources=[S]}const I=w=>Nt(e)&&e(w);t!=null&&t.provider?_2e({provider:b}).then(I,w=>console.log({err:w})):A2e({provider:b}).then(I,w=>console.log({err:w}))};cr({title:"Create provider",content:p,buttons:[{label:"Cancel",intent:"none",close:!0},{label:t!=null&&t.provider?"Update":"Create",onClick:f,id:"createButton",intent:"is-info",disabled:!0,close:!0}]}),n&&setTimeout(l,400)}function dCe(){let t;cr({title:"Settings",content:n=>t=Cr(n,[{options:[{text:"WTN",field:"wtn",checked:ln.activeScale===tE},{text:"UTR",field:"utr",checked:ln.activeScale===rI}],onClick:r=>console.log({x:r}),label:"Active rating",field:"activeRating",id:"activeRating",radio:!0},{label:"Save local copies",checked:ln.saveLocal,field:"saveLocal",id:"saveLocal",checkbox:!0}]),buttons:[{label:"Cancel",intent:"none",close:!0},{label:"Save",intent:"is-primary",onClick:()=>{const n=t.wtn.checked?tE:rI;ln.saveLocal=t.saveLocal.checked,pk(n)},close:!0}]})}function tvt(t){const e=document.getElementById(t);e&&e.addEventListener("click",dCe)}const wk=t=>t.match(/^[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,}$/i);async function ivt(t,e){return ju.post("/auth/login",{password:e,email:t})}async function nvt(t,e,i,n){return ju.post("/auth/invite",{permissions:n,providerId:e,email:t,roles:i})}async function rvt(t,e,i,n){return ju.post("/auth/register",{firstName:t,lastName:e,password:i,code:n})}function avt(t,e=[]){const n=[{value:{organisationName:"None"},key:""},...e].map(({key:p,value:h})=>({label:h==null?void 0:h.organisationName,value:p}));let r;const a={providerId:""},s=[{onInput:({inputs:p})=>{const h=p.email.value,f=wk(h),m=document.getElementById("inviteUser");m&&(m.disabled=!f)},control:"email"}],l=p=>r=Cr(p,[{iconLeft:"fa-regular fa-envelope",placeholder:"valid@email.com",validator:wk,autocomplete:"off",label:"Email",field:"email"},{text:"Roles",header:!0},{label:"Client",field:"client",checkbox:!0,width:"50%",id:"client",fieldPair:{label:"Director",field:"director",id:"director",checkbox:!0}},{label:"Admin",checkbox:!0,field:"admin",width:"50%",id:"admin",fieldPair:{label:"Official",field:"official",id:"official",checkbox:!0}},{label:"Scoring",field:"score",width:"50%",id:"score",checkbox:!0,fieldPair:{label:"Developer",field:"developer",id:"developer",checkbox:!0}},{label:"Generate",field:"generate",checkbox:!0,id:"generate"},{value:a.providerId,options:n,field:"providerId",label:"Provider"},{text:"Permissions",header:!0},{label:"Delete Tournaments",field:"deleteTournament",checkbox:!0,id:"delete"},{field:"editTennisId",label:"Edit WTID",id:"editTennisId",checkbox:!0},{label:"Dev mode",field:"devMode",checkbox:!0,id:"devmode"}],s),c=["client","admin","score","developer","generate","director","official"],u=["devMode"];cr({title:"Invite user",content:l,buttons:[{label:"Cancel",intent:"none",close:!0},{label:"Invite",intent:"is-primary",id:"inviteUser",disabled:!0,onClick:()=>{const p=r.email.value,h=r.providerId.value,f=u.map(v=>r[v].checked&&v).filter(Boolean),m=c.map(v=>r[v].checked&&v).filter(Boolean),g=v=>Nt(t)&&t(v);nvt(p,h,m,f).then(g,v=>console.log({err:v}))},close:!0}]})}function ovt(t){let e;const n=[{onInput:({inputs:o})=>{const s=o.email.value,l=wk(s),c=document.getElementById("loginButton");c&&(c.disabled=!l)},control:"email"}];cr({title:"Log in",content:o=>e=Cr(o,[{iconLeft:"fa-regular fa-envelope",placeholder:"valid@email.com",validator:wk,autocomplete:"email",label:"Email",field:"email"},{placeholder:"minimum 8 characters",autocomplete:"current-password",iconLeft:"fa-solid fa-lock",label:"Password",field:"password",type:"password"}],n),buttons:[{label:"Cancel",intent:"none",close:!0},{onClick:()=>{const o=e.email.value,s=e.password.value,l=c=>{!c&&yK(),(c==null?void 0:c.status)===200&&cvt({data:c.data,callback:t})};ivt(o,s).then(l,c=>console.log({err:c}))},intent:"is-primary",id:"loginButton",disabled:!0,label:"Login",close:!0}]})}function svt(t){navigator.clipboard.writeText(t).then(()=>ti({message:"Copied to clipboard",intent:"is-success"})).catch(a=>ti({message:a,intent:"is-danger"}));let e=document.createElement("input");e.style.opacity=0,e.setAttribute("id","c2c"),e.setAttribute("type","text"),e.setAttribute("value",t);let i=document.body.appendChild(e),n=document.createElement("button");n.style.display="none",n.setAttribute("data-copytarget","#c2c"),n.addEventListener("click",lvt,!0);let r=document.body.appendChild(n);r.click(),r.remove(),i.remove()}function lvt(t){let i=t.target.dataset.copytarget,n=i?document.querySelector(i):null;if(n!=null&&n.select){n.select();try{document.execCommand("copy"),n.blur()}catch{alert("please press Ctrl/Cmd+C to copy")}}}function wB(t){var r;const e=document.getElementById("login"),i=Tt==null?void 0:Tt.provider,n=(r=t==null?void 0:t.roles)==null?void 0:r.includes(FO);t?e.style.color=i&&"red"||n&&"green"||"blue":e.style.color=""}function zc(){const t=ITe(),e=uCe(t);return e&&wB(e),e}function yK(){bTe(),jUe(),YF(),Tt.provider=void 0,Tt.router.navigate(`/${bh}/logout`),wB(!1)}function cvt({data:t,callback:e}){var r,a;const i=uCe(t.token),n=(r=at.getTournament().tournamentRecord)==null?void 0:r.tournamentId;i&&(_9e(t.token),ti({intent:"is-success",message:"Log in successful"}),YF(),n||at.reset(),wB(i),Nt(e)?e():n||Tt.router.navigate(`/${bh}/${(a=i.provider)==null?void 0:a.organisationAbbreviation}`))}function uvt(){nE().then(({data:t})=>{var i;const e=(i=t==null?void 0:t.providers)==null?void 0:i.map(({value:n})=>({onClick:()=>{Tt.provider=n,Tt.router.navigate(`/${bh}/${n.organisationAbbreviation}`)},participantName:n.organisationName}));e&&c9({title:"Select Provider",options:e,selectionLimit:1})})}function dvt(){O2e().then(({data:t})=>{var i;const e=(i=t==null?void 0:t.users)==null?void 0:i.map(({value:n})=>({participantName:`${n.firstName} ${n.lastName} (${n.email})`,onClick:()=>L2e(n).then(()=>ti({message:"User removed"}))}));e&&c9({title:"Select User",options:e,selectionLimit:1})})}function pvt(){Tt.provider=void 0,Tt.router.navigate(`/${bh}/superadmin`)}function Wte(t){const e=document.getElementById(t),i=n=>console.log("Invite:",{error:n});if(e){const n=a=>{const o=a==null?void 0:a.data.inviteCode;if(o){const s=`${window.location.origin}${window.location.pathname}/#/${the}/${o}`;svt(s),console.log({inviteCode:o,inviteURL:s})}else i(a)},r=a=>setTimeout(()=>qte({provider:a}),200);e.addEventListener("click",()=>{var u,d;const a=zc(),o=(u=a==null?void 0:a.roles)==null?void 0:u.includes(FO),s=(d=a==null?void 0:a.roles)==null?void 0:d.includes(GBe),l=Tt==null?void 0:Tt.provider;pc({target:e,title:"Authorization",items:[{onClick:()=>ti({message:"TBD: Registration Modal"}),text:"Register",hide:a},{onClick:()=>ovt(),hide:a,text:"Log in"},{style:"text-decoration: line-through;",hide:!o||!l,onClick:pvt,text:"Impersonate"},{hide:!o||l,onClick:uvt,text:"Impersonate"},{onClick:qte,text:"Create provider",hide:!o},{onClick:()=>N9e({callback:r}),text:"Edit provider",hide:!o},{onClick:dvt,text:"Remove user",hide:!o},{onClick:()=>nE().then(({data:p})=>avt(n,p==null?void 0:p.providers),i),hide:!o&&!l,text:"Invite User"},{text:"Log out",hide:!a,onClick:yK},{hide:!s,divider:!0},{onClick:xQe,heading:"Actions",hide:!s},{divider:!0},{onClick:dCe,heading:"Settings"}]})})}}/*!
 * EventEmitter v5.2.6 - git.io/ee
 * Unlicense - http://unlicense.org/
 * Oliver Caldwell - https://oli.me.uk/
 * @preserve
 */const hvt=function(){function t(){}let e=t.prototype;function i(a,o){let s=a.length;for(;s--;)if(a[s].listener===o)return s;return-1}function n(a){return function(){return this[a].apply(this,arguments)}}e.getListeners=function(o){let s=this._getEvents(),l,c;if(o instanceof RegExp){l={};for(c in s)s.hasOwnProperty(c)&&o.test(c)&&(l[c]=s[c])}else l=s[o]||(s[o]=[]);return l},e.flattenListeners=function(o){let s=[],l;for(l=0;l<o.length;l+=1)s.push(o[l].listener);return s},e.getListenersAsObject=function(o){let s=this.getListeners(o),l;return s instanceof Array&&(l={},l[o]=s),l||s};function r(a){return typeof a=="function"||a instanceof RegExp?!0:a&&typeof a=="object"?r(a.listener):!1}return e.addListener=function(o,s){if(!r(s))throw new TypeError("listener must be a function");let l=this.getListenersAsObject(o),c=typeof s=="object",u;for(u in l)l.hasOwnProperty(u)&&i(l[u],s)===-1&&l[u].push(c?s:{listener:s,once:!1});return this},e.on=n("addListener"),e.addOnceListener=function(o,s){return this.addListener(o,{listener:s,once:!0})},e.once=n("addOnceListener"),e.defineEvent=function(o){return this.getListeners(o),this},e.defineEvents=function(o){for(let s=0;s<o.length;s+=1)this.defineEvent(o[s]);return this},e.removeListener=function(o,s){let l=this.getListenersAsObject(o),c,u;for(u in l)l.hasOwnProperty(u)&&(c=i(l[u],s),c!==-1&&l[u].splice(c,1));return this},e.off=n("removeListener"),e.addListeners=function(o,s){return this.manipulateListeners(!1,o,s)},e.removeListeners=function(o,s){return this.manipulateListeners(!0,o,s)},e.manipulateListeners=function(o,s,l){let c,u,d=o?this.removeListener:this.addListener,p=o?this.removeListeners:this.addListeners;if(typeof s=="object"&&!(s instanceof RegExp))for(c in s)s.hasOwnProperty(c)&&(u=s[c])&&(typeof u=="function"?d.call(this,c,u):p.call(this,c,u));else for(c=l.length;c--;)d.call(this,s,l[c]);return this},e.removeEvent=function(o){let s=typeof o,l=this._getEvents(),c;if(s==="string")delete l[o];else if(o instanceof RegExp)for(c in l)l.hasOwnProperty(c)&&o.test(c)&&delete l[c];else delete this._events;return this},e.removeAllListeners=n("removeEvent"),e.emitEvent=function(o,s){let l=this.getListenersAsObject(o),c,u,d,p,h;for(p in l)if(l.hasOwnProperty(p))for(c=l[p].slice(0),d=0;d<c.length;d++)u=c[d],u.once===!0&&this.removeListener(o,u.listener),h=u.listener.apply(this,s||[]),h===this._getOnceReturnValue()&&this.removeListener(o,u.listener);return this},e.trigger=n("emitEvent"),e.emit=function(o){let s=Array.prototype.slice.call(arguments,1);return this.emitEvent(o,s)},e.setOnceReturnValue=function(o){return this._onceReturnValue=o,this},e._getOnceReturnValue=function(){return this.hasOwnProperty("_onceReturnValue")?this._onceReturnValue:!0},e._getEvents=function(){return this._events||(this._events={})},t}();function Kte(){try{return window}catch{return}}const pCe=()=>Kte().dev&&typeof Kte().dev=="object";function fvt(){document.oncontextmenu=()=>!1,window.addEventListener("contextmenu",t=>{t.preventDefault()},!1),window.packageEntry={updateReady:i$e},window.onunhandledrejection=t=>{if(pCe())return;t.preventDefault();const e=t.reason,i=e&&(e.stack||e);i&&i.indexOf("blocked")>0?(n$e(),console.warn("popup blocked")):console.warn("Unhandled rejection:",e&&(e.stack||e))}}/*!
* tabbable 6.2.0
* @license MIT, https://github.com/focus-trap/tabbable/blob/master/LICENSE
*/var hCe=["input:not([inert])","select:not([inert])","textarea:not([inert])","a[href]:not([inert])","button:not([inert])","[tabindex]:not(slot):not([inert])","audio[controls]:not([inert])","video[controls]:not([inert])",'[contenteditable]:not([contenteditable="false"]):not([inert])',"details>summary:first-of-type:not([inert])","details:not([inert])"],Sk=hCe.join(","),fCe=typeof Element>"u",DI=fCe?function(){}:Element.prototype.matches||Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector,Tk=!fCe&&Element.prototype.getRootNode?function(t){var e;return t==null||(e=t.getRootNode)===null||e===void 0?void 0:e.call(t)}:function(t){return t==null?void 0:t.ownerDocument},Uk=function t(e,i){var n;i===void 0&&(i=!0);var r=e==null||(n=e.getAttribute)===null||n===void 0?void 0:n.call(e,"inert"),a=r===""||r==="true",o=a||i&&e&&t(e.parentNode);return o},mvt=function(e){var i,n=e==null||(i=e.getAttribute)===null||i===void 0?void 0:i.call(e,"contenteditable");return n===""||n==="true"},mCe=function(e,i,n){if(Uk(e))return[];var r=Array.prototype.slice.apply(e.querySelectorAll(Sk));return i&&DI.call(e,Sk)&&r.unshift(e),r=r.filter(n),r},gCe=function t(e,i,n){for(var r=[],a=Array.from(e);a.length;){var o=a.shift();if(!Uk(o,!1))if(o.tagName==="SLOT"){var s=o.assignedElements(),l=s.length?s:o.children,c=t(l,!0,n);n.flatten?r.push.apply(r,c):r.push({scopeParent:o,candidates:c})}else{var u=DI.call(o,Sk);u&&n.filter(o)&&(i||!e.includes(o))&&r.push(o);var d=o.shadowRoot||typeof n.getShadowRoot=="function"&&n.getShadowRoot(o),p=!Uk(d,!1)&&(!n.shadowRootFilter||n.shadowRootFilter(o));if(d&&p){var h=t(d===!0?o.children:d.children,!0,n);n.flatten?r.push.apply(r,h):r.push({scopeParent:o,candidates:h})}else a.unshift.apply(a,o.children)}}return r},vCe=function(e){return!isNaN(parseInt(e.getAttribute("tabindex"),10))},db=function(e){if(!e)throw new Error("No node provided");return e.tabIndex<0&&(/^(AUDIO|VIDEO|DETAILS)$/.test(e.tagName)||mvt(e))&&!vCe(e)?0:e.tabIndex},gvt=function(e,i){var n=db(e);return n<0&&i&&!vCe(e)?0:n},vvt=function(e,i){return e.tabIndex===i.tabIndex?e.documentOrder-i.documentOrder:e.tabIndex-i.tabIndex},yCe=function(e){return e.tagName==="INPUT"},yvt=function(e){return yCe(e)&&e.type==="hidden"},bvt=function(e){var i=e.tagName==="DETAILS"&&Array.prototype.slice.apply(e.children).some(function(n){return n.tagName==="SUMMARY"});return i},Ivt=function(e,i){for(var n=0;n<e.length;n++)if(e[n].checked&&e[n].form===i)return e[n]},wvt=function(e){if(!e.name)return!0;var i=e.form||Tk(e),n=function(s){return i.querySelectorAll('input[type="radio"][name="'+s+'"]')},r;if(typeof window<"u"&&typeof window.CSS<"u"&&typeof window.CSS.escape=="function")r=n(window.CSS.escape(e.name));else try{r=n(e.name)}catch(o){return console.error("Looks like you have a radio button with a name attribute containing invalid CSS selector characters and need the CSS.escape polyfill: %s",o.message),!1}var a=Ivt(r,e.form);return!a||a===e},Svt=function(e){return yCe(e)&&e.type==="radio"},Tvt=function(e){return Svt(e)&&!wvt(e)},Uvt=function(e){var i,n=e&&Tk(e),r=(i=n)===null||i===void 0?void 0:i.host,a=!1;if(n&&n!==e){var o,s,l;for(a=!!((o=r)!==null&&o!==void 0&&(s=o.ownerDocument)!==null&&s!==void 0&&s.contains(r)||e!=null&&(l=e.ownerDocument)!==null&&l!==void 0&&l.contains(e));!a&&r;){var c,u,d;n=Tk(r),r=(c=n)===null||c===void 0?void 0:c.host,a=!!((u=r)!==null&&u!==void 0&&(d=u.ownerDocument)!==null&&d!==void 0&&d.contains(r))}}return a},Yte=function(e){var i=e.getBoundingClientRect(),n=i.width,r=i.height;return n===0&&r===0},Dvt=function(e,i){var n=i.displayCheck,r=i.getShadowRoot;if(getComputedStyle(e).visibility==="hidden")return!0;var a=DI.call(e,"details>summary:first-of-type"),o=a?e.parentElement:e;if(DI.call(o,"details:not([open]) *"))return!0;if(!n||n==="full"||n==="legacy-full"){if(typeof r=="function"){for(var s=e;e;){var l=e.parentElement,c=Tk(e);if(l&&!l.shadowRoot&&r(l)===!0)return Yte(e);e.assignedSlot?e=e.assignedSlot:!l&&c!==e.ownerDocument?e=c.host:e=l}e=s}if(Uvt(e))return!e.getClientRects().length;if(n!=="legacy-full")return!0}else if(n==="non-zero-area")return Yte(e);return!1},Evt=function(e){if(/^(INPUT|BUTTON|SELECT|TEXTAREA)$/.test(e.tagName))for(var i=e.parentElement;i;){if(i.tagName==="FIELDSET"&&i.disabled){for(var n=0;n<i.children.length;n++){var r=i.children.item(n);if(r.tagName==="LEGEND")return DI.call(i,"fieldset[disabled] *")?!0:!r.contains(e)}return!0}i=i.parentElement}return!1},Dk=function(e,i){return!(i.disabled||Uk(i)||yvt(i)||Dvt(i,e)||bvt(i)||Evt(i))},gH=function(e,i){return!(Tvt(i)||db(i)<0||!Dk(e,i))},Cvt=function(e){var i=parseInt(e.getAttribute("tabindex"),10);return!!(isNaN(i)||i>=0)},Pvt=function t(e){var i=[],n=[];return e.forEach(function(r,a){var o=!!r.scopeParent,s=o?r.scopeParent:r,l=gvt(s,o),c=o?t(r.candidates):s;l===0?o?i.push.apply(i,c):i.push(s):n.push({documentOrder:a,tabIndex:l,item:r,isScope:o,content:c})}),n.sort(vvt).reduce(function(r,a){return a.isScope?r.push.apply(r,a.content):r.push(a.content),r},[]).concat(i)},Rvt=function(e,i){i=i||{};var n;return i.getShadowRoot?n=gCe([e],i.includeContainer,{filter:gH.bind(null,i),flatten:!1,getShadowRoot:i.getShadowRoot,shadowRootFilter:Cvt}):n=mCe(e,i.includeContainer,gH.bind(null,i)),Pvt(n)},Mvt=function(e,i){i=i||{};var n;return i.getShadowRoot?n=gCe([e],i.includeContainer,{filter:Dk.bind(null,i),flatten:!0,getShadowRoot:i.getShadowRoot}):n=mCe(e,i.includeContainer,Dk.bind(null,i)),n},u0=function(e,i){if(i=i||{},!e)throw new Error("No node provided");return DI.call(e,Sk)===!1?!1:gH(i,e)},Nvt=hCe.concat("iframe").join(","),y2=function(e,i){if(i=i||{},!e)throw new Error("No node provided");return DI.call(e,Nvt)===!1?!1:Dk(i,e)};/*!
* focus-trap 7.5.4
* @license MIT, https://github.com/focus-trap/focus-trap/blob/master/LICENSE
*/function Zte(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),i.push.apply(i,n)}return i}function Xte(t){for(var e=1;e<arguments.length;e++){var i=arguments[e]!=null?arguments[e]:{};e%2?Zte(Object(i),!0).forEach(function(n){Avt(t,n,i[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):Zte(Object(i)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(i,n))})}return t}function Avt(t,e,i){return e=kvt(e),e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function _vt(t,e){if(typeof t!="object"||t===null)return t;var i=t[Symbol.toPrimitive];if(i!==void 0){var n=i.call(t,e||"default");if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function kvt(t){var e=_vt(t,"string");return typeof e=="symbol"?e:String(e)}var Jte={activateTrap:function(e,i){if(e.length>0){var n=e[e.length-1];n!==i&&n.pause()}var r=e.indexOf(i);r===-1||e.splice(r,1),e.push(i)},deactivateTrap:function(e,i){var n=e.indexOf(i);n!==-1&&e.splice(n,1),e.length>0&&e[e.length-1].unpause()}},xvt=function(e){return e.tagName&&e.tagName.toLowerCase()==="input"&&typeof e.select=="function"},Ovt=function(e){return(e==null?void 0:e.key)==="Escape"||(e==null?void 0:e.key)==="Esc"||(e==null?void 0:e.keyCode)===27},lD=function(e){return(e==null?void 0:e.key)==="Tab"||(e==null?void 0:e.keyCode)===9},Lvt=function(e){return lD(e)&&!e.shiftKey},Fvt=function(e){return lD(e)&&e.shiftKey},Qte=function(e){return setTimeout(e,0)},eie=function(e,i){var n=-1;return e.every(function(r,a){return i(r)?(n=a,!1):!0}),n},g1=function(e){for(var i=arguments.length,n=new Array(i>1?i-1:0),r=1;r<i;r++)n[r-1]=arguments[r];return typeof e=="function"?e.apply(void 0,n):e},lN=function(e){return e.target.shadowRoot&&typeof e.composedPath=="function"?e.composedPath()[0]:e.target},Bvt=[],$vt=function(e,i){var n=(i==null?void 0:i.document)||document,r=(i==null?void 0:i.trapStack)||Bvt,a=Xte({returnFocusOnDeactivate:!0,escapeDeactivates:!0,delayInitialFocus:!0,isKeyForward:Lvt,isKeyBackward:Fvt},i),o={containers:[],containerGroups:[],tabbableGroups:[],nodeFocusedBeforeActivation:null,mostRecentlyFocusedNode:null,active:!1,paused:!1,delayInitialFocusTimer:void 0,recentNavEvent:void 0},s,l=function(R,N,M){return R&&R[N]!==void 0?R[N]:a[M||N]},c=function(R,N){var M=typeof(N==null?void 0:N.composedPath)=="function"?N.composedPath():void 0;return o.containerGroups.findIndex(function(A){var _=A.container,x=A.tabbableNodes;return _.contains(R)||(M==null?void 0:M.includes(_))||x.find(function(O){return O===R})})},u=function(R){var N=a[R];if(typeof N=="function"){for(var M=arguments.length,A=new Array(M>1?M-1:0),_=1;_<M;_++)A[_-1]=arguments[_];N=N.apply(void 0,A)}if(N===!0&&(N=void 0),!N){if(N===void 0||N===!1)return N;throw new Error("`".concat(R,"` was specified but was not a node, or did not return a node"))}var x=N;if(typeof N=="string"&&(x=n.querySelector(N),!x))throw new Error("`".concat(R,"` as selector refers to no known node"));return x},d=function(){var R=u("initialFocus");if(R===!1)return!1;if(R===void 0||!y2(R,a.tabbableOptions))if(c(n.activeElement)>=0)R=n.activeElement;else{var N=o.tabbableGroups[0],M=N&&N.firstTabbableNode;R=M||u("fallbackFocus")}if(!R)throw new Error("Your focus-trap needs to have at least one focusable element");return R},p=function(){if(o.containerGroups=o.containers.map(function(R){var N=Rvt(R,a.tabbableOptions),M=Mvt(R,a.tabbableOptions),A=N.length>0?N[0]:void 0,_=N.length>0?N[N.length-1]:void 0,x=M.find(function(F){return u0(F)}),O=M.slice().reverse().find(function(F){return u0(F)}),B=!!N.find(function(F){return db(F)>0});return{container:R,tabbableNodes:N,focusableNodes:M,posTabIndexesFound:B,firstTabbableNode:A,lastTabbableNode:_,firstDomTabbableNode:x,lastDomTabbableNode:O,nextTabbableNode:function(G){var H=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,$=N.indexOf(G);return $<0?H?M.slice(M.indexOf(G)+1).find(function(q){return u0(q)}):M.slice(0,M.indexOf(G)).reverse().find(function(q){return u0(q)}):N[$+(H?1:-1)]}}}),o.tabbableGroups=o.containerGroups.filter(function(R){return R.tabbableNodes.length>0}),o.tabbableGroups.length<=0&&!u("fallbackFocus"))throw new Error("Your focus-trap must have at least one container with at least one tabbable node in it at all times");if(o.containerGroups.find(function(R){return R.posTabIndexesFound})&&o.containerGroups.length>1)throw new Error("At least one node with a positive tabindex was found in one of your focus-trap's multiple containers. Positive tabindexes are only supported in single-container focus-traps.")},h=function P(R){var N=R.activeElement;if(N)return N.shadowRoot&&N.shadowRoot.activeElement!==null?P(N.shadowRoot):N},f=function P(R){if(R!==!1&&R!==h(document)){if(!R||!R.focus){P(d());return}R.focus({preventScroll:!!a.preventScroll}),o.mostRecentlyFocusedNode=R,xvt(R)&&R.select()}},m=function(R){var N=u("setReturnFocus",R);return N||(N===!1?!1:R)},g=function(R){var N=R.target,M=R.event,A=R.isBackward,_=A===void 0?!1:A;N=N||lN(M),p();var x=null;if(o.tabbableGroups.length>0){var O=c(N,M),B=O>=0?o.containerGroups[O]:void 0;if(O<0)_?x=o.tabbableGroups[o.tabbableGroups.length-1].lastTabbableNode:x=o.tabbableGroups[0].firstTabbableNode;else if(_){var F=eie(o.tabbableGroups,function(Z){var Y=Z.firstTabbableNode;return N===Y});if(F<0&&(B.container===N||y2(N,a.tabbableOptions)&&!u0(N,a.tabbableOptions)&&!B.nextTabbableNode(N,!1))&&(F=O),F>=0){var G=F===0?o.tabbableGroups.length-1:F-1,H=o.tabbableGroups[G];x=db(N)>=0?H.lastTabbableNode:H.lastDomTabbableNode}else lD(M)||(x=B.nextTabbableNode(N,!1))}else{var $=eie(o.tabbableGroups,function(Z){var Y=Z.lastTabbableNode;return N===Y});if($<0&&(B.container===N||y2(N,a.tabbableOptions)&&!u0(N,a.tabbableOptions)&&!B.nextTabbableNode(N))&&($=O),$>=0){var q=$===o.tabbableGroups.length-1?0:$+1,z=o.tabbableGroups[q];x=db(N)>=0?z.firstTabbableNode:z.firstDomTabbableNode}else lD(M)||(x=B.nextTabbableNode(N))}}else x=u("fallbackFocus");return x},v=function(R){var N=lN(R);if(!(c(N,R)>=0)){if(g1(a.clickOutsideDeactivates,R)){s.deactivate({returnFocus:a.returnFocusOnDeactivate});return}g1(a.allowOutsideClick,R)||R.preventDefault()}},y=function(R){var N=lN(R),M=c(N,R)>=0;if(M||N instanceof Document)M&&(o.mostRecentlyFocusedNode=N);else{R.stopImmediatePropagation();var A,_=!0;if(o.mostRecentlyFocusedNode)if(db(o.mostRecentlyFocusedNode)>0){var x=c(o.mostRecentlyFocusedNode),O=o.containerGroups[x].tabbableNodes;if(O.length>0){var B=O.findIndex(function(F){return F===o.mostRecentlyFocusedNode});B>=0&&(a.isKeyForward(o.recentNavEvent)?B+1<O.length&&(A=O[B+1],_=!1):B-1>=0&&(A=O[B-1],_=!1))}}else o.containerGroups.some(function(F){return F.tabbableNodes.some(function(G){return db(G)>0})})||(_=!1);else _=!1;_&&(A=g({target:o.mostRecentlyFocusedNode,isBackward:a.isKeyBackward(o.recentNavEvent)})),f(A||o.mostRecentlyFocusedNode||d())}o.recentNavEvent=void 0},b=function(R){var N=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;o.recentNavEvent=R;var M=g({event:R,isBackward:N});M&&(lD(R)&&R.preventDefault(),f(M))},I=function(R){if(Ovt(R)&&g1(a.escapeDeactivates,R)!==!1){R.preventDefault(),s.deactivate();return}(a.isKeyForward(R)||a.isKeyBackward(R))&&b(R,a.isKeyBackward(R))},T=function(R){var N=lN(R);c(N,R)>=0||g1(a.clickOutsideDeactivates,R)||g1(a.allowOutsideClick,R)||(R.preventDefault(),R.stopImmediatePropagation())},w=function(){if(o.active)return Jte.activateTrap(r,s),o.delayInitialFocusTimer=a.delayInitialFocus?Qte(function(){f(d())}):f(d()),n.addEventListener("focusin",y,!0),n.addEventListener("mousedown",v,{capture:!0,passive:!1}),n.addEventListener("touchstart",v,{capture:!0,passive:!1}),n.addEventListener("click",T,{capture:!0,passive:!1}),n.addEventListener("keydown",I,{capture:!0,passive:!1}),s},S=function(){if(o.active)return n.removeEventListener("focusin",y,!0),n.removeEventListener("mousedown",v,!0),n.removeEventListener("touchstart",v,!0),n.removeEventListener("click",T,!0),n.removeEventListener("keydown",I,!0),s},D=function(R){var N=R.some(function(M){var A=Array.from(M.removedNodes);return A.some(function(_){return _===o.mostRecentlyFocusedNode})});N&&f(d())},E=typeof window<"u"&&"MutationObserver"in window?new MutationObserver(D):void 0,C=function(){E&&(E.disconnect(),o.active&&!o.paused&&o.containers.map(function(R){E.observe(R,{subtree:!0,childList:!0})}))};return s={get active(){return o.active},get paused(){return o.paused},activate:function(R){if(o.active)return this;var N=l(R,"onActivate"),M=l(R,"onPostActivate"),A=l(R,"checkCanFocusTrap");A||p(),o.active=!0,o.paused=!1,o.nodeFocusedBeforeActivation=n.activeElement,N==null||N();var _=function(){A&&p(),w(),C(),M==null||M()};return A?(A(o.containers.concat()).then(_,_),this):(_(),this)},deactivate:function(R){if(!o.active)return this;var N=Xte({onDeactivate:a.onDeactivate,onPostDeactivate:a.onPostDeactivate,checkCanReturnFocus:a.checkCanReturnFocus},R);clearTimeout(o.delayInitialFocusTimer),o.delayInitialFocusTimer=void 0,S(),o.active=!1,o.paused=!1,C(),Jte.deactivateTrap(r,s);var M=l(N,"onDeactivate"),A=l(N,"onPostDeactivate"),_=l(N,"checkCanReturnFocus"),x=l(N,"returnFocus","returnFocusOnDeactivate");M==null||M();var O=function(){Qte(function(){x&&f(m(o.nodeFocusedBeforeActivation)),A==null||A()})};return x&&_?(_(m(o.nodeFocusedBeforeActivation)).then(O,O),this):(O(),this)},pause:function(R){if(o.paused||!o.active)return this;var N=l(R,"onPause"),M=l(R,"onPostPause");return o.paused=!0,N==null||N(),S(),C(),M==null||M(),this},unpause:function(R){if(!o.paused||!o.active)return this;var N=l(R,"onUnpause"),M=l(R,"onPostUnpause");return o.paused=!1,N==null||N(),p(),w(),C(),M==null||M(),this},updateContainerElements:function(R){var N=[].concat(R).filter(Boolean);return o.containers=N.map(function(M){return typeof M=="string"?n.querySelector(M):M}),o.active&&p(),C(),this}},s.updateContainerElements(e),s};const Vvt=()=>{const t={selectorTrigger:"[data-drawer-trigger]",selectorTarget:"[data-drawer-target]",selectorClose:"[data-drawer-close]",leftAlignment:"drawer--left",visibleClass:"is-visible",activeClass:"is-active",speedClose:350,speedOpen:50},e={};let i=!1,n,r;const a=Qpe;let o;const s=I=>r=I,l=()=>{Nt(r)&&r()&&(r=void 0);const I=document.getElementById(a);I.classList.remove(t.visibleClass),document.documentElement.style.overflow="",setTimeout(function(){n?(I.classList.add(t.visibleClass),document.documentElement.style.overflow="hidden",Nt(n==null?void 0:n.callback)&&n.callback()):(I.classList.remove(t.activeClass),i=!1),n=!1,o==null||o.deactivate()},t.speedClose)},c=I=>{const T=document.getElementById(a);T.classList.contains(t.leftAlignment)||T.classList.add(t.leftAlignment),m(T,!1,I)},u=I=>{const T=document.getElementById(a);T.classList.remove(t.leftAlignment),m(T,!1,I)},d=I=>{const w=document.getElementById(a).querySelector(".drawer__title");w&&(w.innerHTML=I)},p=I=>{const w=document.getElementById(a).querySelector(".drawer__footer");w&&(as(w),Nt(I)?e.footer=I(w,l):w.innerHTML=I||"")},h=I=>{const w=document.getElementById(a).querySelector(".drawer__content");w&&(as(w),Nt(I)?e.content=I(w,l):w.innerHTML=I)},f=I=>{const w=document.getElementById(a).querySelector(".drawer__wrapper");w.style.width=I},m=(I,T,w)=>{i=!0,I.classList.add(t.activeClass),document.documentElement.style.overflow="hidden",T&&(o=$vt(I),o.activate()),Nt(w)&&w(),setTimeout(function(){I.classList.add(t.visibleClass)},t.speedOpen)},g=({title:I,content:T,side:w,width:S,footer:D,callback:E,onClose:C}={})=>{if(T&&h(T),C&&s(C),I&&d(I),S&&f(S),p(D),i)n={callback:E};else if(w){if(w===Qt)return u(E);if(w===ci)return c(E)}else{const P=document.getElementById(a);m(P,D,E)}},v=function(I,T){let w=T.parentNode;for(;w;){if(w===I)return!0;w=w.parentNode}return!1},y=function(I){const T=I.target,w=document.querySelector(".drawer__wrapper");(!v(w,T)||T.classList.contains("drawer__close"))&&l()},b=I=>{(I.key==="Escape"||I.keyCode===27)&&l()};return document.addEventListener("click",y,!1),document.addEventListener("keydown",b,!1),{settings:t,open:g,close:l,setTitle:d,setContent:h,setFooter:p,attributes:e}},tie=t=>/^(?=.*?[A-Z])(?=.*?[a-z])(?=.*?[0-9])(?=.*?[#?!@$%^&*-]).{8,12}$/.test(t);function jvt(t){let e;const i=s=>s===e.password.value,r=[{onInput:({inputs:s})=>{const l=document.getElementById("registerButton");l&&(i(s.passwordConfirm.value)&&tie(s.password.value)&&ta(2)(s.givenName.value)&&ta(2)(s.lastName.value)?l.removeAttribute("disabled"):l.setAttribute("disabled",""))},control:"passwordConfirm"}];cr({title:"Register",content:s=>e=Cr(s,[{error:"First name must be at least 2 characters long",iconLeft:"fa-regular fa-user",validator:ta(2),placeholder:"First name",autocomplete:"off",label:"First Name",field:"givenName"},{error:"Last name must be at least 2 characters long",validator:ta(2),placeholder:"Last name",autocomplete:"off",label:"Last name",field:"lastName"},{error:"Must contain upper/lower, number, and special character",placeholder:"minimum 8 characters",iconLeft:"fa-solid fa-lock",validator:tie,autocomplete:"off",label:"Password",field:"password",type:"password"},{placeholder:"minimum 8 characters",error:"Passwords do not match",iconLeft:"fa-solid fa-lock",label:"Re-enter Password",validator:i,field:"passwordConfirm",autocomplete:"off",type:"password"}],r),buttons:[{label:"Cancel",intent:"none",close:!0},{onClick:()=>{var f;const s=e.lastName.value,l=e.givenName.value,c=e.password.value,u=(f=t==null?void 0:t.data)==null?void 0:f.inviteKey,d=()=>{ti({message:"Success",intent:"is-success "})},p=m=>{ti({message:m==null?void 0:m.message,intent:"is-danger"})},h=m=>{var g;(m==null?void 0:m.status)===200&&((g=m==null?void 0:m.data)!=null&&g.success)?d():p(m==null?void 0:m.data)};rvt(l,s,c,u).then(h,p)},intent:"is-primary",id:"registerButton",label:"Register",disabled:!0,close:!0}],onClose:()=>Tt.router.navigate("/")})}function Gvt(){const{tournamentRecord:t}=at.getTournament();t&&(Tt.ee.emit(SUe,t.tournamentId),at.reset())}function iie(){WF(),Wgt(),h$e(),Gvt(),wUe()}function Ba(){}const Hvt=t=>t;function zvt(t,e){for(const i in e)t[i]=e[i];return t}function bCe(t){return t()}function nie(){return Object.create(null)}function Jc(t){t.forEach(bCe)}function An(t){return typeof t=="function"}function hc(t,e){return t!=t?e==e:t!==e||t&&typeof t=="object"||typeof t=="function"}function qvt(t){return Object.keys(t).length===0}function bK(t,...e){if(t==null){for(const n of e)n(void 0);return Ba}const i=t.subscribe(...e);return i.unsubscribe?()=>i.unsubscribe():i}function Ek(t){let e;return bK(t,i=>e=i)(),e}function ft(t,e,i){t.$$.on_destroy.push(bK(e,i))}function Wvt(t,e,i,n){if(t){const r=ICe(t,e,i,n);return t[0](r)}}function ICe(t,e,i,n){return t[1]&&n?zvt(i.ctx.slice(),t[1](n(e))):i.ctx}function Kvt(t,e,i,n){if(t[2]&&n){const r=t[2](n(i));if(e.dirty===void 0)return r;if(typeof r=="object"){const a=[],o=Math.max(e.dirty.length,r.length);for(let s=0;s<o;s+=1)a[s]=e.dirty[s]|r[s];return a}return e.dirty|r}return e.dirty}function Yvt(t,e,i,n,r,a){if(r){const o=ICe(e,i,n,a);t.p(o,r)}}function Zvt(t){if(t.ctx.length>32){const e=[],i=t.ctx.length/32;for(let n=0;n<i;n++)e[n]=-1;return e}return-1}function Qr(t,e,i){return t.set(i),e}function EI(t){return t&&An(t.destroy)?t.destroy:Ba}const Xvt=typeof window<"u"?window:typeof globalThis<"u"?globalThis:global;function sa(t,e){t.appendChild(e)}function Ar(t,e,i){t.insertBefore(e,i||null)}function Er(t){t.parentNode&&t.parentNode.removeChild(t)}function xw(t,e){for(let i=0;i<t.length;i+=1)t[i]&&t[i].d(e)}function Ur(t){return document.createElement(t)}function uM(t){return document.createTextNode(t)}function Sc(){return uM(" ")}function bm(){return uM("")}function dr(t,e,i,n){return t.addEventListener(e,i,n),()=>t.removeEventListener(e,i,n)}function Ck(t){return function(e){return e.stopPropagation(),t.call(this,e)}}function kt(t,e,i){i==null?t.removeAttribute(e):t.getAttribute(e)!==i&&t.setAttribute(e,i)}function Jvt(t){return Array.from(t.childNodes)}function wCe(t,e){e=""+e,t.data!==e&&(t.data=e)}function rie(t,e,i,n){i==null?t.style.removeProperty(e):t.style.setProperty(e,i,n?"important":"")}function hT(t,e){return new t(e)}let JE;function cD(t){JE=t}function BU(){if(!JE)throw new Error("Function called outside component initialization");return JE}function Qvt(t){BU().$$.before_update.push(t)}function eyt(t){BU().$$.on_mount.push(t)}function SCe(t){BU().$$.after_update.push(t)}function tyt(t,e){return BU().$$.context.set(t,e),e}function Yu(t){return BU().$$.context.get(t)}function SB(t,e){const i=t.$$.callbacks[e.type];i&&i.slice().forEach(n=>n.call(this,e))}const C0=[],Zf=[];let X0=[];const aie=[],TCe=Promise.resolve();let vH=!1;function UCe(){vH||(vH=!0,TCe.then(DCe))}function IK(){return UCe(),TCe}function yH(t){X0.push(t)}const b2=new Set;let d0=0;function DCe(){if(d0!==0)return;const t=JE;do{try{for(;d0<C0.length;){const e=C0[d0];d0++,cD(e),iyt(e.$$)}}catch(e){throw C0.length=0,d0=0,e}for(cD(null),C0.length=0,d0=0;Zf.length;)Zf.pop()();for(let e=0;e<X0.length;e+=1){const i=X0[e];b2.has(i)||(b2.add(i),i())}X0.length=0}while(C0.length);for(;aie.length;)aie.pop()();vH=!1,b2.clear(),cD(t)}function iyt(t){if(t.fragment!==null){t.update(),Jc(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(yH)}}function nyt(t){const e=[],i=[];X0.forEach(n=>t.indexOf(n)===-1?e.push(n):i.push(n)),i.forEach(n=>n()),X0=e}const uA=new Set;let bb;function Rc(){bb={r:0,c:[],p:bb}}function Mc(){bb.r||Jc(bb.c),bb=bb.p}function Fi(t,e){t&&t.i&&(uA.delete(t),t.i(e))}function In(t,e,i,n){if(t&&t.o){if(uA.has(t))return;uA.add(t),bb.c.push(()=>{uA.delete(t),n&&(i&&t.d(1),n())}),t.o(e)}else n&&n()}function dl(t){return(t==null?void 0:t.length)!==void 0?t:Array.from(t)}function ECe(t,e){In(t,1,1,()=>{e.delete(t.key)})}function CCe(t,e,i,n,r,a,o,s,l,c,u,d){let p=t.length,h=a.length,f=p;const m={};for(;f--;)m[t[f].key]=f;const g=[],v=new Map,y=new Map,b=[];for(f=h;f--;){const S=d(r,a,f),D=i(S);let E=o.get(D);E?n&&b.push(()=>E.p(S,e)):(E=c(D,S),E.c()),v.set(D,g[f]=E),D in m&&y.set(D,Math.abs(f-m[D]))}const I=new Set,T=new Set;function w(S){Fi(S,1),S.m(s,u),o.set(S.key,S),u=S.first,h--}for(;p&&h;){const S=g[h-1],D=t[p-1],E=S.key,C=D.key;S===D?(u=S.first,p--,h--):v.has(C)?!o.has(E)||I.has(E)?w(S):T.has(C)?p--:y.get(E)>y.get(C)?(T.add(E),w(S)):(I.add(C),p--):(l(D,o),p--)}for(;p--;){const S=t[p];v.has(S.key)||l(S,o)}for(;h;)w(g[h-1]);return Jc(b),g}function rs(t){t&&t.c()}function Vo(t,e,i){const{fragment:n,after_update:r}=t.$$;n&&n.m(e,i),yH(()=>{const a=t.$$.on_mount.map(bCe).filter(An);t.$$.on_destroy?t.$$.on_destroy.push(...a):Jc(a),t.$$.on_mount=[]}),r.forEach(yH)}function Uo(t,e){const i=t.$$;i.fragment!==null&&(nyt(i.after_update),Jc(i.on_destroy),i.fragment&&i.fragment.d(e),i.on_destroy=i.fragment=null,i.ctx=[])}function ryt(t,e){t.$$.dirty[0]===-1&&(C0.push(t),UCe(),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function Qc(t,e,i,n,r,a,o=null,s=[-1]){const l=JE;cD(t);const c=t.$$={fragment:null,ctx:[],props:a,update:Ba,not_equal:r,bound:nie(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(l?l.$$.context:[])),callbacks:nie(),dirty:s,skip_bound:!1,root:e.target||l.$$.root};o&&o(c.root);let u=!1;if(c.ctx=i?i(t,e.props||{},(d,p,...h)=>{const f=h.length?h[0]:p;return c.ctx&&r(c.ctx[d],c.ctx[d]=f)&&(!c.skip_bound&&c.bound[d]&&c.bound[d](f),u&&ryt(t,d)),p}):[],c.update(),u=!0,Jc(c.before_update),c.fragment=n?n(c.ctx):!1,e.target){if(e.hydrate){const d=Jvt(e.target);c.fragment&&c.fragment.l(d),d.forEach(Er)}else c.fragment&&c.fragment.c();e.intro&&Fi(t.$$.fragment),Vo(t,e.target,e.anchor),DCe()}cD(l)}class eu{constructor(){Je(this,"$$");Je(this,"$$set")}$destroy(){Uo(this,1),this.$destroy=Ba}$on(e,i){if(!An(i))return Ba;const n=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return n.push(i),()=>{const r=n.indexOf(i);r!==-1&&n.splice(r,1)}}$set(e){this.$$set&&!qvt(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}const p0=[];function PCe(t,e){return{subscribe:fs(t,e).subscribe}}function fs(t,e=Ba){let i;const n=new Set;function r(s){if(hc(t,s)&&(t=s,i)){const l=!p0.length;for(const c of n)c[1](),p0.push(c,t);if(l){for(let c=0;c<p0.length;c+=2)p0[c][0](p0[c+1]);p0.length=0}}}function a(s){r(s(t))}function o(s,l=Ba){const c=[s,l];return n.add(c),n.size===1&&(i=e(r,a)||Ba),s(t),()=>{n.delete(c),n.size===0&&i&&(i(),i=null)}}return{set:r,update:a,subscribe:o}}function Gh(t,e,i){const n=!Array.isArray(t),r=n?[t]:t;if(!r.every(Boolean))throw new Error("derived() expects stores as input, got a falsy value");const a=e.length<2;return PCe(i,(o,s)=>{let l=!1;const c=[];let u=0,d=Ba;const p=()=>{if(u)return;d();const f=e(n?c[0]:c,o,s);a?o(f):d=An(f)?f:Ba},h=r.map((f,m)=>bK(f,g=>{c[m]=g,u&=~(1<<m),l&&p()},()=>{u|=1<<m}));return l=!0,p(),function(){Jc(h),d(),l=!1}})}function Pk(t){return function(e){return e.key==="Enter"||e.key===" "&&!e.preventDefault()?t.call(this,e):void 0}}function $U(t,e){let i={update(n){typeof n=="string"?t.innerText=n:n!=null&&n.domNodes?t.replaceChildren(...n.domNodes):n!=null&&n.html&&(t.innerHTML=n.html)}};return i.update(e),i}function ayt(t,e){const i=n=>{t&&!t.contains(n.target)&&t.dispatchEvent(new CustomEvent(e+"outside",{detail:{jsEvent:n}}))};return document.addEventListener(e,i,!0),{destroy(){document.removeEventListener(e,i,!0)}}}const oyt=86400;function CI(t=void 0){return t!==void 0?t instanceof Date?sie(t):cyt(t):sie(new Date)}function pb(t){if(typeof t=="number")t={seconds:t};else if(typeof t=="string"){let i=0,n=2;for(let r of t.split(":",3))i+=parseInt(r,10)*Math.pow(60,n--);t={seconds:i}}else t instanceof Date&&(t={hours:t.getUTCHours(),minutes:t.getUTCMinutes(),seconds:t.getUTCSeconds()});let e=t.weeks||t.week||0;return{years:t.years||t.year||0,months:t.months||t.month||0,days:e*7+(t.days||t.day||0),seconds:(t.hours||t.hour||0)*60*60+(t.minutes||t.minute||0)*60+(t.seconds||t.second||0),inWeeks:!!e}}function Da(t){return new Date(t.getTime())}function Xp(t,e,i=1){t.setUTCFullYear(t.getUTCFullYear()+i*e.years);let n=t.getUTCMonth()+i*e.months;for(t.setUTCMonth(n),n%=12,n<0&&(n+=12);t.getUTCMonth()!==n;)fT(t);return t.setUTCDate(t.getUTCDate()+i*e.days),t.setUTCSeconds(t.getUTCSeconds()+i*e.seconds),t}function RCe(t,e,i=1){return Xp(t,e,-i)}function fy(t,e=1){return t.setUTCDate(t.getUTCDate()+e),t}function fT(t,e=1){return fy(t,-e)}function xv(t){return t.setUTCHours(0,0,0,0),t}function vu(t){return new Date(t.getUTCFullYear(),t.getUTCMonth(),t.getUTCDate(),t.getUTCHours(),t.getUTCMinutes(),t.getUTCSeconds())}function sp(t,e=19){return t.toISOString().substring(0,e)}function hf(t,...e){return e.every(i=>t.getTime()===i.getTime())}function syt(t,e){let i=e-t.getUTCDay();return t.setUTCDate(t.getUTCDate()+(i>=0?i:i+7)),t}function MCe(t,e){let i=e-t.getUTCDay();return t.setUTCDate(t.getUTCDate()+(i<=0?i:i-7)),t}function oie(t){return typeof t=="string"&&t.length<=10}function lyt(t,e){return t.setUTCHours(e.getUTCHours(),e.getUTCMinutes(),e.getUTCSeconds(),0),t}function sie(t){return new Date(Date.UTC(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours(),t.getMinutes(),t.getSeconds()))}function cyt(t){const e=t.match(/\d+/g);return new Date(Date.UTC(Number(e[0]),Number(e[1])-1,Number(e[2]),Number(e[3]||0),Number(e[4]||0),Number(e[5]||0)))}function wK(t,e,i){i.update(n=>n.set(e,t))}function lie(t){Jc(t),t.clear()}function NCe(t,e,i){e??(e=t),i.has(e)||i.set(e,setTimeout(()=>{i.delete(e),t()}))}function Ow(...t){return Object.assign(...t)}function Ev(t){return Object.keys(t)}function uyt(t){return Math.floor(t)}function N1(...t){return Math.min(...t)}function k0(...t){return Math.max(...t)}function dyt(){return Symbol("ec")}function ACe(t,e,i,n=[]){let r=document.createElement(t);r.className=e,typeof i=="string"?r.innerText=i:i.domNodes?r.replaceChildren(...i.domNodes):i.html&&(r.innerHTML=i.html);for(let a of n)r.setAttribute(...a);return r}function pyt(t){return t.scrollHeight>t.clientHeight}function Ov(t){return t.getBoundingClientRect()}function QE(t,e){for(;e--;)t=t.parentElement;return t}function cN(t){return Ov(t).height}let SK=dyt();function hyt(t,e){t[SK]=e}function fyt(t){return!!(t!=null&&t[SK])}function dA(t){return t[SK]}function uD(t,e,i=document){for(let n of i.elementsFromPoint(t,e)){if(fyt(n))return n;if(n.shadowRoot){let r=uD(t,e,n.shadowRoot);if(r)return r}}return null}function myt(t,e,i,n){return{type:t,title:e,currentStart:i.start,currentEnd:i.end,activeStart:n.start,activeEnd:n.end,calendar:void 0}}function td(t){return t=Ow({},t),t.currentStart=vu(t.currentStart),t.currentEnd=vu(t.currentEnd),t.activeStart=vu(t.activeStart),t.activeEnd=vu(t.activeEnd),t}function bH(t){return t.startsWith("list")}let gyt=1;function Rk(t){return t.map(e=>({id:"id"in e?String(e.id):`{generated-${gyt++}}`,resourceIds:Array.isArray(e.resourceIds)?e.resourceIds.map(String):"resourceId"in e?[String(e.resourceId)]:[],allDay:e.allDay??(oie(e.start)&&oie(e.end)),start:CI(e.start),end:CI(e.end),title:e.title||"",titleHTML:e.titleHTML||"",editable:e.editable,startEditable:e.startEditable,durationEditable:e.durationEditable,display:e.display||"auto",extendedProps:e.extendedProps||{},backgroundColor:e.backgroundColor||e.color,textColor:e.textColor}))}function vyt(t){return t.map(e=>({events:e.events,url:e.url&&e.url.trimEnd("&")||"",method:e.method&&e.method.toUpperCase()||"GET",extraParams:e.extraParams||{}}))}function IH(t,e,i){return{start:t.start>e?t.start:e,end:t.end<i?t.end:i,event:t}}function yyt(t){t.sort((e,i)=>e.start-i.start||i.event.allDay-e.event.allDay)}function byt(t,e,i,n,r,a){let o=r.formatRange(t.start,e&&t.event.display!=="pointer"?lyt(Da(t.start),t.end):t.start),s;if(i)s=An(i)?i({event:Kp(t.event),timeText:o,view:td(a)}):i;else{let l;switch(t.event.display){case"background":l=[];break;case"pointer":l=[cie(o,t,n)];break;default:l=[...t.event.allDay?[]:[cie(o,t,n)],ACe("h4",n.eventTitle,t.event.title)]}s={domNodes:l}}return[o,s]}function cie(t,e,i){return ACe("time",i.eventTime,t,[["datetime",sp(e.start)]])}function Iyt(t,e,i){return t?(An(t)&&(t=t({event:Kp(e),view:td(i)})),Array.isArray(t)?t:[t]):[]}function Kp(t){return _Ce(t,vu)}function uie(t){return _Ce(t,Da)}function _Ce(t,e){return t=Ow({},t),t.start=e(t.start),t.end=e(t.end),t}function die(t,e){let i={};if(t.length){yyt(t);let n;for(let r of t){let a=[],o=xv(Da(r.start));for(;r.end>o;){if(!e.includes(o.getUTCDay())&&(a.push(Da(o)),a.length>1)){let s=o.getTime();i[s]?i[s].chunks.push(r):i[s]={sorted:!1,chunks:[r]}}fy(o)}a.length?(r.date=a[0],r.days=a.length,r.dates=a,r.start<a[0]&&(r.start=a[0]),xv(Da(r.end))>a[a.length-1]&&(r.end=a[a.length-1])):(r.date=xv(Da(r.start)),r.days=1,r.dates=[r.date]),n&&hf(n.date,r.date)&&(r.prev=n),n=r}}return i}function wyt(t,e,i){var a,o;t.top=0,t.prev&&(t.top=t.prev.bottom+1),t.bottom=t.top+i;let n=1,r=t.date.getTime();if((a=e[r])!=null&&a.sorted||(o=e[r])!=null&&o.chunks.every(s=>"top"in s)){e[r].sorted||(e[r].chunks.sort((s,l)=>s.top-l.top),e[r].sorted=!0);for(let s of e[r].chunks)if(t.top<s.bottom&&t.bottom>s.top){let l=s.bottom-t.top+1;n+=l,t.top+=l,t.bottom+=l}}return n}function kCe(t,e){var i;t.length=e.length;for(let n of t)(i=n==null?void 0:n.reposition)==null||i.call(n)}function pie(t,e,i,n,r){return(t.start<i&&t.end>e||!r&&hf(t.start,t.end,e))&&(n===void 0||t.resourceIds.includes(n.id))}function mT(t){return Syt(t)||Tyt(t)||Uyt(t)}function TK(t){return t==="background"}function Syt(t){return t==="preview"}function Tyt(t){return t==="ghost"}function Uyt(t){return t==="pointer"}function Dyt(t){return Eyt(t,"month")}function Eyt(t,e){return{...t,next:"Next "+e,prev:"Previous "+e}}function Cyt(t){return e=>({...e,view:t})}function dD(t,e){return Gh([t,e],([i,n])=>{let r=An(n)?{format:n}:new Intl.DateTimeFormat(i,n);return{format:a=>r.format(vu(a))}})}function hie(t,e){return Gh([t,e],([i,n])=>{let r;if(An(n))r=n;else{let a=new Intl.DateTimeFormat(i,n);r=(o,s)=>{if(o<=s)return a.formatRange(o,s);{let l=a.formatRangeToParts(s,o),c="",u=["startRange","endRange"],d=[!1,!1];for(let p of l){let h=u.indexOf(p.source);h>=0?d[h]||(c+=Pyt(u[1-h],l),d[h]=!0):c+=p.value}return c}}}return{formatRange:(a,o)=>r(vu(a),vu(o))}})}function Pyt(t,e){let i="";for(let n of e)n.source==t&&(i+=n.value);return i}function Ryt(t){var i;let e={allDayContent:void 0,allDaySlot:!0,buttonText:{today:"today"},date:new Date,datesSet:void 0,dayHeaderFormat:{weekday:"short",month:"numeric",day:"numeric"},dayHeaderAriaLabelFormat:{dateStyle:"long"},displayEventEnd:!0,duration:{weeks:1},events:[],eventAllUpdated:void 0,eventBackgroundColor:void 0,eventTextColor:void 0,eventClassNames:void 0,eventClick:void 0,eventColor:void 0,eventContent:void 0,eventDidMount:void 0,eventMouseEnter:void 0,eventMouseLeave:void 0,eventSources:[],eventTimeFormat:{hour:"numeric",minute:"2-digit"},firstDay:0,flexibleSlotTimeLimits:!1,headerToolbar:{start:"title",center:"",end:"today prev,next"},height:void 0,hiddenDays:[],highlightedDates:[],lazyFetching:!0,loading:void 0,locale:void 0,nowIndicator:!1,selectable:!1,scrollTime:"06:00:00",slotDuration:"00:30:00",slotEventOverlap:!0,slotHeight:24,slotLabelFormat:{hour:"numeric",minute:"2-digit"},slotMaxTime:"24:00:00",slotMinTime:"00:00:00",theme:{allDay:"ec-all-day",active:"ec-active",bgEvent:"ec-bg-event",bgEvents:"ec-bg-events",body:"ec-body",button:"ec-button",buttonGroup:"ec-button-group",calendar:"ec",compact:"ec-compact",content:"ec-content",day:"ec-day",dayHead:"ec-day-head",days:"ec-days",event:"ec-event",eventBody:"ec-event-body",eventTime:"ec-event-time",eventTitle:"ec-event-title",events:"ec-events",extra:"ec-extra",handle:"ec-handle",header:"ec-header",hiddenScroll:"ec-hidden-scroll",highlight:"ec-highlight",icon:"ec-icon",line:"ec-line",lines:"ec-lines",nowIndicator:"ec-now-indicator",otherMonth:"ec-other-month",sidebar:"ec-sidebar",sidebarTitle:"ec-sidebar-title",today:"ec-today",time:"ec-time",title:"ec-title",toolbar:"ec-toolbar",view:"",weekdays:["ec-sun","ec-mon","ec-tue","ec-wed","ec-thu","ec-fri","ec-sat"],withScroll:"ec-with-scroll"},titleFormat:{year:"numeric",month:"short",day:"numeric"},view:void 0,viewDidMount:void 0,views:{}};for(let n of t)(i=n.createOptions)==null||i.call(n,e);return e}function Myt(t){var i;let e={date:n=>xv(CI(n)),duration:pb,events:Rk,eventSources:vyt,hiddenDays:n=>[...new Set(n)],highlightedDates:n=>n.map(CI),scrollTime:pb,slotDuration:pb,slotMaxTime:pb,slotMinTime:pb};for(let n of t)(i=n.createParsers)==null||i.call(n,e);return e}function Nyt(t,e){let i=[];for(let n of Ev(t))t[n]!==e[n]&&i.push([n,t[n]]);return Ow(e,t),i}function Ayt(t){return Gh(t.view,e=>e==null?void 0:e.startsWith("dayGrid"))}function _yt(t){return Gh([t._currentRange,t.firstDay,t.slotMaxTime,t._dayGrid],([e,i,n,r])=>{let a=Da(e.start),o=Da(e.end);if(r)MCe(a,i),syt(o,i);else if(n.days||n.seconds>oyt){Xp(fT(o),n);let s=fT(Da(o));s<a&&(a=s)}return{start:a,end:o}})}function kyt(t){return Gh([t.date,t.duration,t.firstDay,t._dayGrid],([e,i,n,r])=>{let a=Da(e),o;return r?a.setUTCDate(1):i.inWeeks&&MCe(a,n),o=Xp(Da(a),i),{start:a,end:o}})}function xyt(t){return Gh([t._activeRange,t.hiddenDays],([e,i])=>{let n=[],r=xv(Da(e.start)),a=xv(Da(e.end));for(;r<a;)i.includes(r.getUTCDay())||n.push(Da(r)),fy(r);return!n.length&&i.length&&i.length<7&&(t.date.update(o=>{for(;i.includes(o.getUTCDay());)fy(o);return o}),n=Ek(t._viewDates)),n})}function Oyt(t){return Gh([t.date,t._activeRange,t._intlTitle,t._dayGrid],([e,i,n,r])=>r?n.formatRange(e,e):n.formatRange(i.start,fT(Da(i.end))))}function Lyt(t){return Gh([t.view,t._viewTitle,t._currentRange,t._activeRange],e=>myt(...e))}function Fyt(t){let e=fs([]),i,n=0,r={};return Gh([t.events,t.eventSources,t._activeRange,t._fetchedRange,t.lazyFetching,t.loading],(a,o)=>wK(()=>{let[s,l,c,u,d,p]=a;if(!l.length){o(s);return}if(!u.start||u.start>c.start||u.end<c.end||!d){i&&i.abort(),i=new AbortController,An(p)&&!n&&p(!0);let h=()=>{--n===0&&An(p)&&p(!1)},f=[],m=b=>h(),g=b=>{f=f.concat(Rk(b)),o(f),h()},v=sp(c.start),y=sp(c.end);for(let b of l){if(An(b.events)){let I=b.events({start:vu(c.start),end:vu(c.end),startStr:v,endStr:y},g,m);I!==void 0&&Promise.resolve(I).then(g,m)}else{let I=An(b.extraParams)?b.extraParams():Ow({},b.extraParams);I.start=v,I.end=y,I=new URLSearchParams(I);let T=b.url,w={},S;["GET","HEAD"].includes(b.method)?T+=(T.includes("?")?"&":"?")+I:(w["content-type"]="application/x-www-form-urlencoded;charset=UTF-8",S=String(I)),fetch(T,{method:b.method,headers:w,body:S,signal:i.signal,credentials:"same-origin"}).then(D=>D.json()).then(g).catch(m)}++n}u.start=c.start,u.end=c.end}},r,t._queue),[]).subscribe(e.set),e}function Byt(){return PCe(CI(),t=>{let e=setInterval(()=>{t(CI())},1e3);return()=>clearInterval(e)})}function $yt(t){return Gh(t._now,e=>xv(Da(e)))}class Vyt{constructor(e,i){var o,s;e=e||[];let n=Ryt(e),r=Myt(e);n=wH(n,r),i=wH(i,r);for(let[l,c]of Object.entries(n))this[l]=fs(c);this._queue=fs(new Map),this._queue2=fs(new Map),this._tasks=new Map,this._auxiliary=fs([]),this._dayGrid=Ayt(this),this._currentRange=kyt(this),this._activeRange=_yt(this),this._fetchedRange=fs({start:void 0,end:void 0}),this._events=Fyt(this),this._now=Byt(),this._today=$yt(this),this._intlEventTime=hie(this.locale,this.eventTimeFormat),this._intlSlotLabel=dD(this.locale,this.slotLabelFormat),this._intlDayHeader=dD(this.locale,this.dayHeaderFormat),this._intlDayHeaderAL=dD(this.locale,this.dayHeaderAriaLabelFormat),this._intlTitle=hie(this.locale,this.titleFormat),this._bodyEl=fs(void 0),this._scrollable=fs(!1),this._viewTitle=Oyt(this),this._viewDates=xyt(this),this._view=Lyt(this),this._viewComponent=fs(void 0),this._resBgColor=fs(Ba),this._resTxtColor=fs(Ba),this._interaction=fs({}),this._iEvents=fs([null,null]),this._iClasses=fs(Hvt),this._iClass=fs(void 0),this._set=(l,c)=>{SH(l,this)&&(r[l]&&(c=r[l](c)),this[l].set(c))},this._get=l=>SH(l,this)?Ek(this[l]):void 0;for(let l of e)(o=l.createStores)==null||o.call(l,this);i.view&&this.view.set(i.view);let a=new Set([...Ev(n.views),...Ev(i.views??{})]);for(let l of a){let c=fie(n,n.views[l]??{}),u=fie(c,i,((s=i.views)==null?void 0:s[l])??{}),d=u.component;jyt(u,this);for(let p of Ev(u)){let{set:h,_set:f=h,...m}=this[p];this[p]={set:["buttonText","theme"].includes(p)?g=>{if(An(g)){let v=g(c[p]);u[p]=v,h(h===f?v:g)}else u[p]=g,h(g)}:g=>{u[p]=g,h(g)},_set:f,...m}}this.view.subscribe(p=>{if(p===l){this._viewComponent.set(d),An(u.viewDidMount)&&IK().then(()=>u.viewDidMount(Ek(this._view)));for(let h of Ev(u))this[h]._set(u[h])}})}}}function wH(t,e){let i={...t};for(let n of Ev(e))n in i&&(i[n]=e[n](i[n]));if(t.views){i.views={};for(let n of Ev(t.views))i.views[n]=wH(t.views[n],e)}return i}function fie(...t){let e={};for(let i of t){let n={};for(let r of["buttonText","theme"])An(i[r])&&(n[r]=i[r](e[r]));e={...e,...i,...n}}return e}function jyt(t,e){Ev(t).filter(i=>!SH(i,e)||i=="view").forEach(i=>delete t[i])}function SH(t,e){return e.hasOwnProperty(t)&&t[0]!=="_"}function mie(t,e,i){const n=t.slice();return n[23]=e[i],n}function Gyt(t){let e,i=t[5][t[23]]+"",n,r,a,o;function s(){return t[20](t[23])}return{c(){e=Ur("button"),n=uM(i),kt(e,"class",r=t[3].button+(t[6]===t[23]?" "+t[3].active:"")+" ec-"+t[23])},m(l,c){Ar(l,e,c),sa(e,n),a||(o=dr(e,"click",s),a=!0)},p(l,c){t=l,c&33&&i!==(i=t[5][t[23]]+"")&&wCe(n,i),c&73&&r!==(r=t[3].button+(t[6]===t[23]?" "+t[3].active:"")+" ec-"+t[23])&&kt(e,"class",r)},d(l){l&&Er(e),a=!1,o()}}}function Hyt(t){let e,i=t[5][t[23]]+"",n,r,a,o;return{c(){e=Ur("button"),n=uM(i),kt(e,"class",r=t[3].button+" ec-"+t[23]),e.disabled=t[1]},m(s,l){Ar(s,e,l),sa(e,n),a||(o=dr(e,"click",t[19]),a=!0)},p(s,l){l&33&&i!==(i=s[5][s[23]]+"")&&wCe(n,i),l&9&&r!==(r=s[3].button+" ec-"+s[23])&&kt(e,"class",r),l&2&&(e.disabled=s[1])},d(s){s&&Er(e),a=!1,o()}}}function zyt(t){let e,i,n,r,a,o,s,l;return{c(){e=Ur("button"),i=Ur("i"),kt(i,"class",n=t[3].icon+" ec-"+t[23]),kt(e,"class",r=t[3].button+" ec-"+t[23]),kt(e,"aria-label",a=t[5].next),kt(e,"title",o=t[5].next)},m(c,u){Ar(c,e,u),sa(e,i),s||(l=dr(e,"click",t[17]),s=!0)},p(c,u){u&9&&n!==(n=c[3].icon+" ec-"+c[23])&&kt(i,"class",n),u&9&&r!==(r=c[3].button+" ec-"+c[23])&&kt(e,"class",r),u&32&&a!==(a=c[5].next)&&kt(e,"aria-label",a),u&32&&o!==(o=c[5].next)&&kt(e,"title",o)},d(c){c&&Er(e),s=!1,l()}}}function qyt(t){let e,i,n,r,a,o,s,l;return{c(){e=Ur("button"),i=Ur("i"),kt(i,"class",n=t[3].icon+" ec-"+t[23]),kt(e,"class",r=t[3].button+" ec-"+t[23]),kt(e,"aria-label",a=t[5].prev),kt(e,"title",o=t[5].prev)},m(c,u){Ar(c,e,u),sa(e,i),s||(l=dr(e,"click",t[16]),s=!0)},p(c,u){u&9&&n!==(n=c[3].icon+" ec-"+c[23])&&kt(i,"class",n),u&9&&r!==(r=c[3].button+" ec-"+c[23])&&kt(e,"class",r),u&32&&a!==(a=c[5].prev)&&kt(e,"aria-label",a),u&32&&o!==(o=c[5].prev)&&kt(e,"title",o)},d(c){c&&Er(e),s=!1,l()}}}function Wyt(t){let e,i,n,r,a;return{c(){e=Ur("h2"),kt(e,"class",i=t[3].title)},m(o,s){Ar(o,e,s),r||(a=EI(n=$U.call(null,e,t[4])),r=!0)},p(o,s){s&8&&i!==(i=o[3].title)&&kt(e,"class",i),n&&An(n.update)&&s&16&&n.update.call(null,o[4])},d(o){o&&Er(e),r=!1,a()}}}function gie(t){let e;function i(a,o){if(a[23]=="title")return Wyt;if(a[23]=="prev")return qyt;if(a[23]=="next")return zyt;if(a[23]=="today")return Hyt;if(a[23]!="")return Gyt}let n=i(t),r=n&&n(t);return{c(){r&&r.c(),e=bm()},m(a,o){r&&r.m(a,o),Ar(a,e,o)},p(a,o){n===(n=i(a))&&r?r.p(a,o):(r&&r.d(1),r=n&&n(a),r&&(r.c(),r.m(e.parentNode,e)))},d(a){a&&Er(e),r&&r.d(a)}}}function Kyt(t){let e,i=dl(t[0]),n=[];for(let r=0;r<i.length;r+=1)n[r]=gie(mie(t,i,r));return{c(){for(let r=0;r<n.length;r+=1)n[r].c();e=bm()},m(r,a){for(let o=0;o<n.length;o+=1)n[o]&&n[o].m(r,a);Ar(r,e,a)},p(r,[a]){if(a&229503){i=dl(r[0]);let o;for(o=0;o<i.length;o+=1){const s=mie(r,i,o);n[o]?n[o].p(s,a):(n[o]=gie(s),n[o].c(),n[o].m(e.parentNode,e))}for(;o<n.length;o+=1)n[o].d(1);n.length=i.length}},i:Ba,o:Ba,d(r){r&&Er(e),xw(n,r)}}}function Yyt(t,e,i){let n,r,a,o,s,l,c,u,{buttons:d}=e,{_currentRange:p,_viewTitle:h,buttonText:f,date:m,duration:g,hiddenDays:v,theme:y,view:b}=Yu("state");ft(t,p,C=>i(18,o=C)),ft(t,h,C=>i(4,l=C)),ft(t,f,C=>i(5,c=C)),ft(t,m,C=>i(2,r=C)),ft(t,g,C=>i(21,n=C)),ft(t,v,C=>i(22,a=C)),ft(t,y,C=>i(3,s=C)),ft(t,b,C=>i(6,u=C));let I=xv(CI()),T;function w(){let C=RCe(r,n);if(a.length&&a.length<7)for(;a.includes(C.getUTCDay());)fT(C);Qr(m,r=C,r)}function S(){Qr(m,r=Xp(r,n),r)}const D=()=>Qr(m,r=Da(I),r),E=C=>Qr(b,u=C,u);return t.$$set=C=>{"buttons"in C&&i(0,d=C.buttons)},t.$$.update=()=>{t.$$.dirty&262144&&i(1,T=I>=o.start&&I<o.end||null)},[d,T,r,s,l,c,u,p,h,f,m,g,v,y,b,I,w,S,o,D,E]}class xCe extends eu{constructor(e){super(),Qc(this,e,Yyt,Kyt,hc,{buttons:0})}}function vie(t,e,i){const n=t.slice();return n[5]=e[i],n}function yie(t,e,i){const n=t.slice();return n[8]=e[i],n}function Zyt(t){let e,i;return e=new xCe({props:{buttons:t[8]}}),{c(){rs(e.$$.fragment)},m(n,r){Vo(e,n,r),i=!0},p(n,r){const a={};r&1&&(a.buttons=n[8]),e.$set(a)},i(n){i||(Fi(e.$$.fragment,n),i=!0)},o(n){In(e.$$.fragment,n),i=!1},d(n){Uo(e,n)}}}function Xyt(t){let e,i,n,r;return i=new xCe({props:{buttons:t[8]}}),{c(){e=Ur("div"),rs(i.$$.fragment),kt(e,"class",n=t[1].buttonGroup)},m(a,o){Ar(a,e,o),Vo(i,e,null),r=!0},p(a,o){const s={};o&1&&(s.buttons=a[8]),i.$set(s),(!r||o&2&&n!==(n=a[1].buttonGroup))&&kt(e,"class",n)},i(a){r||(Fi(i.$$.fragment,a),r=!0)},o(a){In(i.$$.fragment,a),r=!1},d(a){a&&Er(e),Uo(i)}}}function bie(t){let e,i,n,r;const a=[Xyt,Zyt],o=[];function s(l,c){return l[8].length>1?0:1}return e=s(t),i=o[e]=a[e](t),{c(){i.c(),n=bm()},m(l,c){o[e].m(l,c),Ar(l,n,c),r=!0},p(l,c){let u=e;e=s(l),e===u?o[e].p(l,c):(Rc(),In(o[u],1,1,()=>{o[u]=null}),Mc(),i=o[e],i?i.p(l,c):(i=o[e]=a[e](l),i.c()),Fi(i,1),i.m(n.parentNode,n))},i(l){r||(Fi(i),r=!0)},o(l){In(i),r=!1},d(l){l&&Er(n),o[e].d(l)}}}function Iie(t){let e,i,n,r=dl(t[0][t[5]]),a=[];for(let s=0;s<r.length;s+=1)a[s]=bie(yie(t,r,s));const o=s=>In(a[s],1,1,()=>{a[s]=null});return{c(){e=Ur("div");for(let s=0;s<a.length;s+=1)a[s].c();i=Sc()},m(s,l){Ar(s,e,l);for(let c=0;c<a.length;c+=1)a[c]&&a[c].m(e,null);sa(e,i),n=!0},p(s,l){if(l&3){r=dl(s[0][s[5]]);let c;for(c=0;c<r.length;c+=1){const u=yie(s,r,c);a[c]?(a[c].p(u,l),Fi(a[c],1)):(a[c]=bie(u),a[c].c(),Fi(a[c],1),a[c].m(e,i))}for(Rc(),c=r.length;c<a.length;c+=1)o(c);Mc()}},i(s){if(!n){for(let l=0;l<r.length;l+=1)Fi(a[l]);n=!0}},o(s){a=a.filter(Boolean);for(let l=0;l<a.length;l+=1)In(a[l]);n=!1},d(s){s&&Er(e),xw(a,s)}}}function Jyt(t){let e,i,n,r=dl(Object.keys(t[0])),a=[];for(let s=0;s<r.length;s+=1)a[s]=Iie(vie(t,r,s));const o=s=>In(a[s],1,1,()=>{a[s]=null});return{c(){e=Ur("nav");for(let s=0;s<a.length;s+=1)a[s].c();kt(e,"class",i=t[1].toolbar)},m(s,l){Ar(s,e,l);for(let c=0;c<a.length;c+=1)a[c]&&a[c].m(e,null);n=!0},p(s,[l]){if(l&3){r=dl(Object.keys(s[0]));let c;for(c=0;c<r.length;c+=1){const u=vie(s,r,c);a[c]?(a[c].p(u,l),Fi(a[c],1)):(a[c]=Iie(u),a[c].c(),Fi(a[c],1),a[c].m(e,null))}for(Rc(),c=r.length;c<a.length;c+=1)o(c);Mc()}(!n||l&2&&i!==(i=s[1].toolbar))&&kt(e,"class",i)},i(s){if(!n){for(let l=0;l<r.length;l+=1)Fi(a[l]);n=!0}},o(s){a=a.filter(Boolean);for(let l=0;l<a.length;l+=1)In(a[l]);n=!1},d(s){s&&Er(e),xw(a,s)}}}function Qyt(t,e,i){let n,r,{headerToolbar:a,theme:o}=Yu("state");ft(t,a,l=>i(4,n=l)),ft(t,o,l=>i(1,r=l));let s={start:[],center:[],end:[]};return t.$$.update=()=>{if(t.$$.dirty&17)for(let l of Object.keys(s))i(0,s[l]=n[l].split(" ").map(c=>c.split(",")),s)},[s,r,a,o,n]}class ebt extends eu{constructor(e){super(),Qc(this,e,Qyt,Jyt,hc,{})}}function wie(t,e,i){const n=t.slice();return n[11]=e[i],n}function Sie(t){let e,i,n;var r=t[11];function a(o,s){return{}}return r&&(e=hT(r,a())),{c(){e&&rs(e.$$.fragment),i=bm()},m(o,s){e&&Vo(e,o,s),Ar(o,i,s),n=!0},p(o,s){if(s&1&&r!==(r=o[11])){if(e){Rc();const l=e;In(l.$$.fragment,1,0,()=>{Uo(l,1)}),Mc()}r?(e=hT(r,a()),rs(e.$$.fragment),Fi(e.$$.fragment,1),Vo(e,i.parentNode,i)):e=null}},i(o){n||(e&&Fi(e.$$.fragment,o),n=!0)},o(o){e&&In(e.$$.fragment,o),n=!1},d(o){o&&Er(i),e&&Uo(e,o)}}}function tbt(t){let e,i,n=dl(t[0]),r=[];for(let o=0;o<n.length;o+=1)r[o]=Sie(wie(t,n,o));const a=o=>In(r[o],1,1,()=>{r[o]=null});return{c(){for(let o=0;o<r.length;o+=1)r[o].c();e=bm()},m(o,s){for(let l=0;l<r.length;l+=1)r[l]&&r[l].m(o,s);Ar(o,e,s),i=!0},p(o,[s]){if(s&1){n=dl(o[0]);let l;for(l=0;l<n.length;l+=1){const c=wie(o,n,l);r[l]?(r[l].p(c,s),Fi(r[l],1)):(r[l]=Sie(c),r[l].c(),Fi(r[l],1),r[l].m(e.parentNode,e))}for(Rc(),l=n.length;l<r.length;l+=1)a(l);Mc()}},i(o){if(!i){for(let s=0;s<n.length;s+=1)Fi(r[s]);i=!0}},o(o){r=r.filter(Boolean);for(let s=0;s<r.length;s+=1)In(r[s]);i=!1},d(o){o&&Er(e),xw(r,o)}}}function ibt(t,e,i){let n,r,a,o,{datesSet:s,_auxiliary:l,_activeRange:c,_queue:u,_view:d}=Yu("state");ft(t,s,f=>i(7,r=f)),ft(t,l,f=>i(0,o=f)),ft(t,c,f=>i(5,a=f)),ft(t,d,f=>i(6,n=f));let p={};function h(f){An(r)&&wK(()=>r({start:vu(f.start),end:vu(f.end),startStr:sp(f.start),endStr:sp(f.end),view:td(n)}),p,u)}return t.$$.update=()=>{t.$$.dirty&32&&h(a)},[o,s,l,c,d,a]}let nbt=class extends eu{constructor(e){super(),Qc(this,e,ibt,tbt,hc,{})}};function rbt(t){let e,i,n,r,a,o,s,l,c,u,d;i=new ebt({});var p=t[5];function h(f,m){return{}}return p&&(r=hT(p,h())),l=new nbt({}),{c(){e=Ur("div"),rs(i.$$.fragment),n=Sc(),r&&rs(r.$$.fragment),s=Sc(),rs(l.$$.fragment),kt(e,"class",a=t[1].calendar+" "+t[1].view+(t[0]?" "+t[1].withScroll:"")+(t[2]?" "+t[1][t[2]]:"")),kt(e,"role",o=bH(t[4])?"list":"table"),rie(e,"height",t[3])},m(f,m){Ar(f,e,m),Vo(i,e,null),sa(e,n),r&&Vo(r,e,null),Ar(f,s,m),Vo(l,f,m),c=!0,u||(d=dr(window,"resize",t[17]),u=!0)},p(f,m){if(m[0]&32&&p!==(p=f[5])){if(r){Rc();const g=r;In(g.$$.fragment,1,0,()=>{Uo(g,1)}),Mc()}p?(r=hT(p,h()),rs(r.$$.fragment),Fi(r.$$.fragment,1),Vo(r,e,null)):r=null}(!c||m[0]&7&&a!==(a=f[1].calendar+" "+f[1].view+(f[0]?" "+f[1].withScroll:"")+(f[2]?" "+f[1][f[2]]:"")))&&kt(e,"class",a),(!c||m[0]&16&&o!==(o=bH(f[4])?"list":"table"))&&kt(e,"role",o),m[0]&8&&rie(e,"height",f[3])},i(f){c||(Fi(i.$$.fragment,f),r&&Fi(r.$$.fragment,f),Fi(l.$$.fragment,f),c=!0)},o(f){In(i.$$.fragment,f),r&&In(r.$$.fragment,f),In(l.$$.fragment,f),c=!1},d(f){f&&(Er(e),Er(s)),Uo(i),r&&Uo(r),Uo(l,f),u=!1,d()}}}function abt(t,e,i){let n,r,a,o,s,l,c,u,d,p,h,{plugins:f=[]}=e,{options:m={}}=e,g=BU(),v=new Vyt(f,m);tyt("state",v);let{_viewComponent:y,_bodyEl:b,_interaction:I,_iClass:T,_events:w,_queue:S,_queue2:D,_tasks:E,_scrollable:C,height:P,theme:R,view:N}=v;ft(t,y,Q=>i(5,h=Q)),ft(t,b,Q=>i(32,n=Q)),ft(t,I,Q=>i(35,s=Q)),ft(t,T,Q=>i(2,u=Q)),ft(t,w,Q=>i(36,l=Q)),ft(t,S,Q=>i(34,o=Q)),ft(t,D,Q=>i(33,a=Q)),ft(t,C,Q=>i(0,r=Q)),ft(t,P,Q=>i(3,d=Q)),ft(t,R,Q=>i(1,c=Q)),ft(t,N,Q=>i(4,p=Q));let M={...m};function A(Q,X){return v._set(Q,X),this}function _(Q){let X=v._get(Q);return X instanceof Date?vu(X):X}function x(){return v._fetchedRange.set({start:void 0,end:void 0}),this}function O(){return l.map(Kp)}function B(Q){for(let X of l)if(X.id==Q)return Kp(X);return null}function F(Q){return l.push(Rk([Q])[0]),w.set(l),this}function G(Q){for(let X of l)if(X.id==Q.id){Ow(X,Rk([Q])[0]),w.set(l);break}return this}function H(Q){let X=l.findIndex(oe=>oe.id==Q);return X>=0&&(l.splice(X,1),w.set(l)),this}function $(){return td(Ek(v._view))}function q(){return s.action&&s.action.unselect(),this}function z(Q,X){let oe=uD(Q,X);return oe?dA(oe)(X):null}function Z(){Uo(g,!0)}Qvt(()=>{lie(o)}),SCe(()=>{lie(a),NCe(Y,null,E)});function Y(){n&&Qr(C,r=pyt(n),r)}return t.$$set=Q=>{"plugins"in Q&&i(18,f=Q.plugins),"options"in Q&&i(19,m=Q.options)},t.$$.update=()=>{if(t.$$.dirty[0]&524288)for(let[Q,X]of Nyt(m,M))A(Q,X)},[r,c,u,d,p,h,y,b,I,T,w,S,D,C,P,R,N,Y,f,m,A,_,x,O,B,F,G,H,$,q,z,Z]}class obt extends eu{constructor(e){super(),Qc(this,e,abt,rbt,hc,{plugins:18,options:19,setOption:20,getOption:21,refetchEvents:22,getEvents:23,getEventById:24,addEvent:25,updateEvent:26,removeEventById:27,getView:28,unselect:29,dateFromPoint:30,destroy:31},null,[-1,-1])}get setOption(){return this.$$.ctx[20]}get getOption(){return this.$$.ctx[21]}get refetchEvents(){return this.$$.ctx[22]}get getEvents(){return this.$$.ctx[23]}get getEventById(){return this.$$.ctx[24]}get addEvent(){return this.$$.ctx[25]}get updateEvent(){return this.$$.ctx[26]}get removeEventById(){return this.$$.ctx[27]}get getView(){return this.$$.ctx[28]}get unselect(){return this.$$.ctx[29]}get dateFromPoint(){return this.$$.ctx[30]}get destroy(){return this.$$.ctx[31]}}let I2=!1;function sbt(t){I2||(I2=!0,window.requestAnimationFrame(()=>{t(),I2=!1}))}function Tie(t,e,i){return k0(e,N1(i,t))}const{window:av}=Xvt;function lbt(t){let e,i;return{c:Ba,m(n,r){e||(i=[dr(av,"pointermove",t[31]),dr(av,"pointerup",t[32]),dr(av,"pointercancel",t[32]),dr(av,"scroll",t[0]),dr(av,"selectstart",pA(t[33])),dr(av,"contextmenu",function(){An(pA(t[41]))&&pA(t[41]).apply(this,arguments)}),dr(av,"touchstart",t[34]),dr(av,"touchmove",t[40],{passive:!1})],e=!0)},p(n,r){t=n},i:Ba,o:Ba,d(n){e=!1,Jc(i)}}}const Uie=1,Die=2,Eie=3,w2=4,uN=5;function Cie(t){return t.isPrimary&&(t.pointerType!=="mouse"||t.buttons&1)}function pA(t){return e=>{t()&&e.preventDefault()}}function cbt(t,e,i){let n,r,a,o,s,l,c,u,d,p,h,f,m,g,v,y,b,I,T,w,S,D,E,C,P,R,N,M,A,{_iEvents:_,_iClass:x,_events:O,_view:B,_dayGrid:F,_draggable:G,dateClick:H,dragScroll:$,datesAboveResources:q,eventDragMinDistance:z,eventDragStart:Z,eventDragStop:Y,eventDrop:Q,eventLongPressDelay:X,eventResizeStart:oe,eventResizeStop:re,eventResize:me,longPressDelay:se,selectable:te,select:he,selectBackgroundColor:ae,selectLongPressDelay:de,selectMinDistance:Ie,slotDuration:De,slotHeight:Te,unselect:_e,unselectAuto:Ve,unselectCancel:ot,view:St}=Yu("state");ft(t,_,mt=>i(69,o=mt)),ft(t,x,mt=>i(72,c=mt)),ft(t,O,mt=>i(68,a=mt)),ft(t,B,mt=>i(66,n=mt)),ft(t,F,mt=>i(71,l=mt)),ft(t,G,mt=>i(94,A=mt)),ft(t,H,mt=>i(73,u=mt)),ft(t,$,mt=>i(82,b=mt)),ft(t,q,mt=>i(90,P=mt)),ft(t,z,mt=>i(85,w=mt)),ft(t,Z,mt=>i(83,I=mt)),ft(t,Y,mt=>i(76,h=mt)),ft(t,Q,mt=>i(74,d=mt)),ft(t,X,mt=>i(88,E=mt)),ft(t,oe,mt=>i(84,T=mt)),ft(t,re,mt=>i(77,f=mt)),ft(t,me,mt=>i(75,p=mt)),ft(t,se,mt=>i(87,D=mt)),ft(t,te,mt=>i(93,M=mt)),ft(t,he,mt=>i(78,m=mt)),ft(t,ae,mt=>i(70,s=mt)),ft(t,de,mt=>i(89,C=mt)),ft(t,Ie,mt=>i(86,S=mt)),ft(t,De,mt=>i(91,R=mt)),ft(t,Te,mt=>i(81,y=mt)),ft(t,_e,mt=>i(67,r=mt)),ft(t,Ve,mt=>i(80,v=mt)),ft(t,ot,mt=>i(79,g=mt)),ft(t,St,mt=>i(92,N=mt));let nt,Bt,Pe,et,Ee,lt,Ke,bt,gt,Ue,xe,We,st,vt,ge,Se,qe,$e,ke,Ut,pt,tt,At,ei,vi;function Ln(mt,hi,Nn,xr){nt||(nt=Cie(hi)?Nn?Die:A(mt)?Uie:uN:uN,za()&&(Pe=mt,kr(hi),xr&&(Ee=xr),ke=Nn?$e?"resizingX":"resizingY":"dragging",Nn&&(Ut=Da(Pe.start),$e?(Ut.setUTCHours(Pe.end.getUTCHours(),Pe.end.getUTCMinutes(),Pe.end.getUTCSeconds(),0),Ut<Pe.start&&fy(Ut)):Xp(Ut,R)),Kn(hi)))}function gn(mt){nt||(nt=Cie(mt)?M&&!bH(N)?Eie:w2:uN,za()&&(kr(mt),ke="selecting",pt=$e?pb({day:1}):R,Pe={allDay:$e,start:Ee,end:Xp(Da(Ee),pt),resourceIds:Ke?[Ke.id]:[]},Kn(mt)))}function Jt(){nt||(nt=uN)}function kr(mt){window.getSelection().removeAllRanges(),gt=xe=mt.clientX,Ue=We=mt.clientY;let hi=uD(xe,We);({allDay:$e,date:Ee,resource:Ke}=dA(hi)(We)),st=QE(hi,Ke?4:3),ge=QE(hi,Ke&&(Zo()||P)?2:1),ra(),mt.pointerType!=="mouse"&&i(1,ei=setTimeout(()=>{nt&&(Bt=!0,Kn(mt))},(Qi()?C:E)??D))}function Kn(mt){if(Bt||mt&&mt.pointerType==="mouse"&&tu()>=(Qi()?S:w)){Bt=!0,Pr(mt),Qr(x,c=ke,c),o[0]||(Qi()?aa():vo(mt,Xs()?T:I));let hi=na();if(hi){let Nn;({allDay:Nn,date:lt,resource:bt}=dA(hi)(We)),Nn===$e&&(qe=pb((lt-Ee)/1e3),Qr(_,o[0].end=Xp(Da(Pe.end),qe),o),Xs()?o[0].end<Ut&&Qr(_,o[0].end=Ut,o):Qi()?o[0].end<Pe.end?(Qr(_,o[0].start=RCe(o[0].end,pt),o),Qr(_,o[0].end=Pe.end,o)):Qr(_,o[0].start=Pe.start,o):(Qr(_,o[0].start=Xp(Da(Pe.start),qe),o),Ke&&(Qr(_,o[0].resourceIds=Pe.resourceIds.filter(xr=>xr!==Ke.id),o),o[0].resourceIds.push(bt.id))))}}if(b){let hi=y*2;sbt(()=>{st&&(We<hi&&window.scrollBy(0,k0(-10,(We-hi)/3)),We<vt.top+hi&&(st.scrollTop+=k0(-10,(We-vt.top-hi)/3)),We>window.innerHeight-hi&&window.scrollBy(0,N1(10,(We-window.innerHeight+hi)/3)),We>vt.bottom-hi&&(st.scrollTop+=N1(10,(We-vt.bottom+hi)/3)))})}}function Gt(){za()&&(ra(),Kn())}function Ji(mt){za()&&mt.isPrimary&&(xe=mt.clientX,We=mt.clientY,Kn(mt))}function xo(mt){if(tt&&v&&!(g&&mt.target.closest(g))&&Pr(mt),nt&&mt.isPrimary){if(Bt)if(Qi()){if(tt=!0,An(m)){let{start:hi,end:Nn}=Kp(o[0]);m({start:hi,end:Nn,startStr:sp(o[0].start),endStr:sp(o[0].end),allDay:$e,jsEvent:mt,view:td(n),resource:Ke})}}else{Pe.display=et;let hi=Xs()?f:h;An(hi)&&hi({event:Kp(Pe),jsEvent:mt,view:td(n)});let Nn=uie(Pe);if(Ma(Pe,o[0]),fr(),hi=Xs()?p:d,An(hi)){let xr=Pe,cs;Xs()?cs={endDelta:qe}:cs={delta:qe,oldResource:Ke!==bt?Ke:void 0,newResource:Ke!==bt?bt:void 0},hi(Ow(cs,{event:Kp(Pe),oldEvent:Kp(Nn),jsEvent:mt,view:td(n),revert(){Ma(xr,Nn)}}))}}else if((Os()||Qi())&&An(u)&&!At){xe=mt.clientX,We=mt.clientY;let hi=uD(xe,We);if(hi){let{allDay:Nn,date:xr,resource:cs}=dA(hi)(We);u({allDay:Nn,date:vu(xr),dateStr:sp(xr),dayEl:hi,jsEvent:mt,view:td(n),resource:cs})}}Bt=!1,nt=gt=Ue=xe=We=Pe=et=Ee=lt=Ke=bt=qe=$e=Qr(x,c=Ut=pt=void 0,c),st=ge=vt=Se=void 0,ei&&(clearTimeout(ei),i(1,ei=void 0))}At=!1}function na(){return uD(Tie(xe,vi[0],vi[1]),Tie(We,vi[2],vi[3]))}function ra(){vt=Ov(st),Se=Ov(ge),vi=[k0(0,Se.left+(l?0:8)),N1(document.documentElement.clientWidth,Se.right)-2,k0(0,vt.top),N1(document.documentElement.clientHeight,vt.bottom)-2]}function vo(mt,hi){An(hi)&&hi({event:Kp(Pe),jsEvent:mt,view:td(n)}),et=Pe.display,Pe.display="preview",Qr(_,o[0]=uie(Pe),o),Pe.display="ghost",O.set(a)}function aa(){Qr(_,o[0]={id:"{select}",allDay:Pe.allDay,start:Pe.start,title:"",display:"preview",extendedProps:{},backgroundColor:s,resourceIds:Pe.resourceIds},o)}function fr(){Qr(_,o[0]=null,o)}function Ma(mt,hi){mt.start=hi.start,mt.end=hi.end,mt.resourceIds=hi.resourceIds,O.set(a)}function tu(){return Math.sqrt(Math.pow(xe-gt,2)+Math.pow(We-Ue,2))}function Zo(){return nt===Uie}function Xs(){return nt===Die}function Os(){return nt===w2}function Qi(){return nt===Eie}function za(){return nt&&nt<w2}function Pr(mt){tt&&(tt=!1,fr(),An(r)&&r({jsEvent:mt,view:td(n)}))}function Vi(){At=!0}B.subscribe(Pr);function Ls(mt){if(za()){let hi=mt.target,Nn=[],xr=()=>Jc(Nn);Nn.push(dr(hi,"touchmove",pA(()=>Bt))),Nn.push(dr(hi,"touchend",xr)),Nn.push(dr(hi,"touchcancel",xr))}}function hl(mt){SB.call(this,t,mt)}return[Gt,ei,_,x,O,B,F,G,H,$,q,z,Z,Y,Q,X,oe,re,me,se,te,he,ae,de,Ie,De,Te,_e,Ve,ot,St,Ji,xo,za,Ls,Ln,gn,Jt,Pr,Vi,hl,()=>ei]}class ubt extends eu{constructor(e){super(),Qc(this,e,cbt,lbt,hc,{drag:35,select:36,noAction:37,handleScroll:0,unselect:38,noClick:39},null,[-1,-1,-1,-1])}get drag(){return this.$$.ctx[35]}get select(){return this.$$.ctx[36]}get noAction(){return this.$$.ctx[37]}get handleScroll(){return this.$$.ctx[0]}get unselect(){return this.$$.ctx[38]}get noClick(){return this.$$.ctx[39]}}function dbt(t){let e,i;return{c:Ba,m(n,r){e||(i=[dr(window,"pointermove",t[5]),dr(window,"scroll",t[0])],e=!0)},p:Ba,i:Ba,o:Ba,d(n){e=!1,Jc(i)}}}function dN(t){return t.isPrimary&&t.pointerType==="mouse"}function pbt(t,e,i){let n,r,a,o,{_iEvents:s,_events:l,_viewDates:c,_slotTimeLimits:u,slotDuration:d,slotHeight:p,hiddenDays:h,_view:f,datesAboveResources:m,theme:g}=Yu("state");ft(t,s,A=>i(9,n=A)),ft(t,u,A=>i(18,o=A)),ft(t,d,A=>i(16,r=A)),ft(t,p,A=>i(17,a=A));let v,y,b,I,T,w;function S(A,_,x,O){dN(x)&&(y=A,b=_,I=Ov(b),v=x.clientY,T=O)}function D(A,_){dN(_)&&(y=A,b=null,v=T=void 0)}function E(A){dN(A)&&M()}function C(){if(y){if(b){let A=v-I.top;w=Xp(Xp(Da(y),o.min),r,uyt(A/a))}else w=y;n[1]||N(),Qr(s,n[1].start=w,n),Qr(s,n[1].end=Xp(Da(w),r),n),Qr(s,n[1].resourceIds=T?[T.id]:[],n)}}function P(){b&&(I=Ov(b),C())}function R(A){dN(A)&&(v=A.clientY,C())}function N(){Qr(s,n[1]={id:"{pointer}",title:"",display:"pointer",extendedProps:{},backgroundColor:"transparent"},n)}function M(){y=b=Qr(s,n[1]=null,n)}return t.$$.update=()=>{t.$$.dirty&512&&n[0]&&M()},[P,s,u,d,p,R,S,D,E,n]}class hbt extends eu{constructor(e){super(),Qc(this,e,pbt,dbt,hc,{enterTimeGrid:6,enterDayGrid:7,leave:8,handleScroll:0})}get enterTimeGrid(){return this.$$.ctx[6]}get enterDayGrid(){return this.$$.ctx[7]}get leave(){return this.$$.ctx[8]}get handleScroll(){return this.$$.ctx[0]}}function Pie(t){let e,i,n,r;return{c(){e=Ur("div"),kt(e,"class",i=t[1].resizer)},m(a,o){Ar(a,e,o),n||(r=dr(e,"pointerdown",t[8]),n=!0)},p(a,o){o&2&&i!==(i=a[1].resizer)&&kt(e,"class",i)},d(a){a&&Er(e),n=!1,r()}}}function fbt(t){let e,i=t[0]&&Pie(t);return{c(){i&&i.c(),e=bm()},m(n,r){i&&i.m(n,r),Ar(n,e,r)},p(n,[r]){n[0]?i?i.p(n,r):(i=Pie(n),i.c(),i.m(e.parentNode,e)):i&&(i.d(1),i=null)},i:Ba,o:Ba,d(n){n&&Er(e),i&&i.d(n)}}}function mbt(t,e,i){let n,r,a,{event:o}=e,{theme:s,eventDurationEditable:l,editable:c}=Yu("state");ft(t,s,p=>i(1,a=p)),ft(t,l,p=>i(7,r=p)),ft(t,c,p=>i(6,n=p));let u;function d(p){SB.call(this,t,p)}return t.$$set=p=>{"event"in p&&i(5,o=p.event)},t.$$.update=()=>{t.$$.dirty&224&&i(0,u=!TK(o.display)&&!mT(o.display)&&((o.durationEditable??r)||(o.editable??n)))},[u,a,s,l,c,o,n,r,d]}class gbt extends eu{constructor(e){super(),Qc(this,e,mbt,fbt,hc,{event:5})}}function Rie(t){let e,i,n={};return e=new hbt({props:n}),t[16](e),{c(){rs(e.$$.fragment)},m(r,a){Vo(e,r,a),i=!0},p(r,a){const o={};e.$set(o)},i(r){i||(Fi(e.$$.fragment,r),i=!0)},o(r){In(e.$$.fragment,r),i=!1},d(r){t[16](null),Uo(e,r)}}}function vbt(t){let e,i,n,r,a={};e=new ubt({props:a}),t[15](e);let o=t[1]&&Rie(t);return{c(){rs(e.$$.fragment),i=Sc(),o&&o.c(),n=bm()},m(s,l){Vo(e,s,l),Ar(s,i,l),o&&o.m(s,l),Ar(s,n,l),r=!0},p(s,[l]){const c={};e.$set(c),s[1]?o?(o.p(s,l),l&2&&Fi(o,1)):(o=Rie(s),o.c(),Fi(o,1),o.m(n.parentNode,n)):o&&(Rc(),In(o,1,1,()=>{o=null}),Mc())},i(s){r||(Fi(e.$$.fragment,s),Fi(o),r=!0)},o(s){In(e.$$.fragment,s),In(o),r=!1},d(s){s&&(Er(i),Er(n)),t[15](null),Uo(e,s),o&&o.d(s)}}}function ybt(t,e,i){let n,r,a,o,s,l,c,u,{theme:d,editable:p,eventStartEditable:h,eventDurationEditable:f,pointer:m,_bodyEl:g,_interaction:v,_iClasses:y,_draggable:b}=Yu("state");ft(t,d,S=>i(11,a=S)),ft(t,p,S=>i(13,l=S)),ft(t,h,S=>i(14,c=S)),ft(t,m,S=>i(1,u=S)),ft(t,g,S=>i(10,r=S)),ft(t,v,S=>i(0,n=S)),ft(t,y,S=>i(17,s=S)),ft(t,b,S=>i(12,o=S)),Qr(v,n.resizer=gbt,n);function I(){var S;for(let D of Object.values(n))(S=D==null?void 0:D.handleScroll)==null||S.call(D)}function T(S){Zf[S?"unshift":"push"](()=>{n.action=S,v.set(n)})}function w(S){Zf[S?"unshift":"push"](()=>{n.pointer=S,v.set(n)})}return t.$$.update=()=>{t.$$.dirty&24576&&Qr(b,o=S=>(S.startEditable??c)||(S.editable??l),o),t.$$.dirty&6144&&Qr(y,s=(S,D)=>{let{display:E}=D;return mT(E)?[a[E]]:!TK(E)&&o(D)?[a.draggable]:[]},s),t.$$.dirty&1024&&r&&dr(r,"scroll",I)},[n,u,d,p,h,m,g,v,y,b,r,a,o,l,c,T,w]}class bbt extends eu{constructor(e){super(),Qc(this,e,ybt,vbt,hc,{})}}var Ibt={createOptions(t){t.dateClick=void 0,t.dragScroll=!0,t.editable=!1,t.eventDragMinDistance=5,t.eventDragStart=void 0,t.eventDragStop=void 0,t.eventDrop=void 0,t.eventDurationEditable=!0,t.eventLongPressDelay=void 0,t.eventResizeStart=void 0,t.eventResizeStop=void 0,t.eventResize=void 0,t.eventStartEditable=!0,t.longPressDelay=1e3,t.pointer=!1,t.select=void 0,t.selectBackgroundColor=void 0,t.selectLongPressDelay=void 0,t.selectMinDistance=5,t.unselect=void 0,t.unselectAuto=!0,t.unselectCancel="",t.theme.draggable="ec-draggable",t.theme.ghost="ec-ghost",t.theme.preview="ec-preview",t.theme.pointer="ec-pointer",t.theme.resizer="ec-resizer",t.theme.dragging="ec-dragging",t.theme.resizingY="ec-resizing-y",t.theme.resizingX="ec-resizing-x",t.theme.selecting="ec-selecting"},createStores(t){t._draggable=fs(Ba),t._auxiliary.update(e=>[...e,bbt])}};function wbt(t){return Gh([t.date,t.firstDay,t.hiddenDays],([e,i,n])=>{let r=[],a=Da(e),o=7;for(;a.getUTCDay()!==i&&o;)fT(a),--o;for(let s=0;s<7;++s)n.includes(a.getUTCDay())||r.push(Da(a)),fy(a);return r})}function Mie(t,e,i){const n=t.slice();return n[8]=e[i],n}function Nie(t){let e,i,n,r,a,o,s,l;return{c(){var c;e=Ur("div"),i=Ur("span"),a=Sc(),kt(i,"aria-label",n=t[2].format(t[8])),kt(e,"class",o=t[0].day+" "+((c=t[0].weekdays)==null?void 0:c[t[8].getUTCDay()])),kt(e,"role","columnheader")},m(c,u){Ar(c,e,u),sa(e,i),sa(e,a),s||(l=EI(r=$U.call(null,i,t[3].format(t[8]))),s=!0)},p(c,u){var d;t=c,u&6&&n!==(n=t[2].format(t[8]))&&kt(i,"aria-label",n),r&&An(r.update)&&u&10&&r.update.call(null,t[3].format(t[8])),u&3&&o!==(o=t[0].day+" "+((d=t[0].weekdays)==null?void 0:d[t[8].getUTCDay()]))&&kt(e,"class",o)},d(c){c&&Er(e),s=!1,l()}}}function Sbt(t){let e,i,n,r,a,o,s,l=dl(t[1]),c=[];for(let u=0;u<l.length;u+=1)c[u]=Nie(Mie(t,l,u));return{c(){e=Ur("div"),i=Ur("div");for(let u=0;u<c.length;u+=1)c[u].c();r=Sc(),a=Ur("div"),kt(i,"class",n=t[0].days),kt(i,"role","row"),kt(a,"class",o=t[0].hiddenScroll),kt(e,"class",s=t[0].header)},m(u,d){Ar(u,e,d),sa(e,i);for(let p=0;p<c.length;p+=1)c[p]&&c[p].m(i,null);sa(e,r),sa(e,a)},p(u,[d]){if(d&15){l=dl(u[1]);let p;for(p=0;p<l.length;p+=1){const h=Mie(u,l,p);c[p]?c[p].p(h,d):(c[p]=Nie(h),c[p].c(),c[p].m(i,null))}for(;p<c.length;p+=1)c[p].d(1);c.length=l.length}d&1&&n!==(n=u[0].days)&&kt(i,"class",n),d&1&&o!==(o=u[0].hiddenScroll)&&kt(a,"class",o),d&1&&s!==(s=u[0].header)&&kt(e,"class",s)},i:Ba,o:Ba,d(u){u&&Er(e),xw(c,u)}}}function Tbt(t,e,i){let n,r,a,o,{theme:s,_intlDayHeader:l,_intlDayHeaderAL:c,_days:u}=Yu("state");return ft(t,s,d=>i(0,n=d)),ft(t,l,d=>i(3,o=d)),ft(t,c,d=>i(2,a=d)),ft(t,u,d=>i(1,r=d)),[n,r,a,o,s,l,c,u]}class Ubt extends eu{constructor(e){super(),Qc(this,e,Tbt,Sbt,hc,{})}}function Dbt(t){let e,i,n,r,a;const o=t[7].default,s=Wvt(o,t,t[6],null);return{c(){e=Ur("div"),i=Ur("div"),s&&s.c(),kt(i,"class",n=t[0].content),kt(e,"class",r=t[0].body+(t[1]===!0?" "+t[0].uniform:""))},m(l,c){Ar(l,e,c),sa(e,i),s&&s.m(i,null),t[8](e),a=!0},p(l,[c]){s&&s.p&&(!a||c&64)&&Yvt(s,o,l,l[6],a?Kvt(o,l[6],c,null):Zvt(l[6]),null),(!a||c&1&&n!==(n=l[0].content))&&kt(i,"class",n),(!a||c&3&&r!==(r=l[0].body+(l[1]===!0?" "+l[0].uniform:"")))&&kt(e,"class",r)},i(l){a||(Fi(s,l),a=!0)},o(l){In(s,l),a=!1},d(l){l&&Er(e),s&&s.d(l),t[8](null)}}}function Ebt(t,e,i){let n,r,a,{$$slots:o={},$$scope:s}=e,{dayMaxEvents:l,_bodyEl:c,theme:u}=Yu("state");ft(t,l,p=>i(1,r=p)),ft(t,c,p=>i(2,a=p)),ft(t,u,p=>i(0,n=p));function d(p){Zf[p?"unshift":"push"](()=>{a=p,c.set(a)})}return t.$$set=p=>{"$$scope"in p&&i(6,s=p.$$scope)},[n,r,a,l,c,u,s,o,d]}class Cbt extends eu{constructor(e){super(),Qc(this,e,Ebt,Dbt,hc,{})}}function Pbt(t){let e,i,n,r,a,o,s,l,c,u,d;var p=t[8].resizer;function h(f,m){return{props:{event:f[0]}}}return p&&(o=hT(p,h(t)),o.$on("pointerdown",function(){An(t[33](t[8],!0))&&t[33](t[8],!0).apply(this,arguments)})),{c(){e=Ur("article"),i=Ur("div"),a=Sc(),o&&rs(o.$$.fragment),kt(i,"class",n=t[2].eventBody),kt(e,"class",t[4]),kt(e,"style",t[5]),kt(e,"role",s=t[7]?"button":void 0),kt(e,"tabindex",l=t[7]?0:void 0)},m(f,m){Ar(f,e,m),sa(e,i),sa(e,a),o&&Vo(o,e,null),t[52](e),c=!0,u||(d=[EI(r=$U.call(null,i,t[6])),dr(e,"click",function(){An(t[7]||void 0)&&(t[7]||void 0).apply(this,arguments)}),dr(e,"keydown",function(){An(t[7]&&Pk(t[7]))&&(t[7]&&Pk(t[7])).apply(this,arguments)}),dr(e,"mouseenter",function(){An(t[32](t[9],t[1]))&&t[32](t[9],t[1]).apply(this,arguments)}),dr(e,"mouseleave",function(){An(t[32](t[10],t[1]))&&t[32](t[10],t[1]).apply(this,arguments)}),dr(e,"pointerdown",function(){An(!mT(t[1])&&t[33](t[8]))&&(!mT(t[1])&&t[33](t[8])).apply(this,arguments)})],u=!0)},p(f,m){if(t=f,(!c||m[0]&4&&n!==(n=t[2].eventBody))&&kt(i,"class",n),r&&An(r.update)&&m[0]&64&&r.update.call(null,t[6]),m[0]&256&&p!==(p=t[8].resizer)){if(o){Rc();const g=o;In(g.$$.fragment,1,0,()=>{Uo(g,1)}),Mc()}p?(o=hT(p,h(t)),o.$on("pointerdown",function(){An(t[33](t[8],!0))&&t[33](t[8],!0).apply(this,arguments)}),rs(o.$$.fragment),Fi(o.$$.fragment,1),Vo(o,e,null)):o=null}else if(p){const g={};m[0]&1&&(g.event=t[0]),o.$set(g)}(!c||m[0]&16)&&kt(e,"class",t[4]),(!c||m[0]&32)&&kt(e,"style",t[5]),(!c||m[0]&128&&s!==(s=t[7]?"button":void 0))&&kt(e,"role",s),(!c||m[0]&128&&l!==(l=t[7]?0:void 0))&&kt(e,"tabindex",l)},i(f){c||(o&&Fi(o.$$.fragment,f),c=!0)},o(f){o&&In(o.$$.fragment,f),c=!1},d(f){f&&Er(e),o&&Uo(o),t[52](null),u=!1,Jc(d)}}}function Rbt(t,e,i){let n,r,a,o,s,l,c,u,d,p,h,f,m,g,v,y,b,I,T,w,S,{chunk:D}=e,{longChunks:E={}}=e,{inPopup:C=!1}=e,{dayMaxEvents:P,displayEventEnd:R,eventAllUpdated:N,eventBackgroundColor:M,eventTextColor:A,eventClick:_,eventColor:x,eventContent:O,eventClassNames:B,eventDidMount:F,eventMouseEnter:G,eventMouseLeave:H,theme:$,_view:q,_intlEventTime:z,_interaction:Z,_iClasses:Y,_resBgColor:Q,_resTxtColor:X,_hiddenEvents:oe,_popupDate:re,_tasks:me}=Yu("state");ft(t,P,Ee=>i(55,a=Ee)),ft(t,R,Ee=>i(44,f=Ee)),ft(t,N,Ee=>i(57,c=Ee)),ft(t,M,Ee=>i(50,I=Ee)),ft(t,A,Ee=>i(47,v=Ee)),ft(t,_,Ee=>i(40,n=Ee)),ft(t,x,Ee=>i(49,b=Ee)),ft(t,O,Ee=>i(43,h=Ee)),ft(t,B,Ee=>i(45,m=Ee)),ft(t,F,Ee=>i(58,u=Ee)),ft(t,G,Ee=>i(9,w=Ee)),ft(t,H,Ee=>i(10,S=Ee)),ft(t,$,Ee=>i(2,p=Ee)),ft(t,q,Ee=>i(41,l=Ee)),ft(t,z,Ee=>i(42,d=Ee)),ft(t,Z,Ee=>i(8,s=Ee)),ft(t,Y,Ee=>i(46,g=Ee)),ft(t,Q,Ee=>i(51,T=Ee)),ft(t,X,Ee=>i(48,y=Ee)),ft(t,oe,Ee=>i(54,r=Ee)),ft(t,re,Ee=>i(56,o=Ee));let se,te,he,ae,de,Ie,De=1,Te=!1,_e,Ve;eyt(()=>{An(u)&&u({event:Kp(te),timeText:Ie,el:se,view:td(l)})}),SCe(()=>{An(c)&&!mT(_e)&&NCe(()=>c({view:td(l)}),"eau",me)});function ot(Ee,lt){return!mT(lt)&&An(Ee)?Ke=>Ee({event:Kp(te),el:se,jsEvent:Ke,view:td(l)}):void 0}function St(Ee,lt){return Ee.action?Ke=>s.action.drag(te,Ke,lt,C?o:void 0):void 0}function nt(){se&&(i(38,De=wyt(D,E,cN(se))),a===!0?Bt():i(39,Te=!1))}function Bt(){let Ee=QE(se,2),lt=cN(Ee)-cN(Ee.firstElementChild)-Pe(Ee);i(39,Te=D.bottom>lt);let Ke=!1;for(let bt of D.dates){let gt=r[bt.getTime()];if(gt){let Ue=gt.size;Te?gt.add(D.event):gt.delete(D.event),Ue!==gt.size&&(Ke=!0)}}Ke&&oe.set(r)}function Pe(Ee){let lt=0;for(let Ke=0;Ke<D.days&&(lt=k0(lt,cN(Ee.lastElementChild)),Ee=Ee.nextElementSibling,!!Ee);++Ke);return lt}function et(Ee){Zf[Ee?"unshift":"push"](()=>{se=Ee,i(3,se)})}return t.$$set=Ee=>{"chunk"in Ee&&i(34,D=Ee.chunk),"longChunks"in Ee&&i(35,E=Ee.longChunks),"inPopup"in Ee&&i(36,C=Ee.inPopup)},t.$$.update=()=>{if(t.$$.dirty[1]&8&&i(0,te=D.event),t.$$.dirty[0]&37|t.$$.dirty[1]&2082184){i(1,_e=te.display);let Ee=te.backgroundColor||T(te)||I||b,lt=te.textColor||y(te)||v;i(5,ae=`width:calc(${D.days*100}% + ${(D.days-1)*7}px);margin-top:${De}px;`),Ee&&i(5,ae+=`background-color:${Ee};`),lt&&i(5,ae+=`color:${lt};`),Te&&i(5,ae+="visibility:hidden;"),i(4,he=[p.event,...g([],te),...Iyt(m,te,l)].join(" "))}t.$$.dirty[0]&4|t.$$.dirty[1]&15368&&i(6,[Ie,de]=byt(D,f,h,p,d,l),de),t.$$.dirty[0]&2|t.$$.dirty[1]&512&&i(7,Ve=ot(n,_e))},[te,_e,p,se,he,ae,de,Ve,s,w,S,P,R,N,M,A,_,x,O,B,F,G,H,$,q,z,Z,Y,Q,X,oe,re,ot,St,D,E,C,nt,De,Te,n,l,d,h,f,m,g,v,y,b,I,T,et]}let TB=class extends eu{constructor(e){super(),Qc(this,e,Rbt,Pbt,hc,{chunk:34,longChunks:35,inPopup:36,reposition:37},null,[-1,-1])}get reposition(){return this.$$.ctx[37]}};function Aie(t,e,i){const n=t.slice();return n[20]=e[i],n}function _ie(t,e){let i,n,r;return n=new TB({props:{chunk:e[20],inPopup:!0}}),{key:t,first:null,c(){i=bm(),rs(n.$$.fragment),this.first=i},m(a,o){Ar(a,i,o),Vo(n,a,o),r=!0},p(a,o){e=a;const s={};o&1&&(s.chunk=e[20]),n.$set(s)},i(a){r||(Fi(n.$$.fragment,a),r=!0)},o(a){In(n.$$.fragment,a),r=!1},d(a){a&&Er(i),Uo(n,a)}}}function Mbt(t){let e,i,n,r,a,o,s,l,c,u,d,p,h=[],f=new Map,m,g,v,y,b,I=dl(t[0]);const T=w=>w[20].event;for(let w=0;w<I.length;w+=1){let S=Aie(t,I,w),D=T(S);f.set(D,h[w]=_ie(D,S))}return{c(){e=Ur("div"),i=Ur("div"),n=Ur("time"),o=Sc(),s=Ur("a"),l=uM(""),d=Sc(),p=Ur("div");for(let w=0;w<h.length;w+=1)h[w].c();kt(n,"datetime",r=sp(t[3],10)),kt(s,"role","button"),kt(s,"tabindex","0"),kt(s,"aria-label",c=t[6].close),kt(i,"class",u=t[4].dayHead),kt(p,"class",m=t[4].events),kt(e,"class",g=t[4].popup),kt(e,"style",t[2])},m(w,S){Ar(w,e,S),sa(e,i),sa(i,n),sa(i,o),sa(i,s),sa(s,l),sa(e,d),sa(e,p);for(let D=0;D<h.length;D+=1)h[D]&&h[D].m(p,null);t[16](e),v=!0,y||(b=[EI(a=$U.call(null,n,t[5].format(t[3]))),dr(s,"click",Ck(t[13])),dr(s,"keydown",Pk(t[13])),EI(ayt.call(null,e,"pointerdown")),dr(e,"pointerdown",Ck(t[15])),dr(e,"pointerdownoutside",t[14])],y=!0)},p(w,[S]){(!v||S&8&&r!==(r=sp(w[3],10)))&&kt(n,"datetime",r),a&&An(a.update)&&S&40&&a.update.call(null,w[5].format(w[3])),(!v||S&64&&c!==(c=w[6].close))&&kt(s,"aria-label",c),(!v||S&16&&u!==(u=w[4].dayHead))&&kt(i,"class",u),S&1&&(I=dl(w[0]),Rc(),h=CCe(h,S,T,1,w,I,f,p,ECe,_ie,null,Aie),Mc()),(!v||S&16&&m!==(m=w[4].events))&&kt(p,"class",m),(!v||S&16&&g!==(g=w[4].popup))&&kt(e,"class",g),(!v||S&4)&&kt(e,"style",w[2])},i(w){if(!v){for(let S=0;S<I.length;S+=1)Fi(h[S]);v=!0}},o(w){for(let S=0;S<h.length;S+=1)In(h[S]);v=!1},d(w){w&&Er(e);for(let S=0;S<h.length;S+=1)h[S].d();t[16](null),y=!1,Jc(b)}}}function Nbt(t,e,i){let n,r,a,o,s,l,{buttonText:c,theme:u,_interaction:d,_intlDayPopover:p,_popupDate:h,_popupChunks:f}=Yu("state");ft(t,c,S=>i(6,l=S)),ft(t,u,S=>i(4,o=S)),ft(t,d,S=>i(17,n=S)),ft(t,p,S=>i(5,s=S)),ft(t,h,S=>i(3,r=S)),ft(t,f,S=>i(0,a=S));let m,g="";function v(){let S=QE(m,1),D=QE(S,3),E=Ov(m),C=Ov(S),P=Ov(D);i(2,g="");let R;if(E.width>=P.width){R=P.left-C.left;let M=C.right-P.right;i(2,g+=`right:${M}px;`)}else R=(C.width-E.width)/2,C.left+R<P.left?R=P.left-C.left:C.left+R+E.width>P.right&&(R=P.right-C.left-E.width);i(2,g+=`left:${R}px;`);let N;if(E.height>=P.height){N=P.top-C.top;let M=C.bottom-P.bottom;i(2,g+=`bottom:${M}px;`)}else N=(C.height-E.height)/2,C.top+N<P.top?N=P.top-C.top:C.top+N+E.height>P.bottom&&(N=P.bottom-C.top-E.height);i(2,g+=`top:${N}px;`)}function y(){m&&(i(2,g=""),IK().then(()=>{a.length?v():b()}))}function b(S){Qr(h,r=null,r)}function I(S){var D;b(),(D=n.action)==null||D.noClick()}function T(S){SB.call(this,t,S)}function w(S){Zf[S?"unshift":"push"](()=>{m=S,i(1,m)})}return t.$$.update=()=>{t.$$.dirty&1&&a&&y()},[a,m,g,r,o,s,l,c,u,d,p,h,f,b,I,T,w]}class Abt extends eu{constructor(e){super(),Qc(this,e,Nbt,Mbt,hc,{})}}function kie(t,e,i){const n=t.slice();return n[42]=e[i],n[43]=e,n[44]=i,n}function xie(t){let e,i,n,r;return i=new TB({props:{chunk:t[2][1]}}),{c(){e=Ur("div"),rs(i.$$.fragment),kt(e,"class",n=t[12].events)},m(a,o){Ar(a,e,o),Vo(i,e,null),r=!0},p(a,o){const s={};o[0]&4&&(s.chunk=a[2][1]),i.$set(s),(!r||o[0]&4096&&n!==(n=a[12].events))&&kt(e,"class",n)},i(a){r||(Fi(i.$$.fragment,a),r=!0)},o(a){In(i.$$.fragment,a),r=!1},d(a){a&&Er(e),Uo(i)}}}function Oie(t){let e,i,n,r;return i=new TB({props:{chunk:t[2][0]}}),{c(){e=Ur("div"),rs(i.$$.fragment),kt(e,"class",n=t[12].events+" "+t[12].preview)},m(a,o){Ar(a,e,o),Vo(i,e,null),r=!0},p(a,o){const s={};o[0]&4&&(s.chunk=a[2][0]),i.$set(s),(!r||o[0]&4096&&n!==(n=a[12].events+" "+a[12].preview))&&kt(e,"class",n)},i(a){r||(Fi(i.$$.fragment,a),r=!0)},o(a){In(i.$$.fragment,a),r=!1},d(a){a&&Er(e),Uo(i)}}}function Lie(t,e){let i,n,r=e[44],a;const o=()=>e[36](n,r),s=()=>e[36](null,r);let l={chunk:e[42],longChunks:e[1]};return n=new TB({props:l}),o(),{key:t,first:null,c(){i=bm(),rs(n.$$.fragment),this.first=i},m(c,u){Ar(c,i,u),Vo(n,c,u),a=!0},p(c,u){e=c,r!==e[44]&&(s(),r=e[44],o());const d={};u[0]&16&&(d.chunk=e[42]),u[0]&2&&(d.longChunks=e[1]),n.$set(d)},i(c){a||(Fi(n.$$.fragment,c),a=!0)},o(c){In(n.$$.fragment,c),a=!1},d(c){c&&Er(i),s(),Uo(n,c)}}}function Fie(t){let e,i;return e=new Abt({}),{c(){rs(e.$$.fragment)},m(n,r){Vo(e,n,r),i=!0},i(n){i||(Fi(e.$$.fragment,n),i=!0)},o(n){In(e.$$.fragment,n),i=!1},d(n){Uo(e,n)}}}function Bie(t){let e,i,n,r;return{c(){e=Ur("a"),kt(e,"role","button"),kt(e,"tabindex","0"),kt(e,"aria-haspopup","true")},m(a,o){Ar(a,e,o),n||(r=[dr(e,"click",Ck(t[26])),dr(e,"keydown",Pk(t[26])),dr(e,"pointerdown",Ck(t[35])),EI(i=$U.call(null,e,t[10]))],n=!0)},p(a,o){i&&An(i.update)&&o[0]&1024&&i.update.call(null,a[10])},d(a){a&&Er(e),n=!1,Jc(r)}}}function _bt(t){let e,i,n,r,a,o,s=t[2][1]&&hf(t[2][1].date,t[0]),l,c=t[2][0]&&hf(t[2][0].date,t[0]),u,d,p=[],h=new Map,f,m,g,v,y,b,I,T,w,S=s&&xie(t),D=c&&Oie(t),E=dl(t[4]);const C=N=>N[42].event;for(let N=0;N<E.length;N+=1){let M=kie(t,E,N),A=C(M);h.set(A,p[N]=Lie(A,M))}let P=t[6]&&Fie(),R=t[5].size&&Bie(t);return{c(){var N;e=Ur("div"),i=Ur("time"),o=Sc(),S&&S.c(),l=Sc(),D&&D.c(),u=Sc(),d=Ur("div");for(let M=0;M<p.length;M+=1)p[M].c();m=Sc(),P&&P.c(),g=Sc(),v=Ur("div"),R&&R.c(),kt(i,"class",n=t[12].dayHead),kt(i,"datetime",r=sp(t[0],10)),kt(d,"class",f=t[12].events),kt(v,"class",y=t[12].dayFoot),kt(e,"class",b=t[12].day+" "+((N=t[12].weekdays)==null?void 0:N[t[0].getUTCDay()])+(t[7]?" "+t[12].today:"")+(t[8]?" "+t[12].otherMonth:"")+(t[9]?" "+t[12].highlight:"")),kt(e,"role","cell")},m(N,M){Ar(N,e,M),sa(e,i),sa(e,o),S&&S.m(e,null),sa(e,l),D&&D.m(e,null),sa(e,u),sa(e,d);for(let A=0;A<p.length;A+=1)p[A]&&p[A].m(d,null);sa(e,m),P&&P.m(e,null),sa(e,g),sa(e,v),R&&R.m(v,null),t[37](e),I=!0,T||(w=[EI(a=$U.call(null,i,t[14].format(t[0]))),dr(e,"pointerenter",function(){An(t[25](t[13]))&&t[25](t[13]).apply(this,arguments)}),dr(e,"pointerleave",function(){var A,_;An((A=t[13].pointer)==null?void 0:A.leave)&&((_=t[13].pointer)==null||_.leave.apply(this,arguments))}),dr(e,"pointerdown",function(){var A,_;An((A=t[13].action)==null?void 0:A.select)&&((_=t[13].action)==null||_.select.apply(this,arguments))})],T=!0)},p(N,M){var A;t=N,(!I||M[0]&4096&&n!==(n=t[12].dayHead))&&kt(i,"class",n),(!I||M[0]&1&&r!==(r=sp(t[0],10)))&&kt(i,"datetime",r),a&&An(a.update)&&M[0]&16385&&a.update.call(null,t[14].format(t[0])),M[0]&5&&(s=t[2][1]&&hf(t[2][1].date,t[0])),s?S?(S.p(t,M),M[0]&5&&Fi(S,1)):(S=xie(t),S.c(),Fi(S,1),S.m(e,l)):S&&(Rc(),In(S,1,1,()=>{S=null}),Mc()),M[0]&5&&(c=t[2][0]&&hf(t[2][0].date,t[0])),c?D?(D.p(t,M),M[0]&5&&Fi(D,1)):(D=Oie(t),D.c(),Fi(D,1),D.m(e,u)):D&&(Rc(),In(D,1,1,()=>{D=null}),Mc()),M[0]&2066&&(E=dl(t[4]),Rc(),p=CCe(p,M,C,1,t,E,h,d,ECe,Lie,null,kie),Mc()),(!I||M[0]&4096&&f!==(f=t[12].events))&&kt(d,"class",f),t[6]?P?M[0]&64&&Fi(P,1):(P=Fie(),P.c(),Fi(P,1),P.m(e,g)):P&&(Rc(),In(P,1,1,()=>{P=null}),Mc()),t[5].size?R?R.p(t,M):(R=Bie(t),R.c(),R.m(v,null)):R&&(R.d(1),R=null),(!I||M[0]&4096&&y!==(y=t[12].dayFoot))&&kt(v,"class",y),(!I||M[0]&4993&&b!==(b=t[12].day+" "+((A=t[12].weekdays)==null?void 0:A[t[0].getUTCDay()])+(t[7]?" "+t[12].today:"")+(t[8]?" "+t[12].otherMonth:"")+(t[9]?" "+t[12].highlight:"")))&&kt(e,"class",b)},i(N){if(!I){Fi(S),Fi(D);for(let M=0;M<E.length;M+=1)Fi(p[M]);Fi(P),I=!0}},o(N){In(S),In(D);for(let M=0;M<p.length;M+=1)In(p[M]);In(P),I=!1},d(N){N&&Er(e),S&&S.d(),D&&D.d();for(let M=0;M<p.length;M+=1)p[M].d();P&&P.d(),R&&R.d(),t[37](null),T=!1,Jc(w)}}}function kbt(t,e,i){let n,r,a,o,s,l,c,u,d,p,{date:h}=e,{chunks:f}=e,{longChunks:m}=e,{iChunks:g=[]}=e,{date:v,dayMaxEvents:y,highlightedDates:b,moreLinkContent:I,theme:T,_hiddenEvents:w,_intlDayCell:S,_popupDate:D,_popupChunks:E,_today:C,_interaction:P,_queue:R}=Yu("state");ft(t,v,X=>i(33,l=X)),ft(t,b,X=>i(32,s=X)),ft(t,I,X=>i(30,a=X)),ft(t,T,X=>i(12,u=X)),ft(t,w,X=>i(31,o=X)),ft(t,S,X=>i(14,p=X)),ft(t,D,X=>i(29,r=X)),ft(t,E,X=>i(38,n=X)),ft(t,C,X=>i(34,c=X)),ft(t,P,X=>i(13,d=X));let N,M,A,_,x,O=new Set,B="",F,G=[];function H(X){return X.pointer?oe=>X.pointer.enterDayGrid(h,oe):void 0}function $(){Qr(D,r=h,r)}function q(){var re;let X=fy(Da(h)),oe=M.concat(((re=m[h.getTime()])==null?void 0:re.chunks)||[]);Qr(E,n=oe.map(me=>Ow({},me,IH(me.event,h,X),{days:1,dates:[h]})).sort((me,se)=>me.top-se.top),n)}function z(){kCe(G,M)}function Z(X){SB.call(this,t,X)}function Y(X,oe){Zf[X?"unshift":"push"](()=>{G[oe]=X,i(11,G)})}function Q(X){Zf[X?"unshift":"push"](()=>{N=X,i(3,N)})}return t.$$set=X=>{"date"in X&&i(0,h=X.date),"chunks"in X&&i(27,f=X.chunks),"longChunks"in X&&i(1,m=X.longChunks),"iChunks"in X&&i(2,g=X.iChunks)},t.$$.update=()=>{if(t.$$.dirty[0]&134217777){i(4,M=[]),O.clear(),i(5,O),i(27,f),i(0,h),i(4,M);for(let X of f)hf(X.date,h)&&M.push(X)}if(t.$$.dirty[0]&33&&Qr(w,o[h.getTime()]=O,o),t.$$.dirty[0]&1|t.$$.dirty[1]&8&&i(7,A=hf(h,c)),t.$$.dirty[0]&1|t.$$.dirty[1]&6&&(i(8,_=h.getUTCMonth()!==l.getUTCMonth()),i(9,x=s.some(X=>hf(X,h)))),t.$$.dirty[0]&1073741856|t.$$.dirty[1]&1&&o&&O.size){let X="+"+O.size+" more";a?i(10,B=An(a)?a({num:O.size,text:X}):a):i(10,B=X)}t.$$.dirty[0]&536870913&&i(6,F=r&&hf(h,r)),t.$$.dirty[0]&82&&F&&m&&M&&IK().then(q),t.$$.dirty[0]&9&&N&&hyt(N,()=>({allDay:!0,date:h,resource:void 0,dayEl:N}))},[h,m,g,N,M,O,F,A,_,x,B,G,u,d,p,v,b,I,T,w,S,D,E,C,P,H,$,f,z,r,a,o,s,l,c,Z,Y,Q]}class xbt extends eu{constructor(e){super(),Qc(this,e,kbt,_bt,hc,{date:0,chunks:27,longChunks:1,iChunks:2,reposition:28},null,[-1,-1])}get reposition(){return this.$$.ctx[28]}}function $ie(t,e,i){const n=t.slice();return n[21]=e[i],n[22]=e,n[23]=i,n}function Vie(t){let e,i=t[23],n;const r=()=>t[18](e,i),a=()=>t[18](null,i);let o={date:t[21],chunks:t[1],longChunks:t[2],iChunks:t[3]};return e=new xbt({props:o}),r(),{c(){rs(e.$$.fragment)},m(s,l){Vo(e,s,l),n=!0},p(s,l){i!==s[23]&&(a(),i=s[23],r());const c={};l&1&&(c.date=s[21]),l&2&&(c.chunks=s[1]),l&4&&(c.longChunks=s[2]),l&8&&(c.iChunks=s[3]),e.$set(c)},i(s){n||(Fi(e.$$.fragment,s),n=!0)},o(s){In(e.$$.fragment,s),n=!1},d(s){a(),Uo(e,s)}}}function Obt(t){let e,i,n,r,a,o=dl(t[0]),s=[];for(let c=0;c<o.length;c+=1)s[c]=Vie($ie(t,o,c));const l=c=>In(s[c],1,1,()=>{s[c]=null});return{c(){e=Ur("div");for(let c=0;c<s.length;c+=1)s[c].c();kt(e,"class",i=t[5].days),kt(e,"role","row")},m(c,u){Ar(c,e,u);for(let d=0;d<s.length;d+=1)s[d]&&s[d].m(e,null);n=!0,r||(a=dr(window,"resize",t[11]),r=!0)},p(c,[u]){if(u&31){o=dl(c[0]);let d;for(d=0;d<o.length;d+=1){const p=$ie(c,o,d);s[d]?(s[d].p(p,u),Fi(s[d],1)):(s[d]=Vie(p),s[d].c(),Fi(s[d],1),s[d].m(e,null))}for(Rc(),d=o.length;d<s.length;d+=1)l(d);Mc()}(!n||u&32&&i!==(i=c[5].days))&&kt(e,"class",i)},i(c){if(!n){for(let u=0;u<o.length;u+=1)Fi(s[u]);n=!0}},o(c){s=s.filter(Boolean);for(let u=0;u<s.length;u+=1)In(s[u]);n=!1},d(c){c&&Er(e),xw(s,c),r=!1,a()}}}function Lbt(t,e,i){let n,r,a,o,s,{dates:l}=e,{_events:c,_iEvents:u,_queue2:d,_hiddenEvents:p,hiddenDays:h,theme:f}=Yu("state");ft(t,c,D=>i(17,o=D)),ft(t,u,D=>i(16,a=D)),ft(t,p,D=>i(14,n=D)),ft(t,h,D=>i(15,r=D)),ft(t,f,D=>i(5,s=D));let m,g,v=[],y,b,I=[],T={};function w(){wK(()=>kCe(I,l),T,d)}function S(D,E){Zf[D?"unshift":"push"](()=>{I[E]=D,i(4,I)})}return t.$$set=D=>{"dates"in D&&i(0,l=D.dates)},t.$$.update=()=>{if(t.$$.dirty&1&&(i(12,y=l[0]),i(13,b=fy(Da(l[l.length-1])))),t.$$.dirty&176130){i(1,m=[]);for(let D of o)if(!TK(D.display)&&pie(D,y,b)){let E=IH(D,y,b);m.push(E)}i(2,g=die(m,r)),w()}t.$$.dirty&110592&&i(3,v=a.map(D=>{let E;return D&&pie(D,y,b)?(E=IH(D,y,b),die([E],r)):E=null,E})),t.$$.dirty&16384&&n&&w()},[l,m,g,v,I,s,c,u,p,h,f,w,y,b,n,r,a,o,S]}class Fbt extends eu{constructor(e){super(),Qc(this,e,Lbt,Obt,hc,{dates:0})}}function jie(t,e,i){const n=t.slice();return n[10]=e[i],n}function Gie(t){let e,i;return e=new Fbt({props:{dates:t[10]}}),{c(){rs(e.$$.fragment)},m(n,r){Vo(e,n,r),i=!0},p(n,r){const a={};r&1&&(a.dates=n[10]),e.$set(a)},i(n){i||(Fi(e.$$.fragment,n),i=!0)},o(n){In(e.$$.fragment,n),i=!1},d(n){Uo(e,n)}}}function Bbt(t){let e,i,n=dl(t[0]),r=[];for(let o=0;o<n.length;o+=1)r[o]=Gie(jie(t,n,o));const a=o=>In(r[o],1,1,()=>{r[o]=null});return{c(){for(let o=0;o<r.length;o+=1)r[o].c();e=bm()},m(o,s){for(let l=0;l<r.length;l+=1)r[l]&&r[l].m(o,s);Ar(o,e,s),i=!0},p(o,s){if(s&1){n=dl(o[0]);let l;for(l=0;l<n.length;l+=1){const c=jie(o,n,l);r[l]?(r[l].p(c,s),Fi(r[l],1)):(r[l]=Gie(c),r[l].c(),Fi(r[l],1),r[l].m(e.parentNode,e))}for(Rc(),l=n.length;l<r.length;l+=1)a(l);Mc()}},i(o){if(!i){for(let s=0;s<n.length;s+=1)Fi(r[s]);i=!0}},o(o){r=r.filter(Boolean);for(let s=0;s<r.length;s+=1)In(r[s]);i=!1},d(o){o&&Er(e),xw(r,o)}}}function $bt(t){let e,i,n,r;return e=new Ubt({}),n=new Cbt({props:{$$slots:{default:[Bbt]},$$scope:{ctx:t}}}),{c(){rs(e.$$.fragment),i=Sc(),rs(n.$$.fragment)},m(a,o){Vo(e,a,o),Ar(a,i,o),Vo(n,a,o),r=!0},p(a,[o]){const s={};o&8193&&(s.$$scope={dirty:o,ctx:a}),n.$set(s)},i(a){r||(Fi(e.$$.fragment,a),Fi(n.$$.fragment,a),r=!0)},o(a){In(e.$$.fragment,a),In(n.$$.fragment,a),r=!1},d(a){a&&Er(i),Uo(e,a),Uo(n,a)}}}function Vbt(t,e,i){let n,r,a,o,{_viewDates:s,_hiddenEvents:l,dayMaxEvents:c,hiddenDays:u}=Yu("state");ft(t,s,h=>i(6,n=h)),ft(t,l,h=>i(9,a=h)),ft(t,c,h=>i(7,r=h)),ft(t,u,h=>i(8,o=h));let d,p;return t.$$.update=()=>{if(t.$$.dirty&481){i(0,d=[]),i(5,p=7-o.length),Qr(l,a={},a);for(let h=0;h<n.length/p;++h){let f=[];for(let m=0;m<p;++m)f.push(n[h*p+m]);d.push(f)}}},[d,s,l,c,u,p,n,r,o]}class jbt extends eu{constructor(e){super(),Qc(this,e,Vbt,$bt,hc,{})}}var Gbt={createOptions(t){t.dayMaxEvents=!1,t.dayCellFormat={day:"numeric"},t.dayPopoverFormat={month:"long",day:"numeric",year:"numeric"},t.moreLinkContent=void 0,t.buttonText.dayGridMonth="month",t.buttonText.close="Close",t.theme.uniform="ec-uniform",t.theme.dayFoot="ec-day-foot",t.theme.popup="ec-popup",t.view="dayGridMonth",t.views.dayGridMonth={buttonText:Dyt,component:jbt,dayHeaderFormat:{weekday:"short"},dayHeaderAriaLabelFormat:{weekday:"long"},displayEventEnd:!1,duration:{months:1},theme:Cyt("ec-day-grid ec-month-view"),titleFormat:{year:"numeric",month:"long"}}},createStores(t){t._days=wbt(t),t._intlDayCell=dD(t.locale,t.dayCellFormat),t._intlDayPopover=dD(t.locale,t.dayPopoverFormat),t._hiddenEvents=fs({}),t._popupDate=fs(null),t._popupChunks=fs([])}};let hA;function Hbt(){var i;const t=zc(),e=(i=t==null?void 0:t.provider)==null?void 0:i.organisationId;if(e){const n=r=>{r!=null&&r.calendar?S2(r.calendar):xc.findAllTournaments().then(S2)};xc.findProvider(e).then(n)}else xc.findAllTournaments().then(S2)}function S2(t){const e=document.getElementById(BO);return hA&&as(e),Kgt(),hA=new obt({target:e,props:{plugins:[Gbt,Ibt],options:{view:"dayGridMonth",height:"800px",headerToolbar:{start:"prev,next",center:"title",end:""},buttonText:i=>(i.resourceTimeGridWeek="resources",i),resources:[{id:1,title:"Resource A"},{id:2,title:"Resource B"}],scrollTime:"09:00:00",events:qbt(t),eventClick:zbt,eventMouseEnter:Wbt,views:{},dayMaxEvents:!0,nowIndicator:!0,selectable:!0}}}),{...wP,calendar:hA}}function zbt({event:t}){if(t.id){hA.destroy();const e=t.id;at.reset();const i=`/${Fo}/${e}`;Tt.router.navigate(i)}}function qbt(t){const e=i=>i==null?void 0:i.split("T")[0];return t.map(i=>({title:i.tournamentName,start:e(i.startDate),end:e(i.endDate),extendedProps:{tournamentId:i.tournamentId},resourceIds:[i.tournamentId],id:i.tournamentId,color:"#FE6B64"}))}function Wbt({event:t,jsEvent:e}){fg(e.target,{content:t.title,showOnCreate:!0,arrow:!0})}var Kbt=/([:*])(\w+)/g,Ybt="([^/]+)",Zbt=/\*/g,Xbt="?(?:.*)",Jbt=/\/\?/g,Qbt="/?([^/]+|)",eIt="(?:/^|^)",tIt="";function OCe(t){return t===void 0&&(t="/"),DK()?location.pathname+location.search+location.hash:t}function Io(t){return t.replace(/\/+$/,"").replace(/^\/+/,"")}function Mk(t){return typeof t=="string"}function iIt(t){return typeof t=="function"}function Nk(t){return t&&t.indexOf("#")>=0&&t.split("#").pop()||""}function nIt(t,e){return e.length===0||!t?null:t.slice(1,t.length).reduce(function(i,n,r){return i===null&&(i={}),i[e[r]]=decodeURIComponent(n),i},null)}function Ak(t){var e=Io(t).split(/\?(.*)?$/);return[Io(e[0]),e.slice(1).join("")]}function UK(t){for(var e={},i=t.split("&"),n=0;n<i.length;n++){var r=i[n].split("=");if(r[0]!==""){var a=decodeURIComponent(r[0]);e[a]?(Array.isArray(e[a])||(e[a]=[e[a]]),e[a].push(decodeURIComponent(r[1]||""))):e[a]=decodeURIComponent(r[1]||"")}}return e}function LCe(t,e){var i=Ak(Io(t.currentLocationPath)),n=i[0],r=i[1],a=r===""?null:UK(r),o=[],s;if(Mk(e.path)){if(s=eIt+Io(e.path).replace(Kbt,function(d,p,h){return o.push(h),Ybt}).replace(Zbt,Xbt).replace(Jbt,Qbt)+"$",Io(e.path)===""&&Io(n)==="")return{url:n,queryString:r,hashString:Nk(t.to),route:e,data:null,params:a}}else s=e.path;var l=new RegExp(s,tIt),c=n.match(l);if(c){var u=Mk(e.path)?nIt(c,o):c.groups?c.groups:c.slice(1);return{url:Io(n.replace(new RegExp("^"+t.instance.root),"")),queryString:r,hashString:Nk(t.to),route:e,data:u,params:a}}return!1}function FCe(){return!!(typeof window<"u"&&window.history&&window.history.pushState)}function Lw(t,e){return typeof t[e]>"u"||t[e]===!0}function rIt(t){if(!t)return{};var e=t.split(","),i={},n;return e.forEach(function(r){var a=r.split(":").map(function(o){return o.replace(/(^ +| +$)/g,"")});switch(a[0]){case"historyAPIMethod":i.historyAPIMethod=a[1];break;case"resolveOptionsStrategy":n||(n={}),n.strategy=a[1];break;case"resolveOptionsHash":n||(n={}),n.hash=a[1]==="true";break;case"updateBrowserURL":case"callHandler":case"updateState":case"force":i[a[0]]=a[1]==="true";break}}),n&&(i.resolveOptions=n),i}function DK(){return typeof window<"u"}function aIt(t,e){return t===void 0&&(t=[]),e===void 0&&(e={}),t.filter(function(i){return i}).forEach(function(i){["before","after","already","leave"].forEach(function(n){i[n]&&(e[n]||(e[n]=[]),e[n].push(i[n]))})}),e}function ff(t,e,i){var n=e||{},r=0;(function a(){if(!t[r]){i&&i(n);return}Array.isArray(t[r])?(t.splice.apply(t,[r,1].concat(t[r][0](n)?t[r][1]:t[r][2])),a()):t[r](n,function(o){typeof o>"u"||o===!0?(r+=1,a()):i&&i(n)})})()}ff.if=function(t,e,i){return Array.isArray(e)||(e=[e]),Array.isArray(i)||(i=[i]),[t,e,i]};function Hie(t,e){typeof t.currentLocationPath>"u"&&(t.currentLocationPath=t.to=OCe(t.instance.root)),t.currentLocationPath=t.instance._checkForAHash(t.currentLocationPath),e()}function T2(t,e){for(var i=0;i<t.instance.routes.length;i++){var n=t.instance.routes[i],r=LCe(t,n);if(r&&(t.matches||(t.matches=[]),t.matches.push(r),t.resolveOptions.strategy==="ONE")){e();return}}e()}function oIt(t,e){t.navigateOptions&&(typeof t.navigateOptions.shouldResolve<"u"&&console.warn('"shouldResolve" is deprecated. Please check the documentation.'),typeof t.navigateOptions.silent<"u"&&console.warn('"silent" is deprecated. Please check the documentation.')),e()}function sIt(t,e){t.navigateOptions.force===!0?(t.instance._setCurrent([t.instance._pathToMatchObject(t.to)]),e(!1)):e()}var zie=DK(),lIt=FCe();function cIt(t,e){if(Lw(t.navigateOptions,"updateBrowserURL")){var i=("/"+t.to).replace(/\/\//g,"/"),n=zie&&t.resolveOptions&&t.resolveOptions.hash===!0;lIt?(history[t.navigateOptions.historyAPIMethod||"pushState"](t.navigateOptions.stateObj||{},t.navigateOptions.title||"",n?"#"+i:i),location&&location.hash&&(t.instance.__freezeListening=!0,setTimeout(function(){if(!n){var r=location.hash;location.hash="",location.hash=r}t.instance.__freezeListening=!1},1))):zie&&(window.location.href=t.to)}e()}function BCe(t,e){var i=t.instance;if(!i.lastResolved()){e();return}ff(i.lastResolved().map(function(n){return function(r,a){if(!n.route.hooks||!n.route.hooks.leave){a();return}var o=!1,s=t.instance.matchLocation(n.route.path,t.currentLocationPath,!1);if(n.route.path!=="*")o=!s;else{var l=t.matches?t.matches.find(function(c){return n.route.path===c.route.path}):!1;o=!l}if(Lw(t.navigateOptions,"callHooks")&&o){ff(n.route.hooks.leave.map(function(c){return function(u,d){return c(function(p){p===!1?t.instance.__markAsClean(t):d()},t.matches&&t.matches.length>0?t.matches.length===1?t.matches[0]:t.matches:void 0)}}).concat([function(){return a()}]));return}else a()}}),{},function(){return e()})}function uIt(t,e){t.match.route.hooks&&t.match.route.hooks.before&&Lw(t.navigateOptions,"callHooks")?ff(t.match.route.hooks.before.map(function(i){return function(r,a){return i(function(o){o===!1?t.instance.__markAsClean(t):a()},t.match)}}).concat([function(){return e()}])):e()}function dIt(t,e){Lw(t.navigateOptions,"callHandler")&&t.match.route.handler(t.match),t.instance.updatePageLinks(),e()}function pIt(t,e){t.match.route.hooks&&t.match.route.hooks.after&&Lw(t.navigateOptions,"callHooks")&&t.match.route.hooks.after.forEach(function(i){return i(t.match)}),e()}function hIt(t,e){var i=t.instance.lastResolved();if(i&&i[0]&&i[0].route===t.match.route&&i[0].url===t.match.url&&i[0].queryString===t.match.queryString){i.forEach(function(n){n.route.hooks&&n.route.hooks.already&&Lw(t.navigateOptions,"callHooks")&&n.route.hooks.already.forEach(function(r){return r(t.match)})}),e(!1);return}e()}function fIt(t,e){var i=t.instance._notFoundRoute;if(i){t.notFoundHandled=!0;var n=Ak(t.currentLocationPath),r=n[0],a=n[1],o=Nk(t.to);i.path=Io(r);var s={url:i.path,queryString:a,hashString:o,data:null,route:i,params:a!==""?UK(a):null};t.matches=[s],t.match=s}e()}function mIt(t,e){(!t.resolveOptions||t.resolveOptions.noMatchWarning===!1||typeof t.resolveOptions.noMatchWarning>"u")&&console.warn('Navigo: "'+t.currentLocationPath+`" didn't match any of the registered routes.`),e()}function gIt(t,e){t.instance._setCurrent(null),e()}function $Ce(t,e){Lw(t.navigateOptions,"updateState")&&t.instance._setCurrent(t.matches),e()}var VCe=[hIt,uIt,dIt,pIt],qie=[BCe,fIt,ff.if(function(t){var e=t.notFoundHandled;return e},VCe.concat([$Ce]),[mIt,gIt])];function TH(){return TH=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])}return t},TH.apply(this,arguments)}function Wie(t,e){var i=0;function n(){if(i===t.matches.length){$Ce(t,e);return}ff(VCe,TH({},t,{match:t.matches[i]}),function(){i+=1,n()})}BCe(t,n)}function U2(t){t.instance.__markAsClean(t)}function UH(){return UH=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])}return t},UH.apply(this,arguments)}var Kie="[data-navigo]";function vIt(t,e){var i=e||{strategy:"ONE",hash:!1,noMatchWarning:!1,linksSelector:Kie},n=this,r="/",a=null,o=[],s=!1,l,c=FCe(),u=DK();t?r=Io(t):console.warn('Navigo requires a root path in its constructor. If not provided will use "/" as default.');function d(F){return F.indexOf("#")>=0&&(i.hash===!0?F=F.split("#")[1]||"/":F=F.split("#")[0]),F}function p(F){return Io(r+"/"+Io(F))}function h(F,G,H,$){return F=Mk(F)?p(F):F,{name:$||Io(String(F)),path:F,handler:G,hooks:aIt(H)}}function f(F,G,H){var $=this;return typeof F=="object"&&!(F instanceof RegExp)?(Object.keys(F).forEach(function(q){if(typeof F[q]=="function")$.on(q,F[q]);else{var z=F[q],Z=z.uses,Y=z.as,Q=z.hooks;o.push(h(q,Z,[l,Q],Y))}}),this):(typeof F=="function"&&(H=G,G=F,F=r),o.push(h(F,G,[l,H])),this)}function m(F,G){if(n.__dirty){n.__waiting.push(function(){return n.resolve(F,G)});return}else n.__dirty=!0;F=F?Io(r)+"/"+Io(F):void 0;var H={instance:n,to:F,currentLocationPath:F,navigateOptions:{},resolveOptions:UH({},i,G)};return ff([Hie,T2,ff.if(function($){var q=$.matches;return q&&q.length>0},Wie,qie)],H,U2),H.matches?H.matches:!1}function g(F,G){if(n.__dirty){n.__waiting.push(function(){return n.navigate(F,G)});return}else n.__dirty=!0;F=Io(r)+"/"+Io(F);var H={instance:n,to:F,navigateOptions:G||{},resolveOptions:G&&G.resolveOptions?G.resolveOptions:i,currentLocationPath:d(F)};ff([oIt,sIt,T2,ff.if(function($){var q=$.matches;return q&&q.length>0},Wie,qie),cIt,U2],H,U2)}function v(F,G,H){var $=P(F,G);return $!==null?(g($.replace(new RegExp("^/?"+r),""),H),!0):!1}function y(F){return this.routes=o=o.filter(function(G){return Mk(F)?Io(G.path)!==Io(F):iIt(F)?F!==G.handler:String(G.path)!==String(F)}),this}function b(){c&&(this.__popstateListener=function(){n.__freezeListening||m()},window.addEventListener("popstate",this.__popstateListener))}function I(){this.routes=o=[],c&&window.removeEventListener("popstate",this.__popstateListener),this.destroyed=s=!0}function T(F,G){return n._notFoundRoute=h("*",F,[l,G],"__NOT_FOUND__"),this}function w(){if(u)return S().forEach(function(F){if(F.getAttribute("data-navigo")==="false"||F.getAttribute("target")==="_blank"){F.hasListenerAttached&&F.removeEventListener("click",F.navigoHandler);return}F.hasListenerAttached||(F.hasListenerAttached=!0,F.navigoHandler=function(G){if((G.ctrlKey||G.metaKey)&&G.target.tagName.toLowerCase()==="a")return!1;var H=F.getAttribute("href");if(typeof H>"u"||H===null)return!1;if(H.match(/^(http|https)/)&&typeof URL<"u")try{var $=new URL(H);H=$.pathname+$.search}catch{}var q=rIt(F.getAttribute("data-navigo-options"));s||(G.preventDefault(),G.stopPropagation(),n.navigate(Io(H),q))},F.addEventListener("click",F.navigoHandler))}),n}function S(){return u?[].slice.call(document.querySelectorAll(i.linksSelector||Kie)):[]}function D(F){return"/"+r+"/"+Io(F)}function E(F){return l=F,this}function C(){return a}function P(F,G,H){var $=o.find(function(Z){return Z.name===F}),q=null;if($){if(q=$.path,G)for(var z in G)q=q.replace(":"+z,G[z]);q=q.match(/^\//)?q:"/"+q}return q&&H&&!H.includeRoot&&(q=q.replace(new RegExp("^/"+r),"")),q}function R(F){return F.getAttribute("href")}function N(F){var G=Ak(Io(F)),H=G[0],$=G[1],q=$===""?null:UK($),z=Nk(F),Z=h(H,function(){},[l],H);return{url:H,queryString:$,hashString:z,route:Z,data:null,params:q}}function M(){return N(Io(OCe(r)).replace(new RegExp("^"+r),""))}function A(F){var G={instance:n,currentLocationPath:F,to:F,navigateOptions:{},resolveOptions:i};return T2(G,function(){}),G.matches?G.matches:!1}function _(F,G,H){typeof G<"u"&&(typeof H>"u"||H)&&(G=p(G));var $={instance:n,to:G,currentLocationPath:G};Hie($,function(){}),typeof F=="string"&&(F=typeof H>"u"||H?p(F):F);var q=LCe($,{name:String(F),path:F,handler:function(){},hooks:{}});return q||!1}function x(F,G,H){return typeof G=="string"&&(G=O(G)),G?(G.hooks[F]||(G.hooks[F]=[]),G.hooks[F].push(H),function(){G.hooks[F]=G.hooks[F].filter(function($){return $!==H})}):(console.warn("Route doesn't exists: "+G),function(){})}function O(F){return typeof F=="string"?o.find(function(G){return G.name===p(F)}):o.find(function(G){return G.handler===F})}function B(F){F.instance.__dirty=!1,F.instance.__waiting.length>0&&F.instance.__waiting.shift()()}this.root=r,this.routes=o,this.destroyed=s,this.current=a,this.__freezeListening=!1,this.__waiting=[],this.__dirty=!1,this.__markAsClean=B,this.on=f,this.off=y,this.resolve=m,this.navigate=g,this.navigateByName=v,this.destroy=I,this.notFound=T,this.updatePageLinks=w,this.link=D,this.hooks=E,this.extractGETParameters=function(F){return Ak(d(F))},this.lastResolved=C,this.generate=P,this.getLinkPath=R,this.match=A,this.matchLocation=_,this.getCurrentLocation=M,this.addBeforeHook=x.bind(this,"before"),this.addAfterHook=x.bind(this,"after"),this.addAlreadyHook=x.bind(this,"already"),this.addLeaveHook=x.bind(this,"leave"),this.getRoute=O,this._pathToMatchObject=N,this._clean=Io,this._checkForAHash=d,this._setCurrent=function(F){return a=n.current=F},b.call(this),w.call(this)}function yIt(){const e=new vIt("/",{hash:!0});Tt.router=e;const i=({selectedTab:n,renderDraw:r,data:a})=>{WF(),Ygt({config:{selectedTab:n,renderDraw:r,...a}})};return e.on(`/${Fo}/:tournamentId`,({data:n})=>{i({data:n})}),e.on(`/${Fo}/:tournamentId/overview`,({data:n})=>{i({data:n,selectedTab:QT})}),e.on(`/${Fo}/:tournamentId/${ob}/:eventId`,({data:n})=>{i({selectedTab:qp,data:n})}),e.on(`/${Fo}/:tournamentId/${ob}/:eventId/${y1}/:drawId`,({data:n})=>{i({selectedTab:qp,renderDraw:!0,data:n})}),e.on(`/${Fo}/:tournamentId/${ob}/:eventId/${y1}/:drawId/${RV}/:roundsView`,({data:n})=>{i({selectedTab:qp,renderDraw:!0,data:n})}),e.on(`/${Fo}/:tournamentId/${ob}/:eventId/${y1}/:drawId/${PV}/:structureId`,({data:n})=>{i({selectedTab:qp,renderDraw:!0,data:n})}),e.on(`/${Fo}/:tournamentId/${ob}/:eventId/${y1}/:drawId/${PV}/:structureId/${RV}/:roundsView`,({data:n})=>{i({selectedTab:qp,renderDraw:!0,data:n})}),e.on(`/${Fo}/:tournamentId/${ob}/:eventId/${ehe}/:drawId`,({data:n})=>{i({selectedTab:qp,data:n})}),e.on(`/${Fo}/:tournamentId/${kf}/:participantView`,({data:n})=>{i({selectedTab:kf,data:n})}),e.on(`/${Fo}/:tournamentId/${Qv}/:scheduledDate`,({data:n})=>{i({selectedTab:Qv,data:n})}),e.on(`/${Fo}/:tournamentId/:selectedTab`,({data:n})=>{i({data:n})}),e.on(`/${bh}/:uuid`,iie),e.on(`/${bh}`,iie),e.on(`/${the}/:inviteKey`,jvt),e.on("/calendar",Hbt),e.on("/actionKey/:key",({data:n})=>{n.key,e.navigate("/"),g2()}),e.on("/",()=>{g2()}),e.notFound(()=>{e.navigate("/"),g2()}),e.resolve(),{success:!0}}function bIt(){return new Promise((t,e)=>{UIt();const i=()=>{t()};wIt().then(i,e)})}const IIt=t=>(...e)=>pCe()?t(...e):t(...e).catch(i=>console.log(i));function wIt(){return new Promise((t,e)=>{new Promise((n,r)=>IIt(xc.initDB)().then(t,SIt).then(n,r)).then(t,e)})}function SIt(){Tt.modal.inform({message:'<h2>Database Upgraded</h2><div style="margin: 1em;">Please Close Browser and Re-launch</div>'})}function TIt(t){const e=r=>Object.keys(r).map(a=>r[a]).join(""),i=e(t);ln.messages.reduce((r,a)=>e(a)===i?!0:r,!1)||ln.messages.push(t)}function UIt(){Tt.ee.addListener(AJe,TUe),Tt.ee.addListener("addMessage",TIt)}const DIt=""+new URL("dragmatch-Va2U120p.png",import.meta.url).href;function D2(){MIt(),fvt(),CIt(),p$e(),Wte("login"),Wte("burger"),tvt("config"),Tt.drawer=Vvt(),bIt().then(EIt,t=>console.log({err:t}))}function EIt(){console.log("%c TMX ready","color: lightgreen"),lCe(),NIt(),document.getElementById(XD).onclick=()=>Tt.router.navigate(`/${bh}`),yIt(),uot()}function CIt(){Tt.dragMatch=new Image,Tt.dragMatch.src=DIt,Tt.ee=new hvt}const PIt="ResizeObserver loop limit exceeded",RIt="ResizeObserver loop completed with undelivered notifications.";function MIt(){ln.device=_It();const t=at.version();console.log(`%cversion: ${t9}`,"color: lightblue"),console.log(`%cfactory: ${t}`,"color: lightblue"),AIt()}function NIt(){const t=ks.topicConstants;B0.setSubscriptions({subscriptions:{[t.MODIFY_MATCHUP]:e=>{var n;const i=(n=e.matchUp)==null?void 0:n.matchUpId;Tt.matchUpsToBroadcast.push(i),ln.devNotes&&console.log("MODIFY_MATCHUP",e)}}})}function AIt(){window.addEventListener("error",t=>{if([PIt,RIt].includes(t.message)){const e=document.getElementById("webpack-dev-server-client-overlay-div"),i=document.getElementById("webpack-dev-server-client-overlay");i&&i.setAttribute("style","display: none"),e&&e.setAttribute("style","display: none")}})}function _It(){let t=kIt();return{isStandalone:t&&"standalone"in t&&t.standalone,isIDevice:t&&/iphone|ipod|ipad/i.test(t.userAgent),isIpad:t&&/iPad/i.test(t.userAgent),isWindows:t&&/indows/i.test(t.userAgent),isMobile:t&&/Mobi/.test(t.userAgent)}}function kIt(){try{return navigator||window.navigator}catch{return}}if(window.attachEvent)window.attachEvent("onload",D2);else if(window.onload){const t=window.onload,e=i=>{t(i),D2()};window.onload=e}else window.onload=D2;c$e();d$e();
//# sourceMappingURL=index-C3bZimQr.js.map
