var _Re=Object.defineProperty;var kRe=(t,e,i)=>e in t?_Re(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i;var et=(t,e,i)=>kRe(t,typeof e!="symbol"?e+"":e,i);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const a of r)if(a.type==="childList")for(const s of a.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&n(s)}).observe(document,{childList:!0,subtree:!0});function i(r){const a={};return r.integrity&&(a.integrity=r.integrity),r.referrerPolicy&&(a.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?a.credentials="include":r.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function n(r){if(r.ep)return;r.ep=!0;const a=i(r);fetch(r.href,a)}})();const Cs=function(){let t={},e={},i="gbr";t.define=({ioc:r,idiom:a})=>{e[r]=a},t.set=r=>{if(!r)return i;if(e[r])return i=r,e[r]},t.options=()=>Object.keys(e),t.current=()=>e[i];function n(r){if(!r)return"";let a=e[i],s=r.split(".");for(;s.length;){let o=s.shift();a=(a==null?void 0:a[o])||""}return a}return t.tr=r=>{if(!r)return"";if(n(r))return n(r);let a=e.default,s=r.split(".");for(;s.length;){let o=s.shift();a=(a==null?void 0:a[o])||""}return a},t.obj=r=>{var a;return r?(a=e==null?void 0:e[i])!=null&&a[r]?e[i][r]:e.default[r]?e.default[r]:{}:""},e.default={open:"Open",zoom:"Zoom",addcourts:"Add Courts",login:"Login",logout:"Logout",passwd:"Password",lang:"Language",menu:"Menu",main:"Main Menu",local:"Local Data",save:"Save",side:"Side",bye:"BYE",select:"Select",selected:"Selectd",group:"GROUP",administrator:"Administrator",revoke:"Revoke",tour:"Tour",noresults:"No Results",delete:"Delete",continue:"Do you wish to continue?",notes:"Notes",social:"Social Media",stats:"Statistics",merge:"Merge",week:"Week",warn:"WARNING",add:"Add",remove:"Remove",ptz:"Penalties",replace:"Replace",dl:"Download",or:"or",arp:"All Ranking Points",rlp:"Points - Ranking Lists",trn:"Tournament",tnz:"Tournaments",enable:"Enable",disable:"Disable",rnd:"Round",dt:"Date",fmt:"Format",cat:"Category",cta:"Cat.",team:"Team",tmz:"Teams",rnk:"Rank",rnkz:"Rankings",rtg:"Rating",rtz:"Ratings",prnk:"Rank",trnk:"Rank",rl:"Rank List",rlo:"Rank Order",alpha:"Alphabetical",opnt:"Opponent",ply:"Player",pyr:"Players",sgi:"Sign-In",sgo:"Sign-Out",scr:"Score",pts:"Points",allmatches:"All Matches",allteams:"All Teams",mts:"Matches",emts:"Matches",ests:"Sets",egms:"Games",epts:"Points",mtc:"Match",drw:"Draw",drz:"Draws",ent:"Event",evt:"Events",sch:"Schedule",rename:"Rename",crt:"Courts",ct:"Court",on:"On",off:"Off",id:"ID",nm:"Name",fnm:"First Name",lnm:"Last Name",nnm:"Nickname",attr:"Attribute",bd:"Birthday",yr:"Year",byr:"Birth Year",tot:"Total",sgl:"Singles",dbl:"Doubles",pyo:"Playoff",adh:"Ad-Hoc",snr:"Senior",unk:"Unknown",dup:"Duplicate",stt:"Status",ord:"Order",clb:"Club",scl:"School",cty:"City",state:"State",cnt:"Country",kwn:"Known",ioc:"IOC",act:"Action",agd:"Assigned",igr:"Ignore",igd:"Ignored",edt:"Edit Player",idp:"Identify Player",dlp:"Delete Player",sbt:"Submit",ccl:"Cancel",clr:"Clear",und:"Undo",apt:"Accept",dss:"Dismiss",frm:"From",to:"To",h2h:"Head-to-Head",reg:"Registered",gdr:"Gender",dtp:"Draw Type",drp:"Draw Position",manual:"Manual Draw",adr:"Automated Draw",mdo:"Draw Order",phn:"Phone",view:"View",email:"Email",asn:"Association",start:"Start",end:"End",dates:"Dates",ref:"Referee",time:"Time",duration:"Duration",qualifier:"Qualifier",qualifiers:"Qualifiers",none:"None",keys:"Keys",pos:"Position",seeding:"Seeding",home:"Home",new:"New",inout:"In/Out",indoors:"Indoors",outdoors:"Outdoors",existing:"Existing",success:"Success",loading:"Loading",set:"Settings",version:"Version",messages:"Messages",support:"Support",datastorage:"Data Storage",releasenotes:"Release Notes",documentation:"Documentation",importexport:"Import / Export",newversion:"New Version Available",latitude:"Latitude",longitude:"Longitude",i18n:{previousMonth:"Previous Month",nextMonth:"Next Month",months:["January","February","March","April","May","June","July","August","September","October","November","December"],monthsShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],weekdays:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],weekdaysShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"]},settings:{help:"Help",pagesize:"Page Size",schedule:"Schedule",calendar:"Calendar",search:"Search",documentation:"Documentation Links",hoverhelp:"Hover Hints",diacritics:"Diacritics",lastfirst:"Last name, First name",organization:"Organization",general:"General",categories:"Categories",points:"Points",draws:"Draws",data:"Data",sheetdata:"Sheet Data",publishing:"Publishing",printing:"Printing",savepdfs:"Save PDF",opentabs:"Open in Browser Tabs",compresseddraws:"Compressed Draw Formats",teams:"Teams Displayed",countryflags:"Country Flags Displayed",requireconfirm:"Require Confirmation",publishonscore:"Publish when score entered",publishdrawcreation:"Publish as draw created",matchesbefore:"Matches Before Count",automatedbyes:"Automatic Bye Placement",llallrounds:"LL from All Qualifying Rounds",rrh2hpriority:"RR Head-to-Head priority",qualconsolation:"Qualifying Consolation",consolationalts:"Consolation Alternates",consolationseeds:"Consolation Seeding",gemseeding:"GEM Seeding",adhocelo:"Adhoc ELO Ratings",restrictseedplacement:"Restrict Seed Placement",separate_by_team:"Auto Separate Players by Team",separate_by_ioc:"Auto Separate Players by Country",separate_by_club:"Auto Separate Players by Club",separate_by_school:"Auto Separate Players by School",clear_separation:"Clear Auto Separation",courtdetail:"Court Details",matchtimes:"Match Times",matchdates:"Match Dates",firstday:"Week Starts Monday",time24:"24 Hour Clock",draworderscores:"Scores in Draw Order",schedulecompleted:"Schedule Completed Matches",courtidentifiers:"court identifiers"},round_names:{F:"Final",SF:"Semifinal",QF:"Quarterfinal"},search:{filterplayers:"Filter Players",players:"Search Players",tournaments:"Search Tournaments",clubs:"Search Clubs",approve:"Approve Player",add2team:"Add Team Player",lastfirst:"LAST First",firstlast:"First Last"},formats:{singles:"Singles",doubles:"Doubles",team:"Team"},scoring_format:{set:"Set",sets:"Sets",timedset:"Timed Set",timedsets:"Timed Sets",tiebreak:"Tiebreak",tiebreaks:"Tiebreaks",winby:"Win By",custom:"Custom",bestof:"Best of",tbat:"TB at",finalset:"Final Set",setsto:"Sets to",tbto:"TB to",superto:"To"},scoring:{label:"Scoring",retire:"Retire",default:"Default",walkover:"Walkover",supertiebreak:"Match Tiebreak",normal:"Normal",winloss_abbreviation:"W/L",cancelled:"Cancelled",abandoned:"Abandoned"},draws:{seedlimit:"Seed Limit",blockthreshold:"Block Threshold",generating:"Generating... Please be patient...",generateround:"Generate Round",deleteround:"Delete Round",adhoc:"Adhoc",gemseeding:"GEM Seeding",playerfilter:"Ratings Filter",compass:"Compass",north:"North",south:"South",east:"East",west:"West",northeast:"Northeast",northwest:"Northwest",southeast:"Southeast",southwest:"Southwest",feedin:"Feed-in",staggered:"Staggered",standard:"Standard",elective:"Elective",backdraw:"Backdraw",roundlimit:"Round Limit",structure:"Structure",skiprounds:"Skip Rounds",feedrounds:"Feed Rounds",sequential:"Sequential",brackets:"Brackets",bracketsize:"Bracket Size",roundrobin:"Round Robin",elimination:"Elimination",consolation:"Consolation",qualification:"Qualification",preround:"Pre-Round",incidentals:"Incidentals",remove:"Remove",changestatus:"Change Status",penalty:"Assess penalty",umpire:"Select Referee",matchumpire:"Match Referee",matchtime:"Match Time",starttime:"Start Time",endtime:"Finish Time",resttime:"Rest Time",duration:"Duration",timeheader:"Time Heading",maindraw:"Main Draw",unscheduled:"Unscheduled Matches",scheduled:"Scheduled Matches",completed:"Completed",unpublished:"Unpublished",publisheduptodate:"Up to Date",publishedoutofdate:"Out of Date",published:"Published",publish:"Publish",publishQ:"Publish Draw?",organizers:"Organizers",playerrep:"Representative",playerreps:"Representatives",substitutes:"Substitutes (LL/Alts)",allindraw:"all in draw",lastdirectaccept:"Last Direct Acceptance",clear:"Clear Draw",swap:"Swap Position",alternate:"Alternate",alternatepair:"Alternate Pair",alternateplayer:"Alternate Player",luckyloser:"Lucky Loser",first:"First",last:"Last",seedrange:"Seeds",modifyseeding:"Modify Seeding",playerrange:"All Players",unpublish:"Unpublish Draw",unpublishall:"Unpublish All Events"},print:{publishpdf:"Publish PDF",schedule:"Schedule",draw:"Print",signin:"Sign-In Sheet",ranklist:"Rank List",playerlist:"Player List",matchlist:"Print Match List",matchesbytime:"Matches by Time",pendingmatches:"Pending Matches",matchesbycourt:"Matches by Court",completedmatches:"Completed Matches"},teams:{code:"Code (3 letters)",name:"Name",share:"Share Team",rankings:"Team Rankings",members:"Members",matches:"Matches",winloss:"Won/Lost",newteam:"New Team",createnew:"Create New",submitkey:"Submit Key",nameorkey:"Team Name or Import Key",club:"Club",coaches:"Coaches",school:"School",ioc:"Country",abbreviation:"Abbreviation"},tournament:{organizer_email:"Organizer Email",organizer_phone:"Organizer Phone",judge_email:"Referee Email",judge_phone:"Referee Phone",sponsor:"Sponsor(s)",logo:"Tournament Logo",images:"Tournament Images"},tournaments:{type:"Type",standard:"Standard",dual:"Dual Matches",register:"Register",registration:"Registration Link",team:"Team Tournament",new:"New Tournament",add:"Add Tournament",id:"Tournament ID",loadbyid:"Load by ID",edit:"Edit",copy:"Copy",close:"Close",done:"Finish",import:"Import Record",removeall:"Remove All",addall:"Add All",destroyall:"Destroy All",key:"Authorization",noauth:"Not Authorized",unofficial:"Unofficial",auth:"Authorized",fetch:"Download",fetchtournament:"Download Tournament Record",convert:"Convert to TODS / Save",send:"Upload Tournament Record",export:"Export Tournament Record",renewlist:"Renew List",natlassoc:"National Association",tennisclub:"Tennis Club",received:"Received Tournament Record",existing:"Existing Tournament Record",publishtime:"Publish Time",replacelocal:"Replace Local Copy?",unpublish:"Unpublish Tournament?"},ddlb:{singles:"Singles Tournament Rank:",doubles:"Doubles Tournament Rank:",category:"Tournament Category:",draws:"Select Event:",direction:"Select Draw:"},phrases:{remember_me:"Remember Me",forgot_passwd:"Forgot Password",no_account:"No account? Sign Up",selectlanguage:"Select Language",setupcourts:"Set up your courts",courtsmsg:"Before you can schedule matches we need to know more about your courts. To get started, add some court details.",sortorder:"Sort Order",eventcorrupted:"Event is Corrupted: Development Notified",singlesrankings:"Singles Rankings",doublesrankings:"Doubles Rankings",sectionscroll:"Section Scrolling",dynamicrating:"Dynamic Rating",recalcdynamic:"Re-Calculate Dynamic Rating",comingsoon:"New Feature: Coming Soon!",finalrounds:"Final Rounds",sendplayerdb:"Send Player Database",prerelease:"Pre-release version of TMX",feedback:"Please send all feedback and support requests to",improperauth:"Improper Authorization Credentials",noexportformats:"No Export Formats Enabled",verifyranking:"Please Verify Player Ranking!",nomatches2schedule:"No Matches to Schedule!",addimage:"Enter full website address for an image",addgooglemap:'Enter full URL, not "Link to Share"',retrieveFromServer:"Retrieve from CourtHive Server?",mainmenu:"Main Menu",rankbyrating:"Rank by Rating",dblsrankisrating:"Use Rating as Doubles Ranking?",sheetdataurls:"Enter Google Sheet URLs for Synchronizing Data",playerimport:"Player Import",entersheeturl:"Enter Sheet URL",entergooglemapsurl:"Enter Google Maps link",invalidurl:"Invalid URL(s)",invalidsheeturl:"Invalid Sheet URL",invalidgooglemapsurl:"Invalid Google Maps Link",geolocationdenied:"Geolocation has been denied",unblockgeo:"Unblock in browser settings",usecurrentlocation:"Use your current position?",updatelatlng:"Update Latitude/Longitude?",cleardraw:"Existing Draw will be cleared!",clearselection:"Clear Selection",selectplayer:"Select Player",matches2clear:"Matches to be cleared from the schedule",changeapproved:"Changing Approved will reset the draw and clear the schedule.",qualincomplete:"Qualifying Draw is Incomplete",delegate:"Delegate",delegate2mobile:"Delegate to Mobile",revokedelegation:"Revoke Delegation",delegationrevoked:"Delegation has been revoked",qrcode:"QR Code",scanQRcode:"Scan QR Code with Mobile",ranklists:"Rank Lists for",reset:"Database will be reset",action:"Players requiring some action...",search:"Use the search field above to find players, or click player to edit",assign:"Assign this profile by clicking a player below, or ...",accept:"Accept all players",trnyz:"Loading Tournaments ...",loadplayers:"Load Players",badfile:"File Not Recognized",invalid:"Invalid file type",fileerror:"Error reading file",servererror:"Error Message from Server",notfound:"Not Found",pointcalc:"Point calculation requires tournament category and rank",drawcreated:"Draw Created",drawactive:"Active Draw",notcreated:"Not Created",importdata:"Import Data",exportdata:"Export Data",importtemplate:"Import Template",draganddrop:"Drag and Drop files into this zone",schedulematches:"Schedule Matches",notconfigured:"Not Configured",cannotsignout:"Cannot Sign Out",cannotchangerank:"Cannot Change Rank",cannotchangewinner:"Cannot Change Winner",matchmustbecomplete:"Match Must Be Complete!",approvedplayer:"Player Approved for an Event",locallycreated:"Locally Created Tournament",noremote:"No Remote Registrations to Update",calculateranking:"Calculate Ranking Points",generateranklist:"Generate Rank List",generatekey:"Generate Key",norankingdata:"No Ranking Data",oop_system:"Order of Play",schedulepublished:"Publishing Time:",timestamp:"Date/Time: ",rankedplayers:"Ranked Players",judgesignature:"Signature of Head Umpire:",nopointcalcs:"No Point Calculations for given date",downloadtemplate:"Download Import Template",add2database:"Add Players, Tournaments, Rankings to Database",noconnection:"No Connection",schedulepriority:"Match Scheduling Priority",send:"Send",sendTODS:"Send TODS Tournament Record",export:"Export",pointsvalidfrom:"Points Valid From",linkcopied:"Link Copied to Clipboard",keycopied:"Key Copied to Clipboard",submitkey:"Enter New Key",selectkey:"Select Key",deletereplace:"Delete / Replace",weblink:"Web Link",nomatches:"No Matches",updatedioc:"Update Language File",revokeauth:"Revoke Authorization?",clearalldays:"Clear All Days?",cantdelqual:"Cannot Delete: Qualified Player Active in Main Draw",cantrefresh:"Offline: Cannot Refresh",blocked:"Pop-Up Windows are blocked by your browser",enablepopups:"Please enable Pop-Ups for PDF printing",nopersist:"Data Persistence not guaranteed"},events:{name:"Name",newevent:"New Event",customname:"Custom Name",enableeligibility:"Enable Eligibility Filter",disableeligibility:"Disable Eligibility Filter",teamevent:"Team Event",opponents:"Opponents",matchprofile:"Match Profile",teams:"Teams",draw_type:"Draw Type",draw_size:"Draw Size",created:"Created",category:"Category",rank:"Rank",surface:"Surface",approveteam:"Approve",destroyteam:"Destroy",entered:"Entered",approved:"Approved",eligible:"Eligible",ineligible:"Ineligible",unavailable:"Unavailable",wildcard:"Wildcard",received:"Received Event(s)",toggle:"Toggle Publish State?",modifyranking:"Modify Ranking"},locations:{newlocation:"New Location",abbreviation:"Abbreviation",name:"Name",address:"Address",courts:"Courts",identifiers:"Court IDs"},genders:{male:"Male",male_abbr:"M",female:"Female",female_abbr:"W",mixed:"Mixed"},surfaces:{clay:"Clay",hard:"Hard",grass:"Grass",carpet:"Carpet"},actions:{ok:"OK",actions:"Actions",add_event:"Add Event",save_event:"Save Event",save_team:"Save Team",save_location:"Save Location",done:"Done",cancel:"Cancel",refresh:"Refresh",remakedraw:"Remake Draw",delete_event:"Delete Event",delete_team:"Delete Team",delete_match:"Delete Match",add_player:"Add Player",add_team:"Add Team",create_team:"Create team",generate_team:"Generate Team",publish:"Publish",unpublish:"Unpublish",manage_players:"Manage Players",manage_teams:"Manage Teams",add_location:"Add Location",delete_location:"Delete Location",delete_tournament:"Delete tournament",edit_tournament:"Edit Tournament",copy_tournament:"Copy Tournament",createteambyattr:"Create team",add2localdb:"Add Players to Local Database",signoutunapproved:"Sign Out players not approved for Events"},requests:{syncClubs:"Synchronize Clubs",syncTournaments:"Synchronize Tournaments",syncPlayers:"Synchronize players"},signin:{tournament_date:"Start Date",organization:"Organization",place:"Location",id:"Tournament ID",rank:"Tournament Rank",judge:"Head Umpire",doc_name:"SIGN-IN SHEET",doc_subname:" ",signature:"Signature",registered:"Registered Players",notsignedin:"Not Signed In",signedin:"Signed In",withdrawn:"Withdrawn",medical:"Medical",registration:"Registration",medical_issues:"Medical Expired",create_new_player:"Create New",modifyrankings:"Modify Rankings",acceptrankings:"Accept Rankings",reglink:"Set Link"},schedule:{column:"Column",rows:"Schedule Rows",startrow:"Start Row",alldraws:"All Draws",allevents:"All Events",allrounds:"All Rounds",allcourts:"All Courts",alldual:"All Dual Matches",autoschedule:"Auto Schedule",highlightteam:"Highlight Team",limit:"Limit",clearschedule:"Clear Schedule",clearcompleted:"Clear Completed Matches",orderofplay:"ORDER OF PLAY",matchestime:"Matches => Time",notbefore:"Not Before",nb:"NB",followedby:"Followed By",afterrest:"After Rest",raindelay:"Rain Delay",tba:"TBA",nextavailable:"Next Available",called:"Called",oncourt:"On Court",warmingup:"Warming Up",suspended:"Suspended",abandoned:"Abandoned",clear:"Clear",publish:"Publish Schedule",view:"View Schedule",unpublish:"Unpublish Schedule",timing:"Timing",vs:"vs.",umpirenotes:"Umpire Notes",notice:"Schedule Notice",opponentname:"Opponent Name",scheduled:"Scheduled"},penalties:{fail2signout:"Failed to Sign Out",illegalcoaching:"Illegal Coaching",ballabuse:"Ball Abuse",racquetabuse:"Racquet Abuse",equipmentabuse:"Equipment Abuse",cursing:"Swearing",rudegestures:"Rude Gestures",foullanguage:"Foul Language",timeviolation:"Time Violation",latearrival:"Late Arrival",unsporting:"Unsporting Behavior"},datelocalization:"en-EN"},t}();function Ot(t){return typeof t=="function"}function xRe(t){return typeof t=="string"}function Up(t){return typeof t=="object"&&!Array.isArray(t)}function ORe(t,e=0){let i=e,n,r;const a=()=>{i-=new Date-r,window.clearTimeout(n)},s=()=>i=e,o=()=>{r=new Date,n=window.setTimeout(function(){i=e,t()},i)};return o(),{pause:a,resume:o,reset:s}}var LRe=Object.defineProperty,Li=(t,e)=>{for(var i in e)LRe(t,i,{get:e[i],enumerable:!0})};function qT(){return"2.2.11"}var Jk={};Li(Jk,{competitionGovernor:()=>pz,drawsGovernor:()=>vq,entriesGovernor:()=>GW,eventGovernor:()=>qW,generationGovernor:()=>i4,matchUpFormatGovernor:()=>Zf,matchUpGovernor:()=>a4,mocksGovernor:()=>XO,participantGovernor:()=>N4,policyGovernor:()=>pW,publishingGovernor:()=>rL,queryGovernor:()=>CC,reportGovernor:()=>_4,scheduleGovernor:()=>k4,scoreGovernor:()=>Hv,tieFormatGovernor:()=>O4,tournamentGovernor:()=>B4,venueGovernor:()=>j4});var pz={};Li(pz,{getLinkedTournamentIds:()=>HP,getTournamentIds:()=>jP,linkTournaments:()=>eoe,mutate:()=>cre,query:()=>noe,unlinkTournament:()=>ioe,unlinkTournaments:()=>toe});var cre={};Li(cre,{linkTournaments:()=>eoe,unlinkTournament:()=>ioe,unlinkTournaments:()=>toe});var _b="SINGLES",xn="SINGLES",Zv="DOUBLES",Mn="DOUBLES",ec="TEAM",Zn="TEAM",ure={SINGLES_MATCHUP:_b,SINGLES:xn,DOUBLES_MATCHUP:Zv,DOUBLES:Mn,TEAM_MATCHUP:ec,TEAM:Zn},dre={[xn]:[xn,"S"],[Mn]:[Mn,"D"],[Zn]:[Zn,"T"],S:[xn,"S"],D:[Mn,"D"],T:[Zn,"T"]};function ia(t,e){return(t??0)-(e??0)}function ui(t){return typeof t=="number"?parseInt(t.toString()):typeof t=="string"?parseInt(t):0}function Rd(t){return isNaN(t)?!1:t&&(t&t-1)===0}function OK(t){if(!t.length)return;let e=[...t].sort(ia),i=Math.floor(e.length/2);return e.length%2?e[i]:(e[i-1]+e[i])/2}function FRe(t){if(!Rd(t))return!1;let e=t,i=1;for(;e!==2;)i+=1,e=e/2;return i}function hz(t){return isNaN(t)?0:t%2&&t+1||t}function fz(t){return Math.pow(2,Math.round(Math.log(t)/Math.log(2)))}function Dr(t){return!isNaN(parseFloat(t))}function pre(t){let e=ui(t);if(!isNaN(e))return e===0?!1:(e&-e)===1}function WT(t){if(isNaN(t))return!1;for(;!Rd(t);)t++;return t}function Ac(t,e){return t=Math.ceil(t),e=Math.floor(e),Math.floor(Math.random()*(e-t+1))+t}function Ii(t){return Number.isSafeInteger(typeof t=="string"?+t:t)}function $Re(t=1,e=3,i=!0){let n=0;for(let r=0;r<e;r++)n+=Math.random()*(t/e);return i&&t>1?Math.round(n):n}function BRe(t,e){e||(e=1);let i=1/e;return Math.round(t*i)/i}function hre(t,e,i,n,r=2){let a=1-Math.random(),s=1-Math.random(),o=Math.sqrt(-2*Math.log(a))*Math.cos(2*Math.PI*s);return o=o/10+.5,o>1||o<0?o=hre(t,e,i):(o=Math.pow(o,i),o*=e-t,o+=t),n&&(o=BRe(o,n)),parseFloat(o.toFixed(r))}function _A(t,e=2){return parseFloat(Number(Math.round(t*1e3)/1e3).toFixed(e))}function Ei(t){return Array.isArray(t)?t==null?void 0:t.filter((e,i,n)=>n.lastIndexOf(e)===i):[]}function VRe(t){return Array.isArray(t)?t==null?void 0:t.map(e=>e===null?void 0:e):t}function so(t){return Array.isArray(t)?t.map(e=>[Math.random(),e]).sort((e,i)=>e[0]-i[0]).map(e=>e[1]):[]}function PS(t){return Ii(t)?t:1/0}function Ml(t){return Array.isArray(t)?t.reduce((e,i)=>(e[i]||(e[i]=0),e[i]++,e),{}):{}}function jRe(t){return fre(Ml(t))}function fre(t){return Object.keys(t).reduce((e,i)=>{let n=t[i];return e[n]?e[n].push(i):e[n]=[i],e},{})}function GRe(t,e,i){return i.indexOf(t)===e}function mre(t){return t.filter(GRe)}function Tl(t){return Array.isArray(t)&&t.length?t.splice(Math.floor(Math.random()*t.length),1)[0]:void 0}function wl(t){let e=Math.floor(Math.random()*t.length);return t[e]}function Rt(t,e){return Array.from({length:e-t},(i,n)=>n+t)}function fp(t,e){return e.reduce((i,n,r)=>(n===t&&i.push(r),i),[])}function Nr(t,e){return!Array.isArray(t)||!Array.isArray(e)?[]:t.filter(i=>e.indexOf(i)!==-1).filter((i,n,r)=>r.indexOf(i)===n)}function LK(t,e){return!Array.isArray(t)||!Array.isArray(e)?[]:t.filter(i=>!e.includes(i))}function ho(t,e){return!Array.isArray(t)||!Array.isArray(e)?!1:t.some(i=>e.includes(i))}function HRe(t,e){return Array.isArray(e)&&e.reduce((i,n)=>(i[n]=1+i[n]||1,i),{})[t]||0}function zRe(t,e,i,n){return Array.isArray(t)?[].concat(...t.slice(0,e),...t.slice(e,e+i).sort(n),...t.slice(e+i,t.length)):[]}function Ra(t,e){return Array.isArray(t)?t.reduce((i,n,r)=>{let a=Math.floor(r/e);return i[a]=[].concat(i[a]||[],n),i},[]):[]}function gre(t,[e,...i]){return t.length?[t.slice(0,e),...gre(t.slice(e),[...i,e])]:[]}function qRe(t){return t.reduce((e,i)=>{let n=e[e.length-1];return(!n||n[n.length-1]!==i-1)&&e.push([]),e[e.length-1].push(i),e},[])}function vre(t){return Array.isArray(t)?t.reduce((e,i)=>!isNaN(parseInt(i))&&e,!0):!1}function yre(t){return Array.isArray(t)?t.reduce((e,i)=>isNaN(parseInt(i))&&e,!0):!1}function vV(t,e,i){return Array.isArray(t)?t.reduce((n,r,a)=>{let s=i?!!(Math.floor(a/e)%2):!1,o=a%e,l=s?e-1-o:o;return n[l]||(n[l]=[]),n[l].push(r),n},[]):[]}function WRe(t,e=1){if(!Array.isArray(t)||!t.every(Ii))return[];let i=Math.min(...t,e),n=Math.max(...t);return Rt(i,n+1).filter(r=>!t.includes(r))}function xo(t){return typeof t=="function"}function nr(t){return typeof t=="string"}function Xi(t){return t!==null&&typeof t=="object"&&!Array.isArray(t)}function YRe(t,e){if(!Xi(t)||!Xi(e))return!1;let i=Object.keys(t),n=Object.keys(e);if(i.length!==n.length)return!1;for(let r of i)if(t[r]!==e[r])return!1;return!0}function bre(t,e){return Array.isArray(t)?Object.assign({},...(t??[]).filter(Xi).map(i=>i[e]&&{[i[e]]:i}).filter(Boolean)):{}}var KRe=t=>e=>Object.keys(t).every(i=>e[i]===t[i]);function yV(t,e){if(t===void 0)return null;if(!Xi(t)||t===null)return t;let i=Object.keys(t),n=r=>r===void 0?null:r;return Object.assign({},...i.map(r=>Array.isArray(t[r])?{[r]:e?t[r]:t[r].map(a=>yV(a))}:{[r]:e?n(t[r]):yV(t[r])}))}function bV(t){return Array.isArray(t)?t.length+t.map(bV).reduce((e,i)=>e+i,0):Xi(t)&&t!==null?Object.keys(t).length+Object.keys(t).map(e=>bV(t[e])).reduce((e,i)=>e+i,0):0}function ZRe(t){if(t===null||typeof t!="object")return;let e=JSON.stringify(t),i=bV(t),n=e.split("").reduce((r,a)=>r+a.charCodeAt(0),0);return[e.length,i,n].map(r=>r.toString(36)).join("")}function Qk(t,e){return!Array.isArray(t)||!nr(e)?!1:Nr(t,dre[e]).length}var de={success:!0},Ire="error",wre={SUCCESS:de,ERROR:Ire};function Sre({collectionValueProfiles:t,matchUpCount:e}){let i=[];if(!Array.isArray(t))return i.push(`collectionValueProfiles is not an array: ${t}`),{errors:i};if(t.length&&t.length!==e)return i.push("collectionValueProfiles do not align with matchUpsCount"),{errors:i};for(let r of t){if(typeof r!="object")return i.push(`valueProfile is not type object: ${r}`),{errors:i};let{matchUpValue:a,collectionPosition:s}=r;if(typeof a!="number"||typeof s!="number"||s>e||s<1)return i.push("Invalid value profile: value and collectionPosition must be numeric. collectionPosition cannot be greater than matchUpCount"),{errors:i}}let n=t.map(r=>r.collectionPosition);return n.length!==Ei(n).length?(i.push("collectionPositions are not unique"),{errors:i}):{...de}}var uS={};Li(uS,{addNotice:()=>Si,callListener:()=>ZD,createInstanceState:()=>_ae,cycleMutationStatus:()=>jz,deepCopyEnabled:()=>Vz,deleteNotice:()=>zz,deleteNotices:()=>zI,disableNotifications:()=>xae,enableNotifications:()=>ON,getDevContext:()=>ic,getMethods:()=>Gz,getNotices:()=>Hz,getProvider:()=>RV,getTopics:()=>dc,getTournamentId:()=>qI,getTournamentRecord:()=>qz,getTournamentRecords:()=>Lg,globalLog:()=>Bae,handleCaughtError:()=>gx,hasTopic:()=>fx,removeTournamentRecord:()=>$ae,setDeepCopy:()=>KD,setDevContext:()=>YD,setGlobalLog:()=>kae,setGlobalMethods:()=>Oae,setGlobalSubscriptions:()=>NMe,setMethods:()=>Lae,setStateMethods:()=>Vae,setStateProvider:()=>RMe,setSubscriptions:()=>AMe,setTournamentId:()=>XD,setTournamentRecord:()=>Fae,setTournamentRecords:()=>mx,timeKeeper:()=>MMe});var IV={message:"Chronological error; time violation.",code:"ANACHRONISM"},qD={message:"Duplicate entry",code:"DUPLICATE_ENTRY"},Tre={message:"Cannot remove main structure",code:"ERR_CANNOT_REMOVE_MAIN_STRUCTURE"},wV={message:"records must be an object with tournamentId keys",code:"ERR_INVALID_TOURNAMENTS"},wr={message:"Missing tournamentRecords",code:"ERR_MISSING_TOURNAMENTS"},ut={message:"Missing tournamentRecord",code:"ERR_MISSING_TOURNAMENT"},CP={message:"Invalid tournamentRecord",code:"ERR_INVALID_TOURNAMENT"},CS={message:"Missing tournamentId",code:"ERR_MISSING_TOURNAMENT_ID"},kb={message:"Invalid drawDefinition",code:"ERR_INVALID_DRAWDEF"},Gt={message:"Missing drawDefinition",code:"ERR_MISSING_DRAWDEF"},Ure={message:"Existing drawDefinition(s)",code:"ERR_EXISTING_DRAWDEFS"},tc={message:"drawDefinition not found",code:"ERR_NOT_FOUND_DRAWDEF"},My={message:"Invalid structure",code:"ERR_INVALID_STRUCTURE"},mz={message:"Incomplete source structure",code:"ERR_INCOMPLETE_STRUCTURE"},gz={message:"Invalid drawPosition for seedAssignment",code:"ERR_INVALID_SEEDING_POSITION"},RS={message:"drawPosition already assigned",code:"ERR_EXISTING_POSITION_ASSIGNMENT"},Dre={message:"Schedule not cleared",code:"ERR_UNCHANGED_SCHEDULE_NOT_CLEARED"},Ere={message:"drawPosition not cleared",code:"ERR_FAILURE_POSITION_NOT_CLEARED"},XRe={message:"drawPosition not found",code:"ERR_NOT_FOUND_DRAW_POSITION"},vz={message:"Unrecognized drawType",code:"ERR_UNRECOGNIZED_DRAW_TYPE"},RP={message:"Missing drawPositions",code:"ERR_MISSING_DRAW_POSITIONS"},ex={message:"drawPosition is active",code:"ERR_ACTIVE_DRAW_POSITION"},JRe={message:"drawPosition is occupied",code:"ERR_OCCUPIED_DRAW_POSITION"},YT={message:"Invlid drawPosition",code:"ERR_INVALID_DRAW_POSITION"},KT={message:"Missing drawPosition",code:"ERR_MISSING_DRAW_POSITION"},yz={message:"Invalid drawType",code:"ERR_INVALID_DRAW_TYPE"},tx={message:"Invalid drawSize",code:"ERR_INVALID_DRAW_SIZE"},bz={message:"Cannot set drawSize to be less than existing entries",code:"ERR_INVALID_DRAW_SIZE_MISMATCH"},MP={message:"Missing drawSize",code:"ERR_MISSING_DRAW_SIZE"},Vd={message:"Missing drawId",code:"ERR_MISSING_DRAW_ID"},Pre={message:"drawId exists",code:"ERR_EXISTING_DRAW_ID"},Cre={message:"participantId cannot be assigned to multiple seedNumbers",code:"INVALID_PARTICIPANT_SEEDING"},Rre={message:"seedsCount greater than drawSize",code:"ERR_INVALID_SEED_COUNT"},Mre={message:"Missing seedCountThresholds",code:"ERR_MISSING_SEED_COUNT_THRESHOLD"},Nre={message:"Invalid action",code:"ERR_INVALID_ACTION"},SV={message:"Invalid assignment",code:"ERR_INVALID_ASSIGNMENT"},Are={message:"Missing seedAssignments",code:"ERR_MISSING_SEED_ASSIGNMENTS"},_re={message:"Invalid seedNumber",code:"ERR_INVALID_SEED_NUMBER"},kre={message:"Invalid seedPosition",code:"ERR_INVALID_SEED_POSITION"},Iz={message:"Missing targetLink",code:"ERR_MISSING_LINK_TARGET"},xre={message:"Existing round",code:"ERR_EXISTING_ROUND"},QRe={message:"Missing roundNumber",code:"ERR_MISSING_ROUND_NUMBER"},uc={message:"Missing structureId",code:"ERR_MISSING_STRUCTURE_ID"},gr={message:"structure not found",code:"ERR_NOT_FOUND_STRUCTURE"},wz={message:"Missing structures",code:"ERR_MISSING_STRUCTURES"},Ny={message:"Missing structure",code:"ERR_MISSING_STRUCTURE"},Ore={message:"drawDefinition contains unlinked structures",code:"ERR_MISSING_STRUCTURE_LINKS"},_h={message:"Invalid eventType",code:"ERR_INVALID_EVENT_TYPE"},Jn={message:"Missing event / eventId",code:"ERR_MISSING_EVENT_ID"},Gc={message:"Event not found",code:"ERR_NOT_FOUND_EVENT"},Lre={message:"Event exists",code:"ERR_EXISTING_EVENT"},Fre={message:"Missing entries",code:"ERR_MISSING_ENTRIES"},$re={message:"Invalid entries",code:"ERR_INVALID_ENTRIES"},Sz={message:"Missing assignments",code:"ERR_MISSING_ASSIGNMENTS"},Bre={message:"Missing stage",code:"ERR_MISSING_STAGE"},Ay={message:"Invalid stage",code:"ERR_INVALID_STAGE"},Vre={message:"stageSequence limit",code:"ERR_LIMIT_STAGE_SEQUENCE"},jre={message:"Missing positionAssignments",code:"ERR_MISSING_POSITION_ASSIGNMENTS"},Gre={message:"Cannot Assign BYE status if no assignment: { bye: true }",code:"ERR_UNCHANGED_CANNOT_ASSIGN_BYE"},TV={message:"Unrecognized matchUpStatus",code:"ERR_UNRECOGNIZED_MATCHUP_STATUS"},NP={message:"Unrecognized matchUpFormat",code:"ERR_UNRECOGNIZED_MATCHUP_FORMAT"},kN={message:"Incompatible matchUpStatus",code:"ERR_INCOMPATIBLE_MATCHUP_STATUS"},ZT={message:"Invalid matchUpStatus",code:"ERR_INVALID_MATCHUP_STATUS"},Ih={message:"Invalid tieFormat",code:"ERR_INVALID_TIE_FORMAT"},Tz={message:"Invalid matchUpFormat",code:"ERR_INVALID_MATCHUP_FORMAT"},Uz={message:"Missing matchUpFormat",code:"ERR_MISSING_MATCHUP_FORMAT"},Hre={message:"Missing collectionDefinition",code:"ERR_MISSING_COLLECTION_DEFINITION"},XT={message:"Missing tieFormat",code:"ERR_MISSING_TIE_FORMAT"},Ks={message:"Missing matchUpId",code:"ERR_MISSING_MATCHUP_ID"},BI={message:"Missing matchUpIds",code:"ERR_MISSING_MATCHUP_IDS"},_s={message:"matchUp not found",code:"ERR_NOT_FOUND_MATCHUP"},ym={message:"Missing matchUps",code:"ERR_MISSING_MATCHUPS"},rl={message:"Missing matchUp",code:"ERR_MISSING_MATCHUP"},al={message:"Invalid matchUp",code:"ERR_INVALID_MATCHUP"},Dz={message:"Missing policyType",code:"ERR_MISSING_POLICY_TYPE"},ix={message:"Missing policyDefinitions",code:"ERR_MISSING_POLICY_DEFINITIONS"},eMe={message:"Missing seeding policy",code:"ERR_MISSING_POLICY_SEEDING"},zre={message:"Missing avoidance policy",code:"ERR_MISSING_POLICY_AVOIDANCE"},Ez={message:"Missing policy attributes",code:"ERR_MISSING_POLICY_ATTRIBUTES"},qre={message:"Invalid policyDefinitions",code:"ERR_INVALID_POLICY_DEFINITIONS"},Pz={message:"existing policyType",code:"ERR_EXISTING_POLICY_TYPE"},tMe={message:"Policy not attached",code:"ERR_FAILURE_POLICY_NOT_ATTACHED"},xb={message:"Policy not found",code:"ERR_NOT_FOUND_POLICY"},iMe={message:"Missing scoring policy / matchUpFormats",code:"ERR_MISSING_POLICY_SCORING_MATCHUP_FORMATS"},Cz={message:"Invalid sideNumber",code:"ERR_INVALID_SIDE_NUMBER"},nMe={message:"Invalid setNumber",code:"ERR_INVALID_SET_NUMBER"},nx={message:"Missing setObject",code:"ERR_MISSING_SET_ATTRIBUTE"},rMe={message:"Missing setNumber",code:"ERR_MISSING_SET_NUMBER"},aMe={message:"Missing sideNumber",code:"ERR_MISSING_SIDE_NUMBER"},VI={message:"Missing courtId",code:"ERR_MISSING_COURT_ID"},ai={message:"Missing value",code:"ERR_MISSING_VALUE"},Wre={message:"Missing birthdate",code:"ERR_MISSING_BIRTH_DATE"},Yre={message:"Missing date",code:"ERR_MISSING_DATE"},Kre={message:"No valid dates",code:"ERR_NO_VALID_DATES"},kA={message:"Invalid bookings",code:"ERR_INVALID_BOOKINGS"},xN={message:"Invalid dateAvailability",code:"ERR_INVALID_DATE_AVAILABILITY"},Zre={message:"Missing dateAvailability",code:"ERR_MISSING_DATE_AVAILABILITY"},Fa={message:"Invalid Date",code:"ERR_INVALID_DATE"},bu={message:"Invalid time",code:"ERR_INVALID_TIME"},Xre={message:"Invalid tournament dates",code:"ERR_INVALID_DATES_TOURNAMENT"},UV={message:"Invalid game scores",code:"ERR_INVALID_SCORES_GAME"},Jre={message:"Invalid score",code:"ERR_INVALID_SCORE"},rx={message:"Invalid winningSide",code:"ERR_INVALID_WINNING_SIDE"},sMe={message:"No participants generated",code:"ERR_NO_PARTICIPANTS_GENERATED"},Rz={message:"Cannot modify tieFormat",code:"ERR_UNCHANGED_CANNOT_MODIFY_TIEFORMAT"},Qre={message:"Cannot modify participantType",code:"ERR_UNCHANGED_CANNOT_MODIFY_PARTICIPANT_TYPE"},ax={message:"Cannot remove participants",code:"ERR_UNCHANGED_CANNOT_REMOVE_PARTICIPANTS"},DV={message:"Participant category mismatch",code:"ERR_CATEGORY_MISMATCH"},sx={message:"Cannot change winningSide",code:"ERR_UNCHANGED_CANNOT_CHANGE_WINNING_SIDE"},jI={message:"Invalid participant",code:"ERR_INVALID_PARTICIPANT"},Md={message:"Invalid participantId",code:"ERR_INVALID_PARTICIPANT_ID"},Dl={message:"Invalid participantIds",code:"ERR_INVALID_PARTICIPANT_IDS"},eae={message:"Invalid participantRole",code:"ERR_INVALID_PARTICIPANT_ROLE"},Nd={message:"Invalid participantType",code:"ERR_INVALID_PARTICIPANT_TYPE"},tae={message:"Missing participantRole",code:"ERR_MISSING_PARTICIPANT_ROLE"},GI={message:"Missing participant",code:"ERR_MISSING_PARTICIPANT"},AP={message:"Missing participants",code:"ERR_MISSING_PARTICIPANTS"},la={message:"Missing participantId",code:"ERR_MISSING_PARTICIPANT_ID"},xr={message:"Participant Not Found",code:"ERR_NOT_FOUND_PARTICIPANT"},iae={message:"participantId exists",code:"ERR_EXISTING_PARTICIPANT_ID"},oMe={message:"participant pair exists",code:"ERR_EXISTING_PARTICIPANT_PAIR"},nae={message:"No participant removed",code:"ERR_UNCHANGED_NO_PARTICIPANT_REMOVED"},xg={message:"Missing participantIds",code:"ERR_MISSING_PARTICIPANT_IDS"},rae={message:"Missing participantsCount",code:"ERR_MISSING_PARTICIPANT_COUNT"},aae={message:"Participant not checked in",code:"ERR_UNCHANGED_PARTICIPANT_NOT_CHECKED_IN"},sae={message:"Missing person details",code:"ERR_MISSING_PERSON_DETAILS"},JT={message:"Existing participant drawPosition assignment",code:"ERR_EXISTING_PARTICIPANT_DRAW_POSITION_ASSIGNMENT"},ox={message:"Existing participant",code:"ERR_EXISTING_PARTICIPANT"},Mz={message:"participantsCount exceeds drawSize",code:"ERR_INVALID_PARTICIPANT_COUNT"},EV={message:"Invalid entry status",code:"ERR_INVALID_ENTRY_STATUS"},oae={message:"Participant Entry Not Found",code:"ERR_NOT_FOUND_PARTICIPANT_ENTRY"},lMe={message:"Participant not entered in stage",code:"ERR_UNCHANGED_PARTICIPANT_NOT_ENTERED"},cMe={message:"Participant not found in stageSequence",code:"ERR_NOT_FOUND_PARTICIPANT_IN_STAGE"},lae={message:"entryStatus not allowed in stage",code:"ERR_INVALID_ENTRY_STATUS_IN_STAGE"},cae={message:"entryStatus not allowed for event",code:"ERR_INVALID_ENTRY_STATUS_IN_EVENT"},PV={message:"No stage space available for entryStatus",code:"ERR_UNCHANGED_NO_AVAILABLE_STAGE_SPACE"},uae={message:"Insufficient drawPositions to accommodate qualifiers",code:"ERR_UNCHANGED_NO_DRAW_POSITIONS_FOR_QUALIFIERS"},Nz={message:"Insufficient drawPositions to accommodate entries",code:"ERR_INSUFFICIENT_DRAW_POSITIONS"},dae={message:"Missing penaltyType",code:"ERR_MISSING_PENALTY_TYPE"},Az={message:"Missing penaltyId",code:"ERR_MISSING_PENALTY_ID"},MS={message:"Penalty not found",code:"ERR_NOT_FOUND_PENALTY"},pae={message:"Missing courtsCount/courtNames",code:"ERR_MISSING_COURTS_INFO"},QT={message:"Court not found",code:"ERR_NOT_FOUND_COURT"},hae={message:"Court exists",code:"ERR_EXISTING_COURT"},fae={message:"Venue exists",code:"ERR_EXISTING_VENUE"},HI={message:"Venue not found",code:"ERR_NOT_FOUND_VENUE"},Og={message:"Missing venueId",code:"ERR_MISSING_VENUE_ID"},mae={message:"Invalid endTime",code:"ERR_INVALID_END_TIME"},_z={message:"Existing endTime",code:"ERR_EXISTING_END_TIME"},gae={message:"Invalid stopTime",code:"ERR_INVALID_STOP_TIME"},vae={message:"Invalid startTime",code:"ERR_INVALID_START_TIME"},uMe={message:"Invalid resumeTime",code:"ERR_INVALID_RESUME_TIME"},kz={message:"Invalid timeItem",code:"ERR_INVALID_TIME_ITEMS"},yae={message:"Missing async state provider",code:"ERR_MISSING_ASYNC_STATE_PROVIDER"},xz={message:"Missing timeItem",code:"ERR_MISSING_TIME_ITEM"},Oz={message:"Missing timeItems",code:"ERR_MISSING_TIME_ITEMS"},lx={message:"Missing context",code:"ERR_MISSING_CONTEXT"},bae={message:"Missing schedule",code:"ERR_MISSING_SCHEDULE"},aI={message:"Invalid scaleItem",code:"ERR_INVALID_SCALE_ITEM"},Iae={message:"Modifications failed",code:"ERR_FAILURE_MODIFICATIONS"},eU={message:"No modifications applied",code:"ERR_UNCHANGED_NO_MODIFICATIONS_APPLIED"},wae={message:"Unable to assign court",code:"ERR_UNCHANGED_COURT_NOT_ASSIGNED"},cx={message:"No Candidates",code:"ERR_UNCHANGED_NO_CANDIDATES"},Sae={message:"Invalid configuration",code:"ERR_INVALID_CONFIG"},Tae={message:"Invalid collectionDefinition",code:"ERR_INVALID_COLLECTION_DEFINITION"},bm={message:"Invalid object",code:"ERR_INVALID_OBJECT"},rD={message:"Invalid gender",code:"ERR_INVALID_GENDER"},WD={message:"Invalid category",code:"ERR_INVALID_CATEGORY"},Re={message:"Invalid values",code:"ERR_INVALID_VALUES"},Uae={message:"Duplicate value",code:"ERR_DUPLICATE_VALUE"},Lz={message:"Team not found",code:"ERR_NOT_FOUND_TEAM"},Dae={message:"No valid actions",code:"ERR_NO_VALID_ACTIONS"},ux={message:"No valid attributes",code:"ERR_NO_VALID_ATTRIBUTES"},Fz={message:"Value unchanged",code:"ABORT_UNCHANGED"},za={message:"Not found",code:"ERR_NOT_FOUND"},dx={message:"Not implemented",code:"ERR_NOT_IMPLEMENTED"},Eae={message:"Existing flight",code:"ERR_EXISTING_FLIGHT"},$z={message:"Existing flight profile",code:"ERR_EXISTING_FLIGHT_PROFILE"},Pae={message:"Existing outcome",code:"ERR_EXISTING_OUTCOME"},Cae={message:"Existing matchUpId",code:"ERR_EXISTING_MATCHUP_ID"},CV={message:"Existing stage",code:"ERR_EXISTING_STAGE"},Bz={message:"Existing structure",code:"ERR_EXISTING_STRUCTURE"},_P={message:"Method not found",code:"ERR_NOT_FOUND_METHOD"},Rae={message:"Scheduled matchUps",code:"ERR_SCHEDULED_MATCHUPS"},px={message:"Scores present",code:"ERR_SCORES_PRESENT"},Mae={ANACHRONISM:IV,CANNOT_CHANGE_WINNING_SIDE:sx,CANNOT_MODIFY_TIEFORMAT:Rz,CANNOT_MODIFY_PARTICIPANT_TYPE:Qre,CANNOT_REMOVE_MAIN_STRUCTURE:Tre,CANNOT_REMOVE_PARTICIPANTS:ax,CATEGORY_MISMATCH:DV,COURT_EXISTS:hae,COURT_NOT_FOUND:QT,DRAW_DEFINITION_NOT_FOUND:tc,DRAW_ID_EXISTS:Pre,DRAW_POSITION_ACTIVE:ex,DRAW_POSITION_ASSIGNED:RS,DRAW_POSITION_NOT_CLEARED:Ere,DRAW_POSITION_NOT_FOUND:XRe,DRAW_SIZE_MISMATCH:bz,DUPLICATE_ENTRY:qD,DUPLICATE_VALUE:Uae,ENTRY_STATUS_NOT_ALLOWED_FOR_EVENT:cae,ENTRY_STATUS_NOT_ALLOWED_IN_STAGE:lae,EVENT_EXISTS:Lre,EVENT_NOT_FOUND:Gc,EXISTING_DRAW_DEFINITIONS:Ure,EXISTING_END_TIME:_z,EXISTING_FLIGHT:Eae,EXISTING_MATCHUP_ID:Cae,EXISTING_OUTCOME:Pae,EXISTING_PARTICIPANT_DRAW_POSITION_ASSIGNMENT:JT,EXISTING_PARTICIPANT:ox,EXISTING_POLICY_TYPE:Pz,EXISTING_PROFILE:$z,EXISTING_ROUND:xre,EXISTING_STAGE:CV,EXISTING_STRUCTURE:Bz,INCOMPATIBLE_MATCHUP_STATUS:kN,INCOMPLETE_SOURCE_STRUCTURE:mz,INSUFFICIENT_DRAW_POSITIONS:Nz,INVALID_ACTION:Nre,INVALID_ASSIGNMENT:SV,INVALID_BOOKINGS:kA,INVALID_CATEGORY:WD,INVALID_COLLECTION_DEFINITION:Tae,INVALID_CONFIGURATION:Sae,INVALID_DATE_AVAILABILITY:xN,INVALID_DATE:Fa,INVALID_DRAW_DEFINITION:kb,INVALID_DRAW_POSITION_FOR_SEEDING:gz,INVALID_DRAW_POSITION:YT,INVALID_DRAW_SIZE:tx,INVALID_END_TIME:mae,INVALID_ENTRIES:$re,INVALID_EVENT_TYPE:_h,INVALID_GAME_SCORES:UV,INVALID_GENDER:rD,INVALID_MATCHUP_FORMAT:Tz,INVALID_MATCHUP_STATUS:ZT,INVALID_MATCHUP_STATUS_BYE:Gre,INVALID_MATCHUP:al,INVALID_OBJECT:bm,INVALID_PARTICIPANT_ID:Md,INVALID_PARTICIPANT_IDS:Dl,INVALID_PARTICIPANT_ROLE:eae,INVALID_PARTICIPANT_SEEDING:Cre,INVALID_PARTICIPANT_TYPE:Nd,INVALID_PARTICIPANT:jI,INVALID_POLICY_DEFINITION:qre,INVALID_RECORDS:wV,INVALID_SCALE_ITEM:aI,INVALID_SEED_NUMBER:_re,INVALID_SEED_POSITION:kre,INVALID_SET_NUMBER:nMe,INVALID_SIDE_NUMBER:Cz,INVALID_SCORE:Jre,INVALID_STAGE:Ay,INVALID_START_TIME:vae,INVALID_STRUCTURE:My,INVALID_STOP_TIME:gae,INVALID_TIE_FORMAT:Ih,INVALID_TIME:bu,INVALID_TIME_ITEM:kz,INVALID_TOURNAMENT_DATES:Xre,INVALID_TOURNAMENT_RECORD:CP,INVALID_VALUES:Re,INVALID_WINNING_SIDE:rx,MATCHUP_NOT_FOUND:_s,METHOD_NOT_FOUND:_P,MISSING_ASSIGNMENTS:Sz,MISSING_ASYNC_STATE_PROVIDER:yae,MISSING_AVOIDANCE_POLICY:zre,MISSING_BIRTH_DATE:Wre,MISSING_COLLECTION_DEFINITION:Hre,MISSING_COURT_ID:VI,MISSING_COURTS_INFO:pae,MISSING_DATE_AVAILABILITY:Zre,MISSING_DATE:Yre,MISSING_DRAW_DEFINITION:Gt,MISSING_DRAW_ID:Vd,MISSING_DRAW_POSITION:KT,MISSING_DRAW_POSITIONS:RP,MISSING_DRAW_SIZE:MP,MISSING_ENTRIES:Fre,MISSING_EVENT:Jn,MISSING_MATCHUP_FORMAT:Uz,MISSING_MATCHUP_ID:Ks,MISSING_MATCHUP_IDS:BI,MISSING_MATCHUP:rl,MISSING_MATCHUPS:ym,MISSING_PARTICIPANT_COUNT:rae,MISSING_PARTICIPANT_ID:la,MISSING_PARTICIPANT_IDS:xg,MISSING_PARTICIPANT_ROLE:tae,MISSING_PARTICIPANT:GI,MISSING_PARTICIPANTS:AP,MISSING_PENALTY_ID:Az,MISSING_PENALTY_TYPE:dae,MISSING_PERSON_DETAILS:sae,MISSING_POLICY_ATTRIBUTES:Ez,MISSING_POLICY_DEFINITION:ix,MISSING_POLICY_TYPE:Dz,MISSING_POSITION_ASSIGNMENTS:jre,MISSING_ROUND_NUMBER:QRe,MISSING_SCHEDULE:bae,MISSING_SCORING_POLICY:iMe,MISSING_SEED_ASSIGNMENTS:Are,MISSING_SEEDCOUNT_THRESHOLDS:Mre,MISSING_SEEDING_POLICY:eMe,MISSING_SET_NUMBER:rMe,MISSING_SET_OBJECT:nx,MISSING_SIDE_NUMBER:aMe,MISSING_STAGE:Bre,MISSING_STRUCTURE_ID:uc,MISSING_STRUCTURE:Ny,MISSING_STRUCTURES:wz,MISSING_TARGET_LINK:Iz,MISSING_TIE_FORMAT:XT,MISSING_TIME_ITEM:xz,MISSING_TIME_ITEMS:Oz,MISSING_TOURNAMENT_ID:CS,MISSING_TOURNAMENT_RECORD:ut,MISSING_TOURNAMENT_RECORDS:wr,MISSING_VALUE:ai,MISSING_VENUE_ID:Og,MODIFICATIONS_FAILED:Iae,NO_CANDIDATES:cx,NO_DRAW_POSITIONS_AVAILABLE_FOR_QUALIFIERS:uae,NO_MODIFICATIONS_APPLIED:eU,NO_STAGE_SPACE_AVAILABLE_FOR_ENTRY_STATUS:PV,NO_PARTICIPANT_REMOVED:nae,NO_VALID_ACTIONS:Dae,NO_VALID_ATTRIBUTES:ux,NO_VALID_DATES:Kre,NOT_FOUND:za,NOT_IMPLEMENTED:dx,PARTICIPANT_COUNT_EXCEEDS_DRAW_SIZE:Mz,PARTICIPANT_ID_EXISTS:iae,PARTICIPANT_NOT_CHECKED_IN:aae,PARTICIPANT_NOT_FOUND:xr,PARTICIPANT_PAIR_EXISTS:oMe,PENALTY_NOT_FOUND:MS,POLICY_NOT_ATTACHED:tMe,POLICY_NOT_FOUND:xb,SCHEDULE_NOT_CLEARED:Dre,SCHEDULED_MATCHUPS:Rae,SCORES_PRESENT:px,SEEDSCOUNT_GREATER_THAN_DRAW_SIZE:Rre,STAGE_SEQUENCE_LIMIT:Vre,STRUCTURE_NOT_FOUND:gr,TEAM_NOT_FOUND:Lz,UNABLE_TO_ASSIGN_COURT:wae,UNLINKED_STRUCTURES:Ore,UNRECOGNIZED_DRAW_TYPE:vz,UNRECOGNIZED_MATCHUP_FORMAT:NP,UNRECOGNIZED_MATCHUP_STATUS:TV,VALUE_UNCHANGED:Fz,VENUE_EXISTS:fae},pr={disableNotifications:!1,tournamentId:void 0,tournamentRecords:{},subscriptions:{},modified:!1,methods:{},notices:[]},Nae={addNotice:SMe,callListener:PMe,cycleMutationStatus:wMe,deleteNotice:DMe,deleteNotices:UMe,disableNotifications:dMe,enableNotifications:pMe,getMethods:hx,getNotices:TMe,getTopics:EMe,getTournamentId:Aae,getTournamentRecord:hMe,getTournamentRecords:fMe,removeTournamentRecord:yMe,setMethods:IMe,setSubscriptions:bMe,setTournamentId:gMe,setTournamentRecord:mMe,setTournamentRecords:vMe,handleCaughtError:CMe};function dMe(){pr.disableNotifications=!0}function pMe(){pr.disableNotifications=!1}function Aae(){return pr.tournamentId}function hMe(t){return pr.tournamentRecords[t]}function fMe(){return pr.tournamentRecords}function mMe(t){let e=t==null?void 0:t.tournamentId;return e?(pr.tournamentRecords[e]=t,{success:!0}):{error:CP}}function gMe(t){return t?pr.tournamentRecords[t]?(pr.tournamentId=t,{success:!0}):{error:ut}:(pr.tournamentId=void 0,{success:!0})}function vMe(t){pr.tournamentRecords=t;let e=Object.keys(t);e.length===1?pr.tournamentId=e[0]:e.length||(pr.tournamentId=void 0)}function yMe(t){if(typeof t!="string")return{error:Re};if(!pr.tournamentRecords[t])return{error:za};delete pr.tournamentRecords[t];let e=Object.keys(pr.tournamentRecords);return e.length===1?pr.tournamentId=e[0]:e.length||(pr.tournamentId=void 0),{success:!0}}function bMe(t){return typeof t.subscriptions!="object"?{error:Re}:(Object.keys(t.subscriptions).forEach(e=>{typeof t.subscriptions[e]=="function"?pr.subscriptions[e]=t.subscriptions[e]:delete pr.subscriptions[e]}),{...de})}function IMe(t){return typeof t!="object"?{error:Re}:(Object.keys(t).forEach(e=>{typeof t[e]=="function"&&(pr.methods[e]=t[e])}),{...de})}function wMe(){let t=pr.modified;return pr.modified=!1,t}function SMe({topic:t,payload:e,key:i},n){if(!(typeof t!="string"||typeof e!="object")&&(pr.disableNotifications||(pr.modified=!0),!(pr.disableNotifications||!pr.subscriptions[t]&&!n)))return i&&(pr.notices=pr.notices.filter(r=>!(r.topic===t&&r.key===i))),pr.notices.push({topic:t,payload:e,key:i}),{...de}}function hx(){return pr.methods??{}}function TMe({topic:t}){return pr.notices.filter(e=>e.topic===t).map(e=>e.payload)}function UMe(){pr.notices=[]}function DMe({topic:t,key:e}){pr.notices=pr.notices.filter(i=>(!t||i.topic===t)&&i.key!==e)}function EMe(){return{topics:Object.keys(pr.subscriptions)}}function PMe({topic:t,notices:e},i){let n=pr.subscriptions[t];n&&typeof n=="function"&&n(e);let r=i==null?void 0:i[t];r&&typeof r=="function"&&r(e)}function CMe({engineName:t,methodName:e,params:i,err:n}){let r;return typeof n=="string"?r=n.toUpperCase():n instanceof Error&&(r=n.message),console.log("ERROR",{tournamentId:Aae(),params:JSON.stringify(i),engine:t,methodName:e,error:r}),{error:r}}var Bn={timers:{default:{elapsedTime:0}},globalSubscriptions:{},deepCopyAttributes:{stringify:[],ignore:[],toJSON:[]},globalMethods:[],deepCopy:!0},qa=Nae,FK=["addNotice","callListener","cycleMutationStatus","deleteNotice","deleteNotices","disableNotifications","enableNotifications","getMethods","getNotices","getTopics","getTournamentId","getTournamentRecord","getTournamentRecords","removeTournamentRecord","setSubscriptions","setTournamentId","setTournamentRecord","setTournamentRecords"];function RMe(t){if(typeof t!="object")throw new Error("Global state provider can not be undefined or null");if(Nr(Object.keys(t),FK).length!==FK.length)throw new Error("Global state provider is missing required methods");return qa=t,{success:!0}}function _ae(){if(qa.createInstanceState){try{qa.createInstanceState()}catch(t){return{error:t}}return{success:!0}}else return{error:yae}}function ic(t){return!t||typeof t!="object"?Bn.devContext??!1:typeof Bn.devContext!="object"?!1:Object.keys(t).every(e=>{var i;return((i=Bn.devContext)==null?void 0:i[e])===t[e]})&&Bn.devContext}function MMe(t="reset",e="default"){var n,r;let i=Date.now();if(t==="report"){if(e==="allTimers")return Object.keys(Bn.timers).filter(a=>a!=="default"||Bn.timers[a].startTime).map(a=>{let s=Bn.timers[a],o=s.state==="stopped"?0:(i-((s==null?void 0:s.startTime)??0))/1e3,l=s.elapsedTime+o;return{state:Bn.timers[a].state,elapsedTime:l.toFixed(2),timer:a}});{let a=Bn.timers[e].state==="stopped"?0:(i-(((n=Bn.timers[e])==null?void 0:n.startTime)??0))/1e3,s=Bn.timers[e].elapsedTime+a;return{state:Bn.timers[e].state,elapsedTime:s.toFixed(2),timer:e}}}if(!Bn.timers[e]||t==="reset"){if(e==="allTimers")return Bn.timers={default:{elapsedTime:0}},!0;Bn.timers[e]={startTime:i,state:"active",elapsedTime:0}}return Bn.timers[e].elapsedTime||(Bn.timers[e].elapsedTime=0),t==="stop"&&Bn.timers[e].state!=="stopped"&&(Bn.timers[e].state="stopped")&&(Bn.timers[e].elapsedTime+=(i-(((r=Bn.timers[e])==null?void 0:r.startTime)??0))/1e3),t==="start"&&(Bn.timers[e].startTime=i)&&(Bn.timers[e].state="active"),Bn.timers[e]}function kae(t){xo(t)?Bn.globalLog=t:delete Bn.globalLog}function YD(t){Bn.devContext=t}function xae(){qa.disableNotifications()}function ON(){qa.enableNotifications()}function KD(t,e){typeof t=="boolean"&&(Bn.deepCopy=t),typeof e=="object"&&(Array.isArray(e.ignore)&&(Bn.deepCopyAttributes.ignore=e.ignore),Array.isArray(e.toJSON)&&(Bn.deepCopyAttributes.toJSON=e.toJSON),Array.isArray(e.stringify)&&(Bn.deepCopyAttributes.stringify=e.stringify),e.threshold&&(Bn.deepCopyAttributes.threshold=e.threshold))}function Vz(){return{enabled:Bn.deepCopy,...Bn.deepCopyAttributes}}function NMe(t){return t!=null&&t.subscriptions?(Object.keys(t.subscriptions).forEach(e=>{Bn.globalSubscriptions[e]=t.subscriptions[e]}),{...de}):{error:ai,info:"missing subscriptions"}}function AMe(t){return t!=null&&t.subscriptions?qa.setSubscriptions({subscriptions:t.subscriptions}):{error:ai,info:"missing subscriptions"}}function Oae(t){return t?typeof t!="object"?{error:Re}:(Object.keys(t).forEach(e=>{xo(t[e])&&(Bn.globalMethods[e]=t[e])}),{...de}):{error:ai,info:"missing method declarations"}}function Lae(t){return t?typeof t!="object"?{error:Re}:qa.setMethods(t):{error:ai,info:"missing method declarations"}}function jz(){return qa.cycleMutationStatus()}function Si(t){if(typeof(t==null?void 0:t.topic)!="string")return;let e=Bn.globalSubscriptions[t.topic];return qa.addNotice(t,e)}function Gz(){return{...Bn.globalMethods,...qa.getMethods()}}function Hz(t){return qa.getNotices(t)}function zz({key:t,topic:e}){return qa.deleteNotice({key:t,topic:e})}function zI(){return qa.deleteNotices()}function dc(){return qa.getTopics()}function fx(t){var e,i;return(i=(e=dc())==null?void 0:e.topics)==null?void 0:i.includes(t)}async function ZD(t){return qa.callListener(t,Bn.globalSubscriptions)}function qI(){return qa.getTournamentId()}function qz(t){return qa.getTournamentRecord(t)}function Lg(){return qa.getTournamentRecords()}function Fae(t){return qa.setTournamentRecord(t)}function mx(t){return qa.setTournamentRecords(t)}function XD(t){return qa.setTournamentId(t)}function $ae(t){return qa.removeTournamentRecord(t)}function RV(){return qa}function gx({engineName:t,methodName:e,params:i,err:n}){let r=xo(qa.handleCaughtError)&&qa.handleCaughtError||Nae.handleCaughtError,{tournamentRecord:a,...s}=i;return r({params:s,engineName:t,methodName:e,err:n})}function Bae(t,e){if(Bn.globalLog)try{Bn.globalLog({log:t,engine:e})}catch(i){console.log("globalLog error",i),console.log(e,t),kae()}else console.log(e,t)}function Vae(t,e,i,n){if(!Xi(t))return{error:Re};Dr||(i=1);let r=Array.isArray(e)?e:[],a={},s=(o,l=0)=>{Object.keys(o).forEach(c=>{xo(o[c])?a[c]=o[c]:Xi(o[c])&&(e===!0||r!=null&&r.includes(c))&&(i===void 0||l<i)&&s(o[c],l+1)})};return s(t),n?Oae(a):Lae(a),{methods:a}}function _Me(t,e,i){return Object.keys(t).filter(n=>!e.includes(t[n])&&(!i||(Array.isArray(t[n])?t[n].length:!0)))}function Kt(t,e,i,n){var s;if(typeof t!="object"||t===null)return t;(s=Vz())!=null&&s.enabled||(n=!0);let r=["",void 0,null];e&&r.push(!1);let a=_Me(t,r,i);return Object.assign({},...a.map(o=>Array.isArray(t[o])?{[o]:n?t[o]:t[o].map(l=>Kt(l))}:{[o]:n?t[o]:Kt(t[o])}))}function he({context:t,result:e,stack:i,info:n}){return e&&!Array.isArray(e==null?void 0:e.stack)&&(e.stack=[]),e&&Array.isArray(e==null?void 0:e.stack)&&typeof i=="string"&&e.stack.push(i),e&&n&&(e.info=n),e&&typeof t=="object"&&Object.keys(t).length&&Object.assign(e,Kt(t)),e&&!(e!=null&&e.error)&&!(e!=null&&e.success)&&Object.assign(e,{...de}),e??{success:!0}}var Ad="ANY",Cn="MALE",Oo="MIXED",xv="OTHER",Yn="FEMALE",jp={ANY:Ad,MALE:Cn,FEMALE:Yn,MIXED:Oo,OTHER:xv},kMe="MIXED events can not contain mixed singles or { gender: ANY } collections",xMe="events with { gender: ANY } can not contain MIXED singles collections";function vx(t){let e="tieFormatGenderValidityCheck",{referenceGender:i,matchUpType:n,gender:r}=t;return i&&r&&[Cn,Yn].includes(i)&&i!==r?he({result:{valid:!1,error:rD},context:{gender:r},stack:e}):i===Oo&&(r===Ad||r===Oo&&n!==Mn)?he({result:{error:rD,valid:!1},info:kMe,stack:e}):i===Ad&&r===Oo&&n!==Mn?he({result:{error:rD,valid:!1},info:xMe,stack:e}):{valid:!0}}var OMe="normal",$K="timed",LMe="final",Wz="NOAD",LN="SET",FMe={S:OMe,F:LMe};function yx(t,e){if((t!=null&&t.bestOf||t!=null&&t.exactly)&&(t!=null&&t.setFormat))return $Me(t,e)}function JD(t){return!isNaN(Number(t))&&Number(t)}function jae(t){let e=`T${t.minutes}`;return t.based&&(e+=t.based),t.modifier&&(e+=`@${t.modifier}`),e}function $Me(t,e){var u;let i=JD(t.bestOf)||void 0,n=JD(t.exactly)||void 0,r=i||n;if((u=t.setFormat)!=null&&u.timed&&t.simplified&&r===1)return jae(t.setFormat);let a=r&&`${LN}${r}`||"",s=BK(t.setFormat,e),o=s&&`S:${s}`||"",l=BK(t.finalSetFormat,e),c=r&&r>1&&l&&s!==l&&`F:${l}`||"";if(a&&s)return[a,o,c].filter(d=>d).join("-")}function BK(t,e){if(typeof t=="object"&&Object.keys(t).length){if(t.timed)return jae(t);if(t.tiebreakSet)return VK(t.tiebreakSet);let i=JD(t.setTo);if(i){let n=t.NoAD&&Wz||"",r=VK(t.tiebreakFormat),a=r&&`/${r}`||"",s=JD(t.tiebreakAt),o=s&&(s!==i||e)&&`@${s}`||"";if(r!==!1)return`${i}${n}${a}${o}`}}}function VK(t){if(t){if(typeof t=="object"&&!t.tiebreakTo)return"";if(typeof t=="object"&&JD(t.tiebreakTo)){let e=`TB${t.tiebreakTo}${t.NoAD?Wz:""}`;return t.modifier&&(e+=`@${t.modifier}`),e}else return!1}}function wo(t){if(nr(t)){let e=t.startsWith("T")&&$K||t.startsWith(LN)&&LN||"";if(e===$K){let i=Hae(t),n={simplified:!0,setFormat:i,bestOf:1};if(i)return n}if(e===LN)return BMe(t)}}function BMe(t){let e=t.split("-"),i=kP(e[0].slice(3)),n=i===1||i%2!==0?i:void 0,r=i!==1&&i%2===0?i:void 0,a=e&&jK(e[1]),s=e&&jK(e[2]),o=a&&a.timed||s&&s.timed,l=n&&n<6||o&&r,c=!e[2]||s,u=a,d=Kt({setFormat:a,exactly:r,bestOf:n});if(s&&(d.finalSetFormat=s),l&&u&&c)return d}function jK(t){if((t==null?void 0:t[1])===":"){let e=t.split(":"),i=FMe[e[0]],n=e[1];if(i&&n){if(n.startsWith("TB")){let f=GK(n);return f===!1?!1:typeof f=="object"?{tiebreakSet:f}:void 0}if(n.startsWith("T"))return Hae(n);let r=t.match(/^[FS]:(\d+)([A-Za-z]*)/),a=r&&zae(r[2])||!1,s=!(r!=null&&r[2])||a,o=r?kP(r[1]):void 0,l=Gae(n),c=l!==!1,u=c&&l||o,d=GK(n.split("/")[1]),p=d!==!1,h={setTo:o};return a&&(h.NoAD=!0),d?(h.tiebreakFormat=d,h.tiebreakAt=u):h.noTiebreak=!0,o&&s&&p&&c&&h||!1}}}function Gae(t,e=!0){let i=(t==null?void 0:t.indexOf("@"))>0&&t.split("@");if(i)return(e?kP(i[1]):i[1])||!1}function GK(t){if(t)if(t.startsWith("TB")){let e=Gae(t,!1),i=t.match(/^TB(\d+)([A-Za-z]*)/),n=i==null?void 0:i[1],r=i&&zae(i[2]),a=!(i!=null&&i[2])||r,s=kP(n);if(s&&a){let o={tiebreakTo:s};return e&&typeof e=="string"&&!Ii(e)&&(o.modifier=e),r&&(o.NoAD=!0),o}else return!1}else return!1}function Hae(t){var o;let e=t.slice(1),i=e.match(/^(\d+)(@?[A-Za-z]*)/),n=kP(i==null?void 0:i[1]);if(!n)return;let r={timed:!0,minutes:n},a=i==null?void 0:i[2],s=[void 0,"P","G"].includes(a);if(a&&!s){let l=(o=e.match(/^(\d+)(@)([A-Za-z]+)$/))==null?void 0:o[3];return l?(r.modifier=l,r):void 0}return a&&(r.based=i[2]),r}function zae(t){return t&&t.indexOf(Wz)>=0}function kP(t){return isNaN(Number(t))?0:Number(t)}function Nl({matchUpFormat:t}){if(!nr(t)||t==="")return!1;let e=wo(t),i=t.match(/-S:([1-9])+\/TB([0-9]{1,2})@?([1-9]?)*/),n=i==null?void 0:i[1],r=i==null?void 0:i[2],a=i==null?void 0:i[3],s=t.match(/-F:([1-9])+\/TB([0-9]{1,2})@?([1-9]?)*/),o=s==null?void 0:s[1],l=s==null?void 0:s[2],c=s==null?void 0:s[3];return yx(e,!!(i&&r&&n===a||s&&l&&o===c))===t}var xA=/^[\d]{4}-(0[1-9]|1[0-2])-(0[1-9]|[1-2][\d]|3[0-1])$/,qae=/^((0[\d]|1[\d]|2[0-3]):[0-5][\d](:[0-5][\d])?)([.,][0-9]{3})?$/,Dp=/^([\d]{4}-(0[1-9]|1[0-2])-(0[1-9]|[1-2][\d]|3[0-1]))([ T](0[\d]|1[\d]|2[0-3]):[0-5][\d](:[0-5][\d])?)?([.,][\d]{3})?Z?$/,Ov=/^([\d]{4}-(0[1-9]|1[0-2])-(0[1-9]|[1-2][\d]|3[0-1]))?([ T]?(0[\d]|1[\d]|2[0-3]):[0-5][\d](:[0-5][\d])?)?([.,][\d]{3})?Z?$/;function OA(t){let{scheduledDate:e}=t;if(!e&&t.scheduledTime&&(e=Ri(t.scheduledTime)),!e)return;let i=rr(t.scheduledTime),n=Ri(e);return n&&i&&(n+=`T${i}`),n}function VMe(t){return typeof t!="object"||Array.isArray(t)?!1:Object.prototype.toString.call(t)==="[object Date]"}function tU(t){let e=typeof t=="string"?t==null?void 0:t.split(" "):[];return t&&(e==null?void 0:e.length)>1&&!["AM","PM"].includes(e[1].toUpperCase())?!1:!!(!t||Ov.test(WI(t,!0,!0)))}function El(t){return Xv(t)||xA.test(t)}function jMe(t){let e=new Date(t),i=e.getSeconds()+60*e.getMinutes()+60*60*e.getHours();return GMe(i,{displaySeconds:!1})}function GMe(t,e){let i=parseInt(t,10),n=Math.floor(i/3600),r=Math.floor((i-n*3600)/60),a=i-n*3600-r*60;return(!e||e!=null&&e.displaySeconds?n+":"+r+":"+a:n+":"+r).split(":").map(Oc).join(":")}var Yz=t=>{let e=QD(t)||Xv(t)?new Date(t):new Date,i=e.getUTCMonth()+1,n=i<10?`0${i}`:`${i}`;return`${e.getUTCFullYear()}-${Oc(n)}-${Oc(e.getUTCDate())}`};function HMe(t){let e=QD(t)||Xv(t)?new Date(t):new Date;return Date.UTC(e.getFullYear(),e.getMonth(),e.getDate())}function Mu(t,e="-",i="YMD"){if(!t)return"";typeof t=="string"&&t.indexOf("T")<0&&(t=t+"T00:00");let n=new Date(t),r=""+(n.getMonth()+1),a=""+n.getDate(),s=n.getFullYear();return r.length<2&&(r="0"+r),a.length<2&&(a="0"+a),i==="DMY"?[a,r,s].join(e):i==="MDY"?[r,a,s].join(e):i==="YDM"?[s,a,r].join(e):i==="DYM"?[a,s,r].join(e):i==="MYD"?[r,s,a].join(e):[s,r,a].join(e)}function LA(t){let e=t?new Date(t):new Date,i=e.getTimezoneOffset();return new Date(e.getTime()-i*60*1e3)}function zMe(t){return LA(t).getTime()}function QD(t){if(typeof t=="boolean")return!1;let e=t instanceof Date&&t||!isNaN(t)&&new Date(t)||!1;return e&&!isNaN(e.valueOf())}function NS(t,e){if(!El(t)||!El(e))return[];let i=Ri(t)+"T00:00",n=Ri(e)+"T00:00",r=new Date(i),a=new Date(n),s=QD(a)&&QD(r)&&c(r,a),o=[],l=0;if(s){let u=r,d=u.getTime();for(;d<=a.getTime()&&l<300;)l+=1,o.push(new Date(u)),d=u.setDate(u.getDate()+1)}return o.map(u=>Mu(u));function c(u,d){return u<=d}}var qMe=/^([+-]?\d{4}(?!\d{2}\b))((-?)((0[1-9]|1[0-2])(\3([12]\d|0[1-9]|3[01]))?|W([0-4]\d|5[0-2])(-?[1-7])?|(00[1-9]|0[1-9]\d|[12]\d{2}|3([0-5]\d|6[1-6])))([T\s]((([01]\d|2[0-3])((:?)[0-5]\d)?|24:?00)([.,]\d+(?!:))?)?(\17[0-5]\d([.,]\d+)?)?([zZ]|([+-])([01]\d|2[0-3]):?([0-5]\d)?)?)?)?$/;function Xv(t){return typeof t!="string"?!1:qMe.test(t)}function Kz(t){if(typeof t!="string")return!1;let e=t.split("Z")[0].split(":"),i=e.every(n=>!isNaN(parseInt(n)));return!(e.length<2||!i||parseInt(e[0])>23||parseInt(e[1])>60)}function an(t){let e=rr(t);if(!e)return 0;let[i,n]=e.split(":").map(r=>parseInt(r));return i*60+n}function WMe(t){let e=Math.floor(t/60),i=t-e*60;return e>23&&(e=e%24),[Oc(e),Oc(i)].join(":")}function FA(t){return Kz(t)?t.split(":").slice(0,2).map(Oc).join(":"):void 0}function rr(t){return Xv(t)&&t.indexOf("T")>0?FA(t.split("T").reverse()[0]):FA(t)}function Ri(t){return Xv(t)||Dp.test(t)?t.split("T")[0]:void 0}function H1(t,e){let i=new Date(t);return i.setDate(i.getDate()+e),Ri(i.toISOString())}function $A(t){t=typeof t!="string"?"00:00":t;let e={},i={};return{0:e.time,1:e.ampm}=t.split(" ")||[],{0:i.hours,1:i.minutes}=e.time.split(":")||[],i.ampm=e.ampm,isNaN(i.hours)||isNaN(i.minutes)||i.ampm&&!["AM","PM"].includes(i.ampm.toUpperCase())?{}:i}function YMe(t){let e=$A(t);return e.ampm&&e.hours&&(e.ampm.toLowerCase()==="pm"&&parseInt(e.hours)<12&&(e.hours=(e.hours&&parseInt(e.hours)||0)+12),e.ampm.toLowerCase()==="am"&&e.hours==="12"&&(e.hours="00")),`${e.hours||"12"}:${e.minutes||"00"}`.split(":").map(Oc).join(":")}function KMe(t){var i;let e=$A(t);if(!(typeof e=="object"&&!Object.keys(e).length))return e.ampm?t:(e.hours>12?(e.hours-=12,e.ampm="PM"):e.hours==="12"?e.ampm="PM":(e.hours==="00"&&(e.hours="12"),e.ampm="AM"),((i=e.hours)==null?void 0:i[0])==="0"&&(e.hours=e.hours.slice(1)),`${e.hours||"12"}:${e.minutes||"00"} ${e.ampm}`)}function WI(t,e,i){let n=Ri(t),r=rr(t),a=n?r:t;return t?e&&(n&&i&&t||YMe(a))||KMe(a):void 0}function Wae(t,e){let i=$A(t),n=$A(e);if(parseInt(i.hours)<parseInt(n.hours))return-1;if(parseInt(i.hours)>parseInt(n.hours))return 1;if(i.hours===n.hours){if(parseInt(i.minutes)<parseInt(n.minutes))return-1;if(parseInt(i.minutes)>parseInt(n.minutes))return 1}return 0}function Zz(t,e=7){let i=Ri(t)+"T00:00",n=new Date(i),r=new Date(n.setDate(n.getDate()+e));return Mu(r)}function ZMe(t){return Zz(t)}function XMe(t,e,i,n=!1){let r=new Date(e,0,1+(t-1)*7),a=n?0:1;return r.setDate(r.getDate()+(a-r.getDay())),Mu(r,i)}function JMe(t,e,i){let n=new Date(t,0);return Mu(new Date(n.setDate(e)),i)}function Zr(t,e=void 0){let[i,n]=(t||"00:00").split(":").map(Oc),r=LA(e).setHours(i,n,0,0);return LA(r)}function xP(t,e,i=!0){let n=new Date(t),r=(new Date(e).getTime()-n.getTime())/1e3/60;return i?Math.abs(Math.round(r)):Math.round(r)}function il(t,e){let i=rr(t);if(!i)return"00:00";let n=isNaN(e)?0:e;return rr(Xz(Zr(i),n).toISOString())}function Xz(t,e){let i=new Date(t);return new Date(i.getTime()+e*6e4)}function Oc(t){return t.toString()[1]?t:"0"+t}function kh(t,e){let i=new Date(t),n=new Date(e);return i.getFullYear()===n.getFullYear()&&i.getMonth()===n.getMonth()&&i.getDate()===n.getDate()}var Yae={addDays:Zz,addWeek:ZMe,addMinutesToTimeString:il,convertTime:WI,getIsoDateString:OA,getUTCdateString:Yz,DateHHMM:jMe,extractDate:Ri,extractTime:rr,formatDate:Mu,getDateByWeek:XMe,isISODateString:Xv,isDate:QD,isTimeString:Kz,offsetDate:LA,offsetTime:zMe,sameDay:kh,timeStringMinutes:an,timeToDate:Zr,timeUTC:HMe,validTimeValue:tU,validDateString:xA,timeValidation:Ov,dateValidation:Dp},QMe=(t,e)=>t.filter(Boolean).every(i=>typeof i===e),eNe=t=>t.filter(Boolean).every(Dr);function sI(t){let e=t.category;if(typeof e!="object")return{error:WD};let{ageCategoryCode:i,ageMaxDate:n,ageMinDate:r,ageMax:a,ageMin:s}=e,o=e.categoryName,l;if(!QMe([i,n,r,o],"string")||!eNe([a,s]))return{error:WD};let c=t.consideredDate??Ri(new Date().toLocaleDateString("sv"));if(!El(c))return{error:Fa};let[u]=c.split("-").slice(0,3).map($=>parseInt($)),d=H1(c,-1),[p,h]=d.split("-").slice(1,3).map($=>parseInt($)),f=`${Oc(p)}-${Oc(h)}`,m=H1(c,1),[g,v]=m.split("-").slice(1,3).map($=>parseInt($)),y=`${Oc(g)}-${Oc(v)}`,b=s&&H1(c,-1*365*s),I=a&&H1(c,-1*365*a),T=[],w=$=>!T.includes($)&&T.push($);i=i??o;let S=/^([UO]?)(\d{1,2})([UO]?)$/,U=/^C(\d{1,2})-(\d{1,2})$/,P=i==null?void 0:i.includes("-"),E=P&&(i==null?void 0:i.match(U)),R=i==null?void 0:i.match(S),C=($,F)=>`${$}-${F}`,M=$=>{let F=u-$,V=C(F,y);e.ageMinDate&&e.ageMinDate!==V&&w(`Invalid submitted ageMinDate: ${r}`),r=V,i&&(e.ageMax&&e.ageMax!==$-1&&(w(`Invalid submitted ageMax: ${a}`),I=void 0),a=$-1)},_=$=>{let F=u-$-1,V=C(F,y);e.ageMin&&e.ageMin>$&&w(`Invalid submitted ageMin: ${s}`),e.ageMax&&e.ageMax>$&&w(`Invalid submitted ageMax: ${a}`),e.ageMinDate&&e.ageMinDate!==V&&w(`Invalid submitted ageMinDate: ${r}`),r=V,i&&(e.ageMax&&e.ageMax!==$&&(w(`Invalid submitted ageMax: ${a}`),b=void 0),a=$)},A=$=>{let F=u-$,V=C(F,f);e.ageMaxDate&&e.ageMaxDate!==V&&w(`Invalid submitted ageMaxDate: ${n}`),n=V,i&&(e.ageMin&&e.ageMin!==$+1&&(w(`Invalid submitted ageMin: ${s}`),b=void 0),s=$+1)},N=$=>{let F=u-$-1,V=C(F,f);e.ageMaxDate&&e.ageMaxDate!==V&&w(`Invalid submitted ageMaxDate: ${n}`),n=V,i&&(e.ageMin&&e.ageMin!==$&&(w(`Invalid submitted ageMin: ${s}`),b=void 0),s=$)},k=$=>{let[F,V,j]=($.match(S)||[]).slice(1),B=parseInt(V);F==="U"?(e.ageMaxDate&&e.ageMaxDate!==n&&w(`Invalid submitted ageMaxDate: ${e.ageMaxDate}`),M(B)):F==="O"&&A(B),j==="U"?(e.ageMaxDate&&e.ageMaxDate!==n&&w(`Invalid submitted ageMaxDate: ${e.ageMaxDate}`),_(B)):j==="O"&&N(B),n=n??b,r=r??I};if(E){if(n=void 0,r=void 0,a=void 0,s=void 0,e.ageMin){let V=u-e.ageMin;n=C(V,f)}if(e.ageMax){let V=u-e.ageMax-1;r=C(V,y)}let[$,F]=((i==null?void 0:i.match(U))??[]).slice(1).map(V=>parseInt(V));$<=F?(s=$,a=F,l=!0):w(`Invalid combined age range ${i}`)}else P?i==null||i.split("-").forEach(k):R?k(i):(s&&A(s),a&&_(a));a&&e.ageMin&&e.ageMin>a&&(w(`Invalid submitted ageMin: ${e.ageMin}`),s=void 0);let O=Kt({consideredDate:c,combinedAge:l,ageMaxDate:n,ageMinDate:r,ageMax:a,ageMin:s});return T.length&&(O.errors=T),O}function eE({category:t}){if(!Xi(t))return{error:Re};let e=sI({category:t});if(e.error)return{error:e};let{ratingMax:i,ratingMin:n}=t;return i&&!Dr(i)?he({result:{error:Re},context:{ratingMax:i}}):n&&!Dr(n)?he({result:{error:Re},context:{ratingMin:n}}):{...e}}function OP({childCategory:t,withDetails:e,category:i}){let n=eE({category:i}),r=eE({category:t}),a=r.ageMin&&(n.ageMin&&r.ageMin<n.ageMin||n.ageMax&&r.ageMin>n.ageMax),s=r.ageMax&&(n.ageMax&&r.ageMax>n.ageMax||n.ageMin&&r.ageMax<n.ageMin),o=r.ageMinDate&&n.ageMaxDate&&new Date(r.ageMinDate)>new Date(n.ageMaxDate),l=r.ageMaxDate&&n.ageMinDate&&new Date(r.ageMaxDate)<new Date(n.ageMinDate),c=(i==null?void 0:i.ratingType)&&(t==null?void 0:t.ratingType)&&i.ratingType===t.ratingType&&(i.ratingMin&&t.ratingMin&&t.ratingMin<i.ratingMin||i.ratingMax&&t.ratingMax&&t.ratingMax>i.ratingMax||i.ratingMin&&t.ratingMax&&t.ratingMax<i.ratingMin||i.ratingMax&&t.ratingMin&&t.ratingMin>i.ratingMax),u=(i==null?void 0:i.ballType)&&(t==null?void 0:t.ballType)&&i.ballType!==t.ballType,d=Kt({invalidRatingRange:c,invalidAgeMinDate:o,invalidAgeMaxDate:l,invalidBallType:u,invalidAgeMax:s,invalidAgeMin:a,valid:!c&&!o&&!l&&!u&&!s&&!a},!0);return e&&Object.assign(d,{categoryDetails:n,childCategoryDetails:r}),d}function LP({checkCategory:t=!0,collectionDefinition:e,checkCollectionIds:i,checkGender:n=!0,referenceCategory:r,referenceGender:a,event:s}){a=a??(s==null?void 0:s.gender);let o="validateCollectionDefinition",l=[];if(typeof e!="object")return l.push(`collectionDefinition must be an object: ${e}`),he({result:{errors:l,error:bm},stack:o});let{collectionValueProfiles:c,collectionGroupNumber:u,collectionValue:d,collectionId:p,matchUpCount:h,matchUpFormat:f,matchUpValue:m,matchUpType:g,scoreValue:v,setValue:y,category:b,gender:I}=e;if(i&&typeof p!="string"&&l.push(`collectionId is not type string: ${p}`),typeof h!="number"&&l.push(`matchUpCount is not type number: ${h}`),g&&!Qk([xn,Mn],g)&&l.push(`matchUpType must be SINGLES or DOUBLES: ${g}`),[!!(c!=null&&c.length)].concat([m,d,v,y].map(Ii)).filter(Boolean).length!==1&&l.push("Missing value definition for matchUps: matchUpValue, collectionValue, or collectionValueProfiles"),m&&typeof m!="number"&&l.push(`matchUpValue is not type number: ${m}`),d&&typeof d!="number"&&l.push(`collectionValue is not type number: ${d}`),c&&h){let T=Sre({collectionValueProfiles:c,matchUpCount:h});T.errors&&l.push(...T.errors)}if(u&&typeof u!="number"&&l.push(`collectionGroupNumber is not type number: ${d}`),f&&!Nl({matchUpFormat:f})&&l.push(`Invalid matchUpFormat: ${f}`),n){let T=vx({referenceGender:a,matchUpType:g,gender:I});if(T.error)return he({context:{referenceGender:a,gender:I},result:T,stack:o})}if(t&&r&&b){let T=OP({category:r,childCategory:b});if(!T.valid)return he({result:{error:WD},context:T,stack:o})}return l.length?he({result:{errors:l,error:Tae},stack:o}):{valid:!0}}function Bo(t){var g,v,y,b;let e=!!((t==null?void 0:t.enforceCategory)!==!1&&(t!=null&&t.category)),i=!!((t==null?void 0:t.enforceGender)!==!1&&(t!=null&&t.gender)),n=t==null?void 0:t.checkCollectionIds,r=t==null?void 0:t.tieFormat,a=t==null?void 0:t.event,s="validateTieFormat",o=[],l=tNe({...t,stack:s});if(l!=null&&l.error)return l;let c,u=r.collectionDefinitions.every(I=>{let{setValue:T,scoreValue:w,collectionValue:S}=I;(T||w)&&!S&&(c=!0);let{valid:U,errors:P}=LP({referenceCategory:t.category,referenceGender:t.gender,collectionDefinition:I,checkCollectionIds:n,checkCategory:e,checkGender:i,event:a});return U?!0:(Array.isArray(P)&&o.push(...P),!1)}),d=typeof((g=r.winCriteria)==null?void 0:g.valueGoal)=="number"&&((v=r.winCriteria)==null?void 0:v.valueGoal)>0&&!c||((y=r.winCriteria)==null?void 0:y.aggregateValue);if(!(d||(b=r.winCriteria)!=null&&b.aggregateValue))return c?o.push("aggregateValue is required"):o.push("Either non-zero valueGoal, or { aggregateValue: true } must be specified in winCriteria"),he({context:{tieFormat:r,errors:o,aggregateValueImperative:c},result:{error:Ih},stack:s});let p=r.collectionDefinitions.map(({collectionId:I})=>I),h=!n||p.length===Ei(p).length,f=u&&d&&h;return f?{valid:f,errors:o}:he({result:{error:Ih},context:{tieFormat:r,errors:o},stack:s})}function tNe(t){let{tieFormat:e,stack:i}=t;return!t||!e||!Xi(e)?he({result:{error:Ih},context:{tieFormat:e,message:"tieformat must be an object"},stack:i}):Xi(e.winCriteria)?Array.isArray(e.collectionDefinitions)?{...de}:he({result:{error:Ih},context:{tieFormat:e,message:"collectionDefinitions must be an array"},stack:i}):he({result:{error:Ih},context:{tieFormat:e,message:"tieformat.winCritiera must be an object"},stack:i})}var AS="resourceSubType",_S="resourceType",kS="identifier",Kae={RESOURCE_SUB_TYPE:AS,RESOURCE_TYPE:_S,IDENTIFIER:kS};function _t(t,e,i,n,r=0){if(RV().makeDeepCopy)return RV().makeDeepCopy(t,e,i,n);let a=Vz(),{stringify:s,toJSON:o,ignore:l,modulate:c}=a||{};if(!(a!=null&&a.enabled)&&!i||typeof t!="object"||xo(t)||t===null||typeof(a==null?void 0:a.threshold)=="number"&&r>=a.threshold)return t;let u=Array.isArray(t)?[]:{},d=Object.keys(t).filter(h=>!i||!l||Array.isArray(l)&&!l.includes(h)||xo(l)&&!l(h)),p=(h,f)=>{u[h]=xo(f==null?void 0:f.toString)?f.toString():JSON.stringify(f)};for(let h of d){let f=t[h],m=xo(c)?c(f):void 0;if(m!==void 0)u[h]=m;else if(e&&h==="extensions"&&Array.isArray(f)){let g=Jz(f);Object.assign(u,...g)}else n&&h==="extensions"?u[h]=[]:Array.isArray(s)&&s.includes(h)?p(h,f):Array.isArray(o)&&o.includes(h)&&xo(f==null?void 0:f.toJSON)?u[h]=f.toJSON():f===null?u[h]=void 0:VMe(f)?u[h]=new Date(f).toISOString():u[h]=_t(f,e,i,n,r+1)}return u}function Jz(t){return t==null?void 0:t.map(e=>{let{name:i,value:n}=e;return i&&n&&{[`_${i}`]:n}}).filter(Boolean)}function Zae(t=1,e){return Rt(0,t).map(()=>yn(e))}function yn(t){let e=[];for(let o=0;o<256;o++)e[o]=(o<16?"0":"")+o.toString(16);let i=Math.random()*4294967295|0,n=Math.random()*4294967295|0,r=Math.random()*4294967295|0,a=Math.random()*4294967295|0,s=e[i&255]+e[i>>8&255]+e[i>>16&255]+e[i>>24&255]+"-"+e[n&255]+e[n>>8&255]+"-"+e[n>>16&15|64]+e[n>>24&255]+"-"+e[r&63|128]+e[r>>8&255]+"-"+e[r>>16&255]+e[r>>24&255]+e[a&255]+e[a>>8&255]+e[a>>16&255]+e[a>>24&255];return typeof t=="string"?`${t}_${s.replace(/-/g,"")}`:s}var Xae={collectionDefinitions:[{collectionName:"Male Singles",matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpCount:4,matchUpValue:1,gender:"MALE"},{collectionName:"Female Singles",matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",gender:"FEMALE",matchUpCount:4,matchUpValue:1},{collectionName:"Male Doubles",matchUpFormat:"SET1-S:8/TB7@7",matchUpType:"DOUBLES",matchUpCount:2,matchUpValue:1,gender:"MALE"},{collectionName:"Female Doubles",matchUpFormat:"SET1-S:8/TB7@7",matchUpType:"DOUBLES",gender:"FEMALE",matchUpCount:2,matchUpValue:1},{collectionName:"Mixed Doubles",matchUpFormat:"SET1-S:8/TB7@7",matchUpType:"DOUBLES",matchUpCount:4,matchUpValue:1,gender:"MIXED"}],tieFormatName:"USTA_GOLD_TEAM_CHALLENGE",winCriteria:{valueGoal:9}},Jae={collectionDefinitions:[{collectionName:"Round 1",matchUpCount:3,matchUpFormat:"SET1-S:T20",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Round 2",matchUpCount:3,matchUpFormat:"SET1-S:T20",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Round 3",matchUpCount:3,matchUpFormat:"SET1-S:T20",matchUpType:"DOUBLES",scoreValue:1}],tieFormatName:"Doubles Shuffle",unrestrictedSelections:!0,winCriteria:{aggregateValue:!0}},Qae={collectionDefinitions:[{collectionName:"Male Singles",gender:"MALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Female Singles",gender:"FEMALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Mixed Doubles",gender:"MIXED",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1}],tieFormatName:"USTA_SOUTHERN_LEVEL_5",winCriteria:{valueGoal:8}},ese={collectionDefinitions:[{category:{ageCategoryCode:"16U"},collectionName:"16U Singles",matchUpCount:4,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Singles",matchUpCount:4,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1},{category:{ageCategoryCode:"16U"},collectionName:"16U Doubles",matchUpCount:2,matchUpFormat:"SET1-S:6/TB7",matchUpType:"DOUBLES",matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Doubles",matchUpCount:2,matchUpFormat:"SET1-S:6/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Tiebreak Doubles",matchUpCount:1,matchUpFormat:"SET1-S:TB10",matchUpType:"DOUBLES",matchUpValue:1,processCodes:["RANKING.IGNORE"]}],tieFormatName:"USTA_SECTION_BATTLE",winCriteria:{valueGoal:9}},tse={collectionDefinitions:[{collectionName:"Male Singles",gender:"MALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Female Singles",gender:"FEMALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Male Doubles",gender:"MALE",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Female Doubles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Mixed Doubles",gender:"MIXED",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1}],tieFormatName:"USTA_INTERSECTIONAL",winCriteria:{valueGoal:8}},ise={collectionDefinitions:[{scoreValue:1,matchUpType:"SINGLES",collectionName:"Men's Singles",matchUpFormat:"SET1-S:T60",gender:"MALE",matchUpCount:1},{scoreValue:1,matchUpType:"SINGLES",collectionName:"Women's Singles",matchUpFormat:"SET1-S:T60",gender:"FEMALE",matchUpCount:1},{matchUpValue:1,matchUpType:"DOUBLES",collectionName:"Mixed Doubles",matchUpFormat:"SET1-S:T60",gender:"MIXED",matchUpCount:1}],tieFormatName:"Time Tennis Pro Circuit",winCriteria:{aggregateValue:!0}},nse={collectionDefinitions:[{collectionName:"Mixed Doubles",gender:"MIXED",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Male Singles",matchUpCount:1,gender:"MALE",matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Female Singles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"DOMINANT_DUO_MIXED",winCriteria:{valueGoal:2}},rse={collectionDefinitions:[{scoreValue:1,matchUpType:"SINGLES",collectionName:"Men's Singles",matchUpFormat:"SET1-S:T60",gender:"MALE",matchUpCount:3},{scoreValue:1,matchUpType:"SINGLES",collectionName:"Women's Singles",matchUpFormat:"SET1-S:T60",gender:"FEMALE",matchUpCount:3},{scoreValue:1,matchUpType:"DOUBLES",collectionName:"Men's Doubles",matchUpFormat:"SET1-S:T60",gender:"MALE",matchUpCount:1},{matchUpValue:1,matchUpType:"DOUBLES",collectionName:"Women's Doubles",matchUpFormat:"SET1-S:T60",gender:"FEMALE",matchUpCount:1},{matchUpValue:1,matchUpType:"DOUBLES",collectionName:"Mixed Doubles",matchUpFormat:"SET1-S:T60",gender:"MIXED",matchUpCount:1}],tieFormatName:"Time Tennis Dual",winCriteria:{aggregateValue:!0}},ase={collectionDefinitions:[{category:{ageCategoryCode:"14U"},collectionName:"14U Singles",matchUpCount:2,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{category:{ageCategoryCode:"16U"},collectionName:"16U Singles",matchUpCount:2,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Singles",matchUpCount:2,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{category:{ageCategoryCode:"14U"},collectionName:"14U Doubles",collectionGroupNumber:1,matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{category:{ageCategoryCode:"16U"},collectionName:"16U Doubles",collectionGroupNumber:1,matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Doubles",collectionGroupNumber:1,matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1}],collectionGroups:[{groupNumber:1,groupName:"Doubles",groupValue:1,winCriteria:{valueGoal:2}}],tieFormatName:"USTA_BREWER_CUP",winCriteria:{valueGoal:4}},sse={winCriteria:{valueGoal:23},tieFormatName:"USTA_OZAKI_CUP",collectionDefinitions:[{category:{ageCategoryCode:"18U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"18U Boys Singles",matchUpType:"SINGLES",matchUpCount:3,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"18U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"18U Girls Singles",matchUpType:"SINGLES",gender:"FEMALE",matchUpCount:3,matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Boys Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",matchUpCount:1,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"18U"},collectionName:"18U Girls Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"FEMALE",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Mixed Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"MIXED",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"16U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"16U Boys Singles",matchUpType:"SINGLES",matchUpCount:3,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"16U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"16U Girls Singles",matchUpType:"SINGLES",gender:"FEMALE",matchUpCount:3,matchUpValue:1},{category:{ageCategoryCode:"16U"},collectionName:"16U Boys Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",matchUpCount:1,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"16U"},collectionName:"16U Girls Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"FEMALE",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"16U"},collectionName:"16U Mixed Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"MIXED",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"14U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"14U Boys Singles",matchUpType:"SINGLES",matchUpCount:3,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"14U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"14U Girls Singles",matchUpType:"SINGLES",gender:"FEMALE",matchUpCount:3,matchUpValue:1},{category:{ageCategoryCode:"14U"},collectionName:"14U Boys Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",matchUpCount:1,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"14U"},collectionName:"14U Girls Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"FEMALE",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"14U"},collectionName:"14U Mixed Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"MIXED",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"12U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"12U Boys Singles",matchUpType:"SINGLES",matchUpCount:3,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"12U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"12U Girls Singles",matchUpType:"SINGLES",gender:"FEMALE",matchUpCount:3,matchUpValue:1},{category:{ageCategoryCode:"12U"},collectionName:"12U Boys Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",matchUpCount:1,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"12U"},collectionName:"12U Girls Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"FEMALE",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"12U"},collectionName:"12U Mixed Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"MIXED",matchUpCount:1,matchUpValue:1}]},Nu="SET3-S:6/TB7",iNe="SET3-S:6NOAD",ose="SET3-S:6/TB7-F:TB10",nNe="SET3-S:4/TB7",rNe="SET3-S:4/TB5@3",aNe="SET1-S:T20",sNe="SET1-S:8/TB7",oNe="SET1-S:8/TB7@7",lNe={FORMAT_STANDARD:Nu,FORMAT_STANDARD_NOAD:iNe,FORMAT_ATP_DOUBLES:ose,FORMAT_SHORT_SETS:nNe,FORMAT_FAST4:rNe,FORMAT_PRO_SET:sNe,FORMAT_COLLEGE_PRO_SET:oNe,TIMED20:aNe},lse={collectionDefinitions:[{collectionName:"Doubles",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Singles",matchUpCount:2,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"DOMINANT_DUO",winCriteria:{valueGoal:2}},cse={collectionDefinitions:[{collectionName:"Doubles",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7@7",matchUpType:"DOUBLES",collectionValue:1},{collectionName:"Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"USTA_COLLEGE",winCriteria:{valueGoal:4}},use={collectionDefinitions:[{collectionName:"Male Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Female Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Male Doubles",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Female Doubles",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1}],tieFormatName:"USTA_LEVEL_1",winCriteria:{valueGoal:10}},dse={collectionDefinitions:[{collectionName:"Female Doubles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Male Doubles",gender:"MALE",matchUpCount:1,matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Female Singles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"SINGLES",scoreValue:1},{collectionName:"Male Singles",matchUpCount:1,gender:"MALE",matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"SINGLES",scoreValue:1},{collectionName:"Mixed Doubles",matchUpCount:1,gender:"MIXED",matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Mixed Doubles",matchUpCount:1,gender:"MIXED",matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Overtime",matchUpCount:1,gender:"MIXED",matchUpFormat:"SET1-S:T20",matchUpType:"DOUBLES",scoreValue:1}],tieFormatName:"USTA_WTT_ITT",winCriteria:{aggregateValue:!0}},pse={collectionDefinitions:[{collectionName:"Male Singles",gender:"MALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Female Singles",gender:"FEMALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Male Doubles",gender:"MALE",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Female Doubles",gender:"FEMALE",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Mixed Doubles",gender:"MIXED",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1}],tieFormatName:"USTA_ZONAL",winCriteria:{valueGoal:10}},hse={collectionDefinitions:[{collectionGroupNumber:1,matchUpType:"DOUBLES",matchUpCount:1,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:1},{collectionGroupNumber:1,matchUpType:"SINGLES",matchUpCount:3,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:1},{collectionGroupNumber:2,matchUpType:"DOUBLES",matchUpCount:1,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:2},{collectionGroupNumber:2,matchUpType:"SINGLES",matchUpCount:3,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:2},{collectionGroupNumber:3,matchUpType:"DOUBLES",matchUpCount:1,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:3},{collectionGroupNumber:3,matchUpType:"SINGLES",matchUpCount:3,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:3}],collectionGroups:[{groupNumber:1,groupName:"Day 1"},{groupNumber:2,groupName:"Day 2"},{groupNumber:3,groupName:"Day 3"}],tieFormatName:"LAVER_CUP",winCriteria:{valueGoal:13}},fse={collectionDefinitions:[{collectionName:"Female Doubles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Male Doubles",gender:"MALE",matchUpCount:1,matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Female Singles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"SINGLES",scoreValue:1},{collectionName:"Male Singles",matchUpCount:1,gender:"MALE",matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"SINGLES",scoreValue:1},{collectionName:"Mixed Doubles",matchUpCount:1,gender:"MIXED",matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Overtime",matchUpCount:1,gender:"MIXED",matchUpFormat:"SET1-S:T20",matchUpType:"DOUBLES",scoreValue:1}],tieFormatName:"USTA_TOC",winCriteria:{aggregateValue:!0}},BA="COLLEGE_DEFAULT",MV="COLLEGE_JUCO",NV="COLLEGE_D3",mse="DOMINANT_DUO",gse="DOMINANT_DUO_MIXED",vse="LAVER_CUP",yse="TEAM_DOUBLES_3_AGGREGATION",bse="TIME_TENNIS_DUAL",Ise="TIME_TENNIS_PRO_CIRCUIT",wse="USTA_BREWER_CUP",Sse="USTA_OZAKI_CUP",Tse="USTA_COLLEGE",Use="USTA_GOLD_TEAM_CHALLENGE",Dse="USTA_LEVEL_1",Ese="USTA_INTERSECTIONAL",Pse="USTA_SECTION_BATTLE",Cse="USTA_SOUTHERN_LEVEL_5",Rse="USTA_TOC",Mse="USTA_WTT_ITT",Nse="USTA_ZONAL",Ase={COLLEGE_D3:NV,COLLEGE_DEFAULT:BA,COLLEGE_JUCO:MV,DOMINANT_DUO:mse,DOMINANT_DUO_MIXED:gse,LAVER_CUP:vse,TEAM_DOUBLES_3_AGGREGATION:yse,TIME_TENNIS_DUAL:bse,TIME_TENNIS_PRO_CIRCUIT:Ise,USTA_BREWER_CUP:wse,USTA_OZAKI_CUP:Sse,USTA_COLLEGE:Tse,USTA_GOLD_TEAM_CHALLENGE:Use,USTA_INTERSECTIONAL:Ese,USTA_LEVEL_1:Dse,USTA_SECTION_BATTLE:Pse,USTA_SOUTHERN_LEVEL_5:Cse,USTA_TOC:Rse,USTA_WTT_ITT:Mse,USTA_ZONAL:Nse},_se="STANDARD",HK={[_se]:{hydrate:!0,doubles:{matchUpCount:3,matchUpValue:1},singles:{matchUpCount:6,matchUpValue:1},valueGoal:5},[NV]:{hydrate:!0,doubles:{matchUpFormat:"SET1-S:8/TB7@7",matchUpCount:3,matchUpValue:1},singles:{matchUpFormat:Nu,matchUpCount:6,matchUpValue:1},tieFormatName:NV,valueGoal:5},[BA]:{hydrate:!0,doubles:{matchUpFormat:"SET1-S:6/TB7",collectionValue:1,matchUpCount:3},singles:{matchUpFormat:Nu,matchUpCount:6,matchUpValue:1},tieFormatName:BA,valueGoal:4},[MV]:{hydrate:!0,doubles:{matchUpFormat:"SET1-S:8/TB7",matchUpCount:3,matchUpValue:1},singles:{matchUpFormat:Nu,matchUpCount:6,matchUpValue:1},tieFormatName:MV,valueGoal:5},[vse]:hse,[mse]:lse,[gse]:nse,[yse]:Jae,[bse]:rse,[Ise]:ise,[wse]:ase,[Sse]:sse,[Tse]:cse,[Use]:Xae,[Ese]:tse,[Dse]:use,[Pse]:ese,[Cse]:Qae,[Mse]:dse,[Rse]:fse,[Nse]:pse},cNe=t=>{let e=t!=null&&t.namedFormat&&Object.keys(HK).includes(t.namedFormat)?t.namedFormat:_se,i=Array.isArray(t==null?void 0:t.uuids)?t==null?void 0:t.uuids:[],n,{category:r,gender:a}=(t==null?void 0:t.event)??{},s=_t(HK[e],!1,!0),o=l=>{var u,d;if(!(t!=null&&t.isMock)&&!((u=t==null?void 0:t.event)!=null&&u.isMock)||!t.event)return(i==null?void 0:i.pop())??yn();let c=(d=t==null?void 0:t.event)==null?void 0:d.eventId;return i.pop()??`${c}-COL-${l+1}`};return s.hydrate?(n={winCriteria:{valueGoal:s.valueGoal},collectionDefinitions:[{collectionId:o(0),matchUpFormat:ose,collectionName:"Doubles",matchUpType:Mn,...s.doubles},{collectionId:o(1),matchUpFormat:Nu,collectionName:"Singles",matchUpType:xn,...s.singles}]},s.tieFormatName&&(n.tieFormatName=s.tieFormatName)):(s.collectionDefinitions.forEach((l,c)=>l.collectionId=o(c)),n=s),t!=null&&t.hydrateCollections&&n.collectionDefinitions.forEach(l=>{r&&!l.category&&(l.category=r),a&&!l.gender&&(l.gender=a)}),n},Bf=cNe,Ep="SINGLES",oI="SINGLES",Hc="DOUBLES",Vf="DOUBLES",na="TEAM",Al="TEAM",uNe="AGE",dNe="RATING",pNe="BOTH",pl={AGE:uNe,BOTH:pNe,DOUBLES:Hc,DOUBLES_EVENT:Vf,RATING:dNe,SINGLES:Ep,SINGLES_EVENT:oI,TEAM_EVENT:Al,TEAM:na},Ft="MAIN",ni="QUALIFYING",bs="CONSOLATION",$a="VOLUNTARY_CONSOLATION",Rr="PLAY_OFF",bx=[Ft,ni,bs,Rr,$a],lI={[ni]:1,[Ft]:2,[Rr]:3,[bs]:3,[$a]:4},kse="finishingPositions",xse="aggregateEventStructures",Ose={[Ft]:1,[Rr]:2,[bs]:3,[ni]:4,[$a]:5},hNe={[Rr]:1,[Ft]:2,[bs]:3,[ni]:4,[$a]:5},Ix="CLUSTER",fNe="SEPARATE",Jv="WATERFALL",wx="ITEM",So="CONTAINER",Uu="DRAW",Sx="RANDOM",Pu="TOP_DOWN",Qv="BOTTOM_UP",jf="POSITION",Gf="WINNER",xh="LOSER",Pp="FIRST_MATCHUP",nc="AD_HOC",mNe="AD_HOC",iU="FEED_IN",xS="COMPASS",OS="OLYMPIC",gNe="SINGLE_ELIMINATION",mp="SINGLE_ELIMINATION",FP="DOUBLE_ELIMINATION",LS="FIRST_MATCH_LOSER_CONSOLATION",$P="FIRST_ROUND_LOSER_CONSOLATION",_y="LUCKY_DRAW",Tx="CURTIS_CONSOLATION",vNe="CURTIS_CONSOLATION",Qz="FEED_IN_CHAMPIONSHIP_TO_SF",tE="FEED_IN_CHAMPIONSHIP_TO_SF",eq="FEED_IN_CHAMPIONSHIP_TO_QF",iE="FEED_IN_CHAMPIONSHIP_TO_QF",tq="FEED_IN_CHAMPIONSHIP_TO_R16",nE="FEED_IN_CHAMPIONSHIP_TO_R16",Lse="MODIFIED_FEED_IN_CHAMPIONSHIP",rE="MODIFIED_FEED_IN_CHAMPIONSHIP",BP="FEED_IN_CHAMPIONSHIP",yNe="DOUBLE_ROUND_ROBIN",zu="ROUND_ROBIN",Oh="ROUND_ROBIN_WITH_PLAYOFF",Fse="DECIDER",$se="BACKDRAW",iq={0:{name:"East",abbreviation:"E"},"0-1":{name:"West",abbreviation:"W"},"0-2":{name:"North",abbreviation:"N"},"0-3":{name:"Northeast",abbreviation:"NE"},"0-1-1":{name:"South",abbreviation:"S"},"0-1-2":{name:"Southwest",abbreviation:"SW"},"0-2-1":{name:"Northwest",abbreviation:"NW"},"0-1-1-1":{name:"Southeast",abbreviation:"SE"}},nq={0:{name:"East",abbreviation:"E"},"0-1":{name:"West",abbreviation:"W"},"0-2":{name:"North",abbreviation:"N"},"0-1-1":{name:"South",abbreviation:"S"}},ey="WIN_RATIO",YI="ROUND_OUTCOME",Bse=[xS,Tx,iE,nE,tE,BP,eq,tq,Qz,LS,$P,_y,rE,OS,Rr,Oh],bNe=[nc,xS,Tx,FP,iE,nE,tE,BP,iU,LS,$P,_y,rE,OS,Rr,zu,Oh,mp],Qr={MAIN:Ft,QUALIFYING:ni,CONSOLATION:bs,ITEM:wx,CONTAINER:So,FIRST_MATCHUP:Pp,WINNER:Gf,LOSER:xh,AD_HOC:nc,FEED_IN:iU,FLEX_ROUNDS:mNe,COMPASS:xS,PLAY_OFF:Rr,OLYMPIC:OS,KNOCKOUT:gNe,SINGLE_ELIMINATION:mp,DOUBLE_ELIMINATION:FP,CURTIS:Tx,FICSF:Qz,FICQF:eq,FICR16:tq,MFIC:Lse,VOLUNTARY_CONSOLATION:$a,FIRST_MATCH_LOSER_CONSOLATION:LS,FIRST_ROUND_LOSER_CONSOLATION:$P,MODIFIED_FEED_IN_CHAMPIONSHIP:rE,FEED_IN_CHAMPIONSHIP_TO_R16:nE,FEED_IN_CHAMPIONSHIP_TO_QF:iE,FEED_IN_CHAMPIONSHIP_TO_SF:tE,FEED_IN_CHAMPIONSHIP:BP,LUCKY_DRAW:_y,ROUND_ROBIN_WITH_PLAYOFF:Oh,ROUND_ROBIN:zu,DECIDER:Fse,BACKDRAW:$se,COMPASS_ATTRIBUTES:iq,OLYMPIC_ATTRIBUTES:nq,DRAW:Uu,RANDOM:Sx,TOP_DOWN:Pu,BOTTOM_UP:Qv,WATERFALL:Jv,WIN_RATIO:ey,ROUND_OUTCOME:YI,MULTI_STRUCTURE_DRAWS:Bse,generatedDrawTypes:bNe,stageOrder:lI,finishOrder:Ose,AGGREGATE_EVENT_STRUCTURES:xse,FINISHING_POSITIONS:kse},INe=Qr,ks="tournamentRecords",rq="policyDefinitions",ba="tournamentRecord",aq="onlineResource",To="drawDefinition",Vse="tieFormatName",sq="matchUpFormat",Lh="participantId",jse="scheduleDates",wNe="tournamentId",SNe="scheduleDate",TNe="roundNumber",Ux="structureId",oq="participant",VP="matchUpIds",Gse="entryStage",UNe="policyType",Hse="structures",lq="eventType",Gp="matchUpId",Dx="tieFormat",Ex="inContext",Px="structure",Cx="courtIds",DNe="personId",Rx="venueIds",cq="matchUps",zse="courtId",qse="eventId",Zh="matchUp",Wse="drawId",Au="error",Fg="event",nU="param",uq="uuids",ENe="averageMatchUpMinutes",PNe="recoveryMinutes",CNe="periodLength",RNe="number",el="object",Rs="array",ds="_validate",Yse="_message",rc="_invalid",qo="_ofType",dq="_anyOf",FS="_oneOf",zK={[aq]:t=>Nr(Object.keys(t),[AS,_S,kS]).length===3,[Vse]:t=>t&&Bf({namedFormat:t}),[uq]:t=>!t||Array.isArray(t)&&t.every(nr),[Dx]:t=>!Bo({tieFormat:t}).error,[lq]:t=>[Ep,Hc,na].includes(t),[Gse]:t=>bx.includes(t)},MNe={[ks]:wr,[ba]:ut,[rq]:ix,[To]:Gt,[Lh]:la,[sq]:Uz,[wNe]:CS,[Ux]:uc,[VP]:BI,[oq]:GI,[aq]:bm,[lq]:_h,[Hse]:wz,[Gp]:Ks,[Dx]:Ih,[Px]:Ny,[zse]:VI,[cq]:ym,[qse]:Gc,[Zh]:rl,[Cx]:ai,[Rx]:ai,[Wse]:Vd,[Fg]:Jn},NNe={[ks]:el,[rq]:el,[ba]:el,[To]:el,[aq]:el,[jse]:Rs,[oq]:el,[VP]:Rs,[Hse]:Rs,[Dx]:el,[Px]:el,[Cx]:Rs,[Rx]:Rs,[cq]:Rs,[Zh]:el,[Fg]:el,[uq]:Rs};function Qt(t,e,i){if(!t&&!Xi(t))return{error:Re};if(!(e!=null&&e.length)||t!=null&&t._bypassParamCheck)return{valid:!0};if(!Array.isArray(e))return{error:Re};let{paramError:n,errorParam:r}=kNe(t,e);if(!n)return{valid:!0};let a=n[ds]&&(n[Au]||n[rc])||(t==null?void 0:t[r])===void 0&&(n[Au]||n[rc]||MNe[r]||Re)||Re,s=r??(n[FS]&&Object.keys(n[FS]).join(", "));return he({info:{param:s,message:n[Yse]},result:{error:a},stack:i})}function Kse(t,e){let i=Object.keys(t),n=Object.keys(e);return Nr(i,n)}function ANe(t,e){if(!e)return;let i=Kse(t,e);return i.length!==1?{error:Re}:i.reduce((n,r)=>({...n,[r]:!0}),{})}function _Ne(t,e){if(!e)return;let i=Kse(t,e).filter(n=>t[n]);return i.length<1?{error:Re}:i.reduce((n,r)=>({...n,[r]:!0}),{})}function kNe(t,e){let i,n;return{paramError:e.find(({_ofType:r,_oneOf:a,_anyOf:s,_validate:o,_info:l,...c})=>{let u=a&&ANe(t,a);if(u!=null&&u.error)return u.error;u&&Object.assign(c,u);let d=s&&_Ne(t,s);if(d!=null&&d.error)return d.error;d&&Object.assign(c,d);let p=Object.keys(c).filter(f=>typeof c[f]=="boolean"),h=p.find(f=>{let m=o&&!xo(o),g=t[f]!==void 0&&!o&&xNe(t,f,r),v=c[f]&&[void 0,null].includes(t[f]),y=m||g||v||o&&t[f]!==void 0&&!ONe(t[f],o)||zK[f]&&!zK[f](t[f]);return y&&(i=f,n=l),y});return!p.length||h}),errorParam:i,paramInfo:n}}function xNe(t,e,i){return i=i||NNe[e]||"string",i==="array"?!Array.isArray(t[e]):typeof t[e]!==i}function ONe(t,e){return xo(e)?e(t):!0}var pq="DYNAMIC",og="RANKING",tg="RATING",ty="SCALE",wh="SEEDING",rU={RANKING:og,RATING:tg,SCALE:ty,SEEDING:wh};function aU(t){var r;let e=Qt(t,[{[oq]:!0}]);if(e.error)return e;let i=(r=t.participant.timeItems)==null?void 0:r.filter(({itemType:a})=>(a==null?void 0:a.startsWith(ty))&&[og,tg,wh].includes(a.split(".")[1])),n={ratings:{},rankings:{},seedings:{}};if(i!=null&&i.length){let a=o=>i.filter(l=>(l==null?void 0:l.itemType)===o).sort((l,c)=>new Date(l.createdAt||void 0).getTime()-new Date(c.createdAt||void 0).getTime()).pop(),s=Ei(i.map(({itemType:o})=>o));for(let o of s){let l=a(o);if(l){let[,c,u,d,p]=l.itemType.split("."),h=p?`${d}.${p}`:d,f=c===wh&&"seedings"||c===og&&"rankings"||"ratings";n[f][u]||(n[f][u]=[]),n[f][u].push({scaleValue:l.itemValue,scaleDate:l.itemDate,scaleName:h})}}}return{...de,...n}}function cI(t){if(t===null)return{};let{source:e,template:i}=t||{};if(!i)return e;let n={};return r(e,i,n),n;function r(a,s,o){if(!a||!s)return;let l=Object.keys(a),c=Object.keys(s),u=Object.assign({},...c.filter(h=>h.indexOf("||")).map(h=>h.split("||").map(f=>({[f]:h}))).flat()),d=c.concat(...Object.keys(u)),p=d.includes("*");for(let h of l)if(d.indexOf(h)>=0||p){let f=u[h]||h,m=s[f]||p,g=a[h];if(typeof m=="object"&&typeof g!="function"&&!Array.isArray(m))if(Array.isArray(g)){let v=g.map(y=>{let b={};return r(y,m,b)!==!1?b:void 0}).filter(Boolean);o[h]=v}else g&&(o[h]={},r(g,m,o[h]));else{let v=a[h];if(Array.isArray(m)&&!m.includes(v))return!1;(s[h]||p&&s[h]!==!1)&&(o[h]=v)}}}}var AV="voluntaryConsolation",Uf="competitiveBands",hq="roundRobinTally",Hf="positionActions",Ba="matchUpActions",FN="rankingPoints",$S="roundNaming",sU="participant",aE="progression",$g="scheduling",sE="avoidance",LNe="participant",FNe="display",zc="scoring",Su="seeding",BS="feedIn",$Ne="audit",VA="draws",ky={POLICY_TYPE_VOLUNTARY_CONSOLATION:AV,POLICY_TYPE_COMPETITIVE_BANDS:Uf,POLICY_TYPE_ROUND_ROBIN_TALLY:hq,POLICY_TYPE_POSITION_ACTIONS:Hf,POLICY_TYPE_MATCHUP_ACTIONS:Ba,POLICY_TYPE_RANKING_POINTS:FN,POLICY_TYPE_ROUND_NAMING:$S,POLICY_TYPE_PARTICIPANT:sU,POLICY_TYPE_PROGRESSION:aE,POLICY_TYPE_SCHEDULING:$g,POLICY_TYPE_AVOIDANCE:sE,POLICY_TYPE_DISPLAY:FNe,POLICY_TYPE_PRIVACY:LNe,POLICY_TYPE_FEED_IN:BS,POLICY_TYPE_SCORING:zc,POLICY_TYPE_SEEDING:Su,POLICY_TYPE_AUDIT:$Ne,POLICY_TYPE_DRAWS:VA};function lg({tournamentParticipants:t=[],policyDefinitions:e={},contextProfile:i,participantId:n,internalUse:r,personId:a}){let s=t.find(l=>n&&l.participantId===n||a&&l.person&&l.person.personId===a),o=_t(s,!1,r);if(o){let l=e==null?void 0:e[sU];if(i!=null&&i.withScaleValues){let{ratings:c,rankings:u}=aU({participant:o});o.rankings=u,o.ratings=c}if(l!=null&&l.participant)return cI({template:l.participant,source:o})}return o}var BNe="element required",VNe="missing name";function oo(t){if(!t||typeof t!="object")return{error:ai};if(t.element&&typeof(t==null?void 0:t.element)!="object")return{error:Re};if(!(t!=null&&t.name))return{error:ai,info:VNe};if(!(t!=null&&t.element)){if(t.discover&&t.tournamentRecords){for(let e of Object.keys(t.tournamentRecords)){let i=t.tournamentRecords[e],n=oo({element:i,name:t.name});if(n.error)return he({result:n,stack:"removeExtension"})}return{...de}}return{error:ai,info:BNe}}return t!=null&&t.element.extensions?(t.element.extensions=t.element.extensions.filter(e=>(e==null?void 0:e.name)!==t.name),{...de}):{...de,info:za}}function Cp({requiredAttributes:t=["name","value"],extension:e}){if(!e||typeof e!="object"||typeof e.name!="string")return!1;let i=Object.keys(e);return t.filter(n=>i.includes(n)).length===t.length}function dn(t){if(typeof t!="object")return{error:ai};let e="addExtension";if(t!=null&&t.element&&typeof t.element!="object")return he({result:{error:Re},stack:e});if(!Cp({extension:t.extension}))return he({result:{error:Re,info:"invalid extension"},stack:e});if(!t.element)if(t.discover&&!t.tournamentId&&t.tournamentRecords){for(let n of Object.values(t.tournamentRecords)){let r=dn({extension:t.extension,element:n});if(r.error)return he({result:r,stack:e})}return{...de}}else return he({result:{error:ai},stack:e});if(t.element.extensions||(t.element.extensions=[]),(t==null?void 0:t.creationTime)??!0){let n=new Date().toISOString();Object.assign(t.extension,{createdAt:n})}let i=t.element.extensions.find(({name:n})=>n===t.extension.name);return i?i.value=t.extension.value:t.extension.value&&t.element.extensions.push(t.extension),{...de}}function fq(t){return!t||typeof t!="object"?{error:ai}:t.tournamentRecord?dn({creationTime:t.creationTime,element:t.tournamentRecord,extension:t.extension}):{error:ut}}function Mx(t){return!t||typeof t!="object"?{error:ai}:t.drawDefinition?dn({creationTime:t.creationTime,element:t.drawDefinition,extension:t.extension}):{error:tc}}function Bg(t){return!t||typeof t!="object"?{error:ai}:t.event?dn({creationTime:t.creationTime,extension:t.extension,element:t.event}):{error:Gc}}function Zse(t){var n;if(!t||typeof t!="object")return{error:ai};if(!t.participantId)return{error:la};let e=((n=t.tournamentRecord)==null?void 0:n.participants)||[],i=lg({participantId:t.participantId,tournamentParticipants:e});return i?dn({creationTime:t.creationTime,extension:t.extension,element:i}):{error:xr}}function mq(t){return!t||typeof t!="object"?{error:ai}:t.tournamentRecord?oo({element:t.tournamentRecord,name:t.name}):{error:ut}}function Xse(t){return!t||typeof t!="object"?{error:ai}:t.drawDefinition?oo({element:t.drawDefinition,name:t.name}):{error:tc}}function Nx(t){return!t||typeof t!="object"?{error:ai}:t!=null&&t.event?oo({element:t.event,name:t.name}):{error:Gc}}function Jse(t){var n;if(!t||typeof t!="object")return{error:ai};if(!t.participantId)return{error:la};let e=((n=t.tournamentRecord)==null?void 0:n.participants)||[],i=lg({participantId:t.participantId,tournamentParticipants:e});return i?oo({element:i,name:t.name}):{error:xr}}function jP({tournamentRecords:t}){return{tournamentIds:Xi(t)?Object.keys(t):[],...de}}var jNe="extensionQueries";function ki({discover:t,element:e,name:i,...n}){var a;if(!e||!i){if(t&&n){let s=Object.keys(n).filter(c=>typeof t=="boolean"||Array.isArray(t)&&t.includes(c)).find(c=>{var u;return Array.isArray((u=n[c])==null?void 0:u.extensions)?n[c].extensions.find(d=>(d==null?void 0:d.name)===i):!1}),o=s&&n[s];!o&&n.tournamentRecords&&(o=Object.values(n.tournamentRecords).find(c=>{var u;return(u=c.extensions)==null?void 0:u.length}));let l=(a=o==null?void 0:o.extensions)==null?void 0:a.find(c=>(c==null?void 0:c.name)===i);return{extension:l,info:l?void 0:za}}return he({result:{error:ai},stack:jNe})}if(!Array.isArray(e.extensions))return{info:"no extensions"};let r=e.extensions.find(s=>(s==null?void 0:s.name)===i);return{extension:r,info:r?void 0:za}}var GNe="activeSuspension",oE="appliedPolicies",Qse="context",Ax="delegatedOutcome",Ud="disabled",uI="disableAutoCalc",_x="disableLinks",jA="display",Vv="drawDeletions",HNe="drawProfile",GA="entryProfile",zNe="eventProfile",qNe="eventWithdrawalRequests",WNe="factory",qu="flightProfile",_V="groupingAttribute",zf="lineUps",iy="linkedTournamentsIds",kx="matchUpHistory",gq="participantRepresentatives",oU="personRequests",dS="positionActions",YNe="rankingPoints",KNe="registration",Hp="roundTarget",GP="scheduleLimits",qf="scheduleTiming",dI="schedulingProfile",ZNe="statusDetail",VS="subOrder",cg="tally",aD="tieFormatModification",jv={ACTIVE_SUSPENSION:GNe,APPLIED_POLICIES:oE,CONTEXT:Qse,DELEGATED_OUTCOME:Ax,DISABLED:Ud,DISABLE_LINKS:_x,DISABLE_AUTO_CALC:uI,DISPLAY:jA,DRAW_DELETIONS:Vv,DRAW_PROFILE:HNe,ENTRY_PROFILE:GA,EVENT_PROFILE:zNe,EVENT_WITHDRAWAL_REQUESTS:qNe,FLIGHT_PROFILE:qu,GROUPING_ATTRIBUTE:_V,LINEUPS:zf,LINKED_TOURNAMENTS:iy,MATCHUP_HISTORY:kx,PARTICIPANT_REPRESENTATIVES:gq,PERSON_REQUESTS:oU,POSITION_ACTIONS:dS,RANKING_POINTS:YNe,REGISTRATION:KNe,ROUND_TARGET:Hp,SCHEDULE_LIMITS:GP,SCHEDULE_TIMING:qf,SCHEDULING_PROFILE:dI,STATUS_DETAIL:ZNe,SUB_ORDER:VS,TALLY:cg,TIE_FORMAT_MODIFICATIONS:aD,FACTORY:WNe},qK=[Ax,Ud,uI,_x,qu,zf,iy,kx,gq,oU,Hp,GP,qf,dI,VS,cg,aD];function eoe({tournamentRecords:t}){if(typeof t!="object"||!Object.keys(t).length)return{error:wr};let e=jP({tournamentRecords:t}),{tournamentIds:i}=e;return(i==null?void 0:i.length)>1?dn({tournamentRecords:t,discover:!0,extension:{name:iy,value:{tournamentIds:i}}}):{...de}}function toe({tournamentRecords:t}){if(typeof t!="object"||!Object.keys(t).length)return{error:wr};let e=oo({name:iy,tournamentRecords:t,discover:!0});return he({result:e,stack:"unlinkTournaments"})}function ioe({tournamentRecords:t,tournamentId:e}){if(typeof t!="object")return{error:Re};if(!e)return{error:CS};let i=jP({tournamentRecords:t}),{tournamentIds:n}=i;if(!n.includes(e))return{error:CS};let r;return n.every(a=>{var d;let s=t[a],{extension:o}=ki({element:s,name:iy});if(!o)return!0;let l=((d=o==null?void 0:o.value)==null?void 0:d.tournamentIds)||[];if(!(l!=null&&l.length)||l.length===1&&l.includes(e)||a===e){let p=mq({name:iy,tournamentRecord:s});return p.error&&(r=p.error),p.success}let c=l.filter(p=>p!==e);o.value={tournamentIds:c};let u=fq({tournamentRecord:s,extension:o});return u.error&&(r=u.error),u.success}),r?{error:r}:{...de}}var noe={};Li(noe,{getLinkedTournamentIds:()=>HP,getTournamentIds:()=>jP});function HP({tournamentRecords:t}){return typeof t!="object"||!Object.keys(t).length?{error:wr}:{linkedTournamentIds:Object.assign({},...Object.keys(t).map(e=>{var s;let i=t[e],n=i==null?void 0:i.tournamentId,{extension:r}=ki({element:i,name:iy}),a=(((s=r==null?void 0:r.value)==null?void 0:s.tournamentIds)||[]).filter(o=>o!==n);return{[e]:a}}))}}var vq={};Li(vq,{adHocPositionSwap:()=>Hle,addAdHocMatchUps:()=>uO,addDrawDefinitionTimeItem:()=>T3,addFinishingRounds:()=>aC,addGoesTo:()=>ay,addPlayoffStructures:()=>cO,addQualifyingStructure:()=>Gle,addVoluntaryConsolationStage:()=>Lle,addVoluntaryConsolationStructure:()=>d3,allPlayoffPositionsFilled:()=>w3,alternateDrawPositionAssignment:()=>Ele,assignDrawPosition:()=>vce,assignDrawPositionBye:()=>fc,attachConsolationStructures:()=>hce,attachPlayoffStructures:()=>B3,attachQualifyingStructure:()=>S3,attachStructures:()=>lO,autoSeeding:()=>FLe,automatedPlayoffPositioning:()=>mU,automatedPositioning:()=>mC,checkValidEntries:()=>hO,deleteAdHocMatchUps:()=>bce,drawMatic:()=>uW,findDrawDefinition:()=>z3,generateAdHocMatchUps:()=>fO,generateAdHocRounds:()=>cW,generateAndPopulatePlayoffStructures:()=>F3,generateDrawDefinition:()=>kC,generateDrawMaticRound:()=>Q3,generateDrawStructuresAndLinks:()=>Z3,generateDrawTypeAndModifyDrawDefinition:()=>X3,generateQualifyingStructure:()=>R3,generateVoluntaryConsolation:()=>Hce,getAssignedParticipantIds:()=>jy,getAvailableMatchUpsCount:()=>dO,getAvailablePlayoffProfiles:()=>vC,getDrawDefinitionTimeItem:()=>Gq,getDrawParticipantRepresentativeIds:()=>G3,getDrawStructures:()=>Wu,getDrawTypeCoercion:()=>DC,getEligibleVoluntaryConsolationParticipants:()=>j3,getMatchUpsMap:()=>Ts,getParticipantIdFinishingPositions:()=>H3,getPositionAssignments:()=>mE,getPositionsPlayedOff:()=>gU,getSeedingThresholds:()=>m3,getSeedsCount:()=>EC,getStructureSeedAssignments:()=>qc,getTeamLineUp:()=>ry,getValidGroupSizes:()=>hC,isAdHoc:()=>Vo,isCompletedStructure:()=>fg,isValidForQualifying:()=>K3,luckyLoserDrawPositionAssignment:()=>ble,modifyDrawDefinition:()=>fce,modifyDrawName:()=>V3,modifySeedAssignment:()=>Ple,mutate:()=>roe,positionActions:()=>Y3,pruneDrawDefinition:()=>gce,qualifierDrawPositionAssignment:()=>Dle,query:()=>Sce,removeDrawPositionAssignment:()=>hE,removeRoundMatchUps:()=>Ice,removeSeededParticipant:()=>jle,removeStructure:()=>xle,renameStructures:()=>kle,resetDrawDefinition:()=>mce,resetVoluntaryConsolationStructure:()=>goe,setDrawParticipantRepresentativeIds:()=>aoe,setPositionAssignments:()=>Tle,setStructureOrder:()=>Ale,setSubOrder:()=>wce,shiftAdHocRounds:()=>Sle,swapAdHocRounds:()=>Ule,swapDrawPositionAssignments:()=>Ble,updateTeamLineUp:()=>lw,withdrawParticipantAtDrawPosition:()=>dle});var roe={};Li(roe,{adHocPositionSwap:()=>Hle,addAdHocMatchUps:()=>uO,addDrawDefinitionTimeItem:()=>T3,addPlayoffStructures:()=>cO,addQualifyingStructure:()=>Gle,addVoluntaryConsolationStage:()=>Lle,addVoluntaryConsolationStructure:()=>d3,alternateDrawPositionAssignment:()=>Ele,assignDrawPosition:()=>vce,assignDrawPositionBye:()=>fc,attachConsolationStructures:()=>hce,attachPlayoffStructures:()=>B3,attachQualifyingStructure:()=>S3,attachStructures:()=>lO,automatedPlayoffPositioning:()=>mU,automatedPositioning:()=>mC,deleteAdHocMatchUps:()=>bce,luckyLoserDrawPositionAssignment:()=>ble,modifyDrawDefinition:()=>fce,modifyDrawName:()=>V3,modifySeedAssignment:()=>Ple,pruneDrawDefinition:()=>gce,qualifierDrawPositionAssignment:()=>Dle,removeDrawPositionAssignment:()=>hE,removeRoundMatchUps:()=>Ice,removeSeededParticipant:()=>jle,removeStructure:()=>xle,renameStructures:()=>kle,resetDrawDefinition:()=>mce,resetVoluntaryConsolationStructure:()=>goe,setDrawParticipantRepresentativeIds:()=>aoe,setPositionAssignments:()=>Tle,setStructureOrder:()=>Ale,setSubOrder:()=>wce,shiftAdHocRounds:()=>Sle,swapAdHocRounds:()=>Ule,swapDrawPositionAssignments:()=>Ble,updateTeamLineUp:()=>lw,withdrawParticipantAtDrawPosition:()=>dle});var yq=t=>e=>t[e],bq=(t=[])=>t.map(Pa).filter(Boolean),kV=(t=[])=>t.map(Vi).filter(Boolean),Vi=(t={})=>yq(t)("participantId"),Pa=(t={})=>yq(t)("matchUpId"),lE=(t={})=>yq(t)("drawId");function aoe({representativeParticipantIds:t,drawDefinition:e}){if(!e)return{error:tc};if(!Array.isArray(t))return{error:Re};let i=kV((e==null?void 0:e.entries)||[]);return t.length&&Nr(t,i).length<t.length?{error:Re}:Mx({drawDefinition:e,extension:{name:gq,value:t}})}var sl="ABANDONED",KI="AWAITING_RESULT",mn="BYE",zp="CANCELLED",Lr="COMPLETED",lU="DEAD_RUBBER",Yi="DEFAULTED",sa="DOUBLE_DEFAULT",Yr="DOUBLE_WALKOVER",td="IN_PROGRESS",_l="INCOMPLETE",Iq="NOT_PLAYED",as="RETIRED",Vg="SUSPENDED",Vr="TO_BE_PLAYED",cn="WALKOVER",soe=[KI,Lr,Yi,td,_l,as,Vg],wq=[KI,Lr,Yi,Yr,sa,td,_l,as,Vg,cn],Sq=[sl,KI,mn,zp,Lr,lU,Yi,Yr,sa,td,_l,Iq,as,Vg,Vr,cn],Tq=[mn,Yr,sa,Lr,Yi,as,cn],Uq=[sl,KI,zp,lU,td,_l,Iq,Vg,Vr,void 0],ca=[zp,sl,Lr,lU,Yi,Yr,sa,as,cn],xx=[sl,Lr,Yi,Yr,sa,td,as,cn],Dq=[td,_l,Vg,Vr],Eq={ABANDONED:sl,AWAITING_RESULT:KI,BYE:mn,CANCELLED:zp,COMPLETED:Lr,DEAD_RUBBER:lU,DEFAULTED:Yi,DOUBLE_WALKOVER:Yr,DOUBLE_DEFAULT:sa,IN_PROGRESS:td,INCOMPLETE:_l,NOT_PLAYED:Iq,RETIRED:as,SUSPENDED:Vg,TO_BE_PLAYED:Vr,WALKOVER:cn};function ZI(t,e,i){var d,p;let n=h=>{var f,m;return(m=(f=ki({element:h,name:Hp}))==null?void 0:f.extension)==null?void 0:m.value},r=i==null?void 0:i.deprioritizeCompleted,a=(i==null?void 0:i.mode)===xse&&hNe,s=(i==null?void 0:i.mode)===kse&&Ose,o=s||a||lI,l=h=>(h==null?void 0:h.stage)===Ft&&(h==null?void 0:h.stageSequence)===1,c=h=>l(h)?-1:o[h==null?void 0:h.stage],u=h=>h==null?void 0:h.matchUps.every(({matchUpStatus:f})=>ca.includes(f)?1:-1);return r&&u(t)-u(e)||a&&c(t)-c(e)||((t==null?void 0:t.stage)&&o[t.stage]||0)-((e==null?void 0:e.stage)&&o[e.stage]||0)||(n(t)||0)-(n(e)||0)||!s&&!a&&(((d=e==null?void 0:e.positionAssignments)==null?void 0:d.length)??1/0)-(((p=t==null?void 0:t.positionAssignments)==null?void 0:p.length)??1/0)||((t==null?void 0:t.stageSequence)??0)-((e==null?void 0:e.stageSequence)??0)||(HA(t)||0)-(HA(e)||0)}function HA(t){return((t==null?void 0:t.matchUps)||[]).reduce((e,i)=>{var r;let n=(((r=i.finishingPositionRange)==null?void 0:r.winner)||[]).reduce((a,s)=>a+s,0);return!e||n<e?n:e},void 0)}function hi(t){let e=Qt(t,[{[To]:!0,[Ux]:!0}]);if(e.error)return e;let{drawDefinition:i,structureId:n}=t,{structures:r}=Wu({drawDefinition:i}),a=r==null?void 0:r.map(l=>l.structures?[...l.structures].concat(l):l).flat(),s=a==null?void 0:a.find(l=>l.structureId===n);if(!s)return{error:gr};let o=s.structureType===wx?a==null?void 0:a.find(l=>{var c;return(c=l.structures)==null?void 0:c.some(u=>u.structureId===n)}):void 0;return{structure:s,containingStructure:o}}function Wu({withStageGrouping:t,drawDefinition:e,stageSequences:i,stageSequence:n,roundTarget:r,sortConfig:a,stages:s,stage:o}){var f;let l=!e&&Gt||!(e!=null&&e.structures)&&wz||void 0;if(l)return{error:l,structures:[],stageStructures:{}};let c=m=>{var v,y;let g=(y=(v=ki({element:m,name:Hp}))==null?void 0:v.extension)==null?void 0:y.value;return!r||r===g},u=((f=e==null?void 0:e.structures)==null?void 0:f.filter(p).filter(h).filter(c).sort((m,g)=>ZI(m,g,a)))??[],d=t?Object.assign({},...bx.map(m=>{let g=u==null?void 0:u.filter(v=>v.stage===m);return(g==null?void 0:g.length)&&{[m]:g}}).filter(Boolean)):{};return{structures:u,stageStructures:d};function p(m){return!o&&!Array.isArray(s)||o&&m.stage===o||Array.isArray(s)&&s.includes(m.stage)}function h(m){return!n&&!Array.isArray(i)||n&&m.stageSequence===n||Array.isArray(i)&&i.includes(m.stageSequence)}}function ooe({drawDefinition:t}){if(!t)return{error:Gt};let e={};return{allPositionedParticipantIds:(t.structures||[]).map(i=>{let n=i.stage;e[n]||(e[n]=[]);let{positionAssignments:r}=jn({structure:i}),a=(r==null?void 0:r.map(Vi).filter(Boolean))??[];return e[n].push(...a),a}).flat(),stagePositionedParticipantIds:e}}function jn({drawDefinition:t,structureId:e,structure:i}){let n,r=[];if(!i){if(!t)return{positionAssignments:r,error:Gt};if({structure:i,error:n}=hi({drawDefinition:t,structureId:e}),n)return{positionAssignments:r,error:n}}return i.structures?r=[].concat(...i.structures.map(a=>jn({structure:a}).positionAssignments)):i.positionAssignments?r=i.positionAssignments:n=jre,{positionAssignments:r,error:n}}function Ma({drawDefinition:t,structureId:e,structure:i}){var c;let n=((c=jn({drawDefinition:t,structureId:e,structure:i}))==null?void 0:c.positionAssignments)||[],r=n==null?void 0:n.filter(u=>u.participantId??u.bye??u.qualifier),a=n&&(n==null?void 0:n.length)===(r==null?void 0:r.length),s=n==null?void 0:n.filter(u=>!u.participantId&&!u.bye&&!u.qualifier),o=n==null?void 0:n.filter(u=>!u.participantId&&u.bye),l=n==null?void 0:n.filter(u=>!u.participantId&&u.qualifier);return{allPositionsAssigned:a,positionAssignments:n,unassignedPositions:s,assignedPositions:r,qualifierPositions:l,byePositions:o}}var Pq="addDrawDefinition",Ox="addMatchUps",ug="addParticipants",Cq="addScaleItems",loe="addEvent",Rq="addVenue",Af="audit",Mq="dataIssue",Nq="deleteParticipants",Aq="deleteVenue",_q="deletedDrawIds",kq="deletedMatchUpIds",xq="modifyDrawDefinition",coe="modifyDrawEntries",uoe="modifyEventEntries",Oq="modifyMatchUp",Is="modifyParticipants",Lq="modifyPositionAssignments",Fq="modifySeedAssignments",xy="modifyTournamentDetail",Oy="modifyVenue",cE="mutations",xV="publishEvent",doe="publishEventSeeding",poe="publishOrderOfPlay",hoe="publishParticipants",$q="unPublishEvent",Bq="unPublishEventSeeding",Vq="unPublishOrderOfPlay",XNe="unPublishParticipants",Lx="updateInContextMatchUp",foe={ADD_DRAW_DEFINITION:Pq,ADD_MATCHUPS:Ox,ADD_PARTICIPANTS:ug,ADD_SCALE_ITEMS:Cq,ADD_EVENT:loe,ADD_VENUE:Rq,AUDIT:Af,DATA_ISSUE:Mq,DELETE_PARTICIPANTS:Nq,DELETE_VENUE:Aq,DELETED_DRAW_IDS:_q,DELETED_MATCHUP_IDS:kq,MODIFY_DRAW_DEFINITION:xq,MODIFY_DRAW_ENTRIES:coe,MODIFY_EVENT_ENTRIES:uoe,MODIFY_MATCHUP:Oq,MODIFY_PARTICIPANTS:Is,MODIFY_POSITION_ASSIGNMENTS:Lq,MODIFY_SEED_ASSIGNMENTS:Fq,MODIFY_TOURNAMENT_DETAIL:xy,MODIFY_VENUE:Oy,MUTATIONS:cE,PUBLISH_EVENT_SEEDING:doe,PUBLISH_EVENT:xV,PUBLISH_ORDER_OF_PLAY:poe,PUBLISH_PARTICIPANTS:hoe,UNPUBLISH_EVENT_SEEDING:Bq,UNPUBLISH_EVENT:$q,UNPUBLISH_ORDER_OF_PLAY:Vq,UPDATE_INCONTEXT_MATCHUP:Lx};function Fx(t,e){var a;if(!t)return{error:Gt};let i=Date.now();t.updatedAt&&i===new Date(t.updatedAt).getTime()&&(i+=1);let n=new Date(i).toISOString(),r=e==null?void 0:e.filter(Boolean);return t.updatedAt=n,(a=t.structures)==null||a.filter(Boolean).forEach(s=>{(!(r!=null&&r.length)||r!=null&&r.includes(s.structureId))&&(s.updatedAt=n)}),{...de}}function dg({drawDefinition:t,tournamentId:e,matchUps:i,eventId:n}){return t&&Fx(t),Si({payload:{matchUps:i,tournamentId:e,eventId:n},topic:Ox}),{...de}}function Im({drawDefinition:t,tournamentId:e,matchUpIds:i,eventId:n,action:r}){t&&Fx(t),Si({topic:kq,payload:{tournamentId:e,matchUpIds:i,eventId:n,action:r}});for(let a of i)zz({key:a});return{...de}}function Ji({drawDefinition:t,tournamentId:e,structureId:i,context:n,eventId:r,matchUp:a}){return a?(t&&Hn({drawDefinition:t,structureIds:i?[i]:void 0,tournamentId:e,eventId:r}),Si({topic:Oq,payload:{matchUp:a,tournamentId:e,context:n},key:a.matchUpId}),{...de}):(console.log(rl),{error:rl})}function JNe({tournamentId:t,inContextMatchUp:e}){return e?(Si({payload:{inContextMatchUp:e,tournamentId:t},topic:Lx,key:e.matchUpId}),{...de}):{error:rl}}function zP({tournamentId:t,eventId:e,drawDefinition:i}){return i?(Fx(i),Si({payload:{drawDefinition:i,tournamentId:t,eventId:e},topic:Pq,key:i.drawId}),{...de}):(console.log(Gt),{error:Gt})}function QNe({tournamentId:t,eventId:e,drawId:i}){return Si({payload:{drawId:i,tournamentId:t,eventId:e},topic:_q,key:i}),zz({key:i}),{...de}}function Hn({drawDefinition:t,tournamentId:e,structureIds:i,eventId:n}){return t?(Fx(t,i),Si({payload:{tournamentId:e,eventId:n,drawDefinition:t},topic:xq,key:t.drawId}),{...de}):{error:Gt}}function moe({drawDefinition:t,tournamentId:e,structure:i,eventId:n}){if(!t)return{error:Gt};if(!i)return{error:Ny};let r=i.seedAssignments,a=i.structureId,s=t.drawId;return Si({payload:{tournamentId:e,eventId:n,drawId:s,structureId:a,seedAssignments:r},topic:Fq,key:t.drawId}),Hn({structureIds:[a],drawDefinition:t,tournamentId:e,eventId:n}),{...de}}function pg({drawDefinition:t,tournamentId:e,structure:i,event:n}){if(!t)return{error:Gt};if(!i)return{error:Ny};let r=jn({structure:i}),a=i.structureId,s=t.drawId,o=n==null?void 0:n.eventId;return Si({topic:Lq,payload:{positionAssignments:r,tournamentId:e,structureId:a,eventId:o,drawId:s},key:a}),Hn({structureIds:[a],drawDefinition:t,tournamentId:e,eventId:o}),{...de}}function goe({tournamentRecord:t,drawDefinition:e,resetEntries:i,event:n}){var s,o;if(!e)return{error:Gt};let r=(s=e.structures)==null?void 0:s.find(l=>l.stage===$a);if(!r)return{error:gr};let a=((o=r.matchUps)==null?void 0:o.map(({matchUpId:l})=>l))||[];return r.positionAssignments=[],r.seedAssignments=[],r.matchUps=[],Im({tournamentId:t==null?void 0:t.tournamentId,action:"resetVoluntaryConsolationStructure",matchUpIds:a,drawDefinition:e}),i&&(e.entries=e.entries.filter(l=>l.entryStage!==$a)),Hn({tournamentId:t==null?void 0:t.tournamentId,eventId:n==null?void 0:n.eventId,drawDefinition:e,structureIds:[r.structureId]}),{...de}}function jq({drawPositions:t,structure:e}){var n;if([ni,Ft].includes(e.stage)&&e.stageSequence===1)return;let{positionAssignments:i}=jn({structure:e});(n=i==null?void 0:i.filter(({drawPosition:r})=>t==null?void 0:t.includes(r)))==null||n.forEach(r=>{dn({element:r,extension:{name:_x,value:!0}})})}function $x(t){var o,l;let{appliedPolicies:e,positionAction:i,drawDefinition:n}=t;if(((o=e==null?void 0:e.audit)==null?void 0:o[dS])===!1)return;let{extension:r}=ki({name:dS,element:n}),a=Array.isArray(r==null?void 0:r.value)?(r==null?void 0:r.value)??[]:[];if(!(a!=null&&a.length)){let c=n.structures.find(u=>u.stage===Ft);if(c){let u=(l=jn({structure:c}).positionAssignments)==null?void 0:l.map(({drawPosition:d,participantId:p,bye:h,qualifier:f})=>({drawPosition:d,participantId:p,qualifier:f,bye:h}));a.push({name:"initialMainAssignments",initialAssignments:u})}}let s={value:a.concat(i),name:dS};dn({element:n,extension:s})}function cU({tournamentRecord:t,drawDefinition:e,event:i}){var o;let n=((o=(t==null?void 0:t.events)||i&&[i])==null?void 0:o.map(l=>l==null?void 0:l.drawDefinitions).flat().filter(Boolean))||e&&[e]||[],r={},a={},s=n.map(l=>{var c;return(c=l==null?void 0:l.structures)==null?void 0:c.filter(u=>u==null?void 0:u.structures)}).flat().filter(Boolean);for(let l of s){let{structures:c,structureId:u}=l??{};c&&u&&(r[u]=c==null?void 0:c.map(d=>d.structureId))&&c.forEach(d=>a[d.structureId]=l==null?void 0:l.structureId)}return{containedStructures:r,containerStructures:a}}function Bx(t){var a;let{sides:e,matchUpType:i}=t||{},n=(a=t.potentialParticipants)!=null&&a.length?t.potentialParticipants.flat().map(s=>i===Mn?(s==null?void 0:s.individualParticipantIds)||[]:s.participantId).flat():[],r=(e||[]).map(s=>{var o;return i===Mn&&(((o=s==null?void 0:s.participant)==null?void 0:o.individualParticipantIds)||[])||(s==null?void 0:s.participantId)&&[s.participantId]||[]}).flat();return{individualParticipantIds:r.concat(n).flat(),enteredIndividualParticipantIds:r,potentialIndividualParticipantIds:n}}function Jc(t){return(t==null?void 0:t.tournamentRecords)??((t==null?void 0:t.tournamentRecord)&&{[t.tournamentRecord.tournamentId]:t.tournamentRecord})??{}}var qP="SIGN_IN_STATUS",voe="SIGNED_OUT",uE="SIGNED_IN",Lo="TEAM",ji="INDIVIDUAL",pc="GROUP",Ni="PAIR",En="TEAM",pS={TEAM_PARTICIPANT:Lo,INDIVIDUAL:ji,GROUP:pc,TEAM:En,PAIR:Ni},Ls={INDIVIDUAL:ji,GROUP:pc,PAIR:Ni,TEAM:En,SIGN_IN_STATUS:qP,SIGNED_OUT:voe,SIGNED_IN:uE};function Vx({participantsProfile:t,participants:e=[],deepCopy:i}){let n=new Map,r=i!==!1?_t(e,t==null?void 0:t.convertExtensions,!0):e,a=r.filter(l=>l.participantType===En),s=r.filter(l=>l.participantType===pc),o=r.filter(l=>l.participantType===Ni);return r.forEach(l=>{if(l.participantType===ji){let{participantId:c}=l;l.groupParticipantIds=[],l.teamParticipantIds=[],l.pairParticipantIds=[],l.groups=[],l.teams=[],a.forEach(u=>{((u==null?void 0:u.individualParticipantIds)||[]).forEach(d=>{var p;d===c&&!((p=l.teamParticipantIds)!=null&&p.includes(u.participantId))&&(l.teamParticipantIds.push(u.participantId),n.get(u.participantId)||n.set(u.participantId,{participantName:u.participantName,participantId:u.participantId}),l.teams.push({participantRoleResponsibilities:u.participantRoleResponsibilities,participantOtherName:u.participantOtherName,participantName:u.participantName,participantId:u.participantId,teamId:u.teamId}))})}),o.forEach(u=>{((u==null?void 0:u.individualParticipantIds)||[]).forEach(d=>{d===c&&!l.pairParticipantIds.includes(u.participantId)&&l.pairParticipantIds.push(u.participantId)})}),s.forEach(u=>{((u==null?void 0:u.individualParticipantIds)||[]).forEach(d=>{d===c&&!l.groupParticipantIds.includes(u.participantId)&&(l.groupParticipantIds.push(u.participantId),l.groups.push({participantRoleResponsibilities:u.participantRoleResponsibilities,participantOtherName:u.participantOtherName,participantName:u.participantName,participantId:u.participantId}))})})}}),{participantsWithGroupings:r,groupInfo:Object.fromEntries(n)}}function yoe(t){return t&&typeof String.fromCodePoint<"u"?t.toUpperCase().replace(/./g,e=>String.fromCodePoint(e.charCodeAt(0)+127397)):t}function eAe(t){let e=Object.assign({},...ig.filter(i=>i.ioc).map(i=>({[i.ioc]:i.iso})));return yoe(e[t])}var ig=[{ioc:"",iso2:"",iso:"",label:"NONE",phone:""},{ioc:"AND",iso2:"AD",iso:"AND",label:"Andorra",phone:"376"},{ioc:"UAE",iso2:"AE",iso:"ARE",label:"United Arab Emirates",phone:"971"},{ioc:"AFG",iso2:"AF",iso:"AFG",label:"Afghanistan",phone:"93"},{ioc:"ANT",iso2:"AG",iso:"ATG",label:"Antigua and Barbuda",phone:"1-268"},{ioc:"AIA",iso2:"AI",iso:"AIA",label:"Anguilla",phone:"1-264"},{ioc:"ALB",iso2:"AL",iso:"ALB",label:"Albania",phone:"355"},{ioc:"ARM",iso2:"AM",iso:"ARM",label:"Armenia",phone:"374"},{ioc:"ANG",iso2:"AO",iso:"AGO",label:"Angola",phone:"244"},{ioc:"",iso2:"AQ",iso:"ATA",label:"Antarctica",phone:"672"},{ioc:"ARG",iso2:"AR",iso:"ARG",label:"Argentina",phone:"54"},{ioc:"ASA",iso2:"AS",iso:"ASM",label:"American Samoa",phone:"1-684"},{ioc:"AUT",iso2:"AT",iso:"AUT",label:"Austria",phone:"43"},{ioc:"AUS",iso2:"AU",iso:"AUS",label:"Australia",phone:"61",suggested:!0},{ioc:"ARU",iso2:"AW",iso:"ABW",label:"Aruba",phone:"297"},{ioc:"AZE",iso2:"AZ",iso:"AZE",label:"Azerbaijan",phone:"994"},{ioc:"BIH",iso2:"BA",iso:"BIH",label:"Bosnia and Herzegovina",phone:"387"},{ioc:"BAR",iso2:"BB",iso:"BRB",label:"Barbados",phone:"1-246"},{ioc:"BAN",iso2:"BD",iso:"BGD",label:"Bangladesh",phone:"880"},{ioc:"BEL",iso2:"BE",iso:"BEL",label:"Belgium",phone:"32"},{ioc:"BUR",iso2:"BF",iso:"BFA",label:"Burkina Faso",phone:"226"},{ioc:"BUL",iso2:"BG",iso:"BGR",label:"Bulgaria",phone:"359"},{ioc:"BRN",iso2:"BH",iso:"BHR",label:"Bahrain",phone:"973"},{ioc:"BDI",iso2:"BI",iso:"BDI",label:"Burundi",phone:"257"},{ioc:"BEN",iso2:"BJ",iso:"BEN",label:"Benin",phone:"229"},{ioc:"",iso2:"BL",iso:"BLM",label:"Saint Barthelemy",phone:"590"},{ioc:"BER",iso2:"BM",iso:"BMU",label:"Bermuda",phone:"1-441"},{ioc:"BRU",iso2:"BN",iso:"BRN",label:"Brunei Darussalam",phone:"673"},{ioc:"BOL",iso2:"BO",iso:"BOL",label:"Bolivia",phone:"591"},{ioc:"BRA",iso2:"BR",iso:"BRA",label:"Brazil",phone:"55"},{ioc:"BAH",iso2:"BS",iso:"BHS",label:"Bahamas",phone:"1-242"},{ioc:"BHU",iso2:"BT",iso:"BTN",label:"Bhutan",phone:"975"},{ioc:"",iso2:"BV",iso:"BVT",label:"Bouvet Island",phone:"47"},{ioc:"BOT",iso2:"BW",iso:"BWA",label:"Botswana",phone:"267"},{ioc:"BLR",iso2:"BY",iso:"BLR",label:"Belarus",phone:"375"},{ioc:"BIZ",iso2:"BZ",iso:"BLZ",label:"Belize",phone:"501"},{ioc:"CAN",iso2:"CA",iso:"CAN",label:"Canada",phone:"1",suggested:!0},{ioc:"",iso2:"CC",iso:"CCK",label:"Cocos (Keeling) Islands",phone:"61"},{ioc:"CGO",iso2:"CD",iso:"COG",label:"Congo, Republic of the",phone:"242"},{ioc:"CAF",iso2:"CF",iso:"CAF",label:"Central African Republic",phone:"236"},{ioc:"COD",iso2:"CG",iso:"CGD",label:"Congo, Democratic Republic of the",phone:"243"},{ioc:"SUI",iso2:"CH",iso:"CHE",label:"Switzerland",phone:"41"},{ioc:"CIV",iso2:"CI",iso:"CIV",label:"Cote d'Ivoire",phone:"225"},{ioc:"COK",iso2:"CK",iso:"COK",label:"Cook Islands",phone:"682"},{ioc:"CHI",iso2:"CL",iso:"CHL",label:"Chile",phone:"56"},{ioc:"CMR",iso2:"CM",iso:"CMR",label:"Cameroon",phone:"237"},{ioc:"CHN",iso2:"CN",iso:"CHN",label:"China",phone:"86"},{ioc:"COL",iso2:"CO",iso:"COL",label:"Colombia",phone:"57"},{ioc:"CRC",iso2:"CR",iso:"CRI",label:"Costa Rica",phone:"506"},{ioc:"CUB",iso2:"CU",iso:"CUB",label:"Cuba",phone:"53"},{ioc:"CPV",iso2:"CV",iso:"CPV",label:"Cape Verde",phone:"238"},{ioc:"CUW",iso2:"CW",iso:"CUW",label:"Curacao",phone:"599"},{ioc:"CXR",iso2:"CX",iso:"CXR",label:"Christmas Island",phone:"61"},{ioc:"CYP",iso2:"CY",iso:"CYP",label:"Cyprus",phone:"357"},{ioc:"CZE",iso2:"CZ",iso:"CZE",label:"Czech Republic",phone:"420"},{ioc:"GER",iso2:"DE",iso:"DEU",label:"Germany",phone:"49",suggested:!0},{ioc:"DJI",iso2:"DJ",iso:"DJI",label:"Djibouti",phone:"253"},{ioc:"DEN",iso2:"DK",iso:"DNK",label:"Denmark",phone:"45"},{ioc:"DMA",iso2:"DM",iso:"DMA",label:"Dominica",phone:"1-767"},{ioc:"DOM",iso2:"DO",iso:"DOM",label:"Dominican Republic",phone:"1-809"},{ioc:"ALG",iso2:"DZ",iso:"DZA",label:"Algeria",phone:"213"},{ioc:"ECU",iso2:"EC",iso:"ECU",label:"Ecuador",phone:"593"},{ioc:"EST",iso2:"EE",iso:"ESE",label:"Estonia",phone:"372"},{ioc:"EGY",iso2:"EG",iso:"EGY",label:"Egypt",phone:"20"},{ioc:"",iso2:"EH",iso:"ESH",label:"Western Sahara",phone:"212"},{ioc:"ERI",iso2:"ER",iso:"ERI",label:"Eritrea",phone:"291"},{ioc:"ESP",iso2:"ES",iso:"ESP",label:"Spain",phone:"34"},{ioc:"ETH",iso2:"ET",iso:"ETH",label:"Ethiopia",phone:"251"},{ioc:"FIN",iso2:"FI",iso:"FIN",label:"Finland",phone:"358"},{ioc:"FIJ",iso2:"FJ",iso:"FJI",label:"Fiji",phone:"679"},{ioc:"FLK",iso2:"FK",iso:"FLK",label:"Falkland Islands (Malvinas)",phone:"500"},{ioc:"FSM",iso2:"FM",iso:"FSM",label:"Micronesia, Federated States of",phone:"691"},{ioc:"FAR",iso2:"FO",iso:"FRO",label:"Faroe Islands",phone:"298"},{ioc:"FRA",iso2:"FR",iso:"FRA",label:"France",phone:"33",suggested:!0},{ioc:"GAB",iso2:"GA",iso:"GAB",label:"Gabon",phone:"241"},{ioc:"GBR",iso2:"GB",iso:"GBR",label:"United Kingdom",phone:"44"},{ioc:"GRN",iso2:"GD",iso:"GRD",label:"Grenada",phone:"1-473"},{ioc:"GEO",iso2:"GE",iso:"GEO",label:"Georgia",phone:"995"},{ioc:"FGU",iso2:"GF",iso:"GUF",label:"French Guiana",phone:"594"},{ioc:"",iso2:"GG",iso:"GGY",label:"Guernsey",phone:"44"},{ioc:"",iso2:"GH",iso:"GHA",label:"Ghana",phone:"233"},{ioc:"GIB",iso2:"GI",iso:"GIB",label:"Gibraltar",phone:"350"},{ioc:"GRL",iso2:"GL",iso:"GRL",label:"Greenland",phone:"299"},{ioc:"GAM",iso2:"GM",iso:"GMB",label:"Gambia",phone:"220"},{ioc:"GUI",iso2:"GN",iso:"GIN",label:"Guinea",phone:"224"},{ioc:"GUD",iso2:"GP",iso:"GLP",label:"Guadeloupe",phone:"590"},{ioc:"GEQ",iso2:"GQ",iso:"GNQ",label:"Equatorial Guinea",phone:"240"},{ioc:"GRE",iso2:"GR",iso:"GRC",label:"Greece",phone:"30"},{ioc:"",iso2:"GS",iso:"SGS",label:"South Georgia and the South Sandwich Islands",phone:"500"},{ioc:"GUA",iso2:"GT",iso:"GTM",label:"Guatemala",phone:"502"},{ioc:"GUM",iso2:"GU",iso:"GUM",label:"Guam",phone:"1-671"},{ioc:"GBS",iso2:"GW",iso:"GNB",label:"Guinea-Bissau",phone:"245"},{ioc:"GUY",iso2:"GY",iso:"GUY",label:"Guyana",phone:"592"},{ioc:"HKG",iso2:"HK",iso:"HKG",label:"Hong Kong",phone:"852"},{ioc:"",iso2:"HM",iso:"HMD",label:"Heard Island and McDonald Islands",phone:"672"},{ioc:"HON",iso2:"HN",iso:"HND",label:"Honduras",phone:"504"},{ioc:"CRO",iso2:"HR",iso:"HRV",label:"Croatia",phone:"385"},{ioc:"HAI",iso2:"HT",iso:"HTI",label:"Haiti",phone:"509"},{ioc:"HUN",iso2:"HU",iso:"HUN",label:"Hungary",phone:"36"},{ioc:"INA",iso2:"ID",iso:"IDN",label:"Indonesia",phone:"62"},{ioc:"IRL",iso2:"IE",iso:"IRL",label:"Ireland",phone:"353"},{ioc:"ISR",iso2:"IL",iso:"ISR",label:"Israel",phone:"972"},{ioc:"",iso2:"IM",iso:"IMN",label:"Isle of Man",phone:"44"},{ioc:"IND",iso2:"IN",iso:"IND",label:"India",phone:"91"},{ioc:"",iso2:"IO",iso:"IOT",label:"British Indian Ocean Territory",phone:"246"},{ioc:"IRQ",iso2:"IQ",iso:"IRQ",label:"Iraq",phone:"964"},{ioc:"IRI",iso2:"IR",iso:"IRN",label:"Iran, Islamic Republic of",phone:"98"},{ioc:"ISL",iso2:"IS",iso:"ISL",label:"Iceland",phone:"354"},{ioc:"ITA",iso2:"IT",iso:"ITA",label:"Italy",phone:"39"},{ioc:"",iso2:"JE",iso:"JEY",label:"Jersey",phone:"44"},{ioc:"JAM",iso2:"JM",iso:"JAM",label:"Jamaica",phone:"1-876"},{ioc:"JOR",iso2:"JO",iso:"JOR",label:"Jordan",phone:"962"},{ioc:"JPN",iso2:"JP",iso:"JPN",label:"Japan",phone:"81",suggested:!0},{ioc:"KEN",iso2:"KE",iso:"KEN",label:"Kenya",phone:"254"},{ioc:"KGZ",iso2:"KG",iso:"KGZ",label:"Kyrgyzstan",phone:"996"},{ioc:"CAM",iso2:"KH",iso:"KHM",label:"Cambodia",phone:"855"},{ioc:"KIR",iso2:"KI",iso:"KIR",label:"Kiribati",phone:"686"},{ioc:"COM",iso2:"KM",iso:"COM",label:"Comoros",phone:"269"},{ioc:"SKN",iso2:"KN",iso:"KNA",label:"Saint Kitts and Nevis",phone:"1-869"},{ioc:"KOR",iso2:"KP",iso:"KOR",label:"Korea, Democratic People's Republic of",phone:"850"},{ioc:"PRK",iso2:"KR",iso:"PRK",label:"Korea, Republic of",phone:"82"},{ioc:"KUW",iso2:"KW",iso:"KWT",label:"Kuwait",phone:"965"},{ioc:"CAY",iso2:"KY",iso:"CYM",label:"Cayman Islands",phone:"1-345"},{ioc:"KAZ",iso2:"KZ",iso:"KAZ",label:"Kazakhstan",phone:"7"},{ioc:"LAO",iso2:"LA",iso:"LAO",label:"Lao People's Democratic Republic",phone:"856"},{ioc:"LIB",iso2:"LB",iso:"LBN",label:"Lebanon",phone:"961"},{ioc:"LCA",iso2:"LC",iso:"LCA",label:"Saint Lucia",phone:"1-758"},{ioc:"LIE",iso2:"LI",iso:"LIE",label:"Liechtenstein",phone:"423"},{ioc:"SRI",iso2:"LK",iso:"LKA",label:"Sri Lanka",phone:"94"},{ioc:"LBR",iso2:"LR",iso:"LBR",label:"Liberia",phone:"231"},{ioc:"LES",iso2:"LS",iso:"LSO",label:"Lesotho",phone:"266"},{ioc:"LTU",iso2:"LT",iso:"LTU",label:"Lithuania",phone:"370"},{ioc:"LUX",iso2:"LU",iso:"LUX",label:"Luxembourg",phone:"352"},{ioc:"LAT",iso2:"LV",iso:"LVA",label:"Latvia",phone:"371"},{ioc:"LBA",iso2:"LY",iso:"LBY",label:"Libya",phone:"218"},{ioc:"MAR",iso2:"MA",iso:"MAR",label:"Morocco",phone:"212"},{ioc:"MON",iso2:"MC",iso:"MCO",label:"Monaco",phone:"377"},{ioc:"MDA",iso2:"MD",iso:"MDA",label:"Moldova, Republic of",phone:"373"},{ioc:"MNE",iso2:"ME",iso:"MNE",label:"Montenegro",phone:"382"},{ioc:"",iso2:"MF",iso:"MAF",label:"Saint Martin (French part)",phone:"590"},{ioc:"MAD",iso2:"MG",iso:"MDG",label:"Madagascar",phone:"261"},{ioc:"MSH",iso2:"MH",iso:"MHL",label:"Marshall Islands",phone:"692"},{ioc:"MKD",iso2:"MK",iso:"MKD",label:"Macedonia, the Former Yugoslav Republic of",phone:"389"},{ioc:"MLI",iso2:"ML",iso:"MLI",label:"Mali",phone:"223"},{ioc:"MYA",iso2:"MM",iso:"MMR",label:"Myanmar",phone:"95"},{ioc:"MGL",iso2:"MN",iso:"MNG",label:"Mongolia",phone:"976"},{ioc:"MAC",iso2:"MO",iso:"MAC",label:"Macao",phone:"853"},{ioc:"NMA",iso2:"MP",iso:"NMP",label:"Northern Mariana Islands",phone:"1-670"},{ioc:"MRT",iso2:"MQ",iso:"MTQ",label:"Martinique",phone:"596"},{ioc:"MTN",iso2:"MR",iso:"MRT",label:"Mauritania",phone:"222"},{ioc:"MNT",iso2:"MS",iso:"MSR",label:"Montserrat",phone:"1-664"},{ioc:"MLT",iso2:"MT",iso:"MLT",label:"Malta",phone:"356"},{ioc:"MRI",iso2:"MU",iso:"MUS",label:"Mauritius",phone:"230"},{ioc:"MDV",iso2:"MV",iso:"MDV",label:"Maldives",phone:"960"},{ioc:"MAW",iso2:"MW",iso:"MWI",label:"Malawi",phone:"265"},{ioc:"MEX",iso2:"MX",iso:"MEX",label:"Mexico",phone:"52"},{ioc:"MAS",iso2:"MY",iso:"MYS",label:"Malaysia",phone:"60"},{ioc:"MOZ",iso2:"MZ",iso:"MOZ",label:"Mozambique",phone:"258"},{ioc:"NAM",iso2:"NA",iso:"NAM",label:"Namibia",phone:"264"},{ioc:"NCL",iso2:"NC",iso:"NCL",label:"New Caledonia",phone:"687"},{ioc:"NIG",iso2:"NE",iso:"NER",label:"Niger",phone:"227"},{ioc:"NFI",iso2:"NF",iso:"NFK",label:"Norfolk Island",phone:"672"},{ioc:"NGR",iso2:"NG",iso:"NGA",label:"Nigeria",phone:"234"},{ioc:"NCA",iso2:"NI",iso:"NIC",label:"Nicaragua",phone:"505"},{ioc:"NED",iso2:"NL",iso:"NLD",label:"Netherlands",phone:"31"},{ioc:"NOR",iso2:"NO",iso:"NOR",label:"Norway",phone:"47"},{ioc:"NEP",iso2:"NP",iso:"NPL",label:"Nepal",phone:"977"},{ioc:"NRU",iso2:"NR",iso:"NRU",label:"Nauru",phone:"674"},{ioc:"NIU",iso2:"NU",iso:"NIU",label:"Niue",phone:"683"},{ioc:"NZL",iso2:"NZ",iso:"NZL",label:"New Zealand",phone:"64"},{ioc:"OMA",iso2:"OM",iso:"OMN",label:"Oman",phone:"968"},{ioc:"PAN",iso2:"PA",iso:"PAN",label:"Panama",phone:"507"},{ioc:"PER",iso2:"PE",iso:"PER",label:"Peru",phone:"51"},{ioc:"FPO",iso2:"PF",iso:"PYF",label:"French Polynesia",phone:"689"},{ioc:"PNG",iso2:"PG",iso:"PNG",label:"Papua New Guinea",phone:"675"},{ioc:"PHI",iso2:"PH",iso:"PHL",label:"Philippines",phone:"63"},{ioc:"PAK",iso2:"PK",iso:"PAK",label:"Pakistan",phone:"92"},{ioc:"POL",iso2:"PL",iso:"POL",label:"Poland",phone:"48"},{ioc:"SPM",iso2:"PM",iso:"SPM",label:"Saint Pierre and Miquelon",phone:"508"},{ioc:"",iso2:"PN",iso:"PCN",label:"Pitcairn",phone:"870"},{ioc:"PUR",iso2:"PR",iso:"PRI",label:"Puerto Rico",phone:"1"},{ioc:"PLE",iso2:"PS",iso:"PSE",label:"Palestine, State of",phone:"970"},{ioc:"POR",iso2:"PT",iso:"PRT",label:"Portugal",phone:"351"},{ioc:"PLW",iso2:"PW",iso:"PLW",label:"Palau",phone:"680"},{ioc:"PAR",iso2:"PY",iso:"PRY",label:"Paraguay",phone:"595"},{ioc:"QAT",iso2:"QA",iso:"QAT",label:"Qatar",phone:"974"},{ioc:"REU",iso2:"RE",iso:"REU",label:"Reunion",phone:"262"},{ioc:"ROU",iso2:"RO",iso:"ROU",label:"Romania",phone:"40"},{ioc:"SRB",iso2:"RS",iso:"SRB",label:"Serbia",phone:"381"},{ioc:"RUS",iso2:"RU",iso:"RUS",label:"Russia",phone:"7"},{ioc:"RWA",iso2:"RW",iso:"RWA",label:"Rwanda",phone:"250"},{ioc:"KSA",iso2:"SA",iso:"SAU",label:"Saudi Arabia",phone:"966"},{ioc:"SOL",iso2:"SB",iso:"SLB",label:"Solomon Islands",phone:"677"},{ioc:"SEY",iso2:"SC",iso:"SYC",label:"Seychelles",phone:"248"},{ioc:"SUD",iso2:"SD",iso:"SDN",label:"Sudan",phone:"249"},{ioc:"SWE",iso2:"SE",iso:"SWE",label:"Sweden",phone:"46"},{ioc:"SIN",iso2:"SG",iso:"SGP",label:"Singapore",phone:"65"},{ioc:"HEL",iso2:"SH",iso:"SHN",label:"Saint Helena",phone:"290"},{ioc:"SLO",iso2:"SI",iso:"SVN",label:"Slovenia",phone:"386"},{ioc:"",iso2:"SJ",iso:"SJM",label:"Svalbard and Jan Mayen",phone:"47"},{ioc:"SVK",iso2:"SK",iso:"SVK",label:"Slovakia",phone:"421"},{ioc:"SLE",iso2:"SL",iso:"SLE",label:"Sierra Leone",phone:"232"},{ioc:"SMR",iso2:"SM",iso:"SMR",label:"San Marino",phone:"378"},{ioc:"SEN",iso2:"SN",iso:"SEN",label:"Senegal",phone:"221"},{ioc:"SOM",iso2:"SO",iso:"SOM",label:"Somalia",phone:"252"},{ioc:"SUR",iso2:"SR",iso:"SUR",label:"Suriname",phone:"597"},{ioc:"",iso2:"SS",iso:"SSD",label:"South Sudan",phone:"211"},{ioc:"STP",iso2:"ST",iso:"STP",label:"Sao Tome and Principe",phone:"239"},{ioc:"ESA",iso2:"SV",iso:"SLV",label:"El Salvador",phone:"503"},{ioc:"",iso2:"SX",iso:"SMX",label:"Sint Maarten",phone:"1-721"},{ioc:"SYR",iso2:"SY",iso:"SYR",label:"Syria",phone:"963"},{ioc:"",iso2:"SZ",iso:"SWZ",label:"Swaziland",phone:"268"},{ioc:"TKS",iso2:"TC",iso:"TCA",label:"Turks and Caicos Islands",phone:"1-649"},{ioc:"CHA",iso2:"TD",iso:"TCD",label:"Chad",phone:"235"},{ioc:"",iso2:"TF",iso:"ATF",label:"French Southern Territories",phone:"262"},{ioc:"TOG",iso2:"TG",iso:"TGO",label:"Togo",phone:"228"},{ioc:"THA",iso2:"TH",iso:"THA",label:"Thailand",phone:"66"},{ioc:"TJK",iso2:"TJ",iso:"TJK",label:"Tajikistan",phone:"992"},{ioc:"",iso2:"TK",iso:"TKL",label:"Tokelau",phone:"690"},{ioc:"TLS",iso2:"TL",iso:"TLS",label:"Timor-Leste",phone:"670"},{ioc:"TKM",iso2:"TM",iso:"TKM",label:"Turkmenistan",phone:"993"},{ioc:"TUN",iso2:"TN",iso:"TUN",label:"Tunisia",phone:"216"},{ioc:"TGA",iso2:"TO",iso:"TON",label:"Tonga",phone:"676"},{ioc:"TUR",iso2:"TR",iso:"TUR",label:"Turkey",phone:"90"},{ioc:"TTO",iso2:"TT",iso:"TTO",label:"Trinidad and Tobago",phone:"1-868"},{ioc:"TUV",iso2:"TV",iso:"TUV",label:"Tuvalu",phone:"688"},{ioc:"TPE",iso2:"TW",iso:"TWN",label:"Taiwan",phone:"886"},{ioc:"TAN",iso2:"TZ",iso:"TZA",label:"United Republic of Tanzania",phone:"255"},{ioc:"UKR",iso2:"UA",iso:"UKR",label:"Ukraine",phone:"380"},{ioc:"UGA",iso2:"UG",iso:"UGA",label:"Uganda",phone:"256"},{ioc:"USA",iso2:"US",label:"United States",phone:"1",suggested:!0,iso:"USA"},{ioc:"URU",iso2:"UY",iso:"URY",label:"Uruguay",phone:"598"},{ioc:"UZB",iso2:"UZ",iso:"UZB",label:"Uzbekistan",phone:"998"},{ioc:"",iso2:"VA",iso:"VAT",label:"Holy See (Vatican City State)",phone:"379"},{ioc:"VIN",iso2:"VC",iso:"VCT",label:"Saint Vincent and the Grenadines",phone:"1-784"},{ioc:"VEN",iso2:"VE",iso:"VEN",label:"Venezuela",phone:"58"},{ioc:"IVB",iso2:"VG",iso:"VGB",label:"British Virgin Islands",phone:"1-284"},{ioc:"ISV",iso2:"VI",iso:"VIR",label:"US Virgin Islands",phone:"1-340"},{ioc:"VIE",iso2:"VN",iso:"VNM",label:"Vietnam",phone:"84"},{ioc:"VAN",iso2:"VU",iso:"VUT",label:"Vanuatu",phone:"678"},{ioc:"WAF",iso2:"WF",iso:"WLF",label:"Wallis and Futuna",phone:"681"},{ioc:"SAM",iso2:"WS",iso:"WSM",label:"Samoa",phone:"685"},{ioc:"KOS",iso2:"XK",iso:"KOS",label:"Kosovo",phone:"383"},{ioc:"YEM",iso2:"YE",iso:"YEM",label:"Yemen",phone:"967"},{ioc:"MAY",iso2:"YT",iso:"MYT",label:"Mayotte",phone:"262"},{ioc:"RSA",iso2:"ZA",iso:"ZAF",label:"South Africa",phone:"27"},{ioc:"ZAM",iso2:"ZM",iso:"ZMB",label:"Zambia",phone:"260"},{ioc:"ZIM",iso2:"ZW",iso:"ZWE",label:"Zimbabwe",phone:"263"}];function boe({participant:t,withISO2:e,withIOC:i}){let{person:n,individualParticipants:r}=t,a=[n,r==null?void 0:r.map(({person:o})=>o)].flat().filter(Boolean);function s(o){let{nationalityCode:l}=o||{};if(l){let c=ig.find(({iso:u})=>u===l);i&&(c!=null&&c.ioc)&&!o.iocNationalityCode&&(o.iocNationalityCode=c.ioc),e&&(c!=null&&c.iso2)&&!o.iso2NationalityCode&&(o.iso2NationalityCode=c.iso2),c!=null&&c.label&&!o.countryName&&(o.countryName=c.label)}}a.forEach(s)}function tAe({participantMap:t,template:e}){var n;let i=Object.values(t);for(let r of i){let a=r.participant;if((n=a.individualParticipantIds)!=null&&n.length){a.individualParticipants=[];for(let s of a.individualParticipantIds){let o=t[s].participant;a.individualParticipants.push(e?cI({template:e,source:o}):o)}}}}function jg(t){var r;let{tournamentRecord:e,participantId:i}=t,n=t.tournamentRecords||e&&{[e.tournamentId]:e}||{};for(let a of Object.values(n)){let s=(r=a.participants)==null?void 0:r.find(o=>o.participantId===i);if(s)return{participant:s,tournamentId:a.tournamentId}}return{error:xr}}function Ioe(t){let{tournamentRecord:e,participantId:i}=t;if(i){let r=jg({tournamentRecord:e,participantId:i});return r.participant??r}return t.element||t.drawDefinition||t.event||t.tournamentRecord||{error:ai}}function Qc(t){let{returnPreviousValues:e,itemSubTypes:i,itemType:n}=t,r=Ioe(t);if(r.error)return r;if(i&&!Array.isArray(i))return{error:Re,context:{itemSubTypes:i}};if(!Array.isArray(r.timeItems))return{error:Oz};let a=r.timeItems.filter(o=>(o==null?void 0:o.itemType)===n).filter(o=>!(i!=null&&i.length)||i.some(l=>{var c;return(c=o==null?void 0:o.itemSubTypes)==null?void 0:c.includes(l)})).sort((o,l)=>{let c=new Date(o.createdAt||void 0).getTime(),u=new Date(l.createdAt||void 0).getTime();return c-u}),s=_t(a.pop(),!1,!0);if(s){let o={timeItem:s,...de};return e&&Object.assign(o,{previousItems:a}),o}else return{info:za}}function Gq({returnPreviousValues:t,drawDefinition:e,itemSubTypes:i,itemType:n}){if(!e)return{error:Vd};if(!e.timeItems)return{info:za};let{timeItem:r,previousItems:a,info:s}=Qc({element:e,returnPreviousValues:t,itemSubTypes:i,itemType:n});return r&&{timeItem:r,previousItems:a}||{info:s}}function WP({returnPreviousValues:t,itemSubTypes:e,itemType:i,event:n}){if(!n)return{error:Jn};if(!n.timeItems)return{info:za};let{timeItem:r,previousItems:a,info:s}=Qc({returnPreviousValues:t,element:n,itemSubTypes:e,itemType:i});return r&&{timeItem:r,previousItems:a}||{info:s}}function jx({returnPreviousValues:t,tournamentRecord:e,itemSubTypes:i,itemType:n}){if(!e)return{error:ut};if(!e.timeItems)return{info:za};let{timeItem:r,previousItems:a,info:s}=Qc({element:e,returnPreviousValues:t,itemSubTypes:i,itemType:n});return r&&{timeItem:r,previousItems:a}||{info:s}}function Hq({returnPreviousValues:t,tournamentRecord:e,participantId:i,itemSubTypes:n,itemType:r}){if(!e)return{error:ut};if(!i)return{error:la};let a=jg({tournamentRecord:e,participantId:i});if(a.error)return a;let{participant:s}=a;if(!(s!=null&&s.timeItems))return{info:za};let{timeItem:o,previousItems:l,info:c}=Qc({element:a.participant,returnPreviousValues:t,itemSubTypes:n,itemType:r});return o&&{timeItem:o,previousItems:l}||{info:c}}var iAe={[pc]:"groupParticipantIds",[Ni]:"pairParticipantIds",[En]:"teamParticipantIds"},nAe={[pc]:"groups",[En]:"teams"};function woe({withIndividualParticipants:t,convertExtensions:e,tournamentRecord:i,withSignInStatus:n,withScaleValues:r,withGroupings:a,internalUse:s,withISO2:o,withIOC:l}){let c=[],u={};for(let p of i.participants??[]){let h=p==null?void 0:p.participantId;h&&sAe({participantMap:u,participantId:h})}for(let p of i.participants??[]){let h=_t(p,e,s),{participantId:f,individualParticipantIds:m,participantType:g}=h;if(!u[f]){c.push(f);continue}if(Object.assign(u[f].participant,h),m){let v=aAe({individualParticipantIds:m,participantCopy:h,participantMap:u,participantType:g,participantId:f});v.missingParticipantIds.length&&c.push(...v.missingParticipantIds)}if(n&&(u[f].participant.signedIn=rAe(h)),r){let{ratings:v,rankings:y,seedings:b}=aU({participant:h});u[f].participant.seedings=b,u[f].participant.rankings=y,u[f].participant.ratings=v}(l||o)&&boe({participant:u[f].participant,withISO2:o,withIOC:l})}if(t){let p=Xi(t)?t:void 0;tAe({participantMap:u,template:p})}let d;return a&&(d=Vx({participants:Object.values(u).map(({participant:p})=>p),participantsProfile:{convertExtensions:e},deepCopy:!1}).groupInfo),{missingParticipantIds:c,participantMap:u,groupInfo:d}}function rAe(t){let{timeItem:e}=Qc({itemType:qP,element:t});return(e==null?void 0:e.itemValue)===uE}function aAe({individualParticipantIds:t,participantCopy:e,participantMap:i,participantType:n,participantId:r}){var s;let a=[];for(let o of t){let l=(s=i[o])==null?void 0:s.participant;if(!l){a.push(o);continue}if(l[iAe[n]].push(r),[En,pc].includes(n)){let{participantRoleResponsibilities:c,participantOtherName:u,participantName:d,participantId:p,teamId:h}=e,f=nAe[n];l[f].push({participantRoleResponsibilities:c,participantOtherName:u,participantName:d,participantId:p,teamId:h})}if(n===Ni){let c=t.find(u=>u!==o);i[o].pairIdMap[r]=c,i[o].pairIdMap[c]=r}}return{missingParticipantIds:a}}function sAe({participantMap:t,participantId:e}){if(t[e])return;let i={walkoverWins:0,defaultWins:0,walkovers:0,defaults:0,losses:0,wins:0};t[e]={structureParticipation:{},potentialMatchUps:{},scheduleConflicts:{},scheduleItems:[],participant:{groupParticipantIds:[],pairParticipantIds:[],teamParticipantIds:[],seedings:{},rankings:{},ratings:{},groups:[],teams:[]},statistics:{},opponents:{},pairIdMap:{},matchUps:{},events:{},draws:{},counters:{[xn]:{...i},[Mn]:{...i},[En]:{...i},...i}}}function Ly({participantsProfile:t,useParticipantMap:e,tournamentRecord:i,contextProfile:n,inContext:r}){if(e)return woe({...t,...n,tournamentRecord:i});let a=_t(i.participants,!1,!0)||[];(t!=null&&t.withIOC||t!=null&&t.withISO2)&&a.forEach(o=>boe({participant:o,...t}));let s;if((r||t!=null&&t.withGroupings)&&(a!=null&&a.length)&&({participantsWithGroupings:a,groupInfo:s}=Vx({participantsProfile:t,deepCopy:!1,participants:a})),(t==null?void 0:t.withScaleValues)&&(a==null?void 0:a.length))for(let o of a){let{ratings:l,rankings:c}=aU({participant:o});o.rankings=c,o.ratings=l}return{participants:a,groupInfo:s}}function hn({onlySpecifiedPolicyTypes:t=!1,policyTypes:e=[],tournamentRecord:i,drawDefinition:n,structure:r,event:a}){if(!Array.isArray(e))return{error:Dz};let s={};return i&&o(i),a&&o(a),n&&o(n),r&&o(r),{appliedPolicies:s,...de};function o(l){var u,d;let c=(d=(u=l==null?void 0:l.extensions)==null?void 0:u.find(p=>p.name===oE))==null?void 0:d.value;if(c)for(let p of Object.keys(c))(t?e.includes(p):!e.length||e.includes(p))&&(s[p]=_t(c[p],!1,!0))}}function wm({policyTypes:t=[],tournamentRecord:e,drawDefinition:i,structure:n,event:r}){if(!Array.isArray(t))return{error:Dz};let{appliedPolicies:a}=hn({tournamentRecord:e,drawDefinition:i,structure:n,event:r}),s={};for(let o of t){let l=a==null?void 0:a[o];l&&(s[o]=l)}return Object.keys(s).length?{policyDefinitions:s}:{info:xb.message}}var Soe="WALKOVER",WK="RETIRED",zq="COMPETITIVE",dE="ROUTINE",pE="DECISIVE",$N="winRatio",oAe={[Uf]:{policyName:"Competitive Bands Default",profileBands:{[pE]:20,[dE]:50}}},qq=oAe;function Sm({policyDefinitions:t,tournamentRecord:e,contextProfile:i,drawDefinition:n,event:r}){let a={policies:{}};if(!i)return a;let s=wm({tournamentRecord:e,drawDefinition:n,event:r}).policyDefinitions;if(i.withCompetitiveness){let o=(t==null?void 0:t[Uf])??(s==null?void 0:s[Uf])??qq[Uf];a.policies[Uf]=o}return a}function Fy({tournamentRecord:t,drawDefinition:e,policyType:i,structure:n,event:r}){if(!t)return{error:ut};let{appliedPolicies:a}=hn({tournamentRecord:t,drawDefinition:e,structure:n,event:r});return a!=null&&a[i]?{policy:a[i]}:{info:xb==null?void 0:xb.message}}function YP({tournamentRecord:t,categoryName:e,categoryType:i,event:n}){var o,l,c,u,d,p;e=e??((o=n==null?void 0:n.category)==null?void 0:o.categoryName)??((l=n==null?void 0:n.category)==null?void 0:l.ageCategoryCode),i=i??((c=n==null?void 0:n.category)==null?void 0:c.categoryType)??((u=n==null?void 0:n.category)==null?void 0:u.subType);let{policy:r}=Fy({policyType:$g,tournamentRecord:t,event:n}),a=(d=t?ki({element:t,name:qf}).extension:void 0)==null?void 0:d.value,s=(p=n&&ki({name:qf,element:n}).extension)==null?void 0:p.value;return{scheduleTiming:{tournamentScheduling:a,eventScheduling:s,categoryName:e,categoryType:i,policy:r}}}function Wq({drawDefinition:t,attributes:e}){let{extension:i}=ki({element:t,name:GA}),n=(i==null?void 0:i.value)||{};return e.forEach(r=>{Object.keys(r).forEach(a=>{n[a]?Object.assign(n[a],r[a]):n[a]=r[a]})}),i={name:GA,value:n},Mx({drawDefinition:t,extension:i}),{entryProfile:n}}function KP({drawDefinition:t}){let{extension:e}=ki({element:t,name:GA});return{entryProfile:(e==null?void 0:e.value)||{}}}var _u="ALTERNATE",ZP="CONFIRMED",ol="DIRECT_ACCEPTANCE",XP="FEED_IN",JP="JUNIOR_EXEMPT",Wf="LUCKY_LOSER",QP="ORGANISER_ACCEPTANCE",eC="QUALIFIER",lAe="REGISTERED",tC="SPECIAL_EXEMPT",eu="UNGROUPED",$y="UNPAIRED",jS="WILDCARD",Fh="WITHDRAWN",BN=[ZP,ol,JP,QP,tC],Toe=[XP,Wf,eC],By=[ZP,ol,XP,JP,QP,tC,jS],id=[ZP,ol,JP,Wf,eC,QP,tC,jS],Uoe=[_u,ZP,ol,XP,JP,Wf,QP,eC,lAe,tC,eu,$y,jS,Fh],nd={ALTERNATE:_u,CONFIRMED:ZP,DIRECT_ACCEPTANCE:ol,DIRECT_ENTRY_STATUSES:By,DRAW_SPECIFIC_STATUSES:Toe,EQUIVALENT_ACCEPTANCE_STATUSES:BN,FEED_IN:XP,JUNIOR_EXEMPT:JP,LUCKY_LOSER:Wf,ORGANISER_ACCEPTANCE:QP,QUALIFIER:eC,SPECIAL_EXEMPT:tC,STRUCTURE_SELECTED_STATUSES:id,UNGROUPED:eu,UNPAIRED:$y,VALID_ENTRY_STATUSES:Uoe,WILDCARD:jS,WITHDRAWN:Fh};function Yq({stage:t,drawDefinition:e}){let{entryProfile:i}=KP({drawDefinition:e}),n=Object.keys(i).includes(t);if(!n&&bx.includes(t)){let r=[{[t]:{drawSize:void 0,alternates:!0}}];return Wq({drawDefinition:e,attributes:r}),!0}return n}function cAe({stage:t,drawDefinition:e}){var n;let{entryProfile:i}=KP({drawDefinition:e});return((n=i[t])==null?void 0:n.alternates)||0}function uAe({stage:t,drawDefinition:e}){var n;let{entryProfile:i}=KP({drawDefinition:e});return((n=i[t])==null?void 0:n.wildcardsCount)||0}function OV({stage:t,drawDefinition:e,entryStatus:i}){return e.entries.reduce((n,r)=>r.entryStage===t&&r.entryStatus===i?n+1:n,0)}function XI({provisionalPositioning:t,placementGroup:e,drawDefinition:i,stageSequence:n,entryStatuses:r,structureId:a,roundTarget:s,stages:o,stage:l}){var u;let c=((u=i.entries)==null?void 0:u.reduce((d,p)=>{var v,y;let h=(y=(v=ki({name:Hp,element:p}))==null?void 0:v.extension)==null?void 0:y.value,f=l&&p.entryStage===l||(o==null?void 0:o.length)&&p.entryStage&&o.includes(p.entryStage),m=!r||p.entryStatus&&r.includes(p.entryStatus),g=p.entryStageSequence??1;return f&&(!n||g===n)&&m&&(!s||!h||s===h)?d.concat(p):d},[]))??[];if(a&&l===Rr){let{playoffEntries:d,error:p}=dAe({provisionalPositioning:t,drawDefinition:i,structureId:a});return p&&console.log("playoff entries error"),(d!=null&&d.length?d:c).filter(h=>!e||h.placementGroup===e)}return c}function dAe({provisionalPositioning:t,drawDefinition:e,structureId:i}){let n=[],r=(e.links??[]).find(a=>a.linkType===jf&&a.target.structureId===i);if(r){let{finishingPositions:a,structureId:s}=r.source,{structure:o}=hi({drawDefinition:e,structureId:s});(o==null?void 0:o.structureType)===So&&(o.structures??[]).forEach(l=>{let c=l.positionAssignments??[],{structureId:u}=l,d=u,p=Object.assign({},...c.map(m=>{var y;let{participantId:g}=m,v=(y=ki({element:m,name:cg}).extension)==null?void 0:y.value;return v&&g?{[g]:v}:void 0}).filter(Boolean)),h=Object.keys(p).reduce((m,g)=>{let v=p[g],y=v.groupOrder||t&&v.provisionalOrder;return m.includes(y)||m.push(y),m},[]).length===Object.keys(p).length,f=Object.keys(p).filter(m=>{let g=p[m],v=g.groupOrder||t&&g.provisionalOrder;return a==null?void 0:a.includes(v)});(!t||h)&&f.forEach(m=>{let g=p[m],{groupOrder:v,provisionalOrder:y,GEMscore:b}=g,I=v||t&&y,T=[...a??[]].sort(ia).indexOf(I)+1;n.push({entryStage:Rr,entryStatus:XP,placementGroup:T,groupingValue:d,participantId:m,GEMscore:b})})})}return{playoffEntries:n}}function pAe({stage:t,drawDefinition:e}){return By.reduce((i,n)=>(OV({drawDefinition:e,entryStatus:n,stage:t})||0)+i,0)}function qc({provisionalPositioning:t,returnAllProxies:e,drawDefinition:i,structureId:n,structure:r}){var f;let a,s=[];r||({structure:r,error:a}=hi({drawDefinition:i,structureId:n}));let o=jn({structure:r}).positionAssignments;if(a||!r)return{seedAssignments:[],error:gr};n||(n=r.structureId);let{stage:l,stageSequence:c}=r,u=l===Rr&&i&&XI({provisionalPositioning:t,drawDefinition:i,stageSequence:c,structureId:n,stage:l}),d=u?u.filter(m=>m.placementGroup===1).sort((m,g)=>m.GEMscore<g.GEMscore&&1||m.GEMscore>g.GEMscore&&-1||0).map((m,g)=>{let v=g+1;return{participantId:m.participantId,seedValue:v,seedProxy:!0,seedNumber:v}}):[],p=d==null?void 0:d.slice(0,e?d.length:o.length/2);p.length?s=p:r.seedAssignments?s=r.seedAssignments:a=Are;let h=r.seedLimit??((f=r==null?void 0:r.positionAssignments)==null?void 0:f.length);return{seedAssignments:s,stageSequence:c,seedLimit:h,stage:l,error:a}}function np(t){if(!t)return;let{tieFormatId:e,tieFormats:i}=t;if(t.tieFormat)return t.tieFormat;if(e&&Array.isArray(i))return i.find(n=>n.tieFormatId===e)}function sD({item:t,drawDefinition:e,structure:i,event:n}){var r,a,s;if(t){if(t.tieFormat)return t.tieFormat;if(t.tieFormatId)return e.tieFormat?e.tieFormat:((r=e.tieFormats)==null?void 0:r.find(l=>t.tieFormatId===l.tieFormatId))||(n.tieFormat?n.tieFormat:(a=n.tieFormats)==null?void 0:a.find(l=>t.tieFormatId===l.tieFormatId));if(i.tieFormat)return i.tieFormat;if(i.tieFormatId){let o=(s=e.tieFormats)==null?void 0:s.find(l=>i.tieFormatId===l.tieFormatId);if(o)return o}}}function qs({drawDefinition:t,structure:e,matchUp:i,event:n}){return{tieFormat:sD({item:i,drawDefinition:t,structure:e,event:n})||sD({item:e,drawDefinition:t,structure:e,event:n})||np(t)||np(n)}}function hAe({matchUps:t}){let e=t.reduce((i,n)=>!n.collectionPosition||i.includes(n.collectionPosition)?i:i.concat(n.collectionPosition),[]).map(i=>({[i]:t.filter(n=>n.collectionPosition===i)}));return{collectionPositionMatchUps:Object.assign({},...e)}}function Ts({drawDefinition:t,structure:e}){let i={},n=[];return((t==null?void 0:t.structures)??[e]).filter(r=>r&&typeof r=="object").forEach(r=>{if(!r)return;let{structureId:a,matchUps:s,structures:o}=r,l=Array.isArray(o);if(l)l&&o.forEach(c=>{let{structureName:u}=c,d=c.matchUps;i[c.structureId]={matchUps:d,itemStructureIds:[],structureName:u},d&&(n.push(...d),d.forEach(p=>{p.tieMatchUps&&n.push(...p.tieMatchUps)})),i[a]||(i[a]={itemStructureIds:[],matchUps:[]}),i[a].itemStructureIds||(i[a].itemStructureIds=[]),i[a].itemStructureIds.push(c.structureId)});else{let c=s;i[a]={matchUps:c,itemStructureIds:[]},c==null||c.forEach(u=>{n.push(u),u.tieMatchUps&&n.push(...u.tieMatchUps)})}}),{mappedMatchUps:i,drawMatchUps:n}}function ny({mappedMatchUps:t,matchUpsMap:e,structureId:i,inContext:n}){t=(e==null?void 0:e.mappedMatchUps)??t;let r=t[i],a=((r==null?void 0:r.itemStructureIds)||[]).map(s=>{let{matchUps:o,structureName:l}=t[s];return n?o.map(c=>Object.assign(_t(c,!0,!0),{containerStructureId:i,structureId:s,structureName:l})):o}).flat();return((r==null?void 0:r.matchUps)||[]).concat(...a)}function Doe({groupedOrder:t,roundPositionsCount:e}){if(!t||(t==null?void 0:t.length)<=e)return t;let i=Ra(t,t.length/e).map(r=>r.reduce((a,s)=>a+s)),n=i.slice().sort(ia);return i.map(r=>n.indexOf(r)+1)}function Gx(t){if(!Xi(t))return!1;let{matchUpId:e,drawPositions:i}=t,n=typeof e=="string",r=!i||Array.isArray(i)&&i.length<=2&&i.every(a=>Ii(a)||a===void 0||a===null);return n&&r}function tu(t){return Array.isArray(t)?t.every(Gx):!1}function fo({matchUps:t=[],interpolate:e}){var d;if(!tu(t))return{roundMatchUps:[],error:Re};let i=t.reduce((p,h)=>{let f=typeof h.roundNumber=="string"?ui(h.roundNumber):h.roundNumber;return!h.roundNumber||p.includes(f)?p:p.concat(f)},[]).sort(ia).map(p=>{let h=t.filter(g=>g.roundNumber===p),f=h.find(({matchUpType:g})=>g===Zn)?h.filter(({matchUpType:g})=>g===Zn):h,m=g=>g.sort((v,y)=>ia(v.roundPosition,y.roundPosition));return{[p]:m(f)}}),n=t.reduce((p,h)=>{let f=typeof h.roundNumber=="string"?ui(h.roundNumber):h.roundNumber;return p[f]||(p[f]=Kt({abbreviatedRoundName:h.abbreviatedRoundName,finishingRound:h.finishingRound,roundName:h.roundName})),p},{}),r=Object.assign({},...i);if(e){let p=Math.max(...Object.keys(r).map(f=>ui(f)).filter(f=>!isNaN(f))),h=(d=r[p])==null?void 0:d.length;if(h>1&&Rd(h)){let f=p+1,m=f+h/2;Rt(f,m).forEach((g,v)=>{r[g]=Rt(0,h/(2+v*2)).map(()=>({}))})}}let a=0,s=Object.assign({},...Object.keys(r).map(p=>{var g,v,y;let h=(g=r[p])==null?void 0:g.length,f=(y=(v=r[p])==null?void 0:v.filter(b=>{var I;return!ca.includes(b.matchUpStatus)&&!((I=b.score)!=null&&I.scoreStringSide1)}))==null?void 0:y.length,m=h&&h===f;return a=Math.max(a,h),{[p]:{matchUpsCount:h,inactiveCount:f,inactiveRound:m}}})),o=0,l=0,c=Object.keys(r).map(p=>ui(p)).filter(p=>!isNaN(p));c.forEach(p=>{var m,g,v,y,b;let h=r[p].sort((I,T)=>I.roundPosition-T.roundPosition),f=h.map(I=>(I==null?void 0:I.drawPositions)||[]).flat();if(s[p].roundNumber=p,s[p].roundFactor=s[p].matchUpsCount?a/s[p].matchUpsCount:1,s[p].finishingRound=(m=n[p])==null?void 0:m.finishingRound,s[p].roundName=(g=n[p])==null?void 0:g.roundName,s[p].abbreviatedRoundName=(v=n[p])==null?void 0:v.abbreviatedRoundName,s[p].finishingPositionRange=(b=(y=r[p])==null?void 0:y[0])==null?void 0:b.finishingPositionRange,p===1||!s[p-1]){let I=f.sort(ia),T=Ra(I,2);s[p].drawPositions=I,s[p].pairedDrawPositions=T}else{let I=s[p-1],T=I.drawPositions,w=I.matchUpsCount/s[p].matchUpsCount,S=Ra(T,w),U=h.map(P=>{let{roundPosition:E}=P,R=[...P.drawPositions||[],void 0,void 0].slice(0,2);if(!E)return R;let C=(R==null?void 0:R.filter(Boolean))||[];if(!(C!=null&&C.length))return[void 0,void 0];if(p<3&&(C==null?void 0:C.length)===2)return R==null?void 0:R.slice().sort(ia);let M=Nr(T,C).length!==(C==null?void 0:C.length);if(C!=null&&C.length&&M)return(C==null?void 0:C.length)===1?[C[0],void 0]:R==null?void 0:R.slice().sort(ia);let _=(E-1)*2;return S.slice(_,_+2).map(A=>C==null?void 0:C.find(N=>A.includes(N)))});s[p].drawPositions=U==null?void 0:U.flat(),s[p].pairedDrawPositions=U}s[p+1]&&s[p+1].matchUpsCount===s[p].matchUpsCount&&(s[p+1].feedRound=!0,s[p+1].feedRoundIndex=l,s[p].preFeedRound=!0,l+=1),s[p]&&!s[p].feedRound&&(s[p].roundIndex=o,o+=1)});let u=!!Object.values(s).find(({matchUpsCount:p})=>!Rd(p));return{hasNoRoundPositions:t.some(p=>!p.roundPosition),roundsNotPowerOf2:u,maxMatchUpsCount:a,roundMatchUps:r,roundNumbers:c,roundProfile:s,...de}}function VN(t){if(!Array.isArray(t))return"";let e=t.filter(Dr);return e.length?Ei([Math.min(...e),Math.max(...e)]).join("-"):""}function fAe({drawDefinition:t,structureId:e,matchUpsMap:i}){if(!t)return{error:Gt};if(!e)return{error:uc};let{structure:n}=hi({drawDefinition:t,structureId:e});if((n==null?void 0:n.stage)!==bs)return{error:Ay,info:"Structure is not CONSOLATION stage"};let{links:r}=t,a=(r==null?void 0:r.filter(d=>d.target.structureId===e))||[],s=(a==null?void 0:a.reduce((d,p)=>{let{structureId:h}=p.source;return d.includes(h)?d:d.concat(h)},[]))||[],o=Object.assign({},...s.map(d=>{let p=ny({structureId:d,matchUpsMap:i}),h=fo({matchUps:p}).roundProfile;return{[d]:h}})),l=ny({matchUpsMap:i,structureId:e}),{roundProfile:c}=fo({matchUps:l}),u={};return a==null||a.forEach(d=>{var C,M,_;let{structureId:p,roundNumber:h}=d.source,{feedProfile:f,groupedOrder:m,positionInterleave:g,roundNumber:v}=d.target,y=o[p],b=(C=y[1])==null?void 0:C.drawPositions,I=(M=y[h])==null?void 0:M.matchUpsCount;if(!I)return;let T=I?b.length/I:0,w=b.length/T,S=b.slice(),U=Doe({roundPositionsCount:w,groupedOrder:m}),P=(U==null?void 0:U.length)||1;if(P<=w){let A=b.length/P,N=Ra(S,A);f===Qv&&N.forEach(k=>k.reverse()),S=(U==null?void 0:U.length)&&(U==null?void 0:U.map(k=>N[k-1]).flat())||S}let E=Ra(S,T);if(g){let A=Rt(0,g.interleave).map(()=>{}),N=Rt(0,g.offset).map(()=>{});E=E.map(O=>[O,...A]),E.unshift(N),E=E.flat(1);let k=E.length-g.offset;E=E.slice(0,k)}u[v]||(u[v]={});let R=(_=c==null?void 0:c[v])!=null&&_.feedRound?2:1;E.forEach((A,N)=>{let k=1+N*R;u[v][k]||(u[v][k]=VN(A))})}),{sourceDrawPositionRanges:u}}function Eoe({drawDefinition:t}){if(typeof t!="object")return{error:kb};let e={},{structures:i=[],links:n=[]}=t||{},r=i.reduce((s,o)=>{let{stage:l}=o;return s[l]?s[l].push(o):s[l]=[o],s},{});for(let s of Object.keys(r)){let o=r[s].find(({stageSequence:c})=>c===1);if(!o)continue;let{structureId:l}=o;a({aggregator:{},targetRound:0,exitProfiles:e,exitProfile:"0",structureId:l,stage:s})}return{exitProfiles:e};function a({exitProfiles:s,exitProfile:o,structureId:l,targetRound:c,aggregator:u,stage:d}){s[l]||(s[l]=[]),o==="0"&&[bs,Rr].includes(d)||s[l].push(o);let p=n.filter(h=>h.source.structureId===l&&h.source.roundNumber>=c);for(let h of p){let f=h.source.roundNumber,m=h.target.roundNumber,g=h.target.structureId,v=i.find(b=>b.structureId===g).stage,y=[v,g,m,f].join("|");if(u[y])return;u[y]=!0,a({exitProfile:`${o}-${f}`,structureId:g,exitProfiles:s,targetRound:m,aggregator:u,stage:v})}}}function mAe({drawDefinition:t,roundProfile:e,structureId:i,matchUpsMap:n}){var s;if(!t)return{error:Gt};if(!i)return{error:uc};if(!e){let o=ny({matchUpsMap:n,structureId:i});if({roundProfile:e}=fo({matchUps:o}),!e)return{error:ai}}let r=(Math.min(...((s=e==null?void 0:e[1])==null?void 0:s.drawPositions)??[])||1)-1,a=Object.keys(e);return{drawPositionsRanges:Object.assign({},...(a||[]).map(o=>{var v,y;let l=(v=e==null?void 0:e[o])==null?void 0:v.matchUpsCount,c=((y=e==null?void 0:e[1])==null?void 0:y.drawPositions)??[],u=Ra(c,c.length/l),d=u.map(VN),p=u.map(b=>b.map(I=>I-r)).map(VN),h=a.map(b=>{var T;if(b>o)return;let I=((T=e==null?void 0:e[b])==null?void 0:T.drawPositions)??[];return Ra(I,I.length/l)}).filter(Boolean),f=Rt(0,l).map(b=>h.map(I=>I[b]).flat().filter(Boolean).sort(ia)).map(b=>Ei(b)),m=f.map(b=>qRe(b).map(VN).join(", ")),g=Object.assign({},...Rt(0,l).map(b=>({[b+1]:{firstRoundDrawPositionsRange:d[b],firstRoundOffsetDrawPositionsRange:p[b],possibleDrawPositions:f[b],drawPositionsRange:m[b]}})));return{[o]:g}}))}}function Kq({roundsNotPowerOf2:t,drawDefinition:e,structure:i,matchUps:n}){var a;if(!i)return!1;n=n??i.matchUps??[],t=t??fo({matchUps:n}).roundsNotPowerOf2;let r=!!((a=i.positionAssignments)!=null&&a.find(({drawPosition:s})=>s))||!!(n!=null&&n.find(({drawPositions:s})=>s==null?void 0:s.length));return(!(e!=null&&e.drawType)||e.drawType!==_y)&&!(i!=null&&i.structures)&&t&&r}function Vo({structure:t}){if(!t)return!1;let e=t.matchUps||t.roundMatchUps&&Object.values(t.roundMatchUps).flat(),i=!!(e!=null&&e.find(r=>r==null?void 0:r.roundPosition)),n=!!(e!=null&&e.find(r=>{var a;return(a=r==null?void 0:r.drawPositions)==null?void 0:a.length}));return!(t!=null&&t.structures)&&(t==null?void 0:t.stage)!==$a&&(!e.length||!i&&!n)}var Zq={[$S]:{policyName:"Round Naming Default",namingConventions:{round:"Round",pre:"Pre"},qualifyingFinishMap:{1:"Final"},abbreviatedRoundNamingMap:{1:"F",2:"SF",4:"QF"},roundNamingMap:{1:"Final",2:"Semifinal",4:"Quarterfinal"},affixes:{roundNumber:"R",preFeedRound:"Q",preQualifying:"P"},stageConstants:{[Ft]:"",[Rr]:"P",[ni]:"Q",[bs]:"C"}}},gAe=Zq;function vAe({roundNamingPolicy:t,drawDefinition:e,structure:i,matchUps:n}){var C,M,_;let{roundProfile:r,roundMatchUps:a}=fo({matchUps:n}),{structureAbbreviation:s,stage:o}=i,l=Vo({structure:i}),c=Kq({structure:i}),u=i.structures,d={},p=Zq[$S],h=i.stage===ni,f=h?Math.max(...((e==null?void 0:e.structures)??[]).filter(A=>A.stage===ni).map(({stageSequence:A})=>A??1),0):0,m=(i.stageSequence??1)<f?i.stageSequence??1:"",g=m&&(((C=t==null?void 0:t.affixes)==null?void 0:C.preQualifying)||p.affixes.preQualifying)||"",v=(t==null?void 0:t.roundNamingMap)||p.roundNamingMap||{},y=(t==null?void 0:t.abbreviatedRoundNamingMap)||p.abbreviatedRoundNamingMap||{},b=((M=t==null?void 0:t.affixes)==null?void 0:M.preFeedRound)||p.affixes.preFeedRound,I=((_=t==null?void 0:t.affixes)==null?void 0:_.roundNumber)||p.affixes.roundNumber,T=((t==null?void 0:t.namingConventions)||p.namingConventions).round,w=o&&o!==Ft?o[0]:"",S=(t==null?void 0:t.stageConstants)||p.stageConstants,U=o&&(S==null?void 0:S[o])||w,P=`${g}${U}${m}`,E=r?Object.keys(r):[],R=h&&(S!=null&&S[ni])?`${S==null?void 0:S[ni]}-`:"";if(u||l||c)Object.assign(d,...E.map(A=>{let N=`${R}${T} ${A}`,k=`${I}${A}`;return{[A]:{roundName:N,abbreviatedRoundName:k}}}));else{let A=h&&((t==null?void 0:t.qualifyingFinishMap)||(p==null?void 0:p.qualifyingFinishMap)||{});Object.assign(d,...E.map(N=>{if(!(r!=null&&r[N]))return;let{matchUpsCount:k,preFeedRound:O}=r[N],$=k*2,F=(A==null?void 0:A[r==null?void 0:r[N].finishingRound])||A&&`${I}${$}`||v[k]||`${I}${$}`,V=O?`-${b}`:"",j=`${F}${V}`,B=[P,s,j].filter(Boolean).join("-"),z=`${y[k]||`${I}${$}`}${V}`,W=[P,s,z].filter(Boolean).join("-");return{[N]:{abbreviatedRoundName:W,roundName:B}}}))}return{roundNamingProfile:d,roundProfile:r,roundMatchUps:a}}var yAe=(t,e)=>(t||0)+(e||0);function Poe(t,e){let i=Array.isArray(t)?t[0]:t;return isNaN(i)&&Soe||i<=e[pE]&&pE||i<=e[dE]&&dE||zq}function Coe({score:t}){let e=(t==null?void 0:t.sets)||[],i=e.reduce((r,a)=>(r[0]+=a.side1Score||0,r[1]+=a.side2Score||0,r),[0,0]),n=e.reduce((r,a)=>(r[0]+=a.side1TiebreakScore||0,r[1]+=a.side2TiebreakScore||0,r),[0,0]);return n.reduce(yAe)&&(i[n[0]>n[1]?0:1]+=1),{sets:e,games:i,score:t}}function bAe(t){let e=Math.min(...t.games),i=Math.max(...t.games);return Math.round(e/i*100)}function Roe(t){return t.map(bAe).sort().map(e=>parseFloat(e.toFixed(2)))}function iC({tournamentRecord:t,profileBands:e,matchUp:i}){if(!i)return{error:rl};let{score:n,winningSide:r}=i;if(!r)return{error:Re};let a=!e&&t&&Fy({policyType:Uf,tournamentRecord:t}).policy,s=e||(a==null?void 0:a.profileBands)||qq[Uf].profileBands,o=Coe({score:n}),l=Roe([o]),c=Poe(l,s),u=Array.isArray(l)?l[0]:l;return{...de,competitiveness:c,pctSpread:u}}function Moe({matchUp:t}){var s,o,l;if(!t)return{error:rl};if(t&&!t.sides)return{error:al};if(t&&!t.hasContext)return{error:lx};let e=(s=t.sides??[])==null?void 0:s.map(c=>c==null?void 0:c.participantId).filter(Boolean),i=((o=t.sides)==null?void 0:o.filter(c=>{var u;return((u=c.participant)==null?void 0:u.participantType)===ji}).map(c=>c.participantId).filter(Boolean))??[],n=(((l=t.sides??[])==null?void 0:l.map(c=>{var u;return(u=c.participant)==null?void 0:u.individualParticipants}).filter(Boolean))??[]).map(c=>(c??[]).map(u=>u==null?void 0:u.participantId).filter(Boolean)),r=[...i,...n.flat()].filter(Boolean)??[],a=Ei(r.concat(e)).filter(Boolean)??[];return{nestedIndividualParticipantIds:n,allRelevantParticipantIds:a,individualParticipantIds:r,sideParticipantIds:e,...de}}var zA="CHECK_IN",qA="CHECK_OUT",IAe="SCHEDULE",JI="SCHEDULE.ASSIGNMENT.VENUE",$h="SCHEDULE.ALLOCATION.COURTS",hg="SCHEDULE.ASSIGNMENT.COURT",Hx="SCHEDULE.COURT.ORDER",QI="SCHEDULE.DATE",wAe="COMPLETED.DATE",Xq="HOME_PARTICIPANT_ID",Jq="SCHEDULE.ASSIGN.OFFICIAL",ew="SCHEDULE.TIME.SCHEDULED",gd="SCHEDULE.TIME.START",_f="SCHEDULE.TIME.STOP",Sh="SCHEDULE.TIME.RESUME",Yf="SCHEDULE.TIME.END",zx="SCHEDULE.TIME.MODIFIERS",Noe="TO_BE_ANNOUNCED",Aoe="NEXT_AVAILABLE",_oe="FOLLOWED_BY",koe="AFTER_REST",xoe="RAIN_DELAY",SAe="NOT_BEFORE",LV=[Noe,Aoe,_oe,koe,xoe],TAe="ELIGIBILITY",UAe="REGISTRATION",DAe="SUSPENSION",EAe="MEDICAL",PAe="PENALTY",Ooe="SCALE",Loe="RATING",Foe="RANKING",Qq="SEEDING",Gg="PUBLISH",hc="PUBLIC",Hg="STATUS",CAe="MODIFICATION",RAe="RETRIEVAL",MAe="other",qx={MUTUALLY_EXCLUSIVE_TIME_MODIFIERS:LV,AFTER_REST:koe,ALLOCATE_COURTS:$h,ASSIGN_COURT:hg,ASSIGN_OFFICIAL:Jq,ASSIGN_VENUE:JI,CHECK_IN:zA,CHECK_OUT:qA,COMPLETED_DATE:wAe,COURT_ORDER:Hx,ELIGIBILITY:TAe,END_TIME:Yf,FOLLOWED_BY:_oe,MEDICAL:EAe,MODIFICATION:CAe,NEXT_AVAILABLE:Aoe,NOT_BEFORE:SAe,OTHER:MAe,PENALTY:PAe,PUBLIC:hc,PUBLISH:Gg,RANKING:Foe,RATING:Loe,RAIN_DELAY:xoe,REGISTRATION:UAe,RESUME_TIME:Sh,RETRIEVAL:RAe,SCALE:Ooe,SCHEDULE:IAe,SCHEDULED_DATE:QI,SCHEDULED_TIME:ew,SEEDING:Qq,START_TIME:gd,STATUS:Hg,STOP_TIME:_f,SUSPENSION:DAe,TIME_MODIFIERS:zx,TO_BE_ANNOUNCED:Noe};function tw({matchUp:t}){if(!t)return{error:rl};if(!t.hasContext)return{error:lx};if(!t.sides||t.sides.filter(Boolean).length!==2)return{error:al};let{nestedIndividualParticipantIds:e,allRelevantParticipantIds:i,sideParticipantIds:n}=Moe({matchUp:t}),r=(t.timeItems??[]).filter(o=>(o==null?void 0:o.itemType)&&[zA,qA].includes(o.itemType)).sort((o,l)=>(o.createdAt?new Date(o.createdAt).getTime():0)-(l.createdAt?new Date(l.createdAt).getTime():0)),a=r.map(o=>o.itemValue).filter(o=>r.filter(l=>(l==null?void 0:l.itemValue)===o).reverse()[0].itemType===zA);e==null||e.forEach((o,l)=>{let c=n==null?void 0:n[l],u=(o==null?void 0:o.length)&&o.every(d=>a.includes(d));c&&u&&!a.includes(c)&&a.push(c)}),n==null||n.forEach((o,l)=>{a.includes(o)&&((e==null?void 0:e[l])??[]).forEach(c=>{c&&!a.includes(c)&&a.push(c)})});let s=n==null?void 0:n.reduce((o,l)=>a.includes(l)&&o,!0);return{allRelevantParticipantIds:i,allParticipantsCheckedIn:s,checkedInParticipantIds:a,...de}}var Fr=t=>e=>{let i=Xi(e)&&(e==null?void 0:e.matchUpType)||nr(e)&&e;return i&&dre[t].includes(i)};function oD(t){var a;let{matchUpAverageTimes:e,matchUpFormat:i}=t||{},n=(e==null?void 0:e.map(({matchUpFormatCodes:s})=>s==null?void 0:s.filter(o=>o===i)).flat().filter(Boolean).sort((s,o)=>((s==null?void 0:s.length)||0)-((o==null?void 0:o.length)||0)))||[],r=n.includes(i)?i:n[0];return(a=e==null?void 0:e.find(({matchUpFormatCodes:s,averageTimes:o})=>(s==null?void 0:s.find(l=>r===l))&&o))==null?void 0:a.averageTimes}function lD(t){var r;let{matchUpRecoveryTimes:e,averageMinutes:i,matchUpFormat:n}=t||{};return(r=e==null?void 0:e.find(({matchUpFormatCodes:a,averageTimes:s,recoveryTimes:o})=>{if(s&&i){let{greaterThan:l=0,lessThan:c=360}=s;if(i>l&&i<c)return!0}return(a==null?void 0:a.find(l=>l===n))&&o}))==null?void 0:r.recoveryTimes}function $oe({timesBlockArray:t,categoryName:e,categoryType:i}){return t.filter(n=>Array.isArray(n)).map(n=>n.sort((r,a)=>{var s,o;return(((s=a.categoryNames)==null?void 0:s.length)||0)-(((o=r.categoryNames)==null?void 0:o.length)||0)}).find(({categoryTypes:r,categoryNames:a})=>!(a!=null&&a.length)&&!(r!=null&&r.length)||(a==null?void 0:a.includes(e))||(r==null?void 0:r.includes(i)))).find(Boolean)}function NAe({tournamentScheduling:t,eventScheduling:e,averageMinutes:i,defaultTiming:n,matchUpFormat:r,categoryName:a,categoryType:s,policy:o}){var p;let l=(e==null?void 0:e.matchUpRecoveryTimes)&&lD({...e,averageMinutes:i,matchUpFormat:r}),c=(t==null?void 0:t.matchUpRecoveryTimes)&&lD({...t,averageMinutes:i,matchUpFormat:r}),u=(o==null?void 0:o.matchUpRecoveryTimes)&&lD({...o,averageMinutes:i,matchUpFormat:r}),d=[l,c,u,(p=o==null?void 0:o.defaultTimes)==null?void 0:p.recoveryTimes,n==null?void 0:n.recoveryTimes];return $oe({categoryName:a,categoryType:s,timesBlockArray:d})}function AAe({matchUpFormat:t,categoryName:e,categoryType:i,defaultTiming:n,tournamentScheduling:r,eventScheduling:a,policy:s}){var d;let o=(a==null?void 0:a.matchUpAverageTimes)&&oD({...a,matchUpFormat:t}),l=(r==null?void 0:r.matchUpAverageTimes)&&oD({...r,matchUpFormat:t}),c=(s==null?void 0:s.matchUpAverageTimes)&&oD({...s,matchUpFormat:t}),u=[o,l,c,(d=s==null?void 0:s.defaultTimes)==null?void 0:d.averageTimes,n==null?void 0:n.averageTimes];return $oe({categoryName:e,categoryType:i,timesBlockArray:u})}var Boe="DOUBLES_SINGLES",Voe="SINGLES_DOUBLES",ku="total",FV="participantConflict",zm="matchUpConflict",joe="ISSUE_IDS",Iv="CONFLICT",wv="WARNING",$V="ERROR",BV="ISSUE",jN="STATE",Goe={SINGLES_DOUBLES:Voe,DOUBLES_SINGLES:Boe,TOTAL:ku,CONFLICT_MATCHUP_ORDER:zm,CONFLICT_PARTICIPANTS:FV,SCHEDULE_ISSUE_IDS:joe,SCHEDULE_CONFLICT:Iv,SCHEDULE_WARNING:wv,SCHEDULE_ERROR:$V,SCHEDULE_ISSUE:BV,SCHEDULE_STATE:jN};function nC({defaultAverageMinutes:t=90,defaultRecoveryMinutes:e=0,tournamentRecord:i,matchUpFormat:n,categoryName:r,categoryType:a,eventType:s,event:o}){if(!i)return{error:ut};s=s??(o==null?void 0:o.eventType)??oI;let l={averageTimes:[{minutes:{default:t}}],recoveryTimes:[{minutes:{default:e}}]},{scheduleTiming:c}=YP({tournamentRecord:i,categoryName:r,categoryType:a,event:o}),u={...c,matchUpFormat:n,categoryType:a,defaultTiming:l};return Wx({eventType:s,timingDetails:u})}function Wx({timingDetails:t,eventType:e}){let i=AAe(t),n=Object.keys((i==null?void 0:i.minutes)||{}),r=(i==null?void 0:i.minutes)&&((n==null?void 0:n.includes(e))&&i.minutes[e]||i.minutes.default),a=NAe({...t,averageMinutes:r}),s=Object.keys((a==null?void 0:a.minutes)||{}),o=(a==null?void 0:a.minutes)&&((s==null?void 0:s.includes(e))&&a.minutes[e]||a.minutes.default),l=Fr(oI)(e)?Voe:Boe,c=(a==null?void 0:a.minutes)&&((s==null?void 0:s.includes(l))&&a.minutes[l]||o);return{averageMinutes:r,recoveryMinutes:o,typeChangeRecoveryMinutes:c}}function p$(t){return t.createdAt?new Date(t.createdAt).getTime():0}function Vy({timeItems:t,itemType:e}){let i=t.filter(r=>r&&r.itemType===e).sort((r,a)=>p$(r)-p$(a)).pop(),n=i&&p$(i);return{itemValue:i==null?void 0:i.itemValue,timeStamp:n}}function Hoe({timeStamp:t,schedule:e,matchUp:i}){let{itemValue:n,timeStamp:r}=Vy({timeItems:(i==null?void 0:i.timeItems)||[],itemType:ew});return!e||r&&t&&new Date(r).getTime()>new Date(t).getTime()?{scheduledTime:n}:e}function iw({timeStamp:t,schedule:e,matchUp:i}){let{itemValue:n,timeStamp:r}=Vy({timeItems:(i==null?void 0:i.timeItems)||[],itemType:QI});return!e||r&&t&&new Date(r).getTime()>new Date(t).getTime()?{scheduledDate:n}:e}function pb(t){if(qae.test(t)){let e=Yz();return new Date(`${e}T${t}`)}else return new Date(t)}function _Ae({matchUp:t}){if(!t)return{error:rl};if(!t.timeItems)return{error:Oz};let e=t.timeItems.filter(n=>[gd,_f,Sh,Yf].includes(n==null?void 0:n.itemType)).sort((n,r)=>pb(n.itemValue).getTime()-pb(r.itemValue).getTime()),i=e.reduce((n,r)=>{var l,c;let a,s=(l=r==null?void 0:r.itemType)==null?void 0:l.split("."),o=`SCHEDULE.TIME.${((c=r==null?void 0:r.itemType)==null?void 0:c.startsWith("SCHEDULE.TIME"))&&s[2]}`;switch(o){case gd:a=0;break;case Yf:if(n.lastValue&&[gd,Sh].includes(n.lastType)){let u=pb(r.itemValue).getTime()-pb(n.lastValue).getTime();a=n.milliseconds+u}else a=n.milliseconds;break;case _f:if([gd,"SCHECULE.TIME.RESUME"].includes(n.lastType)){let u=pb(r.itemValue).getTime()-pb(n.lastValue).getTime();a=n.milliseconds+u}else a=n.milliseconds;break;default:a=n.milliseconds;break}return{milliseconds:a,lastType:o,lastValue:r.itemValue}},{milliseconds:0,lastType:void 0,lastValue:void 0});if([gd,Sh].includes(i.lastType)){let n=new Date().getTime()-pb(i.lastValue).getTime();i.milliseconds+=n}return{milliseconds:i.milliseconds,time:kAe(i.milliseconds),relevantTimeItems:e}}function kAe(t){let e=(i,n=2)=>("00"+i).slice(-n);return e(t/36e5|0)+":"+e(t%36e5/6e4|0)+":"+e(t%6e4/1e3|0)}function xAe({matchUp:t}){var n;let e=(t==null?void 0:t.timeItems)||[],i=r=>r.createdAt?new Date(r.createdAt).getTime():0;return{startTime:(n=e.reduce((r,a)=>{let s=a.itemType===gd&&a;return s&&(!r||i(s)<i(r))?s:r},void 0))==null?void 0:n.itemValue}}function rC(t){let{disableNotice:e,venue:i,context:n}=t;if(typeof i!="object")return{error:Re};let r=Jc(t);i.venueId||(i.venueId=yn());let a;for(let s of Object.values(r)){let o=OAe({disableNotice:!0,tournamentRecord:s,context:n,venue:i});if(o!=null&&o.error)return o;a=o.venue}return e||Si({topic:Rq,payload:{venue:i}}),Kt({...de,venue:a})}function OAe({tournamentRecord:t,disableNotice:e,context:i,venue:n}){return t?n?(t.venues||(t.venues=[]),n.venueId||(n.venueId=yn()),t.venues.reduce((r,a)=>r||a.venueId===n.venueId,void 0)?{error:fae}:(i&&dn({element:n,extension:{value:i,name:Qse}}),t.venues.push(n),e||Si({payload:{venue:n,tournamentId:t.tournamentId},topic:Rq}),{...de,venue:_t(n)})):{error:ai,info:"missing venue"}:{error:ut}}function Xh({tournamentRecords:t,tournamentRecord:e,venueId:i}){if(!e)return{error:ut};if(!i)return{error:Og};let n=(e.venues??[]).reduce((r,a)=>a.venueId===i?a:r,void 0);if(!n&&t){let r=(HP({tournamentRecords:t}).linkedTournamentIds??[])[e.tournamentId];for(let a of r){let s=t[a],o=Xh({tournamentRecord:s,venueId:i});if(o.success&&o.venue)return rC({tournamentRecord:e,venue:o.venue}),{...de,venue:n}}}return n?{...de,venue:n}:{error:HI}}function e3({convertExtensions:t,...e}){let{tournamentRecords:i,tournamentRecord:n,venueId:r}=e,a=Xh({tournamentRecords:i,tournamentRecord:n,venueId:r});return _t(a,t,!0)}function nw({tournamentRecords:t,tournamentRecord:e,courtId:i}){if(!e)return{error:ut};if(!i)return{error:VI};let n="findCourt",r,a;if((e.venues??[]).forEach(s=>{(s.courts??[]).forEach(o=>{o.courtId===i&&(r=o,a=s)})}),r)return{...de,court:r,venue:a};if(t){let s=(HP({tournamentRecords:t}).linkedTournamentIds??[])[e.tournamentId];for(let o of s){let l=t[o],c=nw({tournamentRecord:l,courtId:i});if(c.success)return c.venue&&rC({tournamentRecord:e,venue:c.venue}),{...de,court:r,venue:a}}}return he({result:{error:QT},stack:n})}function t3(t){return _t(nw(t),!1,!0)}function Yx({tournamentRecord:t,internalUse:e,courtId:i}){if(!t)return{error:ut};if(!i)return{error:VI};let n=nw({tournamentRecord:t,courtId:i});if(n.error)return n;let r=n.court&&(({altitude:a,courtId:s,courtName:o,courtDimensions:l,latitude:c,longitude:u,surfaceCategory:d,surfaceType:p,surfacedDate:h,pace:f,notes:m})=>({altitude:a,courtId:s,courtName:o,courtDimensions:l,latitude:c,longitude:u,surfaceCategory:d,surfaceType:p,surfacedDate:h,pace:f,notes:m}))(n.court);return{...de,courtInfo:_t(r,!1,e)}}function GS(t){var l;let e=Qt(t,[{[ba]:!0},{venueId:!0,[Au]:Og}]);if(e.error)return e;let{tournamentRecord:i,venueId:n}=t,r=Xh({tournamentRecord:i,venueId:n});if(r.error)return r;let a=(((l=r.venue)==null?void 0:l.courts)??[]).map(c=>(({courtInfo:u})=>({...u}))(Yx({courtId:c.courtId,internalUse:!0,tournamentRecord:i}))),s=r.venue&&(({venueId:c,venueName:u,venueAbbreviation:d})=>({venueAbbreviation:d,venueName:u,venueId:c}))(r.venue),o=s&&{...s,courtsInfo:a};return{...de,venueData:_t(o,!1,!0)}}function LAe({matchUp:t}){var n;let e=(t==null?void 0:t.timeItems)||[],i=r=>r.createdAt?new Date(r.createdAt).getTime():0;return{endTime:(n=e.reduce((r,a)=>{let s=a.itemType===Yf&&a;return s&&(!r||i(s)>i(r))?s:r},void 0))==null?void 0:n.itemValue}}function _r({event:t,eventId:e}){var r,a;if(!t)return{error:Jn};let i=(r=ki({name:qu,element:t}))==null?void 0:r.extension,n=e?_t(i==null?void 0:i.value,!1,!0):i==null?void 0:i.value;return e&&((a=t.drawDefinitions)==null||a.forEach(s=>{var o;(o=n==null?void 0:n.flights)==null||o.forEach(l=>{l.drawId===s.drawId&&Object.assign(l,{drawDefinition:s})})})),{flightProfile:n}}function jo(t){let{tournamentRecord:e,eventId:i,drawId:n}=t,r="findEvent",a={},s=t.tournamentRecords??(e&&{[e.tournamentId]:e})??{},o=Object.values(s).map(({events:c,tournamentId:u})=>(c&&c.forEach(d=>{a[d.eventId]={tournamentId:u}}),c??[])).flat(),l;if(n){let c,u=o.find(d=>{var h,f,m;let p=((d==null?void 0:d.drawDefinitions)??[]).find(g=>g.drawId===n);if(p)c=p,l=a[d.eventId].tournamentId;else{let g=(m=(f=d&&((h=_r({event:d}))==null?void 0:h.flightProfile))==null?void 0:f.flights)==null?void 0:m.find(v=>v.drawId===n);if(g)return l=a[d.eventId].tournamentId,{entries:g.drawEntries,drawName:g.drawName,tournamentId:l,drawId:n}}return p});if(u)return{event:u,drawDefinition:c,tournamentId:l}}if(i){let c=o.find(u=>(u==null?void 0:u.eventId)===i);if(c)l=a[c.eventId].tournamentId;else return{event:void 0,drawDefinition:void 0,...he({result:{error:Gc},stack:r})};return{event:c,drawDefinition:void 0,tournamentId:l}}return{event:void 0,drawDefinition:void 0,...he({result:{error:tc},context:{drawId:n,eventId:i},stack:r})}}function Kx(t){var T,w,S,U,P,E,R,C,M,_;let e=t.event,i=t.matchUpType,{scheduleVisibilityFilters:n,afterRecoveryTimes:r,tournamentRecord:a,usePublishState:s,scheduleTiming:o,matchUpFormat:l,publishStatus:c,matchUp:u}=t;if(!u)return{error:rl};if(r&&!u.matchUpType&&!t.matchUpType&&(e||a)&&u.drawId){let A=t.drawDefinition||((T=e==null?void 0:e.drawDefinitions)==null?void 0:T.find(k=>k.drawId===u.drawId));!A&&a&&({drawDefinition:A,event:e}=jo({drawId:u.drawId,tournamentRecord:a}));let N=u.structureId&&((w=A==null?void 0:A.structures)==null?void 0:w.find(({structureId:k})=>k===u.structureId));i=t.matchUpType||(N==null?void 0:N.matchUpType)||(A==null?void 0:A.matchUpType)||(e==null?void 0:e.eventType)!==na&&(e==null?void 0:e.eventType)}let{milliseconds:d,time:p}=_Ae({matchUp:u}),{startTime:h}=xAe({matchUp:u}),{endTime:f}=LAe({matchUp:u}),m,{eventIds:g,drawIds:v}=n??{};if((!g||g.includes(u.eventId))&&(!v||v.includes(u.drawId))){let A=we=>we.createdAt?new Date(we.createdAt).getTime():0,N=new Map,k=((S=u.timeItems)==null?void 0:S.toSorted((we,ze)=>A(we)-A(ze)))??[];for(let we of k)N.set(we.itemType,we.itemValue);let O=N.get(Xq),$=N.get($h),F=N.get(ew),V=N.get(zx),j=N.get(QI),B=N.get(Jq),z=N.get(Hx),W=N.get(JI),Z=N.get(hg),K,Q,J,se,ie,ce=u.matchUpType??i;if(o&&F&&r&&ce){let we={matchUpFormat:u.matchUpFormat??l,...o};({averageMinutes:Q=0,recoveryMinutes:J=0,typeChangeRecoveryMinutes:se=0}=Wx({timingDetails:we,eventType:ce})),(Q||J)&&(K=f?il(rr(f),J):il(F,Q+J)),se&&(ie=f?il(rr(f),se):il(F,Q+se))}!j&&F&&(j=Ri(F));let oe=OA({scheduledDate:j,scheduledTime:F}),te={},le=((U=a&&W&&GS({tournamentRecord:a,venueId:W}))==null?void 0:U.venueData)||{};W&&(te[W]=le);let{venueName:ne,venueAbbreviation:me,courtsInfo:be}=le,Se=(P=Z&&(be==null?void 0:be.find(we=>we.courtId===Z)))==null?void 0:P.courtName;for(let we of $||[]){if(!a)break;we.venueId&&!te[we.venueid]&&(te[we.venueId]=(E=GS({venueId:we.venueId,tournamentRecord:a}))==null?void 0:E.venueData);let ze=te[we.venueId];we.venueName=ze==null?void 0:ze.venueName;let Qe=(R=ze==null?void 0:ze.courtsInfo)==null?void 0:R.find(ke=>ke.courtId===we.courtId);we.courtName=Qe==null?void 0:Qe.courtName}m=Kt({typeChangeTimeAfterRecovery:ie,timeAfterRecovery:K,scheduledDate:j,scheduledTime:F,isoDateString:oe,homeParticipantId:O,venueAbbreviation:me,allocatedCourts:$,timeModifiers:V,venueName:ne,venueId:W,courtOrder:z,courtName:Se,courtId:Z,official:B,typeChangeRecoveryMinutes:se,recoveryMinutes:J,averageMinutes:Q,milliseconds:d,startTime:h,endTime:f,time:p})}else m=Kt({milliseconds:d,startTime:h,endTime:f,time:p});let{scheduledDate:y}=iw({matchUp:u}),{scheduledTime:b}=Hoe({matchUp:u});if(s&&((C=c==null?void 0:c.displaySettings)!=null&&C.draws)){let A=c.displaySettings.draws,N=(M=(A==null?void 0:A[u.drawId])??(A==null?void 0:A.default))==null?void 0:M.scheduleDetails;if(N){let k=(_=N.find(O=>{var $;return y&&(($=O.dates)==null?void 0:$.includes(y))})??N.find(O=>{var $;return!(($=O.dates)!=null&&$.length)}))==null?void 0:_.attributes;if(k){let O=Object.assign({},...Object.keys(m).map($=>({[$]:!0})),k);m=cI({source:m,template:O})}}}let I=u.matchUpStatus&&ca.includes(u.matchUpStatus)&&(Ri(f)||Ri(y)||Ri(b))||void 0;return{schedule:m,endDate:I}}function FAe({drawPositions:t,roundProfile:e,roundNumber:i}){var o;let n=[void 0,void 0];if(yre(t))return{orderedDrawPositions:n,displayOrder:n};let r=e==null?void 0:e[i],a=((o=r==null?void 0:r.pairedDrawPositions)==null?void 0:o.find(l=>ho(l||[],t.filter(Boolean))))??n,s=r==null?void 0:r.feedRound;if(vre(t)){let l=[...t].sort(ia);return{orderedDrawPositions:l.length===2?l:a,displayOrder:s?l:a}}if(s){let l=[t.find(c=>!isNaN(ui(c))),void 0];return{orderedDrawPositions:l,displayOrder:l}}return{orderedDrawPositions:a,displayOrder:a}}function WA({collectionPosition:t,collectionId:e,lineUp:i}){let n=[],r=[];if(i){let a=o=>o===void 0?-1:o,s=i.map(o=>{let{collectionAssignments:l,participantId:c}=o,u=l==null?void 0:l.find(d=>d.collectionPosition===t&&d.collectionId===e);return u&&{participantId:c,...u}}).filter(Boolean).sort((o,l)=>a(o.substitutionOrder)-a(l.substitutionOrder));for(let o of s){let{participantId:l,previousParticipantId:c,substitutionOrder:u}=o;n.includes(l)||(c&&r.push({previousParticipantId:c,substitutionOrder:u,participantId:l}),n=n.filter(d=>d!==c),n.push(l))}}return{assignedParticipantIds:n,substitutions:r}}function Yu({tournamentParticipants:t,tournamentRecord:e,participantIds:i}){let n="getPairedParticipant";if(!t&&!e)return{error:ut};if(!Array.isArray(i)||i.length>2)return{error:Dl};if(!i.length)return he({result:{error:xg},stack:n});t=t??(e==null?void 0:e.participants)??[];let r=t.filter(o=>o.participantType===Ni&&Nr(i,o.individualParticipantIds).length===i.length&&o.individualParticipantIds.length===i.length),a=r[0];if(!a)return he({result:{error:xr},stack:n});let s=_t(r.slice(1),!1,!0);return{participant:_t(a),duplicatedPairParticipants:s,...de}}function ry({drawDefinition:t,participantId:e}){if(typeof t!="object")return{error:Gt};if(typeof e!="string")return{error:la};let{extension:i}=ki({element:t,name:zf});return{lineUp:((i==null?void 0:i.value)||{})[e]}}function $Ae({tournamentParticipants:t,positionAssignments:e,collectionPosition:i,drawPositions:n=[],participantMap:r,drawDefinition:a,collectionId:s,sideLineUps:o,matchUpType:l}){if(!s||!i)return{};let c=({attribute:d,lineUp:p,teamParticipant:h})=>{var g,v,y,b;let{assignedParticipantIds:f,substitutions:m}=WA({collectionPosition:i,collectionId:s,lineUp:p});if(l===Mn){if((f==null?void 0:f.length)<=2){let I=(v=(g=r==null?void 0:r[f[0]])==null?void 0:g.pairIdMap)==null?void 0:v[f[1]],T=(b=I&&((y=r[I])==null?void 0:y.participant)||Yu({participantIds:f,tournamentParticipants:t}).participant)==null?void 0:b.participantId;return{[d]:{participantId:T,teamParticipant:h,substitutions:m}}}else if((f==null?void 0:f.length)>2)return{[d]:{teamParticipant:h,substitutions:m}}}else{let I=f==null?void 0:f[0];return I&&{[d]:{participantId:I,teamParticipant:h,substitutions:m}}}};if(!(n!=null&&n.length)){let d=(o==null?void 0:o.map(p=>{var g;let{teamParticipant:h,sideNumber:f}=p,m=p.lineUp||((g=ry({participantId:h.teamParticipantId,drawDefinition:a}))==null?void 0:g.lineUp);return c({attribute:f,lineUp:m,teamParticipant:h})}).filter(Boolean))||{};return{sideNumberCollectionAssignment:Object.assign({},...d)}}let u=(n==null?void 0:n.map(d=>{var g,v,y;let p=(g=e.find(b=>b.drawPosition===d))==null?void 0:g.participantId,h=o==null?void 0:o.find(b=>(b==null?void 0:b.drawPosition)===d),f=(h==null?void 0:h.teamParticipant)||p&&((v=r==null?void 0:r[p])==null?void 0:v.participant)||(t==null?void 0:t.find(({participantId:b})=>b===p)),m=(h==null?void 0:h.lineUp)||((y=ry({participantId:p,drawDefinition:a}))==null?void 0:y.lineUp);return c({attribute:d,lineUp:m,teamParticipant:f})}).filter(Boolean))||{};return{drawPositionCollectionAssignment:Object.assign({},...u)}}function Zx(t){var r,a,s;let e=Qt(t,[{[Zh]:!0}]);if(e.error)return e;let i=t==null?void 0:t.matchUp,n=i==null?void 0:i.matchUpType;if(!n&&((r=i==null?void 0:i.sides)!=null&&r.length)){let o=(s=(a=i.sides.find(({participant:l})=>l))==null?void 0:a.participant)==null?void 0:s.participantType;n=o===ji&&xn||o===Ni&&Mn||o===En&&En||void 0}return{matchUpType:n}}function BAe({drawPositionCollectionAssignment:t,sideNumberCollectionAssignment:e,positionAssignments:i,displaySideNumber:n,seedAssignments:r,drawPosition:a,isFeedRound:s,sideNumber:o}){var h,f,m,g;let l=i.find(v=>v.drawPosition&&v.drawPosition===a),c=a&&t,u=o&&e,d=c?(h=c[a])==null?void 0:h.participantId:l==null?void 0:l.participantId,p=l?VAe({displaySideNumber:n,seedAssignments:r,participantId:d,assignment:l,sideNumber:o}):{...u==null?void 0:u[o]};if(s&&(o===1?Object.assign(p,{participantFed:!0}):Object.assign(p,{participantAdvanced:!0})),a&&c){let v=(f=c[a])==null?void 0:f.teamParticipant,y=(m=c[a])==null?void 0:m.participant,b=(g=c[a])==null?void 0:g.substitutions;y&&(p.participant=y),b&&(p.substitutions=b),v&&(p.teamParticipant=v)}return p}function VAe({displaySideNumber:t,seedAssignments:e,participantId:i,assignment:n,sideNumber:r}){let a={drawPosition:n.drawPosition,displaySideNumber:t,sideNumber:r};if(i){let s=jAe({seedAssignments:e,participantId:i});Object.assign(a,s,{participantId:i}),s!=null&&s.seedNumber&&(s==null?void 0:s.seedValue)===""&&(a.seedValue="~")}else n.bye&&Object.assign(a,{bye:!0});return n.qualifier&&Object.assign(a,{qualifier:!0}),a}function jAe({seedAssignments:t,participantId:e}){return t==null?void 0:t.find(i=>!i.seedProxy&&i.participantId===e)}function zoe({scheduleVisibilityFilters:t,sourceDrawPositionRanges:e,tournamentParticipants:i,positionAssignments:n,drawPositionsRanges:r,hydrateParticipants:a,afterRecoveryTimes:s,initialRoundOfPlay:o,additionalContext:l,roundNamingProfile:c,tournamentRecord:u,tieDrawPositions:d,appliedPolicies:p,isCollectionBye:h,seedAssignments:f,usePublishState:m,participantMap:g,contextContent:v,scheduleTiming:y,contextProfile:b,drawDefinition:I,publishStatus:T,scoringActive:w,matchUpTieId:S,isRoundRobin:U,roundProfile:P,sideLineUps:E,structure:R,context:C,matchUp:M,event:_}){var Vt,Me,De,Je,St,bt,Ie,Ue,Oe,Ee,Xe,Et,Fe,ht,ti;l=l??{};let A=(Vt=qs({drawDefinition:I,structure:R,matchUp:M,event:_}))==null?void 0:Vt.tieFormat,{roundOffset:N,structureId:k,structureName:O,stage:$,stageSequence:F}=R,{drawId:V,drawName:j,drawType:B}=I??{},z=A==null?void 0:A.collectionDefinitions,W=M.collectionId&&(z==null?void 0:z.find(Ke=>Ke.collectionId===M.collectionId)),Z=M.collectionId?W==null?void 0:W.matchUpFormat:M.matchUpFormat??(R==null?void 0:R.matchUpFormat)??(I==null?void 0:I.matchUpFormat)??(_==null?void 0:_.matchUpFormat),K=M.matchUpType||(W==null?void 0:W.matchUpType)||(R==null?void 0:R.matchUpType)||(I==null?void 0:I.matchUpType)||!Fr(na)(_==null?void 0:_.eventType)&&(_==null?void 0:_.eventType),Q=h?mn:M.matchUpStatus,{schedule:J,endDate:se}=Kx({scheduleVisibilityFilters:t,afterRecoveryTimes:s,tournamentRecord:u,usePublishState:m,scheduleTiming:y,drawDefinition:I,matchUpFormat:Z,publishStatus:T,matchUpType:K,matchUp:M,event:_}),ie=d??M.drawPositions??[],{collectionPosition:ce,collectionId:oe,roundPosition:te}=M,le=M.roundNumber??l.roundNumber,ne=oe?$Ae({tournamentParticipants:i,positionAssignments:n,collectionPosition:ce,participantMap:g,drawDefinition:I,drawPositions:ie,collectionId:oe,sideLineUps:E,matchUpType:K}):void 0,me=((Me=c==null?void 0:c[le])==null?void 0:Me.roundName)||l.roundName,be=((De=c==null?void 0:c[le])==null?void 0:De.abbreviatedRoundName)||l.abbreviatedRoundName,Se=(Je=P==null?void 0:P[le])==null?void 0:Je.feedRound,we=(St=P==null?void 0:P[le])==null?void 0:St.preFeedRound,ze=(bt=P==null?void 0:P[le])==null?void 0:bt.roundFactor,Qe=r==null?void 0:r[le],ke=te?Qe==null?void 0:Qe[te]:void 0,yt=e==null?void 0:e[le],lt=W!=null&&W.category?{...(C==null?void 0:C.category)||{},...W.category}:(C==null?void 0:C.category)??(_==null?void 0:_.category),Ct=((Ie=M.processCodes)==null?void 0:Ie.length)&&M.processCodes||((Ue=W==null?void 0:W.processCodes)==null?void 0:Ue.length)&&(W==null?void 0:W.processCodes)||((Oe=R==null?void 0:R.processCodes)==null?void 0:Oe.length)&&(R==null?void 0:R.processCodes)||((Ee=I==null?void 0:I.processCodes)==null?void 0:Ee.length)&&(I==null?void 0:I.processCodes)||((Xe=_==null?void 0:_.processCodes)==null?void 0:Xe.length)&&(_==null?void 0:_.processCodes)||(u==null?void 0:u.processCodes),Nt=(b==null?void 0:b.withCompetitiveness)&&iC({...v,matchUp:M}),Ce=M.finishingPositionRange??l.finishingPositionRange,Ge=Ke=>Kt(Ke,void 0,!0),$e={...Ge(C),...Ge({matchUpFormat:M.matchUpType===na?void 0:Z,tieFormat:M.matchUpType!==na?void 0:A,gender:(W==null?void 0:W.gender)??(_==null?void 0:_.gender),roundOfPlay:$!==ni&&Ii(o)&&o+(le||0),endDate:M.endDate??se,discipline:_==null?void 0:_.discipline,category:lt,finishingPositionRange:Ce,abbreviatedRoundName:be,drawPositionsRange:ke,competitiveProfile:Nt,structureName:O,stageSequence:F,drawPositions:ie,matchUpStatus:Q,processCodes:Ct,isRoundRobin:U,matchUpTieId:S,preFeedRound:we,matchUpType:K,roundFactor:ze,roundOffset:N,structureId:k,roundNumber:le,feedRound:Se,roundName:me,drawName:j,drawType:B,schedule:J,drawId:V,stage:$}),..._t(Ge(M),!0,!0)};if(Z&&((Et=M.score)!=null&&Et.scoreStringSide1)){let Ke=wo(Z),{bestOf:zt,finalSetFormat:mt,setFormat:Tt}=Ke??{};(mt!=null&&mt.tiebreakSet||Tt!=null&&Tt.tiebreakSet||Tt!=null&&Tt.timed)&&($e.score.sets=$e.score.sets.sort((Ut,zi)=>Ut.setNumber-zi.setNumber).map((Ut,zi)=>(zi+1===zt?(mt!=null&&mt.tiebreakSet||mt!=null&&mt.timed)&&(Ut.tiebreakSet=!0):(Tt!=null&&Tt.tiebreakSet||Tt!=null&&Tt.timed)&&(Ut.tiebreakSet=!0),Ut)))}if(Array.isArray(ie)){let{orderedDrawPositions:Ke,displayOrder:zt}=FAe({drawPositions:ie,roundProfile:P,roundNumber:le}),mt=(Fe=P==null?void 0:P[le])==null?void 0:Fe.feedRound,Tt=zt[0]!==Ke[0],Ut=Ke.concat(void 0,void 0).slice(0,2).map((zi,gi)=>{var Xa;let Dt=gi+1,Ui=Tt?3-Dt:Dt,Cr=BAe({...ne,positionAssignments:n,displaySideNumber:Ui,seedAssignments:f,drawPosition:zi,isFeedRound:mt,sideNumber:Dt}),nn=(Xa=M.sides)==null?void 0:Xa.find(Gr=>Gr.sideNumber===Dt),tr=te?(te-1)*2+gi+1:void 0,lr=tr?yt==null?void 0:yt[tr]:void 0;return Ge({sourceDrawPositionRange:lr,...nn,...Cr})});Object.assign($e,_t({sides:Ut},!0,!0))}if(i&&$e.sides){let Ke=p==null?void 0:p[sU],zt=mt=>{var Ut;let Tt=(Ut=g==null?void 0:g[mt])==null?void 0:Ut.participant;return Tt&&cI({template:Ke==null?void 0:Ke.participant,source:Tt})};if($e.sides.filter(Boolean).forEach(mt=>{var Tt,Ut,zi,gi;if(mt.participantId){let Dt=_t(zt(mt.participantId)||(i?lg({policyDefinitions:p,participantId:mt.participantId,tournamentParticipants:i,internalUse:!0,contextProfile:b}):void 0),void 0,!0);if(Dt){let Ui,Cr;if(I!=null&&I.entries){let nn=I.entries.find(lr=>lr.participantId===mt.participantId),tr=(Tt=_==null?void 0:_.entries)==null?void 0:Tt.find(lr=>lr.participantId===mt.participantId);Ui=(nn==null?void 0:nn.entryStatus)||(tr==null?void 0:tr.entryStatus),Dt.entryStatus=Ui,nn!=null&&nn.entryStage&&(Cr=nn.entryStage,Dt.entryStage=Cr)}a!==!1?Object.assign(mt,{participant:Dt}):Object.assign(mt,{participant:{entryStage:Cr,entryStatus:Ui}})}}if((zi=(Ut=mt==null?void 0:mt.participant)==null?void 0:Ut.individualParticipantIds)!=null&&zi.length&&!((gi=mt.participant.individualParticipants)!=null&&gi.length)){let Dt=mt.participant.individualParticipantIds.map(Ui=>zt(Ui)||(i?lg({policyDefinitions:p,tournamentParticipants:i,internalUse:!0,contextProfile:b,participantId:Ui}):void 0));a!==!1&&Object.assign(mt.participant,{individualParticipants:Dt})}}),!$e.matchUpType){let{matchUpType:mt}=Zx({matchUp:$e});mt&&Object.assign($e,{matchUpType:mt})}if(b!=null&&b.inferGender&&(!$e.gender||$e.gender===Oo)&&((ht=$e.sides)==null?void 0:ht.length)===2&&$e.matchUpType!==na){let mt=$e.sides.map(Tt=>{var Ut,zi,gi,Dt;if(Fr(xn)($e.matchUpType))return(zi=(Ut=Tt.participant)==null?void 0:Ut.person)==null?void 0:zi.sex;if(((Dt=(gi=Tt.participant)==null?void 0:gi.individualParticipants)==null?void 0:Dt.length)===2){let Ui=Ei(Tt.participant.individualParticipants.map(Cr=>{var nn;return(nn=Cr.person)==null?void 0:nn.sex})).filter(Boolean);if(Ui.length===1)return Ui[0]}});if(mt.filter(Boolean).length===2&&Ei(mt).length===1){let Tt=mt[0];$e.inferredGender=Tt}}}if($e.tieMatchUps){let Ke=$e.matchUpStatus===mn,zt=(ti=$e.sides)==null?void 0:ti.map(({participant:mt,drawPosition:Tt,sideNumber:Ut,lineUp:zi})=>{let gi=(mt==null?void 0:mt.participantType)===na&&mt;return{teamParticipant:gi&&Kt({participantRoleResponsibilities:gi.participantRoleResponsibilities,participantOtherName:gi.participanOthertName,participantName:gi.participantName,participantId:gi.participantId,teamId:gi.teamId}),drawPosition:Tt,sideNumber:Ut,lineUp:zi}});$e.tieMatchUps=$e.tieMatchUps.map(mt=>{let Tt=$e.matchUpId,Ut={finishingPositionRange:$e.finishingPositionRange,abbreviatedRoundName:be,roundNumber:le,roundName:me};return zoe({tieDrawPositions:ie,scheduleVisibilityFilters:t,sourceDrawPositionRanges:e,sideLineUps:zt,drawPositionsRanges:r,initialRoundOfPlay:o,roundNamingProfile:c,additionalContext:Ut,appliedPolicies:p,isCollectionBye:Ke,usePublishState:m,publishStatus:T,matchUpTieId:Tt,isRoundRobin:U,roundProfile:P,matchUp:mt,event:_,tournamentParticipants:i,positionAssignments:n,tournamentRecord:u,seedAssignments:f,participantMap:g,contextContent:v,scheduleTiming:y,contextProfile:b,drawDefinition:I,scoringActive:w,structure:R,context:C})})}let at=$e.sides&&$e.sides.filter(Ke=>Ke==null?void 0:Ke.participantId).length===2,ct=!$e.winningSide;if(Object.assign($e,{readyToScore:w&&at&&ct,hasContext:!0}),at){let{allParticipantsCheckedIn:Ke,checkedInParticipantIds:zt}=tw({matchUp:$e});Object.assign($e,{allParticipantsCheckedIn:Ke,checkedInParticipantIds:zt})}return Array.isArray(b==null?void 0:b.exclude)&&(b==null||b.exclude.forEach(Ke=>delete $e[Ke])),$e}function GAe({timeStamp:t,schedule:e,matchUp:i}){let{itemValue:n,timeStamp:r}=Vy({timeItems:(i==null?void 0:i.timeItems)||[],itemType:$h});return!e||r&&t&&new Date(r).getTime()>new Date(t).getTime()?{allocatedCourts:_t(n,!1,!0)}:e}function HAe({timeStamp:t,schedule:e,matchUp:i}){let{itemValue:n,timeStamp:r}=Vy({timeItems:(i==null?void 0:i.timeItems)||[],itemType:hg});return!e||r&&t&&new Date(r).getTime()>new Date(t).getTime()?{courtId:n}:e}function zAe({timeStamp:t,schedule:e,matchUp:i}){let{itemValue:n,timeStamp:r}=Vy({timeItems:(i==null?void 0:i.timeItems)||[],itemType:JI});return!e||r&&t&&new Date(r).getTime()>new Date(t).getTime()?{venueId:n}:e}function Df(t){if(!Array.isArray(t.matchUps))return[];let{matchUps:e,excludeMatchUpStatuses:i,hasParticipantsCount:n,isCollectionMatchUp:r,matchUpStatuses:a,hasWinningSide:s,matchUpFormats:o,roundPositions:l,matchUpFormat:c,collectionIds:u,isMatchUpTie:d,roundNumbers:p,matchUpIds:h,roundNames:f,filterMatchUpTypes:m=!0,filterMatchUpIds:g=!0,stageSequences:v,scheduledDates:y,scheduledDate:b,participantIds:I,processContext:T,tournamentIds:w,matchUpTypes:S,structureIds:U,readyToScore:P,courtIds:E,eventIds:R,venueIds:C,drawIds:M,stages:_}=t,A=Array.isArray(I)?I.filter(Boolean):[],N=Array.isArray(a)?a.filter(Boolean):[],k=Array.isArray(i)?i.filter(Boolean):[],O=Array.isArray(_)?_.filter(Boolean):[],$=Array.isArray(v)?v.filter(Boolean):[],F=Array.isArray(u)?u.filter(Boolean):[],V=Array.isArray(f)?f.filter(Boolean):[],j=Array.isArray(p)?p.filter(Boolean):[],B=Array.isArray(l)?l.filter(Boolean):[],z=Array.isArray(h)&&g?h.filter(Boolean):[],W=Array.isArray(S)&&m?S.filter(Boolean):[],Z=Array.isArray(E)?E.filter(Boolean):[],K=Array.isArray(C)?C.filter(Boolean):[],Q=Array.isArray(o)&&o.filter(Boolean)||typeof c=="string"&&[c]||[],J=Array.isArray(y)&&y.filter(Boolean)||typeof b=="string"&&b.length&&[b]||[],se=Array.isArray(w)?w.filter(Boolean):[],ie=Array.isArray(R)?R.filter(Boolean):[],ce=Array.isArray(M)?M.filter(Boolean):[],oe=Array.isArray(U)?U.filter(Boolean):[];return e.filter(te=>{var le;if(P&&!Fr(ec)(te)&&!te.readyToScore||te.winningSide&&s&&![1,2].includes(te.winningSide)||d!==void 0&&(d&&!te.tieMatchUps||!d&&te.tieMatchUps)||r!==void 0&&(r&&!te.collectionId||!r&&te.collectionId)||O.length&&!O.includes(te.stage)||$.length&&!$.includes(te.stageSequence)||F.length&&(!te.collectionId||!F.includes(te.collectionId))||V.length&&(!te.roundName||!V.includes(te.roundName))||j.length&&(!te.roundNumber||!j.includes(te.roundNumber))||B.length&&(!te.roundPosition||!B.includes(te.roundPosition))||N.length&&(!te.matchUpStatus||!N.includes(te.matchUpStatus))||k.length&&te.matchUpStatus&&k.includes(te.matchUpStatus)||z.length&&!z.includes(te.matchUpId)||W.length&&(!te.matchUpType||!Qk(W,te.matchUpType))||Q.length&&(!te.matchUpFormat||!Q.includes(te.matchUpFormat)))return!1;if(J!=null&&J.length){let{scheduledTime:ne}=Hoe({matchUp:te}),{scheduledDate:me}=iw({matchUp:te}),be=Ri(ne)||me;if(!J.find(Se=>kh(Se,be)))return!1}if(Z.length){let{courtId:ne}=HAe({matchUp:te}),{allocatedCourts:me}=GAe({matchUp:te}),be=me==null?void 0:me.map(({courtId:Se})=>Se);if(!Z.filter(Boolean).includes(ne)||be!=null&&be.includes(ne))return!1}if(K.length){let{venueId:ne}=zAe({matchUp:te});if(!K.filter(Boolean).includes(ne))return!1}if(T){if(se.length&&!se.includes(te.tournamentId)||ie.length&&!ie.includes(te.eventId)||ce.length&&!ce.includes(te.drawId)||oe.length&&!oe.includes(te.structureId))return!1;let ne=((le=te.sides)==null?void 0:le.map(({participantId:me})=>me).filter(Boolean))??[];if(n&&ne.length<n||A.length&&!A.some(me=>ne.includes(me)))return!1}return!0})}function wn(t){var Z,K,Q,J,se,ie,ce;let{provisionalPositioning:e,tournamentRecord:i,contextFilters:n,matchUpFilters:r,contextProfile:a,drawDefinition:s,context:o={},structure:l,inContext:c,event:u}=t,{seedAssignments:d,contextContent:p,exitProfiles:h,matchUpsMap:f}=t,m={},g={};if(!l)return{collectionPositionMatchUps:m,error:Ny,roundMatchUps:g,matchUps:[]};let v=Array.isArray(r==null?void 0:r.eventIds)?r==null?void 0:r.eventIds.filter(Boolean):[],y=Array.isArray(r==null?void 0:r.structureIds)?r==null?void 0:r.structureIds.filter(Boolean):[],b=Array.isArray(r==null?void 0:r.drawIds)?r==null?void 0:r.drawIds.filter(Boolean):[],I=!(o!=null&&o.eventId)||!(v!=null&&v.length)&&!((Z=n==null?void 0:n.eventIds)!=null&&Z.filter(Boolean).length)||(v==null?void 0:v.includes(o.eventId))||((K=n==null?void 0:n.eventIds)==null?void 0:K.includes(o.eventId)),T=!(y!=null&&y.length)||y.includes(l.structureId),w=!s||!(b!=null&&b.length)||b.includes(s.drawId);if(!I||!T||!w)return{collectionPositionMatchUps:m,roundMatchUps:g,matchUps:[]};a&&!p&&(p=Sm({tournamentRecord:i,contextProfile:a,drawDefinition:s}));let{appliedPolicies:S}=hn({drawDefinition:s}),U={...t.tournamentAppliedPolicies,...S,...t.policyDefinitions},P=(Q=U==null?void 0:U.scoring)==null?void 0:Q.structures,E=l.stage&&((J=P==null?void 0:P.stage)==null?void 0:J[l.stage]),R=l.stageSequence&&((se=E==null?void 0:E.stageSequence)==null?void 0:se[l.stageSequence]),C=((ie=U==null?void 0:U.scoring)==null?void 0:ie.requireAllPositionsAssigned)||(E==null?void 0:E.requireAllPositionsAssigned)||(R==null?void 0:R.requireAllPositionsAssigned);f||(f=Ts({drawDefinition:s,structure:l}));let{positionAssignments:M,allPositionsAssigned:_}=Ma({structure:l}),A=!C||_,{seedAssignments:N}=qc({provisionalPositioning:e,drawDefinition:s,structure:l});d=d??N;let{structureId:k}=l;h=h||s&&Eoe({drawDefinition:s}).exitProfiles;let O=h==null?void 0:h[k],$=(O==null?void 0:O.length)&&(O[0].split("-").map(oe=>parseInt(oe)).reduce((oe,te)=>oe+te)||0),F=!!l.structures,V=ny({matchUpsMap:f,structureId:k,inContext:c}),j=U==null?void 0:U[$S],B=vAe({roundNamingPolicy:j,drawDefinition:s,structure:l,matchUps:V}),{roundNamingProfile:z,roundProfile:W}=B;if(g=(B==null?void 0:B.roundMatchUps)??[],r&&(V=Df({matchUps:V,...r,filterMatchUpTypes:!1,filterMatchUpIds:!1})),c){let{sourceDrawPositionRanges:oe}=fAe({drawDefinition:s,matchUpsMap:f,structureId:k}),te=s?mAe({drawDefinition:s,roundProfile:W,matchUpsMap:f,structureId:k}).drawPositionsRanges:void 0,le=t.tournamentParticipants,ne=t.participantMap;!(le!=null&&le.length)&&!ne&&i&&({participants:le=[],participantMap:ne}=Ly({participantsProfile:t.participantsProfile,useParticipantMap:t.useParticipantMap,policyDefinitions:t.policyDefinitions,tournamentRecord:i,contextProfile:a,inContext:c})),V=V.map(me=>zoe({scheduleVisibilityFilters:t.scheduleVisibilityFilters,hydrateParticipants:t.hydrateParticipants,afterRecoveryTimes:t.afterRecoveryTimes,usePublishState:t.usePublishState,scheduleTiming:t.scheduleTiming,publishStatus:t.publishStatus,sourceDrawPositionRanges:oe,tournamentParticipants:le,positionAssignments:M,drawPositionsRanges:te,initialRoundOfPlay:$,roundNamingProfile:z,tournamentRecord:i,appliedPolicies:U,seedAssignments:d,contextContent:p,participantMap:ne,contextProfile:a,drawDefinition:s,scoringActive:A,isRoundRobin:F,roundProfile:W,structure:l,context:o,matchUp:me,event:u})),(V==null?void 0:V.filter(me=>Array.isArray(me.tieMatchUps))).forEach(me=>{let be=me.tieMatchUps;V=V.concat(...be)}),n&&(V=Df({processContext:!0,...n,matchUps:V}))}else(V==null?void 0:V.filter(oe=>Array.isArray(oe.tieMatchUps))).forEach(oe=>{let te=oe.tieMatchUps;V=V.concat(...te)});return r&&(V=Df({matchUps:V,...r,filterMatchUpTypes:!1,filterMatchUpIds:!1})),(r!=null&&r.matchUpTypes||r!=null&&r.matchUpIds)&&(V=Df({matchUpTypes:r.matchUpTypes,matchUpIds:r.matchUpIds,matchUps:V})),(r!=null&&r.matchUpTypes||r!=null&&r.matchUpIds||c)&&(g=fo({matchUps:V}).roundMatchUps??[]),(ce=qs({drawDefinition:s,structure:l,event:u}))!=null&&ce.tieFormat&&({collectionPositionMatchUps:m}=hAe({matchUps:V})),{collectionPositionMatchUps:m,roundMatchUps:g,isRoundRobin:F,roundProfile:W,matchUpsMap:f,matchUps:V}}function Gv({matchUp:t}){return t?ca.includes(t==null?void 0:t.matchUpStatus)||(t==null?void 0:t.winningSide):!1}function Xx({requireParticipants:t=!0,scheduleVisibilityFilters:e,tournamentAppliedPolicies:i,tournamentParticipants:n,hydrateParticipants:r,afterRecoveryTimes:a,policyDefinitions:s,tournamentRecord:o,usePublishState:l,matchUpFilters:c,contextFilters:u,contextContent:d,participantMap:p,scheduleTiming:h,publishStatus:f,contextProfile:m,drawDefinition:g,exitProfiles:v,matchUpsMap:y,structureId:b,inContext:I,structure:T,context:w,event:S}){!T&&b&&({structure:T}=hi({drawDefinition:g,structureId:b}));let U=wn({tournamentAppliedPolicies:i,scheduleVisibilityFilters:e,tournamentParticipants:n,hydrateParticipants:r,afterRecoveryTimes:a,policyDefinitions:s,tournamentRecord:o,usePublishState:l,matchUpFilters:c,contextFilters:u,contextContent:d,participantMap:p,scheduleTiming:h,publishStatus:f,contextProfile:m,drawDefinition:g,exitProfiles:v,matchUpsMap:y,structure:T,inContext:I,context:w,event:S}),P=[],E=[],R=[],C=[],M=[];if(U.error)return U;let{matchUps:_}=U,{assignedPositions:A}=Ma({structure:T}),N=A==null?void 0:A.filter(O=>O.participantId).map(O=>O.drawPosition),k;return _.filter(O=>{var F;let $=((F=c==null?void 0:c.matchUpTypes)==null?void 0:F.length)===1&&c.matchUpTypes[0]===Zn;return!(O.matchUpType!==Zn&&$)}).forEach(O=>{var Z,K,Q,J;if(O.matchUpStatus===sl){P.push(O);return}O.matchUpType===Zn&&(k=!0);let $=O.collectionId,F=$&&((Z=O.sides)==null?void 0:Z.every(se=>se.participantId)),V=!$&&((K=O.drawPositions)==null?void 0:K.filter(Boolean).length)===2,j=!$&&((Q=O.drawPositions)==null?void 0:Q.every(se=>N==null?void 0:N.includes(se))),B=A==null?void 0:A.filter(se=>se.bye).map(se=>se.drawPosition),z=!$&&((J=O.drawPositions)==null?void 0:J.find(se=>B==null?void 0:B.includes(se))),W=Dq.includes(O.matchUpStatus)&&(F||V&&(!t||j));return z?M.push(O):Gv({matchUp:O})?E.push(O):W?R.push(O):C.push(O)}),{includesTeamMatchUps:k,abandonedMatchUps:P,completedMatchUps:E,upcomingMatchUps:R,pendingMatchUps:C,byeMatchUps:M,structure:T}}function qAe({drawDefinition:t,roundNumber:e,structureId:i}){if(!t)return{error:Gt};if(!i)return{error:uc};let{links:n}=uU({drawDefinition:t,structureId:i}),r=n.source.reduce((s,o)=>!o.source.roundNumber||o.source.roundNumber===e?s.concat(o):s,[]),a=n.target.reduce((s,o)=>!o.target.roundNumber||o.target.roundNumber===e?s.concat(o):s,[]);return{links:{source:r,target:a}}}function h$({finishingPositions:t,linkCondition:e,linkType:i,source:n}){var a;let r=n.find(s=>{var l,c;let o=!((l=s.source)!=null&&l.finishingPositions)||!t||ho(t,(c=s.source)==null?void 0:c.finishingPositions);return e===s.linkCondition&&o&&s.linkType===i});return[Gf,xh].includes(r==null?void 0:r.linkType)&&!((a=r==null?void 0:r.source)!=null&&a.roundNumber)?he({result:{error:Re},stack:"getTargetLink",context:r}):r}function uU({drawDefinition:t,structureId:e,roundNumber:i}){return t?e?{links:(t.links||[]).filter(Boolean).reduce((n,r)=>{var a,s;return((a=r.source)==null?void 0:a.structureId)===e&&(!i||r.source.roundNumber===i)&&(n.source=n.source.concat(r)),((s=r.target)==null?void 0:s.structureId)===e&&(!i||r.target.roundNumber===i)&&(n.target=n.target.concat(r)),n},{source:[],target:[]})}:{error:uc}:{error:Gt}}function WAe({structureMatchUps:t,matchUp:e}){let{roundNumber:i,roundPosition:n}=e,r=t.filter(s=>s.roundNumber===i&&!s.matchUpTieId),a=t.filter(s=>s.roundNumber===i+1&&!s.matchUpTieId);if(a.length){let s;return a.length===r.length?s=a.find(o=>o.roundPosition===n):a.length===r.length/2&&(s=a.find(o=>o.roundPosition===Math.ceil(n/2))),{matchUp:s}}return{message:"no progression found"}}function f$({sourceRoundMatchUpCount:t,inContextDrawMatchUps:e,sourceRoundPosition:i,drawDefinition:n,targetLink:r}){var P;if(!r)return{error:Iz};let{target:{structureId:a,feedProfile:s,groupedOrder:o,roundNumber:l,positionInterleave:c}}=r,{structure:u}=hi({drawDefinition:n,structureId:a}),{positionAssignments:d}=jn({structure:u}),p=(e==null?void 0:e.filter(E=>E.structureId===(u==null?void 0:u.structureId))).filter(E=>E.roundNumber===l&&!E.matchUpTieId),h=p.length,f=Rt(1,h+1),m=h/t,g=Math.ceil(m*i),v=1-i%2;if(c!=null&&c.interleave&&m!==.5){let E=c.offset+(i-1)*c.interleave,R=i+E;g=Math.ceil(R/2),v=1-R%2}let y=f,b=f[g-1],I=Doe({roundPositionsCount:f.length,groupedOrder:o}),T=(I==null?void 0:I.length)||1;if(T<=f.length){let E=h/T,R=Ra(f,E);s===Qv&&R.forEach(C=>C.reverse()),y=(I==null?void 0:I.length)&&(I==null?void 0:I.map(C=>R[C-1]).flat())||y}s===Pu?b=y[g-1]:s===Qv?((!(I!=null&&I.length)||T>f.length)&&(g=p.length+1-g),b=y[g-1]):s===Sx&&ic()&&console.log(dx,{feedProfile:s});let w=b&&p.reduce((E,R)=>R.roundPosition===b?R:E,void 0),S;w!=null&&w.feedRound?(v=0,S=Math.min(...(w.drawPositions||[]).filter(Boolean))):S=((P=w==null?void 0:w.drawPositions)==null?void 0:P.length)===2&&(w==null?void 0:w.drawPositions[v]);let U=d==null?void 0:d.find(({drawPosition:E})=>E===S);if(U){let{extension:E}=ki({element:U,name:_x});if(E!=null&&E.value)return{disabledDrawPosition:S}}return{matchUp:w,targetDrawPosition:S,matchUpDrawPositionIndex:v}}function mo({inContextDrawMatchUps:t=[],useTargetMatchUpIds:e,inContextMatchUp:i,drawDefinition:n,matchUpId:r}){let a=i;t.length&&!a&&(a=t.find(o=>o.matchUpId===r));let{structure:s}=hi({structureId:a==null?void 0:a.structureId,drawDefinition:n});return(s==null?void 0:s.finishingPosition)===YI?YAe({inContextDrawMatchUps:t,useTargetMatchUpIds:e,drawDefinition:n,structure:s,matchUp:a}):KAe({matchUp:a})}function YAe({inContextDrawMatchUps:t,useTargetMatchUpIds:e,drawDefinition:i,structure:n,matchUp:r}){var C,M,_;let{winnerMatchUpId:a,loserMatchUpId:s}=r,{links:o}=qAe({roundNumber:r.roundNumber,structureId:n.structureId,drawDefinition:i}),l=o==null?void 0:o.source,c=h$({source:l,linkType:Gf}),u=h$({linkCondition:Pp,linkType:xh,source:l}),d=h$({source:l,linkType:xh}),p=u&&d;d||(d=u);let h=(C=c==null?void 0:c.target)==null?void 0:C.feedProfile,f=(M=d==null?void 0:d.target)==null?void 0:M.feedProfile,m=(_=u==null?void 0:u.target)==null?void 0:_.feedProfile,g,v,y,b,I,T,w,S,U,P;if(e&&(a||s)&&(w=a&&h!==Uu&&t.find(({matchUpId:A})=>A===a),b=s&&f!==Uu&&t.find(({matchUpId:A})=>A===s),w||b))return{matchUp:r,targetLinks:{loserTargetLink:d,winnerTargetLink:c},targetMatchUps:{loserMatchUp:b,winnerMatchUp:w}};let{roundPosition:E}=r;P=P||t.filter(A=>A.structureId===n.structureId);let R=P.reduce((A,N)=>N.roundNumber===r.roundNumber&&!N.matchUpTieId?A+1:A,0);return d&&!b&&f!==Uu&&({matchUpDrawPositionIndex:T,targetDrawPosition:I,matchUp:b}=f$({targetLink:d,sourceRoundMatchUpCount:R,inContextDrawMatchUps:t,sourceRoundPosition:E,drawDefinition:i})),p&&m!==Uu&&({matchUpDrawPositionIndex:y,targetDrawPosition:v,matchUp:g}=f$({targetLink:u,sourceRoundMatchUpCount:R,inContextDrawMatchUps:t,sourceRoundPosition:E,drawDefinition:i})),c&&!w&&h!==Uu&&({matchUpDrawPositionIndex:U,targetDrawPosition:S,matchUp:w}=f$({targetLink:c,sourceRoundMatchUpCount:R,inContextDrawMatchUps:t,sourceRoundPosition:E,drawDefinition:i})),w||(P=P||t.filter(A=>A.structureId===n.structureId),{matchUp:w}=WAe({structureMatchUps:P,matchUp:r})),Kt({matchUp:r,targetLinks:{loserTargetLink:d,winnerTargetLink:c,byeTargetLink:u},targetMatchUps:{winnerMatchUpDrawPositionIndex:U,loserMatchUpDrawPositionIndex:T,byeMatchUpDrawPositionIndex:y,winnerTargetDrawPosition:S,loserTargetDrawPosition:I,byeTargetDrawPosition:v,winnerMatchUp:w,loserMatchUp:b,byeMatchUp:g},targetMatchUpIds:!!(a||s)})}function KAe({matchUp:t}){return{targetLinks:{loserTargetLink:void 0,winnerTargetLink:void 0},targetMatchUps:{loserMatchUp:void 0,winnerMatchUp:void 0},matchUp:t}}function ZAe({drawDefinition:t,inContextDrawMatchUps:e}){let i={};return e.forEach(n=>{var l,c,u,d,p,h;let{matchUpId:r,structureId:a,drawPositions:s=[]}=n,{structure:o}=hi({drawDefinition:t,structureId:a});if((o==null?void 0:o.finishingPosition)===ey){let{roundNumber:f}=n,m=f&&ui(f)+1,g=o.matchUps??[],{roundMatchUps:v}=fo({matchUps:g});if(m&&(v!=null&&v[m])){let y=[...s].sort(ia).map((b,I)=>{let T=v[m].find(w=>{var S;return(S=w.drawPositions)==null?void 0:S.includes(b)});return{matchUpId:T==null?void 0:T.matchUpId,roundNumber:m,schedule:T==null?void 0:T.schedule,sideNumber:I+1,structureName:o.structureName}});Object.assign(n,{sidesTo:y})}}else{let f=mo({useTargetMatchUpIds:!0,inContextDrawMatchUps:e,inContextMatchUp:n,drawDefinition:t,matchUpId:r}),{winnerMatchUp:m}=f.targetMatchUps,{loserMatchUp:g}=f.targetMatchUps;!n.winnerMatchUpId&&m&&(n.winnerMatchUpId=m.matchUpId),!n.loserMatchUpId&&g&&(n.loserMatchUpId=g.matchUpId);let v=m$({upcomingMatchUp:m}),y=m$({upcomingMatchUp:g});if(n.matchUpStatus!==mn&&(g==null?void 0:g.matchUpStatus)===mn){let{matchUp:I}=qoe({matchUp:g,drawDefinition:t,inContextDrawMatchUps:e})||{};y=I&&m$({upcomingMatchUp:I})||y}let b=(l=n.schedule)==null?void 0:l.timeAfterRecovery;if(b&&((c=v==null?void 0:v.schedule)!=null&&c.scheduledTime&&an(v.schedule.scheduledTime)<an(b)&&(i[v.matchUpId]=n.matchUpId,v.schedule.scheduleConflict=n.matchUpId),(u=y==null?void 0:y.schedule)!=null&&u.scheduledTime&&an(y.schedule.scheduledTime)<an(b)&&(i[y.matchUpId]=n.matchUpId,y.schedule.scheduleConflict=n.matchUpId)),Object.assign(n,{winnerTo:v,loserTo:y}),(d=n.drawPositions)==null?void 0:d.filter(Boolean).length){let I=((h=(p=f.targetLinks)==null?void 0:p.loserTargetLink)==null?void 0:h.linkCondition)===Pp,T=XAe(n);if(T.length){let w=kV(m==null?void 0:m.sides),S=kV(g==null?void 0:g.sides),U=T.find(({participantId:E})=>w.includes(E))?[]:T,P=T.find(({participantId:E})=>S.includes(E))?[]:T;g&&I&&P.length<2&&P.push({bye:!0,tbd:!0}),U!=null&&U.length&&m&&(!f.targetMatchUpIds&&m&&(m=e.find(({matchUpId:E})=>E===m.matchUpId)),m.potentialParticipants||(m.potentialParticipants=[]),m.potentialParticipants.push(U)),P!=null&&P.length&&g&&(f.targetMatchUpIds||(m=e.find(({matchUpId:E})=>E===g.matchUpId)),g.potentialParticipants||(g.potentialParticipants=[]),g.potentialParticipants.push(P))}}}}),Object.keys(i).length&&e.forEach(n=>{Object.keys(i).includes(n.matchUpId)&&(n.schedule.scheduleConflict=i[n.matchUpId])}),{scheduleConflictMatchUpIds:i}}function XAe(t){var e;return((e=t==null?void 0:t.sides)==null?void 0:e.map(({participant:i,participantId:n,qualifier:r})=>i||n&&{participantId:n}||r&&{qualifier:r}).filter(Boolean))||[]}function qoe({matchUp:t,drawDefinition:e,inContextDrawMatchUps:i}){var s;let{matchUpId:n,matchUpStatus:r,structureId:a}=t||{};if(!t||!a||(t==null?void 0:t.matchUpStatus)===Vr)return{matchUp:t};if(r===mn){let o;return t.winnerMatchUpId?o=i.find(({matchUpId:l})=>l===t.winnerMatchUpId):{winnerMatchUp:o}=((s=mo({inContextDrawMatchUps:i,drawDefinition:e,matchUpId:n}))==null?void 0:s.targetMatchUps)||{},qoe({matchUp:o,drawDefinition:e,inContextDrawMatchUps:i})}return{matchUp:void 0}}function m$(t){if(t!=null&&t.upcomingMatchUp)return(({matchUpId:e,structureId:i,schedule:n,roundNumber:r,roundPosition:a,structureName:s})=>({matchUpId:e,structureId:i,schedule:n,roundNumber:r,roundPosition:a,structureName:s}))(t.upcomingMatchUp)}function ua(t){let e="getAllDrawMatchUps";Object.assign(t,{requireParticipants:!1});let i=dU(t);if(i.error)return he({result:i,stack:e});let{abandonedMatchUps:n,completedMatchUps:r,upcomingMatchUps:a,pendingMatchUps:s,byeMatchUps:o,matchUpsMap:l}=i;return{matchUps:(n??[]).concat(...r??[],...a??[],...s??[],...o??[]),matchUpsMap:l}}function dU(t){if(!(t!=null&&t.drawDefinition))return{error:Gt};let{tournamentParticipants:e,contextContent:i,matchUpsMap:n}=t,{scheduleVisibilityFilters:r,tournamentAppliedPolicies:a,requireParticipants:s,participantsProfile:o,afterRecoveryTimes:l,policyDefinitions:c,tournamentRecord:u,usePublishState:d,contextFilters:p,matchUpFilters:h,scheduleTiming:f,participantMap:m,publishStatus:g,contextProfile:v,drawDefinition:y,nextMatchUps:b,inContext:I,context:T,event:w}=t,S=[],U=[],P=[],E=[],R=[];v&&!i&&(i=Sm({policyDefinitions:c,tournamentRecord:u,contextProfile:v,event:w}));let C;!(e!=null&&e.length)&&u&&(e=u==null?void 0:u.participants,(I||o!=null&&o.withGroupings)&&(e!=null&&e.length)&&({participantsWithGroupings:e,groupInfo:C}=Vx({participants:e,participantsProfile:o})));let{structures:M}=Wu({drawDefinition:y});if(!M)return{error:gr};n||(n=Ts({drawDefinition:y}));let _=y&&Eoe({drawDefinition:y}).exitProfiles;M.forEach(k=>{let{byeMatchUps:O=[],pendingMatchUps:$=[],upcomingMatchUps:F=[],completedMatchUps:V=[],abandonedMatchUps:j=[]}=Xx({matchUpFilters:b?void 0:h,contextFilters:b?void 0:p,inContext:I||b||p,hydrateParticipants:t.hydrateParticipants,tournamentAppliedPolicies:a,scheduleVisibilityFilters:r,tournamentParticipants:e,requireParticipants:s,afterRecoveryTimes:l,policyDefinitions:c,tournamentRecord:u,usePublishState:d,contextContent:i,participantMap:m,scheduleTiming:f,publishStatus:g,contextProfile:v,drawDefinition:y,exitProfiles:_,matchUpsMap:n,structure:k,context:T,event:w});S=S.concat(...j),U=U.concat(...V),P=P.concat(...F),E=E.concat(...$),R=R.concat(...O)});let A=k=>(!h&&!b&&!p||(h&&(k=Df({matchUps:k,...h})),p&&(k=Df({matchUps:k,...p,processContext:!0}))),k),N={abandonedMatchUps:A(S),completedMatchUps:A(U),upcomingMatchUps:A(P),pendingMatchUps:A(E),byeMatchUps:A(R),matchUpsMap:n,...de,groupInfo:C};if(b){let k=typeof b=="object"||{abandoned:!0,completed:!0,upcoming:!0,pending:!0,bye:!0},{abandoned:O,completed:$,upcoming:F,pending:V,bye:j}=k,B=[].concat(...O&&S||[],...$&&U||[],...F&&P||[],...V&&E||[],...j&&R||[]);ZAe({inContextDrawMatchUps:B,drawDefinition:y})}return N}function Jh(t){let{participants:e=[],contextContent:i,participantMap:n}=t,{scheduleVisibilityFilters:r,tournamentAppliedPolicies:a,participantsProfile:s,afterRecoveryTimes:o,policyDefinitions:l,useParticipantMap:c,tournamentRecord:u,usePublishState:d,contextFilters:p,matchUpFilters:h,contextProfile:f,nextMatchUps:m,inContext:g,context:v,event:y}=t;if(!y)return{error:Jn};let{eventId:b,eventName:I,endDate:T,eventType:w,category:S,gender:U,matchUpFormat:P}=y??{},E={...v,...Kt({indoorOutDoor:y.indoorOutdoor??(u==null?void 0:u.indoorOutdoor),surfaceCategory:y.surfaceCategory??(u==null?void 0:u.surfaceCategory),endDate:y.endDate??(u==null?void 0:u.endDate),tournamentId:u==null?void 0:u.tournamentId,matchUpFormat:P,eventName:I,eventType:w,category:S,eventId:b,gender:U})};T&&(E.endDate=T),f&&!i&&(i=Sm({policyDefinitions:l,tournamentRecord:u,contextProfile:f,event:y}));let R;if(!(e!=null&&e.length)&&!n&&u){let _=Ly({participantsProfile:s,useParticipantMap:c,policyDefinitions:l,tournamentRecord:u,contextProfile:f,inContext:g});n=_.participantMap,e=_.participants??[],R=_.groupInfo}let C=y.drawDefinitions??[],M=YP({tournamentRecord:u,event:y}).scheduleTiming;return{matchUps:C.flatMap(_=>{let{matchUps:A}=ua({tournamentParticipants:e,tournamentAppliedPolicies:a,scheduleVisibilityFilters:r,context:E,participantsProfile:s,afterRecoveryTimes:o,policyDefinitions:l,tournamentRecord:u,usePublishState:d,contextFilters:p,contextProfile:f,drawDefinition:_,contextContent:i,matchUpFilters:h,participantMap:n,scheduleTiming:M,nextMatchUps:m,inContext:g,event:y});return A??[]}),groupInfo:R}}function Wa(t){let e=Qt(t,[{tournamentRecord:!0}]);if(e.error)return e;if(!(t!=null&&t.tournamentRecord))return{error:ut};let{participantMap:i,participants:n}=t,{scheduleVisibilityFilters:r,participantsProfile:a,afterRecoveryTimes:s,useParticipantMap:o,policyDefinitions:l,tournamentRecord:c,inContext:u=!0,usePublishState:d,contextProfile:p,matchUpFilters:h,contextFilters:f,nextMatchUps:m,context:g}=t,v=t.tournamentId??c.tournamentId,y=(c==null?void 0:c.events)??[];n||({participants:n,participantMap:i}=Ly({participantsProfile:a,useParticipantMap:o,policyDefinitions:l,tournamentRecord:c,contextProfile:p,inContext:u}));let{appliedPolicies:b}=hn({tournamentRecord:c}),I={...g,tournamentId:v,indoorOutDoor:c.indoorOutdoor,surfaceCategory:c.surfaceCategory,endDate:c.endDate},T=Sm({policyDefinitions:l,tournamentRecord:c,contextProfile:p});return{matchUps:y.flatMap(w=>{var S;return I.eventDrawsCount=((S=w.drawDefinitions)==null?void 0:S.length)??0,Jh({context:I,scheduleVisibilityFilters:r,tournamentAppliedPolicies:b,participantsProfile:a,afterRecoveryTimes:s,policyDefinitions:l,tournamentRecord:c,usePublishState:d,contextContent:T,contextFilters:f,contextProfile:p,matchUpFilters:h,participantMap:i,nextMatchUps:m,participants:n,inContext:u,event:w}).matchUps??[]}).concat(...c.matchUps??[])}}function _d({scheduleVisibilityFilters:t,afterRecoveryTimes:e,participantsProfile:i,tournamentRecords:n,policyDefinitions:r,usePublishState:a,matchUpFilters:s,contextFilters:o,nextMatchUps:l,inContext:c}){if(typeof n!="object"||!Object.keys(n).length)return{error:wr};let u=Object.keys(n).map(d=>{let p=n[d];return Wa({scheduleVisibilityFilters:t,afterRecoveryTimes:e,participantsProfile:i,policyDefinitions:r,tournamentRecord:p,usePublishState:a,matchUpFilters:s,contextFilters:o,nextMatchUps:l,inContext:c}).matchUps??[]}).flat();return{...de,matchUps:u}}function rw(t,e){return JAe(t,e)||((t==null?void 0:t.stageSequence)||0)-((e==null?void 0:e.stageSequence)||0)||(t==null?void 0:t.roundNumber)&&e.roundNumber&&(t==null?void 0:t.roundNumber)-(e==null?void 0:e.roundNumber)||((t==null?void 0:t.roundPosition)??0)-((e==null?void 0:e.roundPosition)??0)}function JAe(t,e){return(lI[t==null?void 0:t.stage]||0)-(lI[e==null?void 0:e.stage]||0)}function lo(t){let{participants:e,participantMap:i,contextContent:n}=t,{scheduleVisibilityFilters:r,tournamentAppliedPolicies:a,participantsProfile:s,afterRecoveryTimes:o,policyDefinitions:l,useParticipantMap:c,tournamentRecord:u,matchUpFilters:d,contextFilters:p,contextProfile:h,drawDefinition:f,nextMatchUps:m,inContext:g,context:v,event:y}=t,{eventId:b,eventName:I,endDate:T,eventType:w,category:S,gender:U,matchUpFormat:P}=y??{},E={...v,surfaceCategory:(y==null?void 0:y.surfaceCategory)??(u==null?void 0:u.surfaceCategory),indoorOutDoor:(y==null?void 0:y.indoorOutdoor)??(u==null?void 0:u.indoorOutdoor),matchUpFormat:P,eventType:w,eventName:I,category:S,eventId:b,endDate:T,gender:U},R;return!(e!=null&&e.length)&&!i&&u&&({participants:e=[],participantMap:i,groupInfo:R}=Ly({participantsProfile:s,useParticipantMap:c,policyDefinitions:l,tournamentRecord:u,contextProfile:h,inContext:g})),h&&!n&&(n=Sm({policyDefinitions:l,tournamentRecord:u,contextProfile:h,drawDefinition:f,event:y})),{...ua({context:E,tournamentAppliedPolicies:a,scheduleVisibilityFilters:r,tournamentParticipants:e,participantsProfile:s,afterRecoveryTimes:o,policyDefinitions:l,tournamentRecord:u,drawDefinition:f,contextContent:n,contextFilters:p,contextProfile:h,matchUpFilters:d,participantMap:i,nextMatchUps:m,inContext:g,event:y}),groupInfo:R}}function Ob({element:t,accessor:e}){if(typeof e!="string")return{values:[]};let i=_t(t),n=e.split("."),r=[],a;o({targetElement:i,attributes:n});let s={value:a};return r.length&&(s.values=r),s;function o({targetElement:l,attributes:c=[],significantCharacters:u}){for(let[p,h]of c.entries())if(l!=null&&l[h]){let f=c.slice(p+1);f.length?Array.isArray(l[h])?l[h].forEach(m=>o({targetElement:m,attributes:f})):(l=l[h],d({targetElement:l,index:p})):(a||(a=l[h]),r.includes(l[h])||r.push(l[h]))}function d({targetElement:p,index:h}){if(p&&h===c.length-1&&["string","number"].includes(typeof p)){let f=u?p.slice(0,u):p;a?r.includes(f)||r.push(f):(a=f,r.push(f))}}}}var Woe=t=>e=>{var i;return!t||typeof e!="object"?void 0:Array.isArray(t)&&t.map(n=>{var r;return{[n]:(r=Ob({element:e,accessor:n}))==null?void 0:r.value}})||typeof t=="object"&&Object.keys(t).map(n=>{var r;return{[n]:(r=Ob({element:e,accessor:n}))==null?void 0:r.value}})||((i=typeof t=="string"&&Ob({element:e,accessor:t}))==null?void 0:i.value)},kl=Woe;function aC({finishingPositionOffset:t=0,finishingPositionLimit:e,positionsFed:i,roundsCount:n,roundLimit:r,matchUps:a,lucky:s,fmlc:o}){var g;if(!tu(a))return[];let{roundProfile:l,roundNumbers:c=[]}=fo({interpolate:!0,matchUps:a});n=n??Math.max(...c,0);let u=r?n-r:0,d=u&&((g=l==null?void 0:l[n-u])==null?void 0:g.matchUpsCount),p=l&&Object.values(l).map(kl("matchUpsCount")),h=(v,y)=>{let b=Math.min(...v);d&&y&&b===1&&(b=d);let I=Math.max(...v);return e&&I>e&&(I=e),[b,I]},f=l&&Object.assign({},...c.map(v=>{let y=(n??0)+1-v-u,b=l[v].matchUpsCount,I={finishingPositionRange:{},finishingRound:y},T=p==null?void 0:p.slice(v-1).reduce((M,_)=>M+(_||0),0),w=o&&v!==1,S=1+t+(w?i??0:0),U=1,P=Rt(S,s?S+b*2:T+S+U),E=T+U-b,R=h(P.slice(E)),C=h(P.slice(0,E),!0);return I.finishingPositionRange={loser:R,winner:C},{[v]:I}})),m=ic({finishingRound:!0});return a.filter(Boolean).forEach(v=>{let y=v.roundNumber&&f[v.roundNumber];m&&!y&&console.log({roundFinishingData:f,matchUp:v}),v.finishingRound=y==null?void 0:y.finishingRound,v.finishingPositionRange=y==null?void 0:y.finishingPositionRange}),a}function ay({inContextDrawMatchUps:t,drawDefinition:e,matchUpsMap:i}){var r;if(!e)return{error:Gt};let n={loserMatchUpIds:{},winnerMatchUpIds:{}};if(t||({matchUps:t,matchUpsMap:i}=ua({inContext:!0,drawDefinition:e,matchUpsMap:i})),!(i!=null&&i.drawMatchUps.some(a=>a.finishingPositionRange))&&((r=e==null?void 0:e.structures)==null?void 0:r.length)===1&&!(e!=null&&e.structures[0].structures)){let a=(i==null?void 0:i.drawMatchUps)??[];aC({matchUps:a})}return(t??[]).filter(({collectionId:a})=>!a).forEach(a=>{let{matchUpId:s,structureId:o}=a,l=mo({inContextDrawMatchUps:t,drawDefinition:e,matchUpId:s}),{winnerMatchUp:c,loserMatchUp:u}=l.targetMatchUps,d=c==null?void 0:c.matchUpId,p=u==null?void 0:u.matchUpId,h=ny({matchUpsMap:i,structureId:o}).find(f=>f.matchUpId===s);if(h&&(d&&(n.winnerMatchUpIds[h.matchUpId]=d,Object.assign(h,{winnerMatchUpId:d}),Object.assign(a,{winnerMatchUpId:d})),p&&(n.loserMatchUpIds[h.matchUpId]=p,a.loserMatchUpId=p,h.loserMatchUpId=p,a.finishingPositionRange))){let f=u.finishingPositionRange&&[...a.finishingPositionRange.loser,...u.finishingPositionRange.loser],m=f&&[Math.min(...f),Math.max(...f)];a.finishingPositionRange.loser=m,h.finishingPositionRange.loser=m}}),{inContextDrawMatchUps:t,goesToMap:n}}function rd(t){var y;let e=Jc(t),i=t.matchUps??[],n=t.drawIds??[],{includeParticipantDependencies:r,tournamentRecord:a,drawDefinition:s}=t;if(!Array.isArray(i))return{error:ym};if(!Array.isArray(n))return{error:Vd};let o=(y=t.matchUpIds)!=null&&y.length?t.matchUpIds:i.map(b=>b.matchUpId);if(!Array.isArray(o))return{error:BI};let l={},c={},u={},d={};a&&!Object.keys(e).length&&(e={[a.tournamentId]:a});let p=Object.values(e),h=p.reduce((b,I)=>b.concat(I.events??[]).map(T=>(T.drawDefinitions||[]).map(w=>w.links||[])).flat(1/0),[]).filter(({linkType:b})=>b===jf),f=i;if(h.length){f=_d({nextMatchUps:!0,tournamentRecords:e}).matchUps;let b=h.reduce((I,T)=>{var U,P;let w=(U=T.source)==null?void 0:U.structureId,S=(P=T.target)==null?void 0:P.structureId;return w&&S&&(u[S]=w),w&&!I.includes(w)&&I.push(w),I},[]);for(let I of b)l[I]=[];for(let I of f??[]){let T=I.containerStructureId||I.structureId;b.includes(T)&&l[T].push(I.matchUpId)}}let m=b=>{c[b]||(c[b]={dependentMatchUpIds:[],participantIds:[],matchUpIds:[],sources:[]},d[b]=[])},g=(b,I)=>{c[b].matchUpIds.forEach(T=>{c[I].matchUpIds.push(T)}),c[I].matchUpIds.push(b),c[b].dependentMatchUpIds.push(I),r&&c[b].participantIds.forEach(T=>c[I].participantIds.push(T))},v=b=>{let I=Object.keys(l).length;for(let T of b||[]){let{matchUpId:w,winnerMatchUpId:S,loserMatchUpId:U}=T;if(!o.length||o.includes(w)){if(m(w),r){let{individualParticipantIds:R}=Bx(T);c[w].participantIds=R}S&&(m(S),g(w,S),d[S].push(w)),U&&(m(U),g(w,U),d[U].push(w)),c[w].sources.push(d[w]);let P=d[w].map(R=>c[R].sources[0]).flat(),E=d[w].map(R=>c[R].sources[1]).flat();if(c[w].sources.push(P,E),I){let R=T.containerStructureId||T.structureId,C=u[R];if(l[C])for(let M of l[C])m(M),g(M,w),d[M].push(w)}}}};if(s)ay({drawDefinition:s}),f!=null&&f.length||(f=lo({drawDefinition:s}).matchUps),v(f);else{if(f!=null&&f.length||(f=_d({nextMatchUps:!0,tournamentRecords:e}).matchUps),!n.length){let b=p!=null&&p.length?p.map(({events:I=[]})=>I.map(({drawDefinitions:T=[]})=>T.map(({drawId:w})=>w))).flat(1/0):[];b&&(n=b)}for(let b of n){let I=f==null?void 0:f.filter(T=>T.drawId===b).sort(rw);if(!(I!=null&&I.find(({roundPosition:T})=>!T))){let T=I==null?void 0:I.find(({tournamentId:S})=>S),{drawDefinition:w}=jo({tournamentRecord:e[T==null?void 0:T.tournamentId],drawId:b});w&&ay({drawDefinition:w})}v(I)}}return{positionDependencies:l,matchUpDependencies:c,sourceMatchUpIds:d,matchUps:f,...de}}function ga(t){var d,p;let e=t==null?void 0:t.matchUp,i=(t==null?void 0:t.score)||(e==null?void 0:e.score),n=(d=i==null?void 0:i.sets)==null?void 0:d[0],{side1Score:r,side2Score:a,side1TiebreakScore:s,side2TiebreakScore:o,side1PointScore:l,side2PointScore:c}=n||{},u=r||a||s||o||l||c;return!!(((p=i==null?void 0:i.sets)==null?void 0:p.length)>1||u)}function sC({matchUpStatus:t}){return Tq.includes(t)}function QAe({matchUpStatus:t}){return xx.includes(t)}function VV({matchUpStatus:t}){return Uq.includes(t)}function i3({matchUpStatus:t,winningSide:e,tieMatchUps:i,sides:n,score:r}){var o;let a=n==null?void 0:n.find(({participantId:l})=>l),s=(o=i==null?void 0:i.filter(i3))==null?void 0:o.length;return ga({score:r})||s||e&&a||t&&QAe({matchUpStatus:t})&&![Yi,cn,td].includes(t)}function oC(t){var S;let{drawDefinition:e,findContainer:i,structureId:n,event:r}=t,a=t.structure,s={isCollectionMatchUp:!1},{containedStructures:o}=cU({drawDefinition:e}),l=n?o[n]||[]:[];if(!a){let U=hi({drawDefinition:e,structureId:n});if(U.error)return U;a=i?U.containingStructure??U.structure:U.structure}if(Vo({structure:a}))return{structure:a,isAdHoc:!0,error:YT};let{matchUps:c}=ua({inContext:!0,matchUpFilters:s,drawDefinition:e,event:r}),u=c==null?void 0:c.filter(U=>U.structureId===n||l.includes(U.structureId)),{matchUpDependencies:d}=rd({drawIds:[e.drawId],matchUps:c,drawDefinition:e}),p=[],h=[],f={},m=[];for(let U of c??[]){if(U.structureId===n||l.includes(U.structureId)){h.push(...U.drawPositions??[]);let P=U.roundNumber;for(let E of(U.drawPositions??[]).filter(Boolean))(!f[E]||P&&f[E]>P)&&(f[E]=P)}i3(U)&&(m.push(U),p.push(U.matchUpId,...((S=d==null?void 0:d[U==null?void 0:U.matchUpId])==null?void 0:S.matchUpIds)||[]))}let g=Ei(h.filter(Boolean)).sort(ia),v=Ei(p),y=Ei(u==null?void 0:u.map(({matchUpId:U,drawPositions:P})=>v.includes(U)?P:[]).flat().filter(Boolean)).sort(ia),{positionAssignments:b}=jn({drawDefinition:e,structure:a}),I=b==null?void 0:b.filter(U=>U.bye).map(U=>U.drawPosition),T=b==null?void 0:b.filter(U=>U.qualifier).map(U=>U.drawPosition),w=(g==null?void 0:g.filter(U=>!y.includes(U)))||[];return{allDrawPositions:g,inContextStructureMatchUps:u,drawPositionInitialRounds:f,activeDependentMatchUpIds:v,qualifyingDrawPositions:T,inactiveDrawPositions:w,positionAssignments:b,activeDrawPositions:y,byeDrawPositions:I,activeMatchUps:m,structure:a}}function pI({drawPosition:t,matchUps:e=[]}){return{initialRoundNumber:e.filter(({drawPositions:i})=>t&&(i==null?void 0:i.includes(t))).map(({roundNumber:i})=>i).sort(ia)[0]}}var Bm={reset:"\x1B[0m",bright:"\x1B[1m",dim:"\x1B[2m",red:"\x1B[31m",brightred:"\x1B[91m",green:"\x1B[32m",brightgreen:"\x1B[92m",yellow:"\x1B[33m",brightyellow:"\x1B[93m",blue:"\x1B[34m",brightblue:"\x1B[94m",lightblue:"\x1B[105m",magenta:"\x1B[35m",brightmagenta:"\x1B[95m",cyan:"\x1B[36m",brightcyan:"\x1B[96m",white:"\x1B[37m",brightwhite:"\x1B[97m"},n3=[];function Xl(t,e){nr(t)&&(t={method:t}),(e||ic())&&n3.push(t)}function e_e(t){return n3.slice()}function t_e(t){let e=e_e().map(i=>{let{color:n,keyColors:r,method:a,newline:s}=i,o=Object.keys(Bm).includes(n)?Bm[n]:Bm.cyan,l=Object.keys(i).filter(u=>!["color","keyColors","method","newline"].includes(u)).map(u=>{let d=r&&Object.keys(r).includes(u)&&Bm[r[u]]?Bm[r[u]]:Bm.brightwhite;return`${Bm.white}${u}: ${d}${i[u]}`}).join(", "),c=(a==null?void 0:a.length)<15?"		":"	";return[s?`
`:"",o,a,c,Bm.white,l,Bm.reset,`
`].join("")});e!=null&&e.length&&console.log(...e)}function i_e(){n3.length=0}function fc({provisionalPositioning:t,isPositionAction:e,tournamentRecord:i,drawDefinition:n,drawPosition:r,matchUpsMap:a,structureId:s,structure:o,event:l}){var P,E,R;if(!n)return{error:Gt};if(o||({structure:o}=hi({drawDefinition:n,structureId:s})),!o)return{error:gr};s||({structureId:s}=o);let c="assignDrawPositionBye";Xl({method:c,color:"cyan",drawPosition:r}),a||(a=Ts({drawDefinition:n}));let{positionAssignments:u}=jn({structure:o}),{activeDrawPositions:d}=oC({drawDefinition:n,structureId:s});if((P=u==null?void 0:u.find(C=>C.drawPosition===r))!=null&&P.bye)return{...de};if(d!=null&&d.includes(r))return{error:ex};let p=u==null?void 0:u.find(C=>C.drawPosition===r);if(!p)return{error:YT};let{filled:h,containsBye:f,assignedParticipantId:m}=n_e(p);if(f)return{...de};if(h&&!f)return he({result:{error:RS},stack:c});let g=hn({tournamentRecord:i,drawDefinition:n,event:l}).appliedPolicies??{},v=ua({inContext:!0,drawDefinition:n,matchUpsMap:a}).matchUps??[],y={isCollectionMatchUp:!1},{matchUps:b}=wn({provisionalPositioning:t,drawDefinition:n,matchUpFilters:y,matchUpsMap:a,structure:o});if(u==null||u.forEach(C=>{C.drawPosition===r&&(C.bye=!0)}),o.structureType===So)return r_e({tournamentRecord:i,drawDefinition:n,drawPosition:r,matchUps:b}),pg({tournamentId:i==null?void 0:i.tournamentId,drawDefinition:n,structure:o,event:l}),YK({assignedParticipantId:m,isPositionAction:e,appliedPolicies:g,drawDefinition:n,drawPosition:r,structureId:s,stack:c});let{roundProfile:I,roundMatchUps:T}=fo({matchUps:b}),w=(E=I&&Object.keys(I).map(C=>parseInt(C)).reverse())==null?void 0:E.find(C=>{var M;return(M=I==null?void 0:I[C].drawPositions)==null?void 0:M.includes(r)}),S=w?T==null?void 0:T[w].find(({drawPositions:C})=>C==null?void 0:C.includes(r)):void 0;S&&Yoe({tournamentRecord:i,drawDefinition:n,matchUp:S,event:l});let U=(R=S==null?void 0:S.drawPositions)==null?void 0:R.find(C=>C!==r);if(S&&U){let C=r3({sourceDrawPositions:S.drawPositions,matchUpId:S.matchUpId,inContextDrawMatchUps:v,drawPositionToAdvance:U,tournamentRecord:i,drawDefinition:n,matchUpsMap:a});if(C.error)return C}return pg({tournamentId:i==null?void 0:i.tournamentId,drawDefinition:n,structure:o,event:l}),YK({assignedParticipantId:m,isPositionAction:e,appliedPolicies:g,drawDefinition:n,drawPosition:r,structureId:s,stack:c})}function YK({assignedParticipantId:t,isPositionAction:e,appliedPolicies:i,drawDefinition:n,drawPosition:r,structureId:a,stack:s}){return e&&$x({appliedPolicies:i,drawDefinition:n,positionAction:{removedParticipantId:t,drawPosition:r,structureId:a,name:s}}),he({result:{...de},stack:s})}function n_e(t){let e=t.bye,i=t.qualifier,n=t.participantId;return{containsBye:e,containsQualifier:i,assignedParticipantId:n,filled:e||i||n}}function Yoe({tournamentRecord:t,drawDefinition:e,eventId:i,matchUp:n,event:r}){Object.assign(n,{matchUpStatus:mn,score:void 0,winningSide:void 0}),Ji({tournamentId:t==null?void 0:t.tournamentId,eventId:i??(r==null?void 0:r.eventId),context:"setMatchUpStatusBye",drawDefinition:e,matchUp:n})}function r_e({tournamentRecord:t,drawDefinition:e,drawPosition:i,matchUps:n,event:r}){n.forEach(a=>{var s;(s=a.drawPositions)!=null&&s.includes(i)&&Yoe({eventId:r==null?void 0:r.eventId,tournamentRecord:t,drawDefinition:e,matchUp:a})})}function r3({drawPositionToAdvance:t,inContextDrawMatchUps:e,sourceDrawPositions:i,tournamentRecord:n,drawDefinition:r,matchUpsMap:a,matchUpId:s,event:o}){var b,I;Xl({method:"advanceDrawPosition",color:"cyan",drawPositionToAdvance:t});let l=a.drawMatchUps.find(T=>T.matchUpId===s),c=(b=e.find(T=>T.matchUpId===s))==null?void 0:b.structureId,{structure:u}=hi({drawDefinition:r,structureId:c}),{positionAssignments:d}=jn({structure:u}),p=d==null?void 0:d.filter(T=>T.bye).map(T=>T.drawPosition),h=(I=l==null?void 0:l.drawPositions)==null?void 0:I.find(T=>T!==t),f=h&&(p==null?void 0:p.includes(h)),{targetLinks:{loserTargetLink:m},targetMatchUps:{loserMatchUp:g,winnerMatchUp:v,loserTargetDrawPosition:y}}=mo({inContextDrawMatchUps:e,drawDefinition:r,matchUpId:s});if(v&&v.structureId===(u==null?void 0:u.structureId)&&a_e({drawPositionToAdvance:t,inContextDrawMatchUps:e,sourceDrawPositions:i,tournamentRecord:n,drawDefinition:r,winnerMatchUp:v,matchUpsMap:a,event:o}),g&&f&&g.structureId!==(u==null?void 0:u.structureId)){let{roundNumber:T}=g;if(T===1){let w=fc({structureId:m.target.structureId,drawPosition:y,tournamentRecord:n,drawDefinition:r,event:o});if(w.error)return w}else Koe({loserTargetDrawPosition:y,tournamentRecord:n,loserTargetLink:m,drawDefinition:r,loserMatchUp:g,matchUpsMap:a,event:o})}return{...de}}function a_e({drawPositionToAdvance:t,inContextDrawMatchUps:e,sourceDrawPositions:i,tournamentRecord:n,drawDefinition:r,winnerMatchUp:a,matchUpsMap:s,event:o}){var _,A,N,k,O,$;let l="advanceWinner",c=s.drawMatchUps.find(F=>F.matchUpId===a.matchUpId),u=(_=e.find(F=>F.matchUpId===a.matchUpId))==null?void 0:_.structureId,{structure:d}=hi({drawDefinition:r,structureId:u}),{positionAssignments:p}=jn({structure:d}),h=(A=p==null?void 0:p.find(({drawPosition:F})=>F===t))==null?void 0:A.bye,f=(N=c.drawPositions)==null?void 0:N.filter(Boolean),m=p==null?void 0:p.filter(F=>f==null?void 0:f.includes(F.drawPosition)),g=p==null?void 0:p.find(({drawPosition:F})=>F===t),v=i==null?void 0:i.find(F=>F!==t),y=(k=v&&(m==null?void 0:m.find(({drawPosition:F})=>F===v)))==null?void 0:k.bye,b=h&&y;if(b&&console.log({isByeAdvancedBye:b}),(f==null?void 0:f.length)>1&&h&&!y)return he({result:{error:RS},stack:l});let I=f==null?void 0:f.find(F=>F!==t),T=b,w=[...(c.drawPositions||[]).filter(Boolean),void 0,void 0].slice(0,2),S=w.map(F=>!F&&!T||F===t?(T=!0,t):F).sort(ia);if(!T)return console.log("@@@@@@@",{advancingAssignmentIsBye:g,drawPositionToAdvance:t,existingAssignments:m}),he({result:{error:RS},stack:l});let U=(O=p==null?void 0:p.find(({drawPosition:F})=>F===I))==null?void 0:O.bye,P=($=p==null?void 0:p.find(({drawPosition:F})=>F===t))==null?void 0:$.bye;Object.assign(c,{matchUpStatus:P||U?mn:Vr,score:void 0,winningSide:void 0,drawPositions:S});let E=c.drawPositions.find(F=>!w.includes(F));Xl({method:l,color:"brightyellow",changedDrawPosition:E,pairedDrawPositionIsBye:U,drawPositionIsBye:P}),Ji({tournamentId:n==null?void 0:n.tournamentId,matchUp:c,eventId:o==null?void 0:o.eventId,context:l,drawDefinition:r});let{targetLinks:{loserTargetLink:R},targetMatchUps:{loserMatchUp:C,loserTargetDrawPosition:M}}=mo({matchUpId:a.matchUpId,inContextDrawMatchUps:e,drawDefinition:r});if(U||P){let F=U?t:I;if(F)r3({drawPositionToAdvance:F,matchUpId:a.matchUpId,inContextDrawMatchUps:e,tournamentRecord:n,drawDefinition:r,matchUpsMap:s});else if(P&&R&&C)if(C.feedRound)Koe({loserTargetDrawPosition:M,tournamentRecord:n,loserTargetLink:R,drawDefinition:r,loserMatchUp:C,matchUpsMap:s});else{let V=1-a.roundPosition%2,j=C.drawPositions[V],B=fc({structureId:R.target.structureId,drawPosition:j,tournamentRecord:n,drawDefinition:r,event:o});if(B.error)return B}}}function Koe({loserTargetDrawPosition:t,tournamentRecord:e,loserTargetLink:i,drawDefinition:n,loserMatchUp:r,matchUpsMap:a,event:s}){let{roundNumber:o}=r;Xl({method:"assignFedDrawPositionBye",color:"cyan",loserTargetDrawPosition:t});let l=((a==null?void 0:a.mappedMatchUps)||{})[r.structureId].matchUps,{initialRoundNumber:c}=pI({drawPosition:t,matchUps:l});if(c===o){let u=fc({structureId:i.target.structureId,drawPosition:t,tournamentRecord:e,drawDefinition:n,event:s});if(u.error)return u}}function Zoe({positionAssignments:t,tournamentRecord:e,drawDefinition:i,matchUpsMap:n,structure:r,event:a}){let{matchUps:s}=wn({drawDefinition:i,matchUpsMap:n,structure:r,event:a});s.forEach(o=>{let l=t.filter(({drawPosition:c})=>{var u;return(u=o.drawPositions)==null?void 0:u.includes(c)}).filter(c=>c.bye).length;o.winningSide||(Object.assign(o,{matchUpStatus:l?mn:Vr}),Ji({tournamentId:e==null?void 0:e.tournamentId,context:"modifyRoundRobinMatchUpsStatus",eventId:a==null?void 0:a.eventId,drawDefinition:i,matchUp:o}))})}function lC(t){let{inContextDrawMatchUps:e,participantId:i,drawPosition:n}=t,{tournamentRecord:r,drawDefinition:a,structureId:s,matchUpsMap:o,event:l}=t,{structure:c}=hi({drawDefinition:a,structureId:s}),u=(Ma({drawDefinition:a,structure:c}).positionAssignments||[]).find(p=>i&&p.participantId===i||n&&p.drawPosition===n);if(u&&i&&!n&&(n=u==null?void 0:u.drawPosition),!n)return{error:KT};i||(i=u==null?void 0:u.participantId);let{activeDrawPositions:d}=oC({drawDefinition:a,structureId:s});return d.includes(n)?{error:ex}:(e||({matchUps:e}=ua({inContext:!0,drawDefinition:a,matchUpsMap:o})),jV({inContextDrawMatchUps:e,tournamentRecord:r,drawDefinition:a,structureId:s,drawPosition:n,matchUpsMap:o,event:l}).drawPositionCleared?(pg({tournamentId:r==null?void 0:r.tournamentId,drawDefinition:a,structure:c,event:l}),{...de,participantId:i}):{error:Ere})}function jV({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,drawPosition:n,matchUpsMap:r,structureId:a,event:s}){var v,y;let{structure:o}=hi({drawDefinition:i,structureId:a});if(!o)return{error:gr};let l=Ma({drawDefinition:i,structure:o}).positionAssignments||[],c=l.some(b=>{if(b.drawPosition===n)return delete b.participantId,delete b.qualifier,delete b.bye,!0});if(o.structureType===So)return Zoe({positionAssignments:l,tournamentRecord:e,drawDefinition:i,matchUpsMap:r,structure:o}),{drawPositionCleared:c,...de};let u={isCollectionMatchUp:!1},{matchUps:d}=wn({drawDefinition:i,matchUpFilters:u,matchUpsMap:r,structure:o,event:s}),{roundProfile:p,roundMatchUps:h}=fo({matchUps:d}),f=(v=p&&Object.keys(p))==null?void 0:v.map(b=>ui(b)),m=n,g=(y=f==null?void 0:f.map(b=>{var C,M,_,A;let I=(M=(C=p==null?void 0:p[b])==null?void 0:C.pairedDrawPositions)==null?void 0:M.find(N=>N.includes(m)),T=I==null?void 0:I.find(N=>N!==m),w=l.find(N=>N.drawPosition===T),S=p==null?void 0:p[b+1],U=w==null?void 0:w.bye,P=(_=S==null?void 0:S.pairedDrawPositions)==null?void 0:_.find(N=>N.includes(T)),E=U&&P&&S&&((A=S.drawPositions)==null?void 0:A.includes(T)),R=I&&{pairedDrawPositionByeAdvancedPair:!E&&P,pairedDrawPosition:T,targetDrawPosition:m,relevantPair:I,roundNumber:b};return E&&(m=T),R}).filter(b=>b==null?void 0:b.targetDrawPosition))==null?void 0:y.reduce((b,I)=>{let{roundNumber:T,relevantPair:w,targetDrawPosition:S,pairedDrawPosition:U,pairedDrawPositionByeAdvancedPair:P}=I,E={roundNumber:T,targetDrawPosition:S,relevantPair:w},R=P&&{roundNumber:T+1,targetDrawPosition:U,relevantPair:P,subsequentRoundRemoval:!0},C=[E,R].filter(Boolean);return b.concat(...C)},[]);return g==null||g.forEach(({roundNumber:b,targetDrawPosition:I,relevantPair:T})=>{let w=h==null?void 0:h[b].find(S=>{var U;return ho((U=S.drawPositions)==null?void 0:U.filter(Boolean),T.filter(Boolean))});w&&(s_e({inContextDrawMatchUps:t,targetDrawPosition:I,tournamentRecord:e,drawDefinition:i,structureId:a,roundNumber:b,matchUpsMap:r}),Xoe({inContextDrawMatchUps:t,positionAssignments:l,tournamentRecord:e,drawDefinition:i,targetMatchUp:w,drawPosition:n,matchUpsMap:r,structure:o,event:s}))}),{tasks:g,drawPositionCleared:c,positionAssignments:l}}function s_e({inContextDrawMatchUps:t,targetDrawPosition:e,tournamentRecord:i,drawDefinition:n,matchUpsMap:r,roundNumber:a,structureId:s}){let{structure:o}=hi({drawDefinition:n,structureId:s});if(!o)return{error:gr};if(o.structureType===So)return;r=r||Ts({drawDefinition:n});let l=((r==null?void 0:r.mappedMatchUps)||{})[s].matchUps,{initialRoundNumber:c}=pI({drawPosition:e,matchUps:l}),u=l==null?void 0:l.filter(p=>{var h;return p.roundNumber>=a&&p.roundNumber!==c&&((h=p.drawPositions)==null?void 0:h.includes(e))}),d=jn({drawDefinition:n,structureId:s}).positionAssignments??[];return u==null||u.forEach(p=>Xoe({drawPosition:e,targetMatchUp:p,inContextDrawMatchUps:t,positionAssignments:d,tournamentRecord:i,drawDefinition:n,matchUpsMap:r,structure:o})),{...de}}function Xoe({inContextDrawMatchUps:t,positionAssignments:e,tournamentRecord:i,drawDefinition:n,targetMatchUp:r,drawPosition:a,matchUpsMap:s,structure:o,event:l}){var S,U,P,E,R;let c="removeDrawPosition",u=(S=r.drawPositions)==null?void 0:S.slice(),d=r.matchUpStatus,p=r.winningSide;s=s??Ts({drawDefinition:n});let h=s.mappedMatchUps[o.structureId].matchUps,{initialRoundNumber:f}=pI({drawPosition:a,matchUps:h});if(r.roundNumber&&f&&r.roundNumber>f){let C=(r.drawPositions??[]).map(M=>M===a?void 0:M);r.drawPositions=C}if(r.matchUpType===Zn){let C=(((U=t==null?void 0:t.find(M=>M.matchUpId===r.matchUpId))==null?void 0:U.sides)??[]).reduce((M,_,A)=>_.drawPosition===a?A:M,void 0);C!==void 0&&((E=(P=r.sides)==null?void 0:P[C])!=null&&E.lineUp)&&((R=r.sides)==null||delete R[C].lineUp,Ji({tournamentId:i==null?void 0:i.tournamentId,context:`${c}-TEAM`,eventId:l==null?void 0:l.eventId,matchUp:r,drawDefinition:n}))}let m=mo({matchUpId:r.matchUpId,inContextDrawMatchUps:t,drawDefinition:n}),{targetLinks:{winnerTargetLink:g},targetMatchUps:{loserMatchUp:v,winnerMatchUp:y,loserMatchUpDrawPositionIndex:b}}=m,I=e.filter(({drawPosition:C})=>{var M;return(M=r.drawPositions)==null?void 0:M.includes(C)}).filter(C=>C.bye).length,T=I&&mn||r.matchUpStatus&&[Yi,cn].includes(r.matchUpStatus)&&r.matcHUpStatus||Vr;r.matchUpStatus=T,r.matchUpStatus&&[cn,Yi].includes(r.matchUpStatus)&&(r.winningSide=void 0);let w=u==null?void 0:u.find(C=>{var M;return!((M=r.drawPositions)!=null&&M.includes(C))});if(u!=null&&u.includes(a)&&d===r.matchUpStatus&&p===r.winningSide||(w&&Xl({method:c,color:"brightyellow",removedDrawPosition:w}),Ji({tournamentId:i==null?void 0:i.tournamentId,context:`${c}-${a}`,eventId:l==null?void 0:l.eventId,matchUp:r,drawDefinition:n})),v&&v.structureId!==m.matchUp.structureId&&!I){let{drawPositions:C,roundNumber:M}=v;if(M===1){let _=C[b];jV({structureId:v.structureId,drawPosition:_,inContextDrawMatchUps:t,tournamentRecord:i,drawDefinition:n,matchUpsMap:s})}else{let _=Math.min(...C.filter(Boolean)),A=o_e({loserMatchUpDrawPosition:_,inContextDrawMatchUps:t,tournamentRecord:i,drawDefinition:n,loserMatchUp:v,matchUpsMap:s,event:l});if(A.error)return he({result:A,stack:c});let N=((s==null?void 0:s.mappedMatchUps)||{})[v.structureId].matchUps,{initialRoundNumber:k}=pI({drawPosition:_,matchUps:N});k===1&&(Xl({method:c,color:"brightyellow",loserMatchUpDrawPosition:_}),jV({structureId:v.structureId,drawPosition:_,inContextDrawMatchUps:t,tournamentRecord:i,drawDefinition:n,matchUpsMap:s}))}}return y&&y.structureId!==m.matchUp.structureId&&g.target.feedProfile,{...de}}function o_e({loserMatchUpDrawPosition:t,inContextDrawMatchUps:e,tournamentRecord:i,drawDefinition:n,loserMatchUp:r,matchUpsMap:a,event:s}){var c;let{structure:o}=hi({structureId:r.structureId,drawDefinition:n}),{positionAssignments:l}=jn({structure:o});if((c=l==null?void 0:l.find(u=>u.drawPosition===t))!=null&&c.bye){let u=lC({drawPosition:t,structureId:r.structureId,inContextDrawMatchUps:e,tournamentRecord:i,drawDefinition:n,matchUpsMap:a,event:s});if(u.error)return u}return{...de}}function jy({drawDefinition:t,stages:e}){if(!t)return{error:Gt};let i=((t==null?void 0:t.structures)??[]).filter(r=>!(e!=null&&e.length)||r.stage&&e.includes(r.stage)),n=Ei(i.map(r=>{let{positionAssignments:a}=jn({structure:r});return a?a.map(Vi):[]}).flat().filter(Boolean));return{...de,assignedParticipantIds:n}}function Dd(t){let e=((t==null?void 0:t.entries)??[]).filter(Boolean).reduce((n,r)=>{let{entryStage:a,entryStatus:s}=r,o=`_${a||Ft}${s||""}`;return n[o]||(n[o]=[]),n[o].push(r),n},{}),i=n=>isNaN(n)?1/0:n;return Object.keys(e).map(n=>e[n].sort((r,a)=>i(r.entryPosition)-i(a.entryPosition)).map((r,a)=>{let s=a+1;return{...r,entryPosition:s}})).flat()}function Dv(t){return[$y,eu].includes(t)}function YA({autoEntryPositions:t=!0,ignoreAssignment:e,tournamentRecord:i,drawDefinition:n,participantIds:r,entryStatus:a,entryStage:s,extension:o,eventSync:l,drawId:c,stage:u,event:d}){var P,E,R,C,M,_,A,N,k,O,$,F;if(!r||!Array.isArray(r))return{error:Md,method:"modifyEntriesStatus",participantIds:r};if(!n&&!d)return{error:Jn};if(a&&!Uoe.includes(a))return{error:EV};if(s&&!bx.includes(s))return{error:Ay};let p="modifyEntriesStatus",h=[];if(!a&&!o)return he({result:{error:ai},info:"Missing entryStatus",stack:p});if(o&&!Cp({extension:o,requiredAttributes:["name"]}))return he({result:{error:Re},info:"Invalid extension",context:{extension:o},stack:p});let f=[];(P=d==null?void 0:d.drawDefinitions)==null||P.forEach(V=>{let j=jy({stages:u&&[u],drawDefinition:V}).assignedParticipantIds??[];f.push(...j)});let m=(i==null?void 0:i.participants)??[];if(!r.every(V=>{var B;let j=(B=lg({tournamentParticipants:m,participantId:V}))==null?void 0:B.participantType;return!(j&&[Ni,Lo].includes(j)&&Dv(a))&&!(a&&(d!=null&&d.eventType)&&j===ji&&[Hc,Al].includes(d.eventType)&&[_u,...BN].includes(a))}))return{error:EV};let g=d&&_r({event:d}).flightProfile,v=(E=g==null?void 0:g.flights)==null?void 0:E.find(V=>V.drawId===c),y=V=>{let j=(V||[]).filter(z=>!u||!z.entryStage||u===z.entryStage).filter(({participantId:z})=>r.includes(z)),B=z=>a&&f.includes(z.participantId)&&!(BN.includes(z.entryStatus)&&BN.includes(a));return j.every(z=>B(z)&&!e?!1:(a&&(z.entryStatus=a,delete z.entryPosition),s&&(z.entryStage=s,delete z.entryPosition),o&&(o.value?dn({element:z,extension:o}):oo({element:z,name:o.name})),!0))?{...de}:{error:JT}},b=({flight:V,drawDefinition:j})=>{d&&(d.entries=Dd({entries:d.entries??[]})),V&&(V.drawEntries=Dd({entries:V.drawEntries})),j&&(j.entries=Dd({entries:j.entries}))},I=V=>{let{flight:j,drawDefinition:B}=V,z="updateDrawEntries";if(j){let W=y(j.drawEntries);if(W.error)return he({result:W,stack:z})}if(B){let W=y(B.entries);if(W.error)return he({result:W,stack:z});h.includes(B.drawId)||h.push(B.drawId)}return{...de}},T=((R=d==null?void 0:d.entries)==null?void 0:R.find(({entryPosition:V})=>V))??(((C=v==null?void 0:v.drawEntries)==null?void 0:C.find(({entryPosition:V})=>V))||((M=n==null?void 0:n.entries)==null?void 0:M.find(({entryPosition:V})=>V)));if(t&&!T&&b({flight:v,drawDefinition:n}),v||n){let V=I({flight:v,drawDefinition:n});if(V.error)return he({result:V,stack:p})}let w=((_=d==null?void 0:d.drawDefinitions)==null?void 0:_.map(({drawId:V})=>V))??[],S=((A=g==null?void 0:g.flights)==null?void 0:A.filter(V=>!w.includes(V.drawId)))||[];for(let V of S){let j=V&&I({flight:V});if(j!=null&&j.error)return he({result:j,stack:p})}let U=((N=g==null?void 0:g.flights)==null?void 0:N.length)===1&&(((k=d==null?void 0:d.drawDefinitions)==null?void 0:k.length)??0)<=((O=g==null?void 0:g.flights)==null?void 0:O.length);if(!v&&!n&&a&&Toe.includes(a))return{error:cae};if(!v&&!n||a===Fh||l&&U){let V=y(d==null?void 0:d.entries);if(V!=null&&V.error)return he({result:V,stack:p});let j;if(a===Fh&&(($=g==null?void 0:g.flights)==null||$.every(B=>{let z=y(B.drawEntries);return z.error?(j=z.error,!1):(B.drawEntries=B.drawEntries.filter(({participantId:W})=>!r.includes(W)),!0)}),(F=d==null?void 0:d.drawDefinitions)==null||F.every(B=>{var W;let z=y(B.entries);return z.error?(j=z.error,!1):(B.entries=(W=B.entries)==null?void 0:W.filter(({participantId:Z})=>!r.includes(Z)),!0)})),j)return he({result:{error:j},stack:p})}t&&b({flight:v,drawDefinition:n});for(let V of(d==null?void 0:d.drawDefinitions)??[])h.length&&!h.includes(V.drawId)||Hn({tournamentId:i.tournamentId,eventId:d==null?void 0:d.eventId,drawDefinition:V});return{...de}}function Th({requireTimeStamp:t,scaleAttributes:e,participant:i}){var n,r;if(!i)return{error:GI};if(!Xi(e))return{error:Re};if(i.timeItems||(i.timeItems=[]),Array.isArray(i.timeItems)){let{accessor:a,scaleType:s,eventType:o,scaleName:l}=e,c=[ty,s,o,l].join("."),u=i.timeItems.filter(d=>(d==null?void 0:d.itemType)===c).filter(d=>!t||(d==null?void 0:d.itemDate)).sort((d,p)=>(d.createdAt?new Date(d.createdAt).getTime():0)-(p.createdAt?new Date(p.createdAt).getTime():0)).pop();if(u){let[d,p,h,f]=((n=u.itemType)==null?void 0:n.split("."))??[];if(d!==ty)return{error:aI};let m=((r=a&&Ob({element:u.itemValue,accessor:a}))==null?void 0:r.value)||u.itemValue,g={eventType:h,scaleDate:u.itemDate,scaleValue:m,scaleName:f,scaleType:p};return{...de,scaleItem:g}}}return{...de,scaleItem:void 0}}function l_e({publishedSeeding:t,usePublishState:e,withSeeding:i,participant:n,event:r}){var u,d,p;let a={},s=h=>[ty,wh,r.eventType,h].join("."),o=Object.assign({},...(n.timeItems||[]).filter(({itemType:h})=>h.split(".")[1]===wh).map(({itemType:h,itemValue:f})=>({[h]:f}))),l=((t==null?void 0:t.stageSeedingScaleNames)&&Object.values(t==null?void 0:t.stageSeedingScaleNames)||Array.isArray(t==null?void 0:t.seedingScaleNames)&&t.seedingScaleNames||[]).map(s),c=Nr(Object.keys(o),l);if((!e||!Object.keys(o).length&&!((u=t==null?void 0:t.drawIds)!=null&&u.length)||c.length)&&c.length){if(t!=null&&t.stageSeedingScaleNames){let h=Object.keys(t.stageSeedingScaleNames).map(m=>{let g=s(t.stageSeedingScaleNames[m]),v=o[g];return[m,v]}).filter(m=>m[1]).map(m=>({[m[0]]:{seedValue:m[1]}})),f=Object.assign({},...h);a.seedAssignments=f}else if(c){let h=c.map(f=>o[f]);a.seedValue=h.pop()}}else if(!e&&typeof i=="object"){let h=Object.keys(i).map(m=>{let g=s(i[m]),v=o[g];return[m,v]}).filter(m=>m[1]).map(m=>({[m[0]]:{seedValue:m[1]}})),f=Object.assign({},...h);a.seedAssignments=f}else{let{categoryName:h,ageCategoryCode:f}=r.category||{},m=[f,r.eventId,h].filter(Boolean),g;for(let v of m){let y={eventType:r.eventType,scaleType:wh,scaleName:v},b=Th({scaleAttributes:y,participant:n});if(b.scaleItem){g=b.scaleItem;break}}if(g&&(!e||t!=null&&t.published&&!((p=(d=t==null?void 0:t.published)==null?void 0:d.drawIds)!=null&&p.length))){let v=g.scaleValue;a.seedValue=v}}return a}function c_e({convertExtensions:t,seedAssignments:e,participant:i,withSeeding:n,seedValue:r,eventId:a,ranking:s,entry:o}){let{entryStatus:l,entryStage:c,entryPosition:u,extensions:d}=o,p=d!=null&&d.length&&t?Object.assign({},...Jz(d??[])):{},h=Object.assign(p,{entryPosition:u,entryStatus:l,entryStage:c,ranking:s,eventId:a});i.events[a]=Kt(h,!1,!1,!0),n&&(e&&(i.events[a].seedAssignments=e),r&&(i.events[a].seedValue=r))}function Joe(t){let{participantMap:e,participantId:i,matchUpStatus:n,roundPosition:r,structureId:a,matchUpType:s,roundNumber:o,matchUpId:l,potential:c,schedule:u,drawId:d,score:p}=t;!u||!Object.keys(u).length||n===mn||e[i].scheduleItems.push({...u,scheduledDate:Ri(u==null?void 0:u.scheduledDate),scheduledTime:rr(u==null?void 0:u.scheduledTime),checkScoreHasValue:ga({score:p}),matchUpStatus:n,roundPosition:r,structureId:a,matchUpType:s,roundNumber:o,matchUpId:l,potential:c,drawId:d})}function cC(t){var a,s,o;let e=Qt(t,[{[ba]:!0}]);if(e.error)return e;let{tournamentRecord:i,status:n=hc}=t,r=`${Gg}.${Hg}`;return _t((o=(s=(a=jx({tournamentRecord:i,itemType:r}))==null?void 0:a.timeItem)==null?void 0:s.itemValue)==null?void 0:o[n],!1,!0)}function u_e(t){let{tournamentId:e}=t??{};return!!e}function iu({event:t,status:e=hc}){var n,r,a;let i=`${Gg}.${Hg}`;return(a=(r=(n=WP({itemType:i,event:t}))==null?void 0:n.timeItem)==null?void 0:r.itemValue)==null?void 0:a[e]}function a3({drawDetails:t,drawId:e}){var i,n;return(n=(i=t==null?void 0:t[e])==null?void 0:i.publishingDetail)==null?void 0:n.published}function aw(t){var d,p,h,f,m,g,v,y,b;let{tournamentRecord:e,drawDefinition:i,eventIds:n,eventId:r,drawIds:a,drawId:s,event:o}=t??{};if(e&&!u_e(e))return{error:Re};if(r&&!o)return{error:Gc};if(Array.isArray(n)&&(n!=null&&n.length)){let I={};for(let T of n){if(!nr(T))return{error:Re};let w=(d=jo({tournamentRecord:e,eventId:T}))==null?void 0:d.event;if(!w)return{error:Gc};let S=g$({event:w});I[T]=S}return{...de,publishState:I}}if(o){let I=g$({event:o}),T={};if(s)return i?{publishState:{status:{published:!!((p=I.status.publishedDrawIds)!=null&&p.includes(s)),drawDetail:(h=I.status.drawDetails)==null?void 0:h[s]},...de}}:{error:tc};if(Array.isArray(a)&&(a!=null&&a.length)){let w=((f=o.drawDefinitions)==null?void 0:f.map(lE))??[];for(let S of a){if(!nr(S))return{error:Re};if(!w.includes(S))return{error:tc};T[S]={status:{published:!!I.status.publishedDrawIds.includes(S),drawDetail:(m=I.status.drawDetails)==null?void 0:m[S]}}}}else T=I;return{...de,publishState:T}}let l=[],c=!1,u={};for(let I of(e==null?void 0:e.events)??[]){let T=g$({event:I});u[I.eventId]=T,T.status.published&&(l.push(I.eventId),c=!0);for(let{drawId:w}of I.drawDefinitions??[]){let S=(v=(g=T.status)==null?void 0:g.publishedDrawIds)==null?void 0:v.includes(w);S&&(u[w]={status:{published:S}})}}if(e){let I=cC({tournamentRecord:e});u.tournament=I??{},((y=I==null?void 0:I.orderOfPlay)!=null&&y.published||(b=I==null?void 0:I.participants)!=null&&b.published)&&(c=!0),u.tournament.status={published:c,publishedEventIds:l}}return{...de,publishState:u}}function g$({event:t}){var o;let e=iu({event:t});if(!e)return{status:{published:!1}};let i={published:void 0,seedingScaleNames:[],drawIds:[]};e.seeding&&Object.assign(i,e.seeding);let n=e.drawDetails??{};for(let l of((o=t.drawDefinitions)==null?void 0:o.map(lE))||[])n[l]||(n[l]={publishingDetail:{published:!1}});let r=n&&Object.keys(n).length&&Object.keys(n).filter(l=>a3({drawDetails:n,drawId:l})),a=r!=null&&r.length?r:e.drawIds??[];if(a!=null&&a.length&&!(r!=null&&r.length))for(let l of a)n[l]={publishingDetail:{published:!0}};let s=(a==null?void 0:a.length)>0;return{status:{publishedDrawIds:a,publishedSeeding:i,drawDetails:n,published:s}}}function Jx(t,e){return(t||"").localeCompare(e||"")}function d_e({finishingPositionRange:t={},participantMap:e,finishingRound:i,participantWon:n,matchUpStatus:r,participantId:a,stageSequence:s,roundNumber:o,structureId:l,matchUpId:c,drawId:u,stage:d}){let p=e[a],h=y=>Math.abs(y[0]-y[1]);p.structureParticipation[l]||(p.structureParticipation[l]={rankingStage:d,walkoverWinCount:0,defaultWinCount:0,stageSequence:s,winCount:0,structureId:l,drawId:u});let f=p.structureParticipation[l],{winner:m,loser:g}=t,v=n?m:g;n&&(f.winCount+=1,r===cn&&(f.walkoverWinCount+=1),r===Yi&&(f.defaultWinCount+=1)),v&&(!f.finishingPositionRange||h(v)<h(f.finishingPositionRange))&&(f.finishingPositionRange=v),i&&((!f.finishingRound||i<f.finishingRound)&&(f.finishingMatchUpId=c,f.finishingRound=i,f.roundNumber=o),i===1&&(f.participantWon=n))}function KK(t){var A,N,k,O,$,F,V,j,B,z;let{withScheduleItems:e,scheduleAnalysis:i,withTeamMatchUps:n,participantMap:r,withOpponents:a,withMatchUps:s,withEvents:o,withDraws:l,finishingPositionRange:c,finishingRound:u,matchUpStatus:d,stageSequence:p,roundNumber:h,structureId:f,score:m,stage:g,withRankingProfile:v,tieWinningSide:y,roundPosition:b,matchUpTieId:I,matchUpSides:T,collectionId:w,matchUpType:S,winningSide:U,matchUpId:P,schedule:E,eventId:R,drawId:C,sides:M}=t,_=a&&(M==null?void 0:M.length)===2&&Object.assign({},...M.map(({sideNumber:W},Z)=>{let K=M[1-Z].participantId;return W&&{[W]:K}}).filter(Boolean));for(let W of M){let{participantId:Z,sideNumber:K,bye:Q}=W;if(Q)continue;let J=U===K,se=oe=>{var me,be;let te=(me=r[oe])==null?void 0:me.participant,le=te==null?void 0:te.participantType,ne=[{participantId:oe,participantType:le}];if(le!==Lo)for(let Se of(te==null?void 0:te.individualParticipantIds)||[]){let we=(be=r[Se])==null?void 0:be.participant;ne.push({participantType:we==null?void 0:we.participantType,participantId:Se})}return ne},ie=(oe,te)=>{if(s){if(r[oe].matchUps[P]={participantWon:J,matchUpType:S,structureId:f,sideNumber:K,matchUpId:P,eventId:R,drawId:C,stage:g},a){let le=se(te);r[oe].matchUps[P].opponentParticipantInfo=le}w&&(r[oe].matchUps[P].collectionId=w)}a&&te&&(r[oe].opponents[te]={participantId:te,matchUpId:P,eventId:R,drawId:C}),v&&d_e({finishingPositionRange:c,participantMap:r,participantWon:J,finishingRound:u,matchUpStatus:d,participantId:oe,stageSequence:p,roundNumber:h,structureId:f,matchUpId:P,drawId:C,stage:g}),(i||e)&&Joe({participantMap:r,participantId:oe,matchUpStatus:d,roundPosition:b,matchUpType:S,roundNumber:h,structureId:f,matchUpId:P,schedule:E,drawId:C,score:m})},ce=({participant:oe,partnerParticipantId:te})=>{var ne,me,be;let le=(Se,we)=>{Se&&(Se.partnerParticipantIds||(Se.partnerParticipantIds=[]),Se.partnerParticipantIds.includes(we)||Se.partnerParticipantIds.push(we))};l&&le((ne=oe==null?void 0:oe.draws)==null?void 0:ne[C],te),o&&le((me=oe==null?void 0:oe.events)==null?void 0:me[R],te),s&&le((be=oe==null?void 0:oe.matchUps)==null?void 0:be[P],te)};if(Z&&r[Z]){let oe=_==null?void 0:_[K];ie(Z,oe);let te=((A=r[Z])==null?void 0:A.participant.participantType)===Ni,le=((N=r[Z])==null?void 0:N.participant.individualParticipantIds)||[];if(I){if(n){let ne=me=>r[me].matchUps[I]={participantWon:y===K,matchUpId:I,matchUpType:Zn,sideNumber:K};ne(Z),le.forEach(ne)}if(l&&!r[Z].draws[C]){let ne=(O=(k=T.find(Se=>Se.sideNumber===K))==null?void 0:k.participant)==null?void 0:O.participantId,me=(V=(F=($=r[ne])==null?void 0:$.draws)==null?void 0:F[C])==null?void 0:V.entryStatus,be=Se=>r[Se].draws[C]={entryStatus:me,eventId:R,drawId:C};be(Z),le.forEach(be)}}if(te&&(le.forEach(ne=>r[ne]&&ie(ne,oe)),le.forEach((ne,me)=>{let be=le[1-me],Se=r[ne];Se&&ce({participant:Se,partnerParticipantId:be})}),o&&T)){let ne=(B=(j=T.find(me=>me.sideNumber===K))==null?void 0:j.participant)==null?void 0:B.participantId;if(ne){let me=(z=r[ne])==null?void 0:z.events[R];me?(r[Z].events[R]={...me},le.forEach(be=>r[be].events[R]={...me})):console.log("Missing teamEntry",{eventId:R,teamParticipantId:ne})}}if(U){let ne=me=>{J?(r[me].counters[S].wins+=1,r[me].counters.wins+=1,d===cn&&(r[me].counters[S].walkoverWins+=1,r[me].counters.walkoverWins+=1),d===Yi&&(r[me].counters[S].defaultWins+=1,r[me].counters.defaultWins+=1)):(r[me].counters[S].losses+=1,r[me].counters.losses+=1,d===cn&&(r[me].counters[S].walkovers+=1,r[me].counters.walkovers+=1),d===Yi&&(r[me].counters[S].defaults+=1,r[me].counters.defaults+=1))};ne(Z),le.forEach(ne)}}}}function p_e(t){var A,N,k,O,$,F,V;let{participantFilters:e,convertExtensions:i,policyDefinitions:n,tournamentRecord:r,usePublishState:a,contextFilters:s,matchUpFilters:o,participantMap:l,contextProfile:c,withPotentialMatchUps:u,withRankingProfile:d,withScheduleItems:p,scheduleAnalysis:h,withTeamMatchUps:f,withStatistics:m,withOpponents:g,withMatchUps:v,withSeeding:y,withEvents:b,withDraws:I}=t,T=e==null?void 0:e.participantIds,w=j=>{var z,W;let B=[j];return(W=(z=l[j])==null?void 0:z.participant.individualParticipantIds)==null||W.forEach(Z=>B.push(Z)),B.some(Z=>!(T!=null&&T.length)||T.includes(Z))?B:[]},S={withMatchUps:v||d,withEvents:b||d,withDraws:I||d,withPotentialMatchUps:u,withRankingProfile:d,withScheduleItems:p,scheduleAnalysis:h,withTeamMatchUps:f,withStatistics:m,participantMap:l,withOpponents:g,withSeeding:y},U=[],P={},E=[],R={},C={},M={},_=({eventType:j,scaleNames:B,participantId:z})=>{var W,Z,K,Q,J;return(J=(Q=(K=(Z=(W=l[z])==null?void 0:W.participant)==null?void 0:Z.rankings)==null?void 0:K[j])==null?void 0:Q.find(se=>B.includes(se.scaleName)))==null?void 0:J.scaleValue};for(let j of(r==null?void 0:r.events)||[]){if(e!=null&&e.eventIds&&!e.eventIds.includes(j.eventId))continue;let{drawDefinitions:B=[],extensions:z=[],eventType:W,eventName:Z,category:K,entries:Q,eventId:J,gender:se}=j,{flightProfile:ie}=_r({event:j}),ce=(ie==null?void 0:ie.flights)??[],oe=aw({event:j}).publishState;oe&&(R[J]=oe);let te=(A=oe==null?void 0:oe.status)==null?void 0:A.publishedSeeding;if(b||y||d){let ne=i?Object.assign({},...Jz(z??[])):{};C[J]={...ne,eventName:Z,eventType:W,category:K,eventId:J,gender:se};let me=[K==null?void 0:K.categoryName,K==null?void 0:K.ageCategoryCode].filter(Boolean);for(let be of Q){let{participantId:Se}=be;if(!Se||!l[Se])continue;let we=_({eventType:W,scaleNames:me,participantId:Se}),ze,Qe;if(y){let yt=l[Se].participant;({seedAssignments:ze,seedValue:Qe}=l_e({publishedSeeding:te,usePublishState:a,withSeeding:y,participant:yt,event:j}))}let ke=yt=>{var Ct,Nt;if((Nt=(Ct=l[yt])==null?void 0:Ct.events)!=null&&Nt[J])return;let lt=l[yt];c_e({convertExtensions:i,seedAssignments:ze,participant:lt,withSeeding:y,seedValue:Qe,eventId:J,ranking:we,entry:be})};ke(Se),(l[Se].participant.individualParticipantIds||[]).forEach(ke)}}let le=(N=R==null?void 0:R[J])==null?void 0:N.publishedSeeding;if(I||d||y){let ne=be=>be?Object.assign({},...be.map(({participantId:Se,seedValue:we,seedNumber:ze})=>({[Se]:{seedValue:we,seedNumber:ze}}))):void 0,me=Ei([...B.map(lE),...ce.map(lE)]);for(let be of me){let Se=B.find(Oe=>Oe.drawId===be),we=[K==null?void 0:K.categoryName,K==null?void 0:K.ageCategoryCode].filter(Boolean),{structures:ze=[],drawOrder:Qe,drawName:ke,drawType:yt}=Se??{},lt=ce==null?void 0:ce.find(Oe=>Oe.drawId===be),Ct=(Se==null?void 0:Se.entries)||(lt==null?void 0:lt.drawEntries),Nt=lt==null?void 0:lt.flightNumber,Ce=((Se==null?void 0:Se.structures)||[]).sort((Oe,Ee)=>ZI(Oe,Ee)).map(({structureId:Oe,structures:Ee})=>[Oe,...(Ee||[]).map(({structureId:Xe})=>Xe)]).flat(1/0),Ge,$e,at,ct,Vt=0,Me=ze.filter(({stage:Oe,stageSequence:Ee})=>Oe===Ft&&Ee===1||Oe===ni).flatMap(Oe=>{let{positionAssignments:Ee}=jn({structure:Oe}),{seedAssignments:Xe,stageSequence:Et,stage:Fe}=Oe;return Fe===Ft?(Vt=(Ee==null?void 0:Ee.length)??0,at=Ee,ct=Xe):Et===1&&(Ge=Ee,$e=Xe),Ee}).map(({participantId:Oe})=>Oe).filter(Boolean),De=ne(ct),Je=ne($e),St=Se?Ct.filter(({participantId:Oe})=>Me.includes(Oe)):Ct,bt=!a||(le==null?void 0:le.published)&&(((k=le==null?void 0:le.drawIds)==null?void 0:k.length)===0||((O=le==null?void 0:le.drawIds)==null?void 0:O.includes(be)));for(let Oe of St){if(!l[Oe.participantId])continue;let{entryStatus:Ee,entryStage:Xe,entryPosition:Et,participantId:Fe}=Oe,ht=_({participantId:Fe,scaleNames:we,eventType:W}),ti=Ke=>{var Ui,Cr,nn,tr,lr;if(!l[Ke]||(Ui=l[Ke].draws)!=null&&Ui[be])return;let zt=y&&bt,mt=zt?{}:void 0,Tt=zt?((Cr=De==null?void 0:De[Fe])==null?void 0:Cr.seedValue)||((nn=De==null?void 0:De[Fe])==null?void 0:nn.seedNumber):void 0,Ut=Tt?De==null?void 0:De[Fe]:void 0,zi=zt?((tr=Je==null?void 0:Je[Fe])==null?void 0:tr.seedValue)||((lr=Je==null?void 0:Je[Fe])==null?void 0:lr.seedNumber):void 0,gi=zi?Je==null?void 0:Je[Fe]:void 0;mt&&Tt&&(mt[Ft]=Ut),mt&&zi&&(mt[ni]=gi);let Dt=Tt||zi;Dt&&(l[Ke].participant.seedings[W]||(l[Ke].participant.seedings[W]=[]),Ut&&l[Ke].participant.seedings[W].push({...Ut,scaleName:be}),gi&&l[Ke].participant.seedings[W].push({...gi,scaleName:be}),mt&&(l[Ke].events[J].seedAssignments||(l[Ke].events[J].seedAssignments={}),Object.keys(mt).forEach(Xa=>l[Ke].events[J].seedAssignments[Xa]=mt[Xa]))),(I||d)&&(l[Ke].draws[be]=Kt({seedAssignments:mt,entryPosition:Et,entryStatus:Ee,entryStage:Xe,seedValue:Dt,eventId:J,ranking:ht,drawId:be},!1,!1,!0))};[eu,$y].includes(Ee)||(ti(Fe),($=l[Fe].participant.individualParticipantIds||[])==null||$.forEach(ti))}let Ie=((Se==null?void 0:Se.structures)??[]).reduce((Oe,Ee)=>(Oe.includes(Ee.stage)||Oe.push(Ee.stage),Oe),[]),Ue=((Se==null?void 0:Se.links)??[]).length;M[be]={qualifyingPositionAssignments:Ge,qualifyingSeedAssignments:$e,mainPositionAssignments:at,qualifyingSeedingMap:Je,mainSeedAssignments:ct,orderedStructureIds:Ce,mainSeedingMap:De,flightNumber:Nt,linksCount:Ue,drawOrder:Qe,drawName:ke,drawType:yt,drawSize:Vt,drawId:be,stages:Ie}}}if(d||h||f||m||g||v||I){let ne=!!h||u,me=((F=Jh({afterRecoveryTimes:!!h,policyDefinitions:n,tournamentRecord:r,inContext:!0,participantMap:l,contextFilters:s,matchUpFilters:o,contextProfile:c,nextMatchUps:ne,event:j}))==null?void 0:F.matchUps)??[];for(let be of me){let{finishingPositionRange:Se,potentialParticipants:we,tieMatchUps:ze=[],sides:Qe=[],winningSide:ke,matchUpType:yt,matchUpId:lt,eventId:Ct,drawId:Nt,collectionId:Ce,stageSequence:Ge,finishingRound:$e,matchUpStatus:at,roundPosition:ct,roundNumber:Vt,structureId:Me,schedule:De,score:Je,stage:St}=be;P[lt]=be;let bt={finishingPositionRange:Se,finishingRound:$e,stageSequence:Ge,roundPosition:ct,collectionId:Ce,roundNumber:Vt,structureId:Me,schedule:De,eventId:Ct,drawId:Nt,score:Je,stage:St};KK({...bt,...S,matchUpStatus:at,winningSide:ke,matchUpType:yt,matchUpId:lt,sides:Qe});for(let Ie of ze){let{winningSide:Ue,sides:Oe=[],matchUpId:Ee,matchUpStatus:Xe,matchUpType:Et}=Ie;KK({...bt,...S,winningSide:Ue,tieWinningSide:ke,matchUpTieId:lt,matchUpId:Ee,sides:Oe,matchUpSides:Qe,matchUpStatus:Xe,matchUpType:Et})}Array.isArray(we)&&(ne||h||p)&&((V=we.flat().map(Vi).filter(Boolean))==null||V.forEach(Ie=>{var Ue;(Ue=w(Ie))==null||Ue.forEach(Oe=>{l[Oe]&&(l[Oe].potentialMatchUps[lt]=Kt({tournamentId:r==null?void 0:r.tournamentId,matchUpId:lt,eventId:Ct,drawId:Nt}))}),(h||p)&&Joe({potential:!0,participantMap:l,participantId:Ie,matchUpStatus:at,roundPosition:ct,structureId:Me,matchUpType:yt,roundNumber:Vt,matchUpId:lt,schedule:De,drawId:Nt,score:Je})}))}E.push(...me)}}if(m||d||h){let j=Object.values(l);for(let B of j){let{wins:z,losses:W,[xn]:{wins:Z,losses:K},[Mn]:{wins:Q,losses:J}}=B.counters,se=(ie,ce,oe)=>{let te=ce+oe,le=ce,ne=te&&le/te;B.statistics[ie]={denominator:te,numerator:le,statValue:ne,statCode:ie}};if(m&&(se($N,z,W),se(`${$N}.${xn}`,Z,K),se(`${$N}.${Mn}`,Q,J)),d){let ie=(ce=[])=>Math.abs(ce[0]-ce[1]);for(let ce of Object.keys(B.draws)){let{orderedStructureIds:oe=[],flightNumber:te}=M[ce]||{};if(B.structureParticipation&&oe.length){let le,ne=0,me=oe.map(be=>{let Se=B.structureParticipation[be];if(!Se)return;le||(le=Se==null?void 0:Se.finishingPositionRange),ie(le)>ie(Se==null?void 0:Se.finishingPositionRange)&&(le=Se==null?void 0:Se.finishingPositionRange);let we=Se.stage!==ni;return we&&(ne+=1),Kt({...Se,participationOrder:we?ne:void 0,flightNumber:te})}).filter(Boolean);B.draws[ce]&&(B.draws[ce].finishingPositionRange=le,B.draws[ce].structureParticipation=me)}}}if(h){let ie=Xi(h)?h.scheduledMinutesDifference:0,ce=B.scheduleItems||[],oe=B.potentialMatchUps||{},te=ce.reduce((ne,me)=>{let{scheduledDate:be,scheduledTime:Se}=me;return ne[be]||(ne[be]=[]),Se&&ne[be].push(me),ne},{});Object.values(te).forEach(ne=>ne.sort(Wae));for(let ne of ce){let{typeChangeTimeAfterRecovery:me,timeAfterRecovery:be,scheduledDate:Se,scheduledTime:we}=ne,ze=te[Se],Qe=an(we);for(let ke of ze){if(ke.matchUpId===ne.matchUpId||[cn,Yi].includes(ke.matchUpStatus)&&!ke.checkScoreHasValue)continue;let yt=ne.matchUpType!==ke.matchUpType&&me||be,lt=ne.drawId===ke.drawId,Ct=oe[ne.matchUpId]&&oe[ke.matchUpId],Nt=an(ke.scheduledTime),Ce=Math.abs(Nt-Qe),Ge=Nt>=Qe;if((ie&&!isNaN(ie)?Ce<=ie:Ge&&an(ke.scheduledTime)<an(yt))&&!(Ct&&lt)&&Ge){let $e=[ne.matchUpId,ke.matchUpId].sort(Jx).join("|");B.scheduleConflicts[$e]={priorScheduledMatchUpId:ne.matchUpId,matchUpIdWithConflict:ke.matchUpId}}}}let le=B.participant.participantId;Object.keys(B.scheduleConflicts).length&&U.push(le),l[le].scheduleConflicts=B.scheduleConflicts}}}return{participantIdsWithConflicts:U,eventsPublishStatuses:R,derivedEventInfo:C,derivedDrawInfo:M,mappedMatchUps:P,participantMap:l,matchUps:E}}function uC({participantFilters:t={},tournamentRecord:e,participants:i=[]}){var I;if(!Object.keys(t).length)return i;let{accessorValues:n,drawEntryStatuses:r,positionedParticipants:a,eventEntryStatuses:s,participantRoles:o,participantRoleResponsibilities:l,participantTypes:c,participantIds:u,signInStatus:d,enableOrFiltering:p,eventIds:h,genders:f}=t,m=nh(h)&&((I=e==null?void 0:e.events)==null?void 0:I.filter(T=>h==null?void 0:h.includes(T.eventId)))||(e==null?void 0:e.events)||[],g=r&&h_e({drawEntryStatuses:r,tournamentEvents:m}),v=s&&f_e({eventEntryStatuses:s,tournamentEvents:m}),y=a!==void 0&&[!0,!1].includes(a)&&m.reduce((T,w)=>T.concat(...(w.drawDefinitions||[]).map(S=>ooe({drawDefinition:S}).allPositionedParticipantIds).filter(Boolean)),[]),b=T=>n==null?void 0:n.reduce((w,S)=>{let{accessor:U,value:P}=S,{values:E}=Ob({element:T,accessor:U});return w&&(E==null?void 0:E.includes(P))},!0);if(i=i==null?void 0:i.filter(T=>{var M,_;let w=(_=(M=Qc({element:T,itemType:qP}))==null?void 0:M.timeItem)==null?void 0:_.itemValue,{participantRoleResponsibilities:S,participantType:U,participantRole:P,participantId:E,person:R}=T,C=Array.isArray(f)&&(f==null?void 0:f.length)&&(R==null?void 0:R.sex)&&f.includes(R.sex);return p?f&&C||a&&y.includes(E)||a===!1&&!y.includes(E)||(g==null?void 0:g.includes(E))||(v==null?void 0:v.includes(E))||(u==null?void 0:u.includes(E))||d&&w===d||c&&U&&nh(c)&&c.includes(U)||o&&P&&nh(o)&&o.includes(P)||l&&nh(S)&&nh(l)&&l.find(A=>S==null?void 0:S.includes(A))||(n==null?void 0:n.length)&&nh(n)&&b(T):(!f||C)&&(a===void 0||a&&y.includes(E)||a===!1&&!y.includes(E))&&(!g||g.includes(E))&&(!v||v.includes(E))&&(!u||u.includes(E))&&(!d||w===d)&&(!c||U&&nh(c)&&c.includes(U))&&(!o||P&&nh(o)&&o.includes(P))&&(!l||nh(S)&&nh(l)&&l.find(A=>S==null?void 0:S.includes(A)))&&(!(n!=null&&n.length)||nh(n)&&b(T))}),m.length&&h){let T=m.filter(w=>h.includes(w.eventId)).map(w=>{let S=(w.entries||[]).map(P=>P.participantId);if(Fr(Ep)(w.eventType))return S;let U=((e==null?void 0:e.participants)??[]).filter(P=>S.includes(P.participantId)).map(P=>P.individualParticipantIds).flat(1);return S.concat(...U)}).flat(1);i=i==null?void 0:i.filter(w=>T.includes(w.participantId))}return i}function nh(t){return t&&Array.isArray(t)&&t.length}function h_e({drawEntryStatuses:t,tournamentEvents:e}){let i=({entryStatus:n})=>Array.isArray(t)?t.includes(n):!0;return Ei(e.reduce((n,r)=>{var l,c;let{flightProfile:a}=_r({event:r}),s=((l=a==null?void 0:a.flights)==null?void 0:l.map(({drawEntries:u})=>Array.isArray(u)?u.filter(i).map(Vi):[]).flat())||[],o=((c=r.drawDefinitions)==null?void 0:c.map(({entries:u})=>u?u.filter(i).map(Vi):[]))||[];return n.concat(...s,...o)},[]))}function f_e({eventEntryStatuses:t,tournamentEvents:e}){return Ei(e.reduce((i,n)=>{let r=(n.entries||[]).filter(({entryStatus:a})=>Array.isArray(t)?t.includes(a):!0).map(Vi);return i.concat(...r)},[]))}function vr(t){var Z;let{withIndividualParticipants:e,participantFilters:i={},withPotentialMatchUps:n,withRankingProfile:r,convertExtensions:a,policyDefinitions:s,withScheduleItems:o,tournamentRecord:l,scheduleAnalysis:c,withSignInStatus:u,withTeamMatchUps:d,withScaleValues:p,usePublishState:h,withStatistics:f,contextFilters:m,matchUpFilters:g,contextProfile:v,withOpponents:y,withMatchUps:b,internalUse:I,withSeeding:T,withEvents:w,withDraws:S,withISO2:U,withIOC:P}=t;if(!l)return{error:ut};(b||r)&&rd({tournamentRecord:l});let E=woe({convertExtensions:a,tournamentRecord:l,withSignInStatus:u,withScaleValues:p,internalUse:I,withISO2:U,withIOC:P}),{participantMap:R}=E,C=p_e({withMatchUps:b??r,withEvents:w??r,withDraws:S??r,withPotentialMatchUps:n,participantFilters:i,withRankingProfile:r,convertExtensions:a,withScheduleItems:o,policyDefinitions:s,tournamentRecord:l,scheduleAnalysis:c,withTeamMatchUps:d,usePublishState:h,withStatistics:f,contextFilters:m,matchUpFilters:g,participantMap:R,withOpponents:y,contextProfile:v,withSeeding:T}),{participantIdsWithConflicts:M,eventsPublishStatuses:_,derivedEventInfo:A,derivedDrawInfo:N,mappedMatchUps:k}=C,O=C.matchUps;R=C.participantMap;let $=c??n,F=({potentialMatchUps:K,scheduleConflicts:Q,scheduleItems:J,participant:se,statistics:ie,opponents:ce,matchUps:oe,events:te,draws:le})=>{let ne=Object.values(le),me=Object.values(ce);return y&&(ne==null||ne.forEach(be=>{be.opponents=me.filter(Se=>Se.drawId===be.drawId)})),Kt({...se,scheduleConflicts:c?Object.values(Q):void 0,draws:S||r?ne:void 0,events:w||r?Object.values(te):void 0,matchUps:b||r?Object.values(oe):void 0,opponents:y?me:void 0,potentialMatchUps:$?Object.values(K):void 0,statistics:f?Object.values(ie):void 0,scheduleItems:o?J:void 0},!1,!1,!0)},V=new Map;for(let K of Object.keys(R))V.set(K,F(R[K]));let j=[...V.values()],B=(Z=s==null?void 0:s[sU])==null?void 0:Z.participant,z=uC({participants:j,participantFilters:i,tournamentRecord:l});if(e){let K=Xi(e)?e:void 0;for(let Q of z)for(let J of Q.individualParticipantIds??[]){Q.individualParticipants||(Q.individualParticipants=[]);let se=V.get(J),ie=K?cI({template:K,source:se}):se;Q.individualParticipants.push(ie)}}let W=B?z.map(K=>cI({source:K,template:B})):z;return{participantMap:t.returnParticipantMap!==!1?R:void 0,mappedMatchUps:t.returnMatchUps!==!1?k:void 0,matchUps:t.returnMatchUps!==!1?O:void 0,missingParticipantIds:E.missingParticipantIds,participantIdsWithConflicts:M,eventsPublishStatuses:_,derivedEventInfo:A,derivedDrawInfo:N,participants:W,...de}}function Lb({participantId:t,drawDefinition:e,entryStatus:i,entryStage:n}){var a;if(!e)return{error:Gt};let r=(a=e.entries)==null?void 0:a.find(s=>s.participantId===t&&(!i||i===s.entryStatus)&&(!n||n===s.entryStage));return t&&r}function pU(t){var h,f,m,g,v,y,b,I,T;let{provisionalPositioning:e,drawDefinition:i,stageSequence:n,structureId:r,stage:a}=t;if(!i)return{error:Gt};let{entryProfile:s}=KP({drawDefinition:i}),o=a&&n&&((m=(f=(h=s==null?void 0:s[a])==null?void 0:h.stageSequence)==null?void 0:f[n])==null?void 0:m.qualifiersCount)||a&&((g=s==null?void 0:s[a])==null?void 0:g.qualifiersCount)||0,l={};if(!r)return{qualifiersCount:o,roundQualifiersCounts:l};let{structure:c}=hi({drawDefinition:i,structureId:r}),u=(v=i.links)==null?void 0:v.filter(w=>{var S;return((S=w==null?void 0:w.target)==null?void 0:S.structureId)===(c==null?void 0:c.structureId)}),d=0;if(u!=null&&u.length)for(let w of u){let S=(y=hi({structureId:w.source.structureId,drawDefinition:i}))==null?void 0:y.structure;if((S==null?void 0:S.stage)===ni){let U=w.source.roundNumber,P=w.target.roundNumber,E=0;if(S.structureType===So){let R=((b=S.structures)==null?void 0:b.length)??0,C=((I=w.source.finishingPositions)==null?void 0:I.length)??0;E=R*C}else E=((T=wn({matchUpFilters:{roundNumbers:[U]},structure:S,afterRecoveryTimes:!1,provisionalPositioning:e,inContext:!1}).matchUps)==null?void 0:T.length)||0;l[P]||(l[P]=0),l[P]+=E,d+=E}}let p=Object.keys(l);if(p.length<=1){let w=p[0]||1;l[w]=Math.max(l[w]||0,o)}return d=Math.max(d,o),{qualifiersCount:d,roundQualifiersCounts:l}}function KA({stage:t,drawDefinition:e}){var n;let{entryProfile:i}=KP({drawDefinition:e});return((n=i==null?void 0:i[t])==null?void 0:n.drawSize)||0}function m_e(t){let{provisionalPositioning:e,drawDefinition:i,stageSequence:n,stage:r}=t,a=KA({stage:r,drawDefinition:i}),{qualifiersCount:s}=pU({provisionalPositioning:e,drawDefinition:i,stageSequence:n,stage:r});return a&&a-s}function Qoe({stage:t,drawDefinition:e}){return!!(t===$a||Yq({stage:t,drawDefinition:e})&&KA({stage:t,drawDefinition:e}))}function ele({entryStatus:t=ol,drawDefinition:e,stageSequence:i,stage:n}){if(t===_u)return cAe({stage:n,drawDefinition:e})?{positionsAvailable:1/0,...de}:{error:lae};let r=m_e({drawDefinition:e,stageSequence:i,stage:n}),a=uAe({drawDefinition:e,stage:n}),s=OV({entryStatus:jS,drawDefinition:e,stage:n}),o=OV({entryStatus:ol,drawDefinition:e,stage:n}),l=s+o,c=l>=r,u=r-l;return n!==$a&&c?{error:PV}:t===jS?s<a?{...de}:{error:PV}:{positionsAvailable:u,...de}}function s3(t){let e=Qt(t,[{[To]:!0,[Gse]:!0}]);if(e.error)return e;let{suppressDuplicateEntries:i=!0,entryStatus:n=ol,entryStageSequence:r,entryStage:a=Ft,ignoreStageSpace:s,drawDefinition:o,entryPosition:l,participant:c,roundTarget:u,extensions:d,extension:p,drawType:h,event:f}=t,m="addDrawEntry";if(h!==nc&&!Qoe({stage:a,drawDefinition:o}))return he({result:{error:Ay},stack:m});let g=ele({stageSequence:r,stage:a,drawDefinition:o,entryStatus:n});if(!s&&!g.success&&(!h||h!==nc))return{error:g.error};if(p&&!Cp({extension:p}))return he({result:{error:Re},info:"Invalid extension",context:{extension:p},stack:m});let v=t.participantId||(c==null?void 0:c.participantId);if(!v)return he({result:{error:la},stack:m});let y=n===Wf&&Lb({participantId:v,drawDefinition:o,entryStatus:n}),b=a===$a&&Lb({participantId:v,drawDefinition:o,entryStage:a}),I=Lb({participantId:v,drawDefinition:o}),T=n!==Wf&&a!==$a&&I;if(T)return i?(Si({payload:{drawId:o.drawId,eventId:f==null?void 0:f.eventId,error:qD,participantId:v},topic:Mq}),{...de}):he({result:{error:qD},context:{participantId:v},stack:m});if(y||b)return he({context:{invalidEntry:T,invalidLuckyLoser:y,invalidVoluntaryConsolation:b},result:{error:ox},stack:m});let w=Kt({entryStageSequence:r,participantId:v,entryPosition:l,entryStatus:n,entryStage:a,extensions:d});return p&&dn({element:w,extension:p}),u&&dn({extension:{name:"roundEntry",value:u},element:w}),o.entries||(o.entries=[]),o.entries.push(w),Hn({drawDefinition:o}),{...de}}function g_e(t){let e="addDrawEntries",{suppressDuplicateEntries:i=!0,entryStatus:n=ol,autoEntryPositions:r=!0,ignoreStageSpace:a,participantIds:s,drawDefinition:o,stageSequence:l,stage:c=Ft,roundTarget:u,extension:d,event:p}=t;if(!c)return{error:Bre};if(!o)return{error:Gt};if(!Array.isArray(s))return{error:Dl};if(!Qoe({stage:c,drawDefinition:o}))return{error:Ay};if(d&&!Cp({extension:d}))return he({result:{error:Re},info:"Invalid extension",context:{extension:d},stack:e});let h=ele({drawDefinition:o,stageSequence:l,entryStatus:n,stage:c});if(!a&&!h.success)return{error:h.error};let f=h.positionsAvailable??0;if(!a&&c!==$a&&f<s.length)return{error:Mz};let m=[],g=o.drawId,v=p==null?void 0:p.eventId,y=s.reduce((b,I)=>{let T=n===Wf&&Lb({participantId:I,drawDefinition:o,entryStatus:n}),w=c===$a&&Lb({entryStage:c,drawDefinition:o,participantId:I}),S=Lb({participantId:I,drawDefinition:o});return n!==Wf&&c!==$a&&S&&(m.push(I),i&&Si({payload:{error:qD,participantId:I,eventId:v,drawId:g},topic:Mq})),T||w?b.concat(I):b},[]);return m.length&&!i?he({context:{eventId:v,drawId:g,duplicateEntries:m},result:{error:qD},stack:e}):(s.filter(b=>b&&!y.includes(b)).forEach(b=>{let I={entryStageSequence:l,entryStage:c,participantId:b,entryStatus:n};d&&dn({element:I,extension:d}),u&&dn({extension:{name:Hp,value:u},element:I}),o.entries||(o.entries=[]),o.entries.push(I)}),r&&(o.entries=Dd({entries:o.entries})),Hn({drawDefinition:o}),y!=null&&y.length||m!=null&&m.length?{info:"some participantIds could not be added",participantIdsNotAdded:y,duplicateEntries:m,...de}:{...de})}function o3({suppressDuplicateEntries:t=!0,autoEntryPositions:e=!0,entryStageSequence:i,ignoreStageSpace:n,participantIds:r,drawDefinition:a,entryStatus:s,roundTarget:o,entryStage:l,extension:c,drawId:u,event:d}){if(!(r!=null&&r.length))return{error:xg};if(!d)return{error:Gc};if(!u)return{error:Vd};let p=(d.entries||[]).map(Vi);if(r.filter(m=>!p.includes(m)).length)return{error:Fre};if(a){let m=g_e({stageSequence:i,suppressDuplicateEntries:t,autoEntryPositions:e,stage:l,ignoreStageSpace:n,participantIds:r,drawDefinition:a,entryStatus:s,roundTarget:o,extension:c});if(m.error)return m}let{flightProfile:h}=_r({event:d}),f=h==null?void 0:h.flights.find(m=>m.drawId===u);return f!=null&&f.drawEntries&&(r.forEach(m=>{let g=s===Wf&&v$({participantId:m,entryStatus:s,flight:f}),v=l===$a&&v$({participantId:m,entryStage:l,flight:f});!(s!==Wf&&l!==$a&&v$({flight:f,participantId:m}))&&!g&&!v&&f.drawEntries.push({participantId:m,entryStatus:s,entryStage:l})}),e&&(f.drawEntries=Dd({entries:f.drawEntries}))),{...de}}function v$({participantId:t,entryStatus:e,entryStage:i,flight:n}){var a;let r=(a=n.drawEntries)==null?void 0:a.find(s=>s.participantId===t&&(!e||e===s.entryStatus)&&(!i||i===s.entryStage));return t&&r}function dC({autoEntryPositions:t=!0,participantIds:e=[],entryStatuses:i,stage:n,event:r}){var d,p,h,f;let a="removeEventEntries";if(!(r!=null&&r.eventId))return{error:Jn};if(!Array.isArray(e)||e.some(m=>!nr(m)))return he({result:{error:Md},stack:a});let s=(r.drawDefinitions??[]).flatMap(m=>jy({drawDefinition:m}).assignedParticipantIds??[]),o=((i==null?void 0:i.length)&&((d=r.entries)==null?void 0:d.filter(m=>m.entryStatus&&i.includes(m.entryStatus)))||[]).map(Vi).filter(m=>!s.includes(m)),l=(n&&((p=r.entries)==null?void 0:p.filter(m=>m.entryStage&&m.entryStage===n))||[]).map(Vi).filter(m=>!s.includes(m));if(e.length?e=e.filter(m=>(!(i!=null&&i.length)||o.includes(m))&&(!n||l.includes(m))):o.length&&l.length?e=Nr(o,l):o.length?e=o:l.length&&(e=l),(e==null?void 0:e.length)&&s.some(m=>e.includes(m)))return he({result:{error:JT},stack:a});if(!(e!=null&&e.length))return{...de,participantIdsRemoved:[]};let c=[];r.entries=(r.entries??[]).filter(m=>{let g=!e.includes(m==null?void 0:m.participantId);return g||c.push(m.participantId),g}),t&&(r.entries=Dd({entries:r.entries}));let{flightProfile:u}=_r({event:r});return(h=u==null?void 0:u.flights)==null||h.forEach(m=>{m.drawEntries=(m.drawEntries||[]).filter(g=>!e.includes(g.participantId))}),(f=r.drawDefinitions)==null||f.forEach(m=>{m.entries=(m.entries??[]).filter(g=>!e.includes(g.participantId))}),{...de,participantIdsRemoved:c}}var tle={[Ba]:{policyName:"matchUpActionsDefault",enabledStructures:[{stages:[],stageSequences:[],enabledActions:[],disabledActions:[]}],participants:{enforceCategory:!0,enforceGender:!0},processCodes:{substitution:["RANKING.IGNORE","RATING.IGNORE"]},substituteAfterCompleted:!1,substituteWithoutScore:!1}},hU=tle;function gp(t){var A,N;let{suppressDuplicateEntries:e=!0,entryStatus:i=ol,autoEntryPositions:n=!0,enforceGender:r=!0,entryStageSequence:a,policyDefinitions:s,entryStage:o=Ft,tournamentRecord:l,ignoreStageSpace:c,drawDefinition:u,roundTarget:d,extensions:p,extension:h,drawId:f,event:m}=t,g="addEventEntries";if(!Array.isArray(t.participantIds))return he({result:{error:Dl},stack:g});let v=Ei(t.participantIds??[]);if(!m)return{error:Jn};if(!(v!=null&&v.length))return he({result:{error:xg},stack:g});if(!(m!=null&&m.eventId))return{error:Gc};let y=hn({tournamentRecord:l,event:m}).appliedPolicies??{},b=(s==null?void 0:s[Ba])??(y==null?void 0:y[Ba])??hU[Ba],I=(r??((A=b==null?void 0:b.participants)==null?void 0:A.enforceGender))!==!1,T=[],w=[];if(p&&(!Array.isArray(p)||!p.every(k=>Cp({extension:k})))||h&&!Cp({extension:h}))return he({context:Kt({extension:h,extensions:p}),result:{error:Re},info:"Invalid extension(s)",stack:g});let S=!!l,U=[],P,E=((N=l==null?void 0:l.participants)==null?void 0:N.filter(k=>{var F,V,j;if(!v.includes(k.participantId))return!1;let O=Fr(xn)(m.eventType)&&k.participantType===ji&&!Dv(i),$=m.eventType===Mn&&k.participantType===Ni;return O&&(!m.gender||!I||[Oo,Ad].includes(m.gender)||m.gender===((F=k.person)==null?void 0:F.sex))||$&&!Dv(i)||m.eventType===Mn&&k.participantType===ji&&Dv(i)?!0:O&&m.gender&&I&&![Oo,Ad].includes(m.gender)&&m.gender!==((V=k.person)==null?void 0:V.sex)?(U.push({participantId:k.participantId,sex:(j=k.person)==null?void 0:j.sex}),!1):m.eventType===En&&(k.participantType===En||Dv(i)&&k.participantType===ji)}).map(k=>k.participantId))??[],R=v.filter(k=>!S||E.includes(k));m.entries||(m.entries=[]);let C=m.entries.map(k=>{var O;return k.participantId||((O=k.participant)==null?void 0:O.participantId)});if(R.forEach(k=>{var O;if(!C.includes(k)){let $=Kt({participantId:k,entryStatus:i,entryStage:o,extensions:p});h&&dn({element:$,extension:h}),d&&dn({extension:{name:Hp,value:d},element:$}),a&&($.entryStageSequence=a),T.push($.participantId),(O=m.entries)==null||O.push($)}}),f&&!Dv(o)){let k=o3({participantIds:R,suppressDuplicateEntries:e,autoEntryPositions:n,entryStageSequence:a,ignoreStageSpace:c,drawDefinition:u,entryStatus:i,roundTarget:d,entryStage:o,extension:h,drawId:f,event:m});k.error&&(P=k.error)}if(m.eventType&&[Vf,Al].includes(m.eventType)){let k=(m.entries||[]).map(V=>V.participantId),O=(m.entries||[]).filter(V=>Dv(V.entryStatus)).map(V=>V.participantId),$=((l==null?void 0:l.participants)??[]).filter(V=>k.includes(V.participantId)&&V.participantType&&[Ni,En].includes(V.participantType)).map(V=>V.individualParticipantIds).flat(1/0),F=O.filter(V=>$.includes(V));F.length&&(w.push(...F),dC({participantIds:F,autoEntryPositions:!1,event:m}))}if(R.length!==v.length)return he({context:{mismatchedGender:U,gender:m.gender},result:{error:Dl},stack:g});n&&(m.entries=Dd({entries:m.entries||[]}));let M=T.length,_=w.length;return he({result:{...de,addedEntriesCount:M,removedEntriesCount:_},stack:g,info:P})}var ile="ADMINISTRATION",v_e="CAPTAIN",y_e="COACH",ms="COMPETITOR",nle="MEDIA",rle="MEDICAL",l3="OFFICIAL",ale="OTHER",sle="SECURITY",zg={ADMINISTRATION:ile,CAPTAIN:v_e,COACH:y_e,COMPETITOR:ms,MEDIA:nle,MEDICAL:rle,OFFICIAL:l3,OTHER:ale,SECURITY:sle};function c3({addIndividualParticipantsToEvents:t,individualParticipantIds:e,groupingParticipantId:i,tournamentRecord:n,suppressErrors:r}){let a="removeIndividualParticipantIds";if(!n)return he({result:{error:ut},stack:a});if(!i||!e)return he({result:{error:ai},stack:a});let s=(n.participants??[]).find(u=>u.participantId===i);if(!s)return he({result:{error:xr},stack:a});if(![En,pc].includes(s.participantType))return he({result:{participantType:s.participantType,error:Nd},stack:a});let o=ole({individualParticipantIds:e,groupingParticipant:s,tournamentRecord:n,suppressErrors:r}),{removed:l,error:c}=o;if(c)return he({result:o,stack:a});if(t)for(let u of n.events??[]){let d=(u.entries??[]).map(({participantId:p})=>p).filter(Boolean);if(d.includes(i)){let p=l==null?void 0:l.filter(h=>!d.includes(h));gp({participantIds:p,entryStatus:eu,tournamentRecord:n,event:u})}}return l&&Si({topic:Is,payload:{tournamentId:n.tournamentId,participants:[s]}}),{...de,...o}}function ole({individualParticipantIds:t=[],groupingParticipant:e,tournamentRecord:i,suppressErrors:n,mappedMatchUps:r,participants:a}){var p,h;let s=[];if(!e)return{removed:s};let o=[],l=[];a||({participants:a,mappedMatchUps:r}=vr({withMatchUps:!0,tournamentRecord:i,withEvents:!0}));let c=(h=(p=a==null?void 0:a.find(({participantId:f})=>f===e.participantId))==null?void 0:p.events)==null?void 0:h.map(({eventId:f})=>f),u=(e.individualParticipantIds??[]).filter(f=>{var y;let m=t==null?void 0:t.includes(f),g=m&&((y=a==null?void 0:a.find(b=>b.participantId===f))==null?void 0:y.matchUps.filter(({eventId:b})=>c.includes(b)).map(({matchUpId:b})=>r==null?void 0:r[b]).filter(({winningSide:b,score:I})=>b||ga({score:I}))),v=m&&!(g!=null&&g.length);if(m&&!v&&l.push(f),v){s.push(f);for(let b of i.events??[])for(let I of b.drawDefinitions??[]){let{extension:T}=ki({element:I,name:zf}),w=T==null?void 0:T.value[e.participantId];T&&w&&(T.value[e.participantId]=w.filter(U=>U.participantId!==f),dn({element:I,extension:T}),zP({drawDefinition:I}));let S=lo({drawDefinition:I,inContext:!1}).matchUps??[];for(let U of S){let P=U.sides??[];for(let E of P){let R=E.lineUp??[];R.find(C=>C.participantId===f)&&(E.lineUp=R.filter(C=>C.participantId!==f),Ji({tournamentId:i==null?void 0:i.tournamentId,drawDefinition:I,matchUp:U}))}}}}else o.push(f);return!v});e.individualParticipantIds=u;let d={groupingParticipantId:e.participantId,cannotRemove:l,notRemoved:o,removed:s};return l.length&&!n&&{...d,cannotRemove:l,error:ax}||d}function Qx({participantRole:t=ms,individualParticipantIds:e=[],groupingTypes:i=[Lo,pc],tournamentRecord:n}){if(!n)return{error:ut};let r=n.participants??[],{participants:a,mappedMatchUps:s}=vr({withMatchUps:!0,tournamentRecord:n,withEvents:!0}),o=0;return r.filter(l=>(l.participantRole===t||!l.participantRole)&&l.participantType&&i.includes(l.participantType)).forEach(l=>{let{removed:c}=ole({groupingParticipant:l,individualParticipantIds:e,tournamentRecord:n,mappedMatchUps:s,participants:a});c&&o++}),o?de:{error:nae}}function sw(t){var f,m;let e=Qt(t,[{[ba]:!0},{participantIds:!0,[qo]:Rs,[Au]:xg}]);if(e.error)return e;let{addIndividualParticipantsToEvents:i,tournamentRecord:n,participantIds:r}=t,a=((f=n.participants)==null?void 0:f.length)||0;if(!a)return{...de};let s=(m=n.events||[])==null?void 0:m.filter(({eventType:g})=>g===na).map(g=>{var v;return(v=g==null?void 0:g.drawDefinitions)==null?void 0:v.map(({drawId:y})=>y)}).flat(1/0),o=vr({participantFilters:{participantIds:r},tournamentRecord:n,withDraws:!0}).participants??[],l=g=>{let v=(Wa({matchUpFilters:{drawIds:g,matchUpTypes:[Mn]},tournamentRecord:n}).matchUps??[]).flatMap(({sides:y})=>y==null?void 0:y.map(({participantId:b})=>b||[])).filter(Boolean);return Nr(v,r)},c=s!=null&&s.length?l(s):[],u=o.filter(g=>{var v;return(v=g.draws)==null?void 0:v.filter(y=>(!(s!=null&&s.length)||!(s!=null&&s.includes(y.drawId)))&&y.positionAssignments).length});if(c!=null&&c.length||u.length)return{error:JT};let d={},p={};for(let g of n.events||[]){let v=dC({participantIds:r,event:g});if(v.error)return v;d[g.eventId]=v.participantIdsRemoved}n.participants=(n.participants??[]).filter(g=>{var y,b;let v=r.includes(g.participantId)||g.participantType===Ni&&((y=g.individualParticipantIds)==null?void 0:y.some(I=>r.includes(I)));if(!v&&g.participantType===na&&((b=g.individualParticipantIds)!=null&&b.some(I=>r.includes(I)))&&(g.individualParticipantIds=g.individualParticipantIds.filter(I=>!r.includes(I))),v&&i&&g.participantType&&[Ni,En].includes(g.participantType))for(let I of g.individualParticipantIds||[])r.includes(I)||(p[g.participantId]||(p[g.participantId]=[]),p[g.participantId].push(I));return!v});let h=a-n.participants.length;if(Qx({individualParticipantIds:r,tournamentRecord:n}),i)for(let g of n.events||[]){let v=d[g.eventId].map(y=>p[y]||[]).flat();gp({participantIds:v,entryStatus:eu,tournamentRecord:n,event:g})}return h&&Si({payload:{participantIds:r,tournamentId:n.tournamentId},topic:Nq}),h?{...de,participantsRemovedCount:h}:{error:ax}}function lle({selected:t=!0,drawDefinition:e,entryStatuses:i,drawId:n,event:r,stage:a}){var l;let s=r.entries??[];if(n){let{flightProfile:c}=_r({event:r}),u=(l=c==null?void 0:c.flights)==null?void 0:l.find(d=>d.drawId===n);u?s=u.drawEntries:e.entries&&(s=e==null?void 0:e.entries)}let o=s.filter(c=>(!(i!=null&&i.length)||!c.entryStatus||i.includes(c.entryStatus))&&(!a||!c.entryStage||c.entryStage===a)&&(!t||c.entryStatus&&id.includes(c.entryStatus)));return{entries:s,stageEntries:o}}function cle({removeGroupParticipant:t,tournamentRecord:e,drawDefinition:i,participantId:n,drawId:r,stage:a,event:s}){var v;let o="destroyGroupEntry";if(!e)return{error:ut};if(!n)return he({result:{error:la},stack:o});if(!s)return{error:Jn};if(!s.eventType||![Vf,Al].includes(s.eventType))return he({result:{error:_h},stack:o});let l=e.participants??[],c=l.find(y=>y.participantId===n);if(!c)return he({result:{error:xr},stack:o});if(!c.participantType||![Ni,Lo].includes(c.participantType)||c.participantType===Lo&&s.eventType!==Al||c.participantType===Ni&&s.eventType!==Vf)return{error:Nd};let u=(s.entries??[]).find(y=>y.participantId===n);if(!u)return{error:oae};let{stageEntries:d}=lle({selected:!1,drawDefinition:i,drawId:r,event:s,stage:a}),p=d.map(Vi),h=l.filter(({participantId:y})=>p.includes(y)).map(({individualParticipantIds:y})=>y).flat().filter(Boolean),f=(v=c.individualParticipantIds)==null?void 0:v.filter(y=>fp(y,h).length===1),m=dC({participantIds:[n],event:s});if(m.error||f!=null&&f.length&&(m=gp({participantIds:f,entryStatus:eu,entryStage:u.entryStage,tournamentRecord:e,drawDefinition:i,drawId:r,event:s}),m.error))return m;let g;return t&&sw({participantIds:[n],tournamentRecord:e}).success&&(g=!0),{...de,participantRemoved:g}}function u3({removeGroupParticipant:t,tournamentRecord:e,drawDefinition:i,participantId:n,drawId:r,event:a}){return cle({removeGroupParticipant:t,tournamentRecord:e,drawDefinition:i,participantId:n,drawId:r,event:a})}function ule(t){if(!t.tournamentRecord)return{error:ut};let{participantIds:e,...i}=t,n=0,r=[];for(let a of e){let s=cle({participantId:a,...i});s.success&&(n+=1),s.error&&r.push(s.error)}return n?{destroyedCount:n,...de}:{error:r}}function hE(t){let{tournamentRecord:e,replaceWithBye:i,drawDefinition:n,destroyPair:r,entryStatus:a,matchUpsMap:s,drawId:o}=t,l="removeDrawPositionAssignment",c=lC(t);if(c.error)return he({result:c,stack:l});let{participantId:u}=c,{drawPosition:d,event:p,structureId:h}=t,f=hn({tournamentRecord:e,drawDefinition:n,event:p}).appliedPolicies??{};if([_u,Fh].includes(a)&&u){let{tournamentRecord:g}=t,{participant:v}=jg({tournamentRecord:g,participantId:u}),{participantType:y,individualParticipantIds:b}=v??{};if(r&&y===Ni){let I=u3({tournamentRecord:g,drawDefinition:n,participantId:u,event:p});if(I.error)return he({result:I,stack:l});b&&YA({participantIds:b,tournamentRecord:g,drawDefinition:n,entryStatus:a,drawId:o,event:p})}else YA({participantIds:[u],tournamentRecord:g,drawDefinition:n,entryStatus:a,drawId:o,event:p})}if(i){let g=fc({tournamentRecord:e,drawDefinition:n,drawPosition:d,structureId:h,matchUpsMap:s,event:p});if(g.error)return he({result:g,stack:l})}let{structure:m}=hi({drawDefinition:n,structureId:h});return jq({structure:m,drawPositions:[d]}),$x({appliedPolicies:f,drawDefinition:n,positionAction:{name:"removeDrawPositionAssignment",replaceWithBye:i,drawPosition:d,entryStatus:a,structureId:h}}),c}function dle(t){return Object.assign(t,{entryStatus:Fh}),hE(t)}function GV(t){return nr(t)?t.split(" ").map(e=>e.split("").map((i,n)=>n?i.toLowerCase():i.toUpperCase()).join("")).join(" "):t}function gs(t){return nr(t)?GV(t.replace(/_/g," ")):""}var ng=({finishingPosition:t=YI,qualifyingRoundNumber:e,structureAbbreviation:i,seedAssignments:n=[],stageSequence:r=1,structureOrder:a,seedingProfile:s,matchUpFormat:o,structureType:l,structureName:c,matchUpType:u,matchUps:d=[],structureId:p,roundOffset:h,roundLimit:f,stageOrder:m,structures:g,stage:v})=>{let y={structureId:p??yn(),structureAbbreviation:i,finishingPosition:t,seedAssignments:n,matchUpFormat:o,stageSequence:r,structureName:c};a&&(y.structureOrder=a),l&&(y.structureType=l),s&&(typeof s=="string"?y.seedingProfile=s:typeof s=="object"&&typeof s.positioning=="string"&&(y.seedingProfile=s.positioning)),u&&(y.matchUpType=u),h&&(y.roundOffset=h),m&&(y.stageOrder=m),f&&(y.roundLimit=f),v&&(y.stage=v),e&&(y.qualifyingRoundNumber=e);let b=d.flatMap(({drawPositions:I})=>I).filter(Boolean);return g?y.structures=g:(y.matchUps=d,y.positionAssignments=Ei(b).sort((I,T)=>I-T).map(I=>({drawPosition:I}))),y},Lc=ng;function d3({structureName:t=gs($a),structureAbbreviation:e,drawDefinition:i,matchUpType:n,structureId:r}){if(!i)return{error:Gt};let a=Lc({stage:$a,structureAbbreviation:e,structureName:t,matchUps:[],structureId:r,matchUpType:n});return i.structures||(i.structures=[]),i.structures.push(a),Hn({drawDefinition:i,structureIds:[a.structureId]}),{...de}}function p3({drawPositions:t}){if(!(t!=null&&t.length))return{error:RP};let e=r=>t.filter(a=>a!==r).map(a=>[r,a]),i=[].concat(...(t??[]).map(e)),n=Ei(i.map(eO)).map(r=>r.split("|").map(a=>+a));return{groupMatchUps:i,uniqueMatchUpGroupings:n}}function eO(t=[]){return!Array.isArray(t)||!t.length?"":[...t].sort(ia).join("|")}function ple({groupSize:t,drawPositionOffset:e}){if(!t)return[];let i=d=>[...Array(d)].map((p,h)=>h),n=i(2*Math.round(t/2)+1).slice(1),r=i(n.length-1).map(()=>[]),a=n.slice(0,n.length/2),s=n.slice(n.length/2);n.slice(1).forEach((d,p)=>{a.forEach((g,v)=>{r[p].push([a[v],s[v]])});let h=a.shift(),f=a.pop(),m=s.shift();a=[h,m,...a].filter(Boolean),s=[...s,f].filter(Boolean)});let o=a.shift(),l=a.pop(),c=s.shift();a=[o,c,...a].filter(Boolean),s=[...s,l].filter(Boolean);let u=d=>d[0].reduce((p,h)=>p+h);return[...r].reverse().sort((d,p)=>u(d)-u(p)).map(d=>d.filter(p=>p.every(h=>h<=t)).map(p=>{let h=p.map(f=>f+e);return eO(h)}))}function b_e({rounds:t,hash:e}){return t!=null&&t.length?t==null?void 0:t.reduce((i,n,r)=>n.includes(e)?r+1:i,void 0):{error:ai}}var I_e={getRoundRobinGroupMatchUps:p3,determineRoundNumber:b_e,drawPositionsHash:eO,groupRounds:ple};function pC(t){var S;let{groupNameBase:e="Group",playoffAttributes:i,stageSequence:n=1,structureOptions:r,appliedPolicies:a,seedingProfile:s,stage:o=Ft,matchUpType:l,roundTarget:c,structureId:u,groupNames:d,drawSize:p,idPrefix:h,isMock:f,uuids:m}=t,g=t.structureName??((S=i==null?void 0:i["0"])==null?void 0:S.name)??gs(Ft),{groupCount:v,groupSize:y}=w_e({structureOptions:r,appliedPolicies:a,drawSize:p}),b=ey,I,T=Rt(1,v+1).map(U=>{let P=S_e({groupSize:y,structureOrder:U,matchUpType:l,drawSize:p,idPrefix:h,isMock:f});I=Array.isArray(P)?Math.max(...P.map(({roundNumber:R})=>R??0)):0;let E=(d==null?void 0:d[U-1])??`${e} ${U}`;return ng({structureId:m==null?void 0:m.pop(),structureType:wx,finishingPosition:b,structureOrder:U,structureName:E,matchUps:P})}),w=ng({structureId:u??(m==null?void 0:m.pop()),structureType:So,finishingPosition:b,seedingProfile:s,structureName:g,stageSequence:n,structures:T,stage:o});return c&&dn({extension:{name:Hp,value:c},element:w}),{structures:[w],maxRoundNumber:I,groupCount:v,links:[],groupSize:y,...de}}function w_e({appliedPolicies:t,structureOptions:e,drawSize:i}){let n=e==null?void 0:e.groupSize,r=(e==null?void 0:e.groupSizeLimit)||8,{validGroupSizes:a}=hC({groupSizeLimit:r,drawSize:i}),s=a&&Math.max(...a);n&&(a!=null&&a.includes(n))||(n&&n>4||!(a!=null&&a.includes(4))?n=s:n=4);let o=Math.ceil(i/n);return{groupSize:n,groupCount:o}}function hC(t){let{groupSizeLimit:e=10,drawSize:i=0}=t??{},n=Rt(3,e+1).filter(r=>{let a=Math.ceil(i/r),s=a*r-i,o=Math.ceil(i/a),l=Math.ceil(s/a);return(!s||s<r)&&o===r&&o>=3&&l<2});return{...de,validGroupSizes:n}}function S_e({structureOrder:t,matchUpType:e,groupSize:i,drawSize:n,idPrefix:r,isMock:a,uuids:s}){let o=(t-1)*i,l=Rt(1+o,i+1+o),c=p3({drawPositions:l}).uniqueMatchUpGroupings??[],u=ple({groupSize:i,drawPositionOffset:o});return c.map(p).sort((h,f)=>(h.roundNumber??1/0)-(f.roundNumber??1/0));function d(h){return u.reduce((f,m,g)=>m.includes(h)?g+1:f,void 0)}function p(h){let f=eO(h),m=d(f),g=[1,n],v=T_e({structureOrder:t,drawPositions:h,roundNumber:m,idPrefix:r,uuids:s}),y={matchUpStatus:m?Vr:mn,matchUpType:e,finishingPositionRange:{winner:g,loser:g},drawPositions:h,roundNumber:m,matchUpId:v};return a&&(y.isMock=!0),y}}function T_e({structureOrder:t,drawPositions:e,roundNumber:i,idPrefix:n,uuids:r}){return n?`${n}-${t}-${i}-DP-${e.join("-")}`:(r==null?void 0:r.pop())||yn()}function h3(t){let{roundRobinGroupsCount:e,participantsCount:i,cluster:n}=t;if(!Ii(i))return{seedBlocks:void 0,...he({result:{error:Re},context:{participantsCount:i},stack:"getSeedBlocks"})};let r=WT(i);if(e){let h=Math.min(e,r),f=[],m=1;for(Rt(0,h).forEach(()=>{f.push([m]),m++});m<r;){let g=Rt(m,m+h);m+=h,f.push(g)}return{...de,seedBlocks:f}}let a=Rt(1,r+1),s=[],o=r/2;for(;o>1;){let h=Ra(a,o),f=h.length;h.forEach((m,g)=>{let v,y=g<f/2,b=g%2===0,I=m[0],T=m[m.length-1];n&&f>4?f===8?v=y?T:I:v=b?I:T:v=y?I:T,ho(m,s)||s.push(v)}),o=o/2}let l=a.filter(h=>!s.includes(h));for(;l.length;)l.length%2===0?s.push(l.pop()):s.push(l.shift());let c=Rt(0,20).map(h=>Math.pow(2,h));c.unshift(1);let u=c.indexOf(r),d=0,p=[];return Rt(0,u).forEach(h=>{p.push(s.slice(d,d+c[h])),d+=c[h]}),{...de,seedBlocks:p}}function f3({roundRobinGroupsCount:t,drawSize:e}){let i="getSeedGroups";if(!Ii(e))return{seedGroups:void 0,...he({result:{error:Re},context:{drawSize:e},stack:i})};if(t){if(!Ii(t))return{seedGroups:void 0,...he({context:{roundRobinGroupsCount:t},result:{error:Re},stack:i})};let n=1,r=Math.floor(e/t);return{seedGroups:Rt(0,r).map(()=>{let a=Rt(n,n+t);return n+=t,a})}}else{let{seedBlocks:n}=h3({participantsCount:e,roundRobinGroupsCount:t}),r=0;return{seedGroups:(n||[]).map(a=>(a||[]).map(()=>(r+=1,r)))}}}function m3({roundRobinGroupsCount:t,participantsCount:e}){var r;if(t){let{validGroupSizes:a}=hC({drawSize:e});if(!((r=a==null?void 0:a.map(s=>Math.ceil(e/s)))!=null&&r.includes(t)))return he({context:{roundRobinGroupsCount:t},result:{error:Re}})}let{seedGroups:i}=f3({drawSize:e,roundRobinGroupsCount:t}),n=(i==null?void 0:i.map(a=>Math.min(...a)))||[];return{...de,seedingThresholds:n}}function HS(t){if(!t)return 1/0;if(Ii(t))return ui(t);let e=t.split("-")[0];return Ii(e)?ui(e):1/0}function U_e({size:t}){let e=[t],i=t;for(;i/2===Math.floor(i/2);)i=i/2,e.push(i);return e.includes(1)||e.push(1),e.sort(ia),e.reverse(),e}function D_e({blockPattern:t,index:e}){let i=0;for(let n of t){if(i===e)return n;let r=0;for(;r<n.length;){if(i===e)return n;i+=1,r++}}}function E_e({positioning:t,size:e}){let i=U_e({size:e}),n=[],r=[],a=p=>p[0],s=p=>p[p.length-1],o=(p,h)=>(t&&[Ix,Jv].includes(t)&&h%2?s(p):a(p))||a(p),l=(p,h)=>{if(p.every(f=>!r.includes(f))){let f=o(p,h);return r.push(f),f}},c=p=>{let h=p.filter(f=>!r.includes(f));if(h.length)return r.push(...h),h},u=(p,h)=>{let f=o(p,h);if(!r.includes(f))return r.push(f),f},d=Rt(1,e+1);for(let p of i)if(p===1){let h=Ra(d,2),f=h.map(l).filter(Boolean);f.length&&n.push(f);let m=h.flatMap(c).filter(Boolean);m.length&&n.push(m)}else{let h=Ra(d,p).map(u).filter(Boolean);h.length&&n.push(h)}return{divisions:i,divisionGroupings:n}}function ow({provisionalPositioning:t,returnAllProxies:e,appliedPolicies:i,seedingProfile:n,drawDefinition:r,allPositions:a,structure:s}){var N;let o=[];if(!s)return{error:Ny};let{matchUps:l,roundMatchUps:c}=wn({matchUpFilters:{roundNumbers:[1]},provisionalPositioning:t,structure:s}),{seedAssignments:u}=qc({provisionalPositioning:t,returnAllProxies:e,drawDefinition:r,structure:s}),{positionAssignments:d}=Ma({structure:s}),p=d==null?void 0:d.length,h=(u==null?void 0:u.length)??0,f=[],m=Object.keys(c).map(k=>parseInt(k)).sort((k,O)=>k-O).map(k=>{let O=c[k].map(F=>F.drawPositions).flat(1/0).filter(Boolean),$=O.filter(F=>!f.includes(F));return f=f.concat(...O),$}).filter(k=>k.length).reverse(),g=m.pop()??[],v=g&&Math.min(...g)-1||0;n=n??((N=i==null?void 0:i.seeding)==null?void 0:N.seedingProfile);let y=(g==null?void 0:g.length)||0,b=m.filter(k=>k.filter(O=>O<=h).length),{stage:I,structureType:T,roundLimit:w}=s,S=T===So,U=!S&&(m==null?void 0:m.length),P=!S&&I===ni&&w,E=b.flat(1/0),R=U?E==null?void 0:E.length:0,C=a?p:h,M=Kq({drawDefinition:r,structure:s,matchUps:l}),_=M?0:!U&&C||C&&E.length<C&&C-E.length||0;if(P){let k=s!=null&&s.matchUps?s.matchUps.filter(({roundNumber:$})=>$===s.roundLimit).length:0,O=g.length/k;if(!U){let $=fC(n),F=Ra(g,O),V=1,j=Rt(0,F[0].length).map(()=>{let B=Rt(V,V+F.length);return V+=F.length,B});({validSeedBlocks:o}=hle({drawPositionBlocks:F,nonRandom:n==null?void 0:n.nonRandom,positioning:$,seedGroups:j}))}}else S?{validSeedBlocks:o}=P_e({nonRandom:n==null?void 0:n.nonRandom,seedingProfile:n,structure:s}):U?o=b.map(k=>({seedNumbers:k,drawPositions:k})):M&&Ra(g,2).map((k,O)=>({drawPositions:[k[0]],seedNumbers:[O+1]})).forEach(k=>o.push(k));if(!S&&!M&&!P){let{blocks:k}=C_e({drawPositionOffset:v,seedNumberOffset:R,seedCountGoal:_,seedingProfile:n,baseDrawSize:y});k.forEach(O=>o.push(O))}let A=o.flatMap(k=>k.drawPositions).reduce((k,O)=>(g==null?void 0:g.includes(O))&&k,!0);return!M&&!U&&!S&&!A?{error:kre,validSeedBlocks:[],isContainer:S,isFeedIn:U}:{isLuckyStructure:M,validSeedBlocks:o,isContainer:S,isFeedIn:U}}function P_e({seedingProfile:t,structure:e,nonRandom:i}){var u;let n=e.structures||[],r=n.length,a=(u=jn({structure:e}))==null?void 0:u.positionAssignments,s=fC(t),o=(a==null?void 0:a.length)??0,{seedGroups:l}=f3({roundRobinGroupsCount:r,drawSize:o}),c=n.map(d=>{var p;return(p=jn({structure:d}).positionAssignments)==null?void 0:p.map(h=>h.drawPosition)});return hle({drawPositionBlocks:c,positioning:s,seedGroups:l,nonRandom:i})}function hle({drawPositionBlocks:t,positioning:e,seedGroups:i,nonRandom:n}){let r=[],{divisionGroupings:a}=E_e({size:i.length,positioning:e}),s=[];return i.forEach((o,l)=>{let c=D_e({blockPattern:a,index:l});o.forEach((u,d)=>{let p=l%2?t.length-d-1:d,h=t[p].slice().filter((m,g)=>c.includes(g+1)&&m);e!==Jv?h=n?h:so(h):l%2&&h.reverse();let f=h.find(m=>!s.includes(m));f&&(s.push(f),r.push({drawPositions:[f],seedNumbers:[u]}))})}),{validSeedBlocks:r}}function C_e(t){let{drawPositionOffset:e=0,roundRobinGroupsCount:i,seedNumberOffset:n=0,seedingProfile:r,seedCountGoal:a,baseDrawSize:s}=t,o=1,l=[],{seedBlocks:c}=h3({cluster:fC(r)===Ix,participantsCount:s,roundRobinGroupsCount:i});o=0;for(let d of c){if(o+1>a)break;let p=d.map(f=>f+e),h=u(o+1,d.length).map(f=>+f+n);o+=d.length,l.push({drawPositions:p,seedNumbers:h})}return{blocks:l};function u(d,p){return Array.from(new Array(p),(h,f)=>f+d)}}function ZA({appliedPolicies:t,drawDefinition:e,seedBlockInfo:i,drawPosition:n,structureId:r,seedNumber:a}){var l,c,u,d,p,h;let{structure:s}=hi({drawDefinition:e,structureId:r});t||(t=hn({drawDefinition:e}).appliedPolicies);let o=i==null?void 0:i.validSeedBlocks;return!o&&s&&(o=(l=ow({appliedPolicies:t,drawDefinition:e,structure:s}))==null?void 0:l.validSeedBlocks),(u=(c=t==null?void 0:t.seeding)==null?void 0:c.validSeedPositions)!=null&&u.ignore?!0:(p=(d=t==null?void 0:t.seeding)==null?void 0:d.validSeedPositions)!=null&&p.strict?(((h=o.find(f=>f.seedNumbers.includes(a)))==null?void 0:h.drawPositions)||[]).includes(n):[].concat(...o.map(f=>f.drawPositions)).includes(n)}function fle(t){var C,M,_;let{provisionalPositioning:e,drawDefinition:i,seedingProfile:n,seedBlockInfo:r,structureId:a,randomize:s}=t,{structure:o}=hi({drawDefinition:i,structureId:a}),{seedAssignments:l}=qc({returnAllProxies:t.returnAllProxies,provisionalPositioning:e,drawDefinition:i,structure:o}),{positionAssignments:c}=Ma({structure:o}),u=(C=c==null?void 0:c.filter(A=>A.participantId??A.bye??A.qualifier))==null?void 0:C.map(A=>A.drawPosition).filter(Boolean),{appliedPolicies:d}=hn({drawDefinition:i}),p=((r==null?void 0:r.validSeedBlocks)||o&&((M=ow({returnAllProxies:t.returnAllProxies,provisionalPositioning:e,appliedPolicies:d,drawDefinition:i,seedingProfile:n,structure:o}))==null?void 0:M.validSeedBlocks)||[]).filter(A=>A.drawPositions.filter(N=>!(u!=null&&u.includes(N))).length)[0],h=l==null?void 0:l.map(A=>A.participantId).filter(Boolean),f=c==null?void 0:c.map(A=>A.participantId).filter(Boolean),m=h==null?void 0:h.filter(A=>f==null?void 0:f.includes(A)),g=h==null?void 0:h.filter(A=>!(f!=null&&f.includes(A))),v=l==null?void 0:l.filter(A=>g==null?void 0:g.includes(A.participantId)),y=l==null?void 0:l.filter(A=>!A.participantId),b=(v!=null&&v.length&&v.length>0?v.length:(y==null?void 0:y.length)??0)&&(p==null?void 0:p.drawPositions.filter(A=>!(u!=null&&u.includes(A))))||[],I=s?so(b):b,T=[],w=I.map(()=>{var N;let A=(N=R(v,T))==null?void 0:N.participantId;return A&&T.push(A),A}).filter(Boolean),S=l==null?void 0:l.filter(A=>m==null?void 0:m.includes(A.participantId)).map(A=>A.seedNumber),U=((p==null?void 0:p.seedNumbers)||[]).filter(A=>!(S!=null&&S.includes(A))),P=l==null?void 0:l.filter(A=>U.includes(A.seedNumber)).map(A=>A.participantId),E=(_=d==null?void 0:d.seeding)==null?void 0:_.duplicateSeedNumbers;return{nextSeedBlock:p,unplacedSeedParticipantIds:E===void 0||E?w:P,unplacedSeedNumbers:U,unfilledPositions:I,unplacedSeedAssignments:v};function R(A,N){let k=A.filter(F=>!N.includes(F.participantId)),O=Math.min(...k.map(F=>HS(F.seedValue))),$=k.filter(F=>HS(F.seedValue)===O);return so($).pop()}}function fC(t){if(typeof t=="string")return t;if(typeof t=="object")return t.positioning}function fU({provisionalPositioning:t,tournamentRecord:e,drawDefinition:i,seedingProfile:n,participantId:r,seedBlockInfo:a,structureId:s,seedNumber:o,seedValue:l,eventId:c,event:u}){var T,w,S;let d="assignSeed",{structure:p}=hi({drawDefinition:i,structureId:s}),{positionAssignments:h}=Ma({structure:p}),f=qc({provisionalPositioning:t,drawDefinition:i,structure:p}).seedAssignments,m=f.map(U=>U.seedNumber),g=Lb({drawDefinition:i,participantId:r});if(r&&!g)return he({result:{error:Md},context:{participantId:r},stack:d});let v=u?(w=(T=_r({event:u}).flightProfile)==null?void 0:T.flights)==null?void 0:w.length:0,y=v&&v>1,b=(S=h==null?void 0:h.find(U=>U.participantId===r))==null?void 0:S.drawPosition;if(b&&!ZA({drawPosition:b,drawDefinition:i,seedBlockInfo:a,structureId:s,seedNumber:o}))return he({result:{error:gz},context:{assignedDrawPosition:b},info:"invalid seed position",stack:d});m.includes(o)||f.push({seedNumber:o,seedValue:l});let I;return f.forEach(U=>{U.participantId===r&&U.seedNumber!==o&&(U.participantId=void 0),U.seedNumber===o&&(U.participantId=r,!(n!=null&&n.groupSeedingThreshold)&&!y&&(U.seedValue=l??o),I=!0)}),I?(moe({tournamentId:e==null?void 0:e.tournamentId,drawDefinition:i,structure:p,eventId:c}),{...de}):he({result:{error:_re},stack:d})}function g3({inContextTargetMatchUp:t,drawPositionSideIndex:e,teamParticipantId:i,tournamentRecord:n,drawDefinition:r,matchUp:a,event:s}){var p,h,f,m;let o=(h=(p=t==null?void 0:t.sides)==null?void 0:p[e])==null?void 0:h.sideNumber,l=o&&((f=a.sides)==null?void 0:f.find(g=>g.sideNumber===o)),{extension:c}=ki({element:r,name:zf}),u=(c==null?void 0:c.value)||{},d=_t(u[i],!1,!0);if(l)(m=a==null?void 0:a.sides)==null||m.forEach(g=>{g.sideNumber===o&&(g.lineUp=d)});else{a.sides=[1,2].map(v=>{var y;return{...((y=a.sides)==null?void 0:y.find(b=>b.sideNumber===v))??{},sideNumber:v}});let g=a.sides.find(v=>v.sideNumber===o);g&&(g.lineUp=d)}Ji({tournamentId:n==null?void 0:n.tournamentId,context:"updateSidLineUp",eventId:s==null?void 0:s.eventId,drawDefinition:r,matchUp:a})}function mle(t){let{sourceMatchUp:e}=t,{targetMatchUp:i,structure:n,matchUpsMap:r,drawPosition:a}=t,s=i.roundNumber>1&&i.roundNumber-1,o=ny({structureId:n.structureId,matchUpsMap:r});!e&&a&&(e=o.find(({drawPositions:f,roundNumber:m})=>m===s&&(f==null?void 0:f.includes(a))));let l=e==null?void 0:e.roundPosition,c=l%2?1:-1,u=l+c,d=s&&o.find(({roundNumber:f,roundPosition:m})=>f===s&&m===u),p=d==null?void 0:d.matchUpStatus,h=[Yr,sa].includes(p);return{pairedPreviousMatchUp:d,pairedPreviousMatchUpIsDoubleExit:h}}function R_e({drawPosition:t,drawPositions:e}){let i=!1,n=!!(e!=null&&e.includes(t));return{updatedDrawPositions:n?e||[]:[...e,void 0,void 0].slice(0,2).map(r=>!r&&!n?(n=!0,i=!0,t):r).sort(ia).filter(Boolean),positionAdded:i,positionAssigned:n}}function gle({structureId:t,matchUpsMap:e,matchUp:i}){let n=i==null?void 0:i.roundPosition,r=n%2?1:-1,a=n+r;return{pairedPreviousMatchUp:ny({matchUpsMap:e,structureId:t}).find(({roundNumber:s,roundPosition:o})=>s===(i==null?void 0:i.roundNumber)&&o===a)}}function vle({inContextDrawMatchUps:t,sourceMatchUpStatus:e,sourceMatchUpId:i,matchUpsMap:n,matchUp:r}){let a=t.find(o=>o.matchUpId===i),{pairedPreviousMatchUp:s}=gle({structureId:a==null?void 0:a.structureId,matchUp:a,matchUpsMap:n});if(a&&s){let o=s==null?void 0:s.matchUpId,l=t.find(u=>u.matchUpId===o),c=(a==null?void 0:a.structureId)===(l==null?void 0:l.structureId)?(a==null?void 0:a.roundPosition)<(l==null?void 0:l.roundPosition)&&1||2:a.structureId===(l==null?void 0:l.structureId)&&2||1;r.matchUpStatusCodes=(r.matchUpStatusCodes??[]).map(u=>{let d=nr(u)||!isNaN(u)?{code:u}:u;return d.sideNumber===c?{...d,previousMatchUpStatus:e}:d})}}function GN({inContextDrawMatchUps:t,drawPosition:e,matchUpId:i}){let n=t.filter(({winnerMatchUpId:r,loserMatchUpId:a})=>a===i||r===i).sort((r,a)=>r.roundPosition-a.roundPosition);return t.find(r=>r.matchUpId===i).feedRound?1:n.reduce((r,a,s)=>{var o;return(o=a.drawPositions)!=null&&o.includes(e)?s+1:r},void 0)}function zS({inContextDrawMatchUps:t,sourceMatchUpStatus:e,tournamentRecord:i,sourceMatchUpId:n,drawDefinition:r,matchUpStatus:a,drawPosition:s,matchUpsMap:o,matchUpId:l,event:c}){var C,M,_,A;let u="assignMatchUpDrawPosition";o||(o=Ts({drawDefinition:r})),t||(t=ua({inContext:!0,drawDefinition:r,matchUpsMap:o}).matchUps??[]);let d=t.find(N=>N.matchUpId===l),p=d==null?void 0:d.structureId,h=(C=r==null?void 0:r.structures)==null?void 0:C.find(N=>N.structureId===p);if(!h)return{error:gr};let f=(M=o==null?void 0:o.drawMatchUps)==null?void 0:M.find(N=>N.matchUpId===l),m=(f==null?void 0:f.drawPositions)??[],{positionAdded:g,positionAssigned:v,updatedDrawPositions:y}=R_e({drawPositions:m,drawPosition:s}),{positionAssignments:b}=jn({drawDefinition:r,structure:h}),I=(_=b==null?void 0:b.filter(N=>y.includes(N.drawPosition)))==null?void 0:_.find(({bye:N})=>N),T=(f==null?void 0:f.matchUpStatus)&&[cn,Yi].includes(f.matchUpStatus)&&y.filter(Boolean).length<2;if(a=I&&mn||a||T&&f.matchUpStatus||(f==null?void 0:f.matchUpStatus)&&[Yr,sa].includes(f.matchUpStatus)&&f.matchUpStatus||Vr,f&&g){t=ua({inContext:!0,drawDefinition:r,matchUpsMap:o}).matchUps??[];let N=T&&GN({inContextDrawMatchUps:t,drawPosition:s,matchUpId:l})||void 0;f!=null&&f.matchUpStatusCodes&&vle({inContextDrawMatchUps:t,sourceMatchUpStatus:e,sourceMatchUpId:n,matchUpsMap:o,matchUp:f}),Object.assign(f,{drawPositions:y,winningSide:N,matchUpStatus:a}),Ji({tournamentId:i==null?void 0:i.tournamentId,eventId:d==null?void 0:d.eventId,context:u,drawDefinition:r,matchUp:f})}let w=mo({inContextDrawMatchUps:t,inContextMatchUp:d,drawDefinition:r,matchUpId:l}),{targetMatchUps:{winnerMatchUp:S,loserMatchUp:U,loserTargetDrawPosition:P},targetLinks:{loserTargetLink:E}}=w,R=ny({structureId:h.structureId,matchUpsMap:o});if(v&&I){if(S)if([mn,Yr,sa].includes(a)){let N=zS({matchUpId:S.matchUpId,inContextDrawMatchUps:t,tournamentRecord:i,drawDefinition:r,drawPosition:s,matchUpsMap:o});if(N.error)return N}else{let{structureId:N}=S;N!==h.structureId&&console.log("winnerMatchUp in different structure... participant is in different targetDrawPosition")}}else if(S&&d&&!d.feedRound){let{pairedPreviousMatchUpIsDoubleExit:N}=mle({targetMatchUp:f,drawPosition:s,matchUpsMap:o,structure:h});if(N){let k=zS({matchUpId:S.matchUpId,inContextDrawMatchUps:t,tournamentRecord:i,drawDefinition:r,drawPosition:s,matchUpsMap:o});if(k.error)return k}}if((f==null?void 0:f.matchUpType)===Zn){let N=t==null?void 0:t.find(({matchUpId:$})=>$===f.matchUpId),k=((N==null?void 0:N.sides)??[]).reduce(($,F,V)=>F.drawPosition===s?V:$,void 0),O=(A=b==null?void 0:b.find($=>$.drawPosition===s))==null?void 0:A.participantId;O&&k!==void 0&&g3({inContextTargetMatchUp:N,drawPositionSideIndex:k,teamParticipantId:O,tournamentRecord:i,drawDefinition:r,matchUp:f})}if((E==null?void 0:E.linkCondition)===Pp&&y.filter(Boolean).length===2&&!I&&R.filter(({drawPositions:N,roundNumber:k})=>k===1&&ho(N,y)).every(({matchUpStatus:N})=>[Lr,as].includes(N))&&U){let{structureId:N}=U,k=fc({drawPosition:P,tournamentRecord:i,drawDefinition:r,structureId:N,matchUpsMap:o,event:c});if(k.error)return k}return v?{...de}:he({result:{error:RS},context:{drawPosition:s},stack:u})}function yle({inContextDrawMatchUps:t,drawDefinition:e,assignments:i,matchUpsMap:n,structure:r}){var u,d,p,h;let a=((p=(d=(u=cU({drawDefinition:e}))==null?void 0:u.containedStructures)==null?void 0:d[r.structureId])==null?void 0:p.map(({structureId:f})=>f))||[];a.push(r==null?void 0:r.structureId);let s=(i==null?void 0:i.map(({drawPosition:f})=>f))||[],o=(t==null?void 0:t.filter(f=>a.includes(f.structureId)&&Nr(f.drawPositions??[],s).length))??[],l=o.map(({matchUpId:f})=>f),c=((h=n==null?void 0:n.drawMatchUps)==null?void 0:h.filter(f=>l.includes(f.matchUpId)))??[];return{drawPositions:s,matchUps:c,targetMatchUps:o}}function v3({lineUp:t}){if(!Array.isArray(t))return;let e={};return Ei(t.flatMap(({collectionAssignments:i})=>i==null?void 0:i.map(({collectionId:n,collectionPosition:r})=>[n,r].join("|"))).filter(Boolean)).forEach(i=>{let[n,r]=i.split("|"),a=parseInt(r),{assignedParticipantIds:s}=WA({collectionPosition:a,collectionId:n,lineUp:t});s.forEach(o=>{e[o]||(e[o]=[]),e[o].push({collectionId:n,collectionPosition:a})})}),Object.keys(e).map(i=>({participantId:i,collectionAssignments:e[i]}))}function sy(t){return`${t} must be an array`}function tO({lineUp:t,tieFormat:e}){let i=[];if(!Array.isArray(t))return i.push(sy("lineUp")),{valid:!1,errors:i,error:Re};let n=t.every(a=>{if(typeof a!="object")return i.push("lineUp entries must be objects"),!1;let{participantId:s,collectionAssignments:o}=a;return s?typeof s!="string"?(i.push("participantIds must be strings"),!1):Array.isArray(o)?o.every(l=>{if(typeof l!="object")return i.push("collectionAssignments must be objects"),!1;let{collectionPosition:c}=l;return typeof c!="number"?(i.push("collectionPosition must be a number"),!1):!0}):(i.push(sy("collectionAssignments")),!1):(i.push("Missing participantId"),!1)}),r=Ei(t.map(Vi)).length===t.length;return r||i.push("Duplicated participantId(s)"),{valid:n&&r,errors:i,error:i.length?Re:void 0}}function lw({drawDefinition:t,participantId:e,tieFormat:i,lineUp:n}){if(typeof t!="object")return{error:Gt};if(typeof e!="string")return{error:la};let r=tO({lineUp:n,tieFormat:i});if(!r.valid)return r;let{extension:a}=ki({element:t,name:zf}),s=(a==null?void 0:a.value)||{};return s[e]=v3({lineUp:n}),dn({element:t,extension:{name:zf,value:s}}),zP({drawDefinition:t}),{...de}}function y3({inContextDrawMatchUps:t,inheritance:e=!0,tournamentRecord:i,drawDefinition:n,matchUpsMap:r,assignments:a,structure:s,event:o}){if(!n)return{error:Gt};let{drawPositions:l,matchUps:c,targetMatchUps:u}=yle({inContextDrawMatchUps:t,matchUpsMap:r,assignments:a,structure:s});for(let d of u)d.matchUpType===ec&&(d.sides??[]).forEach((p,h)=>{var f;if(p!=null&&p.drawPosition&&(l!=null&&l.includes(p.drawPosition))){let m=c.find(({matchUpId:g})=>g===d.matchUpId);if((f=m==null?void 0:m.sides)!=null&&f[h]){if(delete m.sides[h].lineUp,e===!1){let g=d.tieFormat,v=p.participantId;g&&v&&lw({drawDefinition:n,participantId:v,lineUp:[],tieFormat:g})}Ji({tournamentId:i==null?void 0:i.tournamentId,context:"resetLineUps",eventId:o==null?void 0:o.eventId,drawDefinition:n,matchUp:m})}}});return{...de}}function Rp({provisionalPositioning:t,inContextDrawMatchUps:e,isQualifierPosition:i,sourceMatchUpStatus:n,tournamentRecord:r,drawDefinition:a,seedingProfile:s,participantId:o,seedBlockInfo:l,drawPosition:c,matchUpsMap:u,structureId:d,event:p}){var E,R,C,M,_;let h="assignDrawPosition";if(!o&&!i)return he({result:{error:la},stack:h});u=u??Ts({drawDefinition:a}),e||({matchUps:e}=ua({inContext:!0,drawDefinition:a,matchUpsMap:u}));let f=hi({drawDefinition:a,structureId:d});if(f.error)return he({result:f,stack:h});let{structure:m}=f;if(!m)return{error:gr};if(Vo({structure:m}))return he({result:{error:al},stack:h});let{seedAssignments:g}=qc({provisionalPositioning:t,drawDefinition:a,structure:m}),v=(E=g==null?void 0:g.find(A=>A.participantId===o))==null?void 0:E.seedNumber,{appliedPolicies:y}=hn({tournamentRecord:r,drawDefinition:a,structure:m,event:p});if(v&&!ZA({seedNumber:v,appliedPolicies:y,drawDefinition:a,seedBlockInfo:l,drawPosition:c,structureId:d}))return he({result:{error:gz},context:{drawPosition:c},stack:h});let b=Ma({structure:m}).positionAssignments||[],I=b==null?void 0:b.find(A=>A.drawPosition===c);if(!I)return he({result:{error:YT},context:{drawPosition:c},stack:h});if(b!=null&&b.map(Vi).includes(o))return he({result:{error:JT},context:{drawPosition:c},stack:h});let{containsParticipant:T,containsBye:w}=P(I);if(w){let A=lC({inContextDrawMatchUps:e,tournamentRecord:r,drawDefinition:a,drawPosition:c,structureId:d,matchUpsMap:u,event:p});if(A.error)return he({result:A,stack:h})}if(T&&I.participantId!==o){let{activeDrawPositions:A}=oC({drawDefinition:a,structureId:d});if(A.includes(c))return he({result:{error:ex},stack:h});y3({assignments:[I],inContextDrawMatchUps:e,tournamentRecord:r,drawDefinition:a,matchUpsMap:u,structure:m})}if(I.participantId=o,i&&(I.qualifier=!0),m.stage===Ft&&(!m.stageSequence||m.stageSequence>1)||m.stage&&[bs,Rr].includes(m.stage)){let A=m.stage===ni?ni:Ft,N=(((C=(R=a.structures)==null?void 0:R.find(k=>(k==null?void 0:k.stage)===A&&(k==null?void 0:k.stageSequence)===1))==null?void 0:C.seedAssignments)??[]).find(k=>k.participantId===o);if(N!=null&&N.participantId){let{participantId:k,seedNumber:O,seedValue:$}=N;fU({eventId:p==null?void 0:p.eventId,provisionalPositioning:t,tournamentRecord:r,drawDefinition:a,seedingProfile:s,participantId:k,seedNumber:O,seedValue:$,structureId:d,event:p})}}if(m.structureType!==So)M_e({provisionalPositioning:t,inContextDrawMatchUps:e,sourceMatchUpStatus:n,tournamentRecord:r,drawDefinition:a,drawPosition:c,matchUpsMap:u,structure:m,event:p});else{Zoe({positionAssignments:b,tournamentRecord:r,drawDefinition:a,matchUpsMap:u,structure:m});let{drawPositions:A,matchUps:N,targetMatchUps:k}=yle({assignments:[I],inContextDrawMatchUps:e,drawDefinition:a,matchUpsMap:u,structure:m});if(A&&(N==null?void 0:N.length)===1&&N[0].matchUpType===Zn){let O=((k==null?void 0:k[0].sides)??[]).reduce(($,F,V)=>A!=null&&A.includes(F.drawPosition)?V:$,void 0);g3({inContextTargetMatchUp:k[0],teamParticipantId:o,matchUp:N[0],drawPositionSideIndex:O,tournamentRecord:r,drawDefinition:a})}}let S=(M=a.entries)==null?void 0:M.find(A=>A.participantId===o),U=(_=p==null?void 0:p.entries)==null?void 0:_.find(A=>A.participantId===o);return!S&&U&&s3({entryStatus:U.entryStatus,entryStage:m.stage,ignoreStageSpace:!0,drawDefinition:a,participantId:o,event:p}),pg({tournamentId:r==null?void 0:r.tournamentId,drawDefinition:a,structure:m,event:p}),{positionAssignments:b,...de};function P(A){let N=A.bye,k=A.qualifier,O=A.participantId;return{containsBye:N,containsQualifier:k,containsParticipant:O,filled:N||k||O}}}function M_e({provisionalPositioning:t,inContextDrawMatchUps:e,sourceMatchUpStatus:i,tournamentRecord:n,drawDefinition:r,drawPosition:a,matchUpsMap:s,structure:o,event:l}){let c={isCollectionMatchUp:!1},{matchUps:u}=wn({provisionalPositioning:t,matchUpFilters:c,drawDefinition:r,matchUpsMap:s,structure:o,event:l}),{roundMatchUps:d}=fo({matchUps:u}),{initialRoundNumber:p}=pI({drawPosition:a,matchUps:u}),h=p&&(d==null?void 0:d[p].find(f=>{var m;return(m=f.drawPositions)==null?void 0:m.includes(a)}));if(h){let f=zS({matchUpId:h.matchUpId,inContextDrawMatchUps:e,sourceMatchUpStatus:i,tournamentRecord:n,drawDefinition:r,drawPosition:a,matchUpsMap:s});if(f.error)return he({stack:"assignDrawPositionToMatchUps",context:{drawPosition:a},result:f})}return{...de}}function b3(t){let{participantIdAttributeName:e="participantId",isQualifierPosition:i,positionActionName:n,tournamentRecord:r,drawDefinition:a,participantId:s,drawPosition:o,structureId:l,event:c}=t,u="positionParticipantAction";if(!a)return{error:Gt};let d=hn({tournamentRecord:r,drawDefinition:a,event:c}).appliedPolicies??{},{inContextDrawMatchUps:p,matchUpsMap:h}=t;h||(h=Ts({drawDefinition:a}),Object.assign(t,{matchUpsMap:h})),p||({matchUps:p}=ua({inContext:!0,drawDefinition:a,matchUpsMap:h}),Object.assign(t,{inContextDrawMatchUps:p}));let{positionAssignments:f}=jn({drawDefinition:a,structureId:l}),m=f==null?void 0:f.find(I=>I.drawPosition===o);if(m!=null&&m.participantId){let I=m.participantId,T=Rp({inContextDrawMatchUps:p,tournamentRecord:r,drawDefinition:a,participantId:s,drawPosition:o,structureId:l,matchUpsMap:h,event:c});return T.success?b({appliedPolicies:d,removedParticipantId:I}):he({result:T,stack:u})}let g=lC({inContextDrawMatchUps:p,tournamentRecord:r,drawDefinition:a,drawPosition:o,structureId:l,matchUpsMap:h,event:c});if(g.error)return he({result:g,stack:u});let v=g.participantId,y=Rp({inContextDrawMatchUps:p,isQualifierPosition:i,tournamentRecord:r,drawDefinition:a,participantId:s,drawPosition:o,structureId:l,matchUpsMap:h,event:c});if(!y.success)return he({result:y,stack:u});return b({appliedPolicies:d,removedParticipantId:v});function b({appliedPolicies:I,removedParticipantId:T}){let{structure:w}=hi({drawDefinition:a,structureId:l});jq({drawPositions:[o],structure:w});let S={[e]:s,name:n,drawPosition:o,structureId:l};return $x({appliedPolicies:I,drawDefinition:a,positionAction:S}),he({context:{removedParticipantId:T},result:{...de},stack:u})}}function N_e({luckyLoserParticipantId:t,tournamentRecord:e,drawDefinition:i,drawPosition:n,structureId:r}){return b3({positionActionName:"luckyLoserDrawPositionAssignment",participantId:t,tournamentRecord:e,drawDefinition:i,drawPosition:n,structureId:r})}function ble(t){return N_e(t)}function Ile({params:t,modMap:e,structure:i}){let{tournamentRecord:n,drawDefinition:r,event:a}=t;for(let s of i.matchUps)e[s.matchUpId]&&(s.roundNumber=e[s.matchUpId],Ji({tournamentId:n==null?void 0:n.tournamentId,eventId:a==null?void 0:a.eventId,drawDefinition:r,matchUp:s}))}function wle(t,e){let i=[{drawDefinition:!0,structureId:!0}];Array.isArray(e)&&i.push(...e);let n=Qt(t,i);if(n.error)return n;let r=hi(t);if(r.error)return r;let a=r.structure;if(!Vo({structure:a}))return he({result:{error:My,message:"structure must be adHoc"}});let{roundMatchUps:s=[],roundNumbers:o}=fo({matchUps:a==null?void 0:a.matchUps});return o!=null&&o.length?{valid:!0,structure:a,roundMatchUps:s,roundNumbers:o}:{error:ym}}function Sle(t){var u;let e=wle(t,[{targetRoundNumber:!0,roundNumber:!0,[qo]:RNe}]);if(e.error)return e;let{structure:i,roundMatchUps:n,roundNumbers:r}=e,{targetRoundNumber:a,roundNumber:s}=t;if(!(r!=null&&r.includes(s))||!(r!=null&&r.includes(a)))return he({result:{error:Re},info:"roundNumbers must be valid rounds"});let o=a>s,l=o?Rt(s+1,a+1):Rt(a,s),c={};return l.forEach(d=>((n==null?void 0:n[d])??[]).forEach(({matchUpId:p})=>{c[p]=d-(o?1:-1)})),(u=n==null?void 0:n[s])==null||u.forEach(({matchUpId:d})=>c[d]=a),Ile({params:t,modMap:c,structure:i}),{...de}}function Tle({structurePositionAssignments:t,provisionalPositioning:e,tournamentRecord:i,drawDefinition:n,event:r}){var o;if(!n)return{error:Gt};if(!Array.isArray(t))return{error:Re};let a="setPositionAssignments";for(let l of t){let{structureId:c,positionAssignments:u}=l;if(!u)continue;let d=hi({drawDefinition:n,structureId:c});if(d.error)return d;let p=d.structure;if(!p)return{error:gr};let h=(o=jn({structure:p}).positionAssignments)==null?void 0:o.map(({drawPosition:v})=>v),f=u==null?void 0:u.map(({drawPosition:v})=>v);if(Nr(h,f).length!==(h==null?void 0:h.length))return he({result:{error:Re},info:"drawPositions do not match",stack:a});let m=Ts({drawDefinition:n}),{matchUps:g}=ua({inContext:!0,drawDefinition:n,matchUpsMap:m});for(let v of u||[]){let{drawPosition:y,participantId:b,bye:I,qualifier:T}=v;if(I){let w=fc({tournamentRecord:i,drawDefinition:n,drawPosition:y,matchUpsMap:m,structureId:c,structure:p,event:r});if(w!=null&&w.error)return w}else if(T)u.forEach(w=>{w.drawPosition===y&&(w.qualifier=!0,delete w.participantId,delete w.bye)});else if(b){let w=Rp({provisionalPositioning:e,inContextDrawMatchUps:g,tournamentRecord:i,drawDefinition:n,participantId:b,drawPosition:y,matchUpsMap:m,structureId:c,event:r});if(w!=null&&w.error)return w}}pg({tournamentId:i==null?void 0:i.tournamentId,drawDefinition:n,structure:p,event:r})}let s=t.map(({structureId:l})=>l);return Hn({tournamentId:i==null?void 0:i.tournamentId,eventId:r==null?void 0:r.eventId,drawDefinition:n,structureIds:s}),{...de}}function Ule(t){let e=wle(t,[{roundNumbers:!0,[qo]:Rs,[ds]:s=>s.length===2&&s.every(Dr)}]);if(e.error)return e;let{structure:i,roundMatchUps:n,roundNumbers:r}=e;if(!t.roundNumbers.every(s=>r==null?void 0:r.includes(s)))return he({result:{error:Re,message:"roundNumbers must be valid rounds"}});let a={};return t.roundNumbers.forEach((s,o)=>((n==null?void 0:n[s])??[]).forEach(({matchUpId:l})=>{a[l]=t.roundNumbers[1-o]})),Ile({params:t,modMap:a,structure:i}),{...de}}function A_e({qualifyingParticipantId:t,tournamentRecord:e,drawDefinition:i,drawPosition:n,structureId:r}){return b3({positionActionName:"qualifierDrawPositionAssignment",participantId:t,isQualifierPosition:!0,tournamentRecord:e,drawDefinition:i,drawPosition:n,structureId:r})}function Dle(t){return A_e(t)}function Ele({alternateParticipantId:t,tournamentRecord:e,drawDefinition:i,drawPosition:n,structureId:r,event:a}){return b3({positionActionName:"alternateDrawPositionAssignment",participantIdAttributeName:"alternateParticipantid",participantId:t,tournamentRecord:e,drawDefinition:i,drawPosition:n,structureId:r,event:a})}function Ple({validation:t=!0,tournamentRecord:e,drawDefinition:i,participantId:n,structureId:r,seedValue:a,event:s}){if(!i)return{error:Gt};if(!r)return{error:uc};let o=((e==null?void 0:e.participants)??[]).find(p=>p.participantId===n);if(e&&!o)return{error:Md};let{structure:l}=hi({drawDefinition:i,structureId:r});if(!l)return{error:gr};if(!(!t||Dr(a)||a===void 0||a===""||typeof a=="string"&&a.split("-").every(p=>Dr(p)&&ui(p)>0)))return{error:Re};let{seedAssignments:c}=qc({drawDefinition:i,structure:l}),u=c==null?void 0:c.map(p=>p.seedNumber),d=c==null?void 0:c.find(p=>p.participantId===n);if(d){let p=typeof a=="string"?a.includes("-")&&a.split("-").map(h=>parseInt(h)).join("-")||parseInt(a)>0&&parseInt(a)||"":a&&a>0&&a||"";d.seedValue=p}else{let p={seedNumber:Math.max(0,...u||[])+1,participantId:n};a&&(p.seedValue=a),l.seedAssignments||(l.seedAssignments=[]),l.seedAssignments.push(p)}return moe({tournamentId:e==null?void 0:e.tournamentId,eventId:s==null?void 0:s.eventId,drawDefinition:i,structure:l}),{...de}}function Cle({drawDefinition:t,structureId:e}){if(!t)return{error:Gt};let{structure:i}=hi({drawDefinition:t,structureId:e}),n=((t==null?void 0:t.links)||[]).filter(r=>{var a;return((a=r.source)==null?void 0:a.structureId)===e}).map(r=>{var a;return(a=r.target)==null?void 0:a.structureId});return{playoffStructures:((t==null?void 0:t.structures)||[]).filter(r=>n.includes(r.structureId)),structure:i}}function iO({withStageGrouping:t,stageSequences:e,stageSequence:i,roundTarget:n,stages:r,event:a,stage:s}){if(!a)return{error:Jn};let o={},l=[];for(let c of a.drawDefinitions||[]){let{structures:u,stageStructures:d}=Wu({withStageGrouping:t,stageSequences:e,drawDefinition:c,stageSequence:i,roundTarget:n,stages:r,stage:s});if(l.push(...u),d)for(let p of Object.keys(d))o[p]||(o[p]=[]),o[p].push(...d[p])}return{structures:l,stageStructures:o}}function I3({withStageGrouping:t,tournamentRecord:e,stageSequences:i,stageSequence:n,roundTarget:r,stages:a,stage:s}){if(!e)return{error:ut};let o={},l=[];for(let c of e.events||[]){let{structures:u,stageStructures:d}=iO({withStageGrouping:t,stageSequences:i,stageSequence:n,roundTarget:r,stages:a,event:c,stage:s});if(u&&l.push(...u),d)for(let p of Object.keys(d))o[p]||(o[p]=[]),o[p].push(...d[p])}return{structures:l,stageStructures:o}}function fg(t){if(!(t!=null&&t.drawDefinition))return!1;let e=Xx(t),i=e==null?void 0:e.includesTeamMatchUps,{completedMatchUps:n,pendingMatchUps:r,upcomingMatchUps:a}=e||{};return i&&(n=n==null?void 0:n.filter(({matchUpType:s})=>s===Zn),r=r==null?void 0:r.filter(({matchUpType:s})=>s===Zn),a=a==null?void 0:a.filter(({matchUpType:s})=>s===Zn)),!!(n!=null&&n.length&&!(r!=null&&r.length)&&!(a!=null&&a.length))}function w3(t){var s,o;let{drawDefinition:e,structureId:i}=t;if(!e)return{error:Gt};let{playoffStructures:n}=Cle({drawDefinition:e,structureId:i});if(!(n!=null&&n.length))return!1;let r=((o=(s=e==null?void 0:e.entries)==null?void 0:s.filter(l=>(l==null?void 0:l.entryStatus)&&id.includes(l.entryStatus)))==null?void 0:o.length)??0,a=0;return(n||[]).reduce((l,c)=>{var u;return!!((u=jn({structure:c}).positionAssignments??[])!=null&&u.filter(d=>(d.participantId&&a++,(d==null?void 0:d.bye)??(d==null?void 0:d.participantId))).length&&l)},!!n.length)||a===r}function HV({significantCharacters:t,accessors:e=[],value:i}){let n=[],r=e[0];if(i!=null&&i[r]){let s=e.slice(1);if(Array.isArray(i[r]))i[r].forEach(o=>{let l=HV({accessors:s,significantCharacters:t,value:o});n.push(...l)});else if(i=i[r],s.length){let o=HV({accessors:s,significantCharacters:t,value:i});n.push(...o)}else a({value:i})}function a({value:s}){if(s&&["string","number"].includes(typeof s)){let o=t?s.slice(0,t):s;n.push(o)}}return n}function __e({targetParticipantIds:t,policyAttributes:e,idCollections:i,participants:n}){if(!Array.isArray(e))return{error:Ez};if(!Array.isArray(n))return{error:AP};let r={};return t.forEach(a=>{let s=n.find(l=>l.participantId===a),{values:o}=Rle({policyAttributes:e,idCollections:i,participants:n,participant:s});o&&o.forEach(l=>{r[l]||(r[l]=[]),r[l].includes(a)||r[l].push(a)})}),r}function Rle({policyAttributes:t,idCollections:e,participants:i,participant:n}){if(!Array.isArray(t))return{error:Ez};if(!n)return{error:GI};let r=[];return t.forEach(a=>{let{directive:s,groupings:o,key:l,significantCharacters:c}=a||{};if(l){let u=l.split(".");r.push(...HV({significantCharacters:c,value:n,accessors:u}))}else if(s){let u=a==null?void 0:a.includeIds,d=((e==null?void 0:e[s])||[]).filter(p=>!u||u.includes(p));d!=null&&d.length&&(i!=null&&i.length)&&d.forEach(p=>{var f;let h=i.find(m=>m.participantId===p);if((f=h==null?void 0:h.individualParticipantIds)!=null&&f.includes(n.participantId)){let m=h==null?void 0:h.participantId;r.push(m)}})}else o&&Object.keys(o).forEach(u=>{o[u].includes(n.participantId)&&r.push(u)})}),{values:Ei(r)}}function ZK({candidatePositionAssignments:t,participantsWithGroupings:e,policyAttributes:i,idCollections:n}){let r=Object.assign({},...e.map(a=>({[a.participantId]:a})));return t.map(a=>{let s=r[a.participantId],{values:o}=Rle({participants:e,policyAttributes:i,idCollections:n,participant:s});return{...a,values:o}})}function Mle({participantIdGroups:t,positionAssignments:e,groupsToAvoid:i}){return Object.assign({},...e.filter(n=>n==null?void 0:n.participantId).map(n=>{let{drawPosition:r,participantId:a}=n,s=t?t[a]||[]:[],o=!!i.some(l=>s.includes(l));return{[r]:{participantGroups:s,includesGroupsToAvoid:o}}}))}function k_e(t){let{unfilledPositions:e,chunkedDrawPositions:i}=t,n=Mle(t);return i.map(a=>{let s=e.filter(c=>a.includes(c)),o=r(s),l=s.filter(c=>!o.includes(c)).filter(c=>{var d;let u=XK(c);return!((d=n[u])!=null&&d.includesGroupsToAvoid)});return{unassigned:s,unpaired:o,pairedNoConflict:l}});function r(a){return a.filter(o=>!s(o));function s(o){let l=XK(o);return!a.includes(l)}}}function x_e(t){let{unfilledPositions:e,chunkedDrawPositions:i}=t,n=Mle(t);return i.map(r=>{let a=e.filter(l=>r.includes(l)),s=a.length===r.length?a:[],o=r.filter(l=>{var c;return(c=n[l])==null?void 0:c.includesGroupsToAvoid}).length;return{unassigned:a,unpaired:s,pairedNoConflict:o?[]:a,conflictsCount:o}})}function XK(t){return Number(t%2?t+1:t-1)}function O_e({allGroups:t,participantId:e}){return Object.keys(t).filter(i=>t[i].includes(e))}function L_e({selectedParticipantGroups:t,participantIdGroups:e,positionAssignments:i,drawPositionChunks:n,unfilledPositions:r,isRoundRobin:a}){let s=n.map(o=>a?x_e({groupsToAvoid:t,chunkedDrawPositions:o,participantIdGroups:e,positionAssignments:i,unfilledPositions:r}):k_e({groupsToAvoid:t,chunkedDrawPositions:o,participantIdGroups:e,positionAssignments:i,unfilledPositions:r}));if(a){let o=s.map(u=>u.map(d=>d.unassigned).filter(d=>d==null?void 0:d.length)).filter(u=>u==null?void 0:u.length).sort((u,d)=>(d.length||0)-(u.length||0)),l=s.map(u=>u.map(d=>d.unpaired).filter(d=>d==null?void 0:d.length)).filter(u=>u==null?void 0:u.length),c=s.map(u=>u.map(d=>d.pairedNoConflict).filter(d=>d==null?void 0:d.length)).filter(u=>u==null?void 0:u.length).sort((u,d)=>(d.length||0)-(u.length||0));return{unassigned:o,unpaired:l,pairedNoConflict:c}}else{let o=s.map(u=>u.map(d=>d.unassigned).filter(d=>d==null?void 0:d.length)).filter(u=>u==null?void 0:u.length),l=s.map(u=>u.map(d=>d.unpaired).filter(d=>d==null?void 0:d.length)).filter(u=>u==null?void 0:u.length),c=s.map(u=>u.map(d=>d.pairedNoConflict).filter(d=>d==null?void 0:d.length)).filter(u=>u==null?void 0:u.length);return{unassigned:o,unpaired:l,pairedNoConflict:c}}}function Nle({positionAssignments:t,participantIds:e}){let i=t.map(n=>n.participantId);return e.filter(n=>!i.includes(n))}function F_e({useSpecifiedGroupKey:t=!1,targetParticipantIds:e,largestFirst:i=!0,allGroups:n,groupKey:r}){var c;let a=Object.assign({},...Object.keys(n).map(u=>[u,n[u].filter(d=>e.includes(d))]).filter(u=>u[1].length).map(([u,d])=>({[u]:d}))),s=Object.keys(a).reduce((u,d)=>a[d].length>u?a[d].length:u,0),o=Object.keys(a).filter(u=>a[u].length===s),l=wl(i?o:Object.keys(a));return r=t&&((c=a[r])!=null&&c.length)?r:l,{participantId:r&&a[r]?wl(a[r]):wl(e),groupKey:r}}function $_e({drawPositionGroups:t,positionAssignments:e}){let i=Object.assign({},...e.map(n=>({[n.drawPosition]:n})));return t.map(n=>n.filter(Boolean).map(r=>i[r]).filter(Boolean).filter(r=>!r.participantId&&!r.bye).map(r=>r.drawPosition)).flat().filter(Boolean)}function B_e({candidatePositionAssignments:t,unseededParticipantIds:e,participantIdGroups:i,drawPositionChunks:n,drawPositionGroups:r,pairedPriority:a,allGroups:s,groupKey:o}){let l=r.reduce((U,P)=>P.length>U?P.length:U,0)<=2,c=Nle({positionAssignments:t,participantIds:e}),u=$_e({positionAssignments:t,drawPositionGroups:r}),{participantId:d,groupKey:p}=F_e({targetParticipantIds:c,useSpecifiedGroupKey:l,allGroups:s,groupKey:o}),h=O_e({participantId:d,allGroups:s}),f=L_e({positionAssignments:t,isRoundRobin:l,selectedParticipantGroups:h,participantIdGroups:i,drawPositionChunks:n,unfilledPositions:u}),{unassigned:m,unpaired:g,pairedNoConflict:v}=f,y=(v==null?void 0:v.length)&&v[0],b=(g==null?void 0:g.length)&&g[0],I=a&&y?y:b,T=a?b:y,w=(I==null?void 0:I.length)&&I||(T==null?void 0:T.length)&&T,S;if(w!=null&&w.length){let U=Tl(w);S=Tl(U)}else{let U=Tl(m[0]);S=Tl(U)}return{newGroupKey:p,selectedParticipantId:d,targetDrawPosition:S}}function XA({isRoundRobin:t,groupedParticipants:e}){let i=[];return t?e.forEach(n=>{let r=n.map(o=>o.drawPosition),a=p3({drawPositions:r}).uniqueMatchUpGroupings??[],s=Object.assign({},...n.map(o=>({[o.drawPosition]:o})));a.forEach(o=>{ho(s[o[0]].values||[],s[o[1]].values||[])&&(i.push(o),n.conflict=!0)})}):e.forEach(n=>{var r,a;ho(((r=n[0])==null?void 0:r.values)||[],((a=n[1])==null?void 0:a.values)||[])&&(i.push(n),n.conflict=!0)}),i}function V_e({positionedParticipants:t,potentialDrawPositions:e,drawPositionGroups:i,avoidanceConflicts:n,isRoundRobin:r}){return n.map(a=>{let s=a.map(o=>o.drawPosition);return a.filter(o=>e.includes(o.drawPosition)).map(o=>{let l=e.filter(c=>!(s!=null&&s.includes(c))).filter(c=>{let u=i.find(m=>m.includes(c)).find(m=>m!==c),d=t.find(m=>m.drawPosition===u),p=XA({isRoundRobin:r,groupedParticipants:[[o,d]]}),h=[t.find(m=>m.drawPosition===c),d],f=XA({isRoundRobin:r,groupedParticipants:[h]});return!p.length&&!f.length});if(l.length)return{drawPosition:o.drawPosition,possibleDrawPositions:l}}).filter(Boolean)}).flat(1)}function JK(t){let{initialPositionAssignments:e,participantsWithGroupings:i,opponentsToPlaceCount:n,unseededByePositions:r,drawPositionGroups:a,policyAttributes:s,idCollections:o,allGroups:l}=t,c=[],u,d=Math.min(...(a||[]).map(b=>b==null?void 0:b.length).filter(Boolean)),p=d>2,h=_t(e,!1,!0).filter(b=>!b.qualifier),f=e.filter(b=>!b.participantId&&(!b.bye||(r==null?void 0:r.includes(b.drawPosition)))).map(b=>b.drawPosition);Rt(0,n).forEach(()=>{let{newGroupKey:b,selectedParticipantId:I,targetDrawPosition:T}=B_e({...t,candidatePositionAssignments:h,allGroups:l,groupKey:u});u=b,h.forEach(w=>{w.drawPosition===T&&(w.participantId=I)})});let m=ZK({candidatePositionAssignments:h,participantsWithGroupings:i,policyAttributes:s,idCollections:o}),g=Ra(m,d),v=XA({groupedParticipants:g,isRoundRobin:p}),y=0;for(;y<20&&v.length;){let b=V_e({positionedParticipants:m,potentialDrawPositions:f,avoidanceConflicts:v,drawPositionGroups:a,isRoundRobin:p});if(b.length){let I=j_e({candidatePositionAssignments:h,swapOptions:b});I.error&&console.log({result:I}),m=ZK({candidatePositionAssignments:h,participantsWithGroupings:i,policyAttributes:s,idCollections:o}),g=Ra(m,d),v=XA({groupedParticipants:g,isRoundRobin:p}),y++}else y=20}return h.forEach(b=>{if(b.bye&&b.participantId){let I=SV;c.push(I)}if(b.qualifier&&b.participantId){let I=SV;c.push(I)}}),{positionAssignments:h,conflicts:v.length,groupedParticipants:g,errors:c}}function j_e({candidatePositionAssignments:t,swapOptions:e}){let i=Tl(e);if(!i)return{error:{message:"No swap options"}};let n=i.drawPosition,r=Tl(i.possibleDrawPositions),a=t.find(c=>c.drawPosition===n),s=t.find(c=>c.drawPosition===r)??{},o={participantId:s==null?void 0:s.participantId,qualifier:s==null?void 0:s.qualifier,bye:s==null?void 0:s.bye},l={participantId:a.participantId,qualifier:a.qualifier,bye:a.bye};return Object.assign(a,o),Object.assign(s,l),{...de}}function G_e({provisionalPositioning:t,unseededParticipantIds:e,inContextDrawMatchUps:i,unseededByePositions:n,tournamentRecord:r,drawDefinition:a,seedBlockInfo:s,participants:o,matchUpsMap:l,structureId:c,avoidance:u,drawSize:d,event:p}){var V;if(!u)return{error:zre};let{candidatesCount:h=1,policyAttributes:f,targetDivisions:m}=u,{roundsToSeparate:g}=u,v="randomUnseededSeparation",{structure:y}=hi({drawDefinition:a,structureId:c}),{matchUps:b}=wn({provisionalPositioning:t,matchUpsMap:l,structure:y,event:p});if(m&&Rd(m)&&!g){let j=FRe(m)||0,B=b.reduce((z,W)=>W.roundNumber>z?W.roundNumber:z,0);g=B<j?1:B-j+1}let{positionAssignments:I}=Ma({structure:y}),T=Vx({participantsProfile:{convertExtensions:!0},deepCopy:!1,participants:o}).participantsWithGroupings,w=I==null?void 0:I.filter(j=>!j.participantId),S=I==null?void 0:I.map(j=>j.drawPosition),U=(y==null?void 0:y.structureType)===So,P=U?{structure:y,matchUps:b,allDrawPositions:S,roundsToSeparate:g}:{matchUps:b,allDrawPositions:S,roundsToSeparate:g},{drawPositionGroups:E,drawPositionChunks:R}=U?H_e(P):z_e(P),C={groupParticipants:o.filter(j=>j.participantType===pc).map(j=>j.participantId),teamParticipants:o.filter(j=>j.participantType===En).map(j=>j.participantId),pairParticipants:o.filter(j=>j.participantType===Ni).map(j=>j.participantId)},M=__e({targetParticipantIds:e,policyAttributes:f,idCollections:C,participants:o});if(M.error)return he({result:M,stack:v});let _=Object.assign({},...e.map(j=>{let B=Object.keys(M).filter(z=>(M[z]??[]).includes(j));return{[j]:B}})),A=Nle({participantIds:e,positionAssignments:I});if(A.length>((w==null?void 0:w.length)||0))return{error:Nz};let N,k=A.length,O=Rt(0,h).map(()=>JK({initialPositionAssignments:I,participantsWithGroupings:T,unseededParticipantIds:e,opponentsToPlaceCount:k,pairedPriority:!1,unseededByePositions:n,participantIdGroups:_,drawPositionChunks:R,drawPositionGroups:E,policyAttributes:f,idCollections:C,allGroups:M,drawSize:d}));if(N=O.reduce((j,B)=>!j||(B.conflicts||0)<(j.conflicts||0)?B:j,void 0),!N||N.conflicts){let j=Rt(0,h).map(()=>JK({initialPositionAssignments:I,participantsWithGroupings:T,unseededParticipantIds:e,opponentsToPlaceCount:k,pairedPriority:!0,unseededByePositions:n,participantIdGroups:_,drawPositionChunks:R,drawPositionGroups:E,policyAttributes:f,idCollections:C,allGroups:M,drawSize:d}));N=O.concat(...j).filter(B=>{var z;return!((z=B.errors)!=null&&z.length)}).reduce((B,z)=>!B||(z.conflicts||0)<(B.conflicts||0)?z:B,void 0)}if(!N)return{error:cx};let $=(((V=jn({structure:y}))==null?void 0:V.positionAssignments)??[]).filter(j=>j.participantId).map(j=>j.participantId),F=N.positionAssignments.filter(j=>!$.includes(j.participantId));for(let j of F)if(j.bye){let B=fc({tournamentRecord:r,drawDefinition:a,seedBlockInfo:s,structureId:c,matchUpsMap:l,event:p,...j});if(B.error)return he({result:B,stack:v})}else if(j.participantId){let B=Rp({automaticPlacement:!0,inContextDrawMatchUps:i,tournamentRecord:r,drawDefinition:a,seedBlockInfo:s,structureId:c,matchUpsMap:l,event:p,...j});if(B.error)return he({result:B,stack:v,context:{assignment:j}})}return{...de}}function H_e(t){let{structure:{structures:e}}=t,i=e.map(n=>n.positionAssignments.map(r=>r.drawPosition));return{drawPositionGroups:i,drawPositionChunks:[i]}}function z_e({allDrawPositions:t,roundsToSeparate:e,matchUps:i}){let n=i.filter(u=>u.roundNumber===1).map(u=>u.drawPositions),r=n.flat().sort(ia),a=Math.max(...r),s=t.filter(u=>u>a),o=r.length,l=Rt(o===2?1:2,o).filter(u=>u===fz(u)),c=l.slice(0,e||l.length).reverse().map(u=>Ra(r,u));return s.length&&console.log({fedDrawPositions:s}),{drawPositionGroups:n,drawPositionChunks:c}}function q_e({provisionalPositioning:t,inContextDrawMatchUps:e,unseededByePositions:i,multipleStructures:n,tournamentRecord:r,drawDefinition:a,seedBlockInfo:s,participants:o,matchUpsMap:l,structureId:c,structure:u,drawSize:d,event:p}){var P,E;let h="positionUnseededParticipants";u||({structure:u}=hi({drawDefinition:a,structureId:c})),c||({structureId:c}=u);let{positionAssignments:f}=Ma({structure:u}),{seedAssignments:m}=qc({provisionalPositioning:t,drawDefinition:a,structure:u}),g=m==null?void 0:m.map(R=>R.participantId).filter(Boolean),{stage:v,stageSequence:y}=u,b=v===ni?(E=(P=ki({element:u,name:Hp}))==null?void 0:P.extension)==null?void 0:E.value:void 0,I=XI({provisionalPositioning:t,drawDefinition:a,stageSequence:y,entryStatuses:By,structureId:c,roundTarget:b,stage:v}),T=I.filter(R=>!(g!=null&&g.includes(R.participantId))).map(R=>R.participantId),w=f==null?void 0:f.filter(R=>!R.participantId&&!R.bye&&!R.qualifier).map(R=>R.drawPosition);if(!n&&T.length>((w==null?void 0:w.length)||0))return he({result:{error:Nz},context:{unseededParticipantsCount:T.length,unfilledDrawPositionsCount:w==null?void 0:w.length},stack:h});let{appliedPolicies:S}=hn({tournamentRecord:r,drawDefinition:a,event:p}),U=S==null?void 0:S[sE];if(u.stage===Rr){let R=I.reduce((C,M)=>(C[M.groupingValue]||(C[M.groupingValue]=[]),C[M.groupingValue].push(M.participantId),C),{});Object.keys(R).length&&(U||(U={policyName:"Playoff Avoidance"}),U.policyAttributes||(U.policyAttributes=[]),U.policyAttributes.push({groupings:R}))}return U&&o?G_e({provisionalPositioning:t,unseededParticipantIds:T,inContextDrawMatchUps:e,unseededByePositions:i,tournamentRecord:r,drawDefinition:a,seedBlockInfo:s,participants:o,matchUpsMap:l,structureId:c,avoidance:U,drawSize:d,entries:I}):W_e({provisionalPositioning:t,unseededParticipantIds:T,inContextDrawMatchUps:e,unfilledDrawPositions:w,multipleStructures:n,tournamentRecord:r,drawDefinition:a,seedBlockInfo:s,structureId:c,matchUpsMap:l,drawSize:d,event:p})}function W_e({provisionalPositioning:t,unseededParticipantIds:e,inContextDrawMatchUps:i,unfilledDrawPositions:n,multipleStructures:r,tournamentRecord:a,drawDefinition:s,seedBlockInfo:o,matchUpsMap:l,structureId:c,drawSize:u,event:d}){let p=u>2?so(n):n.reverse();for(let h of e){let f=p.pop();if(!r||f){let m=Rp({provisionalPositioning:t,inContextDrawMatchUps:i,tournamentRecord:a,drawDefinition:s,seedBlockInfo:o,participantId:h,drawPosition:f,matchUpsMap:l,structureId:c,event:d});if(m!=null&&m.error&&console.log("!!!!!",{result:m}),m==null?void 0:m.error)return he({result:m,stack:"randomUnseededDistribution"})}}return{...de}}function Y_e(t){let e=t.structure??hi(t).structure,i="positionQualifiers",n=[];if(e.stage===bs)return he({result:{error:Ay},stack:i});let{unplacedRoundQualifierCounts:r,positionAssignments:a,roundDrawPositions:s}=K_e(t);for(let o of Object.keys(r)){let l=a==null?void 0:a.filter(c=>s[o].includes(c.drawPosition)&&!c.participantId&&!c.qualifier&&!c.bye).map(c=>c.drawPosition);if(r[o]>(l||0))return he({result:{error:uae},context:{unfilledDrawPositions:l},stack:i});Rt(0,r[o]).forEach(()=>{let c=Tl(l);n.push(c),a==null||a.forEach(u=>{u.drawPosition===c&&(u.qualifier=!0,delete u.participantId,delete u.bye)})})}return{...de,qualifierDrawPositions:n}}function K_e({drawDefinition:t,structure:e,structureId:i}){e||({structure:e}=hi({drawDefinition:t,structureId:i})),i||({structureId:i}=e);let{positionAssignments:n}=Ma({structure:e}),{stage:r,stageSequence:a}=e,{qualifiersCount:s,roundQualifiersCounts:o}=pU({drawDefinition:t,stageSequence:a,structureId:i,stage:r}),l=(o?Object.keys(o):[]).map(m=>ui(m)),{matchUps:c}=wn({structure:e}),{roundProfile:u}=fo({matchUps:c}),d=Object.assign({},...l.filter(m=>u==null?void 0:u[m]).map(m=>{var g,v;return{[m]:((v=(g=u==null?void 0:u[m])==null?void 0:g.drawPositions)==null?void 0:v.filter(Boolean))??[]}})),p=n==null?void 0:n.filter(m=>m.qualifier).map(m=>m.drawPosition),h=s-((p==null?void 0:p.length)??0),f=p==null?void 0:p.length;return{unplacedRoundQualifierCounts:Object.assign({},...l.map(m=>{let g=n==null?void 0:n.filter(v=>{var y,b;return v.qualifier&&((b=(y=d[m])==null?void 0:y.drawPositions)==null?void 0:b.includes(v.drawPosition))}).map(v=>v.drawPosition);return{[m]:((o==null?void 0:o[m])??0)-((g==null?void 0:g.length)??0)}})),unplacedQualifiersCount:h,placedQualifiersCount:f,roundQualifiersCounts:o,positionAssignments:n,roundDrawPositions:d,qualifiersCount:s}}function QK({provisionalPositioning:t,inContextDrawMatchUps:e,tournamentRecord:i,appliedPolicies:n,validSeedBlocks:r,drawDefinition:a,seedingProfile:s,seedBlockInfo:o,participants:l,groupsCount:c,structureId:u,matchUpsMap:d,structure:p,event:h}){let f=[],m=[],g=0;if(p||({structure:p}=hi({drawDefinition:a,structureId:u})),u||(u=p==null?void 0:p.structureId),n||(n=hn({drawDefinition:a}).appliedPolicies),!r){let v=p&&ow({provisionalPositioning:t,appliedPolicies:n,drawDefinition:a,seedingProfile:s,structure:p});v!=null&&v.error&&m.push(v.error),r=v==null?void 0:v.validSeedBlocks}return c=c??(r==null?void 0:r.length)??0,Rt(0,c).forEach(()=>{if(g<(c||0)){let v=Z_e({provisionalPositioning:t,inContextDrawMatchUps:e,tournamentRecord:i,drawDefinition:a,seedingProfile:s,seedBlockInfo:o,participants:l,structureId:u,matchUpsMap:d,event:h});v!=null&&v.success&&(g++,f.push(...v.seedPositions??[])),v.error&&m.push({seedPositionError:v.error})}}),m.length?{error:m}:{...de,seedPositions:f}}function Z_e({provisionalPositioning:t,inContextDrawMatchUps:e,tournamentRecord:i,drawDefinition:n,seedingProfile:r,seedBlockInfo:a,participants:s,structureId:o,matchUpsMap:l,event:c}){let{unplacedSeedParticipantIds:u,unfilledPositions:d}=fle({provisionalPositioning:t,randomize:!0,drawDefinition:n,seedingProfile:r,seedBlockInfo:a,structureId:o,event:c}),{appliedPolicies:p}=hn({drawDefinition:n}),{avoidance:h}=p??{};h&&s&&(u==null?void 0:u.length)>2;let f=[];for(let m of u){let g=d.pop();if(!g)return{error:KT};f.push(g);let v=Rp({provisionalPositioning:t,inContextDrawMatchUps:e,tournamentRecord:i,drawDefinition:n,seedingProfile:r,participantId:m,seedBlockInfo:a,drawPosition:g,matchUpsMap:l,structureId:o,event:c});if(!v.success)return v}return{...de,seedPositions:f}}function X_e({provisionalPositioning:t,drawDefinition:e,structure:i}){let{positionAssignments:n}=Ma({structure:i}),{seedAssignments:r}=qc({provisionalPositioning:t,drawDefinition:e,structure:i}),a=Object.assign({},...(r||[]).filter(s=>s.participantId).map(s=>({[s.participantId]:s})));return n==null?void 0:n.map(s=>a[s.participantId]?{...s,seedNumber:a[s.participantId].seedNumber,seedValue:a[s.participantId].seedValue}:"").filter(Boolean)}function J_e({orderedSortedFirstRoundSeededDrawPositions:t,validSeedBlocks:e,byesToPlace:i}){let n=[];e.forEach(a=>{if(i-n.length>a.drawPositions.length)n.push(...a.drawPositions);else{let s=zV(Ra(a.drawPositions,2)),o,l=t[n.length];for(;o=HN(s,l);)n.push(o),l=t[n.length]}});let r=n.map(a=>Array.isArray(a)?so(a):a).flat(1/0);return pre(i)&&e.map(a=>a.seedNumbers[0]).includes(i)?t:r}function HN(t,e){if(Array.isArray(t)&&t.length!==2)return t.pop();if(!Array.isArray(t[0]))return t.includes(e)?t.indexOf(e)?t.pop():t.shift():Math.round(Math.random())?t.pop():t.shift();let i=t[0].flat(1/0).length,n=t[1].flat(1/0).length;if(i===n){let r=t[0].flat(1/0).includes(e)?t[0]:t[1];return HN(e?r:t[Math.round(Math.random())],e)}return i<n?HN(t[1],e):HN(t[0],e)}function zV(t){let e=Math.floor(t.length/2);return t.length>2?[zV(t.slice(0,e)),zV(t.slice(e))]:t}function Q_e({provisionalPositioning:t,relevantMatchUps:e,appliedPolicies:i,drawDefinition:n,seedingProfile:r,seedBlockInfo:a,byesToPlace:s,structure:o}){var I;a||(a=ow({provisionalPositioning:t,appliedPolicies:i,drawDefinition:n,seedingProfile:r,structure:o}));let{isFeedIn:l,isLuckyStructure:c,isContainer:u}=a,{validSeedBlocks:d}=a;(I=i==null?void 0:i.seeding)!=null&&I.containerByesIgnoreSeeding&&(d=[]);let p=X_e({provisionalPositioning:t,drawDefinition:n,structure:o})??[],h=Ei([].concat(...e.map(T=>T.drawPositions))),f=p.filter(T=>h.includes(T.drawPosition)),m=(T,w)=>HS(T.seedValue)-HS(w.seedValue),g=d.reduce((T,w)=>{let S=f.filter(U=>{var P;return(P=w.drawPositions)==null?void 0:P.includes(U.drawPosition)}).sort(m);return T.concat(...S)},[]).map(T=>T.drawPosition),v=J_e({orderedSortedFirstRoundSeededDrawPositions:g,validSeedBlocks:d,byesToPlace:s}),y=eZ({orderedSeedDrawPositions:g,relevantMatchUps:e}).slice(0,s),b=eZ({orderedSeedDrawPositions:v,relevantMatchUps:e}).slice(0,s);return{strictSeedOrderByePositions:y,blockSeedOrderByePositions:b,isLuckyStructure:c,positionedSeeds:p,isContainer:u,isFeedIn:l}}function eZ({orderedSeedDrawPositions:t,relevantMatchUps:e}){let i=e.map(n=>n.drawPositions).map(n=>n==null?void 0:n.sort((r,a)=>r-a)).filter(n=>(n==null?void 0:n[0])+1===(n==null?void 0:n[1]));return t.map(n=>i.find(r=>r==null?void 0:r.includes(n))).filter(Boolean).map(n=>n==null?void 0:n.reduce((r,a)=>t.includes(a)?r:a,void 0)).filter(Boolean)}function eke({provisionalPositioning:t,seedOrderByePositions:e,isLuckyStructure:i,appliedPolicies:n,drawDefinition:r,seedLimit:a,structure:s,isFeedIn:o}){var A,N;let l=(A=n==null?void 0:n.seeding)==null?void 0:A.seedingProfile,c=s.stage===ni,{positionAssignments:u}=Ma({structure:s}),d=u==null?void 0:u.filter(k=>k.participantId).map(k=>k.drawPosition),p={isCollectionMatchUp:!1},{matchUps:h,roundMatchUps:f}=wn({provisionalPositioning:t,matchUpFilters:p,structure:s}),m=(f==null?void 0:f[1])||[],g=s.structureType===So?h:m,v=Ei([].concat(...g.map(k=>k.drawPositions))),y=Math.min(...v)-1,b=d==null?void 0:d.filter(k=>v.includes(k)),I=k=>{let O=Math.ceil(k.length/2),$=[k.slice(0,O),k.slice(O)],F=$.map(Q=>[].concat(...Q.flat(1/0)).length),V=Math.min(...F.flat(1/0)),j=Math.max(...F.flat(1/0)),B=F.indexOf(j),z=V!==j,W=so($),[Z,K]=!V||z?[$[B],$[1-B]]:[W[0],W[1]];return{greaterHalf:Z,lesserHalf:K}},T=k=>{let{greaterHalf:O,lesserHalf:$}=I(k),{greaterHalf:F,lesserHalf:V}=I(O),j=so(F.flat(1/0)).pop(),B=F.flat().filter(z=>z!==j);return{newlyFilteredChunks:[...$,...V,B],drawPosition:j}},w=k=>!e.includes(k),S=k=>!(b!=null&&b.includes(k)),U=k=>{let O=Ra(k.sort(ia),Math.ceil(k.length/4)).map(V=>V.filter(S)),$=[].concat(...O.flat(1/0)).length,F=[];for(let V=0;V<$;V++){let{newlyFilteredChunks:j,drawPosition:B}=T(O);F.push(B),O=j}return F},{validSeedBlocks:P}=ow({provisionalPositioning:t,allPositions:!0,appliedPolicies:n,drawDefinition:r,structure:s}),E=P==null?void 0:P.map(k=>{var O;return(O=k.drawPositions)==null?void 0:O.map($=>$+y)}),R;if(o){let k=v.length,{seedBlocks:O}=h3({cluster:fC(l)===Ix,participantsCount:k});R=O.map($=>$.map(F=>F+y)).map(U).filter($=>$.length)}else c?R=E==null?void 0:E.map(k=>k.filter(S)):R=E==null?void 0:E.map(U).filter(k=>k.length);let C=g.map(k=>k.drawPositions).map(k=>k==null?void 0:k.sort((O,$)=>O-$)).filter(k=>(k==null?void 0:k[0])+1===(k==null?void 0:k[1])),M=k=>C.reduce((O,$)=>$.includes(k)?$.reduce((F,V)=>V!==k?V:F,void 0):O,void 0),_=R.map(k=>k.map(M)).flat(1/0).filter(S).filter(w).filter(Boolean);if(c&&!s.structures){let k=a%4,O=_.slice(0,k),$=(N=f[s.roundLimit])==null?void 0:N.length,F=Ra(_.slice(k),$).map(so).flat();_=O.concat(F)}return{unseededByePositions:_}}function tke({provisionalPositioning:t,drawDefinition:e,matchUpsMap:i,structure:n,event:r}){var E;let a={isCollectionMatchUp:!1},{matchUps:s,roundMatchUps:o}=wn({afterRecoveryTimes:!1,provisionalPositioning:t,drawDefinition:e,matchUpFilters:a,matchUpsMap:i,structure:n,event:r}),l=(o==null?void 0:o[1])||[],c=(n==null?void 0:n.structureType)===So,u=c?s:l,d=c?((E=n==null?void 0:n.structures)==null?void 0:E.length)||0:s.length,{structureId:p,stage:h,stageSequence:f}=n,m=XI({entryStatuses:id,provisionalPositioning:t,drawDefinition:e,stageSequence:f,structureId:p,stage:h}),{qualifiersCount:g}=pU({provisionalPositioning:t,drawDefinition:e,stageSequence:f,structureId:p,stage:h}),v=m.length+g,{positionAssignments:y,unassignedPositions:b}=Ma({structure:n}),I=b==null?void 0:b.map(R=>R.drawPosition),T=y==null?void 0:y.filter(R=>R.bye).length,w=y==null?void 0:y.filter(R=>R.bye).map(R=>R.drawPosition),S=u.map(R=>R.drawPositions).filter(R=>R==null?void 0:R.reduce((C,M)=>!(w!=null&&w.includes(M))&&C,!0)).flat(1/0).filter(R=>I==null?void 0:I.includes(R)),U=y==null?void 0:y.length,P=U?U-v:0;return P>d&&n.stageSequence===1&&n.stage!==bs&&(P=d),{placedByes:T,byesCount:P,relevantMatchUps:u,placedByePositions:w,roundMatchUps:o,positionsToAvoidDoubleBye:S}}function tZ({provisionalPositioning:t,tournamentRecord:e,appliedPolicies:i,drawDefinition:n,seedBlockInfo:r,seedingProfile:a,matchUpsMap:s,structureId:o,structure:l,seedLimit:c,seedsOnly:u,event:d}){var C;l||({structure:l}=hi({drawDefinition:n,structureId:o})),o||(o=l==null?void 0:l.structureId);let p=!((l==null?void 0:l.structures)??(l==null?void 0:l.stage)===ni),{byesCount:h,placedByes:f,relevantMatchUps:m}=tke({provisionalPositioning:t,drawDefinition:n,matchUpsMap:s,structure:l,event:d}),g=h-(f||0);if(g<=0)return{...de};let{strictSeedOrderByePositions:v,blockSeedOrderByePositions:y,isLuckyStructure:b,isFeedIn:I}=Q_e({provisionalPositioning:t,relevantMatchUps:m,appliedPolicies:i,drawDefinition:n,seedingProfile:a,seedBlockInfo:r,byesToPlace:g,structure:l}),T=(l==null?void 0:l.structureType)&&[So,wx].includes(l.structureType)&&((C=i==null?void 0:i.seeding)==null?void 0:C.containerByesIgnoreSeeding),w=p&&(y!=null&&y.length)?y:v,{unseededByePositions:S}=eke({provisionalPositioning:t,seedOrderByePositions:w,isLuckyStructure:b,appliedPolicies:i,drawDefinition:n,seedLimit:c,structure:l,isFeedIn:I}),U=M=>M%2,P=(M,_)=>(M||[]).every(A=>U(A)?_!==A+1:_!==A-1),E=[].concat(...w);if(!u)for(;S.length;){let M=S.find(_=>P(E,_));M?(E.push(M),S=S.filter(_=>_!==M)):(E.push(...S),S=[])}T&&(E=so(E),ic({ignoreSeededByes:T})&&console.log({byePositions:E}));let R=E.slice(0,g);for(let M of R){let _=fc({provisionalPositioning:t,tournamentRecord:e,drawDefinition:n,drawPosition:M,matchUpsMap:s,structureId:o,structure:l,event:d});if(_!=null&&_.error)return _}return{...de,unseededByePositions:S,byeDrawPositions:R}}function mC(t){var A,N,k,O;let{drawDefinition:e}=t,{applyPositioning:i=!0,provisionalPositioning:n,multipleStructures:r,placeByes:a=!0,tournamentRecord:s,placementGroup:o,seedingProfile:l,structureId:c,seedLimit:u,seedsOnly:d,drawType:p,drawSize:h,event:f}=t,m=[];i||(xae(),e=_t(e,!1,!0));let g=$=>(i||ON(),he({result:$,stack:"automatedPositioning"})),v=$=>(i||ON(),$),y=hi({drawDefinition:e,structureId:c});if(y.error)return g(y);let b=y.structure;if(!b)return{error:gr};let I=t.appliedPolicies||((A=hn({drawDefinition:e,structure:b,event:f}))==null?void 0:A.appliedPolicies),{qualifiersCount:T}=pU({stageSequence:b.stageSequence,provisionalPositioning:n,stage:b.stage,drawDefinition:e,structureId:c}),w=By;if(!((N=XI({stageSequence:b.stageSequence,provisionalPositioning:n,stage:b.stage,placementGroup:o,drawDefinition:e,entryStatuses:w,structureId:c}))!=null&&N.length)&&!T)return v({...de});let S=t.matchUpsMap??Ts({drawDefinition:e}),U=t.inContextDrawMatchUps??((k=ua({inContext:!0,drawDefinition:e,matchUpsMap:S}))==null?void 0:k.matchUps),P=[],E=ow({provisionalPositioning:n,appliedPolicies:I,drawDefinition:e,seedingProfile:l,structure:b});if(E.error)return E;let{validSeedBlocks:R}=E;m.push({validSeedBlocks:R});let C=t.participants||(s?(O=vr({withIndividualParticipants:!0,convertExtensions:!0,tournamentRecord:s}))==null?void 0:O.participants:[]);if(fC(b.seedingProfile||l)===Jv){let $=a?tZ({provisionalPositioning:n,tournamentRecord:s,appliedPolicies:I,drawDefinition:e,seedBlockInfo:E,matchUpsMap:S,structure:b,seedLimit:u,seedsOnly:d,event:f}):void 0;if($!=null&&$.error)return g($);P=$.unseededByePositions,m.push({action:"positionByes",unseededByePositions:P});let F=b.seedingProfile?{positioning:b.seedingProfile}:l;if($=QK({seedingProfile:F,provisionalPositioning:n,inContextDrawMatchUps:U,tournamentRecord:s,appliedPolicies:I,validSeedBlocks:R,drawDefinition:e,seedBlockInfo:E,participants:C,matchUpsMap:S,structure:b,event:f}),$.error)return g($);m.push({seedPositions:$.seedPositions,action:"positionSeedBlocks"})}else{if(p!==_y){let F=b.seedingProfile?{positioning:b.seedingProfile}:l,V=QK({seedingProfile:F,provisionalPositioning:n,inContextDrawMatchUps:U,tournamentRecord:s,appliedPolicies:I,validSeedBlocks:R,drawDefinition:e,seedBlockInfo:E,participants:C,matchUpsMap:S,structure:b,event:f});if(V.error)return g(V);m.push({action:"positionSeedBlocks",seedPositions:V.seedPositions})}let $=a?tZ({provisionalPositioning:n,tournamentRecord:s,appliedPolicies:I,drawDefinition:e,seedBlockInfo:E,matchUpsMap:S,structure:b,seedLimit:u,seedsOnly:d,event:f}):void 0;if($!=null&&$.error)return g($);P=$==null?void 0:$.unseededByePositions,m.push({action:"positionByes",byeDrawPositions:$==null?void 0:$.byeDrawPositions,unseededByePositions:P})}let M={};if(!d){let $=Y_e({inContextDrawMatchUps:U,tournamentRecord:s,appliedPolicies:I,validSeedBlocks:R,drawDefinition:e,seedBlockInfo:E,participants:C,matchUpsMap:S,structure:b});if($.error||($.conflicts&&(M.qualifierConflicts=$.conflicts),m.push({action:"positionQualifiers",qualifierDrawPositions:$.qualifierDrawPositions}),$=q_e({provisionalPositioning:n,inContextDrawMatchUps:U,unseededByePositions:P,multipleStructures:r,tournamentRecord:s,drawDefinition:e,seedBlockInfo:E,participants:C,matchUpsMap:S,structureId:c,structure:b,drawSize:h,event:f}),$.error))return g($);$.conflicts&&(M.unseededConflicts=$.conflicts),m.push({action:"positionUnseededParticipants"})}let{positionAssignments:_}=jn({drawDefinition:e,structure:b});return Hn({drawDefinition:e,structureIds:[c]}),i||ON(),{positionAssignments:_,conflicts:M,...de,positioningReport:m}}function mU(t){var p;let{applyPositioning:e=!0,provisionalPositioning:i,tournamentRecord:n,drawDefinition:r,seedingProfile:a,structureId:s,placeByes:o,seedsOnly:l}=t;if(!r)return{error:tc};if(!fg({drawDefinition:r,structureId:s})&&!i)return{error:mz};let c=(p=Cle({drawDefinition:r,structureId:s}).playoffStructures)==null?void 0:p.sort((h,f)=>HA(h)-HA(f)),u=[],d=[];if(c)for(let h of c){let{structureId:f}=h,m=mC({structureId:f,provisionalPositioning:i,applyPositioning:e,tournamentRecord:n,drawDefinition:r,seedingProfile:a,placeByes:o,seedsOnly:l});if(m.error)return m;m.positionAssignments&&u.push({positionAssignments:m.positionAssignments,structureId:f}),m.positioningReport&&d.push(m.positioningReport)}return{...de,structurePositionAssignments:u,positioningReports:d}}function Ale({drawDefinition:t,orderMap:e}){return t?((typeof e!="object"||!Object.values(e).every(i=>Ii(i)))&&he({result:{error:Re},context:{orderMap:e}}),t.structures||(t.structures=[]),t.structures.forEach(i=>{let n=e[i.structureId];n&&(i.structureOrder=n)}),t.structures.sort((i,n)=>PS(i.structureOrder)-PS(n.structureOrder)),{...de}):{error:Gt}}function nO({drawDefinition:t}){var g,v,y,b,I,T,w;let e=t.structures??[],i=t.links??[],n=new Map,r=S=>{let U=n.get(S)||n.set(S,{drawSources:[],drawTargets:[],progeny:[],sources:[],targets:[]})&&n.get(S);if(U&&!(U!=null&&U.stage)){let P=e.find(E=>E.structureId===S);U.stage=P==null?void 0:P.stage}return U},a={},s={},o=i.map(S=>{let U=S.source.structureId,P=S.target.structureId,E=r(U),R=r(P);return[Qv,Pu,Sx,Jv].includes(S.target.feedProfile)?(E==null||E.targets.push(P),R==null||R.sources.push(U)):S.target.feedProfile===Uu&&(R==null||R.drawSources.push(U),E==null||E.drawTargets.push(P)),s[P]=s[P]||S.target.feedProfile===Uu,a[P]=Ei([...a[P]||[],U]).filter(Boolean),[S.source.structureId,S.target.structureId]});for(let S of n.keys()){let U=n.get(S);if(U){let P=U.targets??[];for(;P.length;){let E=P.pop(),R=E&&n[E];(g=R==null?void 0:R.targets)!=null&&g.length?P.push(...R.targets):R&&(U.rootStage=R.stage)}if(U.rootStage||(U.rootStage=U.stage),!((v=U.targets)!=null&&v.length)){let E=U.sources??[];for(;E.length;){let R=E.pop(),C=R&&n[R];if((y=C==null?void 0:C.sources)!=null&&y.length){for(let M of C.sources)(b=U.progeny)!=null&&b.includes(M)||((I=U.progeny)==null||I.push(M));E.push(...C.sources)}}}}}let l=0;for(let S of n.keys()){let U=n.get(S);if(U&&U.rootStage===ni){let P=[(T=U.drawTargets)==null?void 0:T[0]],E=0;for(;P.length;){E+=1;let R=P.pop(),C=R?n.get(R):void 0;(w=C==null?void 0:C.drawTargets)!=null&&w.length&&P.push(C.drawTargets[0])}U.distanceFromMain=E,E>l&&(l=E)}}let c=o.length;Rt(0,Math.ceil(c/2)).forEach(()=>{o=Rt(0,c).map(S=>{let U=o[S],P=o.reduce((E,R)=>ho(U,R)?E.concat(...R):E,[])||[];return Ei(U.concat(...P))})});let u=o[0],d=(S,U)=>Nr(S,U).length===S.length,p=o.slice(1).reduce((S,U)=>S&&d(U,u),!0),h=[u].filter(Boolean),f=[u].filter(Boolean);e.forEach(S=>{let{structureId:U,stage:P}=S;h.find(E=>E.includes(U))||(h.push([U]),P!==$a&&f.push([U]))});let m=p&&f.length===1;return!(i!=null&&i.length)&&e.length===1&&r(e[0].structureId),{structureProfiles:Object.fromEntries(n),allStructuresLinked:m,maxQualifyingDepth:l,sourceStructureIds:a,hasDrawFeedProfile:s,structureGroups:h}}function _le({drawDefinition:t}){let{maxQualifyingDepth:e,structureProfiles:i}=nO({drawDefinition:t});for(let n of t.structures){let r=i[n.structureId];r.distanceFromMain&&(n.stageSequence=e+1-r.distanceFromMain)}return{...de}}function S3(t){let e=Qt(t,[{[ba]:!0,[To]:!0}]);if(e.error)return e;let{tournamentRecord:i,drawDefinition:n,structure:r,link:a}=t;return ike({tournamentId:i.tournamentId,drawDefinition:n,structure:r,link:a})}function ike(t){var u;let e=Qt(t,[{[To]:!0,[Px]:!0},{link:!0,[qo]:el,[Ire]:Iz}]);if(e.error)return e;let{drawDefinition:i,tournamentId:n,structure:r,eventId:a,link:s}=t,o=s.target.structureId,l=hi({drawDefinition:i,structureId:o});if(l.error)return he({stack:"attachQualifyingStructure",context:{targetStructureId:o},result:l});i.structures||(i.structures=[]),i.links||(i.links=[]),i.structures.push(r),i.links.push(s),_le({drawDefinition:i});let c=((u=wn({structure:r}))==null?void 0:u.matchUps)||[];return dg({drawDefinition:i,tournamentId:n,matchUps:c,eventId:a}),Hn({drawDefinition:i,structureIds:[r.structureId]}),{...de}}function kle({drawDefinition:t,structureDetails:e}){if(!Array.isArray(e))return{error:Re};if(!t)return{error:Gt};let i=Object.assign({},...e.map(n=>{if(!Xi(n))return;let{structureId:r,structureName:a}=n||{};if(!(!r||!a))return{[r]:a}}).filter(Boolean));if(!Object.values(i).length)return{error:ai};for(let n of t.structures||[]){let r=i[n.structureId];if(r&&(n.structureName=r),n.structures)for(let a of n.structures){let s=i[a.structureId];s&&(a.structureName=s)}}return{...de}}function T3({drawDefinition:t,timeItem:e}){if(!t)return{error:tc};if(!e)return{error:xz};let i=e&&Object.keys(e),n=["itemType","itemValue"];if(n.filter(a=>i.includes(a)).length!==n.length)return{error:kz};t.timeItems||(t.timeItems=[]);let r=new Date().toISOString();return Object.assign(e,{createdAt:r}),t.timeItems.push(e),zP({drawDefinition:t}),{...de}}function xle(t){var v;let{tournamentRecord:e,drawDefinition:i,structureId:n,event:r}=t,a=Qt(t,[{drawDefinition:!0,structureId:!0}]);if(a.error)return a;let s=i.structures??[],o=s.find(y=>y.structureId===n);if(!o)return{error:gr};let l=s.find(({stage:y,stageSequence:b})=>y===Ft&&b===1),c=n===(l==null?void 0:l.structureId),u=s.filter(({stage:y})=>y===ni).map(kl("structureId"));if(c&&!u.length)return{error:Tre};let d=u.includes(n),p=nke({isQualifyingStructure:d,structure:o,...t});if(p!=null&&p.error)return p;let{structureIdsToRemove:h,relatedStructureIdsMap:f}=ake({qualifyingStructureIds:u,isQualifyingStructure:d,isMainStageSequence1:c,mainStageSequence1:l,drawDefinition:i,structureId:n}),{removedMatchUpIds:m,removedStructureIds:g}=ske({relatedStructureIdsMap:f,qualifyingStructureIds:u,isMainStageSequence1:c,mainStageSequence1:l,drawDefinition:i,structureIdsToRemove:h,structureId:n});if(rke({removedMatchUpIds:m,drawDefinition:i}),c){let y=(v=l.matchUps??[])==null?void 0:v.map(kl("matchUpId"));m.push(...y),l.positionAssignments=[],l.seedAssignments=[],l.matchUps=[],l.extensions&&(l.extensions=[])}return d&&_le({drawDefinition:i}),Im({tournamentId:e==null?void 0:e.tournamentId,matchUpIds:m,action:"removeStructure",eventId:r==null?void 0:r.eventId,drawDefinition:i}),Hn({drawDefinition:i,eventId:r==null?void 0:r.eventId}),{...de,removedMatchUpIds:m,removedStructureIds:g}}function nke({isQualifyingStructure:t,tournamentRecord:e,drawDefinition:i,structureId:n,structure:r,event:a,force:s}){var l,c,u,d,p,h;let o=[n];if(t){let f=g=>{var v;return(v=i.links)==null?void 0:v.find(y=>y.target.structureId===g)},m=(l=f(n))==null?void 0:l.source.structureId;for(;m;)o.push(m),m=(c=f(m))==null?void 0:c.source.structureId}if((u=ua({matchUpFilters:{structureIds:o},drawDefinition:i}).matchUps)!=null&&u.some(({score:f})=>ga({score:f}))){let f=(d=hn({tournamentRecord:e,drawDefinition:i,structure:r,event:a}))==null?void 0:d.appliedPolicies;if(!(s??((h=(p=f==null?void 0:f[zc])==null?void 0:p.allowDeletionWithScoresPresent)==null?void 0:h.structures)))return{error:px}}return{...de}}function rke({removedMatchUpIds:t,drawDefinition:e}){let{matchUps:i}=ua({drawDefinition:e});i==null||i.forEach(n=>{n.winnerMatchUpId&&t.includes(n.winnerMatchUpId)&&delete n.winnerMatchUpId,n.loserMatchUpId&&t.includes(n.loserMatchUpId)&&delete n.loserMatchUpId})}function ake({qualifyingStructureIds:t,isQualifyingStructure:e,isMainStageSequence1:i,mainStageSequence1:n,drawDefinition:r,structureId:a}){let s=(r.structures??[]).map(kl("structureId")),o=u=>{var d;return((d=r.links)==null?void 0:d.map(p=>p.source.structureId===u&&p.target.structureId!==(n==null?void 0:n.structureId)&&p.target.structureId).filter(Boolean))??[]},l=u=>{var d;return((d=r.links)==null?void 0:d.map(p=>t.includes(p.source.structureId)&&p.target.structureId===u&&p.source.structureId).filter(Boolean))??[]},c=new Map;return s.forEach(u=>c.set(u,e?l(u):o(u))),{structureIdsToRemove:i?c.get(a):[a],relatedStructureIdsMap:c}}function ske({relatedStructureIdsMap:t,qualifyingStructureIds:e,isMainStageSequence1:i,mainStageSequence1:n,drawDefinition:r,structureIdsToRemove:a,structureId:s}){let o=[],l=[];for(;a!=null&&a.length;){let c=a.pop();l.push(...cke({idBeingRemoved:c,drawDefinition:r}));let u=lke({qualifyingStructureIds:e,isMainStageSequence1:i,idBeingRemoved:c,drawDefinition:r,structureId:s});o.push(...u.removedStructureIds);let d=oke({relatedStructureIdsMap:t,mainStageSequence1:n,idBeingRemoved:c,structureId:s});d!=null&&d.length&&a.push(...d)}return{removedMatchUpIds:l,removedStructureIds:o}}function oke({idBeingRemoved:t,relatedStructureIdsMap:e,mainStageSequence1:i,structureId:n}){var r;return t&&((r=e.get(t))==null?void 0:r.filter(a=>a!==(i==null?void 0:i.structureId)||n===i.structureId))}function lke({qualifyingStructureIds:t,isMainStageSequence1:e,idBeingRemoved:i,drawDefinition:n,structureId:r}){var s;let a=[];return n.links=((s=n.links)==null?void 0:s.filter(o=>o.source.structureId!==i&&o.target.structureId!==i))??[],(!e||e&&t.length||i!==r)&&(n.structures=(n.structures??[]).filter(o=>(i&&i===o.structureId&&a.push(i),o.structureId!==i))),{removedStructureIds:a}}function cke({idBeingRemoved:t,drawDefinition:e}){let{structure:i}=hi({structureId:t,drawDefinition:e}),n=wn({structure:i}).matchUps;return bq(n)}function JA({stageSequence:t=1,drawDefinition:e,drawSize:i,stage:n}){if(!e)return{error:Gt};if(!Yq({drawDefinition:e,stage:n}))return{error:Ay};let r=pAe({drawDefinition:e,stage:n}),{qualifiersCount:a}=pU({drawDefinition:e,stageSequence:t,stage:n}),s=r+a;if(i<s)return{error:bz};let{entryProfile:o}=Wq({attributes:[{[n]:{drawSize:i}}],drawDefinition:e});return Hn({drawDefinition:e}),{...de,entryProfile:o}}function Ole({qualifiersCount:t=0,drawDefinition:e,stage:i}){return e?Yq({drawDefinition:e,stage:i})?i!==Ft?{error:bz,info:"qualifiersCount can only be set for main stage"}:(Wq({attributes:[{[i]:{qualifiersCount:t}}],drawDefinition:e}),Hn({drawDefinition:e}),{...de}):{error:Ay}:{error:Gt}}function uke({drawDefinition:t,drawSize:e}){if(!t)return{error:Gt};let i=JA({stage:$a,stageSequence:1,drawDefinition:t,drawSize:e});return i.error?i:(Hn({drawDefinition:t}),{...de})}function Lle(t){return uke(t)}var dke="qualifierDrawPositionAssignment",pke="withdrawParticipantAtDrawPosition",hke="alternateDrawPositionAssignment",fke="luckyLoserDrawPositionAssignment",iZ="removeDrawPositionAssignment",Fle="swapDrawPositionAssignments",mke="modifyPairAssignment",gke="adHocPositionSwap",vke="modifyParticipantOtherName",nZ="assignDrawPosition",yke="removeSeededParticipant",bke="assignDrawPositionBye",Ike="modifySeedAssignment",$le="addPenalty",U3="MODIFY_PAIR",rO="QUALIFIER",D3="ALTERNATE",E3="WITHDRAW",hI="ASSIGN",qV="REMOVE",P3="LUCKY",cD="REMOVE_SEED",aO="SWAP",fE="NICKNAME",Fb="SEED_VALUE",fI="PENALTY",QA="BYE",cw={MODIFY_PAIR_ASSIGNMENT:U3,QUALIFYING_PARTICIPANT:rO,ALTERNATE_PARTICIPANT:D3,WITHDRAW_PARTICIPANT:E3,ASSIGN_PARTICIPANT:hI,LUCKY_PARTICIPANT:P3,REMOVE_ASSIGNMENT:qV,SWAP_PARTICIPANTS:aO,ADD_NICKNAME:fE,REMOVE_SEED:cD,ADD_PENALTY:fI,ASSIGN_BYE:QA,SEED_VALUE:Fb};function Ble({tournamentRecord:t,drawDefinition:e,drawPositions:i,structureId:n,event:r}){if(!e)return{error:Gt};if(!n)return{error:uc};if((i==null?void 0:i.length)!==2)return{error:Re,drawPositions:i};let a=Ts({drawDefinition:e}),{matchUps:s}=ua({inContext:!0,drawDefinition:e,matchUpsMap:a}),{structure:o}=hi({drawDefinition:e,structureId:n});if(!o)return{error:gr};let l=hn({tournamentRecord:t,drawDefinition:e,event:r}).appliedPolicies??{},c;if(o.structureType===So?c=Tke({inContextDrawMatchUps:s,tournamentRecord:t,drawDefinition:e,drawPositions:i,matchUpsMap:a,structure:o,event:r}):c=wke({inContextDrawMatchUps:s,tournamentRecord:t,drawDefinition:e,drawPositions:i,matchUpsMap:a,structure:o,event:r}),c.error)return c;if(jq({structure:o,drawPositions:i}),$x({appliedPolicies:l,drawDefinition:e,positionAction:{name:Fle,drawPositions:i,structureId:n}}),pg({tournamentId:t==null?void 0:t.tournamentId,drawDefinition:e,structure:o,event:r}),r.eventType===Al){let u=wn({matchUpFilters:{matchUpTypes:[ec]},inContext:!0,structure:o}).matchUps.filter(p=>{var h;return(h=p.drawPositions)==null?void 0:h.some(f=>i.includes(f))}),d=wn({matchUpFilters:{matchUpTypes:[ec]},structure:o}).matchUps;u.forEach(p=>{(p.sides||[]).forEach(h=>{var m;let f=h==null?void 0:h.drawPosition;if(i.includes(f)){let g=h.participantId,v=d.find(({matchUpId:b})=>b===p.matchUpId),y=(m=p==null?void 0:p.sides)==null?void 0:m.reduce((b,I,T)=>I.drawPosition===f?T:b,void 0);g3({inContextTargetMatchUp:p,drawPositionSideIndex:y,teamParticipantId:g,tournamentRecord:t,drawDefinition:e,matchUp:v,event:r})}})})}return Hn({drawDefinition:e,structureIds:[n]}),{...de}}function wke({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,drawPositions:n,matchUpsMap:r,structure:a,event:s}){let o=a==null?void 0:a.positionAssignments.filter(c=>n==null?void 0:n.includes(c.drawPosition));if(!o)return{error:Re,structure:a,info:"Missing positionAssignments"};if(o.filter(({bye:c})=>c).length===2)return{...de};if(o.filter(({qualifier:c})=>c).length===2)return{...de};let l=o.some(({qualifier:c})=>c);return o.some(({bye:c})=>c)&&!l?Vle({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,assignments:o,matchUpsMap:r,structure:a,event:s}):Ske({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,assignments:o,matchUpsMap:r,structure:a,event:s})}function Vle({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,assignments:n,matchUpsMap:r,structure:a,event:s}){let o=n.find(({bye:f})=>f),l=n.find(({participantId:f})=>f),c=o.drawPosition,{participantId:u,drawPosition:d}=l,{structureId:p}=a,h=hE({drawPosition:c,inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,structureId:p,matchUpsMap:r});return h.error||(h=hE({drawPosition:d,inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,structureId:p,matchUpsMap:r}),h.error)||(fc({drawPosition:d,tournamentRecord:e,drawDefinition:i,structureId:p,matchUpsMap:r,event:s}),h=Rp({drawPosition:c,inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,structureId:p,participantId:u,matchUpsMap:r,event:s}),h.error)?h:{...de}}function Ske({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,assignments:n,matchUpsMap:r,structure:a,event:s}){let o=Object.assign({},...n.map((l,c)=>{let{drawPosition:u}=l,d={...n[1-c],drawPosition:u};return{[u]:d}}));return a.positionAssignments=a.positionAssignments.map(l=>o[l.drawPosition]||l),y3({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,matchUpsMap:r,assignments:n,structure:a,event:s}),{...de}}function Tke({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,drawPositions:n,matchUpsMap:r,structure:a,event:s}){var c;let o=(c=a.structures)==null?void 0:c.reduce((u,d)=>{let p=d==null?void 0:d.positionAssignments.filter(h=>n==null?void 0:n.includes(h.drawPosition));return p&&u.push(...p),u},[]);if(o.filter(({bye:u})=>u).length===2)return{...de};if(o.filter(({qualifier:u})=>u).length===2)return{...de};y3({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,matchUpsMap:r,assignments:o,structure:a,event:s});let l=o.some(({qualifier:u})=>u);if(o.some(({bye:u})=>u)&&!l)Vle({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,assignments:o,matchUpsMap:r,structure:a,event:s});else{let u=_t(o,!1,!0);o.forEach((d,p)=>{let h=u[1-p].participantId;d.qualifier=u[1-p].qualifier,d.participantId=h})}return{...de}}function jle({tournamentRecord:t,drawDefinition:e,participantId:i,structureId:n}){var s;let r="removeSeededParticipant";if(!t)return{error:ut};if(!e)return{error:Gt};let a=(e.structures??[]).find(o=>o.structureId===n);return a?!a.stage||![Ft,ni].includes(a.stage)||a.stage===Ft&&a.stageSequence!==1?he({result:{error:My},stack:r}):(s=a.seedAssignments)!=null&&s.find(o=>o.participantId===i)?{...de}:he({info:"participant not seeded",result:{error:za},context:{participantId:i}}):he({result:{error:gr},stack:r})}function gC({targetEntryRound:t=1,finishingPositions:e,sourceRoundNumber:i,sourceStructureId:n,targetStructureId:r,linkType:a=Gf}){return!n||!r?{error:uc}:{link:Kt({linkType:a,source:{roundNumber:i,structureId:n,finishingPositions:e},target:{feedProfile:Uu,roundNumber:t,structureId:r}})}}function C3({roundPosition:t,roundNumber:e,idPrefix:i,uuids:n}){return i?`${i}-${e}-${t}`:(n==null?void 0:n.pop())||yn()}function e_({includeMatchUpType:t,matchUpType:e,roundNumber:i,matchUps:n,idPrefix:r,isMock:a,uuids:s,nodes:o}){let l=0,c=[],u=1,d=i-1,p=o==null?void 0:o.length;for(;l<(p||0);){let h=o==null?void 0:o[l],f=o==null?void 0:o[l+1];d&&(h.roundNumber=d),f&&d&&(f.roundNumber=d);let m=C3({roundPosition:u,roundNumber:i,idPrefix:r,uuids:s}),g={roundPosition:u,children:[h,f],matchUpId:m};c.push(g);let v={drawPositions:g.children.map(y=>y==null?void 0:y.drawPosition).filter(Boolean),matchUpStatus:Vr,matchUpId:g.matchUpId,roundPosition:u,roundNumber:i};t&&e&&(v.matchUpType=e),a&&(v.isMock=!0),n.push(v),u++,l+=2}return{roundNodes:c,matchUps:n}}function Mp({finishingPositionOffset:t,finishingPositionLimit:e,qualifyingRoundNumber:i,qualifyingPositions:n,matchUpType:r,roundLimit:a,idPrefix:s,drawSize:o,isMock:l,uuids:c}){if(isNaN(o)||o<2||n&&o<=n)return{matchUps:[],roundsCount:0};if(n&&(!Rd(o)||o%n)){let g=n;for(;g<o;)g=2*g;o=g}let u=n&&!(o%2)&&(!isNaN(n)||i&&!isNaN(i))&&(o/n===Math.round(o/n)||i&&o/i===Math.round(o/i));if(!Rd(o)&&!u)return{matchUps:[],roundsCount:0};let d=Rt(1,o+1).map(g=>({drawPosition:g})),p,h=[],f=1;for({roundNodes:p,matchUps:h}=e_({matchUpType:r,roundNumber:f,idPrefix:s,matchUps:h,isMock:l,nodes:d,uuids:c}),f++,a=a??i;p.length>1;)n&&p.length===n&&(a=f-1),{roundNodes:p,matchUps:h}=e_({nodes:p,matchUpType:r,roundNumber:f,idPrefix:s,matchUps:h,isMock:l,uuids:c}),f++;let m=f-1;return h=aC({finishingPositionOffset:t,finishingPositionLimit:e,roundsCount:m,roundLimit:a,matchUps:h}),a?h=h.filter(g=>a&&(g.roundNumber??0)<=a):a=f-1,{drawSize:o,matchUps:h,roundsCount:m,roundLimit:a}}function R3(t){var O,$,F,V,j,B;let e="generateQualifyingStructure";if(!t.drawDefinition)return he({result:{error:Gt},stack:e});if(t.drawSize&&!Ii(t.drawSize)||t.participantsCount&&!Ii(t.participantsCount)||t.qualifyingPositions&&!Ii(t.qualifyingPositions))return he({result:{error:Re},stack:e});let i=t.drawSize??hz(t.participantsCount),{qualifyingRoundNumber:n,qualifyingPositions:r,targetStructureId:a,structureOptions:s,appliedPolicies:o,drawDefinition:l,matchUpFormat:c,structureName:u,structureId:d,roundTarget:p,drawType:h,idPrefix:f,isMock:m,uuids:g}=t;if(!t.drawSize)return he({result:{error:MP},context:{drawSize:i},stack:e});if(r&&r>=t.drawSize)return he({result:{error:Re},context:{drawSize:i,qualifyingPositions:r},stack:e});let v,y,b,I,T=0,w,S=1,{structureProfiles:U}=nO({drawDefinition:l}),P=U[a];if(!P)return he({result:{error:gr},context:{targetStructureId:a},stack:e});let E=l.matchUpType,R=p?`${p}-`:"",C=P.stage===ni,M=(($=(O=o==null?void 0:o[$S])==null?void 0:O.namingConventions)==null?void 0:$.pre)??((V=(F=gAe[$S])==null?void 0:F.namingConventions)==null?void 0:V.pre),_=C&&M?`${M}-`:"",A=u??(R?`${_}${gs(ni)} ${R}`:`${_}${gs(ni)}`);if(h===zu){let{maxRoundNumber:z,structures:W,groupCount:Z}=pC({structureName:u??A,structureId:d??(g==null?void 0:g.pop()),stage:ni,structureOptions:s,appliedPolicies:o,stageSequence:S,matchUpType:E,roundTarget:p,idPrefix:f,drawSize:i,isMock:m,uuids:g});T=Z,v=z,b=W[0],w=[1]}else({drawSize:i,matchUps:I,roundLimit:v,roundsCount:y}=Mp({qualifyingRoundNumber:n,qualifyingPositions:r,matchUpType:E,idPrefix:f,drawSize:i,isMock:m,uuids:g})),v||(v=y),b=Lc({structureName:u??A,structureId:d??(g==null?void 0:g.pop()),qualifyingRoundNumber:v,stage:ni,matchUpFormat:c,stageSequence:S,matchUpType:E,roundLimit:v,matchUps:I}),p&&dn({extension:{name:Hp,value:p},element:b}),T=(j=I==null?void 0:I.filter(z=>z.roundNumber===v))==null?void 0:j.length;let N=h===zu?jf:Gf,k=b&&v&&((B=gC({sourceStructureId:b.structureId,sourceRoundNumber:v,targetStructureId:a,finishingPositions:w,linkType:N}))==null?void 0:B.link);return{qualifyingDrawPositionsCount:i,qualifiersCount:T,...de,structure:b,link:k}}function Gle(t){if(!t.tournamentRecord)return{error:ut};let e=Uke(t);return e.error,e}function Uke(t){if(!t.drawDefinition)return{error:Gt};if(!t.targetStructureId)return{error:uc};let e=R3(t);if(e.error)return e;let{structure:i,link:n}=e;return!i||!n?{error:Re}:S3({tournamentRecord:t.tournamentRecord,drawDefinition:t.drawDefinition,structure:i,link:n})}function Hle(t){var d;let e=Qt(t,[{[To]:!0,[Ux]:!0,[Gp]:!0},{[TNe]:!0,[ds]:p=>Number.isInteger(p)&&p>0},{[ds]:p=>Array.isArray(p)&&p.length===2&&p.every(nr),[rc]:Dl,participantIds:!0}]);if(e.error)return e;let{drawDefinition:i,structureId:n,tournamentRecord:r,event:a}=t,{structure:s}=hi({drawDefinition:i,structureId:n});if(!s)return{error:gr};if(!Vo({structure:s}))return{error:My};let o=p=>{var h;return(h=p.sides)==null?void 0:h.map(f=>f.participantId).some(f=>t.participantIds.includes(f))},l=p=>p.roundNumber===t.roundNumber,c=p=>!ga(p),u=((s==null?void 0:s.matchUps)??[]).filter(l).filter(c).filter(o);if(u.length!==2)return{error:Dl};for(let p of u){let h=(d=p==null?void 0:p.sides)==null?void 0:d.find(f=>t.participantIds.includes(f==null?void 0:f.participantId));if(h){let f=t.participantIds.find(m=>m!==(h==null?void 0:h.participantId));h.participantId=f,Ji({tournamentId:r==null?void 0:r.tournamentId,eventId:a==null?void 0:a.eventId,drawDefinition:i,matchUp:p})}}return Hn({drawDefinition:i,structureIds:[n]}),{...de}}function Dke({includeMatchUpType:t,drawPosition:e,roundNumber:i,matchUpType:n,idPrefix:r,matchUps:a,isMock:s,uuids:o,nodes:l,fed:c}){let u=l.length,d=e?e-u:void 0,p=Rt(0,u).map(m=>d?d+m:void 0),h=[];for(let m=0;m<u;m++){let g=p.shift(),v={drawPosition:g,fed:c+1,feed:!0},y=l[m];y.roundNumber=i-1;let b=C3({roundPosition:y.roundPosition,roundNumber:i,idPrefix:r,uuids:o}),I={roundPosition:y.roundPosition,drawPositions:[g],matchUpStatus:Vr,roundNumber:i,matchUpId:b};t&&(I.matchUpType=n),s&&(I.isMock=!0),a.push(I);let T={children:[y,v]};h.push(T)}let f=e?e-u:void 0;return{roundNodes:h,matchUps:a,drawPosition:f}}function mg(t){let e=t.drawSize,{feedRoundsProfile:i,feedRounds:n=0,skipRounds:r=0,baseDrawSize:a}=t,{linkFedFinishingRoundNumbers:s,finishingPositionOffset:o,linkFedRoundNumbers:l,feedsFromFinal:c,isConsolation:u,matchUpType:d,idPrefix:p,isMock:h,uuids:f,fmlc:m}=t;a=a??_(e);let g=Eke({drawSize:a}),v=g.length,y=0;if(i!=null&&i.length)y=i.reduce((A,N)=>A+N,0);else if(e){let A=e-a;i=g.filter(N=>N<=A?(A-=N,!0):!1),y=i.reduce((N,k)=>N+k,0),n=i.length}else r>=v?n=0:c&&(n=v-c,r=0),i=g.filter((A,N)=>c&&!n||n&&N>=r+n||N<r?0:A),y=i.reduce((A,N)=>A+N,0),n=i.length;let b=[...g,...i].sort((A,N)=>N-A),I=b.length,T=[...(l??[]).map(A=>A-1),...(s??[]).map(A=>I-A)].map(A=>b[A]).reduce((A,N)=>A+N,0);y=y-T;let w=0,S=[],U,P=1,E=Rt(0,a).map((A,N)=>({drawPosition:N+1+y})),R=y+1;for(let A of g){if({roundNodes:U,matchUps:S}=e_({matchUpType:d,roundNumber:P,idPrefix:p,matchUps:S,isMock:h,nodes:E,uuids:f}),P++,i.includes(A)){let N=Ml(i)[A],k=Rt(0,N),O=I+1-P,$=(s==null?void 0:s.includes(O))??(l==null?void 0:l.includes(P));k.forEach(()=>{({roundNodes:U,matchUps:S,drawPosition:R}=Dke({drawPosition:!$&&R||void 0,nodes:U,matchUpType:d,roundNumber:P,idPrefix:p,matchUps:S,isMock:h,uuids:f,fed:w})),P++,w+=1})}E=U}I!==P-1&&console.log("ERROR");let C=a-y;S=aC({finishingPositionOffset:u?C:o,positionsFed:y,roundsCount:I,matchUps:S,fmlc:m});let M=U!=null&&U.length?U[0]:U;return M&&(M.roundNumber=P-1,M.matchUps=S),{draw:M,matchUps:S,roundsCount:I};function _(A){let N=fz(A);return N>A?N/2:N}}function Eke({drawSize:t}){let e=Math.ceil(Math.log(t)/Math.log(2));return Rt(0,e).reverse().map(i=>Math.pow(2,i))}function hS(t){let{finishingPositionOffset:e=0,addNameBaseToAttributeName:i,playoffStructureNameBase:n,finishingPositionNaming:r,finishingPositionLimit:a,playoffAttributes:s,stageSequence:o=1,exitProfile:l="0",exitProfileLimit:c,roundOffsetLimit:u,roundOffset:d=0,drawDefinition:p,staggeredEntry:h,sequenceLimit:f,stage:m=Ft,drawSize:g,idPrefix:v,isMock:y,uuids:b}=t;if(!(!s||!c||s!=null&&s[l])||g<2||f&&o>f)return{};let I=[],T=[],w=[],S=t.matchUpType??(p==null?void 0:p.matchUpType),U=e+1,P=e+g,E=`${U}-${P}`,R=s==null?void 0:s[l],C=n&&`${n} `||"",M=(s==null?void 0:s[E])??(r==null?void 0:r[E]),_=t.structureName||(M==null?void 0:M.name)||(R==null?void 0:R.name)&&(i?`${C}${R==null?void 0:R.name}`:R.name)||`${C}${E}`,A=(M==null?void 0:M.abbreviation)??(R==null?void 0:R.abbreviation),N=t.structureId??(R==null?void 0:R.structureId)??(b==null?void 0:b.pop()),k={idPrefix:v&&`${v}-${_}-RP`,finishingPositionOffset:e,matchUpType:S,drawSize:g,isMock:y,uuids:b},{matchUps:O}=h?mg(k):Mp(k),$=Lc({structureAbbreviation:A,stageSequence:o,structureName:_,matchUpType:S,roundOffset:d,structureId:N,matchUps:O,stage:m});I.push(...O),T.push($);let F=Math.ceil(Math.log(g)/Math.log(2)),V=u?Math.min(u-d,F):(!a||U<a)&&F||0;return g>2&&Rt(1,V+1).forEach(B=>j(B)),{structureId:$.structureId,matchUps:I,structureName:_,structures:T,links:w,...de};function j(B){let z=g/Math.pow(2,B);if(z<2)return;let W=g/Math.pow(2,B)+e;if(a&&W+1>a)return;let{structures:Z,structureId:K,matchUps:Q,links:J}=hS({finishingPositionOffset:W,exitProfile:`${l}-${B}`,roundOffset:d+B,stageSequence:o+1,drawSize:z,addNameBaseToAttributeName:i,playoffStructureNameBase:n,finishingPositionNaming:r,finishingPositionLimit:a,playoffAttributes:s,exitProfileLimit:c,roundOffsetLimit:u,drawDefinition:p,sequenceLimit:f,matchUpType:S,idPrefix:v,uuids:b,stage:m});if($.structureId&&K){let se={linkType:xh,source:{roundNumber:B,structureId:$.structureId},target:{roundNumber:1,feedProfile:Pu,structureId:K}};J&&$&&J.push(se),J!=null&&J.length&&w.push(...J)}return Z!=null&&Z.length&&T.push(...Z),Q!=null&&Q.length&&I.push(...Q),{structureId:K,childLinks:J,structures:T}}}function M3({drawDefinition:t,matchUpsMap:e,structureId:i}){let n=hi({drawDefinition:t,structureId:i});if(n.error)return he({result:n});let{matchUps:r}=wn({structure:n.structure,matchUpsMap:e});return{...fo({matchUps:r}),matchUps:r,matchUpsMap:e}}function rZ({finishingPositions:t,drawDefinition:e,structureId:i}){var r;let{roundProfile:n}=M3({drawDefinition:e,structureId:i});return(r=n&&Object.keys(n))==null?void 0:r.reduce((a,s)=>(zle(n==null?void 0:n[s]).forEach(o=>{t.forEach(l=>{Pke({position:l,rangeDefinition:o})&&(a[l]={roundNumber:s})})}),a),{})}function Pke({position:t,rangeDefinition:e}){if(!Array.isArray(e)||e.reduce((r,a)=>r||isNaN(a),!1))return!1;let[i,n]=e;return Rt(i,(n||i)+1).includes(t)}function zle(t){var e,i;return[Ei(((e=t==null?void 0:t.finishingPositionRange)==null?void 0:e.loser)||[]),Ei(((i=t==null?void 0:t.finishingPositionRange)==null?void 0:i.winner)||[])]}function Cke(t){return zle(t).map(e=>Rt(e[0],e[1]&&e[1]+1||e[0]+1))}function gU({drawDefinition:t,structureIds:e,matchUpsMap:i}){if(e&&!Array.isArray(e))return{error:Re,context:{structureIds:e}};if(!t)return{error:Gt};e=e??(t.structures??[]).filter(a=>a.stage!==ni).map(({structureId:a})=>a);let n=e.map(a=>{var o;let{roundProfile:s}=M3({drawDefinition:t,matchUpsMap:i,structureId:a});return(o=s&&Object.values(s))==null?void 0:o.map(Cke).flat()}).flat(),r=n.filter(a=>(a==null?void 0:a.length)===1).sort(ia).flat();return{positionsNotPlayedOff:Ei(n.flat()).filter(a=>!r.includes(a)),positionsPlayedOff:r}}function qle({excludeRoundNumbers:t=[],playoffPositions:e=[],drawDefinition:i,structureId:n}){if(!i)return{error:Gt};if(!n)return{error:uc};if(!e)return{error:ai,info:"missing playoffPositions"};let r=gU({drawDefinition:i});if(r.error)return r;let a=r.positionsPlayedOff,s=e.filter(v=>!a.includes(v)),o=rZ({finishingPositions:s,drawDefinition:i,structureId:n}),l=Object.values(o).reduce((v,y)=>v.includes(y.roundNumber)?v:v.concat(y.roundNumber),[]).map(v=>ui(v)).filter(v=>!t.includes(v)),c=rZ({finishingPositions:a,drawDefinition:i,structureId:n}),u=c?Object.values(c):[],d=c?u.reduce((v,y)=>v.includes(y.roundNumber)?v:v.concat(y.roundNumber),[]).map(v=>ui(v)):[],p=l.filter(v=>!d.includes(v)).sort(ia),{roundProfile:h}=M3({drawDefinition:i,structureId:n}),f=p.map(v=>{let y=h==null?void 0:h[v].finishingPositionRange.loser,[b,I]=y??[0,0];return Rt(b,(I||b)+1)}).flat().sort(ia),{playoffRoundsRanges:m}=Rke({playoffSourceRounds:p,roundProfile:h}),g=[...p,...d];return{playoffPositionsReturned:f,playedOffSourceRounds:d,playoffRoundsRanges:m,playoffSourceRounds:p,sourceRounds:g,roundProfile:h}}function Rke({playoffSourceRounds:t,roundProfile:e}){return{playoffRoundsRanges:t.map(i=>{let n=e[i].finishingPositionRange.loser,[r,a]=n,s=Rt(r,(a||r)+1);return{finishingPositionRange:n.join("-"),finishingPositions:s,roundNumber:i}})}}function vC({drawDefinition:t,structureId:e}){if(!t)return{error:Gt};let{matchUps:i,matchUpsMap:n}=lo({inContext:!0,drawDefinition:t}),{positionsNotPlayedOff:r,positionsPlayedOff:a}=gU({drawDefinition:t,matchUpsMap:n}),{structures:s}=Wu({drawDefinition:t}),o=s.filter(c=>!e&&c.stage!==$a||c.structureId===e),l={};for(let c of o){let u=c==null?void 0:c.structureId,d=Mke({playoffPositions:r,drawDefinition:t,structure:c,matchUps:i}),{error:p,...h}=d;if(p)return d;l[u]={structureId:u,...h}}return e?{positionsPlayedOff:a,...l[e]}:{availablePlayoffProfiles:Object.values(l),availablePlayoffRounds:Object.values(l),positionsPlayedOff:a}}function Mke({playoffPositions:t,drawDefinition:e,structure:i,matchUps:n}){var h,f,m,g,v,y,b,I,T;let r=i==null?void 0:i.structureId,{links:a}=uU({drawDefinition:e,structureId:r});if(i.structureType===So||i.structures){let w=(f=(h=jn({structure:i}))==null?void 0:h.positionAssignments)==null?void 0:f.length,S=i.structures.length,U=(w??0)/S,P=((m=a.source)==null?void 0:m.flatMap(({source:$})=>($==null?void 0:$.finishingPositions)||[]))||[],E=Rt(1,U+1).filter($=>!P.includes($)),R=((v=(g=n.find($=>$.containerStructureId===r&&$.finishingPositionRange))==null?void 0:g.finishingPositionRange)==null?void 0:v.winner)||[0,1],C=a==null?void 0:a.source.map(({target:$})=>$.structureId),{positionsPlayedOff:M=[],positionsNotPlayedOff:_=[]}=gU({structureIds:C,drawDefinition:e}),A=[...M,..._],N=Rt(R[0],R[1]+1).filter($=>!A.includes($)),k=Ra(N,N.length/E.length),O=E.map(($,F)=>{let V=k[F],j=[Math.min(...V||[]),Math.max(...V||[])].join("-");return{finishingPosition:$,finishingPositions:V,finishingPositionRange:j}});return{positionsNotPlayedOff:N,playoffFinishingPositionRanges:O,finishingPositionsAvailable:E,finishingPositionsPlayedOff:P,positionsPlayedOff:M,groupCount:S,groupSize:U}}let s=((y=a==null?void 0:a.source)==null?void 0:y.filter(w=>w.linkCondition!==Pp).map(w=>{var S;return(S=w.source)==null?void 0:S.roundNumber}))||[],o=((b=a==null?void 0:a.source)==null?void 0:b.filter(w=>w.linkCondition===Pp).map(w=>{var S;return(S=w.source)==null?void 0:S.roundNumber}))||[],l=qle({excludeRoundNumbers:s,playoffPositions:t,drawDefinition:e,structureId:r}),c=l!=null&&l.playoffSourceRounds?[...(l==null?void 0:l.playoffSourceRounds)||[]]:void 0,u=[...(l==null?void 0:l.playoffRoundsRanges)||[]],{roundProfile:d,error:p}=l;for(let w of o){let S=a==null?void 0:a.source.find(C=>C.source.roundNumber===w),U=S==null?void 0:S.target.roundNumber,P=S==null?void 0:S.target.structureId,E=n.filter(({roundNumber:C,structureId:M})=>M===P&&C===U),R=E.filter(({sides:C})=>C.find(M=>M.participantFed&&!M.participantId)).length;if(c&&R===E.length){c.push(w);let C=(T=(I=d==null?void 0:d[w])==null?void 0:I.finishingPositionRange)==null?void 0:T.loser;if(C){let M=Math.min(...C),_=M+R,A=Rt(M,_),N={finishingPositionRange:[M,_-1].join("-"),finishingPositions:A,roundNumber:w};u.push(N)}}}return c&&c.sort(ia),u.sort((w,S)=>w.roundNumber-S.roundNumber),{playoffRounds:c,playoffRoundsRanges:u,error:p}}function Nke({playoffGroups:t,drawDefinition:e,structureId:i}){var r,a;if(!e)return{error:Gt};if(!nr(i)||!Array.isArray(t))return{error:Re};let n=t.map(({finishingPositions:s})=>s).flat();return{positionRangeMap:(a=(r=vC({drawDefinition:e,structureId:i}).playoffFinishingPositionRanges)==null?void 0:r.filter(s=>n.includes(s.finishingPosition)))==null?void 0:a.reduce((s,o)=>(s[o.finishingPosition]=o,s),{})}}function Wle(t){var y,b;let{finishingPositionOffset:e=0,playoffAttributes:i,stageSequence:n=1,staggeredEntry:r,structureName:a,stage:s=Ft,matchUpType:o,structureId:l,idPrefix:c,drawSize:u,isMock:d,uuids:p}=t,h={finishingPositionOffset:e,matchUpType:o,drawSize:u,idPrefix:c,isMock:d,uuids:p},{matchUps:f}=r?mg(h):Mp(h),m=Lc({structureName:a||((y=i==null?void 0:i["0"])==null?void 0:y.name)||gs(Ft),structureId:l||(p==null?void 0:p.pop()),stageSequence:n,matchUpType:o,matchUps:f,stage:s}),g=[m],v=[];if(u>2){let I=u/2,{matchUps:T}=Mp({finishingPositionOffset:e+I,idPrefix:c&&`${c}-c`,drawSize:I,matchUpType:o,isMock:d}),w=gs(bs),S=((b=i==null?void 0:i["0-1"])==null?void 0:b.name)??t.consolationStructureName??(a?`${a} ${w}`:w),U=Lc({structureName:S,matchUps:T,structureId:p==null?void 0:p.pop(),stage:bs,stageSequence:1,matchUpType:o});g.push(U);let P={linkType:xh,source:{roundNumber:1,structureId:m.structureId},target:{roundNumber:1,feedProfile:Pu,structureId:U.structureId}};v.push(P)}return{...de,structures:g,links:v}}function Yle({consolationStructure:t,roundOffset:e=0,mainStructure:i,roundsCount:n,feedPolicy:r,fmlc:a}){let s=t.matchUps.reduce((c,u)=>(u.drawPositions||[]).filter(Boolean).length&&!c.includes(u.roundNumber)?c.concat(u.roundNumber):c,[]),o=(r==null?void 0:r.roundGroupedOrder)||[],l=r==null?void 0:r.roundFeedProfiles;return Rt(1+e,n+1+e).map(c=>{let u=l!=null&&l[c-1]?l[c-1]:c%2&&Pu||Qv,d=c-e<=2?c-e:(c-e-2)*2+2,p={linkType:xh,source:{roundNumber:c,structureId:i.structureId},target:{feedProfile:u,roundNumber:d,structureId:t.structureId}},h=o[c-1];return h&&(p.target.groupedOrder=h),ic()&&(p.source.structureName=i.structureName,p.target.structureName=t.structureName),c===2&&a&&(p.linkCondition=Pp,p.target.feedProfile=Pu),s.includes(d)?p:void 0}).filter(Boolean)}function Kle(t){var T,w;let{playoffStructureNameBase:e,finishingPositionOffset:i,stageSequence:n=1,playoffAttributes:r,structureNameMap:a,staggeredEntry:s,stage:o=Ft,matchUpType:l,structureId:c,drawSize:u,idPrefix:d,isMock:p,uuids:h}=t,f={finishingPositionOffset:i,matchUpType:l,drawSize:u,idPrefix:d,isMock:p,uuids:h},{matchUps:m,roundsCount:g}=s?mg(f):Mp(f),v=t.structureName??((T=r==null?void 0:r["0"])==null?void 0:T.name)??gs(Ft),y=ng({structureId:c||(h==null?void 0:h.pop()),structureName:v,stageSequence:n,matchUpType:l,matchUps:m,stage:o}),b=[y],I=[];if(u>2){let S=[0,2].slice(0,u/16).map((U,P)=>{let E=P+1,{consolationStructure:R}=Ake({idPrefix:d&&`${d}-c${P}`,structureId:h==null?void 0:h.pop(),playoffStructureNameBase:e,playoffAttributes:r,structureNameMap:a,stageSequence:E,roundOffset:U,matchUpType:l,drawSize:u,isMock:p,index:P,uuids:h});b.push(R);let C=Yle({consolationStructure:R,roundsCount:2,mainStructure:y,roundOffset:U});return{consolationStructure:R,links:C}}).map(U=>U.links).flat();if(I.push(...S),u>=4&&u<=16||u>32){let{matchUps:U}=Mp({idPrefix:d&&`${d}-p3t4`,finishingPositionOffset:2,drawSize:2,matchUpType:l,isMock:p}),P=((w=r==null?void 0:r["3-4"])==null?void 0:w.name)??gs(Rr),E=(a==null?void 0:a[P])||P,R=e?`${e} ${E}`:E,C=ng({structureId:h==null?void 0:h.pop(),matchUps:U,stageSequence:2,stage:Rr,structureName:R,matchUpType:l}),M={linkType:xh,source:{roundNumber:g-1,structureId:y.structureId},target:{structureId:C.structureId,feedProfile:Pu,roundNumber:1}};b.push(C),I.push(M)}}return{structures:b,links:I,...de}}function Ake({playoffStructureNameBase:t,stageSequence:e=1,playoffAttributes:i,structureNameMap:n,roundOffset:r=0,matchUpType:a,structureId:s,idPrefix:o,drawSize:l,isMock:c,index:u,uuids:d}){var y,b;let p=l/(2*Math.pow(2,r)),{matchUps:h,roundsCount:f}=mg({finishingPositionOffset:p,baseDrawSize:p,isConsolation:!0,feedRounds:1,matchUpType:a,idPrefix:o,isMock:c,uuids:d}),m=u===0&&((y=i==null?void 0:i["0-1"])==null?void 0:y.name)||u===1&&((b=i==null?void 0:i["0-3"])==null?void 0:b.name)||`${gs(bs)} ${u+1}`,g=(n==null?void 0:n[m])||m,v=t?`${t} ${g}`:g;return{consolationStructure:ng({matchUps:h,stage:bs,structureName:v,stageSequence:e,matchUpType:a,structureId:s}),consolationRoundsCount:f}}function Ib(t){var E,R,C,M;let{finishingPositionOffset:e,stageSequence:i=1,playoffAttributes:n,feedsFromFinal:r,staggeredEntry:a,structureName:s,stage:o=Ft,structureId:l,matchUpType:c,skipRounds:u,feedRounds:d,idPrefix:p,drawSize:h,isMock:f,uuids:m,fmlc:g}=t,v=t.feedPolicy||((E=t.policyDefinitions)==null?void 0:E[BS])||((R=t.appliedPolicies)==null?void 0:R[BS]),y={finishingPositionOffset:e,matchUpType:c,skipRounds:u,drawSize:h,idPrefix:p,isMock:f,uuids:m},{matchUps:b}=a?mg(y):Mp(y),I=Lc({structureName:s||((C=n==null?void 0:n["0"])==null?void 0:C.name)||gs(Ft),structureId:l||(m==null?void 0:m.pop()),stageSequence:i,matchUpType:c,matchUps:b,stage:o}),T=[I],w=[],S=h/2,{matchUps:U,roundsCount:P}=mg({finishingPositionOffset:S,idPrefix:p&&`${p}-c`,isConsolation:!0,feedsFromFinal:r,baseDrawSize:S,matchUpType:c,feedRounds:d,skipRounds:u,isMock:f,uuids:m,fmlc:g});if(h>2){let _=((M=n==null?void 0:n["0-1"])==null?void 0:M.name)??gs(bs),A=t.playoffStructureNameBase?`${t.playoffStructureNameBase} ${_}`:_,N=Lc({matchUps:U,structureId:m==null?void 0:m.pop(),stage:bs,stageSequence:1,structureName:A,matchUpType:c});T.push(N);let k=Yle({consolationStructure:N,mainStructure:I,roundsCount:P,feedPolicy:v,fmlc:g});w.push(...k)}return{...de,structures:T,links:w}}function Zle({requireSequential:t=!0,playoffMatchUpFormat:e,playoffAttributes:i,sourceStructureId:n,policyDefinitions:r,stageSequence:a,drawDefinition:s,playoffGroups:o,matchUpType:l,feedPolicy:c,groupCount:u,idPrefix:d,isMock:p,uuids:h}){var T,w,S,U,P,E;c=c||(r==null?void 0:r[BS]);let f="processPlayoffGroups",m=0,g=[],v=[],y=[],{error:b,positionRangeMap:I}=Nke({structureId:n,drawDefinition:s,playoffGroups:o});if(b)return he({result:{error:b},stack:f});if(!(!I||o!=null&&o.every(R=>{let{finishingPositions:C=[]}=R;if(!C.length)return!1;let M=[...C].sort(ia).map((_,A)=>(C[A+1]||_)-_).every(_=>_<2);return(!t||M)&&C.every(_=>I[_])})))return he({context:{validFinishingPositions:Object.values(I)},result:{error:Re},stack:f});for(let R of o){let C=R.finishingPositions,M=I&&C.map(V=>{var j;return(j=I[V])==null?void 0:j.finishingPositions}).flat(),_=u*C.length,A=WT(_),N=A===2&&mp||R.drawType||mp;M&&(m=Math.min(...M)-1);let k=M&&`${Math.min(...M)}-${Math.max(...M)}`,O=R.structureName||k&&((w=(T=R.playoffAttributes)==null?void 0:T[k])==null?void 0:w.name)||((U=(S=R.playoffAttributes)==null?void 0:S["0"])==null?void 0:U.name),$={addNameBaseToAttributeName:R.addNameBaseToAttributeName,playoffStructureNameBase:R.playoffStructureNameBase,finishingPositionNaming:R.finishingPositionNaming,finishingPositionLimit:R.finishingPositionLimit,structureId:R.structureId??(h==null?void 0:h.pop()),playoffAttributes:R.playoffAttributes,structureNameMap:R.structureNameMap,sequenceLimit:R.sequenceLimit,structureName:O,idPrefix:d&&`${d}-po`,appliedPolicies:r,finishingPositionOffset:m,stage:Rr,stageSequence:a,matchUpType:l,drawSize:A,isMock:p,uuids:h},F=({playoffStructures:V,playoffLinks:j})=>{let[B]=V,z=$M({playoffStructureId:B.structureId,finishingPositions:C,sourceStructureId:n});y.push(z),y.push(...j),v.push(...V),g.push({structureId:B.structureId,finishingPositions:C}),m+=_};if(N===mp){let{matchUps:V}=Mp({finishingPositionLimit:m+_,idPrefix:d&&`${d}-po`,finishingPositionOffset:m,matchUpType:l,drawSize:A,isMock:p,uuids:h}),j=Lc({structureId:R.structureId??(h==null?void 0:h.pop()),matchUpFormat:e,stage:Rr,structureName:O,stageSequence:a,matchUps:V});v.push(j);let B=$M({playoffStructureId:j.structureId,finishingPositions:C,sourceStructureId:n});y.push(B),m+=_,g.push({structureId:j.structureId,finishingPositions:C})}else if([xS,OS,Rr].includes(N)){let V={playoffAttributes:R.playoffAttributes??i,playoffStructureNameBase:R.playoffStructureNameBase,structureId:R.structureId??(h==null?void 0:h.pop()),structureName:R.structureName,idPrefix:d&&`${d}-po`,addNameBaseToAttributeName:!0,finishingPositionOffset:m,stage:Rr,roundOffset:0,stageSequence:a,drawSize:A,isMock:p,uuids:h};N===xS?Object.assign(V,{playoffAttributes:(R==null?void 0:R.playoffAttributes)??i??iq,roundOffsetLimit:3}):N===OS&&Object.assign(V,{playoffAttributes:(R==null?void 0:R.playoffAttributes)??i??nq,roundOffsetLimit:2});let j=hS(V);if(j.error)return j;if((P=j.links)!=null&&P.length&&y.push(...j.links),(E=j.structures)!=null&&E.length&&v.push(...j.structures),v.sort(ZI),j.structureId){let B=$M({playoffStructureId:j.structureId,finishingPositions:C,sourceStructureId:n});y.push(B),g.push({structureId:j.structureId,finishingPositions:C})}m+=_}else if([LS,BP,nE,iE,tE,rE].includes(N)){let V=[h==null?void 0:h.pop(),h==null?void 0:h.pop()],j={playoffStructureNameBase:R.playoffStructureNameBase,structureId:R.structureId??(h==null?void 0:h.pop()),playoffAttributes:R.playoffAttributes,idPrefix:d&&`${d}-po`,finishingPositionOffset:m,uuids:V,stage:Rr,structureName:O,matchUpType:l,feedPolicy:c,drawSize:A,isMock:p},B={[LS]:{fmlc:!0,feedRounds:1},[rE]:{feedRounds:1},[nE]:{feedsFromFinal:3},[iE]:{feedsFromFinal:2},[tE]:{feedsFromFinal:1}};Object.assign(j,B[N]||{});let{structures:z,links:W}=Ib(j),[Z]=z,K=$M({playoffStructureId:Z.structureId,finishingPositions:C,sourceStructureId:n});y.push(K),y.push(...W),v.push(...z),g.push({structureId:Z.structureId,finishingPositions:C}),m+=_}else if([zu].includes(N)){let{structures:V,links:j}=pC({...$,structureOptions:R.structureOptions||{groupSize:4}});F({playoffStructures:V,playoffLinks:j})}else if([$P].includes(N)){let{structures:V,links:j}=Wle($);F({playoffStructures:V,playoffLinks:j})}else if([vNe].includes(N)){let{structures:V,links:j}=Kle($);F({playoffStructures:V,playoffLinks:j})}else if([nc].includes(N)){let V=Lc({structureId:R.structureId??(h==null?void 0:h.pop()),structureName:R.structureName,finishingPosition:$N,stage:Rr,stageSequence:a,matchUps:[]});F({playoffStructures:[V],playoffLinks:[]})}}return{finishingPositionTargets:g,positionRangeMap:I,structures:v,links:y}}function $M({playoffStructureId:t,finishingPositions:e,sourceStructureId:i}){return{linkType:jf,source:{structureId:i,finishingPositions:e},target:{structureId:t,feedProfile:Uu,roundNumber:1}}}function yC({matchUp:t,tieFormat:e,isMock:i,uuids:n}){let{collectionDefinitions:r}=e??{};return{tieMatchUps:(r??[]).map(a=>bC({matchUp:t,collectionDefinition:a,uuids:n,isMock:i})).filter(Boolean).flat()}}function bC({collectionPositionOffset:t=0,collectionDefinition:e,matchUpsLimit:i,matchUp:n,isMock:r,uuids:a}){let{matchUpCount:s,matchUpType:o,collectionId:l,processCodes:c}=e||{},u=i??s??0,d=p=>{if(!r&&!(n!=null&&n.isMock))return(a==null?void 0:a.pop())??yn();let h=e==null?void 0:e.collectionId;return(a==null?void 0:a.pop())??`${n==null?void 0:n.matchUpId}-${h}-TMU-${p+1}`};return Rt(0,u).map(p=>{let h=t+p+1;return{sides:[{sideNumber:1},{sideNumber:2}],matchUpId:d(p),matchUpStatus:Vr,collectionPosition:h,collectionId:l,processCodes:c,matchUpType:o,isMock:r}})}function _ke(t){var U,P,E;let e="generateAndPopulateRRplayoffStructures";if(!t.playoffGroups)return he({result:{error:ai},info:"playoffGroups required",stack:e});let{sourceStructureId:i,requireSequential:n,tournamentRecord:r,drawDefinition:a,playoffGroups:s,groupCount:o,groupSize:l,event:c}=t,u=Zle({requireSequential:n,sourceStructureId:i,playoffGroups:s,groupCount:o,groupSize:l,...t});if(u.error)return he({result:u,stack:e});let{structures:d=[],links:p=[],finishingPositionTargets:h,positionRangeMap:f}=u,m=h==null?void 0:h.map(({finishingPositions:R})=>R).flat().map(R=>f[R].finishingPositions).flat();a.structures.push(...d),a.links.push(...p);let{matchUps:g,matchUpsMap:v}=ua({inContext:!0,drawDefinition:a}),y=d.map(({structureId:R})=>R),b=g==null?void 0:g.filter(({structureId:R})=>y.includes(R)).map(Pa),I=(U=v==null?void 0:v.drawMatchUps)==null?void 0:U.filter(({matchUpId:R})=>b==null?void 0:b.includes(R));if(I!=null&&I.length){let R=(P=qs({drawDefinition:a,event:c}))==null?void 0:P.tieFormat;R&&I.forEach(C=>{let{tieMatchUps:M}=yC({isMock:t.isMock,tieFormat:R,matchUp:C});Object.assign(C,{tieMatchUps:M,matchUpType:ec})})}let{positionAssignments:T}=jn({structureId:i,drawDefinition:a}),w={};T==null||T.forEach(R=>{var M,_,A;let C=(A=(_=(M=ki({element:R,name:cg}))==null?void 0:M.extension)==null?void 0:_.value)==null?void 0:A.groupOrder;C&&(w[C]||(w[C]=[]),w[C].push(R.participantId))});let S=mU({provisionalPositioning:t.provisionalPositioning,structureId:i,applyPositioning:!0,event:t.event,tournamentRecord:r,drawDefinition:a});return S.error&&((E=S.error)==null?void 0:E.code)!==mz.code?he({result:S,stack:e}):{structures:d,links:p,positionsPlayedOff:m,drawDefinition:a,...de}}function Q0({value:t,sourceRange:e,targetRange:i}){let n=Math.min(...e),r=Math.max(...e),a=Math.min(...i),s=Math.max(...i);return(t-n)*(s-a)/(r-n)+a}var Du="ELO",Xle="NTRP",kke="TRN",Jle="UTR",N3="WTN",Qle={ELO:Du,NTRP:Xle,TRN:kke,UTR:Jle,WTN:N3},xke={[Du]:{defaultInitialization:1500,decimalsCount:0,range:[0,3e3],ascending:!0},[Xle]:{accessors:["ntrpRating","dntrpRatingHundredths"],attributes:{ustaRatingType:""},accessor:"dntrpRatingHundredths",defaultInitialization:3,decimalsCount:1,ascending:!0,range:[1,7]},[Jle]:{defaultInitialization:6,accessors:["utrRating"],accessor:"utrRating",decimalsCount:2,ascending:!0,range:[1,16]},[N3]:{attributes:{confidence:{generator:!0,range:[60,100]}},accessors:["wtnRating","confidence"],defaultInitialization:23,accessor:"wtnRating",ascending:!1,decimalsCount:2,range:[40,1]}},Da=xke;function Oke({sourceRatingType:t,sourceRating:e}){let i=Da[t].range,n=i[0]>i[1],r=Da[Du].range;return Q0({value:n?i[0]-e:e,sourceRange:i,targetRange:r})}function Lke({targetRatingType:t,sourceRating:e}){let i=Da[t].decimalsCount||0,n=Da[t].range,r=n[0]>n[1],a=Math.max(...n),s=Da[Du].range,o=Q0({targetRange:n,sourceRange:s,value:e}),l=parseFloat(o.toFixed(i));return r?a-l:l}function aZ(t){var d;let e=Qt(t,[{ratings:!0,[qo]:el}]);if(e.error)return e;let i=t.matchUpType&&[xn,Mn].includes(t.matchUpType)?t.matchUpType:xn,n=Object.keys(Da),r=t.targetRatingType&&n.includes(t.targetRatingType)?t.targetRatingType:Du,a=t.ratings[i]?t.ratings[i].reduce((p,h)=>p.includes(h.scaleName)?p:p.concat(h.scaleName),[]):[];if(!a)return{error:za};let s=((d=t.ratings[i])==null?void 0:d.find(p=>p.scaleName===r))??t.ratings[i][0];if(a[0]===r)return s;let o=s.scaleName,l=Da[s.scaleName].accessor,c=l?s.scaleValue[l]:s.scaleValue,u=Oke({sourceRatingType:o,sourceRating:c});return{convertedRating:Lke({targetRatingType:r,sourceRating:u}),sourceRating:c}}function Fke({participantResults:t,sides:e,score:i}){var o,l;let n=e.find(({sideNumber:c})=>c===1),r=e.find(({sideNumber:c})=>c===2),a=(o=n==null?void 0:n.participant)==null?void 0:o.ratings,s=(l=r==null?void 0:r.participant)==null?void 0:l.ratings;if(a!=null&&a[xn]&&(s!=null&&s[xn])){let c=Du,{convertedRating:u}=aZ({ratings:a,targetRatingType:c}),{convertedRating:d}=aZ({ratings:s,targetRatingType:c}),{side1pressure:p,side2pressure:h}=$ke({side1ConvertedRating:u,side2ConvertedRating:d,score:i});p&&t[n==null?void 0:n.participantId].pressureScores.push(p),h&&t[r==null?void 0:r.participantId].pressureScores.push(h);let f=Math.max(...Da[Du].range),m=_A((d-u)/f),g=_A((u-d)/f);t[n==null?void 0:n.participantId].ratingVariation.push(m),t[r==null?void 0:r.participantId].ratingVariation.push(g)}}function $ke({side1ConvertedRating:t,side2ConvertedRating:e,score:i}){var y,b;let n=t>e?t:e,r=t>e?e:t,a=Math.abs(t-e),s=Da[Du].range,o=Math.max(...s),l=(o-n)*0,c=(n+l)/o*a,u=(y=i==null?void 0:i.sets)==null?void 0:y.reduce((I,T)=>I+((T==null?void 0:T.side1Score)??0),0),d=(b=i==null?void 0:i.sets)==null?void 0:b.reduce((I,T)=>I+(T.side2Score??0),0),p=t>e?2:1,h=(u||0)*(r+(p===1?c:0)),f=(d||0)*(r+(p===2?c:0)),m=h+f,g=m?_A(h/m):0,v=m?_A(f/m):0;return{side1pressure:g,side2pressure:v}}function A3({winningSide:t,matchUpFormat:e=Nu,matchUpStatus:i,tallyPolicy:n,score:r}){let a=[0,0],s=r==null?void 0:r.sets,o=typeof t=="number"&&t-1,l=wo(e),c=_3((l==null?void 0:l.bestOf)??1);if(typeof o=="number"&&(i===Yi&&(n!=null&&n.setsCreditForDefaults)||i===cn&&(n!=null&&n.setsCreditForWalkovers)))a[o]=c;else for(let u of s||[]){let{winningSide:d}=u;d&&(a[d-1]+=1)}return typeof o=="number"&&i===as&&(+a[1-o]===c&&(a[1-o]-=1),n!=null&&n.setsCreditForRetirements&&(a[o]=c)),a}function ece({matchUpFormat:t=Nu,winningSide:e,matchUpStatus:i,tallyPolicy:n,score:r}){var p,h;let{sets:a}=r||{};if(!a)return[0,0];let s=typeof e=="number"&&e-1,o=wo(t),l=(o==null?void 0:o.bestOf)??1,c=_3(l),u=((p=o==null?void 0:o.setFormat)==null?void 0:p.tiebreakAt)||0,d=[[],[]];if(typeof s=="number"&&(i===Yi&&(n!=null&&n.gamesCreditForDefaults)||i===cn&&(n!=null&&n.gamesCreditForWalkovers))){let f=((h=o==null?void 0:o.setFormat)==null?void 0:h.setTo)||0,m=c*f;d[s].push(m)}else a.forEach((f,m)=>{var T;let g=(f.setNumber||m+1)>c&&(o!=null&&o.finalSetFormat)?"finalSetFormat":"setFormat",v=(T=o==null?void 0:o[g])==null?void 0:T.based,y=o==null?void 0:o[g].tiebreakSet,{side1Score:b,side2Score:I}=f;sZ(v)&&(d[0].push(ui(b||0)),d[1].push(ui(I||0))),y&&f.winningSide&&(n==null?void 0:n.gamesCreditForTiebreakSets)!==!1&&d[f.winningSide-1].push(1)});if(i===as&&typeof s=="number"){let f=a.length>c&&(o!=null&&o.finalSetFormat)?"finalSetFormat":"setFormat",m=o==null?void 0:o[f];if(sZ(m.based)){let g=(m==null?void 0:m.setTo)||0,v=b=>{if(!(!o||b===""))return+b===u-1||+b===u?ui(u||0)+1:+b<u?g:u},y=A3({winningSide:e,score:{sets:a},matchUpStatus:i,matchUpFormat:t,tallyPolicy:n});if(d.map(b=>b[s]<=b[1-s]).reduce((b,I)=>b+(I?1:0),0)>y[1-s]){let b=d[s].length,I=v(d[1-s][b-1]);I&&(d[s][b-1]=I)}c>d[s].length&&(n!=null&&n.gamesCreditForRetirements)&&d[s].push(g)}}return[d[0].reduce((f,m)=>f+m,0),d[1].reduce((f,m)=>f+m,0)]}function tce({matchUpFormat:t,score:e}){var o;let i=t?wo(t):void 0,n=(i==null?void 0:i.bestOf)??1,r=_3(n),a=[0,0],s=[0,0];return(o=e==null?void 0:e.sets)==null||o.forEach((l,c)=>{var p;let u=(l.setNumber||c+1)>r&&(i!=null&&i.finalSetFormat)?"finalSetFormat":"setFormat",d=(p=i==null?void 0:i[u])==null?void 0:p.based;if(ice(d)){let{side1Score:h,side2Score:f}=l;h&&(s[0]+=ui(h||0)),f&&(s[1]+=ui(f||0))}else l.side1TiebreakScore&&(s[0]+=ui(l.side1TiebreakScore||0)),l.side2TiebreakScore&&(s[1]+=ui(l.side2TiebreakScore||0)),(l.side1TiebreakScore||l.side2TiebreakScore)&&l.winningSide&&(a[l.winningSide-1]+=1)}),{pointsTally:s,tiebreaksTally:a}}function _3(t){return t&&Math.ceil(t/2)||1}function ice(t){return t==="P"}function sZ(t){return!ice(t)}function Bke({participantResults:t,matchUpFormat:e,tallyPolicy:i,perPlayer:n,totalSets:r}){var c;let a=e&&wo(e)||{},s=a.bestOf,o=s&&Math.ceil(s/2)||1,l=(c=a.setFormat)==null?void 0:c.setTo;Object.keys(t).forEach(u=>{let d=t[u].setsWon,p=t[u].setsLost,h=i!=null&&i.groupTotalSetsPlayed?r:n*(o||0)||d+p,f=Math.round(d/h*1e3)/1e3;(f===1/0||isNaN(f))&&(f=h);let m=t[u].tieMatchUpsWon,g=t[u].tieMatchUpsLost,v=m+g,y=Math.round(m/v*1e3)/1e3;(y===1/0||isNaN(y))&&(y=m);let b=t[u].matchUpsWon,I=t[u].matchUpsLost,T=b+I,w=Math.round(b/T*1e3)/1e3;(w===1/0||isNaN(w))&&(w=b);let S=t[u].gamesWon||0,U=t[u].gamesLost||0,P=(n||0)*(o||0)*(l||0),E=Math.max(P,S+U),R=Math.round(S/E*1e3)/1e3;(R===1/0||isNaN(R))&&(R=0);let C=t[u].pointsWon+t[u].pointsLost,M=Math.round(t[u].pointsWon/C*1e3)/1e3;(M===1/0||isNaN(M))&&(M=0),t[u].setsWon=d,t[u].setsLost=p,t[u].setsPct=f,t[u].tieMatchUpsWon=m,t[u].tieMatchUpsPct=y,t[u].matchUpsPct=w,t[u].gamesWon=S,t[u].gamesLost=U,t[u].gamesPct=R,t[u].pointsPct=M,t[u].result=`${t[u].matchUpsWon}/${t[u].matchUpsLost}`})}function IC({participantIds:t,pressureRating:e,matchUpFormat:i,tallyPolicy:n,perPlayer:r,matchUps:a}){var u,d,p,h,f,m,g;let s={},o=(n==null?void 0:n.excludeMatchUpStatuses)||[],l=a==null?void 0:a.filter(v=>(v.tieMatchUps||!o.includes(v.matchUpStatus))&&(!(t!=null&&t.length)||Nr(t,[eS(v,0),eS(v,1)]).length===2)),c=(u=l==null?void 0:l.flatMap(({score:v,tieMatchUps:y})=>{var b;return y?y.filter(({matchUpStatus:I})=>!o.includes(I)).flatMap(({score:I})=>{var T;return((T=I==null?void 0:I.sets)==null?void 0:T.length)??0}):((b=v==null?void 0:v.sets)==null?void 0:b.length)??0}))==null?void 0:u.reduce((v,y)=>v+y,0);for(let v of l??[]){let{matchUpStatus:y,tieMatchUps:b,tieFormat:I,score:T,winningSide:w,sides:S}=v,U=I&&v._disableAutoCalc&&I.collectionDefinitions.every(({scoreValue:M})=>M),P=w&&Vke(v),E=w&&jke(v);if(!P&&!E)if(y&&ca.includes(y)){let M=eS(v,0),_=eS(v,1);M&&(qm(s,M),s[M].matchUpsCancelled+=1),_&&(qm(s,_),s[_].matchUpsCancelled+=1)}else if(b!=null&&b.length){r=0;for(let M of b){if(M.winningSide){let _=(d=S==null?void 0:S.find(({sideNumber:N})=>N===M.winningSide))==null?void 0:d.participantId,A=(p=S==null?void 0:S.find(({sideNumber:N})=>N===M.winningSide))==null?void 0:p.participantId;_&&A&&(qm(s,_),qm(s,A),s[_].tieMatchUpsWon+=1,s[A].tieMatchUpsLost+=1,Fr(xn)(M.matchUpType)?(s[_].tieSinglesWon+=1,s[A].tieSinglesLost+=1):Fr(Mn)(M.matchUpType)&&(s[_].tieDoublesWon+=1,s[A].tieDoublesLost+=1))}oZ({score:M.score,manualGamesOverride:U,participantResults:s,sides:S})}}else oZ({manualGamesOverride:U,participantResults:s,score:T,sides:S});else if(qm(s,P),qm(s,E),b==null?void 0:b.length){r=0;for(let M of b){let{matchUpType:_}=M,A=Fr(Mn)(_),N=Fr(xn)(_);M.winningSide&&(M.winningSide===w?(P&&(s[P].tieMatchUpsWon+=1,N&&(s[P].tieSinglesWon+=1),A&&(s[P].tieDoublesWon+=1)),E&&(s[E].tieMatchUpsLost+=1,N&&(s[E].tieSinglesLost+=1),A&&(s[E].tieDoublesLost+=1))):M.winningSide!==w&&(E&&(s[E].tieMatchUpsWon+=1,N&&(s[E].tieSinglesWon+=1),A&&(s[E].tieDoublesWon+=1)),P&&(s[P].tieMatchUpsLost+=1,N&&(s[P].tieSinglesLost+=1),A&&(s[P].tieDoublesLost+=1)))),lZ({matchUpFormat:M.matchUpFormat,matchUpStatus:M.matchUpStatus,matchUpType:M.matchUpType,score:M.score,sides:M.sides,winningParticipantId:P,losingParticipantId:E,manualGamesOverride:U,participantResults:s,isTieMatchUp:!0,pressureRating:e,tallyPolicy:n,winningSide:w})}nce({winningParticipantId:P,losingParticipantId:E,participantResults:s,matchUpStatus:y})}else lZ({matchUpFormat:v.matchUpFormat??i,matchUpType:v.matchUpType,isTieMatchUp:void 0,winningParticipantId:P,manualGamesOverride:U,losingParticipantId:E,participantResults:s,pressureRating:e,matchUpStatus:y,tallyPolicy:n,winningSide:w,score:T,sides:S});let R=(h=T==null?void 0:T.sets)==null?void 0:h.reduce((M,_)=>M+((_==null?void 0:_.side1Score)??0),0),C=(f=T==null?void 0:T.sets)==null?void 0:f.reduce((M,_)=>M+(_.side2Score??0),0);if(U){let M=(m=S==null?void 0:S.find(({sideNumber:A})=>A===1))==null?void 0:m.participantId,_=(g=S==null?void 0:S.find(({sideNumber:A})=>A===2))==null?void 0:g.participantId;qm(s,M),qm(s,_),M&&(s[M].gamesWon+=R,s[M].gamesLost+=C),_&&(s[_].gamesWon+=C,s[_].gamesLost+=R)}}return Bke({participantResults:s,matchUpFormat:i,tallyPolicy:n,perPlayer:r,totalSets:c}),{participantResults:s}}function Vke(t){let e=t.winningSide-1;return eS(t,e)}function jke(t){let e=1-(t.winningSide-1);return eS(t,e)}function eS(t,e){if(!(t!=null&&t.sides))return console.log("no sides:",{matchUp:t}),"foo";let i=t.sides[e];return i?i.participantId:(console.log("No Side",{matchUp:t,index:e}),"foo")}function qm(t,e){e&&!t[e]&&(t[e]={allDefaults:0,defaults:0,defeats:[],gamesLost:0,gamesWon:0,matchUpsCancelled:0,matchUpsLost:0,matchUpsWon:0,pointsLost:0,pointsWon:0,pressureScores:[],ratingVariation:[],retirements:0,setsLost:0,setsWon:0,tieSinglesWon:0,tieSinglesLost:0,tieDoublesWon:0,tieDoublesLost:0,tieMatchUpsLost:0,tieMatchUpsWon:0,victories:[],walkovers:0})}function oZ({manualGamesOverride:t,participantResults:e,score:i,sides:n}){let{sets:r}=i||{},a=[[],[]],s=[0,0];for(let l of r||[]){let{winningSide:c,side1Score:u,side2Score:d}=l;c&&(s[c-1]+=1),a[0].push(ui(u||0)),a[1].push(ui(d||0))}let o=[a[0].reduce((l,c)=>l+c,0),a[1].reduce((l,c)=>l+c,0)];n.forEach((l,c)=>{let{participantId:u}=l;u&&(qm(e,u),e[u].setsWon+=s[c],e[u].setsLost+=s[1-c],t||(e[u].gamesWon+=o[c],e[u].gamesLost+=o[1-c]))})}function lZ({winningParticipantId:t,manualGamesOverride:e,losingParticipantId:i,participantResults:n,pressureRating:r,matchUpFormat:a,matchUpStatus:s,isTieMatchUp:o,matchUpType:l,tallyPolicy:c,winningSide:u,score:d,sides:p}){let h=u&&u-1,f=1-h;r&&l===xn&&Fke({participantResults:n,sides:p,score:d}),o||nce({winningParticipantId:t,losingParticipantId:i,participantResults:n,matchUpStatus:s});let m=A3({matchUpStatus:s,matchUpFormat:a,tallyPolicy:c,winningSide:u,score:d}),g=ece({matchUpStatus:s,matchUpFormat:a,tallyPolicy:c,winningSide:u,score:d}),{pointsTally:v}=tce({score:d,matchUpFormat:a});t&&(n[t].setsWon+=m[h],n[t].setsLost+=m[f],e||(n[t].gamesWon+=g[h],n[t].gamesLost+=g[f]),n[t].pointsWon+=v[h],n[t].pointsLost+=v[f]),i&&(n[i].setsWon+=m[f],n[i].setsLost+=m[h],e||(n[i].gamesWon+=g[f],n[i].gamesLost+=g[h]),n[i].pointsWon+=v[f],n[i].pointsLost+=v[h])}function nce({winningParticipantId:t,losingParticipantId:e,participantResults:i,matchUpStatus:n}){e&&(n===cn&&(i[e].walkovers+=1),n===Yi&&(i[e].defaults+=1),n===as&&(i[e].retirements+=1),[Yi,as,cn].includes(n)&&(i[e].allDefaults+=1),i[e].matchUpsLost+=1),t&&(i[t].matchUpsWon+=1),e&&t&&(i[e].defeats.push(t),i[t].victories.push(e))}function Gke({matchUps:t,order:e,report:i}){let n={};t.forEach(({sides:a})=>{a.forEach(s=>{s.participantId&&s.participant&&(n[s.participantId]=s.participant.participantName)})});let r=[];return Array.isArray(i)&&i.forEach((a,s)=>{var o,l;if((o=a.excludedDirectives)!=null&&o.length){let c=a.excludedDirectives.map(({attribute:p})=>p).join(", "),u=`${c.length} directives were excluded due to participants limit}`;r.push(u);let d=`Excluded: ${c}`;r.push(d)}else{let c=(m,g)=>parseFloat(a.reversed?m:g)-parseFloat(a.reversed?g:m),u=a.groups?Object.values(a.groups).flat(1/0).length:((l=a.participantIds)==null?void 0:l.length)??0,d=m=>{m.groups&&Object.keys(m.groups).sort(c).forEach(g=>{let v=m.groups[g].map(b=>n[b]).join(", "),y=`${g} ${m.attribute}: ${v}`;r.push(y)})},p=a.reversed?" in reverse order":"",h=a.groups?"grouped":"separated",f=`Step ${s+1}: ${u} particiants were ${h}${p} by ${a.attribute}`;if(r.push(f),a.idsFilter){let m=`${a.attribute} was calculated considering ONLY TIED PARTICIPANTS`;r.push(m)}d(a)}r.push("----------------------")}),r.push("Final Order:"),e.forEach(a=>{let{participantId:s,resolved:o}=a,l=a.groupOrder||a.provisionalOrder;r.push(`${l}: ${n[s]} => resolved: ${!!o}`)}),r.join(`\r
`)}function rce({participantResults:t,participantIds:e,attribute:i}){return ace({participantResults:t,participantIds:e}).reduce((n,r)=>{let{participantId:a,results:s}=r,o=s==null?void 0:s[i];return!isNaN(o)&&a&&(n[o]?n[o].push(a):n[o]=[a]),n},{})}function ace(t){return(t.participantIds||Object.keys(t.participantResults)).reduce((e,i,n)=>(e.push({participantId:i,i:n,results:t.participantResults[i]}),e),[])}var Hke=[{attribute:"matchUpsPct",idsFilter:!1},{attribute:"allDefaults",reversed:!0,idsFilter:!1},{attribute:"defaults",reversed:!0,idsFilter:!1},{attribute:"walkovers",reversed:!0,idsFilter:!1},{attribute:"retirements",reversed:!0,idsFilter:!1},{attribute:"setsPct",idsFilter:!1},{attribute:"gamesPct",idsFilter:!1},{attribute:"pointsPct",idsFilter:!1},{attribute:"matchUpsPct",idsFilter:!0},{attribute:"setsPct",idsFilter:!0},{attribute:"gamesPct",idsFilter:!0},{attribute:"pointsPct",idsFilter:!0}],y$={matchUpsPct:20,tieMatchUpsPct:16,pointsPct:4,gamesPct:8,setsPct:12};function cZ(t){let{requireCompletion:e=!0,participantResults:i,subOrderMap:n,tallyPolicy:r}=t,a=[];if(e&&!zke(t))return{};let s=["tieMatchUpsWon","tieSinglesWon","tieDoublesWon","matchUpsWon","pointsWon","gamesWon","setsWon","gamesPct","setsPct","pointsPct","matchUpsPct"].includes(r==null?void 0:r.groupOrderKey)?r.groupOrderKey:"matchUpsWon",o=rce({participantResults:i,attribute:s});a.push({attribute:s,groups:o});let l=Object.keys(o).map(g=>parseFloat(g)).sort((g,v)=>v-g).map(g=>o[g]).map(g=>{let v=sce({participantIds:g,...t});return a.push(...v.report??[]),v.order}).map((g,v)=>g.map(y=>y.resolved?y:{...y,subGroup:[v].concat(...y.subGroup??[])})).flat(),c,u=0,d=1,p;l.forEach((g,v)=>{var b;v&&(g.resolved||p&&!g.resolved)&&(d+=1),p=g.resolved;let y=parseInt(((b=g.subGroup)==null?void 0:b.join(""))||0);g.resolved?(g.position=v+1,d=g.position):(c&&y>c&&(d+=u,u=0),g.position=d,u+=1),c=y});let h=l.map(({position:g})=>g),f=Ml(h);return l.forEach(g=>{let{participantId:v,position:y}=g||{},b=i[v];g.GEMscore=m(b);let I=f[y];(g==null?void 0:g.position)!==void 0&&(I>1&&(g.ties=I,n&&(g.subOrder=n[v])),g.rankOrder=y,g.groupOrder=y+(g.subOrder||1)-1)}),{groupOrder:l,report:a.flat(1/0).filter(Boolean)};function m(g){return(Array.isArray(r==null?void 0:r.GEMscore)?Object.keys(y$).filter(v=>r.GEMscore.includes(v)):Object.keys(y$)).map(v=>(g[v]||0)*Math.pow(10,y$[v].toFixed(3))).reduce((v,y)=>v+y,0)}}function zke({participantResults:t,participantsCount:e}){let i=ace({participantResults:t}).filter(n=>e-1===n.results.matchUpsWon+n.results.matchUpsLost+n.results.matchUpsCancelled);return e===i.length}function qke({disableHeadToHead:t,participantIds:e,matchUpFormat:i,tallyPolicy:n,attribute:r,idsFilter:a,matchUps:s,reversed:o}){let{participantResults:l}=IC({participantIds:a&&e,matchUpFormat:i,tallyPolicy:n,matchUps:s}),c=rce({participantResults:l,participantIds:e,attribute:r}),u=[{attribute:r,reversed:o,groups:c,idsFilter:a}],d;return Object.keys(c).length>1&&e.length&&(d=Object.keys(c).map(p=>parseFloat(p)).sort((p,h)=>o?p-h:h-p).map(p=>c[p]).map(p=>{let h=sce({participantResults:l,disableHeadToHead:t,participantIds:p,matchUpFormat:i,tallyPolicy:n,matchUps:s});return u.push(...h.report??[]),h.order}).map((p,h)=>p.map(f=>f.resolved?f:{...f,subGroup:[h].concat(...f.subGroup??[])})).flat()),{order:d,report:u}}function sce({participantResults:t,disableHeadToHead:e,participantIds:i,matchUpFormat:n,tallyPolicy:r,matchUps:a}){let s=[],o=[],l;if((i==null?void 0:i.length)===1)return{order:[{resolved:!0,participantId:i[0]}]};if((i==null?void 0:i.length)===2&&(!(r!=null&&r.headToHead)||!r.headToHead.disabled&&!e)){let u=Wke({participantIds:i,participantResults:t});if(u){let d=u[0].participantId;return o.push({attribute:"head2Head",participantIds:i,headToHeadWinner:d}),{order:u,headToHeadWinner:d,report:o}}}let c=((r==null?void 0:r.tallyDirectives)||Hke).filter(u=>{let d=!(Dr(u.maxParticipants)&&(i==null?void 0:i.length)>u.maxParticipants);return d||s.push(u),d});return s.length&&o.push({excludedDirectives:s,participantIds:i}),c.every(({attribute:u,reversed:d,idsFilter:p,disableHeadToHead:h})=>(l=qke({disableHeadToHead:h,participantIds:i,matchUpFormat:n,tallyPolicy:r,attribute:u,idsFilter:p,matchUps:a,reversed:d}),o.push(l.report),!l.order)),l.order?{order:l.order,report:o}:{order:i==null?void 0:i.map(u=>({participantId:u})),report:o}}function Wke({participantIds:t,participantResults:e}){if(t){if(e[t[0]].victories.includes(t[1]))return t.map(i=>({resolved:!0,participantId:i}));if(e[t[1]].victories.includes(t[0]))return t.reverse().map(i=>({resolved:!0,participantId:i}))}}function vU({policyDefinitions:t,generateReport:e,pressureRating:i,matchUpFormat:n,matchUps:r=[],subOrderMap:a,perPlayer:s}){if(!(r!=null&&r.length)||!tu(r))return{error:ym};let o=Ei(r.map(({structureId:I})=>I));if(o.length!==1)return he({result:{error:Re,info:"Maximum one structureId"},stack:"tallyParticipantResults",context:{structureIds:o}});let l=r.filter(I=>I&&I.matchUpStatus!==mn),c=l.length&&Ei(l.map(({drawPositions:I})=>I).flat()).length,u=l.filter(I=>Gv({matchUp:I})).length===l.length;u||(s=0);let d=r.every(({matchUpType:I,tieMatchUps:T})=>I===Zn&&(T==null?void 0:T.every(w=>Gv({matchUp:w})))),p=t==null?void 0:t[hq],h=r.filter(I=>Gv({matchUp:I})||I.matchUpType===Zn),{participantResults:f}=IC({matchUps:h,pressureRating:i,matchUpFormat:n,tallyPolicy:p,perPlayer:s}),m,g,{groupOrder:v,report:y}=cZ({matchUps:h,participantResults:f,participantsCount:c,matchUpFormat:n,tallyPolicy:p,subOrderMap:a});if(i&&Yke({participantResults:f}),u&&v)m=y,g=v,v.forEach(I=>{let{participantId:T,groupOrder:w,rankOrder:S,subOrder:U,ties:P,GEMscore:E}=I,R=f[T];Object.assign(R,{groupOrder:w,rankOrder:S,GEMscore:E,subOrder:U,ties:P})});else{let{groupOrder:I,report:T}=cZ({requireCompletion:!1,participantResults:f,participantsCount:c,matchUpFormat:n,tallyPolicy:p,subOrderMap:a,matchUps:r});m=T,g=I,I&&I.forEach(w=>{let{participantId:S,groupOrder:U,GEMscore:P}=w,E=f[S];Object.assign(E,{provisionalOrder:U,GEMscore:P})})}let b={completedTieMatchUps:d,readableReport:"",participantResults:f,bracketComplete:u,order:[],report:m};if((u||d)&&(b.order=g),e||ic({tally:!0})){let I=Gke({matchUps:r,report:m,order:g});ic({tally:!0})&&console.log(I),b.readableReport=I}return b}function Yke({participantResults:t}){let e=r=>r.reduce((a,s)=>a+parseFloat(s),0),i=r=>parseFloat((e(r)/r.length).toFixed(2)),n=Object.keys(t).map(r=>{let a=t[r],{pressureScores:s}=a,o=s!=null&&s.length?i(s):0;return{participantId:r,averagePressure:o}}).sort((r,a)=>(a.averagePressure||0)-(r.averagePressure||0)).map((r,a)=>({...r,order:a+1}));for(let r of n)t[r.participantId].pressureOrder=r.order}function oce({positionAssignments:t}){let e=(t||[]).filter(kl(Lh)).map(r=>{let{extension:a}=ki({element:r,name:VS}),s=ui(a==null?void 0:a.value),o=!isNaN(s)&&s;return o&&{participantId:r.participantId,subOrder:o}}).filter(Boolean),i=e.map(({subOrder:r})=>r),n=Ml(i);return{subOrderMap:Object.assign({},...e.filter(({subOrder:r})=>n[r]===1).map(({participantId:r,subOrder:a})=>({[r]:a})))}}function k3({positionAssignments:t,tournamentRecord:e,drawDefinition:i,matchUpFormat:n,matchUps:r,event:a}){if(!tu(r))return{error:Re};if(!t)return{error:Re};let{policyDefinitions:s}=wm({policyTypes:[hq],tournamentRecord:e,drawDefinition:i,event:a}),{subOrderMap:o}=oce({positionAssignments:t}),l=r.length?vU({policyDefinitions:s,matchUpFormat:n,subOrderMap:o,matchUps:r}):void 0;if(l!=null&&l.error)return l;let{participantResults:c={},bracketComplete:u,report:d}=l??{},p=Object.keys(c);return t.forEach(h=>{let{participantId:f}=h;if(p.includes(f)){let m={value:c[f],name:cg};dn({element:h,extension:m}),c[f].ties||oo({element:h,name:VS})}else oo({element:h,name:cg}),oo({element:h,name:VS})}),Hn({drawDefinition:i}),{...de,participantResults:c,bracketComplete:u,report:d}}function lce({matchUps:t,matchUpId:e}){return{matchUp:(t||[]).find(i=>i.matchUpId===e)}}function ar(t){let e=Qt(t,[{[To]:!0,[Gp]:!0}]);if(e.error)return e;let{tournamentParticipants:i,afterRecoveryTimes:n,contextProfile:r,drawDefinition:a,matchUpsMap:s,matchUpId:o,inContext:l,context:c,event:u}=t,{structures:d=[]}=Wu({drawDefinition:a}),p=t.contextContent||r&&Sm({contextProfile:r,drawDefinition:a});for(let h of d){let{matchUps:f}=wn({tournamentParticipants:i,afterRecoveryTimes:n,contextContent:p,drawDefinition:a,contextProfile:r,matchUpsMap:s,inContext:l,structure:h,context:c,event:u}),{matchUp:m}=lce({matchUps:f,matchUpId:o});if(m)return{matchUp:m,structure:h}}return{error:_s}}function sO(t){var e;return!Xi(t)||!t.notes?{error:ai}:Xi(t.element)?!nr(t.notes)&&!((e=t.notes)!=null&&e.testing)?{error:Re}:(Object.assign(t.element,{notes:t.notes}),{...de}):{error:Re}}function x3(t){return Xi(t)?Xi(t.element)?(t.element.notes&&delete t.element.notes,{...de}):{error:Re}:{error:ai}}var oO={matchUpStatus:Vr,matchUpStatusCodes:[],score:{scoreStringSide1:"",scoreStringSide2:"",sets:void 0},matchUpFormat:void 0,winningSide:void 0};function vp(t){var S,U,P,E,R,C,M,_;let e="modifyMatchUpScore",i=t.matchUpFormat,n=t.matchUp,r,{matchUpStatusCodes:a,tournamentRecord:s,drawDefinition:o,matchUpStatus:l,removeScore:c,winningSide:u,matchUpId:d,event:p,notes:h,score:f}=t,m=t.appliedPolicies&&Object.keys(t.appliedPolicies).length?t.appliedPolicies:(S=hn({policyTypes:[zc],tournamentRecord:s,drawDefinition:o,structure:r,event:p}))==null?void 0:S.appliedPolicies,g=n.matchUpType===Zn;if(g&&o){if(d&&n.matchUpId!==d){let A=ar({drawDefinition:o,matchUpId:d,event:p});if(!A.matchUp)return{error:_s};({matchUp:n,structure:r}=A)}}else n.matchUpId!==d&&console.log("!!!!!");l&&[cn,Yr].includes(l)||c?Object.assign(n,{...oO}):f&&(n.score=f);let v=l&&(n==null?void 0:n.matchUpStatus)===Yi&&l!==Yi;l&&(n.matchUpStatus=l),i&&(n.matchUpFormat=i),a&&(n.matchUpStatusCodes=a),u&&(n.winningSide=u),t.removeWinningSide&&(n.winningSide=void 0),!r&&o&&({structure:r}=ar({drawDefinition:o,matchUpId:d,event:p})),l&&!n.winningSide&&ga(n)&&!ca.includes(l)&&![KI,Vg,_l].includes(l)&&(n.matchUpStatus=td);let y;if((v&&((U=n==null?void 0:n.processCodes)!=null&&U.length)||l===Yi)&&(y=(E=(P=m==null?void 0:m[zc])==null?void 0:P.processCodes)==null?void 0:E.incompleteAssignmentsOnDefault),!n.collectionId){let A=(r==null?void 0:r.structureType)===So,N=Vo({structure:r});if(Kq({drawDefinition:o,structure:r})||N||A){let k=F=>{i=g?"SET1-S:T100":i??n.matchUpFormat??(F==null?void 0:F.matchUpFormat)??(o==null?void 0:o.matchUpFormat)??(p==null?void 0:p.matchUpFormat);let V=g?{matchUpTypes:[Zn]}:void 0,{matchUps:j}=wn({afterRecoveryTimes:!1,tournamentRecord:s,inContext:!0,matchUpFilters:V,drawDefinition:o,structure:F,event:p});return N&&(F.positionAssignments=Ei(j.flatMap(B=>(B.sides??[]).map(z=>z.participantId)).filter(Boolean)).map(B=>({participantId:B}))),k3({positionAssignments:F.positionAssignments,tournamentRecord:s,drawDefinition:o,matchUpFormat:i,matchUps:j,event:p})},O=A&&r.structures.find(F=>F==null?void 0:F.matchUps.find(V=>V.matchUpId===d)),$=k(O||r);if($.error)return he({result:$,stack:e})}}if(h){let A=sO({element:n,notes:h});if(A.error)return he({result:A,stack:e})}let b=s==null?void 0:s.tournamentId,I=dc().topics.includes(Lx),T=(I||y)&&Ts({drawDefinition:o}),w=T&&((R=ua({matchUpFilters:{matchUpIds:[d]},nextMatchUps:!0,tournamentRecord:s,inContext:!0,drawDefinition:o,matchUpsMap:T}).matchUps)==null?void 0:R[0]);if(I&&w&&JNe({tournamentId:b,inContextMatchUp:w}),Array.isArray(y)&&w&&!((C=w.sides)!=null&&C.every(({participantId:A})=>A)))if(l===Yi)n.processCodes=Ei([...n.processCodes??[],...y]);else for(let A of y||[]){let N=A&&((M=n==null?void 0:n.processCodes)==null?void 0:M.lastIndexOf(A));(_=n==null?void 0:n.processCodes)==null||_.splice(N,1)}return Ji({eventId:p==null?void 0:p.eventId,context:e,drawDefinition:o,tournamentId:b,matchUp:n}),{...de}}function O3(t){var f,m,g,v;let{matchUpStatusCodes:e,matchUpStatus:i,structure:n,matchUp:r,dualMatchUp:a,inContextMatchUp:s,autoCalcDisabled:o}=t,l=sC({matchUpStatus:i})||[zp,sl].includes(i)&&a||o,c=((f=r==null?void 0:r.sides)==null?void 0:f.map(y=>y.participantId).filter(Boolean).length)||((m=s==null?void 0:s.sides)==null?void 0:m.map(y=>y.participantId).filter(Boolean).length),u="attemptToModifyScore";if(!(Vo({structure:n})&&c===1||i===Yi&&c||Kke({structure:n,matchUp:r,inContextMatchUp:s})||((v=(g=t.appliedPolicies)==null?void 0:g[zc])==null?void 0:v.requireParticipantsForScoring)===!1))return he({result:{error:Sz},stack:u});let d=[cn].includes(i),p=l?i:t.winningSide&&Lr||_l,h=vp({...t,matchUpStatusCodes:l&&e||[],matchUpStatus:p,context:u,removeScore:d});return he({result:h,stack:u})}function Kke({structure:t,matchUp:e,inContextMatchUp:i}){var o;let{drawPositions:n}=e,{positionAssignments:r}=Ma({structure:t}),a=r==null?void 0:r.filter(l=>(n==null?void 0:n.includes(l.drawPosition))&&l.participantId),s=(o=i==null?void 0:i.sides)==null?void 0:o.every(l=>l.participantId);return(a==null?void 0:a.length)===2||s}function cce({collectionGroups:t=[]}){let e=Object.assign({},...t.filter(n=>Ii(n==null?void 0:n.groupValue)&&(n==null?void 0:n.groupNumber)).map(n=>({[n.groupNumber]:{...n,allGroupMatchUpsCompleted:!0,matchUpsCount:0,sideWins:[0,0],values:[0,0]}}))),i=Object.keys(e).map(n=>ui(n));return{groupValueGroups:e,groupValueNumbers:i}}function Zke({collectionDefinition:t,groupValueNumbers:e,groupValueGroups:i,sideTieValues:n,tieMatchUps:r}){let a=r.filter(y=>y.collectionId===t.collectionId),s=[0,0],o=[0,0],l=a.every(y=>ca.includes(y.matchUpStatus)),{collectionValueProfiles:c,collectionGroupNumber:u,collectionValue:d,matchUpValue:p,winCriteria:h,scoreValue:f,setValue:m}=t,g=u&&e.includes(u),v=[0,0];if(a.forEach(y=>{y.winningSide&&(v[y.winningSide-1]+=1)}),Ii(p)?a.forEach(y=>{y.winningSide&&(s[y.winningSide-1]+=p)}):Ii(m)?a.forEach(y=>{var b,I;(I=(b=y.score)==null?void 0:b.sets)==null||I.forEach(T=>{T.winningSide&&(s[T.winningSide-1]+=m)})}):Ii(f)?a.forEach(y=>{var b,I;(I=(b=y.score)==null?void 0:b.sets)==null||I.forEach(T=>{let{side1TiebreakScore:w=0,side2TiebreakScore:S=0,side1Score:U=0,side2Score:P=0}=T;(y.matchUpStatus===Lr||y.winningSide||T.winningSide)&&(U||P?(s[0]+=U,s[1]+=P):(w||S)&&T.winningSide&&(s[T.winningSide-1]+=1))})}):Array.isArray(c)&&a.forEach(y=>{if(y.winningSide){let b=y.collectionPosition,I=Xke({collectionDefinition:t,collectionPosition:b});Ii(I)&&(s[y.winningSide-1]+=I)}}),Ii(d)){let y;if(h!=null&&h.aggregateValue)l&&(Ii(p||m||f)&&s[0]!==s[1]?y=s[0]>s[1]?1:2:v[0]!==v[1]&&(y=v[0]>v[1]?1:2));else if(h!=null&&h.valueGoal)y=s.reduce((b,I,T)=>I>=h.valueGoal?T+1:b,0);else{let b=Math.floor(t.matchUpCount/2)+1;y=v.reduce((I,T,w)=>T>=b?w+1:I,0)}y&&(g?i[u].values[y-1]+=d:o[y-1]+=d)}else g?(i[u].values[0]+=s[0]||0,i[u].values[1]+=s[1]||0):o=s;g?(i[u].sideWins[0]+=v[0]||0,i[u].sideWins[1]+=v[1]||0,i[u].allGroupMatchUpsCompleted=i[u].allGroupMatchUpsCompleted&&l,i[u].matchUpsCount+=a.length):o.forEach((y,b)=>n[b]+=y||0)}function Xke({collectionDefinition:t,collectionPosition:e}){var i,n;return(n=(i=t.collectionValueProfiles||[])==null?void 0:i.find(r=>r.collectionPosition===e))==null?void 0:n.matchUpValue}function wC(t){var I,T,w,S,U;let{sideAdjustments:e=[0,0],separator:i="-",drawDefinition:n,matchUpsMap:r,structure:a,matchUp:s,event:o}=t;if(!Array.isArray(e)||e.length!==2||isNaN(e.reduce((P,E)=>P+E)))return{error:Re};if(!s)return{error:rl};let l=((I=qs({matchUp:s,drawDefinition:n,structure:a,event:o}))==null?void 0:I.tieFormat)||(t==null?void 0:t.tieFormat);if(!l)return{error:XT};let c=Bo({tieFormat:l});if(c.error)return c;let u=(l==null?void 0:l.collectionDefinitions)||[],d=(s==null?void 0:s.tieMatchUps)??[],p=[0,0],{groupValueGroups:h,groupValueNumbers:f}=cce(l);for(let P of u)Zke({collectionDefinition:P,groupValueNumbers:f,groupValueGroups:h,sideTieValues:p,tieMatchUps:d});for(let P of f){let E=h[P],{allGroupMatchUpsCompleted:R,matchUpCount:C,winCriteria:M,groupValue:_,sideWins:A,values:N}=E,k;if(M!=null&&M.aggregateValue)R&&N[0]!==N[1]&&(k=N[0]>N[1]?1:2);else if(M!=null&&M.valueGoal)k=N.reduce((O,$,F)=>$>=M.valueGoal?F+1:O,void 0);else{let O=Math.floor(C/2)+1;k=A.reduce(($,F,V)=>F>=O?V+1:$,void 0)}k&&(p[k-1]+=_||0)}let m=p.map((P,E)=>(P||0)+e[E]),g={side1Score:m[0],side2Score:m[1],winningSide:void 0},v=m.join(i),y=m.slice().reverse().join(i),b;if(l!=null&&l.winCriteria){let{valueGoal:P,aggregateValue:E,tallyDirectives:R}=l.winCriteria;if(P?b=(T=m.map((C,M)=>({sideNumber:M+1,points:C})).find(({points:C})=>C>=P))==null?void 0:T.sideNumber:E&&d.every(C=>C.matchUpStatus&&ca.includes(C.matchUpStatus)||C.winningSide)&&m[0]!==m[1]&&(b=m[0]>m[1]?1:2),!b&&R){let C=s.matchUpId,M=s.hasContext?s:((w=r==null?void 0:r.drawMatchUps)==null?void 0:w[C])||n&&((S=ar({inContext:!0,drawDefinition:n,matchUpId:C}))==null?void 0:S.matchUp);if(M){let{completedTieMatchUps:_,order:A}=vU({matchUps:[M]});if(_&&(A!=null&&A.length)){let N=A[0].participantId;b=(U=M.sides.find(({participantId:k})=>k===N))==null?void 0:U.sideNumber}}}}return b&&(g.winningSide=b),{scoreStringSide1:v,scoreStringSide2:y,winningSide:b,set:g}}function SC({inContextDualMatchUp:t,drawDefinition:e,tournamentId:i,dualMatchUp:n,eventId:r}){var a,s;if(n){t||(t=(a=ar({matchUpId:n.matchUpId,inContext:!0,drawDefinition:e}))==null?void 0:a.matchUp);let{extension:o}=ki({element:e,name:zf}),l=_t((o==null?void 0:o.value)||{},!1,!0),c=({displaySideNumber:u,drawPosition:d,sideNumber:p})=>({drawPosition:d,sideNumber:p,displaySideNumber:u});n.sides=(s=t==null?void 0:t.sides)==null?void 0:s.map(u=>{var g;let d=u.participantId,p=d&&l[d]||void 0,{lineUp:h,...f}=((g=n.sides)==null?void 0:g.find(({sideNumber:v})=>v===u.sideNumber))??{},m=h!=null&&h.length?h:p;return{...c(u),...f,lineUp:m}}),Ji({context:"ensureSidLineUps",matchUp:n,drawDefinition:e,tournamentId:i,eventId:r})}}function cs(t){if(t)return _t(t,!1,!0)}function L3(t){let e=Qt(t,[{[ks]:!0}]);return e.error?e:Object.keys(t.tournamentRecords).reduce((i,n)=>{i.tournamentIdMap[n]=[];let r=t.tournamentRecords[n].events??[],a=r.map(({eventId:o})=>o),s=r.map(o=>(o.drawDefinitions??[]).map(({drawId:l})=>l)).flat();return i.tournamentIdMap[n].push(...a,...s),i.eventIds.push(...a),i.drawIds.push(...s),i},{eventIds:[],drawIds:[],tournamentIdMap:{}})}function uce({tournamentRecords:t,eventId:e,drawId:i}){let{tournamentIdMap:n}=L3({tournamentRecords:t});return(n?Object.keys(n):[]).find(r=>e&&(n==null?void 0:n[r].includes(e))||i&&(n==null?void 0:n[r].includes(i)))}function Tm(t){var C,M,_,A;let{exitWhenNoValues:e,drawDefinition:i,matchUpStatus:n,removeScore:r,matchUpsMap:a,matchUpId:s,event:o}=t,l=t.tournamentRecords||t.tournamentRecord&&{[(C=t.tournamentRecord)==null?void 0:C.tournamentId]:t.tournamentRecord}||{},c=t.tournamentId||((M=t.tournamentRecord)==null?void 0:M.tournamentId);l&&uce({tournamentRecords:l,...t});let u=c&&l[c];if(!u)return{error:ut};let d=ar({drawDefinition:i,event:o,matchUpId:s});if(d.error)return d;if(!d.matchUp)return{error:_s};let{matchUp:p,structure:h}=d;if(!p.tieMatchUps)return{error:al};SC({tournamentId:u==null?void 0:u.tournamentId,eventId:o==null?void 0:o.eventId,dualMatchUp:p,drawDefinition:i});let{extension:f}=ki({name:uI,element:p});if(f!=null&&f.value)if(r)oo({element:p,name:uI});else return{...de,score:p.score};let m=(_=qs({drawDefinition:i,structure:h,matchUp:p,event:o}))==null?void 0:_.tieFormat;p.tieFormat=cs(m);let g=wC({drawDefinition:i,matchUpsMap:a,structure:h,matchUp:p,event:o}),{winningSide:v,set:y,scoreStringSide1:b,scoreStringSide2:I}=g,T=(y==null?void 0:y.side1Score)||(y==null?void 0:y.side2Score);if(e&&!p.score&&!T)return{...de};let w={scoreStringSide1:b,scoreStringSide2:I,sets:y?[y]:[]},S=v&&[1,2].includes(v),U=S&&Lr||i3({matchUpStatus:n??p.matchUpStatus,tieMatchUps:p.tieMatchUps,winningSide:p.winningSide,score:w})&&td||Vr,P=!!(p.winningSide&&!S),E=p.tieMatchUps.find(({score:N,winningSide:k,matchUpStatus:O})=>{var $;return(($=N==null?void 0:N.sets)==null?void 0:$.length)&&(N.sets[0].side1Score||N.sets[0].side2Score)||O&&ca.includes(O)||k}),R;if(p.tieFormat&&!S&&!E){let N=(A=qs({drawDefinition:i,structure:h,event:o}))==null?void 0:A.tieFormat;N&&JSON.stringify(m)===JSON.stringify(N)&&(p.tieFormatId=void 0,p.tieFormat=void 0,R=!0)}return vp({appliedPolicies:t.appliedPolicies,matchUpStatus:U,score:w,removeWinningSide:P,tournamentRecord:u,drawDefinition:i,removeScore:r,winningSide:v,matchUpId:s,matchUp:p,event:o}),{...de,score:w,removeWinningSide:P,tieFormatRemoved:R,winningSide:v}}function Jke({winnerMatchUpDrawPositionIndex:t,inContextDrawMatchUps:e,projectedWinningSide:i,sourceMatchUpStatus:n,winningDrawPosition:r,tournamentRecord:a,winnerTargetLink:s,sourceMatchUpId:o,drawDefinition:l,winnerMatchUp:c,dualMatchUp:u,matchUpsMap:d,event:p}){var f,m,g,v,y;let h="directWinner";if(s){let b=c.drawPositions||[],I=b[t],T=s.source.structureId,w=hi({structureId:T,drawDefinition:l});if(w.error)return w;let{structure:S}=w,{positionAssignments:U}=Ma({structureId:T,drawDefinition:l}),P=(f=U==null?void 0:U.find(A=>A.drawPosition===r))==null?void 0:f.participantId,E=s.target.structureId,{positionAssignments:R}=Ma({structureId:E,drawDefinition:l}),C=(m=R==null?void 0:R.find(A=>A.participantId===P))==null?void 0:m.drawPosition,M=R==null?void 0:R.filter(A=>{let N=b.includes(A.drawPosition),k=!A.participantId&&!A.bye&&!A.qualifier;return N&&k}).map(A=>A.drawPosition),_=M==null?void 0:M.includes(I);if(P&&s.target.roundNumber===1&&_)Rp({drawPosition:I,participantId:P,structureId:E,inContextDrawMatchUps:e,sourceMatchUpStatus:n,tournamentRecord:a,drawDefinition:l,matchUpsMap:d,event:p});else if(P&&(M!=null&&M.length)){let A=M.pop();A&&Rp({participantId:P,structureId:E,inContextDrawMatchUps:e,sourceMatchUpStatus:n,tournamentRecord:a,drawDefinition:l,drawPosition:A,matchUpsMap:d,event:p})}else if(C){let A=zS({drawPosition:C,matchUpId:c.matchUpId,inContextDrawMatchUps:e,sourceMatchUpStatus:n,tournamentRecord:a,sourceMatchUpId:o,drawDefinition:l,matchUpsMap:d});if(A.error)return he({result:A,stack:h})}else if((S==null?void 0:S.stage)!==ni){let A="winner target position unavaiallble";return console.log(A),{error:A}}if(S!=null&&S.seedAssignments&&S.structureId!==E){let A=S.seedAssignments.find(({participantId:k})=>k===P),N=A==null?void 0:A.participantId;A&&N&&fU({eventId:c==null?void 0:c.eventId,structureId:E,...A,tournamentRecord:a,drawDefinition:l,participantId:N})}}else{let b=zS({matchUpId:c.matchUpId,drawPosition:r,inContextDrawMatchUps:e,sourceMatchUpStatus:n,tournamentRecord:a,sourceMatchUpId:o,drawDefinition:l,matchUpsMap:d});if(b.error)return b}if(u&&i){let b=(g=u.sides)==null?void 0:g.find(I=>I.sideNumber===i);if(b!=null&&b.lineUp){let I=u.roundPosition,T=c.roundPosition,w=I===T&&I!==1||Math.floor(I/2)===T?2:1,S=(v=d==null?void 0:d.drawMatchUps)==null?void 0:v.find(({matchUpId:E})=>E===c.matchUpId),U=[1,2].map(E=>{var R;return{...((R=S.sides)==null?void 0:R.find(C=>C.sideNumber===E))||{},sideNumber:E}});S.sides=U;let P=S.sides.find(E=>E.sideNumber===w);if(P){let E=(y=b.lineUp)==null?void 0:y.filter(R=>R==null?void 0:R.participantId);P.lineUp=v3({lineUp:E}),Ji({tournamentId:a==null?void 0:a.tournamentId,eventId:c==null?void 0:c.eventId,matchUp:S,context:h,drawDefinition:l})}}}return{...de}}function Qke(t){var F,V,j;let{loserMatchUpDrawPositionIndex:e,inContextDrawMatchUps:i,projectedWinningSide:n,sourceMatchUpStatus:r,loserDrawPosition:a,tournamentRecord:s,loserTargetLink:o,drawDefinition:l,loserMatchUp:c,dualMatchUp:u,matchUpsMap:d,event:p}=t,h="directLoser",f=o.linkCondition,m=c.drawPositions||[],g=f===Pp&&c.roundNumber===2&&Math.min(...m.filter(Boolean)),v=g||m[e],y=g||m[1-e],b=o.source.structureId,{structure:I}=hi({structureId:b,drawDefinition:l}),{matchUps:T}=wn({afterRecoveryTimes:!1,inContext:!0,drawDefinition:l,structure:I,event:p}),w=T.filter(B=>{var z;return(z=B.drawPositions)==null?void 0:z.includes(a)}).filter(B=>{let z=B.sides.find(Z=>Z.drawPosition===a),W=B.matchUpStatus===cn||B.matchUpStatus===Yi&&!ga(B);return(z==null?void 0:z.sideNumber)===B.winningSide&&!W}),S=f===Pp&&w.length===0,{positionAssignments:U}=Ma({structureId:b,drawDefinition:l}),P=(F=U==null?void 0:U.find(B=>B.drawPosition===a))==null?void 0:F.participantId,E=o.target.structureId,{positionAssignments:R}=Ma({structureId:E,drawDefinition:l}),C=R==null?void 0:R.filter(({drawPosition:B})=>m.includes(B));if(C!=null&&C.some(B=>B.participantId===P))return{...de};let M=C==null?void 0:C.filter(B=>{let z=m.includes(B.drawPosition),W=!B.participantId&&!B.bye&&!B.qualifier;return z&&W}).map(B=>B.drawPosition),_=M==null?void 0:M.includes(v),A=o.target.roundNumber>1&&(M==null?void 0:M.length),N=o.target.roundNumber===1&&_;if(g){let B=k();if(B.error)return he({result:B,stack:h})}else if(N){let B=$();if(B.error)return he({result:B,stack:h})}else if(P&&A){M.sort(ia);let B=M[0],z=Rp({participantId:P,structureId:E,drawPosition:B,inContextDrawMatchUps:i,sourceMatchUpStatus:r,tournamentRecord:s,drawDefinition:l,matchUpsMap:d,event:p});if(z.error)return he({result:z,stack:h})}else return he({context:{loserDrawPosition:a,loserTargetLink:o,targetDrawPositionIsUnfilled:_},result:{error:_?YT:JRe},stack:h});if(I!=null&&I.seedAssignments&&I.structureId!==E){let B=I.seedAssignments.find(({participantId:W})=>W===P),z=B==null?void 0:B.participantId;B&&z&&fU({eventId:c==null?void 0:c.eventId,structureId:E,...B,tournamentRecord:s,drawDefinition:l,participantId:z})}if(u&&n){let B=(V=u.sides)==null?void 0:V.find(z=>z.sideNumber===3-n);if(B!=null&&B.lineUp){let{roundNumber:z,eventId:W}=c,{roundPosition:Z}=u,K=z===1?2-Z%2:1,Q=(j=d==null?void 0:d.drawMatchUps)==null?void 0:j.find(({matchUpId:ie})=>ie===c.matchUpId),J=[1,2].map(ie=>{var ce;return{...((ce=Q.sides)==null?void 0:ce.find(oe=>oe.sideNumber===ie))||{},sideNumber:ie}});Q.sides=J;let se=Q.sides.find(ie=>ie.sideNumber===K);se&&(se.lineUp=v3({lineUp:B.lineUp}),Ji({tournamentId:s==null?void 0:s.tournamentId,matchUp:Q,context:h,drawDefinition:l,eventId:W}))}}return{...de};function k(){let B="loserLinkFedFMLC";return he(S?{result:$(),stack:B}:{result:O(),stack:B})}function O(){let B=fc({drawPosition:y,structureId:E,tournamentRecord:s,drawDefinition:l,event:p});return he({result:B,stack:"assignLoserPositionBye"})}function $(){let B=P?Rp({drawPosition:v,participantId:P,structureId:E,inContextDrawMatchUps:i,sourceMatchUpStatus:r,tournamentRecord:s,drawDefinition:l,matchUpsMap:d,event:p}):{error:la};return he({result:B,stack:"assignLoserDrawPosition"})}}function dce(t){var w;let e="directParticipants",i=O3(t);if(i.error)return he({result:i,stack:e});let n=sC({matchUpStatus:t.matchUpStatus}),{dualWinningSideChange:r,projectedWinningSide:a,inContextDrawMatchUps:s,tournamentRecord:o,drawDefinition:l,matchUpStatus:c,dualMatchUp:u,matchUpsMap:d,winningSide:p,targetData:h,matchUpId:f,structure:m,matchUp:g,event:v}=t,y=!!g.collectionId,b=Vo({structure:m}),I=g.drawPositions,T;if(y){let{matchUpTieId:S,matchUpsMap:U}=t,P=Tm({appliedPolicies:t.appliedPolicies,matchUpId:S,tournamentRecord:o,drawDefinition:l,matchUpsMap:U,event:v});if(T=P&&{tieMatchUpResult:P},I=(w=s.find(({matchUpId:E})=>E===S))==null?void 0:w.drawPositions,!r)return he({result:{...de,...T},stack:e})}if(b)return he({result:{...de,...T},stack:e});if(I){let S=a?a-1:p-1,U=1-S,P=I[S],E=I[U],{targetLinks:{loserTargetLink:R,winnerTargetLink:C,byeTargetLink:M},targetMatchUps:{winnerMatchUpDrawPositionIndex:_,loserMatchUpDrawPositionIndex:A,winnerMatchUp:N,loserMatchUp:k,byeMatchUp:O}}=h;if(N){let $=Jke({sourceMatchUpStatus:n&&c||Lr,winnerMatchUpDrawPositionIndex:_,sourceMatchUpId:f,inContextDrawMatchUps:s,projectedWinningSide:a,winningDrawPosition:P,tournamentRecord:o,winnerTargetLink:C,drawDefinition:l,winnerMatchUp:N,dualMatchUp:u,matchUpsMap:d,event:v});if($.error)return he({result:$,stack:e})}if(k){let $=Qke({sourceMatchUpStatus:n&&c||Lr,loserMatchUpDrawPositionIndex:A,sourceMatchUpId:f,inContextDrawMatchUps:s,projectedWinningSide:a,loserDrawPosition:E,tournamentRecord:o,loserTargetLink:R,drawDefinition:l,loserMatchUp:k,winningSide:p,matchUpsMap:d,dualMatchUp:u,event:v});if($.error)return he({result:$,stack:e})}if(O){let $=O.drawPositions||[],F=Math.min(...$.filter(Boolean)),V=M.target.structureId,j=fc({drawPosition:F,structureId:V,tournamentRecord:o,drawDefinition:l,event:v});if(j.error)return he({result:j,stack:e})}}else return he({result:{error:RP},stack:e});return he({result:{...de,...T},stack:e})}function F3(t){var K,Q,J,se;let e="genPlayoffStructure";if(!t.drawDefinition)return he({result:{error:Gt},stack:e});let i=vC(t);if(i.error)return he({result:i,stack:e});let{structureId:n,addNameBaseToAttributeName:r,playoffStructureNameBase:a,finishingPositionNaming:s,finishingPositionLimit:o,playoffAttributes:l,playoffPositions:c,roundOffsetLimit:u,tournamentRecord:d,exitProfileLimit:p,roundProfiles:h,roundNumbers:f,idPrefix:m,isMock:g,event:v,uuids:y}=t,b=_t(t.drawDefinition,!1,!0),{structure:I}=hi({structureId:n,drawDefinition:b});if(!I)return he({result:{error:gr},stack:e});if(I.structureType===So||I.structures)return _ke({sourceStructureId:I.structureId,...t,...i,drawDefinition:b});let{playoffRoundsRanges:T,playoffRounds:w}=i,{playoffPositionsReturned:S,error:U,playoffSourceRounds:P,playoffRoundsRanges:E}=qle(t);if(U)return he({result:{error:U},stack:e});let R=(h==null?void 0:h.length)&&Object.assign({},...h),C=f||typeof h=="object"&&h.map(ie=>Object.keys(ie)).flat(),M=Array.isArray(C)&&C.map(ie=>!isNaN(ie)&&ui(ie)).filter(Boolean);if(M){if(!Array.isArray(M))return he({result:{error:Re},context:{validRoundNumbers:M},stack:e});M.forEach(ie=>{if(!(w!=null&&w.includes(ie)))return he({result:{error:Re},context:{roundNumber:ie},stack:e})})}c&&c.forEach(ie=>{if(!(S!=null&&S.includes(ie)))return he({result:{error:Re},context:{playoffPosition:ie},stack:e})});let _=M||P,A=M?T:E,N=[],k=[];for(let ie of _??[]){let ce=A==null?void 0:A.find(we=>we.roundNumber===ie);if(!ce)return he({result:{error:Re},context:{roundNumber:ie},stack:e});let oe=ce.finishingPositions.length,te=Math.min(...ce.finishingPositions)-1,le=2,ne=ie&&(R==null?void 0:R[ie])&&le+R[ie]-1,me=hS({exitProfile:`0-${ie}`,addNameBaseToAttributeName:r,playoffStructureNameBase:a,finishingPositionOffset:te,playoffAttributes:l,exitProfileLimit:p,stage:Rr,roundOffset:0,drawDefinition:b,sequenceLimit:ne,stageSequence:le,drawSize:oe,idPrefix:m,isMock:g,uuids:y,finishingPositionNaming:s,finishingPositionLimit:o,roundOffsetLimit:u});if(me.error)return he({result:me,stack:e});let{structures:be,links:Se}=me;if(be!=null&&be.length&&N.push(...be),Se!=null&&Se.length&&k.push(...Se),me.structureId&&ie){let we={linkType:xh,source:{structureId:n,roundNumber:ie},target:{structureId:me.structureId,feedProfile:Pu,roundNumber:1}};k.push(we)}}if(!N.length)return he({result:{error:Re},info:"No structures generated",stack:e});b.structures.push(...N),b.links.push(...k);let{matchUps:O,matchUpsMap:$}=ua({inContext:!0,drawDefinition:b}),F=N.map(({structureId:ie})=>ie),V=O==null?void 0:O.filter(({structureId:ie})=>F.includes(ie)).map(Pa),j=(K=$==null?void 0:$.drawMatchUps)==null?void 0:K.filter(({matchUpId:ie})=>V==null?void 0:V.includes(ie));if(j!=null&&j.length){let ie=(Q=qs({drawDefinition:b,event:v}))==null?void 0:Q.tieFormat;ie&&j.forEach(ce=>{let{tieMatchUps:oe}=yC({matchUp:ce,tieFormat:ie,isMock:g});Object.assign(ce,{tieMatchUps:oe,matchUpType:Zn})})}(J=O==null?void 0:O.filter(ie=>Gv({matchUp:ie})&&ie.structureId===n))==null||J.forEach(ie=>{let{matchUpId:ce,score:oe,winningSide:te}=ie,le=mo({inContextDrawMatchUps:O,drawDefinition:b,matchUpId:ce}),ne=dce({inContextDrawMatchUps:O,tournamentRecord:d,drawDefinition:b,matchUpsMap:$,winningSide:te,targetData:le,matchUpId:ce,structure:I,matchUp:ie,score:oe,event:v});ne.error&&console.log(ne.error)}),(se=O==null?void 0:O.filter(ie=>ie.matchUpStatus===mn&&ie.structureId===n))==null||se.forEach(ie=>{let{matchUpId:ce}=ie,oe=mo({inContextDrawMatchUps:O,drawDefinition:b,matchUpId:ce}),{targetLinks:{loserTargetLink:te},targetMatchUps:{loserMatchUpDrawPositionIndex:le,loserMatchUp:ne}}=oe;if(te&&ne){let me=te.target.structureId,be=ne.drawPositions[le],Se=fc({drawPosition:be,structureId:me,tournamentRecord:d,drawDefinition:b,event:v});Se.error&&console.log(Se.error)}});let B=[],z=ay({inContextDrawMatchUps:O,drawDefinition:b,matchUpsMap:$}).goesToMap,{structure:W}=hi({drawDefinition:t.drawDefinition,structureId:n}),{matchUps:Z}=wn({structure:W});return Z.forEach(ie=>{var te,le;let ce=z==null?void 0:z.loserMatchUpIds[ie.matchUpId];if(ce&&ie.loserMatchUpId!==ce){ie.loserMatchUpId=ce;let ne={tournamentId:d==null?void 0:d.tournamentId,eventId:(te=t.event)==null?void 0:te.eventId,context:e,matchUp:ie};B.push(ne)}let oe=z==null?void 0:z.winnerMatchUpIds[ie.matchUpId];if(oe&&ie.winnerMatchUpId!==oe){ie.winnerMatchUpId=oe;let ne={tournamentId:d==null?void 0:d.tournamentId,eventId:(le=t.event)==null?void 0:le.eventId,context:e,matchUp:ie};B.push(ne)}}),{structures:N,matchUpModifications:B,links:k,drawDefinition:b,...de}}function pce({element:t}){if(!t)return{error:Re};if(!t.timeItems)return{};if(!Array.isArray(t.timeItems))return{error:Re};let e=(i,n)=>(r,a)=>(a[i]&&(r[a[i]]=a[n]),r);return t.timeItems.reduce(e("itemType","itemValue"),{})}function qp(t){let{duplicateValues:e=!0,creationTime:i=!0,removePriorValues:n,timeItem:r}=t;if(!r)return{error:xz};let a=Ioe(t);if(a.error)return a;if(!(Xi(r)&&nr(r.itemType)&&Object.keys(r).includes("itemValue")))return{error:kz};if(!a.timeItems)a.timeItems=[];else if(exe({element:a,duplicateValues:e,timeItem:r}))return{...de};if(r.itemSubTypes&&!r.itemSubTypes.length&&delete r.itemSubTypes,i){let s=new Date().toISOString();Object.assign(r,{createdAt:s})}return n&&(a.timeItems=a.timeItems.filter(({itemType:s})=>r.itemType!==s)),n&&!r.itemValue||a.timeItems.push(r),{...de}}function exe({element:t,duplicateValues:e,timeItem:i}){var o;let{itemType:n,itemSubTypes:r,itemValue:a}=i,s=n&&((o=Qc({itemSubTypes:r,itemType:n,element:t}))==null?void 0:o.timeItem);return s&&JSON.stringify(s==null?void 0:s.itemValue)===JSON.stringify(a)&&!e}function $3({creationTime:t=!0,removePriorValues:e,tournamentRecord:i,duplicateValues:n,participantId:r,timeItem:a}){if(!i)return{error:ut};if(!r)return{error:la};let s=jg({tournamentRecord:i,participantId:r});return s.error?s:qp({element:s.participant,removePriorValues:e,duplicateValues:n,creationTime:t,timeItem:a})}function TC(t){let{removePriorValues:e,tournamentRecord:i,duplicateValues:n,creationTime:r,timeItem:a}=t;if(!i)return{error:ut};let s=qp({element:i,removePriorValues:e,duplicateValues:n,creationTime:r,timeItem:a});if(s.error)return s;let o=pce({element:i});return Si({payload:{parentOrganisation:i.parentOrganisation,tournamentId:i.tournamentId,timeItemValues:o},topic:xy}),s}function uw(t){let{removePriorValues:e,duplicateValues:i,creationTime:n,timeItem:r,event:a}=t;return a?qp({removePriorValues:e,duplicateValues:i,element:a,creationTime:n,timeItem:r}):{error:Gc}}function hce(t){return lO({...t,itemType:"attachConsolationStructures"})}function B3(t){return lO({...t,itemType:"attachPlayoffStructures"})}function lO({itemType:t="attachStructures",matchUpModifications:e,tournamentRecord:i,drawDefinition:n,structures:r,links:a=[],event:s}){var g,v,y;let o="attachStructures";if(!n)return{error:Gt};if(!Array.isArray(r)||!Array.isArray(a))return he({result:{error:Re},stack:o});let l=b=>{var I;return[b.source.structureId,b.source.roundNumber||((I=b.source.finishingPositions)==null?void 0:I.join("|")),b.target.roundNumber].join("|")},c=(g=n.links)==null?void 0:g.map(l);if(a.some(b=>{let I=l(b);return c==null?void 0:c.includes(I)}))return he({result:{error:Bz},info:"playoff structure exists",stack:o});a.length&&((v=n.links)==null||v.push(...a));let u=r.map(({structureId:b})=>b),d=(y=n.structures)==null?void 0:y.map(({structureId:b})=>b);n.structures=(n.structures??[]).map(b=>u.includes(b.structureId)?r.find(({structureId:I})=>I===b.structureId):b);let p=r==null?void 0:r.filter(({structureId:b})=>!(d!=null&&d.includes(b)));p.length&&n.structures.push(...p),ay({drawDefinition:n});let h=r.map(b=>{var I;return((I=wn({structure:b}))==null?void 0:I.matchUps)||[]}).flat();dg({tournamentId:i==null?void 0:i.tournamentId,eventId:s==null?void 0:s.eventId,drawDefinition:n,matchUps:h});let f=r.map(({structureId:b})=>b);if(Hn({drawDefinition:n,structureIds:f}),e==null?void 0:e.length){let b={};e.forEach(T=>{var S;let w=(S=T.matchUp)==null?void 0:S.matchUpId;w&&(b[w]=T)});let I=T=>{T.matchUps.forEach(w=>{if(b[w.matchUpId]){let{tieMatchUps:S,...U}=b[w.matchUpId].matchUp;if(Object.assign(w,U),S==null?void 0:S.length){let P={};S.forEach(E=>b[E.matchUpId]=E),w.tieMatchUps.forEach(E=>Object.assign(E,P[E.matchUpId]))}b[w.matchUpId].matchUp=w,Ji(b[w.matchUpId])}})};n.structures.forEach(T=>{if(d!=null&&d.includes(T.structureId))if(T.structures)for(let w of T.structures)I(w);else I(T)})}let m=p.map(kl("structureId"));if(i){let b={itemValue:{structureIds:f,drawId:n.drawId},itemType:t};qp({element:i,timeItem:b})}return{...de,addedStructureIds:m}}function cO(t){var s,o;let{structures:e,links:i,matchUpModifications:n,error:r}=F3(t);if(r)return{error:r};let a=t.drawDefinition;return B3({tournamentId:(s=t.tournamentRecord)==null?void 0:s.tournamentId,eventId:((o=t.event)==null?void 0:o.eventId)||t.eventId,matchUpModifications:n,drawDefinition:a,structures:e,links:i})}function oy(t){let e=Qt(t,[{_anyOf:{[ks]:!1,[ba]:!1,[To]:!1,[Fg]:!1},[rq]:!0}]);if(e.error)return e;let i=[],n=t.drawDefinition??t.event??((t.tournamentId||!t.tournamentRecords)&&t.tournamentRecord);if(n){let r=uZ(t,n);if(r.error)return r;i.push(...(r==null?void 0:r.applied)??[]),t.drawDefinition&&Hn({drawDefinition:t.drawDefinition,tournamentId:t.tournamentId})}else if(t.tournamentRecords){let r=Object.keys(t.tournamentRecords);if(!r.length)return{error:ut};for(let a of r){let s=t.tournamentRecords[a],o=uZ(t,s);if(o.error)return o;i.push(...(o==null?void 0:o.applied)??[])}}else return{error:ut};return i.length?{...de,applied:i}:{error:Pz}}function uZ(t,e){let i=hn(t).appliedPolicies??{};e.extensions||(e.extensions=[]);let n=[],r=Object.keys(t.policyDefinitions);if(!r.length)return{error:ix};for(let a of r)if(!i[a]||t.allowReplacement){let s=t.policyDefinitions[a];if(!s)continue;if(!Xi(s))return{error:Re};let{policyName:o,...l}=s;if(!l||!Object.keys(l).length||o&&!nr(o))return{error:Re};i[a]=t.policyDefinitions[a],n.push(a)}return n!=null&&n.length?{...dn({element:e,extension:{name:oE,value:i}}),applied:n}:{applied:n,error:Pz}}function V3({tournamentRecord:t,drawDefinition:e,flightProfile:i,drawName:n,drawId:r,event:a}){var o;if(!n||typeof n!="string")return he({result:{error:Re},context:{drawName:n}});i||(i=_r({event:a}).flightProfile);let s=(o=i==null?void 0:i.flights)==null?void 0:o.find(l=>l.drawId===r);if(s){s.drawName=n;let l={name:qu,value:{...i,flights:i.flights}};Bg({event:a,extension:l})}return e&&(e.drawName=n,Hn({tournamentId:t==null?void 0:t.tournamentId,drawDefinition:e})),!s&&!e?{error:Gt}:{...de,flight:s}}function fce({tournamentRecord:t,drawDefinition:e,drawUpdates:i,drawId:n,event:r}){var l;if(!Xi(i))return{error:Re};let a=_r({event:r}).flightProfile,s=i.drawName&&V3({drawName:i.drawName,tournamentRecord:t,drawDefinition:e,flightProfile:a,drawId:n,event:r});if(s!=null&&s.error)return s==null?void 0:s.error;let o=(s==null?void 0:s.flight)||((l=a==null?void 0:a.flights)==null?void 0:l.find(c=>c.drawId===n));if(!o&&!e)return{error:Gt};if(o){let c={name:qu,value:{...a,flights:a.flights}};Bg({event:r,extension:c})}return e&&(i.policyDefinitions&&oy({policyDefinitions:i.policyDefinitions,drawDefinition:e}),Hn({tournamentId:t==null?void 0:t.tournamentId,drawDefinition:e})),{...de}}function mce({tournamentRecord:t,removeScheduling:e,drawDefinition:i}){var s,o;if(!i)return{error:Gt};let n=Ts({drawDefinition:i}),r=l=>{var c;return(c=n==null?void 0:n.drawMatchUps)==null?void 0:c.find(u=>u.matchUpId===l)};for(let l of i.structures||[]){let{positionAssignments:c,stage:u,stageSequence:d}=l;c&&(d!==1||![ni,Ft].includes(u))&&(l.positionAssignments=c.map(f=>(delete f.participantId,f)),l.seedAssignments=[]);let{matchUps:p,isRoundRobin:h}=wn({afterRecoveryTimes:!1,inContext:!0,matchUpsMap:n,structure:l});for(let f of p){let{matchUpId:m,roundNumber:g}=f,v=f.sides||[],y=r(m);if(y){if(delete y.extensions,delete y.notes,y.matchUpStatus!==mn&&Object.assign(y,oO),g&&g>1&&((s=y.drawPositions)==null?void 0:s.length)&&!h){let b=v==null?void 0:v.map(({drawPosition:T,participantFed:w})=>!w&&T).filter(Boolean),I=y.drawPositions.map(T=>b.includes(T)?void 0:T);y.drawPositions=I}e?delete y.timeItems:(o=y.timeItems)!=null&&o.length&&(y.timeItems=y.timeItems.filter(b=>b.itemType&&![$h,hg,JI,Jq,QI,ew].includes(b.itemType))),Ji({tournamentId:t==null?void 0:t.tournamentId,context:"resetDrawDefiniton",drawDefinition:i,matchUp:y})}}}i.extensions=i.extensions.filter(l=>l.name!==dS);let a=(i.structures||[]).map(({structureId:l})=>l);return Hn({drawDefinition:i,structureIds:a}),{...de}}function UC({tournamentRecord:t}){var n;if(!t)return{error:ut};let e={positionsNoOutcomes:[],canBePruned:[],matchPlay:[],inactive:[],drawAnalysis:{}},i={};return((n=t.events)==null?void 0:n.map(r=>{let a=r.eventId;return i[a]=r,((r==null?void 0:r.drawDefinitions)||[]).map(s=>({drawDefinition:s,eventId:a}))}).flat().filter(Boolean)).forEach(({drawDefinition:r,eventId:a})=>{let s=0,o=0,l=0,{allStructuresLinked:c}=nO({drawDefinition:r}),u=i[a],d=((r==null?void 0:r.structures)||[]).map(I=>{let{stage:T,stageSequence:w,structureId:S}=I,U=lI[T],{inContextStructureMatchUps:P}=oC({drawDefinition:r,structure:I,event:u}),E=P==null?void 0:P.filter(({winningSide:B})=>B),R=E.filter(Boolean).length||0;o+=R,l+=P.length-o;let C=Math.max(E.filter(({roundNumber:B})=>B===1).map(({roundPosition:B})=>B)),{positionAssignments:M}=jn({structure:I}),_=M==null?void 0:M.filter(({participantId:B})=>B);s+=(_==null?void 0:_.length)??0;let A=((M==null?void 0:M.length)??0)-((_==null?void 0:_.length)??0),{roundMatchUps:N,roundProfile:k,roundNumbers:O,maxMatchUpsCount:$}=fo({matchUps:P}),F=k&&Object.keys(k).filter(B=>!k[B].inactiveRound).map(B=>parseInt(B)),V=k&&Object.keys(k).filter(B=>k[B].inactiveRound).map(B=>parseInt(B)),j=k&&Object.values(k).every(B=>B.inactiveRound);return{positionsAssignedCount:(_==null?void 0:_.length)??0,maxWinningSideFirstRoundPosition:C,unassignedPositionsCount:A,inactiveStructure:j,maxMatchUpsCount:$,inactiveRounds:V,roundMatchUps:N,activeRounds:F,roundNumbers:O,roundProfile:k,structureId:S,stageSequence:w,orderNumber:U,stage:T}}),p=d.find(I=>I.orderNumber===2&&I.stageSequence===1),h=d.filter(({inactiveStructure:I})=>!I).length,{links:f}=uU({structureId:p.structureId,drawDefinition:r}),m=ui(p.activeRounds[0])===1&&p.activeRounds.length===1&&h===1,g=d==null?void 0:d.every(({inactiveStructure:I})=>I),v=!f.length&&p.activeRounds.length&&(p.roundProfile[1].inactiveCount||p.inactiveRounds.length),y=r.drawId;s&&!o&&e.positionsNoOutcomes.push(y),g&&e.inactive.push(y),m&&e.matchPlay.push(y),v&&e.canBePruned.push(y);let b={matchUpsWithWinningSideCount:o,matchUpsNoOutcomeCount:l,positionsAssignedCount:s,allStructuresLinked:c,structuresData:d,inactiveDraw:g,isMatchPlay:m,drawId:y};e.drawAnalysis[y]=b}),{...de,drawsAnalysis:e}}function gce({matchPlayDrawPositions:t=!0,tournamentRecord:e,drawDefinition:i,drawId:n}){var s;if(!e)return{error:ut};if(!i)return{error:Gt};let r=[],{drawsAnalysis:a}=UC({tournamentRecord:e});if(a.canBePruned.includes(n)){let o=a.matchPlay.includes(n),l=a.drawAnalysis[n],{structures:[c]}=Wu({stageSequence:1,drawDefinition:i,stage:Ft}),u=l.structuresData.find(({structureId:f})=>c.structureId===f),d=(c.matchUps??[]).sort((f,m)=>f.roundPosition-m.roundPosition);r=d.filter(({roundNumber:f})=>!u.inactiveRounds.includes(f));let p=r.map(Pa),h=d.map(Pa).filter(f=>!p.includes(f));if(o){let f=r.filter(({roundNumber:b})=>!u.inactiveRounds.includes(b)).filter(({winningSide:b})=>b),m=f.map(Pa),g=p.filter(b=>!m.includes(b));h.push(...g);let v=f.flatMap(b=>b.drawPositions??[]).filter(Boolean).flat(),y=Object.assign({},...v.map((b,I)=>({[b]:I+1})));if(f.forEach(b=>{t?b.drawPositions=b.drawPositions.map(I=>y[I]):delete b.drawPositions}),t){let b=(s=c==null?void 0:c.positionAssignments)==null?void 0:s.filter(I=>v.includes(I.drawPosition)).map(I=>(I.drawPosition=y[I.drawPosition],I));c.positionAssignments=b}else c.positionAssignments=[];c.matchUps=f,r=f}Im({tournamentId:e==null?void 0:e.tournamentId,matchUpIds:h,drawDefinition:i}),Hn({drawDefinition:i})}return{...de,matchUps:r}}function vce({tournamentRecord:t,drawDefinition:e,participantId:i,drawPosition:n,structureId:r,qualifier:a,event:s,bye:o}){if(!e)return{error:Gt};if(!n)return{error:KT};if(!r)return{error:uc};if(o){let l=fc({tournamentRecord:t,drawDefinition:e,drawPosition:n,structureId:r,event:s});if(l.error)return l}else{if(a)return{error:dx};{let l=Rp({tournamentRecord:t,drawDefinition:e,participantId:i,drawPosition:n,structureId:r,event:s});if(l.error)return l}}return{...de}}function yce(t){var l,c,u,d,p;let e=t.matchUpIds??[],{drawDefinition:i}=t,n=t.structureId??((c=(l=i==null?void 0:i.structures)==null?void 0:l.find(h=>{var f;return(f=h.matchUps)==null?void 0:f.some(({matchUpId:m})=>e.includes(m))}))==null?void 0:c.structureId)??((d=(u=i==null?void 0:i.structures)==null?void 0:u[0])==null?void 0:d.structureId);if(!n)return{error:gr};let r=(p=i.structures)==null?void 0:p.find(h=>h.structureId===n);if(!r)return{error:gr};let a=r==null?void 0:r.matchUps,s=a==null?void 0:a.find(h=>!!h.roundPosition);if(r.structures||s||r.finishingPosition===YI)return{error:My};let o=a.filter(({roundNumber:h})=>{var f;return(f=t.roundNumbers)==null?void 0:f.includes(h)}).map(Pa);return e=e.filter(h=>!o.includes(h)),t.roundNumbers&&!e.length&&(e=o),{existingMatchUps:a,matchUpIds:e,structureId:n,structure:r}}function bce(t){let e=Qt(t,[{[To]:!0},{[FS]:{[VP]:!1,roundNumbers:!1},[rc]:Re,[qo]:Rs}]);if(e.error)return e;let{removeIncomplete:i=!1,removeUnAssigned:n=!0,removeCompleted:r=!1,tournamentRecord:a,drawDefinition:s,event:o}=t,l=yce(t);if(l.error)return l;let{structure:c,structureId:u,existingMatchUps:d,matchUpIds:p}=l,h=[],f=(d==null?void 0:d.filter(({matchUpId:v,score:y,winningSide:b})=>{if(b&&!r)return!1;if(b||ga({score:y})){if(!b&&!i)return!1;h.push(v)}else if(!n)return!1;return p==null?void 0:p.includes(v)}))??[],m=f.map(Pa),g=f.map(({tieMatchUps:v})=>v==null?void 0:v.map(Pa)).filter(Boolean).flat();if(m.length){c.matchUps=(c.matchUps??[]).filter(({matchUpId:b})=>!m.includes(b)),Im({tournamentId:a==null?void 0:a.tournamentId,matchUpIds:[...g,...m],action:"deleteAdHocMatchUps",eventId:o==null?void 0:o.eventId,drawDefinition:s});let v=Ei(c.matchUps.map(kl("roundNumber"))),y=WRe(v);if(y.length){y.reverse();for(let b of y)c.matchUps.forEach(I=>{I.roundNumber&&I.roundNumber>b&&(I.roundNumber-=1,Ji({tournamentId:a==null?void 0:a.tournamentId,context:["adHoc round deletion"],eventId:o==null?void 0:o.eventId,drawDefinition:s,matchUp:I}))})}if(h.length){c.positionAssignments=Ei(c.matchUps.flatMap(S=>(S.sides??[]).map(U=>U.participantId)).filter(Boolean)).map(S=>({participantId:S}));let b=(c==null?void 0:c.matchUpFormat)??(s==null?void 0:s.matchUpFormat)??(o==null?void 0:o.matchUpFormat),I=l.existingMatchUps.some(S=>S.matchUpType===ec)?{matchUpTypes:[ec]}:void 0,{matchUps:T}=wn({afterRecoveryTimes:!1,inContext:!0,matchUpFilters:I,structure:c,event:o});Vo({structure:c})&&(c.positionAssignments=Ei(T.flatMap(S=>(S.sides??[]).map(U=>U.participantId)).filter(Boolean)).map(S=>({participantId:S})));let w=k3({positionAssignments:c.positionAssignments,tournamentRecord:a,drawDefinition:s,matchUpFormat:b,matchUps:T,event:o});w.error&&console.log(w)}Hn({structureIds:[u],eventId:o==null?void 0:o.eventId,drawDefinition:s})}return!m.length&&p.length?{error:px}:{...de,deletedMatchUpsCount:[...m,...g].length}}function Ice({removeCompletedMatchUps:t,tournamentRecord:e,drawDefinition:i,structureId:n,roundNumber:r,event:a}){if(!e)return{error:ut};if(!i)return{error:Gt};if(!r)return he({result:{error:ai},info:"roundNumber required"});let s=hi({drawDefinition:i,structureId:n});if(s.error)return s;let o=s.structure;return o!=null&&o.structures?{error:My}:Vo({structure:o})?txe({tournamentId:e.tournamentId,removeCompletedMatchUps:t,eventId:a.eventId,drawDefinition:i,roundNumber:r,structure:o}):(console.log("not implemented"),{...de})}function txe({removeCompletedMatchUps:t,drawDefinition:e,tournamentId:i,roundNumber:n,structure:r,eventId:a}){let s=(r==null?void 0:r.matchUps)??[],o=[],l=[],c=!1;if(s.reduce((u,d)=>{let p=d==null?void 0:d.roundNumber;return p?u.includes(p)?u:u.concat(p):u},[]).sort(ia).includes(n)){let u=s.filter(d=>{let p=d.roundNumber===n&&(!ca.includes(d.matchUpStatus)||t);return p&&(l.push(d.matchUpId),d.tieMatchUps&&o.push(...d.tieMatchUps.map(Pa))),!p});l.length&&(Im({matchUpIds:[...o,...l],drawDefinition:e,tournamentId:i,eventId:a}),u.some(d=>d.roundNumber===n)||(u.forEach(d=>{d.roundNumber>n&&(d.roundNumber-=1,Ji({drawDefinition:e,tournamentId:i,eventId:a,matchUp:d}))}),c=!0),r.matchUps=u)}return{deletedMatchUpsCount:l.length,roundRemoved:c,...de}}function uO(t){var p,h,f,m,g,v;let{suppressNotifications:e,tournamentRecord:i,drawDefinition:n,matchUps:r,event:a}=t;if(typeof n!="object")return{error:Gt};let s=t==null?void 0:t.structureId;if(!s&&((p=n.structures)==null?void 0:p.length)===1&&(s=(f=(h=n.structures)==null?void 0:h[0])==null?void 0:f.structureId),typeof s!="string")return{error:uc};if(!tu(r))return{error:Re,info:sy("matchUps")};let o=(m=n.structures)==null?void 0:m.find(y=>y.structureId===s);if(!o)return{error:gr};let l=(o==null?void 0:o.matchUps).find(y=>!!y.roundPosition);if(o.structures||l||o.finishingPosition===YI)return{error:My};let c=((v=(g=Wa({tournamentRecord:i,inContext:!1}))==null?void 0:g.matchUps)==null?void 0:v.map(Pa))??[],u=r.map(Pa);if(ho(c,u))return{error:Cae,info:"One or more matchUpIds already present in tournamentRecord"};o.matchUps.push(...r);let d=r.map(({tieMatchUps:y})=>y).filter(Boolean).flat();return e||(dg({tournamentId:i==null?void 0:i.tournamentId,matchUps:[...d,...r],eventId:a==null?void 0:a.eventId,drawDefinition:n}),Hn({drawDefinition:n,structureIds:[s]})),{...de}}function wce({tournamentRecord:t,drawDefinition:e,drawPosition:i,structureId:n,subOrder:r,event:a}){var h;if(!e)return{error:Gt};if(!n)return{error:uc};if(!i)return{error:KT};let{structure:s}=hi({drawDefinition:e,structureId:n});if(!s)return{error:gr};let o=s;s.structures&&s.structureType===So&&(o=(h=s.structures)==null?void 0:h.find(f=>{var m;return(m=f.positionAssignments)==null?void 0:m.find(g=>g.drawPosition===i)}));let l=o==null?void 0:o.positionAssignments,c=l==null?void 0:l.find(f=>f.drawPosition===i);c&&dn({element:c,extension:{name:VS,value:r}});let u=((a==null?void 0:a.eventType)===Zn||e.matchUpType===Zn||((a==null?void 0:a.tieFormat)??(e==null?void 0:e.tieFormat)??(s==null?void 0:s.tieFormat)))&&{matchUpTypes:[Zn]},{matchUps:d}=wn({structure:o,afterRecoveryTimes:!1,inContext:!0,matchUpFilters:u,event:a}),p=(s==null?void 0:s.matchUpFormat)??e.matchUpFormat;return k3({positionAssignments:l,tournamentRecord:t,drawDefinition:e,matchUpFormat:p,matchUps:d,event:a}),Hn({drawDefinition:e,structureIds:[n]}),{...de}}var Sce={};Li(Sce,{addGoesTo:()=>ay,allPlayoffPositionsFilled:()=>w3,checkValidEntries:()=>hO,findDrawDefinition:()=>z3,getAssignedParticipantIds:()=>jy,getAvailableMatchUpsCount:()=>dO,getAvailablePlayoffProfiles:()=>vC,getDrawDefinitionTimeItem:()=>Gq,getDrawParticipantRepresentativeIds:()=>G3,getDrawStructures:()=>Wu,getDrawTypeCoercion:()=>DC,getEligibleVoluntaryConsolationParticipants:()=>j3,getMatchUpsMap:()=>Ts,getParticipantIdFinishingPositions:()=>H3,getPositionAssignments:()=>mE,getPositionsPlayedOff:()=>gU,getSeedingThresholds:()=>m3,getSeedsCount:()=>EC,getStructureSeedAssignments:()=>qc,getTeamLineUp:()=>ry,getValidGroupSizes:()=>hC,isAdHoc:()=>Vo,isCompletedStructure:()=>fg,isValidForQualifying:()=>K3,positionActions:()=>Y3});function j3({excludedMatchUpStatuses:t=[],includeEventParticipants:e,includeQualifyingStage:i,finishingRoundLimit:n,policyDefinitions:r,roundNumberLimit:a,tournamentRecord:s,drawDefinition:o,matchUpsLimit:l,requirePlay:c,requireLoss:u,allEntries:d,winsLimit:p,event:h}){var k,O,$,F,V;if(!o)return{error:Gt};let f=[Ft,Rr];i&&f.push(ni);let m=h!=null&&h.eventType?{matchUpTypes:[h.eventType]}:void 0,g=o!=null&&o.matchUpType?{matchUpTypes:[o.matchUpType]}:void 0,v=e&&h?((k=Jh({contextFilters:{stages:f},matchUpFilters:m,tournamentRecord:s,inContext:!0,event:h}))==null?void 0:k.matchUps)??[]:((O=lo({contextFilters:{stages:f},matchUpFilters:g,tournamentRecord:s,inContext:!0,drawDefinition:o}))==null?void 0:O.matchUps)??[],y=XI({stage:$a,drawDefinition:o}).map(({participantId:j})=>j),b={},I={},T={},w={};r||(r=wm({policyTypes:[AV],tournamentRecord:s,drawDefinition:o,event:h}).policyDefinitions);let S=r==null?void 0:r[AV];t=t.length&&t||(S==null?void 0:S.excludedMatchUpStatuses)||[],e=e??(S==null?void 0:S.includeEventParticipants),d=d??(S==null?void 0:S.allEntries),n=n??(S==null?void 0:S.finishingRoundLimit),a=a??(S==null?void 0:S.roundNumberLimit),l=l??(S==null?void 0:S.matchUpsLimit),c===void 0&&(c=(S==null?void 0:S.requirePlay)!==void 0?S.requirePlay:!0),u===void 0&&(u=(S==null?void 0:S.requireLoss)!==void 0?S.requireLoss:!0),p=p??(S==null?void 0:S.winsLimit);for(let j of v){if(c&&j.winningSide&&![1,2].includes(j.winningSide)&&j.matchUpStatus!==Yr||j.finishingRound&&n&&j.finishingRound>=n||j.finishingRound&&a&&j.finishingRound<=a)continue;let B=($=j.sides)==null?void 0:$.find(({sideNumber:W})=>j.winningSide&&W===3-j.winningSide),z=(F=j.sides)==null?void 0:F.find(({sideNumber:W})=>j.winningSide&&W===j.winningSide);if((V=j.sides)==null||V.forEach(W=>{var K;let Z=(K=W==null?void 0:W.participant)==null?void 0:K.participantId;Z&&(T[Z]=W.participant,j.matchUpStatus===Yr&&!c&&(I[Z]=W.participant,b[Z]||(b[Z]=0),(!j.matchUpStatus||!t.includes(j.matchUpStatus))&&(b[Z]+=1)))}),B==null?void 0:B.participant){let W=B.participant.participantId;I[W]=B.participant,b[W]||(b[W]=0),j.matchUpStatus&&!t.includes(j.matchUpStatus)&&(b[W]+=1)}if(z!=null&&z.participant){let W=z.participant.participantId;w[W]||(w[W]=0),w[W]+=1,b[W]||(b[W]=0),j.matchUpStatus&&!t.includes(j.matchUpStatus)&&(b[W]+=1)}}let U=(s==null?void 0:s.participants)&&!c&&!u&&d,P=U?((e&&h?h.entries:o.entries)??[]).filter(j=>![Fh,eu].includes(j.entryStatus)).map(({participantId:j})=>j):[],E=Object.keys(I),R=U?((s==null?void 0:s.participants)??[]).filter(({participantId:j})=>P.includes(j)):u&&Object.values(I)||Object.values(T),C=j=>!u||E.includes(j),M=j=>!c||(b[j]||0)>=0,_=j=>!p||(w[j]||0)<=p,A=j=>!l||b[j]<=l,N=j=>!y.includes(j);return{eligibleParticipants:R.filter(j=>C(j.participantId)&&M(j.participantId)&&_(j.participantId)&&A(j.participantId)&&N(j.participantId)).map(j=>{var B;return{...j,individualParticipants:(B=j.individualParticipantIds)==null?void 0:B.map(z=>{var W;return(W=s==null?void 0:s.participants)==null?void 0:W.find(Z=>Z.participantId===z)})}}),losingParticipantIds:E,...de}}function dO(t){var f,m,g,v,y,b,I,T;let e=Qt(t,[{drawDefinition:!0}]);if(e.error)return e;let{drawDefinition:i,roundNumber:n}=t,r=t.structureId??(((f=i.structures)==null?void 0:f.length)===1&&((g=(m=i.structures)==null?void 0:m[0])==null?void 0:g.structureId));if(typeof r!="string")return{error:uc};let a=(v=i.structures)==null?void 0:v.find(w=>w.structureId===r);if(!a)return{error:gr};let s,o=(y=a.matchUps??[])==null?void 0:y.reduce((w,S)=>(S.roundPosition&&(s=!0),((S==null?void 0:S.roundNumber)||0)>w?S.roundNumber:w),0);if(a.structures||s||a.finishingPosition===YI)return{error:My};let l=((b=i==null?void 0:i.entries)==null?void 0:b.filter(w=>{let S=w.entryStatus;return id.includes(S)}))??[],c=Math.floor((l==null?void 0:l.length)/2)||1,u=n??o??1,d=((T=(I=a.matchUps)==null?void 0:I.filter(w=>w.roundNumber===u))==null?void 0:T.length)??0,p=c-d,h=p>0?p:0;return{...de,availableMatchUpsCount:h,lastRoundNumber:o,roundMatchUpsCount:c}}function G3({drawDefinition:t}){var i;let e=ki({name:"participantRepresentatives",element:t});return e.error?e:{representativeParticipantIds:((i=e.extension)==null?void 0:i.value)||[]}}function ixe({tournamentParticipants:t,drawDefinition:e,event:i}){if(!e)return{error:Gt};let n=ua({tournamentParticipants:t,inContext:!0,drawDefinition:e,event:i}),r=_t(n.matchUps,!1,!0),a=Ei(r.reduce((o,l)=>o.concat(...l.sides.map(c=>c.participantId).filter(Boolean)),[])),s=Object.assign({},...a.map(o=>{let l=r.filter(c=>c.sides.map(u=>u.participantId).filter(Boolean).includes(o));return{[o]:l}}));return{participantIds:a,participantIdMatchUps:s}}function H3({byeAdvancements:t=!1,tournamentRecord:e,drawDefinition:i}){if(!i)return{error:Gt};let{participantIds:n,participantIdMatchUps:r}=ixe({tournamentParticipants:e==null?void 0:e.participants,drawDefinition:i}),a=(n==null?void 0:n.map(s=>{let o=r[s].filter(d=>[Lr,mn].includes(d.matchUpStatus)||d.winningSide),l=o.map(d=>{let p=d.sides.find(f=>f.bye),h=d.sides.find(f=>f.participantId===s).sideNumber;return(d.winningSide||t&&p&&h)===h?d.finishingPositionRange.winner:d.finishingPositionRange.loser}),c=d=>Math.abs(d[0]-d[1]),u=l.reduce((d,p)=>d&&c(d)<c(p)?d:p,void 0);return{[s]:{relevantMatchUps:o,finishingPositionRanges:l,finishingPositionRange:u}}}))||[];return Object.assign({},...a)}function qg({tournamentRecords:t,tournamentRecord:e,tournamentId:i,drawId:n}){if(!e&&!t)return{error:ut};if(!n)return{error:Vd};if(!e&&t){if(typeof i!="string"&&(i=uce({tournamentRecords:t,drawId:n}),!i))return{error:CS};if(e=t[i],!e)return{error:ut}}let r=e&&jo({tournamentRecord:e,drawId:n});return r!=null&&r.drawDefinition?{drawDefinition:r.drawDefinition,event:r.event,tournamentRecord:e,...de}:he({result:{error:tc},stack:"findDrawDefinition"})}function z3(t){let{drawDefinition:e,error:i}=qg(t);return i?{error:i}:{drawDefinition:_t(e)}}function WV({targetRoundNumber:t,finishingPosition:e,drawDefinition:i,structureId:n,linkType:r}){let{links:a}=uU({drawDefinition:i,structureId:n})||{},s=((a==null?void 0:a.target)||[]).filter(({linkType:o})=>o===r).filter(({target:o})=>!t||t===o.roundNumber).map(o=>{let l=o.source.structureId,{structure:c}=hi({structureId:l,drawDefinition:i});if(!(e&&(c==null?void 0:c.finishingPosition)!==e))return o}).filter(Boolean);return{sourceStructureIds:s.map(({source:o})=>o.structureId),relevantLinks:s}}function nxe({tournamentParticipants:t,returnParticipants:e,drawPosition:i,participant:n,drawId:r,event:a}){var o;let s=((o=a==null?void 0:a.entries)==null?void 0:o.filter(({entryStatus:l})=>[eu,$y].includes(l)).map(({participantId:l})=>l))||[];if(s.length){let l=n.individualParticipantIds,c=e?t.filter(({participantId:d})=>s.includes(d)):void 0,u=e?t.filter(({participantId:d})=>l.includes(d)):void 0;return{validModifyAssignedPairAction:Kt({payload:{participantId:n.participantId,replacementIndividualParticipantId:void 0,existingIndividualParticipantId:void 0,drawPosition:i,drawId:r},method:mke,availableIndividualParticipantIds:s,availableIndividualParticipants:c,existingIndividualParticipantIds:l,existingIndividualParticipants:u,type:U3},!1,!1,!0)}}return{}}function ly(t){var g,v,y,b,I;let{inContextDrawMatchUps:e,targetData:i,drawDefinition:n,relevantLink:r}=t;if((r==null?void 0:r.linkCondition)===Pp&&((g=i==null?void 0:i.matchUp)==null?void 0:g.matchUpStatus)===mn)return!1;let{targetMatchUps:{loserMatchUp:a,winnerMatchUp:s},targetLinks:o}=i,l=a&&mo({matchUpId:a.matchUpId,inContextDrawMatchUps:e,drawDefinition:n}),c=(v=l==null?void 0:l.targetMatchUps)==null?void 0:v.loserMatchUp,u=(y=l==null?void 0:l.targetMatchUps)==null?void 0:y.loserMatchUpDrawPositionIndex,d=(b=c==null?void 0:c.sides[u])==null?void 0:b.participant,p=[Yi,cn].includes(a==null?void 0:a.matchUpStatus)&&!d,h=((I=s==null?void 0:s.drawPositions)==null?void 0:I.filter(Boolean).length)||0;if(a!=null&&a.winningSide&&!p||s!=null&&s.winningSide&&h===2&&(!s.feedRound||![cn,Yi].includes(s==null?void 0:s.matchUpStatus)))return!0;let f=s&&mo({matchUpId:s.matchUpId,inContextDrawMatchUps:e,drawDefinition:n}),m=l&&ly({relevantLink:o==null?void 0:o.loserTargetLink,targetData:l,inContextDrawMatchUps:e,drawDefinition:n});return!!(f&&ly({targetData:f,inContextDrawMatchUps:e,drawDefinition:n})||m)}var Tce={[Hf]:{policyName:"positionActionsDefault",enabledStructures:[{stages:[ni,Ft],stageSequences:[1],enabledActions:[],disabledActions:[]},{stages:[],stageSequences:[],enabledActions:[fE,fI,rO,Fb],disabledActions:[]}],disbledStructures:[],otherFlightEntries:!1,activePositionOverrides:[]}},zN="positionAction",YV="matchUpAction";function Uce({actionType:t=zN,appliedPolicies:e,drawDefinition:i,structure:n}){var d,p;let r=t===zN&&Hf||t===YV&&Ba,a=t===zN&&Tce||t===YV&&tle,s=r&&((e==null?void 0:e[r])||(a==null?void 0:a[r])),o=((p=(d=i.links)==null?void 0:d.filter(h=>{var f;return((f=h==null?void 0:h.target)==null?void 0:f.structureId)===(n==null?void 0:n.structureId)}))==null?void 0:p.map(({target:h})=>h.feedProfile))??[],{enabledStructures:l,disabledStructures:c}=s||{},u=c==null?void 0:c.find(h=>{let{stages:f,stageSequences:m,structureTypes:g,feedProfiles:v}=h;return(!(v!=null&&v.length)||Array.isArray(v)&&v.some(y=>o.includes(y)))&&(!(f!=null&&f.length)||Array.isArray(f)&&(f==null?void 0:f.includes(n==null?void 0:n.stage)))&&(!(g!=null&&g.length)||Array.isArray(g)&&(g==null?void 0:g.includes(n==null?void 0:n.structureType)))&&(!(m!=null&&m.length)||Array.isArray(m)&&m.includes(n==null?void 0:n.stageSequence))});return{enabledStructures:l,actionsDisabled:u,actionsPolicy:s}}function dZ({activePositionOverrides:t,activeDrawPositions:e,action:i}){return i&&t.includes(i)?!0:!e.length}function Dce({enabledStructures:t,drawDefinition:e,structure:i}){var o,l;if(t===!1)return{};if(!(t!=null&&t.length))return{policyActions:{enabledActions:[],disabledActions:[]}};let{stage:n,stageSequence:r,structureType:a}=i||{},s=((l=(o=e.links)==null?void 0:o.filter(c=>{var u;return((u=c==null?void 0:c.target)==null?void 0:u.structureId)===(i==null?void 0:i.structureId)}))==null?void 0:l.map(({target:c})=>c.feedProfile))||[];return{policyActions:t.find(c=>{let{stages:u,stageSequences:d,structureTypes:p,feedProfiles:h}=c||{},f=!(u!=null&&u.length)||Array.isArray(u)&&u.includes(n),m=!(d!=null&&d.length)||Array.isArray(d)&&d.includes(r),g=!(p!=null&&p.length)||Array.isArray(p)&&p.includes(a),v=!(h!=null&&h.length)||Array.isArray(h)&&h.some(y=>s.includes(y));return m&&g&&v&&c&&f})}}function Xo({action:t,policyActions:e}){var n;let i=!(e!=null&&e.enabledActions)||((n=e==null?void 0:e.disabledActions)==null?void 0:n.length)&&e.disabledActions.includes(t);return i?!1:((e==null?void 0:e.enabledActions.length)===0||(e==null?void 0:e.enabledActions.includes(t)))&&!i}var Ece="replaceTieMatchUpParticipantId",Pce="assignTieMatchUpParticipantId",KV="removeTieMatchUpParticipantId",pZ="assignMatchUpSideParticipant",rxe="removeMatchUpSideParticipant",Cce="substituteParticipant",ZV="REMOVE_SUBSTITUTION",Rce="REPLACE_PARTICIPANT",q3="REMOVE_PARTICIPANT",XV="setMatchUpStatus",JV="SUBSTITUTION",Mce="SCHEDULE",axe="PENALTY",QV="REFEREE",Nce="STATUS",ej="START",Ace="SCORE",tj="END",W3={REPLACE_TEAM_POSITION_METHOD:Ece,ASSIGN_TEAM_POSITION_METHOD:Pce,REMOVE_TEAM_POSITION_METHOD:KV,REPLACE_PARTICIPANT:Rce,SUBSTITUTION_METHOD:Cce,REMOVE_SUBSTITUTION:ZV,REMOVE_PARTICIPANT:q3,SCHEDULE_METHOD:XV,SUBSTITUTION:JV,SCHEDULE:Mce,PENALTY:axe,REFEREE:QV,STATUS:Nce,SCORE:Ace,START:ej,END:tj};function sxe({specifiedPolicyDefinitions:t,inContextDrawMatchUps:e,matchUpParticipantIds:i,matchUpActionsPolicy:n,inContextMatchUp:r,policyActions:a,enforceGender:s,participantId:o,sideNumber:l,matchUpId:c,matchUp:u,drawId:d,side:p}){var _,A,N,k,O,$,F,V,j,B,z,W,Z,K,Q;let h=[],f=(_=r.sides)==null?void 0:_.find(J=>J.participant),m=r.gender===Oo&&r.sideNumber&&((A=r.sides)==null?void 0:A.filter(J=>J.particiapntId).length)===1&&((k=(N=f==null?void 0:f.participant)==null?void 0:N.person)==null?void 0:k.sex),g=r.matchUpType,v=(s??((O=n==null?void 0:n.participants)==null?void 0:O.enforceGender))!==!1?r.gender:void 0,y=(F=($=r.sides)==null?void 0:$.flatMap(J=>{var se;return((se=J.participant)==null?void 0:se.individualParticipants)||J.participant}).filter(Boolean))==null?void 0:F.map(Vi),b=(V=r.sides)==null?void 0:V.filter(J=>!l||J.sideNumber===l).flatMap(J=>{var se;return((se=J.participant)==null?void 0:se.individualParticipants)||J.participant}).filter(Boolean),I=b==null?void 0:b.map(Vi),T=(B=(j=e==null?void 0:e.find(J=>J.matchUpId===r.matchUpTieId))==null?void 0:j.sides)==null?void 0:B.map(J=>{var se,ie;return(ie=(se=J==null?void 0:J.participant)==null?void 0:se.individualParticipants)==null?void 0:ie.filter(({participantId:ce,person:oe})=>!(I!=null&&I.includes(ce))&&(!v||v===Ad||oe.sex===v||v===Oo&&!m||m&&oe.sex!==m))}),w=l?T==null?void 0:T[l-1]:T==null?void 0:T.map((J,se)=>({participants:J,sideNumber:se+1})),S=l?(z=T==null?void 0:T[l-1])==null?void 0:z.map(Vi):T==null?void 0:T.map((J,se)=>({participants:J==null?void 0:J.map(Vi),sideNumber:se+1})),U=l&&(Fr(_b)(g)&&!(I!=null&&I.length)||Fr(Zv)(g)&&((I==null?void 0:I.length)??0)<2)||!l&&(Fr(_b)(g)&&((I==null?void 0:I.length)??0)<2||Fr(Zv)(g)&&((I==null?void 0:I.length)??0)<4),P=S==null?void 0:S.filter(J=>!(y!=null&&y.includes(J))),E=w==null?void 0:w.filter(({participantId:J})=>P.includes(J));if(U&&(P!=null&&P.length)&&h.push({availableParticipantIds:P,method:Pce,availableParticipants:E,type:hI,payload:{participantId:void 0,tieMatchUpId:c,sideNumber:l,drawId:d}}),I!=null&&I.length&&(!ga(u)||(W=p==null?void 0:p.substitutions)!=null&&W.length)&&h.push({method:KV,type:q3,existingParticipantIds:I,payload:{participantId:void 0,tieMatchUpId:c,drawId:d}}),E!=null&&E.length&&(!l&&(I!=null&&I.length)||l&&(p!=null&&p.participant))&&h.push({availableParticipantIds:P,method:Ece,availableParticipants:E,type:Rce,existingParticipantIds:I,payload:{existingParticipantId:void 0,participantId:void 0,tieMatchUpId:c,drawId:d}}),Xo({policyActions:a,action:ZV})&&((Z=p==null?void 0:p.substitutions)==null?void 0:Z.length)){let J=((K=p.participant)==null?void 0:K.participantType)===ji&&[p.participantId]||((Q=p.participant)==null?void 0:Q.participantType)===Ni&&p.participant.individualParticipantIds||[],se=p.substitutions.map(ie=>ie.participantId).filter(ie=>J.includes(ie));(!o||se.includes(o))&&h.push({method:KV,type:ZV,substitutedParticipantIds:se,payload:{participantId:void 0,tieMatchUpId:c,drawId:d}})}let R=t==null?void 0:t[Ba],C=R==null?void 0:R.substituteWithoutScore,M=R==null?void 0:R.substituteAfterCompleted;if(Xo({policyActions:a,action:JV})&&i.length===2&&(!l&&(I!=null&&I.length)||l&&(p!=null&&p.participant))&&(C||ga(u))&&(M||u.matchUpStatus&&!ca.includes(u.matchUpStatus))&&(b!=null&&b.length)&&w.length){let J=b.map(Vi);h.push({info:"list of team players available for substitution",method:Cce,availableParticipantIds:S,existingParticipantIds:J,availableParticipants:w,existingParticipants:b,type:JV,payload:{substituteParticipantId:void 0,existingParticipantId:void 0,sideNumber:l,matchUpId:c,drawId:d}})}return h}function oxe({tournamentParticipants:t=[],possiblyDisablingAction:e,activeDrawPositions:i,positionAssignments:n,returnParticipants:r,appliedPolicies:a,drawDefinition:s,drawPosition:o,validActions:l,structureId:c,structure:u,drawId:d,event:p}){var S,U,P,E,R;if(i.includes(o))return{};let h=(S=l.find(C=>C.type===hI))==null?void 0:S.availableParticipantIds,f=(U=a==null?void 0:a[Hf])==null?void 0:U.otherFlightEntries,m=(P=a==null?void 0:a[Hf])==null?void 0:P.restrictQualifyingAlternates,g=(s.entries??[]).filter(({entryStage:C})=>!m||(u.stage===ni?C===ni:C!==ni)).sort((C,M)=>(C.entryPosition??1/0)-(M.entryPosition??1/0)).map(({participantId:C})=>C).filter(Boolean),{allPositionedParticipantIds:v}=ooe({drawDefinition:s}),y=n.map(C=>C.participantId).filter(Boolean),b=g.filter(C=>u.stage&&[ni,Ft,Rr].includes(u.stage)?!(v!=null&&v.includes(C)):!y.includes(C)),I=((p==null?void 0:p.entries)??[]).filter(C=>C.entryStatus===_u&&_ce({restrictQualifyingAlternates:m,structure:u,entry:C})&&(u.stage&&[ni,Ft,Rr].includes(u.stage)?!(v!=null&&v.includes(C.participantId)):!y.includes(C.participantId))).sort((C,M)=>(C.entryPosition??1/0)-(M.entryPosition??1/0)).map(C=>C.participantId),T=Ei(b.concat(I));if(f){let C=(R=(E=p?_r({event:p}).flightProfile:void 0)==null?void 0:E.flights)==null?void 0:R.filter(M=>M.drawId!==d).map(M=>M.drawEntries.filter(_=>_.participantId&&![Fh,eu,$y].includes(_.entryStatus)&&!g.includes(_.participantId)).map(({participantId:_})=>_)).flat().filter(Boolean);C!=null&&C.length&&T.push(...C)}h!=null&&h.length&&(T=T.filter(C=>!h.includes(C)));let w=r?t==null?void 0:t.filter(C=>T.includes(C.participantId)):void 0;return w==null||w.forEach(C=>{let M=(s.entries??[]).find(_=>_.participantId===C.participantId);C.entryPosition=M==null?void 0:M.entryPosition}),w==null||w.sort((C,M)=>(C.entryPosition||1/0)-(M.entryPosition||1/0)),T.length?{validAlternatesAction:Kt({payload:{drawId:d,structureId:c,drawPosition:o},willDisableLinks:e,method:hke,availableAlternatesParticipantIds:T,type:D3,availableAlternates:w})}:{}}function _ce({restrictQualifyingAlternates:t,structure:e,entry:i}){let{stage:n}=e;if(!i.entryStage||i.entryStage===n||n===ni&&!t||i.entryStage===Ft&&n===bs)return!0}function lxe({eventEntries:t,structure:e}){let i=r=>r.entryStatus===_u&&_ce({structure:e,entry:r}),n=(r,a)=>(r.entryPosition||1/0)-(a.entryPosition||1/0);return t.filter(i).sort(n).map(Vi)}function cxe({restrictAdHocRoundParticipants:t,tournamentParticipants:e,matchUpParticipantIds:i,otherFlightEntries:n,drawDefinition:r,structureId:a,sideNumber:s,matchUpId:o,structure:l,matchUp:c,drawId:u,event:d}){var U,P,E,R,C,M,_;let p=[],h=(l==null?void 0:l.matchUps)??[],f=(P=(U=c.sides)==null?void 0:U.find(A=>A.sideNumber===s))==null?void 0:P.participantId,m=h.filter(({roundNumber:A})=>A===c.roundNumber),g=((E=r==null?void 0:r.entries)==null?void 0:E.filter(({entryStatus:A})=>A&&By.includes(A)).map(Vi))??[],v=m.map(A=>(A.sides??[]).flatMap(Vi)).flat().filter(Boolean),y=g.filter(A=>!i.includes(A)&&(!t||!v.includes(A))),b=e==null?void 0:e.filter(A=>y==null?void 0:y.includes(A.participantId)).map(A=>_t(A,void 0,!0));b==null||b.forEach(A=>{let N=(r.entries??[]).find(k=>k.participantId===A.participantId);A.entryPosition=N==null?void 0:N.entryPosition}),y.length&&p.push({payload:{drawId:u,matchUpId:o,structureId:a,sideNumber:s},method:pZ,type:hI,availableParticipantIds:y,participantsAvailable:b});let I=(d==null?void 0:d.entries)??[],T=lxe({eventEntries:I,structure:l}),w=Ei(g.concat(T));if(n){let A=(C=(R=d?_r({event:d}):void 0)==null?void 0:R.flights)==null?void 0:C.filter(N=>N.drawId!==u).flatMap(N=>N.drawEntries.filter(k=>k.participantId&&![Fh,eu,$y].includes(k.entryStatus)).map(({participantId:k})=>k)).filter(Boolean);A!=null&&A.length&&w.push(...A)}w=w.filter(A=>!i.includes(A)&&!y.includes(A)&&(!t||!v.includes(A)));let S=e==null?void 0:e.filter(A=>w.includes(A.participantId)).map(A=>_t(A,void 0,!0));if(S==null||S.forEach(A=>{let N=(r.entries??[]).find(k=>k.participantId===A.participantId);A.entryPosition=N==null?void 0:N.entryPosition}),S==null||S.sort((A,N)=>(A.entryPosition||1/0)-(N.entryPosition||1/0)),w.length&&p.push({payload:{drawId:u,matchUpId:o,structureId:a,sideNumber:s},availableParticipantIds:w,participantsAvailable:S,method:pZ,type:_u}),!ga(c)&&s&&f){p.push({payload:{drawId:u,matchUpId:o,structureId:a,sideNumber:s},method:rxe,type:q3});let A=B=>B.sides.map(Vi),N=({matchUpId:B})=>B!==c.matchUpId,k=B=>!ga(B),O=(_=(M=c.sides)==null?void 0:M.find(B=>B.sideNumber!==s))==null?void 0:_.participantId,$=h.filter(({roundNumber:B})=>B!==c.roundNumber).filter(N).map(A),F=[O,...$.filter(B=>B.includes(f)).flat()].filter(Boolean),V=B=>!F.flat().includes(B),j=m.filter(k).filter(N).map(A).flat().filter(V);if(j.length){let B=e==null?void 0:e.filter(z=>j.includes(z.participantId)).map(z=>_t(z,void 0,!0));p.push({payload:{participantIds:[f],roundNumber:c.roundNumber,structureId:a,sideNumber:s,matchUpId:o,drawId:u},swappableParticipantIds:j,method:gke,type:aO,swappableParticipants:B})}}return p}function pO(t){var J,se,ie,ce,oe,te,le,ne,me;if(!t)return{error:Re};let{drawDefinition:e,event:i}=t,{restrictAdHocRoundParticipants:n=!0,policyDefinitions:r,enforceGender:a,participantId:s,sideNumber:o,matchUpId:l}=t,c=t.tournamentRecord??(t.tournamentId&&nr(t.tournamentId)&&((J=t.tournamentRecords)==null?void 0:J[t.tournamentId]));if(!c)return{error:ut};if(!l||!nr(l))return{error:Ks};if(o&&![1,2].includes(o))return he({result:{error:Re},context:{sideNumber:o}});if(!e){let be=(Wa({tournamentRecord:c}).matchUps??[]).find(we=>we.matchUpId===l);i=((c==null?void 0:c.events)??[]).find(we=>we.eventId===(be==null?void 0:be.eventId));let Se=((i==null?void 0:i.drawDefinitions)??[]).find(we=>we.drawId===(be==null?void 0:be.drawId));Se&&(e=Se)}if(!e)return{error:Gt};let u=vr({withIndividualParticipants:!0,tournamentRecord:c}).participants,{drawId:d}=e,{matchUp:p,structure:h}=ar({drawDefinition:e,matchUpId:l,event:i});if(!p)return{error:_s};let f=hn({tournamentRecord:c,drawDefinition:e,structure:h,event:i}).appliedPolicies??{};Object.assign(f,r??{});let m=(se=f==null?void 0:f[Hf])==null?void 0:se.otherFlightEntries,g=(f==null?void 0:f[Ba])??hU[Ba],{enabledStructures:v}=Uce({actionType:YV,appliedPolicies:f,drawDefinition:e,structure:h}),{policyActions:y}=Dce({enabledStructures:v,drawDefinition:e,structure:h}),b=t.matchUpsMap??Ts({drawDefinition:e}),I=t.inContextDrawMatchUps??ua({tournamentParticipants:u,inContext:!0,drawDefinition:e,matchUpsMap:b,event:i}).matchUps,T=I==null?void 0:I.find(be=>be.matchUpId===l),w=o&&((ie=T==null?void 0:T.sides)==null?void 0:ie.find(be=>be.sideNumber===o)),S=((ce=T==null?void 0:T.sides)==null?void 0:ce.map(be=>{var Se;return be.participantId||((Se=be.participant)==null?void 0:Se.participantid)}).filter(Boolean))??[],{assignedPositions:U,allPositionsAssigned:P}=Ma({structure:h}),{structureId:E}=h??{},R=[];if(!E)return{validActions:R};let C=Vo({structure:h}),M=p.collectionId;if(C&&!M){let be=cxe({restrictAdHocRoundParticipants:n,tournamentParticipants:u,matchUpParticipantIds:S,otherFlightEntries:m,drawDefinition:e,structureId:E,sideNumber:o,matchUpId:l,structure:h,matchUp:p,drawId:d,event:i});R.push(...be)}let _=fg({drawDefinition:e,structure:h}),A=U==null?void 0:U.filter(be=>be.participantId).map(be=>be.drawPosition),N=U==null?void 0:U.filter(be=>be.bye).map(be=>be.drawPosition),k=p.matchUpStatus===mn||!M&&((oe=p.drawPositions)==null?void 0:oe.reduce((be,Se)=>(N==null?void 0:N.includes(Se))||be,!1));if(k)return{validActions:R,isByeMatchUp:k};Xo({policyActions:y,action:QV})&&R.push({type:QV,payload:{matchUpId:l}});let O=!sC({matchUpStatus:p.matchUpStatus}),$=(te=f==null?void 0:f.scoring)==null?void 0:te.structures,F=(h==null?void 0:h.stage)&&($==null?void 0:$.stage)&&($==null?void 0:$.stage[h.stage]),V=(h==null?void 0:h.stageSequence)&&(F==null?void 0:F.stageSequence)&&F.stageSequence[h.stageSequence],j=!((le=f==null?void 0:f.scoring)!=null&&le.requireAllPositionsAssigned||F!=null&&F.requireAllPositionsAssigned||V!=null&&V.requireAllPositionsAssigned)||P,B=p.sides&&p.sides.filter(be=>be==null?void 0:be.participantId).length===2,z=p.matchUpStatus&&[Yr,sa].includes(p.matchUpStatus),W=mo({inContextDrawMatchUps:I,drawDefinition:e,matchUpId:l}),Z=ly({inContextDrawMatchUps:I,drawDefinition:e,targetData:W}),K=(((ne=T==null?void 0:T.drawPositions)==null?void 0:ne.length)===2&&T.drawPositions.every(be=>A==null?void 0:A.includes(be))&&((me=T==null?void 0:T.sides)==null?void 0:me.length)===2&&T.sides.every(({participantId:be})=>be)||B)&&!(z&&Z),Q={method:$le,type:fI,payload:{drawId:d,matchUpId:l,penaltyCode:void 0,penaltyType:void 0,participantIds:[],notes:void 0}};if(O&&R.push({payload:{drawId:d,matchUpId:l,schedule:{}},method:XV,type:Mce}),Xo({policyActions:y,action:fI})&&(w!=null&&w.participant||!o&&(S!=null&&S.length))&&R.push(Q),O&&K&&R.push({type:Nce}),j&&K){let{matchUpId:be,matchUpFormat:Se}=p,we={drawId:d,matchUpId:be,matchUpFormat:Se,outcome:{scoreStringSide1:void 0,scoreStringSide2:void 0,sets:[]},winningSide:void 0};R.push({info:"set outcome and winningSide",method:XV,type:Ace,payload:we}),Xo({policyActions:y,action:ej})&&R.push({type:ej}),Xo({policyActions:y,action:tj})&&R.push({type:tj})}if(M&&T){let be=sxe({specifiedPolicyDefinitions:r,inContextDrawMatchUps:I,matchUpParticipantIds:S,matchUpActionsPolicy:g,inContextMatchUp:T,policyActions:y,enforceGender:a,participantId:s,sideNumber:o,matchUpId:l,matchUp:p,drawId:d,side:w});R.push(...be)}return{structureIsComplete:_,validActions:R,isDoubleExit:z,...de}}function uxe({tournamentParticipants:t=[],sourceStructuresComplete:e,possiblyDisablingAction:i,isWinRatioFedStructure:n,activeDrawPositions:r,positionAssignments:a,drawDefinition:s,drawPosition:o,structureId:l,structure:c,drawId:u,event:d}){var v,y,b,I,T,w,S;if(r.includes(o)||n&&!e)return{};let{sourceStructureIds:p,targetStructureIds:h}=((v=s.links)==null?void 0:v.reduce((U,P)=>{var C,M;let E=(C=P.source)==null?void 0:C.structureId,R=(M=P.target)==null?void 0:M.structureId;return U.sourceStructureIds.includes(E)||U.sourceStructureIds.push(E),U.targetStructureIds.includes(R)||U.targetStructureIds.push(R),U},{sourceStructureIds:[],targetStructureIds:[]}))||{},f=[],m=((y=s.links)==null?void 0:y.filter(U=>{var P;return((P=U.target)==null?void 0:P.structureId)===c.structureId}))??[];for(let U of m){let P=(b=U==null?void 0:U.source)==null?void 0:b.structureId,{structure:E}=hi({structureId:P,drawDefinition:s}),R=(E==null?void 0:E.finishingPosition)===YI&&((p==null?void 0:p.length)!==1||(h==null?void 0:h.length)!==1),C={};if(R){let{matchUps:A}=wn({drawDefinition:s,structure:c,event:d}),{initialRoundNumber:N}=pI({drawPosition:o,matchUps:A}),k=(w=(T=(I=s.links)==null?void 0:I.find(O=>{var $;return(($=O.target)==null?void 0:$.structureId)===(c==null?void 0:c.structureId)&&O.target.roundNumber===N}))==null?void 0:T.source)==null?void 0:w.roundNumber;C.roundNumbers=[k]}let{completedMatchUps:M}=Xx({structureId:P,inContext:!0,matchUpFilters:C,drawDefinition:s}),_=a.map(A=>A.participantId).filter(Boolean);(S=M==null?void 0:M.filter(({matchUpType:A,winningSide:N})=>N&&((d==null?void 0:d.eventType)!==na||A===na)).map(({winningSide:A,sides:N})=>A&&(N==null?void 0:N[1-(A-1)])).map(Vi).filter(A=>A&&!_.includes(A)))==null||S.forEach(A=>{f.includes(A)||f.push(A)})}let g=t==null?void 0:t.filter(U=>f==null?void 0:f.includes(U.participantId));return g==null||g.forEach(U=>{let P=(s.entries??[]).find(E=>E.participantId===U.participantId);U.entryPosition=P==null?void 0:P.entryPosition}),f!=null&&f.length?{validLuckyLosersAction:{type:P3,method:fke,availableLuckyLosers:g,availableLuckyLoserParticipantIds:f,willDisableLinks:i,payload:{drawId:u,structureId:l,drawPosition:o}}}:{}}function dxe({positionSourceStructureIds:t,unassignedParticipantIds:e,possiblyDisablingAction:i,provisionalPositioning:n,tournamentParticipants:r,isWinRatioFedStructure:a,positionAssignments:s,returnParticipants:o,appliedPolicies:l,drawDefinition:c,seedingProfile:u,isByePosition:d,drawPosition:p,structureId:h,event:f}){var T,w,S;let{drawId:m}=c,g=[],v,y,b=[],I=(w=(T=l==null?void 0:l[Su])==null?void 0:T.validSeedPositions)==null?void 0:w.ignore;if(I||({unplacedSeedParticipantIds:v,unplacedSeedAssignments:y,unfilledPositions:b}=fle({provisionalPositioning:n,returnAllProxies:!0,randomize:!0,drawDefinition:c,seedingProfile:u,structureId:h,event:f})),b!=null&&b.length||(b=s.filter(U=>!U.participantId&&!U.bye&&!U.qualifier).map(U=>U.drawPosition)),d||g.push({payload:{drawId:m,structureId:h,drawPosition:p,isPositionAction:!0},willDisableLinks:i,method:bke,type:QA}),a&&I){let U=s.map(M=>M.participantId).filter(Boolean),P={structureIds:t},{completedMatchUps:E}=dU({inContext:!0,matchUpFilters:P,drawDefinition:c}),R=Ei((S=(E??[]).filter(({matchUpType:M})=>(f==null?void 0:f.eventType)!==na||M===na))==null?void 0:S.map(({sides:M})=>M==null?void 0:M.map(Vi)).flat().filter(M=>M&&!U.includes(M))),C=o?r==null?void 0:r.filter(M=>R==null?void 0:R.includes(M.participantId)).map(M=>_t(M,void 0,!0)):void 0;return C==null||C.forEach(M=>{let _=(c.entries??[]).find(A=>A.participantId===M.participantId);M.entryPosition=_==null?void 0:_.entryPosition}),C!=null&&C.length&&g.push(Kt({payload:{drawId:m,structureId:h,drawPosition:p},willDisableLinks:i,method:nZ,type:hI,availableParticipantIds:R,participantsAvailable:C})),{validAssignmentActions:g}}if(b.includes(p)||d){let U;if(y!=null&&y.length){let E=y.filter(R=>v==null?void 0:v.includes(R.participantId));E.sort(pxe),U=E.map(R=>R.participantId)}else U=e;let P=o?r==null?void 0:r.filter(E=>U.includes(E.participantId)).map(E=>_t(E,void 0,!0)):void 0;P!=null&&P.length&&g.push(Kt({payload:{drawId:m,structureId:h,drawPosition:p},willDisableLinks:i,method:nZ,type:hI,availableParticipantIds:U,participantsAvailable:P}))}return{validAssignmentActions:g}}function pxe(t,e){return t.bye||HS(t.seedValue)<HS(e.seedValue)||t.seedValue&&!e.seedValue?-1:(t.seedNumber||0)-(e.seedNumber||0)}function hxe({drawPositionInitialRounds:t,tournamentParticipants:e,positionAssignments:i,returnParticipants:n,appliedPolicies:r,drawDefinition:a,drawPosition:s,structureId:o,drawId:l}){var T,w,S;let c=[],u=[],d=[],p=[],h=i.map(U=>U.participantId).filter(Boolean),f=r==null?void 0:r[Hf],m=!(f!=null&&f.disableRoundRestrictions)&&t[s],g=f==null?void 0:f.requireCompletedStructures,{sourceStructureIds:v,relevantLinks:y}=WV({targetRoundNumber:m,linkType:Gf,drawDefinition:a,structureId:o})||{};v!=null&&v.length&&p.push(...v);let{sourceStructureIds:b,relevantLinks:I}=WV({targetRoundNumber:m,linkType:jf,drawDefinition:a,structureId:o})||{};b!=null&&b.length&&p.push(...b);for(let U of y){let P=(T=a.structures)==null?void 0:T.find(R=>R.structureId===U.source.structureId);if((P==null?void 0:P.stage)!==ni)continue;let E=fg({structureId:U.source.structureId,drawDefinition:a});if(!g||E){let R=P.qualifyingRoundNumber,{matchUps:C}=wn({matchUpFilters:{roundNumbers:[R],hasWinningSide:!0},afterRecoveryTimes:!1,tournamentParticipants:e,inContext:!0,structure:P});for(let M of C){let _=M.sides.find(N=>(N==null?void 0:N.sideNumber)===M.winningSide),A=M.matchUpStatus===mn&&((w=M.sides)==null?void 0:w.find(({participantId:N})=>N));if(_||A){let{participantId:N,participant:k}=_||A||{};N&&!h.includes(N)&&(k&&n&&c.push(k),u.push(N))}}}}for(let U of I){let P=(S=a.structures)==null?void 0:S.find(R=>R.structureId===U.source.structureId);if((P==null?void 0:P.stage)!==ni)continue;let E=fg({structureId:U.source.structureId,drawDefinition:a});if(!g||E){let{positionAssignments:R}=jn({structure:P}),C=(R==null?void 0:R.map(M=>{var N;let _=M.participantId,A=(N=ki({element:M,name:cg}).extension)==null?void 0:N.value;return A?{participantId:_,groupOrder:A==null?void 0:A.groupOrder}:{}}).filter(({groupOrder:M,participantId:_})=>M===1&&!h.includes(_)).map(({participantId:M})=>M))??[];if(C&&u.push(...C),n){let M=e.filter(({participantId:_})=>C.includes(_));c.push(...M)}}}return u.length&&d.push(Kt({qualifyingParticipants:n?c:void 0,method:dke,type:rO,qualifyingParticipantIds:u,payload:{qualifyingParticipantId:void 0,drawPosition:s,structureId:o,drawId:l}})),{validAssignmentActions:d,sourceStructureIds:p}}function fxe({onlyAssignedPositions:t=!0,possiblyDisablingAction:e,tournamentParticipants:i,inactiveDrawPositions:n,activeDrawPositions:r,positionAssignments:a,returnParticipants:s,byeDrawPositions:o,drawDefinition:l,isByePosition:c,drawPosition:u,structureId:d,structure:p,drawId:h,event:f}){if(r.includes(u))return{};let m=E=>!t||E.participantId||E.qualifier||E.bye,g=n==null?void 0:n.filter(E=>E!==u&&!(c&&o.includes(E))),v=(a==null?void 0:a.filter(E=>m(E)&&(g==null?void 0:g.includes(E.drawPosition))))??[],y=v.map(({drawPosition:E})=>E),{matchUps:b}=wn({afterRecoveryTimes:!1,inContext:!0,drawDefinition:l,structure:p,event:f}),I=b.filter(({drawPositions:E})=>ho(E,y)),T=Object.assign({},...I.map(E=>{var R;return(R=E.sides)==null?void 0:R.filter(({sourceDrawPositionRange:C})=>C).map(({drawPosition:C,sourceDrawPositionRange:M})=>({[C]:M}))}).flat()),w=v.map(E=>E.participantId).filter(Boolean),S=(i??[]).filter(E=>w.includes(E.participantId)),U=Object.assign({},...S.map(E=>({[E.participantId]:E}))),P=v.map(E=>{let R=U==null?void 0:U[E.participantId],C=T[E.drawPosition];return Kt({...E,participant:s?_t(R,!1,!0):void 0,sourceDrawPositionRange:C})});return P.length?{validSwapAction:{payload:{drawId:h,structureId:d,drawPositions:[u]},willDisableLinks:e,method:Fle,type:aO,availableAssignments:P}}:{}}function Y3(t){var Q;let e=Qt(t,[{event:!0,drawDefinition:!0,structureId:!0}]);if(e.error)return e;let{policyDefinitions:i,returnParticipants:n=!0,provisionalPositioning:r,tournamentRecord:a,drawDefinition:s,drawPosition:o,event:l}=t,c=t.tournamentParticipants??(a&&vr({withIndividualParticipants:!0,tournamentRecord:a}).participants)??[],u=hi({structureId:t.structureId,drawDefinition:s});if(u.error)return u;let d=u.containingStructure||u.structure;if(!d)return{error:gr};let p=d.structureId;if(u=oC({drawDefinition:s,structureId:p}),o===void 0&&!u.isAdHoc)return{error:KT};if(u.isAdHoc)return pO(t);if(u.error)return u;let{drawPositionInitialRounds:h,inactiveDrawPositions:f,activeDrawPositions:m,byeDrawPositions:g}=u,v=hn({tournamentRecord:a,drawDefinition:s,structure:d,event:l}).appliedPolicies??{};Object.assign(v,i??{});let{actionsPolicy:y,enabledStructures:b,actionsDisabled:I}=Uce({actionType:zN,appliedPolicies:v,drawDefinition:s,structure:d}),T=(y==null?void 0:y.activePositionOverrides)||[],{sourceStructureIds:w}=WV({finishingPosition:ey,targetRoundNumber:1,linkType:jf,drawDefinition:s,structureId:p})||{},S;w!=null&&w.length&&(S=w.every(J=>fg({structureId:J,drawDefinition:s})));let U=w.length,P=w.length&&!S,{policyActions:E}=Dce({enabledStructures:b,drawDefinition:s,structure:d}),R=![ni,Ft].includes(d.stage)||d.stageSequence!==1,{drawId:C}=s,M=[],{assignedPositions:_,positionAssignments:A}=Ma({structure:d}),N=_==null?void 0:_.find(J=>J.drawPosition===o),k=!!N;if(!((Q=A==null?void 0:A.map(J=>J.drawPosition))!=null&&Q.includes(o)))return{error:YT};let{stage:O,stageSequence:$}=d,F=[O];O===bs&&F.push(Ft),O===Ft&&F.push(bs);let V=XI({entryStatuses:By,provisionalPositioning:r,drawDefinition:s,stageSequence:$,structureId:p,stages:F}),j=jy({drawDefinition:s,stages:F}).assignedParticipantIds??[],B=V.filter(J=>!j.includes(J.participantId)).map(J=>J.participantId),z=g.includes(o),W=m.includes(o);if(I)return{info:"Actions Disabled for structure",isActiveDrawPosition:W,isDrawPosition:!0,hasPositionAssigned:k,validActions:[],isByePosition:z};if(Xo({policyActions:E,action:hI})&&!W&&A&&!P&&(!N||z)){let{validAssignmentActions:J}=dxe({positionSourceStructureIds:w,unassignedParticipantIds:B,possiblyDisablingAction:R,isWinRatioFedStructure:U,tournamentParticipants:c,positionAssignments:A,returnParticipants:n,appliedPolicies:v,drawDefinition:s,isByePosition:z,drawPosition:o,structureId:p,event:l});J==null||J.forEach(se=>M.push(se))}if(Xo({policyActions:E,action:rO})&&!W){let{validAssignmentActions:J}=hxe({drawPositionInitialRounds:h,tournamentParticipants:c,positionAssignments:A,returnParticipants:n,appliedPolicies:v,drawDefinition:s,drawPosition:o,structureId:p,drawId:C});J==null||J.forEach(se=>M.push(se))}let{participantId:Z}=N||{},K=Z&&c.find(J=>J.participantId===Z);if(N){Xo({policyActions:E,action:qV})&&!W&&(M.push({type:qV,method:iZ,payload:{drawId:C,structureId:p,drawPosition:o},willDisableLinks:R}),z||M.push({type:E3,method:pke,payload:{drawId:C,structureId:p,drawPosition:o},willDisableLinks:R}),Xo({policyActions:E,action:QA})&&!z&&M.push({type:QA,method:iZ,payload:{drawId:C,structureId:p,drawPosition:o,replaceWithBye:!0},willDisableLinks:R}));let J=d.stage===ni||d.stage===Ft&&d.stageSequence===1;if(!z&&dZ({activePositionOverrides:T,activeDrawPositions:m,action:Fb})&&Xo({policyActions:E,action:Fb})&&ZA({drawDefinition:s,structureId:p,drawPosition:o})&&J){let{seedAssignments:se}=qc({returnAllProxies:!0,drawDefinition:s,structure:d}),{seedNumber:ie,seedValue:ce}=(se==null?void 0:se.find(oe=>oe.participantId===Z))??{};M.push({type:Fb,method:Ike,participant:K,seedNumber:ie,payload:{drawId:C,structureId:p,participantId:Z,seedValue:ce}})}if(!z&&dZ({activePositionOverrides:T,activeDrawPositions:m,action:cD})&&Xo({policyActions:E,action:cD})&&ZA({drawDefinition:s,structureId:p,drawPosition:o})&&J){let{seedAssignments:se}=qc({returnAllProxies:!0,drawDefinition:s,structure:d}),{seedNumber:ie}=(se==null?void 0:se.find(ce=>ce.participantId===Z))??{};M.push({method:yke,type:cD,participant:K,seedNumber:ie,payload:{participantId:Z,structureId:p,drawId:C}})}if(!z&&Z){if(Xo({policyActions:E,action:fI})){let se={type:fI,method:$le,participant:K,payload:{penaltyCode:void 0,penaltyType:void 0,participantIds:[],notes:void 0,drawId:C}};M.push(se)}if(Xo({policyActions:E,action:fE})){let se={type:fE,method:vke,participant:K,payload:{participantId:Z,otherName:void 0}};M.push(se)}}if(Xo({policyActions:E,action:aO})){let{validSwapAction:se}=fxe({possiblyDisablingAction:R,tournamentParticipants:c,inactiveDrawPositions:f,activeDrawPositions:m,positionAssignments:A,returnParticipants:n,byeDrawPositions:g,drawDefinition:s,isByePosition:z,drawPosition:o,structureId:p,structure:d,drawId:C});se&&M.push(se)}}if(Xo({policyActions:E,action:D3})&&!P){let{validAlternatesAction:J}=oxe({possiblyDisablingAction:R,tournamentParticipants:c,positionAssignments:A,activeDrawPositions:m,returnParticipants:n,appliedPolicies:v,drawDefinition:s,drawPosition:o,validActions:M,structureId:p,structure:d,drawId:C,event:l});J&&M.push(J)}if(Xo({policyActions:E,action:P3})&&!P&&!W&&A){let{validLuckyLosersAction:J}=uxe({sourceStructuresComplete:S,possiblyDisablingAction:R,isWinRatioFedStructure:U,tournamentParticipants:c,activeDrawPositions:m,positionAssignments:A,drawDefinition:s,drawPosition:o,structureId:p,structure:d,drawId:C});J&&M.push(J)}if((K==null?void 0:K.participantType)===Ni&&Xo({policyActions:E,action:U3})){let{validModifyAssignedPairAction:J}=nxe({tournamentParticipants:c,returnParticipants:n,drawPosition:o,participant:K,drawId:C,event:l});J&&M.push(J)}return{isActiveDrawPosition:W,isDrawPosition:!0,hasPositionAssigned:k,isByePosition:z,validActions:M,...de}}function DC({policyDefinitions:t,appliedPolicies:e,drawType:i}){var a,s;let n=(a=t==null?void 0:t[VA])==null?void 0:a.drawTypeCoercion,r=(s=e==null?void 0:e[VA])==null?void 0:s.drawTypeCoercion;return(typeof n=="boolean"?n:void 0)??(i&&(n==null?void 0:n[i]))??(typeof r=="boolean"?r:void 0)??(i&&(r==null?void 0:r[i]))??!0}function mE({tournamentRecord:t,drawDefinition:e,stage:i=Ft,structureId:n,structure:r}){var o;if(!t)return{error:ut};if(!r&&!e)return{error:Gt};if(!r&&!n&&((o=e==null?void 0:e.structures)==null?void 0:o.filter(l=>l.stage===i).length)===1&&(r=e.structures.find(l=>l.stage===i)),!r&&!n)return{error:uc};let{error:a,positionAssignments:s}=jn({drawDefinition:e,structureId:n,structure:r});return{positionAssignments:s??[],structureId:r==null?void 0:r.structureId,error:a}}function K3({structureId:t,drawDefinition:e}){if(!e)return{error:Gt};if(!nr(t))return{error:Re};let i=uU({drawDefinition:e,structureId:t});if(i.error)return i;let n=i.links.target.flatMap(a=>a.target.feedProfile).filter(Boolean),r=!Nr([Qv,Pu,Sx,Jv],n).length;return{...de,valid:r}}function kce({participantsCount:t,participantCount:e}){if(t=t??e,!t)return{error:Re};let i=WT(t);return i?{drawSize:i}:he({result:{error:Re},stack:"getEliminationDrawSize",context:{participantsCount:t}})}function EC(t){let{drawSizeProgression:e=!1,policyDefinitions:i,drawSize:n}=t||{},{requireParticipantCount:r=!0,tournamentRecord:a,drawDefinition:s,event:o}=t||{},l="getSeedsCount",c=(t==null?void 0:t.participantsCount)??(t==null?void 0:t.participantCount);if(!i){let f=wm({tournamentRecord:a,drawDefinition:s,event:o});if(f.error)return he({result:f,stack:l});i=f.policyDefinitions}let u=Ii(c);if(c&&!u)return he({result:{error:Re},context:{participantsCount:c},stack:l});if(r&&!u)return he({result:{error:rae},stack:l});if(isNaN(n))if(c)({drawSize:n}=kce({participantsCount:c}));else return he({result:{error:MP},stack:l});let d=r&&c||n;if(d&&d>n)return{error:Mz};let p=i==null?void 0:i[Su];if(!p)return{error:qre};let h=p.seedsCountThresholds;return h?(p.drawSizeProgression!==void 0&&(e=p.drawSizeProgression),{seedsCount:h.filter(f=>e?f.drawSize<=n:n===f.drawSize).reduce((f,m)=>c&&c>=m.minimumParticipantCount?m.seedsCount:f,0)}):{error:Mre}}function hO({consideredEntries:t,policyDefinitions:e,tournamentRecord:i,appliedPolicies:n,participantMap:r,enforceGender:a,participants:s,event:o}){var v;if((!s||!r)&&i&&({participants:s,participantMap:r}=vr({tournamentRecord:i})),!s)return{error:AP};if(!Array.isArray(s))return{error:Re};if(!o)return{error:Jn};let l=(e==null?void 0:e[Ba])??(n==null?void 0:n[Ba])??hU[Ba],c=(a??((v=l==null?void 0:l.participants)==null?void 0:v.enforceGender))!==!1,{eventType:u,gender:d}=o,p=u===Vf,h=u===Al&&En||p&&Ni||ji,f=Object.assign({},...(t??o.entries??[]).map(y=>({[y.participantId]:y.entryStatus}))),m=Object.keys(f),g=s.filter(y=>m.includes(y.participantId)).filter(y=>{let b=mxe({participant:y,participantType:h,eventType:u,entryStatusMap:f}),I=gxe({genderEnforced:c,participantMap:r,eventGender:d,participant:y,isDoubles:p,mismatch:b});return b||!I});if(g.length){let y=g.map(b=>b.participantId);return{error:$re,invalidParticipantIds:y}}return{...de,valid:!0}}function mxe({participant:t,participantType:e,eventType:i,entryStatusMap:n}){let r=n[t.participantId],a=i&&[Vf,Al].includes(i)&&t.participantType===ji&&(Dv(r)||r===Fh);return t.participantType!==e&&!a}function gxe(t){var d,p,h;let{participant:e,participantMap:i,eventGender:n,mismatch:r,isDoubles:a,genderEnforced:s}=t,o=!r&&a&&Ei(((d=e==null?void 0:e.individualParticipantIds)==null?void 0:d.map(f=>{var m,g,v;return(v=(g=(m=i==null?void 0:i[f])==null?void 0:m.participant)==null?void 0:g.person)==null?void 0:v.sex}).filter(Boolean))??[])||[],l=!n||!(o!=null&&o.length)||Ad===n||[Cn,Yn].includes(n)&&o[0]===n||Oo===n&&(o.length===1&&((p=e.individualParticipantIds)==null?void 0:p.length)===1||o.length===2),c=(h=e==null?void 0:e.person)==null?void 0:h.sex,u=!(e!=null&&e.person)||!n||[Ad,Oo].includes(n)||[Cn,Yn].includes(n)&&c===n;return!s||l&&u}function xce({qualifyingProfiles:t,appliedPolicies:e,idPrefix:i,isMock:n,uuids:r}){var m;let a="generateQualifyingSTructures",s=[],o=[],l=[],c=(g,v)=>g.stageSequence-v.stageSequence,u=(g,v)=>g.roundTarget-v.roundTarget,d=0,p=0,h,f=1;for(let g of t.sort(u)){let v=g.structureProfiles||[];f=g.roundTarget||f;let y=1,b=0,I,T,w;for(let S of(v||[]).sort(c)){let U=hz(S.drawSize||S.participantsCount),{qualifyingRoundNumber:P,structureOptions:E,matchUpFormat:R,structureName:C,structureId:M,drawType:_}=S,A=S.matchUpType,N=S.qualifyingPositions||vxe({drawSize:U,qualifyingRoundNumber:P}),k,O,$;if(!Ii(U))return he({result:{error:MP},stack:a});let F=t.length>1?`${f}-`:"",V=v.length>1||F?y:"",j=C||(F||V?`${gs(ni)} ${F}${V}`:gs(ni));if(_===zu){let{structures:B,groupCount:z,maxRoundNumber:W}=pC({structureName:S.structureName||j,structureId:M||(r==null?void 0:r.pop()),stage:ni,structureOptions:E,appliedPolicies:e,stageSequence:y,matchUpType:A,roundTarget:f,drawSize:U,idPrefix:i,isMock:n,uuids:r});b=z,k=W,O=B[0],h=[1]}else({drawSize:U,matchUps:$,roundLimit:k}=Mp({qualifyingRoundNumber:P,qualifyingPositions:N,matchUpType:A,drawSize:U,idPrefix:i,isMock:n,uuids:r})),O=Lc({structureName:S.structureName||j,structureId:M||(r==null?void 0:r.pop()),qualifyingRoundNumber:k,stage:ni,matchUpFormat:R,stageSequence:y,matchUpType:A,roundLimit:k,matchUps:$}),f&&dn({extension:{name:Hp,value:f},element:O}),b=((m=$==null?void 0:$.filter(B=>B.roundNumber===k))==null?void 0:m.length)||0;if(y>1){let{link:B}=gC({sourceStructureId:T,sourceRoundNumber:I,targetStructureId:O.structureId,finishingPositions:w===jf?[1]:void 0,linkType:w});l.push(B),d+=(U||0)-b}else d+=U||0;w=_===zu?jf:Gf,T=O.structureId,I=k,o.push(O),y+=1}p+=b,s.push({qualifiersCount:b,finalQualifyingRoundNumber:I,finalQualifyingStructureId:T,finishingPositions:h,roundTarget:f,linkType:w}),f+=1}return{qualifiersCount:p,qualifyingDrawPositionsCount:d,qualifyingDetails:s,structures:o,...de,links:l}}function vxe({drawSize:t,qualifyingRoundNumber:e}){let i=t,n=0;for(;n<e;)i=Math.floor(i/2),n+=1;return i}function Oce(t){let{drawTypeCoercion:e,enforceMinimumDrawSize:i}=t,n=ui(t.drawSize),r=e&&t.drawType!==nc&&(typeof e=="boolean"||e<=2)&&n===2&&mp||t.drawType||mp,a=Bse.includes(r);if(n&&a){if(e&&(typeof e=="boolean"&&n<4||n<=e))r=mp;else if(n<4&&i)return{...he({context:{enforceMinimumDrawSize:i,drawSize:n,drawType:r},result:{error:tx},stack:"getCoercedDrawType"}),drawType:r}}return{drawType:r}}function yxe(t){let{drawDefinition:e,structureOptions:i,requireSequential:n}=t,r={structureName:gs(Ft),...t,stage:Ft},{structures:a,groupCount:s,groupSize:o}=pC(r);if(s<1)return{error:Sae};let l=(i==null?void 0:i.playoffGroups)||[{finishingPositions:[1],structureName:gs(Rr)}],[c]=a,{structures:u,links:d}=Zle({sourceStructureId:c.structureId,requireSequential:n,drawDefinition:e,playoffGroups:l,groupCount:s,groupSize:o,...t});return u&&a.push(...u),{...de,structures:a,links:d}}function bxe({mainStructure:t,consolationStructure:e,deciderStructure:i}){let n=e.matchUps.reduce((c,u)=>(u.drawPositions||[]).filter(Boolean).length&&!c.includes(u.roundNumber)?c.concat(u.roundNumber):c,[]),r=t.matchUps.reduce((c,u)=>!c||u.roundNumber>c?u.roundNumber:c,void 0),a=e.matchUps.reduce((c,u)=>!c||u.roundNumber>c?u.roundNumber:c,void 0),s=n.map((c,u)=>{let d=n.indexOf(c)%2?Pu:Qv,p=1+u;return{linkType:xh,source:{roundNumber:p,structureId:t.structureId},target:{feedProfile:d,roundNumber:c,structureId:e.structureId}}}),o={linkType:Gf,source:{roundNumber:a,structureId:e.structureId},target:{feedProfile:Pu,roundNumber:r,structureId:t.structureId}},l=[{linkType:Gf,source:{roundNumber:r,structureId:t.structureId},target:{feedProfile:Pu,roundNumber:1,structureId:i.structureId}},{linkType:xh,source:{roundNumber:r,structureId:t.structureId},target:{feedProfile:Pu,roundNumber:1,structureId:i.structureId}}];return[...s,o,...l]}function Ixe({structureName:t,matchUpType:e,idPrefix:i,drawSize:n,isMock:r,uuids:a}){let s=[],{matchUps:o}=mg({linkFedFinishingRoundNumbers:[1],drawSize:n+1,matchUpType:e,idPrefix:i,isMock:r}),l=ng({structureName:t||gs(Ft),structureId:a==null?void 0:a.pop(),stageSequence:1,stage:Ft,matchUpType:e,matchUps:o});s.push(l);let c=n/2,{matchUps:u}=mg({finishingPositionOffset:c,idPrefix:i&&`${i}-c`,drawSize:n-1,isConsolation:!0,matchUpType:e,isMock:r,uuids:a}),d=ng({structureName:gs($se),matchUps:u,structureId:a==null?void 0:a.pop(),stage:bs,stageSequence:2,matchUpType:e});s.push(d);let{matchUps:p}=Mp({idPrefix:i&&`${i}-p1t2`,drawSize:2,matchUpType:e,isMock:r}),h=ng({structureName:gs(Fse),matchUps:p,structureId:a==null?void 0:a.pop(),stageSequence:3,stage:Rr,matchUpType:e});s.push(h);let f=bxe({mainStructure:l,consolationStructure:d,deciderStructure:h});return{structures:s,links:f,...de}}function wxe(t){let{qualifyingRoundNumber:e,finishingPositionOffset:i,qualifyingPositions:n,matchUpType:r,idPrefix:a,drawSize:s,isMock:o,uuids:l}=t;if(!Ii(s)||s<2)return{matchUps:[],roundsCount:0};if(Rd(s))return Mp(t);let c=Sxe(s),u=c.shift(),d=Rt(1,((u==null?void 0:u.participantsCount)||0)+1).map(g=>({drawPosition:g})),p=[],h=1;({matchUps:p}=e_({roundNumber:h,matchUpType:r,idPrefix:a,matchUps:p,isMock:o,nodes:d,uuids:l})),h++;let f=t.roundLimit||e;for(let g of c){let v=g.participantsCount/2,y=Rt(1,v+1);n&&v===n&&(f=h-1);let b=y.map(I=>{let T=C3({roundPosition:I,roundNumber:h,idPrefix:a,uuids:l});return{roundPosition:I,roundNumber:h,matchUpId:T}});p.push(...b),h++}let m=h-1;return p=aC({finishingPositionOffset:i,lucky:!0,roundsCount:m,roundLimit:f,matchUps:p}),f&&(p=p.filter(g=>g.roundNumber<=f)),{matchUps:p,roundsCount:m,roundLimit:f}}function Sxe(t){let e=ui(t),i=e%2?e+1:e,n=!!(Math.ceil(i/2)%2),r=[{participantsCount:i,preFeedRound:n}];for(;i>2;){let a=Math.ceil(i/2),s=a===1,o=!!(!s&&a%2);i=!s&&o?a+1:a;let l=!!(i!==2&&Math.ceil(i/2)%2);r.push({participantsCount:i,preFeedRound:l,feedRound:o})}return r}function Lce(t){var h,f;let{playoffAttributes:e,stageSequence:i=1,stage:n=Ft,matchUpType:r,drawSize:a,uuids:s}=t,o=()=>!t.isMock&&!t.idPrefix?void 0:`${t.drawDefinition.drawId}-s-0`,l=t.structureId||o()||(s==null?void 0:s.pop()),c=t.appliedPolicies??hn(t),u=((h=t.policyDefinitions)==null?void 0:h[BS])||(c==null?void 0:c[BS]);t.skipRounds=t.skipRounds||a<=4&&(u!=null&&u.feedFromMainFinal?0:1)||0;let d=t.structureName??((f=e==null?void 0:e["0"])==null?void 0:f.name)??gs(Ft),p=()=>{let{matchUps:m}=Mp(t);return{structures:[Lc({stageSequence:i,structureName:d,matchUpType:r,structureId:l,matchUps:m,stage:n})],links:[],...de}};return{generators:{[nc]:()=>({structures:[Lc({finishingPosition:ey,stageSequence:i,structureName:d,matchUps:[],matchUpType:r,structureId:l,stage:n})],links:[],...de}),[_y]:()=>{let{matchUps:m}=wxe(t);return{structures:[Lc({stageSequence:i,structureName:d,matchUpType:r,structureId:l,matchUps:m,stage:n})],links:[],...de}},[mp]:()=>p(),[FP]:()=>Ixe(t),[xS]:()=>hS({...t,roundOffsetLimit:3,playoffAttributes:e??iq}),[OS]:()=>hS({...t,roundOffsetLimit:2,playoffAttributes:e??nq}),[Rr]:()=>hS(t),[iU]:()=>{let{matchUps:m}=mg({drawSize:a,uuids:s,matchUpType:r});return{structures:[Lc({stageSequence:i,structureName:d,matchUpType:r,structureId:l,stage:Ft,matchUps:m})],links:[],...de}},[$P]:()=>Wle(t),[LS]:()=>Ib({...t,feedRounds:1,fmlc:!0}),[Lse]:()=>Ib({...t,feedRounds:1}),[Qz]:()=>Ib({...t,feedsFromFinal:1}),[eq]:()=>Ib({...t,feedsFromFinal:2}),[tq]:()=>Ib({...t,feedsFromFinal:3}),[BP]:()=>Ib(t),[Tx]:()=>Kle(t),[zu]:()=>pC(t),[Oh]:()=>yxe(t)}}}function Z3(t){var j,B,z,W,Z;let{enforceMinimumDrawSize:e=!0,overwriteExisting:i,appliedPolicies:n,staggeredEntry:r,drawDefinition:a,tieFormat:s,isMock:o,uuids:l}=t||{},c=ui(t.drawSize),u=t.drawTypeCoercion??DC({appliedPolicies:n,drawType:t.drawType}),d="generateDrawStructuresAndLinks",p=Oce({drawType:t.drawType,enforceMinimumDrawSize:e,drawTypeCoercion:u,drawSize:c});if(p.error)return p;let h=p.drawType,f=[],m=[],g=(t==null?void 0:t.matchUpType)??xn,v=(j=a==null?void 0:a.structures)==null?void 0:j.filter(({stage:K})=>K===ni);v&&f.push(...v);let y=v==null?void 0:v.map(({structureId:K})=>K),b=(B=a==null?void 0:a.structures)==null?void 0:B.find(({stage:K,stageSequence:Q})=>K===Ft&&Q===1),I=(z=a==null?void 0:a.links)==null?void 0:z.filter(K=>K.target.structureId===(b==null?void 0:b.structureId)&&(y==null?void 0:y.includes(K.source.structureId))),T=(K,Q)=>{var J;if(K.linkType===jf&&(Q!=null&&Q.structures)){let se=K.source.finishingPositions||[];return Q.structures.length*se.length}else if(K.linkType===Gf&&((J=Q==null?void 0:Q.matchUps)!=null&&J.length)){let se=K.source.roundNumber;return Q.matchUps.filter(({roundNumber:ie})=>ie===se).length}},w=v==null?void 0:v.map(K=>{var oe,te,le;let Q=I==null?void 0:I.find(ne=>ne.target.structureId===K.structureId),J=((te=(oe=jn({structure:K}))==null?void 0:oe.positionAssignments)==null?void 0:te.length)??0;if(!Q)return J;let se=Q==null?void 0:Q.source.structureId,ie=(le=a.structures)==null?void 0:le.find(ne=>ne.structureId===se),ce=T(Q,ie)||0;return J-ce}).filter(Boolean).reduce((K,Q)=>K+Q,0),S=I==null?void 0:I.map(K=>{let Q=K.source.structureId,J=v==null?void 0:v.find(se=>se.structureId===Q);return T(K,J)}).filter(Boolean).reduce((K,Q)=>K+Q,0),U=!!(b&&!((W=b==null?void 0:b.matchUps)!=null&&W.length));if(v!=null&&v.length&&!U)return{error:CV};let P=!(v!=null&&v.length)&&t.qualifyingProfiles,E=(P==null?void 0:P.length)&&xce({idPrefix:t.idPrefix,qualifyingProfiles:P,appliedPolicies:n,isMock:o,uuids:l});if(E!=null&&E.error)return E;let{qualifyingDrawPositionsCount:R,qualifyingDetails:C,qualifiersCount:M}=E||{qualifyingDrawPositionsCount:w,qualifiersCount:S};R&&(E!=null&&E.structures&&f.push(...E.structures),E!=null&&E.links&&m.push(...E.links)),Object.assign(t,Kt({drawSize:c,matchUpType:g,tieFormat:s}));let _=h!==nc&&(!c||c<2||!r&&![iU,_y].includes(h)&&([Oh,zu].includes(h)&&c<3||![zu,Oh].includes(h)&&!Rd(c)));if(_&&!R)return he({context:{drawSize:c,invalidDrawSize:_},result:{error:tx},stack:d});let{generators:A,error:N}=Lce(t);if(N)return{error:N};let k=A[h];if(!k)return{error:vz};let O=k==null?void 0:k();if(O.error)return O;let{structures:$,links:F}=O;if($!=null&&$.length){let K=$.find(({stage:Q,stageSequence:J})=>Q===Ft&&J===1);if(b&&K){if(U){let Q=K.structureId;if(K.structureId=b.structureId,F==null?void 0:F.length)for(let J of F)J.source.structureId===Q&&(J.source.structureId=b.structureId),J.target.structureId===Q&&(J.target.structureId=b.structureId)}else if(!i)return{error:CV}}f.push(...$)}f.sort(ZI),F!=null&&F.length&&m.push(...F);let V=O.structures.find(({stage:K,stageSequence:Q})=>K===Ft&&Q===1);for(let K of C||[]){let{finalQualifyingRoundNumber:Q,finalQualifyingStructureId:J,roundTarget:se,finishingPositions:ie,linkType:ce}=K,oe=V&&((Z=gC({targetStructureId:V.structureId,sourceStructureId:J,sourceRoundNumber:Q,finishingPositions:ie,targetEntryRound:se,linkType:ce}))==null?void 0:Z.link);if(oe!=null&&oe.error)return oe;oe&&m.push(oe)}return I&&m.push(...I),{...de,qualifyingResult:{qualifyingDrawPositionsCount:R,qualifiersCount:M},structures:f,links:m}}function X3(t){var b,I;let{modifyOriginal:e=!0,stageSequence:i=1,isMock:n}=t||{},r="generateDrawTypeAndModifyDrawDefinition";if(!t.drawDefinition)return he({result:{error:Gt},stack:r});let a=e?t.drawDefinition:_t(t.drawDefinition,!1,!0),{tieFormat:s,matchUpType:o}=t;if(s){let T=Bo({tieFormat:s});if(T.error)return T}s=cs(s??((b=qs({drawDefinition:a}))==null?void 0:b.tieFormat)),o=o??(a.matchUpType||xn),t.tieFormat=s,t.matchUpType=o;let l=KA({drawDefinition:a,stage:Ft});t.drawSize=t.drawSize??l,!l&&t.drawSize&&JA({drawSize:t.drawSize,drawDefinition:a,stageSequence:i,stage:Ft});let c=Ts({drawDefinition:a}).drawMatchUps.map(Pa),u=Z3(t);if(u.error)return he({result:u,stack:r});let{structures:d,links:p,qualifyingResult:h}=u;a.structures=d,a.links=p;let f=Math.max(t.qualifiersCount??0,(h==null?void 0:h.qualifiersCount)||0);if(h!=null&&h.qualifyingDrawPositionsCount&&!KA({stage:ni,drawDefinition:a})){let T=JA({drawSize:h.qualifyingDrawPositionsCount,stage:ni,drawDefinition:a});if(T.error)return T}if(f){let T=Ole({qualifiersCount:f,drawDefinition:a,stage:Ft});if(T.error)return T}let m=t.drawSize??l;Object.assign(t,Kt({drawSize:m,matchUpType:o,tieFormat:s}));let{matchUps:g,matchUpsMap:v}=ua({drawDefinition:a});s&&(g==null||g.forEach(T=>{if(!c.includes(T.matchUpId)){let{tieMatchUps:w}=yC({tieFormat:s,matchUp:T,isMock:n});Object.assign(T,{tieMatchUps:w,matchUpType:o})}}));let{inContextDrawMatchUps:y}=ay({drawDefinition:a,matchUpsMap:v});return Hn({tournamentId:(I=t.tournamentRecord)==null?void 0:I.tournamentId,drawDefinition:a}),{inContextDrawMatchUps:y,drawDefinition:a,matchUpsMap:v,...de,structures:d,matchUps:g,links:p}}function PC(t){let{removePriorValues:e,tournamentRecord:i,participantId:n,scaleItem:r}=t,a,s;if(!$ce({scaleItem:r}))return{error:aI};if(n&&Array.isArray(i.participants)&&(s=i.participants.find(o=>o.participantId===n),s)){if(s.participantType===Lo&&(r==null?void 0:r.eventType)!==Al)return{error:aI};let o=Bce({removePriorValues:e,participant:s,scaleItem:r});if(o.error)return o;a=!o.valueChanged;let{topics:l}=dc();l.includes(Is)&&Si({topic:Is,payload:{tournamentId:i.tournamentId,participants:[s]}})}return a&&{...de,info:Fz,existingValue:r==null?void 0:r.scaleValue}||s&&{...de,newValue:r==null?void 0:r.scaleValue}||{error:xr}}function Fce(t){var d;let{scaleItemsWithParticipantIds:e=[],removePriorValues:i,tournamentRecord:n,auditData:r,context:a}=t;if(!n)return{error:ut};if(!n.participants)return{error:AP};let s=0,o={},l=[];for(let p of e){let h=p==null?void 0:p.participantId;if(Array.isArray(p==null?void 0:p.scaleItems))for(let f of p.scaleItems)if($ce({scaleItem:f}))Array.isArray(o[h])||(o[h]=[]),o[h].push(f);else return{error:aI}}for(let p of n.participants){let{participantId:h}=p||{};if(Array.isArray(o[h]))for(let f of o[h]){if(p.participantType===Lo&&(f==null?void 0:f.eventType)!==Al)return he({context:{participantId:h,scaleItem:f,participantType:p.participantType},info:"Invalid participantType for eventType",result:{error:aI}});Bce({participant:p,scaleItem:f,removePriorValues:i}),l.push(p),s++}}let c=s?void 0:eU,{topics:u}=dc();if(u.includes(Is)&&s&&Si({topic:Is,payload:{tournamentId:n.tournamentId,participants:l}}),a){let{eventId:p,drawId:h,...f}=a,m=((d=f.scaleAttributes)==null?void 0:d.scaleType)&&[f.scaleAttributes.scaleType];if(Object.keys(f).length){let g={itemType:Cq,itemValue:f};if(m&&(g.itemSubTypes=m),h||p){let{drawDefinition:v,event:y}=jo({tournamentRecord:n,eventId:p,drawId:h});h&&T3({drawDefinition:v,timeItem:g}),p&&uw({event:y,timeItem:g})}else TC({tournamentRecord:n,timeItem:g})}}return r&&u.includes(Af)&&Si({topic:Af,payload:r}),Kt({...de,modificationsApplied:s,info:c})}function $ce({scaleItem:t}){let e=t&&Object.keys(t),i=["scaleType","eventType","scaleName"];return i.filter(n=>e==null?void 0:e.includes(n)).length===i.length}function Bce({removePriorValues:t,participant:e,scaleItem:i}){if(!e)return{error:GI};let n=i&&Object.keys(i),r=["scaleType","eventType","scaleName"];if(r.filter(c=>n.includes(c)&&i[c]).length!==r.length)return{error:aI};let a=new Date().toISOString();e.timeItems||(e.timeItems=[]);let{scaleItem:s}=Th({scaleAttributes:i,participant:e}),o=c=>[void 0,null,""].includes(c),l=!(o(s==null?void 0:s.scaleValue)&&o(i.scaleValue))&&JSON.stringify(s==null?void 0:s.scaleValue)!==JSON.stringify(i.scaleValue);if(l){let{scaleType:c,eventType:u,scaleName:d}=i,p=[ty,c,u,d].join("."),h=Kt({itemValue:i.scaleValue,itemDate:i.scaleDate,createdAt:a,itemType:p});i.scaleId&&(h.itemSubTypes=[i.scaleId]),t&&(e.timeItems=e.timeItems.filter(f=>f.itemType!==p)),e.timeItems.push(h)}return{...de,valueChanged:l,newValue:i.scaleValue}}function J3(t){let{tournamentRecord:e,modifiedScaleValues:i,removePriorValues:n}=t,r=Qt(t,[{[ba]:!0},{modifiedScaleValues:!0,[qo]:el}]);if(r.error)return r;for(let a in i){let s=PC({scaleItem:i[a],removePriorValues:n,tournamentRecord:e,participantId:a});if(s.error)return s}return{...de}}function qS(t){let{tournamentRecord:e,scaleAttributes:i,participantId:n}=t,r=t.tournamentRecords||e&&{[e.tournamentId]:e}||{};if(!n)return{error:la};let{participant:a,tournamentId:s}=jg({tournamentRecords:r,tournamentRecord:e,participantId:n});return a?{...Th({participant:a,scaleAttributes:i}),tournamentId:s}:{error:xr}}var Txe=(t=0)=>250/Math.pow(t+5,.4),Uxe=()=>1;function Dxe(t=3,e=2){let i=t/e;return isNaN(i)?L0.kDefault():i}var L0={nSpread:400,diffThreshold:.125,kCalc:Txe,kMultiplier:Dxe,kDefault:Uxe};function Vce(t){let{winnerRating:e,loserRating:i}=t,{ratings:n=Da,winnerCountables:r=1,loserCountables:a=0,ratingType:s=Du,maxCountables:o,countables:l}=t||{},c=n==null?void 0:n[s];if(!c)return{error:ai};let u=c.range||t.ratingRange;e=e||c.defaultInitialization,i=i||c.defaultInitialization;let d=u[0]>u[1],p=c.decimalsCount||0,h=d?u.slice().reverse():u,f=(N,k)=>parseFloat(k)>=Math.min(...N)&&parseFloat(k)<=Math.max(...N);(!f(u,e)||!f(u,i))&&(f(u,e)||(e=c.defaultInitialization),f(u,i)||(i=c.defaultInitialization));let m=Q0({targetRange:Da[Du].range,sourceRange:h,value:d?u[0]-e:e}),g=Q0({targetRange:Da[Du].range,sourceRange:h,value:d?u[0]-i:i}),v=(N,k)=>1/(1+Math.pow(10,(k-N)/L0.nSpread)),y=v(m,g),b=v(g,m),I=L0.kCalc(r),T=L0.kCalc(a),w=L0.kMultiplier(o,l),S=m+w*I*(1-y),U=g+w*T*(0-b),P=Q0({sourceRange:Da[Du].range,value:S,targetRange:h}),E=Q0({sourceRange:Da[Du].range,value:U,targetRange:h}),R=d?u[0]-P:P,C=parseFloat(R.toFixed(p)),M=d?u[0]-E:E,_=parseFloat(M.toFixed(p)),A=Math.max(...u)?Math.abs(e-i)/Math.max(...u):0;return(P>E&&A>L0.diffThreshold||C<0||_<0)&&(C=e,_=i),{newWinnerRating:C,newLoserRating:_}}var Exe=t=>(t==null?void 0:t.reduce((e,i)=>(i.winningSide&&(e[i.winningSide-1]+=1),e),[0,0]))||[0,0];function jce(t){var y,b;let e=Qt(t,[{[ba]:!0},{matchUpIds:!0,[qo]:Rs,[Au]:BI},{ratingType:!1,[ds]:I=>Da[I]}]);if(e.error)return e;let{updateParticipantRatings:i,removePriorValues:n=!0,tournamentRecord:r,ratingType:a=Du,refreshDynamic:s,considerGames:o,drawDefinition:l,matchUpIds:c,asDynamic:u}=t,d=Da[a],{accessor:p}=d,h={},f=(t.matchUps||s&&lo({drawDefinition:l,tournamentRecord:r,inContext:!0,matchUpFilters:{matchUpStatuses:ca}}).matchUps||Wa({matchUpFilters:{matchUpIds:c,matchUpStatuses:ca},tournamentRecord:r,inContext:!0}).matchUps)??[],m=`${a}.${pq}`,g=u?m:a;f.sort(rw);for(let I of f){let{endDate:T,matchUpFormat:w,score:S,sides:U,winningSide:P}=I,E=I.matchUpType,R={eventType:E,scaleName:a,scaleType:tg},C={scaleName:m,eventType:E,scaleType:tg},M=Object.assign({},...(U??[]).map(j=>{let{sideNumber:B,participant:z}=j;return B&&{[B]:[z==null?void 0:z.participantId,...(z==null?void 0:z.individualParticipantIds)??[]].filter(Boolean).flat()}})),_=Object.assign({},...Object.values(M).flat().map(j=>{let B=h[j],z=!s||B?qS({scaleAttributes:C,tournamentRecord:r,participantId:j}).scaleItem:void 0,W=qS({tournamentRecord:r,scaleAttributes:R,participantId:j}).scaleItem,Z=p?{[p]:void 0}:void 0;return j&&{[j]:z??W??{scaleName:g,eventType:E,scaleDate:T,scaleType:tg,scaleValue:Z}}})),A=w?wo(w):{},N=(A==null?void 0:A.bestOf)||1,k=(A==null?void 0:A.setsTo)||1,O=o?N&k:N,$=(S==null?void 0:S.sets)&&Exe(S.sets)||P===1&&[1,0]||[0,1],F=P?M[P]:[],V=P?M[3-P]:[];for(let j of F){let B=(y=_[j])==null?void 0:y.scaleValue,z=typeof B=="object"?B[p]:B;for(let W of V){let Z=(b=_[W])==null?void 0:b.scaleValue,K=typeof Z=="object"?Z[p]:Z,Q=P?$[P]:[0,0],J=P?$[3-P]:[0,0],{newWinnerRating:se,newLoserRating:ie}=Vce({winnerCountables:Q,loserCountables:J,maxCountables:O,winnerRating:z,loserRating:K,ratingType:a}),ce=p?{...B,[p]:se}:se,oe=p?{...Z,[p]:ie}:ie;_[j].scaleValue=ce,_[W].scaleValue=oe,_[j].scaleName=g,_[W].scaleName=g}}Object.assign(h,_),i&&J3({tournamentRecord:r,modifiedScaleValues:h,removePriorValues:n})}let v=f.map(({matchUpId:I})=>I);return{...de,modifiedScaleValues:h,outputScaleName:g,processedMatchUpIds:v}}function fO(t){var g;let{matchUpIds:e=[],drawDefinition:i,roundNumber:n,newRound:r,isMock:a,event:s}=t;if(typeof i!="object")return{error:Gt};let{participantIdPairings:o,matchUpsCount:l}=t,c=dO(t);if(c.error)return he({result:c});let{lastRoundNumber:u,availableMatchUpsCount:d=0,roundMatchUpsCount:p=0}=c;if(!l)r?l=p:d>0&&(l=d);else if(l>p&&t.restrictMatchUpsCount!==!1)return he({result:{error:Re,info:"matchUpsCount error",context:{roundMatchUpsCount:p}}});if(o&&!Array.isArray(o)||l&&!Ii(l)||e&&!Array.isArray(e)||!o&&!l)return{error:Re,info:"matchUpsCount or pairings error"};if(l&&t.restrictMatchUpsCount!==!1&&l>32)return{error:Re,info:"matchUpsCount must be less than 33"};if(n&&!t.ignoreLastRoundNumber&&n-1>(u||0))return{error:Re,info:"roundNumber error"};let h=n??(r&&(u??0)+1||u||1);o=o??Rt(0,l).map(()=>({participantIds:[void 0,void 0]}));let f=v=>{if(!t.idPrefix)return;let y=i.drawId,b=t.idPrefix??"ah";return`${y}-${b}-${h}-${v}`},m=o==null?void 0:o.map((v,y)=>{let b=(v==null?void 0:v.participantIds)??[void 0,void 0];b.push(void 0,void 0);let I=b.slice(0,2).map((w,S)=>Kt({sideNumber:S+1,participantId:w})),T=e[y]??f(y)??yn();return{roundNumber:h,matchUpStatus:Vr,matchUpId:T,sides:I}});if(m!=null&&m.length){let v=(g=qs({drawDefinition:i,event:s}))==null?void 0:g.tieFormat;v&&m.forEach(y=>{let{tieMatchUps:b}=yC({tieFormat:v,matchUp:y,isMock:a});Object.assign(y,{tieMatchUps:b,matchUpType:Zn})})}return{roundNumber:h,matchUpsCount:(m==null?void 0:m.length)??0,matchUps:m,...de}}function Pxe({maxIterations:t=4e3,valueSortedPairings:e,pairingValues:i,valueObjects:n,deltaObjects:r}){let a=Object.assign({},...e.map(y=>({[y.pairing]:y.value}))),s=Object.keys(i),o=[],l=hZ({actorsCount:s.length,valueSortedPairings:e,pairingValueMap:a,deltaObjects:r,valueObjects:n}),c=[b$(l)];o.push(l);let u=l.value,d=l,p=1,h=0,f=s.length,m;do f-=1,m=s.length*i[s[0]].length;while(m>t&&f>5);let g=[];s.forEach(y=>{i[y].slice(0,f).forEach(b=>{h+=1;let I=$b(y,b.opponent);if(!g.includes(I)){let T=hZ({stipulated:[[y,b.opponent]],actorsCount:s.length,valueSortedPairings:e,pairingValueMap:a,deltaObjects:r,valueObjects:n});if(!c.includes(b$(T))){c.push(b$(T)),o.push(T);let{maxDelta:w,value:S}=T;w<d.maxDelta&&(d=T),(S<u||S===u&&Math.round(Math.random()))&&(u=S),g.push(I),p+=1}}}),o=o.filter(b=>Math.abs(b.value-u)<5)}),o.sort((y,b)=>y.maxDiff-b.maxDiff);let v=Tl(o);return{candidatesCount:p,deltaCandidate:d,maxIterations:t,iterations:h,candidate:v}}function b$(t){return t.participantIdPairings.map(({participantIds:e})=>e.sort().join("|")).sort().join("/")}function hZ({valueSortedPairings:t,stipulated:e=[],pairingValueMap:i,deltaObjects:n,valueObjects:r,actorsCount:a}){let s=[].concat(...e),o=[],l=0;e.filter(Boolean).forEach(d=>{let[p,h]=d,f=$b(p,h),m=i[f];o.push({participantIds:d,value:m}),l+=i[f]}),Ra(t,a).map(d=>so(d).map(p=>({...p,value:p.value+Math.random()*Math.round(Math.random())}))).flat().forEach(d=>{let p=d.pairing.split("|");if(!p.reduce((h,f)=>s.includes(f)||h,!1)){s.push(...p);let h=d.value;l+=h,o.push({participantIds:p,value:h})}}),o.sort((d,p)=>d.value-p.value);let c=o.reduce((d,p)=>{let[h,f]=p.participantIds,m=$b(h,f),g=n[m];return g>d?g:d},0),u=o.reduce((d,p)=>{let[h,f]=p.participantIds,m=$b(h,f),g=r[m];return g>d?g:d},0);return{value:l,participantIdPairings:o,maxDelta:c,maxDiff:u}}function $b(t,e){return[t,e].sort(Jx).join("|")}function Gce({participantIds:t}){let e={},i=[];t.forEach(r=>{e[r]=t.filter(a=>a!==r),e[r].forEach(a=>{let s=$b(a,r);i.includes(s)||i.push(s)})});let n=Object.assign({},...i.map(r=>({[r]:0})));return{uniquePairings:i,possiblePairings:e,deltaObjects:n}}function Cxe({matchUps:t}){let e=[];for(let i of t){let n=i.sides.map(Vi);if(n.length===2){let[r,a]=n,s=$b(r,a);e.includes(s)||e.push(s)}}return{encounters:e}}function Rxe({possiblePairings:t,valueObjects:e}){let i={};for(let r of Object.keys(t)){let a=t[r].map(s=>n(r,s));i[r]=a.sort((s,o)=>s.value-o.value)}function n(r,a){let s=$b(r,a);return{opponent:a,value:e[s]}}return{pairingValues:i}}var Mxe=0;function Nxe({tournamentParticipants:t,adHocRatings:e,eventType:i,scaleName:n,pairing:r}){var s;let a=((s=Da[n])==null?void 0:s.defaultInitialization)??Mxe;return r.split("|").map(o=>{var l;if(i===Hc){let c=(l=t==null?void 0:t.find(u=>u.participantId===o))==null?void 0:l.individualParticipantIds;return c?c==null?void 0:c.map(u=>e[u]||a):a*2}else return e[o]||a})}function Axe(t){let{tournamentParticipants:e,adHocRatings:i={},possiblePairings:n,uniquePairings:r,maxIterations:a,minimizeDelta:s,deltaObjects:o,valueObjects:l,eventType:c,scaleName:u,salted:d}=t;r.forEach(b=>{let I=Nxe({tournamentParticipants:e,adHocRatings:i,scaleName:u,eventType:c,pairing:b}),T=typeof d=="number"&&d||.5,w=d&&(Math.round(Math.random())?T:T*-1)||0,S=Math.abs(I[0]-I[1])+w,U=Math.abs(I[0]-I[1]);o[b]=U,l[b]||(l[b]=0),l[b]+=S?Math.pow(S,2):0});let p=r.map(b=>({pairing:b,value:l[b]})).sort((b,I)=>b.value-I.value),{pairingValues:h}=Rxe({possiblePairings:n,valueObjects:l}),{candidate:f,candidatesCount:m,deltaCandidate:g,iterations:v}=Pxe({valueSortedPairings:p,maxIterations:a,pairingValues:h,deltaObjects:o,valueObjects:l}),{participantIdPairings:y}=s?g:f;return{participantIdPairings:y,candidatesCount:m,deltaCandidate:g,iterations:v,candidate:f}}var _xe=100,kxe=100,xxe=4e3;function Q3(t){var Z,K;let{encounterValue:e=_xe,sameTeamValue:i=kxe,maxIterations:n=xxe,updateParticipantRatings:r,generateMatchUps:a=!0,ignoreLastRoundNumber:s,iterationMatchUps:o,tournamentRecord:l,dynamicRatings:c,refreshDynamic:u,participantIds:d,drawDefinition:p,roundNumber:h,structureId:f,matchUpIds:m,eventType:g,scaleName:v,idPrefix:y,isMock:b,salted:I,event:T}=t;if(!p)return{error:Gt};if(!t.structure&&!f)return{error:gr};let w=t.structure||hi({drawDefinition:p,structureId:f}).structure;if(!Xi(w))return{error:Ny};if(!(d!=null&&d.length))return{error:xg};let S=[...o??[],...(w==null?void 0:w.matchUps)??[]],{encounters:U}=Cxe({matchUps:S}),P=(l==null?void 0:l.participants)??[],E={};if(c){let Q=Ei(w!=null&&w.matchUps?w.matchUps.map(({roundNumber:se})=>se):[]),J=Math.max(...Q,0);if(J){let se=(Z=w==null?void 0:w.matchUps)==null?void 0:Z.filter(({roundNumber:ce})=>ce===J).map(({matchUpId:ce})=>ce),ie=jce({ratingType:v??((K=T==null?void 0:T.category)==null?void 0:K.ratingType),updateParticipantRatings:r,tournamentRecord:l,asDynamic:!0,refreshDynamic:u,drawDefinition:p,matchUpIds:se});if(ie.error)return ie;ie.modifiedScaleValues&&(E=ie.modifiedScaleValues)}}let{valueObjects:R}=Oxe({tournamentParticipants:P,encounterValue:e,sameTeamValue:i,encounters:U}),{uniquePairings:C,possiblePairings:M,deltaObjects:_}=Gce({participantIds:d}),A=Object.values(E).length?E:t.adHocRatings,N={tournamentParticipants:P,possiblePairings:M,participantIds:d,uniquePairings:C,drawDefinition:p,maxIterations:n,adHocRatings:A,deltaObjects:_,valueObjects:R,eventType:g,scaleName:v,structure:w,salted:I},{candidatesCount:k,participantIdPairings:O,deltaCandidate:$,iterations:F,candidate:V}=Axe(N);if(!k)return{error:cx};let j,B;if(a){let Q=fO({structureId:w==null?void 0:w.structureId,ignoreLastRoundNumber:s,participantIdPairings:O,newRound:!0,drawDefinition:p,roundNumber:h,matchUpIds:m,idPrefix:y,isMock:b,event:T});if(Q.error)return Q;j=Q.roundNumber,B=Q.matchUps}let{maxDelta:z,maxDiff:W}=V;return{roundNumber:j,participantIdPairings:O,modifiedScaleValues:E,candidatesCount:k,deltaCandidate:$,...de,iterations:F,matchUps:B,maxDelta:z,maxDiff:W}}function Oxe({encounters:t,tournamentParticipants:e,encounterValue:i,sameTeamValue:n}){let r={};for(let s of t)r[s]||(r[s]=0),r[s]+=i;let a=e==null?void 0:e.filter(({participantType:s})=>s===En);if(a)for(let s of a){let o=s.individualParticipantIds??[],{uniquePairings:l}=Gce({participantIds:o});for(let c of l)r[c]||(r[c]=0),r[c]+=n}return{valueObjects:r}}function Hce(t){var R,C,M,_;let{drawType:e=mp,attachConsolation:i=!0,applyPositioning:n=!0,tournamentRecord:r,staggeredEntry:a,automated:s,placeByes:o,isMock:l,event:c}=t,u=t==null?void 0:t.drawDefinition;if(!u)return{error:Gt};let d=$a,p=XI({stageSequence:1,drawDefinition:u,stage:d}),h=[zu,FP,Oh].includes(e)?p.length:WT(p.length);if(!a&&e===iU&&p.length<2||e===zu&&p.length<3)return{error:tx};let{tieFormat:f,matchUpType:m}=t;if(f){let A=Bo({tieFormat:f});if(A.error)return A}f=cs(f??((R=qs({drawDefinition:u}))==null?void 0:R.tieFormat)),m=m??u.matchUpType;let{structures:g}=Wu({stageSequence:1,drawDefinition:u,stage:d});if(g.length>1)return{error:Vre};if((M=(C=g==null?void 0:g[0])==null?void 0:C.matchUps)!=null&&M.length)return{error:Bz};let v=(_=g==null?void 0:g[0])==null?void 0:_.structureId;Object.assign(t,Kt({structureName:t.structureName??gs($a),structureId:v,matchUpType:m,tieFormat:f,drawSize:h,stage:d}));let y=Lce(t);if(y.error)return y;let b=y.generators[e];if(!b)return{error:vz};let I=b==null?void 0:b();if(I.error)return I;let{structures:T,links:w}=I,S=T.map(A=>wn({structure:A}).matchUps).flat();f&&S.forEach(A=>{let{tieMatchUps:N}=yC({matchUp:A,tieFormat:f,isMock:l});Object.assign(A,{tieMatchUps:N,matchUpType:m})}),(!n||!i)&&(u=_t(u,!1,!0)),u.links||(u.links=[]),w.length&&u.links.push(...w);let U=T.map(({structureId:A})=>A);u.structures||(u.structures=[]);let P=u.structures.map(({structureId:A})=>A);u.structures=u.structures.map(A=>U.includes(A.structureId)?T.find(({structureId:N})=>N===A.structureId):A);let E=T.filter(({structureId:A})=>!P.includes(A));return E.length&&u.structures.push(...E),s&&mC({seedingProfile:t.seedingProfile,applyPositioning:n,tournamentRecord:r,drawDefinition:u,structureId:v,placeByes:o,drawSize:h,event:c}),i&&Hn({drawDefinition:u}),{links:w,structures:T,...de}}var Hv={};Li(Hv,{addGame:()=>Jce,addPoint:()=>Xce,addSet:()=>eue,addShot:()=>Qce,analyzeScore:()=>sW,analyzeSet:()=>vE,calculateHistoryScore:()=>Yce,checkScoreHasValue:()=>ga,checkSetIsComplete:()=>vO,clearHistory:()=>Zce,generate:()=>zce,generateScoreString:()=>Uh,generateTieMatchUpScore:()=>wC,getSetComplement:()=>lW,getTiebreakComplement:()=>wO,helpers:()=>rue,isValidMatchUpFormat:()=>Nl,keyValueScore:()=>Rue,mutate:()=>Wce,parseMatchUpFormat:()=>wo,parseScoreString:()=>r_,query:()=>kue,redo:()=>tue,reverseScore:()=>qce,setServingSide:()=>Kce,stringifyMatchUpFormat:()=>yx,tidyScore:()=>_ue,umo:()=>nue,undo:()=>iue,validateScore:()=>oW,validateTieFormat:()=>Bo});var zce={};Li(zce,{generateScoreString:()=>Uh,generateTieMatchUpScore:()=>wC,reverseScore:()=>qce});function Uh(t){let{winnerFirst:e=!0,setTBlast:i=!0,addOutcomeString:n,reversed:r=!1,matchUpStatus:a,matchUpFormat:s,autoComplete:o,winningSide:l,sets:c}=t;if(!c)return{error:ai,info:"missing sets"};let u=s&&wo(s),{bestOf:d,finalSetFormat:p,setFormat:h}=u??{},f=r||!(!e||!l||l===1),m=n?Lxe({matchUpStatus:a}):"",g=(c==null?void 0:c.sort(Fxe).map(v).filter(Boolean).join(" "))||"";if(!m)return g;if(l===2)return`${m} ${g}`;return`${g} ${m}`;function v(y){let b=d&&y.setNumber===d&&p?p:h,I=B=>Dr(B==null?void 0:B.side1Score)||Dr(B==null?void 0:B.side2Score),T=(B=>Dr(B==null?void 0:B.side1TiebreakScore)||Dr(B==null?void 0:B.side2TiebreakScore))(y),w=(b==null?void 0:b.tiebreakSet)||!I(y)&&T,{side1Score:S,side2Score:U,side1TiebreakScore:P,side2TiebreakScore:E}=y,R=P||(Dr(P)||T&&o?0:""),C=E||(Dr(E)||T&&o?0:"");if(w)return`[${(f?[C,R]:[R,C]).join("-")}]`;let M=T?Math.min(R,C):"",_=M===R?1:2,A=Dr(M)?`(${M})`:"",N=S||(Dr(S)||o?0:""),k=U||(Dr(U)||o?0:""),O=B=>!i&&_===B?A:"",$=`${N}${O(1)}`,F=`${k}${O(2)}`,V=i&&T?`(${M})`:"",j=f?`${[F,$].join("-")}${V}`:`${[$,F].join("-")}${V}`;return["-"," "].includes(j)&&(j=""),j}}function Lxe({matchUpStatus:t}){let e={[as]:"RET",[cn]:"WO",[sa]:"DF/DF",[Yr]:"WO/WO",[Vg]:"SUS",[sl]:"ABN",[Yi]:"DEF",[lU]:"DR"};return t&&e[t]||""}function Fxe(t,e){return t.setNumber-e.setNumber}function qce(t){if(!(t!=null&&t.score))return{error:ai};let{sets:e}=t.score,i=e.map(s=>{let{side1TiebreakScore:o,side2TiebreakScore:l,winningSide:c,side1Score:u,side2Score:d,setNumber:p}=s;return Kt({winningSide:c?3-c:void 0,side1TiebreakScore:l,side2TiebreakScore:o,side1Score:d,side2Score:u,setNumber:p})}),n=t==null?void 0:t.setTBlast,r=Uh({setTBlast:n,sets:i}),a=Uh({sets:i,reversed:!0,setTBlast:n});return{reversedScore:{sets:i,scoreStringSide1:r,scoreStringSide2:a},...de}}var Wce={};Li(Wce,{addGame:()=>Jce,addPoint:()=>Xce,addSet:()=>eue,addShot:()=>Qce,calculateHistoryScore:()=>Yce,clearHistory:()=>Zce,redo:()=>tue,setServingSide:()=>Kce,umo:()=>nue,undo:()=>iue});function Gy({matchUp:t}){let{extension:e}=ki({name:kx,element:t});if(!e)return{error:za};let{history:i=[],undoHistory:n=[]}=e.value;return{history:i,undoHistory:n,...de}}function Yce(t){var E,R;if(!t)return{error:ai};let{matchUp:e,updateScore:i}=t;if(!e)return{error:rl};let n=((E=Gy({matchUp:e}))==null?void 0:E.history)||[];if(!Array.isArray(n))return{error:Re,info:"history is not an array"};let{matchUpFormat:r}=e;if(!r)return{error:Uz};if(!Nl({matchUpFormat:r}))return{error:Tz};let a=wo(r),{bestOf:s,finalSetFormat:o,setFormat:l}=a,c=["0","15","30","40","A","G"],u={sets:[]},d=[],p,h=[0,0],f=1,m=0,g,v=0,y=C=>[1,2].includes(C),b=()=>(m+=1,{winningSide:void 0,side1Score:0,side2Score:0,setNumber:m,games:[]}),I=()=>({winningSide:void 0,points:[]}),T=()=>({winningSide:void 0,side1Score:"",side2Score:"",shots:[]}),w=T(),S=I(),U=b(),P=0;for(let C of n){P+=1,g=u.sets.length+1===s;let M=g&&o?o:l,{tiebreakAt:_,setTo:A,NoAD:N,tiebbreakFormat:k}=M,O=U.side1Score===_&&U.side1Score===U.side2Score,$=!!M.tiebreakSet,F=$?M.tiebreakSet:k,{tiebreakTo:V,NoAD:j}=F||{},B=()=>{p=void 0,h=[0,0],f=3-f,U.side1TiebreakScore="",U.side2TiebreakScore="",U.side1PointScore="",U.side2PointScore="",v=0},z=K=>{U.winningSide=K;let{s:Q,...J}=U;u.sets.push(J),w=T(),S=I(),U=b(),B()},W=K=>{S.winningSide=K;let{g:Q,...J}=S;U.games.push(J),w=T(),S=I(),B();let se=`side${K}Score`;U[se]+=1},Z=K=>{w.winningSide=K;let{p:Q,...J}=w;S.points.push(J),w=T(),v=0;let se=()=>h.reduce((ce,oe)=>ce+oe)%4/4>.5?f:3-f,ie=K-1;if(O||$){h[ie]+=1,p=se(),U[`side${K}TiebreakScore`]=h[ie],U[`side${3-K}TiebreakScore`]=h[1-ie];let ce=j?1:2;if(h[ie]>=V&&h[ie]>=h[1-ie]+ce)return W(K),{gameCompleted:!0}}else if(h[1-ie]===4&&h[ie]===3?h[1-ie]-=1:h[ie]+=1,U.side1PointScore=c[h[0]],U.side2PointScore=c[h[1]],h[ie]===5||h[ie]===4&&h[1-ie]<3||N&&h[ie]===4)return W(K),{gameCompleted:!0}};if(y(C.srv)&&(f=C.srv),["p","s","g","o"].includes(C.u)&&d.push(C.u),C.shotOutcome&&(w.shots.push(C),C.shotType==="SERVE"&&["OUT","NET"].includes(C.shotOutcome)&&(v+=1),v===2)){let K=3-f;Z(K)}if(y(C.p)||Ii(C.pointNumber)){let K=C.winningSide||C.p;if((R=Z(K))!=null&&R.gameCompleted)continue}if(y(C.g)||Ii(C.gameNumber)){let K=C.winningSide||C.g;S.winningSide=K;let Q=`side${K}Score`,J=`side${3-K}Score`;if(d.length&&(d.includes("p"),d=[]),W(K),U[Q]===A&&U[Q]-U[J]>=(N?1:2)&&(z(K),g))break}if(y(C.s)||Ii(C.setNumber)){let K=C.winningSide||C.s;if(z(K),d.length&&(d.includes("p"),d.includes("g"),d=[]),g)break}}return P!==n.length&&console.log({error:"Match completed with excess history"}),(U.side1Score||U.side2Score||U.games.length||U.side1TiebreakScore||U.side2TiebreakScore)&&u.sets.push(U),u.scoreStringSide1=Uh({...u,matchUpFormat:r}),u.scoreStringSide2=Uh({...u,matchUpFormat:r,reversed:!0}),f=p||f,i&&(e.score=u),{...de,servingSide:f,score:u}}function Hy({undoHistory:t,history:e,matchUp:i}){return dn({element:i,extension:{value:{history:e,undoHistory:t},name:kx}})}function Kce({matchUp:t,sideNumber:e}){if(![1,2].includes(e))return{error:Cz};let{history:i=[]}=Gy({matchUp:t});return i.push({srv:e}),Hy({matchUp:t,history:i})}function Zce({matchUp:t}){return Hy({matchUp:t})}function Xce({matchUp:t,point:e}){if(!e||!t)return{error:ai};if(typeof e!="object")return{error:Re,context:{point:e}};let{history:i=[]}=Gy({matchUp:t});return i.push(e),Hy({matchUp:t,history:i})}function Jce({matchUp:t,game:e}){if(typeof e!="object")return{error:Re,context:{game:e}};let{history:i=[]}=Gy({matchUp:t});return i.push(e),Hy({matchUp:t,history:i})}function Qce({matchUp:t,shot:e}){if(typeof e!="object")return{error:ai};let{history:i=[]}=Gy({matchUp:t});return i.push(e),Hy({matchUp:t,history:i})}function eue({matchUp:t,set:e}){if(typeof e!="object")return{error:ai};let{history:i=[]}=Gy({matchUp:t});return i.push(e),Hy({matchUp:t,history:i})}function tue({matchUp:t}){let{history:e=[],undoHistory:i=[]}=Gy({matchUp:t});return i.length&&e.push(i.pop()),Hy({matchUp:t,history:e,undoHistory:i})}function iue({matchUp:t}){let{history:e=[],undoHistory:i=[]}=Gy({matchUp:t});return i.push(e.pop()),Hy({matchUp:t,history:e,undoHistory:i})}var nue={},rue={};Li(rue,{keyValueScore:()=>Rue,parseMatchUpFormat:()=>wo,stringifyMatchUpFormat:()=>yx,tidyScore:()=>_ue});var Bb=" ",ij="DEF",$xe="COMPLETED",aue="WO",Bxe="WO/WO",sue="ABN",oue="SUS",lue="RET",cue="INT",uue=[lue,ij,aue,Bxe,sue,oue,cue],nj="DEFAULTED",due="WALKOVER",pue="ABANDONED",hue="SUSPENDED",fue="RETIRED",mue="INTERRUPTED",Vxe=[fue,nj,due],jxe="Enter Score",mI="()",cy="[]",eW=["up","left","shift+tab"],tW=["enter","down","tab","right"],t_="backspace",gue="r",vue="s",yue="a",bue="d",Iue="w",wue="i",mO=[gue,bue,Iue,yue,vue,wue],gO="space",I$=["[","("],i_=[...eW,...tW,gO,"]"],Sue="-",Gxe="/",Vb=Sue,Dh=Sue,Tue=[Gxe],Hxe=0,zxe=["=","+","num_1","num_2","shift+=","shift+-"],lh=["0","1","2","3","4","5","6","7","8","9"].concat(mO),Uue=lh.map(t=>`shift+${t}`),iW=[Vb,t_].concat(i_,Tue),Due=[lh,Uue,iW].join(","),qxe=[Due,eW,tW,zxe].join(",");[].concat(...lh,...lh,...iW,...lh,...lh,...lh,...lh,...lh,...lh);var nW={OUTCOMEKEYS:mO,SIDE1KEYS:lh,SIDE2KEYS:Uue,MODIFIERS:iW,PROMPT:jxe,MOVEUP:eW,MOVEDOWN:tW,HOTKEYS:qxe};function v0({scoreString:t,lowSide:e,outcome:i}){if({scoreString:t}=Eue({scoreString:t}),e===2){let n=(t&&t[t.length-1])!==Bb?Bb:"";return t+n+i}else return i+Bb+t}function Eue({scoreString:t}){if(!t)return{scoreString:""};let e=!1;for(let i of uue){let n=t==null?void 0:t.indexOf(i);n===0?t=t.slice(i.length+1).trim()+Bb:n>0&&(t=t.slice(0,n)),n>=0&&(e=!0)}return t!=null&&t.trim()||(t=""),{scoreString:t,removed:e}}function rj({analysis:t,scoreString:e,sets:i,lowSide:n}){var m,g,v;let r,a;if(!e)return{scoreString:e,sets:i};let{scoreString:s,removed:o}=Eue({scoreString:e});if(e=s,o)return{scoreString:e,sets:i,outcomeRemoved:!0};let l=i[i.length-1]||{},c=Object.values(l).filter(y=>y!==void 0).length;l.setNumber&&c===1&&(i=i.slice(0,i.length-1),l=i[i.length-1]||{});let{tiebreakSet:u}=t.setFormat,{tiebreakTo:d,NoAD:p}=u||{},{isTiebreakEntry:h}=fS({brackets:cy,scoreString:e}),f=Yxe(e);if(f>=0){r=e.slice(0,f);let{isTiebreakEntry:y}=fS({brackets:mI,scoreString:r}),{lastOpenBracketIndex:b,isTiebreakEntry:I}=fS({brackets:cy,scoreString:r}),T=r&&r[r.length-1].trim(),w=r&&!isNaN(T),S=t.isIncompleteSetScore;if(h&&I){let U=r.slice(b+1).split(Dh),P=(U==null?void 0:U.length)>0&&U[0]!==void 0&&!isNaN(parseInt(U[0]))&&parseInt(U[0])||void 0,E=(U==null?void 0:U.length)>1&&U[1]!==void 0&&parseInt(U[1])||void 0,R=[P,E];if(E){let C=n===1?1:0;R[C]=((R==null?void 0:R[1-C])||0)+(p?1:2),(R[C]||0)<d&&(R[C]=d),r=e.slice(0,b+1),r+=R.join(Dh)}else P!==void 0?(r=e.slice(0,b+1),r+=P):(r=e.slice(0,b),S=!0);l.side1TiebreakScore=R[0]||0,l.side2TiebreakScore=R[1]||0}if(r.length||(r=void 0),S){let U=(m=l.side1Score)==null?void 0:m.toString();if(U){let P=U==null?void 0:U.slice(0,U.length-1);l.side1Score=!isNaN(P)&&parseInt(P)||void 0,l.side1Score===void 0&&(l.side2Score=void 0)}t.isTimedSet?(a=l.side1Score?i:(i==null?void 0:i.slice(0,i.length-1))||[],a[i.length-1]=l):a=(i==null?void 0:i.slice(0,i.length-1))||[]}else if(w){let U=(g=l.side2Score)==null?void 0:g.toString(),P=(v=l.side1Score)==null?void 0:v.toString();if(!t.isTiebreakEntry&&!t.isMatchTiebreak)if(l.side2Score){let E=U==null?void 0:U.slice(0,U.length-1);l.side2Score=!isNaN(E)&&parseInt(E)||void 0}else{let E=P==null?void 0:P.slice(0,P.length-1);l.side1Score=!isNaN(E)&&parseInt(E)||void 0}t.isTimedSet?l.side1Score?(a=i||[],a[i.length-1]=l):a=(i==null?void 0:i.slice(0,i.length-1))||[]:(a=i||[],a[i.length-1]=l),a[a.length-1]&&Object.assign(a[a.length-1],{winningSide:void 0})}else y?(a=i||[],Object.assign(a[a.length-1]||{},{winningSide:void 0,side1TiebreakScore:void 0,side2TiebreakScore:void 0})):(h&&!I?a=(i==null?void 0:i.slice(0,i.length-1))||[]:(a=i,a[i.length-1]=l),h||(a[a.length-1].side2Score=0,a[a.length-1].winningSide=void 0));return{scoreString:r,sets:a}}return{scoreString:e,sets:i}}function fS({brackets:t=mI,scoreString:e}){if(!e)return{};let[i,n]=t.split(""),r=e.split(""),a=Math.max(...fp(i,r)),s=Math.max(...fp(n,r));return{isTiebreakEntry:a>s,lastOpenBracketIndex:a}}function Wxe({scoreString:t}){if(!t)return!1;let e=t&&t[t.length-1].trim(),i=t&&!isNaN(e),[n,r]=cy.split(""),a=t.split(""),s=Math.max(...fp(n,a)),o=Math.max(...fp(r,a)),l=Math.max(...fp(Dh,a));return i&&s>o&&l>s}function Yxe(t){return t.split("").reduce((e,i,n)=>(i.match(/\d+/g)&&e.push(n),e),[]).pop()}function Pue(t){let{lowValue:e=0,NoAD:i=!1,tiebreakTo:n}=t||{},r=i?1:2;return e+1>=n?e+r:parseInt(n)}function fZ({matchUpFormat:t,matchUpStatus:e,winningSide:i,sets:n}){var l;let r=wo(t),{bestOf:a}=r,s=Math.ceil(a/2),o=((l=n==null?void 0:n.reduce((c,u)=>{let{winningSide:d}=u;return d&&c[d-1]++,c},[0,0]))==null?void 0:l.indexOf(s))+1||void 0;return Vxe.includes(e)&&i&&(o=i),{matchUpWinningSide:o}}function vO({ignoreTiebreak:t=!1,matchUpScoringFormat:e,matchUpFormat:i,isTiebreakSet:n,isDecidingSet:r,isTimedSet:a,set:s}){var I;if(!s)return{error:ai,info:"missing set"};e=e||i&&wo(i);let o=r&&e.finalSetFormat||(e==null?void 0:e.setFormat)||{},{side1Score:l,side2Score:c}=s,{setTo:u,tiebreakAt:d}=o,p=l||c,h=yO({set:s}),f=Math.abs(l-c),m=l>=u||c>=u,g=n||l>=u&&c>=u||d&&d<u&&(l===d||c===d),v=t||g&&(h===1&&s.side1TiebreakScore>s.side2TiebreakScore||h===2&&s.side2TiebreakScore>s.side1TiebreakScore),y=!g&&o.NoAD||g||n&&((I=o.tiebreakFormat)!=null&&I.NoAD)?1:2,b=f>=y;return!!((a&&p||m&&(b||g)||n)&&(!g||v))}function yO({set:t}){if(t.side1Score||t.side2Score){if(t.side1Score>t.side2Score)return 1;if(t.side2Score>t.side1Score)return 2}else if(t.side1TiebreakScore||t.side2TiebreakScore){if(t.side1TiebreakScore>t.side2TiebreakScore)return 1;if(t.side2TiebreakScore>t.side1TiebreakScore)return 2}}function rW({analysis:t,set:e}){let i=yO({set:e}),{isDecidingSet:n,isTiebreakSet:r,matchUpScoringFormat:a}=t;return vO({matchUpScoringFormat:a,isDecidingSet:n,isTiebreakSet:r,set:e})&&i}function Kxe({analysis:t,scoreString:e,sets:i,value:n}){let r;if(!(i!=null&&i.length))return{sets:[]};let a=i[i.length-1];n=ui(n);let{validSide2Score:s,requiresTiebreak:o}=Zxe({analysis:t,set:a,value:n});if(s){r=!0,e=(e||"")+n,a.side2Score=n;let l=rW({analysis:t,set:i[i.length-1]});if(a.winningSide=l||void 0,o){let c=mI.split("")[0];e+=c}else t.isDecidingSet||(e+=Bb)}return{sets:i,scoreString:e,updated:r}}function Zxe({analysis:t,set:e={},value:i}){let n=t.isDecidingSet&&t.matchUpScoringFormat.finalSetFormat||t.matchUpScoringFormat.setFormat,{tiebreakAt:r,setTo:a,NoAD:s}=n,{side1Score:o}=e,l,c;return r&&r<a?o===r?l=i<=a:l=i<=r:o===a?s?l=i<a:l=i<=a+1:o===a-1?s?l=i<=a:l=i<=a+1:o===a+1?l=i===a||i===a-1:l=i<=a,l&&(r&&r<a?c=o===a&&i===r||o===r&&i===a:c=o>=a&&i>=a&&o!==i),{validSide2Score:l,requiresTiebreak:c}}function Cue({lowSide:t,value:e,sets:i,scoreString:n,winningSide:r,matchUpStatus:a}){let s;return e===gue?n?(s=!0,n=v0({scoreString:n,lowSide:t,outcome:lue}),r=t===2?1:2,a=fue):(s=!0,n=v0({scoreString:n,lowSide:t,outcome:ij}),r=t===2?1:2,a=nj):e===bue?(s=!0,n=v0({scoreString:n,lowSide:t,outcome:ij}),r=t===2?1:2,a=nj):e===Iue?(s=!0,i=[],n=aue,r=t===2?1:2,a=due):e===vue&&n?(s=!0,n=v0({scoreString:n,lowSide:t,outcome:oue}),a=hue,r=void 0):e===yue?(s=!0,n=v0({scoreString:n,lowSide:t,outcome:sue}),a=pue,r=void 0):e===wue&&n&&(s=!0,n=v0({scoreString:n,lowSide:t,outcome:cue}),a=mue,r=void 0),{updated:s,sets:i,scoreString:n,matchUpStatus:a,winningSide:r}}function Xxe(t){let{sets:e,info:i,scoreString:n,winningSide:r,matchUpStatus:a}=t,{analysis:s,lowSide:o,value:l}=t,c,u;!(e!=null&&e.length)&&l!==t_&&(e=[{setNumber:1}]);let d=e.length-1;if(mO.includes(l)){let p=e[e.length-1]||{},{side1Score:h,side2Score:f}=p;h&&!f?i="missing side2Score":s.finalSetIsComplete||r?i="final set is already complete":s.isIncompleteSetScore?i="incomplete set scoreString":s.isIncompleteSetScore||({sets:e,scoreString:n,winningSide:r,matchUpStatus:a,updated:c}=Cue({lowSide:o,value:l,sets:e,scoreString:n,matchUpStatus:a,winningSide:r}))}else if(l===t_){if({scoreString:n,sets:e,outcomeRemoved:u}=rj({analysis:s,scoreString:n,sets:e}),(n==null?void 0:n.trim())===""&&(n=n.trim()),n||(e=[]),u){let p=e[e.length-1]||{},{side1Score:h,side2Score:f}=p;if(h&&f){let m=h>f&&1||f>h&&2||void 0;m&&(p.winningSide=m,e.push({setNumber:e.length+1}))}}a=void 0,r=void 0,c=!0}else if(s.hasOutcome)i="has outcome";else{if(r)return{sets:e,scoreString:n,winningSide:r,matchUpStatus:a,updated:!1,info:"matchUp is complete"};if(l===gO){let p=e[e.length-1]||{},{side1Score:h,side2Score:f}=p,m=h>f&&1||f>h&&2||void 0;m&&!r&&!s.isIncompleteSetScore&&(e[e.length-1].winningSide=m,e.push({setNumber:e.length+1}),n+=" ",c=!0)}else if(l===Vb&&e[d].side1Score!==void 0&&e[d].side2Score===void 0&&n&&s.isNumericEnding)n+="-",e[d].side2Score=0,a=void 0,r=void 0,c=!0;else if(!isNaN(l)){let p;if(e[d].side2Score===void 0){let h=ui((e[d].side1Score||0).toString()+l).toString().slice(0,2);e[d].side1Score=ui(h),p=e[d].side1Score.toString(),c=!0}else{let h=ui((e[d].side2Score||0).toString()+l).toString().slice(0,2);e[d].side2Score=ui(h),p=[e[d].side1Score,e[d].side2Score].join("-"),c=!0}if(c){let h=(e.slice(0,d)||[]).filter(f=>f).map(f=>{let{side1Score:m,side2Score:g}=f;return[m,g].join("-")}).join(" ");h?n=h+" "+p:n=p}}}return{sets:e,scoreString:n,winningSide:r,matchUpStatus:a,info:i,updated:c}}function Jxe({analysis:t,auto:e,lowSide:i,scoreString:n="",sets:r,value:a}){var d;let s,o,{tiebreakSet:{tiebreakTo:l,NoAD:c}}=t.setFormat,[u]=cy.split("");if(t.isMatchTiebreakEntry||(n+=u),r[t.setNumber-1]){let{lastOpenBracketIndex:p}=fS({brackets:cy,scoreString:n}),h=(n.slice((p??0)+1)+(e?"":a)).split(Dh);if((((d=h[i-1])==null?void 0:d.length)||0)>=2)o="tiebreak digit limit";else if(e){i===1&&(h[0]=(h[0]||"")+a),i===2&&(h[1]=(h[1]||"")+a);let f=[h[0]||0,h[1]||0].map(v=>ui(v)),m=i===1?1:0;f[m]=f[1-m]+(c?1:2),f[m]<l&&(f[m]=l);let g=r[r.length-1];g.side1TiebreakScore=f[0],g.side2TiebreakScore=f[1],n=n.slice(0,(p??0)+1),n+=f.join(Dh),s=!0}else{let f=[h[0]||0,h[1]||0].map(g=>ui(g)),m=r[r.length-1];m.side1TiebreakScore=f[0],m.side2TiebreakScore=f[1],n+=a,s=!0}}else{let p=Pue({lowValue:ui(a||0),tiebreakTo:l,NoAD:c}),h=[ui(a),p];i===2&&h.reverse();let f={side1TiebreakScore:h[0],side2TiebreakScore:h[1],setNumber:(r==null?void 0:r.length)+1||1};r.push(f),n+=h.join(Dh),s=!0}return{info:o,scoreString:n,sets:r,updated:s}}function Qxe({analysis:t,lowSide:e,scoreString:i,value:n}){let{setTo:r,tiebreakAt:a,NoAD:s}=(t==null?void 0:t.setFormat)||{},o=n===parseInt(a||r);if(a&&a<r&&n>a)return{scoreString:i};if(s&&n===r||n>r)return{scoreString:i};let l=f(),c=[n,l];e===2&&c.reverse();let u=mI.split("")[0],d=c.join(Vb)+(o?u:Bb);i=(i||"")+d;let p={side1Score:c[0],side2Score:c[1]},h=rW({analysis:t,set:p});return p.winningSide=h||void 0,{scoreString:i,set:p};function f(){return o?n+1:n+1===r?n+(s?1:2):r}}function eOe({matchUpFormat:t,scoreString:e,winningSide:i,value:n,sets:r}){var $,F,V;let a=((($=r==null?void 0:r.filter(j=>j==null?void 0:j.winningSide))==null?void 0:$.length)||0)+(i?0:1),s=wo(t),o=a===(s==null?void 0:s.bestOf),l=o&&(s==null?void 0:s.finalSetFormat)||(s==null?void 0:s.setFormat)||{},c=l==null?void 0:l.timed,u=o&&r[(s==null?void 0:s.bestOf)-1],d=u==null?void 0:u.winningSide,{isTiebreakEntry:p}=fS({brackets:mI,scoreString:e}),{isTiebreakEntry:h}=fS({brackets:cy,scoreString:e}),f=p||h,m=!!l.tiebreakSet,g=(F=e==null?void 0:e[e.length-1])==null?void 0:F.trim(),v=e&&!isNaN(g),y=!f&&g===Vb,b=p&&I$.includes(g),I=h&&I$.includes(g),T=h&&g===Dh,w=e==null?void 0:e.split(""),[S]=cy.split(""),U=w&&Math.max(...fp(S,w)),P=w&&Math.max(...fp(Dh,w)),E=w&&P>U,R=(V=r[r.length-1])==null?void 0:V.winningSide,C=(r==null?void 0:r.length)&&!R,M=uue.find(j=>(e==null?void 0:e.indexOf(j))>=0),_=!isNaN(n),A=n===gO,N=i_.includes(n),k=e==null?void 0:e.split("").find(j=>I$.includes(j)),O=N&&h&&!I&&(T||!Wxe({scoreString:e}));return{isTiebreakSetValue:m&&_,matchUpScoringFormat:s,setNumber:a,setFormat:l,matchTiebreakHasJoiner:E,isGameScoreEntry:C,isSpace:A,isCloser:N,isTiebreakCloser:N&&k&&f&&v,isDecidingSet:o,isTiebreakSet:m,isTimedSet:c,isNumericEnding:v,isNumericValue:_,hasOpener:k,hasOutcome:M,finalSet:u,finalSetIsComplete:d,lastSetIsComplete:R,isInvalidSetTiebreakValue:A&&f&&b,isInvalidMatchTiebreakValue:O,isTiebreakEntry:f,isSetTiebreakEntry:p,isMatchTiebreakEntry:h,isIncompleteSetScore:y,isIncompleteSetTiebreak:b,isIncompleteMatchTiebreak:I,isPartialMatchTiebreakValue:T}}function Rue(t){let{lowSide:e=1,value:i}=t,{scoreString:n,sets:r,winningSide:a,matchUpStatus:s}=t,{matchUpFormat:o,shiftFirst:l,auto:c=!0}=t,u,d,p=l&&e===2||!l&&e===1;if(!Due.includes(i))return{updated:!1,info:"invalid key"};l&&(e=3-e);let{matchUpWinningSide:h}=fZ({sets:r,winningSide:a,matchUpStatus:s,matchUpFormat:o});a=h;let f=eOe({value:i,winningSide:a,scoreString:n,sets:r,matchUpFormat:o});if(Tue.includes(i)&&(i=Vb),f.hasOpener&&f.isTiebreakEntry&&!f.isTiebreakSet&&p&&ui(i)===0&&(f.isTiebreakCloser=!0),i_.includes(i)&&f.hasOpener&&(i=""),i_.includes(i)&&(i=gO),f.lastSetIsComplete){let m=(n==null?void 0:n.length)&&n[n.length-1];n&&m!==" "&&(n+=" ")}if(f.isTimedSet)({info:d,sets:r,scoreString:n,updated:u,matchUpStatus:s,winningSide:a}=Xxe({analysis:f,lowSide:e,scoreString:n,sets:r,matchUpStatus:s,winningSide:a,value:i}));else if(mO.includes(i))f.finalSetIsComplete||a?d="final set is already complete":!f.isTiebreakEntry&&!f.isIncompleteSetScore?{sets:r,scoreString:n,matchUpStatus:s,winningSide:a,updated:u}=Cue({lowSide:e,sets:r,scoreString:n,matchUpStatus:s,winningSide:a,value:i}):f.isTiebreakEntry||f.isIncompleteSetScore?d="incomplete set scoreString or tiebreak entry":console.log("handle case",{value:i});else if(i===t_)u=!0,{scoreString:n,sets:r}=rj({analysis:f,scoreString:n,sets:r,lowSide:e}),n||(r=[]),s=void 0,a=void 0;else if(f.hasOutcome)d="has outcome";else if(i===Vb&&!f.isMatchTiebreakEntry)(!f.isSetTiebreakEntry||f.isSetTiebreakEntry&&!f.isNumericEnding)&&(u=!0,{scoreString:n,sets:r}=rj({analysis:f,scoreString:n,sets:r,lowSide:e}),s=void 0);else if(i===Dh&&f.isMatchTiebreakEntry&&!f.isSetTiebreakEntry)f.matchTiebreakHasJoiner?d="existing joiner":f.isNumericEnding&&(u=!0,n+=Dh);else if([Vb,Dh].includes(i))d="invalid location for joiner";else{if(a)return{updated:!1,info:"matchUp is complete"};if(f.isIncompleteSetScore)f.isNumericValue&&({sets:r,scoreString:n,updated:u}=Kxe({analysis:f,scoreString:n,sets:r,value:i}));else if(f.isInvalidMatchTiebreakValue)d="invalid matchUp tiebreak character";else if(f.isInvalidSetTiebreakValue)d="invalid set tiebreak character";else if(f.isTiebreakCloser){let m=f.isSetTiebreakEntry?mI:cy,g=m.split("").reverse()[0],v=m.split("")[0],y=r[r.length-1],{tiebreakFormat:b}=f.setFormat,{tiebreakTo:I,NoAD:T}=b||{},w=yO({set:y});if(!f.isTiebreakSet){let U=parseInt(n.split(v).reverse()[0]),P=Pue({lowValue:U,tiebreakTo:I,NoAD:T});w===1?(y.side1TiebreakScore=P,y.side2TiebreakScore=U):(y.side1TiebreakScore=U,y.side2TiebreakScore=P)}n=(n||"")+g,f.isDecidingSet||(n+=Bb);let S=rW({analysis:f,set:y});y.winningSide=S||void 0,u=!0}else if(f.isTiebreakSetValue)({info:d,scoreString:n,sets:r,updated:u}=Jxe({analysis:f,auto:c,lowSide:e,scoreString:n,sets:r,value:i}));else if(f.isSetTiebreakEntry){let[m]=mI.split(""),g=Math.max(...fp(m,n.split(""))),v=n.slice(g+1),y=v&&ui(v)===Hxe,b=ui(v?v+i:i),{tiebreakFormat:I}=f.setFormat,{tiebreakTo:T,NoAD:w}=I||{};!y&&v.length<2?w&&b>T-1?d="invalid low value for NoAD tiebreak":(u=!0,n=(n||"")+i):d=y?"tiebreak begins with zero":"tiebreak digit limit"}else if(f.isCloser)d=`invalid key: ${i}`;else if(f.isGameScoreEntry)d="game scoreString entry";else if(f.lastSetIsComplete||!r.length){u=!0;let{scoreString:m,set:g}=Qxe({analysis:f,lowSide:e,scoreString:n,value:ui(i)});g&&(g.setNumber=(r==null?void 0:r.length)+1||1),r=(r==null?void 0:r.concat(g).filter(Boolean))||[g],n=m||void 0}else console.log("error: unknown outcome")}if(u){r=r==null?void 0:r.filter(Boolean);let{matchUpWinningSide:m}=fZ({sets:r,winningSide:a,matchUpStatus:s,matchUpFormat:o});return a=m,m&&(!s||[Vr,_l].includes(s))?(s=$xe,r=r.filter(g=>{let{side1Score:v,side2Score:y,side1TiebreakScore:b,side2TiebreakScore:I}=g;return v||y||b||I})):n&&!a&&![hue,pue,mue].includes(s)&&(s=void 0),{updated:u,scoreString:n,sets:r,winningSide:a,matchUpStatus:s,info:d}}return{updated:u,scoreString:n,sets:r,winningSide:a,matchUpStatus:s,info:d}}var bO="\\d+-\\d+",gE="\\d+-\\d+\\(\\d+\\)",aW="\\[\\d+-\\d+\\]",tOe="\\d+-\\d+\\(\\d+-\\d+\\)",iOe=new RegExp(`(${bO}),`,"g"),nOe=new RegExp(`(${gE}),`,"g"),rOe=[bO,gE,aW,tOe],aOe=["0","1","2","00","01","10","11","002","012","102","112","000","001","010","100","011","101","110","111","002","012","102","112","0002","0012","0102","1002","0112","1012","1102","1112","3","03","13","013","103"],sOe=aOe.map(t=>{let e=t.split("").map(i=>rOe[i]).join(" ");return new RegExp(`^${e}$`)});function mZ(t){return!t||sOe.some(e=>e.test(t))}function oOe(t){let e="[];",i="()",n=e+i,r=[e[0],i[0]],a=Object.assign({},...n.split("").map(l=>({[l]:0}))),s="",o=t.split("").map(l=>{let c=n.includes(l)&&l,u=r.includes(c);if(u&&c)return a[c]+=1,s=c,l;if(!u&&c&&s&&c!==s){a[s]-=1;let d=e.includes(s)&&e||i.includes(s)&&i||"",p=d.split("").find(h=>h!==s);if(d.includes(c))a[s]||(s="");else return a[c]||(s=""),p}return l}).join("");return t!==o?o:t}function qN(t){return/^\(\d+\)$/.test(t)||/^\(\d+$/.test(t)}function lOe(t){return/^\(\d+-\d+\)$/.test(t)||/^\[\d+-\d+\]$/.test(t)}function WS(t){let e=(i=>i==null?void 0:i.split("-").join("").split("/").join(""))(t);if(/^\d+$/.test(e)&&e.length===2){let i=e.split("");return Math.abs(i.reduce((n,r)=>+n-+r))===1}return!1}function n_(t,e){let i=[t.slice(e,e+2),e?t.slice(0,1):t.slice(2)].map(r=>parseInt(r.join("")));e&&i.reverse();let n=i;if(Math.abs(n.reduce((r,a)=>+r-+a))>=2)return n.join("-")}function gZ(t){return t.length===2?t.split("").join("-"):([", ",",","/"," "].forEach(e=>t=t.split(e).join("-")),t=t.replace(/-{2,}/,"-"),t)}function cOe(t){return t.startsWith("(")&&t.endsWith(")")}function uOe({score:t,applied:e}){t=oOe(t);let i=/\)(\d+)/g;if(i.test(t))for(let w of t.match(i)){let S=w.replace(")",") ");t=t.replace(w,S)}t=t.replace(/\)\//g,") / "),t=t.replace(/\/\)/g,")");let n=/\(([\d- ]+)\)/g,r=/\(([\d- ]+)\)/,a=t.match(n);for(let w of a||[]){let[S]=w.match(r).slice(1),U=S.replace(/ /g,"");t=t.replace(w,`(${U})`)}let s=/\(\(\d-\d\)\)/g;if(s.test(t)){let w=t.match(s);w.length&&w.forEach(S=>{let U=S.match(/\((\(\d-\d\))\)/).slice(1)[0];t=t.replace(S,U)})}if(s=/\(\((\d)\)\)/g,s.test(t)){let w=t.match(s);w.length&&w.forEach(S=>{let U=S.match(/\((\(\d\))\)/).slice(1)[0];t=t.replace(S,U)})}/(^|\s)6-,/.test(t)&&(t=t.replace(/(^|\s)6-,/g,"6-0,"));let o=new RegExp(/[-,]{2,}/g);t=t.replace(o,"-"),["- "," -"].forEach(w=>{let S=new RegExp(`(\\d+)${w}(\\d+)`,"g"),U=t.match(S);U&&U.forEach(P=>t=t.replace(P,P.split(w).join("-")))}),/^[(-/,]+$/.test(t)&&(t=""),/\)[-/,]+$/.test(t)&&(t=t.slice(0,t.length-1)),/\d \/\d/.test(t)&&(t=t.replace(/ \//g,"/")),t.includes(" /")&&(t=t.replace(/ \//g," "));let l=/\(\d+, \)/g;l.test(t)&&t.match(l).forEach(w=>{let[S]=w.match(/\((\d+), \)/).slice(1);S.length===2?t=t.replace(w,`(${S})`):S.length===1&&S==="6"&&(t=t.replace(w,"(6-0)"))});let c=/\((\d+)\/\)/g;c.test(t)&&t.match(c).forEach(w=>{let[S]=w.match(/\((\d+)\/\)/).slice(1);S.length===2?t=t.replace(w,`(${S})`):S.length===1&&S==="6"?t=t.replace(w,"(6-0)"):t=t.replace(w,`(${S})`)});let u=/\d\/\d\/,/g;u.test(t)&&t.match(u).forEach(w=>{let[S]=w.match(/(\d\/\d)\/,/).slice(1);t=t.replace(w,`${S},`),e.push("slashComma")});let d=/\(\/(\d+)\)/g;d.test(t)&&t.match(d).forEach(w=>{let[S]=w.match(/\(\/(\d+)\)/).slice(1);S.length===2?t=t.replace(w,`(${S})`):S.length===1&&parseInt(S)<6?t=t.replace(w,`(6-${S})`):t=t.replace(w,`(${S})`)});let p,h,f,m,g,v=()=>{g=Ml(t.split("")),h=g["("]===(g[")"]||0)+1,p=(g["("]||0)+1===g[")"],f=g["["]===g["]"]+1,m=h&&!f};v();let y=/(\d+-\d+\(\d+)0,/;if(y.test(t)){let[w]=t.match(y).slice(1);t=t.replace(y,w+")")}if(g["("]===g[")"]&&g["("]>1){let w=t.split(")(").join(") (").split(" ");w.every(cOe)?t=w.map(S=>{let U=S.slice(1,S.length-1);return U.length>2?U:S}).join(" "):t=w.join(" ")}v();let b=/[A-Za-z]+/.test(t),I=/\d+/.test(t);if(!b&&!I)return{score:""};if(/^\[.+\]$/.test(t)&&"()/,- ".split("").some(w=>g[w])&&(t=t.slice(1,t.length-1)),/^\(.+\)$/.test(t)&&g["("]===1&&g[")"]===1&&"[]/,".split("").some(w=>g[w]>1)&&(t=t.slice(1,t.length-1)),t.startsWith("(")&&t.endsWith("))")&&(t=t.slice(1,t.length-1)),g["("]>(g[")"]||0)&&t[t.length-1]==="("&&(t=t.slice(0,t.length-1)+")",v()),g["("]===1&&!g[")"]&&t[0]==="("&&(t=t+")",v()),g["("]>(g[")"]||0)&&t.slice(0,2)==="(("&&(t=t.slice(1)),p){if(/^9\d/.test(t))t="("+t.slice(1);else if(t[0]!=="(")t="("+t;else{let w=[],S=0;for(let U of t.split("").reverse())U===")"&&(S?w.push("("):S+=1),U==="("&&(S-=1),w.push(U);w.reverse(),t=w.join("")}v()}if(g[")"]>(g["("]||0)&&t[0]===")"&&(t="("+t.slice(1),v()),m&&(t.endsWith(9)||/\d+0$/.test(t))&&(t=t.slice(0,t.length-1)+")",v()),m&&(!t.endsWith(")")||t.startsWith("(("))&&(t=t+")",v()),m){let w="",S=0;for(let U of t.split(""))U==="("&&(S?w+=")":S+=1),U===")"&&(S-=1),w+=U;t=w}v(),f&&!h&&(t=t+"]"),t.includes("([")&&t.includes("])")&&(t=t.split("([").join("[").split("])").join("]"),v()),/\(\d+0$/.test(t)&&(t=t.slice(0,t.length-1)+")"),v(),g[")"]===1&&!g["("]&&t.endsWith(")")&&(t=t.slice(0,t.length-1)),t.startsWith("(")&&t.endsWith(")")&&g["("]===1&&g[")"]===1&&(t=t.slice(1,t.length-1),v());let T=w=>{let S=w.indexOf("("),U=w.indexOf(")");return S>=0&&U>=0&&S<U};if(/^\([\d ]+.*[\d ]+\)$/.test(t)&&g["("]===g[")"]){let w=t.slice(1,t.length-1);T(w)&&(t=w,v())}return{score:t,applied:e}}function IO(t){if(!/^[\d-]+(\(\d\))*$/.test(t))return t;let e=fp("-",t.split(""));if(!e.length)return t;let i=t.split("-"),n=!(i.length%2),r=!!(e.length%2);return n&&r&&e.length>i.length/2&&e.filter((a,s)=>s%2).forEach(a=>{t=t.substring(0,a)+" "+t.substring(a+1)}),t}function dOe({score:t,applied:e}){return t.includes("( ")&&(e.push("removeParenSpacingAfterOpen"),t=t.split("( ").map(i=>i.trim()).join("(")),t.includes(" )")&&(e.push("removeParenSpacingBeforeClose"),t=t.split(" )").map(i=>i.trim()).join(")")),[iOe,nOe].forEach(i=>{let n=t.match(i);n!=null&&n.length&&(n.forEach(r=>{t=t.replace(r,r.slice(0,r.length-1)+" ")}),e.push("setsEndComma"))}),t=t.split(" ").filter(Boolean).map(IO).join(" "),{score:t,applied:e}}function pOe({score:t}){if(typeof t!="string")return{score:t};let e=p=>p==null?void 0:p.split("-").join("").split("/").join(""),i=p=>p.split("[").join("(").split("]").join(")");t=t.split(", ").join(" ");let n=t.split(" ");t=n.map(p=>{let h=/^-(\d+)$/;if(h.test(p)){let[f]=p.match(h).slice(1);if(f.length===2)return f.split("").join("-")}return p}).join(" "),n=t.split(" ");let r=n.filter(qN),a=0,s="";for(let p of r){let h=fp(p,n).filter(v=>!a||v>a)[0],f=n.slice(a,h-1),m=n[h-1],g=e(m);if(/^\d+$/.test(g)&&g.length===2){let v=g.split(""),y=Math.abs(v.reduce((b,I)=>+b-+I));if(y===1){let b=[f.join(" "),[m,p].join("")].join(" ");s+=b,a=h+1}else if(y===0){let b=Math.max(...v);if([4,5,6,7,8,9].includes(b)){let I=[6,4].includes(b)?b+1:b-1,T=[b,I].sort().reverse().join("-"),w=[f.join(" "),[T,p].join("")].join(" ");s+=w,a=h+1}}}}if(r.length&&s.length){let p=n.slice(a).join(" ");return s=[s,p].join(" "),{score:s.trim()}}if(n.length===2&&["(","["].some(p=>n[1].includes(p))){let p=e(n[0]).split("");if(Math.abs(p.reduce((h,f)=>+h-+f,0))===1)return n[1]=i(n[1]),{score:n.join("")}}let o=n.map(p=>lOe(p)&&"bracket"||WS(p)&&"set");if(o.includes("set")&&o.includes("bracket")){let p,h="";return n.forEach((f,m)=>{o[m]==="bracket"&&p==="set"?(f=i(f),h+=f):h+=` ${f}`,p=o[m]}),{score:h.trim()}}n=t.split(" ");let l,c=n.map(p=>{let h=new RegExp(/^(\d+)-(\d+)$/);if(h.test(p)){let[f,m]=p.match(h).slice(1),g=Math.abs([f,m].reduce((y,b)=>+y-+b)),v=Math.max(f,m);if(g===1)return l="tiebreakSet",l;if(g>=2&&v>=7&&l==="tiebreakSet")return l="tiebreak",l}}),u=fp("tiebreak",c);if(u.length){let p="";n.forEach((h,f)=>{u.includes(f)?p+=`(${h}) `:u.includes(f+1)?p+=`${h}`:p+=`${h} `}),t=p.trim()}let d=/(\d+-\d+)\((\d+)-(\d+)\)$/;if(d.test(t)){let[p,h,f]=t.match(d).slice(1),m=Math.max(h,f)>=10;!WS(p)&&m&&(t=t.replace(d,`${p} [${h}-${f}]`))}return c=[],t=t.split(" ").map(p=>{let h=/^\((.*)\)$/,f=h.test(p),m=new RegExp(aW).test(p)&&"super"||new RegExp(gE).test(p)&&"tiebreak"||new RegExp(bO).test(p)&&"standard"||"unknown";return c.push(m),m==="standard"&&f?p.match(h)[1]:p}).join(" "),{score:t}}function hOe({score:t,applied:e}){for(let U of[".",","," ","/"]){let P=new RegExp(`^(\\d+)\\${U}(\\d+)$`);if(P.test(t)){let E=t.match(P).slice(1).map(C=>parseInt(C)),R=Math.abs(E[0]-E[1]);R<=10&&R>=2&&(t=t.split(U).join("-"),e.push("variedJoinerPattern"))}}t.includes(";")&&(t=t.split(";").join(" "),e.push("semicolon set separation"));let i=/(^|\s)(\d)\/(\d)(\d)\/(\d)(\(|$)/;if(i.test(t)){let[U,P,E,R,C,M]=t.match(i).slice(1);t=t.replace(i,`${U}${P}-${E} ${R}-${C}${M}`),e.push("smashSlashPattern")}/.*\s6[/-]+$/.test(t)&&(t+="0",e.push("incompleteFinalSetPattern"));let n=/\(6,\)/g;n.test(t)&&(t=t.replace(n,"(6, 0)"),e.push("missingZeroPattern1"));let r=/^\d{3,}\(/,a=/\(\d+\)\d+/;[r,a].forEach(()=>{t=t.split(" ").map(U=>(r.test(U)&&(U=U.replace("("," (")),a.test(U)&&(U=U.replace(")",") ")),U)).join(" "),e.push("spaceConsiderationPatterns")});let s=IO(t);s!==t&&(t=s,e.push("deDashMash"));let o=/^(\d)[-/,]+(\d{2})[-/,]+(\d)$/;if(o.test(t)){let[U,P,E]=t.match(o).slice(1),[R,C]=P.split("");t=`${U}-${R} ${C}-${E}`,e.push("smashSetPattern")}let l=/^(\d+)[ -](\d+)$/,c=/^([\d -]+)\/([\d -]+)$/;if(c.test(t)){let[U,P]=t.match(c).slice(1),E=U.trim(),R=P.trim();if(l.test(E)&&l.test(R)){let C=E.match(l).slice(1,3).join("-"),M=R.match(l).slice(1,3).join("-");t=`${C} ${M}`,e.push("slashSeparationPattern")}}let u=/^([\d -]+),([\d -]+)$/;if(u.test(t)){let[U,P]=t.match(u).slice(1),E=U.trim(),R=P.trim();if(l.test(E)&&l.test(R)){let C=E.match(l).slice(1,3).join("-"),M=R.match(l).slice(1,3).join("-");t=`${C} ${M}`,e.push("commaSeparationPattern")}}let d=/^\d \d,/;if(d.test(t)){let U=t.match(d)[0],P=U.slice(0,U.length-1).split(" ").join("-");t=t.replace(U,P),e.push("singleSetCommaSeparationPattern")}let p=0,h=/(\d+)-(\d{2})-(\d+)/;for(;h.test(t)&&p<3;){let[U,P,E]=t.match(h).slice(1),R=P.split(""),C=`${U}-${R[0]} ${R[1]}-${E}`;t=t.replace(h,C),e.push("noSetSeparationPattern"),p+=1}let f=/(^|\s)7-6\s(\d+)\s/g,m=t.match(f);if(m!=null&&m.length){let U=/(^|\s)7-6\s(\d+)\s/;m.forEach(P=>{let E=P.match(U).slice(2)[0];t=t.replace(P,`7-6(${E}) `),e.push("floatingTiebreakPattern1")})}let g=t.match(/\d \d /);g==null||g.forEach(U=>{let P=U.slice(0,U.length-1).split(" ").join("-");t=t.replace(U,P),e.push("spaceSeparatedSetPattern1")}),g=t.match(/ \d \d$/),g==null||g.forEach(U=>{let P=" "+U.slice(1).split(" ").join("-");t=t.replace(U,P),e.push("spaceSeparatedSetPattern2")});let v=/^\d, *\d\/\d, *\d/;if(v.test(t)){let U=t.match(v)[0],P=U.split("/").map(E=>`(${E})`).join(" ")+" ";t=t.replace(U,P),e.push("slashCommaSetPattern")}let y=/\(6-\)/g;y.test(t)&&(t=t.replace(y,"(6-0)"),e.push("missingZeroPattern2"));let b=new RegExp("(?<!-)(\\d+)\\/(\\d+)(?!-)","g");if(b.test(t)){let U=t.match(b),P=new RegExp("(?<!-)(\\d+)\\/(\\d+)(?!-)"),E=t;U.forEach(R=>{let[C,M]=R.match(P).slice(1),_=`${C}-${M}`;E=E.replace(R,_)}),t=E,e.push("slashSetPattern")}let I=/(.*)\s(1\d)\s(\d+)$/;if(I.test(t)){let[U,P,E]=t.match(I).slice(1);U.replace(/\D/g,"").length>=4&&(t=U+` ${P}${E}`,e.push("spaceSeparatedSuperPattern"))}let T=/(^|\s)(\d+-\d+)\s(\d+)(\s|$)/g;for(let U of t.match(T)||[]){let[P,E,R,C]=U.match(/(^|\s)(\d+-\d+)\s(\d+)(\s|$)/).slice(1),[M,_]=E.split("-").map(A=>parseInt(A));Math.abs(M-_)===1&&(t=t.replace(U,`${P}${E}(${R})${C}`),e.push("spaceSeparatedSetPattern"))}let w=/\d-\d \(\d{1,2}\)(\s|$|,)/g;for(let U of t.match(w)||[]){let P=/(\d-\d) \((\d{1,2})\)(\s|$|,)/,[E,R,C]=U.match(P).slice(1),[M,_]=E.split("-").map(A=>parseInt(A));Math.abs(M-_)===1&&(t=t.replace(U,`${E}(${R})${C}`),e.push("floatingTiebreakPattern2"))}let S=/(^|\s)(\d \d)\(/g;for(let U of t.match(S)||[]){let P=/(^|\s)(\d \d)\(/,[E,R]=U.match(P).slice(1);t=t.replace(U,`${E}${R.split(" ").join("-")}(`),e.push("spacedTiebreakPattern")}return{score:t,applied:e}}function fOe({score:t,matchUpStatus:e}){var o;let i=t==null?void 0:t.split(" ");t=i.map(l=>{if(l.endsWith("]")){let c=l.split("[");if(WS(c[0]))return c[0]+`(${c[1].slice(0,c[1].length-1)})`}return l}).join(" ");let n=new RegExp(/(\([\d ]+\))/g);if(n.test(t))for(let l of t.match(n)){let c=(o=l.replace(" ","-").match(/\((.*)\)/))==null?void 0:o[1];if(Dr(c)&&(c==null?void 0:c[0])>2){if([2,4].includes(c.length))c=c.split("").join("-");else if(c.length===3){let u=c.indexOf("1");c=n_(c.split(""),u)}}t=t.replace(l,`(${c})`)}i=t==null?void 0:t.split(" ");let r=new RegExp(/^(\d[-/]+\d)\((\d+)[-/]+(\d+)\)$/),a=i.length-1;t=i.map((l,c)=>{let u=[void 0,"","COMPLETED"].includes(e)||c!==a;if(r.test(l)&&u){let[d,p,h]=Array.from(l.match(r)).slice(1),f=Math.min(p,h);return`${d}(${f})`}return l}).join(" "),i=t==null?void 0:t.split(" "),r=new RegExp(/^(\d{2})\((\d+)\)$/),t=i.map(l=>{if(r.test(l)){let[c,u]=Array.from(l.match(r)).slice(1),d=c.split("");return`${d[0]}-${d[1]}(${u})`}return l}).join(" "),i=t==null?void 0:t.split(" "),r=new RegExp(/^\((\d[-/]+\d)\)(\d+)$/),t=i.map(l=>{if(r.test(l)){let[c,u]=Array.from(l.match(r)).slice(1);return WS(c)?`${c}(${u})`:c}return l}).join(" "),i=t==null?void 0:t.split(" "),r=new RegExp(/^1-0\((\d+)\)$/),t=i.map(l=>{if(r.test(l)){let[c]=l.match(r).slice(1);return`[${c<9?10:parseInt(c)+2}-${c}]`}return l}).join(" ");let s=/\((\d)+0 /;if(s.test(t)){let l=t.match(s)[1];t=t.replace(s,`(${l}) `)}return{score:t}}function mOe({score:t,attributes:e,identifier:i}){var u,d,p;if(typeof t!="string")return{score:t,identifier:i};let n=new RegExp(/\([\d,/ ]+\)/g),r=t.match(n);for(let h of r||[]){let f=(d=(u=h.match(/^\((.*)\)$/))==null?void 0:u.slice(1))==null?void 0:d[0],m=t.split(h)[0].split(")").reverse()[0].replace(/\D/g,"");if((f==null?void 0:f.length)===2&&(m==null?void 0:m.length)>=2){let y=m.slice(m.length-2).split("").map(b=>parseInt(b));if(Math.abs(y[0]-y[1])===1)continue}let g=gZ(f),v=IO(g);t=t.replace(h,`(${v})`).trim()}let a=new RegExp(/\[[\d,/ ]+\]/g);(p=t.match(a))==null||p.forEach(h=>{let f=gZ(h.match(/^\[(.*)\]$/)[1]);t=t.replace(h,`(${f}) `).trim()});let s=[")","]"],o=[")(","), (",") (",")[",") [","](","] ("];if(t.startsWith("(")&&s.some(h=>t.endsWith(h))&&o.some(h=>t.includes(h))){let h="",f=t.split(/[)\]]/).filter(Boolean).map(b=>(b.startsWith(",")&&(b=b.slice(1)),b.trim())),m=f.every(b=>b.includes(",")||qN(b)),g=f.every(b=>b.includes("/")||qN(b)),v=f.every(b=>b.includes("-")||qN(b)),y=m&&","||v&&"-"||g&&"/";if(y){let b;f.forEach(I=>{if(I.startsWith("("))if(b==="set"&&(h+=" "),I.includes(y))h+=I.slice(1).split(y).map(T=>T.trim()).join("-"),b="set";else{let T=I.slice(1);h+=`(${T}) `,b="tiebreak"}else if(I.startsWith("[")){let T=I.slice(1).split(y).map(S=>parseInt(S.trim())),w=Math.min(...T);b==="set"?h+=`(${w}) `:h+=`[${T.join("-")}] `,b="tiebreak"}}),t=h.trim()}}let l=Ml(t.split(""));l["("]===1&&l[")"]===1&&t.startsWith("(")&&t.endsWith(")")&&(t=t.slice(1,t.length-1),l["-"]===1&&WS(t)&&Dr(e==null?void 0:e.removed)&&(t=t+`(${e.removed})`,e.removed=void 0));let c=/\(\)/g;return c.test(t)&&(t=t.replace(c,"").trim()),{score:t}}function Mue({score:t}){let e=t.split(""),i=[],n,r=()=>n=[void 0,void 0,void 0],a=()=>{let o=`${n[0]}-${n[1]}`;return n[2]&&(o+=` (${n[2]})`),r(),n.push(n),o};r();let s=()=>n[0]!==void 0&&n[1]!==void 0&&Math.abs(parseInt(n[0])-parseInt(n[1]));for(;e.length;){let o=e.shift(),l=Dr(o)&&parseInt(o),c=n[0]!==void 0&&n[1]!==void 0;if(Dr(l)){if(n[0]===void 0){n[0]=l;continue}if(n[1]===void 0&&(n[1]=l,s())){i.push(a()),n=[void 0,void 0];continue}if(c&&e.length===1&&Dr(e[0])){let u=e.pop();n[0]=n[0].toString()+n[1].toString(),n[1]=u,i.push(a()),n=[void 0,void 0]}c&&s()}}return{sets:i}}function aj(t){let e=t.indexOf("1"),i=t.split(""),n=i.every(r=>!isNaN(r));if(n&&t.length===3&&e===0){let r=n_(i,e);if(r)return r}if(n&&t.length===7&&e>3){let r=i.slice(4),a=n_(r,e-4);if(a)return`${i[0]}-${i[1]} ${i[2]}-${i[3]} ${a}`}}function Nue(t){let{score:e}=t,{applied:i,matchUpStatus:n}=t,r=e==null?void 0:e.toString().split(""),a=r==null?void 0:r.every(o=>Dr(o)),s=o=>Math.abs(o[0]-o[1]);if(typeof e=="number"||a){e=e.toString().toLowerCase(),a&&(e=r.join(""));let o=a?r.map(l=>parseInt(l)):e.split("").map(l=>parseInt(l));if(Mue({score:e}),o.length,e.length===3&&s(o.slice(0,2))===1){let[l,c,u]=o;e=`${l}-${c}(${u})`,i.push("numericTiebreakPattern1")}else if(e.length===3&&o[0]===1){let[l,c,u]=o;e=`[${l}${c}-${u}]`,i.push("numericTiebreakPattern2")}else if(e.length===4&&s(o.slice(0,2))===1&&"987654".split("").includes(o[0].toString())){let[l,c,u,d]=o,p=Math.min(u,d);e=`${l}-${c}(${p})`,i.push("numericTiebreakPattern3")}else if(e.length===4&&o[0]===1&&o[2]===1){let[l,c,u,d]=o;e=`[${l}${c}-${u}${d}]`,i.push("bigSuper")}else if(e.length===4){let[l,c,u,d]=o;e=`${l}${c} ${u}${d}`,i.push("split4")}else if(e.length===5&&s(o.slice(0,2))===1){let[l,c,u,d,p]=o;e=`${l}-${c}(${u}) ${d}-${p}`,i.push("numericTiebreakPattern4")}else if(e.length===5&&s(o.slice(3))===1){let[l,c,u,d,p]=o;e=`${l}-${c} ${u}-${d}(${p})`,i.push("numericTiebreakPattern5")}else if(o.length===7)if(s(o.slice(0,2))>1&&s(o.slice(2,4))>1&&o[4]===1){let[l,c,u,d,p,h,f]=o;e=`${l}-${c} ${u}-${d} [${p}${h}-${f}]`,i.push("numericTiebreakPattern6")}else if(s(o.slice(0,2))===1&&s(o.slice(3,5))>1&&s(o.slice(5,7))>1){let[l,c,u,d,p,h,f]=o;e=`${l}-${c}(${u}) ${d}-${p} ${h}-${f}`,i.push("numericTiebreakPattern7")}else if(s(o.slice(0,2))>1&&s(o.slice(2,4))===1&&s(o.slice(5,7))>1){let[l,c,u,d,p,h,f]=o;e=`${l}-${c} ${u}-${d}(${p}) ${h}-${f}`,i.push("numericTiebreakPattern8")}else if(s(o.slice(0,2))>1&&s(o.slice(2,4))>1&&s(o.slice(4,6))===1){let[l,c,u,d,p,h,f]=o;e=`${l}-${c} ${u}-${d} ${p}-${h}(${f})`,i.push("numericTiebreakPattern9")}else e=e.slice(0,2)+" "+e.slice(2,4)+" "+e.slice(4),i.push("numericMatchTiebreakPattern");else if(e.length%2){let l=aj(e);l&&e!==l&&i.push("parsedSuperPattern"),e=l??e}else{let l=Ra(e.split(""),2).map(g=>g.join("")),c=l.map(g=>{let[v,y]=g.split("").map(T=>parseInt(T)),b=Math.abs(v-y),I=v>y?1:2;return b>1&&I||I*-1}),u=c.reduce((g,v)=>g>0&&v>0,1),d=Ml(c),p=c.map(g=>Math.abs(g)),h=Ml(p),f=c[0]<0,m=!f&&c[1]<0;if(c[0]>0&&c[1]>0&&c[0]!==c[1])e=[l.slice(0,2).join(" "),l.slice(2).join("-")].join(" "),i.push("numeric3rdSetTiebreakPattern");else if(u)e=l.join(" "),i.push("chunkSplit");else if(o.length===6){if(d[1]===2||d[2]===2)if(!Object.values(h).includes(3))e=l.join(" "),i.push("chunkSplit");else{let[g,v,y,b,I,T]=o,w=c.reduce((S,U,P)=>U<0?P:S,void 0);if(w===0){let S=Math.min(y,b);e=`${g}-${v}(${S}) ${I}-${T}`,i.push("chunkSplitTiebreak1")}else if(w===1){let S=Math.min(I,T);e=`${g}-${v} ${y}-${b}(${S})`,i.push("chunkSplitTiebreak2")}else e=`${g}-${v} ${y}-${b}`,i.push("chunkSplitTrimExtraneous")}}else if(o.length===8){let[g,v,y,b,I,T,w,S]=o;f||m?o[5]===1&&(f?e=`${g}-${v}(${y}) ${b}-${I} [${T}${w}-${S}]`:e=`${g}-${v} ${y}-${b}(${I}) [${T}${w}-${S}]`):(c[0],c[1])}}}return{score:e,applied:i,matchUpStatus:n}}function Aue(t){let e=[0,0],i=[],n=t.split(" "),r=/(\d+)-(\d+)/;n.forEach(l=>{if(r.test(l)){let c=l.match(r).slice(1).map(d=>parseInt(d)),u=c[0]>c[1]&&1||c[1]>c[0]&&2;u&&(e[u-1]+=1,i.push(u))}});let a=e[0]>e[1]&&1||e[1]>e[0]&&2,s=e[0]>0&&e[0]===e[1],o=e.reduce((l,c)=>l+c,0);return{setsWon:e,setsTied:s,setWinners:i,totalSets:o,winningSide:a}}function gOe({score:t,matchUpStatus:e,attributes:i}){let n=[],r,a=t.split(" "),s=a.length;t=a.map((u,d)=>{if(new RegExp(gE).test(u)){let h=u.slice(3),f=u.slice(0,3),m=f.split("-");if(!WS(f)&&!e){let g=Math.max(...m),v=f.indexOf(g),y=[g,g-1];return v&&y.reverse(),y.join("-")+h}}else if(u.length===2&&Dr(u))return u.split("").join("-");u=IO(u);let p=new RegExp(`^${aW}$`).test(u)&&"super"||new RegExp(`^${gE}$`).test(u)&&"tiebreak"||new RegExp(`^${bO}$`).test(u)&&"standard"||"unknown";if(n.push(p),s>1&&p==="standard"&&d<2){let[h,f]=u.split("-"),m=Math.abs(parseInt(h)-parseInt(f)),g=Math.max(h,f),v=Math.min(h,f),y=[parseInt(h),parseInt(f)].indexOf(v);if(g>9&&m>2){let b=g.toString().split(""),I=b.find(T=>parseInt(T)>v||d&&parseInt(T)<=r)??b[0];I&&(u=y?[I,v].join("-"):[v,I].join("-"))}g>(r||0)&&(r=g)}if(p==="standard"){let[h,f]=u.split("-");if(!Math.abs(parseInt(h)-parseInt(f))&&e!=="RETIRED")return""}return u}).filter(Boolean).join(" ");let{setsWon:o,setWinners:l,totalSets:c}=Aue(t);if(c===1&&(i==null?void 0:i.removed)==="6"&&(t+=" 6-0"),t.split(" ").length>2&&Math.max(...o)>=2&&l[0]===l[1]&&(t=t.split(" ").slice(0,2).join(" ")),Math.max(...o)>2){let u=[0,0];t=t.split(" ").map((d,p)=>(u[l[p]]+=1,Math.max(...u)>2?void 0:d)).filter(Boolean).join(" ")}return{score:t,profile:n}}function vOe({score:t}){let{setsTied:e,winningSide:i}=Aue(t),n=/\s\((\d+)\)$/;if(!i&&e&&n.test(t)){let o=t.match(n).slice(1)[0],l=o<=8?10:o+2;t=t.replace(n,` [${l}-${o}]`)}let r=t.split(" "),a=r[r.length-1];if(!a.includes("-")||a.indexOf("(")>0)return{score:t};let s=a.split("(").join("").split(")").join("").split("-");if(!s.every(o=>Dr(o)))return{score:t};if(s[0]==="76"){let o=s[1].length===2?Math.min(...s[1].split("").map(l=>parseInt(l))):s[1];t=[...r.slice(0,r.length-1),`7-6(${o})`].join(" ")}else{s=s.map(c=>parseInt(c));let o=Math.max(...s),l=Math.abs(s[0]-s[1]);if(o>=10){if(l>2&&s.every(c=>+c>=10)){let c=s.map(u=>u===o?u-10:10).sort();l=Math.abs(c[0]-c[1]),l>2&&(s=c)}t=[...r.slice(0,r.length-1),`[${s.join("-")}]`].join(" ")}else r.length===3&&o>=7&&l>2&&(t=[...r.slice(0,r.length-1),`[${s.join("-")}]`].join(" "))}return{score:t}}function yOe({score:t}){return t=(t==null?void 0:t.toString().toLowerCase())||"",{score:t}}function bOe({score:t,applied:e}){return typeof t!="string"?{score:t}:(t.toLowerCase().includes("o")&&(t=t.toLowerCase().split(" ").map(i=>i.split("o").join("0")).join(" "),e.push("replaceOh")),{score:t,applied:e})}function IOe({score:t,applied:e}){return typeof t!="string"?{score:t}:(t=t.toLowerCase().split(" ").map(i=>{if(/^\d+$/.test(i)&&i.length>2){let n=i.indexOf("1");if(i.length%2){if(i.length===3&&n===0){let r=n_(i.split(""),n);return e.push("getSuper"),r}}else{let{score:r,applied:a}=Nue({score:i,applied:[]});r!==i&&(i=r,e.push(...a))}}return i}).join(" "),{score:t,applied:e})}function wOe({score:t,applied:e}){return typeof t!="string"?{score:t}:[3,4].includes(t.length)&&aj(t)?{score:aj(t)}:(t=t.toLowerCase().split(" ").map(i=>{if(/^\d+$/.test(i)&&i.length===1){e.push("removeErroneous1");return}return i}).filter(Boolean).join(" "),{score:t,applied:e})}function SOe({score:t,applied:e}){return["walkover","wo","w/o","w-o"].includes(t==null?void 0:t.toString().toLowerCase())?(e.push("handleWalkover"),{matchUpStatus:"walkover",score:"",applied:e}):{score:t}}function TOe({score:t,profile:e,applied:i}){var s;t=t==null?void 0:t.toString().toLowerCase();let n=/^(.*\d+.*)(ret|con)+[A-Za-z ]*$/;if(n.test(t)){let[o]=t.match(n).slice(1);return i.push("handleRetired"),{score:o.trim(),matchUpStatus:"retired",applied:i}}let r=(s=e==null?void 0:e.matchUpStatuses)==null?void 0:s.retired,a=["rtd",...Array.isArray(r)?r:[r].filter(Boolean)].find(o=>t==null?void 0:t.endsWith(o));return a?(i.push("handleRetired"),{matchUpStatus:"retired",score:t==null?void 0:t.replace(a,"").trim(),applied:i}):{score:t}}function UOe({score:t,attributes:e}){(t.endsWith(" am")||t.endsWith(" pm"))&&(t=""),t=t.replace(/[A-Za-z]+/g,"").trim(),[".",","].some(r=>t.endsWith(r))&&(t=t.slice(0,t.length-1));let i="()/-".split("").some(r=>t.includes(r));/ \d$/.test(t)&&i&&(e={removed:t.slice(t.length-2).trim()},t=t.slice(0,t.length-2));let n=/(.*)[A-Za-z]+$/;return n.test(t)&&(t=t.match(n).slice(1)[0].trim()),{score:t,attributes:e}}function DOe({score:t}){return new RegExp(/-\d+\/\d+-/).test(t)&&(t=t.split("/").join(" ")),{score:t}}function EOe({score:t}){let e=new RegExp(/^\d+\/\d+/),i=t.split(" ");i.some(r=>e.test(r))&&(t=i.map(r=>e.test(r)?r.replace("/","-"):r).join(" "));let n=/^(\d+), *(\d+)$/;if(n.test(t)){let[r,a]=t.match(n).slice(1);t=[r,a].join("-")}return{score:t}}function POe({score:t}){let e=new RegExp(/\(\d+\/\d+\)/g),i=t.match(e);for(let n of i||[]){let r=n.replace("/","-");t=t.replace(n,r)}return{score:t}}function COe({score:t}){if(t.includes(",")){let e=t.split(",").map(n=>n.trim()),i=n=>/\d \d/.test(n);e.every(i)&&(t=e.map(n=>{let r=/\d+ \d+/g;for(let a of n.match(r)){let[s,o]=a.match(/(\d+) (\d+)/).slice(1);n=n.replace(a,`${s}-${o}`)}return n}).join(" "))}if(t.includes(" ")){let e=t.replace(/[ ,]/g,"");e.split("").every(i=>Dr(i))&&e.length===4&&(t=e)}return{score:t}}function ROe({score:t}){let e=new RegExp(/^\[\d+\](.*)$/);e.test(t)&&(t=t.match(e).slice(1)[0].trim());let i=/\(,/g;return i.test(t)&&(t=t.replace(i,"(")),{score:t}}var MOe={handleTiebreakSlashSeparation:POe,handleSetSlashSeparation:DOe,punctuationAdjustments:uOe,handleGameSeparation:EOe,joinFloatingTiebreak:pOe,handleBracketSpacing:dOe,handleSpaceSeparator:COe,separateScoreBlocks:IOe,matchKnownPatterns:hOe,removeDanglingBits:UOe,removeErroneous:wOe,handleWalkover:SOe,properTiebreak:fOe,handleNumeric:Nue,handleRetired:TOe,containedSets:mOe,sensibleSets:gOe,stringScore:yOe,superSquare:vOe,setBuilder:Mue,excisions:ROe,replaceOh:bOe},w$={},NOe=["handleNumeric","handleWalkover","handleRetired","replaceOh","stringScore","punctuationAdjustments","excisions","handleSpaceSeparator","matchKnownPatterns","removeDanglingBits","handleBracketSpacing","matchKnownPatterns","containedSets","separateScoreBlocks","handleGameSeparation","removeErroneous","joinFloatingTiebreak","handleSetSlashSeparation","handleTiebreakSlashSeparation","properTiebreak","sensibleSets","superSquare"],AOe=["handleNumeric","separateScoreBlocks","sensibleSets","superSquare"];function _ue(t){if(!t.score)return{error:Re};let{score:e,sheetName:i,identifier:n,fileName:r,stepLog:a,fullLog:s,profile:o}=t,l=[],c,u=[],d,p,h=e,f=g=>{g.forEach(v=>{p=MOe[v]({profile:o,identifier:n,matchUpStatus:c,attributes:d,applied:u,score:h});let y=p.score!==h;y&&l.push({method:v,score:p.score}),a&&(s||y||p.matchUpStatus!==c)&&console.log(c?{score:p.score,matchUpStatus:c}:{score:p.score},v),p.matchUpStatus&&(c=p.matchUpStatus),p.attributes&&(d=p.attributes),p.applied&&(u=p.applied),h=p.score})};f(NOe);let m=mZ(h);return m||(h=e.toString().replace(/\D/g,""),d!=null&&d.removed&&(d.removed=void 0),f(AOe),m=mZ(h),m||(h="")),u.forEach(g=>{w$[g]||(w$[g]=0),w$[g]+=1}),{matchUpStatus:c==null?void 0:c.toUpperCase(),modifications:l,attributes:d,isValid:m,score:h}}var kue={};Li(kue,{analyzeScore:()=>sW,analyzeSet:()=>vE,checkScoreHasValue:()=>ga,checkSetIsComplete:()=>vO,getSetComplement:()=>lW,getTiebreakComplement:()=>wO,isValidMatchUpFormat:()=>Nl,parseScoreString:()=>r_,validateScore:()=>oW,validateTieFormat:()=>Bo});function sW({existingMatchUpStatus:t,matchUpFormat:e,matchUpStatus:i,winningSide:n,score:r}){var T,w;let a=(r==null?void 0:r.sets)??[],s=((a==null?void 0:a.filter(S=>S==null?void 0:S.winningSide))||[]).reduce((S,U)=>{let{winningSide:P}=U;if(!P)return S;let E=P-1;return S[E]++,S},[0,0]),o=n?n-1:void 0,l=o!==void 0?1-o:void 0,c=o!==void 0&&s[o],u=l!==void 0&&s[l],d=e?wo(e):void 0,p=Math.max(...s),h=Ml(s)[p],f=((T=d==null?void 0:d.setFormat)==null?void 0:T.timed)||((w=d==null?void 0:d.finalSetFormat)==null?void 0:w.timed),m=d==null?void 0:d.bestOf,g=m&&Math.ceil(m/2)||1,v=i??t,y=v&&[Yi,as,cn].includes(v),b=!d||!a.length||a.every((S,U)=>{let P=U+1,E=P===m,R=P===a.length,{side1Score:C,side2Score:M,side1TiebreakScore:_,side2TiebreakScore:A,winningSide:N}=S,k=Math.max(C??0,M??0),O=_??A,{finalSetFormat:$,setFormat:F}=d,V=E&&$||F;if(O){let{tiebreakTo:j,NoAD:B}=(V==null?void 0:V.tiebreakFormat)||{},z=Math.max(_??0,A??0);if(B&&z>j||z<j&&N&&(R&&!y||!R))return!1}return V.setTo?!(!V.noTiebreak&&k>V.setTo+1):!0}),I=(!e||p===g)&&h===1&&s.indexOf(p)+1||void 0;return{valid:!!(b&&(n&&c>u&&n===I||n&&y||!n&&!I&&(![Lr,Yi,as,cn].includes(v)||f&&v===Lr)))}}function oW({existingMatchUpStatus:t,matchUpFormat:e,matchUpStatus:i,winningSide:n,score:r}){if(typeof r!="object")return{error:Re};let{sets:a,scoreStringSide1:s,scoreStringSide2:o}=r,l="scoreString must be a string!";if(s!==void 0&&typeof s!="string")return{error:Re,info:l};if(o!==void 0&&typeof o!="string")return{error:Re,info:l};if(a!==void 0&&!Array.isArray(a))return{error:Re,info:sy("sets")};if(a!=null&&a.length){let c=a.map(d=>d==null?void 0:d.setNumber).filter(Boolean);if(c.length!==Ei(c).length)return{error:Re,info:"setNumbers not unique"};for(let d of a){let{side1Score:p,side2Score:h,side1TiebreakScore:f,side2TiebreakScore:m,side1PointScore:g,side2PointScore:v,winningSide:y,setNumber:b}=d;if(![[p,h],[f,m],[g,v]].filter(I=>I.some(T=>![void 0,null].includes(T))).every(I=>I.every(T=>Ii(T))))return{error:Re,info:"non-numeric values"};if(![b,y].filter(I=>![void 0,null].includes(I)).every(I=>Ii(I)))return{error:Re,info:"non-numeric values"};if(y&&![1,2].includes(y))return{error:Re,info:"winningSide must be 1 or 2"}}let{valid:u}=sW({existingMatchUpStatus:t,matchUpStatus:i,matchUpFormat:e,winningSide:n,score:r});if(!u)return{error:Jre,info:"score is invalid for matchUpFormat or winningSide does not match calculated winningSide"}}return{valid:!0}}var lW=t=>{let{isSide1:e,lowValue:i,setTo:n,tiebreakAt:r,NoAD:a}=t;if(i===void 0)return!1;let s=ui(i);(s==null?void 0:s.toString().length)>2&&(s=parseInt(s.toString().slice(0,2))),r&&r<n&&s>r&&(s=r);let o;return a&&!r?(s>n&&(o=n),o=s<n?n:n-1):o=s+1<n&&n||r&&r<n&&s===r&&n||!r&&s+2||n+1,[e?s:o,e?o:s]},wO=t=>{let{isSide1:e,lowValue:i,tiebreakTo:n,tiebreakNoAd:r}=t;if(i===void 0)return!1;let a=typeof i=="string"?parseInt(i):i;(a==null?void 0:a.toString().length)>2&&(a=parseInt(a.toString().slice(0,2))),r&&a>n-1&&(a=n-1);let s=_Oe({lowValue:a,NoAD:r,tiebreakTo:n});return[e?a:s,e?s:a]};function _Oe(t){let{lowValue:e,NoAD:i,tiebreakTo:n}=t,r=i?1:2;return e+1>=n?e+r:n}function r_({tiebreakTo:t=7,scoreString:e=""}){return e==null?void 0:e.split(" ").filter(Boolean).map((n,r)=>i({set:n,setNumber:r+1}));function i({set:n,setNumber:r}){let a=/\(([^)]+)\)/,s=/\[([^)]+)\]/,o=a.exec(n),l=s.exec(n),c=(n==null?void 0:n.startsWith("["))&&l&&l[1].split("-").map(b=>parseInt(b)),u=o&&n.replace(o[0],"")||l&&n.replace(l[0],"")||n,d=!c&&u.split("-").map(b=>parseInt(b)),p=c?c[0]>c[1]&&1||c[0]<c[1]&&2||void 0:d[0]>d[1]&&1||d[0]<d[1]&&2||void 0,h=o?o[1]:void 0,f=(h&&wO({lowValue:h,isSide1:p===2,tiebreakTo:t}))??[],[m,g]=d||[],[v,y]=c||f||[];return{side1Score:m,side2Score:g,side1TiebreakScore:v,side2TiebreakScore:y,winningSide:p,setNumber:r}}}function kOe({matchUpScoringFormat:t,isDecidingSet:e,isTiebreakSet:i,isTimedSet:n,setObject:r}){if(!r)return;let a=yO({set:r});return vO({matchUpScoringFormat:t,set:r,isDecidingSet:e,isTiebreakSet:i,isTimedSet:n})&&a||void 0}function vE(t){let{setObject:e,matchUpScoringFormat:i}=t;if(!e)return{error:nx};let{setNumber:n}=e||{},{bestOf:r,exactly:a}=i||{},s=r||a,o=!!(n&&s&&n===s),l=o&&(i==null?void 0:i.finalSetFormat)||(i==null?void 0:i.setFormat),c=!!(l!=null&&l.tiebreakSet),u=!!(l!=null&&l.timed),d=!c&&!u,p=!!(n&&s&&n<=s),h=[e==null?void 0:e.side1Score,e==null?void 0:e.side2Score],f=[e==null?void 0:e.side1PointScore,e==null?void 0:e.side2PointScore],m=[e==null?void 0:e.side1TiebreakScore,e==null?void 0:e.side2TiebreakScore],g=h.filter(O=>O!==void 0).length,v=f.filter(O=>O!==void 0).length,y=m.filter(O=>O!==void 0).length,b=h==null?void 0:h.filter(O=>!isNaN(O)).length,I=m==null?void 0:m.filter(O=>!isNaN(O)).length,{tiebreakAt:T}=l||{},w=T&&h.filter(O=>O>=T).length===2,S=w&&(h[0]>h[1]&&1||h[1]>h[0]&&2||void 0),U=!!(I&&!b),P=!!(e!=null&&e.winningSide),{error:E,result:R}=xOe({sideTiebreakScores:m,sideGameScores:h,setFormat:l,setObject:e}),{error:C,result:M}=OOe({sideTiebreakScores:m,setObject:e,setFormat:l}),_=d&&!U&&R||c&&U&&M||u,A=p&&!(c&&!U)&&!(d&&U)&&(!P||_),N=kOe({isTimedSet:u,matchUpScoringFormat:i,isDecidingSet:o,isTiebreakSet:U,setObject:e}),k={expectTiebreakSet:c,expectTimedSet:u,hasTiebreakCondition:w,isCompletedSet:P,isDecidingSet:o,isTiebreakSet:U,isValidSet:A,isValidSetNumber:p,isValidSetOutcome:_,leadingSide:S,setFormat:l,sideGameScores:h,sideGameScoresCount:g,sidePointScores:f,sidePointScoresCount:v,sideTiebreakScores:m,sideTiebreakScoresCount:y,winningSide:N};return(e==null?void 0:e.winningSide)!==void 0&&(U?(k.isValidTiebreakSetOutcome=M,M||(k.tiebreakSetError=C)):(k.isValidStandardSetOutcome=R,R||(k.standardSetError=E))),k}function xOe({setObject:t,setFormat:e,sideGameScores:i,sideTiebreakScores:n}){if(!t)return{result:!1,error:nx};let r=!!(e!=null&&e.tiebreakSet),a=!!(e!=null&&e.timed);if(!e||r||a)return{result:!1,error:Re};if((i==null?void 0:i.filter(S=>!isNaN(S)).length)!==2)return{result:!1,error:UV};let{setTo:s,tiebreakAt:o,tiebreakFormat:l,NoAD:c}=e||{};if(!(s&&(i!=null&&i.find(S=>S>=s))))return{result:!1,error:UV};let u=[1,2].includes(t==null?void 0:t.winningSide);if(!t||!u)return{result:!1,error:rx};let d=(t==null?void 0:t.winningSide)-1,p=1-d,h=i[d],f=i[p],m=h-f;if(!(h>f))return{result:!1,error:{message:"winningSide game scoreString is not high"}};let g=o&&l,v=(n==null?void 0:n.filter(S=>!isNaN(S)).length)===2,y=n==null?void 0:n[d],b=n==null?void 0:n[p],I=o&&i.filter(S=>S>=o).length===2;if(g){let{NoAD:S,tiebreakTo:U}=l;if(I){if(m>1)return{result:!1,error:{message:"invalid winning game scoreString (5)"}};if(!v)return{result:!1,error:{message:"invalid tiebreak scores (1)"}};if(isNaN(U))return{result:!1,error:{message:"tiebreakTo error"}};if(!(U&&(n!=null&&n.find(M=>M>=U))))return{result:!1,error:{message:"invalid tiebreak scores (2)"}};let P=o<s?s:s+1;if(h>P)return{result:!1,error:{message:"invalid winning game scoreString (1)"}};if(!y||!b||y<b)return{result:!1,error:{message:"winningSide tiebreak value is not high"}};let E=S?1:2,R=y-b,C=b>=U-1;if(R&&C&&R<E)return{result:!1,error:{message:"invalid tiebreak scores (3)"}}}if(h>s&&!I)return{result:!1,error:{message:"invalid winning game scoreString (2)"}}}let T=c?1:2,w=f>=s-1;return m&&w&&!I&&m<T?{result:!1,error:{message:"invalid winning game scoreString (3)"}}:m>T&&h>s?{result:!1,error:{message:"invalid winning game scoreString (4)"}}:{result:!0}}function OOe({setObject:t,setFormat:e,sideTiebreakScores:i}){if(!t)return{result:!1,error:nx};let n=!!(e!=null&&e.tiebreakSet),r=!!(e!=null&&e.timed);if(!e||!n||r)return{result:!1,error:{message:"not tiebreak set"}};let a=[1,2].includes(t==null?void 0:t.winningSide);if(!t||!a)return{result:!1,error:rx};let{tiebreakSet:s}=e||{},{NoAD:o,tiebreakTo:l}=s||{};if((i==null?void 0:i.filter(g=>!isNaN(g)).length)!==2)return{result:!1,error:{message:"invalid tiebreak scores (1)"}};if(isNaN(l))return{result:!1,error:{message:"tiebreakTo error"}};if(!(i!=null&&i.find(g=>g>=l)))return{result:!1,error:{message:"invalid tiebreak scores (2)"}};let c=(t==null?void 0:t.winningSide)-1,u=1-c,d=i[c],p=i[u];if(!d||!p||d<p)return{result:!1,error:{message:"winningSide tiebreak value is not high"}};let h=o?1:2,f=d-p,m=p>=l-1;return f&&m&&f<h?{result:!1,error:{message:"invalid tiebreak scores (3)"}}:{result:!0}}function LOe(t){var d,p,h;let{existingDrawDefinition:e,hydrateCollections:i,enforceGender:n,tieFormatName:r,matchUpType:a,eventType:s,isMock:o,event:l}=t,{tieFormat:c,matchUpFormat:u}=t;if(a===na&&s===na){let f=(p=(d=e==null?void 0:e.structures)==null?void 0:d.find(({stage:m})=>m===Ft))==null?void 0:p.tieFormat;c=c||f||r&&((h=l==null?void 0:l.tieFormat)==null?void 0:h.tieFormatName)===r&&l.tieFormat||r&&Bf({namedFormat:r,hydrateCollections:i,isMock:o,event:l})||(l==null?void 0:l.tieFormat)||Bf({event:l,isMock:o,hydrateCollections:i}),u=void 0}else u||(c=void 0,l!=null&&l.matchUpFormat||(u=Nu));if(c){let f=Bo({gender:l==null?void 0:l.gender,enforceGender:n,tieFormat:c});if(f.error)return f}return{tieFormat:c,matchUpFormat:u}}function FOe(t){var b,I,T,w,S;let e=t.drawDefinition,{existingQualifyingPlaceholderStructureId:i,appliedPolicies:n,drawEntries:r,structureId:a,idPrefix:s,isMock:o,event:l}=t,c=t.qualifyingProfiles,u=c!=null&&c.length?xce({uuids:t.uuids,qualifyingProfiles:c,appliedPolicies:n,idPrefix:s,isMock:o}):void 0;if(u!=null&&u.error)return u;e.structures=(b=e.structures)==null?void 0:b.filter(({structureId:U})=>U!==i),e.links=(I=e.links)==null?void 0:I.filter(({source:U})=>U.structureId!==i);let{qualifiersCount:d,qualifyingDrawPositionsCount:p,qualifyingDetails:h}=u??{};p&&(u!=null&&u.structures&&((T=e.structures)==null||T.push(...u.structures)),u!=null&&u.links&&((w=e.links)==null||w.push(...u.links)));let f=(S=e.structures)==null?void 0:S.find(({stage:U,stageSequence:P})=>U===Ft&&P===1),{qualifiersCount:m}=pU({stageSequence:1,drawDefinition:e,structureId:a,stage:Ft}),g=Math.max(d??0,m??0),v=Ole({qualifiersCount:g,drawDefinition:e,stage:Ft});if(v.error||(v=JA({drawSize:p,stage:ni,drawDefinition:e}),v.error))return v;$Oe({drawDefinition:e,drawEntries:r,event:l});let y=BOe({mainStructure:f,qualifyingDetails:h,drawDefinition:e});return y.error?y:{drawDefinition:e,structureId:a}}function $Oe({drawDefinition:t,drawEntries:e,event:i}){for(let n of(e??[]).filter(({entryStage:r})=>r===ni)){let r={...n,entryStage:n.entryStage??Ft,drawDefinition:t,event:i};s3(r)}}function BOe({mainStructure:t,qualifyingDetails:e,drawDefinition:i}){var n;for(let r of e||[]){let{finalQualifyingRoundNumber:a,finalQualifyingStructureId:s,roundTarget:o,finishingPositions:l,linkType:c}=r,u=t&&((n=gC({targetStructureId:t.structureId,sourceStructureId:s,sourceRoundNumber:a,finishingPositions:l,targetEntryRound:o,linkType:c}))==null?void 0:n.link);if(u!=null&&u.error)return u;u&&(i.links||(i.links=[]),i.links.push(u))}return{error:void 0}}function xue(t){var n,r;let{participantIds:e}=t,i=((r=(n=t.drawDefinition)==null?void 0:n.entries)==null?void 0:r.filter(a=>{let s=a.entryStatus;return!t.restrictEntryStatus||id.includes(s)}).map(Vi))??[];if(e){let a=e.filter(s=>!(i!=null&&i.includes(s)));if(a!=null&&a.length)return he({result:{error:Md},info:{invalidParticipantIds:a}})}else e=i;return t.roundsCount&&t.restrictRoundsCount!==!1&&t.roundsCount>e.length-1&&(!t.enableDoubleRobin||t.roundsCount>(e.length-1)*2)?{error:Re,info:"Not enough participants for roundsCount"}:t.roundsCount&&t.restrictRoundsCount!==!1&&t.roundsCount>31?{error:Re,info:"roundsCount must be less than 32"}:{participantIds:e}}function cW(t){var d;let e=[],{roundsCount:i=1,drawDefinition:n,matchUpsCount:r,structureId:a,idPrefix:s,isMock:o,event:l}=t,c,u=xue(t);if(u.error)return u;for(let p of Rt(1,i+1)){let h=fO({restrictMatchUpsCount:t.restrictMatchUpsCount,ignoreLastRoundNumber:!!c,newRound:!c,drawDefinition:n,matchUpsCount:r,structureId:a,roundNumber:c,idPrefix:s,isMock:o,event:l});if(h.error)return he({result:h,info:{iteration:p}});(d=h.matchUps)!=null&&d.length&&e.push(...h.matchUps),c=((h==null?void 0:h.roundNumber)??1)+1}return{matchUps:e}}function VOe(t){var l;let{tournamentRecord:e,participantIds:i,scaleName:n,eventType:r,adHocRatings:a={}}=t,s=t.scaleAccessor??((l=Da[n])==null?void 0:l.accessor),o=e.participants??[];for(let c of i??[]){let u=o==null?void 0:o.find(p=>p.participantId===c),d=vZ({scaleName:`${n}.${pq}`,participant:u,eventType:r});!d&&n&&(d=vZ({scaleAccessor:s,participant:u,scaleName:n,eventType:r})),d&&!a[c]&&(a[c]=d)}return a}function vZ({scaleType:t=tg,scaleAccessor:e,participant:i,scaleName:n,eventType:r}){var s,o;let a=(o=(s=i&&Th({scaleAttributes:{eventType:r??oI,scaleType:t,scaleName:n},participant:i}))==null?void 0:s.scaleItem)==null?void 0:o.scaleValue;return e&&Xi(a)?a[e]:a}function uW(t){var u,d;let e=GOe(t);if(e!=null&&e.error)return e;let i=xue(t);if(i.error)return i;let n=jOe(t);if(n.error)return n;let r=VOe(t),a=((u=t.tournamentRecord)==null?void 0:u.isMock)??t.isMock,s=t.eventType??((d=t.event)==null?void 0:d.eventType),o=[],l=[],c;for(let p of Rt(1,(t.roundsCount??1)+1)){let h=Q3({...t,participantIds:i.participantIds,structure:n.structure,ignoreLastRoundNumber:!0,iterationMatchUps:o,adHocRatings:r,roundNumber:c,eventType:s,isMock:a});if(h.error)return h;let{matchUps:f,...m}=h;m.modifiedScaleValues&&(r=m.modifiedScaleValues),l.push({...m,iteration:p,matchUpsCount:f==null?void 0:f.length}),c=((m==null?void 0:m.roundNumber)??1)+1,f!=null&&f.length&&o.push(...f)}return{...de,matchUps:o,roundResults:l}}function jOe(t){var r,a,s;if(t.structureId)return t.structureId;let e=t.drawDefinition,i=(a=(r=e==null?void 0:e.structures)==null?void 0:r.filter(o=>o.stageSequence===1))==null?void 0:a.reduce((o,l)=>{let c=l.stage&&lI[l.stage];return Vo({structure:l})&&c>(lI[o==null?void 0:o.stage]||1)?l:o},void 0),n=(s=e==null?void 0:e.structures)==null?void 0:s.find(o=>o.structureId===(i==null?void 0:i.structureId));return n?Vo({structure:n})?{structure:n}:{error:kb}:{error:gr}}function GOe(t){var e;return t.roundsCount&&typeof t.roundsCount!="number"?{error:Re,info:"roundsCount must be a number"}:typeof t.drawDefinition!="object"||t.drawDefinition.drawType&&t.drawDefinition.drawType!==nc?{error:kb}:!Array.isArray((e=t.drawDefinition)==null?void 0:e.entries)&&t.participantIds&&!Array.isArray(t.participantIds)?{error:Re,info:"Missing Entries"}:{error:void 0}}function HOe(t){var u,d;let{tournamentRecord:e,drawDefinition:i,structureId:n,idPrefix:r,isMock:a,event:s}=t,o=(u=s==null?void 0:s.entries)==null?void 0:u.filter(({entryStage:p,entryStatus:h})=>(!p||p===Ft)&&h&&id.includes(h)),l=o==null?void 0:o.map(Vi),c=o?Math.floor(o.length/2):0;if(t.automated)return zOe({...t,participantIds:l});{let p=cW({roundsCount:t.roundsCount,drawDefinition:i,matchUpsCount:c,idPrefix:r,isMock:a,event:s});if(p.error)return p;(d=p.matchUps)!=null&&d.length&&uO({matchUps:p.matchUps,suppressNotifications:!0,tournamentRecord:e,drawDefinition:i,structureId:n,event:s})}return{...de}}function zOe(t){var l,c;let{restrictEntryStatus:e,generateMatchUps:i,structureId:n,matchUpIds:r,scaleName:a,scaleAccessor:s}=t.drawMatic??{},o=uW({...t,eventType:((l=t.drawMatic)==null?void 0:l.eventType)??t.matchUpType,generateMatchUps:i??!0,scaleAccessor:s??t.scaleAccessor,scaleName:a??t.scaleName,participantIds:t.participantIds,roundsCount:t.roundsCount,restrictEntryStatus:e,structureId:n,matchUpIds:r});return o.error?o:((c=o==null?void 0:o.matchUps)!=null&&c.length&&uO({tournamentRecord:t.tournamentRecord,drawDefinition:t.drawDefinition,suppressNotifications:!0,matchUps:o.matchUps,event:t.event,structureId:n}),{...de})}function qOe({requireParticipantCount:t=!0,enforcePolicyLimits:e=!0,drawSizeProgression:i,participantsCount:n,participantCount:r,appliedPolicies:a,drawDefinition:s,seedingProfile:o,structureId:l,seedsCount:c}){var y,b;n=n??r;let u=hi({drawDefinition:s,structureId:l});if(u.error)return u;let d=u.structure;if(!d)return{error:gr};let{positionAssignments:p}=Ma({structure:d}),h=(p==null?void 0:p.length)||0;if(c>h)return{error:Rre};let f=(y=d.structures)==null?void 0:y.length,m=Ii(o==null?void 0:o.groupSeedingThreshold)&&(o==null?void 0:o.groupSeedingThreshold),g=(b=f3({roundRobinGroupsCount:f,drawSize:h}))==null?void 0:b.seedGroups,{seedsCount:v}=EC({policyDefinitions:a,requireParticipantCount:t,drawSizeProgression:i,participantsCount:n,drawSize:h});return v&&(a!=null&&a[Su])&&c>v&&e&&(c=v),d.seedLimit=c,d.seedAssignments=Rt(1,c+1).map(I=>{let T=g==null?void 0:g.find(U=>U.includes(I)),w=T&&Math.min(...T),S=m&&I>=m?w:I;return{participantId:void 0,seedNumber:I,seedValue:S}}),Hn({drawDefinition:s,structureIds:[l]}),{...de,seedLimit:c}}function dw({sortDescending:t=!1,tournamentRecord:e,scaleAttributes:i,scaleSortMethod:n,stageSequence:r,entries:a,event:s,stage:o}){if(!e)return{error:ut};return a=a??(s==null?void 0:s.entries)??[],{scaledEntries:a.filter(u=>(!o||!u.entryStage||u.entryStage===o)&&(!r||!u.entryStageSequence||u.entryStageSequence===r)&&id.includes(u.entryStatus)).map(u=>{let{participantId:d}=u,{scaleItem:p}=qS({tournamentRecord:e,scaleAttributes:i,participantId:d});return{...u,...p}}).filter(u=>{let d=u.scaleValue;return!n&&(isNaN(d)||!parseFloat(d))?!1:d}).sort(n||l)};function l(u,d){return t?c(d)-c(u):c(u)-c(d)}function c(u){return parseFloat(u.scaleValue||(t?-1:1e5))}}function Oue(t){let e="prepareStage",{drawDefinition:i}=t,{structures:n}=Wu({stageSequence:t.stageSequence||1,roundTarget:t.roundTarget,stage:t.stage,drawDefinition:i}),r=t.preparedStructureIds||[],a=n==null?void 0:n.find(({structureId:h})=>!r.includes(h));if(!a)return he({result:{error:gr},stack:e});let s=a==null?void 0:a.structureId,{seedsCount:o,stageEntries:l,seedLimit:c}=eLe({...t,structureId:s});(t.seededParticipants||t.event||t.seedingScaleName)&&KOe({...t,seedsCount:o,structure:a,structureId:s});let u=t.automated!==!1&&t.drawType!==nc&&!(t.qualifyingOnly&&t.stage!==ni),d=((n==null?void 0:n.length)||0)>1,p=u?YOe({...t,multipleStructures:d,seedLimit:c,structureId:s}):{};return p!=null&&p.error?he({result:p,stack:e}):{...p,stageEntries:l,structureId:s,seedsCount:o}}function WOe({entries:t,stage:e,stageSequence:i,roundTarget:n}){return t.filter(r=>{var s,o;let a=(o=(s=ki({name:Hp,element:r}))==null?void 0:s.extension)==null?void 0:o.value;return(!r.entryStage||r.entryStage===e)&&(!i||!r.entryStageSequence||r.entryStageSequence===i)&&(!n||!a||a===n)&&By.includes(r.entryStatus)})}function YOe(t){let e=typeof t.automated=="object"&&t.automated.seedsOnly,i=mC({...t,seedsOnly:e});if(i.error)return i;let n=i==null?void 0:i.positionAssignments,r=i==null?void 0:i.positioningReport;return{conflicts:i.conflicts,positionAssignments:n,positioningReport:r}}function KOe(t){let{seededParticipants:e,seedingScaleName:i,entries:n,event:r}=t,a=n.map(Vi);e?ZOe({...t,enteredParticipantIds:a}):(r||i)&&XOe({...t,enteredParticipantIds:a})}function ZOe(t){let{provisionalPositioning:e,enteredParticipantIds:i,seededParticipants:n,tournamentRecord:r,appliedPolicies:a,drawDefinition:s,seedingProfile:o,structureId:l,structure:c,event:u}=t,d=c?ow({provisionalPositioning:e,appliedPolicies:a,drawDefinition:s,seedingProfile:o,structure:c}):void 0;n.filter(({participantId:p})=>i.includes(p)).filter(p=>!p.seedNumber||p.seedNumber<=n.length).sort((p,h)=>p.seedNumber<h.seedNumber?-1:p.seedNumber<h.seedNumber?1:0).forEach(p=>{let{participantId:h,seedNumber:f,seedValue:m}=p;fU({provisionalPositioning:e,tournamentRecord:r,drawDefinition:s,seedingProfile:o,participantId:h,seedBlockInfo:d,structureId:l,seedNumber:f,seedValue:m,event:u})})}function XOe(t){let e=t.seedsCount,{provisionalPositioning:i,enteredParticipantIds:n,seedAssignmentProfile:r,assignSeedsCount:a,tournamentRecord:s,drawDefinition:o,seedByRanking:l,seedingProfile:c,structureId:u,event:d}=t,{categoryName:p,ageCategoryCode:h}=(d==null?void 0:d.category)||{},f=d==null?void 0:d.eventType,m=JOe({...t,ageCategoryCode:h,categoryName:p,eventType:f})||l&&QOe({...t,ageCategoryCode:h,categoryName:p,eventType:f}),g=(m==null?void 0:m.length)??0;g<e&&(e=g),m==null||m.filter(({participantId:v})=>n.includes(v)).slice(0,a||e).forEach((v,y)=>{let b=y+1,{participantId:I,scaleValue:T}=v,w=(r==null?void 0:r[b])||T||b;fU({provisionalPositioning:i,tournamentRecord:s,drawDefinition:o,seedingProfile:c,participantId:I,structureId:u,seedNumber:b,seedValue:w,event:d})})}function JOe(t){let{tournamentRecord:e,seedingScaleName:i,stageSequence:n,entries:r,stage:a,event:s}=t,{categoryName:o,ageCategoryCode:l}=(s==null?void 0:s.category)||{},c=s==null?void 0:s.eventType,u={scaleName:i||o||l||s.eventId,scaleType:wh,eventType:c};return dw({scaleAttributes:u,tournamentRecord:e,stageSequence:n,entries:r,stage:a}).scaledEntries}function QOe(t){let{tournamentRecord:e,stageSequence:i,event:n,entries:r,stage:a}=t,{categoryName:s,ageCategoryCode:o}=(n==null?void 0:n.category)||{},l=n==null?void 0:n.eventType;return dw({scaleAttributes:{scaleName:s||o,scaleType:og,eventType:l},tournamentRecord:e,stageSequence:i,entries:r,stage:a}).scaledEntries}function eLe(t){let{seedsCount:e}=t;t.seededParticipants&&(e=t.seededParticipants.length),e>t.drawSize&&(e=t.drawSize);let i=WOe(t);e>i.length&&(e=i.length);let{seedLimit:n}=qOe({enforcePolicyLimits:t.enforcePolicyLimits??!0,appliedPolicies:t.appliedPolicies,participantsCount:i.length,seedingProfile:t.seedingProfile,drawDefinition:t.drawDefinition,structureId:t.structureId,seedsCount:e});return n&&n<e&&(e=n),{seedsCount:e,stageEntries:i,seedLimit:n}}function tLe(t){var I;let e=X3({...t,modifyOriginal:!1});if(e.error)return e;let i=e.drawDefinition,{suppressDuplicateEntries:n=!0,ignoreStageSpace:r,appliedPolicies:a,qualifyingOnly:s,seedingProfile:o,participants:l,drawEntries:c,placeByes:u,drawSize:d,drawType:p,entries:h}=t,f=[],m=[],g=iLe({suppressDuplicateEntries:n,ignoreStageSpace:r,drawDefinition:i,drawEntries:c,drawType:p,entries:h});if(g.error)return g;let v=p===_y?0:ui(t.seedsCount??0),y=Oue({...t,qualifyingOnly:!d||s,appliedPolicies:a,drawDefinition:i,seedingProfile:o,participants:l,stage:Ft,seedsCount:v,placeByes:u,drawSize:d,entries:h});if(y.error&&!y.conflicts)return y;(I=y.positioningReport)!=null&&I.length&&f.push({[Ft]:y.positioningReport});let b=y.structureId;return y.conflicts&&(m=y.conflicts),p===nc&&t.roundsCount&&HOe({...t,drawDefinition:i,structureId:b}),{drawDefinition:i,positioningReports:f,conflicts:m,structureId:b}}function iLe(t){let{ignoreStageSpace:e,drawDefinition:i,drawEntries:n,drawType:r,entries:a}=t;for(let s of a){if(n&&s.entryStage&&s.entryStage!==Ft)continue;let o={...s,ignoreStageSpace:e??r===nc,entryStage:s.entryStage??Ft,event:t.event,drawDefinition:i,drawType:r},l=s3(o);if(n&&l.error)return l}return{error:void 0}}var nLe=()=>({matchUpType:void 0,drawName:void 0,drawId:void 0,structures:[],entries:[],links:[]}),rLe=nLe;function aLe(t){let{drawId:e=yn(),processCodes:i,matchUpType:n,drawType:r}=t??{},a=rLe();return Object.assign(a,{processCodes:i,matchUpType:n,drawType:r,drawId:e})}function dW(t){let e=t.structureIds,{tournamentRecord:i,drawDefinition:n,matchUpFormat:r,structureId:a,matchUpId:s,event:o}=t,l=Qt(t,[{[To]:!0,[sq]:!0}]);if(l.error)return l;if(!Nl({matchUpFormat:r}))return{error:NP};let c="setMatchUpFormat";if(s){let u=ar({drawDefinition:n,matchUpId:s,event:o});if(u.error)return u;let d=u.matchUp;if((d==null?void 0:d.matchUpType)===na)return{info:"Cannot set matchUpFormat when { matchUpType: TEAM }",error:al};d&&(d.matchUpFormat=r,Ji({tournamentId:i==null?void 0:i.tournamentId,eventId:o==null?void 0:o.eventId,context:c,drawDefinition:n,matchUp:d}))}else if(Array.isArray(e)){if((o==null?void 0:o.eventType)===na)return{error:_h};for(let u of e){let d=hi({drawDefinition:n,structureId:u});if(d.error)return d;d.structure&&(d.structure.matchUpFormat=r)}}else if(a){if((o==null?void 0:o.eventType)===na)return{error:_h};let u=hi({drawDefinition:n,structureId:a});if(u.error)return u;u.structure&&(u.structure.matchUpFormat=r)}else n&&(n.matchUpFormat=r);return e=e??(a?[a]:void 0),Hn({drawDefinition:n,structureIds:e}),{...de}}function sLe({tieFormat:t}){let e=Bo({checkCollectionIds:!1,tieFormat:t});if(e.error)return e;for(let i of t.collectionDefinitions)i.collectionId||(i.collectionId=yn());return{tieFormat:t}}function oLe({tournamentRecord:t,drawDefinition:e,matchUpFormat:i,matchUpType:n,tieFormat:r,event:a}){if((i||r)&&!(i&&(a==null?void 0:a.matchUpFormat)===i||a!=null&&a.tieFormat&&r&&JSON.stringify(a.tieFormat)===JSON.stringify(r))){if(r){let s=sLe({tieFormat:r});if(s.error)return s;e.tieFormat=s.tieFormat??r}else if(i){let s=dW({tournamentRecord:t,drawDefinition:e,matchUpFormat:i,event:a});if(s.error)return{info:"matchUpFormat or tieFormat error",error:s.error}}n&&(e.matchUpType=n)}return{error:void 0}}var pW={};Li(pW,{attachPolicies:()=>oy,findPolicy:()=>Fy,getAppliedPolicies:()=>hn,getPolicyDefinitions:()=>wm,mutate:()=>Lue,query:()=>$ue,removePolicy:()=>Fue});var Lue={};Li(Lue,{attachPolicies:()=>oy,removePolicy:()=>Fue});function Fue(t){let e=Qt(t,[{[UNe]:!0,_anyOf:{[ks]:!1,[ba]:!1,[To]:!1,[Fg]:!1}}]);if(e.error)return e;let i,n=t.drawDefinition??t.event??((t.tournamentId||!t.tournamentRecords)&&t.tournamentRecord);if(n)return yZ(t,n);if(t.tournamentRecords){let r=Object.keys(t.tournamentRecords);if(!r.length)return{error:ut};for(let a of r){let s=t.tournamentRecords[a],o=yZ(t,s);if(o.error)return o;i=!0}}else return{error:ut};return i?{...de}:{error:xb}}function yZ(t,e){let i=hn(t).appliedPolicies??{};return i[t.policyType]?(delete i[t.policyType],Object.keys(i).length?dn({element:e,extension:{name:oE,value:i}}):oo({element:e,name:oE}),{...de}):{error:xb}}var $ue={};Li($ue,{findPolicy:()=>Fy,getAppliedPolicies:()=>hn,getPolicyDefinitions:()=>wm});var Bue={[Su]:{validSeedPositions:{ignore:!0},duplicateSeedNumbers:!0,drawSizeProgression:!0,seedingProfile:{drawTypes:{[Oh]:{positioning:Jv},[zu]:{positioning:Jv}},positioning:fNe},policyName:"USTA SEEDING",seedsCountThresholds:[{drawSize:4,minimumParticipantCount:3,seedsCount:2},{drawSize:16,minimumParticipantCount:12,seedsCount:4},{drawSize:32,minimumParticipantCount:24,seedsCount:8},{drawSize:64,minimumParticipantCount:48,seedsCount:16},{drawSize:128,minimumParticipantCount:96,seedsCount:32},{drawSize:256,minimumParticipantCount:192,seedsCount:64}]}},sj=Bue;function lLe({appliedPolicies:t,policyDefinitions:e,drawDefinition:i,stack:n}){if(e&&typeof e!="object")return he({info:"policyDefinitions must be an object",result:{error:Re},stack:n});let r={[sE]:t==null?void 0:t[sE]};return e?cLe({policyDefinitions:e,appliedPolicies:t,policiesToAttach:r,drawDefinition:i}):r.avoidance&&oy({drawDefinition:i,policyDefinitions:r}),!(t!=null&&t[Su])&&!(e!=null&&e[Su])&&(oy({policyDefinitions:sj,drawDefinition:i}),t&&Object.assign(t,sj)),{error:void 0}}function cLe({policyDefinitions:t,appliedPolicies:e,policiesToAttach:i,drawDefinition:n}){for(let r of Object.keys(t))JSON.stringify(e==null?void 0:e[r])!==JSON.stringify(t[r])&&(i[r]=t[r]);Object.keys(i).length&&(oy({policyDefinitions:i,drawDefinition:n}),e&&Object.assign(e,i))}function uLe(t){var v,y,b,I,T;let{tournamentRecord:e,matchUpFormat:i,appliedPolicies:n,policyDefinitions:r,matchUpType:a,tieFormat:s,drawType:o,stack:l,event:c}=t,u=t.drawId?(v=c==null?void 0:c.drawDefinitions)==null?void 0:v.find(w=>w.drawId===t.drawId):void 0;u&&o!==u.drawType&&(u.drawType=o);let d=u??aLe({processCodes:t.processCodes,drawId:t.drawId,drawType:o}),p=oLe({tournamentRecord:e,drawDefinition:d,matchUpFormat:i,matchUpType:a,tieFormat:s,event:c});if(p.error)return he({result:p,stack:l});let h=lLe({appliedPolicies:n,policyDefinitions:r,drawDefinition:d,stack:l});if(h.error)return h;let f=(b=(y=u==null?void 0:u.structures)==null?void 0:y.find(w=>w.stage===Ft&&w.stageSequence===1))==null?void 0:b.structureId,m=u?(I=u.structures)==null?void 0:I.filter(w=>w.stage===ni):[],g=(m==null?void 0:m.length)===1&&!((T=m[0].matchUps)!=null&&T.length)&&m[0].structureId;return{drawDefinition:d,structureId:f,existingDrawDefinition:u,existingQualifyingPlaceholderStructureId:g}}function dLe(t){var u,d;let e="generateOrGetExisting",i=[],n=[],r=uLe(t);if(r.error)return he({result:r,stack:e});let a=r.existingDrawDefinition,s=r.drawDefinition??{},o=r.structureId,l=t.drawEntries??t.eventEntries??[],c=r.existingQualifyingPlaceholderStructureId&&FOe({...t,...r})||tLe({...t,...r,entries:l});return c.error?he({result:c,stack:e}):((u=c.positioningReports)!=null&&u.length&&i.push(...c.positioningReports??[]),(d=c.conflicts)!=null&&d.length&&n.push(...c.conflicts??[]),s=c.drawDefinition,o=c.structureId,{existingDrawDefinition:a,positioningReports:i,drawDefinition:s,structureId:o,conflicts:n,entries:l})}function pLe(t){var m,g,v;let{qualifyingPlaceholder:e,qualifyingProfiles:i,existingDrawDefinition:n,positioningReports:r,appliedPolicies:a,qualifyingOnly:s,drawDefinition:o,seedingProfile:l,participants:c,structureId:u,entries:d,stack:p}=t,h=e&&!(i!=null&&i.length)&&!n,f=[];if(i){let y=(w,S)=>w.stageSequence-S.stageSequence,b=(w,S)=>w.roundTarget-S.roundTarget,I=[],T=1;i.sort(b);for(let w of i){if(!Array.isArray(w.structureProfiles))return he({info:sy("structureProfiles"),result:{error:ai},stack:p});T=w.roundTarget||T;let S=((m=w.structureProfiles)==null?void 0:m.sort(y))||[],U=1;for(let P of S){let{qualifyingRoundNumber:E,qualifyingPositions:R,seededParticipants:C,seedingScaleName:M,seedsCount:_=0,seedByRanking:A,placeByes:N,drawSize:k}=P,O=Oue({...t,seedingProfile:P.seedingProfile??l,stageSequence:U,qualifyingRoundNumber:E,preparedStructureIds:I,qualifyingPositions:R,seededParticipants:C,stage:ni,seedingScaleName:M,appliedPolicies:a,drawDefinition:o,qualifyingOnly:s,seedByRanking:A,participants:c,roundTarget:T,seedsCount:_,placeByes:N,drawSize:k,entries:d});if(O.error)return O;O.structureId&&I.push(O.structureId),U+=1,(g=O.conflicts)!=null&&g.length&&f.push(...O.conflicts),(v=O.positioningReport)!=null&&v.length&&r.push({[ni]:O.positioningReport})}T+=1}}else if(u&&h){let y=Lc({structureName:gs(ni),stage:ni}),{link:b}=gC({sourceStructureId:y.structureId,targetStructureId:u,sourceRoundNumber:0,linkType:jf});o.structures||(o.structures=[]),o.structures.push(y),o.links||(o.links=[]),o.links.push(b)}return{qualifyingConflicts:f,error:void 0}}var CC={};Li(CC,{addGoesTo:()=>ay,allCompetitionMatchUps:()=>_d,allDrawMatchUps:()=>lo,allEventMatchUps:()=>Jh,allPlayoffPositionsFilled:()=>w3,allTournamentMatchUps:()=>Wa,analyzeDraws:()=>UC,analyzeMatchUp:()=>bE,analyzeTournament:()=>SW,bulkUpdatePublishedEventIds:()=>UW,calculateWinCriteria:()=>hw,categoryCanContain:()=>OP,checkMatchUpIsComplete:()=>Gv,checkValidEntries:()=>hO,compareTieFormats:()=>Kf,competitionScheduleMatchUps:()=>_C,courtGridRows:()=>_O,credits:()=>hLe,drawMatchUps:()=>FW,eventMatchUps:()=>OO,filterMatchUps:()=>Df,filterParticipants:()=>uC,findDrawDefinition:()=>z3,findExtension:()=>ki,findVenue:()=>Xh,getAggregateTeamResults:()=>wW,getAllDrawMatchUps:()=>ua,getAllEventData:()=>DW,getAllStructureMatchUps:()=>wn,getAllowedDrawTypes:()=>SO,getAllowedMatchUpFormats:()=>yW,getAppliedPolicies:()=>hn,getAssignedParticipantIds:()=>jy,getAvailableMatchUpsCount:()=>dO,getAvailablePlayoffProfiles:()=>vC,getCategoryAgeDetails:()=>sI,getCheckedInParticipantIds:()=>tw,getCompetitionDateRange:()=>UO,getCompetitionMatchUps:()=>yE,getCompetitionParticipants:()=>hW,getCompetitionPenalties:()=>bW,getCompetitionVenues:()=>RC,getCourtInfo:()=>Yx,getCourts:()=>$W,getDrawData:()=>PO,getDrawDefinitionTimeItem:()=>Gq,getDrawParticipantRepresentativeIds:()=>G3,getDrawStructures:()=>Wu,getDrawTypeCoercion:()=>DC,getEligibleVoluntaryConsolationParticipants:()=>j3,getEntriesAndSeedsCount:()=>kO,getEvent:()=>jW,getEventData:()=>CO,getEventMatchUpFormatTiming:()=>RW,getEventProperties:()=>BW,getEventPublishStatus:()=>iu,getEventStructures:()=>iO,getEventTimeItem:()=>WP,getEvents:()=>VW,getFlightProfile:()=>_r,getHomeParticipantId:()=>_W,getLinkedTournamentIds:()=>HP,getMatchUpCompetitiveProfile:()=>iC,getMatchUpContextIds:()=>kW,getMatchUpDailyLimits:()=>FO,getMatchUpDailyLimitsUpdate:()=>MW,getMatchUpDependencies:()=>rd,getMatchUpFormat:()=>xW,getMatchUpFormatTiming:()=>nC,getMatchUpFormatTimingUpdate:()=>CW,getMatchUpScheduleDetails:()=>Kx,getMatchUpType:()=>Zx,getMatchUpsMap:()=>Ts,getMatchUpsStats:()=>OW,getMatchUpsToSchedule:()=>RO,getMaxEntryPosition:()=>PW,getModifiedMatchUpFormatTiming:()=>xO,getPairedParticipant:()=>Yu,getParticipantEventDetails:()=>fW,getParticipantIdFinishingPositions:()=>H3,getParticipantMembership:()=>mW,getParticipantResults:()=>IC,getParticipantScaleItem:()=>qS,getParticipantSchedules:()=>gW,getParticipantSignInStatus:()=>vW,getParticipantTimeItem:()=>Hq,getParticipants:()=>vr,getPersonRequests:()=>zy,getPolicyDefinitions:()=>wm,getPositionAssignments:()=>mE,getPositionsPlayedOff:()=>gU,getPredictiveAccuracy:()=>AW,getProfileRounds:()=>AO,getPublishState:()=>aw,getRoundMatchUps:()=>fo,getRounds:()=>LW,getScaleValues:()=>aU,getScaledEntries:()=>dw,getScheduledRoundsDetails:()=>MC,getSchedulingProfile:()=>Dm,getSchedulingProfileIssues:()=>EW,getSeedingThresholds:()=>m3,getSeedsCount:()=>EC,getStructureSeedAssignments:()=>qc,getTeamLineUp:()=>ry,getTieFormat:()=>EO,getTimeItem:()=>Qc,getTournamentIds:()=>jP,getTournamentInfo:()=>pw,getTournamentPenalties:()=>TO,getTournamentPersons:()=>IW,getTournamentPoints:()=>DO,getTournamentPublishStatus:()=>cC,getTournamentStructures:()=>I3,getTournamentTimeItem:()=>jx,getValidGroupSizes:()=>hC,getVenueData:()=>GS,getVenuesAndCourts:()=>Um,isAdHoc:()=>Vo,isCompletedStructure:()=>fg,isValidForQualifying:()=>K3,isValidMatchUpFormat:()=>Nl,matchUpActions:()=>pO,participantScaleItem:()=>Th,participantScheduledMatchUps:()=>NW,positionActions:()=>Y3,publicFindCourt:()=>t3,publicFindVenue:()=>e3,tallyParticipantResults:()=>vU,tieFormatGenderValidityCheck:()=>vx,tournamentMatchUps:()=>LO,validMatchUp:()=>Gx,validMatchUps:()=>tu,validateCollectionDefinition:()=>LP,validateLineUp:()=>tO});function hLe(){return`
    This project would not have been possible without the generous input and patience
    of tournament organizers and directors who worked with early versions of CourtHive/TMX.

    Thanks to Pavel, Ivan, Mladen, Zdenko, Antonia, Jakov, Kreso, Barry, Jeff, Bobby... to name just a few. 

    The project would not have even begun without the support of Miro, or the introduction by Sretchko.
    The project would not have succeeded without the enthusiasm of Randy and Bruce.
    Thanks to serendipity and Luca and the ensuing TODS conversations with ITF.
    Thanks to Scott and Jake for sanity checks, suggestions, and camaraderie.
    Thanks to Zoran for inspiring the async support and getting into the weeds with subscriptions.
    Thanks to Dave for backing the conversion of TMX 1.x source into the factory repository.
    Thanks to Vuk and Pavle and Rich and Chris and Deepa for the direct engagement with the APIs.
    Thanks to Joe for repeatedly challenging me and the many pointers to useful tooling.
    Thanks to Shannon for the validation of the approach from his deep domain experience.
    Thanks to Nikola for the ongoing camaraderie and explorations of what we can do with TODS.

    And a special thanks to my family for putting up with the long days and weeks and months of coding
    and conversations at all hours.
  `}var Vue={};Li(Vue,{filterParticipants:()=>uC,getCompetitionParticipants:()=>hW,getPairedParticipant:()=>Yu,getParticipantEventDetails:()=>fW,getParticipantMembership:()=>mW,getParticipantScaleItem:()=>qS,getParticipantSchedules:()=>gW,getParticipantSignInStatus:()=>vW,getParticipantTimeItem:()=>Hq,getParticipants:()=>vr,getScaleValues:()=>aU,participantScaleItem:()=>Th,validateLineUp:()=>tO});function hW(t){let{tournamentRecords:e}=t||{};if(typeof e!="object"||!Object.keys(e).length)return{error:wr};let i=[],n={},r={},a={},s=[],o={},l=[];for(let c of Object.values(e)){let{participantIdsWithConflicts:u,mappedMatchUps:d,participantMap:p,participants:h,matchUps:f,derivedEventInfo:m,derivedDrawInfo:g}=vr({...t,tournamentRecord:c});Object.assign(o,d),Object.assign(n,p),Object.assign(r,m),Object.assign(a,g),i.push(...h??[]),s.push(...f??[]),u==null||u.forEach(v=>{l.includes(v)||l.push(v)})}return{participantIdsWithConflicts:l,derivedEventInfo:r,derivedDrawInfo:a,participantMap:n,mappedMatchUps:o,participants:i,...de,matchUps:s}}function fW({tournamentRecord:t,participantId:e}){if(!t)return{error:ut};if(!e)return{error:la};let i=[e].concat((t.participants??[]).filter(n=>{var r;return(n==null?void 0:n.participantType)&&[En,Ni].includes(n.participantType)&&((r=n.individualParticipantIds)==null?void 0:r.includes(e))}).map(n=>n.participantId));return{eventDetails:(t.events??[]).filter(n=>{let r=((n==null?void 0:n.entries)??[]).map(a=>a.participantId);return ho(r,i)}).map(n=>({eventName:n.eventName,eventId:n.eventId}))}}function mW({tournamentRecord:t,participantId:e}){if(!t)return{error:ut};if(!e)return{error:la};let{participants:i}=vr({participantFilters:{participantTypes:[En,Ni,pc]},tournamentRecord:t});return(i??[]).filter(n=>{var r;return(r=n.individualParticipantIds)==null?void 0:r.includes(e)}).reduce((n,r)=>{let a=r.participantType;return a&&(n[a]||(n[a]=[]),n[a].push(r)),n},{})}function gW({participantFilters:t={},tournamentRecord:e}){if(!e)return{error:ut};if(typeof t!="object")return{error:bm,context:{participantFilters:t}};let i={eventIds:t.eventIds},n=Wa({tournamentRecord:e,contextFilters:i}).matchUps??[],r=Object.assign({},...n.map(l=>({[l.matchUpId]:l}))),a=n.filter(({schedule:l})=>l&&Object.keys(l).length),s=rd({tournamentRecord:e,matchUps:n}).sourceMatchUpIds??[],o={};for(let l of a){let{sides:c}=l,u,d=(c==null?void 0:c.map(h=>{if(h.participant)return[h.participant].concat(...h.participant.individualParticipants||[]);s[l.matchUpId]&&!u&&(u=(s[l.matchUpId]||[]).map(f=>r[f]).filter(({winningSide:f,bye:m})=>!f&&!m))}).filter(Boolean).flat())??[];for(let h of d){let{participantId:f}=h;o[f]||(o[f]={potentialMatchUps:[],participant:h,matchUps:[]}),o[f].matchUps.push(l)}let p=(u==null?void 0:u.map(({sides:h})=>h).flat().map(({participant:h})=>h&&[h].concat(...h.individualParticipants||[])).filter(Boolean).flat())||[];for(let h of p){let{participantId:f}=h;o[f]||(o[f]={potentialMatchUps:[],participant:h,matchUps:[]}),o[f].potentialMatchUps.push(l)}}return{participantSchedules:Object.values(o).filter(({participant:l})=>!(t.participantIds&&!t.participantIds.includes(l.participantId)||t.participantTypes&&!t.participantTypes.includes(l.participantType))),...de}}function vW({tournamentRecord:t,participantId:e}){if(!t)return{error:ut};if(!e)return{error:la};let{participant:i}=jg({tournamentRecord:t,participantId:e});if(!i)return{error:xr};let{timeItem:n}=Qc({itemType:qP,element:i});return n&&n.itemValue===uE&&uE}var jue={};Li(jue,{analyzeDraws:()=>UC,analyzeTournament:()=>SW,getAggregateTeamResults:()=>wW,getAllowedDrawTypes:()=>SO,getAllowedMatchUpFormats:()=>yW,getAppliedPolicies:()=>hn,getCompetitionDateRange:()=>UO,getCompetitionPenalties:()=>bW,getPolicyDefinitions:()=>wm,getTournamentInfo:()=>pw,getTournamentPenalties:()=>TO,getTournamentPersons:()=>IW,getTournamentPoints:()=>DO,getTournamentStructures:()=>I3,getTournamentTimeItem:()=>jx});function yW({tournamentRecord:t,categoryName:e,categoryType:i}){var r;if(!t)return{error:ut};let{appliedPolicies:n}=hn({tournamentRecord:t});return(((r=n==null?void 0:n[zc])==null?void 0:r.matchUpFormats)||[]).filter(({categoryNames:a,categoryTypes:s})=>!e&&!s||e&&(a==null?void 0:a.includes(e))||i&&(s==null?void 0:s.includes(i)))}function SO({tournamentRecord:t,categoryName:e,categoryType:i}){var r;if(!t)return{error:ut};let{appliedPolicies:n}=hn({tournamentRecord:t});return(((r=n==null?void 0:n[VA])==null?void 0:r.allowedDrawTypes)||[]).filter(({categoryNames:a,categoryTypes:s})=>!e&&!s||e&&(a==null?void 0:a.includes(e))||i&&(s==null?void 0:s.includes(i)))}function TO({tournamentRecord:t}){if(!t)return{error:ut};let e=((t==null?void 0:t.participants)??[]).reduce((i,n)=>{let{participantId:r}=n;return(n.penalties??[]).forEach(a=>{let{penaltyId:s}=a||{};i[s]?i[s].participants.push(r):i[s]={...a,participantIds:[r]}}),i},{});return{penalties:Object.values(e)}}function bW({tournamentRecords:t}){if(typeof t!="object"||!Object.keys(t).length)return{error:wr};let e=[];for(let i of Object.values(t)){let{penalties:n}=TO({tournamentRecord:i});e.push(...n??[])}return{penalties:e}}function Gue({event:t}){return{eventInfo:(({eventId:e,eventName:i,eventType:n,eventLevel:r,surfaceCategory:a,matchUpFormat:s,category:o,gender:l,startDate:c,endDate:u,ballType:d,discipline:p,onlineResources:h,notes:f})=>({eventId:e,eventName:i,eventType:n,eventLevel:r,surfaceCategory:a,matchUpFormat:s,category:o,gender:l,startDate:c,endDate:u,ballType:d,discipline:p,onlineResources:h,notes:f}))(t)}}var fLe={[sU]:{policyName:"Staff Privacy Policy",participant:{contacts:!1,individualParticipants:!1,individualParticipantIds:!1,onlineResources:!1,participantName:!0,participantOtherName:!0,participantId:!0,participantRole:!0,participantRoleResponsibilities:!0,participantStatus:!0,penalties:!1,representing:!0,participantType:!0,person:{addresses:!1,biographicalInformation:!1,birthDate:!1,contacts:!1,nationalityCode:!0,nativeFamilyName:!1,nativeGivenName:!1,onlineResources:!1,otherNames:!0,parentOrganisationId:!1,passportFamilyName:!1,passportGivenName:!1,personId:!1,personOtherIds:!1,previousNames:!1,sex:!1,standardFamilyName:!0,standardGivenName:!0,status:!1,tennisId:!1,wheelchair:!0}}}},mLe=fLe;function pw(t){var o,l,c,u;let{tournamentRecord:e}=t??{};if(!e)return{error:ut};let i=(({tournamentId:d,tournamentRank:p,tournamentStatus:h,formalName:f,tournamentName:m,promotionalName:g,onlineResources:v,localTimeZone:y,activeDates:b,startDate:I,endDate:T,hostCountryCode:w,venues:S,notes:U,updatedAt:P})=>({tournamentId:d,tournamentRank:p,tournamentStatus:h,formalName:f,tournamentName:m,promotionalName:g,onlineResources:v,localTimeZone:y,activeDates:b,startDate:I,endDate:T,hostCountryCode:w,venues:S,notes:U,updatedAt:P}))(e),n=((o=vr({participantFilters:{participantRoles:[ile,l3,nle,rle,sle]},policyDefinitions:mLe,tournamentRecord:e}))==null?void 0:o.participants)??[];n&&(i.tournamentContacts=n);let r=(l=aw({tournamentRecord:e}))==null?void 0:l.publishState,a=((u=(c=r==null?void 0:r.tournament)==null?void 0:c.status)==null?void 0:u.publishedEventIds)||[],s=[];for(let d of e.events??[])if(!(t!=null&&t.usePublishState)||a.includes(d.eventId)){let p=Gue({event:d}).eventInfo;p&&s.push(p)}return i.timeItemValues=pce({element:e}),i.publishState=r==null?void 0:r.tournament,i.eventInfo=s,{tournamentInfo:_t(Kt(i),!1,!0),...de}}function UO({tournamentRecords:t}){if(!Xi(t))return{error:wr};let e=Object.keys(t??{}).reduce((r,a)=>{let s=t[a],{tournamentInfo:{startDate:o,endDate:l}}=pw({tournamentRecord:s}),c=o&&new Date(Ri(o));(!r.startDate||c&&c<r.startDate)&&(r.startDate=c);let u=l&&new Date(Ri(l));return(!r.endDate||u&&u>r.endDate)&&(r.endDate=u),r},{startDate:void 0,endDate:void 0}),i=e.startDate&&Ri(e.startDate.toISOString()),n=e.endDate&&Ri(e.endDate.toISOString());return!i||!n?{error:Yre}:{startDate:i,endDate:n}}function IW({tournamentRecord:t,participantFilters:e}){if(!t)return{error:ut};let i=t.participants||[];e&&(i=uC({participants:i,participantFilters:e,tournamentRecord:t}));let n={},r=a=>{if(a.person){let{personId:s}=a.person;n[s]?n[s].participantIds.push(a.participantId):n[s]={...a.person,participantIds:[a.participantId]}}};return i.forEach(a=>{a.person&&r(a)}),{tournamentPersons:Object.values(n)}}function wW(t){var d,p,h,f,m,g,v,y;let e=Qt(t,[{[ba]:!0}]);if(e.error)return e;let i=t.finishingPositionRangeBounsPoints||{},n={},r=b=>{var T,w,S;let I=(T=b==null?void 0:b.individualParticipants)==null?void 0:T.map(U=>{var P;return((P=U.teams)==null?void 0:P.length)===1&&U.teams[0]});return((w=b==null?void 0:b.teams)==null?void 0:w.length)===1&&((S=b==null?void 0:b.teams)==null?void 0:S[0])||(I==null?void 0:I[0].participantId)===(I==null?void 0:I[1].participantId)&&(I==null?void 0:I[0])},{matchUps:a,participants:s}=vr({participantFilters:{participantTypes:[ji]},withRankingProfile:!0,withStatistics:!0,...t});for(let b of s??[]){if(b.participantType===Lo)continue;((p=(d=b.draws)==null?void 0:d[0])==null?void 0:p.drawId)==="draw-0-3"&&console.log(b.participantType,b.draws[0].finishingPositionRange);let I=r(b);if(I)for(let T of(b==null?void 0:b.draws)??[]){let w=(h=T==null?void 0:T.finishingPositionRange)==null?void 0:h.join("-");if(w&&(i!=null&&i[w])){let S=I==null?void 0:I.participantId,U=T==null?void 0:T.drawId,P=`${S}|${U}|${w}`;n[P]=i[w]}}}let o=b=>({teamName:b,standingPoints:0,pointsPlayed:0,pointsPct:0,points:0,bonus:0,diff:0,loss:0,win:0}),l=(b,I,T)=>{b[I]===void 0&&(b[I]=0),b[I]+=T},c={},u={};for(let b of a??[]){let{sides:I,matchUpFormat:T}=b,w=T&&wo(T);if((I==null?void 0:I.length)===2&&((f=w.setFormat)!=null&&f.timed)&&(!w.finalSetFormat||(m=w.finalSetFormat)!=null&&m.timed))for(let S of I){let U=r(S.participant),P=U==null?void 0:U.participantId,E=(g=S.participant)==null?void 0:g.participantId,R=U==null?void 0:U.participantName,C=S.sideNumber,M=((v=S.participant)==null?void 0:v.individualParticipantIds)||E&&[E]||[];if(M.forEach(_=>{_&&!c[_]&&(c[_]=o(R))}),P&&C){u[P]||(u[P]=o(R));let _=[...M.map(N=>c[N]),u[P]];b.winningSide&&(C===b.winningSide?_.forEach(N=>l(N,"win",1)):_.forEach(N=>l(N,"loss",1)));let A=((y=b.score)==null?void 0:y.sets)||[];for(let N of A){let k=(N==null?void 0:N[`side${3-C}Score`])||0,O=(N==null?void 0:N[`side${C}Score`])||0,$=O-k;_.forEach(F=>l(F,"pointsPlayed",O+k)),_.forEach(F=>l(F,"points",O)),_.forEach(F=>l(F,"diff",$))}}}}for(let b of Object.keys(n)){let[I]=b.split("|");u[I]&&(u[I].bonus+=n[b],u[I].pointsPct=parseFloat((u[I].points/u[I].pointsPlayed).toFixed(2)),u[I].standingPoints=u[I].win+u[I].bonus)}for(let b of Object.keys(c))c[b].pointsPct=parseFloat((c[b].points/c[b].pointsPlayed).toFixed(2));return{...de,individualResults:c,teamResults:u}}function gLe(t){var a,s,o,l,c,u,d;let e=((s=(a=t.participants)==null?void 0:a.filter(({participantType:p})=>p===En))==null?void 0:s.length)===2,i=((o=t.events)==null?void 0:o.length)===1&&t.events[0],n=((l=i==null?void 0:i.drawDefinitions)==null?void 0:l.length)===1&&i.drawDefinitions[0],r=((d=(u=((c=n==null?void 0:n.structures)==null?void 0:c.length)===1&&n.structures[0])==null?void 0:u.positionAssignments)==null?void 0:d.length)===2;return!!(i.tieFormat&&e&&r)}function SW({tournamentRecord:t}){var r;if(!t)return{error:ut};let{drawsAnalysis:e}=UC({tournamentRecord:t}),i={isDual:gLe(t),drawsAnalysis:e},n=vr({tournamentRecord:t});return(r=n.missingParticipantIds)!=null&&r.length&&(i.missingParticipantIds=n.missingParticipantIds),{...de,analysis:i}}function Hue(t,e){return t&&e&&Array.isArray(e)&&e[t-1]||typeof e=="object"&&e[t]}function vLe(t){let{participation:e={},awardProfiles:i,startDate:n,eventType:r,drawSize:a,drawType:s,category:o,endDate:l,level:c}=t,{participationOrder:u,flightNumber:d,rankingStage:p}=e,h=f=>!n&&!l||!f.dateRanges?!0:f.dateRanges.some(m=>{let g=!n||!m.startDate||new Date(n)>new Date(m.startDate),v=!l||!m.endDate||new Date(l)<=new Date(m.endDate);return g&&v});return{awardProfile:i.find(f=>{var m,g,v,y,b,I,T,w,S,U;return h(f)&&(!f.maxFlightNumber||d<=f.maxFlightNumber)&&(!((m=f.drawTypes)!=null&&m.length)||((g=f.drawTypes)==null?void 0:g.includes(s)))&&(!((v=f.drawSizes)!=null&&v.length)||f.drawSizes.includes(a))&&(!((y=f.stages)!=null&&y.length)||f.stages.includes(p))&&(!((b=f.levels)!=null&&b.length)||f.levels.includes(c))&&(!f.maxDrawSize||a<=f.maxDrawSize)&&(!f.drawSize||f.drawSize===a)&&(!f.maxLevel||c<=f.maxLevel)&&(!d||!((T=(I=f.flights)==null?void 0:I.flightNumbers)!=null&&T.length)||f.flights.flightNumbers.includes(d))&&(!f.participationOrder||f.participationOrder===u)&&(!((w=f.category)!=null&&w.ageCategoryCodes)||f.category.ageCategoryCodes.includes(o==null?void 0:o.ageCategoryCode))&&(!((S=f.eventTypes)!=null&&S.length)||((U=f.eventTypes)==null?void 0:U.includes(r)))})}}function bZ({participantWon:t,flightNumber:e,valueObj:i,drawSize:n,flights:r,level:a}){var f,m;let s=(g,v)=>{if(g){if(Array.isArray(v)){let y=v.find(b=>b.flight===g||b.f===g);return y.value||y.v}if(typeof v=="object"){let y=v.flights||v.f;if(Array.isArray(y))return y[g-1]}}},o=(g,v)=>{let y=(g==null?void 0:g.value)||(g==null?void 0:g.v)||(Ii(g)?g:0),b=Hue(a,g==null?void 0:g.level);return{value:s(v,b)||Ii(b)&&b||y}},l=0,c,u,d,p,h=t&&"won"||t===!1&&"lost"||void 0;if(Array.isArray(i)){let g=i.find(b=>{var I;return b.drawSize===n||((I=b.drawSizes)==null?void 0:I.includes(n))}),v=i.find(b=>b.drawSize&&b.threshold&&n>b.drawSize),y=i.find(b=>{var I;return!b.drawSize&&!((I=b.drawSizes)!=null&&I.length)});h!==void 0&&(g=g==null?void 0:g[h],v=v==null?void 0:v[h],y=y==null?void 0:y[h]),u=o(g,e).value,d=o(v,e).value,p=o(y,e).value,l=u||d||p,c=u&&g.requireWin||d&&v.requireWin||(y==null?void 0:y.requireWin)}else if(typeof i=="object"){let g=(f=i==null?void 0:i.drawSizes)==null?void 0:f[n],v=i;h!==void 0&&(g=g==null?void 0:g[h],v=v==null?void 0:v[h]),u=o(g,e).value,p=o(v,e).value,l=u||p,c=u?g.requireWin:v==null?void 0:v.requireWin}else Ii(i)&&h===void 0&&(l=i);return e&&((m=r==null?void 0:r.pct)!=null&&m[e])&&(l=Math.round(l*r.pct[e])),{awardPoints:l,requireWin:c}}function DO({participantFilters:t,policyDefinitions:e,tournamentRecord:i,level:n}){var v;if(!i)return{error:ut};let{policyDefinitions:r}=wm({policyTypes:[FN],tournamentRecord:i}),a=(e==null?void 0:e[FN])??(r==null?void 0:r[FN]);if(!a)return{error:ix};let s=a.awardProfiles,o=a.requireWinFirstRound,l=a.requireWinForPoints,{participants:c,derivedEventInfo:u,derivedDrawInfo:d,mappedMatchUps:p}=vr({withRankingProfile:!0,participantFilters:t,tournamentRecord:i}),h=c==null?void 0:c.filter(y=>{var b;return(b=y.draws)==null?void 0:b.length}),f={},m={},g={};for(let y of h??[]){let{participantType:b,participantId:I,person:T,draws:w}=y;for(let S of w){let{drawId:U,structureParticipation:P,eventId:E}=S,R=u[E],C=d[U],M=C==null?void 0:C.drawType,{category:_,eventType:A}=R||{},N=S.startDate||R.startDate||i.startDate,k=S.endDate||R.endDate||i.endDate;if(A===Al&&I!==Lo)continue;let O;if(s){let $=l,F=0,V=0,j=0,B;for(let z of P){let{finishingPositionRange:W,participationOrder:Z,participantWon:K,flightNumber:Q,rankingStage:J,winCount:se}=z;F+=se||0;let ie=C==null?void 0:C.drawSize,{awardProfile:ce}=vLe({awardProfiles:s,participation:z,eventType:A,startDate:N,category:_,drawSize:ie,drawType:M,endDate:k,level:n});if(ce){if(!ie)continue;let oe=Array.isArray(W)&&Math.max(...W),te=Ei(W||[]).join("-"),le=oe&&J!==ni&&(W==null?void 0:W.includes(ie));ce.requireWinForPoints!==void 0&&($=ce.requireWinForPoints),ce.requireWinFirstRound!==void 0&&(o=ce.requireWinFirstRound);let{finishingPositionPoints:ne={},finishingPositionRanges:me,finishingRound:be,pointsPerWin:Se,flights:we}=ce,ze=Array.isArray(ce.perWinPoints)?(v=ce.perWinPoints)==null?void 0:v.find(lt=>{var Ct;return(Ct=lt.participationOrders)==null?void 0:Ct.includes(Z)}):ce.perWinPoints,Qe=ne.participationOrders,ke=0,yt;if((!Qe||Qe.includes(Z))&&me&&oe){let lt=me[oe];lt&&({awardPoints:ke,requireWin:yt}=bZ({flightNumber:Q,valueObj:lt,drawSize:ie,flights:we,level:n}))}if(!ke&&be&&Z===1&&oe){let lt=be[oe];lt&&({awardPoints:ke,requireWin:yt}=bZ({participantWon:K,flightNumber:Q,valueObj:lt,drawSize:ie,flights:we,level:n}))}if(le&&o!==void 0&&($=o),yt!==void 0&&($=yt),ke>V&&(!$||se)&&(V=ke,B=oe),!ke&&Se&&se&&(j+=se*Se,B=te),!ke&&se&&ze){let lt=Hue(n,ze==null?void 0:ze.level);lt?j+=se*lt:ze.value&&(j+=se*ze.value)}}if(O=V+j,b===Lo){let oe=(y.matchUps||[]).filter(({structureId:te})=>te===z.structureId);for(let{matchUpId:te}of oe){let le=p[te],ne=le.sides.find(me=>me.participantId===I).sideNumber;if(le.winningSice===ne)for(let me of le.tieMatchUps)me.winningSide}}}if(j||V){let z={winCount:F,positionPoints:V,rangeAccessor:B,perWinPoints:j,eventType:A,drawId:U,points:O},W=T==null?void 0:T.personId;W?(f[W]||(f[W]=[]),f[W].push(z)):b===Ni?(g[I]||(g[I]=[]),g[I].push(z)):b===Lo&&(m[I]||(m[I]=[]),m[I].push(z))}}}}return{participantsWithOutcomes:h,personPoints:f,pairPoints:g,teamPoints:m,...de}}var zue={};Li(zue,{compareTieFormats:()=>Kf,getTieFormat:()=>EO,tieFormatGenderValidityCheck:()=>vx,validateCollectionDefinition:()=>LP});function a_(t){var r;if(!t)return{};let e=[],i=t.tieFormatName,n=(r=t.collectionDefinitions)==null?void 0:r.map(a=>{let{matchUpType:s,matchUpFormat:o,matchUpCount:l,category:c,gender:u}=a;e.includes(o)||e.push(o);let d=c==null?void 0:c.ageCategoryCode;return[l,s===Zv?"D":"S",d,o,u].join(";")}).join("|");return{tieFormatName:t&&i||"UNNAMED",matchUpFormats:e,tieFormatDesc:n}}function Kf({considerations:t={},descendant:e,ancestor:i}){var T,w;let n={},r={},{matchUpFormats:a,tieFormatDesc:s}=a_(e),{matchUpFormats:o,tieFormatDesc:l}=a_(i),c=Ei((a??[]).filter(S=>!(o??[]).includes(S)).concat((o??[]).filter(S=>!(a??[]).includes(S)))),u=!!(t!=null&&t.collectionName&&e.collectionDefinitions.map(({collectionName:S})=>S).join("|")!==i.collectionDefinitions.map(({collectionName:S})=>S).join("|")),d=!!(t!=null&&t.collectionOrder&&e.collectionDefinitions.map(({collectionOrder:S})=>S).join("|")!==i.collectionDefinitions.map(({collectionOrder:S})=>S).join("|")),p=Object.assign({},...((e==null?void 0:e.collectionDefinitions)||[]).map(S=>({[S.collectionId]:S}))),h=Object.assign({},...((i==null?void 0:i.collectionDefinitions)||[]).map(S=>({[S.collectionId]:S})));n.collectionIds=LK(Object.keys(p),Object.keys(h)),r.collectionIds=LK(Object.keys(h),Object.keys(p)),n.collectionsValue=IZ(p),r.collectionsValue=IZ(h),n.groupsCount=((T=i==null?void 0:i.collectionGroups)==null?void 0:T.length)??(0-(((w=e==null?void 0:e.collectionGroups)==null?void 0:w.length)??0)||0),r.groupsCount=n.groupsCount?-1*n.groupsCount:0;let f=n.collectionsValue.totalValue-r.collectionsValue.totalValue,m=n.collectionsValue.totalMatchUps-r.collectionsValue.totalMatchUps,g=r.collectionsValue.assignmentValues.length!==n.collectionsValue.assignmentValues.length,v=r.collectionsValue.assignmentValues.some((S,U)=>{let P=n.collectionsValue.assignmentValues[U];return!P||S.valueKey!==P.valueKey||S.value!==P.value?!0:Array.isArray(S.value)?S.value.every((E,R)=>P.value[R]===E):!1}),y=u||d||l!==s||g||v||f!==0,b=[...r.collectionsValue.invalidValues,...n.collectionsValue.invalidValues],I=b.length&&b;return{matchUpFormatDifferences:c,matchUpCountDifference:m,descendantDifferences:n,ancestorDifferences:r,orderDifference:d,valueDifference:f,nameDifference:u,descendantDesc:s,ancestorDesc:l,...de,different:y,invalid:I}}function IZ(t){let e=[],i=[],n=0;return{totalValue:Object.keys(t).sort(Jx).reduce((r,a)=>{let s=t[a],{collectionValueProfiles:o,collectionValue:l,matchUpCount:c,matchUpValue:u,scoreValue:d,setValue:p}=s,h={collectionValueProfiles:o,collectionValue:l,matchUpValue:u,scoreValue:d,setValue:p},f=Object.keys(h).filter(g=>![void 0,null].includes(h[g])&&(!Array.isArray(h[g])||h[g].length>0));f.length!==1&&e.push({collectionId:a});let m=f[0];if(m){let g=m==="collectionValueProfiles"?Object.values(o):h[m];i.push({valueKey:m,value:g})}return n+=c,o!=null&&o.length?r+o.reduce((g,v)=>g+v.value,0):c?Ii(u)?r+u*c:Ii(d)?r+d*c:Ii(p)?r+p*c:r+l:r},0),totalMatchUps:n,invalidValues:e,assignmentValues:i}}function TW(t){Object.assign(t,{inContext:!0});let{matchUp:e,error:i}=que(t);return{matchUp:_t(e,!0,!0),error:i}}function que({participantsProfile:t,afterRecoveryTimes:e,tournamentRecord:i,contextContent:n,contextProfile:r,drawDefinition:a,nextMatchUps:s,matchUpId:o,inContext:l,eventId:c,drawId:u,event:d}){var f;if(!i)return{error:ut};if(typeof o!="string")return{error:Ks};if(!a||!d){let m=(Wa({tournamentRecord:i,nextMatchUps:s}).matchUps??[]).find(g=>g.matchUpId===o);if(!m)return{error:_s};({eventId:c,drawId:u}=m),{event:d,drawDefinition:a}=jo({tournamentRecord:i,eventId:c,drawId:u})}if(!a)return{error:tc};r&&!n&&(n=Sm({tournamentRecord:i,contextProfile:r}));let p={surfaceCategory:(d==null?void 0:d.surfaceCategory)??i.surfaceCategory,indoorOutDoor:(d==null?void 0:d.indoorOutdoor)??i.indoorOutdoor,endDate:(d==null?void 0:d.endDate)??i.endDate,tournamentId:i.tournamentId,eventId:c??(d==null?void 0:d.eventId),drawId:u},{participants:h=[]}=Ly({participantsProfile:t,tournamentRecord:i,contextProfile:r,inContext:l});if(s){let m=(lo({context:l?p:void 0,participants:h,afterRecoveryTimes:e,contextContent:n,contextProfile:r,drawDefinition:a,nextMatchUps:s,inContext:l,event:d}).matchUps??[]).find(v=>v.matchUpId===o);if(!m)return{error:_s};let g=(f=a==null?void 0:a.structures)==null?void 0:f.find(v=>v.structureId===m.structureId);return{drawDefinition:a,structure:g,matchUp:m}}else{let{matchUp:m,structure:g}=ar({context:l?p:void 0,tournamentParticipants:h,afterRecoveryTimes:e,contextContent:n,drawDefinition:a,contextProfile:r,matchUpId:o,inContext:l,event:d});return{matchUp:m,structure:g,drawDefinition:a}}}function EO({tournamentRecord:t,drawDefinition:e,structureId:i,matchUpId:n,structure:r,eventId:a,drawId:s,event:o}){var h,f,m,g,v;if(!t)return{error:ut};if(!s&&!o&&!i&&!n)return he({result:{error:ai},stack:"getTieFormat"});a&&!o&&(o=(h=t.events)==null?void 0:h.find(y=>y.eventId===a));let l=TW({tournamentRecord:t,drawDefinition:e,matchUpId:n,drawId:s,event:o});if(n&&(l!=null&&l.error))return l;if(!e&&(l!=null&&l.drawDefinition)&&(e=l==null?void 0:l.drawDefinition),r=r??(l==null?void 0:l.structure),!r&&i&&!n){if(!e)return{error:Vd};let y=hi({drawDefinition:e,structureId:i});if(y.error)return y;r=y.structure}let c=((r==null?void 0:r.tieFormat)||(r==null?void 0:r.tieFormatId))&&((f=qs({structure:r,drawDefinition:e,event:o}))==null?void 0:f.tieFormat),u=((e==null?void 0:e.tieFormat)||(e==null?void 0:e.tieFormatId))&&((m=qs({drawDefinition:e,event:o}))==null?void 0:m.tieFormat),d=(g=qs({event:o}))==null?void 0:g.tieFormat,p=(v=qs({matchUp:l==null?void 0:l.matchUp,drawDefinition:e,structure:r,event:o}))==null?void 0:v.tieFormat;return{...de,matchUp:l==null?void 0:l.matchUp,structureDefaultTieFormat:cs(c),eventDefaultTieFormat:cs(d),drawDefaultTieFormat:cs(u),tieFormat:cs(p),structure:r}}var Wue={};Li(Wue,{bulkUpdatePublishedEventIds:()=>UW,getAllEventData:()=>DW,getCourtInfo:()=>Yx,getDrawData:()=>PO,getEventData:()=>CO,getEventPublishStatus:()=>iu,getPublishState:()=>aw,getTournamentPublishStatus:()=>cC,getVenueData:()=>GS});function UW({tournamentRecord:t,outcomes:e}){var r;if(!t)return{error:ut};if(!(e!=null&&e.length))return{error:ai,info:"Missing outcomes"};let i=e.reduce((a,s)=>{let{drawId:o,eventId:l}=s;return l&&o&&(a[l]?a[l].includes(o)||a[l].push(o):a[l]=[o]),a},{}),n=Object.keys(i);return{publishedEventIds:((r=t.events)==null?void 0:r.filter(a=>n.includes(a.eventId))).filter(a=>{let s=iu({event:a}),{drawDetails:o,drawIds:l}=s??{},{eventId:c}=a;return i[c].filter(u=>{let d=o?Object.keys(s.drawDetails).filter(p=>a3({drawId:p,drawDetails:o})):[];return(l==null?void 0:l.includes(u))||d.includes(u)}).length}).map(a=>a.eventId),eventIdPublishedDrawIdsMap:i}}function Yue({dates:t=[],extension:e}){var n;if(!e)return!1;if(typeof e.value=="boolean"&&e.value)return!0;if(!t.length)return!1;let i=Xi(e.value)?(n=e.value)==null?void 0:n.dates:void 0;if(Array.isArray(i))return i!=null&&i.length?!!i.filter(r=>!t.length||t.includes(r)).length:!1}function Kue({convertExtensions:t,ignoreDisabled:e,venue:i,court:n}){var s;let r={..._t(n,t,!0),venueId:i.venueId},{extension:a}=ki({name:Ud,element:n});if(e&&a){let o=Xi(a.value)?(s=a.value)==null?void 0:s.dates:void 0,l=(a==null?void 0:a.value)===!0?[]:r.dateAvailability.map(c=>{let u=c.date;if(!(!u||o.includes(u)))return c}).filter(Boolean);r.dateAvailability=l}return{inContextCourt:r}}function Um(t){let{convertExtensions:e,ignoreDisabled:i,venueIds:n=[],dates:r}=t,a=t.tournamentRecords||t.tournamentRecord&&{[t.tournamentRecord.tournamentId]:t.tournamentRecord}||{},s=[],o=[],l=[],c=[];return Object.keys(a).filter(u=>!t.tournamentId||u===t.tournamentId).forEach(u=>{let d=a[u];for(let p of d.venues??[])if(!(n.length&&!n.includes(p.venueId))){if(i){let{extension:h}=ki({name:Ud,element:p});if(h!=null&&h.value)continue}s.includes(p.venueId)||(c.push(_t(p,e,!0)),s.push(p.venueId));for(let h of p.courts??[])if(!o.includes(h.courtId)){if(i){let{extension:m}=ki({name:Ud,element:h});if(Yue({extension:m,dates:r}))continue}let{inContextCourt:f}=Kue({convertExtensions:e,ignoreDisabled:i,venue:p,court:h});l.push(f),o.push(h.courtId)}}}),{courts:l,venues:c,...de}}function yLe({convertExtensions:t,tournamentRecord:e,ignoreDisabled:i,dates:n}){if(!e)return{error:wr};let r=_t(e.venues??[],t).filter(s=>{if(!i)return s;let{extension:o}=ki({name:Ud,element:s});return!(o!=null&&o.value)&&s}).filter(Boolean),a=r.reduce((s,o)=>{let l=((o==null?void 0:o.courts)||[]).filter(c=>{if(!i&&!(n!=null&&n.length))return c;let{extension:u}=ki({name:Ud,element:c});return Yue({extension:u,dates:n})}).filter(Boolean).map(c=>{let{inContextCourt:u}=Kue({convertExtensions:t,ignoreDisabled:i,venue:o,court:c});return u});return l.length?s.concat(l):s},[]);return{venues:r,courts:a}}function RC({tournamentRecords:t,requireCourts:e,dates:i}){return typeof t!="object"||!Object.keys(t).length?{error:wr}:Object.keys(t).reduce((n,r)=>{let a=t[r],{venues:s}=yLe({tournamentRecord:a,dates:i});return s==null||s.forEach(o=>{let{venueId:l,courts:c}=o;(!e||c!=null&&c.length)&&!n.venueIds.includes(l)&&(n.venues.push(o),n.venueIds.push(l))}),n},{venues:[],venueIds:[]})}function DW({tournamentRecord:t,policyDefinitions:e}){if(!t)return{error:ut};let i=t.events||[],n=(t==null?void 0:t.participants)||[],{tournamentInfo:r}=pw({tournamentRecord:t}),{venues:a}=Um({tournamentRecord:t}),s=i.map(o=>{let{eventId:l}=o,c=Gue({event:o}).eventInfo,u=YP({tournamentRecord:t,event:o}).scheduleTiming,d=(o.drawDefinitions||[]).map(h=>{let f=(({drawId:b,drawName:I,matchUpFormat:T,updatedAt:w})=>({matchUpFormat:T,updatedAt:w,drawName:I,drawId:b}))(h),{abandonedMatchUps:m,completedMatchUps:g,upcomingMatchUps:v,pendingMatchUps:y}=dU({requireParticipants:!0,tournamentParticipants:n,context:{eventId:l},policyDefinitions:e,tournamentRecord:t,inContext:!0,scheduleTiming:u,drawDefinition:h,event:o});return{drawInfo:f,matchUps:{abandonedMatchUps:m,completedMatchUps:g,upcomingMatchUps:v,pendingMatchUps:y}}}),p=iu({event:o});return Object.assign(c,{drawsData:d,publish:p}),c});return{allEventData:{tournamentInfo:r,venuesData:a,eventsData:s}}}function Zue({publishStatus:t,drawId:e}){var i,n,r;return t!=null&&t.drawDetails?(r=(n=(i=t.drawDetails)==null?void 0:i[e])==null?void 0:n.publishingDetail)==null?void 0:r.published:t!=null&&t.drawIds?t.drawIds.includes(e):!0}var Xue="PUBLIC",bLe="ADMIN",Jue={PUBLIC_DISPLAY:Xue,ADMIN_DISPLAY:bLe};function PO(t){var C,M,_;let{tournamentParticipants:e=[],includePositionAssignments:i,policyDefinitions:n,tournamentRecord:r,inContext:a=!0,usePublishState:s,status:o=hc,pressureRating:l,refreshResults:c,contextProfile:u,drawDefinition:d,noDeepCopy:p,sortConfig:h,context:f,event:m}=t;if(!d)return{error:Gt};let g=(({matchUpFormat:A,updatedAt:N,drawType:k,drawName:O,drawId:$})=>({matchUpFormat:A,updatedAt:N,drawName:O,drawType:k,drawId:$}))(d);g.display=(C=ki({element:d,name:jA}).extension)==null?void 0:C.value;let v={},y,{allStructuresLinked:b,sourceStructureIds:I,hasDrawFeedProfile:T,structureGroups:w}=nO({drawDefinition:d});if(!b)return{error:Ore};let S=(t==null?void 0:t.publishStatus)??iu({event:m,status:o}),U=t.eventPublished??!!((_=(M=aw({event:m}).publishState)==null?void 0:M.status)!=null&&_.published),P=!1,E=!1,R=w.map(A=>{let N={},k=A.map(O=>{let{structure:$}=hi({drawDefinition:d,structureId:O}),{seedAssignments:F}=qc({drawDefinition:d,structure:$});return($==null?void 0:$.stage)===Ft&&$.stageSequence===1&&(y=F),($==null?void 0:$.stage)===ni&&(v[$.stageSequence??0]=F),$}).sort((O,$)=>ZI(O,$,h)).map(O=>{var J,se;if(!O)return;let $=O==null?void 0:O.structureId,F=[];O.stage&&[Ft,bs,Rr].includes(O.stage)&&(F=y),(O==null?void 0:O.stage)===ni&&(F=v[O.stageSequence??0]);let{matchUps:V,roundMatchUps:j,roundProfile:B}=wn({seedAssignments:(J=O==null?void 0:O.seedAssignments)!=null&&J.length?void 0:F,context:{drawId:g.drawId,...f},hydrateParticipants:t.hydrateParticipants,participantsProfile:t.participantsProfile,tournamentParticipants:e,policyDefinitions:n,tournamentRecord:r,usePublishState:s,publishStatus:S,contextProfile:u,drawDefinition:d,inContext:a,structure:O,event:m}),{positionAssignments:z}=jn({structure:O}),W=z==null?void 0:z.filter(kl(Lh)).map(ie=>{var le,ne;let ce=(ne=(le=ki({element:ie,name:cg}))==null?void 0:le.extension)==null?void 0:ne.value,{drawPosition:oe,participantId:te}=ie;return E=!0,{participantResult:ce,participantId:te,drawPosition:oe}});if(V.length&&(!(W!=null&&W.length)&&t.allParticipantResults||c&&!O.structures)){let{subOrderMap:ie}=oce({positionAssignments:z}),ce=V.some(te=>te.matchUpType===ec)?V.filter(te=>te.matchUpType===ec):V,oe=vU({matchUpFormat:O.matchUpFormat,matchUps:ce,policyDefinitions:n,pressureRating:l,subOrderMap:ie});W=z==null?void 0:z.filter(kl(Lh)).map(te=>{var me;let{drawPosition:le,participantId:ne}=te;return E=!0,{participantResult:ne&&((me=oe==null?void 0:oe.participantResults)==null?void 0:me[ne]),participantId:ne,drawPosition:le}})}let Z=O?(({stageSequence:ie,structureName:ce,structureType:oe,matchUpFormat:te,stage:le})=>({stageSequence:ie,structureName:ce,structureType:oe,matchUpFormat:te,stage:le}))(O):{},K=(se=ki({element:O,name:jA}).extension)==null?void 0:se.value;Z.display=(K==null?void 0:K[Xue])??K,Z.sourceStructureIds=I[$],Z.hasDrawFeedProfile=T[$],Z.positionAssignments=z,Z.structureActive=V.reduce((ie,ce)=>{var te;let oe=[Yr,sa,td,Lr,zp,Yi,as,cn].includes(ce.matchUpStatus);return ie||oe||!!ce.winningSide||!!((te=ce.score)!=null&&te.scoreStringSide1)},!1);let Q=V.reduce((ie,ce)=>ie&&[mn,Lr,as,cn,Yi,sl].includes(ce.matchUpStatus),!!V.length);return Z.structureCompleted=Q,N[$]=Q,Z.structureActive&&(P=!0),{...Z,participantResults:W,seedAssignments:F,roundMatchUps:j,roundProfile:B,structureId:$}});return k.forEach(O=>{var $;i||delete O.positionAssignments,O.sourceStructuresComplete=($=O.sourceStructureIds)==null?void 0:$.every(F=>N[F])}),k}).flat();return g.drawActive=P,g.participantPlacements=E,g.drawGenerated=R==null?void 0:R.reduce((A,N)=>A||!!(N!=null&&N.roundMatchUps),!1),g.drawCompleted=R==null?void 0:R.reduce((A,N)=>A&&N.structureCompleted,!0),g.drawPublished=s?U&&Zue({publishStatus:S,drawId:g.drawId}):void 0,{structures:!s||g.drawPublished?p&&R||_t(R,!1,!0):void 0,drawInfo:p?g:_t(g,!1,!0),...de}}function CO(t){var M,_,A;let{includePositionAssignments:e,participantsProfile:i,policyDefinitions:n,usePublishState:r,status:a=hc,contextProfile:s,sortConfig:o}=t,l=Qt(t,[{tournamentRecord:!0},{[dq]:{event:!1,eventId:!1}}]);if(l.error)return l;let c=_t(t.tournamentRecord,!1,!0),u=t.event?void 0:jo({tournamentRecord:c,eventId:t.eventId}).event,d=t.event?_t(t.event,!1,!0):u&&_t(u,!1,!0)||void 0;if(!d)return{error:Gc};let{eventId:p}=d,{tournamentId:h,endDate:f}=c,m=iu({event:d,status:a}),g=aw({event:d}).publishState??{},v=!!((M=g==null?void 0:g.status)!=null&&M.published),{participants:y}=vr({withGroupings:!0,withEvents:!1,withDraws:!1,policyDefinitions:n,...i,tournamentRecord:c}),b=({stage:N,drawId:k})=>{var $,F,V;if(!r)return!0;let O=(F=($=m==null?void 0:m.drawDetails)==null?void 0:$[k])==null?void 0:F.stageDetails;return!O||!Object.keys(O).length?!0:(V=O[N])==null?void 0:V.published},I=({structureId:N,drawId:k})=>{var $,F,V;if(!r)return!0;let O=(F=($=m==null?void 0:m.drawDetails)==null?void 0:$[k])==null?void 0:F.structureDetails;return!O||!Object.keys(O).length?!0:(V=O[N])==null?void 0:V.published},T=({drawId:N})=>r?Zue({publishStatus:m,drawId:N}):!0,w=({drawId:N,structure:k})=>{var $,F,V,j;if(!r)return k;let O=(j=(V=(F=($=m==null?void 0:m.drawDetails)==null?void 0:$[N])==null?void 0:F.structureDetails)==null?void 0:V[k.structureId])==null?void 0:j.roundLimit;if(Ii(O)){let B=Rt(1,O+1),z={},W={};for(let Z of B)k.roundMatchUps[Z]&&(z[Z]=k.roundMatchUps[Z],W[Z]=k.roundProfile[Z]);k.roundMatchUps=z,k.roundProfile=W}return k},S=d.drawDefinitions||[],U=!r||v?S.filter(T).map(N=>(({drawInfo:k,structures:O})=>({...k,structures:O}))(PO({allParticipantResults:t.allParticipantResults,hydrateParticipants:t.hydrateParticipants,context:{eventId:p,tournamentId:h,endDate:f},pressureRating:t.pressureRating,refreshResults:t.refreshResults,includePositionAssignments:e,tournamentParticipants:y,noDeepCopy:!0,policyDefinitions:n,tournamentRecord:c,usePublishState:r,contextProfile:s,drawDefinition:N,publishStatus:m,sortConfig:o,event:d}))).map(({structures:N,...k})=>{let O=N==null?void 0:N.filter(({stage:$,structureId:F})=>I({structureId:F,drawId:k.drawId})&&b({stage:$,drawId:k.drawId})).map($=>w({drawId:k.drawId,structure:$}));return{...k,structures:O}}).filter(N=>{var k;return(k=N.structures)==null?void 0:k.length}):void 0,P=(Array.isArray(c.venues)?c.venues:[]).map(N=>(({venueData:k})=>({...k}))(GS({venueId:N.venueId,tournamentRecord:c}))),E=(({eventId:N,eventName:k,eventType:O,eventLevel:$,surfaceCategory:F,matchUpFormat:V,category:j,gender:B,startDate:z,endDate:W,ballType:Z,discipline:K})=>({eventId:N,eventName:k,eventType:O,eventLevel:$,surfaceCategory:F,matchUpFormat:V,category:j,gender:B,startDate:z,endDate:W,ballType:Z,discipline:K}))(d);E.display=(_=ki({element:d,name:jA}).extension)==null?void 0:_.value;let{tournamentInfo:R}=pw({tournamentRecord:c}),C={tournamentInfo:R,venuesData:P,eventInfo:E,drawsData:U};return C.eventInfo.publishState=g,C.eventInfo.published=(A=g==null?void 0:g.status)==null?void 0:A.published,{...de,eventData:C,participants:y}}var Que={};Li(Que,{courtGridRows:()=>_O,findVenue:()=>Xh,getMatchUpsToSchedule:()=>RO,getPersonRequests:()=>zy,getProfileRounds:()=>AO,getScheduledRoundsDetails:()=>MC,getSchedulingProfile:()=>Dm,getSchedulingProfileIssues:()=>EW,publicFindCourt:()=>t3});function YS({matchUpPotentialParticipantIds:t,matchUpNotBeforeTimes:e,timeAfterRecovery:i,matchUp:n}){var c,u,d,p;let{individualParticipantIds:r}=Bx(n);i=i??((c=n.schedule)==null?void 0:c.timeAfterRecovery);let a=h=>{t[h]||(t[h]=[]),t[h]=Ei(t[h].concat(...r))},s=h=>{i&&(!e[h]||i>e[h])&&(e[h]=i)},o=((u=n.winnerTo)==null?void 0:u.matchUpId)||n.winnerMatchUpId;o&&(i&&s(o),a(o));let l=((d=n.loserTo)==null?void 0:d.matchUpId)||n.loserMatchUpId;l&&(i&&s(l),a(l)),(p=n.sidesTo)!=null&&p.length&&n.sidesTo.forEach(({matchUpId:h})=>{h&&(i&&s(h),a(h))})}function RO(t){let e=Qt(t,[{[cq]:!0}]);if(e.error)return e;let{matchUpPotentialParticipantIds:i,dateScheduledMatchUpIds:n=[],scheduleCompletedMatchUps:r,matchUpNotBeforeTimes:a,matchUpScheduleTimes:s,orderedMatchUpIds:o,clearDate:l,matchUps:c}=t,u=s?Object.keys(s):[],d=(o??[]).map(h=>c.find(f=>f.matchUpId===h)).filter(Boolean).filter(h=>{let f=!l&&(n.includes(h.matchUpId)||u.includes(h.matchUpId)),m=[mn,Yi,Lr,sl,as,cn,Yr,sa].includes(h==null?void 0:h.matchUpStatus);return r||!f&&!h.winningSide&&!m}),p=i&&a?d.reduce((h,f)=>{let{drawId:m,tournamentId:g}=f;return h.matchUpMap[g]||(h.matchUpMap[g]={}),h.matchUpMap[g][m]?h.matchUpMap[g][m].push(f):h.matchUpMap[g][m]=[f],YS({matchUpPotentialParticipantIds:i,matchUpNotBeforeTimes:a,matchUp:f}),h},{matchUpMap:{}}).matchUpMap:{};return{matchUpsToSchedule:d,matchUpMap:p}}function MO({defaultRecoveryMinutes:t=0,defaultAverageMinutes:e,tournamentRecords:i,matchUpFormat:n,categoryName:r,categoryType:a,tournamentId:s,eventType:o,eventId:l}){if(!Nl({matchUpFormat:n}))return{error:NP};let c=Object.keys(i).filter(d=>!s||d===s),u;return c.forEach(d=>{var f;if(u)return;let p=i[d],h=l?(f=jo({tournamentRecord:p,eventId:l}))==null?void 0:f.event:void 0;return u=nC({tournamentRecord:p,matchUpFormat:n,categoryName:r,categoryType:a,eventType:o,event:h}),(u==null?void 0:u.averageMinutes)||(u==null?void 0:u.recoveryMinutes)}),{recoveryMinutes:(u==null?void 0:u.recoveryMinutes)||t,averageMinutes:(u==null?void 0:u.averageMinutes)||e,typeChangeRecoveryMinutes:(u==null?void 0:u.typeChangeRecoveryMinutes)||(u==null?void 0:u.recoveryMinutes)||t}}function MC(t){let e=Qt(t,[{[dq]:{tournamentRecords:!1,tournamentRecord:!1}},{rounds:!0,[qo]:Rs}]);if(e.error)return e;let{scheduleCompletedMatchUps:i,periodLength:n=30}=t,r=t.tournamentRecords||t.tournamentRecord&&{[t.tournamentRecord.tournamentId]:t.tournamentRecord}||{};if(typeof r!="object")return{error:wr};let a={},s=[],o=t.rounds.toSorted((f,m)=>(f.sortOrder??0)-(m.sortOrder??0)),l=t.containedStructureIds??Object.assign({},...Object.values(r).map(f=>cU({tournamentRecord:f}).containedStructures)),c=t.matchUps??_d({nextMatchUps:!0,tournamentRecords:r}).matchUps,u=0,d={},p={},h={};return{scheduledRoundsDetails:o.flatMap(f=>{var S;let m=f.periodLength||n,g=[];l!=null&&l[f.structureId]?g.push(...l[f.structureId]):g.push(f.structureId);let v=c?Df({tournamentIds:[f.tournamentId],roundNumbers:[f.roundNumber],matchUpIds:f.matchUpIds,eventIds:[f.eventId],drawIds:[f.drawId],processContext:!0,structureIds:g,matchUps:c}).sort(rw):[],{segmentNumber:y,segmentsCount:b}=f.roundSegment||{};if(Ii(y)&&Rd(v==null?void 0:v.length)&&Rd(b)&&y>0&&y<=b&&b<(v==null?void 0:v.length)&&!((S=f.matchUpIds)!=null&&S.length)){let U=v.length/b,P=U*(y-1);v=v.slice(P,P+U)}let I=r[f.tournamentId],T=jo({drawId:f.drawId,tournamentRecord:I}).event,w=[];for(let U of v){let P=U.matchUpFormat;P&&(a[P]||(a[P]=[],a[P].push(U)),w.push(P))}for(let U of w){let{eventType:P,category:E}=T??{},{categoryName:R,ageCategoryCode:C}=E??{},{typeChangeRecoveryMinutes:M,recoveryMinutes:_,averageMinutes:A,error:N}=MO({categoryName:R??C,categoryType:E==null?void 0:E.categoryType,tournamentId:f.tournamentId,eventId:f.eventId,tournamentRecords:r,matchUpFormat:U,eventType:P});if(N)return{error:N,round:f};let k=v.filter($=>(i||!ca.includes($.matchUpStatus))&&$.matchUpStatus!==mn).map(Pa);k.forEach($=>{h[$]={typeChangeRecoveryMinutes:M,recoveryMinutes:_,averageMinutes:A},d[$]=_,p[$]=A}),s.push(...k),u=Math.max(A||0,u);let O=`${A}|${m}`;return{roundPeriodLength:m,recoveryMinutes:_,averageMinutes:A,matchUpIds:k,hash:O}}}),greatestAverageMinutes:u,matchUpFormatCohorts:a,recoveryMinutesMap:d,averageMinutesMap:p,orderedMatchUpIds:s,minutesMap:h,...de}}function ede({schedulingProfile:t,venueIds:e,eventIds:i,drawIds:n}){let r=[],a=t==null?void 0:t.map(o=>{let l=Ri(o==null?void 0:o.scheduleDate);if(!l){r.push(`Invalid date: ${o==null?void 0:o.scheduledDate}`);return}let c=((o==null?void 0:o.venues)||[]).map(u=>{let{rounds:d,venueId:p}=u;if(!(e!=null&&e.includes(p))){r.push(`Missing venueId: ${p}`);return}let h=d.filter(f=>{let m=i.includes(f.eventId)&&n.includes(f.drawId);return m||r.push(`Invalid eventId: ${f.eventId} or drawId: ${f.drawId}`),m});if(h.length)return{venueId:p,rounds:h}}).filter(Boolean);return c.length&&l&&{...o,venues:c}}).filter(Boolean),s=r.length;return{updatedSchedulingProfile:a,modifications:s,issues:r}}function NO({tournamentRecords:t,schedulingProfile:e}){if(!e)return{valid:!0};if(!Array.isArray(e))return{valid:!1,error:Re};let{venueIds:i,tournamentsMap:n}=wLe({tournamentRecords:t}),r,a,s=e.every(o=>{let{scheduleDate:l,venues:c}=o;return El(l)?c.every(u=>{let{venueId:d,rounds:p}=u;return typeof d!="string"?(a="venueId should be a string",!1):Array.isArray(p)?i.includes(d)?!!p.every(h=>{var U,P,E,R;if(!h)return a="empty round",!1;let{roundSegment:f,tournamentId:m,structureId:g,roundNumber:v,eventId:y,drawId:b}=h,I=(R=(E=(P=(U=n==null?void 0:n[m])==null?void 0:U[y])==null?void 0:P[b])==null?void 0:E[g])==null?void 0:R.includes(v);I||(a="Invalid rounds");let{segmentNumber:T,segmentsCount:w}=f||{},S=!f||Ii(T)&&Rd(w)&&T<=w;return S||(a="Invalid segment"),I&&S}):(r=HI,!1):(a="rounds should be an array",!1)}):!1});return!s&&!r&&(r=Re),{valid:!!s,error:r,info:a}}function ILe(t){let{tournamentRecord:e={},tournamentMap:i={},requireCourts:n}=t,r=[],a=[],s=[],o=[],l=((e==null?void 0:e.venues)||[]).map(({venueId:u,courts:d})=>(!n||(d==null?void 0:d.length))&&u),c=e==null?void 0:e.tournamentId;return c&&(r.push(c),i[c]={},((e==null?void 0:e.events)||[]).forEach(u=>{let d=u.eventId;s.push(d),i[c][d]={},(u.drawDefinitions||[]).forEach(p=>{let h=p.drawId;o.push(h),i[c][d][h]={};let{structures:f}=Wu({drawDefinition:p});(f||[]).forEach(m=>{var I;let g=m.structureId,{matchUps:v}=wn({structure:m}),{roundMatchUps:y}=fo({matchUps:v}),b=y&&Object.keys(y).map(T=>parseInt(T));i[c][d][h][g]=b,a.push(g),(I=m.structures)!=null&&I.length&&m.structures.forEach(T=>{a.push(T.structureId),i[c][d][h][T.structureId]=b})})})})),{tournamentMap:i,tournamentIds:r,structureIds:a,venueIds:l,eventIds:s,drawIds:o}}function wLe(t){let e=(t==null?void 0:t.tournamentRecords)&&Object.values(t==null?void 0:t.tournamentRecords)||[],i={},{venueIds:n,eventIds:r,drawIds:a,structureIds:s,tournamentIds:o}=e.reduce((l,c)=>{let{tournamentIds:u,tournamentMap:d,structureIds:p,venueIds:h,eventIds:f,drawIds:m}=ILe({tournamentRecord:c});return h.forEach(g=>{l.venueIds.includes(g)||l.venueIds.push(g)}),l.tournamentIds.push(...u),l.structureIds.push(...p),l.eventIds.push(...f),l.drawIds.push(...m),Object.assign(i,d),l},{tournamentIds:[],structureIds:[],venueIds:[],eventIds:[],drawIds:[]});return{tournamentsMap:i,tournamentIds:o,structureIds:s,venueIds:n,eventIds:r,drawIds:a}}function Dm({tournamentRecords:t,tournamentRecord:e}){if(typeof t!="object"||!Object.keys(t).length)return{error:wr};let{extension:i}=ki({element:e,name:dI,tournamentRecords:t,discover:!0}),n=(i==null?void 0:i.value)||[];if(n.length){let{venueIds:r}=RC({requireCourts:!0,tournamentRecords:t}),{eventIds:a,drawIds:s}=L3({tournamentRecords:t}),{updatedSchedulingProfile:o,modifications:l,issues:c}=ede({schedulingProfile:n,venueIds:r,eventIds:a,drawIds:s});if(l){n=o;let u=yU({tournamentRecords:t,tournamentRecord:e,schedulingProfile:n});return u.error?u:{schedulingProfile:n,modifications:l,issues:c}}}return{schedulingProfile:n,modifications:0}}function yU({tournamentRecords:t,tournamentRecord:e,schedulingProfile:i}){let n=NO({tournamentRecords:t,schedulingProfile:i});return n.error?n:i?dn({tournamentRecords:t,discover:!0,extension:{name:dI,value:i}}):oo({element:e,name:dI,tournamentRecords:t,discover:!0})}function NC(t){let{tournamentRecord:e}=t,i=t.tournamentRecords||e&&{[e.tournamentId]:e}||{};if(!t.schedulingProfile){let{modifications:c,issues:u}=Dm({tournamentRecords:i,tournamentRecord:e});return{success:!c,modifications:c,issues:u}}let{venueIds:n}=RC({tournamentRecords:i}),{eventIds:r,drawIds:a}=L3({tournamentRecords:i}),{updatedSchedulingProfile:s,modifications:o,issues:l}=ede({schedulingProfile:t.schedulingProfile,venueIds:n,eventIds:r,drawIds:a});return o?{...yU({schedulingProfile:s,tournamentRecords:i}),modifications:o,issues:l}:{...de,modifications:o,issues:l}}function EW(t){let{scheduleDates:e=[],tournamentRecords:i,periodLength:n=30}=t??{};if(typeof i!="object")return{error:CP};if(!Array.isArray(e))return{error:Re};if(!e.every(El))return{error:Fa};let r=[],a=0,s={},{schedulingProfile:o}=Dm({tournamentRecords:i});if(!o)return{issues:r,...de};let{matchUps:l}=_d({nextMatchUps:!0,tournamentRecords:i});for(let u of o){let{scheduleDate:d,venues:p=[]}=u;if(!(e!=null&&e.length)||e.includes(d)){for(let h of p||[])if(h){let{rounds:f}=h,m=[],{orderedMatchUpIds:g,scheduledRoundsDetails:v}=MC({tournamentRecords:i,periodLength:n,matchUps:l,rounds:f}),{matchUpDependencies:y}=rd({tournamentRecords:i,matchUps:l}),b=I=>{let T;return v==null||v.find((w,S)=>{let U=w.matchUpIds.includes(I);return U&&(T=S),U}),T};if(g==null||g.forEach((I,T)=>{var U;let w=g.slice(T+1),S=Nr(w,((U=y==null?void 0:y[I])==null?void 0:U.matchUpIds)||[]);S.length&&m.push({matchUpId:I,shouldBeAfter:S})}),m.length){a+=m.length;let I=m.map(({matchUpId:T,shouldBeAfter:w})=>{let S=b(T),U=Ei(w.map(b));return s[d]||(s[d]={}),s[d][S]||(s[d][S]=[]),U.forEach(P=>{s[d][S].includes(P)||s[d][S].push(P)}),{matchUpId:T,matchUpRoundIndex:S,earlierRoundIndices:U,shouldBeAfter:w}});r.push(...I)}}}}let c={matchUpIdShouldBeAfter:Object.assign({},...r.map(u=>{let{matchUpId:d,shouldBeAfter:p,earlierRoundIndices:h}=u;return{[d]:{earlierRoundIndices:h,shouldBeAfter:p}}}))};return{issuesCount:a,profileIssues:c,roundIndexShouldBeAfter:s,...de}}function zy(t){let{tournamentRecords:e,requestType:i}=t,n=Qt(t,[{[ks]:!0}]);if(n.error)return n;let r={};for(let a of Object.values(e)){let{extension:s}=ki({element:a,name:oU}),o=(s==null?void 0:s.value)||[];for(let l of o){let{personId:c,requests:u}=l||{};r[c]||(r[c]=[]);for(let d of u)i&&d.requestType!==i||r[c].push(d)}}return{personRequests:r,...de}}function oj(t){let{containerStructureId:e,roundSegment:i,isRoundRobin:n,tournamentId:r,roundNumber:a,structureId:s,eventId:o,drawId:l}=t,c=n?e:s,u=[r,o,l,c,a].join("|");return Kt({structureId:c,roundSegment:i,tournamentId:r,roundNumber:a,eventId:o,drawId:l,id:u})}function wZ({round:t,matchUps:e,events:i,tournamentRecords:n}){let r=i.find(p=>p.eventId===t.eventId),{eventType:a,category:s,categoryType:o}=r||{},{categoryName:l,ageCategoryCode:c}=s||{},u=Ml(e.map(({matchUpFormat:p})=>p)),d=0;return Object.keys(u).forEach(p=>{let h=u[p],f=MO({categoryName:l||c,tournamentId:t.tournamentId,eventId:t.eventId,tournamentRecords:n,matchUpFormat:p,categoryType:o,eventType:a});if(f.error)return f;let m=f.averageMinutes*h;isNaN(d)||(d+=m)}),{roundMinutes:d}}function SLe(t){return(t||[]).reduce((e,i)=>{var a,s;let n=(((a=i.finishingPositionRange)==null?void 0:a.winner)||[]).reduce((o,l)=>o+l,0),r=(((s=i.finishingPositionRange)==null?void 0:s.winner)||[]).join("-")||"";return!e.minFinishingSum||n<e.minFinishingSum?{minFinishingSum:n,winnerFinishingPositionRange:r}:e},{minFinishingSum:0,winnerFinishingPositionRange:""})}function SZ(t){let e=t.length,i=t.filter(({sides:c})=>c==null?void 0:c.some(({bye:u})=>u)).length||0,n=t.filter(({winningSide:c,matchUpStatus:u})=>c||ca.includes(u)).length||0,r=t.filter(({schedule:c,matchUpStatus:u})=>(c==null?void 0:c.scheduledDate)&&(c==null?void 0:c.scheduledTime)&&u!==mn).length||0,a=e-i,s=a===n,o=a-r,l=a-r;return{unscheduledCount:o,incompleteCount:l,scheduledCount:r,completedCount:n,matchUpsCount:e,isScheduled:a===r,isComplete:s,byeCount:i}}function AO({tournamentRecords:t,schedulingProfile:e,tournamentRecord:i,withRoundId:n}){if(i&&!t){if(typeof i!="object")return{error:CP};t={[i.tournamentId]:i}}if(e){let a=NO({tournamentRecords:t,schedulingProfile:e});if(a.error)return a}if(!e&&t){let a=Dm({tournamentRecords:t});if(a.error)return a;e=a.schedulingProfile}if(!e)return{error:za};let r={};return{profileRounds:e.map(({venues:a,scheduleDate:s})=>a.map(({rounds:o})=>o.map(l=>{var u;let c=oj(l);return(u=c.roundSegment)!=null&&u.segmentsCount&&(r[c.id]=c.roundSegment.segmentsCount),Kt({id:n?c.id:void 0,scheduleDate:s,...c})}))).flat(1/0),segmentedRounds:r}}function _O({courtPrefix:t="C|",minRowsCount:e,courtsData:i}){if(!Array.isArray(i))return{error:Re};let n=i==null?void 0:i.reduce((s,o)=>{let l=o.matchUps||[],c=Math.max(0,...l.map(u=>u.schedule.courtOrder||0));return c>s?c:s},1),r=e?Math.max(e,n):n,a=Rt(0,r).map(s=>({matchUps:Rt(0,i.length).map(o=>{let l=i[o],{courtId:c,venueId:u}=l;return{schedule:{courtOrder:s+1,venueId:u,courtId:c}}})}));return i.forEach((s,o)=>{var l;for(let c of s.matchUps){let u=(l=c.schedule)==null?void 0:l.courtOrder;u&&(a[u-1].matchUps[o]=c)}}),{courtPrefix:t,rows:a.map((s,o)=>Object.assign({rowId:`rowId-${o+1}`},...s.matchUps.map((l,c)=>({[`${t}${c}`]:l}))))}}var tde={};Li(tde,{getEntriesAndSeedsCount:()=>kO,getMaxEntryPosition:()=>PW});function kO({policyDefinitions:t,drawDefinition:e,drawSize:i,drawId:n,event:r,stage:a}){if(!r)return{error:Jn};let{entries:s,stageEntries:o}=lle({drawDefinition:e,drawId:n,stage:a,event:r}),l=o.length,{drawSize:c}=kce({participantsCount:l}),u=EC({drawSize:i??c,participantsCount:l,policyDefinitions:t});if(u.error)return he({result:u,stack:"getEntriesAndSeedsCount"});let{seedsCount:d}=u;return{entries:s,seedsCount:d,stageEntries:o}}function PW(t){let{entries:e=[],entryStatus:i,stage:n}=t;return Math.max(...e.filter(r=>(!n||n===r.entryStage)&&(!i||r.entryStatus===i)&&!isNaN(r.entryPosition)).map(({entryPosition:r})=>ui(r||0)),0)}var ide={};Li(ide,{allCompetitionMatchUps:()=>_d,allDrawMatchUps:()=>lo,allEventMatchUps:()=>Jh,allTournamentMatchUps:()=>Wa,analyzeMatchUp:()=>bE,calculateWinCriteria:()=>hw,checkMatchUpIsComplete:()=>Gv,competitionScheduleMatchUps:()=>_C,drawMatchUps:()=>FW,eventMatchUps:()=>OO,filterMatchUps:()=>Df,getAllDrawMatchUps:()=>ua,getAllStructureMatchUps:()=>wn,getCheckedInParticipantIds:()=>tw,getCompetitionMatchUps:()=>yE,getEventMatchUpFormatTiming:()=>RW,getHomeParticipantId:()=>_W,getMatchUpCompetitiveProfile:()=>iC,getMatchUpContextIds:()=>kW,getMatchUpDailyLimits:()=>FO,getMatchUpDailyLimitsUpdate:()=>MW,getMatchUpDependencies:()=>rd,getMatchUpFormat:()=>xW,getMatchUpFormatTiming:()=>nC,getMatchUpFormatTimingUpdate:()=>CW,getMatchUpScheduleDetails:()=>Kx,getMatchUpType:()=>Zx,getMatchUpsStats:()=>OW,getModifiedMatchUpFormatTiming:()=>xO,getParticipantResults:()=>IC,getPredictiveAccuracy:()=>AW,getRoundMatchUps:()=>fo,getRounds:()=>LW,isValidMatchUpFormat:()=>Nl,matchUpActions:()=>pO,participantScheduledMatchUps:()=>NW,tallyParticipantResults:()=>vU,tournamentMatchUps:()=>LO,validMatchUp:()=>Gx,validMatchUps:()=>tu});function nde({tournamentRecords:t,extensionName:e}){if(typeof t!="object"||!Object.keys(t).length)return{error:wr};let i=[],n;for(let r of Object.values(t)){let{extension:a}=ki({element:r,name:e});a&&!n&&(i.push({params:{extension:a,discover:!0},method:"addExtension"}),n=!0);let s=r.events??[];for(let o of s){let{eventId:l}=o,{extension:c}=ki({name:e,element:o});c&&i.push({params:{eventId:l,extension:c},method:"addEventExtension"})}}return{methods:i}}function CW({tournamentRecords:t}){return nde({extensionName:qf,tournamentRecords:t})}var S$="ADULT",T$="JUNIOR",BM="WHEELCHAIR",rde={[$g]:{allowModificationWhenMatchUpsScheduled:{courts:!1,venues:!1},defaultTimes:{averageTimes:[{categoryNames:[],minutes:{default:90}}],recoveryTimes:[{minutes:{[Mn]:30,default:60}}]},defaultDailyLimits:{[xn]:2,[Mn]:2,total:3},matchUpAverageTimes:[{matchUpFormatCodes:[Nu],averageTimes:[{categoryNames:[],minutes:{default:90}},{categoryTypes:[BM],minutes:{default:120}}]},{matchUpFormatCodes:["SET3-S:6/TB7-F:TB10"],averageTimes:[{categoryNames:[],minutes:{default:85}}]},{matchUpFormatCodes:["SET3-S:6/TB7-F:TB7"],averageTimes:[{categoryNames:[],minutes:{default:70}}]},{matchUpFormatCodes:["SET3-S:4NOAD-F:TB7"],averageTimes:[{categoryNames:[],minutes:{default:55}}]},{matchUpFormatCodes:["SET3-S:4/TB7"],averageTimes:[{categoryNames:[],minutes:{default:60}}]},{matchUpFormatCodes:["SET3-S:4/TB7-F:TB7"],averageTimes:[{categoryNames:[],minutes:{default:50}}]},{matchUpFormatCodes:["SET3-S:4/TB7-F:TB10"],averageTimes:[{categoryNames:[],minutes:{default:55}}]},{matchUpFormatCodes:["SET3-S:4/TB5@3"],averageTimes:[{categoryNames:[],minutes:{default:45}}]},{matchUpFormatCodes:["SET1-S:8/TB7","SET1-S:8/TB7@7"],averageTimes:[{categoryNames:[],minutes:{default:40}}]},{matchUpFormatCodes:["SET1-S:5/TB9@4"],averageTimes:[{categoryNames:[],minutes:{default:30}}]},{matchUpFormatCodes:["SET1-S:6/TB7"],averageTimes:[{categoryNames:[],minutes:{default:30}}]},{matchUpFormatCodes:["SET1-S:6NOAD"],averageTimes:[{categoryNames:[],minutes:{default:30}}]},{matchUpFormatCodes:["SET1-S:4/TB7","SET1-S:4/TB5@3","SET3-S:TB10","SET1-S:T20"],averageTimes:[{categoryNames:[],minutes:{default:20}}]},{matchUpFormatCodes:["SET1-S:4NOAD"],averageTimes:[{categoryNames:[],minutes:{default:20}}]},{matchUpFormatCodes:["SET1-S:TB10"],averageTimes:[{categoryNames:[],minutes:{default:10}}]}],matchUpRecoveryTimes:[{matchUpFormatCodes:["SET3-S:6/TB7","SET3-S:6/TB7-F:TB10","SET3-S:6/TB7-F:TB7"],recoveryTimes:[{categoryTypes:[S$,BM],minutes:{default:60,[Mn]:30}},{categoryTypes:[T$],minutes:{default:60,[Mn]:60}}]},{matchUpFormatCodes:["SET3-S:4/TB7-F:TB7","SET3-S:4/TB7-F:TB10","SET3-S:4NOAD-F:TB7","SET3-S:4/TB7","SET3-S:4/TB5@3"],recoveryTimes:[{categoryTypes:[S$,BM],minutes:{default:30}},{categoryTypes:[T$],minutes:{default:60}}]},{matchUpFormatCodes:["SET1-S:8/TB7","SET1-S:8/TB7@7","SET1-S:5/TB9@4","SET1-S:6/TB7","SET1-S:6NOAD","SET1-S:4/TB7","SET1-S:4NOAD","SET3-S:TB10","SET1-S:T20"],recoveryTimes:[{categoryNames:[],minutes:{default:30}}]},{matchUpFormatCodes:["SET1-S:4/TB5@3"],recoveryTimes:[{categoryTypes:[S$,T$],minutes:{default:30}},{categoryTypes:[BM],minutes:{default:15}}]},{matchUpFormatCodes:["SET1-S:TB10"],recoveryTimes:[{categoryNames:[],minutes:{default:15}}]}],matchUpDailyLimits:[]}},TLe=rde;function RW({tournamentRecord:t,matchUpFormats:e,categoryType:i,event:n}){if(!n)return{error:Jn};let r=[],a;if(e!=null&&e.length){let d=[];r=e.map(p=>{let h=typeof p=="string"?{matchUpFormat:p}:p;if(!d.includes(h==null?void 0:h.matchUpFormat)&&Nl({matchUpFormat:h==null?void 0:h.matchUpFormat}))return d.push(h.matchUpFormat),h}).filter(Boolean)}else{let{policy:d}=Fy({policyType:zc,tournamentRecord:t,event:n});if(d!=null&&d.matchUpFormats)r=d==null?void 0:d.matchUpFormats;else{let{extension:p}=ki({name:qf,element:n}),h,f;p!=null&&p.value?{matchUpAverageTimes:h,matchUpRecoveryTimes:f}=p.value:{matchUpAverageTimes:h,matchUpRecoveryTimes:f}=TLe[$g],r=Ei([...(h||[]).map(m=>m.matchUpFormatCodes),...(f||[]).map(m=>m.matchUpFormatCodes)].flat()).map(m=>({matchUpFormat:m})),a="default scheduling policy in use"}}let{eventType:s,eventId:o,category:l}=n,c=(l==null?void 0:l.categoryName)??(l==null?void 0:l.ageCategoryCode)??o;if(!o)return{error:Jn};let u=r.map(({matchUpFormat:d,description:p})=>{let h=nC({tournamentRecord:t,matchUpFormat:d,categoryName:c,categoryType:i,eventType:s,event:n});return{matchUpFormat:d,description:p,...h}});return Kt({eventMatchUpFormatTiming:u,info:a})}function xO(t){let e=Qt(t,[{[ba]:!0},{[ds]:m=>Nl({matchUpFormat:m}),[rc]:NP,[sq]:!0}]);if(e.error)return e;let{tournamentRecord:i,matchUpFormat:n,event:r}=t,{extension:a}=ki({name:qf,element:r}),s=a==null?void 0:a.value,{extension:o}=ki({element:i,name:qf}),l=o==null?void 0:o.value,c=(s==null?void 0:s.matchUpAverageTimes)&&oD({...s,matchUpFormat:n}),u=(l==null?void 0:l.matchUpAverageTimes)&&oD({...l,matchUpFormat:n}),d=[c,u].find(m=>m),p=(s==null?void 0:s.matchUpRecoveryTimes)&&lD({...s,matchUpFormat:n}),h=(l==null?void 0:l.matchUpRecoveryTimes)&&lD({...l,matchUpFormat:n}),f=[p,h].find(m=>m);return{matchUpFormat:n,recoveryTimes:f,averageTimes:d}}function MW({tournamentRecords:t}){return nde({extensionName:GP,tournamentRecords:t})}var AC=({scheduleAttributes:t=["scheduledDate","scheduledTime"],schedule:e={}})=>!!Object.keys(e).filter(i=>t.includes(i)).filter(i=>e[i]).length;function NW({scheduleAttributes:t=["scheduledDate","scheduledTime"],matchUps:e=[]}){if(!tu(e))return{error:ym};if(!Array.isArray(t))return{error:Re};let i=e.filter(Boolean).filter(({schedule:n})=>AC({schedule:n,scheduleAttributes:t})).reduce((n,r)=>{let{schedule:a}=r,s=Ri(a==null?void 0:a.scheduledDate),o=rr(a==null?void 0:a.scheduledTime);return s&&o&&(n[s]?n[s].push(r):n[s]=[r]),n},{});return Object.keys(i).forEach(n=>{i[n].sort((r,a)=>{var s,o;return Wae(rr((s=r.schedule)==null?void 0:s.scheduledTime),rr((o=a.schedule)==null?void 0:o.scheduledTime))})}),{...de,scheduledMatchUps:i}}function ULe({tournamentRecords:t}){var n;let e={},i=[];for(let r of Object.values(t))for(let a of r.events??[]){let s=iu({event:a}),o=s==null?void 0:s.drawDetails;Xi(o)?(Object.assign(e,o),i.push(...Object.keys(o).filter(l=>a3({drawId:l,drawDetails:o})))):(n=s==null?void 0:s.drawIds)!=null&&n.length&&i.push(...s.drawIds)}return{drawIds:i,detailsMap:e}}function s_({schedulingProfile:t,matchUps:e=[]}){let i={},n=({eventId:o,drawId:l,structureId:c,roundNumber:u})=>`${o}|${l}|${c}${u}`;t!=null&&t.length&&t.map(({venues:o})=>o.map(({rounds:l})=>l)).flat().forEach(o=>{o.sort((l,c)=>(l.sortOrder||0)-(c.sortOrder||0)).forEach(({eventId:l,drawId:c,structureId:u,roundNumber:d},p)=>{let h=n({eventId:l,drawId:c,structureId:u,roundNumber:d});i[h]=p})});let r=[],a={noScheduledDate:[]};for(let o of e){let l=o.schedule||{},c=l.scheduledDate&&Ri(l.scheduledDate)||l.scheduledTime&&Ri(l.scheduledTime)||"noScheduledDate";a[c]||(a[c]=[]),a[c].push(o)}let s=Object.keys(a).sort();for(let o of s){let l=a[o],c={noScheduledTime:[]};for(let d of l){let p=d.schedule||{},h=p.scheduledTime&&rr(p.scheduledTime)||"noScheduledTime";c[h]||(c[h]=[]),c[h].push(d)}for(let d of Object.keys(c)){let p=c[d].sort((h,f)=>(h.roundNumber||0)-(f.roundNumber||0));c[d]=p}let u=Object.keys(c).sort();for(let d of u){let p=c[d];p.sort((h,f)=>{let m=i[n(h)]||0,g=i[n(f)]||0;return m-g}),r.push(...p)}}return r}function OO(t){let{participants:e,contextContent:i,participantMap:n}=t,{tournamentAppliedPolicies:r,scheduleVisibilityFilters:a,participantsProfile:s,afterRecoveryTimes:o,policyDefinitions:l,useParticipantMap:c,tournamentRecord:u,usePublishState:d,contextFilters:p,matchUpFilters:h,contextProfile:f,nextMatchUps:m,tournamentId:g,inContext:v,context:y,event:b}=t;if(!b)return{error:Jn};let{eventId:I,eventName:T,endDate:w,eventType:S,category:U,gender:P}=b??{},E={...y,...Kt({surfaceCategory:b.surfaceCategory??(u==null?void 0:u.surfaceCategory),indoorOutDoor:b.indoorOutdoor??(u==null?void 0:u.indoorOutdoor),tournamentId:g??(u==null?void 0:u.tournamentId),endDate:w??(u==null?void 0:u.endDate),eventName:T,eventType:S,category:U,eventId:I,gender:P})},R;!e&&u&&({participants:e,participantMap:n,groupInfo:R}=Ly({participantsProfile:s,policyDefinitions:l,useParticipantMap:c,tournamentRecord:u,contextProfile:f,inContext:v})),f&&!i&&(i=Sm({policyDefinitions:l,tournamentRecord:u,contextProfile:f,event:b}));let C=iu({event:b});return{...(b.drawDefinitions??[]).reduce((M,_)=>{var N;let A=dU({hydrateParticipants:t.hydrateParticipants,context:E,tournamentAppliedPolicies:r,scheduleVisibilityFilters:a,tournamentParticipants:e,participantsProfile:s,afterRecoveryTimes:o,policyDefinitions:l,tournamentRecord:u,usePublishState:d,contextContent:i,contextFilters:p,matchUpFilters:h,participantMap:n,publishStatus:C,contextProfile:f,drawDefinition:_,nextMatchUps:m,inContext:v,event:b});return(N=Object.keys(A))==null||N.forEach(k=>{Array.isArray(A[k])&&(M[k]||(M[k]=[]),M[k]=M[k].concat(A[k]))}),M},{}),...de,groupInfo:R}}function LO(t){if(!(t!=null&&t.tournamentRecord))return{error:ut};let e=t.contextContent,{scheduleVisibilityFilters:i,participantsProfile:n,afterRecoveryTimes:r,policyDefinitions:a,tournamentRecord:s,inContext:o=!0,usePublishState:l,contextFilters:c,matchUpFilters:u,contextProfile:d,nextMatchUps:p,context:h}=t,f=t.tournamentId??s.tournamentId,m=(s==null?void 0:s.events)??[],{participants:g,participantMap:v,groupInfo:y}=Ly({participantsProfile:n,policyDefinitions:a,tournamentRecord:s,contextProfile:d,inContext:o});d&&!e&&(e=Sm({policyDefinitions:a,tournamentRecord:s,contextProfile:d}));let{appliedPolicies:b}=hn({tournamentRecord:s}),I=(c==null?void 0:c.eventIds)??[];return{...m.filter(T=>!I.includes(T.eventId)).map(T=>{var S,U,P;let w={eventDrawsCount:((U=(S=_r({event:T}).flightProfile)==null?void 0:S.flights)==null?void 0:U.length)||((P=T.drawDefinitions)==null?void 0:P.length)||0,...h};return OO({hydrateParticipants:t.hydrateParticipants,context:w,tournamentAppliedPolicies:b,scheduleVisibilityFilters:i,participantsProfile:n,afterRecoveryTimes:r,policyDefinitions:a,tournamentRecord:s,usePublishState:l,contextFilters:c,contextProfile:d,contextContent:e,matchUpFilters:u,participantMap:v,participants:g,tournamentId:f,nextMatchUps:p,inContext:o,event:T})}).reduce((T,w)=>{var S;return(S=w&&Object.keys(w).filter(U=>!["success","matchUpsMap"].includes(U)))==null||S.forEach(U=>{Array.isArray(w[U])&&(T[U]||(T[U]=[]),T[U]=T[U].concat(w[U]),T.matchUpsCount!==void 0?T.matchUpsCount+=w[U].length:T.matchUpsCount=w[U].length)}),T},{matchUpsCount:0}),groupInfo:y,participants:g}}function yE({scheduleVisibilityFilters:t,hydrateParticipants:e,participantsProfile:i,tournamentRecords:n,useParticipantMap:r,policyDefinitions:a,usePublishState:s,matchUpFilters:o,contextFilters:l,nextMatchUps:c,inContext:u}){if(typeof n!="object"||!Object.keys(n).length)return{error:wr};let d=Object.keys(n).map(f=>{let m=n[f];return LO({scheduleVisibilityFilters:t,hydrateParticipants:e,participantsProfile:i,useParticipantMap:r,policyDefinitions:a,tournamentRecord:m,usePublishState:s,matchUpFilters:o,contextFilters:l,nextMatchUps:c,inContext:u})}),p={},h={};return{...d.reduce((f,m)=>(Object.keys(m).forEach(g=>{if(g==="groupInfo")Object.assign(h,m[g]);else if(g==="participants")for(let v of m[g]??[])p[v.participantId]=v;else Array.isArray(m[g])&&(f[g]||(f[g]=[]),f[g]=f[g].concat(m[g]))}),f),{}),groupInfo:h,mappedParticipants:p}}function _C(t){var M,_,A,N,k,O,$;if(typeof(t==null?void 0:t.tournamentRecords)!="object"||!Object.keys(t==null?void 0:t.tournamentRecords).length)return{error:wr};let{courts:e,venues:i}=Um(t),n=Dm(t).schedulingProfile,{sortDateMatchUps:r=!0,courtCompletedMatchUps:a,alwaysReturnCompleted:s,activeTournamentId:o,tournamentRecords:l,withCourtGridRows:c,minCourtGridRows:u,usePublishState:d,status:p=hc,sortCourtsData:h}=t,f=o??qI()??Object.keys(l)[0],m=d?cC({tournamentRecord:l[f],status:p}):void 0,g=s?yE({...t,matchUpFilters:{...t.matchUpFilters,matchUpStatuses:[Lr]},contextFilters:t.contextFilters}).completedMatchUps:[];if(d&&!((M=m==null?void 0:m.orderOfPlay)!=null&&M.published))return{completedMatchUps:g,dateMatchUps:[],courtsData:[],venues:i};let v,y;d&&({drawIds:v,detailsMap:y}=ULe({tournamentRecords:l})),v!=null&&v.length&&(t.contextFilters||(t.contextFilters={}),(_=t.contextFilters)!=null&&_.drawIds?t.contextFilters.drawIds=t.contextFilters.drawIds.filter(F=>v.includes(F)):t.contextFilters.drawIds=v),(A=m==null?void 0:m.eventIds)!=null&&A.length&&(t.matchUpFilters||(t.matchUpFilters={}),(N=t.matchUpFilters)!=null&&N.eventIds&&t.matchUpFilters.eventIds.length?t.matchUpFilters.eventIds=t.matchUpFilters.eventIds.filter(F=>m.eventIds.includes(F)):t.matchUpFilters.eventIds=m.eventIds),(k=m==null?void 0:m.scheduledDates)!=null&&k.length&&(t.matchUpFilters||(t.matchUpFilters={}),t.matchUpFilters.scheduledDates&&t.matchUpFilters.scheduledDates.length?t.matchUpFilters.scheduledDates=t.matchUpFilters.scheduledDates.filter(F=>m.scheduledDates.includes(F)):t.matchUpFilters.scheduledDates=m.scheduledDates),s&&(t.matchUpFilters||(t.matchUpFilters={}),($=(O=t.matchUpFilters)==null?void 0:O.excludeMatchUpStatuses)!=null&&$.length?t.matchUpFilters.excludeMatchUpStatuses.includes(Lr)||t.matchUpFilters.excludeMatchUpStatuses.push(Lr):t.matchUpFilters.excludeMatchUpStatuses=[Lr]);let{completedMatchUps:b,upcomingMatchUps:I,pendingMatchUps:T,groupInfo:w,mappedParticipants:S}=yE({...t,matchUpFilters:t.matchUpFilters,contextFilters:t.contextFilters}),U=[...I??[],...T??[]];y&&(!(v!=null&&v.length)||Object.keys(y).length)&&(U=U.filter(F=>{var z,W;let{drawId:V,structureId:j,stage:B}=F;if(!((W=(z=y==null?void 0:y[V])==null?void 0:z.publishingDetail)!=null&&W.published))return!1;if(y[V].stageDetails){let Z=Object.keys(y[V].stageDetails),K=Z.filter(J=>!y[V].stageDetails[J].published),Q=Z.filter(J=>y[V].stageDetails[J].published);return K.length&&K.includes(B)?!1:Q.length&&Q.includes(B)?!0:K.length&&!K.includes(B)&&!Q.length}if(y[V].structureDetails){let Z=Object.keys(y[V].structureDetails),K=Z.filter(J=>!y[V].structureDetails[J].published),Q=Z.filter(J=>y[V].structureDetails[J].published);return K.length&&K.includes(j)?!1:Q.length&&Q.includes(j)?!0:K.length&&!K.includes(j)&&!Q.length}return!0}));let P=r?s_({matchUps:U,schedulingProfile:n}):U,E=e==null?void 0:e.map(F=>{let V=C(F);return{surfaceCategory:(F==null?void 0:F.surfaceCategory)??"",matchUps:V,...F}}),R={completedMatchUps:s?g:b,mappedParticipants:t.hydrateParticipants?void 0:S,dateMatchUps:P,courtsData:E,groupInfo:w,venues:i};if(c){let{rows:F,courtPrefix:V}=_O({minRowsCount:u,courtsData:E});R.courtPrefix=V,R.rows=F}return{...R,...de};function C({courtId:F}){let V=(a?P.concat(b??[]):P).filter(j=>{var B,z,W;return((B=j.schedule)==null?void 0:B.courtId)===F||((W=(z=j.schedule)==null?void 0:z.allocatedCourts)==null?void 0:W.map(({courtId:Z})=>Z).includes(F))});return h?s_({matchUps:V,schedulingProfile:n}):V}}function FO({tournamentRecords:t,tournamentId:e}){if(typeof t!="object"||!Object.keys(t).length)return{error:wr};let i=Object.keys(t).filter(r=>!e||r===e),n;return i.forEach(r=>{let a=t[r],{matchUpDailyLimits:s}=DLe({tournamentRecord:a});n=s}),{matchUpDailyLimits:n}}function DLe(t){var o;let e=Qt(t,[{[ba]:!0}]);if(e.error)return e;let{tournamentRecord:i}=t,{policy:n}=Fy({policyType:$g,tournamentRecord:i}),{extension:r}=ki({element:i,name:GP}),a=(o=r==null?void 0:r.value)==null?void 0:o.dailyLimits,s=n==null?void 0:n.defaultDailyLimits;return{matchUpDailyLimits:a||s}}function AW(t){var _,A,N,k;let{matchUps:e}=t,{singlesForDoubles:i,tournamentRecord:n,drawDefinition:r,excludeMargin:a,exclusionRule:s,zoneDoubling:o,matchUpType:l,scaleName:c,eventId:u,zonePct:d,drawId:p,event:h}=t;if(!n&&!e)return{error:ut};if(l&&![xn,Mn].includes(l))return{error:Re,info:{matchUpType:l}};if(e&&!tu(e))return{error:Re,context:{matchUps:e}};let f=Da[c],m=(f==null?void 0:f.ascending)??t.ascending??!1,g=(f==null?void 0:f.accessor)??t.valueAccessor,v=Array.isArray(f==null?void 0:f.range)?Math.abs(f.range[0]-f.range[1]):0,y=Ii(d)&&v?(d??0/100)*v:t.zoneMargin??v,b={withScaleValues:!0,withCompetitiveness:!0},I={matchUpTypes:l?[l]:[xn,Mn]},T=n==null?void 0:n.participants;(_=e==null?void 0:e[0])!=null&&_.hasContext?p?e=e.filter(O=>O.drawId===p):u&&(e=e.filter(O=>O.eventId===u)):e===void 0&&(e=p&&!r&&[]||!p&&u&&!h&&[]||p&&((A=lo({inContext:!0,drawDefinition:r,contextFilters:I,contextProfile:b,participants:T}))==null?void 0:A.matchUps)||!p&&u&&((N=Jh({inContext:!0,contextFilters:I,contextProfile:b,participants:T,event:h}))==null?void 0:N.matchUps)||((k=Wa({tournamentRecord:n,contextFilters:I,contextProfile:b}))==null?void 0:k.matchUps)||[]),l&&(e=e.filter(O=>O.matchUpType===l));let w=e.filter(({winningSide:O,score:$,sides:F,matchUpStatus:V})=>![as,Yi,cn,lU,sl].includes(V??"")&&ga({score:$})&&(F==null?void 0:F.length)===2&&O),S=PLe({matchUps:w,excludeMargin:a,exclusionRule:s,valueAccessor:g,ascending:m,scaleName:c}),U=!o||Fr(xn)(l)?y:(y||0)*2,P=y?w.map(({competitiveProfile:O,matchUpType:$,score:F,sides:V})=>{let j=ade({singlesForDoubles:i,valueAccessor:g,matchUpType:$,scaleName:c,sides:V}),B=Math.abs(j[0].value-j[1].value);return{competitiveness:O==null?void 0:O.competitiveness,valuesGap:B,score:F}}).filter(({valuesGap:O})=>O<=U):[],E=ELe({zoneData:P}),R=E&&[].concat(Object.values(E)).flat().length,C=R&&Object.assign({},...Object.keys(E).map(O=>({[O]:Math.round(1e4*E[O].length/R)/100}))),M=w.length-((P==null?void 0:P.length)||0);return{...de,relevantMatchUps:w,zoneDistribution:C,zoneData:P,accuracy:S,nonZone:M}}function ELe({zoneData:t}){let e={[zq]:[],[dE]:[],[pE]:[]};for(let i of t){let{competitiveness:n,score:r,valuesGap:a}=i;e[n]&&e[n].push({score:r,valuesGap:a})}return e}function ade({singlesForDoubles:t,exclusionRule:e,valueAccessor:i,matchUpType:n,scaleName:r,sides:a}){let s=e==null?void 0:e.range.sort(),o=l=>{let c=l==null?void 0:l[e==null?void 0:e.valueAccessor];return{exclude:e&&c>=s[0]&&c<=s[1],exclusionValue:c}};return a.sort((l,c)=>l.sideNumber-c.sideNumber).map(({participant:l})=>{let c=[],u=l==null?void 0:l.individualParticipants;if(u!=null&&u.length){let d=[],p=0;for(let h of u){let{scaleValue:f,value:m}=TZ({singlesForDoubles:t,valueAccessor:i,participant:h,matchUpType:n,scaleName:r}),{exclude:g,exclusionValue:v}=o(f);g&&c.push(v),d.push(f),m&&!isNaN(p)?p+=m:p=void 0}return{participantName:l.participantName,exclusionValues:c,scaleValues:d,value:p}}else if(l){let{scaleValue:d,value:p}=TZ({singlesForDoubles:t,valueAccessor:i,matchUpType:n,participant:l,scaleName:r}),{exclude:h,exclusionValue:f}=o(d);return h&&c.push(f),{participantName:l.participantName,exclusionValues:c,scaleValue:d,value:p}}else return{}})}function TZ({singlesForDoubles:t,valueAccessor:e,matchUpType:i,participant:n,scaleName:r}){var c,u,d,p,h;let a=t?xn:i,s=(u=(c=n==null?void 0:n.rankings)==null?void 0:c[a])==null?void 0:u.find(f=>f.scaleName===r),o=(h=((p=(d=n==null?void 0:n.ratings)==null?void 0:d[a])==null?void 0:p.find(f=>f.scaleName===r))||s)==null?void 0:h.scaleValue,l=e?o==null?void 0:o[e]:o;return{scaleValue:o,value:l}}function PLe({excludeMargin:t,exclusionRule:e,valueAccessor:i,ascending:n,scaleName:r,matchUps:a}){let s={affirmative:[],negative:[],excluded:[]};for(let c of a){let{matchUpType:u,sides:d,score:p,winningSide:h}=c;if(!h)continue;if(e&&(!e.valueAccessor||!e.range))return{info:"exclusionRule requires valueAccessor and range",error:ai};let f=h-1,m=ade({exclusionRule:e,valueAccessor:i,matchUpType:u,scaleName:r,sides:d});if(e){let T=m.map(({exclusionValues:w})=>w).flat();if(T.length){s.excluded.push({scoreString:p==null?void 0:p.scoreStringSide1,exclusionValues:T,winningSide:h,sideValues:m});continue}}if(m.filter(T=>![void 0,"",null].includes(T.value)).length<2){s.excluded.push({scoreString:p==null?void 0:p.scoreStringSide1,missingValues:!0,winningSide:h,sideValues:m});continue}let g=m[f].value-m[1-f].value,v=parseFloat(t||0),y=v&&Math.abs(g)<v;if(y){s.excluded.push({scoreString:p==null?void 0:p.scoreStringSide1,excludeMargin:t,winningSide:h,excludeGap:y,sideValues:m,valuesGap:g});continue}let b=n?g:g*-1,I=h===1?p==null?void 0:p.scoreStringSide1:p==null?void 0:p.scoreStringSide2;b>0?s.affirmative.push({winningScoreString:I,winningSide:h,sideValues:m,valuesGap:g,score:p}):s.negative.push({winningScoreString:I,winningSide:h,sideValues:m,valuesGap:g,score:p})}let o=s.affirmative.length+s.negative.length,l=o&&s.affirmative.length/o*100;return s.percent=l?Math.round(100*l)/100:0,s}function hw({collectionDefinitions:t=[],collectionGroups:e=[]}){let i=0,{groupValueNumbers:n}=cce({collectionGroups:e}),r;for(let a of t||[]){let{collectionValueProfiles:s,collectionGroupNumber:o,collectionValue:l,matchUpCount:c,matchUpValue:u,scoreValue:d,setValue:p}=a,h=o&&n.includes(o);if(Ii(p||d))r=!0;else{if(h)continue;if(typeof l=="number"&&Ii(l))i+=l;else if(Array.isArray(s)&&(s!=null&&s.length))for(let f of s)i+=f.matchUpValue;else typeof u=="number"&&Ii(u)&&(i+=(c??0)*u)}}for(let a of e)i+=a.groupValue??0;return r||!i?{aggregateValue:!0,...de}:{valueGoal:Math.floor(i/2)+1,...de}}function _W(t){let{timeStamp:e,schedule:i,matchUp:n}=t,r=Qt(t,[{[Zh]:!0}]);if(r.error)return r;let{itemValue:a,timeStamp:s}=Vy({timeItems:(n==null?void 0:n.timeItems)||[],itemType:Xq});return!i||s&&e&&new Date(s).getTime()>new Date(e).getTime()?{homeParticipantId:a}:i}function kW({matchUps:t,matchUpId:e}){if(!tu(t))return{error:Re};let i=t.find(o=>o.matchUpId===e),{drawId:n,eventId:r,structureId:a,tournamentId:s}=i||{};return{matchUpId:e,drawId:n,eventId:r,structureId:a,tournamentId:s}}function bU(t,e){if(!Xi(t))return{error:Re};if(!Array.isArray(e))return{error:Re};let i={};for(let{param:n,error:r,attr:a}of e){let s=CLe({params:t,param:n,attr:a,error:r});if(s!=null&&s.error)return s;i[n]=s}return i}function CLe({params:t,param:e,attr:i,error:n}){if(e===Px&&Xi(t.drawDefinition)&&nr(t.structureId)){let r=(t.drawDefinition.structures??[]).find(({structureId:a})=>a===t.structureId);return!r.length&&n?{error:n}:{structure:r}}if(e===Zh){let r=que({...t,...i});return r.error&&n?{...r,error:n}:r}return{error:za,info:{param:e}}}function xW(t){var p,h;let{structureId:e,matchUpId:i,event:n}=t,r=t.drawDefinition,a=Qt(t,[{[ba]:!0},{[dq]:{[Ux]:!1,[Gp]:!1,[Wse]:!1,[Fg]:!1}}]);if(a[Au])return a;let s=(p=bU(t,[{[nU]:Zh,[Au]:ai}]))==null?void 0:p.matchUp;if(i&&(s!=null&&s.error))return s;!r&&(s!=null&&s.drawDefinition)&&(r=s==null?void 0:s.drawDefinition);let o=s==null?void 0:s.structure;if(!o&&e&&!i){if(!r)return{error:Vd};let f=hi({drawDefinition:r,structureId:e});if(f.error)return f;o=f.structure}let l=o==null?void 0:o.matchUpFormat,c=r==null?void 0:r.matchUpFormat,u=n==null?void 0:n.matchUpFormat,d=((h=s==null?void 0:s.matchUp)==null?void 0:h.matchUpFormat)||l||c||u;return{structureDefaultMatchUpFormat:l,eventDefaultMatchUpFormat:u,drawDefaultMatchUpFormat:c,matchUpFormat:d}}function OW({profileBands:t,tournamentRecord:e,matchUps:i}){if(!tu(i))return{error:ym};let n=!t&&Fy({policyType:Uf,tournamentRecord:e}).policy,r=t||(n==null?void 0:n.profileBands)||qq[Uf].profileBands,a=i.filter(({winningSide:p})=>p),s=a.map(Coe),o=(p,h)=>{let f=Poe(h,r);return p[f]+=1,p},l=Roe(s).reduce((p,h)=>o(p,h),{[zq]:0,[dE]:0,[pE]:0,[Soe]:0}),c=Object.keys(l).reduce((p,h)=>(l[h]||0)+p,0),u=Object.keys(l).map(p=>{let h=parseFloat((l[p]/c).toFixed(4));return{[p]:h*100}}),d=a.filter(({matchUpStatus:p})=>p===WK).length;return u.push({[WK]:parseFloat((d/c).toFixed(4))*100}),{competitiveBands:Object.assign({},...u),...de}}var{stageOrder:UZ}=INe;function RLe(t,e){return t.eventName.localeCompare(e.eventName)||t.eventId.localeCompare(e.eventId)||(UZ[t==null?void 0:t.stage]||0)-(UZ[e==null?void 0:e.stage]||0)||e.matchUpsCount-t.matchUpsCount||`${t.stageSequence}-${t.roundNumber}-${t.minFinishingSum}`.localeCompare(`${e.stageSequence}-${e.roundNumber}-${e.minFinishingSum}`)}function LW({excludeScheduleDateProfileRounds:t,excludeScheduledRounds:e,excludeCompletedRounds:i,inContextMatchUps:n,tournamentRecords:r,schedulingProfile:a,tournamentRecord:s,withSplitRounds:o,matchUpFilters:l,scheduleDate:c,withRoundId:u,venueId:d,context:p}){var w;if(n&&!Array.isArray(n||typeof n[0]!="object"))return{error:Re,inContextMatchUps:n};if(s&&!r){if(typeof s!="object")return{error:CP};r={[s.tournamentId]:s}}let h=typeof r!="object"||!Object.keys(r).length;if((d||c||!n||!a&&(t||i||a||o))&&h)return{error:wr};let f=Object.assign({},...Object.values(r??{}).map(({venues:S=[],tournamentId:U})=>({[U]:S==null?void 0:S.map(({venueId:P})=>P)}))),m=Object.values(r??{}).map(({events:S=[],tournamentId:U,startDate:P,endDate:E})=>S.map(R=>({...R,validVenueIds:f[U],startDate:R.startDate??P,endDate:R.endDate??E}))).flat(),{segmentedRounds:g,profileRounds:v}=r&&(t||i||a||o)&&AO({tournamentRecords:r,schedulingProfile:a})||{},y=t&&Object.assign({},...v.map(S=>({[S.id]:S}))),b=n||r&&((w=_d({tournamentRecords:r,matchUpFilters:l}))==null?void 0:w.matchUps)||[],I=[],T=b&&Object.values(b.reduce((S,U)=>{var K;let P=oj(U).id,E=g==null?void 0:g[P],R=[...((K=S[P])==null?void 0:K.matchUps)??[],U],{containerStructureId:C,stageSequence:M,structureName:_,tournamentId:A,isRoundRobin:N,matchUpType:k,roundNumber:O,roundOffset:$,structureId:F,eventName:V,roundName:j,drawName:B,eventId:z,drawId:W}=U,Z=N?C:F;return{...S,[P]:{id:u?P:void 0,structureId:Z,stageSequence:M,segmentsCount:E,structureName:_,tournamentId:A,matchUpType:k,roundNumber:O,roundOffset:$,eventName:V,roundName:j,drawName:B,matchUps:R,eventId:z,drawId:W}}},{})).map(S=>{let{minFinishingSum:U,winnerFinishingPositionRange:P}=SLe(S.matchUps),E=S.segmentsCount;if(E){let O=S.matchUps.length/E;return Ra(S.matchUps.sort(($,F)=>$.roundPosition-F.roundPosition),O).map(($,F)=>{let{unscheduledCount:V,incompleteCount:j,matchUpsCount:B,isScheduled:z,isComplete:W,byeCount:Z}=SZ($),K=wZ({matchUps:S.matchUps,tournamentRecords:r,events:m,round:S});return Kt({...S,...p,roundSegment:{segmentsCount:E,segmentNumber:F+1},winnerFinishingPositionRange:P,unscheduledCount:V,incompleteCount:j,minFinishingSum:U,matchUpsCount:B,isScheduled:z,roundTiming:K,isComplete:W,byeCount:Z,matchUps:$})})}let{unscheduledCount:R,incompleteCount:C,matchUpsCount:M,isScheduled:_,isComplete:A,byeCount:N}=SZ(S.matchUps),k=wZ({matchUps:S.matchUps,tournamentRecords:r,events:m,round:S});return Kt({...S,...p,winnerFinishingPositionRange:P,unscheduledCount:R,incompleteCount:C,minFinishingSum:U,matchUpsCount:M,isScheduled:_,roundTiming:k,isComplete:A,byeCount:N})}).flat().filter(S=>{if(t){let F=Ri(t),V=u?S.id:oj(S).id;if(F&&y[V]&&Ri(y[V].scheduleDate)===F)return!1}let{isComplete:U,isScheduled:P}=S,E=!i||!U,R=!e||!P,C=d||c?m==null?void 0:m.find(({eventId:F})=>F===S.eventId):void 0,M=(C==null?void 0:C.startDate)??(s==null?void 0:s.startDate),_=(C==null?void 0:C.endDate)??(s==null?void 0:s.endDate),A=!c||!M||new Date(c)>=new Date(M),N=!c||!_||new Date(c)<=new Date(_),k=A&&N,O=!d||(C==null?void 0:C.validVenueIds.includes(d)),$=E&&R&&O&&k;return $||I.push(S),$}).sort(RLe)||[];return{...de,rounds:T,excludedRounds:I}}function bE(t){var W;let{matchUp:e,sideNumber:i,setNumber:n,isTiebreakValue:r,isPointValue:a}=t||{},{matchUpFormat:s}=t||{};if(!e)return{error:rl};s=s||(e==null?void 0:e.matchUpFormat);let o=wo(s),l=!!(e!=null&&e.winningSide),c=(W=e.score)==null?void 0:W.sets,u=c==null?void 0:c.length,d=n&&n-1,p=!!(c!=null&&c.find((Z,K)=>Z.setNumber===n&&K===d)),h=(c==null?void 0:c.filter(Z=>Z==null?void 0:Z.winningSide))||[],f=(h==null?void 0:h.length)||0,m=n&&(c==null?void 0:c.slice(n))||[],g=!!(u&&n&&(m!=null&&m.reduce((Z,K)=>(!K||!K.side1Score&&!K.side2Score&&!K.side1TiebreakScore&&!K.side2TiebreakScore&&!K.side1PointScore&&!K.side2PointScore)&&Z,!0))),v=n<=u&&c.find(Z=>Z.setNumber===n),y=v&&vE({setObject:v,matchUpScoringFormat:o}),{isCompletedSet:b,sideGameScores:I,sideTiebreakScores:T}=y||{},w=!!(v&&!b&&g||n&&n===u+1&&!l),S=[1,2].includes(i),U=S?i-1:0,P=v&&S&&(!r&&!a&&I[U]!==void 0&&I[U]||r&&T[U]!==void 0&&T[U]),E=!!P,R=h==null?void 0:h.map(Z=>vE({setObject:Z,matchUpScoringFormat:o}).isValidSetOutcome).reduce((Z,K)=>Z&&K,!0),C=h.reduce((Z,K)=>{let{winningSide:Q}=K,J=Q-1;return Z[J]++,Z},[0,0]),M=e==null?void 0:e.winningSide,_=M&&M-1,A=1-_,N=C[_],k=C[A],O=Math.max(...C),$=Ml(C)[O],{bestOf:F,exactly:V}=o??{},j=F&&Math.ceil(F/2)||V||1,B=O===j&&$===1&&C.indexOf(O)+1||void 0,z=N>k&&M===B;return{completedSetsHaveValidOutcomes:R,validMatchUpWinningSide:z,calculatedWinningSide:B,matchUpScoringFormat:o,validMatchUpOutcome:B&&R&&z,isLastSetWithValues:g,completedSetsCount:f,isCompletedMatchUp:l,isValidSideNumber:S,hasExistingValue:E,existingValue:P,isExistingSet:p,isActiveSet:w,...y}}function FW({participants:t,tournamentAppliedPolicies:e,scheduleVisibilityFilters:i,participantsProfile:n,afterRecoveryTimes:r,policyDefinitions:a,useParticipantMap:s,tournamentRecord:o,usePublishState:l,contextFilters:c,contextContent:u,matchUpFilters:d,participantMap:p,publishStatus:h,contextProfile:f,drawDefinition:m,nextMatchUps:g,tournamentId:v,inContext:y,context:b,event:I}){let{eventId:T,eventName:w,endDate:S,eventType:U,category:P,gender:E}=I??{},R={...b,...Kt({surfaceCategory:(I==null?void 0:I.surfaceCategory)??(o==null?void 0:o.surfaceCategory),indoorOutDoor:(I==null?void 0:I.indoorOutdoor)??(o==null?void 0:o.indoorOutdoor),endDate:S??(I==null?void 0:I.endDate)??(o==null?void 0:o.endDate),tournamentId:v??(o==null?void 0:o.tournamentId),eventName:w,eventType:U,category:P,eventId:T,gender:E})},C;return!(t!=null&&t.length)&&o&&({participants:t,participantMap:p,groupInfo:C}=Ly({participantsProfile:n,policyDefinitions:a,useParticipantMap:s,tournamentRecord:o,contextProfile:f,inContext:y})),I&&f&&!u&&(u=Sm({policyDefinitions:a,tournamentRecord:o,contextProfile:f,drawDefinition:m,event:I})),{...dU({context:R,tournamentAppliedPolicies:e,scheduleVisibilityFilters:i,tournamentParticipants:t,participantsProfile:n,afterRecoveryTimes:r,policyDefinitions:a,tournamentRecord:o,usePublishState:l,participantMap:p,contextContent:u,contextFilters:c,matchUpFilters:d,publishStatus:h,contextProfile:f,drawDefinition:m,nextMatchUps:g,inContext:y,event:I}),groupInfo:C}}var sde={};Li(sde,{getCompetitionVenues:()=>RC,getCourts:()=>$W,getVenuesAndCourts:()=>Um,publicFindVenue:()=>e3});function $W({tournamentRecord:t,venueId:e,venueIds:i}){return t?{courts:(t.venues||[]).filter(n=>e?n.venueId===e:i?i.includes(n.venueId):!0).map(n=>{let{venueId:r}=n,a=_t(n.courts||[]);return a.forEach(s=>Object.assign(s,{venueId:r})),a}).flat()}:{error:ut}}var ode={};Li(ode,{categoryCanContain:()=>OP,getCategoryAgeDetails:()=>sI,getEvent:()=>jW,getEventProperties:()=>BW,getEventStructures:()=>iO,getEventTimeItem:()=>WP,getEvents:()=>VW,getFlightProfile:()=>_r,getScaledEntries:()=>dw});function BW({tournamentRecord:t,event:e}){var d,p;if(!t)return{error:ut};if(!e)return{error:Jn};let i=e.entries||[],n=t.participants||[],r=((d=e.category)==null?void 0:d.categoryName)||((p=e.category)==null?void 0:p.ageCategoryCode),{eventType:a}=e,s=i.map(h=>h.participantId),o=n.filter(h=>s.includes(h.participantId)),l,c,u;return{entryScaleAttributes:o.map(h=>{var T,w,S,U,P,E;let{participantId:f,participantName:m,name:g}=h,v={scaleType:Qq,eventType:a,scaleName:r},y=(w=(T=Th({participant:h,scaleAttributes:v}))==null?void 0:T.scaleItem)==null?void 0:w.scaleValue;v={scaleType:Foe,eventType:a,scaleName:r};let b=(U=(S=Th({participant:h,scaleAttributes:v}))==null?void 0:S.scaleItem)==null?void 0:U.scaleValue;v={scaleType:Loe,eventType:a,scaleName:r};let I=(E=(P=Th({participant:h,scaleAttributes:v}))==null?void 0:P.scaleItem)==null?void 0:E.scaleValue;return l=!!(l||y),c=!!(c||b),u=!!(u||I),{participantId:f,participantName:m||g,seed:y,ranking:b,rating:I}}),hasSeededParticipants:l,hasRankedParticipants:c,hasRatedParticipants:u}}function VW({tournamentRecord:t,withScaleValues:e,scaleEventType:i,inContext:n,eventIds:r,drawIds:a,context:s}){var u,d,p,h;if(!t)return{error:ut};let{tournamentId:o}=t,l=(t.events??[]).filter(({eventId:f})=>!r||Array.isArray(r)&&r.includes(f)).map(f=>{var v;let m=(v=f.drawDefinitions)==null?void 0:v.map(lE);if(a!=null&&a.length&&!Nr(a,m).length)return;let g=_t(f);return n&&Object.assign(g,{tournamentId:o}),s&&Object.assign(g,s),g}).filter(Boolean),c={};if(e){let f=vr({withScaleValues:!0,tournamentRecord:t}).participantMap,m=g=>g.reduce((v,y)=>v+parseFloat(y),0);for(let g of l){let v=i??g.eventType,y=g.eventId;c[y]||(c[y]={ratingsStats:{},ratings:{},ranking:{},draws:{}});let b=(g.entries??[]).filter(({entryStatus:E})=>id.includes(E)).map(Vi),I=E=>{var R,C,M,_,A,N;if((R=E==null?void 0:E.ratings)!=null&&R[v])for(let k of((C=E==null?void 0:E.ratings)==null?void 0:C[v])??[]){let O=k.scaleName;c[y].ratings[O]||(c[y].ratings[O]=[]);let $=(M=Da[O])==null?void 0:M.accessor;if($){let F=parseFloat((_=k.scaleValue)==null?void 0:_[$]);F&&c[y].ratings[O].push(F)}}if((A=E==null?void 0:E.rankings)!=null&&A[v])for(let k of((N=E==null?void 0:E.rankings)==null?void 0:N[v])??[]){let O=k.scaleName;c[y].ranking[O]||(c[y].ranking[O]=[]),k.scaleValue&&c[y].ranking[O].push(k.scaleValue)}};for(let E of b){let R=(u=f==null?void 0:f[E])==null?void 0:u.participant;if((R==null?void 0:R.participantType)!==ji)for(let C of(R==null?void 0:R.individualParticipantIds)??[]){let M=(d=f==null?void 0:f[C])==null?void 0:d.participant;I(M)}else I(R)}let T=c[y].ratings;for(let E of Object.keys(T)){let R=T[E];if(!R.length)continue;let C=(p=OK(R))==null?void 0:p.toFixed(2);c[y].ratingsStats[E]={avg:parseFloat((m(R)/R.length).toFixed(2)),median:C?parseFloat(C):void 0,max:Math.max(...R),min:Math.min(...R)}}let w=(E,R)=>{var M,_;let C=A=>{var N,k,O,$,F,V,j,B,z,W;if((N=c[y].draws)!=null&&N[E]&&((k=A==null?void 0:A.ratings)!=null&&k[v]))for(let Z of((O=A==null?void 0:A.ratings)==null?void 0:O[v])??[]){let K=Z.scaleName;($=c[y].draws[E])!=null&&$.ratings[K]||(c[y].draws[E].ratings[K]=[]);let Q=(F=Da[K])==null?void 0:F.accessor;if(Q){let J=parseFloat((V=Z.scaleValue)==null?void 0:V[Q]);J&&c[y].draws[E].ratings[K].push(J)}}if((j=c[y].draws)!=null&&j[E]&&((B=A==null?void 0:A.rankings)!=null&&B[v]))for(let Z of((z=A==null?void 0:A.rankings)==null?void 0:z[v])??[]){let K=Z.scaleName;(W=c[y].draws[E])!=null&&W.ranking[K]||(c[y].draws[E].ranking[K]=[]);let Q=Z.scaleValue;Q&&c[y].draws[E].ranking[K].push(Q)}};for(let A of R.filter(Boolean)){let N=(M=f==null?void 0:f[A])==null?void 0:M.participant;if((N==null?void 0:N.participantType)!==ji)for(let k of(N==null?void 0:N.individualParticipantIds)??[]){let O=(_=f==null?void 0:f[k])==null?void 0:_.participant;C(O)}else C(N)}},S=[],U=E=>(a==null?void 0:a.length)&&a.includes(E)||S.includes(E);for(let E of g.drawDefinitions??[]){let R=E.drawId;if(U(R))continue;let C=jy({drawDefinition:E}).assignedParticipantIds??[];c[y].draws[R]||(c[y].draws[R]={ratingsStats:{},ratings:{},ranking:{}}),S.push(R),w(R,C)}let P=_r({event:g}).flightProfile;for(let E of(P==null?void 0:P.flights)??[]){let R=E.drawId;if(U(R))continue;let C=E.drawEntries.map(Vi);w(R,C)}for(let E of S){let R=c[y].draws[E].ratings;for(let C of Object.keys(R)){let M=R[C];if(!M.length)continue;let _=(h=OK(M))==null?void 0:h.toFixed(2);c[y].draws[E].ratingsStats[C]={avg:parseFloat((m(M)/M.length).toFixed(2)),median:_?parseFloat(_):void 0,max:Math.max(...M),min:Math.min(...M)}}}}}return Kt({eventScaleValues:c,events:l,...de})}function jW({tournamentRecord:t,drawDefinition:e,context:i,event:n}){var s;if(!t)return{error:ut};if(!n)return{error:Jn};let r=_t(n);i&&Object.assign(r,i);let a=e&&((s=r.drawDefinitions)==null?void 0:s.find(({drawId:o})=>e.drawId===o));return Kt({drawDefinition:a,event:r})}function MLe(t){var h,f;let e="validateAndDeriveDrawValues",{appliedPolicies:i,policyDefinitions:n}=_Le(t),r=kLe({...t,policyDefinitions:n,appliedPolicies:i}),a=ALe(t),s=xLe({...t,consideredEntries:a,appliedPolicies:i});if(s!=null&&s.error)return he({result:s,stack:e});let o=OLe({...t,consideredEntries:a}),l=NLe({...t,appliedPolicies:i,policyDefinitions:n,drawSize:o});if(l.error)return he({result:l,stack:e});let c=l.drawType;if(isNaN(o)&&c!==nc)return he({result:{error:MP},stack:e});let u=(n==null?void 0:n[Su])??(i==null?void 0:i[Su]),d=t.seedingProfile??((f=(h=u==null?void 0:u.seedingProfile)==null?void 0:h.drawTypes)==null?void 0:f[c??""])??(u==null?void 0:u.seedingProfile);t.seedingProfile&&(n[Su]||(n[Su]={...sj[Su]}),n[Su].seedingProfile=d);let p=LLe({...t,drawType:c});return p!=null&&p.error?he({result:p,stack:e}):{drawSize:o,drawType:c,enforceGender:r,seedingProfile:d,appliedPolicies:i,policyDefinitions:n}}function NLe(t){let{policyDefinitions:e,appliedPolicies:i,enforceMinimumDrawSize:n=!0,drawSize:r}=t,a=t.drawTypeCoercion??DC({drawType:t.drawType,policyDefinitions:e,appliedPolicies:i}),s=Oce({drawType:t.drawType,enforceMinimumDrawSize:n,drawTypeCoercion:a,drawSize:r});return s.error?s:{drawType:s.drawType}}function lde(t){return t==null?void 0:t.filter(e=>e.entryStatus&&[...id,eC].includes(e.entryStatus))}function ALe({considerEventEntries:t=!0,drawEntries:e,eventEntries:i,qualifyingOnly:n}){return(n&&[]||lde(e)||(t?i:[])).filter(({entryStage:r})=>!r||r===Ft)}function _Le(t){let{tournamentRecord:e,event:i}=t,n=hn({tournamentRecord:e,event:i}).appliedPolicies??{},r=_t(t.policyDefinitions??{},!1,!0);return{appliedPolicies:n,policyDefinitions:r}}function kLe({enforceGender:t,policyDefinitions:e,appliedPolicies:i}){var n,r,a,s;return t??((r=(n=e==null?void 0:e[Ba])==null?void 0:n.participants)==null?void 0:r.enforceGender)??((s=(a=i==null?void 0:i[Ba])==null?void 0:a.participants)==null?void 0:s.enforceGender)}function xLe(t){let{consideredEntries:e,appliedPolicies:i,policyDefinitions:n,enforceGender:r,participantMap:a,participants:s,event:o}=t;return o&&s&&hO({consideredEntries:e,policyDefinitions:n,appliedPolicies:i,participantMap:a,enforceGender:r,participants:s,event:o})}function OLe(t){return!t.drawSize&&t.consideredEntries.length&&![nc,FP,iU,zu,Oh].includes(t.drawType??"")&&WT(t.consideredEntries.length)||t.drawSize&&ui(t.drawSize)||!1}function LLe(t){var s,o;let{tournamentRecord:e,event:i,ignoreAllowedDrawTypes:n,drawType:r}=t,a=!n&&e&&SO({tournamentRecord:e,categoryType:(s=i==null?void 0:i.category)==null?void 0:s.categoryType,categoryName:(o=i==null?void 0:i.category)==null?void 0:o.categoryName});return a!=null&&a.length&&!a.includes(r)?{error:yz}:{...de}}function kC(t){let{voluntaryConsolation:e,tournamentRecord:i,event:n}=t,r="generateDrawDefinition",{participants:a,participantMap:s}=vr({withIndividualParticipants:!0,convertExtensions:!0,internalUse:!0,tournamentRecord:i}),o=lde(n==null?void 0:n.entries)??[],l=MLe({...t,participantMap:s,participants:a,eventEntries:o});if(l.error)return he({result:l,stack:r});let{appliedPolicies:c,policyDefinitions:u,drawSize:d,drawType:p,enforceGender:h,seedingProfile:f}=l,m=n==null?void 0:n.eventType,g=t.matchUpType??m,v=LOe({...t,enforceGender:h,eventType:m,matchUpType:g});if(v.error)return he({result:v,stack:r});let{matchUpFormat:y,tieFormat:b}=v;if(t.drawId&&typeof t.drawId!="string")return he({result:{error:Re},stack:r});let I=dLe({...t,policyDefinitions:u,tournamentRecord:i,appliedPolicies:c,matchUpFormat:y,seedingProfile:f,participants:a,eventEntries:o,matchUpType:g,tieFormat:b,drawSize:d,drawType:p,event:n});if(I.error)return he({result:I,stack:r});let{existingDrawDefinition:T,positioningReports:w,drawDefinition:S,structureId:U,conflicts:P,entries:E}=I;if(!S)return he({result:{error:Re},stack:r});let R=pLe({...t,existingDrawDefinition:T,positioningReports:w,appliedPolicies:c,drawDefinition:S,seedingProfile:f,participants:a,structureId:U,entries:E,params:t,stack:r});if(R.error)return R;let{qualifyingConflicts:C}=R;return S.drawName=t.drawName??(p&&gs(p)),d&&typeof e=="object"&&d>=4&&d3({...e,drawDefinition:S,matchUpType:g}),{existingDrawDefinition:!!T,qualifyingConflicts:C,positioningReports:w,drawDefinition:S,structureId:U,...de,conflicts:P}}function cde({scaleAttributes:t,scaledEntries:e,stageEntries:i,seedsCount:n,scaleName:r}){if(!t)return{error:ai,info:"missing scaleAttributes"};let a=Object.assign({},...(e||[]).slice(0,n).map(({participantId:o},l)=>({[o]:l+1})));r=r||t.scaleName;let s=new Date().toISOString();return{scaleItemsWithParticipantIds:i.map(({participantId:o})=>({scaleItems:[{scaleValue:a[o],eventType:t.eventType,scaleType:wh,scaleName:r,scaleDate:s}],participantId:o}))}}function FLe({tournamentRecord:t,drawDefinition:e,policyDefinitions:i,scaleAttributes:n,scaleName:r,drawSize:a,drawId:s,event:o,stage:l,sortDescending:c,scaleSortMethod:u}){let d=kO({policyDefinitions:i,drawDefinition:e,drawSize:a,drawId:s,event:o,stage:l});if(d.error)return d;let{entries:p,seedsCount:h,stageEntries:f}=d;if(!f||!h)return{error:Re};let m=dw({tournamentRecord:t,scaleAttributes:n,scaleSortMethod:u,sortDescending:c,entries:p,stage:l}).scaledEntries??[],{scaleItemsWithParticipantIds:g}=cde({scaleAttributes:n,scaledEntries:m,stageEntries:f,seedsCount:h,scaleName:r});return{scaleItemsWithParticipantIds:g}}var GW={};Li(GW,{addDrawEntries:()=>o3,addEventEntries:()=>gp,addEventEntryPairs:()=>fde,destroyPairEntries:()=>ule,destroyPairEntry:()=>u3,getEntriesAndSeedsCount:()=>kO,getMaxEntryPosition:()=>PW,modifyEntriesStatus:()=>YA,modifyEventEntries:()=>mde,mutate:()=>ude,promoteAlternate:()=>pde,promoteAlternates:()=>zW,query:()=>tde,removeDrawEntries:()=>hde,removeEventEntries:()=>dC,setEntryPosition:()=>HW,setEntryPositions:()=>dde});var ude={};Li(ude,{addDrawEntries:()=>o3,addEventEntries:()=>gp,addEventEntryPairs:()=>fde,destroyPairEntries:()=>ule,destroyPairEntry:()=>u3,modifyEntriesStatus:()=>YA,modifyEventEntries:()=>mde,promoteAlternate:()=>pde,promoteAlternates:()=>zW,removeDrawEntries:()=>hde,removeEventEntries:()=>dC,setEntryPosition:()=>HW,setEntryPositions:()=>dde});function HW({tournamentRecord:t,drawDefinition:e,participantId:i,entryPosition:n,skipRefresh:r,event:a}){let s="setEntryPositions";if(!t)return{error:ut};if(!i)return he({result:{error:la},stack:s});if(n!==void 0&&!Number.isSafeInteger(n))return{error:Re,entryPosition:n};((a==null?void 0:a.entries)||[]).forEach(l=>{l.participantId===i&&(l.entryPosition=n)}),((e==null?void 0:e.entries)||[]).forEach(l=>{l.participantId===i&&(l.entryPosition=n)});let o=l=>{l.entries.forEach(c=>{c.entryPosition===n&&c.participantId!==i&&(c.entryPosition+=.1)})};return r||(a!=null&&a.entries&&(o(a),a.entries=Dd({entries:a.entries})),e!=null&&e.entries&&(o(e),e.entries=Dd({entries:e.entries}))),{...de}}function dde({tournamentRecord:t,entryPositions:e,drawDefinition:i,event:n}){if(!t)return{error:ut};if(!Array.isArray(e))return{error:Re};for(let r of e){let{participantId:a,entryPosition:s}=r,o=HW({skipRefresh:!0,tournamentRecord:t,drawDefinition:i,participantId:a,entryPosition:s,event:n});if(o.error)return o}return n!=null&&n.entries&&(n.entries=Dd({entries:n.entries})),i!=null&&i.entries&&(i.entries=Dd({entries:i.entries})),{...de}}function pde(t){let{participantId:e}=t;return e&&typeof e!="string"?{error:Re,participantId:e}:zW({...t,participantIds:[e].filter(Boolean)})}function zW({tournamentRecord:t,drawDefinition:e,participantIds:i,stageSequence:n,stage:r=Ft,eventId:a,event:s}){if(!t)return{error:ut};if(!Array.isArray(i))return{error:Re,participantIds:i};if(!s)return{error:Jn};let o="promoteAlternates";if(s){let l=DZ({element:s,participantIds:i,stageSequence:n,stage:r});if(l.error)return l}if(e){let l=DZ({element:e,participantIds:i,stageSequence:n,stage:r});if(l.error)return a?he({context:{drawPromotionError:l.error,drawId:e.drawId},result:{...de},stack:o}):l}return{...de}}function DZ({participantIds:t,stageSequence:e,element:i,stage:n}){let r=(i.entries||[]).filter(d=>d.entryStatus===_u),a=(i.entries||[]).filter(d=>t.includes(d.participantId)),s=r.reduce((d,p)=>{let{entryPosition:h}=p;return isNaN(h)&&d||(!d||h<d.entryPosition)&&p||d},void 0),o=a.length?a:[s].filter(Boolean);if(!(o!=null&&o.length))return{error:oae};let l=o.filter(({entryStatus:d})=>d!==_u);if(l.length)return{error:EV,invalidEntryStatus:l};let c=o.filter(({entryStage:d})=>d&&d!==n);if(c.length)return{error:lMe,invalidStage:c};let u=e&&o.filter(d=>d.stageSequence!==e);if(u!=null&&u.length)return{error:cMe,invalidStageSequence:u};for(let d of o){d.entryStatus=ol;let p=d==null?void 0:d.entryPosition;isNaN(p)||i.entries.forEach(f=>{f.entryStatus===_u&&f.entryPosition>p&&(f.entryPosition=f.entryPosition-1)});let h=Math.max(...i.entries.filter(f=>f.entryStatus===ol&&!isNaN(f.entryPosition)).map(({entryPosition:f})=>ui(f||0)),0);d.entryPosition=h||0}return{...de}}function hde({autoEntryPositions:t=!0,participantIds:e,drawDefinition:i,drawId:n,stages:r,event:a}){var u;if(!a)return{error:Jn};if(!n)return{error:Vd};if(!(e!=null&&e.length))return{error:xg};let s=jy({drawDefinition:i,stages:r}).assignedParticipantIds??[];if(ho(s,e))return{error:JT};let o=d=>{let p=d.participantId;return!e.includes(p)},{flightProfile:l}=_r({event:a}),c=(u=l==null?void 0:l.flights)==null?void 0:u.find(d=>d.drawId===n);return c!=null&&c.drawEntries&&(c.drawEntries=c.drawEntries.filter(o),t&&(c.drawEntries=Dd({entries:c.drawEntries}))),i!=null&&i.entries&&(i.entries=i.entries.filter(o),t&&(i.entries=Dd({entries:i.entries}))),{...de}}function Np(t){var m,g,v,y,b;let e="addParticipant",{allowDuplicateParticipantIdPairs:i,returnParticipant:n,disableNotice:r,pairOverride:a,participant:s}=t,o=t.tournamentId?(m=t.tournamentRecords)==null?void 0:m[t.tournamentId]:t.tournamentRecord??(t.activeTournamentId&&((g=t.tournamentRecords)==null?void 0:g[t.activeTournamentId]));if(!o)return{error:ut};if(!s)return he({result:{error:GI},stack:e});s.participantId||(s.participantId=yn()),o.participants||(o.participants=[]);let{participantId:l,individualParticipantIds:c}=s;if(o.participants.reduce((I,T)=>T.participantId===l||I,!1))return{error:iae};let{participantType:u,participantRole:d}=s;if(!u||!Object.keys(pS).includes(u))return{error:Nd,participantType:u};if(!d)return{error:tae};let p=o.participants||[],h=p.filter(I=>I.participantType===ji).map(I=>I.participantId);if(u!==ji&&s.person)return{error:Re,person:s.person};if(c&&!Array.isArray(c))return{error:Re,individualParticipantIds:c};if(u===Ni){if(s.person)return{error:Re,person:s.person};if(s.individualParticipantIds){if(s.individualParticipantIds.length!==2&&!a)return he({info:"PAIR must be 2 individualParticipantIds",result:{error:Dl},stack:e});{let w=p.filter(S=>S.participantType===ji).map(S=>S.participantId);if(!Array.isArray(s.individualParticipantIds))return he({result:{error:Dl},stack:e});if(!s.individualParticipantIds.reduce((S,U)=>w.includes(U)&&S,!0))return he({result:{error:Dl},stack:e})}}else return he({result:{error:xg},stack:e});let I=p.filter(w=>w.participantType===Ni).map(w=>({individualParticipantIds:w.individualParticipantIds,participant:w})),T=s.participantType===Ni&&I.find(w=>Nr(w.individualParticipantIds,s.individualParticipantIds).length===2);if(T&&!i)return{...de,existingParticipant:!0,participant:n&&_t(T.participant)};if(!s.participantName){let w=p.filter(U=>{var P;return(P=s.individualParticipantIds)==null?void 0:P.includes(U.participantId)}),S=w.map(U=>{var P;return(P=U.person)==null?void 0:P.standardFamilyName}).filter(Boolean).join("/");w.length===1&&(S+="/Unknown"),s.participantName=S}}else if(u===ji){if(!((v=s.person)!=null&&v.standardFamilyName)||!((y=s.person)!=null&&y.standardGivenName))return{error:sae};if(!s.participantName){let I=`${s.person.standardFamilyName.toUpperCase()}, ${s.person.standardGivenName}`;s.participantName=I}}else if(u&&[En,pc].includes(u)){if(c||(s.individualParticipantIds=[]),(b=s.individualParticipantIds)==null?void 0:b.length)for(let I of s.individualParticipantIds){if(typeof I!="string")return he({result:{participantId:I,error:Re},stack:e});if(!h.includes(I))return he({result:{participantId:I,error:xr},stack:e})}}else return{error:Nd};o.participants.push(s),r||Si({payload:{tournamentId:o.tournamentId,participants:[s]},topic:ug});let f={participant:n&&_t(s),...de};return Kt(f)}function Ku({allowDuplicateParticipantIdPairs:t,returnParticipants:e,tournamentRecord:i,participants:n=[]}){if(!i)return{error:ut};i.participants||(i.participants=[]);let r=i.participants.map(d=>d.participantId)||[];n.forEach(d=>{d.participantId||(d.participantId=yn())});let a=n.filter(d=>!r.includes(d.participantId)),s=n.filter(d=>r.includes(d.participantId)),o=a.filter(d=>d.participantType===ji),l=a.filter(d=>d.participantType!==ji),c=o.concat(...l),u=[];if(c.length){for(let p of c){let h=Np({allowDuplicateParticipantIdPairs:t,returnParticipant:!0,disableNotice:!0,tournamentRecord:i,participant:p});if(h.error)return h;h.success&&!h.existingParticipant&&u.push(h.participant)}u.length&&Si({topic:ug,payload:{tournamentId:i.tournamentId,participants:u}});let d={participants:e&&_t(u),addedCount:u.length,...de};return s.length&&Object.assign(d,{notAdded:s,info:ox}),Kt(d)}else return{info:"No new participants to add",addedCount:0,...de}}function fde(t){let e=Qt(t,[{[ba]:!0,[Fg]:!0}]);if(e.error)return e;let{allowDuplicateParticipantIdPairs:i,entryStatus:n=_u,participantIdPairs:r=[],entryStage:a=Ft,tournamentRecord:s,drawDefinition:o,event:l,uuids:c}=t;if(l.eventType!==Mn)return{error:_h};let u=[],d=new Map;for(let I of s.participants??[]){let{participantType:T,participantId:w,person:S,individualParticipantIds:U}=I;T===ji&&(S!=null&&S.sex)?d.set(w,S.sex):T===Ni&&U&&u.push(U)}let p=r.filter(I=>{if(I.length!==2)return!0;if(!l.gender||l.gender===Ad)return!1;if(!d.has(I[0])||!d.has(I[1]))return!0;let T=I.map(S=>d.get(S)),w=l.gender===Cn&&(T[0]!==Cn||T[1]!==Cn)||l.gender===Yn&&(T[0]!==Yn||T[1]!==Yn);return l.gender===Oo&&(T.sort(Jx),(T[0]!==Yn||T[1]!==Cn)&&(w=!0)),w});if(p.length)return{error:Dl,invalidParticipantIdPairs:p};let h=r.map(I=>({participantId:(c==null?void 0:c.pop())??yn(),participantRole:ms,individualParticipantIds:I,participantType:Ni})),f=i?h:h.filter(I=>!u.find(T=>Nr(T,I.individualParticipantIds).length===2)),m,g=[];if(f){let I=Ku({allowDuplicateParticipantIdPairs:i,participants:f,returnParticipants:!0,tournamentRecord:s});if(I.error)return I;g=I.participants||[],m=I.info}let v=r.map(I=>{let T=g.find(S=>Nr(S.individualParticipantIds,I).length===2);if(T)return T;let{participant:w}=Yu({tournamentRecord:s,participantIds:I});return w}).map(I=>I.participantId),y=gp({participantIds:v,tournamentRecord:s,drawDefinition:o,entryStatus:n,entryStage:a,event:l});f.length&&Si({payload:{participants:f},topic:ug});let b=f.map(Vi);return{...y,info:m,newParticipantIds:b}}function mde({entryStatus:t=ol,unpairedParticipantIds:e=[],participantIdPairs:i=[],entryStage:n=Ft,tournamentRecord:r,event:a}){if(!r)return{error:ut};if(!a)return{error:Jn};let s=r.participants??[],o=s.filter(m=>m.participantType===ji).map(m=>m.participantId),l=e.concat(...i).flat(1/0).filter(m=>!o.includes(m));if(l.length)return{error:Dl,invalidParticipantIds:l};let c=i.filter(m=>m.length!==2);if(c.length)return{error:Dl,invalidParticipantIdPairs:c};let u=s.filter(m=>m.participantType===Ni).map(m=>m.individualParticipantIds),d=i.filter(m=>!u.find(g=>Nr(g,m).length===2)).map(m=>({participantType:Ni,participantRole:ms,individualParticipantIds:m})),p=Ku({participants:d,tournamentRecord:r});if(p.error)return p;let h=i.map(m=>{let{participant:g}=Yu({tournamentRecord:r,participantIds:m});return g}).map(m=>({participantId:m,entryStatus:t,entryStage:n})),f=e.map(m=>({entryStatus:eu,participantId:m,entryStage:n}));return a.entries=(a.entries??[]).filter(m=>m.entryStage===n),a.entries=a.entries.concat(...h,...f),{...de}}var qW={};Li(qW,{addDrawDefinition:()=>xC,addEvent:()=>IU,addFlight:()=>jO,assignSeedPositions:()=>Cde,attachFlightProfile:()=>e4,categoryCanContain:()=>OP,deleteDrawDefinitions:()=>$O,deleteEvents:()=>Mde,deleteFlightAndFlightDraw:()=>Ede,deleteFlightProfileAndFlightDraws:()=>Sde,generate:()=>gde,generateEventsFromTieFormat:()=>yde,getCategoryAgeDetails:()=>sI,getEvent:()=>jW,getEventProperties:()=>BW,getEventStructures:()=>iO,getEventTimeItem:()=>WP,getEvents:()=>VW,getFlightProfile:()=>_r,getScaledEntries:()=>dw,modifyEvent:()=>Nde,modifyEventMatchUpFormatTiming:()=>Tde,modifyPairAssignment:()=>Pde,mutate:()=>bde,query:()=>ode,refreshEventDrawOrder:()=>QW,removeEventMatchUpFormatTiming:()=>BO,removeScaleValues:()=>t4,removeSeeding:()=>Rde,setEventDates:()=>XW,setEventDisplay:()=>VO,setEventEndDate:()=>ZW,setEventStartDate:()=>KW,updateDrawIdsOrder:()=>JW,validateCategory:()=>eE});var gde={};Li(gde,{generateEventsFromTieFormat:()=>yde});function $Le({tournamentId:t,event:e}){return e?(Si({payload:{tournamentId:t,event:e},key:e.eventId,topic:loe}),{...de}):{error:Jn}}var BLe={collectionDefinitions:[{collectionName:"Doubles",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7@7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"COLLEGE_D3",winCriteria:{valueGoal:5}},VLe={collectionDefinitions:[{collectionName:"Doubles",collectionValue:1,matchUpCount:3,matchUpFormat:"SET1-S:6/TB7",matchUpType:"DOUBLES"},{collectionName:"Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"COLLEGE_DEFAULT",winCriteria:{valueGoal:5}},jLe={collectionDefinitions:[{collectionName:"Doubles",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"COLLEGE_JUCO",winCriteria:{valueGoal:5}},vde={COLLEGE_D3:BLe,COLLEGE_DEFAULT:VLe,COLLEGE_JUCO:jLe,DOMINANT_DUO:lse,DOMINANT_DUO_MIXED:nse,LAVER_CUP:hse,TEAM_DOUBLES_3_AGGREGATION:Jae,TIME_TENNIS_DUAL:rse,TIME_TENNIS_PRO_CIRCUIT:ise,USTA_BREWER_CUP:ase,USTA_OZAKI_CUP:sse,USTA_COLLEGE:cse,USTA_GOLD_TEAM_CHALLENGE:Xae,USTA_INTERSECTIONAL:tse,USTA_LEVEL_1:use,USTA_SECTION_BATTLE:ese,USTA_SOUTHERN_LEVEL_5:Qae,USTA_TOC:fse,USTA_WTT_ITT:dse,USTA_ZONAL:pse};function IU({suppressNotifications:t,tournamentRecord:e,internalUse:i,event:n}){var o,l,c,u;if(!e)return{error:ut};if(e.events||(e.events=[]),!n)return{error:Jn};let{startDate:r,endDate:a}=e;if(!i&&((o=n.entries)!=null&&o.length||(l=n.drawDefinitions)!=null&&l.length)){let d=Kt({drawDefinitions:!!((c=n.drawDefinitions)!=null&&c.length),entries:!!((u=n.entries)!=null&&u.length)});return{info:"entries/drawDefinitions cannot exist",error:Re,context:d}}let s={eventType:oI,drawDefinitions:[],entries:[],startDate:r,endDate:a,...n};if(n.eventType===Al){if(n.tieFormat){let d=Bo({tieFormat:n.tieFormat});if(d.error)return d}else if(n.tieFormatName){if(!vde[n.tieFormatName])return{context:{tieFormatName:n.tieFormatName},error:Re};let d=Bf({isMock:e==null?void 0:e.isMock,namedFormat:n.tieFormatName,event:n});s.tieFormat=d}}if(s.eventId||(s.eventId=yn()),e.events.reduce((d,p)=>d||p.eventId===s.eventId,void 0))return{error:Lre};{let d=s;if(e.events.push(d),!t){let{topics:p}=dc();if(p.includes(Ox)){let m=Jh({event:n}).matchUps??[];dg({tournamentId:e==null?void 0:e.tournamentId,eventId:n.eventId,matchUps:m})}let{drawDefinitions:h,...f}=n;for(let m of h||[])zP({drawDefinition:m});$Le({tournamentId:e==null?void 0:e.tournamentId,event:f})}return{...de,event:s}}}function yde(t){var s,o,l,c;let e=Qt(t,[{[FS]:{[Dx]:!0,[Vse]:!0}},{[ba]:!0}]);if(e.error)return e;let i=t.tieFormat||Bf({namedFormat:t.tieFormatName}),n=t.uuids||[Zae(i.collectionDefinitions.length)],r={[Cn]:[],[Yn]:[]};if(t.addEntriesFromTeams){let u=(o=(s=t.tournamentRecord.participants)==null?void 0:s.filter(d=>d.participantType===Lo))==null?void 0:o.flatMap(d=>d.individualParticipantIds??[]);for(let d of t.tournamentRecord.participants??[])if(u!=null&&u.includes(d.participantId)){let p=(l=d.person)==null?void 0:l.sex;p&&[Cn,Yn].includes(p)&&r[p].push(d.participantId)}}let a=[];for(let u of i.collectionDefinitions??[]){let d=((c=n==null?void 0:n.pop())==null?void 0:c.toString())||yn(),p=u.matchUpType,h=u.gender,f={matchUpFormat:u.matchUpFormat,eventName:u.collectionName,category:u.category,gender:h,eventType:p,eventId:d};if(t.addEntriesFromTeams){let m=p===Vf?eu:t.entryStatus||ol,g=h===Oo?[...r[Cn],...r[Yn]]:r[h]??[];if(g.length){let v=gp({participantIds:g,entryStatus:m,event:f});if(v.error)return v}}if(a.push(f),t.addEvents!==!1){let m=IU({internalUse:!0,tournamentRecord:t.tournamentRecord,event:f});if(m.error)return m}}return{...de,events:a}}var bde={};Li(bde,{addDrawDefinition:()=>xC,addEvent:()=>IU,addFlight:()=>jO,assignSeedPositions:()=>Cde,attachFlightProfile:()=>e4,deleteDrawDefinitions:()=>$O,deleteEvents:()=>Mde,deleteFlightAndFlightDraw:()=>Ede,deleteFlightProfileAndFlightDraws:()=>Sde,modifyEvent:()=>Nde,modifyEventMatchUpFormatTiming:()=>Tde,modifyPairAssignment:()=>Pde,refreshEventDrawOrder:()=>QW,removeEventMatchUpFormatTiming:()=>BO,removeScaleValues:()=>t4,removeSeeding:()=>Rde,setEventDates:()=>XW,setEventDisplay:()=>VO,setEventEndDate:()=>ZW,setEventStartDate:()=>KW,updateDrawIdsOrder:()=>JW,validateCategory:()=>eE});function wU({removePriorValues:t=!0,status:e=hc,statusObject:i,event:n}){if(!Xi(i))return{error:Re};let r=iu({event:n,status:e}),a=`${Gg}.${Hg}`,s={itemValue:{[e]:{...r,...i}},itemType:a};return uw({timeItem:s,removePriorValues:t,event:n})}function SU(t){var T,w,S,U,P,E,R;let e=Qt(t,[{[ba]:!0,[Fg]:!0},{eventDataParams:!1,[qo]:el}]);if(e.error)return e;let{includePositionAssignments:i,removePriorValues:n,tournamentRecord:r,status:a=hc,event:s,drawIdsToRemove:o,drawIdsToAdd:l}=t,{appliedPolicies:c}=hn({tournamentRecord:r,event:s}),u={...c,...t.policyDefinitions},d=((T=s==null?void 0:s.drawDefinitions)==null?void 0:T.map(({drawId:C})=>C))??[],p=t.drawDetails?Object.keys(t.drawDetails):[],h=p.length?[]:t.drawIds,f=(l??[]).concat(...o??[],...h??[],...p),m=f.filter(C=>!d.includes(C));if(m.length)return he({result:{error:tc},context:{invalidDrawIds:m}});let g=iu({event:s,status:a}),v=Object.keys((g==null?void 0:g.drawDetails)||{}).filter(C=>d.includes(C)).reduce((C,M)=>(C[M]=g.drawDetails[M],C),{});for(let C of d)if((!f.length||f.includes(C))&&(o!=null&&o.includes(C)||h!=null&&h.length&&!h.includes(C)?v[C]={...v[C],publishingDetail:{published:!1}}:(l!=null&&l.includes(C)||h!=null&&h.includes(C)||!(h!=null&&h.length))&&(v[C]={...v[C],publishingDetail:{published:!0}})),(w=t.drawDetails)==null?void 0:w[C]){let M=t.drawDetails[C],_=M.structureDetails??v[C].structureDetails,A=M.stageDetails??v[C].stageDetails??{},{structureIdsToRemove:N=[],structureIdsToAdd:k=[],publishingDetail:O={},stagesToRemove:$=[],stagesToAdd:F=[]}=M;if((k||F)&&(O.published=!0),v[C]={publishingDetail:O,structureDetails:_,stageDetails:A},k.length||N.length){let j=(((U=(S=s==null?void 0:s.drawDefinitions)==null?void 0:S.find(z=>z.drawId===C))==null?void 0:U.structures)??[]).map(({structureId:z})=>z),B=(k??[]).concat(N??[]).filter(z=>!j.includes(z));if(B.length)return he({result:{error:gr},context:{invalidStructureIds:B}});_=_??{};for(let z of j)N.includes(z)?_[z]={published:!1}:_[z]={published:!0};v[C].structureDetails=_}let V=(((E=(P=s==null?void 0:s.drawDefinitions)==null?void 0:P.find(j=>j.drawId===C))==null?void 0:E.structures)??[]).map(({stage:j})=>j);if(F.length){for(let j of F)A[j]={published:!0};for(let j of V)A[j]||(A[j]={published:!1})}if(F.length||$.length){for(let j of $)A[j]={published:!1};for(let j of V)A[j]||(A[j]={published:!0})}(F.length||$.length)&&(v[C].stageDetails=A)}wU({statusObject:{drawDetails:v},removePriorValues:n,status:a,event:s});let{topics:y}=dc(),b=y.includes(xV),I=b||t.returnEventData?(R=CO({includePositionAssignments:i,...t.eventDataParams,usePublishState:!0,tournamentRecord:r,policyDefinitions:u,event:s}))==null?void 0:R.eventData:void 0;return b&&Si({payload:{eventData:I,tournamentId:r.tournamentId},topic:xV}),{...de,eventData:I}}var Ide="deleteDrawDefinitions",lj="autoSchedulingAudit",WN="deleteEvents",wde={AUTO_SCHEDULING_AUDIT:lj,DELETE_EVENTS:WN,DELETE_DRAW_DEFINITIONS:Ide};function $O(t){var U,P,E,R,C;if(!t.tournamentRecord)return{error:ut};let e="deleteDrawDefinitions",i=t.drawIds??[],n=t.event,{autoPublish:r=!0,tournamentRecord:a,auditData:s,eventId:o,force:l}=t,{appliedPolicies:c}=hn({tournamentRecord:a,event:n}),u={...c,...t.policyDefinitions},d=Array.isArray(i)?i[0]:void 0;if(!n){let M=jo({tournamentRecord:a,eventId:o,drawId:d});if(M.error)return M;n=M.event}let p=[],h=[],f=[];if(!(n!=null&&n.drawDefinitions))return he({info:"event has no drawDefinition",result:{...de},stack:e});let m=n.drawDefinitions.map(({drawId:M})=>M);if(i.length||(i=m),i=i.filter(M=>m.includes(M)),!i.length)return he({info:"nothing to do; no matching drawIds in event.",result:{...de},stack:e});let g=_t(_r({event:n}).flightProfile,!1,!0),v=({participantId:M,drawPosition:_,qualifier:A,bye:N})=>({bye:N,qualifier:A,drawPosition:_,participantId:M}),y=l??((P=(U=c==null?void 0:c[zc])==null?void 0:U.allowDeletionWithScoresPresent)==null?void 0:P.drawDefinitions),b=iu({event:n})??{},I=b.drawIds??(b.drawDetails&&Object.keys(b.drawDetails))??[],T,w=[],S=n.drawDefinitions.filter(M=>{var _,A,N,k,O,$,F,V;if(i.includes(M.drawId)){let j=((_=lo({event:n,drawDefinition:M}))==null?void 0:_.matchUps)??[];if(j.some(({score:ce})=>ga({score:ce}))&&!y)return w.push(M.drawId),!0;let{drawId:B,drawType:z,drawName:W}=M,Z=(A=g==null?void 0:g.flights)==null?void 0:A.find(ce=>ce.drawId===M.drawId);Z&&(Z.drawEntries=(N=Z.drawEntries)==null?void 0:N.filter(ce=>id.includes(ce.entryStatus))),I.includes(B)&&(I=I.filter(ce=>ce!==B),T=!0);let K=(O=(k=Wu({stageSequence:1,drawDefinition:M,stage:Ft}))==null?void 0:k.structures)==null?void 0:O[0],Q=(F=($=K?mE({structureId:K.structureId,tournamentRecord:a,drawDefinition:M}):void 0)==null?void 0:$.positionAssignments)==null?void 0:F.map(v),J=(V=Wu({stage:ni,drawDefinition:M}))==null?void 0:V.structures,se=J!=null&&J.length?J.map(ce=>{var te;let oe=ce.stageSequence;return{positionAssignments:(te=mE({structureId:ce.structureId,tournamentRecord:a,drawDefinition:M}))==null?void 0:te.positionAssignments.map(v),stageSequence:oe}}):void 0,ie={action:Ide,payload:{drawDefinitions:[M],eventId:o??(n==null?void 0:n.eventId),auditData:s}};f.push(ie),p.push(Kt({tournamentId:a.tournamentId,eventId:o??(n==null?void 0:n.eventId),qualifyingPositionAssignments:se,positionAssignments:Q,auditData:s,drawType:z,drawName:W,drawId:B})),j==null||j.forEach(({matchUpId:ce})=>h.push(ce))}return!i.includes(M.drawId)});if(w.length&&!l)return he({context:{drawIdsWithScoresPresent:w},result:{error:px},stack:e});if(n.drawDefinitions=S,g&&Bg({event:n,extension:{name:qu,value:g}}),NC({tournamentRecord:a}),T){let M={};for(let A of I)M[A]=((E=b.drawDetails)==null?void 0:E[A])??{published:!0};let _=wU({statusObject:{drawDetails:M},event:n});if(_.error)return{error:_.error}}if(f.length)if(fx(Af)){let M=a.tournamentId;Si({topic:Af,payload:{tournamentId:M,detail:f}});let _=(((C=(R=Qc({element:n,itemType:Vv}))==null?void 0:R.timeItem)==null?void 0:C.itemValue)||0)+1;qp({element:n,timeItem:{itemType:Vv,itemValue:_},removePriorValues:!0})}else GLe({appliedPolicies:c,event:n,deletedDrawsDetail:p,auditData:s});if(h.length&&Im({tournamentId:a==null?void 0:a.tournamentId,matchUpIds:h}),i.forEach(M=>QNe({drawId:M})),r&&T){let M=SU({...t.eventDataParams,drawIdsToRemove:i,policyDefinitions:u,tournamentRecord:a,event:n});if(M.error)return{...de,info:M.error}}return{...de}}function GLe({appliedPolicies:t,event:e,deletedDrawsDetail:i,auditData:n}){var o;if(((o=t==null?void 0:t.audit)==null?void 0:o[Vv])===!1)return;let{extension:r}=ki({name:Vv,element:e}),a={...n,deletedDrawsDetail:i},s={value:Array.isArray(r==null?void 0:r.value)?r==null?void 0:r.value.concat(a):[a],name:Vv};dn({element:e,extension:s})}function Sde({autoPublish:t=!0,tournamentRecord:e,auditData:i,event:n,force:r}){var s;if(!e)return{error:ut};if(!n)return{error:Jn};let{flightProfile:a}=_r({event:n});if(a){let o=(s=a.flights)==null?void 0:s.map(({drawId:c})=>c).filter(Boolean),l=$O({eventId:n.eventId,tournamentRecord:e,autoPublish:t,auditData:i,drawIds:o,event:n,force:r});return l.error?l:Nx({event:n,name:qu})}return{...de}}function WW(t){let{matchUpFormat:e,recoveryTimes:i,averageTimes:n,tournamentId:r,eventId:a}=t,s=(t==null?void 0:t.tournamentRecords)??((t==null?void 0:t.tournamentRecord)&&{[t.tournamentRecord.tournamentId]:t.tournamentRecord})??{};if(!Object.keys(s).length)return{error:wr};let o=Object.keys(s).filter(c=>!r||r===c);if(r&&!o.includes(r))return{error:Re};let l;for(let c of o){let u=s[c],{event:d}=jo({tournamentRecord:u,eventId:a});a&&d&&(l=!0);let p=HLe({tournamentRecord:u,event:d,matchUpFormat:e,averageTimes:n,recoveryTimes:i});if(p.error)return p}return!a||l?{...de}:{error:Gc}}function HLe({tournamentRecord:t,recoveryTimes:e,matchUpFormat:i,averageTimes:n,event:r}){if(!t)return{error:ut};if(n&&!Array.isArray(n))return{error:Re};if(e&&!Array.isArray(e))return{error:Re};let a=qf;if(r){let{extension:s}=ki({element:r,name:a}),o=(s==null?void 0:s.value)||{},l=EZ({...o,matchUpFormat:i,averageTimes:n,recoveryTimes:e});dn({element:r,extension:{name:a,value:l}})}else{let{extension:s}=ki({element:t,name:a}),o=(s==null?void 0:s.value)||{},l=EZ({...o,matchUpFormat:i,averageTimes:n,recoveryTimes:e});dn({extension:{name:a,value:l},element:t})}return{...de}}function EZ(t){let{matchUpRecoveryTimes:e=[],matchUpAverageTimes:i=[],matchUpFormat:n}=t,{averageTimes:r,recoveryTimes:a}=t;r=(r||[]).filter(l=>{var c,u;return((c=l==null?void 0:l.categoryNames)==null?void 0:c.length)||((u=l==null?void 0:l.categoryTypes)==null?void 0:u.length)});let s=(r==null?void 0:r.length)&&i.map(l=>{var c;return l!=null&&l.matchUpFormatCodes.includes(n)?{...l,matchUpFormatCodes:(c=l.matchUpFormatCodes)==null?void 0:c.filter(u=>u!==n)}:l}).filter(({matchUpFormatCodes:l})=>l==null?void 0:l.length).concat({matchUpFormatCodes:[n],averageTimes:r});a=(a||[]).filter(l=>{var c,u;return((c=l==null?void 0:l.categoryNames)==null?void 0:c.length)||((u=l==null?void 0:l.categoryTypes)==null?void 0:u.length)});let o=(a==null?void 0:a.length)&&e.map(l=>{var c;return l!=null&&l.matchUpFormatCodes.includes(n)?{...l,matchUpFormatCodes:(c=l.matchUpFormatCodes)==null?void 0:c.filter(u=>u!==n)}:l}).filter(({matchUpFormatCodes:l,averageTimes:c})=>(l==null?void 0:l.length)||c).concat({matchUpFormatCodes:[n],recoveryTimes:a});return{matchUpAverageTimes:(s==null?void 0:s.length)&&s||i,matchUpRecoveryTimes:(o==null?void 0:o.length)&&o||e}}function Tde(t){let{tournamentRecord:e,recoveryMinutes:i,averageMinutes:n,matchUpFormat:r,categoryType:a,eventId:s,event:o}=t;if(!e)return{error:ut};if(!Nl({matchUpFormat:r}))return{error:Re};if(!o)return{error:Jn};let{averageTimes:l=[],recoveryTimes:c=[]}=xO({tournamentRecord:e,matchUpFormat:r,event:o}),u=o.category,d=(u==null?void 0:u.categoryName)||(u==null?void 0:u.ageCategoryCode)||(o==null?void 0:o.eventId),p={categoryNames:[d],minutes:{}},h={categoryNames:[d],minutes:{}},f=b=>{var I,T;if((I=b.categoryTypes)!=null&&I.includes(a)&&console.log("encountered:",{categoryType:a}),!((T=b.categoryNames)!=null&&T.includes(d)&&(b.categoryNames=b.categoryNames.filter(w=>w!==d),p={minutes:b.minutes,categoryNames:[d]},!b.categoryNames.length)))return b},m=n&&!isNaN(ui(n)),g=i&&!isNaN(ui(i)),v=l.map(f).filter(b=>{var I;return(I=b==null?void 0:b.categoryNames)==null?void 0:I.length}),y=c.map(f).filter(b=>{var I;return(I=b==null?void 0:b.categoryNames)==null?void 0:I.length});return m&&(Object.assign(p.minutes,{[(o==null?void 0:o.eventType)||xn]:n}),v.push(p)),g&&(Object.assign(h.minutes,{[(o==null?void 0:o.eventType)||xn]:i}),y.push(h)),!m&&!g?{error:Re}:WW({averageTimes:m&&v,recoveryTimes:g&&y,tournamentRecord:e,matchUpFormat:r,eventId:s,event:o})}function BO(t){if(t.event)return PZ({event:t.event});{t.tournamentRecord&&!t.tournamentRecords&&(t.tournamentRecords={[t.tournamentRecord.tournamentId]:t.tournamentRecord});let e=Qt(t,[{[ks]:!0,[qse]:!0}]);if(e.error)return e;let{tournamentRecords:i,eventId:n}=t;for(let r of Object.values(i??{})){let{event:a}=jo({tournamentRecord:r,eventId:n});if(a)return PZ({event:a})}}return{error:Gc}}function PZ({event:t}){return Nx({event:t,name:qf})}var zLe="MON",qLe="TUE",WLe="WED",YLe="THU",KLe="FRI",ZLe="SAT",XLe="SUN",YW={MON:zLe,TUE:qLe,WED:WLe,THU:YLe,FRI:KLe,SAT:ZLe,SUN:XLe};function Ude(t){return!Array.isArray(t)||Ei(t).length!==t.length?!1:t.every(e=>Object.keys(YW).includes(e))}function KW({tournamentRecord:t,event:e,startDate:i}){if(!t)return{error:ut};if(!e)return{error:Jn};if(!Dp.test(i))return{error:Fa};let n=Dde(t);if(n.error)return n;let{tournamentStartDate:r,tournamentEndDate:a}=n,s=new Date(Ri(i)).getTime();if(!r||!a||s<r||s>a)return{error:Fa};let o=e.endDate&&new Date(Ri(e.endDate)).getTime();return o&&s>o&&(e.endDate=i),e.startDate=i,{...de}}function ZW(t){let{tournamentRecord:e,event:i,endDate:n}=t;if(!e)return{error:ut};if(!i)return{error:Jn};if(!Dp.test(n))return{error:Fa};let r=Dde(e);if(r.error)return r;let{tournamentStartDate:a,tournamentEndDate:s}=r,o=new Date(Ri(n)).getTime();if(!a||!s||o<a||o>s)return{error:Fa};let l=i.startDate&&new Date(Ri(i.startDate)).getTime();return l&&o<l&&(i.startDate=n),i.endDate=n,{...de}}function XW(t){var l;let e=Qt(t,[{tournamentRecord:!0,event:!0},{[ds]:c=>Dp.test(c),[rc]:Fa,startDate:!1,endDate:!1},{[ds]:c=>c.filter(Boolean).every(u=>Dp.test(u)),[rc]:Fa,activeDates:!1},{[ds]:Ude,weekdays:!1}]);if(e.error)return e;let{tournamentRecord:i,weekdays:n,event:r,startDate:a,endDate:s}=t,o=(l=t.activeDates)==null?void 0:l.filter(Boolean);if(a&&s){let c=new Date(Ri(a)).getTime(),u=new Date(Ri(s)).getTime();if(c>u)return{error:Re}}if(o){let c=a||i.startDate,u=s||i.endDate,d=!c||o.every(h=>new Date(h)>=new Date(c)),p=!u||o.every(h=>new Date(h)<=new Date(u));if(!d||!p)return{error:Fa}}if(a){let c=KW({tournamentRecord:i,event:r,startDate:a});if(c.error)return c}if(s){let c=ZW({tournamentRecord:i,event:r,endDate:s});if(c.error)return c}return o&&(r.activeDates=o),n&&(r.weekdays=n),{...de}}function Dde(t){let{startDate:e,endDate:i}=t;return!Dp.test(e)||!Dp.test(i)?he({result:{error:Xre},context:{startDate:e,endDate:i}}):{tournamentStartDate:new Date(Ri(e)).getTime(),tournamentEndDate:new Date(Ri(i)).getTime()}}function JW({event:t,orderedDrawIdsMap:e}){var r,a;if(typeof t!="object")return{error:Jn};if(!e)return{error:ai,info:"Missing drawIdsOrderMap"};if(typeof e!="object")return{error:Re,info:"orderedDrawIdsMap must be an object"};let i=Object.values(e);if(!i.every(s=>!isNaN(s)))return{error:Re,info:"drawOrder must be numeric"};if(Ei(i).length!==i.length)return{error:Re,info:"drawOrder values must be unique"};if((r=t.drawDefinitions)!=null&&r.length){let s=(t.drawDefinitions||[]).map(({drawId:l})=>l),o=Object.keys(e);if(o!=null&&o.length&&Nr(s,o).length!==s.length)return{error:Re,info:"Missing drawIds"};t.drawDefinitions.forEach(l=>{l.drawOrder=e[l.drawId]})}let{flightProfile:n}=_r({event:t});return(a=n==null?void 0:n.flights)==null||a.forEach(s=>{s.flightNumber=e[s.drawId]}),{...de}}function QW({tournamentRecord:t,event:e}){var r;if(!t)return{error:ut};if(!e)return{error:Jn};let{flightProfile:i}=_r({event:e}),n=(i==null?void 0:i.flights)&&Object.assign({},...i.flights.sort((a,s)=>a.flightNumber-s.flightNumber).map((a,s)=>({[a.drawId]:s+1})))||((r=e.drawDefinitions)==null?void 0:r.length)&&Object.assign({},...e.drawDefinitions.sort((a,s)=>a.drawOrder-s.drawOrder).map((a,s)=>({[a.drawId]:s+1})))||void 0;return n?JW({event:e,orderedDrawIdsMap:n}):{...de}}function Ede({autoPublish:t=!0,tournamentRecord:e,auditData:i,drawId:n,event:r,force:a}){var o,l;if(!e)return{error:ut};if(!n)return{error:Vd};if(!r)return{error:Jn};let{flightProfile:s}=_r({event:r});if(s&&((o=s.flights)!=null&&o.find(c=>c.drawId===n))){let c=s.flights.filter(d=>d.drawId!==n),u={name:qu,value:{...s,flights:c}};Bg({event:r,extension:u})}if((l=r.drawDefinitions)!=null&&l.find(c=>c.drawId===n)){let c=$O({drawIds:[n],eventId:r.eventId,tournamentRecord:e,autoPublish:t,auditData:i,event:r,force:a});if(c.error)return c}return QW({tournamentRecord:e,event:r})}function Pde(t){var g,v;let e=Qt(t,[{[Fg]:!0,[ba]:!0,[uq]:!1},{replacementIndividualParticipantId:!0,[ds]:y=>nr(y),existingIndividualParticipantId:!0,[Au]:la,participantId:!0}]),{replacementIndividualParticipantId:i,existingIndividualParticipantId:n,tournamentRecord:r,drawDefinition:a,participantId:s,event:o,uuids:l}=t;if(e.error)return e;if((o==null?void 0:o.eventType)!==Hc)return{error:_h};if(!(((g=o==null?void 0:o.entries)==null?void 0:g.filter(({entryStatus:y})=>[eu,$y].includes(y)).map(({participantId:y})=>y))||[]).includes(i))return{error:Md};let c=(r.participants||[]).find(y=>y.participantId===s);if((c==null?void 0:c.participantType)!==Ni)return{error:jI,participant:c};let u=c.individualParticipantIds,d=[i,...u.filter(y=>y!==n)],{participant:p}=Yu({participantIds:d,tournamentRecord:r}),h;if(p)h=p.participantId;else{let y={participantId:l==null?void 0:l.pop(),participantRole:ms,individualParticipantIds:d,participantType:Ni},b=Np({participant:y,returnParticipant:!0,tournamentRecord:r});if(b.error)return b;h=b.participant.participantId}let{flightProfile:f}=_r({event:o});if(a){let y=(v=f==null?void 0:f.flights)==null?void 0:v.find(({drawId:b})=>b===a.drawId);y&&(y.drawEntries=y.drawEntries.map(b=>b.participantId===s?{...b,participantId:h}:b)),a.entries=a.entries.map(b=>b.participantId===s?{...b,participantId:h}:b);for(let b of a.structures||[])if(b.structures){b.positionAssignments=void 0;for(let I of b.structures)I.positionAssignments=I.positionAssignments.map(T=>T.participantId===s?{...T,participantId:h}:T)}else b.positionAssignments&&(b.positionAssignments=b.positionAssignments.map(I=>I.participantId===s?{...I,participantId:h}:I))}o.entries=o.entries.map(y=>y.participantId===s&&{...y,participantId:h}||y.participantId===i&&{...y,participantId:n}||y);let m=r.events.some(({entries:y,eventId:b,drawDefinitions:I})=>o.eventId===b?I.some(({drawId:T,entries:w})=>T===(a==null?void 0:a.drawId)?!1:w==null?void 0:w.find(S=>S.participantId===s)):y==null?void 0:y.find(T=>T.participantId===s));if(!m){let y=sw({addIndividualParticipantsToEvents:!1,participantIds:[s],tournamentRecord:r});if(y.error)return y}return{...de,participantOtherEntries:m,newPairParticipantId:h}}function xC(t){var C,M,_,A,N,k,O,$,F,V,j,B;let{flight:e,suppressNotifications:i,modifyEventEntries:n,existingDrawCount:r,allowReplacement:a,checkEntryStatus:s,tournamentRecord:o,drawDefinition:l,event:c}=t;if(!l)return{error:Gt};if(!c)return{error:Jn};c.drawDefinitions||(c.drawDefinitions=[]);let{drawId:u,drawName:d,entries:p}=l,{entries:h}=c,f=0;if(r!==void 0&&r!==c.drawDefinitions.length)return{error:Re,info:"drawDefintions count mismatch"};let{flightProfile:m}=_r({event:c}),g=e&&((C=m==null?void 0:m.flights)==null?void 0:C.find(z=>z.flightNumber===e.flightNumber)),v=(A=(_=(M=m==null?void 0:m.links)==null?void 0:M.find(z=>{var W;return((W=z==null?void 0:z.target)==null?void 0:W.drawId)===u}))==null?void 0:_.source)==null?void 0:A.drawId;if(v&&!c.drawDefinitions.find(z=>z.drawId===v))return he({result:{error:Gt},info:{sourceDrawId:v}});if(g&&g.drawId!==l.drawId)return he({result:{error:kb},info:{relevantFlight:g}});let y=p==null?void 0:p.every(({participantId:z,entryStatus:W})=>{let Z=g==null?void 0:g.drawEntries.find(K=>K.participantId===z);return!W||(Z==null?void 0:Z.entryStatus)===W}),b=!s||h&&(p==null?void 0:p.every(({participantId:z,entryStatus:W,entryStage:Z})=>{var K;return((K=h.find(Q=>Q.participantId===z&&(!Q.entryStage||Q.entryStage===Z)))==null?void 0:K.entryStatus)===W}));if(g&&!y)return he({result:{error:kb},context:{drawEntriesPresentInFlight:y,matchingEventEntries:b,relevantFlight:g},info:"Draw entries are not present in flight or do not match entryStatuses"});if(n&&(p==null||p.filter(Boolean).forEach(z=>{if(z!=null&&z.entryStatus&&id.includes(z==null?void 0:z.entryStatus)){let W=h==null?void 0:h.filter(Boolean).find(Z=>Z.participantId===z.participantId);W&&z.entryStatus&&(W==null?void 0:W.entryStatus)!==z.entryStatus&&(W.entryStatus=z.entryStatus,f+=1)}})),h&&!b)return he({result:{info:"Draw entries do not match event entryStatuses",context:{matchingEventEntries:b,eventEntries:h},error:kb}});let I=((k=(N=m==null?void 0:m.flights)==null?void 0:N.map(({flightNumber:z})=>!isNaN(z)&&ui(z)))==null?void 0:k.filter(Boolean))||[],T=((O=c.drawDefinitions.map(({drawOrder:z})=>z&&ui(z)))==null?void 0:O.filter(Boolean))||[],w=Math.max(0,...T,...I)+1,S=($=m==null?void 0:m.flights)==null?void 0:$.find(z=>z.drawId===u),U;if(S){S.drawName=l.drawName,U={name:qu,value:{...m,flights:m.flights}};let z=S.flightNumber;z&&!T.includes(z)?w=z:S.flightNumber=w}else{let z=(m==null?void 0:m.flights)||[];z.push({manuallyAdded:!0,flightNumber:w,drawEntries:p,drawName:d,drawId:u}),U={name:qu,value:{...m||{},flights:z}}}Bg({event:c,extension:U}),Object.assign(l,{drawOrder:w});let P=c.drawDefinitions.find(z=>z.drawId===u),E=o==null?void 0:o.tournamentId,R=c.eventId;if(P){if(!a)return{error:Pre};let z=((V=(F=lo({drawDefinition:P}))==null?void 0:F.matchUps)==null?void 0:V.map(Pa))??[],W=(j=lo({drawDefinition:l}))==null?void 0:j.matchUps;if(!i){z!=null&&z.length&&Im({matchUpIds:z,action:"modifyDrawDefinition",tournamentId:E,eventId:R}),W!=null&&W.length&&dg({matchUps:W,tournamentId:E,eventId:R}),c.drawDefinitions=c.drawDefinitions.map(K=>K.drawId===u?l:K);let Z=(B=l.structures)==null?void 0:B.map(({structureId:K})=>K);Hn({drawDefinition:l,tournamentId:E,structureIds:Z,eventId:R})}}else if(c.drawDefinitions.push(l),!i){let{matchUps:z}=lo({drawDefinition:l,event:c});z&&dg({tournamentId:o==null?void 0:o.tournamentId,matchUps:z}),zP({drawDefinition:l,tournamentId:E,eventId:R})}return{...de,modifiedEventEntryStatusCount:f}}function Cde(t){let{provisionalPositioning:e,useExistingSeedLimit:i,tournamentRecord:n,drawDefinition:r,seedingProfile:a,structureId:s,assignments:o,drawId:l,event:c}=t,u=0;if(!(o!=null&&o.length))return{error:Sz};if(!n)return{error:ut};if(!l)return{error:Vd};let d=qc({provisionalPositioning:e,drawDefinition:r,structureId:s});if(d.error)return d;let{seedAssignments:p,seedLimit:h}=d,f=Object.assign({},...(p??[]).filter(v=>v.seedNumber).map(v=>({[v.seedNumber]:v})));o.forEach(v=>{let{seedNumber:y}=v;h&&y<=h&&(!i||f[y])&&(f[y]=v)});let m=Object.values(f),g=m.map(v=>v==null?void 0:v.participantId).filter(Boolean);if(g.length!==mre(g).length)return{error:Cre};for(let v of m){let y=fU({...v,provisionalPositioning:e,tournamentRecord:n,drawDefinition:r,seedingProfile:a,structureId:s,event:c});if(y!=null&&y.error)return y;y!=null&&y.success&&u++}return u?{...de,modifications:u}:{error:eU}}function e4({deleteExisting:t,event:e,flightProfile:i}){var a;let n="attachFlightProfile";if(!i)return he({result:{error:ai},stack:n});if(!e)return he({result:{error:Jn},stack:n});let{flightProfile:r}=_r({event:e});return r&&!t?he({result:{error:$z},stack:n}):(a=e.drawDefinitions)!=null&&a.length?he({result:{error:Ure},stack:n}):(Bg({event:e,extension:{name:qu,value:i}}),{flightProfile:_t(i,!1,!0),...de})}function JLe({tournamentRecord:t,scaleAttributes:e,participantIds:i}){var o;if(!t)return{error:ut};if(!i)return{error:xg};if(!e)return{error:ai,info:"scaleAttributes required"};let{scaleType:n,eventType:r,scaleName:a}=e,s=[Ooe,n,r,a].join(".");return(o=t.participants)==null||o.forEach(l=>{i.includes(l.participantId)&&l.timeItems&&(l.timeItems=l.timeItems.filter(c=>c&&(c==null?void 0:c.itemType)!==s))}),{...de}}function t4({tournamentRecord:t,scaleAttributes:e,drawDefinition:i,entryStatuses:n,drawId:r,event:a,stage:s}){var c;if(!a)return{error:Jn};if(n&&!Array.isArray(n))return he({result:{error:Re},info:sy("entryStatus"),stack:"removeScaleValues"});let o=a.entries;if(r){let{flightProfile:u}=_r({event:a}),d=(c=u==null?void 0:u.flights)==null?void 0:c.find(p=>p.drawId===r);d?o=d.drawEntries:o=i==null?void 0:i.entries}let l=(o||[]).filter(u=>(!s||!u.entryStage||u.entryStage===s)&&(!n||n.includes(u.entryStatus))).map(Vi);return JLe({tournamentRecord:t,scaleAttributes:e,participantIds:l})}function VO({removePriorValues:t,tournamentRecord:e,displaySettings:i,status:n=hc,event:r}){if(!e)return he({result:{error:ut}});if(!r)return he({result:{error:Jn}});if(!Xi(i))return he({result:{error:ai}});if(Xi(i.draws))for(let s of Object.keys(i.draws)){let o=i.draws[s].scheduleDetails??[];if(o.length){let l=[];for(let c of o){let u=l.find(d=>YRe(d.attributes,c.attributes));u!=null&&u.dates&&c.dates?u.dates.push(...c.dates):l.push(c)}i.draws[s].scheduleDetails=l}}let a=wU({statusObject:{displaySettings:i},removePriorValues:t,status:n,event:r});return a.error?a:{...de}}function Rde({tournamentRecord:t,drawDefinition:e,entryStatuses:i,scaleName:n,drawId:r,event:a,stage:s}){var l,c;if(!t)return{error:ut};if(!a)return{error:Jn};n=n||((l=a.category)==null?void 0:l.categoryName)||((c=a.category)==null?void 0:c.ageCategoryCode);let o={eventType:a.eventType,scaleType:wh,scaleName:n};return t4({tournamentRecord:t,scaleAttributes:o,drawDefinition:e,entryStatuses:i,drawId:r,event:a,stage:s})}function Mde(t){let e=Qt(t,[{[ba]:!0},{eventIds:!0,[qo]:Rs}]);if(e.error)return e;let{removePairParticipants:i,tournamentRecord:n,eventIds:r}=t,a=[],s=[],o=[],l=[];if(n.events=(n.events||[]).filter(c=>{if(r.includes(c.eventId)){let p={action:WN,payload:{events:[c]}};a.push(p),s.push({tournamentId:n.tournamentId,eventName:c.eventName,eventType:c.eventType,category:c.category,eventId:c.eventId,gender:c.gender})}let u=c.eventType===Hc?(c.entries||[]).map(({entryStatus:p,participantId:h})=>p!==eu&&h).filter(Boolean):[],d=r.includes(c.eventId);return d?l.push(...u):o.push(...u),!d}),i){let c=l.filter(u=>!o.includes(u));n.participants=n.participants.filter(({participantId:u})=>!c.includes(u))}if(NC({tournamentRecord:n}),a.length)if(fx(Af)){let c=n.tournamentId;Si({topic:Af,payload:{type:WN,tournamentId:c,detail:a}})}else TC({tournamentRecord:n,timeItem:{itemValue:s,itemType:WN}});return{...de}}function Nde(t){var m,g,v;let e=Qt(t,[{tournamentRecord:!0,eventId:!0,event:!0},{eventUpdates:!0,_ofType:el}]);if(e.error)return e;let{eventUpdates:i,event:n}=t,r="modifyEvent",a=tFe(t),s=iFe({enteredParticipants:a}),{enteredParticipantGenders:o,enteredParticipantTypes:l}=s,c=(g=(m=_r({event:n}))==null?void 0:m.flightProfile)==null?void 0:g.flights,u=!((v=n.drawDefinitions)!=null&&v.length)&&!(c!=null&&c.length),d=nFe({noFlightsNoDraws:u,enteredParticipantGenders:o,eventUpdates:i,stack:r});if(d.error)return d;let p=rFe({enteredParticipantTypes:l,eventUpdates:i,stack:r});if(p.error)return p;let h=QLe({...t,...s,enteredParticipants:a,stack:r});if(h.error)return h;let f=eFe({...t,stack:r});return f.error?f:(i.eventType&&(n.eventType=i.eventType),i.eventName&&(n.eventName=i.eventName),i.gender&&(n.gender=i.gender),{...de})}function QLe(t){var n,r,a,s,o,l;let e=(n=t.eventUpdates)==null?void 0:n.category;if(!e)return{...de};let i=eE({category:e});if(i.error)return i;if(t.event.eventType===na){let c=((a=(r=t.event)==null?void 0:r.drawDefinitions)==null?void 0:a.map(p=>np(p)))??[],u=np(t.event),d=(((s=Jh(t))==null?void 0:s.matchUps)??[]).map(p=>np(p))??[];if(![u,...c,...d].filter(Boolean).every(p=>p.collectionDefinitions.every(h=>!h.category||OP({category:t.eventUpdates.category,childCategory:h.category}))))return he({result:{error:WD},stack:t.stack})}if((o=t.enteredParticipants)!=null&&o.length){let c=t.eventUpdates.startDate||t.event.startDate||t.tournamentRecord.startDate,u=t.eventUpdates.endDate||t.event.endDate||t.tournamentRecord.endDate,d=t.enteredParticipants.map(f=>f.participantType===ji?f:f.individualParticpants??[]).flat(),p=sI({category:e,consideredDate:c}),h=sI({category:e,consideredDate:u});if(p!=null&&p.ageMinDate||p!=null&&p.ageMaxDate||h!=null&&h.ageMinDate||h!=null&&h.ageMaxDate)for(let f of d){let m=(l=f.person)==null?void 0:l.birthDate;if(!m)return he({result:{error:Wre},stack:t.stack});let g=new Date(m).getTime();if(p.ageMinDate||p.ageMaxDate){let v=new Date(p.ageMinDate).getTime(),y=new Date(p.ageMaxDate).getTime();if(g<v||g>y)return he({result:{error:DV},stack:t.stack})}if(h.ageMin||h.ageMax){let v=new Date(h.ageMinDate).getTime(),y=new Date(h.ageMaxDate).getTime();if(g<v||g>y)return he({result:{error:DV},stack:t.stack})}}}return{...de}}function eFe(t){let{tournamentRecord:e,eventUpdates:i,event:n,stack:r}=t;if(i.startDate||i.endDate){let a=XW({startDate:i.startDate,endDate:i.endDate,tournamentRecord:e,event:n});if(a.error)return he({result:a,stack:r})}return{...de}}function tFe(t){var r;let{tournamentRecord:e,event:i}=t,n=((r=i==null?void 0:i.entries)==null?void 0:r.filter(({entryStatus:a})=>{let s=a;return[...id,_u].includes(s)}).map(({participantId:a})=>a))??[];return n?vr({participantFilters:{participantIds:n},withIndividualParticipants:!0,tournamentRecord:e}).participants??[]:[]}function iFe({enteredParticipants:t}){let e=[],i=t.reduce((r,a)=>{var o,l;let s=(o=a.person)!=null&&o.sex?[a.person.sex]:((l=a.individualParticpants)==null?void 0:l.map(c=>{var u;return(u=c.person)==null?void 0:u.sex}))||[];return e.push(...s),r.includes(a.participantType)?r:r.concat(a.participantType)},[]),n=Ei(e);return{enteredParticipantTypes:i,enteredParticipantGenders:n}}function nFe({noFlightsNoDraws:t,enteredParticipantGenders:e,eventUpdates:i,stack:n}){let r=!e.length||!i.gender||i.gender===Ad||e.length===1&&e[0]===i.gender||t&&i.gender===Oo;return i.gender&&!r?he({context:{gender:i.gender,validGender:r},result:{error:rD},stack:n}):{...de}}function rFe({enteredParticipantTypes:t,eventUpdates:e,stack:i}){let n=(t.includes(na)&&[na]||t.includes(ji)&&[Ep]||t.includes(Ni)&&[Hc]||[Hc,Ep,na]).includes(e.eventType??"");return e.eventType&&!n?he({context:{participantType:e.eventType,validEventType:n},result:{error:_h},stack:i}):{...de}}function jO({qualifyingPositions:t,drawEntries:e=[],drawName:i,drawId:n,event:r,stage:a}){var h,f,m;let s="addFlight";if(!r)return he({result:{error:Jn},stack:s});if(!i)return he({result:{error:ai},stack:s});if(e!=null&&e.length){let g=(r.entries??[]).map(Vi),v=e.map(Vi);if(Nr(v,g).length!==v.length)return he({result:{error:Re},stack:s})}let o=(h=_r({event:r}))==null?void 0:h.flightProfile,l=((m=(f=o==null?void 0:o.flights)==null?void 0:f.map(({flightNumber:g})=>!isNaN(g)&&ui(g)))==null?void 0:m.filter(Boolean))||[],c=Math.max(0,...l)+1,u={drawId:n||yn(),flightNumber:c,drawEntries:e,drawName:i};if(a&&(u.stage=a),t&&(u.qualifyingPositions=t),((o==null?void 0:o.flights)||[]).find(({drawId:g})=>g===u.drawId))return he({result:{error:Eae},stack:s});let d=((o==null?void 0:o.flights)||[]).concat(u),p={name:qu,value:{...o||{},flights:d}};return Bg({event:r,extension:p})}var i4={};Li(i4,{drawMatic:()=>uW,garman:()=>Bde,generateAdHocMatchUps:()=>fO,generateAdHocRounds:()=>cW,generateAndPopulatePlayoffStructures:()=>F3,generateCourts:()=>n4,generateDrawDefinition:()=>kC,generateDrawMaticRound:()=>Q3,generateDrawStructuresAndLinks:()=>Z3,generateDrawTypeAndModifyDrawDefinition:()=>X3,generateFlightProfile:()=>sFe,generateLineUps:()=>$de,generateQualifyingStructure:()=>R3,generateSeedingScaleItems:()=>cde,generateStatCrew:()=>oFe,generateVoluntaryConsolation:()=>Hce,roundRobinGroups:()=>I_e});var aFe="splitLevelBased",Ade="splitWaterfall",_de="splitShuttle",kde={SPLIT_LEVEL_BASED:aFe,SPLIT_WATERFALL:Ade,SPLIT_SHUTTLE:_de};function sFe(t){let{drawNameRoot:e="Flight",attachFlightProfile:i,tournamentRecord:n,scaleAttributes:r,scaleSortMethod:a,deleteExisting:s,sortDescending:o,drawNames:l=[],flightsCount:c,splitMethod:u,uuids:d=[],event:p,stage:h}=t;if(!p)return{error:Jn};let f=p.entries??[],{flightProfile:m}=_r({event:p});if(m&&i&&!s)return{error:$z};let g=t.scaledEntries??dw({tournamentRecord:n,scaleAttributes:r,scaleSortMethod:a,sortDescending:o,event:p,stage:h}).scaledEntries,v=g.map(Vi),y=so(f.filter(({participantId:E})=>!v.includes(E)).filter(E=>(!h||!E.entryStage||E.entryStage===h)&&(!E.entryStatus||By.includes(E.entryStatus)))),b=g.concat(...y),I=b.length,T=Math.ceil(I/c),w=Ra(b,T);u===Ade?w=vV(b,c):u===_de&&(w=vV(b,c,!0));function S(E){return(E||[]).map(({participantId:R,scaleValue:C})=>{let M=f.find(_=>_.participantId===R);return M!=null&&M.scaleValue&&C&&(M.scaleValue=C),M}).sort((R,C)=>R.scaleValue-C.scaleValue).map((R,C)=>(R.scaleValue&&(R.seedNumber=C+1),R))}let U=Rt(0,c).map(E=>{let R=E+1;return{flightNumber:R,drawId:(d==null?void 0:d.pop())??yn(),drawEntries:S(w[E]),drawName:(l==null?void 0:l.length)&&l[E]||`${e} ${R}`}}),P={scaleAttributes:r,splitMethod:u,flights:U};if(i){let E=e4({flightProfile:P,deleteExisting:s,event:p});return{splitEntries:ic()&&w||void 0,...E}}else return{flightProfile:P,...de}}function xde({json:t,tagName:e}){let i=Object.keys(t).filter(a=>Array.isArray(t[a])).map(a=>({key:a,value:t[a].filter(s=>typeof s=="object"&&Object.keys(s).length===1)})),n=Object.keys(t).filter(a=>typeof t[a]=="object"&&!Array.isArray(t[a])).map(a=>({key:a,value:t[a]})),r=Object.keys(t).filter(a=>["string","number"].includes(typeof t[a])).map(a=>({key:a,value:t[a]}));return Ode({tagName:e,attributes:r,childArrays:i,childObjects:n})}function Ode(t){let{tagName:e,attributes:i=[],childArrays:n=[],childObjects:r}=t,a=`\r
`,s=h=>{let f=Object.keys(h)[0],m=h[f];return{key:f,value:m}},o=n==null?void 0:n.map(({key:h,value:f})=>Ode({tagName:h,childObjects:f.map(s)})).join(`\r
`),l=r==null?void 0:r.map(({key:h,value:f})=>xde({tagName:h,json:f??[]})).join(`\r
`),c=i==null?void 0:i.map(({key:h,value:f})=>`${h}="${f}"`).join(" "),u=c?` ${c}`:"";if(e==="childArray")return l;let d=l!=null&&l.length?`${a}${l}${a}`:"",p=o!=null&&o.length?`${a}${o}${a}`:"";return`<${e}${u}>${d}${p}</${e}>`}function oFe(t){var b,I,T;let e=Qt(t,[{[ba]:!0}]);if(e.error)return e;let{tournamentRecord:i}=t,{startDate:n,tournamentId:r,tournamentName:a}=i,{participantMap:s,matchUps:o,mappedMatchUps:l}=vr({withMatchUps:!0,withEvents:!0,tournamentRecord:i}),c=i.participants.filter(w=>w.participantType===En),u=(o==null?void 0:o.filter(w=>w.matchUpType===En))??[],d=(u==null?void 0:u.reduce((w,S)=>{let U=(S==null?void 0:S.tieMatchUps)??[];return U&&[...w,...U]},[]))??[],p=(o==null?void 0:o.filter(w=>w.matchUpType===xn))??[],h=(o==null?void 0:o.filter(w=>w.matchUpType===Mn))??[],f=d.length===p.length+h.length,m=u.length===1&&f,g={mappedMatchUps:l,participantMap:s,tournamentName:a,tournamentId:r,tournament:f?"N":"Y",startDate:n},v=[],y=[];if(m){let w=u[0],{json:S,xml:U}=CZ({teamParticipants:c,teamMatchUp:w,...g,doubles:h,singles:p});y.push(S),v.push(U)}else for(let w of u){let S=(b=w==null?void 0:w.sides)==null?void 0:b.map(({participant:R})=>R==null?void 0:R.participantId).filter(Boolean);if((S==null?void 0:S.length)!==2)continue;let U=S.map(R=>{var C;return R&&((C=s==null?void 0:s[R])==null?void 0:C.participant)}),{xml:P,json:E}=CZ({doubles:(I=w.tieMatchUps)==null?void 0:I.filter(R=>R.matchUpType===Mn),singles:(T=w.tieMatchUps)==null?void 0:T.filter(R=>R.matchUpType===xn),teamParticipants:U,teamMatchUp:w,...g});y.push(E),v.push(P)}return{json:y,xml:v,...de}}function CZ({teamParticipants:t,mappedMatchUps:e,participantMap:i,tournamentName:n,tournamentId:r,teamMatchUp:a,tournament:s,startDate:o,doubles:l,singles:c}){var I,T,w,S;let u=t==null?void 0:t.find(U=>{var P;return(P=U.participantRoleResponsibilities)==null?void 0:P.includes("Home")}),d=t==null?void 0:t.filter(U=>U.participantId!==(u==null?void 0:u.participantId)),p=Mu(o,"/","MDY"),h=(u==null?void 0:u.participantName)||((I=d==null?void 0:d[1])==null?void 0:I.participantName),f=(u==null?void 0:u.participantId)||((T=d==null?void 0:d[1])==null?void 0:T.participantId),m=(w=d==null?void 0:d[0])==null?void 0:w.participantName,g=(S=d==null?void 0:d[0])==null?void 0:S.participantId,v={},y=t.map(U=>({team:{...uFe({teamParticipant:U,teamMatchUp:a,uniValues:v,participantMap:i,mappedMatchUps:e,homeid:f})}})),b=Kt({venue:{tournamentname:s?n:void 0,neutralgame:u?"N":"Y",gameid:r,officials:{},tournament:s,rules:{},homename:h,visname:m,homeid:f,visid:g,date:p},childArray:y,singles_matches:c==null?void 0:c.map(U=>RZ({matchUp:U,homeid:f,uniValues:v})),doubles_matches:l==null?void 0:l.map(U=>RZ({matchUp:U,homeid:f,uniValues:v}))});return{json:b,xml:xde({json:b,tagName:"tngame"})}}function lFe({homeid:t,uniValues:e,participant:i}){var m,g,v,y,b,I,T,w,S,U,P,E,R,C,M;if(!i)return{};let n=((m=i.individualParticipants)==null?void 0:m.length)===2,r=n?Ei((g=i.individualParticipants)==null?void 0:g.map(_=>{var A,N;return(N=(A=_.teams)==null?void 0:A[0])==null?void 0:N.participantId})):[],a=n?Ei((v=i.individualParticipants)==null?void 0:v.map(_=>{var A,N;return(N=(A=_.teams)==null?void 0:A[0])==null?void 0:N.teamId})):[],s=!n&&((b=(y=i.teams)==null?void 0:y[0])==null?void 0:b.participantId)||(r==null?void 0:r.length)===1&&r[0]||void 0,o=!n&&((T=(I=i.teams)==null?void 0:I[0])==null?void 0:T.teamId)||(a==null?void 0:a.length)===1&&a[0]||s,l=n?void 0:i.participantName,c=(S=(w=i.individualParticipants)==null?void 0:w[0])==null?void 0:S.participantName,u=(P=(U=i.individualParticipants)==null?void 0:U[1])==null?void 0:P.participantName,d=t&&(s===t?"H":"V")||"",p=n?void 0:e[s][i.participantId],h=e[s][(R=(E=i.individualParticipants)==null?void 0:E[0])==null?void 0:R.participantId],f=e[s][(M=(C=i.individualParticipants)==null?void 0:C[1])==null?void 0:M.participantId];return Kt({vh:d,uni:p,uni_1:h,uni_2:f,team:o,name:l,name_1:c,name_2:u})}function cFe({sets:t,sideNumber:e}){return Object.assign({},...(t==null?void 0:t.map(i=>{let{setNumber:n,side1Score:r,side2Score:a,side1TiebreakScore:s,side2TiebreakScore:o}=i,l=`set_${n}`,c=`tie_${n}`,u=e===1?r:a,d=e===1?s:o;return{[l]:u,[c]:d}}))??[])}function uFe({teamParticipant:t,teamMatchUp:e,participantMap:i,mappedMatchUps:n,homeid:r,uniValues:a}){var I,T,w,S,U,P,E,R,C,M,_,A,N,k;let{participantId:s,participantName:o}=t,l=r&&(s===r?"H":"V")||"",c=(I=i==null?void 0:i[s])==null?void 0:I.matchUps,u=c&&Object.keys(c),d=(w=(T=e==null?void 0:e.sides)==null?void 0:T.find(({participant:O})=>O.participantId===s))==null?void 0:w.sideNumber,p=((P=(U=(S=e==null?void 0:e.score)==null?void 0:S.sets)==null?void 0:U[0])==null?void 0:P[`side${d}Score`])??0;a[s]={};let h={SINGLES:{w:0,l:0},DOUBLES:{w:0,l:0}},f=[],m=[],g=0;for(let O of u??[]){let $=n==null?void 0:n[O],F=(E=$.sides.find(({participant:j})=>j.participantId===s))==null?void 0:E.sideNumber,V=((M=(C=(R=$.score)==null?void 0:R.sets)==null?void 0:C[0])==null?void 0:M[`side${F}Score`])??0;g+=V;for(let j of $.tieMatchUps??[]){let{matchUpType:B,winningSide:z}=j,W=z&&(z===F?"w":"l")||"";W&&(h[B][W]+=1);let Z=W==="w"?"1":"0",K=W==="l"?"1":"0";if(B===xn){let Q=m.length+1;m.push({singles_pair:{pair:Q,won:Z,lost:K,tied:"0"}})}else if(B===Mn){let Q=f.length+1;f.push({doubles_pair:{pair:Q,won:Z,lost:K,tied:"0"}})}}}let v=[{singles:{childArray:m,won:h.SINGLES.w,lost:h.SINGLES.l}},{doubles:{childArray:f,won:h.DOUBLES.w,lost:h.DOUBLES.l}}],y=[],b=1;for(let O of t.individualParticipantIds){let $=i==null?void 0:i[O];if($){let{participant:F,counters:V}=$,j={won:((_=V==null?void 0:V.DOUBLES)==null?void 0:_.wins)||0,lost:((A=V==null?void 0:V.DOUBLES)==null?void 0:A.losses)||0},B={won:((N=V==null?void 0:V.SINGLES)==null?void 0:N.wins)||0,lost:((k=V==null?void 0:V.SINGLES)==null?void 0:k.losses)||0},{participantName:z,participantId:W}=F;a[s][W]=b,y.push({player:{name:z,uni:b,singles:B,doubles:j}})}b+=1}return{vh:l,id:s,name:o,score:p||g,totals:v,childArray:y}}function RZ({matchUp:t,homeid:e,uniValues:i}){let{collectionPosition:n,orderOfFinish:r,matchUpType:a,sides:s}=t??{},o=s==null?void 0:s.map(l=>{var p;let{sideNumber:c,participant:u}=l,d=cFe({sets:(p=t.score)==null?void 0:p.sets,sideNumber:c});return{[a===xn?"singles_score":"doubles_score"]:{...lFe({homeid:e,uniValues:i,participant:u}),...d}}});return{[a===xn?"singles_match":"doubles_match"]:{match:n,order:r,childArray:o}}}var dFe="ASC",Lde="ASC",pFe="DESC",cj="DESC",Fde={ASC:dFe,ASCENDING:Lde,DESC:pFe,DESCENDING:cj};function $de(t){var R,C,M,_,A;let{tieFormat:e}=t,{useDefaultEventRanking:i,tournamentRecord:n,drawDefinition:r,scaleAccessor:a,singlesOnly:s,attach:o,event:l}=t;if((l==null?void 0:l.eventType)!==Al)return{error:_h};if(!n)return{error:ut};if(!e&&!r)return{error:tc};if(e=e??((R=qs({drawDefinition:r,event:l}))==null?void 0:R.tieFormat),Bo({tieFormat:e}).error)return{error:Ih};if(typeof a!="object"&&!i)return{error:Re,context:{scaleAccessor:a}};let c={},u=((r==null?void 0:r.entries)??(l==null?void 0:l.entries)??[]).filter(N=>(N==null?void 0:N.entryStatus)===ol).map(Vi),{participants:d=[]}=vr({withIndividualParticipants:!0,withScaleValues:!0,tournamentRecord:n}),p=d.filter(({participantId:N})=>u.includes(N)),h=N=>N===og?"rankings":"ratings",f=((C=l==null?void 0:l.category)==null?void 0:C.categoryName)??((M=l==null?void 0:l.category)==null?void 0:M.ageCategoryCode),{scaleName:m=f,scaleType:g=og,sortOrder:v,accessor:y}=a||{},b=h(g),I=(N,k)=>{var $,F,V;let O=($=N[b])==null?void 0:$[k];if(!O&&i&&(O=(F=N[b])==null?void 0:F[_b]),Array.isArray(O)){let j=(V=O.find(B=>B.scaleName===m))==null?void 0:V.scaleValue;if(Dr(j))return j;if(y&&typeof j=="object")return j[y]}return 0},T=(N,k,O)=>{let $=v===cj?k:N,F=v===cj?N:k;return I($,O)-I(F,O)},w=(N,k)=>T(N,k,_b),S=(N,k)=>T(N,k,Zv),U=[],P=(e==null?void 0:e.collectionDefinitions)??[];for(let N of p){let k=((_=N.individualParticipants)==null?void 0:_.sort(w))??[],O=s?k:((A=N.individualParticipants)==null?void 0:A.sort(S))??[],$={};for(let V of P){let j=[],{collectionId:B,matchUpCount:z,matchUpType:W,gender:Z}=V,K=Fr(_b)(W);Rt(0,z).forEach(Q=>{let J=K?k:O??[],se=Q+1,ie=[];Rt(0,K?1:2).forEach(ce=>{var te;let oe=(te=J==null?void 0:J.find(le=>{var me;let ne=Z&&([Cn,Yn].includes(Z)&&Z||Z===Oo&&[Cn,Yn][ce]);return(!ne||ne===((me=le.person)==null?void 0:me.sex))&&!j.includes(le.participantId)}))==null?void 0:te.participantId;oe&&(ie.push(oe),j.push(oe),$[oe]||($[oe]=[]),$[oe].push({collectionPosition:se,collectionId:B}))}),K||U.push(ie)})}let F=Object.keys($).map(V=>({collectionAssignments:$[V],participantId:V}));c[N.participantId]=F}let E=[];for(let N of U){let{participant:k}=Yu({tournamentParticipants:d,participantIds:N});if(!k){let O={individualParticipantIds:N,participantRole:ms,participantType:Ni};E.push(O)}}if(o){for(;E.length;)Np({participant:E.pop(),tournamentRecord:n});dn({element:r,extension:{name:zf,value:c}})}return{...de,lineUps:c,participantsToAdd:E}}function n4(t){if(!t)return{error:ai};let e=Qt(t,[{dates:!1,[ds]:s=>Array.isArray(s)&&s.every(El)},{uuids:!1,[ds]:s=>Array.isArray(s)&&s.every(nr)},{startTime:!1,endTime:!1,[ds]:Kz},{idPrefix:!1,namePrefix:!1,[ds]:nr},{count:!0,[ds]:Dr}]);if(e.error)return e;let{startDate:i,endDate:n}=t.tournamentRecord??{},r=t.dates||i&&n&&NS(i,n)||[],a=Rt(1,t.count+1).map(s=>{var o,l;return Kt({courtId:((o=t.uuids)==null?void 0:o.pop())??(t.idPrefix&&`${t.idPrefix}-${s}`)??yn(),courtName:((l=t.courtNames)==null?void 0:l.pop())??(t.namePrefix&&`${t.namePrefix} ${s}`),dateAvailability:r.map(c=>({startTime:t.startTime??"08:00",endTime:t.endTime??"20:00",date:c}))})});return{...de,courts:a}}var Bde={};Li(Bde,{default:()=>mFe,garman:()=>Gde});function OC({court:t,date:e}){let i=e&&t.dateAvailability.find(r=>kh(r.date,e)),n=t.dateAvailability.find(r=>!r.date);return i||n}function TU(t){let e=Qt(t,[{courtDate:!0,_ofType:el}]);if(e.error)return e;let{includeBookingTypes:i=[],courtDate:n}=t,r=[],a=Zr(n.startTime);(n.bookings||[]).filter(o=>!o.bookingType||!i.includes(o.bookingType)).sort((o,l)=>FA(o.startTime).localeCompare(FA(l.startTime))).forEach(o=>{let l={startTime:rr(a.toISOString()),endTime:o.startTime};Zr(o.startTime)>a&&r.push(l),Zr(o.endTime)>a&&(a=Zr(o.endTime))});let s={startTime:rr(a.toISOString()),endTime:n.endTime};return Zr(n.endTime)>a&&r.push(s),{timeSlots:r}}function hFe({averageMatchUpMinutes:t,includeBookingTypes:e,periodStartTime:i,periodEndTime:n}){let r=s=>{var l;let{timeSlots:o}=TU({includeBookingTypes:e,courtDate:s});return!!((l=o==null?void 0:o.filter(a))!=null&&l.length)};function a(s){let o=Zr(s.startTime),l=Zr(s.endTime);return o>i||l<n?!1:xP(i,l)>=t}return{enoughTime:r}}function Vde(t){let e=Qt(t,[{periodStart:!0,date:!0},{courts:!0,_ofType:Rs}]);if(e.error)return e;let{averageMatchUpMinutes:i,includeBookingTypes:n,periodStart:r,date:a}=t,s=t.courts,o=Zr(r),l=Xz(o,i),{enoughTime:c}=hFe({averageMatchUpMinutes:i,includeBookingTypes:n,periodStartTime:o,periodEndTime:l});return{availableToScheduleCount:((s==null?void 0:s.filter(u=>{if(!Array.isArray(u.dateAvailability))return!1;let d=OC({date:a,court:u});return!!(d&&c(d))}))||[]).length,...de}}function GO(t){var p;let{remainingScheduleTimes:e=[],clearScheduleDates:i,periodLength:n=30,scheduleDate:r,courts:a=[]}=t,{bookings:s=[]}=t;if(!Array.isArray(a)||!a.length)return{error:Re,courts:a};if(!Array.isArray(s))return{error:kA};if(!El(r))return{error:Fa};i&&(Array.isArray(i)?i.includes(r)&&(s=[]):s=[]);let{courtBookings:o,unassignedBookings:l}=s.reduce((h,f)=>{let{courtId:m}=f;return m?h.courtBookings[m]?h.courtBookings[m].push(f):h.courtBookings[m]=[f]:h.unassignedBookings.push(f),h},{courtBookings:{},unassignedBookings:[]}),c=a.map((h,f)=>{let{courtId:m,courtName:g}=h,v=o[m]||[],y=OC({date:r,court:h})||{},{bookings:b=[],startTime:I,endTime:T,date:w}=y,S=[e[f]&&{startTime:I,endTime:e[f]},..._t(b,!1,!0),...v].filter(Boolean);return{courtId:m,courtName:g,dateAvailability:{bookings:S,startTime:I,endTime:T,date:w}}});l.sort((h,f)=>an(h.startTime)-an(f.startTime));let u=()=>c.map(h=>{let f=h.dateAvailability,{timeSlots:m=[]}=TU({courtDate:f});return{courtName:h.courtName,courtId:h.courtId,timeSlots:m}}).flat(),d=[];for(let h of l){let{startTime:f,endTime:m,averageMinutes:g,recoveryMinutes:v,matchUpId:y}=h,b=an(f),I=an(m),T=u().reduce((w,{courtId:S,courtName:U,timeSlots:P})=>{let E;return P.find(({startTime:R,endTime:C})=>{E=an(R)-b;let M=b>=an(R);return I<=an(C)&&w.startDifference!==0&&((E===0||E+n>=0)&&(w.startDifference===void 0||E<w.startDifference)||M)})?{courtName:U,courtId:S,startDifference:E}:w},{});if(T.courtId){let w={averageMinutes:g,recoveryMinutes:v,matchUpId:y,startTime:f,endTime:m};d.push(w),(p=c.find(({courtId:S})=>S===T.courtId))==null||p.dateAvailability.bookings.push(w)}else console.log({unassignedBooking:h})}return{virtualCourts:c.map(({courtId:h,courtName:f,dateAvailability:m})=>({dateAvailability:[m],courtName:f,courtId:h})),assignedBookings:d}}function HO({averageMatchUpMinutes:t,periodLength:e=30,recoveryMinutes:i}){let n=(t||90)+(i||0);return e>n?n:e||30}function jde(t){let{startTime:e="8:00",endTime:i="20:30",count:n=10,date:r}=t??{};return Rt(0,n).map(()=>({dateAvailability:[{date:r,startTime:e,endTime:i}]}))}function KS({scheduleDate:t,startTime:e,endTime:i,courts:n}){let r=e&&"startTime"||i&&"endTime"||void 0;return n.reduce((a,s)=>{let o=OC({date:t,court:s}),l=r&&((o==null?void 0:o[r])||s[r]);return l&&(!a||e&&an(l)<an(a)||i&&an(l)>an(a))?l:a},void 0)}function fFe({averageMinutes:t,startTime:e,endTime:i,courts:n,date:r}){e=e||KS({courts:n,scheduleDate:r,startTime:!0}),i=i||KS({courts:n,scheduleDate:r,endTime:!0});let a;if(e&&i){let s=Zr(e),o=Zr(i);for(let l of n||[]){if(!Array.isArray(l.dateAvailability))continue;let c=OC({court:l,date:r}),{timeSlots:u}=TU({courtDate:c});u==null||u.forEach(d=>{let p=Zr(d.startTime),h=Zr(d.endTime);if(p>o||p<s||h<s)return!1;if(xP(p,h)>=t){let f=rr(p.toISOString());(!a||f<a)&&(a=f)}})}}return{firstTimeSlotStartTime:a}}function r4(t){let e=Qt(t,[{courts:!0,_ofType:Rs}]);if(e.error)return e;let{date:i=Yz(),startTime:n="08:00",endTime:r="19:00",periodLength:a,courts:s}=t,{calculateStartTimeFromCourts:o=!0,remainingScheduleTimes:l,averageMatchUpMinutes:c,clearScheduleDates:u,courtsCount:d,bookings:p}=t;a=a||HO({averageMatchUpMinutes:c}),i=Ri(i),n=rr(n),r=rr(r);let h=0,f=0,m=0,g=0,v=0;!s&&d&&(s=jde({startTime:n,endTime:r,count:d,date:i}));let{virtualCourts:y}=GO({remainingScheduleTimes:l,clearScheduleDates:u,scheduleDate:i,periodLength:a,bookings:p,courts:s}),{firstTimeSlotStartTime:b}=fFe({averageMinutes:c,courts:y,startTime:n,endTime:r,date:i});o&&b&&(n=b??n);let I=an(n),T=an(r)-I,w=Math.floor(T/a),S=Rt(0,w+1).map(U=>{let P=I+U*a,E=WMe(P),R=Vde({courts:y??[],averageMatchUpMinutes:c,periodStart:E,date:i});if(R.error)return{error:R.error};let{availableToScheduleCount:C=0}=R,M=C>f?C-f:0;v+=U?C:0;let _=U?v/U:C,A=a*_/c,N=U?A*(U-1)+_:_,k=C?f&&N-h||M:0;h=N,f=C,m+=k;let O=ui(m)-g;return g+=O,{periodStart:E,add:O,availableToScheduleCount:C,newCourts:M,totalMatchUps:g}});return{scheduleTimes:S.reduce((U,P)=>{let E=Rt(0,P.add).map(()=>({scheduleTime:P.periodStart}));return U.concat(...E)},[]).flat(),timingProfile:S,totalMatchUps:g}}var Gde={getCourtsAvailableAtPeriodStart:Vde,generateTimeSlots:TU,getScheduleTimes:r4,courtGenerator:jde},mFe=Gde,Zf={};Li(Zf,{isValid:()=>Nl,isValidMatchUpFormat:()=>Nl,parse:()=>wo,stringify:()=>yx});var a4={};Li(a4,{allCompetitionMatchUps:()=>_d,allDrawMatchUps:()=>lo,allEventMatchUps:()=>Jh,allTournamentMatchUps:()=>Wa,analyzeMatchUp:()=>bE,applyLineUps:()=>ppe,assignMatchUpSideParticipant:()=>zde,assignTieMatchUpParticipantId:()=>o_,bulkMatchUpStatusUpdate:()=>lpe,calculateWinCriteria:()=>hw,checkInParticipant:()=>o4,checkMatchUpIsComplete:()=>Gv,checkOutParticipant:()=>s4,competitionScheduleMatchUps:()=>_C,disableTieAutoCalc:()=>ape,drawMatchUps:()=>FW,enableTieAutoCalc:()=>ipe,eventMatchUps:()=>OO,filterMatchUps:()=>Df,findMatchUp:()=>TW,getAllDrawMatchUps:()=>ua,getAllStructureMatchUps:()=>wn,getCheckedInParticipantIds:()=>tw,getCompetitionMatchUps:()=>yE,getEventMatchUpFormatTiming:()=>RW,getHomeParticipantId:()=>_W,getMatchUpCompetitiveProfile:()=>iC,getMatchUpContextIds:()=>kW,getMatchUpDailyLimits:()=>FO,getMatchUpDailyLimitsUpdate:()=>MW,getMatchUpDependencies:()=>rd,getMatchUpFormat:()=>xW,getMatchUpFormatTiming:()=>nC,getMatchUpFormatTimingUpdate:()=>CW,getMatchUpScheduleDetails:()=>Kx,getMatchUpType:()=>Zx,getMatchUpsStats:()=>OW,getModifiedMatchUpFormatTiming:()=>xO,getParticipantResults:()=>IC,getPredictiveAccuracy:()=>AW,getRoundMatchUps:()=>fo,getRounds:()=>LW,isValidMatchUpFormat:()=>Nl,matchUpActions:()=>pO,mutate:()=>Hde,participantScheduledMatchUps:()=>NW,query:()=>ide,removeDelegatedOutcome:()=>npe,removeMatchUpSideParticipant:()=>u4,removeTieMatchUpParticipantId:()=>Wde,replaceTieMatchUpParticipantId:()=>c4,resetAdHocMatchUps:()=>upe,resetMatchUpLineUps:()=>v4,resetScorecard:()=>b4,resetTieFormat:()=>y4,setDelegatedOutcome:()=>cpe,setMatchUpFormat:()=>spe,setMatchUpStatus:()=>FC,setOrderOfFinish:()=>dpe,substituteParticipant:()=>rpe,tallyParticipantResults:()=>vU,toggleParticipantCheckInState:()=>zO,tournamentMatchUps:()=>LO,updateTieMatchUpScore:()=>Tm,validMatchUp:()=>Gx,validMatchUps:()=>tu});var Hde={};Li(Hde,{applyLineUps:()=>ppe,assignMatchUpSideParticipant:()=>zde,assignTieMatchUpParticipantId:()=>o_,bulkMatchUpStatusUpdate:()=>lpe,checkInParticipant:()=>o4,checkOutParticipant:()=>s4,disableTieAutoCalc:()=>ape,enableTieAutoCalc:()=>ipe,findMatchUp:()=>TW,removeDelegatedOutcome:()=>npe,removeMatchUpSideParticipant:()=>u4,removeTieMatchUpParticipantId:()=>Wde,replaceTieMatchUpParticipantId:()=>c4,resetAdHocMatchUps:()=>upe,resetMatchUpLineUps:()=>v4,resetScorecard:()=>b4,resetTieFormat:()=>y4,setDelegatedOutcome:()=>cpe,setMatchUpFormat:()=>spe,setMatchUpStatus:()=>FC,setOrderOfFinish:()=>dpe,substituteParticipant:()=>rpe,toggleParticipantCheckInState:()=>zO,updateTieMatchUpScore:()=>Tm});function zde({tournamentRecord:t,drawDefinition:e,participantId:i,sideNumber:n,matchUpId:r,event:a}){var c,u;if(i&&typeof i!="string")return{error:Md};if(!e)return{error:Gt};if(!r)return{error:Ks};let s=n===void 0;if(s&&(n=1),![1,2].includes(n))return he({result:{error:Re,context:{sideNumber:n}}});let{matchUp:o,structure:l}=ar({drawDefinition:e,matchUpId:r,event:a});if(!o)return{error:_s};if(!(!(l!=null&&l.structures)&&!(e.drawType&&e.drawType!==nc)&&!((c=l==null?void 0:l.matchUps)!=null&&c.find(({roundPosition:d})=>!!d))))return{error:yz};if(!i&&((u=o==null?void 0:o.score)!=null&&u.scoreStringSide1||ca.includes(o==null?void 0:o.matchUpstatus)||o!=null&&o.matchUpStatus&&[Yr,sa].includes(o.matchUpStatus)))return{error:ax,info:"matchUp has completed status or score"};if(o){if(o.sides=[1,2].map(d=>{var h;let p=((h=o.sides)==null?void 0:h.find(f=>f.sideNumber===d))??{sideNumber:d};return n===d?{...p,participantId:i}:p}),s)for(let d of o.sides)d.sideNumber&&(d.sideNumber=3-d.sideNumber);Ji({tournamentId:t==null?void 0:t.tournamentId,context:"assignSideParticipant",drawDefinition:e,matchUp:o})}return{...de,sidesSwapped:s}}function xl({removePriorValues:t,tournamentRecord:e,duplicateValues:i,drawDefinition:n,disableNotice:r,matchUpId:a,timeItem:s,event:o}){let{matchUp:l}=ar({drawDefinition:n,event:o,matchUpId:a});if(!l)return{error:_s};let c=qp({removePriorValues:t,element:l,duplicateValues:i,timeItem:s});return r||Ji({tournamentId:e==null?void 0:e.tournamentId,eventId:o==null?void 0:o.eventId,context:"addTimeItem",drawDefinition:n,matchUp:l}),c}function s4(t){var y;let e=[{[ba]:!0},{[To]:!0},{[Lh]:!0},{[Gp]:!0}],i=Qt(t,e);if(i.error)return i;let n=bU(t,[{[nU]:Zh,attr:{[Ex]:!0}}]);if(n.error)return n;let{tournamentRecord:r,drawDefinition:a,participantId:s,matchUpId:o}=t,l=(y=n==null?void 0:n.matchUp)==null?void 0:y.matchUp,{matchUpStatus:c,score:u}=l??{};if(c&&xx.includes(c)||c&&ca.includes(c)||ga({score:u}))return{error:Nre};let d=tw({matchUp:l});if(d!=null&&d.error)return d;let{checkedInParticipantIds:p,allRelevantParticipantIds:h}=d??{};if(!(h!=null&&h.includes(s)))return{error:Md};if(!(p!=null&&p.includes(s)))return{error:aae};let f=Moe({matchUp:l});if(f!=null&&f.error)return f;let{sideParticipantIds:m,nestedIndividualParticipantIds:g}=f??{},v=m==null?void 0:m.indexOf(s);return v!==void 0&&[0,1].includes(v)&&((g==null?void 0:g[v])??[]).forEach(b=>{xl({drawDefinition:a,matchUpId:o,timeItem:{itemType:qA,itemValue:b}})}),xl({tournamentRecord:r,drawDefinition:a,matchUpId:o,timeItem:{itemValue:s,itemType:qA}}),{...de,checkedOut:!0}}function o4(t){var p;let e=[{[ba]:!0},{[To]:!0},{[Lh]:!0},{[Gp]:!0}],i=Qt(t,e);if(i[Au])return i;let n=bU(t,[{[nU]:Zh,attr:{[Ex]:!0}}]);if(n[Au])return n;let{tournamentRecord:r,drawDefinition:a,participantId:s,matchUpId:o}=t,l=tw({matchUp:(p=n==null?void 0:n.matchUp)==null?void 0:p.matchUp});if(l!=null&&l.error)return l;let{checkedInParticipantIds:c,allRelevantParticipantIds:u}=l??{};if(!(u!=null&&u.includes(s)))return{[Au]:Md};let d={...de,checkedIn:!0};return c!=null&&c.includes(s)||xl({tournamentRecord:r,drawDefinition:a,matchUpId:o,timeItem:{itemValue:s,itemType:zA}}),d}function zO(t){var c,u;let e=Qt(t,[{[Lh]:!0,[To]:!0,[Gp]:!0}]);if(e.error)return e;let i=t.tournamentId??t.activeTournamentId,n=t.tournamentRecord??(i&&((c=t.tournamentRecords)==null?void 0:c[i]));if(!n)return{error:ut};let r=(u=bU(t,[{[nU]:Zh,attr:{[Ex]:!0},[Au]:_s}]).matchUp)==null?void 0:u.matchUp;if(!r)return{error:_s};let{checkedInParticipantIds:a=[]}=tw({matchUp:r}),{participantId:s,matchUpId:o,drawDefinition:l}=t;return s&&a.includes(s)?s4({tournamentRecord:n,drawDefinition:l,participantId:s,matchUpId:o,matchUp:r}):o4({tournamentRecord:n,drawDefinition:l,participantId:s,matchUpId:o,matchUp:r})}function l4({tournamentRecord:t,drawDefinition:e,tieMatchUpId:i,event:n}){var w,S;if(!t)return{error:ut};if(!e)return{error:Vd};if(!n)return{error:Gc};let r=Ts({drawDefinition:e}),{matchUp:a}=ar({matchUpId:i,drawDefinition:e,matchUpsMap:r});if(!a)return{error:_s};let{matchUp:s,structure:o}=ar({tournamentParticipants:t.participants,matchUpId:i,inContext:!0,drawDefinition:e,matchUpsMap:r,event:n});if(!s)return{error:_s};let{collectionPosition:l,drawPositions:c,collectionId:u,matchUpTieId:d,matchUpType:p}=s;if(p&&!Qk([xn,Mn],p))return{error:al};let{positionAssignments:h}=jn({structure:o}),f=h==null?void 0:h.filter(U=>c==null?void 0:c.includes(U.drawPosition)),{matchUp:m}=ar({matchUpId:d,drawDefinition:e,matchUpsMap:r}),g=((w=m==null?void 0:m.sides)==null?void 0:w.map(Vi))??[],v=(f==null?void 0:f.map(Vi))??[],y=[...g,...v],{participants:b}=vr({tournamentRecord:t,participantFilters:{participantTypes:[En],participantIds:y}}),{matchUp:I}=ar({matchUpId:d,inContext:!0,drawDefinition:e,matchUpsMap:r}),T=(S=qs({matchUp:m,drawDefinition:e,structure:o,event:n}))==null?void 0:S.tieFormat;return{inContextDualMatchUp:I,inContextTieMatchUp:s,relevantAssignments:f,collectionPosition:l,teamParticipants:b,collectionId:u,matchUpType:p,dualMatchUp:m,tieMatchUp:a,tieFormat:T,structure:o,...de}}function c4(t){var O,$,F,V,j,B,z,W,Z,K,Q,J,se,ie,ce,oe;let e=l4(t);if(e.error)return e;let i="replaceTieMatchUpParticipantid",{existingParticipantId:n,tournamentRecord:r,newParticipantId:a,drawDefinition:s,substitution:o,event:l}=t;if(!n||!a)return he({result:{error:la},stack:i});if(n===a)return{...de};let{inContextDualMatchUp:c,inContextTieMatchUp:u,collectionPosition:d,collectionId:p,dualMatchUp:h,tieMatchUp:f,tieFormat:m}=e,g=u==null?void 0:u.matchUpType,v=(O=u==null?void 0:u.sides)==null?void 0:O.find(te=>{var le,ne,me;return((le=te.participant)==null?void 0:le.participantId)===n||((me=(ne=te.participant)==null?void 0:ne.individualParticipantIds)==null?void 0:me.includes(n))});if(!v)return{error:xr};let y=(($=vr({tournamentRecord:r,participantFilters:{participantIds:[n,a]}}))==null?void 0:$.participants)??[];if(y.length!==2)return he({result:{error:la},stack:i});if(y[0].participantType!==y[1].participantType)return he({result:{error:Nd},stack:i});let{appliedPolicies:b}=hn({tournamentRecord:r,drawDefinition:s,event:l}),I=((F=t.policyDefinitions)==null?void 0:F[Ba])??(b==null?void 0:b[Ba])??hU[Ba],T=y.find(({participantId:te})=>te===a);if((t.enforceGender??((V=I==null?void 0:I.participants)==null?void 0:V.enforceGender))!==!1&&[Cn,Yn].includes(u==null?void 0:u.gender)&&(u==null?void 0:u.gender)!==((j=T==null?void 0:T.person)==null?void 0:j.sex))return{error:jI,info:"Gender mismatch"};let w=(B=I==null?void 0:I.processCodes)==null?void 0:B.substitution;SC({tournamentId:r.tournamentId,eventId:l.eventId,inContextDualMatchUp:c,drawDefinition:s,dualMatchUp:h});let S=(z=h==null?void 0:h.sides)==null?void 0:z.find(({sideNumber:te})=>te===v.sideNumber);if(!S)return he({result:{sideNumber:v.sideNumber,existingParticipantId:n,error:za},stack:i});if((Z=(W=u==null?void 0:u.sides)==null?void 0:W.flatMap(te=>{var le,ne;return((le=te.participant)==null?void 0:le.individualParticipantIds)||((ne=te.participant)==null?void 0:ne.participantId)||[]}))!=null&&Z.includes(a))return he({result:{error:ox},stack:i});let U=(Q=(K=c==null?void 0:c.sides)==null?void 0:K.find(({sideNumber:te})=>te===v.sideNumber))==null?void 0:Q.participantId,P=S.lineUp,E=P==null?void 0:P.find(({participantId:te})=>a===te),R=P==null?void 0:P.reduce((te,le)=>le.substitutionOrder>te?le.substitutionOrder:te,0),C=(P==null?void 0:P.map(te=>{var ne;let le=_t(te,!1,!0);if(![n,a].includes(le.participantId))return le;if(!o&&[n,a].includes(le.participantId)&&(le.collectionAssignments=(ne=le.collectionAssignments)==null?void 0:ne.filter(me=>!(me.collectionPosition===d&&me.collectionId===p))),o&&n===le.participantId&&(le.collectionAssignments=le.collectionAssignments.map(me=>me.collectionPosition===d&&me.collectionId===p&&me.substitutionOrder===void 0?{...me,substitutionOrder:R}:me)),le.participantId===a){le.collectionAssignments||(le.collectionAssignments=[]);let me={collectionId:p,collectionPosition:d};o&&(me.previousParticipantId=n,me.substitutionOrder=(R??0)+1),le.collectionAssignments.push(me)}return le}))??[];if(!E){let te={collectionId:p,collectionPosition:d};o&&(te.substitutionOrder=(R??0)+1,te.previousParticipantId=n);let le={collectionAssignments:[te],participantId:a};C.push(le)}let M=g===Mn,{assignedParticipantIds:_}=WA({lineUp:P,collectionPosition:d,collectionId:p}),{assignedParticipantIds:A}=WA({lineUp:C,collectionPosition:d,collectionId:p});if(S.lineUp=C,U&&m){let te=lw({participantId:U,lineUp:C,drawDefinition:s,tieFormat:m});if(te.error)return he({result:te,stack:i})}else console.log("team participantId not found");let N,k;if(M){let{tournamentRecord:te}=t,le=Yu({participantIds:A,tournamentRecord:te});if(!le.participant){let me=Np({returnParticipant:!0,pairOverride:!0,tournamentRecord:te,participant:{participantRole:ms,individualParticipantIds:A,participantType:Ni}});if(me.error)return he({result:me,stack:i});N=(J=me.participant)==null?void 0:J.participantId}le=Yu({participantIds:_,tournamentRecord:te});let ne=(se=le.participant)==null?void 0:se.participantId;ne&&sw({participantIds:[ne],tournamentRecord:te}).success&&(k=ne)}if(o||((ie=v.substitutions)==null?void 0:ie.length)===1){if(o)w&&f&&(f.processCodes=Ei([...(f==null?void 0:f.processCodes)??[],...w]));else for(let te of w||[]){let le=(ce=f==null?void 0:f.processCodes)==null?void 0:ce.lastIndexOf(te);le!==void 0&&((oe=f==null?void 0:f.processCodes)==null||oe.splice(le,1))}f&&Ji({tournamentId:r==null?void 0:r.tournamentId,matchUp:f,context:i,drawDefinition:s})}return h&&Ji({tournamentId:r==null?void 0:r.tournamentId,matchUp:h,context:i,drawDefinition:s}),{...de,modifiedLineUp:C,participantRemoved:k,participantAdded:N}}function qde({collectionPosition:t,teamParticipantId:e,dualMatchUpSide:i,drawDefinition:n,participantIds:r,collectionId:a}){var c;if(!a||!t||!Array.isArray(r))return{modifiedLineUp:(i==null?void 0:i.lineUp)||[],error:Re};let s=(i==null?void 0:i.lineUp)||((c=ry({participantId:e,drawDefinition:n}))==null?void 0:c.lineUp),o=[],l=[];return{modifiedLineUp:(s==null?void 0:s.map(u=>{var p;if(!r.includes(u.participantId))return u;let d=(p=u.collectionAssignments)==null?void 0:p.filter(h=>{let f=h.collectionId===a&&h.collectionPosition===t;return f&&(h.previousParticipantId&&o.push(h.previousParticipantId),l.push({participantId:u.participantId,...h})),!f});return{participantId:u.participantId,collectionAssignments:d}}).filter(Boolean))||[],assignmentsRemoved:l,previousParticipantIds:o}}function gFe({individualParticipantIds:t,groupingParticipantId:e,tournamentRecord:i}){var a,s;let n=(i.events||[]).filter(o=>{var l;return(o==null?void 0:o.eventType)===na&&((l=o==null?void 0:o.entries)==null?void 0:l.some(c=>c.participantId===e))}),r=o=>!t.includes(o.participantId);for(let o of n){o.entries=(o.entries||[]).filter(r);let{flightProfile:l}=_r({event:o});(a=l==null?void 0:l.flights)==null||a.forEach(c=>{c.drawEntries=(c.drawEntries||[]).filter(r)}),(s=o==null?void 0:o.drawDefinitions)==null||s.forEach(c=>{c.entries=(c.entries||[]).filter(r)})}return{...de}}function qO({individualParticipantIds:t,groupingParticipantId:e,removeFromOtherTeams:i,tournamentRecord:n}){let r="addIndividualParticipantIds";if(!n)return he({result:{error:ut},stack:r});if(!e||!t)return he({result:{error:ai},stack:r});let a=n.participants??[],s=a.find(d=>d.participantId===e);if(!s)return he({result:{error:xr},stack:r});if(s!=null&&s.participantType&&![En,pc].includes(s.participantType))return he({context:{participantType:s.participantType},result:{error:Nd},stack:r});let o=t.filter(d=>{var p;return((p=a.find(h=>h.participantId===d))==null?void 0:p.participantType)!==ji});if(o.length)return he({result:{error:Dl,invalidParticipantIds:o},stack:r});s.individualParticipantIds||(s.individualParticipantIds=[]);let l=s.individualParticipantIds,c=t.filter(d=>!l.includes(d));c.length&&(i&&Qx({individualParticipantIds:c,tournamentRecord:n}),s.individualParticipantIds=s.individualParticipantIds.concat(...c));let{topics:u}=dc();if(u.includes(Is)){let d=a.find(({participantId:p})=>p===e);Si({topic:Is,payload:{participants:[d]}})}return gFe({individualParticipantIds:t,groupingParticipantId:e,tournamentRecord:n}),{groupingParticipant:_t(s,!1,!0),added:c.length,...de}}function WO(t){let{updateParticipantName:e=!0,groupingParticipantId:i,removeFromOtherTeams:n,tournamentRecord:r,pairOverride:a,participant:s}=t;if(!r)return{error:ut};if(!s)return{error:GI};if(!s.participantId)return Np({tournamentRecord:r,participant:s});let{participant:o}=jg({participantId:s.participantId,tournamentRecord:r});if(!o)return Np({tournamentRecord:r,participant:s});let{participantRoleResponsibilties:l,individualParticipantIds:c,participantOtherName:u,participantName:d,participantRole:p,participantType:h,onlineResources:f,contacts:m,person:g}=s;if(h&&o.participantType!==h)return{error:Qre};let v={};if(m&&(v.contacts=m),f&&(v.onlineResources=f),u&&nr(u)&&(v.participantOtherName=u),d&&nr(d)&&(v.participantName=d),Array.isArray(c)){let{participants:y}=vr({participantFilters:{participantTypes:[ji]},tournamentRecord:r}),b=y==null?void 0:y.map(Vi);if(b){let I=c.filter(T=>nr(T)&&b.includes(T));([pc,Zn].includes(h||o.participantType)||h===Ni&&(I.length===2||a))&&(v.individualParticipantIds=I),o.participantType===pS.PAIR&&e&&(v.participantName=vFe({individualParticipants:y,newValues:v}))}}return Object.keys(zg).includes(p)&&(v.participantRole=p),Object.keys(pS).includes(h)&&(v.participantType=h),Array.isArray(l)&&(v.participantRoleResponsibilties=l),o.participantType===pS.INDIVIDUAL&&g&&yFe({updateParticipantName:e,existingParticipant:o,newValues:v,person:g}),Object.assign(o,Kt(v)),i&&qO({individualParticipantIds:[o.participantId],groupingParticipantId:i,removeFromOtherTeams:n,tournamentRecord:r}),Si({topic:Is,payload:{tournamentId:r.tournamentId,participants:[o]}}),{participant:_t(o),...de}}function vFe({individualParticipants:t,newValues:e}){let i=e.individualParticipantIds,n=t.filter(({participantId:r})=>i.includes(r)).map(({person:r})=>r==null?void 0:r.standardFamilyName).filter(Boolean).sort().join("/");return i.length===1&&(n+="/Unknown"),n}function yFe({updateParticipantName:t,existingParticipant:e,newValues:i,person:n}){let r={},{standardFamilyName:a,standardGivenName:s,nationalityCode:o,personId:l,birthdate:c,tennisId:u,sex:d}=n;d&&Object.keys(jp).includes(d)&&(r.sex=d);let p;if(nr(l)&&(r.personId=l),o&&nr(o)&&(bFe(o)||o==="")&&(r.nationalityCode=o),a&&typeof nr(a)&&a.length>1&&(r.standardFamilyName=a,p=!0),s&&typeof nr(s)&&s.length>1&&(r.standardGivenName=s,p=!0),p&&t){let h=`${r.standardGivenName} ${r.standardFamilyName}`;i.participantName=h}c&&El(c)&&(r.birthdate=c),u&&nr(u)&&(r.tennisId=u),Object.assign(e.person,r)}function bFe(t){return ig.flatMap(({iso:e,ioc:i})=>[e,i]).filter(Boolean).includes(t)}function o_(t){var F,V,j,B,z,W,Z,K,Q,J,se,ie,ce,oe,te,le,ne,me,be,Se;let e=l4(t);if(e.error)return e;let i="assignTieMatchUpParticipantId",n=t.teamParticipantId,{tournamentRecord:r,drawDefinition:a,participantId:s,event:o}=t;if(!s)return he({result:{error:la},stack:i});if(t.sideNumber&&![1,2].includes(t.sideNumber))return he({result:{error:Cz},stack:i});let{inContextDualMatchUp:l,inContextTieMatchUp:c,relevantAssignments:u,collectionPosition:d,teamParticipants:p,collectionId:h,matchUpType:f,dualMatchUp:m,tieFormat:g}=e;if((V=(F=c==null?void 0:c.sides)==null?void 0:F.flatMap(we=>{var ze,Qe;return((ze=we.participant)==null?void 0:ze.individualParticipantIds)||((Qe=we.participant)==null?void 0:Qe.participantId)||[]}))!=null&&V.includes(s))return he({result:{...de},stack:i});n=n??(t.sideNumber?(B=(j=l==null?void 0:l.sides)==null?void 0:j.find(we=>we.sideNumber===t.sideNumber))==null?void 0:B.participantId:void 0);let v=(W=(z=vr({participantFilters:{participantIds:[s]},tournamentRecord:r}))==null?void 0:z.participants)==null?void 0:W[0];if(!v)return he({result:{error:xr},stack:i});let{appliedPolicies:y}=hn({tournamentRecord:r,drawDefinition:a,event:o}),b=((Z=t.policyDefinitions)==null?void 0:Z[Ba])??(y==null?void 0:y[Ba])??hU[Ba];if((t.enforceGender??((K=b==null?void 0:b.participants)==null?void 0:K.enforceGender))!==!1&&[Cn,Yn].includes(c==null?void 0:c.gender)&&(c==null?void 0:c.gender)!==((Q=v.person)==null?void 0:Q.sex))return{error:jI,info:"Gender mismatch"};let{individualParticipantIds:I,participantType:T}=v;if(Fr(xn)(f)&&T!==ji)return{error:Nd};let w=T===ji?[s]:I,S=n&&(p==null?void 0:p.find(({participantId:we})=>we===n))||(p==null?void 0:p.find(({individualParticipantIds:we})=>ho(w,we)));if(!S)return{error:Lz};if(n||(n=S.participantId),!n)return{error:xr};let U=(J=u==null?void 0:u.find(we=>we.participantId===(S==null?void 0:S.participantId)))==null?void 0:J.drawPosition,P=(ie=(se=m==null?void 0:m.sides)==null?void 0:se.find(we=>we.participantId===n))==null?void 0:ie.sideNumber,E=(oe=(ce=c==null?void 0:c.sides)==null?void 0:ce.find(we=>U&&we.drawPosition===U))==null?void 0:oe.sideNumber,R=P??E??t.sideNumber;if(!g)return{error:XT};if(!((te=g.collectionDefinitions)!=null&&te.find(we=>we.collectionId===h)))return{error:Hre};SC({tournamentId:r.tournamentId,eventId:o.eventId,inContextDualMatchUp:l,drawDefinition:a,dualMatchUp:m});let C=(le=m==null?void 0:m.sides)==null?void 0:le.find(we=>we.sideNumber===R),M=(ne=c==null?void 0:c.sides)==null?void 0:ne.find(we=>we.sideNumber===R),_=(Se=(be=(C==null?void 0:C.lineUp)??((me=ry({participantId:n,drawDefinition:a}))==null?void 0:me.lineUp))==null?void 0:be.filter(we=>{var ze;return(ze=we.collectionAssignments)==null?void 0:ze.find(Qe=>Qe.collectionPosition===d&&Qe.collectionId===h&&!Qe.previousParticipantId)}))==null?void 0:Se.map(we=>we==null?void 0:we.participantId),A=(_==null?void 0:_.length)>1&&_||(T===Ni?v.individualParticipantIds:[s]),N=qde({collectionPosition:d,teamParticipantId:n,dualMatchUpSide:C,drawDefinition:a,participantIds:A,collectionId:h});if(N.error)return he({result:N,stack:i});let{modifiedLineUp:k}=N,O;if(f===Mn){if(T!==Ni){let we=U$({collectionPosition:d,teamParticipantId:n,drawDefinition:a,modifiedLineUp:k,participantId:s,collectionId:h,tieFormat:g});if(we!=null&&we.error)return he({result:we,stack:i});if(we=$({side:M}),we.error)return we;O=we.deletedParticipantId,C&&(C.lineUp=k),m&&Ji({tournamentId:r==null?void 0:r.tournamentId,matchUp:m,context:i,drawDefinition:a})}else if(T===Ni)for(let we of A)U$({collectionPosition:d,teamParticipantId:n,drawDefinition:a,modifiedLineUp:k,participantId:we,collectionId:h,tieFormat:g})}else{let we=U$({collectionPosition:d,teamParticipantId:n,drawDefinition:a,modifiedLineUp:k,participantId:s,collectionId:h,tieFormat:g});if(we!=null&&we.error)return we}if(C&&(C.lineUp=k),m&&Ji({tournamentId:r==null?void 0:r.tournamentId,matchUp:m,context:i,drawDefinition:a}),O){let{error:we}=sw({participantIds:[O],tournamentRecord:r});we&&console.log("cleanup")}return{...de,modifiedLineUp:k};function $({side:we}){let ze;if(we.participant){let Qe=we.participant.individualParticipantIds||[];if(Qe.filter(Boolean).length===1){let{participant:ke}=Yu({participantIds:Qe,tournamentRecord:r});Qe.push(s);let{participant:yt}=Yu({participantIds:Qe,tournamentRecord:r});if(!yt&&ke){ke.individualParticipantIds=Qe;let lt=WO({pairOverride:!0,tournamentRecord:r,participant:ke});if(lt.error)return lt}else ze=ke==null?void 0:ke.participantId}}else{let Qe=Np({participant:{individualParticipantIds:[s],participantRole:ms,participantType:Ni},pairOverride:!0,tournamentRecord:r});if(Qe.error)return Qe}return{...de,deletedParticipantId:ze}}}function U$({collectionPosition:t,teamParticipantId:e,drawDefinition:i,modifiedLineUp:n,participantId:r,collectionId:a,tieFormat:s}){var u,d;let o=(u=ry({participantId:e,drawDefinition:i}))==null?void 0:u.lineUp,l=(d=n||o)==null?void 0:d.find(p=>(p==null?void 0:p.participantId)===r),c={collectionId:a,collectionPosition:t};if(l)l.collectionAssignments.push(c);else{let p={collectionAssignments:[c],participantId:r};n.push(p)}return lw({participantId:e,lineUp:n,drawDefinition:i,tieFormat:s})}function Wde(t){var R,C,M,_,A,N,k,O,$,F,V,j,B,z,W,Z,K,Q,J,se,ie,ce,oe;let{tournamentRecord:e,drawDefinition:i,participantId:n,event:r}=t,a="removeTieMatchUpParticiapantId";if(!n)return he({result:{error:la},stack:a});let s=l4(t);if(s.error)return s;let{appliedPolicies:o}=hn({tournamentRecord:e,drawDefinition:i,event:r}),l=(M=(C=((R=t.policyDefinitions)==null?void 0:R[Ba])??(o==null?void 0:o[Ba])??hU[Ba])==null?void 0:C.processCodes)==null?void 0:M.substitution,{inContextDualMatchUp:c,inContextTieMatchUp:u,relevantAssignments:d,collectionPosition:p,teamParticipants:h,collectionId:f,matchUpType:m,dualMatchUp:g,tieMatchUp:v,tieFormat:y}=s;if(!g)return he({result:{error:rl},stack:a});let b=(_=u==null?void 0:u.sides)==null?void 0:_.find(te=>{var le,ne,me;return((le=te.participant)==null?void 0:le.participantId)===n||((me=(ne=te.participant)==null?void 0:ne.individualParticipantIds)==null?void 0:me.includes(n))});if(!b)return he({result:{error:xr},stack:a});let I=((A=t.policyDefinitions)==null?void 0:A[zc])??(o==null?void 0:o[zc]);if(!((N=b.substitutions)!=null&&N.length)&&(ga({score:u==null?void 0:u.score})||u!=null&&u.winningSide)&&(I==null?void 0:I.requireParticipantsForScoring)!==!1)return he({result:{error:Pae},stack:a});let T=(O=(k=c==null?void 0:c.sides)==null?void 0:k.find(({sideNumber:te})=>te===b.sideNumber))==null?void 0:O.participantId;if(!T)return he({result:{error:xr},stack:a});let w=(F=($=vr({participantFilters:{participantIds:[n]},tournamentRecord:e}))==null?void 0:$.participants)==null?void 0:F[0];if(!w)return he({result:{error:xr},stack:a});if(m===xn&&w.participantType===Ni)return he({result:{error:jI},stack:a});let S=w.participantType===ji?[n]:w.individualParticipantIds;SC({tournamentId:e.tournamentId,eventId:r.eventId,inContextDualMatchUp:c,drawDefinition:i,dualMatchUp:g});let U=(V=g.sides)==null?void 0:V.find(({sideNumber:te})=>te===b.sideNumber);if(!U&&(((j=g.sides)==null?void 0:j.filter(({lineUp:te})=>!te).length)||0)<2){let te=h==null?void 0:h.map(({participantId:le})=>{var ne;return{drawPosition:(ne=d==null?void 0:d.find(me=>me.participantId===le))==null?void 0:ne.drawPosition,teamParticipantId:le}});U=(B=g.sides)==null?void 0:B.find(le=>{var ne;return((ne=te==null?void 0:te.find(({drawPosition:me})=>me===le.drawPosition))==null?void 0:ne.teamParticipantId)===T})}if(!U)return he({result:{error:xr,context:{participantId:n}}});let{modifiedLineUp:P,previousParticipantIds:E}=qde({collectionPosition:p,teamParticipantId:T,dualMatchUpSide:U,participantIds:S,drawDefinition:i,collectionId:f});if(U.lineUp=P,T&&y&&lw({participantId:T,lineUp:P,drawDefinition:i,tieFormat:y}),m===Mn&&w.participantType===ji){let te=(z=u==null?void 0:u.sides)==null?void 0:z.find(me=>me.sideNumber===(U==null?void 0:U.sideNumber)),{participantId:le}=te??{},ne=le&&((Z=(W=vr({participantFilters:{participantIds:[le]},tournamentRecord:e,withDraws:!0}))==null?void 0:W.participants)==null?void 0:Z[0]);if(ne){let me=((K=ne==null?void 0:ne.individualParticipantIds)==null?void 0:K.filter(be=>be!==n))??[];if(E&&me.push(...E),me.length>2)return he({result:{error:Dl},stack:a});if((Q=ne.draws)!=null&&Q.length){if(me.length===1){let{participant:be}=Yu({participantIds:me,tournamentRecord:e});if(!be){let Se=Np({participant:{participantRole:ms,individualParticipantIds:me,participantType:Ni},pairOverride:!0,tournamentRecord:e});if(Se.error)return he({result:Se,stack:a})}}}else if(me.length){ne.individualParticipantIds=me;let be=WO({participant:ne,pairOverride:!0,tournamentRecord:e});if(be.error)return he({result:be,stack:a})}else{let be=sw({participantIds:[le],tournamentRecord:e});be.error&&console.log("cleanup",{result:be})}}else return he({result:{error:xr},stack:a})}if(((J=b.substitutions)==null?void 0:J.length)===1&&!((ce=(ie=(se=u==null?void 0:u.sides)==null?void 0:se.find(te=>te.sideNumber!==b.sideNumber))==null?void 0:ie.substitutions)!=null&&ce.length)&&((oe=v==null?void 0:v.processCodes)!=null&&oe.length)){for(let te of l||[]){let le=v.processCodes.lastIndexOf(te);v.processCodes.splice(le,1)}Ji({tournamentId:e==null?void 0:e.tournamentId,matchUp:v,context:a,drawDefinition:i})}return Ji({tournamentId:e==null?void 0:e.tournamentId,matchUp:g,context:a,drawDefinition:i}),{...de,modifiedLineUp:P}}function u4(t){var l,c;let e=Qt(t,[{[ba]:!0,[To]:!0,[Gp]:!0}]);if(e.error)return e;let{drawDefinition:i,sideNumber:n,matchUpId:r,event:a}=t;if(n&&![1,2].includes(n))return{error:Re,sideNumber:n};let{matchUp:s,structure:o}=ar({drawDefinition:i,matchUpId:r,event:a});return s?Vo({structure:o})?((l=s.sides)==null||l.forEach(u=>{(!n||u.sideNumber===n)&&delete u.participantId}),Ji({tournamentId:(c=t.tournamentRecord)==null?void 0:c.tournamentId,context:"assignSideParticipant",drawDefinition:i,matchUp:s}),{...de}):{error:yz}:{error:_s}}function IFe({matchUpStatuses:t=[mn,cn,Yi],drawPositionMatchUps:e,loserDrawPosition:i,sourceMatchUps:n}){var u;let r=e==null?void 0:e.reduce((d,p)=>!d||p.roundNumber>d.roundNumber?p:d,void 0),a=(u=r==null?void 0:r.drawPositions)==null?void 0:u.find(d=>d!==i),s=n.filter(d=>{var p;return(p=d==null?void 0:d.drawPositions)==null?void 0:p.includes(a)}).map(d=>d.matchUpStatus),o=n.filter(d=>{var p;return(p=d==null?void 0:d.drawPositions)==null?void 0:p.includes(i)}).map(d=>d.matchUpStatus),l=ho(s||[],t),c=ho(o||[],t);return{sourceMatchUp:r,winnerHadMatchUpStatus:l,winnerMatchUpStatuses:s,loserHadMatchUpStatus:c,loserMatchUpStatuses:o}}function wFe({inContextDrawMatchUps:t,sourceMatchUpStatus:e,targetDrawPosition:i,tournamentRecord:n,sourceMatchUpId:r,drawDefinition:a,structureId:s,dualMatchUp:o,roundNumber:l,matchUpsMap:c,event:u}){let{structure:d}=hi({drawDefinition:a,structureId:s});if((d==null?void 0:d.structureType)===So)return{...de};c=c??Ts({drawDefinition:a});let p=((c==null?void 0:c.mappedMatchUps)||{})[s].matchUps,{initialRoundNumber:h}=pI({drawPosition:i,matchUps:p}),f=p==null?void 0:p.filter(g=>{var v;return g.roundNumber>=l&&g.roundNumber!==h&&((v=g.drawPositions)==null?void 0:v.includes(i))}),{positionAssignments:m}=jn({drawDefinition:a,structureId:s});for(let g of f??[])SFe({inContextDrawMatchUps:t,sourceMatchUpStatus:e,positionAssignments:m,targetDrawPosition:i,tournamentRecord:n,sourceMatchUpId:r,drawDefinition:a,dualMatchUp:o,matchUpsMap:c,matchUp:g,event:u});return{...de}}function SFe({inContextDrawMatchUps:t,positionAssignments:e,sourceMatchUpStatus:i,targetDrawPosition:n,tournamentRecord:r,sourceMatchUpId:a,drawDefinition:s,dualMatchUp:o,matchUpsMap:l,matchUp:c,event:u}){var h,f,m;let d="removeSubsequentDrawPosition";if(o){let g=(f=(h=t.find(({matchUpId:y})=>c.matchUpId===y).sides)==null?void 0:h.find(y=>y.drawPosition===n))==null?void 0:f.sideNumber,v=(m=c.sides)==null?void 0:m.find(y=>y.sideNumber===g);v&&delete v.lineUp}c.drawPositions=(c.drawPositions||[]).map(g=>g===n?void 0:g).filter(Boolean);let p=e.filter(({drawPosition:g})=>{var v;return(v=c.drawPositions)==null?void 0:v.includes(g)}).filter(g=>g.bye).length;return c.matchUpStatus=p&&mn||[Yi,cn].includes(c.matchUpStatus)&&c.matchUpStatus||Vr,[cn,Yi].includes(c.matchUpStatus)&&(c.winningSide=void 0),c.matchUpStatusCodes&&vle({inContextDrawMatchUps:t,sourceMatchUpStatus:i,sourceMatchUpId:a,matchUpsMap:l,matchUp:c}),Ji({tournamentId:r==null?void 0:r.tournamentId,eventId:u==null?void 0:u.eventId,context:`${d}-${n}`,drawDefinition:s,matchUp:c}),{...de}}function UU(t){let{dualWinningSideChange:e,inContextDrawMatchUps:i,tournamentRecord:n,drawDefinition:r,matchUpStatus:a,matchUpsMap:s,dualMatchUp:o,targetData:l,matchUpId:c,structure:u,event:d}=t,p=!!t.matchUp.collectionId,h=Vo({structure:u}),{drawPositions:f,winningSide:m}=l.matchUp||{};if(!h&&!f)return{error:RP};let{targetLinks:{loserTargetLink:g,winnerTargetLink:v,byeTargetLink:y},targetMatchUps:{loserMatchUp:b,winnerMatchUp:I,byeMatchUp:T}}=l,w=vp({...t,matchUpStatus:a||Vr,removeWinningSide:!0});if(w.error)return w;let S;if(p){let{matchUpTieId:k,matchUpsMap:O}=t;if(S=Tm({appliedPolicies:t.appliedPolicies,matchUpId:k,tournamentRecord:n,drawDefinition:r,matchUpsMap:O,event:d}),!e&&!S.removeWinningSide)return{...de}}if(h)return{...de};let{matchUps:U}=wn({afterRecoveryTimes:!1,inContext:!0,drawDefinition:r,matchUpsMap:s,structure:u}),{positionAssignments:P}=Ma({structure:u}),E=m-1,R=1-E,C=f[E],M=f[R],{winnerParticipantId:_,loserParticipantId:A}=(P==null?void 0:P.reduce((k,O)=>(O.drawPosition===M&&(k.loserParticipantId=O.participantId),O.drawPosition===C&&(k.winnerParticipantId=O.participantId),k),{winnerParticipantId:void 0,loserParticipantId:void 0}))||{},N=U.filter(k=>{var O;return(O=k.drawPositions)==null?void 0:O.includes(M)});if(I&&Yde({sourceMatchUpStatus:a,sourceMatchUpId:c,inContextDrawMatchUps:i,winningDrawPosition:C,winnerParticipantId:_,tournamentRecord:n,winnerTargetLink:v,drawDefinition:r,winnerMatchUp:I,dualMatchUp:o,matchUpsMap:s}),b){let{winnerHadMatchUpStatus:k}=IFe({drawPositionMatchUps:N,loserDrawPosition:M,sourceMatchUps:U}),O=g.linkCondition===Pp;if(k&&O){let F=Math.min(...b.drawPositions);uj({targetLink:g,inContextDrawMatchUps:i,drawDefinition:r,drawPosition:F,matchUpsMap:s,event:d})}let $=TFe({sourceMatchUpStatus:a,sourceMatchUpId:c,loserParticipantId:A,tournamentRecord:n,loserTargetLink:g,drawDefinition:r,loserMatchUp:b,dualMatchUp:o,matchUpsMap:s,event:d});if($.error)return $}if(T){let k=Math.min(...T.drawPositions);uj({sourceMatchUpId:c,targetLink:y,inContextDrawMatchUps:i,drawDefinition:r,drawPosition:k,matchUpsMap:s,event:d})}return{...de,...S&&{tieMatchUpResult:S}}}function Yde({inContextDrawMatchUps:t,winningDrawPosition:e,sourceMatchUpStatus:i,winnerParticipantId:n,tournamentRecord:r,winnerTargetLink:a,sourceMatchUpId:s,drawDefinition:o,winnerMatchUp:l,matchUpsMap:c,dualMatchUp:u,event:d}){var m,g;let{structureId:p,roundNumber:h}=l,f="removeDirectedWinner";if(a){let v=a.target.structureId,{structure:y}=hi({drawDefinition:o,structureId:v});if(!y)return{error:gr};let{positionAssignments:b}=Ma({structure:y});y.seedAssignments=(y.seedAssignments??[]).filter(P=>P.participantId!==n);let I=(m=b==null?void 0:b.find(P=>P.participantId===n))==null?void 0:m.drawPosition,{matchUps:T}=wn({drawDefinition:o,structure:y,event:d}),w=T.map(P=>P.drawPositions).flat(1/0).filter(Boolean),S=Ml(w);if((I?S[I]:void 0)===1)b==null||b.forEach(P=>{P.participantId===n&&delete P.participantId});else{let P=T.filter(({drawPositions:E})=>E.includes(I));console.log("not removing from position assignments since instances > 1",{drawPositionMatchUps:P,winnerTargetLink:a})}let U=(g=c==null?void 0:c.drawMatchUps)==null?void 0:g.find(({matchUpId:P})=>P===l.matchUpId);U&&Ji({tournamentId:r==null?void 0:r.tournamentId,eventId:d==null?void 0:d.eventId,matchUp:U,context:f,drawDefinition:o})}return h&&wFe({targetDrawPosition:e,inContextDrawMatchUps:t,sourceMatchUpStatus:i,tournamentRecord:r,sourceMatchUpId:s,drawDefinition:o,dualMatchUp:u,matchUpsMap:c,roundNumber:h,structureId:p}),{...de}}function TFe({sourceMatchUpStatus:t,loserParticipantId:e,tournamentRecord:i,loserTargetLink:n,sourceMatchUpId:r,drawDefinition:a,loserMatchUp:s,matchUpsMap:o,dualMatchUp:l,event:c}){var m,g,v;let u="removeDirectedLoser",d=n.target.structureId,{structure:p}=hi({drawDefinition:a,structureId:d});if(!p)return{error:gr};let{positionAssignments:h}=Ma({structure:p}),f=(m=h==null?void 0:h.find(y=>y.participantId===e))==null?void 0:m.drawPosition;if(h==null||h.forEach(y=>{y.participantId===e&&delete y.participantId}),p.seedAssignments=(p.seedAssignments??[]).filter(y=>y.participantId!==e),l){let y=s==null?void 0:s.sides.reduce((T,w,S)=>w.drawPosition===f?S:T,void 0),b=(g=o==null?void 0:o.drawMatchUps)==null?void 0:g.find(({matchUpId:T})=>T===s.matchUpId),I=(v=b==null?void 0:b.sides)==null?void 0:v[y];I&&(delete I.lineUp,Ji({tournamentId:i==null?void 0:i.tournamentId,eventId:c==null?void 0:c.eventId,matchUp:b,context:u,drawDefinition:a}))}return{...de}}function uj({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,drawPosition:n,matchUpsMap:r,targetLink:a,event:s}){let o=a.target.structureId,l="removeDirectedBye";Xl({color:"brightyellow",method:l,drawPosition:n});let c=lC({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,drawPosition:n,matchUpsMap:r,structureId:o,event:s});return he({result:c,stack:l})}function UFe(t){var l,c;let{matchUpFormat:e,score:i}=t,n=(l=i==null?void 0:i.sets)==null?void 0:l.length,r=e&&wo(e),{setFormat:a,finalSetFormat:s,bestOf:o}=r??{};return((c=o&&n===o&&s||a)==null?void 0:c.timed)||!1}function DFe({tournamentRecord:t,drawDefinition:e,structure:i,matchUp:n}){var o;let r="attemptToSetMatchUpStatusBYE";if(n!=null&&n.winningSide)return he({result:{error:ZT},context:{matchUpStatus:mn},stack:r});let{positionAssignments:a}=Ma({structure:i}),s=a==null?void 0:a.filter(l=>l.bye).map(l=>l.drawPosition);return(o=n.drawPositions)!=null&&o.some(l=>s==null?void 0:s.includes(l))?(n.matchUpStatus=mn,n.matchUpStatusCodes=[],Ji({tournamentId:t==null?void 0:t.tournamentId,context:r,drawDefinition:e,matchUp:n}),{...de}):he({result:{error:Gre},info:"matchUp does not include BYE",stack:r})}function uD(t){var g,v;let{tournamentRecord:e,appliedPolicies:i,drawDefinition:n,matchUpsMap:r,targetData:a,structure:s,event:o}=t,l="doubleExitAdvancement";if(s.structureType===So)return he({result:{...de},stack:l});let{matchUp:c,targetMatchUps:u,targetLinks:d}=a,{loserMatchUp:p,winnerMatchUp:h,loserTargetDrawPosition:f}=u,m=[cn,Yi].includes(p==null?void 0:p.matchUpStatus)&&!((g=p.sides)!=null&&g.map(y=>y.participantId??y.participant).filter(Boolean).length);if(p&&p.matchUpStatus!==mn){let{loserTargetLink:y}=d;if((v=i==null?void 0:i.progression)!=null&&v.doubleExitPropagateBye){let b=Kde({loserTargetDrawPosition:f,tournamentRecord:e,loserTargetLink:y,drawDefinition:n,loserMatchUp:p,matchUpsMap:r,event:o});if(b.error)return he({result:b,stack:l})}else if(!m){let{feedRound:b,drawPositions:I,matchUpId:T}=p,w=b?2:2-I.indexOf(f),S=MZ({...t,targetMatchUp:p,walkoverWinningSide:w,tournamentRecord:e,sourceMatchUp:c,matchUpId:T});if(S.error)return he({result:S,stack:l})}}if(h){let y=MZ({...t,matchUpId:h.matchUpId,targetMatchUp:h,tournamentRecord:e,sourceMatchUp:c});if(y.error)return he({result:y,stack:l})}return he({result:{...de},stack:l})}function MZ(t){var W,Z,K;let{inContextDrawMatchUps:e,tournamentRecord:i,drawDefinition:n,sourceMatchUp:r,targetMatchUp:a,matchUpsMap:s}=t,o=n.structures.find(({structureId:Q})=>Q===a.structureId),l=t.matchUpStatus===sa?sa:Yr,c=t.matchUpStatus===sa?Yi:cn,u="conditionallyAdvanceDrawPosition",d=s.drawMatchUps.find(Q=>Q.matchUpId===a.matchUpId);if(!d)return{error:rl};let p=(r==null?void 0:r.drawPositions)||[],h=(W=d.drawPositions)==null?void 0:W.filter(Boolean),f=(r==null?void 0:r.structureId)===a.structureId;if(f&&ho(p,h)&&(h=h.filter(Q=>!p.includes(Q))),f&&h.length>1)return he({result:{error:RS},stack:u});let{pairedPreviousMatchUpIsDoubleExit:m,pairedPreviousMatchUp:g}=mle(t),v=mo({matchUpId:a.matchUpId,inContextDrawMatchUps:e,drawDefinition:n}),{targetMatchUps:y,targetLinks:b}=v,{loserTargetDrawPosition:I,winnerMatchUp:T,loserMatchUp:w}=y;if(w){let{loserTargetLink:Q}=b,J=Kde({loserTargetDrawPosition:I,loserMatchUp:w,tournamentRecord:i,loserTargetLink:Q,drawDefinition:n,matchUpsMap:s});if(J.error)return he({result:J,stack:u})}let S=((Z=d.drawPositions)==null?void 0:Z.filter(Boolean))||[],U=S.length===1,P=t.walkoverWinningSide||U&&GN({drawPosition:S[0],matchUpId:a.matchUpId,inContextDrawMatchUps:e})||void 0,E=[cn,Yi].includes(d.matchUpStatus)&&!S.length,R=d.finishingRound===1,C=E&&!R?l:c,M=e.find(Q=>Q.matchUpId===g.matchUpId),_=[],A;r&&((r==null?void 0:r.structureId)===(M==null?void 0:M.structureId)?r.roundPosition<(g==null?void 0:g.roundPosition)?A=1:A=2:a.feedRound?r.structureId===a.structureId?A=2:A=1:P&&(A=3-P));let N=t.matchUpStatus,k=g==null?void 0:g.matchUpStatus;A===1?_=[{matchUpStatus:VM(N),previousMatchUpStatus:N,sideNumber:1},{matchUpStatus:VM(k),previousMatchUpStatus:k,sideNumber:2}]:A===2&&(_=[{matchUpStatus:VM(k),previousMatchUpStatus:k,sideNumber:1},{matchUpStatus:VM(N),previousMatchUpStatus:N,sideNumber:2}]),_.length&&(_=_.map(Q=>Kt(Q)));let O=vp({...t,winningSide:P,matchUp:d,matchUpStatusCodes:_,context:u,matchUpStatus:C});if(O.error)return he({result:O,stack:u});if(E)return uD({...t,matchUpStatus:C,targetData:v});if(!T)return he({result:{...de},stack:u});let $=h.length===2?h[P-1]:h[0],{positionAssignments:F}=jn({structure:o}),V=F==null?void 0:F.find(Q=>Q.drawPosition===$),j=s.drawMatchUps.find(Q=>Q.matchUpId===T.matchUpId),B=(K=j==null?void 0:j.drawPositions)==null?void 0:K.filter(Boolean),z=B.length===1;if($){if(V!=null&&V.bye){let Q=mo({matchUpId:j.matchUpId,inContextDrawMatchUps:e,drawDefinition:n});if(z){let J=B.filter(Boolean)[0],se=GN({drawPosition:J,matchUpId:j.matchUpId,inContextDrawMatchUps:e}),ie=vp({appliedPolicies:t.appliedPolicies,matchUpId:j.matchUpId,matchUp:j,matchUpStatus:c,matchUpStatusCodes:[],removeScore:!0,context:u,drawDefinition:n,winningSide:se});return ie.error?he({result:ie,stack:u}):r3({drawPositionToAdvance:J,matchUpId:j.matchUpId,inContextDrawMatchUps:e,drawDefinition:n,matchUpsMap:s})}else if([cn,Yi].includes(T.matchUpStatus)){let J=uD({...t,matchUpId:j.matchUpId,matchUpStatus:C,targetData:Q});if(J.error)return he({result:J,stack:u})}return he({result:{...de},stack:u})}return zS({matchUpId:T.matchUpId,drawPosition:$,inContextDrawMatchUps:e,drawDefinition:n})}else if(m){if(!j)return{error:rl};if(z){let se=B[0],ie=GN({matchUpId:a.matchUpId,inContextDrawMatchUps:e,drawPosition:se});console.log("existing drawPosition is winningSide",{walkoverWinningSide:ie})}let Q=[cn,Yi].includes(j.matchUpStatus)?c:l,J=vp({matchUpId:j.matchUpId,appliedPolicies:t.appliedPolicies,matchUp:j,matchUpStatusCodes:[],removeScore:!0,context:u,drawDefinition:n,matchUpStatus:Q});if(J.error)return he({result:J,stack:u});if(Q===l){let se=uD({...t,matchUpId:a.matchUpId,matchUpStatus:Q,targetData:v});if(se.error)return se}}return he({result:{...de},stack:u})}function Kde(t){var c;let{loserTargetDrawPosition:e,tournamentRecord:i,loserTargetLink:n,drawDefinition:r,matchUpsMap:a,event:s}=t,o=(c=n==null?void 0:n.target)==null?void 0:c.structureId,{structure:l}=hi({drawDefinition:r,structureId:o});return l?fc({drawPosition:e,tournamentRecord:i,drawDefinition:r,structureId:o,matchUpsMap:a,event:s}):{error:Ny}}function VM(t){return t===Yr?cn:t===sa?Yi:t}function EFe(t){let{tournamentRecord:e,drawDefinition:i,matchUpStatus:n,structure:r,matchUp:a}=t,s=!!(a.tieMatchUps&&!a.rondPosition&&t.inContextDrawMatchUps.find(v=>v.matchUpId===a.matchUpId).containerStructureId),o="attemptToSetMatchUpStatus",l=n===mn,c=a.winningSide,u=[Yr,sa].includes(n),d=sC({matchUpStatus:n}),p=VV({matchUpStatus:n}),h=!d&&!p,f=t.matchUpTieId||c&&d&&!u,m=c&&u,g=()=>vp({...t,removeScore:[zp,cn].includes(n),matchUpStatus:n||Vr});return h&&{error:TV}||f&&dj(t)||m&&PFe(t)||c&&UU(t)||p&&g()||l&&DFe({tournamentRecord:e,drawDefinition:i,structure:r,matchUp:a})||!d&&{error:TV}||u&&CFe(t)||s&&dj(t)||he({result:{error:ZT},stack:o})}function PFe(t){let e=UU(t);return e.error?e:uD(t)}function CFe(t){let e=dj({...t,removeScore:!0});return e.error?e:uD(t)}function dj(t){var r;let e="scoreModification";if(t.isCollectionMatchUp&&((r=t.dualMatchUp)!=null&&r.winningSide)&&!t.projectedWinningSide){let a=UU(t);if(a.error)return he({result:a,stack:e})}let i=!!t.matchUp.collectionId,n=vp({...t,context:e});if(i){let{matchUpTieId:a,drawDefinition:s,matchUpsMap:o}=t,l=Tm({tournamentRecord:t.tournamentRecord,appliedPolicies:t.appliedPolicies,matchUpId:a,event:t.event,drawDefinition:s,matchUpsMap:o});if(l.error)return he({result:l,stack:e});Object.assign(n,{tieMatchUpResult:l})}return he({result:n,stack:e})}function RFe({drawDefinition:t,structure:e,matchUp:i}){var l,c,u,d;let{drawPositions:n}=i,{positionAssignments:r}=jn({drawDefinition:t,structure:e}),a=(l=r==null?void 0:r.filter(({drawPosition:p})=>n==null?void 0:n.includes(p)))==null?void 0:l.map(p=>{var f;let{extension:h}=ki({element:p,name:cg});return(f=h==null?void 0:h.value)==null?void 0:f.groupOrder}),{containerStructures:s}=cU({drawDefinition:t}),o=s[e.structureId];return{structureIds:(d=(u=(c=uU({drawDefinition:t,structureId:o}))==null?void 0:c.links)==null?void 0:u.source)==null?void 0:d.filter(p=>{var h;return ho(a,((h=p.source)==null?void 0:h.finishingPositions)||[])}).map(p=>p.source.structureId)}}function Zde({drawDefinition:t,structure:e,matchUp:i}){let n=[];if(e.finishingPosition===ey&&fg({drawDefinition:t,structure:e})){let{structureIds:r}=RFe({drawDefinition:t,structure:e,matchUp:i});r!=null&&r.length&&n.push(...r)}return{connectedStructureIds:n}}function MFe(t){var o,l,c;let e,{inContextDrawMatchUps:i,inContextMatchUp:n,drawDefinition:r,winningSide:a}=t,s=(o=t.targetData.targetLinks)==null?void 0:o.winnerTargetLink;if(s.target.feedProfile===Uu){let u=n.sides.find(({sideNumber:p})=>p!==a).participantId,d=i.find(p=>p.structureId===s.target.structureId&&p.roundNumber===s.target.roundNumber&&p.sides.some(({participantId:h})=>h===u));if((d==null?void 0:d.matchUpStatus)===Vr){let p=mo({matchUpId:d.matchUpId,inContextDrawMatchUps:i,drawDefinition:r});if(!ly({inContextDrawMatchUps:i,drawDefinition:r,targetData:p})){let{structure:h}=hi({structureId:d.structureId,drawDefinition:r}),f=jn({structure:h}).positionAssignments;for(let m of f||[])if(m.participantId===u){let g=n.sides.find(({sideNumber:v})=>v===a).participantId;if(m.participantId=g,h==null?void 0:h.positionAssignments)h.positionAssignments=f;else if(h!=null&&h.structures){let v=Object.assign({},...(f||[]).map(y=>({[y.drawPosition]:y.participantId})));for(let y of h.structures)(l=y.positionAssignments)==null||l.forEach(b=>b.participantId=v[b.drawPosition])}pg({tournamentId:(c=t.tournamentRecord)==null?void 0:c.tournamentId,event:t.event,drawDefinition:r,structure:h}),e=!0}}}}return{...de,qualifierReplaced:e}}function NFe(t){var o,l,c,u,d;let e,{inContextDrawMatchUps:i,inContextMatchUp:n,drawDefinition:r,winningSide:a}=t,s=(o=t.targetData.targetLinks)==null?void 0:o.winnerTargetLink;if(s.target.feedProfile===Uu){let p=(l=n.sides.find(({sideNumber:m})=>m===a))==null?void 0:l.participantId,h=i.filter(m=>m.structureId===s.target.structureId&&m.roundNumber===s.target.roundNumber&&m.sides.some(({participantId:g,qualifier:v})=>v&&!g)),f=wl(h);if((f==null?void 0:f.matchUpStatus)===Vr){let m=mo({matchUpId:f.matchUpId,inContextDrawMatchUps:i,drawDefinition:r});if(!ly({inContextDrawMatchUps:i,drawDefinition:r,targetData:m})){let g=(c=f.sides.find(b=>b.qualifier&&!b.participantId))==null?void 0:c.drawPosition,{structure:v}=hi({structureId:f.structureId,drawDefinition:r});if(!v)return{error:gr};let y=jn({structure:v}).positionAssignments;for(let b of y||[])if(b.drawPosition===g&&!b.participantId){if(b.participantId=p,v.positionAssignments)v.positionAssignments=y;else if(v.structures){let I=Object.assign({},...(y||[]).map(T=>({[T.drawPosition]:T.participantId})));for(let T of v.structures)(u=T.positionAssignments)==null||u.forEach(w=>w.participantId=I[w.drawPosition])}pg({tournamentId:(d=t.tournamentRecord)==null?void 0:d.tournamentId,event:t.event,drawDefinition:r,structure:v}),e=!0}}}}return{...de,qualifierPlaced:e}}function AFe(t){var h,f;let e="attemptToSetWinningSide",i,{appliedPolicies:n,disableAutoCalc:r,drawDefinition:a,dualMatchUp:s,winningSide:o,structure:l,matchUp:c}=t;if(s!=null&&s._disableAutoCalc&&r!==!1)return O3(t);if(c.winningSide&&c.winningSide!==o){let{connectedStructureIds:m}=Zde({drawDefinition:a,structure:l,matchUp:c});m.length&&(console.log({connectedStructureIds:m}),i=!0);let g=UU(t);if(g.error)return g}let u=dce(t);if(u.error)return he({result:u,stack:e});let d,p;return t.qualifierChanging&&((h=n==null?void 0:n[aE])!=null&&h.autoReplaceQualifiers)&&(d=MFe(t).qualifierReplaced),t.qualifierAdvancing&&((f=n==null?void 0:n[aE])!=null&&f.autoPlaceQualifiers)&&(p=NFe(t).qualifierPlaced),he({result:Kt({...de,...u,connectedStructures:i,qualifierReplaced:d,qualifierPlaced:p}),stack:e})}var YN={drawPositionToRemove:"green",iteration:"brightred",winner:"green",loser:"brightred"};function Xde(t){var g,v,y,b;let{inContextDrawMatchUps:e,appliedPolicies:i,drawDefinition:n,matchUpsMap:r,targetData:a,matchUp:s}=t,{matchUpId:o}=s,{iteration:l=0}=t;l+=1;let c="removeDoubleExit";Xl({color:"brightyellow",method:c,matchUpId:o,iteration:l,keyColors:YN});let{targetMatchUps:{loserMatchUp:u,winnerMatchUp:d,loserTargetDrawPosition:p},targetLinks:{loserTargetLink:h}}=a;if(d&&d.matchUpStatus!==mn){let{stage:I,roundNumber:T,roundPosition:w,structureName:S}=d;Xl({winner:"winner",roundPosition:w,structureName:S,roundNumber:T,keyColors:YN,stage:I}),NZ({...t,targetMatchUp:d,sourceMatchUp:s,iteration:l})}let f=(u==null?void 0:u.matchUpStatus)===mn&&((u==null?void 0:u.feedRound)||(u==null?void 0:u.roundNumber)===1),m=((v=(g=a==null?void 0:a.targetLinks)==null?void 0:g.loserTargetLink)==null?void 0:v.linkCondition)===Pp;if(f&&m){let I=e.filter(({roundNumber:S,structureId:U})=>U===s.structureId&&S===1),T=I.map(({roundPosition:S})=>S),w=Ra(T.sort(),2).find(S=>S.includes(s.roundPosition));if(((y=I.filter(({roundPosition:S})=>w.includes(S)))==null?void 0:y.map(({matchUpStatus:S})=>S)).every(S=>[sa,Yr].includes(S)))return he({result:{...de},stack:c})}if(u&&(u.matchUpStatus!==mn||f)){let I=e.find(({matchUpId:R})=>R===u.matchUpId),{structure:T}=hi({drawDefinition:n,structureId:I.structureId}),{stage:w,roundNumber:S,roundPosition:U,feedRound:P,structureName:E}=u;if(Xl({loser:"loser",roundPosition:U,structureName:E,roundNumber:S,keyColors:YN,feedRound:P,stage:w}),((b=i==null?void 0:i.progression)==null?void 0:b.doubleExitPropagateBye)||f)uj({drawPosition:p,targetLink:h,inContextDrawMatchUps:e,drawDefinition:n,matchUpsMap:r});else{let R=NZ({...t,targetMatchUp:u,structure:T,iteration:l});if(R.error)return he({result:R,stack:c})}}return he({result:{...de},stack:c})}function NZ(t){var I,T,w,S,U,P;let{inContextDrawMatchUps:e,appliedPolicies:i,drawDefinition:n,sourceMatchUp:r,targetMatchUp:a,matchUpsMap:s,structure:o,iteration:l}=t,c="conditionallyRemoveDrawPosition";Xl({method:c,structureName:o==null?void 0:o.structureName,iteration:l});let u=mo({matchUpId:a.matchUpId,inContextDrawMatchUps:e,drawDefinition:n}),{targetMatchUps:{winnerMatchUp:d}}=u,p=s==null?void 0:s.drawMatchUps.find(E=>E.matchUpId===a.matchUpId),h=[],f,m,g;if(a.feedRound)g=(T=(I=d==null?void 0:d.drawPositions)==null?void 0:I.filter(Boolean))==null?void 0:T.find(E=>a.drawPositions.includes(E));else if(!r)g=(w=Nr((a==null?void 0:a.drawPositions)||[],(d==null?void 0:d.drawPositions)||[]))==null?void 0:w[0];else if(m=(S=gle({structureId:o.structureId,matchUp:r,matchUpsMap:s}))==null?void 0:S.pairedPreviousMatchUp,f=[Yr,sa].includes(m==null?void 0:m.matchUpStatus),h=((U=m==null?void 0:m.drawPositions)==null?void 0:U.filter(Boolean))||[],[...ca,mn].includes(m==null?void 0:m.matchUpStatus)||(m==null?void 0:m.winningSide)){let E=r.drawPositions||[],R=(P=a.drawPositions)==null?void 0:P.filter(Boolean);ho(E,R)&&(R=R==null?void 0:R.filter(C=>!E.includes(C))),g=E.concat(h).find(C=>R==null?void 0:R.includes(C))}if(d&&g){let{stage:E,roundNumber:R,roundPosition:C,structureName:M}=d;Xl({method:"removeDirectedWinner",drawPositionToRemove:g,color:"brightgreen",roundPosition:C,structureName:M,roundNumber:R,keyColors:YN,stage:E}),Yde({winningDrawPosition:g,winnerMatchUp:d,inContextDrawMatchUps:e,drawDefinition:n,matchUpsMap:s})}let v=Xde({targetData:u,matchUp:a,inContextDrawMatchUps:e,appliedPolicies:i,drawDefinition:n,matchUpsMap:s,structure:o,iteration:l});if(v.error)return he({result:v,stack:c});let y=_Fe({pairedPreviousDoubleExit:f,noContextTargetMatchUp:p}),b=!f;return v=vp({...t,matchUpId:a.matchUpId,matchUp:p,removeWinningSide:!0,matchUpStatusCodes:[],context:c,matchUpStatus:y,removeScore:b,score:{scoreStringSide1:"",scoreStringSide2:"",sets:void 0}}),v.error?he({result:v,stack:c}):{...de}}function _Fe({pairedPreviousDoubleExit:t,noContextTargetMatchUp:e}){return e.matchUpStatus===mn?mn:t?[sa,Yi].includes(e==null?void 0:e.matchUpStatus)?Yi:cn:Vr}function kFe(t){var s,o,l,c,u;let e,{inContextDrawMatchUps:i,inContextMatchUp:n,drawDefinition:r}=t,a=(s=t.targetData.targetLinks)==null?void 0:s.winnerTargetLink;if(a.target.feedProfile===Uu){let d=(l=(o=n.sides)==null?void 0:o.find(({sideNumber:h})=>h===n.winningSide))==null?void 0:l.participantId,p=i.find(h=>{var f;return h.structureId===a.target.structureId&&h.roundNumber===a.target.roundNumber&&((f=h.sides)==null?void 0:f.some(({participantId:m})=>m===d))});if(p&&p.matchUpStatus===Vr){let h=mo({matchUpId:p.matchUpId,inContextDrawMatchUps:i,drawDefinition:r});if(!ly({inContextDrawMatchUps:i,drawDefinition:r,targetData:h})){let{structure:f}=hi({structureId:p.structureId,drawDefinition:r}),m=jn({structure:f}).positionAssignments;for(let g of m||[])if(g.participantId===d){if(g.participantId=void 0,f==null?void 0:f.positionAssignments)f.positionAssignments=m;else if(f!=null&&f.structures){let v=Object.assign({},...(m||[]).map(y=>({[y.drawPosition]:y.participantId})));for(let y of(f==null?void 0:f.structures)||[])(c=y.positionAssignments)==null||c.forEach(b=>b.participantId=v[b.drawPosition])}pg({tournamentId:(u=t.tournamentRecord)==null?void 0:u.tournamentId,event:t.event,drawDefinition:r,structure:f}),e=!0}}}}return{qualifierRemoved:e}}function xFe(t){var m;let{matchUp:e,matchUpStatus:i,score:n,winningSide:r}=t,a="noDownStreamDependencies";if([Yr,sa].includes(e==null?void 0:e.matchUpStatus)&&![Yr,sa].includes(i)){let g=Xde(t);if(g.error)return he({result:g,stack:a})}let s=i===Yr,o=ga({score:n})&&!s&&(t.isCollectionMatchUp&&!t.projectedWinningSide||!r),l=((m=t==null?void 0:t.inContextMatchUp)==null?void 0:m.collectionId)&&UFe(t.inContextMatchUp),c=t.removeScore||!l&&![_l,sl].includes(i||_l),u=t.isCollectionMatchUp&&t.dualMatchUp.winningSide&&!t.projectedWinningSide||e.winningSide&&!r&&!ga({score:n}),d=i&&i!==Vr,p=g=>{var U,P;let v,{structure:y,drawDefinition:b,dualMatchUp:I,disableAutoCalc:T}=t;if(I!=null&&I._disableAutoCalc&&T!==!1)return O3({...t,removeWinningSide:u});let{connectedStructureIds:w}=Zde({drawDefinition:b,structure:y,matchUp:e});w.length&&(console.log({connectedStructureIds:w}),v=!0),Object.assign(t,{removeScore:g});let S=UU(t);if(S.error)return S;if(t.removingQualifier&&((P=(U=t.appliedPolicies)==null?void 0:U[aE])!=null&&P.autoRemoveQualifiers)){let E=kFe(t);return{...de,connectedStructures:v,...E}}return{...de,connectedStructures:v}};if(u&&r&&t.isCollectionMatchUp)return AZ(t);let h=[zp,sl].includes(i)&&t.dualWinningSideChange,f=(r||h)&&AFe(t)||o&&p(c)||d&&EFe(t)||u&&p(c)||e&&AZ({...t,removeScore:!0})||{...de};return he({result:f,stack:a})}function AZ(t){var n;let e="ndd:scoreModification";if(t.isCollectionMatchUp&&((n=t.dualMatchUp)!=null&&n.winningSide)&&!t.projectedWinningSide&&!t.autoCalcDisabled){let r=UU(t);if(r.error)return r}let i=vp({...t,context:e});if(t.isCollectionMatchUp){let{matchUpTieId:r,drawDefinition:a,event:s,matchUpsMap:o}=t,{removeWinningSide:l}=Tm({tournamentRecord:t.tournamentRecord,appliedPolicies:t.appliedPolicies,matchUpId:r,drawDefinition:a,matchUpsMap:o,event:s});l&&console.log("REMOVE WINNING SIDE")}return he({result:i,stack:e})}function d4(t){var u,d,p;let e=Qt(t,[{[ba]:!0,[To]:!0,[Gp]:!0},{homeParticipantId:!0,[Au]:la}]);if(e.error)return e;let i=bU(t,[{[nU]:Zh,attr:{[Ex]:!0}}]);if(i.error)return i;let n=(p=(d=(u=i==null?void 0:i.matchUp)==null?void 0:u.matchUp)==null?void 0:d.sides)==null?void 0:p.map(h=>h==null?void 0:h.participantId);if(t.homeParticipantId&&!(n!=null&&n.includes(t.homeParticipantId)))return{error:Md};let{disableNotice:r,homeParticipantId:a,removePriorValues:s,tournamentRecord:o,drawDefinition:l,matchUpId:c}=t;return xl({duplicateValues:!1,removePriorValues:s,tournamentRecord:o,drawDefinition:l,disableNotice:r,matchUpId:c,timeItem:{itemType:Xq,itemValue:a}})}function Jde({timeStamp:t,schedule:e,matchUp:i}){let{itemValue:n,timeStamp:r}=Vy({timeItems:(i==null?void 0:i.timeItems)||[],itemType:zx});return!e||r&&t&&new Date(r).getTime()>new Date(t).getTime()?{timeModifiers:n}:e}function Wg(t){var h;let e="addMatchUpScheduledTime",i=t.matchUp,{removePriorValues:n,tournamentRecord:r,drawDefinition:a,disableNotice:s,scheduledTime:o,matchUpId:l}=t;if(!l)return he({result:{error:Ks},stack:e});if(!tU(o))return he({result:{error:bu},stack:e});if(!i){let f=ar({drawDefinition:a,matchUpId:l});if(f.error)return he({result:f,stack:e});i=f.matchUp}let c=Ri(o),u=iw({matchUp:i}).scheduledDate,d=c&&!u;if((h=Jde({matchUp:i}).timeModifiers||[])!=null&&h.length){let f=Qde({disableNotice:!0,removePriorValues:n,tournamentRecord:r,timeModifiers:[],drawDefinition:a,matchUpId:l,matchUp:i});if(f!=null&&f.error)return he({result:f,stack:e})}let p=WI(o,!0,d);return xl({duplicateValues:!1,removePriorValues:n,tournamentRecord:r,drawDefinition:a,disableNotice:s,matchUpId:l,timeItem:{itemType:ew,itemValue:p}})}function Qde({removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:n,timeModifiers:r,matchUpId:a,matchUp:s}){let o="addMatchUpTimeModifiers";if(!a)return he({result:{error:Ks},stack:o});if(r!==void 0&&!Array.isArray(r))return he({info:sy("timeModifiers"),result:{error:Re},stack:o});if(!s){let d=ar({drawDefinition:i,matchUpId:a});if(d.error)return he({result:d,stack:o});s=d.matchUp}let l=Jde({matchUp:s}).timeModifiers||[],c=r.filter(d=>!l.includes(d));if(r.length&&!c.length)return{...de};if(c.some(d=>LV.includes(d))){l=l.filter(p=>!LV.includes(p));let d=Wg({disableNotice:!0,removePriorValues:t,scheduledTime:"",tournamentRecord:e,drawDefinition:i,matchUpId:a});if(d.error)return he({result:d,stack:o})}let u=r!=null&&r.length?[...c,...l]:void 0;return xl({duplicateValues:!1,removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:n,matchUpId:a,timeItem:{itemType:zx,itemValue:u}})}function YO({scheduledDate:t,removePriorValues:e,tournamentRecord:i,drawDefinition:n,disableNotice:r,matchUpId:a}){if(!a)return{error:Ks};let s=t&&Dp.test(t);if(t&&!s)return{error:Fa};let o={itemValue:Ri(t),itemType:QI};return xl({duplicateValues:!1,removePriorValues:e,tournamentRecord:i,drawDefinition:n,disableNotice:r,matchUpId:a,timeItem:o})}function KO({removePriorValues:t,tournamentRecords:e,tournamentRecord:i,drawDefinition:n,disableNotice:r,courtDayDate:a,matchUpId:s,courtIds:o}){var u,d;if(!i&&!e)return{error:ut};if(!s)return{error:Ks};let l=ar({drawDefinition:n,matchUpId:s});if(l.error)return l;if(((u=l==null?void 0:l.matchUp)==null?void 0:u.matchUpType)!==ec)return{error:al};if(!(o===void 0||Array.isArray(o)&&o.length&&o.every(p=>typeof p=="string")))return{error:Re,context:{courtIds:o}};let c;if(o){let p=e||i&&{[i.tournamentId]:i},h=Um({tournamentRecords:p});if(h.error)return h;let f=(d=h.courts)==null?void 0:d.filter(m=>o.includes(m.courtId));if((f==null?void 0:f.length)!==o.length)return{error:Re,context:{courtIds:o}};c=f==null?void 0:f.map(m=>({venueId:m.venueId,courtId:m.courtId}))}return xl({duplicateValues:!1,removePriorValues:t,tournamentRecord:i,drawDefinition:n,disableNotice:r,matchUpId:s,timeItem:{itemType:$h,itemDate:a,itemValue:c}})}function DU({removePriorValues:t,tournamentRecords:e,tournamentRecord:i,drawDefinition:n,disableNotice:r,matchUpId:a,venueId:s}){if(!i)return{error:ut};if(!a)return{error:Ks};if(s){let o=Xh({tournamentRecords:e,tournamentRecord:i,venueId:s});if(o.error)return o}return xl({duplicateValues:!1,removePriorValues:t,tournamentRecord:i,drawDefinition:n,disableNotice:r,matchUpId:a,timeItem:{itemType:JI,itemValue:s}})}function fw({removePriorValues:t,tournamentRecords:e,tournamentRecord:i,drawDefinition:n,disableNotice:r,courtDayDate:a,matchUpId:s,courtId:o}){var l;if(!i&&!e)return{error:ut};if(!s)return{error:Ks};if(o){let c=nw({tournamentRecords:e,tournamentRecord:i,courtId:o});if(c.error)return c;let u=(l=c.venue)==null?void 0:l.venueId;DU({tournamentRecords:e,tournamentRecord:i,drawDefinition:n,disableNotice:r,matchUpId:s,venueId:u})}return xl({duplicateValues:!1,removePriorValues:t,tournamentRecord:i,drawDefinition:n,disableNotice:r,matchUpId:s,timeItem:{itemType:hg,itemDate:a,itemValue:o}})}function up(t,e){let i=qae.test(t)?t:rr(t),n=Ri(t)||Ri(e)||Mu(new Date);return new Date(`${n}T${i}`).getTime()}function ZO(t){var A;let e="addMatchUpScheduleItems",i=Qt(t,[{drawDefinition:!0,matchUpId:!0},{schedule:!0,[qo]:el}],e);if(i.error)return i;let{matchUpDependencies:n,inContextMatchUps:r}=t,{errorOnAnachronism:a=!1,checkChronology:s=!0,removePriorValues:o,tournamentRecords:l,tournamentRecord:c,drawDefinition:u,disableNotice:d,drawMatchUps:p,matchUpId:h,schedule:f,event:m}=t,g,v;if(p)g=p.find(N=>N.matchUpId===h);else{let N=ar({drawDefinition:u,event:m,matchUpId:h});if(N.error)return N;g=N.matchUp}let{endTime:y,courtId:b,courtIds:I,courtOrder:T,resumeTime:w,homeParticipantId:S,scheduledDate:U,scheduledTime:P,startTime:E,stopTime:R,timeModifiers:C,venueId:M}=f;s&&(!n||!r)&&({matchUpDependencies:n,matchUps:r}=rd({drawDefinition:u}));let _=(A=n==null?void 0:n[h])==null?void 0:A.matchUpIds;if(f.scheduledDate&&s&&_){let N=r==null?void 0:r.filter(k=>{var O,$;return(((O=k.schedule)==null?void 0:O.scheduledDate)||Ri(($=k.schedule)==null?void 0:$.scheduledTime))&&_.includes(k.matchUpId)}).map(({schedule:k})=>{let O=OA(k);return new Date(O).getTime()});if(N!=null&&N.length){let k=OA(f),O=new Date(k).getTime();if(Math.max(...N)>=O){if(a)return he({result:{error:IV},stack:e});v=IV}}}if(U!==void 0){let N=YO({disableNotice:!0,removePriorValues:o,tournamentRecord:c,drawDefinition:u,scheduledDate:U,matchUpId:h});if(N!=null&&N.error)return he({result:N,stack:e,context:{scheduledDate:U}})}if(P!==void 0){let N=Wg({disableNotice:!0,removePriorValues:o,tournamentRecord:c,drawDefinition:u,scheduledTime:P,matchUpId:h,matchUp:g});if(N!=null&&N.error)return he({result:N,stack:e,context:{scheduledTime:P}})}if(E!==void 0){let N=h4({disableNotice:!0,removePriorValues:o,tournamentRecord:c,drawDefinition:u,matchUpId:h,startTime:E,event:m});if(N!=null&&N.error)return he({result:N,stack:e,context:{startTime:E}})}if(R!==void 0){let N=m4({disableNotice:!0,removePriorValues:o,tournamentRecord:c,drawDefinition:u,matchUpId:h,stopTime:R,event:m});if(N!=null&&N.error)return he({result:N,stack:e,context:{stopTime:R}})}if(w!==void 0){let N=g4({disableNotice:!0,removePriorValues:o,tournamentRecord:c,drawDefinition:u,resumeTime:w,matchUpId:h,event:m});if(N!=null&&N.error)return he({result:N,stack:e,context:{resumeTime:w}})}if(y!==void 0){let N=f4({disableNotice:!0,removePriorValues:o,tournamentRecord:c,drawDefinition:u,matchUpId:h,endTime:y,event:m});if(N!=null&&N.error)return he({result:N,stack:e,context:{endTime:y}})}if(I!==void 0){let N=KO({disableNotice:!0,removePriorValues:o,tournamentRecord:c,drawDefinition:u,matchUpId:h,courtIds:I});if(N!=null&&N.error)return he({result:N,stack:e,context:{courtIds:I}})}if(b!==void 0&&U!==void 0){let N=fw({courtDayDate:U,disableNotice:!0,removePriorValues:o,tournamentRecords:l,tournamentRecord:c,drawDefinition:u,matchUpId:h,courtId:b});if(N!=null&&N.error)return he({result:N,stack:e,context:{courtId:b}})}if(M!==void 0){let N=DU({disableNotice:!0,removePriorValues:o,tournamentRecords:l,tournamentRecord:c,drawDefinition:u,matchUpId:h,venueId:M});if(N!=null&&N.error)return he({result:N,stack:e,context:{venueId:M}})}if(T!==void 0&&Ii(T)){let N=p4({disableNotice:!0,removePriorValues:o,tournamentRecord:c,drawDefinition:u,courtOrder:T,matchUpId:h});if(N!=null&&N.error)return he({result:N,stack:e,context:{courtOrder:T}})}if(C!==void 0){let N=Qde({disableNotice:!0,removePriorValues:o,tournamentRecord:c,drawDefinition:u,timeModifiers:C,matchUpId:h,matchUp:g});if(N!=null&&N.error)return he({result:N,stack:e,context:{timeModifiers:C}})}return nr(S)&&d4({disableNotice:!0,homeParticipantId:S,removePriorValues:o,tournamentRecord:c,drawDefinition:u,matchUpId:h}),d||Ji({tournamentId:c==null?void 0:c.tournamentId,eventId:m==null?void 0:m.eventId,context:e,drawDefinition:u,matchUp:g}),v?{...de,warnings:[v]}:{...de}}function p4({removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:n,courtOrder:r,matchUpId:a}){if(!a)return{error:Ks};if(r&&!Ii(r))return{error:Re,info:"courtOrder must be numeric"};let s=r&&ui(r);return xl({duplicateValues:!1,removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:n,matchUpId:a,timeItem:{itemType:Hx,itemValue:s}})}function epe({removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:n,participantId:r,officialType:a,matchUpId:s}){if(!s)return{error:Ks};if(!r)return{error:la};if(e){let l=vr({tournamentRecord:e,participantFilters:{participantTypes:[ji],participantRoles:[l3]}}).participants??[];if(!lg({tournamentParticipants:l,participantId:r}))return{error:xr}}let o={itemType:"SCHEDULE.ASSIGNMENT.OFFICIAL",itemValue:r};return a&&(o.itemSubTypes=[a]),xl({duplicateValues:!1,removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:n,matchUpId:s,timeItem:o})}function h4({removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:n,matchUpId:r,startTime:a,event:s}){if(!r)return{error:Ks};if(!tU(a))return{error:bu};let{matchUp:o}=ar({drawDefinition:i,event:s,matchUpId:r}),{scheduledDate:l}=iw({matchUp:o}),c=((o==null?void 0:o.timeItems)??[]).filter(u=>[_f,Sh,Yf].includes(u==null?void 0:u.itemType)).map(u=>up(u.itemValue,l)).reduce((u,d)=>!u||d<u?d:u,void 0);if(!c||up(a,l)<c){o!=null&&o.timeItems&&(o.timeItems=o.timeItems.filter(d=>d.itemType!==gd));let u=WI(a,!0,!0);return xl({duplicateValues:!1,removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:n,matchUpId:r,timeItem:{itemType:gd,itemValue:u}})}else return{error:vae}}function f4({validateTimeSeries:t=!0,removePriorValues:e,tournamentRecord:i,drawDefinition:n,disableNotice:r,matchUpId:a,endTime:s,event:o}){if(!a)return{error:Ks};if(!tU(s))return{error:bu};let{matchUp:l}=ar({drawDefinition:n,event:o,matchUpId:a}),{scheduledDate:c}=iw({matchUp:l}),u=((l==null?void 0:l.timeItems)??[]).filter(d=>[gd,Sh,_f].includes(d==null?void 0:d.itemType)).map(d=>up(d.itemValue,c)).reduce((d,p)=>!d||p>d?p:d,void 0);if(!t||!u||up(s,c)>u){l!=null&&l.timeItems&&(l.timeItems=l.timeItems.filter(p=>p.itemType!==Yf));let d=WI(s,!0,!0);return xl({duplicateValues:!1,removePriorValues:e,tournamentRecord:i,drawDefinition:n,disableNotice:r,matchUpId:a,timeItem:{itemType:Yf,itemValue:d}})}else return{error:mae}}function m4({removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:n,matchUpId:r,stopTime:a,event:s}){if(!r)return{error:Ks};if(!tU(a))return{error:bu};let{matchUp:o}=ar({drawDefinition:i,event:s,matchUpId:r}),{scheduledDate:l}=iw({matchUp:o}),c=(o==null?void 0:o.timeItems)??[];if(c.reduce((f,m)=>m.itemType===Yf||f,void 0))return{error:_z};let u=c.filter(f=>[gd,Sh,_f].includes(f==null?void 0:f.itemType)).sort((f,m)=>up(f.itemValue,l)-up(m.itemValue,l)),d=u[u.length-1],p=d&&d.itemType===_f,h=u.filter(f=>!p||f.createdAt!==d.createdAt).map(f=>up(f.itemValue,l)).reduce((f,m)=>!f||m>f?m:f,void 0);if(up(a,l)>h){if(o!=null&&o.timeItems&&p){let m=d.createdAt;o.timeItems=o.timeItems.filter(g=>g.createdAt!==m)}let f={itemValue:WI(a,!0,!0),itemType:_f};return xl({duplicateValues:!0,removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:n,matchUpId:r,timeItem:f})}else return{error:gae}}function g4({removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:n,resumeTime:r,matchUpId:a,event:s}){if(!a)return{error:Ks};if(!tU(r))return{error:bu};let{matchUp:o}=ar({drawDefinition:i,event:s,matchUpId:a}),{scheduledDate:l}=iw({matchUp:o}),c=(o==null?void 0:o.timeItems)??[];if(c.reduce((f,m)=>m.itemType===Yf||f,void 0))return{error:_z};let u=c.filter(f=>[gd,Sh,_f].includes(f==null?void 0:f.itemType)).sort((f,m)=>up(f.itemValue,l)-up(m.itemValue,l)),d=u[u.length-1],p=d&&d.itemType===Sh,h=u.filter(f=>!p||f.createdAt!==d.createdAt).map(f=>up(f.itemValue,l)).reduce((f,m)=>!f||m>f?m:f,void 0);if(up(r,l)>h){if(o!=null&&o.timeItems&&p){let m=d.createdAt;o.timeItems=o.timeItems.filter(g=>g.createdAt!==m)}let f={itemValue:WI(r,!0,!0),itemType:Sh};return xl({duplicateValues:!0,removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:n,matchUpId:a,timeItem:f})}else return{error:uMe}}function OFe({drawDefinition:t,matchUpStatus:e,matchUpsMap:i,winningSide:n,dualMatchUp:r,tieFormat:a,structure:s,matchUp:o,event:l,score:c}){var p;let u=_t(r,void 0,!0);for(let h of(u==null?void 0:u.tieMatchUps)||[])h.matchUpId===o.matchUpId&&(h.winningSide=n,h.score=c,!ga({score:c})&&!e?Object.assign(h,{...oO}):e&&(h.matchUpStatus=e));a=a??((p=qs({matchUp:o,structure:s,drawDefinition:t,event:l}))==null?void 0:p.tieFormat);let{winningSide:d}=wC({matchUp:u,drawDefinition:t,matchUpsMap:i,structure:s,tieFormat:a,event:l});return{projectedWinningSide:d}}function LFe(t){var T;let{tournamentRecord:e,inContextMatchUp:i,structure:n,drawDefinition:r}=t,a=i.roundNumber,s=i.sides.find(w=>w.sideNumber===i.winningSide),o=i.sides.find(w=>w.sideNumber!==i.winningSide),{drawPosition:l,participantId:c}=s,{drawPosition:u,participantId:d}=o,p="swapWinnerLoser",{matchUps:h}=wn(t),f=h.filter(({drawPositions:w,roundNumber:S})=>(w==null?void 0:w.includes(l))&&S>a);ic({changeWinner:!0})&&console.log({existingWinnerSubsequentMatchUps:f}),f.forEach(w=>{var S,U;w.drawPositions=((S=w.drawPositions)==null?void 0:S.map(P=>P===l?u:P))||[],Ji({tournamentId:e==null?void 0:e.tournamentId,eventId:(U=t.event)==null?void 0:U.eventId,context:p,drawDefinition:r,matchUp:w})});let{stage:m,stageSequence:g}=n,v=r.structures.filter(({stage:w,stageSequence:S})=>w===m&&S>g).map(({structureId:w})=>w),{targetLinks:{loserTargetLink:y,winnerTargetLink:b}}=t.targetData,I=[y==null?void 0:y.target.structureId,(T=b==null?void 0:b.target)==null?void 0:T.structureId].filter(Boolean);return r.structures.filter(({stage:w,structureId:S})=>w!==m&&I.includes(S)).forEach(({stage:w,stageSequence:S,structureId:U})=>{v.includes(U)||v.push(U),r.structures.filter(({stage:P,stageSequence:E})=>P===w&&E>S).forEach(({structureId:P})=>{v.includes(P)||v.push(P)})}),r.structures.filter(({structureId:w})=>v.includes(w)).forEach(w=>{let{positionAssignments:S}=jn({structure:w}),U=S==null?void 0:S.find(({participantId:E})=>E===c),P=S==null?void 0:S.find(({participantId:E})=>E===d);U&&(U.participantId=d),P&&(P.participantId=c)}),vp({...t,context:p})}function LC(t){var V,j,B;let e="setMatchUpStatus";t.matchUpStatus&&[cn,Yr].includes(t.matchUpStatus)&&(t.score=void 0);let{allowChangePropagation:i,disableScoreValidation:n,tournamentRecords:r,tournamentRecord:a,disableAutoCalc:s,enableAutoCalc:o,drawDefinition:l,matchUpStatus:c,winningSide:u,matchUpId:d,event:p,score:h}=t;if(!l)return{error:Gt};if(c&&[zp,_l,sl,Vr].includes(c)&&u)return{error:Re,winningSide:u,matchUpStatus:c};if(![void 0,...Sq].includes(c))return he({result:{error:ZT},info:"matchUpStatus does not exist",stack:"setMatchUpStatus"});let f=Ts({drawDefinition:l}),{matchUps:m}=ua({nextMatchUps:!0,tournamentRecord:a,inContext:!0,drawDefinition:l,matchUpsMap:f,event:p}),g=f.drawMatchUps.find(z=>z.matchUpId===d),v=m==null?void 0:m.find(z=>z.matchUpId===d);if(!g||!m)return{error:_s};if((g.winningSide||u)&&c===mn)return{context:"Cannot have Bye with winningSide",error:kN,matchUpStatus:c};let y=v==null?void 0:v.structureId,{structure:b}=hi({drawDefinition:l,structureId:y}),I=Fr(Zn)(g.matchUpType),T=(V=v==null?void 0:v.drawPositions)==null?void 0:V.filter(Boolean),w=v==null?void 0:v.matchUpTieId,S=mo({matchUpId:w||d,inContextDrawMatchUps:m,drawDefinition:l});Object.assign(t,{inContextDrawMatchUps:m,inContextMatchUp:v,matchUpTieId:w,matchUpsMap:f,targetData:S,structure:b,matchUp:g});let U=ly(t),P;if(I){if(s)dn({extension:{name:uI,value:!0},element:g});else if(o){let z=g.winningSide,{winningSide:W,scoreStringSide1:Z,scoreStringSide2:K,set:Q}=wC({drawDefinition:l,matchUpsMap:f,structure:b,matchUp:g,event:p}),J={scoreStringSide1:Z,scoreStringSide2:K,sets:Q?[Q]:[]};if(P=W!==z,U&&P)return he({stack:"winningSideWithDownstreamDependencies",result:{error:sx},context:{winningSide:u,matchUp:g}});oo({name:uI,element:g}),Object.assign(t,{winningSide:W,dualWinningSideChange:P,projectedWinningSide:W,score:J})}SC({tournamentId:a==null?void 0:a.tournamentId,inContextDualMatchUp:v,eventId:p==null?void 0:p.eventId,dualMatchUp:g,drawDefinition:l})}if(I&&c&&[KI].includes(c))return{info:"Not supported for matchUpType: TEAM",error:Re};if(h&&!I&&!n){let z=g.matchUpFormat??(b==null?void 0:b.matchUpFormat)??(l==null?void 0:l.matchUpFormat)??(p==null?void 0:p.matchUpFormat),W=oW({existingMatchUpStatus:g.matchUpStatus,matchUpFormat:z,matchUpStatus:c,winningSide:u,score:h});if(W.error)return W}let E=((j=hn({policyTypes:[aE,zc],tournamentRecord:a,drawDefinition:l,event:p}))==null?void 0:j.appliedPolicies)??{};Xi(t.policyDefinitions)&&Object.assign(E,t.policyDefinitions);let R=$Fe({assignedDrawPositions:T,inContextMatchUp:v,appliedPolicies:E,drawDefinition:l,matchUpStatus:c,structure:b,matchUp:g});if(R!=null&&R.error)return R;let C=(v==null?void 0:v.stage)===ni&&v.finishingRound===1,M=C&&u,_=C&&g.winningSide&&!u&&(!t.matchUpStatus||t.matchUpStatus&&VV({matchUpStatus:t.matchUpStatus}))&&(!t.outcome||!ga({outcome:t.outcome})),A=M&&u!==g.winningSide&&g.winningSide;if(Object.assign(t,{qualifierAdvancing:M,qualifierChanging:A,removingQualifier:_,appliedPolicies:E}),w){let{matchUp:z}=ar({matchUpId:w,inContext:!0,drawDefinition:l,matchUpsMap:f,event:p});if(z){let W=(B=qs({matchUp:z,drawDefinition:l,structure:b,event:p}))==null?void 0:B.tieFormat,{projectedWinningSide:Z}=OFe({drawDefinition:l,matchUpStatus:c,dualMatchUp:z,matchUpsMap:f,winningSide:u,tieFormat:W,structure:b,matchUp:g,event:p,score:h}),K=z.winningSide;P=Z!==K;let Q=z._disableAutoCalc;Object.assign(t,{isCollectionMatchUp:!0,dualWinningSideChange:P,projectedWinningSide:Z,autoCalcDisabled:Q,matchUpTieId:w,dualMatchUp:z,tieFormat:W})}}let N=sC({matchUpStatus:c});if(!w){if(U&&!u&&(c&&VV({matchUpStatus:c})||c&&[Yr,sa].includes(c)))return{error:kN,activeDownstream:U,winningSide:u};if(u&&u===g.winningSide&&c&&!N)return{context:"winningSide must include directing matchUpStatus",error:kN,directingMatchUpStatus:N,matchUpStatus:c}}let{schedule:k}=t;if(k){let z=ZO({disableNotice:!0,tournamentRecords:r,tournamentRecord:a,drawDefinition:l,matchUpId:d,schedule:k});if(z.error)return z}let O=!I&&!P&&u&&g.winningSide&&g.winningSide!==u;if(i&&O&&g.roundPosition)return LFe(t);let $=u&&!w||t.projectedWinningSide;Xl({activeDownstream:U,matchUpWinner:$,method:e,winningSide:u});let F=!U&&xFe(t)||$&&FFe(t)||(N||t.autoCalcDisabled)&&tpe(t)||{error:Dae};return he({result:F,stack:e})}function FFe(t){let{matchUp:e,winningSide:i,matchUpTieId:n,dualWinningSideChange:r}=t;return i===e.winningSide||n&&!r?tpe(t):he({stack:"winningSideWithDownstreamDependencies",result:{error:sx},context:{winningSide:i,matchUp:e}})}function tpe(t){let{tournamentRecord:e,matchUp:i,event:n}=t,r=t.isCollectionMatchUp&&i.winningSide&&!t.winningSide&&!ga({score:t.score}),a=t.isCollectionMatchUp?t.matchUpStatus||r&&Vr||t.winningSide&&Lr||_l:t.matchUpStatus||Lr,s=t.removeScore||[zp,cn].includes(a)&&![_l,sl].includes(a),o=vp({...t,matchUpStatus:a,removeWinningSide:r,context:"sms",removeScore:s});if(o.error)return o;if(t.isCollectionMatchUp){let{matchUpTieId:l,drawDefinition:c,matchUpsMap:u}=t,d=Tm({appliedPolicies:t.appliedPolicies,matchUpId:l,tournamentRecord:e,drawDefinition:c,matchUpsMap:u,event:n});if(d.error)return d;Object.assign(o,{tieMatchUpResult:d})}return o}function $Fe({assignedDrawPositions:t,inContextMatchUp:e,appliedPolicies:i,drawDefinition:n,matchUpStatus:r,structure:a,matchUp:s}){var u,d;if(((u=i==null?void 0:i[zc])==null?void 0:u.requireParticipantsForScoring)===!1)return{...de};let o=(d=e==null?void 0:e.sides)==null?void 0:d.map(p=>p.participantId).filter(Boolean).length,l=s!=null&&s.sides?[]:jn({structureId:a==null?void 0:a.structureId,drawDefinition:n}).positionAssignments,c=o&&o===2||s.collectionId&&Vo({structure:a})&&o&&o>=1||(t==null?void 0:t.length)===2&&(l==null?void 0:l.filter(p=>t.includes(p.drawPosition)).every(p=>p.participantId));return r&&wq.includes(r)&&!c?he({info:"matchUpStatus requires assigned participants",context:{matchUpStatus:r,requiredParticipants:c},result:{error:ZT}}):{...de}}function ipe({tournamentRecord:t,drawDefinition:e,matchUpId:i,event:n}){if(!e)return{error:Gt};let{matchUp:r}=ar({drawDefinition:e,matchUpId:i,event:n});return(r==null?void 0:r.matchUpType)!==ec?{error:al}:LC({enableAutoCalc:!0,tournamentRecord:t,drawDefinition:e,matchUpId:i,event:n})}function npe({drawDefinition:t,event:e,matchUpId:i}){if(!t)return{error:Gt};if(!i)return{error:Ks};let{matchUp:n}=ar({drawDefinition:t,event:e,matchUpId:i});return n?oo({name:Ax,element:n}):{error:_s}}function BFe({substituteParticipantId:t,existingParticipantId:e,tournamentRecord:i,drawDefinition:n,sideNumber:r,matchUpId:a,event:s}){var h,f,m,g,v;let o="substituteParticipant";if(!n)return{error:Gt};if(!a)return{error:Ks};if(!e||!t)return he({result:{error:la},stack:o});let{matchUp:l}=ar({drawDefinition:n,matchUpId:a,event:s});if(!l)return{error:_s};if(!l.collectionId)return he({result:{error:al},stack:o});let c=Ts({drawDefinition:n}),{matchUps:u}=ua({tournamentParticipants:i==null?void 0:i.participants,inContext:!0,drawDefinition:n,matchUpsMap:c}),d=u==null?void 0:u.find(y=>y.matchUpId===a),p=(f=(h=u==null?void 0:u.find(y=>y.matchUpId===(d==null?void 0:d.matchUpTieId)))==null?void 0:h.sides)==null?void 0:f.find(y=>y.participant.individualParticipants.some(({participantId:b})=>b===e));return!p||r&&p.sideNumber!==r?{error:Md}:(v=(g=(m=p.participant)==null?void 0:m.individualParticipants)==null?void 0:g.map(Vi).filter(y=>y!==e))!=null&&v.includes(t)?c4({newParticipantId:t,tieMatchUpId:a,existingParticipantId:e,substitution:!0,tournamentRecord:i,drawDefinition:n,event:s}):he({result:{error:Md},stack:o})}function rpe(t){return BFe(t)}function ape({drawDefinition:t,matchUpId:e,event:i}){if(!t)return{error:Gt};let{matchUp:n}=ar({drawDefinition:t,matchUpId:e,event:i});return dn({extension:{name:uI,value:!0},element:n})}function spe(t){let e="setMatchUpFormat",i=Qt(t,[{tournamentRecord:!0},{[ds]:T=>Nl({matchUpFormat:T}),[rc]:NP,matchUpFormat:!0}]);if(i.error)return he({result:i,stack:e});let{tournamentRecord:n,drawDefinition:r,scheduledDates:a,stageSequences:s,matchUpFormat:o,structureId:l,eventType:c,matchUpId:u,eventId:d,stages:p,drawId:h,event:f,force:m}=t;if(a&&!Array.isArray(a))return he({result:{error:Re,scheduledDates:a},stack:e});if(c&&!Qk([Ep,Hc],c))return he({result:{error:_h},stack:e});let g=0,v=t.structureIds||l&&[l].filter(Boolean)||[],y=t.eventIds||d&&[d].filter(Boolean)||[],b=t.drawIds||h&&[h].filter(Boolean)||[];if((l||v!=null&&v.length)&&!r)return he({result:{error:Gt},stack:e});if(h&&u&&r){let T=dW({tournamentRecord:n,drawDefinition:r,matchUpFormat:o,structureIds:v,structureId:l,matchUpId:u});if(T.error)return T;g+=1}let I=T=>{let w=[];for(let S of T.structures||[]){if(Array.isArray(p)&&!p.includes(S.stage)||Array.isArray(s)&&!s.includes(S.stageSequence)||v!=null&&v.length&&!v.includes(S.structureId))continue;v!=null&&v.length&&S.matchUpFormat!==o&&(S.matchUpFormat=o,w.push(S.structureId),g+=1);let U=((m||a)&&wn({matchUpFilters:{matchUpStatuses:[Vr]},structure:S}).matchUps)??[],P=(a&&wn({matchUpFilters:{matchUpStatuses:[Vr]},contextFilters:{scheduledDates:a},afterRecoveryTimes:!1,inContext:!0,structure:S}).matchUps)??[];if(U!=null&&U.length){let E=P?P.map(Pa):U.map(Pa);for(let R of U)E.includes(R.matchUpId)&&(R.matchUpFormat=a!=null&&a.length?o:void 0,Ji({tournamentId:n==null?void 0:n.tournamentId,eventId:f==null?void 0:f.eventId,context:e,drawDefinition:T,matchUp:R}))}}return!w.length&&T.matchUpFormat!==o&&(T.matchUpFormat=o,g+=1),w};for(let T of(n==null?void 0:n.events)||[])if(!(y!=null&&y.length&&!y.includes(T.eventId)||c&&c!==T.eventType||c===na))if(Array.isArray(s)||Array.isArray(p)||v!=null&&v.length||b!=null&&b.length)for(let w of T.drawDefinitions||[]){if(Array.isArray(b)&&!b.includes(w.drawId))continue;let S=I(w);Hn({structureIds:S,drawDefinition:w})}else T.matchUpFormat!==o&&(T.matchUpFormat=o,g+=1);return g?{...de,modificationsCount:g}:{...de,info:eU}}function v4({inheritance:t=!0,tournamentRecord:e,drawDefinition:i,matchUpId:n,event:r}){var l,c;if(!i)return{error:Gt};let a=(l=ar({drawDefinition:i,matchUpId:n}))==null?void 0:l.matchUp;if(!(a!=null&&a.tieMatchUps))return{error:al};let s=(c=ar({inContext:!0,drawDefinition:i,matchUpId:n,event:r}))==null?void 0:c.matchUp,o=0;return((a==null?void 0:a.sides)||[]).forEach(u=>{u.lineUp&&delete u.lineUp}),((s==null?void 0:s.sides)||[]).forEach(u=>{if(o+=1,t===!1){let d=s==null?void 0:s.tieFormat,p=u.participantId;d&&p&&lw({drawDefinition:i,participantId:p,lineUp:[],tieFormat:d})}Ji({tournamentId:e==null?void 0:e.tournamentId,context:"resetMatchUpLineUps",eventId:r==null?void 0:r.eventId,drawDefinition:i,matchUp:a})}),{...de,modificationsCount:o}}function ope(t){let{matchUpFormat:e,matchUpStatus:i,winningSide:n,score:r,setTBlast:a}=t;if(!r)return{sets:[]};let s=r.sets||[],o=Uh({winnerFirst:!1,matchUpFormat:e,matchUpStatus:i,setTBlast:a,sets:s}),l=Uh({winnerFirst:!1,reversed:!0,matchUpFormat:e,matchUpStatus:i,setTBlast:a,sets:s}),c=Uh({matchUpFormat:e,matchUpStatus:i,winningSide:n,setTBlast:a,sets:s}),u=o===c?l:o;return n&&(o=n===1?c:u,l=n===2?c:u),{score:{sets:s,scoreStringSide1:o,scoreStringSide2:l}}}function FC(t){var y,b;let e=Qt(t,[{[Gp]:!0,[To]:!0}]);if(e.error)return e;let i=Jc(t);if(!t.drawDefinition){let I=t.tournamentRecord??(t.tournamentId&&i[t.tournamentId]);t.tournamentRecord||(t.tournamentRecord=I);let T=jo({eventId:t.eventId,drawId:t.drawId,tournamentRecord:I});if(T.error)return T;T.drawDefinition&&(t.drawDefinition=T.drawDefinition),t.event=T.event}let{disableScoreValidation:n,policyDefinitions:r,tournamentRecord:a,disableAutoCalc:s,enableAutoCalc:o,drawDefinition:l,matchUpId:c,schedule:u,event:d,notes:p}=t,h=t.matchUpFormat||((y=t.outcome)==null?void 0:y.matchUpFormat),{policy:f}=Fy({policyType:zc,tournamentRecord:a,event:d}),m=t.allowChangePropagation!==void 0&&t.allowChangePropagation||(f==null?void 0:f.allowChangePropagation)!==void 0&&f.allowChangePropagation||void 0,{outcome:g,setTBlast:v}=t;if(g!=null&&g.winningSide&&![1,2].includes(g.winningSide))return{error:rx};if(h){let I=dW({tournamentRecord:a,drawDefinition:l,matchUpFormat:h,matchUpId:c,event:d});if(I.error)return I}if((b=g==null?void 0:g.score)!=null&&b.sets&&!g.score.scoreStringSide1){let{score:I}=ope({...g,setTBlast:v});g.score=I,g.score.sets=g.score.sets.filter(T=>T.side1Score||T.side2Score||T.side1TiebreakScore||T.side2TiebreakScore)}return LC({matchUpStatusCodes:g==null?void 0:g.matchUpStatusCodes,matchUpStatus:g==null?void 0:g.matchUpStatus,winningSide:g==null?void 0:g.winningSide,allowChangePropagation:m,disableScoreValidation:n,score:g==null?void 0:g.score,tournamentRecords:i,policyDefinitions:r,tournamentRecord:a,disableAutoCalc:s,enableAutoCalc:o,drawDefinition:l,matchUpFormat:h,matchUpId:c,schedule:u,event:d,notes:p})}function lpe(t){if(!(t!=null&&t.outcomes))return{error:ai};if(!Array.isArray(t.outcomes))return{error:ai,info:{outcomes:t.outcomes}};let e=t.tournamentRecords||t.tournamentRecord&&{[t.tournamentRecord.tournamentId]:t.tournamentRecord}||{},i=t.outcomes??[],n=i.reduce((r,a)=>r.includes(a.tournamentId)?r:r.concat(a.tournamentId),[]);for(let r of n){let a=e[r];if(!a)return{error:ut};let s=i.filter(o=>o.tournamentId===r);if(s.length){let o=VFe({outcomes:s,tournamentRecord:a});if(o.error)return o}}return{...de}}function VFe(t){var s;let{tournamentRecords:e,tournamentRecord:i,outcomes:n,policyDefinitions:r}=t,a={};n.forEach(o=>{let{eventId:l}=o;a[l]||(a[l]=[]),a[l].push(o)});for(let o of Object.keys(a)){let{event:l}=jo({tournamentRecord:i,eventId:o});for(let c of a[o]){let{drawId:u}=c,d=(s=l==null?void 0:l.drawDefinitions)==null?void 0:s.find(p=>p.drawId===u);if(d&&u){let{matchUpFormat:p,matchUpId:h}=c,f=FC({schedule:c==null?void 0:c.schedule,tournamentRecords:e,policyDefinitions:r,tournamentRecord:i,drawDefinition:d,matchUpFormat:p,matchUpId:h,outcome:c,drawId:u,event:l});if(f.error)return f}}}return{...de}}function jFe({drawDefinition:t,matchUpId:e,outcome:i,matchUp:n}){var r,a;if(!n&&!t)return{error:Gt};if(!i)return{error:ai,info:"missing outcome"};if(!n&&!e)return{error:rl};if(!n){let s=ar({drawDefinition:t,matchUpId:e});if(s.error)return s;n=s.matchUp}return typeof i!="object"||!((r=i.score)!=null&&r.scoreStringSide1)||!((a=i.score)!=null&&a.scoreStringSide2)?{error:Re}:dn({element:n,extension:{name:Ax,value:i}})}function cpe(t){return jFe(t)}function y4(t){var m,g;let e="resetTieFormat",{drawDefinition:i,event:n,uuids:r}=t,a=Qt(t,[{[ba]:!0,[Gp]:!0}],e);if(a.error)return a;let s=bU(t,[{[nU]:Zh}]);if(s[Au])return s;let o=(m=t.tournamentRecord)==null?void 0:m.tournamentId,{matchUp:l,structure:c}=(s==null?void 0:s.matchUp)??{};if(!(l!=null&&l.tieMatchUps))return he({result:{error:al},info:"Must be a TEAM matchUp",stack:e});if(!l.tieFormat)return{...de};let u=(g=qs({structure:c,drawDefinition:i,event:n}))==null?void 0:g.tieFormat;if(!u)return he({result:{error:za},info:"No inherited tieFormat",stack:e});let d=[],p=[],h=[],f=[];for(let v of u.collectionDefinitions){let{matchUpCount:y,collectionId:b}=v;p.push(b);let I=(l.tieMatchUps||[]).filter(T=>T.collectionId===b);if(I.length>y)I.sort((T,w)=>(T.matchUpStatus===Vr?1:0)-(w.matchUpStatus===Vr?1:0)),h.push(...I.slice(0,y)),d.push(...I.slice(3).map(Pa));else if(h.push(...I),I.length<y){let T=y-I.length,w=bC({collectionDefinition:v,matchUpsLimit:T,matchUp:l,uuids:r});f.push(...w)}}for(let v of(l==null?void 0:l.tieMatchUps)||[])v.collectionId&&!p.includes(v.collectionId)&&d.push(v.matchUpId);return f.length&&(h.push(...f),dg({eventId:n==null?void 0:n.eventId,matchUps:f,drawDefinition:i,tournamentId:o})),d.length&&Im({matchUpIds:d,eventId:n==null?void 0:n.eventId,drawDefinition:i,tournamentId:o}),l&&(l.tieMatchUps=h,l.tieFormatId=void 0,l.tieFormat=void 0,Ji({structureId:c==null?void 0:c.structureId,eventId:n==null?void 0:n.eventId,context:e,drawDefinition:i,tournamentId:o,matchUp:l})),{...de,newMatchUps:f,deletedMatchUpIds:d}}function b4(t){var m,g,v;let{tournamentRecord:e,drawDefinition:i,matchUpId:n,event:r}=t,a="resetScorecard";if(!i)return he({result:{error:Gt},stack:a});if(!n)return he({result:{error:Ks},stack:a});if(!nr(n))return he({result:{error:Re,matchUpId:n},stack:a});let s=Ts({drawDefinition:i}),{matchUps:o}=ua({nextMatchUps:!0,inContext:!0,drawDefinition:i,matchUpsMap:s}),l=s.drawMatchUps.find(y=>y.matchUpId===n),c=o==null?void 0:o.find(y=>y.matchUpId===n);if(!l||!o)return{error:_s};if(l.matchUpType!==Al)return{error:al};let u=mo({inContextDrawMatchUps:o,drawDefinition:i,matchUpId:n}),d=c==null?void 0:c.structureId,{structure:p}=hi({drawDefinition:i,structureId:d});if(Object.assign(t,{inContextDrawMatchUps:o,inContextMatchUp:c,matchUpsMap:s,targetData:u,structure:p,matchUp:l}),ly(t))return{error:sx};if((m=l.tieMatchUps)!=null&&m.length)for(let y of l.tieMatchUps){let b=LC({matchUpId:y.matchUpId,matchUpTieId:n,winningSide:void 0,removeScore:!0,tournamentRecord:e,drawDefinition:i,event:r});if(b.error)return he({result:b,stack:a})}let h=(g=hn({tournamentRecord:e,drawDefinition:i,event:r}))==null?void 0:g.appliedPolicies,f=Tm({event:t.event,removeScore:!0,tournamentRecord:e,appliedPolicies:h,drawDefinition:i,matchUpsMap:s,matchUpId:n});if(f.error)return he({result:f,stack:a});if(t.tiebreakReset&&!f.tieFormatRemoved){let y=(v=qs({drawDefinition:i,structure:p,event:r}))==null?void 0:v.tieFormat;if(l.tieFormat&&y){let{matchUpCountDifference:b,descendantDifferences:I,ancestorDifferences:T,valueDifference:w}=Kf({descendant:l.tieFormat,ancestor:y});if(I.collectionIds.length===1&&!T.collectionIds.length&&!T.groupsCount&&b===1&&w===1){let S=y4({tournamentRecord:e,drawDefinition:i,matchUpId:n,event:r});if(S.error)return S}}}return{...de}}function upe(t){let e=Qt(t,[{[To]:!0,[Fg]:!0},{[FS]:{[VP]:!1,roundNumbers:!1},[Yse]:"At least one must be provided",[qo]:Rs}]);if(e.error)return e;let i=yce(t);if(i.error)return i;let{matchUpIds:n}=i,r=Fr(Al)(t.event.eventType),{tournamentRecord:a,drawDefinition:s,event:o}=t;for(let l of n){if(r){let u=b4({tiebreakReset:!0,tournamentRecord:a,drawDefinition:s,matchUpId:l,event:o});if(u.error||t.removeAssignments&&v4({inheritance:!1,drawDefinition:s,matchUpId:l}).error)return u}let c=LC({winningSide:void 0,removeScore:!0,tournamentRecord:a,drawDefinition:s,matchUpId:l,event:o});if(c.error)return c;if(t.removeAssignments){let u=u4({...t,matchUpId:l});if(u.error)return u}}return{...de}}function GFe({tournamentRecord:t,drawDefinition:e,finishingOrder:i}){var y;if(!e)return{error:Gt};let n="setOrderOfFinish";if(!Array.isArray(i))return he({info:sy("finishingOrder"),result:{error:Re},stack:n});let{completedMatchUps:r,matchUpsMap:a}=dU({inContext:!0,drawDefinition:e}),s=(r==null?void 0:r.map(Pa))??[],o=i.map(Pa),{matchUpTypes:l,roundNumbers:c,structureIds:u,matchUpTieIds:d}=(r??[]).filter(({matchUpId:b})=>o.includes(b)).reduce((b,I)=>{let{matchUpTieId:T,matchUpType:w,roundNumber:S,structureId:U}=I;return b.matchUpTypes.includes(w)||b.matchUpTypes.push(w),b.roundNumbers.includes(S)||b.roundNumbers.push(S),b.structureIds.includes(U)||b.structureIds.push(U),b.matchUpTieIds.includes(T)||b.matchUpTieIds.push(T),b},{matchUpTypes:[],roundNumbers:[],structureIds:[],matchUpTieIds:[]});if(l.length>1||d.length>1||c.length>1||u.length>1)return he({info:"matchUpType, structureId and roundNumber must be equivalent",result:{error:Re},stack:n});let p,h,f={},m=[],g=[];if(!i.every(({orderOfFinish:b,matchUpId:I})=>(m.push(I),b&&g.push(b),f[I]=b,p=s.includes(I),h=b===void 0||Ii(b)&&Math.floor(b)>0,p&&h)))return he({result:{error:p?Re:ZT},info:!p&&"matchUps must be completed"||!h&&"orderOfFinish must be integer > 0 or undefined"||void 0,stack:n});let v=r==null?void 0:r.filter(b=>b.structureId===u[0]&&b.roundNumber===c[0]&&b.matchUpType===l[0]&&b.matchUpTieId===d[0]&&!m.includes(b.matchUpId));for(let b of v??[]){let{orderOfFinish:I}=b||{};if(I){if(!Ii(I))return he({context:{orderOfFinish:I,matchUp:b},result:{error:Re},stack:n});g.push(I)}}if(mre(g).length!==g.length||Math.max(...g)>g.length)return he({info:"Values not unique or greater than expected number of values",result:{error:Re},stack:n});if(u.length){let b=Xx({matchUpFilters:{matchUpIds:o},structureId:u[0],drawDefinition:e,matchUpsMap:a});if(b.error)return he({result:b,stack:n});(y=b.completedMatchUps)==null||y.forEach(I=>{I.orderOfFinish=f[I.matchUpId],Ji({tournamentId:t.tournamentId,context:"setOrderOfFinish",drawDefinition:e,matchUp:I})})}return{...de}}function dpe(t){return GFe(t)}function ppe(t){var v,y,b,I;let{tournamentRecord:e,drawDefinition:i,matchUpId:n,lineUps:r,event:a}=t,s="applyLineUps",o=Qt(t,[{[ba]:!0,[To]:!0,[Gp]:!0},{lineUps:!0,[qo]:Rs}],s);if(o.error)return o;let l=e.participants||[],c=ar({tournamentParticipants:l,inContext:!0,drawDefinition:i,matchUpId:n});if(c.error)return c;if(!c.matchUp)return{error:_s};let{matchUp:u,structure:d}=c,{drawPositions:p,matchUpType:h}=u;if(h!==Zn)return{error:al};if(!(p!=null&&p.length))return{error:RP};let f=(v=qs({matchUp:u,drawDefinition:i,structure:d,event:a}))==null?void 0:v.tieFormat,m={};for(let T of r){if(!Array.isArray(T))return{error:Re,lineUp:T};let w={},S=[];for(let C of T){if(typeof C!="object")return{error:Re,lineUpAssignment:C};let{participantId:M,collectionAssignments:_=[]}=C;if(!Array.isArray(_))return{error:Re,collectionAssignments:_};let A=l.find(k=>k.participantId===M);if(!A)return{error:xr};if(A.participantType!==ji)return{error:Nd};let N=(b=(y=u.sides)==null?void 0:y.find(k=>{var O,$;return($=(O=k.participant)==null?void 0:O.individualParticipantIds)==null?void 0:$.includes(M)}))==null?void 0:b.sideNumber;N&&S.push(N);for(let k of _){if(typeof k!="object")return{error:Re,collectionAssignment:k};let{collectionId:O,collectionPosition:$}=k,F=(I=f==null?void 0:f.collectionDefinitions)==null?void 0:I.find(B=>B.collectionId===O);if(!F)return{error:Re,collectionId:O};let V=`${O}-${$}`;w[V]||(w[V]=[]);let j=w[V].length;if(Fr(xn)(F.matchUpType)&&j||F.matchUpType===Mn&&j>1)return{info:"Excessive collectionPosition assignments",error:Re};w[V].push(M)}}let U=Object.values(w);for(let C of U)if(C.length===2){let{participant:M}=Yu({tournamentParticipants:l,participantIds:C});if(!M){let _=Np({participant:{participantType:Ni,participantRole:ms,individualParticipantIds:C},pairOverride:!0,tournamentRecord:e});if(_.error)return _}}let P=Ml(S),E=(P[1]||0)>(P[2]||0)&&1||(P[2]||0)>(P[1]||0)&&2||void 0,R=Object.keys(m).map(C=>parseInt(C));E&&!R.includes(E)&&(m[E]=T)}if(!Object.keys(m).length)return{error:Fz};if(c=ar({drawDefinition:i,matchUpId:n}),c.error)return c;if(!c.matchUp)return{error:_s};let{matchUp:g}=c;g.sides||(g.sides=[]);for(let T of[1,2]){let w=g.sides.find(U=>U.sideNumber===T),S=m[T];if(S)w?w.lineUp=S:g.sides.push({lineUp:S,sideNumber:T});else continue}return Ji({tournamentId:e==null?void 0:e.tournamentId,context:s,drawDefinition:i,matchUp:g}),{...de}}var XO={};Li(XO,{anonymizeTournamentRecord:()=>xpe,generate:()=>hpe,generateEventWithDraw:()=>iL,generateOutcome:()=>P4,generateOutcomeFromScoreString:()=>I4,generateParticipants:()=>EU,generateTournamentRecord:()=>_pe,modifyTournamentRecord:()=>Ope,mutate:()=>kpe});var hpe={};Li(hpe,{generateEventWithDraw:()=>iL,generateOutcome:()=>P4,generateOutcomeFromScoreString:()=>I4,generateParticipants:()=>EU,generateTournamentRecord:()=>_pe});function I4(t){let{matchUpFormat:e,matchUpStatus:i,winningSide:n,scoreString:r,setTBlast:a}=t;if(!r)return{outcome:{...oO,winningSide:n,matchUpStatus:i}};if(n&&![1,2,void 0].includes(n))return{error:Re,winningSide:n};let s=r&&r_({scoreString:r}),o={},l=Uh({sets:s,matchUpFormat:e,setTBlast:a}),c=Uh({sets:s,reversed:!0,matchUpFormat:e,setTBlast:a});return n===2?(o.scoreStringSide1=c,o.scoreStringSide2=l):(o.scoreStringSide1=l,o.scoreStringSide2=c),o.sets=r_({scoreString:o.scoreStringSide1}),Kt({outcome:{matchUpStatus:i,winningSide:n,score:o}})}function w4({matchUpScheduleTimes:t,matchUpDependencies:e,allDateMatchUpIds:i,matchUp:n}){var a;let r=(((a=e==null?void 0:e[n.matchUpId])==null?void 0:a.matchUpIds)||[]).filter(s=>i.includes(s)).filter(s=>!t[s]);return{dependenciesScheduled:!(r!=null&&r.length),remainingDependencies:r}}function $C({individualParticipantProfiles:t,participantId:e}){t[e]||(t[e]={typeChangeTimeAfterRecovery:void 0,timeAfterRecovery:void 0,priorMatchUpType:void 0,potentialRecovery:{},potentialCounted:{},potentialBookings:{},bookings:[],counters:{}})}function HFe({individualParticipantProfiles:t,recoveryValue:e,participantId:i,scheduleTime:n,drawId:r}){t[i].potentialRecovery[r]||(t[i].potentialRecovery[r]=[]),t[i].potentialRecovery[r].push(e),t[i].potentialBookings[r]||(t[i].potentialBookings[r]=[]),t[i].potentialBookings[r].push({timeAfterRecovery:e,scheduleTime:n})}function IE({matchUpPotentialParticipantIds:t,individualParticipantProfiles:e,typeChangeRecoveryMinutes:i,averageMatchUpMinutes:n=0,matchUpNotBeforeTimes:r,matchUpDependencies:a,recoveryMinutes:s=0,scheduleTime:o,matchUp:l}){var f,m;let c=rr((f=l==null?void 0:l.schedule)==null?void 0:f.endTime),u=c?il(c,ui(s)):il(o,ui(n)+ui(s)),d=i&&(c?il(rr(c),i):il(o,ui(n)+ui(i))),p=((m=a==null?void 0:a[l.matchUpId])==null?void 0:m.participantIds)||[],h=(l.roundPosition&&t[l.matchUpId]||[]).flat();p.forEach(g=>{$C({individualParticipantProfiles:e,participantId:g});let v=e[g].priorMatchUpType!==l.matchUpType&&d||u;h.includes(g)?HFe({individualParticipantProfiles:e,drawId:l.drawId,recoveryValue:v,participantId:g,scheduleTime:o}):(e[g].timeAfterRecovery=v,e[g].bookings.push({scheduleTime:o,timeAfterRecovery:v}))}),YS({matchUpPotentialParticipantIds:t,matchUpNotBeforeTimes:r,timeAfterRecovery:u,matchUp:l})}function fpe({matchUpScheduleTimes:t,matchUpDependencies:e,scheduleTime:i,matchUpId:n,details:r}){var u,d,p,h,f;let a,s=(d=(u=r.minutesMap)==null?void 0:u[n])==null?void 0:d.recoveryMinutes,o=(((h=(p=r.minutesMap)==null?void 0:p[n])==null?void 0:h.averageMinutes)||0)+(s||0),l=il(i,o),c=((f=e==null?void 0:e[n])==null?void 0:f.dependentMatchUpIds)||[];if(c.length){let m=c.reduce((g,v)=>{let y=t[v];if(!y)return g;let b={scheduleTime:y,matchUpId:v};return y&&!g.matchUpId||an(y)<an(g.scheduleTime)?b:g},{});m.scheduleTime&&an(l)>an(m.scheduleTime)&&(a=m)}return{scheduledDependent:a}}function zFe(t){let{sides:e,matchUpType:i}=t||{};return(e||[]).map(n=>{var r;return i===Mn&&(((r=n==null?void 0:n.participant)==null?void 0:r.individualParticipants)||[])||(n==null?void 0:n.participant)&&[n.participant]||[]}).flat()}var BC="DO_NOT_SCHEDULE",mpe={DO_NOT_SCHEDULE:BC};function S4({averageMatchUpMinutes:t=90,requestConflicts:e={},potentials:i=!0,personRequests:n,scheduleTime:r,scheduleDate:a,matchUp:s}){let o=zFe(s).map(({person:h})=>h==null?void 0:h.personId);if(i){let h=((s==null?void 0:s.potentialParticipants)||[]).flat().map(({person:f})=>f==null?void 0:f.personId);o.push(...h)}let l=o.map(h=>{var f;return(f=n[h])==null?void 0:f.map(m=>({...m,personId:h}))}).filter(Boolean).flat().filter(h=>h.requestType===BC&&kh(a,h.date)),c=[],u=s==null?void 0:s.matchUpId,d=Zr(rr(r),Ri(a)),p=rr(Xz(d,t).toISOString());for(let h of l){let{requestId:f,startTime:m,endTime:g}=h;(r>m&&r<g||p>m&&p<g)&&(c.push({matchUpId:u,request:h,scheduleTime:r}),e[f]?(e[f].scheduleTimes.includes(r)||e[f].scheduleTimes.push(r),e[f].matchUpIds.includes(u)||e[f].matchUpIds.push(u)):e[f]={request:h,scheduleTimes:[r],matchUpIds:[u]})}return{conflicts:c}}function pj({matchUpPotentialParticipantIds:t,individualParticipantProfiles:e,matchUp:i,value:n}){let{matchUpType:r}=i,{individualParticipantIds:a}=Bx(i),s=(t[i.matchUpId]||[]).filter(o=>!ho(o,a)).flat();[...a,...s].forEach(o=>{if($C({individualParticipantProfiles:e,participantId:o}),!e[o].potentialCounted[i.drawId]){let l=e[o].counters;l[r]?l[r]+=n:n>0&&(l[r]=n),l[ku]?l[ku]+=n:n>0&&(l[ku]=n),s.includes(o)&&(e[o].potentialCounted[i.drawId]=!0)}})}function qFe({matchUpPotentialParticipantIds:t,individualParticipantProfiles:e,dateScheduledMatchUpIds:i,greatestAverageMinutes:n,dateScheduledMatchUps:r,matchUpNotBeforeTimes:a,matchUpScheduleTimes:s,matchUpDependencies:o,clearScheduleDates:l,scheduleDate:c,minutesMap:u,matchUps:d}){var m,g;let p=[];i||(r=d==null?void 0:d.filter(v=>{let y=v.schedule||{},b=v.matchUpStatus===mn;return b&&p.push({tournamentId:v.tournamentId,matchUpId:v.matchUpId}),!b&&AC({schedule:y})&&(!c||v.schedule.scheduledDate===c)}),i=r.map(Pa));let h=Array.isArray(l)?l.includes(c):l,f=h?[]:d.filter(({matchUpId:v})=>i.includes(v));for(let v of f){pj({matchUpPotentialParticipantIds:t,individualParticipantProfiles:e,value:1,matchUp:v});let y=(m=v.schedule)==null?void 0:m.scheduledTime;if(y){s[v.matchUpId]=y;let b=(g=u==null?void 0:u[v.matchUpId])==null?void 0:g.recoveryMinutes;IE({individualParticipantProfiles:e,matchUpPotentialParticipantIds:t,matchUpNotBeforeTimes:a,matchUpDependencies:o,averageMatchUpMinutes:n,recoveryMinutes:b,scheduleTime:y,matchUp:v})}}return{dateScheduledMatchUpIds:i,byeScheduledMatchUpDetails:p,dateScheduledMatchUps:r,clearDate:h}}function JO({defaultRecoveryMinutes:t=0,averageMatchUpMinutes:e=90,dateScheduledMatchUps:i,tournamentRecords:n,venueIds:r=[],periodLength:a,scheduleDate:s,matchUps:o}){if(typeof n!="object")return{error:wr};if(!tu(o)&&!Array.isArray(i))return{error:ym};a=a??HO({recoveryMinutes:t,averageMatchUpMinutes:e});let l=Object.assign({},...Object.values(n).map(d=>(d.events??[]).map(p=>{let{scheduleTiming:h}=YP({tournamentRecord:d,event:p});return{[p.eventId]:{event:p,scheduleTiming:h}}})).flat()),c={averageTimes:[{minutes:{default:e}}],recoveryTimes:[{minutes:{default:t}}]};i||(i=o==null?void 0:o.filter(d=>{let p=d.schedule;return AC({schedule:p})&&(!s||d.schedule.scheduledDate===s)}));let u=i==null?void 0:i.filter(d=>(!r.length||r.includes(d.schedule.venueId))&&d.matchUpStatus!==mn);return{bookings:u==null?void 0:u.map(({eventId:d,schedule:p,matchUpFormat:h})=>{let{event:f,scheduleTiming:m}=l[d],g=f==null?void 0:f.eventType,v={...m,defaultTiming:c,matchUpFormat:h},{averageMinutes:y,recoveryMinutes:b}=Wx({timingDetails:v,eventType:g}),{courtId:I,venueId:T}=p,w=rr(p.scheduledTime),S=il(w,y);return{recoveryMinutes:b,averageMinutes:y,periodLength:a,startTime:w,courtId:I,endTime:S,venueId:T}}).filter(Boolean),relevantMatchUps:u,dateScheduledMatchUps:i}}function WFe({calculateStartTimeFromCourts:t=!0,remainingScheduleTimes:e,defaultRecoveryMinutes:i,averageMatchUpMinutes:n,clearScheduleDates:r,tournamentRecords:a,tournamentRecord:s,periodLength:o,scheduleDate:l,startTime:c,venueIds:u,matchUps:d,endTime:p}){if(s&&!a&&(a={[s.tournamentId]:s}),typeof a!="object"||!Object.keys(a).length)return{error:wr};o=o??HO({recoveryMinutes:i,averageMatchUpMinutes:n});let{courts:h,venues:f}=Um({dates:[l],ignoreDisabled:!0,tournamentRecords:a}),m=(h==null?void 0:h.filter(T=>!u||u.includes(T.venueId)))??[];c=c??KS({courts:m,scheduleDate:l,startTime:!0}),p=p??KS({courts:m,scheduleDate:l,endTime:!0});let{bookings:g,dateScheduledMatchUps:v}=JO({defaultRecoveryMinutes:i,averageMatchUpMinutes:n,tournamentRecords:a,scheduleDate:l,periodLength:o,venueIds:u,matchUps:d}),y={calculateStartTimeFromCourts:t,remainingScheduleTimes:e,averageMatchUpMinutes:n,clearScheduleDates:r,date:l,periodLength:o,startTime:c,bookings:g,endTime:p,courts:m},{scheduleTimes:b}=r4(y),I=(u==null?void 0:u.length)===1&&u[0]||(f==null?void 0:f.length)===1&&f[0].venueId||void 0;return{dateScheduledMatchUpIds:v==null?void 0:v.map(kl("matchUpId")),dateScheduledMatchUps:v,scheduleTimes:b,venueId:I}}function YFe({scheduledRoundsDetails:t,greatestAverageMinutes:e,garmanSinglePass:i}){let n=[],r=[],a,s,o,l;for(let c of t.filter(Boolean))l||(l=c.hash),(c.hash===l||i)&&(r=r.concat(c.matchUpIds)),c.hash!==l&&!i&&(l=c.hash,n.push({averageMinutes:o,recoveryMinutes:s,roundPeriodLength:a,matchUpIds:r}),r=c.matchUpIds),o=i?e:c.averageMinutes,s=c.recoveryMinutes,a=c.roundPeriodLength;return r.length&&n.push({matchUpIds:r,roundPeriodLength:a,recoveryMinutes:s,averageMinutes:o}),{groupedRounds:n}}function gpe({matchUpPotentialParticipantIds:t,individualParticipantProfiles:e,scheduleCompletedMatchUps:i,containedStructureIds:n,matchUpNotBeforeTimes:r,matchUpScheduleTimes:a,matchUpDependencies:s,clearScheduleDates:o,tournamentRecords:l,periodLength:c,scheduleDate:u,useGarman:d,matchUps:p,courts:h,venues:f}){var b;let m={},g=[],v=[],y=[];for(let I of f){let{rounds:T=[],venueId:w}=I,{scheduledRoundsDetails:S,greatestAverageMinutes:U,orderedMatchUpIds:P,minutesMap:E}=MC({scheduleCompletedMatchUps:i,containedStructureIds:n,tournamentRecords:l,periodLength:c,matchUps:p,rounds:T});y.push(...P??[]);let{groupedRounds:R}=YFe({scheduledRoundsDetails:S,greatestAverageMinutes:U,garmanSinglePass:!0}),C,M=[];d&&({scheduleTimes:M,dateScheduledMatchUpIds:C}=WFe({averageMatchUpMinutes:(b=R[0])==null?void 0:b.averageMinutes,scheduleDate:Ri(u),venueIds:[I.venueId],clearScheduleDates:o,tournamentRecords:l,periodLength:c,matchUps:p}));let _=qFe({matchUpPotentialParticipantIds:t,individualParticipantProfiles:e,dateScheduledMatchUpIds:C,greatestAverageMinutes:U,matchUpNotBeforeTimes:r,matchUpScheduleTimes:a,matchUpDependencies:s,clearScheduleDates:o,scheduleDate:u,minutesMap:E,matchUps:p});({dateScheduledMatchUpIds:C}=_);let A=_,{byeScheduledMatchUpDetails:N,clearDate:k}=_;N!=null&&N.length&&v.push(...N);let{matchUpsToSchedule:O,matchUpMap:$}=RO({matchUpPotentialParticipantIds:t,scheduleCompletedMatchUps:i,dateScheduledMatchUpIds:C,matchUpNotBeforeTimes:r,matchUpScheduleTimes:a,orderedMatchUpIds:P,clearDate:k,matchUps:p}),F=h.filter(V=>V.venueId===w);m[w]={previousRemainingScheduleTimes:[],courtsCount:F.length,greatestAverageMinutes:U,scheduledRoundsDetails:S,dateScheduledMatchUps:A,matchUpsToSchedule:O,scheduleTimes:M,groupedRounds:R,venueCourts:F,minutesMap:E,matchUpMap:$},o||g.push(...C)}return{allDateScheduledByeMatchUpDetails:v,allDateScheduledMatchUpIds:g,venueScheduledRoundDetails:m,allDateMatchUpIds:y}}function KFe(t,e){let i=an(t.scheduleTime),n=an(t.timeAfterRecovery),r=an(e.scheduleTime),a=an(e.timeAfterRecovery),s=i===r||n===a,o=i>r&&i<a,l=r>i&&r<n,c=n>r&&n<a,u=a>i&&a<n;return Kt({hasOverlap:s||o||c||l||u,startAisContained:o,endAisContained:c,startBisContained:l,endBisContained:u},!0)}function T4({individualParticipantProfiles:t,matchUpNotBeforeTimes:e,matchUpDependencies:i,scheduleTime:n,matchUp:r,details:a}){var p,h,f,m,g;let s=(((p=i==null?void 0:i[r.matchUpId])==null?void 0:p.participantIds)||[]).flat(),o=((f=(h=a==null?void 0:a.minutesMap)==null?void 0:h[r.matchUpId])==null?void 0:f.averageMinutes)||0,l=((g=(m=a==null?void 0:a.minutesMap)==null?void 0:m[r.matchUpId])==null?void 0:g.recoveryMinutes)||0,c=s.every(v=>{var T;$C({individualParticipantProfiles:t,participantId:v});let y=t[v];if(!y.timeAfterRecovery)return!0;let b=rr((T=r==null?void 0:r.schedule)==null?void 0:T.endTime),I=b?il(b,ui(l)):il(n,ui(o)+ui(l));return![...Object.keys(y.potentialBookings).filter(w=>w!==r.drawId).map(w=>y.potentialBookings[w]).flat(),...y.bookings].find(w=>KFe({scheduleTime:n,timeAfterRecovery:I},w).hasOverlap)}),u=e[r.matchUpId],d=(u?xP(Zr(u),Zr(n),!1):0)>=0;return{enoughTime:c&&d}}function vpe({autoSchedulingAudit:t,tournamentRecords:e}){var s;Si({topic:Af,payload:t});let i=o=>o?Object.values(o).reduce((l,c)=>l+c.length||0,0):0,n=((t==null?void 0:t.schedulingProfile)||[]).reduce((o,l)=>o+l.venues.reduce((c,u)=>c+u.rounds.length,0),0),r={scheduledDatesCount:(s=t.scheduledDates)==null?void 0:s.length,noTimeMatchUpIdsCount:i(t==null?void 0:t.noTimeMatchUpIds),scheduledMatchUpIdsCount:i(t==null?void 0:t.scheduledMatchUpIds),overLimitMatchUpIdsCount:i(t==null?void 0:t.overLimitMatchUpIds),requestConflictsCount:i(t==null?void 0:t.requestConflicts),profileRoundsCount:n},a={itemType:lj,itemValue:r};for(let o of Object.values(e)){let l=o.tournamentId;fx(Af)?Si({payload:{type:lj,tournamentId:l,detail:r},topic:Af}):TC({tournamentRecord:o,timeItem:a})}}function U4({matchUpPotentialParticipantIds:t,individualParticipantProfiles:e,matchUpDailyLimits:i={},matchUp:n}){let{enteredIndividualParticipantIds:r}=Bx(n),{matchUpId:a,matchUpType:s}=n,o=(n.roundPosition&&t[a]||[]).flat(),l=Ei(r.concat(...o));return l.forEach(c=>{$C({individualParticipantProfiles:e,participantId:c})}),{participantIdsAtLimit:l.filter(c=>{let u=e[c];if(u)return[s,ku].find(d=>{var f;let p=((f=u.counters)==null?void 0:f[d])||0,h=i[d]||0;return p&&h&&p>=h})}),relevantParticipantIds:l}}function wE({scheduleCompletedMatchUps:t=!1,scheduleByeMatchUps:e=!1,errorOnAnachronism:i=!1,checkChronology:n=!0,matchUpDependencies:r,removePriorValues:a,tournamentRecords:s,tournamentRecord:o,matchUpDetails:l,matchUpIds:c,schedule:u}){var g,v,y;if(!o)return{error:ut};if(!l&&(!c||!Array.isArray(c)))return{error:BI};if(!l&&(!u||typeof u!="object"))return{error:bae};let d,p=[],h=0;if(n&&!r){let b=rd({tournamentRecords:s,tournamentRecord:o});r=b.matchUpDependencies,d=b.matchUps}d||(d=((g=Wa({tournamentRecord:o}))==null?void 0:g.matchUps)??[]);let f=d.reduce((b,I)=>{let{matchUpId:T,drawId:w,matchUpStatus:S}=I;return(e||S!==mn)&&(t||!ca.includes(S))&&(b[w]?b[w].push(T):b[w]=[T]),b},{}),m=l==null?void 0:l.map(b=>b.matchUpId);for(let b of Object.keys(f)){let{drawDefinition:I}=qg({tournamentRecord:o,drawId:b});if(!I)continue;let T=f[b].filter(S=>(c==null?void 0:c.includes(S))??(m==null?void 0:m.includes(S))),w=lo({inContext:!1,drawDefinition:I}).matchUps;for(let S of T){let U=((v=l==null?void 0:l.find(E=>E.matchUpId===S))==null?void 0:v.schedule)||u,P=ZO({schedule:U,matchUpDependencies:r,errorOnAnachronism:i,removePriorValues:a,inContextMatchUps:d,tournamentRecords:s,tournamentRecord:o,checkChronology:n,drawDefinition:I,drawMatchUps:w,matchUpId:S});if((y=P==null?void 0:P.warnings)!=null&&y.length&&p.push(...P.warnings),P!=null&&P.success&&(h+=1),P.error)return P}}return p.length?{...de,scheduled:h,warnings:p}:{...de,scheduled:h}}function VC(t){var f;let{scheduleCompletedMatchUps:e=!1,scheduleByeMatchUps:i=!1,errorOnAnachronism:n,matchUpContextIds:r,removePriorValues:a,tournamentRecords:s,checkChronology:o,matchUpDetails:l,schedule:c}=t;if(t.matchUpIds&&!r)return wE(t);let u=Qt(t,[{[ks]:!0},{[FS]:{matchUpContextIds:!1,matchUpDetails:!1},[rc]:Re,[qo]:Rs}]);if(u.error)return u;if((!l||r)&&!c)return{error:ai,info:"schedule is required"};let d=[],p=0,{matchUpDependencies:h}=rd({tournamentRecords:s});for(let m of Object.values(s)){let{tournamentId:g}=m,v=r==null?void 0:r.filter(b=>b.tournamentId===g).map(Pa),y=l==null?void 0:l.filter(b=>(b==null?void 0:b.tournamentId)===g);if(v!=null&&v.length||y!=null&&y.length){let b=wE({matchUpDetails:y,scheduleCompletedMatchUps:e,scheduleByeMatchUps:i,matchUpDependencies:h,errorOnAnachronism:n,removePriorValues:a,tournamentRecords:s,tournamentRecord:m,checkChronology:o,matchUpIds:v,schedule:c});if((f=b.warnings)!=null&&f.length&&d.push(...b.warnings),b.scheduled&&(p+=b.scheduled),b.error)return b}}return d.length?{...de,scheduled:p,warnings:d}:{...de,scheduled:p}}function ZFe({schedulingProfileModifications:t,checkPotentialRequestConflicts:e,scheduleCompletedMatchUps:i,schedulingProfileIssues:n,dateSchedulingProfiles:r,containedStructureIds:a,matchUpDependencies:s,matchUpDailyLimits:o,clearScheduleDates:l,tournamentRecords:c,schedulingProfile:u,personRequests:d,periodLength:p,matchUps:h,courts:f,dryRun:m}){var C,M,_,A,N,k,O;let g={},v={},y={},b={},I={},T={},w={},S={},U={},P={};for(let $ of r){let F=Ri($==null?void 0:$.scheduleDate),V=($==null?void 0:$.venues)||[],j={},B={},z=(oe,te)=>{oe.forEach(le=>{let ne=B[le].counters;ne[te]?ne[te]+=1:ne[te]=1,ne[ku]?ne[ku]+=1:ne[ku]=1})};y[F]={},b[F]={},g[F]={},v[F]={},w[F]=[],S[F]=[],U[F]=[],P[F]=[];let W={};h.forEach(oe=>{var te;(te=oe.schedule)!=null&&te.scheduledDate&&kh(F,Ri(oe.schedule.scheduledDate))&&YS({matchUpPotentialParticipantIds:j,matchUpNotBeforeTimes:W,matchUp:oe})});let{allDateScheduledByeMatchUpDetails:Z,venueScheduledRoundDetails:K,allDateMatchUpIds:Q}=gpe({matchUpPotentialParticipantIds:j,individualParticipantProfiles:B,scheduleCompletedMatchUps:i,containedStructureIds:a,matchUpNotBeforeTimes:W,matchUpScheduleTimes:T,matchUpDependencies:s,clearScheduleDates:l,tournamentRecords:c,useGarman:!0,periodLength:p,scheduleDate:F,matchUps:h,courts:f,venues:V}),J=10,se=0,ie,ce=10;for(;!ie;){for(let{venueId:oe}of V){let te=0,le=K[oe];for(;le.courtsCount&&((C=le.scheduleTimes)!=null&&C.length)&&((M=le.matchUpsToSchedule)!=null&&M.length)&&te<=le.courtsCount;){let{scheduleTime:ne,attempts:me=0}=le.scheduleTimes.shift(),be=le.matchUpsToSchedule.find(Se=>{var at,ct;let{matchUpId:we,matchUpType:ze}=Se,{participantIdsAtLimit:Qe,relevantParticipantIds:ke}=U4({matchUpPotentialParticipantIds:j,individualParticipantProfiles:B,matchUpDailyLimits:o,matchUp:Se});if(Qe.length)return S[F].includes(we)||S[F].push(we),!1;let{scheduledDependent:yt}=fpe({matchUpScheduleTimes:T,matchUpDependencies:s,scheduleTime:ne,matchUpId:we,details:le});if(yt)return!1;let{dependenciesScheduled:lt,remainingDependencies:Ct}=w4({matchUpScheduleTimes:T,matchUpDependencies:s,allDateMatchUpIds:Q,matchUp:Se});if(!lt)return b[F][we]||(b[F][we]=[]),b[F][we].push({scheduleTime:ne,remainingDependencies:Ct}),!1;let{enoughTime:Nt}=T4({individualParticipantProfiles:B,matchUpNotBeforeTimes:W,matchUpDependencies:s,scheduleTime:ne,details:le,matchUp:Se});if(!Nt)return y[F][we]||(y[F][we]=[]),y[F][we].push({scheduleTime:ne}),!1;let Ce=le.greatestAverageMinutes,{conflicts:Ge}=S4({potentials:e,averageMatchUpMinutes:Ce,requestConflicts:P,personRequests:d,scheduleTime:ne,scheduleDate:F,matchUp:Se});if(Ge!=null&&Ge.length)return I[F]||(I[F]=[]),I[F].push(...Ge),!1;z(ke,ze);let $e=(ct=(at=le.minutesMap)==null?void 0:at[we])==null?void 0:ct.recoveryMinutes;return IE({matchUpPotentialParticipantIds:j,individualParticipantProfiles:B,matchUpNotBeforeTimes:W,averageMatchUpMinutes:Ce,matchUpDependencies:s,recoveryMinutes:$e,scheduleTime:ne,matchUp:Se}),T[we]=ne,!0});le.matchUpsToSchedule=le.matchUpsToSchedule.filter(({matchUpId:Se})=>Se!==(be==null?void 0:be.matchUpId)),be?te+=1:(v[F][oe]||(v[F][oe]=[]),v[F][oe].push({scheduleTime:ne,attempts:me+1}))}(_=le.matchUpsToSchedule)!=null&&_.length&&(v[F][oe]=(A=v[F][oe])==null?void 0:A.filter(ne=>{let me=ne.attempts<J;return me&&le.scheduleTimes.push(ne),!me})),(!((N=le.scheduleTimes)!=null&&N.length)||!((k=le.matchUpsToSchedule)!=null&&k.length))&&(le.complete=!0)}se+=1,ie=V.every(({venueId:oe})=>K[oe].complete)||se===ce}for(let{venueId:oe}of V){let te=K[oe].matchUpMap;Object.keys(te).forEach(le=>{let ne=c[le];ne&&Object.keys(te[le]).forEach(me=>{let{drawDefinition:be}=qg({tournamentRecord:ne,drawId:me});be&&te[le][me].forEach(({matchUpId:Se})=>{let we=T[Se];if(we){let ze=we.split(":").map(Oc).join(":"),Qe=`${Ri(F)}T${ze}`;m?w[F].push(Se):(Wg({drawDefinition:be,scheduledTime:Qe,matchUpId:Se}).success&&w[F].push(Se),oe&&DU({tournamentRecord:ne,drawDefinition:be,matchUpId:Se,venueId:oe}))}})})}),U[F]=K[oe].matchUpsToSchedule.map(Pa),g[F][oe]=K[oe].scheduleTimes.sort((le,ne)=>an(le.scheduleTime)-an(ne.scheduleTime))}!m&&(Z!=null&&Z.length)&&VC({matchUpDetails:Z,scheduleByeMatchUps:!0,removePriorValues:!0,tournamentRecords:c,schedule:{scheduledDate:"",scheduledTime:"",courtOrder:"",courtId:"",venueId:""}});for(let oe of $.venues)for(let te of oe.rounds){let le=(((O=te.matchUps)==null?void 0:O.map(({matchUpId:me})=>me))||[]).filter(me=>w[F].includes(me));te.canScheduledMatchUpIds=le;let ne=Math.round(le.length/te.matchUpsCount*1e4)/100;(ne===1/0||isNaN(ne))&&(ne=0),te.possibleToSchedulePct=ne,te.matchUpsCount===le.length&&(te.possibleToSchedule=!0)}}let E=r.map(({scheduleDate:$})=>$),R={timeStamp:Date.now(),overLimitMatchUpIds:S,scheduledMatchUpIds:w,schedulingProfile:u,noTimeMatchUpIds:U,requestConflicts:P,scheduledDates:E};return vpe({tournamentRecords:c,autoSchedulingAudit:R}),{...de,schedulingProfileModifications:t,schedulingProfileIssues:n,scheduleTimesRemaining:g,dateSchedulingProfiles:r,skippedScheduleTimes:v,recoveryTimeDeferredMatchUpIds:y,dependencyDeferredMatchUpIds:b,matchUpScheduleTimes:T,overLimitMatchUpIds:S,scheduledMatchUpIds:w,noTimeMatchUpIds:U,requestConflicts:P,scheduledDates:E}}function _Z({averageMinutes:t,startTime:e,endTime:i,court:n,date:r}){if(!Array.isArray(n.dateAvailability))return{error:ai,stack:"getEarliestCourtTime"};let a=KS({scheduleDate:r,courts:[n],startTime:!0}),s=KS({scheduleDate:r,courts:[n],endTime:!0});e=e||a,i=i||s;let o=OC({court:n,date:r}),{timeSlots:l}=TU({courtDate:o}),c=Zr(e),u=Zr(i);return{earliestCourtTime:l==null?void 0:l.reduce((d,p)=>{let h=Zr(p.startTime),f=Zr(p.endTime);if(h>u||f<c)return d;let m=c>h?c:h;if(xP(m,f)>=t){let g=rr(m.toISOString());(!d||g<d)&&(d=g)}return d},void 0),courtStartTime:a,courtEndTime:s}}function XFe({schedulingProfileModifications:t,checkPotentialRequestConflicts:e,scheduleCompletedMatchUps:i,schedulingProfileIssues:n,dateSchedulingProfiles:r,containedStructureIds:a,matchUpDependencies:s,matchUpDailyLimits:o,clearScheduleDates:l,tournamentRecords:c,periodLength:u=30,schedulingProfile:d,personRequests:p,matchUps:h=[],courts:f,dryRun:m}){var R,C;let g={},v={},y={},b={},I={},T={},w={},S={},U={};for(let M of r??[]){let _=Ri(M==null?void 0:M.scheduleDate),A=(M==null?void 0:M.venues)||[],N={},k={},O=(oe,te)=>{oe.forEach(le=>{let ne=k[le].counters;ne[te]?ne[te]+=1:ne[te]=1,ne[ku]?ne[ku]+=1:ne[ku]=1})};g[_]={},v[_]={},T[_]=[],w[_]=[],S[_]=[],U[_]=[];let $={};h==null||h.forEach(oe=>{var te;(te=oe.schedule)!=null&&te.scheduledDate&&kh(_,Ri(oe.schedule.scheduledDate))&&YS({matchUpPotentialParticipantIds:N,matchUpNotBeforeTimes:$,matchUp:oe})});let{allDateScheduledByeMatchUpDetails:F,allDateScheduledMatchUpIds:V,venueScheduledRoundDetails:j,allDateMatchUpIds:B}=gpe({matchUpPotentialParticipantIds:N,individualParticipantProfiles:k,scheduleCompletedMatchUps:i,containedStructureIds:a,matchUpNotBeforeTimes:$,matchUpScheduleTimes:I,matchUpDependencies:s,clearScheduleDates:l,tournamentRecords:c,periodLength:u,scheduleDate:_,matchUps:h,courts:f,venues:A}),z=h==null?void 0:h.filter(({matchUpId:oe})=>V.includes(oe)),{bookings:W}=JO({dateScheduledMatchUps:z,tournamentRecords:c,scheduleDate:_,periodLength:u}),{virtualCourts:Z}=GO({scheduleDate:_,periodLength:u,bookings:W,courts:f}),K=Z==null?void 0:Z.reduce((oe,te)=>{let{earliestCourtTime:le,courtEndTime:ne}=_Z({date:_,averageMinutes:0,court:te});return(!oe.startTime||Zr(le)<Zr(oe.startTime))&&(oe.startTime=le),(!oe.endTime||Zr(ne)>Zr(oe.endTime))&&(oe.endTime=ne),oe},{}),Q=K.startTime,J=({courtId:oe,booking:te})=>{var le;return(le=Z==null?void 0:Z.find(ne=>ne.courtId===oe))==null?void 0:le.dateAvailability[0].bookings.push(te)},se=10,ie=0,ce;for(;!ce;){for(let{venueId:oe}of A){let te=j[oe],le=te.matchUpsToSchedule.length,ne=[],me=[],be,Se=0;for(;!be;){for(let we of te.matchUpsToSchedule){if(me.length===te.courtsCount||ne.length===te.courtsCount){be=!0;break}let{matchUpId:ze,matchUpType:Qe}=we,{participantIdsAtLimit:ke,relevantParticipantIds:yt}=U4({matchUpPotentialParticipantIds:N,individualParticipantProfiles:k,matchUpDailyLimits:o,matchUp:we});if(ke.length){w[_].includes(ze)||w[_].push(ze);continue}let{dependenciesScheduled:lt,remainingDependencies:Ct}=w4({matchUpScheduleTimes:I,matchUpDependencies:s,allDateMatchUpIds:B,matchUp:we});if(!lt){v[_][ze]||(v[_][ze]=[]),v[_][ze].push({remainingDependencies:Ct});continue}let Nt=[],Ce=Z==null?void 0:Z.reduce((Ge,$e)=>{var St,bt,Ie,Ue;if(me.includes($e.courtId))return Ge;let{earliestCourtTime:at}=_Z({averageMinutes:te.greatestAverageMinutes,startTime:Q,date:_,court:$e});if(Ge.scheduleTime&&an(at)>=an(Ge.scheduleTime))return Ge;let{scheduledDependent:ct}=fpe({matchUpScheduleTimes:I,matchUpDependencies:s,scheduleTime:at,matchUpId:ze,details:te});if(ct)return Ge;let{enoughTime:Vt}=T4({individualParticipantProfiles:k,matchUpNotBeforeTimes:$,matchUpDependencies:s,scheduleTime:at,details:te,matchUp:we});if(!Vt)return g[_][ze]||(g[_][ze]=[]),g[_][ze].includes(at)||g[_][ze].push(at),Ge;let Me=((bt=(St=te.minutesMap)==null?void 0:St[ze])==null?void 0:bt.averageMinutes)||te.greatestAverageMinutes,{conflicts:De}=S4({potentials:e,averageMatchUpMinutes:Me,requestConflicts:U,personRequests:p,scheduleTime:at,scheduleDate:_,matchUp:we});if(De!=null&&De.length)return Nt.push(...De),!1;O(yt,Qe);let Je=(Ue=(Ie=te.minutesMap)==null?void 0:Ie[ze])==null?void 0:Ue.recoveryMinutes;return IE({matchUpPotentialParticipantIds:N,individualParticipantProfiles:k,matchUpNotBeforeTimes:$,averageMatchUpMinutes:Me,matchUpDependencies:s,recoveryMinutes:Je,scheduleTime:at,matchUp:we}),(!Ge.scheduleTime||an(at)<an(Ge.scheduleTime))&&(Ge.averageMatchUpMinutes=Me,Ge.recoveryMinutes=Je,Ge.scheduleTime=at,Ge.courtName=$e.courtName,Ge.courtId=$e.courtId),Ge},{});if(Ce.scheduleTime){let{averageMatchUpMinutes:Ge,recoveryMinutes:$e,scheduleTime:at,courtId:ct}=Ce;I[ze]=at,b[ze]=ct,ne.push(ze),me.push(ct);let Vt=at,Me=il(Vt,Ge);J({courtId:ct,booking:{averageMatchUpMinutes:Ge,recoveryMinutes:$e,periodLength:u,matchUpId:ze,startTime:Vt,courtId:ct,endTime:Me,venueId:oe}}),te.matchUpsToSchedule=te.matchUpsToSchedule.filter(De=>De.matchUpId!==ze)}else Nt!=null&&Nt.length&&(y[_]||(y[_]=[]),y[_].push(...Nt))}(me.length===te.courtsCount||ne.length===te.courtsCount||!te.matchUpsToSchedule.length)&&(be=!0),te.matchUpsToSchedule.length&&ne<te.courtsCount&&(Zr(Q)<Zr(K.endTime)?Q=il(Q,u):(be=!0,te.complete=!0)),Se+=1,!be&&Se>=le&&(be=!0)}(R=te.matchUpsToSchedule)!=null&&R.length||(te.complete=!0)}ie+=1,ce=A.every(({venueId:oe})=>j[oe].complete)||ie===se}for(let{venueId:oe}of A){let te=j[oe].matchUpMap;Object.keys(te).forEach(le=>{let ne=c[le];ne&&Object.keys(te[le]).forEach(me=>{let{drawDefinition:be}=qg({tournamentRecord:ne,drawId:me});be&&te[le][me].forEach(({matchUpId:Se})=>{let we=I[Se],ze=b[Se];if(we){let Qe=we.split(":").map(Oc).join(":"),ke=`${Ri(_)}T${Qe}`;m||(Wg({drawDefinition:be,scheduledTime:ke,matchUpId:Se}),fw({courtDayDate:_,tournamentRecords:c,tournamentRecord:ne,drawDefinition:be,matchUpId:Se,courtId:ze})),T[_].push(Se)}})})}),S[_]=j[oe].matchUpsToSchedule.map(Pa)}!m&&(F!=null&&F.length)&&VC({matchUpDetails:F,scheduleByeMatchUps:!0,removePriorValues:!0,tournamentRecords:c,schedule:{scheduledDate:"",scheduledTime:"",courtOrder:"",courtId:"",venueId:""}});for(let oe of M.venues)for(let te of oe.rounds){let le=(C=(te.matchUps??[]).map(({matchUpId:me})=>me))==null?void 0:C.filter(me=>T[_].includes(me));te.canScheduledMatchUpIds=le;let ne=Math.round(((le==null?void 0:le.length)||0)/te.matchUpsCount*1e4)/100;(ne===1/0||isNaN(ne))&&(ne=void 0),te.possibleToSchedulePct=ne,te.matchUpsCount===(le==null?void 0:le.length)&&(te.possibleToSchedule=!0)}}let P=(r??[]).map(({scheduleDate:M})=>M),E={timeStamp:Date.now(),overLimitMatchUpIds:w,scheduledMatchUpIds:T,schedulingProfile:d,noTimeMatchUpIds:S,requestConflicts:U,scheduledDates:P};return vpe({tournamentRecords:c,autoSchedulingAudit:E}),{...de,schedulingProfileModifications:t,schedulingProfileIssues:n,dateSchedulingProfiles:r,recoveryTimeDeferredMatchUpIds:g,dependencyDeferredMatchUpIds:v,matchUpScheduleTimes:I,overLimitMatchUpIds:w,scheduledMatchUpIds:T,noTimeMatchUpIds:S,requestConflicts:U,scheduledDates:P}}function QO(t){let{scheduleAttributes:e=["scheduledDate","scheduledTime","courtOrder"],ignoreMatchUpStatuses:i=ca,scheduledDates:n,venueIds:r}=t,a=Jc(t),s=Xi(a)?Object.values(a).map(({tournamentId:l})=>l).filter(Boolean):[];if(!(s!=null&&s.length))return{error:wr};let o=0;for(let l of s){let c=a[l],u=JFe({ignoreMatchUpStatuses:i,scheduleAttributes:e,tournamentRecord:c,scheduledDates:n,venueIds:r});if(u.error)return u;o+=u.clearedScheduleCount??0}return{...de,clearedScheduleCount:o}}function JFe({scheduleAttributes:t=["scheduledDate","scheduledTime","courtOrder"],ignoreMatchUpStatuses:e=ca,tournamentRecord:i,scheduledDates:n,venueIds:r=[]}){if(typeof i!="object")return{error:ut};if(!Array.isArray(e)||!Array.isArray(r))return{error:Re};r.length&&t.push("venueId");let a=Wa({matchUpFilters:{scheduledDates:n},tournamentRecord:i}).matchUps??[],s={};a.forEach(({matchUpStatus:c,schedule:u,drawId:d,matchUpId:p})=>{(!c||!e.includes(c))&&AC({schedule:u,scheduleAttributes:t})&&(!(r!=null&&r.length)||r.includes(u.venueId))&&(s[d]||(s[d]=[]),s[d].push(p))});let o=i.tournamentId,l=0;for(let c in s){let{event:u,drawDefinition:d}=jo({tournamentRecord:i,drawId:c}),p=lo({drawDefinition:d,matchUpFilters:{matchUpIds:s[c]}}).matchUps??[];for(let h of p){let f=!1;h.timeItems=(h.timeItems??[]).filter(m=>{let g=(m==null?void 0:m.itemType)&&![$h,hg,JI,Hx,QI,ew].includes(m==null?void 0:m.itemType);return g||(f=!0),g}),f&&(Ji({context:"clear schedules",eventId:u==null?void 0:u.eventId,drawDefinition:d,tournamentId:o,matchUp:h}),l+=1)}}return{...de,clearedScheduleCount:l}}function eL(t){let{checkPotentialRequestConflicts:e=!0,scheduleCompletedMatchUps:i,clearScheduleDates:n,scheduleDates:r=[],tournamentRecords:a,periodLength:s,useGarman:o,dryRun:l,pro:c}=t,u=Qt(t,[{[ks]:!0},{[ds]:P=>!P||Array.isArray(P)&&P.every(El),[jse]:!1,[qo]:Rs}]);if(u.error)return u;let d=Dm({tournamentRecords:a});if(d.error)return d;if(!d.schedulingProfile.length)return{...de};let{modifications:p,issues:h=[],schedulingProfile:f=[]}=d,m=Object.assign({},...Object.values(a).map(P=>cU({tournamentRecord:P}).containedStructures)),g=r.map(P=>{if(El(P))return Ri(P)}).filter(Boolean),v=f.map(P=>P.scheduleDate).map(P=>El(P)&&Ri(P)).filter(P=>P&&(!r.length||g.includes(P)));if(!v.length)return{error:Kre};if(n&&!l){let P=Array.isArray(n)?n:[];QO({tournamentRecords:a,scheduledDates:P})}let y=Um({ignoreDisabled:!1,tournamentRecords:a}).courts,{matchUps:b}=_d({matchUpFilters:{matchUpTypes:[xn,Mn]},afterRecoveryTimes:!0,nextMatchUps:!0,tournamentRecords:a}),{matchUpDependencies:I}=rd({includeParticipantDependencies:!0,tournamentRecords:a,matchUps:b}),{matchUpDailyLimits:T}=FO({tournamentRecords:a}),{personRequests:w}=zy({requestType:BC,tournamentRecords:a}),S=f.filter(P=>{let E=Ri(P==null?void 0:P.scheduleDate);return v.includes(E)}).sort((P,E)=>new Date(P.scheduleDate).getTime()-new Date(E.scheduleDate).getTime()),U={schedulingProfileModifications:p,checkPotentialRequestConflicts:e,scheduleCompletedMatchUps:i,schedulingProfileIssues:h,dateSchedulingProfiles:S,containedStructureIds:m,matchUpDependencies:I,matchUpDailyLimits:T,clearScheduleDates:n,tournamentRecords:a,schedulingProfile:f,personRequests:w,periodLength:s,useGarman:o,matchUps:b,dryRun:l,courts:y};return c?XFe(U):ZFe(U)}function tL(t){let{tournamentRecord:e,tournamentRecords:i,activeTournamentId:n,...r}=t||{};return r.tournamentId||(r.tournamentId=yn()),r.startDate&&!Xv(r.startDate)&&!xA.test(r.startDate)?{error:Fa}:r.endDate&&!Xv(r.endDate)&&!xA.test(r.endDate)?{error:Fa}:(r.extensions&&(r.extensions=r.extensions.filter(Cp)),{...r})}function D4({addParticipants:t=!0,participantAttribute:e,tournamentRecord:i,personAttribute:n,teamNames:r,accessor:a,uuids:s}){var f,m;if(!i)return{error:ut};let o={},l=(i.participants??[]).filter(({participantType:g,participantRole:v})=>g===ji&&v===ms),c=0;for(let g of l){let v=a&&((f=Ob({element:g,accessor:a}))==null?void 0:f.value)||n&&((m=g.person)==null?void 0:m[n])||e&&g[e];if(v){if(!Object.keys(o).includes(v)){o[v]={participantName:(r==null?void 0:r[c])??v,participantId:(s==null?void 0:s.pop())??yn(),individualParticipantIds:[],participantRole:ms,participantType:En};let y={value:n??e,name:_V};dn({element:o[v],extension:y}),c+=1}o[v].individualParticipantIds.push(g.participantId)}}let u=Object.keys(o),d=(i.participants??[]).map(g=>{if(g.participantType!==En||g.participantRole!==ms)return;let{extension:v}=ki({name:_V,element:g}),y=v==null?void 0:v.value;if(u.includes(y))return g.participantId}).filter(Boolean),p=0,h=[];return Object.keys(o).forEach(g=>{let v=o[g],{participantId:y}=v;d.includes(y)||(i.participants||(i.participants=[]),t&&i.participants.push(v),h.push(v),p++)}),t&&p?(Si({payload:{tournamentId:i.tournamentId,participants:h},topic:ug}),{...de,participantsAdded:p}):h.length?{...de,newParticipants:h}:{error:sMe}}var QFe=[{AA:"Annexia"},{BA:"Bacteria"},{BO:"Borduria"},{BM:"Bensalem"},{BS:"Basenji"},{BI:"Balnibarbi"},{BV:"Bartovia"},{BZ:"Berzerkistan"},{CA:"Caldonia"},{CC:"Concordia"},{CH:"Chula"},{DA:"Deltora"},{DW:"Discworld"},{EA:"Eastasia"},{EP:"Ecotopia"},{ER:"Erewhon"},{FA:"Freedonia"},{FN:"Florin"},{FG:"Fogg"},{FK:"Fourecks"},{GA:"Genovia"},{GL:"Gilead"},{GD:"Gilead"},{GL:"Gondal"},{GO:"Gondor"},{GR:"Gruzinia"},{GT:"Goritania"},{GU:"Guilder"},{HA:"Heldscalla"},{HO:"Hidalgo"},{IL:"Illyria"},{KA:"Kinakuta"},{KG:"Kangan"},{KN:"Kreplachistan"},{KS:"Kallipolis"},{LH:"Lugash"},{LI:"Listenbourg"},{LT:"Lilliput"},{LU:"Luggnagg"},{LV:"Lichtenslava"},{MR:"Moher"},{NA:"Narnia"},{NV:"Novaria"},{OA:"Oceania"},{OS:"Orsinia"},{OV:"Octavia"},{PA:"Palombia"},{PG:"Penguina"},{QA:"Qasha"},{PM:"Panem"},{SA:"Solymbria"},{SD:"Syldavia"},{SG:"San Glucose"},{SL:"San Lorenzo"},{SR:"Sontar"},{SY:"Sylvania"},{TF:"Tralfamadore"},{TH:"Themyscira"},{UA:"Utopia"},{VA:"Vespugia"},{WA:"Wakanda"},{WX:"Wessex"},{ZA:"Zamunda"},{ZK:"Zubrowka"}],e2e=["Amber","Ansul","Atlantis","Braavos","Busytown","Castle Rock","Centralia","Coober Pedy","Chefchaouen","Chronopolis","Damanhur","Diaspar","Dictionopolis","Diomira","El Dorado","Elista","Ephesus","Gotham","Hadleyburg","Hallstatt","Hierusalem","Ilium","Inverness","Kowloon","Laputa","Longyearbyen","Lys","Matmata","Maycomb","Metropolis","Miyake-jima","Monowi","Nagoro","Navarre","New New York","Nimbin","Pemberley","Pseudopolis","Rivendell","Roswell","Shangri-La","Springfield","Supilinn","Thneedville","Trantor","Wobegon","Yonwood","Xanadu","Xylar","Zion"];function ype({count:t=1,participantsCount:e=32}={}){let i=so(e2e),n=i.slice(0,t);return{cities:Rt(0,e).map(r=>r<Math.min(t,i.length)?n[r]:wl(n))}}function bpe({count:t=1,participantsCount:e=32}={}){let i=so(QFe),n=i.slice(0,t).map(r=>Object.keys(r)).flat();return{states:Rt(0,e).map(r=>r<Math.min(t,i.length)?n[r]:wl(n))}}function Ipe({count:t=1,participantsCount:e=32}={}){let i=Rt(0,t).map(()=>Rt(0,5).map(()=>Ac(0,9)).join(""));return{postalCodes:Rt(0,e).map(n=>n<t?i[n]:wl(i))}}function l_({idPrefix:t,participantType:e,index:i,uuids:n}){let r=nr(e)?e[0]:"X";return t?`${t}-${r}-${i}`:(n==null?void 0:n.pop())||yn()}function wpe(t){let{cities:e,states:i,postalCodes:n,nationalityCode:r,participantIndex:a}=t;return{postalCode:n==null?void 0:n[a],state:i==null?void 0:i[a],city:e==null?void 0:e[a],countryCode:r}}var t2e={lastNames:["Abbey","Ahern","Ampleforth","Ananiadis","Andelic","Assange","Atreides","Austen","Bach","Banks","Barrington","Batty","Bauers","Beals","Beer","Bennett","Berry","Bonaparte","Brewer","Brockovich","Bukowski","Cassidy","Catton","Calvino","Carlin","Carson","Chip","Constant","Crane","Crowne","Cummings","Curie","Dallas","Diamond","Deckard","Drazic","Dunbar","Earhart","Eisenstein","Eldritch","Elliot","Ellul","Escher","Eyre","Faulkner","Fulcher","Fukuoka","Godel","Goldstein","Greer","Hedges","Herbert","Holmgren","Humperdinck","Huxley","Illich","Jeffers","Jensen","Jevons","Johnson","Johnstone","Jovovich","Kingsnorth","Langer","Fernwright","Fuller","Le Guin","Lem","Lovelace","Mander","McLuhan","Midgely","Mond","Montoya","Moore","Murry","Nagle","Nearing","Ogden","Ophuls","Parks","Paz","Peet","Perfect","Pendejo","Pevensie","Postman","Ripley","Rodda","Rumfoord","Runciter","Rugen","Sale","Schumacher","Shaftoe","Shelley","Shepard","Smith","Stratton","Stewart","Swift","Tillich","Turing","Tyrell","Twain","Yeats","Veblen","Yates","Vonnegut","Waterhouse","Watson","Wolin","Wirt","Waschuk","Wormwood"],firstFemale:["Ada","Amelia","Amelie","America","Anne","Antonia","Aravis","Astrid","Beatrice","Brienne","Buttercup","Caitlin","Cimorene","Cordelia","Desdemona","Ellen","Elizabeth","Emily","Emmie","Erin","Eva","Evelyn","Heather","Helen","Hermia","Hypatia","Imogen","Jane","Jasmine","Juliana","Juliet","Katniss","Leeloo","Lenina","Lilith","Linda","Lizzie","Louise","Lucy","Marie","Mary","Martha","Matilda","Milla","Miranda","Meg","Melba","Nicole","Ola","Portia","Pris","Rachael","Rachel","Rebecca","River","Rosa","Rosalind","Scout","Sharn","Susanne","Titania","Uhura","Ursula","Valentina","Viola","Virginia","Xena","Zoe"],firstMale:["Alan","Aldous","August","Axel","Barda","Barry","Bill","Bruce","Charles","Chris","Constantine","Darwin","David","Derrick","Edward","Emmanuel","Ernst","Estlin","Fezzik","Filby","Frank","Frito","George","Glen","Helmholtz","Inigo","Italo","Ivan","Jacques","James","Jared","Jerry","Joe","Johann","Julian","John Michael","Jonathan","Korben","Kirkpatrick","Kurt","Lief","Malachi","Mark","Marhsall","Masanobu","Maurits","Michael","Mustapha","Neil","Nikola","Octavio","Palmer","Paul","Pierre","Robinson","Rick","Rincewind","Roy","Shannon","Sheldon","Stafford","Stanislaw","Stanley","Syme","Thorstein","Thomas","Tyrone","Vizzini","Walton","Walker","Warren","Wendell","Westley","William","Winston","Zoran"]};function D$(t){let{count:e=100,sex:i}=t||{};if(!e||i&&![Cn,Yn].includes(i))return{personData:[],error:Re};let n=Math.ceil(e*1.3),{lastNames:r,firstFemale:a,firstMale:s}=t2e,o=ig.map(({iso:m})=>m).filter(Boolean),l=Math.ceil(n/r.length),c=Math.ceil(n/a.length),u=Math.ceil(n/s.length),d=Rt(0,l).flatMap(()=>{let m=_t(r,!1,!0);return Rt(0,r.length).map(()=>Tl(m))}),p=Rt(0,c).flatMap(()=>{let m=_t(a,!1,!0);return Rt(0,a.length).map(()=>Tl(m))}),h=Rt(0,u).flatMap(()=>{let m=_t(s,!1,!0);return Rt(0,s.length).map(()=>Tl(m))}),f={};for(let m=0;m<n;m++){let g=d.pop(),v=i||wl([Cn,Yn]),y=v===Cn?h.pop():p.pop(),b=wl(o);f[`${y}${g}`]={nationalityCode:b,sex:v,firstName:y,lastName:g}}return{personData:Object.values(f).slice(0,e)}}function Spe(t){let e=(t==null?void 0:t.count)||1,{personExtensions:i,consideredDate:n,isMock:r=!0,gendersCount:a,personData:s,category:o,sex:l}=t||{};if(isNaN(e))return{error:Re};let c=(a==null?void 0:a[Cn])||l===Cn&&e||0,u=(a==null?void 0:a[Yn])||l===Yn&&e||0;e=Math.max(e,c+u);let d=e-(c+u),p=c&&D$({count:c,sex:Cn}).personData||[],h=u&&D$({count:u,sex:Yn}).personData||[],f=[...p,...h,...d&&D$({count:d}).personData||[]],m=f.filter(U=>!l||c&&u||U.sex===l),g=[];if(Array.isArray(s)){let U=s.filter(P=>typeof P.firstName!="string"||typeof P.lastName!="string"||P.sex&&![Cn,Yn].includes(P.sex)||P.nationalityCode&&(typeof P.nationalityCode!="string"||P.nationalityCode.length>3||!ig.find(({iso:E,ioc:R})=>[E,R].includes(P.nationalityCode)))?!1:(P.nationalityCode&&g.push(P.nationalityCode),!0));if(U.length)m=U;else return{error:Re}}let v=s?m:so(m);if(v.length<e){let{maleFirstNames:U,maleLastNames:P,femaleFirstNames:E,femaleLastNames:R,nationalityCodes:C}=f.reduce((M,_)=>{let{firstName:A,lastName:N,nationalityCode:k}=_;return _.sex===Cn?(M.maleFirstNames.includes(A)||M.maleFirstNames.push(A),M.maleLastNames.includes(N)||M.maleLastNames.push(N)):(M.femaleFirstNames.includes(A)||M.femaleFirstNames.push(A),M.femaleLastNames.includes(N)||M.femaleLastNames.push(N)),M.nationalityCodes.includes(k)||M.nationalityCodes.push(k),M},{maleFirstNames:[],maleLastNames:[],femaleFirstNames:[],femaleLastNames:[],nationalityCodes:[]});Rt(0,e-v.length).forEach(()=>{let M=l||wl([Cn,Yn]),_=wl(C),A=wl(M===Cn?U:E),N=wl(M===Cn?P:R),k={firstName:A,lastName:N,sex:M,nationalityCode:_};v.push(k)})}let{ageMinDate:y,ageMaxDate:b}=sI({consideredDate:n,category:o}),I=ui((y==null?void 0:y.slice(0,4))||0)||ui((b==null?void 0:b.slice(0,4))||0)-3,T=ui((b==null?void 0:b.slice(0,4))||0)||ui((y==null?void 0:y.slice(0,4))||0)+3,w=(y||b)&&[I,T],S=v.slice(0,e).map((U,P)=>{let[E,R]=w||[],C=w&&Tl(Rt(E,R)),M=Tl(Rt(0,365)),_=C&&JMe(C,M);return Object.assign(Kt({extensions:i||[{name:"regionCode",value:P+1}],birthDate:_,isMock:r}),U)});return{persons:S.length&&S||v[0],nationalityCodes:g}}var i2e=["Ace Academy","Avengers","Ball Bouncers","Baseliners","Captivators","Civil Disobedients","Continentals","Court Royal","Court Sharks","Diamond Dogs","Danger Zone","Doubles Dominators","Double Faults","Tricksters","Eliminators","Court Crusaders","Fuzz Busters","Game Changers","Goal Gurus","Good Volley","Green Machine","Hawk Eyes","Inside Outers","Killer Instinct","Line Toers","Masters of Mayhem","Matter Catchers","Cheap Shot","Mean Machines","Mindspace Invaders","Net Centric","Net Positive","Smash Mullet","Over Your Head","Spin Meisters","Aggressors","Racket Machine","Slice Happy","Refs Nightmare","Sandeaters","Sun Seekers","Slicer Dicers","Stacked Deck","Cross Stringers","The Emergence","Total Demolition","Touch and Go","Unreturnables","Upside Downers","Vertically Challenged","Visual Spectacle"];function c_({nameRoot:t="TEAM",count:e=1}={}){let i=so(i2e).slice(0,e);return i.length<e&&Rt(0,e-i.length).forEach(n=>i.push(`${t} ${n+1}`)),{names:i}}function EU(t){let{scaledParticipantsCount:e,rankingRange:i}=t,{ratingsParameters:n=Da,valuesInstanceLimit:r,ratingsValues:a=[],consideredDate:s,categories:o,category:l,nationalityCodesCount:c,nationalityCodeType:u,nationalityCodes:d,participantsCount:p=32,participantType:h,teamSize:f=8,personIds:m,idPrefix:g,uuids:v,personExtensions:y,addressProps:b,gendersCount:I,matchUpType:T,personData:w,sex:S,inContext:U,withISO2:P,withIOC:E,scaleAllParticipants:R}=t,C=h===Ni||T===Zv,M=h===En||T===En;i&&(!Array.isArray(i)||!i.every(ke=>Dr(ke))||i.length!==2)&&(i=void 0),e=R?p:e;let _=1e3,A=e&&e>_?e:_;i=i||[1,A],i[1]+=1;let N=p*(C&&2||M&&(f??8)||1),k=Spe({count:N,personExtensions:y,consideredDate:s,gendersCount:I,personData:w,category:l,sex:S});if(k.error)return k;let{nationalityCodes:O,persons:$}=k,F={},V={},j={},B={},z=ke=>{Object.assign(F,ke.doublesRankings),Object.assign(V,ke.singlesRankings),Object.assign(B,ke.doublesRatings),Object.assign(j,ke.singlesRatings)};if(Xi(l)){let ke=kZ({scaledParticipantsCount:e,ratingsParameters:n,participantType:h,ratingsValues:a,rankingRange:i,category:l});z(ke)}Array.isArray(o)&&o.forEach(ke=>{let yt=kZ({scaledParticipantsCount:e,ratingsParameters:n,participantType:h,ratingsValues:a,rankingRange:i,category:ke});z(yt)});let W=ig.filter(ke=>u==="IOC"&&ke.ioc||ke.iso);function Z(ke){let yt=Math.ceil(N/ke);return r&&yt>r?Math.ceil(N/r):ke}let{postalCodesProfile:K,postalCodesCount:Q,statesProfile:J,citiesProfile:se,citiesCount:ie,statesCount:ce}=b||{},oe=ke=>Object.keys(ke).map(yt=>Rt(0,J[yt]).map(()=>yt)).flat(),te=se&&oe(se)||(b==null?void 0:b.cities)||ype({count:ie||N,participantsCount:N}).cities,le=J&&oe(J)||(b==null?void 0:b.states)||bpe({count:ce||N,participantsCount:N}).states,ne=K&&oe(K)||(b==null?void 0:b.postalCodes)||Ipe({count:Q||N,participantsCount:N}).postalCodes,me={cities:te,states:le,postalCodes:ne},be=Z(c),Se=be?so(W).slice(0,c):d&&W.filter(ke=>d.includes(ke.iso))||W,we=so(Rt(0,Math.ceil(N/(be||1))).map(()=>Se).flat(1/0)),ze=c_({count:p}).names;return{participants:Rt(0,p).map(ke=>{let yt=C&&2||M&&(f??8)||1,lt=Rt(0,yt).map($e=>{let at=ke*yt+$e;return Qe(at)}),Ct=lt.map($e=>$e.participantId),Nt=lt.map($e=>$e.person.standardFamilyName).join("/"),Ce=C?Ni:En,Ge={participantId:l_({participantType:Ce,index:ke,idPrefix:g,uuids:v}),participantName:C?Nt:ze[ke],participantRole:ms,individualParticipantIds:Ct,participantType:Ce};return U&&(Ge.individualParticipants=lt),C||M?[Ge,...lt]:lt}).flat(),...de};function Qe(ke){let yt=$[ke],{nationalityCode:lt,participantExtensions:Ct,participantTimeItems:Nt,extensions:Ce,firstName:Ge,birthDate:$e,lastName:at,personId:ct,sex:Vt}=yt||{},Me=Ge||"GivenName",De=at||"FamilyName",Je=`${Me} ${De}`,St=we[ke],bt=(O==null?void 0:O.length)&&lt||St&&(u==="IOC"?St.ioc||St.iso:St.iso||St.ioc)||lt;we!=null&&we.length&&!bt&&!lt&&console.log("%c Invalid Nationality Code",{participantIndex:ke,country:St});let Ie=wpe({...me,participantIndex:ke,nationalityCode:bt}),Ue=Kt({participantId:l_({participantType:ji,index:ke,idPrefix:g,uuids:v}),extensions:Ct,timeItems:Nt,participantRole:ms,participantType:ji,participantName:Je,person:{personId:ct||(m==null?void 0:m.length)&&m[ke]||yn(),birthDate:El($e)?$e:void 0,addresses:[Ie],standardFamilyName:De,standardGivenName:Me,nationalityCode:bt,extensions:Ce,sex:Vt}});if(E&&bt){let Ee=ig.find(({iso:Xe})=>Xe===bt);Ee!=null&&Ee.ioc&&(Ue.person.iocNationalityCode=Ee.ioc),Ee!=null&&Ee.label&&(Ue.person.countryName=Ee.label)}if(P&&bt){let Ee=ig.find(({iso:Xe})=>Xe===bt);Ee!=null&&Ee.iso2&&(Ue.person.iso2NationalityCode=Ee.iso2),Ee!=null&&Ee.label&&(Ue.person.countryName=Ee.label)}let Oe=Ee=>{var Ke,zt,mt,Tt;let Xe=Ee.categoryName||Ee.ratingType||Ee.ageCategoryCode,Et=(Ke=V[Xe])==null?void 0:Ke[ke],Fe=(zt=F[Xe])==null?void 0:zt[ke];jM({scaleValue:Et,eventType:oI,scaleType:og,participant:Ue,category:Ee}),jM({scaleValue:Fe,eventType:Vf,scaleType:og,participant:Ue,category:Ee});let ht=(mt=j[Xe])==null?void 0:mt[ke],ti=(Tt=B[Xe])==null?void 0:Tt[ke];jM({scaleValue:ht,eventType:oI,scaleType:tg,participant:Ue,category:Ee}),jM({scaleValue:ti,eventType:Vf,scaleType:tg,participant:Ue,category:Ee})};return Array.isArray(o)?o.forEach(Ee=>Oe(Ee)):l&&Oe(l),Ue}}function jM({scaleValue:t,participant:e,eventType:i,scaleType:n,category:r}){let a=r.categoryName||r.ratingType||r.ageCategoryCode,s=[ty,n,i,a].join("."),o={itemValue:t,itemType:s};a&&t&&(e.timeItems||(e.timeItems=[]),e.timeItems.push(o))}function kZ(t){let{category:e,scaledParticipantsCount:i,ratingsParameters:n,participantType:r,ratingsValues:a=[]}=t,s=e.rankingRange||t.rankingRange||[1,1e3],o={},l={},c={},u={},{categoryName:d,ageCategoryCode:p,ratingType:h}=e,f=e.categoryName||e.ratingType||e.ageCategoryCode;if((d||p)&&!h){let[m,g]=s||[];if(l[f]=so(Rt(m,g)).slice(0,i||Ac(20,30)),[Ni,En].includes(r)){let[v,y]=s||[];o[f]=so(Rt(v,y)).slice(0,i||Ac(20,30))}}if(h&&n[h]){let{ratingMax:m,ratingMin:g,ratingAttributes:v}=e,y={...n[h],...v||{}},{attributes:b={},decimalsCount:I,accessors:T,range:w,step:S}=y,U=M=>{let _={},A=Object.keys(M||{});for(let N of A){let k=M[N];if(typeof k=="object"&&k.generator){let{range:O}=k,[$,F]=O.slice().sort();_[N]=Ac($,F)}else _[N]=k}return _},P=w[0]>w[1]?2:.7,[E,R]=w.slice().sort(),C=Rt(0,2e3).map(()=>hre(E,R,P,S,I)).filter(M=>(!m||M<=m)&&(!g||M>=g)).slice(0,i||Ac(20,30)).map(M=>T?Object.assign({},...T.map(_=>({[_]:M})),U(b)):M);c[f]=[...a,...C],[Ni,En].includes(r)&&(u[f]=[...a,...C])}return{singlesRankings:l,doublesRankings:o,singlesRatings:c,doublesRatings:u}}function E4(t){var h,f;let{alternatesCount:e=0,tieFormatName:i,drawSize:n}=t,r=0,a=0,s=0,o=0,l={},c={[Cn]:0,[Yn]:0,[Oo]:0,[xv]:0,[Ad]:0};(f=(h=Xi(t.tieFormat)?t.tieFormat:Bf({namedFormat:i}))==null?void 0:h.collectionDefinitions)==null||f.filter(Boolean).forEach(m=>{let{category:g,collectionId:v,matchUpType:y,matchUpCount:b,gender:I}=m;if([Cn,Yn].includes(I)){let T=b*(y===Mn?2:1);c[I]<T&&(c[I]=T)}else I===Oo&&(c[Cn]<b&&(c[Cn]=b),c[Yn]<b&&(c[Yn]=b));if(g){let T=JSON.stringify(g);l[T]=g}if(v||(m.collectionId=yn()),Fr(Mn)(y)){let T=b;o+=b,r=Math.max(r,T)}if(Fr(xn)(y)){let T=b;s+=b,a=Math.max(a,T)}});let u=Object.keys(l).length?Math.max(s,o*2):Math.max(a,r*2),d=r*(n+e),p=a*(n+e);return{maxDoublesDraw:d,maxSinglesDraw:p,teamSize:u,genders:c}}function n2e({participantsProfile:t,eventProfiles:e,drawProfiles:i}){let{participantsCount:n,participantType:r=ji}=t||{},a=n||0,s={[Yn]:0,[Oo]:0,[xv]:0,[Cn]:0,[Ad]:0},o=0,l=0,c=0,u=0,d=0,p=({alternatesCount:f=0,uniqueParticipants:m,tieFormatName:g,drawSize:v=0,eventType:y,tieFormat:b,category:I,gender:T,stage:w})=>{let S=y===Hc,U=y===na,P=!!(m||w===ni||I||T);if(U){u=Math.max(u,v+f),b=typeof b=="object"?b:Bf({namedFormat:g});let{teamSize:E,maxDoublesDraw:R,maxSinglesDraw:C,genders:M}=E4({alternatesCount:f,tieFormatName:g,tieFormat:b,drawSize:v});c=Math.max(c,E),l=Math.max(l,C),P||(o=Math.max(o,R)),Object.keys(M).forEach(_=>s[_]+=M[_])}else if(S)if(P){let E=(v+f)*2;d+=E,T&&(s[T]+=E)}else v+f&&v+f>o&&(o=v+f);else if(P){let E=v+f;T&&(s[T]+=E),d+=E}else v&&v>l&&(l=v+f)};if(e==null||e.forEach(f=>{let{tieFormatName:m,tieFormat:g,drawProfiles:v,eventType:y,category:b,gender:I}=f;if(v)for(let T of v){let{tieFormatName:w,tieFormat:S}=T;p({...T,tieFormatName:w||m,tieFormat:S||g,eventType:y,category:b,gender:I})}}),Array.isArray(i))for(let f of i)p(f);let h=Math.max(u*c,o*2,l);return o&&(r=Ni),(n||a)<h&&(n=h),n&&o&&[Ni,na].includes(r)&&(l&&Math.floor(l/2)>o?n=Math.floor(l/2):(!l||o*2>=l)&&(n=Math.ceil(n/2))),n===void 0&&(n=!(e!=null&&e.length)&&!(i!=null&&i.length)?32:0),n<a&&(n=a),{uniqueParticipantsCount:d,participantsCount:n,largestTeamDraw:u,largestTeamSize:c,participantType:r,gendersCount:s}}function Tpe({participantsProfile:t,tournamentRecord:e,eventProfiles:i,drawProfiles:n,startDate:r,uuids:a}){if((t==null?void 0:t.participantsCount)===0)return{addedCount:0,...de};let{participantsCount:s,participantType:o,largestTeamDraw:l,largestTeamSize:c,gendersCount:u}=n2e({participantsProfile:t,eventProfiles:i,drawProfiles:n}),d=t==null?void 0:t.teamKey,p=EU({consideredDate:r,...t,participantsCount:s,participantType:o,gendersCount:u,uuids:a}).participants,h=0,f=Ku({tournamentRecord:e,participants:p});if(f.error)return f;if(h+=f.addedCount,d){let y=D4({tournamentRecord:e,...d});if(y.error)return y}let m=p.filter(({participantType:y})=>y===ji).map(Vi),g=t!=null&&t.idPrefix?`${En}-${t.idPrefix}`:void 0,v=Rt(0,l).map(y=>{let b=m.slice(y*c,(y+1)*c),I=l_({index:y,participantType:o,idPrefix:g,uuids:a});return{participantName:`Team ${y+1}`,participantRole:ms,individualParticipantIds:b,participantType:En,participantId:I}});return f=Ku({participants:v,tournamentRecord:e}),f.error?f:(h+=f.addedCount,{addedCount:h,...de})}function Upe({drawProfiles:t,category:e,gender:i}){let n={},r=t==null?void 0:t.reduce((s,o)=>{let{qualifyingPositions:l=0,participantsCount:c=0,uniqueParticipants:u,stage:d=Ft,drawSize:p=0}=o||{};Object.keys(s).includes(d)||(s[d]=0);let h=(c||p)-l;return u||i||e||d===ni?(Object.keys(n).includes(d)||(n[d]=0),n[d]+=h):s[d]=Math.max(s[d],h),s},{}),a=Object.keys(n);return a.forEach(s=>r[s]+=n[s]),{stageParticipantsCount:r,uniqueParticipantsCount:n,uniqueParticipantStages:a}}function Dpe({allUniqueParticipantIds:t,stageParticipantsCount:e,eventParticipantType:i,targetParticipants:n}){let r=e[Ft]||0,a=e[ni]||0;return{stageParticipants:{QUALIFYING:n==null?void 0:n.filter(({participantType:s})=>s===i).filter(({participantId:s})=>!t.includes(s)).slice(0,a),MAIN:n==null?void 0:n.filter(({participantType:s})=>s===i).filter(({participantId:s})=>!t.includes(s)).slice(a,a+r)}}}var r2e={[cn]:2,[Yr]:1,[sa]:1,[as]:1,[Yi]:4};function P4(t){let{defaultWithScorePercent:e=2,winningSide:i}=t,{matchUpStatusProfile:n=r2e,matchUpFormat:r=Nu,pointsPerMinute:a=1,sideWeight:s=4}=t;if(!Nl({matchUpFormat:r}))return{error:Tz};if(typeof n!="object")return{error:Re};if(e>100&&(e=100),isNaN(e)||isNaN(a)||isNaN(s))return{error:Re};let o=Object.keys(n).filter(E=>Object.keys(Eq).includes(E)&&E!==Lr);if(Object.keys(o).reduce((E,R)=>E+n[R],0)>100)return{error:Re,matchUpStatusProfile:n};let l=o.reduce((E,R)=>(E.pointer=E.pointer+n[R],E.valueMap.push([E.pointer,R]),E),{pointer:0,valueMap:[]}),c=Ac(1,100),u=(l.valueMap.find(E=>c<=E[0])??[100,Lr])[1],d={sets:[],scoreStringSide1:"",side2ScoreString:""};if([cn,Yi].includes(u)){i=i||Ac(1,2);let E={score:d,matchUpStatus:u,winningSide:i};if(!(u===Yi&&Ac(1,100)>100-e))return{outcome:E}}else if([Yr,sa].includes(u))return{outcome:{score:d,matchUpStatus:u}};let p=wo(r),{bestOf:h=1,exactly:f,setFormat:m,finalSetFormat:g}=p??{},v=[],y=Ac(0,1),b=i?[i-1]:[...Rt(0,s).map(()=>y),1-y],I=[as,Yi,_l,Vg].includes(u)&&(Tl(Rt(1,f||h))||1),T,w=Rt(1,(f??h)+1);for(let E of w){let R=E===(f??h),{set:C,incomplete:M,winningSideNumber:_}=a2e({setFormat:R&&g||m,incomplete:I===E,pointsPerMinute:a,matchUpStatus:u,weightedRange:b,setNumber:E});if(v.push(C),M){T=_;break}if(bE({matchUp:{score:{sets:v},matchUpFormat:r}}).calculatedWinningSide)break}let S=bE({matchUp:{score:{sets:v},matchUpFormat:r,winningSide:i}}),U=T?i||T:S.calculatedWinningSide,{score:P}=ope({winningSide:U,score:{sets:v},matchUpStatus:u});return{outcome:{winningSide:U,matchUpStatus:u,score:P}}}function a2e({weightedRange:t=[0,1],pointsPerMinute:e,matchUpStatus:i,incomplete:n,setFormat:r,setNumber:a}){let s={setNumber:a},{setTo:o,tiebreakFormat:l,tiebreakAt:c,tiebreakSet:u,timed:d,minutes:p}=r,h=Ac(0,t.length-1),f=t[h],m;if(d){let g=p*e,v=Math.round(g*.2),y=g+Tl([1,-1])*v,b=$Re(y,2),I=[b,y-b];f&&I.reverse(),m=t[h]+1;let T=I[0]>I[1]&&1||I[1]>I[0]&&2||0;if(n){let[U,P]=I;return Object.assign(s,{side1Score:U,side2Score:P}),ca.includes(i)?{set:s,incomplete:n,winningSideNumber:m}:{set:s,incomplete:n}}T||(I[Ac(0,1)]+=1),T=I[0]>I[1]?1:2,T!==m&&I.reverse();let[w,S]=I;return Object.assign(s,{side1Score:w,side2Score:S,winningSide:m}),{set:s}}else{if(n)return s.side1Score=Ac(0,c),s.side2Score=Ac(0,c),ca.includes(i)&&(m=t[h]+1),{set:s,incomplete:n,winningSideNumber:m};{let g=Rt(1,o+1).map(S=>Rt(0,o+2-S).map(()=>S)).flat(),v=g[Ac(0,g.length-1)],y=o&&lW({isSide1:!0,tiebreakAt:c,lowValue:v,setTo:o}),b=!y,I=t.length===1&&t[h]+1;if(!b){I?(y[0]>y[1]?1:2)!==I&&y.reverse():f&&y.reverse();let[S,U]=y;Object.assign(s,{side1Score:S,side2Score:U})}let T=vE({matchUpScoringFormat:{setFormat:r},setObject:s}),w;if(T.hasTiebreakCondition||b){let{NoAD:S,tiebreakTo:U}=l||u||{},P=Rt(1,U+1).map(C=>Rt(0,U+2-C).map(()=>C)).flat(),E=P[Ac(0,P.length-1)],R=wO({isSide1:!0,tiebreakNoAd:S,tiebreakTo:U,lowValue:E});if(R)if(b){let C=R[0]>R[1]?1:2;I?C!==I&&R.reverse():f&&R.reverse(),[s.side1TiebreakScore,s.side2TiebreakScore]=R,w=R[0]>R[1]&&1||R[1]>R[0]&&2||void 0}else T.leadingSide===2?[s.side1TiebreakScore,s.side2TiebreakScore]=R:[s.side2TiebreakScore,s.side1TiebreakScore]=R}s.winningSide=T.winningSide||T.leadingSide||I||w}}return{set:s}}function u_(t){var v,y,b;let{matchUpStatusProfile:e,completeAllMatchUps:i,randomWinningSide:n,tournamentRecord:r,completionGoal:a,drawDefinition:s,event:o}=t;if(!s)return{error:Gt};let l=t.matchUpFormat||s.matchUpFormat||(o==null?void 0:o.matchUpFormat),c=s.structures.slice().sort(ZI),u=0,{matchUps:d,matchUpsMap:p}=ua({matchUpFilters:{matchUpTypes:[Zn],roundNumbers:[1]},contextFilters:{stages:[Ft,ni]},inContext:!0,drawDefinition:s});if(d!=null&&d.length){let I=((v=o==null?void 0:o.category)==null?void 0:v.ageCategoryCode)||((y=o==null?void 0:o.category)==null?void 0:y.categoryName);if(I){let T=$de({singlesOnly:!0,tournamentRecord:r,drawDefinition:s,scaleAccessor:{scaleName:I,sortOrder:Lde,scaleType:og},event:o});if(T.error)return T;let{lineUps:w,participantsToAdd:S}=T;Ku({tournamentRecord:r,participants:S}),dn({element:s,extension:{name:zf,value:w}})}else{let T=(b=d[0])==null?void 0:b.structureId,{positionAssignments:w}=jn({drawDefinition:s,structureId:T});if(w!=null&&w.length){let{participants:S}=vr({participantFilters:{participantTypes:[Zn]},tournamentRecord:r}),U=P=>{let E=P.tieMatchUps.filter(Fr(xn)),R=P.tieMatchUps.filter(Fr(Mn));E.forEach((C,M)=>{let _=C.matchUpId;C.sides.forEach(A=>{var O;let{drawPosition:N}=A,k=S==null?void 0:S.find($=>{var V;let{participantId:F}=$;return((V=w.find(j=>j.participantId===F))==null?void 0:V.drawPosition)===N});if(k){let $=(O=k.individualParticipantIds)==null?void 0:O[M];$&&o_({teamParticipantId:k.participantId,participantId:$,tournamentRecord:r,drawDefinition:s,tieMatchUpId:_,event:o})}})}),R.forEach((C,M)=>{let _=C.matchUpId;C.sides.forEach(A=>{var O,$;let{drawPosition:N}=A,k=S==null?void 0:S.find(F=>{var j;let{participantId:V}=F;return((j=w.find(B=>B.participantId===V))==null?void 0:j.drawPosition)===N});k&&(($=(O=k.individualParticipantIds)==null?void 0:O.slice(M*2,M*2+2))==null||$.forEach(F=>{o_({teamParticipantId:k.participantId,participantId:F,tournamentRecord:r,drawDefinition:s,tieMatchUpId:_,event:o})}))})})};d.forEach(U)}}}let h=typeof i=="string"&&i,f=h&&Lr,m=c.length===2&&c[0].finishingPosition===ey&&Nr(c.map(({stage:I})=>I),[Ft,Rr]).length===2,g=c.map(({structureId:I})=>I);for(let I of g){if(u>=a)break;let T=s.structures.find(U=>U.structureId===I),w=wn({contextFilters:{matchUpTypes:[Mn,xn]},afterRecoveryTimes:!1,tournamentRecord:r,inContext:!0,drawDefinition:s,matchUpsMap:p,structure:T,event:o}).matchUps;w.length;let S=w.filter(({winningSide:U})=>!U).sort(rw).map(Pa);for(let U of S){if(!isNaN(a)&&u>=a)break;let{matchUps:P}=wn({matchUpFilters:{matchUpTypes:[Mn,xn]},afterRecoveryTimes:!1,tournamentRecord:r,inContext:!0,drawDefinition:s,matchUpsMap:p,structure:T,event:o}),E=P.find(C=>C.matchUpId===U),R=[Yr,sa].includes(E.matchUpStatus);if(E!=null&&E.readyToScore&&!R){let C=s2e({matchUpStatusProfile:e,tournamentRecord:r,drawDefinition:s,targetMatchUp:E,matchUpFormat:l,matchUpStatus:f,scoreString:h,winningSide:!n&&1,event:o});if(C!=null&&C.error)return C;u+=1}}m&&T.finishingPosition===ey&&t.completeRoundRobinPlayoffs&&mU({structureId:T.structureId,applyPositioning:!0,drawDefinition:s})}return{...de,completedCount:u}}function Epe(t){let{matchUpStatusCodes:e,policyDefinitions:i,tournamentRecord:n,drawDefinition:r,targetMatchUp:a,matchUpStatus:s,matchUpFormat:o,scoreString:l,winningSide:c,event:u}=t;if(!a||a.matchUpStatus===mn)return;let{matchUpId:d}=a||{},{outcome:p}=I4({matchUpFormat:o,matchUpStatus:s,scoreString:l,winningSide:c});return e&&(p.matchUpStatusCodes=e),FC({tournamentRecord:n,policyDefinitions:i,drawDefinition:r,matchUpFormat:o,matchUpId:d,outcome:p,event:u})}function s2e(t){let{matchUpStatusProfile:e={},tournamentRecord:i,policyDefinitions:n,drawDefinition:r,matchUpStatus:a,matchUpFormat:s,targetMatchUp:o,scoreString:l,winningSide:c,event:u}=t;if(l||a)return Epe(t);let{matchUpId:d}=o||{},{outcome:p}=P4({matchUpStatusProfile:e,matchUpFormat:s,winningSide:c});return FC({policyDefinitions:n,tournamentRecord:i,drawDefinition:r,matchUpFormat:s,matchUpId:d,outcome:p,event:u})}function Ppe({matchUpStatusProfile:t,completeAllMatchUps:e,randomWinningSide:i,tournamentRecord:n,drawProfiles:r,isMock:a,event:s}){var m,g,v,y;let o=_r({event:s}).flightProfile,{eventName:l,eventType:c,category:u}=s,{startDate:d}=n,p=[],h=(u==null?void 0:u.categoryName)||(u==null?void 0:u.ageCategoryCode)||(u==null?void 0:u.ratingType),f=(m=s.drawDefinitions)==null?void 0:m.map(({drawId:b})=>b);if(Array.isArray(o==null?void 0:o.flights))for(let[b,I]of o.flights.entries()){let{drawId:T,stage:w,drawName:S,drawEntries:U}=I;p.push(I.drawId);let P=r[b],{seedsCount:E,generate:R=!0}=P||{};if(R){let C=U.filter(kl(Lh)).map(kl(Lh)),M=h||l;if(n&&E&&E<=C.length&&Rt(1,E+1).forEach((O,$)=>{let F={scaleValue:O,scaleName:M,scaleType:wh,eventType:c,scaleDate:d},V=C[$];PC({tournamentRecord:n,participantId:V,scaleItem:F})}),f==null?void 0:f.includes(T))break;let _=kC({...P,matchUpType:c,seedingScaleName:M,tournamentRecord:n,drawEntries:U,drawName:S,drawId:T,isMock:a,event:s,stage:w});if(_.error)return{error:_.error,drawIds:[]};let{drawDefinition:A}=_;if(!A)return{error:tc};let N=(g=r[b])==null?void 0:g.drawExtensions;if(Array.isArray(N)&&N.filter(Cp).forEach(O=>dn({element:A,extension:O})),_=xC({suppressNotifications:!0,tournamentRecord:n,drawDefinition:A,event:s}),_.error)return{error:_.error,drawIds:[]};if(P!=null&&P.withPlayoffs){let O=(v=A.structures)==null?void 0:v[0].structureId,$=cO({idPrefix:P.idPrefix,...P.withPlayoffs,tournamentRecord:n,drawDefinition:A,structureId:O,isMock:a,event:s});if($!=null&&$.error)return $}let k=P==null?void 0:P.completionGoal;if((P==null?void 0:P.automated)!==!1&&(e||k)){let O=P==null?void 0:P.matchUpFormat,$=u_({completeAllMatchUps:!k&&e,matchUpStatusProfile:t,randomWinningSide:i,tournamentRecord:n,completionGoal:k,drawDefinition:A,matchUpFormat:O,event:s});if($.error)return{error:$.error,drawIds:[]};let F=$.completedCount;if((P==null?void 0:P.drawType)===Oh){let V=(y=A.structures)==null?void 0:y.find(z=>z.stage===Ft);if(!V)return{error:gr};let j=mU({structureId:V.structureId,tournamentRecord:n,drawDefinition:A,event:s});if(j.error)return{error:j.error,drawIds:[]};let B=k?k-(F??0):void 0;if(j=u_({completeAllMatchUps:!k&&e,completionGoal:k?B:void 0,matchUpStatusProfile:t,randomWinningSide:i,tournamentRecord:n,drawDefinition:A,matchUpFormat:O,event:s}),j.error)return{error:j.error,drawIds:[]}}}}}return{...de,drawIds:p}}function Cpe(t){var w,S;let{participantsProfile:e={},uniqueParticipantsCount:i,ratingsParameters:n,tournamentRecord:r,eventProfile:a,eventIndex:s,event:o,uuids:l}=t,{category:c,gender:u,eventType:d}=o,p=Fr(Ep)(d)&&ji||Fr(Hc)(d)&&Ni||d,h=i[Ft]||0,f=i[ni]||0,m=(w=a.drawProfiles)!=null&&w.length?h+f:((S=a.participantsProfile)==null?void 0:S.participantsCount)??0,g=[Cn,Yn].includes(u)?u:void 0,v=e!=null&&e.idPrefix?`E-${s}-${e==null?void 0:e.idPrefix}`:void 0,{participants:y}=EU({uuids:a.uuids||l,...e,scaledParticipantsCount:a.scaledParticipantsCount,consideredDate:r==null?void 0:r.startDate,rankingRange:a.rankingRange,participantType:p,participantsCount:m,ratingsParameters:n,category:c,idPrefix:v,sex:g}),b=Ku({tournamentRecord:r,participants:y});if(b.error)return b;let I=y==null?void 0:y.filter(({participantType:U})=>U===p),T=y==null?void 0:y.map(Vi);return{uniqueDrawParticipants:I,uniqueParticipantIds:T}}function o2e({autoEntryPositions:t,tournamentRecord:e,drawParticipants:i,drawProfile:n,event:r}){let{drawType:a=mp,qualifyingPositions:s=0,stage:o=Ft,drawSize:l=0,drawName:c,drawId:u}=n,d=l-s,p=i.slice(0,d).map(Vi);if(p.length){let m=gp({participantIds:p,autoEntryPositions:t,entryStage:o,tournamentRecord:e,event:r});if(m.error)return m}let h=p.map(m=>({entryStatus:ol,entryStage:o,participantId:m})),f=jO({drawName:c||a,qualifyingPositions:s,drawEntries:h,drawId:u,event:r,stage:o});return f.error?f:{...de}}function Rpe({uniqueDrawParticipants:t,autoEntryPositions:e,stageParticipants:i,tournamentRecord:n,drawProfiles:r,category:a,gender:s,event:o}){let l=0;for(let c of r){let{qualifyingPositions:u=0,uniqueParticipants:d,stage:p=Ft,drawSize:h=0}=c,f=h-u,m=d||s||a||p===ni,g=m?t.slice(l,l+f):i[p||Ft]||[];m&&(l+=f);let v=o2e({autoEntryPositions:e,drawParticipants:g,tournamentRecord:n,drawProfile:c,event:o});if(v.error)return v}return{...de}}function Mpe(t){var J;let{allUniqueParticipantIds:e,matchUpStatusProfile:i,participantsProfile:n,completeAllMatchUps:r,autoEntryPositions:a,hydrateCollections:s,randomWinningSide:o,ratingsParameters:l,tournamentRecord:c,eventProfile:u,eventIndex:d,publish:p,isMock:h,uuids:f}=t,m=u.gender,g=u.eventName,{eventType:v=Ep,policyDefinitions:y,drawProfiles:b=[],eventExtensions:I,surfaceCategory:T,tieFormatName:w,processCodes:S,discipline:U,eventLevel:P,timeItems:E,ballType:R,category:C}=u,M=u.eventId||yn(),_=u.tieFormat||(v===na?Bf({namedFormat:w,event:{eventId:M,category:C,gender:m},hydrateCollections:s,isMock:h}):void 0),A=c.participants;for(let se of b)!m&&se.gender&&(m=se==null?void 0:se.gender);let{stageParticipantsCount:N,uniqueParticipantsCount:k,uniqueParticipantStages:O}=Upe({drawProfiles:b,category:C,gender:m}),$=Fr(Ep)(v)&&ji||Fr(Hc)(v)&&Ni||v,{uniqueDrawParticipants:F=[],uniqueParticipantIds:V=[]}=O?Cpe({event:{eventType:v,category:C,gender:m},uniqueParticipantsCount:k,participantsProfile:n,ratingsParameters:l,tournamentRecord:c,eventProfile:u,eventIndex:d,uuids:f}):{},{eventAttributes:j}=u;typeof j!="object"&&(j={});let B=(C==null?void 0:C.categoryName)||(C==null?void 0:C.ageCategoryCode)||(C==null?void 0:C.ratingType);g=g||B||"Generated Event";let z={...j,surfaceCategory:T,processCodes:S,discipline:U,eventLevel:P,eventName:g,eventType:v,tieFormat:_,ballType:R,category:C,eventId:M,gender:m};if(I!=null&&I.length&&Array.isArray(I)){let se=I.filter(Cp);se!=null&&se.length&&Object.assign(z,{extensions:se})}if(Array.isArray(E)&&E.forEach(se=>uw({event:K,timeItem:se})),typeof y=="object")for(let se of Object.keys(y))oy({policyDefinitions:{[se]:y[se]},event:z});z.category&&(z.category.categoryName=B);let W,Z=IU({suppressNotifications:!1,internalUse:!0,tournamentRecord:c,event:z});if(Z.error)return Z;let K=Z==null?void 0:Z.event,{stageParticipants:Q}=Dpe({allUniqueParticipantIds:e,stageParticipantsCount:N,eventParticipantType:$,targetParticipants:A});if(b!=null&&b.length){let se=Rpe({uniqueDrawParticipants:F,autoEntryPositions:a,stageParticipants:Q,tournamentRecord:c,drawProfiles:b,category:C,gender:m,event:K});if(se.error)return se;let ie=Ppe({matchUpStatusProfile:i,completeAllMatchUps:r,randomWinningSide:o,tournamentRecord:c,drawProfiles:b,isMock:h,event:K});if(ie.error)return ie;W=ie.drawIds}else if((J=u==null?void 0:u.participantsProfile)!=null&&J.participantsCount){let se=F.map(Vi);if(se.length){let ie=gp({participantIds:se,autoEntryPositions:a,tournamentRecord:c,entryStage:Ft,event:K});if(ie.error)return ie}}return p&&SU({tournamentRecord:c,event:K}),{drawIds:W,eventId:M,uniqueParticipantIds:V}}function C4({tournamentRecords:t,scheduleDate:e,venueId:i,round:n}){if(!El(e))return{error:Fa};let r="addSchedulingProfileRound",{extension:a}=ki({name:dI,tournamentRecords:t,discover:!0}),s=(a==null?void 0:a.value)||[],o=s.find(p=>kh(e,p.scheduleDate));if(!o){let{startDate:p,endDate:h}=UO({tournamentRecords:t}),f=new Date(e);if(p&&f<new Date(p)||h&&f>new Date(h))return{error:Fa};o={scheduleDate:e,venues:[]},s.push(o)}let l=o.venues.find(p=>p.venueId===i);l||(l={venueId:i,rounds:[]},o.venues.push(l));let c=["notBeforeTime"],u=p=>Object.keys(p).filter(h=>!c.includes(h)).sort().map(h=>Xi(p[h])?u(p[h]):p[h]).flat().join("|");if(l.rounds.find(p=>u(p)===u(n)))return he({result:{error:xre},stack:r});l.rounds.push(n);let d=yU({tournamentRecords:t,schedulingProfile:s});return d.error?d:{...de}}function l2e({schedulingProfile:t,tournamentRecord:e}){if(typeof t!="object")return{error:Re};let i=cU({tournamentRecord:e}).containedStructures,n=Wa({tournamentRecord:e}).matchUps??[],{tournamentId:r}=e,a=[];for(let s of t){let{scheduleDate:o,venues:l=[]}=s;for(let c of l){let{rounds:u,venueId:d}=c;for(let p of u){let{drawId:h,winnerFinishingPositionRange:f,roundSegment:m}=p,g=n.filter(v=>{var I;let y=(f==null?void 0:f.indexOf("-"))>0&&f.split("-").map(T=>+T),b=(I=v.finishingPositionRange)==null?void 0:I.winner;return v.drawId===h&&(!p.roundNumber||v.roundNumber===p.roundNumber)&&(!b||!y||Nr(b,y).length===2||Ei(b).length===Ei(y).length&&Nr(b,y).length===Ei(b).length)})[0];if(g){let{eventId:v,roundNumber:y,drawName:b,structureName:I,roundName:T}=g,w=g.structureId;y&&!f&&(w=Object.keys(i).find(P=>i[P].includes(w))??w);let S={tournamentId:r,structureId:w,roundNumber:y,roundSegment:m,eventId:v,drawId:h},U=C4({tournamentRecords:{[r]:e},round:S,scheduleDate:o,venueId:d});if(U.error)return U;a.push({structureName:I,roundName:T,drawName:b,...S})}}}}return{scheduledRounds:a}}function iL(t){var lt,Ct,Nt;let e=Qt(t,[{drawProfile:!0,_ofType:el}]);if(e.error)return e;let{allUniqueParticipantIds:i=[],participantsProfile:n={},matchUpStatusProfile:r,completeAllMatchUps:a,autoEntryPositions:s,hydrateCollections:o,randomWinningSide:l,ratingsParameters:c,tournamentRecord:u,isMock:d=!0,drawProfile:p,startDate:h,drawIndex:f,uuids:m}=t,g=_t(p,!1,!0),{excessParticipantAlternates:v=!0,matchUpFormat:y=Nu,drawType:b=mp,tournamentAlternates:I=0,alternatesCount:T=0,qualifyingPositions:w,qualifyingProfiles:S,generate:U=!0,eventExtensions:P,drawExtensions:E,completionGoal:R,tieFormatName:C,buildTeams:M,seedsCount:_,timeItems:A,drawName:N,category:k,idPrefix:O,publish:$,gender:F,stage:V}=g,j=g.drawSize||(g.ignoreDefaults?void 0:32),B=g.eventId||yn(),z=p.eventType||p.matchUpType||Ep,W=z===Hc?Ni:ji,Z=Xi(p.tieFormat)&&p.tieFormat||z===En&&Bf({event:{eventId:B,category:k,gender:F},namedFormat:C,hydrateCollections:o,isMock:d})||void 0,K=(k==null?void 0:k.categoryName)||(k==null?void 0:k.ageCategoryCode)||(k==null?void 0:k.ratingType),Q=p.eventName||K||`Generated ${z}`,J=(u==null?void 0:u.participants)||[],se=((S==null?void 0:S.map(Ce=>Ce.structureProfiles||[]).flat().reduce((Ce,Ge)=>{let $e=!Ge.participantsCount||Ge.participantsCount>Ge.drawSize?Ge.drawSize:Ge.participantsCount||0;return Ce+$e},0))||0)*(W===Ni?2:1),ie=(!p.participantsCount||p.participantsCount>j?j:p.participantsCount)||0,ce={eventName:Q,eventType:z,tieFormat:Z,category:k,eventId:B,gender:F};Array.isArray(A)&&A.forEach(Ce=>uw({event:ce,timeItem:Ce}));let{eventAttributes:oe}=p;if(typeof oe!="object"&&(oe={}),Object.assign(ce,oe),(P==null?void 0:P.length)&&Array.isArray(P)){let Ce=P.filter(Cp);Ce!=null&&Ce.length&&Object.assign(ce,{extensions:Ce})}let te=[];if((n==null?void 0:n.participantsCount)===0||p.uniqueParticipants||se||!u||F||k){let Ce=(ie||0)+T+se,Ge=Ce,$e={[Cn]:0,[Yn]:0},at,ct;z===En&&({teamSize:at,genders:ct}=E4({alternatesCount:T,tieFormatName:C,tieFormat:Z,drawSize:j}),Object.keys(ct).forEach(De=>{[Cn,Yn].includes(De)&&ct[De]&&($e[De]=j*ct[De])}),Ge=at*((j||0)+se));let Vt=n!=null&&n.idPrefix?`D-${f}-${n==null?void 0:n.idPrefix}`:void 0,Me=EU({...n,scaledParticipantsCount:p.scaledParticipantsCount||n.scaledParticipantsCount,participantsCount:Ge,consideredDate:u==null?void 0:u.startDate,sex:F||(n==null?void 0:n.sex),rankingRange:p.rankingRange,uuids:p.uuids||m,ratingsParameters:c,participantType:W,gendersCount:$e,idPrefix:Vt,category:k}).participants;if(ce.category&&(ce.category.categoryName=K),u){let De=Ku({participants:Me,tournamentRecord:u});if(De.error)return De}if(Me.forEach(({participantId:De})=>te.push(De)),J=Me,z===En){let De=ct[Cn]?Me.filter(({participantType:Fe,person:ht})=>Fe===ji&&(ht==null?void 0:ht.sex)===Cn).map(Vi):[],Je=ct[Yn]?Me.filter(({participantType:Fe,person:ht})=>Fe===ji&&(ht==null?void 0:ht.sex)===Yn).map(Vi):[],St=Me.filter(({participantType:Fe})=>Fe===ji).map(Vi).filter(Fe=>!De.includes(Fe)&&!Je.includes(Fe)),bt=[...g.teamNames??[],...c_({count:Ce}).names],Ie=at-(ct[Cn]+ct[Yn]),Ue=0,Oe=0,Ee=0,Xe=Rt(0,Ce).map(Fe=>{let ht=Je.slice(Ue,Ue+ct[Yn]),ti=De.slice(Oe,Oe+ct[Cn]),Ke=St.slice(Ee,Ee+Ie);Ue+=ct[Yn],Oe+=ct[Cn],Ee+=Ie;let zt=M!==!1?[...ht,...ti,...Ke]:[];return{participantName:bt[Fe]||`Team ${Fe+1}`,participantOtherName:`TM${Fe+1}`,participantRole:ms,individualParticipantIds:zt,participantType:En,participantId:yn()}}),Et=Ku({participants:Xe,tournamentRecord:u});if(!Et.success)return Et;J=Xe}}let le=Ce=>{let{participantType:Ge}=Ce;return Fr(Ep)(z)&&Ge===ji||Fr(Hc)(z)&&Ge===Ni?!0:z===En&&Ge===En},ne=Ce=>{var Ge,$e;return!p.gender||((Ge=Ce.person)==null?void 0:Ge.sex)===p.gender?!0:($e=Ce.individualParticipantIds)==null?void 0:$e.some(at=>{let ct=J.find(Vt=>Vt.participantId===at);return ct&&ne(ct)})},me=J.filter(le).filter(ne).filter(({participantId:Ce})=>!i.includes(Ce)),be=me.slice(0,ie).map(Ce=>Ce.participantId);if(d&&(be!=null&&be.length)){let Ce=gp({autoEntryPositions:s,entryStage:V,tournamentRecord:u,participantIds:be,event:ce});if(Ce.error)return Ce}let Se=se?me.slice(ie,ie+se).map(Ce=>Ce.participantId):0;if(d&&(Se!=null&&Se.length)){let Ce=0,Ge=1,$e=(ct,Vt)=>ct.stageSequence-Vt.stageSequence,at=(ct,Vt)=>ct.roundTarget-Vt.roundTarget;for(let ct of S.sort(at)){Ge=ct.roundTarget||Ge;let Vt=1,Me;for(let De of ct.structureProfiles.sort($e)){let Je=(De.drawSize||hz(De.participantsCount))-(Me||0),St=Se.slice(Ce,Ce+Je),bt=gp({entryStage:ni,entryStageSequence:Vt,autoEntryPositions:s,tournamentRecord:u,participantIds:St,roundTarget:Ge,event:ce});if(bt.error)return bt;Me=De.qualifyingPositions,Ce+=Je,Vt+=1}Ge+=1}}let we=v&&((lt=u==null?void 0:u.participants)==null?void 0:lt.filter(({participantId:Ce})=>!be.includes(Ce)).filter(le).filter(ne).slice(0,T||j-ie||I).map(Ce=>Ce.participantId));if(d&&(we!=null&&we.length)){let Ce=gp({participantIds:we,autoEntryPositions:!1,entryStatus:_u,tournamentRecord:u,event:ce});if(Ce.error)return Ce.error}let ze=K||Q;u&&_&&_<=be.length&&Rt(1,_+1).forEach((Ce,Ge)=>{let $e={scaleName:ze,scaleDate:h,scaleType:Qq,scaleValue:Ce,eventType:z},at=be[Ge];PC({tournamentRecord:u,participantId:at,scaleItem:$e})});let Qe=kC({..._t(p,!1,!0),tournamentRecord:u,seedingScaleName:ze,matchUpFormat:y,eventId:B,isMock:d,event:ce});if(Qe.error)return Qe;if(!Qe.drawDefinition)return{error:tc};let{drawDefinition:ke}=Qe,yt=ke.drawId;if(Array.isArray(E)&&E.filter(Cp).forEach(Ce=>dn({element:ke,extension:Ce})),U){if(xC({drawDefinition:ke,event:ce,suppressNotifications:!0}),p.withPlayoffs){let Ge=(Ct=ke.structures)==null?void 0:Ct[0].structureId,$e=cO({...p.withPlayoffs,tournamentRecord:u,drawDefinition:ke,structureId:Ge,idPrefix:O,isMock:d,event:ce});if($e!=null&&$e.error)return $e}let Ce=p.automated===!1;if(d&&!Ce){let Ge=$e=>{var Vt;let at=u_({completeAllMatchUps:$e.completeAllMatchUps,completionGoal:$e.completionGoal,matchUpStatusProfile:r,randomWinningSide:l,tournamentRecord:u,drawDefinition:ke,matchUpFormat:y,event:ce});if(at.error)return at;let ct=at.completedCount;if(b===Oh){let Me=(Vt=ke.structures)==null?void 0:Vt.find(St=>St.stage===Ft);if(!Me)return{error:gr};mU({structureId:Me.structureId,tournamentRecord:u,drawDefinition:ke,event:ce});let De=R?R-(ct??0):void 0,Je=u_({completionGoal:R?De:void 0,matchUpStatusProfile:r,completeAllMatchUps:a,randomWinningSide:l,tournamentRecord:u,drawDefinition:ke,matchUpFormat:y,event:ce});if(Je.error)return Je}};if(R&&Ge({completionGoal:R}),p.outcomes){let{matchUps:$e}=lo({inContext:!0,drawDefinition:ke,event:ce});for(let at of p.outcomes){let{matchUpStatus:ct=Lr,matchUpStatusCodes:Vt,stageSequence:Me=1,matchUpIndex:De=0,structureOrder:Je,matchUpFormat:St,drawPositions:bt,roundPosition:Ie,stage:Ue=Ft,roundNumber:Oe,winningSide:Ee,scoreString:Xe}=at,Et=($e==null?void 0:$e.reduce((Ke,zt)=>{let{structureId:mt,matchUpId:Tt}=zt;return Ke[mt]?Ke[mt].push(Tt):Ke[mt]=[Tt],Ke},{}))??[],Fe=Object.assign({},...Object.keys(Et).map((Ke,zt)=>({[Ke]:zt+1}))),ht=(Nt=$e==null?void 0:$e.filter(Ke=>(!Ue||Ke.stage===Ue)&&(!Me||Ke.stageSequence===Me)&&(!Oe||Ke.roundNumber===Oe)&&(!Ie||Ke.roundPosition===Ie)&&(!Je||Fe[Ke.structureId]===Je)&&(!bt||Nr(bt,Ke.drawPositions).length===2)))==null?void 0:Nt[De],ti=Epe({matchUpStatusCodes:Vt,tournamentRecord:u,drawDefinition:ke,targetMatchUp:ht,matchUpFormat:St,matchUpStatus:ct,scoreString:Xe,winningSide:Ee});if(ti!=null&&ti.error)return ti}}a&&Ge({completeAllMatchUps:a})}$&&SU({tournamentRecord:u,event:ce})}else{let Ce=jO({drawEntries:ke.entries,drawName:N||b,qualifyingPositions:w,drawId:yt,event:ce,stage:V});if(Ce.error)return Ce}return{...de,event:Kt(ce),uniqueParticipantIds:te,targetParticipants:J,drawDefinition:ke,eventId:B,drawId:yt}}var Npe=()=>({altitude:void 0,courtId:void 0,courtName:"",courtDimensions:void 0,latitude:void 0,longitude:void 0,surfaceCategory:void 0,surfaceType:void 0,surfacedDate:void 0,dateAvailability:[],onlineResources:[],pace:void 0,notes:void 0}),c2e=Npe;function d_(t){return parseInt(t)}function xZ({startTime:t="",endTime:e=""}={}){if(!t||!e||!Ov.test(t)||!Ov.test(e))return!1;let[i,n]=t.split(":").map(d_),[r,a]=e.split(":").map(d_);return r<i?!1:!(i===r&&a<n)}function u2e(t,e){let[i,n]=t.startTime.split(":").map(d_),[r,a]=e.startTime.split(":").map(d_);return i<r?-1:i>r?1:n<a?-1:n>a?1:0}function Ape({dateAvailability:t}){if(!t)return{error:Zre};if(!Array.isArray(t))return{error:xN};let e="Dates must be formated => YYYY-MM-DD",i="Times must be 24 hour => 00:00";for(let n of t){if(typeof n!="object")return{error:xN};let{date:r,startTime:a,endTime:s,bookings:o=[]}=n;if(!a||!s)return{error:xN};if(r&&!Dp.test(r))return{error:Fa,dateAvailability:{date:r},info:e};if(!Ov.test(a))return{error:bu,dateAvailability:{startTime:a},info:i};if(!Ov.test(s))return{error:bu,dateAvailability:{endTime:s},info:i};if(a===s)return{error:bu,dateAvailability:{startTime:a,endTime:s},info:"startTime and endTime are equivalent"};if(!xZ({startTime:a,endTime:s}))return{error:bu,dateAvailability:{startTime:a,endTime:s},info:"endTime must be after startTime"};if(o){if(!Array.isArray(o))return{error:kA};for(let l of o){if(typeof l!="object")return{error:kA};let{startTime:c,endTime:u}=l;if(!Ov.test(c))return{error:bu,booking:{startTime:c},info:i};if(!Ov.test(u))return{error:bu,booking:{endTime:u},info:i};if(c===u)return{error:bu,dateAvailability:{startTime:c,endTime:u},info:"startTime and endTime are equivalent"};if(!xZ({startTime:c,endTime:u}))return{error:bu,dateAvailability:{startTime:c,endTime:u},info:"endTime must be after startTime"}}}}return{valid:!0}}function nL({tournamentRecord:t,disableNotice:e,venueId:i,courtId:n,court:r}){let{venue:a}=Xh({tournamentRecord:t,venueId:i});if(!a)return{error:HI};a.courts||(a.courts=[]);let s={...Npe(),venueId:i,courtId:n};if(s.courtId||(s.courtId=yn()),a.courts.some(o=>o.courtId===s.courtId))return{error:hae};{let o=((r==null?void 0:r.dateAvailability)||[]).map(u=>{var d;return{...u,date:Ri(u.date),startTime:rr(u.startTime),endTime:rr(u.endTime),bookings:(d=u.bookings)==null?void 0:d.map(({startTime:p,endTime:h,bookingType:f})=>({startTime:rr(p),endTime:rr(h),bookingType:f}))}}),l=Object.keys(s);for(let u of l)if(r!=null&&r[u])if(u==="dateAvailability"){let d=Ape({dateAvailability:o});if(!d.valid&&d.error)return d;s.dateAvailability=o}else s[u]=r[u];let c=s;return a.courts.push(c),e||Si({payload:{venue:a,tournamentId:t.tournamentId},topic:Oy,key:a.venueId}),{...de,court:_t(s),venueId:i}}}function R4(t){let{tournamentRecord:e,venueId:i}=t;if(typeof i!="string"||!i)return{error:Og};let n=t.tournamentRecords??(e&&{[e.tournamentId]:e})??{},r=[],a;for(let s of Object.values(n)){let{venue:o}=Xh({tournamentRecord:s,venueId:i});if(o){let l=d2e({...t,tournamentRecord:s});for(let c of(l==null?void 0:l.courts)??[])r.push(c==null?void 0:c.courtId);if(l.error)return l;a=!0}}return a?{...de,courtIds:r}:{error:HI}}function d2e({courtNameRoot:t="Court",dateAvailability:e=[],venueAbbreviationRoot:i,tournamentRecord:n,courtNames:r=[],courtTimings:a,courtsCount:s,startTime:o,courtIds:l,endTime:c,idPrefix:u,venueId:d,dates:p}){if(!d)return{error:Og};let h=Xh({tournamentRecord:n,venueId:d});if(h.error)return h;let{venue:f}=h;if(!Dr(s)||!r)return{error:pae};s=s??r.length;let m=Rt(0,s).map(g=>{let v=a==null?void 0:a[g],y=v?p.map(b=>({date:Mu(b),startTime:o,endTime:c,...v})):e;return v&&o&&c&&y.push({startTime:o,endTime:c}),{courtName:r[g]||i&&(f==null?void 0:f.venueAbbreviation)&&`${f==null?void 0:f.venueAbbreviation} ${g+1}`||`${t} ${g+1}`,dateAvailability:y}}).map((g,v)=>{let y=(l==null?void 0:l.pop())||u&&`${u}-${v+1}`;return nL({disableNotice:!0,tournamentRecord:n,courtId:y,venueId:d,court:g})}).map(g=>g.court).filter(Boolean);return m.length!==s?he({info:"not all courts could be generated",result:{error:Re}}):(f&&Si({payload:{venue:f,tournamentId:n.tournamentId},topic:Oy,key:f.venueId}),{...de,courts:_t(m)})}function M4({tournamentRecord:t,ignoreExistingVenues:e,venueProfiles:i,uuids:n}){let{startDate:r,endDate:a}=t,s=[];for(let[o,l]of i.entries()){let{venueAbbreviation:c,venueId:u=(n==null?void 0:n.pop())??yn(),dateAvailability:d,startTime:p="07:00",endTime:h="19:00",courtTimings:f,courtsCount:m,courtNames:g,venueName:v,idPrefix:y,courtIds:b}=l,I={venueName:v||`Venue ${o+1}`,venueAbbreviation:c,venueId:u},T=rC({tournamentRecord:t,venue:I});if(T.error){if(e)continue;return T}s.push(u);let w=NS(r,a),S=!Array.isArray(d)&&[{startTime:p,endTime:h}].concat(w.map(U=>({date:Mu(U),startTime:p,endTime:h})));if(m||g){let U=R4({dateAvailability:d||S,tournamentRecord:t,courtTimings:f,courtsCount:m,courtNames:g,startTime:p,idPrefix:y,courtIds:b,endTime:h,venueId:u,dates:w});if(U.error)return U}}return s}function p2e(t){var u,d,p;let{tournamentRecord:e,leagueProfiles:i,eventIds:n,venueIds:r,drawIds:a,allUniqueParticipantIds:s,uuids:o}=t,l=0;for(let h of i){let f=[],{tieFormatName:m=BA,teamProfiles:g=[],teamsCount:v=0,category:y,idPrefix:b,gender:I}=h,T=h.leagueName??h.eventName??`League ${l+1}`,w=h.leagueId??h.eventId??(o==null?void 0:o.pop())??yn();n.push(w);let S=Xi(h.tieFormat)&&h.tieFormat||Bf({event:{eventId:w,category:y,gender:I},namedFormat:m,isMock:t.isMock})||void 0;if(!S)return{error:XT};let U=Math.max(v,g.length),P=Rt(0,U),{genders:E,teamSize:R}=E4({tieFormat:S,drawSize:U}),C={[Yn]:0,[Oo]:0,[xv]:0,[Cn]:0,[Ad]:0};Object.keys(E).forEach(_=>C[_]+=E[_]);for(let _ of P){let A=((u=g==null?void 0:g[_])==null?void 0:u.teamName)??`Team ${_+1}`,N=((d=g==null?void 0:g[_])==null?void 0:d.teamId)||(o==null?void 0:o.pop())||yn(),k=h.startDate??t.startDate,O=EU({...h==null?void 0:h.participantsProfile,participantsCount:R,consideredDate:k,gendersCount:C,category:y,gender:I,uuids:o}).participants,$=O.map(W=>W.participantId),F=En,V=N??l_({participantType:F,idPrefix:b,index:_,uuids:o});f.push({participantId:V,entryStatus:ol,entryStage:Ft});let j=((p=g==null?void 0:g[_])==null?void 0:p.venueIds)??[],B={participantId:V,participantRole:ms,participantName:A,individualParticipantIds:$,participantType:F,homeVenueIds:j};j.forEach(W=>!r.includes(W)&&r.push(W)),s.push(...$),s.push(V);let z=Ku({participants:[B,...O],tournamentRecord:e});if(z.error)return z}let M={eventName:T,entries:f,eventType:En,tieFormat:S,category:y,eventId:w,gender:I};if(e.events||(e.events=[]),e.events.push(M),f.length){let _=(Dr(h.roundsCount)&&h.roundsCount)??h.roundsCount===yNe?(U-1)*2:U-1,A=kC({automated:h.automated,tournamentRecord:e,drawType:nc,roundsCount:_,drawSize:U,event:M});if(A.error)return A;let{drawDefinition:N}=A;if(N){let k=N==null?void 0:N.drawId;xC({drawDefinition:N,event:M,suppressNotifications:!0}),a.push(k)}}l++}let c=r.map(h=>({venueId:h}));M4({tournamentRecord:e,ignoreExistingVenues:!0,venueProfiles:c,uuids:o})}var h2e=["Generated Tournament","CourtHive Challenge","Replication Crisis","Open Competition","Factory Follies","Mock Tournament","Atomic Culture","Racket Rally","Stats Fail"];function _pe(t){var y,b,I;let{startDate:e,endDate:i}=t??{},{tournamentName:n=Tl(h2e),ratingsParameters:r=Da,tournamentExtensions:a,policyDefinitions:s,schedulingProfile:o,venueProfiles:l,uuids:c}=t??{},u=(t==null?void 0:t.isMock)===!1?void 0:!0;if(e&&!El(e)||i&&!El(i))return{error:Fa};if(t.leagueProfiles&&!Array.isArray(t.leagueProfiles)||t.eventProfiles&&!Array.isArray(t.eventProfiles)||t.drawProfiles&&!Array.isArray(t.drawProfiles))return{error:Re};if(!e){let T=new Date;e=Mu(i??T),i=Mu(T.setDate(T.getDate()+7))}if(!i){let T=new Date(e);i=Mu(T.setDate(T.getDate()+7))}let d=tL({...t.tournamentAttributes??{},tournamentName:n,startDate:e,endDate:i,isMock:u}),p=l!=null&&l.length?M4({tournamentRecord:d,venueProfiles:l,uuids:c}):[];if(a!=null&&a.length&&Array.isArray(a)){let T=a.filter(w=>Cp({extension:w}));T!=null&&T.length&&Object.assign(d,{extensions:T,isMock:u})}if(typeof s=="object")for(let T of Object.keys(s))oy({policyDefinitions:{[T]:s[T]},tournamentRecord:d});if(!((y=t==null?void 0:t.leagueProfiles)!=null&&y.length)||(b=t.eventProfiles)!=null&&b.length||(I=t.drawProfiles)!=null&&I.length||t.participantsProfile){let T=Tpe({tournamentRecord:d,...t});if(!T.success)return T}let h=[],f=[],m=[];if(t.leagueProfiles){let T=p2e({allUniqueParticipantIds:h,tournamentRecord:d,...t,eventIds:f,venueIds:p,drawIds:m});if(T!=null&&T.error)return T}if(t.drawProfiles){let T=f2e({allUniqueParticipantIds:h,ratingsParameters:r,tournamentRecord:d,...t,eventIds:f,drawIds:m});if(T!=null&&T.error)return T}if(t.eventProfiles){let T=m2e({allUniqueParticipantIds:h,ratingsParameters:r,tournamentRecord:d,...t,eventIds:f,drawIds:m});if(T!=null&&T.error)return T}let{scheduledRounds:g=void 0,schedulerResult:v={}}=o?g2e({...t,tournamentRecord:d}):{};return jz(),Kt({...de,tournamentRecord:d,scheduledRounds:g,schedulerResult:v,eventIds:f,venueIds:p,drawIds:m})}function f2e(t){let{tournamentRecord:e,drawProfiles:i,allUniqueParticipantIds:n,eventIds:r,drawIds:a}=t,s=0;for(let o of i){let l=iL({allUniqueParticipantIds:n,tournamentRecord:e,drawProfile:o,drawIndex:s,...t});if(l.error)return l;let{drawId:c,eventId:u,event:d,uniqueParticipantIds:p}=l;if((o==null?void 0:o.addEvent)!==!1){if(l=IU({suppressNotifications:!1,internalUse:!0,tournamentRecord:e,event:d}),l.error)return l;c&&a.push(c),r.push(u)}p!=null&&p.length&&n.push(...p),s+=1}}function m2e(t){let{eventProfiles:e,allUniqueParticipantIds:i,eventIds:n,drawIds:r}=t,a=0;for(let s of e){let o=Mpe({...t,eventIndex:a,eventProfile:s});if(o.error)return o;let{eventId:l,drawIds:c,uniqueParticipantIds:u}=o;c&&r.push(...c),n.push(l),u!=null&&u.length&&i.push(...u),a+=1}}function g2e(t){let{schedulingProfile:e,tournamentRecord:i,autoSchedule:n,periodLength:r,scheduleCompletedMatchUps:a}=t,s=l2e({schedulingProfile:e,tournamentRecord:i});if(s.error)return s;let o=s.scheduledRounds;if(n){let{tournamentId:l}=i,c={[l]:i};return{schedulerResult:eL({scheduleCompletedMatchUps:a,tournamentRecords:c,periodLength:r}),scheduledRounds:o}}return{scheduledRounds:o}}var kpe={};Li(kpe,{anonymizeTournamentRecord:()=>xpe,modifyTournamentRecord:()=>Ope});function xpe({keepExtensions:t=[],anonymizeParticipantNames:e=!0,tournamentRecord:i,tournamentName:n,personIds:r=[],tournamentId:a}){var O,$,F,V,j;if(!i)return{error:ut};let s=Array.isArray(t)?qK.concat(...t):qK,o=B=>{var z;return Array.isArray(t)?(z=B==null?void 0:B.extensions)==null?void 0:z.filter(W=>s.includes(W.name)):B==null?void 0:B.extensions},l={};i.extensions=o(i);let c=a||yn();l[i.tournamentId]=c,i.tournamentId=c,i.createdAt=new Date().toISOString(),i.tournamentName=n||`Anonymized: ${Mu(new Date)}`,i.isMock=!0,delete i.parentOrganisation;for(let B of i.participants||[]){B.extensions=o(B),B.onlineResources=[];let z=yn();l[B.participantId]=z,B.participantId=z}for(let B of i.participants||[])Array.isArray(B.individualParticipantIds)&&(B.individualParticipantIds=B.individualParticipantIds.map(z=>l[z]));let u=0;for(let B of i.venues||[]){B.venueAbbreviation=`V${u}`,B.extensions=o(B),B.venueName=`Venue #${u}`,B.onlineResources=[],B.addresses=[];let z=yn();l[B.venueId]=z,B.isMock=!0,u+=1;let W=0;for(let Z of B.courts||[])Z.courtName=`V${u}C${W}`,Z.extensions=o(Z),Z.onlineResources=[],Z.isMock=!0,W+=1}let d=1;for(let B of i.events||[]){B.extensions=o(B),B.onlineResources=[],B.isMock=!0;let z=yn();l[B.eventId]=z,B.eventId=z;let W=((O=B.category)==null?void 0:O.categoryName)||(($=B.category)==null?void 0:$.ageCategoryCode)||((F=B.category)==null?void 0:F.ratingType)||B.gender;if(B.eventName=`Event ${d} ${W}`,Array.isArray(B.entries))for(let K of B.entries)K.participantId=l[K.participantId];for(let K of B.drawDefinitions||[]){K.extensions=o(K);let Q=yn();if(l[K.drawId]=Q,K.drawId=Q,K.isMock=!0,Array.isArray(K.entries))for(let se of K.entries)se.participantId=l[se.participantId];let J=se=>{se.extensions=o(se);let ie=yn();l[se.structureId]=ie,se.structureId=ie;for(let ce of se.positionAssignments||[])ce.participantId&&(ce.participantId=l[ce.participantId]);for(let ce of se.seedAssignments||[])ce.participantId&&(ce.participantId=l[ce.participantId]);for(let ce of se.matchUps||[]){ce.isMock=!0;for(let oe of ce.sides||[])oe.lineUp&&(oe.lineUp=oe.lineUp.map(({participantId:te,collectionAssignments:le})=>({participantId:l[te],collectionAssignments:le})))}};for(let se of K.structures||[])if(J(se),Array.isArray(se.structures))for(let ie of se.structures)J(ie);for(let se of K.links||[])se.source.structureId=l[se.source.structureId],se.target.structureId=l[se.target.structureId]}let{extension:Z}=ki({name:qu,element:B});Array.isArray((V=Z==null?void 0:Z.value)==null?void 0:V.flights)&&((j=Z==null?void 0:Z.value.flights)==null||j.forEach(K=>{if(K.drawId=l[K.drawId],Array.isArray(K.drawEntries))for(let Q of K.drawEntries)Q.participantId=l[Q.participantId]})),d+=1}let p=i.startDate||Mu(new Date),h=(i.participants||[]).filter(({participantType:B})=>B===ji),f=h.reduce((B,z)=>{var Z;let W=(Z=z.person)==null?void 0:Z.sex;return[Cn,Yn].includes(W)?B[W]+=1:B[xv]+=1,B},{[Cn]:0,[Yn]:0,[xv]:0}),m=Object.assign({},...Object.keys(f).map(B=>{var z;return{[B]:((z=Spe({category:{ageCategoryCode:"O18"},count:f[B],addressProps:{citiesCount:10},personExtensions:[],consideredDate:p,sex:B}))==null?void 0:z.persons)||[]}})),g={[Cn]:0,[Yn]:0,[xv]:0},v=h.length,y=h.reduce((B,z)=>{var J,se;let W=((se=(J=z.person)==null?void 0:J.addresses)==null?void 0:se[0])||{},{city:Z,state:K,postalCode:Q}=W;return B.cities.includes(Z)||B.cities.push(Z),B.states.includes(K)||B.states.push(K),B.postalCodes.includes(Q)||B.postalCodes.push(Q),B},{cities:[],postalCodes:[],states:[]}),b=y.postalCodes.length,I=y.cities.length,T=y.states.length,{cities:w}=ype({count:I||v,participantsCount:v}),{states:S}=bpe({count:T||v,participantsCount:v}),{postalCodes:U}=Ipe({count:b||v,participantsCount:v}),P={cities:w,states:S,postalCodes:U};h.forEach((B,z)=>{var se,ie;let W=B==null?void 0:B.person,Z=(W==null?void 0:W.sex)||xv,K=(se=Ri(W==null?void 0:W.birthDate))==null?void 0:se.split("-")[0],Q=g[Z],J=m[Z][Q];if(g[Z]+=1,K){let[,ce,oe]=((ie=J==null?void 0:J.birthDate)==null?void 0:ie.split("-"))||[],te=[K,ce,oe].join("-");J.birthDate=te}if(W!=null&&W.addresses){let ce=wpe({...P,participantIndex:z,nationalityCode:J.nationalityCode});J.addresses=[ce]}J.personId=(r==null?void 0:r[z])||yn(),e?(J.standardFamilyName=J.lastName,J.standardGivenName=J.firstName,B.participantName=`${J.standardGivenName} ${J.standardFamilyName}`):(J.standardFamilyName=W==null?void 0:W.standardFamilyName,J.standardGivenName=W==null?void 0:W.standardGivenName),delete J.firstName,delete J.lastName,J.extensions=o(W),B.person=J,l[W==null?void 0:W.personId]=J.personId}),(i.participants||[]).filter(({participantType:B})=>B===Ni).forEach(B=>{let{individualParticipantIds:z}=B;B.participantName=v2e({individualParticipantIds:z,individualParticipants:h})});let E=(i.participants||[]).filter(({participantType:B})=>B===En),R=E.length,C=c_({count:R}).names;E.forEach((B,z)=>{B.participantName=C[z]});let M=(i.participants||[]).filter(({participantType:B})=>B===pc),_=M.length,A=c_({count:_,nameRoot:"Group"}).names;M.forEach((B,z)=>{B.participantName=A[z]});let{extension:N}=ki({element:i,name:dI});Array.isArray(N==null?void 0:N.value)&&(N==null||N.value.forEach(B=>{B.tournamentId=l[B.tournamentId],B.structureId=l[B.structureId],B.eventId=l[B.eventId],B.drawId=l[B.drawId]}));let{extension:k}=ki({element:i,name:oU});return Array.isArray(k==null?void 0:k.value)&&(k==null||k.value.forEach(B=>{B.personId=l[B.personId]})),{...de}}function v2e({individualParticipantIds:t,individualParticipants:e}){let i=e.filter(({participantId:n})=>t.includes(n)).map(({person:n})=>n==null?void 0:n.standardFamilyName).filter(Boolean).sort().join("/");return t.length===1&&(i+="/Unknown"),i}function Ope(t){var P,E,R;let{ratingsParameters:e=Da,participantsProfile:i={},matchUpStatusProfile:n,completeAllMatchUps:r,autoEntryPositions:a,hydrateCollections:s,randomWinningSide:o,schedulingProfile:l,tournamentRecord:c,autoSchedule:u,eventProfiles:d,periodLength:p,venueProfiles:h,drawProfiles:f,isMock:m,uuids:g}=t;if(!c)return{error:ut};let v=[],y=[],b=[];d==null||d.forEach(C=>{var _;let M=(_=c.events)==null?void 0:_.find((A,N)=>C.eventIndex!==void 0&&N===C.eventIndex||C.eventName&&A.eventName===C.eventName||C.eventId&&A.eventId===C.eventId);M!=null&&M.gender&&(C.gender=M.gender)});let I=((P=c.participants)==null?void 0:P.length)||void 0;I&&(i!=null&&i.idPrefix)&&(i.idPrefix=`${i.idPrefix}-${I}`);let T=Tpe({startDate:c.startDate,participantsProfile:i,tournamentRecord:c,eventProfiles:d,drawProfiles:f,uuids:g});if(!T.success)return T;if(d){let C=((E=c.events)==null?void 0:E.length)||0;for(let M of d){let{ratingsParameters:_}=M,A=(R=c.events)==null?void 0:R.find((N,k)=>M.eventIndex!==void 0&&k===M.eventIndex||M.eventName&&N.eventName===M.eventName||M.eventId&&N.eventId===M.eventId);if(A){let{gender:N,category:k,eventType:O}=A,{drawProfiles:$,publish:F}=M,V=Fr(Ep)(O)&&ji||Fr(Hc)(O)&&Ni||O;if($){let{stageParticipantsCount:j,uniqueParticipantsCount:B,uniqueParticipantStages:z}=Upe({drawProfiles:$,category:k,gender:N}),{uniqueDrawParticipants:W=[],uniqueParticipantIds:Z=[]}=z?Cpe({event:{eventType:O,category:k,gender:N},uniqueParticipantsCount:B,participantsProfile:i,ratingsParameters:_,tournamentRecord:c,eventProfile:M,uuids:g}):{};v.push(...Z);let{stageParticipants:K}=Dpe({targetParticipants:c.participants||[],allUniqueParticipantIds:v,stageParticipantsCount:j,eventParticipantType:V}),Q=Rpe({uniqueDrawParticipants:W,autoEntryPositions:a,stageParticipants:K,tournamentRecord:c,drawProfiles:$,category:k,gender:N,event:A});if(Q.error||(Q=Ppe({matchUpStatusProfile:n,completeAllMatchUps:r,randomWinningSide:o,tournamentRecord:c,drawProfiles:$,isMock:m,event:A}),Q.error))return Q;b.push(...Q.drawIds)}F&&SU({tournamentRecord:c,event:A})}else{let N=Mpe({startDate:c.startDate,allUniqueParticipantIds:v,matchUpStatusProfile:n,participantsProfile:i,completeAllMatchUps:r,autoEntryPositions:a,randomWinningSide:o,ratingsParameters:_,tournamentRecord:c,eventProfile:M,eventIndex:C,uuids:g});if(N.error)return N;let{eventId:k,drawIds:O,uniqueParticipantIds:$}=N;O&&b.push(...O),y.push(k),$!=null&&$.length&&v.push(...$),C+=1}}}if(f){let C=(c.events||[]).map(M=>{var _;return((_=M.drawDefinitions)==null?void 0:_.map(()=>1))||[]}).flat().reduce((M,_)=>M+_,0);for(let M of f){let _=iL({startDate:c.startDate,allUniqueParticipantIds:v,matchUpStatusProfile:n,participantsProfile:i,completeAllMatchUps:r,autoEntryPositions:a,hydrateCollections:s,randomWinningSide:o,ratingsParameters:e,tournamentRecord:c,drawProfile:M,drawIndex:C,uuids:g});if(_.error)return _;let{drawId:A,eventId:N,event:k,uniqueParticipantIds:O}=_;if(_=IU({tournamentRecord:c,event:k,internalUse:!0}),_.error)return _;A&&b.push(A),y.push(N),O!=null&&O.length&&v.push(...O),C+=1}}let w=h!=null&&h.length?M4({tournamentRecord:c,venueProfiles:h}):[],S,U={};if(l!=null&&l.length){let C={[c.tournamentId]:c},M=yU({tournamentRecords:C,schedulingProfile:l});if(M.error)return M;if(u){let{tournamentId:_}=c,A={[_]:c};U=eL({tournamentRecords:A,periodLength:p})}}return{totalParticipantsCount:c.participants.length,scheduledRounds:S,schedulerResult:U,...de,eventIds:y,venueIds:w,drawIds:b}}var N4={};Li(N4,{addDynamicRatings:()=>J3,addIndividualParticipantIds:()=>qO,addParticipant:()=>Np,addParticipants:()=>Ku,addPenalty:()=>nhe,addPersonRequests:()=>jpe,addPersons:()=>rhe,createGroupParticipant:()=>Ype,createTeamsFromParticipantAttributes:()=>D4,deleteParticipants:()=>sw,filterParticipants:()=>uC,findParticipant:()=>Wpe,getCompetitionParticipants:()=>hW,getPairedParticipant:()=>Yu,getParticipantEventDetails:()=>fW,getParticipantMembership:()=>mW,getParticipantScaleItem:()=>qS,getParticipantSchedules:()=>gW,getParticipantSignInStatus:()=>vW,getParticipantTimeItem:()=>Hq,getParticipants:()=>vr,getScaleValues:()=>aU,mergeParticipants:()=>ihe,modifyIndividualParticipantIds:()=>Gpe,modifyParticipant:()=>WO,modifyParticipantName:()=>Kpe,modifyParticipantOtherName:()=>zpe,modifyParticipantsSignInStatus:()=>Hpe,modifyPenalty:()=>ehe,modifyPersonRequests:()=>Bpe,mutate:()=>Lpe,participantScaleItem:()=>Th,query:()=>Vue,regenerateParticipantNames:()=>qpe,removeIndividualParticipantIds:()=>c3,removeParticipantIdsFromAllTeams:()=>Qx,removePenalty:()=>Jpe,removePersonRequests:()=>Vpe,removeRatings:()=>Xpe,scaledTeamAssignment:()=>Zpe,setParticipantScaleItem:()=>PC,setParticipantScaleItems:()=>Fce,validateLineUp:()=>tO});var Lpe={};Li(Lpe,{addDynamicRatings:()=>J3,addIndividualParticipantIds:()=>qO,addParticipant:()=>Np,addParticipants:()=>Ku,addPenalty:()=>nhe,addPersonRequests:()=>jpe,addPersons:()=>rhe,createGroupParticipant:()=>Ype,createTeamsFromParticipantAttributes:()=>D4,deleteParticipants:()=>sw,findParticipant:()=>Wpe,mergeParticipants:()=>ihe,modifyIndividualParticipantIds:()=>Gpe,modifyParticipant:()=>WO,modifyParticipantName:()=>Kpe,modifyParticipantOtherName:()=>zpe,modifyParticipantsSignInStatus:()=>Hpe,modifyPenalty:()=>ehe,modifyPersonRequests:()=>Bpe,regenerateParticipantNames:()=>qpe,removeIndividualParticipantIds:()=>c3,removeParticipantIdsFromAllTeams:()=>Qx,removePenalty:()=>Jpe,removePersonRequests:()=>Vpe,removeRatings:()=>Xpe,scaledTeamAssignment:()=>Zpe,setParticipantScaleItem:()=>PC,setParticipantScaleItems:()=>Fce});function Fpe(t=0){(typeof t!="number"||isNaN(t))&&(t=0);let e=new Date;return e.setHours(e.getHours()+t),e.getTime().toString(36).slice(-6).toUpperCase()}function $pe({personRequests:t,personId:e,requests:i}){t[e]||(t[e]=[]);let n=i.filter(({requestType:r})=>r).map(r=>{let{date:a,startTime:s,endTime:o}=r;return r.requestType===BC&&(a=Ri(a),s=rr(s),o=rr(o),a&&s&&o)?{date:a,startTime:s,endTime:o,requestType:r.requestType}:r}).filter(Boolean);for(let r of n)r.requestId=Fpe(),t[e].push(r);return{mergeCount:n.length}}function A4(t){let{tournamentRecords:e,personRequests:i}=t,n=Qt(t,[{[ks]:!0}]);if(n.error)return n;if(!i)return{...de};let r=Object.values(e);for(let a of r){let s=a.participants??[],o=[];for(let l of Object.keys(i))if(lg({tournamentParticipants:s,personId:l})){let c=i[l];c.length&&o.push({personId:l,requests:c})}Object.keys(o).length&&dn({element:a,extension:{value:o,name:oU}})}return{...de}}function Bpe(t){let{tournamentRecords:e,requests:i,personId:n}=t,r=Qt(t,[{[ks]:!0},{requests:!0,[qo]:Rs,[rc]:Re}]);if(r.error)return r;let a=i.map(({requestId:c})=>c).filter(Boolean),{personRequests:s}=zy({tournamentRecords:e}),o=c=>{s&&(s[c]=s[c].map(u=>{if(!a.includes(u.requestId))return u;let d=i.find(p=>p.requestId===u.requestId);if(d.requestType)return Object.assign(u,d)}).filter(Boolean))};if(n&&(s!=null&&s[n]))o(n);else if(s)for(let c of Object.keys(s))o(c);let l=i.filter(c=>!c.requestId);return l.length&&$pe({personRequests:s,personId:n,requests:l}),A4({tournamentRecords:e,personRequests:s})}function Vpe(t){let{tournamentRecords:e,requestType:i,requestId:n,personId:r,date:a}=t,s=Qt(t,[{[ks]:!0}]);if(s.error)return s;let{personRequests:o}=zy({tournamentRecords:e}),l=u=>{var d;o&&(o[u]=o[u].filter(p=>(!i||p.requestType!==i)&&(!n||p.requestId!==n)&&(!a||p.date!==a)),(d=o==null?void 0:o[u])!=null&&d.length||delete o[u])},c=!i&&!n&&!r&&!a;if(!c){if(r&&(o!=null&&o[r]))l(r);else if(o)for(let u of Object.keys(o))l(u)}return c||!o||!Object.keys(o).length?oo({name:oU,tournamentRecords:e,discover:!0}):A4({tournamentRecords:e,personRequests:o})}function jpe(t){let{tournamentRecords:e,personId:i,requests:n}=t,r=Qt(t,[{[ks]:!0,[DNe]:!0},{requests:!0,[qo]:Rs,[rc]:Re}]);if(r.error)return r;let{personRequests:a}=zy({tournamentRecords:e}),{mergeCount:s}=$pe({personRequests:a,personId:i,requests:n});return s&&a?A4({tournamentRecords:e,personRequests:a}):{error:Re}}function Gpe({individualParticipantIds:t,groupingParticipantId:e,tournamentRecord:i}){let n="modifyIndividualParticipantIds";if(!i)return he({result:{error:ut},stack:n});if(!e||!t)return he({result:{error:ai},stack:n});let r=i.participants||[],a=r.find(h=>h.participantId===e);if(!a)return he({result:{error:xr},stack:n});if(![En,pc].includes(a.participantType))return he({result:{error:Nd},context:{participantType:a.participantType},stack:n});let s=t.filter(h=>{var f;return((f=r.find(m=>m.participantId===h))==null?void 0:f.participantType)!==ji});if(s.length)return he({result:{error:Dl,invalidParticipantIds:s},stack:n});let o=a.individualParticipantIds||[],l=t.filter(h=>!o.includes(h)),c=o.filter(h=>!t.includes(h)),u=qO({individualParticipantIds:l,groupingParticipantId:e,tournamentRecord:i});if(u.error)return he({result:u,stack:n});let d=c3({individualParticipantIds:c,groupingParticipantId:e,tournamentRecord:i});if(d.error)return he({result:d,stack:n});let{topics:p}=dc();if(p.includes(Is)){let h=r.find(({participantId:f})=>f===e);Si({topic:Is,payload:{tournamentId:i.tournamentId,participants:[h]}})}return{...u,...d}}function Hpe({tournamentRecord:t,participantIds:e,signInState:i}){if(!t)return{error:ut};if(!Array.isArray(e))return{error:ai};if(![uE,voe].includes(i))return{error:Re,signInState:i};let n=t.participants||[];if(!n.length)return{error:AP};let r=n.map(Vi),a=e.filter(c=>!r.includes(c));if(a.length)return{error:Re,context:{invalidParticipantIds:a}};let s=[],o=new Date().toISOString();for(let c of n){let{participantId:u}=c;if(e.includes(u)){let d=$3({duplicateValues:!1,tournamentRecord:t,participantId:u,timeItem:{itemType:qP,itemValue:i,createdAt:o}});if(d.error)return d;s.push(c)}}let{topics:l}=dc();return s.length&&l.includes(Is)&&Si({topic:Is,payload:{tournamentId:t.tournamentId,participants:s}}),{...de}}function zpe({tournamentRecord:t,participantId:e,participantOtherName:i}){if(!t)return{error:ut};if(!e)return{error:la};let{participant:n}=jg({tournamentRecord:t,participantId:e});if(!n)return{error:xr};n.participantOtherName=i;let{topics:r}=dc();return r.includes(Is)&&Si({topic:Is,payload:{tournamentId:t.tournamentId,participants:[n]}}),{...de}}function OZ({personFormat:t,person:e}){let i=m=>m.replace(/\W/g,""),n=m=>/^[a-z]*$/.test(i(m)),r=m=>/^[A-Z]*$/.test(i(m)),a=m=>/^[LAST]{4}/.test(i(m)),s=m=>m.toLowerCase().indexOf("l")<m.toLowerCase().indexOf("f"),o=m=>m.indexOf(",")>=0,l=m=>m.toLowerCase().indexOf("f.")>=0,c=m=>m.toLowerCase().indexOf("f")<0,u=m=>m.indexOf(" ")>0;if(!e)return;let d=u(t)?" ":"",p=GV((e==null?void 0:e.standardGivenName)??""),h=GV((e==null?void 0:e.standardFamilyName)??"");if(!t)return`${p}${d}${h}`;l(t)&&!o(t)&&!s(t)&&(p=`${p[0]}.`),n(t)?(p=p.toLowerCase(),h=h.toLowerCase()):r(t)?(p=p.toUpperCase(),h=h.toUpperCase()):a(t)&&(h=h.toUpperCase());let f=`${p}${d}${h}`;return c(t)?f=h:s(t)&&(o(t)?f=`${h},${d}${p}`:f=`${h}${d}${p}`),f}function y2e({participantMap:t,participant:e,formats:i}){let{participantType:n,individualParticipantIds:r,person:a}=e,s=n&&i[n];if(n!==Lo&&s){let{personFormat:o,doublesJoiner:l}=s;n===ji&&(e.participantName=OZ({person:a,personFormat:o})),n===Ni&&(e.participantName=r==null?void 0:r.map(c=>{var d;let u=(d=t[c])==null?void 0:d.person;return OZ({person:u,personFormat:o})}).filter(Boolean).join(l??"/"))}}function qpe({tournamentRecord:t,formats:e}){if(!t)return{error:ut};if(!Xi(e))return{error:ai};let i=t.participants??[],n=bre(i,"participantId");for(let r of i)y2e({participant:r,participantMap:n,formats:e});return{...de}}function Wpe(t){let{tournamentRecord:e,policyDefinitions:i,contextProfile:n,participantId:r,personId:a}=t,s=t.tournamentRecords||e&&{[e.tournamentId]:e}||{};if(typeof r!="string"&&typeof a!="string")return{error:ai,stack:"publicFindParticipant"};let o,l;for(let c of Object.values(s)){l=c.tournamentId;let u=c.participants||[];if(o=lg({tournamentParticipants:u,internalUse:!0,policyDefinitions:i,contextProfile:n,participantId:r,personId:a}),o)break}return{participant:o,tournamentId:l,...de}}function Ype({individualParticipantIds:t=[],participantRoleResponsibilities:e,participantRole:i=ale,tournamentRecord:n,participantId:r,groupName:a}){if(!n)return{error:ut};if(!a)return{error:ai,info:"Missing groupName"};if(!Array.isArray(t))return{info:"Invalid individualParticipantIds",error:Re};let s=(vr({participantFilters:{participantTypes:[ji]},tournamentRecord:n}).participants??[]).map(u=>u.participantId);for(let u of t)if(!s.includes(u))return{error:Nd,participantId:u};let o=Kt({participantId:r||yn(),participantRoleResponsibilities:e,participantName:a,individualParticipantIds:t,participantType:pc,participantRole:i}),l=Np({participant:o,tournamentRecord:n});if(l.error)return l;let{topics:c}=dc();return c.includes(ug)&&Si({topic:ug,payload:{tournamentId:n.tournamentId,participants:[o]}}),{...de,participant:_t(o)}}function Kpe({tournamentRecord:t,participantName:e,participantId:i}){if(!t)return{error:ut};if(!i)return{error:la};if(!e)return{error:ai,info:"Missing participantName"};let{participant:n}=jg({tournamentRecord:t,participantId:i});if(!n)return{error:xr};n.participantName=e;let{topics:r}=dc();return r.includes(Is)&&Si({topic:Is,payload:{tournamentId:t.tournamentId,participants:[n]}}),{...de}}function Zpe({clearExistingAssignments:t=!0,individualParticipantIds:e,reverseAssignmentOrder:i,initialTeamIndex:n=0,scaledParticipants:r=[],teamParticipantIds:a,tournamentRecord:s,scaleAttributes:o,teamNameBase:l,teamsCount:c,eventId:u,event:d}){var v,y,b,I,T;if(!s)return{error:ut};if(!Array.isArray(a)&&!Ii(c)&&!u||!Ii(n)||r&&!Array.isArray(r)||o&&(typeof o!="object"||!Object.keys(o).length))return{error:Re};if(!o&&!r.length||!r&&!(e&&o))return{error:ai,info:"Missing scaling details"};if(u&&!a){if((d==null?void 0:d.eventType)!==Al)return{error:_h};a=(v=d==null?void 0:d.entries)==null?void 0:v.filter(({entryStatus:w})=>w===ol).map(Vi)}if(!(a!=null&&a.length)&&!c)return{info:"Missing teamParticipantIds or teamsCount",error:ai};let p=e??r.map(({participantId:w})=>w);i&&(a==null||a.reverse(),n+=1),n>((a==null?void 0:a.length)||0)-1&&(n=0);let h=(a==null?void 0:a.slice(n).concat(...a.slice(0,n)))??[],f=[];for(let w of s.participants??[]){let{participantId:S,participantType:U}=w;if(h.includes(S)){if(U!==Lo)return{error:Nd,participant:w};f.push(w)}}if(c&&f.length<c){let w=c-((f==null?void 0:f.length)||0),S=l??"Team",U=Rt(0,w).map(C=>({participantName:`${S} ${C+1}`,participantType:Lo,participantRole:ms})),{participants:P=[]}=Ku({participants:U,returnParticipants:!0,tournamentRecord:s}),E=P.map(Vi),R=((y=s.participants)==null?void 0:y.filter(({participantId:C})=>E.includes(C)))??[];f.push(...R)}if(!f.length)return{error:Lz};if(t)for(let w of f)w.individualParticipantIds=[];else{let w=f.map(S=>S).flat();e!=null&&e.length?p=p.filter(S=>!w.includes(S)):r=r==null?void 0:r.filter(({participantId:S})=>!w.includes(S))}if(!(e!=null&&e.length)&&!(r!=null&&r.length))return{error:cx,info:"Nothing to be done"};if(!r.length){for(let w of s.participants??[]){let{participantId:S,participantType:U}=w;if(!p.includes(S))continue;if(U!==ji)return{error:Nd,participant:w};let P=(b=Th({scaleAttributes:o,participant:w}))==null?void 0:b.scaleItem,E=o!=null&&o.accessor?(I=P==null?void 0:P.scaleValue)==null?void 0:I[o==null?void 0:o.accessor]:P==null?void 0:P.scaleValue,R={participantId:S,scaleValue:E};r.push(R)}if(!r.length)return{error:xr}}r.sort((w,S)=>o!=null&&o.sortOrder?((S==null?void 0:S.scaleValue)||0)-((w==null?void 0:w.scaleValue)||0):((w==null?void 0:w.scaleValue)||1/0)-((S==null?void 0:S.scaleValue)||1/0));for(let w of r)if(!w.participantId)return{error:Re,scaledParticipant:w};let m=0;for(;m<r.length;){for(let w of f){if(m+1>r.length)break;let S=r[m];w.individualParticipantIds.push(S.participantId),m++}f.reverse()}let g=f.map(Vi);for(let w of s.events??[]){if(w.eventType!==Al)continue;let S=(w.entries??[]).filter(U=>g.includes(U.participantId));for(let U of S){let P=U.participantId,E=(T=f.find(C=>C.participantId===P))==null?void 0:T.individualParticipantIds;w.entries=(w.entries??[]).filter(C=>!E.includes(C.participantId)),(w.drawDefinitions??[]).forEach(C=>{C.entries=(C.entries??[]).filter(M=>!E.includes(M.participantId))});let{flightProfile:R}=_r({event:w});((R==null?void 0:R.flights)||[]).forEach(C=>{C.drawEntries=(C.drawEntries||[]).filter(M=>!E.includes(M.participantId))})}}return{...de,scaledParticipants:r}}function Xpe(t){let e=Qt(t,[{[ba]:!0,[lq]:!0},{ratingType:!1,[ds]:s=>Da[s]}]);if(e.error)return e;let i=`${t.ratingType}.${pq}`,n=t.asDynamic?i:t.ratingType,r=[ty,tg,t.eventType,n].join("."),a=t.tournamentRecord.participants??[];for(let s of a)s.timeItems&&(s.timeItems=s.timeItems.filter(o=>o.itemType!==r));return{...de}}function Jpe(t){let{tournamentRecords:e}=t;if(typeof e!="object"||!Object.keys(e).length)return{error:wr};for(let i of Object.values(e)){let n=b2e({...t,tournamentRecord:i});if(n.error&&n.error!==MS)return n}return{...de}}function b2e({tournamentRecord:t,penaltyId:e}){if(!t)return{error:ut};if(!e)return{error:Az};let i=(t==null?void 0:t.participants)??[],n=[],r=!1,a;return i.forEach(s=>{let o=!1;s.penalties=(s.penalties??[]).filter(l=>(l.penaltyId===e&&(o=!0,r||(a=l,r=!0)),o&&n.push(s),l.penaltyId!==e))}),a&&Si({topic:Is,payload:{tournamentId:t.tournamentId,participants:n}}),a?{...de,penalty:a}:{error:MS}}var I2e=({penaltyId:t=yn()}={})=>({refereeParticipantId:void 0,penaltyCode:void 0,penaltyType:void 0,extensions:void 0,matchUpId:void 0,createdAt:void 0,issuedAt:void 0,notes:void 0,penaltyId:t}),Qpe=I2e;function ehe(t){let{tournamentRecords:e}=t;if(typeof e!="object"||!Object.keys(e).length)return{error:wr};for(let i of Object.values(e)){let n=w2e({...t,tournamentRecord:i});if(n.error&&n.error!==MS||n.success)return n}return{error:MS}}function w2e({tournamentRecord:t,modifications:e,penaltyId:i}){if(!t)return{error:ut};if(!e)return{error:Re,modifications:e};if(!i)return{error:Az};let n=(t==null?void 0:t.participants)??[],r=Object.keys(Qpe()).filter(l=>l!=="penaltyId"),a=Object.keys(e).filter(l=>r.includes(l));if(!a.length)return{error:ux};let s,o=[];return n.forEach(l=>{let c=!1;l.penalties=(l.penalties??[]).map(u=>(u.penaltyId===i&&(c=!0,a.forEach(d=>Object.assign(u,{[d]:e[d]})),s||(s=u)),u)),c&&o.push(l)}),s&&Si({topic:Is,payload:{tournamentId:t.tournamentId,participants:o}}),s?{...de,penalty:s}:{error:MS}}function the(t,e,i){return!t&&e?e:t&&!e||typeof t!="object"||typeof e!="object"?t:Ei(Object.keys(t).concat(Object.keys(e))).reduce((n,r)=>{if(!e[r])n[r]=t[r];else if(!t[r])n[r]=e[r];else if(typeof t[r]!=typeof e[r])n[r]=e[r];else if(Array.isArray(t[r]))if(i===!0||Array.isArray(i)&&i.includes(r)){let a=Ei(t[r].map(s=>JSON.stringify(s)).concat(e[r].map(s=>JSON.stringify(s)))).map(s=>JSON.parse(s));n[r]=a}else n[r]=e[r];else typeof t[r]=="object"?n[r]=the(t[r],e[r],i):n[r]=e[r];return n},{})}function ihe({participants:t=[],tournamentRecord:e,arraysToMerge:i}){if(!e)return{error:ut};e.participants||(e.participants=[]);let n=t.filter(kl(Lh)).map(c=>({[c.participantId]:c})),r=Object.assign({},...n),a=[];e.participants=e.participants.map(c=>{if(r[c.participantId]){let u=the(c,r[c.participantId],i);return a.push(u),u}return c});let s=e.participants.map(kl(Lh))||[],o=t.filter(({participantId:c})=>!s.includes(c)),{topics:l}=dc();return o.length&&(e.participants=e.participants.concat(...o),l.includes(ug)&&Si({topic:ug,payload:{participants:o}})),a.length&&l.includes(Is)&&Si({topic:Is,payload:{tournamentId:e.tournamentId,participants:a}}),{modifiedParticipantsCount:a.length,newParticipantsCount:o.length,...de}}function nhe(t){var a;let{tournamentRecord:e,participantIds:i}=t,n=t.tournamentRecords??(e&&{[e.tournamentId]:e})??{},r;for(let s of Object.values(n)){let o=(a=vr({tournamentRecord:s}).participants??[])==null?void 0:a.map(Vi).filter(l=>i.includes(l));o.length&&(r=S2e({...t,penaltyId:t.penaltyId??r,tournamentRecord:s,participantIds:o}).penaltyId)}return r?{...de,penaltyId:r}:{error:xr}}function S2e({refereeParticipantId:t,tournamentRecord:e,participantIds:i,penaltyCode:n,penaltyType:r,extensions:a,penaltyId:s,matchUpId:o,issuedAt:l,notes:c}){if(!e)return{error:ut};if(!i)return{error:la};if(!r)return{error:dae};let u=((e==null?void 0:e.participants)??[]).filter(h=>i.includes(h.participantId));if(!u.length)return{error:xr};let d=new Date().toISOString(),p=Object.assign(Qpe({penaltyId:s}),{refereeParticipantId:t,penaltyCode:n,penaltyType:r,matchUpId:o,createdAt:d,issuedAt:l,notes:c});return Array.isArray(a)&&a.forEach(h=>dn({element:p,extension:h})),u.forEach(h=>{h.penalties||(h.penalties=[]),h.penalties.push(p)}),Si({topic:Is,payload:{tournamentId:e.tournamentId,participants:u}}),{...de,penaltyId:p.penaltyId}}function rhe({participantRole:t=ms,tournamentRecord:e,persons:i}){var f;if(!e)return{error:ut};if(!Array.isArray(i))return{error:Re};if(!Object.keys(zg).includes(t))return{error:eae};let n=(e.participants||[]).map(({person:m})=>m==null?void 0:m.personId).filter(Boolean),r=[],a=i.filter(m=>m&&(!m.personId||!n.includes(m.personId))).map(m=>(m.personId||(m.personId=yn()),r.push(m.personId),m)),s=(m,g)=>Object.assign({},...Object.keys(m).filter(v=>!g.includes(v)).map(v=>({[v]:m[v]}))),o=a.map(m=>Kt({extensions:m.participantExtensions,timeItems:m.participantTimeItems,participantType:ji,participantRole:t,person:s(m,["participantExtensions","participantTimeItems","pairedPersons"])})),l=0,c=0,u=Ku({participants:o,tournamentRecord:e});if(u.error)return u;c=u.addedCount||0;let d=[],p=((f=vr({participantFilters:{participantTypes:[ji]},tournamentRecord:e}))==null?void 0:f.participants)??[];if(t===ms&&i.filter(({pairedPersons:m})=>m).forEach(({personId:m,pairedPersons:g})=>{Array.isArray(g)&&g.forEach(v=>{let y=[m,v.personId].map(b=>lg({tournamentParticipants:p,personId:b})).filter(Boolean);if(y.length===2){let b=y.map(Vi);d.push(Kt({extensions:v.participantExtensions,timeItems:v.timeItems,participantRole:ms,individualParticipantIds:b,participantType:Ni}))}})}),d.length){if(u=Ku({participants:d,tournamentRecord:e}),u.error)return u;l=u.addedCount||0}let h=c+l;return{...de,addedCount:h,newPersonIds:r}}var rL={};Li(rL,{bulkUpdatePublishedEventIds:()=>UW,getAllEventData:()=>DW,getCourtInfo:()=>Yx,getDrawData:()=>PO,getEventData:()=>CO,getEventPublishStatus:()=>iu,getPublishState:()=>aw,getTournamentPublishStatus:()=>cC,getVenueData:()=>GS,mutate:()=>ahe,publishEvent:()=>SU,publishEventSeeding:()=>she,publishOrderOfPlay:()=>dhe,publishParticipants:()=>uhe,query:()=>Wue,setEventDisplay:()=>VO,unPublishEvent:()=>phe,unPublishEventSeeding:()=>ohe,unPublishOrderOfPlay:()=>che,unPublishParticipants:()=>lhe});var ahe={};Li(ahe,{publishEvent:()=>SU,publishEventSeeding:()=>she,publishOrderOfPlay:()=>dhe,publishParticipants:()=>uhe,setEventDisplay:()=>VO,unPublishEvent:()=>phe,unPublishEventSeeding:()=>ohe,unPublishOrderOfPlay:()=>che,unPublishParticipants:()=>lhe});function she({removePriorValues:t=!0,stageSeedingScaleNames:e,seedingScaleNames:i,tournamentRecord:n,status:r=hc,drawIds:a=[],event:s}){var d,p,h,f;if(!n)return{error:ut};if(!s)return{error:Jn};let o=iu({event:s,status:r}),l=(((d=o==null?void 0:o.seeding)==null?void 0:d.seedingScaleNames)||i)&&{...(p=o==null?void 0:o.seeding)==null?void 0:p.seedingScaleNames,...i},c=(((h=o==null?void 0:o.seeding)==null?void 0:h.stageSeedingScaleNames)||e)&&{...(f=o==null?void 0:o.seeding)==null?void 0:f.stageSeedingScaleNames,...e},u=Kt({stageSeedingScaleNames:c,seedingScaleNames:l,published:!0,drawIds:a});return wU({statusObject:{seeding:u},removePriorValues:t,status:r,event:s}),Si({topic:doe,payload:{tournamentId:n.tournamentId,eventId:s.eventId,drawIds:a}}),{...de}}function ohe({removePriorValues:t=!0,seedingScaleNames:e,tournamentRecord:i,status:n=hc,drawIds:r,stages:a,event:s}){var l,c;if(!i)return{error:ut};if(!s)return{error:Jn};let o=iu({event:s});if(o){let u=o.seeding;if(Array.isArray(a)&&u.stageSeedingScaleNames)for(let d of a)u.stageSeedingScaleNames[d]&&delete u.stageSeedingScaleNames[d];Array.isArray(e)&&(u!=null&&u.seedingScaleNames)&&(u.seedingScaleNames=u.seedingScaleNames.filter(d=>!e.includes(d))),Array.isArray(r)&&(u!=null&&u.drawIds)&&(u.drawIds=u.drawIds.filter(d=>!r.includes(d))),(!Object.values(u.stageSeedingScaleNames??{}).length&&!((l=u.seedingScaleNames)!=null&&l.length)&&!((c=u.drawIds)!=null&&c.length)||!a&&!e&&!(r!=null&&r.length))&&(delete u.stageSeedingScaleNames,delete u.seedingScaleNames,delete u.drawIds,u.published=!1),wU({statusObject:{seeding:u},removePriorValues:t,status:n,event:s})}return Si({topic:Bq,payload:{tournamentId:i.tournamentId,eventId:s.eventId}}),{...de}}function lhe(t){let e=Jc(t);if(!Object.keys(e).length)return{error:wr};for(let i of Object.values(e)){let n=T2e({tournamentRecord:i,...t});if(n.error)return n}return{...de}}function T2e({removePriorValues:t=!0,tournamentRecord:e,status:i=hc}){if(!e)return{error:ut};let n=`${Gg}.${Hg}`,{timeItem:r}=Qc({element:e,itemType:n}),a=(r==null?void 0:r.itemValue)||{[i]:{}};return a[i]&&delete a[i].participants,qp({timeItem:{itemValue:a,itemType:n},element:e,removePriorValues:t}),Si({payload:{tournamentId:e.tournamentId},topic:XNe}),{...de}}function che(t){let e=Jc(t);if(!Object.keys(e).length)return{error:wr};for(let i of Object.values(e)){let n=U2e({tournamentRecord:i,...t});if(n.error)return n}return{...de}}function U2e({removePriorValues:t=!0,tournamentRecord:e,status:i=hc}){if(!e)return{error:ut};let n=`${Gg}.${Hg}`,{timeItem:r}=Qc({element:e,itemType:n}),a=(r==null?void 0:r.itemValue)||{[i]:{}};return a[i]&&delete a[i].orderOfPlay,qp({timeItem:{itemValue:a,itemType:n},element:e,removePriorValues:t}),Si({topic:Vq,payload:{tournamentId:e.tournamentId}}),{...de}}function uhe(t){let e=Jc(t);if(!Object.keys(e).length)return{error:wr};for(let i of Object.values(e)){let n=D2e({tournamentRecord:i,...t});if(n.error)return n}return{...de}}function D2e({removePriorValues:t,tournamentRecord:e,status:i=hc}){if(!e)return{error:ut};let n=`${Gg}.${Hg}`,{timeItem:r}=Qc({element:e,itemType:n}),a=(r==null?void 0:r.itemValue)||{[i]:{}};return a[i].participants={published:!0},qp({timeItem:{itemValue:a,itemType:n},element:e,removePriorValues:t}),Si({payload:{tournamentId:e.tournamentId},topic:hoe}),{...de}}function dhe(t){let e=Jc(t);if(!Object.keys(e).length)return{error:wr};for(let i of Object.values(e)){let n=E2e({tournamentRecord:i,...t});if(n.error)return n}return{...de}}function E2e({scheduledDates:t=[],removePriorValues:e,tournamentRecord:i,status:n=hc,eventIds:r=[]}){if(!i)return{error:ut};let a=`${Gg}.${Hg}`,{timeItem:s}=Qc({element:i,itemType:a}),o=(s==null?void 0:s.itemValue)||{[n]:{}};return o[n].orderOfPlay={published:!0,scheduledDates:t,eventIds:r},qp({timeItem:{itemValue:o,itemType:a},element:i,removePriorValues:e}),Si({topic:poe,payload:{tournamentId:i.tournamentId,scheduledDates:t,eventIds:r}}),{...de}}function phe({removePriorValues:t=!0,tournamentRecord:e,status:i=hc,event:n}){if(!e)return{error:ut};if(!n)return{error:Jn};let r=`${Gg}.${Hg}`,{timeItem:a}=WP({itemType:r,event:n}),s=(a==null?void 0:a.itemValue)||{[i]:{}};return delete s[i].structureIds,delete s[i].drawDetails,delete s[i].drawIds,uw({event:n,timeItem:{itemValue:s,itemType:r},removePriorValues:t}),wU({statusObject:{structureIds:void 0,drawIds:void 0,seeding:void 0},removePriorValues:t,status:i,event:n}),Si({topic:$q,payload:{tournamentId:e.tournamentId,eventId:n.eventId}}),{eventId:n.eventId,...de}}var _4={};Li(_4,{getEntryStatusReports:()=>C2e,getParticipantStats:()=>P2e,getStructureReports:()=>M2e,getVenuesReport:()=>A2e});function P2e({withCompetitiveProfiles:t,opponentParticipantId:e,withIndividualStats:i,teamParticipantId:n,tournamentRecord:r,withScaleValues:a,tallyPolicy:s,matchUps:o}){var S,U,P,E,R;if(!r)return{error:ut};if(o&&!Array.isArray(o))return{error:al};if(o=o??Wa({tournamentRecord:r,participantsProfile:a?{withScaleValues:a}:void 0}).matchUps,!(o!=null&&o.length))return{error:ym};let l=[];e&&l.push(e),n&&l.push(n);let c=l.length?{participantIds:l}:{participantTypes:[Lo]},u=vr({participantFilters:c,tournamentRecord:r}).participants??[];if(!u.every(({participantType:C})=>C===Lo))return{error:Dl};l.length||l.push(...u.map(Vi));let d=new Map,p=new Map,h=new Map,f=new Map,m=(C,M="")=>p.get(C)||p.set(C,{participantName:M,participantId:C,competitorIds:[],competitiveness:{},matchUpStatuses:{},tiebreaks:[0,0],matchUps:[0,0],points:[0,0],games:[0,0],sets:[0,0]})&&p.get(C);for(let C of u){let{participantId:M,individualParticipantIds:_}=C;f.set(M,_??[]),m(M,C.participantName)}if(n&&!f.get(n))return he({result:{error:xr},context:{teamParticipantId:n}});if(e&&!f.get(e))return he({result:{error:xr},context:{opponentParticipantId:e}});let g=[],v=C=>{let M=[[],[]];for(let A of C){let N=A.participant;if(N!=null&&N.participantName){d.set(N.participantId,{participantName:N.participantName,ratings:N.ratings});let k=p.get(N.participantId);k&&(k.participantName=N.participantName)}}let _=({side:A,individualParticipantIds:N})=>{var k,O,$,F,V;return A.participantId&&(!(N!=null&&N.length)||N.includes(A.participantId))&&[A.participantId]||((O=(k=A.participant)==null?void 0:k.individualParticipantIds)==null?void 0:O.length)&&(!(N!=null&&N.length)||Nr(N,($=A.participant)==null?void 0:$.individualParticipantIds).length===((V=(F=A.participant)==null?void 0:F.individualParticipantIds)==null?void 0:V.length))&&A.participant.individualParticipantIds};if(f.size){let A=(N,k)=>{for(let O of C){if(!O.participant)continue;let $=_({individualParticipantIds:k,side:O});if($!=null&&$.length){let F=O.sideNumber;if(!F)continue;let V=[N];i&&V.push(...$),M[F-1]=V;let j=p.get(N);for(let B of $.filter(Boolean))j&&!j.competitorIds.includes(B)&&j.competitorIds.push(B)}}};if(n)(!e||C.every(N=>N.participant&&(_({individualParticipantIds:f.get(n),side:N})||_({individualParticipantIds:f.get(e),side:N}))))&&A(n,f.get(n));else for(let[N,k]of f)A(N,k)}else if(i)for(let A of C){if(!A.participant)continue;let N=_({individualParticipantIds:[],side:A}),k=A.sideNumber;k&&(M[k-1]=N)}return M};for(let C of o){if(!Xi(C))return{error:al};let{matchUpStatus:M,matchUpFormat:_,matchUpType:A,winningSide:N,score:k,sides:O}=C;if(!O||!k||A===ec||M===mn)continue;let $=v(O);if(!$.filter(Boolean).length)continue;let F=t&&N&&((S=iC({matchUp:C}))==null?void 0:S.competitiveness);g.push(C);let V=A3({matchUpStatus:M,matchUpFormat:_,tallyPolicy:s,winningSide:N,score:k}),j=ece({matchUpStatus:M,matchUpFormat:_,tallyPolicy:s,winningSide:N,score:k}),{pointsTally:B,tiebreaksTally:z}=tce({matchUpFormat:_,score:k});$.forEach((W,Z)=>{var K;for(let Q of W){let J=(K=d.get(Q))==null?void 0:K.participantName,se=m(Q,J);if(se){let ie=(ne,me)=>me.forEach((be,Se)=>se[ne][Se]+=be),ce=Z?[...z].reverse():z,oe=Z?[...B].reverse():B,te=Z?[...j].reverse():j,le=Z?[...V].reverse():V;if(ie("tiebreaks",ce),ie("points",oe),ie("games",te),ie("sets",le),N){let ne=N-1===Z?0:1;se.matchUps[ne]+=1}if(F){let ne=F.toLowerCase();se.competitiveness[ne]||(se.competitiveness[ne]=[0,0]),se.competitiveness[ne][Z]+=1}if(M){let ne=M.toLowerCase();se.matchUpStatuses[ne]||(se.matchUpStatuses[ne]=0),se.matchUpStatuses[ne]+=1}}}})}let y=["tiebreaks","matchUps","points","games","sets"],b=["competitive","routine","decisive"],I=new Map,T=(C,M)=>(C??0)+(M??0);for(let[C,M]of p.entries()){for(let _ of y){let A=M[_].reduce(T);if(A){let N=M[_][0]/A,k=`${_}Ratio`,O=parseFloat(N.toFixed(2));M[k]=O,h.set(C,!0),I.has(k)||I.set(k,[]),(U=I.get(k))==null||U.push(O)}}for(let _ of b){let A=(E=(P=M.competitiveness)==null?void 0:P[_])==null?void 0:E.reduce(T);if(A){let N=M.competitiveness[_][0]/A,k=`${_}Ratio`,O=parseFloat(N.toFixed(2));M[k]=O}}}if(!n){let C=(M,_)=>_-M;for(let M of p.values())for(let _ of y){let A=`${_}Ratio`;if(typeof M[A]=="number"){let N=(R=I.get(A))==null?void 0:R.sort(C).indexOf(M[A]);if(typeof N=="number"&&N>=0){let k=`${_}Rank`;M[k]=N+1}}}}let w={relevantMatchUps:g,...de};return n?(w.teamStats=p.get(n),e&&(w.opponentStats=p.get(e))):w.participatingTeamsCount=h.size,w.allParticipantStats=[...p.values()],w}function p_({participant:t,eventType:e}){var c,u,d,p,h,f;let i=(c=t==null?void 0:t.person)==null?void 0:c.personId,n=(d=(u=t==null?void 0:t.person)==null?void 0:u.personOtherIds)==null?void 0:d[0],r=(p=t==null?void 0:t.person)==null?void 0:p.tennisId,a=(f=(h=t==null?void 0:t.ratings)==null?void 0:h[e])==null?void 0:f.find(({scaleName:m})=>m===N3),s=a==null?void 0:a.scaleValue,{wtnRating:o,confidence:l}=s||{};return{timeStamp:a==null?void 0:a.scaleDate,personOtherId:n,confidence:l,wtnRating:o,personId:i,tennisId:r}}function C2e({tournamentRecord:t}){if(!t)return{error:ut};let e=t.tournamentId,{participantMap:i}=vr({withScaleValues:!0,withEvents:!0,withSeeding:!0,tournamentRecord:t,withDraws:!0}),n=(Wa({matchUpFilters:{matchUpTypes:[_b,Zv]},tournamentRecord:t}).matchUps??[]).flatMap(({sides:h,matchUpType:f})=>h==null?void 0:h.flatMap(m=>{var g,v;return f===Zv?(g=m==null?void 0:m.participant)==null?void 0:g.individualParticipantIds:((v=m==null?void 0:m.participant)==null?void 0:v.participantId)||m.participantId}).filter(Boolean)).filter(Boolean),r=[],a={},s={},o={},l=0,c=({id:h,entry:f,eventId:m,eventType:g})=>{var E;let{qualifyingSeeding:v,mainSeeding:y,entryStatus:b,entryStage:I,drawId:T}=f;a[h]||(a[h]=[]);let{participant:w,events:S}=(i==null?void 0:i[h])??{},U=p_({participant:w,eventType:g}),P=(E=S==null?void 0:S[m])==null?void 0:E.ranking;b===E3&&r.push(h),a[h].push({participantType:w==null?void 0:w.participantType,participantId:h,tournamentId:e,eventType:g,eventId:m,drawId:T,entryStatus:b,entryStage:I,...U,ranking:P,mainSeeding:y,qualifyingSeeding:v})};for(let h of t.events??[]){let f={},m=S=>{f[S]||(f[S]={count:0}),f[S].count+=1},{drawDefinitions:g=[],eventType:v,eventId:y}=h,b=g.flatMap(S=>{let{drawId:U,entries:P}=S;l+=1;let E=({stage:_,stageSequence:A})=>_===Ft&&A===1||_===ni,R=(S.structures??[]).filter(E).flatMap(({positionAssignments:_})=>_).filter(Boolean).map(({participantId:_})=>_),C=({participantId:_})=>R.includes(_),M=_=>{var $,F,V,j,B,z,W,Z;let{participantId:A,entryStatus:N,entryStage:k}=_;m(N);let O=(j=(V=(F=($=i==null?void 0:i[A])==null?void 0:$.draws)==null?void 0:F[U])==null?void 0:V.seedAssignments)==null?void 0:j[Ft];return{qualifyingSeeding:(Z=(W=(z=(B=i==null?void 0:i[A])==null?void 0:B.draws)==null?void 0:z[U])==null?void 0:W.seedAssignments)==null?void 0:Z[ni],participantId:A,mainSeeding:O,entryStatus:N,entryStage:k,drawId:U}};return P==null?void 0:P.filter(C).map(M)}),I=S=>{var E;let U=S.participantId,P=(E=i==null?void 0:i[U].participant.individualParticipantIds)==null?void 0:E.filter(R=>n.includes(R));return U&&{[U]:{individualParticipantIds:P}}};v===Vf?(()=>{let S=Object.assign({},...b.map(I).filter(Boolean)),U=P=>{S[P.participantId].individualParticipantIds.forEach(E=>{c({id:E,eventType:v,eventId:y,entry:P})})};b.forEach(U)})():b.forEach(S=>{c({id:S==null?void 0:S.participantId,eventType:v,eventId:y,entry:S})});let T=Object.values(f).reduce((S,U)=>S+U.count,0);Object.keys(f).forEach(S=>{f[S].pct=f[S].count/T*100}),o[y]={tournamentId:e,eventId:y,entries:b,entryStatuses:f};let w=Object.assign({},...id.flatMap(S=>{var U,P;return[{[S+"_count"]:(U=f[S])==null?void 0:U.count},{[S+"_pct"]:(P=f[S])==null?void 0:P.pct}]}));s[y]={tournamentId:e,eventId:y,...w}}let u=Object.values(i??{}).filter(({participant:{participantType:h,participantRole:f}})=>h===ji&&f===ms),d=u.filter(({participant:h})=>!n.includes(h.participantId)).map(({participant:h})=>h.participantId),p={nonParticipatingEntriesCount:d.length,individualParticipantsCount:u.length,eventsCount:Object.values(o).length,nonParticipatingParticipantIds:d,drawDefinitionsCount:l,tournamentId:e};return{entryStatusReports:Object.values(s).flat(),participantEntryReports:Object.values(a).flat(),eventReports:Object.values(o).flat(),withDrawnParticipantIds:r,tournamentEntryReport:p}}function R2e({eventType:t,matchUps:e,eventId:i,drawId:n}){let r={},a=f=>{let m=f==null?void 0:f.matchUpFormat;m&&(r[m]||(r[m]=0),r[m]+=1)},s=e.filter(f=>i?f.eventId===i:f.drawId===n).reduce((f,m)=>(a(m),(m.sides??[]).flatMap(g=>{var v;return(((v=g==null?void 0:g.participant)==null?void 0:v.individualParticipants)||[g==null?void 0:g.participant]).filter(Boolean)}).forEach(g=>f[g.participantId]=g),f),{}),o=Object.values(s),l=o.map(f=>p_({participant:f,eventType:t})).filter(({wtnRating:f})=>f),c=(o.length-l.length)/o.length*100,u=l.reduce((f,m)=>{let{wtnRating:g,confidence:v}=m;return f.totalWTN+=g,f.totalConfidence+=v,f},{totalWTN:0,totalConfidence:0}),d=l!=null&&l.length?u.totalWTN/l.length:0,p=l!=null&&l.length?u.totalConfidence/l.length:0,h=Object.values(r).reduce((f,m)=>f+(m||0),0);return{matchUpFormatCounts:r,matchUpsCount:h,avgConfidence:p,pctNoRating:c,avgWTN:d}}function M2e(t){var f;let{tournamentRecord:e,extensionProfiles:i,firstFlightOnly:n}=t;if(!e)return{error:CS};let r=[],a={},s={},o=[],l=Object.assign({},...(i??[]).map(({name:m,label:g,accessor:v})=>{var I,T,w;let y=(T=(I=ki({element:e,name:m}))==null?void 0:I.extension)==null?void 0:T.value,b=v?(w=Ob({element:y,accessor:v}))==null?void 0:w.value:y;return{[g||m]:b}})),c=e==null?void 0:e.tournamentId,u=Wa({participantsProfile:{withScaleValues:!0},tournamentRecord:e}).matchUps??[],d=m=>{var g,v,y;return(y=(v=(g=Qc({itemType:Cq,itemSubTypes:[wh],element:{timeItems:m}}))==null?void 0:g.timeItem)==null?void 0:v.itemValue)==null?void 0:y.scaleBasis},p=({positionManipulations:m})=>{m==null||m.forEach(g=>{let{structureId:v,name:y}=g,b=g.drawPositions||[g.drawPosition];a[v]||(a[v]=[]),a[v].push(`${y}: ${b.join("/")}`)})},h=(f=e==null?void 0:e.events)==null?void 0:f.flatMap(({timeItems:m,drawDefinitions:g=[],extensions:v,eventType:y,eventName:b,eventId:I,category:T})=>{var _,A,N,k;let w=(N=(A=(_=v==null?void 0:v.find(O=>O.name===qu))==null?void 0:_.value)==null?void 0:A.flights)==null?void 0:N.map(O=>({[O.drawId]:O.flightNumber})),S=w&&Object.assign({},...w),U=v==null?void 0:v.find(O=>O.name===Vv),P=m==null?void 0:m.find(O=>O.itemType===Vv),E=((k=U==null?void 0:U.value)==null?void 0:k.length)||(P==null?void 0:P.itemValue)||0,R=Object.values(S??{}),C=S&&Math.min(...R),M=d(m);return s[I]={seedingBasis:M?JSON.stringify(M):void 0,totalPositionManipulations:0,maxPositionManipulations:0,generatedDrawsCount:0,drawDeletionsCount:E,tournamentId:c,eventId:I},g.filter(O=>!n||!w||S[O.drawId]===C).flatMap(O=>{let{matchUpFormat:$,tieFormat:F,timeItems:V,extensions:j,structures:B,drawName:z,drawType:W,drawId:Z}=O,{matchUpFormatCounts:K,matchUpsCount:Q,avgConfidence:J,pctNoRating:se,avgWTN:ie}=R2e({eventType:y,matchUps:u,drawId:Z}),ce=d(V)||M,oe=N2e({extensions:j}),te=(oe==null?void 0:oe.length)||0;return p({positionManipulations:oe}),s[I].totalPositionManipulations+=te,s[I].generatedDrawsCount+=1,te>s[I].maxPositionManipulations&&(s[I].maxPositionManipulations=te),B==null?void 0:B.filter(le=>le.stageSequence===1&&[ni,Ft,bs,Rr].includes(le.stage)).map(le=>{var Fe,ht,ti;let ne=[Ft,Rr].includes(le.stage)?u.find(Ke=>Ke.structureId===le.structureId&&Ke.finishingRound===1&&Ke.winningSide):void 0;le.stage===Ft&&r.push({eventName:b,drawName:z,structureId:le.structureId});let me=(ht=(Fe=ne==null?void 0:ne.sides)==null?void 0:Fe.find(Ke=>Ke.sideNumber===ne.winningSide))==null?void 0:ht.participant,be=(me==null?void 0:me.participantType)===Lo&&me.participantId,Se=(me==null?void 0:me.participantType)===Ni?me.individualParticipants:[],we=p_({participant:(Se==null?void 0:Se[0])||me,eventType:y}),{personId:ze,personOtherId:Qe,tennisId:ke,confidence:yt,wtnRating:lt}=we||{},Ct=p_({participant:Se==null?void 0:Se[1],eventType:y}),{personId:Nt,personOtherId:Ce,tennisId:Ge,confidence:$e,wtnRating:at}=Ct||{},{ageCategoryCode:ct,categoryName:Vt,subType:Me}=T??{},De=le.matchUpFormat||$,Je=(K[De]||0)/Q*100,{tieFormatName:St,tieFormatDesc:bt}=a_(F),{tieFormatName:Ie,tieFormatDesc:Ue}=a_(le.tieFormat),Oe=bt===Ue,Ee=!Oe&&Ie,Xe=le.tieFormat&&!Oe&&Ue,Et=((ti=oe==null?void 0:oe.filter(Ke=>Ke.structureId===le.structureId))==null?void 0:ti.length)||0;return{...l,tournamentId:c,eventId:I,structureId:le.structureId,drawId:Z,eventType:y,category:Me,categoryName:Vt,ageCategoryCode:ct,flightNumber:S==null?void 0:S[Z],drawType:W,stage:le.stage,seedingBasis:ce?JSON.stringify(ce):void 0,winningPersonId:ze,winningPersonOtherId:Qe,winningPersonTennisId:ke,winningPersonWTNrating:lt,winningPersonWTNconfidence:yt,winningPerson2Id:Nt,winningPerson2OtherId:Ce,winningPerson2TennisId:Ge,winningPerson2WTNrating:at,winningPerson2WTNconfidence:$e,winningTeamId:be,positionManipulations:Et,pctNoRating:se,matchUpFormat:De,pctInitialMatchUpFormat:Je,matchUpsCount:Q,drawTieFormatName:St,drawTieFormatDesc:bt,tieFormatName:Ee,tieFormatDesc:Xe,avgConfidence:J,avgWTN:ie}})})});return r.forEach(({eventName:m,drawName:g,structureId:v})=>{var y;(y=a[v])!=null&&y.length&&o.push({eventName:m,drawName:g,actions:a[v]})}),{eventStructureReports:Object.values(s),structureReports:h,flightReports:o}}function N2e({extensions:t}){var e,i;return(i=(e=t==null?void 0:t.find(({name:n})=>n===dS))==null?void 0:e.value)==null?void 0:i.slice(1)}function A2e({ignoreDisabled:t=!0,tournamentRecords:e,tournamentId:i,venueIds:n=[],dates:r=[]}){var u,d;if(!Array.isArray(r))return{error:Re,dates:r};if(!Array.isArray(n))return{error:Re,venueIds:n};if(!(e&&Object.keys(e).filter(p=>!i||p===i)||[]).length)return{error:wr};if(!r.every(El))return{error:Fa};let a=Um({tournamentRecords:e,ignoreDisabled:t,dates:r});if(a.error)return a;let s=(u=a==null?void 0:a.venues)==null?void 0:u.filter(({venueId:p})=>!(n!=null&&n.length)||n.includes(p)),o=(d=a.courts)==null?void 0:d.reduce((p,h)=>{var f;return(f=h.dateAvailability)==null||f.forEach(m=>{let g=m.date;p.includes(g)||p.push(g)}),p},[]).filter(p=>!r.length||r.includes(p)),l={venueIds:s==null?void 0:s.map(({venueId:p})=>p)},{matchUps:c}=_d({afterRecoveryTimes:!0,tournamentRecords:e,matchUpFilters:l});return{venuesReport:s==null?void 0:s.map(p=>_2e(o,p,c))}}function _2e(t,e,i){let{venueId:n,courts:r,venueName:a}=e,s={};return t.forEach(o=>{var h;let l=0,c=0,u=0;for(let f of r){let m=f.dateAvailability.find(v=>v.date===o),g=(h=m&&TU({courtDate:m}).timeSlots)==null?void 0:h.reduce((v,y)=>{let{startTime:b,endTime:I}=y,T=an(I)-an(b);return v+T},0);g&&(u+=1),l+=g}let d=i.filter(({schedule:f})=>f.venueId===n&&kh(o,f.scheduledDate));d.forEach(({schedule:f})=>{let m=rr(f.scheduledTime),g=il(m,f.averageMinutes),v=an(g)-an(m);c+=v});let p=l?(c/l*100).toFixed(2):"100";s[o]={scheduledMatchUpsCount:d.length,availableCourts:u,availableMinutes:l,scheduledMinutes:c,percentUtilization:p}}),{venueId:n,venueName:a,venueReport:s}}var k4={};Li(k4,{addMatchUpCourtOrder:()=>p4,addMatchUpEndTime:()=>f4,addMatchUpOfficial:()=>epe,addMatchUpResumeTime:()=>g4,addMatchUpScheduleItems:()=>ZO,addMatchUpScheduledDate:()=>YO,addMatchUpScheduledTime:()=>Wg,addMatchUpStartTime:()=>h4,addMatchUpStopTime:()=>m4,addSchedulingProfileRound:()=>C4,allocateTeamMatchUpCourts:()=>KO,assignMatchUpCourt:()=>fw,assignMatchUpVenue:()=>DU,bulkRescheduleMatchUps:()=>Ihe,bulkScheduleMatchUps:()=>VC,bulkScheduleTournamentMatchUps:()=>wE,bulkUpdateCourtAssignments:()=>ghe,calculateScheduleTimes:()=>x4,clearMatchUpSchedule:()=>She,clearScheduledMatchUps:()=>QO,courtGridRows:()=>_O,findMatchUpFormatTiming:()=>MO,findVenue:()=>Xh,generateBookings:()=>JO,generateVirtualCourts:()=>GO,getMatchUpsToSchedule:()=>RO,getPersonRequests:()=>zy,getProfileRounds:()=>AO,getScheduledRoundsDetails:()=>MC,getSchedulingProfile:()=>Dm,getSchedulingProfileIssues:()=>EW,matchUpScheduleChange:()=>whe,modifyMatchUpFormatTiming:()=>WW,mutate:()=>hhe,proAutoSchedule:()=>mhe,proConflicts:()=>yhe,publicFindCourt:()=>t3,query:()=>Que,removeEventMatchUpFormatTiming:()=>BO,removeMatchUpCourtAssignment:()=>fhe,reorderUpcomingMatchUps:()=>bhe,scheduleMatchUps:()=>vhe,scheduleProfileRounds:()=>eL,setMatchUpDailyLimits:()=>The,setMatchUpHomeParticipantId:()=>d4,setSchedulingProfile:()=>yU,toggleParticipantCheckInState:()=>zO,validateSchedulingProfile:()=>NO});var hhe={};Li(hhe,{addMatchUpCourtOrder:()=>p4,addMatchUpEndTime:()=>f4,addMatchUpOfficial:()=>epe,addMatchUpResumeTime:()=>g4,addMatchUpScheduleItems:()=>ZO,addMatchUpScheduledDate:()=>YO,addMatchUpScheduledTime:()=>Wg,addMatchUpStartTime:()=>h4,addMatchUpStopTime:()=>m4,addSchedulingProfileRound:()=>C4,allocateTeamMatchUpCourts:()=>KO,assignMatchUpCourt:()=>fw,assignMatchUpVenue:()=>DU,bulkRescheduleMatchUps:()=>Ihe,bulkScheduleMatchUps:()=>VC,bulkScheduleTournamentMatchUps:()=>wE,bulkUpdateCourtAssignments:()=>ghe,calculateScheduleTimes:()=>x4,clearMatchUpSchedule:()=>She,clearScheduledMatchUps:()=>QO,findMatchUpFormatTiming:()=>MO,generateBookings:()=>JO,generateVirtualCourts:()=>GO,matchUpScheduleChange:()=>whe,modifyMatchUpFormatTiming:()=>WW,proAutoSchedule:()=>mhe,proConflicts:()=>yhe,removeEventMatchUpFormatTiming:()=>BO,removeMatchUpCourtAssignment:()=>fhe,reorderUpcomingMatchUps:()=>bhe,scheduleMatchUps:()=>vhe,scheduleProfileRounds:()=>eL,setMatchUpDailyLimits:()=>The,setMatchUpHomeParticipantId:()=>d4,setSchedulingProfile:()=>yU,toggleParticipantCheckInState:()=>zO,validateSchedulingProfile:()=>NO});function x4({calculateStartTimeFromCourts:t=!0,defaultRecoveryMinutes:e=0,averageMatchUpMinutes:i=90,remainingScheduleTimes:n,clearScheduleDates:r,tournamentRecords:a,periodLength:s,scheduleDate:o,startTime:l,venueIds:c,endTime:u}){if(typeof a!="object"||!Object.keys(a).length)return{error:wr};s=s??HO({recoveryMinutes:e,averageMatchUpMinutes:i});let{courts:d,venues:p}=Um({dates:[o],ignoreDisabled:!0,tournamentRecords:a}),h=d==null?void 0:d.filter(E=>!c||c.includes(E.venueId));l||(l=h==null?void 0:h.reduce((E,R)=>{var M,_;let C=((_=(M=R.dateAvailability)==null?void 0:M.find(A=>!A.date||kh(o,A.date)))==null?void 0:_.startTime)??R.startTime;return C&&(!E||an(C)<an(E))?C:E},void 0)),u||(u=h==null?void 0:h.reduce((E,R)=>{var M,_;let C=((_=(M=R.dateAvailability)==null?void 0:M.find(A=>!A.date||kh(o,A.date)))==null?void 0:_.endTime)??R.endTime;return C&&(!E||an(C)>an(E))?C:E},void 0));let f=Object.values(a),m=Object.assign({},...f.map(E=>(E.events??[]).map(R=>{let{scheduleTiming:C}=YP({tournamentRecord:E,event:R});return{[R.eventId]:{event:R,scheduleTiming:C}}})).flat()),g=_C({sortDateMatchUps:!1,tournamentRecords:a,matchUpFilters:{scheduledDate:o,venueIds:c}}),v=(g==null?void 0:g.dateMatchUps)??[],y=(g==null?void 0:g.completedMatchUps)??[],b=[];b.push(...v),b.push(...y);let I={averageTimes:[{minutes:{default:i}}],recoveryTimes:[{minutes:{default:e}}]},T=b==null?void 0:b.map(({eventId:E,schedule:R,matchUpFormat:C})=>{let{event:M,scheduleTiming:_}=m[E],A=M==null?void 0:M.eventType,N={..._,defaultTiming:I,matchUpFormat:C},{averageMinutes:k,recoveryMinutes:O}=Wx({eventType:A,timingDetails:N}),{courtId:$,venueId:F}=R,V=rr(R.scheduledTime),j=il(V,k);return{recoveryMinutes:O,averageMinutes:k,periodLength:s,startTime:V,endTime:j,courtId:$,venueId:F}}),w={calculateStartTimeFromCourts:t,remainingScheduleTimes:n,averageMatchUpMinutes:i,date:o,clearScheduleDates:r,periodLength:s,startTime:l,endTime:u,bookings:T,courts:h},{scheduleTimes:S}=r4(w),U=(c==null?void 0:c.length)===1&&c[0]||(p==null?void 0:p.length)===1&&p[0].venueId||void 0,P=b.map(Pa);return{venueId:U,scheduleTimes:S,dateScheduledMatchUpIds:P}}function fhe(t){var h;let e=Qt(t,[{[ks]:!0}]);if(e.error)return e;let{removePriorValues:i,tournamentRecords:n,tournamentId:r,courtDayDate:a,matchUpId:s,courtId:o,drawId:l}=t,c=n[r];if(!c)return{error:ut};let{drawDefinition:u,event:d}=qg({tournamentRecord:c,drawId:l});if(!u)return{error:Gt};let p=ar({drawDefinition:u,event:d,matchUpId:s});if(p.error)return p;if(((h=p==null?void 0:p.matchUp)==null?void 0:h.matchUpType)===ec){let{itemValue:f}=Vy({timeItems:p.matchUp.timeItems??[],itemType:$h}),m=o&&f.filter(g=>g.courtId!==o);return xl({duplicateValues:!1,removePriorValues:i,tournamentRecord:c,drawDefinition:u,matchUpId:s,timeItem:{itemType:$h,itemValue:m}})}else return fw({tournamentRecord:c,drawDefinition:u,courtDayDate:a,courtId:"",matchUpId:s})}function mhe({scheduleCompletedMatchUps:t,tournamentRecords:e,scheduledDate:i,matchUps:n}){if(!tu(n))return{error:Re};if(n.some(({hasContext:h})=>!h))return{info:"matchUps must have { inContext: true, nextMatchUps: true }",error:lx};let r=_C({courtCompletedMatchUps:!0,withCourtGridRows:!0,minCourtGridRows:10,tournamentRecords:e,matchUpFilters:{localPerspective:!0,scheduledDate:i}});if(r.error)return r;let{rows:a}=r,s=[],o=h=>[(h.sides||[]).map(f=>{var m;return[f.participantId,(m=f.participant)==null?void 0:m.individualParticipantIds]}),(h.potentialParticipants||[]).flat().map(f=>[f.participantId,f.individualParticipantIds])].flat(1/0).filter(Boolean),l=a==null?void 0:a.reduce((h,f)=>{let m=[],g=[];Object.values(f).forEach(y=>{if(Xi(y)&&(y.matchUpId&&(m.push(y.matchUpId),s.push(y)),y.sides)){let b=o(y);g.push(...b)}});let v=Object.values(f).filter(y=>Xi(y)&&!y.matchUpId);return h.concat({matchUpIds:m,availableCourts:v,rowId:f.rowId,participantIds:g})},[]);n.filter(({matchUpStatus:h})=>h&&h!==mn&&(t||!ca.includes(h))).sort(rw);let c=rd({matchUps:n.concat(s),includeParticipantDependencies:!0,tournamentRecords:e}).matchUpDependencies,u=[],d=[];for(;n.length&&l.length;){let h=l.shift(),f=[];for(;n.length&&h.availableCourts.length;){let m=n.concat(f).map(U=>U.matchUpId),g=n.shift(),v=g==null?void 0:g.matchUpId,y=v&&c[v].matchUpIds.concat(c[v].dependentMatchUpIds),b=v&&m.some(U=>c[v].matchUpIds.includes(U)),I=v&&d.some(U=>c[v].dependentMatchUpIds.includes(U)),T=h.matchUpIds.some(U=>y.includes(U)),w=o(g),S=h.participantIds.some(U=>w.includes(U));if(g&&!T&&!b&&!S&&!I){let U=h.availableCourts.shift();Object.assign(g.schedule,U.schedule),Object.assign(U,g),u.push(g),h.participantIds.push(...w),h.matchUpIds.push(v)}else g&&f.push(g)}n.push(...f),d.push(...h.matchUpIds)}let p=u.map(({matchUpId:h,tournamentId:f,schedule:m,drawId:g})=>({tournamentId:f,matchUpId:h,drawId:g,schedule:{...m,scheduledDate:i}}));return r=VC({tournamentRecords:e,matchUpDetails:p}),{...r,scheduled:u,notScheduled:n}}function ghe(t){let{courtDayDate:e}=t,i=Qt(t,[{courtAssignments:!0,[qo]:Rs,[rc]:ai},{[ks]:!0}]);if(i.error)return i;let n=t.courtAssignments.reduce((a,s)=>{let{tournamentId:o}=s;return a[o]||(a[o]=[]),a[o].push(s),a},{}),r;return Object.keys(n).every(a=>{let s=t[ks][a];if(!s)return r={error:ut},!1;let o=n[a].reduce((l,c)=>{let{drawId:u}=c;return l[u]||(l[u]=[]),l[u].push(c),l},{});Object.keys(o).every(l=>{let{drawDefinition:c}=jo({tournamentRecord:s,drawId:l});return c?(o[l].every(u=>{let{matchUpId:d,courtId:p}=u,h=fw({tournamentRecord:s,drawDefinition:c,courtDayDate:e,matchUpId:d,courtId:p});if(h.success)return h==null?void 0:h.success;r={error:wae}}),!0):(r={error:Gt},!1)})}),r||de}function vhe(t){let{tournamentRecords:e,allDateMatchUpIds:i=[],averageMatchUpMinutes:n=90,recoveryMinutes:r=0,recoveryMinutesMap:a,matchUpPotentialParticipantIds:s={},individualParticipantProfiles:o={},matchUpNotBeforeTimes:l={},matchUpDailyLimits:c={},checkPotentialRequestConflicts:u=!0,remainingScheduleTimes:d,clearScheduleDates:p,periodLength:h=30,scheduleDate:f,matchUpIds:m,venueIds:g,startTime:v,endTime:y,dryRun:b}=t,I=Qt(t,[{[ks]:!0,[VP]:!0},{[ds]:El,[rc]:Fa,[SNe]:!0},{[ds]:W=>!W||!isNaN(W),[ENe]:!1,[rc]:Re,[PNe]:!1,[CNe]:!1}]);if(I.error)return I;let T=t.competitionMatchUps??_d({nextMatchUps:!0,tournamentRecords:e}).matchUps??[],w=t.matchUpDependencies??rd({includeParticipantDependencies:!0,matchUps:T,tournamentRecords:e}).matchUpDependencies;T.forEach(W=>{var Z;(Z=W.schedule)!=null&&Z.scheduledDate&&kh(f,Ri(W.schedule.scheduledDate))&&YS({matchUpPotentialParticipantIds:s,matchUpNotBeforeTimes:l,matchUp:W})});let S=m.map(W=>T.find(Z=>Z.matchUpId===W)).filter(Boolean),{venueId:U,scheduleTimes:P,dateScheduledMatchUpIds:E}=x4({tournamentRecords:e,remainingScheduleTimes:d,startTime:rr(v),endTime:rr(y),scheduleDate:Ri(f),averageMatchUpMinutes:n,clearScheduleDates:p,periodLength:h,venueIds:g}),R={},C=[],M={},_={},A={};T.filter(({matchUpId:W})=>E==null?void 0:E.includes(W)).forEach(W=>{var K;pj({matchUpPotentialParticipantIds:s,individualParticipantProfiles:o,matchUp:W,value:1});let Z=(K=W.schedule)==null?void 0:K.scheduledTime;if(Z){M[W.matchUpId]=Z;let Q=a==null?void 0:a[W.matchUpId];IE({recoveryMinutes:Q||r,matchUpPotentialParticipantIds:s,individualParticipantProfiles:o,matchUpNotBeforeTimes:l,averageMatchUpMinutes:n,matchUpDependencies:w,scheduleTime:Z,matchUp:W})}});let N=S.filter(W=>{let Z=E==null?void 0:E.includes(W.matchUpId),K=[mn,Yi,Lr,sl,as,cn].includes(W==null?void 0:W.matchUpStatus);return!Z&&!W.winningSide&&!K}),{matchUpMap:k,overLimitMatchUpIds:O,participantIdsAtLimit:$}=N.reduce((W,Z)=>{let{drawId:K,tournamentId:Q,matchUpType:J}=Z,{participantIdsAtLimit:se,relevantParticipantIds:ie}=U4({individualParticipantProfiles:o,matchUpPotentialParticipantIds:s,matchUpDailyLimits:c,matchUp:Z});return se!=null&&se.length?(W.overLimitMatchUpIds.push(Z.matchUpId),W.participantIdsAtLimit.push(...se),W):(ie.forEach(ce=>{$C({individualParticipantProfiles:o,participantId:ce});let oe=o[ce].counters;oe[J]?oe[J]+=1:oe[J]=1,oe[ku]?oe[ku]+=1:oe[ku]=1}),W.matchUpMap[Q]||(W.matchUpMap[Q]={}),W.matchUpMap[Q][K]?W.matchUpMap[Q][K].push(Z):W.matchUpMap[Q][K]=[Z],YS({matchUpPotentialParticipantIds:s,matchUpNotBeforeTimes:l,matchUp:Z}),W)},{matchUpMap:{},overLimitMatchUpIds:[],participantIdsAtLimit:[]});N=N.filter(({matchUpId:W})=>!O.includes(W));let F=0,V=(P==null?void 0:P.length)??0,{personRequests:j}=zy({tournamentRecords:e,requestType:BC});for(;P!=null&&P.length&&N.length&&F<=V;){F++;let{scheduleTime:W}=P.shift(),Z=N.find(K=>{let{matchUpId:Q}=K,{dependenciesScheduled:J,remainingDependencies:se}=w4({matchUpScheduleTimes:M,matchUpDependencies:w,allDateMatchUpIds:i,matchUp:K});if(!J)return A[Q]||(A[Q]=[]),A[Q].push({scheduleTime:W,remainingDependencies:se}),!1;let{enoughTime:ie}=T4({individualParticipantProfiles:o,matchUpNotBeforeTimes:l,matchUpDependencies:w,scheduleTime:W,matchUp:K});if(!ie)return _[Q]||(_[Q]=[]),_[Q].push({scheduleTime:W}),!1;let{conflicts:ce}=S4({potentials:u,averageMatchUpMinutes:n,requestConflicts:R,personRequests:j,scheduleTime:W,scheduleDate:f,matchUp:K});if(ce!=null&&ce.length)return!1;let oe=a==null?void 0:a[K.matchUpId];return IE({recoveryMinutes:oe||r,matchUpPotentialParticipantIds:s,individualParticipantProfiles:o,matchUpNotBeforeTimes:l,averageMatchUpMinutes:n,matchUpDependencies:w,scheduleTime:W,matchUp:K}),M[K.matchUpId]=W,!0});N=N.filter(({matchUpId:K})=>K!==(Z==null?void 0:Z.matchUpId)),Z||C.push(W)}N.forEach(W=>{pj({individualParticipantProfiles:o,matchUpPotentialParticipantIds:s,value:-1,matchUp:W})});let B=[];Object.keys(k).forEach(W=>{let Z=e[W];Z&&Object.keys(k[W]).forEach(K=>{let{drawDefinition:Q}=qg({tournamentRecord:Z,drawId:K});Q&&k[W][K].forEach(({matchUpId:J})=>{let se=M[J];if(se){let ie=se.split(":").map(Oc).join(":"),ce=`${Ri(f)}T${ie}`;b?B.push(J):(Wg({drawDefinition:Q,matchUpId:J,scheduledTime:ce}).success&&B.push(J),U&&DU({tournamentRecords:e,tournamentRecord:Z,drawDefinition:Q,matchUpId:J,venueId:U}))}})})});let z=bq(N);return{...de,requestConflicts:Object.values(R),remainingScheduleTimes:P==null?void 0:P.map(({scheduleTime:W})=>W),individualParticipantProfiles:o,matchUpNotBeforeTimes:l,participantIdsAtLimit:$,skippedScheduleTimes:C,overLimitMatchUpIds:O,scheduledMatchUpIds:B,noTimeMatchUpIds:z,recoveryTimeDeferred:_,dependencyDeferred:A}}function yhe({tournamentRecords:t,matchUps:e}){if(!tu(e))return{error:ym};if(e.some(({matchUpId:h,hasContext:f})=>h&&!f))return{info:"matchUps must have { inContext: true, nextMatchUps: true }",error:lx};let i=Math.max(...e.map(({schedule:h})=>(h==null?void 0:h.courtOrder)||1).map(h=>ui(h))),n=Rt(1,i+1).map(h=>e.filter(f=>{var m;return ui((m=f.schedule)==null?void 0:m.courtOrder)===h})),r={},a={},s={};n.flat().filter(Boolean).sort(rw).forEach(({schedule:h})=>delete h[jN]);let o=Ei(e.map(({drawId:h})=>h)),l=rd({includeParticipantDependencies:!0,tournamentRecords:t,drawIds:o}).matchUpDependencies,c=n.map((h,f)=>h.reduce((m,g)=>{if(!g.matchUpId)return m;let{matchUpId:v,winnerMatchUpId:y,loserMatchUpId:b,schedule:I,sides:T,potentialParticipants:w}=g,S=I==null?void 0:I.courtId;r[v]=f,a[S]=[],m.matchUpIds.push(v),s[v]=g;let U=l[v].matchUpIds;U.length&&m.sourceMatchUpIds.push(...U);let P=(T==null?void 0:T.map(R=>{var C;return[(C=R.participant)==null?void 0:C.individualParticipantIds,R.participantId]}).flat().filter(Boolean))??[],E=(w==null?void 0:w.flat().map(({individualParticipantIds:R,participantId:C})=>[R,C]).flat().filter(Boolean))||[];return m.participantIds.push(...E,...P),y&&m.targetMatchUpIds.push(y),b&&m.targetMatchUpIds.push(b),m},{sourceMatchUpIds:[],targetMatchUpIds:[],participantIds:[],matchUpIds:[]})),u=(h,f)=>l[h].sources.reduce((m,g,v)=>g.includes(f)&&v+1||m,0),d=c.map(()=>[]),p=(h,f,m,g)=>{if(!s[h].schedule[jN]){s[h].schedule[jN]=f,s[h].schedule[joe]=g,d[r[h]].push({matchUpId:h,issueType:m,issueIds:g,issue:f});let v=s[h].schedule.courtId;a[v]||(a[v]=[]),a[v].push({matchUpId:h,issue:f,issueType:m,issueIds:g})}};return c.forEach((h,f)=>{let m=f?c[f-1]:void 0,g=c.slice(f+1),v={},y=Ml(h.participantIds),b=Object.keys(y).filter(w=>y[w]>1),I=h.matchUpIds.filter(w=>l[w].participantIds.some(S=>b.includes(S)));I.forEach(w=>{v[w]||(v[w]={}),v[w][Iv]||(v[w][Iv]=I.filter(S=>S!==w))});let T=m&&h.participantIds.filter(w=>m.participantIds.includes(w));T&&T.forEach(w=>{let S=h.matchUpIds.concat(m.matchUpIds).filter(U=>l[U].participantIds.includes(w));S.forEach(U=>{v[U]||(v[U]={}),v[U][wv]||(v[U][wv]=S.filter(P=>P!==U))})}),h.matchUpIds.forEach(w=>{var P,E,R,C;let S=l[w].matchUpIds;for(let M of g){let _=M.matchUpIds.filter(A=>S.includes(A));_!=null&&_.length&&(_.forEach(A=>p(A,$V,zm,[w])),p(w,$V,zm,_))}if((P=v[w])!=null&&P[Iv]&&p(w,Iv,FV,v[w][Iv]),h.sourceMatchUpIds.includes(w)){let M=h.matchUpIds.filter(_=>l[_].matchUpIds.includes(w));p(w,Iv,zm,M),h.matchUpIds.filter(_=>l[_].matchUpIds.includes(w)).forEach(_=>p(_,Iv,zm,[w]))}let U=(E=m==null?void 0:m.matchUpIds)==null?void 0:E.filter(M=>u(w,M)>1);if(U!=null&&U.length&&(p(w,BV,zm,U),U.forEach(M=>p(M,BV,zm,[w]))),(R=v[w])!=null&&R[wv]&&p(w,wv,FV,v[w][wv]),(C=m==null?void 0:m.targetMatchUpIds)==null?void 0:C.includes(w)){let M=s[w].schedule.courtId,_=S.filter(A=>m.matchUpIds.includes(A));_.some(A=>s[A].schedule.courtId===M)||(_.forEach(A=>p(A,wv,zm,[w])),p(w,wv,zm,_))}})}),{courtIssues:a,rowIssues:d}}function bhe(t){let e="reorderUpcomingMatchUps",{tournamentRecords:i}=t;if(typeof i!="object"||!Object.keys(i).length)return he({result:{error:wr},stack:e});let{matchUpsContextIds:n,firstToLast:r}=t;if(!n)return he({result:{error:ai},stack:e});let a=n==null?void 0:n.length;if(!a)return{...de};let s=0;return n.forEach((l,c)=>{let{tournamentId:u,drawId:d,matchUpId:p}=l,h=c+(r?-1:1);h<0&&(h=a-1),h===a&&(h=0);let f=n[h].schedule.scheduledTime,m=o({tournamentId:u,scheduledTime:f,matchUpId:p,drawId:d});if(m.success)s++;else return m}),s===a?de:he({result:{error:Iae},stack:e});function o({tournamentId:l,scheduledTime:c,matchUpId:u,drawId:d}){let p=i[l],{drawDefinition:h}=qg({tournamentRecord:p,drawId:d});return h?Wg({drawDefinition:h,scheduledTime:c,matchUpId:u}):{error:tc}}}function Ihe(t){var l,c;let{scheduleChange:e,matchUpIds:i,dryRun:n}=t;if(!i||!Array.isArray(i))return{error:BI};if(typeof e!="object")return{error:Re};let r=Jc(t),a=[],s=[];for(let u of Object.values(r)){let d=k2e({tournamentRecord:u,scheduleChange:e,matchUpIds:i,dryRun:n});if(d.error)return d;Array.isArray(d.notRescheduled)&&s.push(...d.notRescheduled);let p=bq(d.notRescheduled),h=[];(l=d.rescheduled)==null||l.forEach(f=>{let{matchUpId:m}=f;p.includes(m)&&h.push(m),a.push(f)}),h.length&&(s=((c=d==null?void 0:d.notRescheduled)==null?void 0:c.filter(({matchUpId:f})=>!h.includes(f)))||[])}let o=!!(a.length&&!s.length);return{...de,rescheduled:a,notRescheduled:s,allRescheduled:o}}function k2e({tournamentRecord:t,scheduleChange:e,matchUpIds:i,dryRun:n}){var I;if(!t)return{error:ut};if(!i||!Array.isArray(i))return{error:BI};if(typeof e!="object")return{error:Re};let r=[],a=[],{minutesChange:s,daysChange:o}=e;if(!s&&!o)return{...de};if(s&&isNaN(s))return{error:Re};if(o&&isNaN(o))return{error:Re};let{matchUps:l}=Wa({matchUpFilters:{matchUpIds:i},tournamentRecord:t}),c=({matchUpStatus:T})=>!ca.includes(T),u=l==null?void 0:l.filter(T=>AC({schedule:T.schedule})).filter(T=>c({matchUpStatus:T.matchUpStatus}));if(!(u!=null&&u.length))return{...de};let{tournamentInfo:d}=pw({tournamentRecord:t}),{startDate:p,endDate:h}=d,f=u==null?void 0:u.reduce((T,w)=>{let{matchUpId:S,drawId:U}=w;return T[U]?T[U].push(S):T[U]=[S],T},{}),m=1440;for(let T of Object.keys(f)){let w=qg({tournamentRecord:t,drawId:T});if(w.error)return w;let S=w.drawDefinition,U=f[T].filter(P=>i.includes(P));for(let P of U)if(P&&S){let E=(I=u.find(N=>N.matchUpId===P))==null?void 0:I.schedule,{scheduledTime:R,scheduledDate:C}=E,M,_,A;if(!M&&o&&C){let N=Ri(C);A=H1(N,o),M=new Date(A)<new Date(p)||new Date(A)>new Date(h)}if(s&&R){let N=Ri(R),k=an(rr(R))+s;if(M=k<0||k>m,!M){let O=il(R,s),$=N&&A||C===N&&N;_=$?`${$}T${O}`:O}}if(M)a.push(P);else{if(!n){if(_){let N=Wg({scheduledTime:_,drawDefinition:S,matchUpId:P});if(N.error)return N}if(A){let N=YO({scheduledDate:A,drawDefinition:S,matchUpId:P});if(N.error)return N}}(_||A)&&r.push(P)}}}let g=Wa({matchUpFilters:{matchUpIds:i},tournamentRecord:t}).matchUps??[],v=g.filter(({matchUpId:T})=>r.includes(T)),y=g.filter(({matchUpId:T})=>a.includes(T)),b=v.length&&!y.length;return{...de,rescheduled:v,notRescheduled:y,allRescheduled:b}}function whe(t){let e="matchUpScheduleChange",{tournamentRecords:i}=t;if(typeof i!="object"||!Object.keys(i).length)return{error:wr};let{sourceMatchUpContextIds:n,targetMatchUpContextIds:r,sourceCourtId:a,targetCourtId:s,courtDayDate:o}=t||{},{drawId:l,matchUpId:c,tournamentId:u}=n||{},{drawId:d,matchUpId:p,tournamentId:h}=r||{};if(!c&&!p)return he({result:{error:ai},stack:e});let{matchUps:f}=_d({matchUpFilters:{matchUpIds:[c,p].filter(Boolean),drawIds:[l,d].filter(Boolean)},tournamentRecords:t.tournamentRecords}),m=f==null?void 0:f.find(({matchUpId:I})=>I===c),g=f==null?void 0:f.find(({matchUpId:I})=>I===p),v=0;if(s&&c&&!p){let I=y({tournamentId:u,matchUpId:c,courtId:s,matchUp:m,drawId:l,tournamentRecords:i,sourceCourtId:a,courtDayDate:o});if(I!=null&&I.success&&v++,I.error)return he({result:I,stack:e})}else if(a&&s&&c&&p){let I=y({tournamentId:u,matchUpId:c,courtId:s,matchUp:m,drawId:l,tournamentRecords:i,sourceCourtId:a,courtDayDate:o});if(I.success&&v++,I.error)return he({result:I,stack:e,info:"source"});let T=y({tournamentId:h,sourceCourtId:s,matchUpId:p,matchUp:g,courtId:a,drawId:d,tournamentRecords:i,courtDayDate:o});if(T.success&&v++,T.error)return he({result:T,stack:e,info:"target"})}else return{error:ai};return v?de:he({result:{error:eU},stack:e});function y(I){let{tournamentRecords:T,tournamentId:w,matchUp:S,drawId:U}=I,P=T[w],{drawDefinition:E}=qg({tournamentRecord:P,drawId:U});return S.matchUpType===Zn?b({...I,tournamentRecord:P,drawDefinition:E}):fw({...I,tournamentRecord:P,drawDefinition:E})}function b({removePriorValues:I,tournamentRecords:T,tournamentRecord:w,drawDefinition:S,sourceCourtId:U,courtDayDate:P,matchUpId:E,matchUp:R,courtId:C}){let M=[C].concat(R.schedule.allocatedCourts.map(({courtId:_})=>_).filter(_=>_!==U));return KO({removePriorValues:I,tournamentRecords:T,tournamentRecord:w,drawDefinition:S,courtDayDate:P,matchUpId:E,courtIds:M})}}function She({scheduleAttributes:t=[$h,hg,JI,QI,ew,gd,Yf,Sh,_f],tournamentRecord:e,drawDefinition:i,matchUpId:n}){var o,l;let r="clearMatchUpSchedule",a=i?(o=lo({matchUpFilters:{matchUpIds:[n]},inContext:!1,drawDefinition:i}).matchUps)==null?void 0:o[0]:(l=Wa({matchUpFilters:{matchUpIds:[n]},tournamentRecord:e,inContext:!1}).matchUps)==null?void 0:l[0];if(!a)return{error:_s};let s=(a.timeItems??[]).filter(c=>(c==null?void 0:c.itemType)&&!t.includes(c==null?void 0:c.itemType));return a.timeItems=s,Ji({tournamentId:e.tournamentId,context:r,drawDefinition:i,matchUp:a}),{...de}}function The(t){let{tournamentRecord:e,tournamentId:i,dailyLimits:n}=t,r=t.tournamentRecords||e&&{[e.tournamentId]:e}||{};if(typeof r!="object"||!Object.keys(r).length)return{error:wr};if(typeof n!="object")return{error:bm};let a=Object.keys(r).filter(s=>!i||i===s);if(i&&!a.includes(i))return{error:Re};for(let s of a){let o=r[s],l=dn({extension:{name:GP,value:{dailyLimits:n}},element:o});if(l.error)return l}return{...de}}var O4={};Li(O4,{addCollectionDefinition:()=>$4,addCollectionGroup:()=>Rhe,aggregateTieFormats:()=>Nhe,compareTieFormats:()=>Kf,getTieFormat:()=>EO,modifyCollectionDefinition:()=>L4,modifyTieFormat:()=>Mhe,mutate:()=>Uhe,orderCollectionDefinitions:()=>Phe,query:()=>zue,removeCollectionDefinition:()=>F4,removeCollectionGroup:()=>Ehe,tieFormatGenderValidityCheck:()=>vx,validateCollectionDefinition:()=>LP});var Uhe={};Li(Uhe,{addCollectionDefinition:()=>$4,addCollectionGroup:()=>Rhe,aggregateTieFormats:()=>Nhe,modifyCollectionDefinition:()=>L4,modifyTieFormat:()=>Mhe,orderCollectionDefinitions:()=>Phe,removeCollectionDefinition:()=>F4,removeCollectionGroup:()=>Ehe});function uy({drawDefinition:t,structureId:e,matchUpId:i,structure:n,matchUp:r,eventId:a,event:s}){var c;let o="getTieFormat",l;if(e=(n==null?void 0:n.structureId)??e,i=(r==null?void 0:r.matchUpId)??i,(i||e)&&!t)return{error:Gt};if(a&&s)l=np(s);else if(i){if(t&&(!r||!n)){let u=ar({drawDefinition:t,matchUpId:i});if(u.error)return u;if(((c=u.matchUp)==null?void 0:c.matchUpType)!==ec)return he({result:{error:al},stack:o});n||(n=u.structure),r||(r=u.matchUp)}l=sD({item:r,drawDefinition:t,structure:n,event:s})||sD({item:n,drawDefinition:t,structure:n,event:s})||np(t)||np(s)}else if(t&&e){if(!n){let u=hi({drawDefinition:t,structureId:e});if(u.error)return u;n=u==null?void 0:u.structure}l=sD({item:n,drawDefinition:t,structure:n,event:s})||np(t)||np(s)}else l=np(t)||np(s);return l?{...de,structure:n,tieFormat:l,matchUp:r}:he({result:{error:XT},stack:o})}function h_({matchUp:t,updateInProgressMatchUps:e}){return!t.winningSide&&![ca].includes(t.matchUpStatus)&&(e||t.matchUpStatus!==td&&!ga(t))}function E$({from:t,to:e}){let i=Object.keys(t),n=Nr(i,Object.keys(e)).length===i.length,r=i.filter(s=>t[s]!==e[s]).map(s=>({countChange:e[s]-t[s],collectionId:s})),a=i.every(s=>t[s]===e[s]);return{equivalent:n&&a,matchUpsCountChanges:r}}function x2e({updateInProgressMatchUps:t,tournamentRecord:e,drawDefinition:i,structure:n,tieFormat:r,eventId:a,matchUp:s,event:o,uuids:l}){var w,S,U,P;let c="updateTieFormat",u=e==null?void 0:e.tournamentId,d=0,p=0,h=0,f=0,m=r==null?void 0:r.collectionDefinitions.reduce((E,R)=>(E[R.collectionId]=(E[R.collectionId]||0)+R.matchUpCount,E),{}),g=({tieFormat:E})=>{let R=E==null?void 0:E.collectionDefinitions.reduce((C,M)=>(C[M.collectionId]=(C[M.collectionId]||0)+M.matchUpCount,C),{});return E$({from:R,to:m}).equivalent},v=(w=uy({drawDefinition:i}))==null?void 0:w.tieFormat,y=(S=uy({event:o}))==null?void 0:S.tieFormat;if(o&&a){for(let E of o.drawDefinitions??[])b({drawDefinition:E});o.tieFormat=cs(r),f+=1}else if(s){if(!s.tieMatchUps)return he({result:{error:al},stack:c});let E=Ml((U=s.tieMatchUps)==null?void 0:U.map(({collectionId:A})=>A)),R=E$({to:m,from:E}),{changes:C,changesArePossible:M,cannotChangeReaon:_}=LZ({matchUp:s,check:R});if(R.equivalent)if(h_({matchUp:s,updateInProgressMatchUps:t}))s.tieFormat=cs(r),f+=1;else return he({result:{error:Rz},info:"matchUp is IN_PROGRESS or COMPLETE",stack:c});else if(M)T({tieFormat:r,matchUp:s,changes:C,uuids:l});else return he({context:{collectionMap:m,matchUpMap:E},result:{error:Ih},info:_||"specified changes not possible",stack:c});p+=1,Ji({eventId:o==null?void 0:o.eventId,context:c,drawDefinition:i,tournamentId:u,matchUp:s})}else if(n){let E=(P=I({inheritedTieFormat:v??y,structure:n}))==null?void 0:P.modifiedMatchUpsCount;E&&(p+=E,d+=1,f+=1);let R=!n.tieFormat||Kf({ancestor:n.tieFormat,descendant:r}).different;R&&(n.tieFormat=cs(r),d+=1,f+=1),(E||R)&&i&&Hn({structureIds:[n.structureId],eventId:o==null?void 0:o.eventId,drawDefinition:i})}else if(i)b({drawDefinition:i}),i.tieFormat=cs(r),f+=1;else return{error:Gt};return{modifiedStructuresCount:d,modifiedMatchUpsCount:p,addedMatchUpsCount:h,modifiedCount:f,...de,tieFormat:r};function b({drawDefinition:E}){var M;let R=E.structures||[],C=[];for(let _ of R){if(_.tieFormat)continue;let A=(M=I({inheritedTieFormat:y,structure:_}))==null?void 0:M.modifiedMatchUpsCount;if(A){d+=1,p+=A;let N=_.structureId;C.push(N)}}return Hn({structureIds:C,eventId:o==null?void 0:o.eventId,drawDefinition:E}),C.length}function I({inheritedTieFormat:E,structure:R}){var _,A;let C=0,M=((_=wn({matchUpFilters:{matchUpTypes:[Zn]},structure:R}))==null?void 0:_.matchUps)||[];for(let N of M){let k=h_({matchUp:N,updateInProgressMatchUps:t}),O=!1,$=Ml((A=N.tieMatchUps)==null?void 0:A.map(({collectionId:V})=>V)),F=E$({from:$,to:m});if(F.equivalent)N.tieFormat&&g(N)&&k&&(N.tieFormat=cs(r),O=!0);else{let{changes:V,changesArePossible:j}=LZ({matchUp:N,check:F});if(j&&!N.tieFormat)T({changes:V,matchUp:N,tieFormat:r,uuids:l});else if(E)(!N.tieFormat||Kf({ancestor:E,descendant:N.tieFormat}).different)&&(N.tieFormat=E,O=!0);else return he({result:{error:XT},stack:c})}O&&(C+=1,Ji({tournamentId:e==null?void 0:e.tournamentId,drawDefinition:i,context:c,eventId:a,matchUp:N}))}return{modifiedMatchUpsCount:C}}function T({uuids:E,matchUp:R,tieFormat:C,changes:M}){R.tieFormat=cs(C);let _=[],A=[];return M.forEach(N=>{if(N.countChange>0){let k=Math.max(0,...R.tieMatchUps.filter(F=>F.collectionId===N.collectionId).map(kl("collectionPosition"))),O=C.collectionDefinitions.find(F=>F.collectionId===N.collectionId),$=bC({matchUpsLimit:N.countChange,collectionPositionOffset:k,collectionDefinition:O,matchUp:R,uuids:E});A.push(..._t($,!1,!0)),h+=A.length,R.tieMatchUps.push(...$)}else{let k=N.toBePlayedTieMatchUpIds.slice(0,Math.abs(N.countChange));console.log("remove",k.length),_.push(...k),R.tieMatchUps=R.tieMatchUps.filter(({matchUpId:O})=>!k.includes(O))}}),A.length&&dg({matchUps:A,drawDefinition:i,tournamentId:u,eventId:a}),_.length&&Im({matchUpIds:_,action:"updateTieFormat",drawDefinition:i,tournamentId:u,eventId:a}),{matchUpIdsRemoved:_,matchUpsAdded:A}}}function LZ({check:t,matchUp:e}){let i="",n=[];return{changesArePossible:t.matchUpsCountChanges.every(({collectionId:r,countChange:a})=>{let s=e.tieMatchUps.filter(l=>l.collectionId===r&&l.matchUpStatus===Vr).map(kl("matchUpId")),o=s.length+a>=0||a>0;return!o&&a<0&&(i="Insufficient TO_BE_PLAYED matchUps"),n.push({toBePlayedTieMatchUpIds:s,collectionId:r,countChange:a}),o}),changes:n,cannotChangeReaon:i}}function aL({appliedPolicies:t,drawDefinition:e,auditData:i}){var a;if(!((a=t==null?void 0:t.audit)!=null&&a[aD]))return;let{extension:n}=ki({name:aD,element:e}),r={value:Array.isArray(n==null?void 0:n.value)?n==null?void 0:n.value.concat(i):[i],name:aD};dn({element:e,extension:r})}function L4({updateInProgressMatchUps:t=!1,tournamentRecord:e,collectionOrder:i,collectionName:n,tieFormatName:r,drawDefinition:a,matchUpFormat:s,matchUpCount:o,collectionId:l,matchUpType:c,structureId:u,matchUpId:d,category:p,eventId:h,gender:f,event:m,collectionValueProfiles:g,collectionValue:v,matchUpValue:y,scoreValue:b,setValue:I}){let T="modifyCollectionDefinition";if(s&&!Nl({matchUpFormat:s}))return he({result:{error:Re},context:{matchUpFormat:s},stack:T});if(n&&typeof n!="string")return he({result:{error:Re},context:{collectionName:n},stack:T});if(f&&!Object.values(jp).includes(f))return he({result:{error:Re},context:{gender:f},stack:T});if(p&&typeof p!="object")return he({result:{error:Re},context:{category:p},stack:T});let w={collectionValueProfiles:g,collectionValue:v,matchUpValue:y,scoreValue:b,setValue:I};if(!Object.values(w).filter(Boolean).length&&!i&&!n&&!s&&!o&&!c)return he({result:{error:ai},stack:T});if(Object.values(w).filter(Boolean).length>1)return he({info:"Only one value assignment allowed per collectionDefinition",result:{error:Re},stack:T});let S=uy({drawDefinition:a,structureId:u,matchUpId:d,eventId:h,event:m});if(S.error)return he({result:S,stack:T});let{matchUp:U,structure:P,tieFormat:E}=S,R=cs(E),C=E==null?void 0:E.collectionDefinitions.find(B=>B.collectionId===l),M=R==null?void 0:R.collectionDefinitions.find(B=>B.collectionId===l);if(!C)return he({info:"source collectionDefinition",result:{error:za},context:{collectionId:l},stack:T});let _=v??y??b??I;if(g!=null&&g.length){let B=Sre({matchUpCount:o??(C==null?void 0:C.matchUpCount)??0,collectionValueProfiles:g});if(B.errors)return he({result:{error:Re},info:B.errors,stack:T})}else if(_&&!Ii(_))return he({result:{error:Re},info:"value is not an integer",context:{value:_},stack:T});let A=(B,z)=>Nr(Object.keys(B),Object.keys(z)).length===Object.keys(B).length&&Nr(Object.values(B),Object.values(z)).length===Object.values(B).length,N=g&&(!C.collectionValueProfiles||!A(C.collectionValueProfiles,g)),k=Ii(v)&&C.collectionValue!==v||Ii(y)&&C.matchUpValue!==y||Ii(b)&&C.scoreValue!==b||Ii(I)&&C.setValue!==I||N,O=[];if(k&&(M.collectionValueProfiles=void 0,M.collectionValue=void 0,M.matchUpValue=void 0,M.scoreValue=void 0,M.setValue=void 0,Object.assign(M,w),O.push({collectionId:l,...Kt(w)})),(Ii(b)||Ii(I))&&M.collectionGroupNumber){let B=M.collectionGroupNumber;R.collectionDefinitions=R.collectionDefinitions.map(z=>{let{collectionGroupNumber:W,...Z}=z;return W===B?Z:z}),R.collectionGroups=R.collectionGroups.filter(({groupNumber:z})=>z!==B),O.push({collectionId:l,change:"collectionGroupNumber removed"})}let{aggregateValue:$,valueGoal:F}=hw(R),V=Kt({aggregateValue:$,valueGoal:F});if((V.aggregateValue!==(E==null?void 0:E.winCriteria.aggregateValue)||V.valueGoal!==(E==null?void 0:E.winCriteria.valueGoal))&&(R.winCriteria=V,O.push({collectionId:l,winCriteria:V})),Ii(i)&&C.collectionOrder!==i&&(M.collectionOrder=i,O.push({collectionId:l,collectionOrder:i})),n&&C.collectionName!==n&&(M.collectionName=n,O.push({collectionId:l,collectionName:n})),s&&C.matchUpFormat!==s&&(M.matchUpFormat=s,O.push({collectionId:l,matchUpFormat:s})),Ii(o)&&C.matchUpCount!==o&&(M.matchUpCount=o,O.push({collectionId:l,matchUpCount:o})),c&&C.matchUpType!==c)return he({result:{error:dx},context:{matchUpType:c},stack:T});p&&C.category!==p&&(M.category=p,O.push({collectionId:l,category:p})),f&&C.gender!==f&&(M.gender=f,O.push({collectionId:l,gender:f}));let j=Kt(R);if(S=Bo({tieFormat:j}),S.error)return he({result:S,stack:T});if(!O.length)return he({result:{...de,modifications:O}});if((E==null?void 0:E.tieFormatName)!==r?(j.tieFormatName=r,O.push({tieFormatName:r})):O.length&&(delete j.tieFormatName,O.push("tieFormatName removed: modifications without new tieFormatName")),S=x2e({tieFormat:j,updateInProgressMatchUps:t,tournamentRecord:e,drawDefinition:a,structure:P,eventId:h,matchUp:U,event:m}),!S.error){let{appliedPolicies:B}=hn({tournamentRecord:e}),z=Kt({collectionDefinition:M,drawId:a==null?void 0:a.drawId,action:T,structureId:u,matchUpId:d,eventId:h});aL({appliedPolicies:B,drawDefinition:a,auditData:z})}return he({result:{...S,modifications:O},stack:T})}function O2e({updateInProgressMatchUps:t,drawDefinition:e,structureId:i,structure:n,matchUpId:r,matchUp:a}){var o,l;let s=[];return r&&a?s=[a]:i&&n?s=((o=wn({matchUpFilters:{matchUpTypes:[Zn]},structure:n}))==null?void 0:o.matchUps)??[]:e&&(s=((l=lo({matchUpFilters:{matchUpTypes:[Zn]},drawDefinition:e}))==null?void 0:l.matchUps)??[]),{targetMatchUps:s.filter(c=>!c.winningSide&&c.matchUpStatus!==Lr&&(t||c.matchUpStatus!==td&&!ga(c)))}}function L2e({updateInProgressMatchUps:t,tournamentRecord:e,drawDefinition:i,targetMatchUps:n,tieFormat:r,event:a}){for(let s of n){let o=!!s.tieFormat;o&&(s.tieFormat=cs(r));let l;if(t){let c=hn({tournamentRecord:e,drawDefinition:i,event:a}).appliedPolicies,u=Tm({matchUpId:s.matchUpId,exitWhenNoValues:!0,tournamentRecord:e,appliedPolicies:c,drawDefinition:i,event:a});if(u.error)return u;l=u.score}o&&!l&&Ji({tournamentId:e==null?void 0:e.tournamentId,context:"updateTargetTeamMatchUps",eventId:a==null?void 0:a.eventId,matchUp:s,drawDefinition:i})}return{...de}}function Dhe({updateInProgressMatchUps:t,originalValueGoal:e,tournamentRecord:i,wasAggregateValue:n,tieFormatName:r,drawDefinition:a,structureId:s,structure:o,tieFormat:l,matchUpId:c,matchUp:u,eventId:d,event:p}){let{aggregateValue:h,valueGoal:f}=hw(l);l.winCriteria=Kt({aggregateValue:h,valueGoal:f}),(e&&e!==f||h&&!n)&&(r?l.tieFormatName=r:delete l.tieFormatName);let{targetMatchUps:m}=O2e({updateInProgressMatchUps:t,drawDefinition:a,structureId:s,structure:o,matchUpId:c,matchUp:u});L2e({updateInProgressMatchUps:t,tournamentRecord:i,targetMatchUps:m,drawDefinition:a,tieFormat:l,event:p});let g=Kt(l),v=Bo({tieFormat:g});if(v.error)return v;if(d&&p)p.tieFormat=g;else if(c&&u)u.tieFormat=l;else if(o)o.tieFormat=g;else if(a)a.tieFormat=g;else if(!u||!a)return{error:Gt};return Hn({drawDefinition:a,eventId:p==null?void 0:p.eventId}),{...de}}function Ehe({updateInProgressMatchUps:t=!0,collectionGroupNumber:e,tournamentRecord:i,drawDefinition:n,tieFormatName:r,structureId:a,matchUpId:s,matchUp:o,eventId:l,event:c}){if(!e)return{error:ai};if(isNaN(e))return{error:Re};let u="removeCollectionGroup",d=o?void 0:uy({drawDefinition:n,structureId:a,matchUpId:s,eventId:l,event:c});if(d!=null&&d.error)return he({result:d,stack:u});let p=d==null?void 0:d.structure;o=o??(d==null?void 0:d.matchUp);let h=d==null?void 0:d.tieFormat,f=h==null?void 0:h.winCriteria.valueGoal,m=h==null?void 0:h.winCriteria.aggregateValue,g=cs(h);if(d=Bo({tieFormat:g}),d.error)return he({result:d,stack:u});let v=[];if(g.collectionDefinitions=g.collectionDefinitions.map(y=>{let{collectionGroupNumber:b,...I}=y;return b!==e?y:(v.push(y.collectionId),I)}),g.collectionGroups=g.collectionGroups.filter(({groupNumber:y})=>y!==e),d=Dhe({updateInProgressMatchUps:t,originalValueGoal:f,wasAggregateValue:m,tournamentRecord:i,drawDefinition:n,tieFormatName:r,structureId:a,structure:p,tieFormat:g,matchUpId:s,matchUp:o,eventId:l,event:c}),!d.error){let{appliedPolicies:y}=hn({tournamentRecord:i}),b=Kt({drawId:n==null?void 0:n.drawId,collectionGroupNumber:e,action:u,structureId:a,matchUpId:s,eventId:l});aL({appliedPolicies:y,drawDefinition:n,auditData:b})}return he({result:{...d,modifiedCollectionIds:v},stack:u})}function ZS({tieFormat:t,orderMap:e}){var n,r;let i=cs(t);return(n=i.collectionDefinitions)==null||n.forEach(a=>{let s=e[a.collectionId];s&&(a.collectionOrder=s)}),(r=i.collectionDefinitions)==null||r.sort((a,s)=>PS(a.collectionOrder)-PS(s.collectionOrder)),i}function Phe({tournamentRecord:t,drawDefinition:e,structureId:i,matchUpId:n,orderMap:r,eventId:a,matchUp:s,event:o}){var u;if(typeof r!="object"||!Object.values(r).every(d=>Ii(d)))return he({result:{error:Re},context:{orderMap:r}});let l=i?hi({drawDefinition:e,structureId:i}):void 0;if(l!=null&&l.error)return l;let c=l==null?void 0:l.structure;if(a&&(o!=null&&o.tieFormat))FZ({tournamentRecord:t,event:o,orderMap:r});else if(n){let d=e&&ar({drawDefinition:e,matchUpId:n});if(d!=null&&d.error)return d;if(s=d.matchUp,!s)return{error:rl};let p=(u=EO({tournamentRecord:t,matchUpId:n,structure:c,drawDefinition:e,event:o}))==null?void 0:u.tieFormat;s.tieFormat=ZS({tieFormat:p,orderMap:r}),Ji({tournamentId:t==null?void 0:t.tournamentId,eventId:o==null?void 0:o.eventId,drawDefinition:e,matchUp:s})}else if(i)if(c!=null&&c.tieFormat)c.tieFormat=ZS({tieFormat:c.tieFormat,orderMap:r}),Che({eventId:o==null?void 0:o.eventId,tournamentRecord:t,drawDefinition:e,structure:c,orderMap:r}),Hn({drawDefinition:e,structureIds:[c.structureId]});else if(e.tieFormat)hj({structureIds:[i],tournamentRecord:t,drawDefinition:e,orderMap:r,event:o});else if(o!=null&&o.tieFormat)FZ({structureIds:[i],tournamentRecord:t,orderMap:r,event:o});else return{error:za};else if(e!=null&&e.tieFormat)hj({tournamentRecord:t,drawDefinition:e,orderMap:r,event:o});else return{error:za};return{...de}}function FZ({tournamentRecord:t,structureIds:e,orderMap:i,event:n}){let r=ZS({tieFormat:n.tieFormat,orderMap:i});e!=null&&e.length||(n.tieFormat=r);for(let a of n.drawDefinitions??[])hj({tournamentRecord:t,drawDefinition:a,structureIds:e,orderMap:i,event:n})}function hj({tournamentRecord:t,drawDefinition:e,structureIds:i,orderMap:n,event:r}){let a=e.tieFormat??(r==null?void 0:r.tieFormat),s=ZS({tieFormat:a,orderMap:n});i!=null&&i.length||(e.tieFormat=s);let o=[];for(let l of e.structures??[])i!=null&&i.length&&!i.includes(l.structureId)||((l.tieFormat||i!=null&&i.includes(l.structureId))&&(l.tieFormat=ZS({tieFormat:l.tieFormat??e.tieFormat??(r==null?void 0:r.tieFormat),orderMap:n})),Che({eventId:r==null?void 0:r.eventId,tournamentRecord:t,drawDefinition:e,structure:l,orderMap:n}),o.push(l.structureId));Hn({drawDefinition:e,structureIds:o})}function Che({tournamentRecord:t,drawDefinition:e,structure:i,orderMap:n,eventId:r}){var s;let a=(s=wn({matchUpFilters:{matchUpTypes:[Zn]},structure:i}))==null?void 0:s.matchUps;for(let o of a)o.tieFormat&&(o.tieFormat=ZS({tieFormat:o.tieFormat,orderMap:n}),Ji({tournamentId:t==null?void 0:t.tournamentId,drawDefinition:e,eventId:r,matchUp:o}))}function F4({updateInProgressMatchUps:t=!0,tieFormatComparison:e,tournamentRecord:i,drawDefinition:n,tieFormatName:r,collectionId:a,structureId:s,matchUpId:o,eventId:l,matchUp:c,event:u}){var R,C,M,_,A;let d="removeCollectionDefinition",p=c?void 0:uy({drawDefinition:n,structureId:s,matchUpId:o,eventId:l,event:u});if(p!=null&&p.error)return he({result:p,stack:d});let h=p==null?void 0:p.structure;c=c??(p==null?void 0:p.matchUp);let f=p==null?void 0:p.tieFormat,m=cs(f);if(p=Bo({tieFormat:m}),p.error)return he({result:p,stack:d});let g=(R=m==null?void 0:m.collectionDefinitions)==null?void 0:R.find(N=>N.collectionId===a);if(!g)return he({result:{error:za,collectionId:a}});m.collectionDefinitions=m.collectionDefinitions.filter(N=>N.collectionId!==a),g.collectionGroupNumber&&(m.collectionDefinitions=m.collectionDefinitions.map(N=>{let{collectionGroupNumber:k,...O}=N;return O}),m.collectionGroups=m.collectionGroups.filter(({groupNumber:N})=>N!==g.collectionGroupNumber));let{aggregateValue:v,valueGoal:y}=hw(m);m.winCriteria=Kt({aggregateValue:v,valueGoal:y});let b=f==null?void 0:f.winCriteria.valueGoal,I=f==null?void 0:f.winCriteria.aggregateValue;(b&&b!==y||v&&!I)&&(r?m.tieFormatName=r:delete m.tieFormatName);let T=[];o&&c?T=[c]:s&&h?T=((C=wn({matchUpFilters:{matchUpTypes:[Zn]},structure:h}))==null?void 0:C.matchUps)??[]:n?T=((M=lo({matchUpFilters:{matchUpTypes:[Zn]},drawDefinition:n}))==null?void 0:M.matchUps)??[]:u&&(T=((_=Jh({matchUpFilters:{matchUpTypes:[Zn]},drawDefinition:n}))==null?void 0:_.matchUps)??[]);let w=(T||[]).filter(N=>{var $,F,V;let k=(F=($=N.tieMatchUps)==null?void 0:$.filter(j=>j.collectionId===a))==null?void 0:F.some(ga),O=e&&N.tieFormat?(V=Kf({descendant:N.tieFormat,ancestor:m}))==null?void 0:V.different:!1;return t&&!k||!N.winningSide&&N.matchUpStatus!==Lr&&(t||N.matchUpStatus!==td&&!ga(N)&&!O)});if(!w.length)return{error:eU};let{appliedPolicies:S}=hn({tournamentRecord:i});if(o&&c&&t){let N=(A=c.tieMatchUps)==null?void 0:A.filter(k=>k.collectionId===a);for(let k of N??[]){let O=LC({matchUpId:k.matchUpId,tieMatchUpId:c==null?void 0:c.matchUpId,winningSide:void 0,removeScore:!0,tournamentRecord:i,appliedPolicies:S,drawDefinition:n,event:u});if(O.error||(O=ar({drawDefinition:n,matchUpId:o}),O.error))return O;c=O==null?void 0:O.matchUp}}let U=[];for(let N of w){for(let k of(N==null?void 0:N.sides)??[])k.lineUp=(k.lineUp??[]).map(O=>({participantId:O.participantId,collectionAssignments:((O==null?void 0:O.collectionAssignments)??[]).filter($=>$.collectionId!==a)}));if(N.tieMatchUps=(N.tieMatchUps??[]).filter(k=>{let O=k.collectionId===a;return O&&U.push(k.matchUpId),!O}),N.tieFormat&&(N.tieFormat=cs(m)),t){let k=Tm({matchUpId:N.matchUpId,exitWhenNoValues:!0,tournamentRecord:i,appliedPolicies:S,drawDefinition:n,event:u});if(k.error)return k}Ji({tournamentId:i==null?void 0:i.tournamentId,eventId:u==null?void 0:u.eventId,drawDefinition:n,context:d,matchUp:N})}U.length&&Im({tournamentId:i==null?void 0:i.tournamentId,matchUpIds:U,eventId:u==null?void 0:u.eventId,drawDefinition:n});let P=Kt(m);if(p=Bo({tieFormat:P}),p.error)return he({result:p,stack:d});if(l&&u)u.tieFormat=P;else if(o&&c)c.tieFormat=P;else if(h)h.tieFormat=P;else if(n)n.tieFormat=P;else if(!c||!n)return{error:Gt};Hn({drawDefinition:n,eventId:u==null?void 0:u.eventId});let E=Kt({drawId:n==null?void 0:n.drawId,action:d,collectionId:a,structureId:s,matchUpId:o,eventId:l});return aL({appliedPolicies:S,drawDefinition:n,auditData:E}),{tieFormat:P,deletedMatchUpIds:U,targetMatchUps:w,...de}}function Rhe({updateInProgressMatchUps:t=!0,tournamentRecord:e,groupDefinition:i,drawDefinition:n,collectionIds:r,tieFormatName:a,structureId:s,matchUpId:o,matchUp:l,eventId:c,event:u}){let d="addCollectionGroup";if(!Array.isArray(r))return he({result:{error:ai},stack:d});let p=l?void 0:uy({drawDefinition:n,structureId:s,matchUpId:o,eventId:c,event:u});if(p!=null&&p.error)return he({result:p,stack:d});let h=p==null?void 0:p.structure;l=l||(p==null?void 0:p.matchUp);let f=p==null?void 0:p.tieFormat,m=f==null?void 0:f.winCriteria.valueGoal,g=cs(f);if(p=Bo({tieFormat:g}),p.error)return he({result:p,stack:d});for(let y of g.collectionDefinitions){let{collectionId:b,collectionGroupNumber:I}=y;if(I&&r.includes(b))return he({info:"collectionIds cannot be part of other collectionGroups",result:{error:Re},stack:d})}let v=(g.collectionGroups||[]).reduce((y,b)=>b.groupNumber>y?b.groupNumber:y,0)+1;return i.groupNumber=v,g.collectionDefinitions=g.collectionDefinitions.map(y=>r.includes(y.collectionId)?{...y,collectionGroupNumber:v}:y),g.collectionGroups=[...g.collecitonGroups||[],i],Dhe({updateInProgressMatchUps:t,originalValueGoal:m,tournamentRecord:e,drawDefinition:n,tieFormatName:a,structureId:s,structure:h,tieFormat:g,matchUpId:o,matchUp:l,eventId:c,event:u})}function $4({updateInProgressMatchUps:t=!0,collectionDefinition:e,referenceCategory:i,tournamentRecord:n,policyDefinitions:r,enforceCategory:a,referenceGender:s,drawDefinition:o,tieFormatName:l,enforceGender:c,structureId:u,matchUpId:d,matchUp:p,eventId:h,uuids:f,event:m}){var F,V;let g="addCollectionDefinition",v=hn({tournamentRecord:n,drawDefinition:o,event:m}).appliedPolicies??{},y=(r==null?void 0:r[Ba])??(v==null?void 0:v[Ba]);a=a??((F=y==null?void 0:y.participants)==null?void 0:F.enforceCategory);let b=(c??((V=y==null?void 0:y.participants)==null?void 0:V.enforceGender))!==!1,I=!!((i??(m==null?void 0:m.category))&&a!==!1),T=!!((s??(m==null?void 0:m.gender))&&b),w=LP({referenceCategory:i??(m==null?void 0:m.category),collectionDefinition:e,referenceGender:s,checkCategory:I,checkGender:T,event:m});if(w.error)return he({result:w,stack:g});let S=p!=null&&p.tieFormat?void 0:uy({drawDefinition:o,structureId:u,matchUpId:d,eventId:h,event:m});if(S!=null&&S.error)return he({result:{error:S.error},stack:g});let U=S==null?void 0:S.structure;p=p??(S==null?void 0:S.matchUp);let P=(p==null?void 0:p.tieFormat)??(S==null?void 0:S.tieFormat),E=cs(P);if(S=Bo({tieFormat:E}),S==null?void 0:S.error)return he({result:{error:S.error},stack:g});if(!e.collectionId)e.collectionId=yn();else if(E.collectionDefinitions.map(({collectionId:j})=>j).includes(e.collectionId))return he({context:{collectionId:e.collectionId},result:{error:Uae}});E.collectionDefinitions.push(e),E.collectionDefinitions.sort((j,B)=>(j.collectionOrder||0)-(B.collectionOrder||0)).forEach((j,B)=>j.collectionOrder=B+1);let{aggregateValue:R,valueGoal:C}=hw(E);E.winCriteria=Kt({aggregateValue:R,valueGoal:C});let M=P==null?void 0:P.winCriteria.valueGoal,_=P==null?void 0:P.winCriteria.aggregateValue;(M&&M!==C||R&&!_)&&(l?E.tieFormatName=l:delete E.tieFormatName);let A=[],N=[],k=[],O=Kt(E);if(S=Bo({tieFormat:O}),S==null?void 0:S.error)return he({result:{error:S.error},stack:g});if(h&&m){m.tieFormat=O;for(let j of m.drawDefinitions??[])if(!j.tieFormat)for(let B of j.structures??[]){if(B.tieFormat)continue;let z=P$({updateInProgressMatchUps:t,collectionDefinition:e,structure:B,uuids:f});N.push(...z.newMatchUps),k.push(...z.targetMatchUps),A.push(B.structureId)}GM({modifiedMatchUps:k,eventId:m==null?void 0:m.eventId,modifiedStructureIds:A,tournamentRecord:n,drawDefinition:o,addedMatchUps:N,stack:g})}else if(u&&U){U.tieFormat=O;let j=P$({updateInProgressMatchUps:t,collectionDefinition:e,structure:U,uuids:f});N.push(...j.newMatchUps),k=j.targetMatchUps,GM({modifiedMatchUps:k,eventId:m==null?void 0:m.eventId,modifiedStructureIds:A,tournamentRecord:n,drawDefinition:o,addedMatchUps:N,stack:g})}else if(d&&p){if(!h_({matchUp:p,updateInProgressMatchUps:t}))return he({result:{error:Rz},stack:g});p.tieFormat=O;let j=bC({collectionDefinition:e,matchUp:p,uuids:f});Array.isArray(p.tieMatchUps)||(p.tieMatchUps=[]),p.tieMatchUps.push(...j),N.push(...j),GM({modifiedMatchUps:[p],eventId:m==null?void 0:m.eventId,modifiedStructureIds:A,tournamentRecord:n,drawDefinition:o,addedMatchUps:N,stack:g})}else if(o){o.tieFormat=O;for(let j of o.structures??[]){let B=P$({updateInProgressMatchUps:t,collectionDefinition:e,structure:j,uuids:f});A.push(j.structureId),N.push(...B.newMatchUps),k.push(...B.targetMatchUps)}GM({modifiedMatchUps:k,eventId:m==null?void 0:m.eventId,tournamentRecord:n,drawDefinition:o,addedMatchUps:N,stack:g})}else return{error:Gt};let $=Kt({drawId:o==null?void 0:o.drawId,collectionDefinition:e,action:g,structureId:u,matchUpId:d,eventId:h});return aL({appliedPolicies:v,drawDefinition:o,auditData:$}),{tieFormat:O,targetMatchUps:k,addedMatchUps:N,...de}}function P$({updateInProgressMatchUps:t,collectionDefinition:e,structure:i,uuids:n}){var s;let r=[],a=((s=wn({matchUpFilters:{matchUpTypes:[Zn]},structure:i}))==null?void 0:s.matchUps).filter(o=>h_({matchUp:o,updateInProgressMatchUps:t})&&!o.tieFormat);for(let o of a){let l=bC({collectionDefinition:e,matchUp:o,uuids:n});Array.isArray(o.tieMatchUps)||(o.tieMatchUps=[]),o.tieMatchUps.push(...l),r.push(...l)}return{newMatchUps:r,targetMatchUps:a}}function GM({modifiedStructureIds:t,tournamentRecord:e,modifiedMatchUps:i,drawDefinition:n,addedMatchUps:r,eventId:a,stack:s}){dg({tournamentId:e==null?void 0:e.tournamentId,matchUps:r,drawDefinition:n,eventId:a}),i==null||i.forEach(o=>{Ji({tournamentId:e==null?void 0:e.tournamentId,drawDefinition:n,context:s,matchUp:o,eventId:a})}),Hn({structureIds:t,drawDefinition:n,eventId:a})}function Mhe({updateInProgressMatchUps:t=!1,tieFormatComparison:e,modifiedTieFormat:i,tournamentRecord:n,considerations:r,drawDefinition:a,structureId:s,matchUpId:o,eventId:l,uuids:c,event:u}){let d="modifyTieFormat";if(!Bo({tieFormat:i}).valid)return he({result:{error:Ih},info:"falied validation",stack:d});let p=uy({drawDefinition:a,structureId:s,matchUpId:o,eventId:l,event:u});if(p.error)return he({result:p,stack:d});let{matchUp:h,tieFormat:f}=p,m=cs(f),g=Kf({descendant:i,ancestor:m,considerations:r});if(g.invalid)return he({context:{invalid:g.invalid},result:{error:Ih},stack:d});if(!(g!=null&&g.different))return he({result:{...de},info:"Nothing to do",stack:d});let v=m.collectionDefinitions.map(({collectionId:P})=>P),y=i.collectionDefinitions.map(({collectionId:P})=>P),b=v.filter(P=>!y.includes(P)),I=i.collectionDefinitions.filter(({collectionId:P})=>!v.includes(P)),T=I.map(kl("collectionId")),w=[],S,U=i.tieFormatName;for(let P of i.collectionDefinitions){if(T.includes(P.collectionId))continue;let E=L4({updateInProgressMatchUps:t,...P,tournamentRecord:n,tieFormatName:U,drawDefinition:a,structureId:s,matchUpId:o,eventId:l,event:u});if(E.modifications&&w.push(...E.modifications),E.error)return he({result:E,stack:d});E.tieFormat&&(S=E.tieFormat)}for(let P of I){let E=$4({updateInProgressMatchUps:t,collectionDefinition:P,tournamentRecord:n,drawDefinition:a,tieFormatName:U,structureId:s,matchUpId:o,matchUp:h,eventId:l,uuids:c,event:u});if(E.error)return he({result:E,stack:d});E.tieFormat&&(S=E.tieFormat)}for(let P of b){let E=F4({updateInProgressMatchUps:t,tieFormatComparison:e,tournamentRecord:n,drawDefinition:a,tieFormatName:U,collectionId:P,structureId:s,matchUpId:o,eventId:l,matchUp:h,event:u});if(E.error)return he({result:E,stack:d});E.tieFormat&&(S=E.tieFormat)}return(f==null?void 0:f.tieFormatName)!==U?(S.tieFormatName=U,w.push({tieFormatName:U})):(w.length||T.length||b.length)&&(delete S.tieFormatName,w.push("tieFormatName removed: modifications without new tieFormatName")),S.collectionDefinitions=S.collectionDefinitions.sort((P,E)=>PS(P.collectionOrder)-PS(E.collectionOrder)).map((P,E)=>({...P,collectionOrder:E+1})),{processedTieFormat:cs(S),modifications:w,...de}}function Nhe({tournamentRecord:t}){if(!t)return{error:ut};let e=0;for(let i of t.events??[]){let n=i.tieFormats??[],r=u=>{if(!u.tieFormat)return;let d;for(let p of n)Kf({descendant:u.tieFormat,ancestor:p}).different||(d=p.tieFormatId);if(d)u.tieFormatId=d,delete u.tieFormat;else{let p=_t(u.tieFormat,void 0,!0);p.tieFormatId||(p.tieFormatId=yn()),u.tieFormatId=p.tieFormatId,delete u.tieFormat,n.push(p),e+=1}},a=i.eventType;r({tieFormat:i.tieFormat,eventType:a});for(let u of i.drawDefinitions??[]){r({tieFormat:u.tieFormat,eventType:a});for(let d of u.structures??[])r({tieFormat:d.tieFormat,eventType:a})}let s=(u,d)=>{var h;let p=(h=l.matchUps)==null?void 0:h.find(f=>f.matchUpId===u);p&&(p.tieFormatId=d,delete p.tieFormat,Ji({tournamentId:t==null?void 0:t.tournamentId,eventId:i.eventId,matchUp:p}))},o=u=>{let d=_t(u.tieFormat,void 0,!0);d.tieFormatId||(d.tieFormatId=yn()),n.push(d),e+=1,s(u.matchUpId,d.tieFormatId)},l=Jh({matchUpFilters:{matchUpTypes:[ec]},event:i}),c=l.matchUps??[];for(let u of c){let d;for(let p of n)u.tieFormat&&Kf({descendant:u.tieFormat,ancestor:p}).different||(d=p.tieFormatId);d?s(u.matchUpId,d):o(u)}n.length&&(i.tieFormats=n)}return{...de,addedCount:e}}var B4={};Li(B4,{addDrawDefinitionExtension:()=>Mx,addEventExtension:()=>Bg,addEventTimeItem:()=>uw,addExtension:()=>dn,addNotes:()=>sO,addOnlineResource:()=>Lhe,addParticipantExtension:()=>Zse,addParticipantTimeItem:()=>$3,addTimeItem:()=>qp,addTournamentExtension:()=>fq,addTournamentTimeItem:()=>TC,analyzeDraws:()=>UC,analyzeTournament:()=>SW,copyTournamentRecord:()=>_he,createTournamentRecord:()=>tL,generate:()=>Ahe,getAggregateTeamResults:()=>wW,getAllowedDrawTypes:()=>SO,getAllowedMatchUpFormats:()=>yW,getAppliedPolicies:()=>hn,getCompetitionDateRange:()=>UO,getCompetitionPenalties:()=>bW,getPolicyDefinitions:()=>wm,getTournamentInfo:()=>pw,getTournamentPenalties:()=>TO,getTournamentPersons:()=>IW,getTournamentPoints:()=>DO,getTournamentStructures:()=>I3,getTournamentTimeItem:()=>jx,mutate:()=>khe,query:()=>jue,removeDrawDefinitionExtension:()=>Xse,removeEventExtension:()=>Nx,removeExtension:()=>oo,removeNotes:()=>x3,removeOnlineResource:()=>Ohe,removeParticipantExtension:()=>Jse,removeTournamentExtension:()=>mq,setTournamentCategories:()=>Bhe,setTournamentDates:()=>sL,setTournamentEndDate:()=>jhe,setTournamentName:()=>Fhe,setTournamentNotes:()=>$he,setTournamentStartDate:()=>Vhe,setTournamentStatus:()=>xhe});var Ahe={};Li(Ahe,{copyTournamentRecord:()=>_he,createTournamentRecord:()=>tL});function _he(t){var p,h;let e=Qt(t,[{tournamentRecord:!0,startDate:!0,endDate:!1,tournamentName:!0}]);if(e.error)return e;let{startDate:i,endDate:n}=t.tournamentRecord,r=24*60*60*1e3,a=(i&&n?new Date(Ri(n)).getTime()-new Date(Ri(i)).getTime():0)/r,s=t.endDate||Zz(t.startDate,a),o=f=>f==null?void 0:f.filter(({itemType:m})=>{var g;return(g=t.itemTypeList)==null?void 0:g.includes(m)}),l=f=>f==null?void 0:f.filter(({name:m})=>{var g;return(g=t.extensionList)==null?void 0:g.includes(m)}),c=f=>{let{timeItems:m,extensions:g,...v}=f;return _t({...v,timeItems:o(m),extensions:l(g)},!1,!0)},u=f=>{let{drawDefinitions:m,timeItems:g,extensions:v,startDate:y,endDate:b,...I}=f;return _t({extensions:l(v),timeItems:o(g),startDate:t.startDate,endDate:s,...I},!1,!0)},d={participants:t.copyParticipants?((p=t.tournamentRecord.participants)==null?void 0:p.map(c))??[]:[],parentOrganisation:_t({...t.tournamentRecord.parentOrganisation},!1,!0),venues:_t(t.tournamentRecord.venues??[],!1,!0),extensions:l(t.tournamentRecord.extensions),timeItems:o(t.tournamentRecord.timeItems),events:((h=t.tournamentRecord.events)==null?void 0:h.map(u))??[],weekdays:[...t.tournamentRecord.weekdays??[]],tournamentName:t.tournamentName,startDate:t.startDate,tournamentId:yn(),endDate:s};return{...de,tournamentRecord:d}}var khe={};Li(khe,{addDrawDefinitionExtension:()=>Mx,addEventExtension:()=>Bg,addEventTimeItem:()=>uw,addExtension:()=>dn,addNotes:()=>sO,addOnlineResource:()=>Lhe,addParticipantExtension:()=>Zse,addParticipantTimeItem:()=>$3,addTimeItem:()=>qp,addTournamentExtension:()=>fq,addTournamentTimeItem:()=>TC,removeDrawDefinitionExtension:()=>Xse,removeEventExtension:()=>Nx,removeExtension:()=>oo,removeNotes:()=>x3,removeOnlineResource:()=>Ohe,removeParticipantExtension:()=>Jse,removeTournamentExtension:()=>mq,setTournamentCategories:()=>Bhe,setTournamentDates:()=>sL,setTournamentEndDate:()=>jhe,setTournamentName:()=>Fhe,setTournamentNotes:()=>$he,setTournamentStartDate:()=>Vhe,setTournamentStatus:()=>xhe});var F2e="ABANDONED",$2e="ACTIVE",B2e="CANCELLED",V2e="COMPLETED",j2e="IN_PROGRESS",V4={ABANDONED:F2e,ACTIVE:$2e,CANCELLED:B2e,COMPLETED:V2e,IN_PROGRESS:j2e};function xhe({tournamentRecord:t,status:e}){return t?e&&!Object.keys(V4).includes(e)?{error:Re,info:"Unknown status"}:(t.tournamentStatus=e,{...de}):{error:ut}}function Ohe(t){var c,u,d;let e=Qt(t,[{tournamentRecord:!0,onlineResource:!0}]);if(e.error)return e;let{tournamentRecord:i,onlineResource:n,organisationId:r,participantId:a,personId:s,courtId:o,venueId:l}=t;if(r){if(((c=i.parentOrganisation)==null?void 0:c.parentOrganisationId)!==r)return he({result:{error:za}});y0({element:i.parentOrganisation,onlineResource:n})}else if(a||s){let p=(i.participants??[]).find(h=>{var f;return s&&((f=h.person)==null?void 0:f.personId)===s||h.participantId===a});if(!p)return he(s?{result:{error:za}}:{result:{error:xr}});if(s){if(((u=p.person)==null?void 0:u.personId)!==s)return he({result:{error:jI}});y0({element:p.person,onlineResource:n})}else y0({element:p,onlineResource:n})}else if(o){let p=(d=(i.venues??[]).filter(h=>!l||h.venueId===l).flatMap(h=>(h.courts??[]).filter(f=>f.courtId===o)))==null?void 0:d[0];if(!p)return he({result:{error:QT}});y0({element:p,onlineResource:n})}else if(l){let p=(i.venues??[]).find(h=>h.venueId===l);if(!p)return he({result:{error:HI}});y0({element:p,onlineResource:n})}else y0({element:i,onlineResource:n}),Si({payload:{parentOrganisation:i.parentOrganisation,onlineResources:i.onlineResources,tournamentId:i.tournamentId},topic:xy});return{...de}}function y0({element:t,onlineResource:e}){let i=(t.onlineResources??[]).filter(n=>!((n==null?void 0:n[AS])===e[AS]&&(n==null?void 0:n[_S])===e[_S]&&(n==null?void 0:n[kS])===e[kS]));t.onlineResources=i}function Lhe(t){var c,u,d;let e=Qt(t,[{tournamentRecord:!0,onlineResource:!0}]);if(e.error)return e;let{tournamentRecord:i,onlineResource:n,organisationId:r,participantId:a,personId:s,courtId:o,venueId:l}=t;if(r){if(((c=i.parentOrganisation)==null?void 0:c.parentOrganisationId)!==r)return he({result:{error:za}});b0({element:i.parentOrganisation,onlineResource:n})}else if(a||s){let p=(i.participants??[]).find(h=>{var f;return s&&((f=h.person)==null?void 0:f.personId)===s||h.participantId===a});if(!p)return he(s?{result:{error:za}}:{result:{error:xr}});if(s){if(((u=p.person)==null?void 0:u.personId)!==s)return he({result:{error:jI}});b0({element:p.person,onlineResource:n})}else b0({element:p,onlineResource:n})}else if(o){let p=(d=(i.venues??[]).filter(h=>!l||h.venueId===l).flatMap(h=>(h.courts??[]).filter(f=>f.courtId===o)))==null?void 0:d[0];if(!p)return he({result:{error:QT}});b0({element:p,onlineResource:n})}else if(l){let p=(i.venues??[]).find(h=>h.venueId===l);if(!p)return he({result:{error:HI}});b0({element:p,onlineResource:n})}else b0({element:i,onlineResource:n}),Si({payload:{parentOrganisation:i.parentOrganisation,onlineResources:i.onlineResources,tournamentId:i.tournamentId},topic:xy});return{...de}}function b0({element:t,onlineResource:e}){let i=(t.onlineResources??[]).filter(n=>(n==null?void 0:n[AS])!==e[AS]&&(n==null?void 0:n[_S])!==e[_S]&&(n==null?void 0:n[kS])!==e[kS]);return i.push(e),t.onlineResources=i,{...de}}function Fhe({tournamentRecord:t,promotionalName:e,tournamentName:i,formalName:n}){if(!t)return{error:ut};let r=t.tournamentId,a={tournamentId:r};return i&&i!==t.tournamentName&&(t.tournamentName=i,a.tournamentName=i),e&&e!==t.promotionalName&&(t.promotionalName=e,a.promotionalName=e),n&&n!==t.formalName&&(t.formalName=n,a.formalName=n),t.promotionalName===t.tournamentName&&(delete t.promotionalName,a.promotionalName=""),t.formalName===t.tournamentName&&(delete t.formalName,a.formalName=""),Object.keys(a).length>1&&Si({topic:xy,payload:{parentOrganisation:t.parentOrganisation,tournamentId:r,...a}}),{...de}}function $he({tournamentRecord:t,notes:e}){if(!t)return{error:ut};let i=e?sO({element:t,notes:e}):x3({element:t});return i.error?i:(Si({topic:xy,payload:{parentOrganisation:t.parentOrganisation,tournamentId:t.tournamentId,notes:e??""}}),{...de})}function Bhe({tournamentRecord:t,categories:e}){return t?(e=(e||[]).filter(i=>i.categoryName&&i.type),t.tournamentCategories=e,Si({topic:xy,payload:{parentOrganisation:t.parentOrganisation,tournamentId:t.tournamentId,categories:e}}),{...de}):{error:ut}}function G2e({tournamentRecord:t}){var a,s;if(!t)return{error:ut};let{startDate:e,endDate:i}=t,n=NS(e,i),r=[];for(let o of t.venues||[])(a=o==null?void 0:o.courts)!=null&&a.length&&r.push(...o.courts);for(let o of r){let{startTime:l,endTime:c}=(o.dateAvailability??[]).reduce((p,h)=>{let f=an(p.startTime),m=an(p.endTime);return h.startTime&&an(h.startTime)<f&&(p.startTime=h.startTime),h.endTime&&an(h.endTime)>m&&(p.endTime=h.endTime),p},{startTime:"08:00",endTime:"18:00"}),u=n.map(p=>{var h;return((h=o.dateAvailability)==null?void 0:h.find(f=>f.date===p))??{date:p,startTime:l,endTime:c}}),d=(s=o.dateAvailability)==null?void 0:s.find(p=>!p.date);d&&u.unshift(d),o.dateAvailability=u}return{...de}}function sL(t){var h,f;let{tournamentRecord:e,startDate:i,endDate:n,weekdays:r}=t,a=(h=t.activeDates)==null?void 0:h.filter(Boolean),s=Qt(t,[{tournamentRecord:!0},{[ds]:m=>Dp.test(m),[rc]:Fa,startDate:!1,endDate:!1},{[ds]:m=>m.filter(Boolean).every(g=>Dp.test(g)),[rc]:Fa,activeDates:!1},{[ds]:Ude,weekdays:!1}]);if(s.error)return s;if(n&&i&&new Date(n)<new Date(i))return{error:Re};if(n&&i&&new Date(i)>new Date(n))return{error:Re};if(a!=null&&a.length){let m=i||e.startDate,g=n||e.endDate,v=!m||a.every(b=>new Date(b)>=new Date(m)),y=!g||a.every(b=>new Date(b)<=new Date(g));if(!v||!y)return{error:Fa}}let o;(i&&e.startDate&&new Date(i)>new Date(e.startDate)||n&&e.endDate&&new Date(n)<new Date(e.endDate))&&(o=!0);let l=NS(e.startDate,e.endDate);i&&(e.startDate=i),n&&(e.endDate=n);let c=NS(e.startDate,e.endDate),u=l.filter(m=>!c.includes(m)),d=c.filter(m=>!l.includes(m));for(let m of e.events??[])i&&m.startDate&&new Date(m.startDate)<new Date(i)&&(m.startDate=i),n&&m.startDate&&new Date(m.startDate)>new Date(n)&&(m.startDate=i??n),n&&m.endDate&&new Date(m.endDate)>new Date(n)&&(m.endDate=n),i&&m.endDate&&new Date(m.endDate)<new Date(i)&&(m.endDate=n??i);i&&e.endDate&&new Date(i)>new Date(e.endDate)&&(e.endDate=i),n&&e.startDate&&new Date(n)<new Date(e.startDate)&&(e.startDate=n),a&&(e.activeDates=a),r&&(e.weekdays=r);let p=o&&((f=H2e({tournamentRecord:e}))==null?void 0:f.unscheduledMatchUpIds);return G2e({tournamentRecord:e}),Si({payload:Kt({parentOrganisation:e.parentOrganisation,tournamentId:e.tournamentId,activeDates:a,startDate:i,weekdays:r,endDate:n}),topic:xy}),{...de,unscheduledMatchUpIds:p,datesAdded:d,datesRemoved:u}}function Vhe({tournamentRecord:t,startDate:e}){return e?sL({tournamentRecord:t,startDate:e}):{error:Fa}}function jhe({tournamentRecord:t,endDate:e}){return e?sL({tournamentRecord:t,endDate:e}):{error:Fa}}function H2e({tournamentRecord:t}){let e=Wa({tournamentRecord:t}).matchUps??[],i=t.startDate&&new Date(t.startDate),n=t.endDate&&new Date(t.endDate),r=[],a=[];for(let s of e){let{schedule:o,matchUpId:l}=s;if(o&&o.scheduledDate){let c=new Date(o.scheduledDate);(i&&c<i||n&&c>n)&&(a.push(l),r.includes(o.scheduledDate)||r.push(o.scheduledDate))}}return r.length&&!QO({scheduledDates:r,tournamentRecord:t}).clearedScheduleCount?{error:Dre}:{unscheduledMatchUpIds:a}}var j4={};Li(j4,{addCourt:()=>nL,addCourts:()=>R4,addVenue:()=>rC,deleteCourt:()=>Xhe,deleteVenue:()=>q4,deleteVenues:()=>qhe,disableCourts:()=>Whe,disableVenues:()=>Yhe,enableCourts:()=>Khe,enableVenues:()=>Zhe,generate:()=>Ghe,generateCourts:()=>n4,getCompetitionVenues:()=>RC,getCourts:()=>$W,getVenuesAndCourts:()=>Um,modifyCourt:()=>W4,modifyCourtAvailability:()=>H4,modifyVenue:()=>Jhe,mutate:()=>Hhe,publicFindVenue:()=>e3,query:()=>sde});var Ghe={};Li(Ghe,{generateCourts:()=>n4});var Hhe={};Li(Hhe,{addCourt:()=>nL,addCourts:()=>R4,addVenue:()=>rC,deleteCourt:()=>Xhe,deleteVenue:()=>q4,deleteVenues:()=>qhe,disableCourts:()=>Whe,disableVenues:()=>Yhe,enableCourts:()=>Khe,enableVenues:()=>Zhe,modifyCourt:()=>W4,modifyCourtAvailability:()=>H4,modifyVenue:()=>Jhe});function G4(t){if(!(t!=null&&t.tournamentRecord)&&!Array.isArray(t==null?void 0:t.venueMatchUps))return{error:ut};if(!(t!=null&&t.courtId))return{error:VI};let{scheduleVisibilityFilters:e,tournamentRecord:i,matchUpFilters:n,venueMatchUps:r,courtId:a}=t,{schedulingProfile:s}=Dm({tournamentRecord:i});if(Array.isArray(r))return{matchUps:l({matchUps:r,courtId:a})};let{matchUps:o}=Wa({scheduleVisibilityFilters:e,tournamentRecord:i,matchUpFilters:n});return{matchUps:l({matchUps:o,courtId:a})};function l({matchUps:c,courtId:u}){let d=c.filter(p=>{var f,m,g;let h=(m=(f=p.schedule)==null?void 0:f.allocatedCourts)==null?void 0:m.map(({courtId:v})=>v);return((g=p.schedule)==null?void 0:g.courtId)===u||(h==null?void 0:h.includes(u))});return s_({matchUps:d,schedulingProfile:s})}}function z2e({scheduleVisibilityFilters:t,tournamentRecord:e,matchUpFilters:i,venueId:n}){if(!e)return{error:ut};if(!n)return{error:Og};let{schedulingProfile:r}=Dm({tournamentRecord:e}),{matchUps:a}=Wa({scheduleVisibilityFilters:t,tournamentRecord:e,matchUpFilters:i});return{matchUps:s({matchUps:a,venueId:n})};function s({matchUps:o,venueId:l}){let c=o.filter(u=>{var p,h,f;let d=(h=(p=u.schedule)==null?void 0:p.allocatedCourts)==null?void 0:h.map(({venueId:m})=>m);return((f=u.schedule)==null?void 0:f.venueId)===l||(d==null?void 0:d.includes(l))});return s_({matchUps:c,schedulingProfile:r})}}function H4({tournamentRecord:t,dateAvailability:e,disableNotice:i,venueMatchUps:n,courtId:r,force:a}){var h,f,m;if(!t)return{error:ut};if(!r)return{error:VI};let s=Ape({dateAvailability:e});if(s.error)return s;let{updatedDateAvailability:o,totalMergeCount:l}=q2e(e);e=o;let c=nw({tournamentRecord:t,courtId:r});if(c.error)return c;let{court:u,venue:d}=c,{matchUps:p}=G4({tournamentRecord:t,venueMatchUps:n,courtId:r});if(p!=null&&p.length){let g=(h=hn({tournamentRecord:t}))==null?void 0:h.appliedPolicies,v=a??((m=(f=g==null?void 0:g[$g])==null?void 0:f.allowDeletionWithScoresPresent)==null?void 0:m.courts),y=[];y.length&&(v||console.log("throw error: scheduled court matchUps",y.length))}return u&&(u.dateAvailability=e,!i&&d&&Si({payload:{venue:d,tournamentId:t.tournamentId},topic:Oy,key:d.venueId})),{...de,totalMergeCount:l}}function q2e(t){let e=0,i=t.reduce((r,a)=>{let{date:s,startTime:o,endTime:l,bookings:c}=a;return r[s]||(r[s]=[]),r[s].push({startTime:o,endTime:l,bookings:c}),r},{}),n=[];return Object.keys(i).forEach(r=>{i[r].sort(u2e);let{mergedAvailability:a,mergeCount:s}=W2e(i[r]);n.push(...a.map(o=>({date:r,...o}))),e+=s}),{updatedDateAvailability:n,totalMergeCount:e}}function W2e(t){let e,i,n,r=t.length,a=0,s=[];for(;t.length&&r;){let l=t.shift(),{startTime:c,endTime:u,bookings:d}=l;if(r-=1,!e)e=c,n=d,i=u;else if(xP(Zr(i),Zr(c),!1)>0){let p={startTime:e,endTime:i};n!=null&&n.length&&(p.bookings=n),s.push(p),e=c,n=d,i=u}else d&&(n?n.push(d):n=d),i=u,a+=1}let o={startTime:e,endTime:i};return n!=null&&n.length&&(o.bookings=n),s.push(o),{mergedAvailability:s,mergeCount:a}}function z4({matchUpsCount:t=0}){let e=`Schedule would be deleted from ${t} ${t===1?"matchUp":"matchUps"}; use { force: true }`;return{error:Rae,info:e}}function zhe({tournamentRecord:t,drawDefinition:e,matchUpId:i,drawId:n}){let r="removeCourtAssignment";if(!i)return{error:Ks};if(!e&&!n)return{error:Vd};let a;if(!e){if(!t)return{error:ut};({drawDefinition:e}=jo({tournamentRecord:t,drawId:n}))}if(e)({matchUp:a}=ar({drawDefinition:e,matchUpId:i}));else{if(!t)return{error:ut};let s=Wa({tournamentRecord:t,inContext:!1}).matchUps??[];({matchUp:a}=lce({matchUps:s,matchUpId:i}))}return a?(a.timeItems&&a.timeItems.find(s=>[hg,$h].includes(s.itemType))&&(a.timeItems=a.timeItems.filter(({itemType:s})=>![hg,$h].includes(s)),Ji({tournamentId:t==null?void 0:t.tournamentId,context:r,drawDefinition:e,matchUp:a})),{...de}):{error:_s}}function q4(t){var l,c,u;if(typeof(t==null?void 0:t.venueId)!="string")return{error:Og};let{tournamentRecord:e,venueId:i,force:n}=t,r=t.tournamentRecords||e&&{[e.tournamentId]:e}||{};if(!Object.keys(r).length)return{error:ut};let a=_d({tournamentRecords:r,contextFilters:{venueIds:[i]}}).matchUps??[],s=(l=hn({tournamentRecord:e}))==null?void 0:l.appliedPolicies,o=n??((u=(c=s==null?void 0:s[$g])==null?void 0:c.allowDeletionWithScoresPresent)==null?void 0:u.venues);if(!a.length||o)for(let d of Object.values(r)){for(let h of a){let f=zhe({matchUpId:h.matchUpId,drawId:h.drawId,tournamentRecord:d});if(f.error)return f}let p;d.venues=(d.venues??[]).filter(h=>(h==null?void 0:h.venueId)!==i?!0:(p=!0,!1)),p&&Si({payload:{venueId:i,tournamentId:d.tournamentId},topic:Aq,key:i})}else return z4({matchUpsCount:a.length});return NC({tournamentRecords:r}),{...de}}function qhe({tournamentRecord:t,venueIds:e,force:i}){if(!t)return{error:ut};if(!Array.isArray(e))return{error:Re};for(let n of t.venues||[]){let{venueId:r}=n;if(e.includes(r)){let{venueId:a}=n,s=q4({tournamentRecord:t,venueId:a,force:i});if(s.error)return s}}return{...de}}function Whe(t){let{courtIds:e,dates:i}=t,n=Jc(t),r=[{[ks]:!0,[Cx]:!0}],a=Qt(t,r);if(a.error)return a;for(let s of Object.values(n))Y2e({tournamentRecord:s,courtIds:e,dates:i});return{...de}}function Y2e({tournamentRecord:t,courtIds:e,dates:i}){let n=Array.isArray(i)&&i.length?{dates:i}:!0,r=a=>dn({extension:{value:n,name:Ud},creationTime:!1,element:a});for(let a of t.venues||[])for(let s of a.courts||[])if(e!=null&&e.includes(s.courtId)){let o=r(s);if(o.error)return o}return{...de}}function Yhe(t){let{tournamentRecords:e,tournamentId:i,venueIds:n}=t,r=[{[ks]:!0,[Rx]:!0}],a=Qt(t,r);if(a.error)return a;let s=Object.keys(e).filter(o=>!i||o===i);for(let o of s){let l=e[o];K2e({tournamentRecord:l,venueIds:n})}return{...de}}function K2e({tournamentRecord:t,venueIds:e}){for(let i of t.venues||[])if(e!=null&&e.includes(i.venueId)){let n=dn({creationTime:!1,element:i,extension:{name:Ud,value:!0}});if(n.error)return n}return{...de}}function Khe(t){let e=Jc(t),i=[{[ks]:!0}];!t.enableAll&&i.push({[Cx]:!0});let n=Qt(t,i);if(n.error)return n;let{enableAll:r,courtIds:a,dates:s}=t;for(let o of Object.values(e))Z2e({tournamentRecord:o,courtIds:a,enableAll:r,dates:s});return{...de}}function Z2e({tournamentRecord:t,courtIds:e,enableAll:i,dates:n}){for(let r of t.venues||[])for(let a of r.courts||[])if(i||e!=null&&e.includes(a.courtId))if(Array.isArray(n)){let{extension:s}=ki({element:a,name:Ud});if(s){let o=s.value;Array.isArray(o.dates)&&(o.dates=o.dates.filter(l=>!n.includes(l))),dn({extension:{name:Ud,value:o},creationTime:!1,element:a})}}else oo({element:a,name:Ud});return{...de}}function Zhe(t){let e=Jc(t),i=[{[ks]:!0}];!t.enableAll&&i.push({[Rx]:!0});let n=Qt(t,i);if(n.error)return n;let{venueIds:r,enableAll:a}=t;for(let s of Object.values(e))for(let o of s.venues||[])(a||r!=null&&r.includes(o.venueId))&&oo({element:o,name:Ud});return{...de}}function Xhe(t){let{courtId:e,disableNotice:i,force:n}=t,r=Jc(t),a=Qt(t,[{[ks]:!0,[zse]:!0}]);if(a.error)return a;let s,o;for(let l of Object.values(r)){if(o=X2e({tournamentRecord:l,disableNotice:i,courtId:e,force:n}),o.error&&o.error!==QT)return o;o.success&&(s=!0)}return s?{...de}:o}function X2e({tournamentRecord:t,disableNotice:e,courtId:i,force:n}){var c,u,d;let r=nw({tournamentRecord:t,courtId:i});if(r.error)return r;let a=r.venue,{matchUps:s}=G4({tournamentRecord:t,courtId:i}),o=(c=hn({tournamentRecord:t}))==null?void 0:c.appliedPolicies,l=n??((d=(u=o==null?void 0:o[$g])==null?void 0:u.allowDeletionWithScoresPresent)==null?void 0:d.courts);if(!(s!=null&&s.length)||l){for(let p of s??[]){let h=zhe({matchUpId:p.matchUpId,drawId:p.drawId,tournamentRecord:t});if(h.error)return h}a&&(a.courts=(a.courts??[]).filter(p=>p.courtId!==i),e||Si({payload:{venue:a,tournamentId:t.tournamentId},topic:Oy,key:a.venueId}))}else return z4({matchUpsCount:s.length});return{...de}}function W4(t){let{disableNotice:e,modifications:i,courtId:n,force:r,venueMatchUps:a}=t,s=Jc(t);if(!Object.keys(s).length)return{error:wr};let o,l;for(let c of Object.values(s)){let u=J2e({tournamentRecord:c,disableNotice:e,venueMatchUps:a,modifications:i,courtId:n,force:r});if(u!=null&&u.error)return u;o=!0}return o?{...de}:l}function J2e({tournamentRecord:t,disableNotice:e,venueMatchUps:i,modifications:n,courtId:r,force:a}){if(!t)return{error:ut};if(!r)return{error:VI};if(!n||typeof n!="object")return{error:bm};let s=nw({tournamentRecord:t,courtId:r});if(s.error)return s;let{venue:o,court:l}=s,c=Object.keys(c2e()).filter(p=>p!=="courtId");if(!Object.keys(n).filter(p=>c.includes(p)).length)return{error:ux};let u=c.filter(p=>!["dateAvailability"].includes(p)),d=Object.keys(n).filter(p=>u.includes(p));if(l&&d.forEach(p=>Object.assign(l,{[p]:n[p]})),n.dateAvailability){let p=H4({dateAvailability:n.dateAvailability,tournamentRecord:t,venueMatchUps:i,disableNotice:e,courtId:r,force:a});if(p.error)return p}return e||Si({payload:{venue:o,tournamentId:t.tournamentId},topic:Oy,key:o==null?void 0:o.venueId}),{...de,court:_t(l)}}var Q2e=()=>({venueId:void 0,venueName:"",venueAbbreviation:"",onlineResources:[],venueType:void 0,addresses:[],contacts:[],courts:[],roles:[]}),e$e=Q2e;function Jhe(t){let{modifications:e,venueId:i,force:n}=t,r=Jc(t);if(!Object.keys(r).length)return{error:wr};if(typeof i!="string")return{error:Og};let a,s;for(let o of Object.values(r)){let l=t$e({tournamentRecord:o,modifications:e,venueId:i,force:n});if(l.success&&(s=!0),l.error&&(a=l.error),l.error&&l.error!==HI)return l}return NC({tournamentRecords:r}),s?{...de}:{error:a}}function t$e({tournamentRecord:t,modifications:e,venueId:i,force:n}){var g,v,y,b,I,T,w,S;if(!t)return{error:ut};if(!e||typeof e!="object")return{error:bm};if(!i)return{error:Og};let r=(g=hn({tournamentRecord:t}))==null?void 0:g.appliedPolicies,a=n??((y=(v=r==null?void 0:r[$g])==null?void 0:v.allowDeletionWithScoresPresent)==null?void 0:y.venues),{matchUps:s}=z2e({tournamentRecord:t,venueId:i}),o=Xh({tournamentRecord:t,venueId:i});if(o.error)return o;let l=o.venue,c=Object.keys(e$e()).filter(U=>U!=="venueId");if(!Object.keys(e).filter(U=>c.includes(U)).length)return{error:ux};let u=c.filter(U=>!["courts","onlineResources"].includes(U)),d=Object.keys(e).filter(U=>u.includes(U));l&&d.forEach(U=>Object.assign(l,{[U]:e[U]}));let p=((b=l==null?void 0:l.courts)==null?void 0:b.map(U=>U.courtId))??[],h=((I=e.courts)==null?void 0:I.map(U=>U.courtId))||[],f=h.length?p.filter(U=>!h.includes(U)):(e==null?void 0:e.courts)&&p,m=[];if(f!=null&&f.length){let U=(w=(T=l==null?void 0:l.courts)==null?void 0:T.filter(P=>f.includes(P.courtId)))==null?void 0:w.map(P=>{var R;let E=G4({courtId:P.courtId,tournamentRecord:t,venueMatchUps:s});for(let C of E.matchUps??[])m.push({matchUpId:C.matchUpId,drawId:C.drawId});return((R=E.matchUps)==null?void 0:R.length)??0}).reduce((P,E)=>P+E);if(l&&(!U||a))l.courts=(S=l.courts)==null?void 0:S.filter(P=>h.includes(P.courtId)),wE({schedule:{courtId:"",scheduledDate:""},matchUpDetails:m,removePriorValues:!0,tournamentRecord:t});else return z4({matchUpsCount:U})}if(e.courts)for(let U of e.courts){let{courtId:P}=U||{},E=W4({modifications:U,disableNotice:!0,tournamentRecord:t,venueMatchUps:s,courtId:P,force:n});if(E.error===QT&&(E=nL({disableNotice:!0,tournamentRecord:t,venueId:i,court:U})),E.error)return E}return NC({tournamentRecord:t}),l&&Si({payload:{venue:l,tournamentId:t.tournamentId},topic:Oy,key:l==null?void 0:l.venueId}),{...de,venue:_t(l)}}var _i={};Li(_i,{JSON2CSV:()=>l$e,UUID:()=>yn,UUIDS:()=>Zae,allNumeric:()=>vre,attributeFilter:()=>cI,chunkArray:()=>Ra,chunkByNth:()=>vV,chunkSizeProfile:()=>gre,constantToString:()=>gs,countValues:()=>jRe,createMap:()=>bre,dateTime:()=>Yae,definedAttributes:()=>Kt,dehydrateMatchUps:()=>r$e,extractAttributes:()=>Woe,flattenJSON:()=>Y4,generateDateRange:()=>NS,generateHashCode:()=>ZRe,generateRange:()=>Rt,generateTimeCode:()=>Fpe,groupValues:()=>fre,hasAttributeValues:()=>KRe,instanceCount:()=>Ml,intersection:()=>Nr,isConvertableInteger:()=>Ii,isNumeric:()=>Dr,isOdd:()=>pre,isPowerOf2:()=>Rd,makeDeepCopy:()=>_t,matchUpScheduleSort:()=>n$e,matchUpSort:()=>rw,nearestPowerOf2:()=>fz,nextPowerOf2:()=>WT,noNulls:()=>VRe,noNumeric:()=>yre,numericSort:()=>ia,occurrences:()=>HRe,overlap:()=>ho,randomMember:()=>wl,randomPop:()=>Tl,shuffleArray:()=>so,structureSort:()=>ZI,subSort:()=>zRe,undefinedToNull:()=>yV,unique:()=>Ei,visualizeScheduledMatchUps:()=>i$e});function i$e({scheduledMatchUps:t,showGlobalLog:e}){i_e();let i=t==null?void 0:t.reduce((r,{structureId:a})=>r.includes(a)?r:r.concat(a),[]),n=Array.isArray(i)&&{...i.map(r=>{let{structureName:a,matchUpType:s}=t.find(o=>o.structureId===r);return{[r]:`${a} ${s}`}})};i==null||i.forEach(r=>{var o;Xl({color:"blue",method:"draw",structure:n[r],keyColors:{structure:"magenta"}},!0);let a=t.filter(l=>l.structureId===r),s=((o=fo({matchUps:a}))==null?void 0:o.roundMatchUps)||[];Object.keys(s).forEach(l=>{Xl({roundNumber:l,keyColors:{roundNumber:"brightcyan"}},!0),s[l].forEach(({matchUpId:c,schedule:u})=>{let d=rr(u.scheduledTime);Xl({matchUpId:c,time:d,date:u.scheduledDate,venue:u.venueId,keyColors:{time:"brightcyan",date:"brightcyan",matchUpId:"yellow",venue:"magenta"}},!0)})})}),e&&t_e()}var{extractTime:$Z,timeStringMinutes:BZ}=Yae;function n$e(t,e){let i=t.schedule??{},n=e.schedule??{};if(i.scheduledDate&&!n.scheduledDate)return 1;if(n.scheduledDate&&!i.scheduledDate)return-1;if(i.scheduledDate&&n.scheduledDate){if(i.scheduledDate===n.scheduledDate){if(i.scheduledTime&&!n.scheduledTime)return 1;if(n.scheduledTime&&!i.scheduledTime)return-1;if(i.scheduledTime&&n.scheduledTime){let r=BZ($Z(i.scheduledTime)),a=BZ($Z(n.scheduledTime));return r-a}}return new Date(i.scheduledDate).getTime()-new Date(n.scheduledDate).getTime()}return 0}function r$e({tournamentRecord:t}){if(!t)return{error:ut};if(typeof t!="object"||!t.tournamentId)return{error:Re};let{matchUps:e}=Wa({tournamentRecord:t,inContext:!1});if(e!=null&&e.length){let i=a$e({tournamentRecord:t});o$e(e,i)}return{...de}}function a$e({tournamentRecord:t}){let e={};for(let i of t.events||[]){i.matchUpFormat&&(e[i.eventId]=i.matchUpFormat);for(let n of i.drawDefinitions||[]){n.matchUpFormat&&(e[n.drawId]=n.matchUpFormat);for(let r of n.structures||[]){r.matchUpFormat&&(e[r.structureId]=r.matchUpFormat);for(let a of r.structures||[])a.matchUpFormat&&(e[a.structureId]=a.matchUpFormat)}}}return e}var s$e=["collectionId","collectionPosition","drawPositions","extensions","finishingPositionRange","finishingRound","isMock","matchUpId","matchUpStatus","matchUpStatusCodes","orderOfFinish","processCodes","roundNumber","tieFormat","tieMatchUps","roundPosition","score","sides","winnerMatchUpId","loserMatchUpId","matchUpDuration","winningSide"];function o$e(t,e={}){for(let i of t){let{structureId:n,drawId:r,eventId:a}=i,s=e[n]||e[r]||e[a],o=i.matchUpFormat===s?void 0:i.matchUpFormat;for(let l of Object.keys(i))s$e.includes(l)||delete i[l];i.sides&&i.drawPositions&&!i.tieMatchUps&&delete i.sides,o&&(i.matchUpFormat=o)}}function l$e(t,e){if(e&&typeof e!="object")return{error:Re};let{columnTransform:i={}}=e||{},{includeTransformAccessors:n,includeHeaderRow:r=!0,returnTransformedJSON:a,removeEmptyColumns:s,onlyHeaderRow:o,columnAccessors:l=[],functionMap:c={},columnMap:u={},valuesMap:d={},context:p={},delimiter:h='"',columnJoiner:f=",",rowJoiner:m=`\r
`,keyJoiner:g="."}=e||{};if(!Array.isArray(t)||!Array.isArray(l)||typeof p!="object"||typeof u!="object"||typeof i!="object"||typeof c!="object"||typeof d!="object"||typeof f!="string"||typeof m!="string"||typeof g!="string"||typeof h!="string")return{error:Re};i=Object.assign({},...Object.keys(i).reverse().map(_=>({[_]:Array.isArray(i[_])?i[_]:[typeof i[_]=="string"&&i[_]].filter(Boolean)})));let v=t.filter(Boolean).map(_=>Y4(_,g)),y=Object.values(i).flat();n&&l.push(...y);let b=v.reduce((_,A)=>Object.keys(A).every(N=>!_.includes(N)&&_.push(N)||!0)&&_,[]).filter(_=>!(l!=null&&l.length)||l.includes(_)),I=Object.assign({},...Object.keys(i).reverse().map(_=>i[_].map(A=>({[A]:_})).flat()).flat()),T=(_,A)=>e!=null&&e.sortOrder?e.sortOrder.includes(_)&&e.sortOrder.includes(A)&&e.sortOrder.indexOf(_)-e.sortOrder.indexOf(A)||!e.sortOrder.includes(A)&&-1:0,w=b.reduce((_,A)=>{let N=I[A];return N?_.includes(N)||_.push(N):_.push(A),_},[]).sort(T);Object.keys(u).forEach(_=>!w.includes(_)&&w.unshift(_)),Object.keys(i).forEach(_=>!w.includes(_)&&w.unshift(_)),typeof p=="object"&&Object.keys(p).forEach(_=>!w.includes(_)&&w.unshift(_));let S=w.map(_=>u[_]||_);if(o)return[S];let U=_=>`${h}${_}${h}`,P=[],E=_=>Object.values(w.reduce((A,N,k)=>{var j;let O=i[N],$=(O!=null&&O.length?_[O.find(B=>_[B])]:_[N])||(p==null?void 0:p[N])||"",F=((j=d[N])==null?void 0:j[$])||$,V=xo(c[N])?c[N](F):F;return A[N]=U(V),V&&(P[k]=(P[k]||0)+1),A},{})),R=v.map(E),C=s&&[...P].map((_,A)=>!_&&A).filter(Dr).reverse();if(C){let _=A=>A.filter((N,k)=>!C.includes(k));R=R.map(_),S=_(S)}let M=R.map(_=>_.join(f));return a?M.map(_=>{let A=_.split(f);return Object.assign({},...A.map((N,k)=>({[S[k]]:N})))}):r?[S.map(U).join(f),...M].join(m):M.join(m)}function Y4(t,e=".",i=[]){return typeof t=="object"&&Object.keys(t).reduce((n,r)=>typeof t[r]!="object"?(n[i.concat(r).join(e)]=t[r],n):Object.assign(n,Y4(t[r],e,i.concat(r))),{})}var c$e={},{FACTORY:VZ}=jv;function u$e({tournamentRecord:t,value:e}){let{extension:i}=ki({element:t,name:VZ}),n={name:VZ,value:{...i==null?void 0:i.value,...e}};dn({element:t,extension:n})}function oL({timeStamp:t}){let e=Lg(),i=jz();return i&&Object.values(e).forEach(n=>{u$e({tournamentRecord:n,value:{version:qT(),timeStamp:t}})}),i}function Qhe({engineType:t,methodName:e,elapsed:i,params:n,result:r}){var d,p;let a=ic();if(typeof a!="object")return;let s={method:e},o=(r==null?void 0:r.error)&&(a.errors===!0||Array.isArray(a.errors)&&a.errors.includes(e)),l=Array.isArray(a.params)&&((d=a.params)==null?void 0:d.includes(e)),c=a.params&&!Array.isArray(a.params)||l,u=Array.isArray(a.exclude)&&a.exclude.includes(e);!u&&![void 0,!1].includes(a.perf)&&!isNaN(a.perf)&&i>=a.perf&&(s.elapsed=i),!u&&(o||c)&&(s.params=n),!u&&(o||a.result&&!Array.isArray(a.result)&&(!Array.isArray(a.params)||l)||Array.isArray(a.result)&&((p=a.result)!=null&&p.includes(e)))&&(s.result=r),Object.keys(s).length>1&&Bae(s,t)}function jC({methodName:t,params:e,start:i}){let n={error:_P,methodName:t},r=i?Date.now()-i:0;return Qhe({result:n,methodName:t,elapsed:r,params:e,engineType:"sync"}),n}function d$e(t,e){var a;if(e._middleware===!1)return e;if(e.tournamentId&&!t[e.tournamentId])return{error:ut};let i=e.drawId||((a=e.matchUp)==null?void 0:a.drawId);if(i){let{event:s,drawDefinition:o,tournamentId:l}=jo({tournamentRecords:t,drawId:i});o&&(e.drawDefinition=o),l&&(e.tournamentId=l),s&&(e.event=s)}if(e.eventId&&!e.event){let{event:s,tournamentId:o}=jo({eventId:e.eventId,tournamentRecords:t});if(!s)return{error:Gc};e.tournamentId=o,e.event=s}let n=e.tournamentId??qI();if(!n&&e)return e;let r=t[n];return n&&!r?{error:ut}:(r&&(e.tournamentRecord=r),e)}function GC(t,e,i,n,r){delete t.success,delete t.error;let a=Date.now(),s=qI();i&&(i.activeTournamentId=s);let o=(i==null?void 0:i.tournamentRecord)||qz(s),l=typeof(i==null?void 0:i.tournamentRecord)=="object"&&{[i==null?void 0:i.tournamentRecord.tournamentId]:i.tournamentRecord}||Lg(),c=i?_t(i,void 0,!0):void 0,u=i?d$e(l,i):void 0;if(u!=null&&u.error)return u;let d=p$e({params:u,tournamentRecords:l,tournamentRecord:o,methodName:n,method:e}),p=Date.now()-a;return Qhe({result:d,methodName:n,elapsed:p,params:c,engineType:r}),d}function p$e({tournamentRecords:t,tournamentRecord:e,params:i,methodName:n,method:r}){if(ic())return r({tournamentRecords:t,tournamentRecord:e,...i});try{return r({tournamentRecords:t,tournamentRecord:e,...i})}catch(a){return gx({engineName:"engine",methodName:n,params:i,err:a})}}function lL(t){let{mutationStatus:e,tournamentId:i,directives:n,timeStamp:r}=t||{},{topics:a}=dc();for(let s of[...a].sort(tfe)){let o=Hz({topic:s});o!=null&&o.length&&ZD({topic:s,notices:o})}e&&r&&a.includes(cE)&&ZD({notices:[{tournamentId:i,directives:n,timeStamp:r}],topic:cE})}async function efe(t){let{mutationStatus:e,tournamentId:i,directives:n,timeStamp:r}=t||{},{topics:a}=dc();for(let s of[...a].sort(tfe)){let o=Hz({topic:s});o&&await ZD({topic:s,notices:o})}e&&r&&a.includes(cE)&&ZD({notices:[{tournamentId:i,directives:n,timeStamp:r}],topic:cE})}var jZ={[Bq]:5,[$q]:5,[Vq]:5,[Fq]:5,[Lq]:5,[xq]:5,[coe]:5,[uoe]:5,[Oq]:1,[Lx]:1,[Is]:5,[Oy]:5,[kq]:4,[Nq]:4,[Aq]:4,[_q]:4,[Ox]:3,[Pq]:2};function tfe(t,e){return(jZ[e]||0)-(jZ[t]||0)}function h$e({convertExtensions:t,removeExtensions:e}){let i=Lg();return{tournamentId:qI(),tournamentRecords:_t(i,t,!1,e)}}function f$e(t){let{convertExtensions:e=!1,removeExtensions:i=!1}=t??{},n=(t==null?void 0:t.tournamentId)??qI();if(typeof n!="string")return{};let r=qz(n);return{tournamentRecord:_t(r,e,!1,i)}}function m$e(){var n;let t=Lg(),{extension:e}=ki({name:iy,tournamentRecords:t,discover:!0}),i=((n=e==null?void 0:e.value)==null?void 0:n.tournamentIds)||[];return Object.keys(t).forEach(r=>{i.includes(r)||delete t[r]}),mx(t)}function GZ(t,e=!0){return typeof t!="object"||Array.isArray(t)?{error:bm}:t!=null&&t.tournamentId?Fae(e?_t(t):t):{error:Re}}function gI(t,e=!0){if(typeof t!="object")return{error:bm};if(XD(),Array.isArray(t)){if(t.filter(i=>i==null?void 0:i.tournamentId).length!==t.length)return{error:wV};t=Object.assign({},...t.map(i=>({[i.tournamentId]:i})))}else if(t!=null&&t.tournamentId)t={[t.tournamentId]:t},XD(t.tournamentId);else if(!Object.keys(t).every(i=>t[i].tournamentId===i))return{error:wV};return mx(e?_t(t):t)}async function g$e(t,e,i){if(!Array.isArray(e))return{error:Re,message:"directives must be an array"};let n=Gz(),r=Date.now(),a=i&&_t(Lg(),!1,!0),s=[];for(let c of e){if(typeof c!="object")return{error:Re,message:"directive must be an object"};let{method:u,pipe:d}=c,p=c.params?{...c.params}:{};if(!n[u])return jC({methodName:u,start:r,params:p});if(d){let f=s[s.length-1],m=Object.keys(d);for(let g of m)f[g]&&(p[g]=f[g])}let h=GC(t,n[u],p,u,"async");if(h!=null&&h.error)return a&&gI(a),{...h,rolledBack:!!a};s.push({...h,methodName:u})}let o=Date.now(),l=oL({timeStamp:o});return await efe({directives:e,mutationStatus:l,timeStamp:o}),zI(),{success:s.every(c=>c.success),results:s}}async function HZ(t,e){if(!Xi(e))return{error:Re,message:"args must be an object"};let i=Object.values(e).filter(xo).length;if(i>1)return{message:"there must be only one arg with typeof function",error:Re};let n=i?Object.keys(e).find(h=>xo(e[h])):nr(e.method)&&e.method;if(!n)return{error:_P};let{[n]:r,...a}=e,s=e!=null&&e.params?{...e.params}:{...a},o=s.rollbackOnError&&_t(Lg(),!1,!0),l=r||t[n]||hx()[n];if(!l)return jC({methodName:n,params:s});let c=await GC(t,l,s,n,"async")??{};c!=null&&c.error&&o&&gI(o);let u=Date.now(),d=oL({timeStamp:u}),p=(c==null?void 0:c.success)&&(s==null?void 0:s.delayNotify)!==!0&&(s==null?void 0:s.doNotNotify)!==!0;return p&&await efe({directives:[{method:l,params:s}],mutationStatus:d,timeStamp:u}),(p||!(c!=null&&c.success)||s!=null&&s.doNotNotify)&&zI(),c}function v$e(t,e,i,n,r,a){let s=Vae(i,n,r,a);if(s.error)return s;let o=s.methods??[];return Object.keys(o).filter(l=>xo(o[l])).forEach(l=>{t[l]=c=>{let u=()=>e(t,{[l]:o[l],...c});if(ic())return u();try{return u()}catch(d){gx({engineName:"engine",methodName:l,params:c,err:d})}}}),{...de,...t}}function I0(t,e){return e!=null&&e.error?(t.error=e.error,t.success=!1):(t.error=void 0,t.success=!0),t}function K4(t,e){t.importMethods=(i,n,r,a)=>v$e(t,e,i,n,r,a),t.getTournament=i=>f$e(i),t.getState=i=>h$e({convertExtensions:i==null?void 0:i.convertExtensions,removeExtensions:i==null?void 0:i.removeExtensions}),t.version=()=>qT(),t.reset=()=>(mx({}),I0(t)),t.devContext=i=>(YD(i),I0(t)),t.getDevContext=i=>ic(i),t.newTournamentRecord=(i={})=>{let n=tL(i),r=n.tournamentId;return n.error?n:(GZ(n),XD(r),{...de,tournamentId:r})},t.setState=(i,n,r)=>{KD(n,r);let a=gI(i,n);return I0(t,a)},t.setTournamentId=i=>XD(i),t.getTournamentId=()=>qI(),t.setTournamentRecord=(i,n,r)=>{KD(n,r);let a=GZ(i,n);return I0(t,a)},t.removeTournamentRecord=i=>{let n=$ae(i);return I0(t,n)},t.removeUnlinkedTournamentRecords=()=>{let i=m$e();return I0(t,i)}}function y$e(t){let e=_ae();if(e.error&&!t)return e;let i={executionQueue:(n,r)=>g$e(i,n,r),execute:n=>HZ(i,n)};return K4(i,HZ),i}function b$e(t,e,i){if(!Array.isArray(e))return{error:Re,message:"directives must be an array"};let n=Gz(),r=Date.now(),a=i&&_t(Lg(),!1,!0),s=[];for(let c of e){if(typeof c!="object")return{error:Re,message:"directive must be an object"};if(c.params&&typeof c.params!="object")return{error:Re,message:"params must be an object"};let{method:u,pipe:d}=c,p=c.params?{...c.params}:{};if(!n[u])return jC({methodName:u,start:r,params:p});if(d){let f=s[s.length-1],m=Object.keys(d);for(let g of m)f[g]&&(p[g]=f[g])}let h=GC(t,n[u],p,u,"sync");if(h!=null&&h.error)return a&&gI(a),{...h,rolledBack:!!a};s.push({...h,methodName:u})}let o=Date.now(),l=oL({timeStamp:o});return lL({directives:e,mutationStatus:l,timeStamp:o}),zI(),{success:s.every(c=>c.success),results:s}}function zZ(t,e){if(!Xi(e))return{error:Re,message:"args must be an object"};let i=Object.values(e).filter(xo).length;if(i>1)return{message:"there must be only one arg with typeof function",error:Re};let n=i?Object.keys(e).find(h=>xo(e[h])):nr(e.method)&&e.method;if(!n)return{error:_P};let{[n]:r,...a}=e,s=e!=null&&e.params?{...e.params}:{...a},o=s.rollbackOnError&&_t(Lg(),!1,!0),l=r||t[n]||hx()[n];if(!l)return jC({methodName:n,params:s});let c=GC(t,l,s,n,"sync")??{};c!=null&&c.error&&o&&gI(o);let u=Date.now(),d=oL({timeStamp:u}),p=(c==null?void 0:c.success)&&(s==null?void 0:s.delayNotify)!==!0&&(s==null?void 0:s.doNotNotify)!==!0;return p&&lL({directives:[{method:l,params:s}],mutationStatus:d,timeStamp:u}),(p||!(c!=null&&c.success)||s!=null&&s.doNotNotify)&&zI(),c}var ife=(()=>{let t={executionQueue:(e,i)=>b$e(t,e,i),execute:e=>zZ(t,e)};return K4(t,zZ),t})(),HC=ife;function qZ(t,e){if(!Xi(e))return{error:Re,message:"args must be an object"};let i=Object.values(e).filter(xo).length;if(i>1)return{message:"there must be only one arg with typeof function",error:Re};let n=i?Object.keys(e).find(l=>xo(e[l])):nr(e.method)&&e.method;if(!n)return{error:_P};let{[n]:r,...a}=e,s=e!=null&&e.params?{...e.params}:{...a},o=r||t[n]||hx()[n];return o?GC(t,o,s,n,"ask"):jC({methodName:n,params:s})}var I$e=(()=>{let t={execute:e=>qZ(t,e)};return K4(t,qZ),t})(),jb={},Jm;function WZ(t,e=!0){if(!t)return{error:ai};if(typeof t!="object")return{error:bm};if(t.matchUpId)Jm=t.matchUpId,jb[Jm]=e?_t(t):t;else if(Array.isArray(t))for(let i of t.reverse())i.matchUpId&&(jb[i.matchUpId]=e?_t(i):i,Jm||(Jm=i.matchUpId));else for(let i of Object.values(t))i.matchUpId&&(jb[i.matchUpId]=e?_t(i):i,Jm||(Jm=i.matchUpId));return e?_t(t):t}function w$e(){return jb[Jm]}function S$e(){return Object.values(jb)}function T$e(){Jm=void 0,jb={}}function U$e(t){return _t(jb[Jm],t==null?void 0:t.convertExtensions,!1,t==null?void 0:t.removeExtensions)}var D$e=(()=>{let t={getState:r=>U$e(r),version:()=>qT(),reset:()=>(T$e(),{...de}),drawId:void 0,error:void 0,success:!1,devContext:r=>(YD(r),t),setState:(r,a,s)=>{KD(a,s);let o=WZ(r);return e(o)}};function e(r){return r!=null&&r.error?(t.error=r.error,t.success=!1):(t.error=void 0,t.success=!0,t.drawId=r.drawId),t}return i([Hv]),t;function i(r){r.forEach(a=>{Object.keys(a).forEach(s=>{t[s]=o=>{if(ic())return n({params:o,governor:a,methodName:s});try{return n({params:o,governor:a,methodName:s})}catch(l){gx({engineName:"matchUpEngine",methodName:s,params:o,err:l})}}})})}function n({params:r,governor:a,methodName:s}){t.error=void 0,t.success=!1;let o=(r==null?void 0:r.matchUp)||w$e(),l=(r==null?void 0:r.matchUps)||S$e(),c=(r==null?void 0:r.rollbackOnError)&&_t(o,!1,!0);r={...r,matchUpId:o==null?void 0:o.matchUpId,matchUps:l,matchUp:o};let u=a[s](r);if(u!=null&&u.error)return c&&WZ(c),{...u,rolledBack:!!c};let d=(u==null?void 0:u.success)&&(r==null?void 0:r.delayNotify)!==!0&&(r==null?void 0:r.doNotNotify)!==!0;return d&&lL(),(d||!(u!=null&&u.success)||r!=null&&r.doNotNotify)&&zI(),u}})(),C$=!1,zC=(()=>{let t={version:()=>qT(),setDeepCopy:(n,r)=>(KD(n,r),t),devContext:n=>(YD(n),C$=!0,t)};return i([XO]),t;function e(n,r){let a=n({...r});return a!=null&&a.error||lL(),zI(),C$&&(YD(!1),C$=!1),a}function i(n){n.forEach(r=>{Object.keys(r).forEach(a=>{t[a]=s=>{if(ic()){let o=e(r[a],s);return!(o!=null&&o.error)&&(s!=null&&s.setState)&&(o!=null&&o.tournamentRecord)&&gI(o.tournamentRecord),o}else try{let o=e(r[a],s);return!(o!=null&&o.error)&&(s!=null&&s.setState)&&(o!=null&&o.tournamentRecord)&&gI(o.tournamentRecord),o}catch(o){let l;typeof o=="string"?l=o.toUpperCase():o instanceof Error&&(l=o.message),console.log("ERROR",{params:JSON.stringify(s),method:a,error:l})}}})})}})();HC.importMethods(Jk,!0,1);var Xf=HC,ot=HC,E$e={getTournamentPoints:DO},P$e=E$e,C$e={calculateNewRatings:Vce,generateDynamicRatings:jce},R$e=C$e,M$e={...P$e,...R$e};HC.importMethods(M$e);var N$e=HC,A$e={[sE]:{roundsToSeparate:void 0,policyName:"Nationality Code",policyAttributes:[{key:"person.nationalityCode"},{key:"individualParticipants.person.nationalityCode"}]}},_$e={[Hf]:{policyName:"positionActionsUnrestricted",enabledStructures:[],otherFlightEntries:!0,disableRoundRestrictions:!0,activePositionOverrides:[Fb,cD]}},k$e={[Hf]:{policyName:"positionActionsNoMovement",enabledStructures:[{stages:[],stageSequences:[],enabledActions:[Fb,fE,fI],disabledActions:[]}]}},x$e={[Hf]:{policyName:"positionActionsDisabled",enabledStructures:!1}},O$e={[sU]:{policyName:"Participant Privacy Policy",participant:{contacts:!1,individualParticipants:{onlineResources:!1,participantName:!0,participantOtherName:!0,participantId:!0,participantRole:!0,participantStatus:!0,penalties:!1,rankings:!0,ratings:!0,representing:!0,participantRoleResponsibilities:!1,participantType:!0,person:{addresses:!1,biographicalInformation:!1,birthDate:!1,contacts:!1,nationalityCode:!0,nativeFamilyName:!1,nativeGivenName:!1,onlineResources:!1,otherNames:!0,parentOrganisationId:!1,passportFamilyName:!1,passportGivenName:!1,personId:!1,personOtherIds:!1,previousNames:!1,sex:!1,standardFamilyName:!0,standardGivenName:!0,status:!1,tennisId:!1,wheelchair:!0}},individualParticipantIds:!0,onlineResources:!1,participantName:!0,participantOtherName:!0,participantId:!0,participantRole:!0,participantStatus:!0,penalties:!1,rankings:!0,ratings:!0,representing:!0,participantRoleResponsibilities:!1,participantType:!0,person:{addresses:!1,biographicalInformation:!1,birthDate:!1,contacts:!1,nationalityCode:!0,nativeFamilyName:!1,nativeGivenName:!1,onlineResources:!1,otherNames:!0,parentOrganisationId:!1,passportFamilyName:!1,passportGivenName:!1,personId:!1,personOtherIds:!1,previousNames:!1,sex:!1,standardFamilyName:!0,standardGivenName:!0,status:!1,tennisId:!1,wheelchair:!0}}}},L$e={[zc]:{processCodes:{incompleteAssignmentsOnDefault:["RANKING.IGNORE"]},defaultMatchUpFormat:Nu,allowDeletionWithScoresPresent:{drawDefinitions:!1,structures:!1},requireParticipantsForScoring:!1,requireAllPositionsAssigned:void 0,allowChangePropagation:!1,stage:{[Ft]:{stageSequence:{1:{requireAllPositionsAssigned:!0}}}},matchUpFormats:[],matchUpStatusCodes:{[sl]:[],[zp]:[],[Yi]:[],[_l]:[],[as]:[],[cn]:[]}}},R$="Personal circumstance",F$e={[zc]:{requireAllPositionsAssigned:!1,stage:{[Ft]:{stageSequence:{1:{requireAllPositionsAssigned:!0}}}},defaultMatchUpFormat:Nu,matchUpFormats:[{description:"Best of 3 tiebreak sets",matchUpFormat:Nu,categoryNames:[],categoryTypes:[]},{description:"Two tiebreak sets, 7-point match tiebreak at one set all",matchUpFormat:"SET3-S:6/TB7-F:TB7"},{description:"Two tiebreak sets, 10-point match tiebreak at one set all",matchUpFormat:"SET3-S:6/TB7-F:TB10"},{description:"One standard tiebreak set to 6, 7-point tiebreak at 6 games all",matchUpFormat:"SET1-S:6/TB7"},{description:"Best of 3 sets to 4",matchUpFormat:"SET3-S:4/TB7"},{description:"Two out of three short sets to 4 with 5-point tiebreak at 3 games all",matchUpFormat:"SET3-S:4/TB5@3"},{description:"One short set to 4, 7-point tiebreak at 4 games all",matchUpFormat:"SET1-S:4/TB7"},{description:"One short set to 4, 5-point tiebreak at 3 games all",matchUpFormat:"SET1-S:4/TB5@3"},{description:"Two short sets to 4, 10-point match tiebreak at one set all",matchUpFormat:"SET3-S:4/TB7-F:TB10"},{description:"Two short sets to 4, 7-point match tiebreak at one set all",matchUpFormat:"SET3-S:4/TB7-F:TB7"},{description:"One no advantage set to 5, tiebreak to 9 at 4-4",matchUpFormat:"SET1-S:5/TB9@4"},{description:"One set to 6 with deciding game at 5 games all",matchUpFormat:"SET1-S:6NOAD"},{description:"One short set to 4, deciding game is played at 3 games all",matchUpFormat:"SET1-S:4NOAD"},{description:"Two short sets to 4 with deciding game at 3-3, 7-point match tiebreak at one set all",matchUpFormat:"SET3-S:4NOAD-F:TB7"},{description:"8 game pro-set with 7 point tiebreak at 8 games all",matchUpFormat:"SET1-S:8/TB7"},{description:"8 game pro-set with 7 point tiebreak at 7 games all",matchUpFormat:"SET1-S:8/TB7@7"},{description:"Best of 3 10-point tiebreak games",matchUpFormat:"SET3-S:TB10"},{description:"One 10-point tiebreak game",matchUpFormat:"SET1-S:TB10"},{description:"Timed 20 minute game - game based",matchUpFormat:"SET1-S:T20"}],matchUpStatusCodes:{[sl]:[{matchUpStatusCodeDisplay:"Abandoned",label:"Abandoned match",matchUpStatusCode:"OA"}],[zp]:[{matchUpStatusCodeDisplay:"Unplayed or Cancelled",label:"Cancelled match",matchUpStatusCode:"OC"}],[_l]:[{matchUpStatusCodeDisplay:"Incomplete",label:"Incomplete match",matchUpStatusCode:"OI"}],[Yi]:[{description:"Disqualification for cause or ineligibility",label:"Disqualification (ineligibility)",matchUpStatusCodeDisplay:"Def [dq]",matchUpStatusCode:"DQ"},{description:"Misconduct before or between matches",label:"Misconduct",matchUpStatusCodeDisplay:"Def [cond]",matchUpStatusCode:"DM"},{description:"Failure to start match because of adult discipline",label:"Fail. (adult discipline)",matchUpStatusCodeDisplay:"Def [ad]",matchUpStatusCode:"D5"},{description:"Refusal to start match for reason other than adult discipline, injury, illness, or personal circumstance. (After the Referee has conclusively confirmed that a player refuses to play a match, the Referee need not wait until the scheduled time of the match to records the result.)",label:"Refusal to start match",matchUpStatusCodeDisplay:"Def [refsl]",matchUpStatusCode:"D4"},{label:"Not showing up",matchUpStatusCodeDisplay:"Def [ns]",matchUpStatusCode:"D6"},{description:"Lateness for match including, but not limited to, intending to play but mistakenly arriving at the wrong time, location, or without proper equipment",label:"Lateness for match",matchUpStatusCodeDisplay:"Score + Def [late]",matchUpStatusCode:"D7"},{label:"Double default",matchUpStatusCodeDisplay:"Def/Def",matchUpStatusCode:"DD"},{description:"Refusal to continue playing a match for reason other than injury, illness, personal circumstance, or adult discipline",label:"Refusal to continue match",matchUpStatusCodeDisplay:"Def [refsl]",matchUpStatusCode:"D9"},{description:"Default for receiving an injection, IV, or supplemental oxygen",label:"Default (PEDs)",matchUpStatusCodeDisplay:"Def [med]",matchUpStatusCode:"DI"},{description:"Default under Point Penalty System",label:"Default (Point Penalty System)",matchUpStatusCodeDisplay:"Def [pps]",matchUpStatusCode:"DP"}],[cn]:[{matchUpStatusCodeDisplay:"Wo [inj]",matchUpStatusCode:"W1",label:"Injury"},{matchUpStatusCodeDisplay:"Wo [ill]",matchUpStatusCode:"W2",label:"Illness"},{matchUpStatusCodeDisplay:"Wo [pc]",label:R$,matchUpStatusCode:"W3"},{matchUpStatusCodeDisplay:"Wo/Wo",matchUpStatusCode:"WOWO",label:"Double walkover"},{matchUpStatusCodeDisplay:"Wo [Tae]",label:"Tournament Administrative Error",matchUpStatusCode:"W4"},{matchUpStatusCodeDisplay:"Wo/Withdrawn",matchUpStatusCode:"W5",label:"Withdrawn"}],[as]:[{matchUpStatusCodeDisplay:"Ret [inj]",matchUpStatusCode:"RJ",label:"Injury"},{matchUpStatusCodeDisplay:"Ret [ill]",matchUpStatusCode:"RI",label:"Illness"},{matchUpStatusCodeDisplay:"Ret [pc]",label:R$,matchUpStatusCode:"RC"},{description:"Retirement because of adult discipline",label:"Ret. (adult discipline)",matchUpStatusCodeDisplay:"Ret [ad]",matchUpStatusCode:"RD"},{description:"A player who retires from a match remains eligible for consolations, place playoffs, doubles and subsequent round robin matches",matchUpStatusCodeDisplay:"Ret [elg]",label:"Ret. (eligible)",matchUpStatusCode:"RU"}],[Fh]:[{matchUpStatusCodeDisplay:"Wd [inj]",matchUpStatusCode:"WD.INJ",label:"Injury"},{matchUpStatusCodeDisplay:"Wd [ill]",matchUpStatusCode:"WD.ILL",label:"Illness"},{matchUpStatusCodeDisplay:"Wd [pc]",label:R$,matchUpStatusCode:"WD.PC"},{matchUpStatusCodeDisplay:"Wd/Wd",matchUpStatusCode:"WD.WD",label:"Double withdrawal"},{label:"Tournament Administrative Error",matchUpStatusCodeDisplay:"Wd [Tae]",matchUpStatusCode:"WD.TAE"}]}}},$$e={[Su]:{seedingProfile:{positioning:Ix},validSeedPositions:{ignore:!0},duplicateSeedNumbers:!0,drawSizeProgression:!0,policyName:"ITF SEEDING",seedsCountThresholds:[{drawSize:4,minimumParticipantCount:3,seedsCount:2},{drawSize:16,minimumParticipantCount:12,seedsCount:4},{drawSize:32,minimumParticipantCount:24,seedsCount:8},{drawSize:64,minimumParticipantCount:48,seedsCount:16},{drawSize:128,minimumParticipantCount:97,seedsCount:32},{drawSize:256,minimumParticipantCount:192,seedsCount:64}]}},B$e={POLICY_AVOIDANCE_COUNTRY:A$e,POLICY_POSITION_ACTIONS_DEFAULT:Tce,POLICY_POSITION_ACTIONS_DISABLED:x$e,POLICY_POSITION_ACTIONS_NO_MOVEMENT:k$e,POLICY_POSITION_ACTIONS_UNRESTRICTED:_$e,POLICY_PRIVACY_DEFAULT:O$e,POLICY_ROUND_NAMING_DEFAULT:Zq,POLICY_SCHEDULING_DEFAULT:rde,POLICY_SCORING_DEFAULT:L$e,POLICY_SCORING_USTA:F$e,POLICY_SEEDING_ITF:$$e,POLICY_SEEDING_DEFAULT:Bue},Jf={ratingsParameters:Da,matchUpFormats:lNe,countryToFlag:yoe,tieFormats:vde,countries:ig,policies:B$e,flagIOC:eAe},Uo={};Li(Uo,{activeMatchUpStatuses:()=>xx,auditConstants:()=>wde,completedMatchUpStatuses:()=>ca,directingMatchUpStatuses:()=>Tq,displayConstants:()=>Jue,drawDefinitionConstants:()=>Qr,entryStatusConstants:()=>nd,errorConditionConstants:()=>Mae,eventConstants:()=>pl,extensionConstants:()=>jv,flightConstants:()=>kde,genderConstants:()=>jp,keyValueConstants:()=>nW,matchUpActionConstants:()=>W3,matchUpStatusConstants:()=>Eq,matchUpTypes:()=>ure,nonDirectingMatchUpStatuses:()=>Uq,particicipantsRequiredMatchUpStatuses:()=>wq,participantConstants:()=>Ls,participantRoles:()=>zg,participantTypes:()=>pS,penaltyConstants:()=>nfe,policyConstants:()=>ky,positionActionConstants:()=>cw,ratingConstants:()=>Qle,recoveryTimeRequiredMatchUpStatuses:()=>soe,requestConstants:()=>mpe,resourceContants:()=>Kae,resultConstants:()=>wre,scaleConstants:()=>rU,scheduleConstants:()=>Goe,sortingConstants:()=>Fde,surfaceConstants:()=>rfe,tieFormatConstants:()=>Ase,timeItemConstants:()=>qx,topicConstants:()=>foe,tournamentConstants:()=>V4,upcomingMatchUpStatuses:()=>Dq,validMatchUpStatuses:()=>Sq,venueConstants:()=>afe,weekdayConstants:()=>YW});var V$e="Coaching",j$e="Ball Abuse",G$e="Racket Abuse",H$e="Verbal Abuse",z$e="INELIGIBILITY",q$e="Physical Abuse",W$e="Unsportmanlike Conduct",Y$e="Dress Code Violation",K$e="Equipment Violation",Z$e="Leaving the court",X$e="Failure to complete",J$e="No Show",Q$e="Other",eBe="REFUSAL_TO_PLAY",tBe="PROHIBITED_SUBSTANCE",iBe="Puncuality",nBe="Failure to sign in",nfe={COACHING:V$e,BALL_ABUSE:j$e,RACKET_ABUSE:G$e,VERBAL_ABUSE:H$e,PHYSICAL_ABUSE:q$e,INELIGIBILITY:z$e,UNSPORTSMANLIKE_CONDUCT:W$e,PROHIBITED_SUBSTANCE:tBe,DRESS_CODE_VIOLATION:Y$e,EQUIMENT_VIOLATION:K$e,LEAVING_THE_COURT:Z$e,REFUSAL_TO_PLAY:eBe,FAILURE_TO_COMPLETE:X$e,NO_SHOW:J$e,OTHER:Q$e,PUNCTUALITY:iBe,FAILUIRE_TO_SIGN_IN:nBe},rBe="CLAY",aBe="HARD",sBe="GRASS",oBe="CARPET",lBe="ARTIFICIAL",rfe={CLAY:rBe,HARD:aBe,GRASS:sBe,CARPET:oBe,ARTIFICIAL:lBe},cBe="INDOOR",uBe="OUTDOOR",afe={INDOOR:cBe,OUTDOOR:uBe};const fj=Object.freeze(Object.defineProperty({__proto__:null,activeMatchUpStatuses:xx,askEngine:I$e,asyncEngine:y$e,auditConstants:wde,competitionEngine:Xf,competitionGovernor:pz,completedMatchUpStatuses:ca,directingMatchUpStatuses:Tq,displayConstants:Jue,drawDefinitionConstants:Qr,drawsGovernor:vq,entriesGovernor:GW,entryStatusConstants:nd,errorConditionConstants:Mae,eventConstants:pl,eventGovernor:qW,extensionConstants:jv,factoryConstants:Uo,fixtures:Jf,flightConstants:kde,forge:c$e,genderConstants:jp,generationGovernor:i4,globalState:uS,governors:Jk,keyValueConstants:nW,matchUpActionConstants:W3,matchUpEngine:D$e,matchUpFormatCode:Zf,matchUpFormatGovernor:Zf,matchUpGovernor:a4,matchUpStatusConstants:Eq,matchUpTypes:ure,mocksEngine:zC,mocksGovernor:XO,nonDirectingMatchUpStatuses:Uq,particicipantsRequiredMatchUpStatuses:wq,participantConstants:Ls,participantGovernor:N4,participantRoles:zg,participantTypes:pS,penaltyConstants:nfe,policyConstants:ky,policyGovernor:pW,positionActionConstants:cw,publishingGovernor:rL,queryGovernor:CC,ratingConstants:Qle,recoveryTimeRequiredMatchUpStatuses:soe,reportGovernor:_4,requestConstants:mpe,resourceContants:Kae,resultConstants:wre,scaleConstants:rU,scaleEngine:N$e,scheduleConstants:Goe,scheduleGovernor:k4,scoreGovernor:Hv,sortingConstants:Fde,surfaceConstants:rfe,syncEngine:ife,tieFormatConstants:Ase,tieFormatGovernor:O4,timeItemConstants:qx,tools:_i,topicConstants:foe,tournamentConstants:V4,tournamentEngine:ot,tournamentGovernor:B4,upcomingMatchUpStatuses:Dq,utilities:_i,validMatchUpStatuses:Sq,venueConstants:afe,venueGovernor:j4,version:qT,weekdayConstants:YW},Symbol.toStringTag,{value:"Module"})),{AFTER_REST:sfe,FOLLOWED_BY:ofe,NEXT_AVAILABLE:lfe,NOT_BEFORE:cfe,TO_BE_ANNOUNCED:ufe}=Uo.timeItemConstants,{SCHEDULE_ERROR:dBe,SCHEDULE_CONFLICT:pBe,SCHEDULE_WARNING:hBe}=Uo.scheduleConstants,{ORGANISER_ACCEPTANCE:fBe,DIRECT_ACCEPTANCE:mBe,SPECIAL_EXEMPT:gBe,JUNIOR_EXEMPT:vBe,ALTERNATE:yBe,WILDCARD:bBe}=nd,dfe="All statuses",IBe="All genders",SE="All flights",YZ="All rounds",gg="All events",wBe="No events",pfe="All teams",hfe="All Types",SBe="Any team",ffe="registration",TBe="timepicker",UBe="timevalue",dD="tmxContent",mfe="tmxDrawer",TE="splash",cL="superadmin",gfe="admin",Z4="competitionEngine",DBe="tournamentEngine",Bh="tournaments",vfe="drawEntries",Ps="tournament",mj="structure",yfe="invite",wb="event",z1="draw",gj="view",UE="tournamentEvents",PU="overview",Qf="participants",dy="schedule",X4="matchUps",hh="events",J4="venues",EBe="unscheduled",qC={success:!0},PBe=10,bfe="ISSUE",_c="Automated",Q4="Manual",Ife={[dBe]:"matchup-error",[pBe]:"matchup-conflict",[bfe]:"matchup-issue",[hBe]:"matchup-warning"},f_="tournamentParticipants",CBe="scheduledDateFilter",Gb="unscheduledMatchUps",uL="tournamentsCalendar",m_="tournamentMatchUps",g_="tournamentSchedule",vj="tournamentsTable",v_="tournamentTeams",y_="venuesTable",wfe="entriesCount",Sfe="eventsTable",DE="tmxOverlay",e5="teamStats",t5="drawControl",RBe="drawFrame",Tfe="drawRight",Ufe="drawLeft",Dfe="entriesView",Vh="drawsView",WC="QUALIFYING",fd="ACCEPTED",Efe="eventInfo",i5="acceptedPanel",n5="alternatesPanel",r5="qualifyingPanel",a5="ungroupedPanel",s5="withdrawaPanel",Pfe="unscheduledVisibility",Cfe="tournamentsControl",o5="participantControl",l5="unscheduledControl",c5="scheduleControl",u5="matchUpsControl",d5="venuesControl",p5="eventsControl",YC="eventControl",h5="teamsControl",MBe="controlBar",Rfe="buttonBar",Ub="tmxPanel",Mfe="tmxTable",Nfe="tcContainer",fa="overlay",mi="center",b_="header",oi="right",pi="left",Ap="bottom",KZ="top",dL="subTable",XS="",HM="flex",xt="none",Afe="isOpen",f5="Collection value",m5="Match value",g5="Score value",v5="Set value",U1={[sfe]:"After rest",[ofe]:"Followed by",[ufe]:"To be announced",[lfe]:"Next available",[cfe]:"Not before"},NBe={[sfe]:"After rest",[ofe]:"Followed by",[ufe]:"TBA",[lfe]:"Next available",[cfe]:"NB"},_fe={[fBe]:"OA",[mBe]:"DA",[gBe]:"SE",[vBe]:"JE",[WC]:"QUAL",[yBe]:"ALT",[bBe]:"WC"},I_="Playoff",Ev="drawSize",w_="CUSTOM",F0="advancePerGroup",S_="qualifiersCount",T_="groupRemaining",y5="matchUpFormat",EE="structureName",pD="playoffType",Ef="groupSize",kfe="positions",vI="drawName",vh="drawType",hD="top",ABe="winners",yj="roundsColumns",JS="roundsStats",QS="roundsTable",yI="utr",PE="wtn",fD={},_Be={position:"top-right",clickClose:!0,duration:2e3,offsetBottom:0,offsetRight:0,offsetLeft:0,offsetTop:0,opacity:1},kBe=(t,e,i,n,r)=>{const a=t.split("-"),s=a.includes(pi)&&`left:${n}`,o=a.includes(oi)&&`right:${r}`,l=a.includes("top")&&`top:${e}`,c=a.includes("bottom")&&`bottom:${i}`,u="align-items: "+(a.includes("left")&&"flex-start"||a.includes("right")&&"flex-end"||mi),d="text-align: "+(a.includes("left")&&"left"||a.includes("right")&&"right"||mi);return[s,o,l,c,u,d].filter(Boolean).join(";")};function xBe(t){if(fD.position)return fD.position;const e=document.createElement("div");return e.style="position: fixed; display: flex; flex-direction: column; width:100%; z-index: 9999; pointer-events: none;padding:15px;"+kBe(t.position,t.offsetTop,t.offsetBottom,t.offsetLeft,t.offsetRight),(t.appendTo||document.body).appendChild(e),fD.position=e,e}function OBe(t){if(!t.message)return{error:"Missing message"};const e={..._Be,...t},i=xBe(e),n=LBe(e);if(e.onlyOne){let r=i.lastElementChild;for(;r;)i.removeChild(r),r=i.lastElementChild}i.appendChild(n.element)}function LBe(t){var l,c;const e=document.createElement("div");t.clickClose&&e.addEventListener("click",()=>a(t.onClose));const i=t.duration&&ORe(()=>a(t.onClose),t.duration);i&&t.pauseOnHover&&(e.addEventListener("mouseover",i.pause),e.addEventListener("mouseout",i.resume)),e.style=`display:inline-flex;width:auto;pointer-events:auto;white-space:pre-wrap;opacity:${t.opacity};${t.dismissible?"":"padding: 1.25rem, 1.5rem;"}`;const n=["notification"];if(typeof t.classList=="string"&&n.push(t.classList),t.type&&n.push(t.type),(l=t==null?void 0:t.animate)!=null&&l.in){const u=t.animate.speed?`animate__${t.animate.speed}`:"animate__faster",d=`animate__${t.animate.in}`;n.push(`animate__animated ${d} ${u}`),o(()=>e.classList.remove(d))}if(e.className=n.join(" "),t.dismissible){const u=document.createElement("button");u.className="delete",u.addEventListener("click",()=>a(t.onClose)),e.insertAdjacentElement("afterbegin",u)}const r=document.createElement("div");if(r.style="display: flex; flex-direction: row; align-items: center; justify-content: center;",typeof t.message=="string"?r.insertAdjacentHTML("beforeend",t.message):t.message&&console.log(" MESSAGE ",t.message,typeof t.messsage),Ot((c=t.action)==null?void 0:c.onClick)){const u=document.createElement("button");u.style="margin-left: 1em;",u.className="button",u.innerHTML=t.action.text||"OK",u.addEventListener("click",t.action.onClick),r.appendChild(u)}return e.appendChild(r),{element:e};function a(u){var d;Ot(u)&&u(),(d=t==null?void 0:t.animate)!=null&&d.out?(e.classList.add(`animate__${t.animate.out}`),o(()=>{s(e.parentNode),delete fD.position,e.remove()})):(s(e.parentNode),delete fD.position,e.remove())}function s(u){u&&u.children.length<=1&&u.remove()}function o(u=()=>{}){const d={WebkitAnimation:"webkitAnimationEnd",MozAnimation:"mozAnimationEnd",OAnimation:"oAnimationEnd",animation:"animationend"};for(const p in d)if(e.style[p]!==void 0){e.addEventListener(d[p],()=>u());break}}}function Jt(t){const{position:e="top-center",intent:i="is-success",pauseOnHover:n=!1,dismissible:r=!0,clickClose:a=!0,duration:s=2500,single:o=!0,onClose:l,offsetBottom:c=0,offsetRight:u=0,offsetLeft:d=0,offsetTop:p=0,opacity:h=1,message:f,action:m}=t??{};OBe({animate:{in:"fadeIn",out:"fadeOut"},pauseOnHover:n,offsetBottom:c,type:i,offsetRight:u,dismissible:r,offsetLeft:d,clickClose:a,offsetTop:p,duration:s,position:e,message:f,onClose:l,opacity:h,action:m,single:o})}function FBe(){Jt({intent:"is-success",message:"New Version Cached: Close Tab or Browser and Re-open to Update"})}function $Be(){let t=`${Cs.tr("phrases.blocked")}. ${Cs.tr("phrases.enablepopups")}`;return Jt({intent:"is-danger",message:t})}function BBe(){const t=document.createElement("div");return t.className="is-marginless",t.style.width="inherit",t.id="o-tab",t.innerHTML=`
    <div class="tab_section events_tab">
        <div class="section">
            <div id=${PU} class="box tournament-information">
            </div>
        </div>
    </div>
  `,t}function VBe(){const t=document.getElementById("dnav"),e=window.pageXOffset!==void 0,i=(document.compatMode||"")==="CSS1Compat";let n=0;const r=()=>{let c=e?window.pageYOffset:i?document.documentElement.scrollTop:document.body.scrollTop,u;return c>n?u=!0:u=!1,n=c,u},a=()=>{r()&&!t.contains(document.activeElement)?(t.classList.add("scroll-down"),t.classList.remove("scroll-up")):(t.classList.add("scroll-up"),t.classList.remove("scroll-down"))};var s;const o=(c,u)=>{s||(s=!0,setTimeout(()=>{c(),s=!1},u))},l=window.matchMedia("(prefers-reduced-motion: reduce)");window.addEventListener("scroll",()=>{l&&!l.matches&&o(a,250)})}function jBe(){const t=document.createElement("div");return t.className="is-marginless",t.style.width="inherit",t.id="e-tab",t.innerHTML=`
  <div class="tab_section events_tab">
    <div class="section">
      <div class='tabHeader foreground'></div>
      <div id=${Efe} class="block" style='display: none; width: 100%;'}>
        <div id=${YC} class="controlBar" style='min-height: 3em; border-radius: 6px;'}></div>
      </div>
      <div id=${Sfe}>
        <div id=${p5} class="controlBar"></div>
        <div id=${UE} class="tableClass flexcol flexcenter">
          {' '}
        </div>
      </div>
      <div id=${Dfe} style='display: none;'}>
        <div id=${i5} class='tableClass block ${Ub}'>
          {' '}
        </div>
        <div id=${r5} class='tableClass block ${Ub}'>
          {' '}
        </div>
        <div id=${n5} class='tableClass block ${Ub}'>
          {' '}
        </div>
        <div id=${a5} class='tableClass block ${Ub}'>
          {' '}
        </div>
        <div id=${s5} class='tableClass block ${Ub}'>
          {' '}
        </div>
      </div>
      <div style="width: 100%; margin: 0">
        <div id=${t5}></div>
        <div id=${RBe} class="flexrow flexjustifystart" style="width: 100%">
          <div id=${Ufe} ></div>
          <div
            id=${Vh}
            style="overflow-x: scroll; width: 100%; display: none;"
          >
          </div>
          <div id=${Tfe} ></div>
        </div>
      </div>
    </div>
  </div>
  `,t}const GBe=""+new URL("orgLogo-DsK9KK2k.png",import.meta.url).href;function HBe(){const t=document.createElement("img");return t.style.maxWidth="800px",t.style.width="100%",t.alt="tmxLogo",t.src=GBe,t}function zBe(){const t=document.getElementById("root");t.appendChild(qBe());const e=document.createElement("div");e.className="flexrow flexcenter",e.id=TE,e.style="margin-top: 2em; padding-top: 5em; display: none;",e.appendChild(HBe()),t.appendChild(e);const i=document.createElement("div");i.style.display=xt,i.id=TBe;const n=document.createElement("input");n.className="timepicker-ui-input",n.id=UBe,n.type="text",i.appendChild(n),t.appendChild(i);const r=document.createElement("section");r.className="drawer drawer--left",r.setAttribute("data-drawer-target",""),r.id=mfe,r.innerHTML=`
      <div class="drawer__overlay" data-drawer-close tabIndex="-1"></div>
      <div class="drawer__wrapper">
        <div class="drawer__header">
          <div class="drawer__title"></div>
          <button
            class="drawer__close"
            style='display: none;'}
            data-drawer-close
            aria-label="Close Drawer"
          ></button>
        </div>
        <div class="drawer__content"></div>
        <div class="drawer__footer"></div>
      </div>
  `,t.appendChild(r);const a=document.getElementById("navMain"),s=document.createElement("div");s.id=dD,s.className="springboard flexrow flexcenter",s.style.display=xt;const o=document.createElement("div");o.id="navText",o.className="navText",o.style.display=xt,s.appendChild(o);const l=document.createElement("div");l.id=Nfe,l.className="flexcol flexcenter tournament_container",l.appendChild(BBe()),l.appendChild(jBe()),s.appendChild(l),a.appendChild(s);const c=document.createElement("div");c.className="flexcol flexgrow",c.style.display=xt,c.id=Bh;const u=document.createElement("div");u.className="controlBar flexcol flexgrow flexcenter",u.id=Cfe,c.appendChild(u);const d=document.createElement("div");d.className="flexcol flexgrow flexcenter box",d.id=vj,c.appendChild(d),a.appendChild(c);const p=document.createElement("div");return p.className="flexcol flexgrow",p.style.paddingTop="3em",p.style.display=xt,p.style.height="90%",p.style.width="100%",p.id=uL,a.appendChild(p),VBe(),t}function qBe(){const t=document.createElement("div");return t.innerHTML=`<div id='dnav'>
    <div class="navbar-item" style="display: flex; flex-wrap: nowrap">
      <div id="provider" style="display: flex; flex-direction: column">
        <div style="font-size: .6em">TMX</div>
      </div>
      <div style="padding-left: 1em" id="pageTitle"> </div>
    </div>
    <div id='trnynav' class="navbar-item" style="display: flex; flex-direction: row;">
      <i id='o-route' class="nav-icon fa-solid fa-trophy"></i>
      <i id='p-route' class="nav-icon fa-solid fa-user-group" style="color: blue"></i>
      <i id='e-route' class="nav-icon fa-solid fa-diagram-project"></i>
      <i id='m-route' class="nav-icon fa-solid fa-table-tennis-paddle-ball"></i>
      <i id='s-route' class="nav-icon fa-solid fa-clock"></i>
      <i id='v-route' class="nav-icon fa-solid fa-location-dot"></i>
    </div>
    <div class="navbar-item" style="font-size: 1em">
      <i id="config" class="fa-solid fa-sliders"></i>
      <i id="login" style="padding-left: .5em" class="fa-solid fa-circle-user"></i>
    </div>
  </div>
  <main id="navMain"></main>`,t}window.location.hostname==="localhost"||window.location.hostname==="[::1]"||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/);function WBe(){"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(t=>{t.unregister()})}function Ys(t){if(t)for(;t.firstChild;)t.removeChild(t.firstChild)}const KN={[PU]:"o-tab",[Qf]:"p-tab",[hh]:"e-tab",[X4]:"m-tab",[dy]:"s-tab",[J4]:"v-tab"};function YBe(){const t=`
        <div id='individuals' class='tab_section participants_tab'>
          <div class='section'>
            <div class='tabHeader foreground'>Participants</div>
            <div id='${o5}' class='controlBar'></div>
            <div id='${f_}' class='tableClass flexcol flexcenter'> </div>
          </div>
        </div>
        <div id='participantGroupings' class='tab_section participants_tab'>
            <div class='section'>
              <div class='tabHeader foreground'></div>
              <div id='${h5}' class='controlBar'></div>
              <div id='${v_}' class='tableClass flexcol flexcenter'> </div>
            </div>
        </div>
        `,e=`
        <div class='tab_section sch_tab'>
            <div class='section block'>
              <div id='${Pfe}' style='width: 100%; display: none;'>
                  <div id='${l5}' class='controlBar flexcol flexcenter'></div>
                  <div id='${Gb}' class='tableClass flexcol flexcenter'></div>
              </div>
              <div>
                  <div id='${c5}' class='controlBar flexcol flexcenter'></div>
                  <div id='${g_}' class='tableClass flexcol flexcenter'></div>
              </div>
            </div>
        </div>
        `,i=`
        <div class='tab_section venues_tab'>
            <div class='section'>
              <div class='tabHeader foreground'></div>
              <div id='${d5}' class='controlBar'></div>
              <div id='${y_}' class='tableClass flexcol flexcenter'></div>
            </div>
        </div>
        `,n=`
        <div class='tab_section matchUps_tab'>
            <div class='section'>
              <div class='tabHeader foreground'></div>
              <div id='${u5}' class='controlBar'></div>
              <div id='${e5}' class='controlBar'></div>
              <div id='${m_}' class='tableClass flexcol flexcenter'> </div>
            </div>
        </div>
        `,r={"p-tab":t,"s-tab":e,"v-tab":i,"m-tab":n},a=document.getElementById(Nfe);Object.keys(r).forEach(s=>{const o=document.createElement("div");o.class="is-marginless",o.style="width: inherit",o.id=s,o.innerHTML=r[s],a.appendChild(o)}),xfe(Qf)}function xfe(t){return Object.keys(KN).includes(t)?(Object.keys(KN).forEach(e=>{const i=KN[e],n=document.getElementById(i);n?n.style.display=t===e?"":xt:console.log({key:e,id:i,element:n})}),{...qC}):!1}function KBe(){[Vh,p5,u5,o5,l5,YC,h5,c5,d5,e5,i5,n5,r5,a5,s5,UE,m_,f_,g_,v_,Gb,y_].forEach(e=>{const i=KN[e],n=document.getElementById(i);n&&Ys(n)})}function Ofe(){return"tmxToken"}function Lfe(t,e){return function(){return t.apply(e,arguments)}}const{toString:ZBe}=Object.prototype,{getPrototypeOf:b5}=Object,pL=(t=>e=>{const i=ZBe.call(e);return t[i]||(t[i]=i.slice(8,-1).toLowerCase())})(Object.create(null)),Qh=t=>(t=t.toLowerCase(),e=>pL(e)===t),hL=t=>e=>typeof e===t,{isArray:CU}=Array,CE=hL("undefined");function XBe(t){return t!==null&&!CE(t)&&t.constructor!==null&&!CE(t.constructor)&&Ed(t.constructor.isBuffer)&&t.constructor.isBuffer(t)}const Ffe=Qh("ArrayBuffer");function JBe(t){let e;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?e=ArrayBuffer.isView(t):e=t&&t.buffer&&Ffe(t.buffer),e}const QBe=hL("string"),Ed=hL("function"),$fe=hL("number"),fL=t=>t!==null&&typeof t=="object",eVe=t=>t===!0||t===!1,ZN=t=>{if(pL(t)!=="object")return!1;const e=b5(t);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in t)&&!(Symbol.iterator in t)},tVe=Qh("Date"),iVe=Qh("File"),nVe=Qh("Blob"),rVe=Qh("FileList"),aVe=t=>fL(t)&&Ed(t.pipe),sVe=t=>{let e;return t&&(typeof FormData=="function"&&t instanceof FormData||Ed(t.append)&&((e=pL(t))==="formdata"||e==="object"&&Ed(t.toString)&&t.toString()==="[object FormData]"))},oVe=Qh("URLSearchParams"),[lVe,cVe,uVe,dVe]=["ReadableStream","Request","Response","Headers"].map(Qh),pVe=t=>t.trim?t.trim():t.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function KC(t,e,{allOwnKeys:i=!1}={}){if(t===null||typeof t>"u")return;let n,r;if(typeof t!="object"&&(t=[t]),CU(t))for(n=0,r=t.length;n<r;n++)e.call(null,t[n],n,t);else{const a=i?Object.getOwnPropertyNames(t):Object.keys(t),s=a.length;let o;for(n=0;n<s;n++)o=a[n],e.call(null,t[o],o,t)}}function Bfe(t,e){e=e.toLowerCase();const i=Object.keys(t);let n=i.length,r;for(;n-- >0;)if(r=i[n],e===r.toLowerCase())return r;return null}const Mb=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,Vfe=t=>!CE(t)&&t!==Mb;function bj(){const{caseless:t}=Vfe(this)&&this||{},e={},i=(n,r)=>{const a=t&&Bfe(e,r)||r;ZN(e[a])&&ZN(n)?e[a]=bj(e[a],n):ZN(n)?e[a]=bj({},n):CU(n)?e[a]=n.slice():e[a]=n};for(let n=0,r=arguments.length;n<r;n++)arguments[n]&&KC(arguments[n],i);return e}const hVe=(t,e,i,{allOwnKeys:n}={})=>(KC(e,(r,a)=>{i&&Ed(r)?t[a]=Lfe(r,i):t[a]=r},{allOwnKeys:n}),t),fVe=t=>(t.charCodeAt(0)===65279&&(t=t.slice(1)),t),mVe=(t,e,i,n)=>{t.prototype=Object.create(e.prototype,n),t.prototype.constructor=t,Object.defineProperty(t,"super",{value:e.prototype}),i&&Object.assign(t.prototype,i)},gVe=(t,e,i,n)=>{let r,a,s;const o={};if(e=e||{},t==null)return e;do{for(r=Object.getOwnPropertyNames(t),a=r.length;a-- >0;)s=r[a],(!n||n(s,t,e))&&!o[s]&&(e[s]=t[s],o[s]=!0);t=i!==!1&&b5(t)}while(t&&(!i||i(t,e))&&t!==Object.prototype);return e},vVe=(t,e,i)=>{t=String(t),(i===void 0||i>t.length)&&(i=t.length),i-=e.length;const n=t.indexOf(e,i);return n!==-1&&n===i},yVe=t=>{if(!t)return null;if(CU(t))return t;let e=t.length;if(!$fe(e))return null;const i=new Array(e);for(;e-- >0;)i[e]=t[e];return i},bVe=(t=>e=>t&&e instanceof t)(typeof Uint8Array<"u"&&b5(Uint8Array)),IVe=(t,e)=>{const n=(t&&t[Symbol.iterator]).call(t);let r;for(;(r=n.next())&&!r.done;){const a=r.value;e.call(t,a[0],a[1])}},wVe=(t,e)=>{let i;const n=[];for(;(i=t.exec(e))!==null;)n.push(i);return n},SVe=Qh("HTMLFormElement"),TVe=t=>t.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(i,n,r){return n.toUpperCase()+r}),ZZ=(({hasOwnProperty:t})=>(e,i)=>t.call(e,i))(Object.prototype),UVe=Qh("RegExp"),jfe=(t,e)=>{const i=Object.getOwnPropertyDescriptors(t),n={};KC(i,(r,a)=>{let s;(s=e(r,a,t))!==!1&&(n[a]=s||r)}),Object.defineProperties(t,n)},DVe=t=>{jfe(t,(e,i)=>{if(Ed(t)&&["arguments","caller","callee"].indexOf(i)!==-1)return!1;const n=t[i];if(Ed(n)){if(e.enumerable=!1,"writable"in e){e.writable=!1;return}e.set||(e.set=()=>{throw Error("Can not rewrite read-only method '"+i+"'")})}})},EVe=(t,e)=>{const i={},n=r=>{r.forEach(a=>{i[a]=!0})};return CU(t)?n(t):n(String(t).split(e)),i},PVe=()=>{},CVe=(t,e)=>t!=null&&Number.isFinite(t=+t)?t:e,M$="abcdefghijklmnopqrstuvwxyz",XZ="0123456789",Gfe={DIGIT:XZ,ALPHA:M$,ALPHA_DIGIT:M$+M$.toUpperCase()+XZ},RVe=(t=16,e=Gfe.ALPHA_DIGIT)=>{let i="";const{length:n}=e;for(;t--;)i+=e[Math.random()*n|0];return i};function MVe(t){return!!(t&&Ed(t.append)&&t[Symbol.toStringTag]==="FormData"&&t[Symbol.iterator])}const NVe=t=>{const e=new Array(10),i=(n,r)=>{if(fL(n)){if(e.indexOf(n)>=0)return;if(!("toJSON"in n)){e[r]=n;const a=CU(n)?[]:{};return KC(n,(s,o)=>{const l=i(s,r+1);!CE(l)&&(a[o]=l)}),e[r]=void 0,a}}return n};return i(t,0)},AVe=Qh("AsyncFunction"),_Ve=t=>t&&(fL(t)||Ed(t))&&Ed(t.then)&&Ed(t.catch),Hfe=((t,e)=>t?setImmediate:e?((i,n)=>(Mb.addEventListener("message",({source:r,data:a})=>{r===Mb&&a===i&&n.length&&n.shift()()},!1),r=>{n.push(r),Mb.postMessage(i,"*")}))(`axios@${Math.random()}`,[]):i=>setTimeout(i))(typeof setImmediate=="function",Ed(Mb.postMessage)),kVe=typeof queueMicrotask<"u"?queueMicrotask.bind(Mb):typeof process<"u"&&process.nextTick||Hfe,pt={isArray:CU,isArrayBuffer:Ffe,isBuffer:XBe,isFormData:sVe,isArrayBufferView:JBe,isString:QBe,isNumber:$fe,isBoolean:eVe,isObject:fL,isPlainObject:ZN,isReadableStream:lVe,isRequest:cVe,isResponse:uVe,isHeaders:dVe,isUndefined:CE,isDate:tVe,isFile:iVe,isBlob:nVe,isRegExp:UVe,isFunction:Ed,isStream:aVe,isURLSearchParams:oVe,isTypedArray:bVe,isFileList:rVe,forEach:KC,merge:bj,extend:hVe,trim:pVe,stripBOM:fVe,inherits:mVe,toFlatObject:gVe,kindOf:pL,kindOfTest:Qh,endsWith:vVe,toArray:yVe,forEachEntry:IVe,matchAll:wVe,isHTMLForm:SVe,hasOwnProperty:ZZ,hasOwnProp:ZZ,reduceDescriptors:jfe,freezeMethods:DVe,toObjectSet:EVe,toCamelCase:TVe,noop:PVe,toFiniteNumber:CVe,findKey:Bfe,global:Mb,isContextDefined:Vfe,ALPHABET:Gfe,generateString:RVe,isSpecCompliantForm:MVe,toJSONObject:NVe,isAsyncFn:AVe,isThenable:_Ve,setImmediate:Hfe,asap:kVe};function kn(t,e,i,n,r){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=t,this.name="AxiosError",e&&(this.code=e),i&&(this.config=i),n&&(this.request=n),r&&(this.response=r,this.status=r.status?r.status:null)}pt.inherits(kn,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:pt.toJSONObject(this.config),code:this.code,status:this.status}}});const zfe=kn.prototype,qfe={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(t=>{qfe[t]={value:t}});Object.defineProperties(kn,qfe);Object.defineProperty(zfe,"isAxiosError",{value:!0});kn.from=(t,e,i,n,r,a)=>{const s=Object.create(zfe);return pt.toFlatObject(t,s,function(l){return l!==Error.prototype},o=>o!=="isAxiosError"),kn.call(s,t.message,e,i,n,r),s.cause=t,s.name=t.name,a&&Object.assign(s,a),s};const xVe=null;function Ij(t){return pt.isPlainObject(t)||pt.isArray(t)}function Wfe(t){return pt.endsWith(t,"[]")?t.slice(0,-2):t}function JZ(t,e,i){return t?t.concat(e).map(function(r,a){return r=Wfe(r),!i&&a?"["+r+"]":r}).join(i?".":""):e}function OVe(t){return pt.isArray(t)&&!t.some(Ij)}const LVe=pt.toFlatObject(pt,{},null,function(e){return/^is[A-Z]/.test(e)});function mL(t,e,i){if(!pt.isObject(t))throw new TypeError("target must be an object");e=e||new FormData,i=pt.toFlatObject(i,{metaTokens:!0,dots:!1,indexes:!1},!1,function(m,g){return!pt.isUndefined(g[m])});const n=i.metaTokens,r=i.visitor||u,a=i.dots,s=i.indexes,l=(i.Blob||typeof Blob<"u"&&Blob)&&pt.isSpecCompliantForm(e);if(!pt.isFunction(r))throw new TypeError("visitor must be a function");function c(f){if(f===null)return"";if(pt.isDate(f))return f.toISOString();if(!l&&pt.isBlob(f))throw new kn("Blob is not supported. Use a Buffer instead.");return pt.isArrayBuffer(f)||pt.isTypedArray(f)?l&&typeof Blob=="function"?new Blob([f]):Buffer.from(f):f}function u(f,m,g){let v=f;if(f&&!g&&typeof f=="object"){if(pt.endsWith(m,"{}"))m=n?m:m.slice(0,-2),f=JSON.stringify(f);else if(pt.isArray(f)&&OVe(f)||(pt.isFileList(f)||pt.endsWith(m,"[]"))&&(v=pt.toArray(f)))return m=Wfe(m),v.forEach(function(b,I){!(pt.isUndefined(b)||b===null)&&e.append(s===!0?JZ([m],I,a):s===null?m:m+"[]",c(b))}),!1}return Ij(f)?!0:(e.append(JZ(g,m,a),c(f)),!1)}const d=[],p=Object.assign(LVe,{defaultVisitor:u,convertValue:c,isVisitable:Ij});function h(f,m){if(!pt.isUndefined(f)){if(d.indexOf(f)!==-1)throw Error("Circular reference detected in "+m.join("."));d.push(f),pt.forEach(f,function(v,y){(!(pt.isUndefined(v)||v===null)&&r.call(e,v,pt.isString(y)?y.trim():y,m,p))===!0&&h(v,m?m.concat(y):[y])}),d.pop()}}if(!pt.isObject(t))throw new TypeError("data must be an object");return h(t),e}function QZ(t){const e={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(t).replace(/[!'()~]|%20|%00/g,function(n){return e[n]})}function I5(t,e){this._pairs=[],t&&mL(t,this,e)}const Yfe=I5.prototype;Yfe.append=function(e,i){this._pairs.push([e,i])};Yfe.toString=function(e){const i=e?function(n){return e.call(this,n,QZ)}:QZ;return this._pairs.map(function(r){return i(r[0])+"="+i(r[1])},"").join("&")};function FVe(t){return encodeURIComponent(t).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function Kfe(t,e,i){if(!e)return t;const n=i&&i.encode||FVe,r=i&&i.serialize;let a;if(r?a=r(e,i):a=pt.isURLSearchParams(e)?e.toString():new I5(e,i).toString(n),a){const s=t.indexOf("#");s!==-1&&(t=t.slice(0,s)),t+=(t.indexOf("?")===-1?"?":"&")+a}return t}class eX{constructor(){this.handlers=[]}use(e,i,n){return this.handlers.push({fulfilled:e,rejected:i,synchronous:n?n.synchronous:!1,runWhen:n?n.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){pt.forEach(this.handlers,function(n){n!==null&&e(n)})}}const Zfe={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},$Ve=typeof URLSearchParams<"u"?URLSearchParams:I5,BVe=typeof FormData<"u"?FormData:null,VVe=typeof Blob<"u"?Blob:null,jVe={isBrowser:!0,classes:{URLSearchParams:$Ve,FormData:BVe,Blob:VVe},protocols:["http","https","file","blob","url","data"]},w5=typeof window<"u"&&typeof document<"u",wj=typeof navigator=="object"&&navigator||void 0,GVe=w5&&(!wj||["ReactNative","NativeScript","NS"].indexOf(wj.product)<0),HVe=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",zVe=w5&&window.location.href||"http://localhost",qVe=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:w5,hasStandardBrowserEnv:GVe,hasStandardBrowserWebWorkerEnv:HVe,navigator:wj,origin:zVe},Symbol.toStringTag,{value:"Module"})),xu={...qVe,...jVe};function WVe(t,e){return mL(t,new xu.classes.URLSearchParams,Object.assign({visitor:function(i,n,r,a){return xu.isNode&&pt.isBuffer(i)?(this.append(n,i.toString("base64")),!1):a.defaultVisitor.apply(this,arguments)}},e))}function YVe(t){return pt.matchAll(/\w+|\[(\w*)]/g,t).map(e=>e[0]==="[]"?"":e[1]||e[0])}function KVe(t){const e={},i=Object.keys(t);let n;const r=i.length;let a;for(n=0;n<r;n++)a=i[n],e[a]=t[a];return e}function Xfe(t){function e(i,n,r,a){let s=i[a++];if(s==="__proto__")return!0;const o=Number.isFinite(+s),l=a>=i.length;return s=!s&&pt.isArray(r)?r.length:s,l?(pt.hasOwnProp(r,s)?r[s]=[r[s],n]:r[s]=n,!o):((!r[s]||!pt.isObject(r[s]))&&(r[s]=[]),e(i,n,r[s],a)&&pt.isArray(r[s])&&(r[s]=KVe(r[s])),!o)}if(pt.isFormData(t)&&pt.isFunction(t.entries)){const i={};return pt.forEachEntry(t,(n,r)=>{e(YVe(n),r,i,0)}),i}return null}function ZVe(t,e,i){if(pt.isString(t))try{return(e||JSON.parse)(t),pt.trim(t)}catch(n){if(n.name!=="SyntaxError")throw n}return(i||JSON.stringify)(t)}const ZC={transitional:Zfe,adapter:["xhr","http","fetch"],transformRequest:[function(e,i){const n=i.getContentType()||"",r=n.indexOf("application/json")>-1,a=pt.isObject(e);if(a&&pt.isHTMLForm(e)&&(e=new FormData(e)),pt.isFormData(e))return r?JSON.stringify(Xfe(e)):e;if(pt.isArrayBuffer(e)||pt.isBuffer(e)||pt.isStream(e)||pt.isFile(e)||pt.isBlob(e)||pt.isReadableStream(e))return e;if(pt.isArrayBufferView(e))return e.buffer;if(pt.isURLSearchParams(e))return i.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let o;if(a){if(n.indexOf("application/x-www-form-urlencoded")>-1)return WVe(e,this.formSerializer).toString();if((o=pt.isFileList(e))||n.indexOf("multipart/form-data")>-1){const l=this.env&&this.env.FormData;return mL(o?{"files[]":e}:e,l&&new l,this.formSerializer)}}return a||r?(i.setContentType("application/json",!1),ZVe(e)):e}],transformResponse:[function(e){const i=this.transitional||ZC.transitional,n=i&&i.forcedJSONParsing,r=this.responseType==="json";if(pt.isResponse(e)||pt.isReadableStream(e))return e;if(e&&pt.isString(e)&&(n&&!this.responseType||r)){const s=!(i&&i.silentJSONParsing)&&r;try{return JSON.parse(e)}catch(o){if(s)throw o.name==="SyntaxError"?kn.from(o,kn.ERR_BAD_RESPONSE,this,null,this.response):o}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:xu.classes.FormData,Blob:xu.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};pt.forEach(["delete","get","head","post","put","patch"],t=>{ZC.headers[t]={}});const XVe=pt.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),JVe=t=>{const e={};let i,n,r;return t&&t.split(`
`).forEach(function(s){r=s.indexOf(":"),i=s.substring(0,r).trim().toLowerCase(),n=s.substring(r+1).trim(),!(!i||e[i]&&XVe[i])&&(i==="set-cookie"?e[i]?e[i].push(n):e[i]=[n]:e[i]=e[i]?e[i]+", "+n:n)}),e},tX=Symbol("internals");function D1(t){return t&&String(t).trim().toLowerCase()}function XN(t){return t===!1||t==null?t:pt.isArray(t)?t.map(XN):String(t)}function QVe(t){const e=Object.create(null),i=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let n;for(;n=i.exec(t);)e[n[1]]=n[2];return e}const eje=t=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(t.trim());function N$(t,e,i,n,r){if(pt.isFunction(n))return n.call(this,e,i);if(r&&(e=i),!!pt.isString(e)){if(pt.isString(n))return e.indexOf(n)!==-1;if(pt.isRegExp(n))return n.test(e)}}function tje(t){return t.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(e,i,n)=>i.toUpperCase()+n)}function ije(t,e){const i=pt.toCamelCase(" "+e);["get","set","has"].forEach(n=>{Object.defineProperty(t,n+i,{value:function(r,a,s){return this[n].call(this,e,r,a,s)},configurable:!0})})}class Ou{constructor(e){e&&this.set(e)}set(e,i,n){const r=this;function a(o,l,c){const u=D1(l);if(!u)throw new Error("header name must be a non-empty string");const d=pt.findKey(r,u);(!d||r[d]===void 0||c===!0||c===void 0&&r[d]!==!1)&&(r[d||l]=XN(o))}const s=(o,l)=>pt.forEach(o,(c,u)=>a(c,u,l));if(pt.isPlainObject(e)||e instanceof this.constructor)s(e,i);else if(pt.isString(e)&&(e=e.trim())&&!eje(e))s(JVe(e),i);else if(pt.isHeaders(e))for(const[o,l]of e.entries())a(l,o,n);else e!=null&&a(i,e,n);return this}get(e,i){if(e=D1(e),e){const n=pt.findKey(this,e);if(n){const r=this[n];if(!i)return r;if(i===!0)return QVe(r);if(pt.isFunction(i))return i.call(this,r,n);if(pt.isRegExp(i))return i.exec(r);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,i){if(e=D1(e),e){const n=pt.findKey(this,e);return!!(n&&this[n]!==void 0&&(!i||N$(this,this[n],n,i)))}return!1}delete(e,i){const n=this;let r=!1;function a(s){if(s=D1(s),s){const o=pt.findKey(n,s);o&&(!i||N$(n,n[o],o,i))&&(delete n[o],r=!0)}}return pt.isArray(e)?e.forEach(a):a(e),r}clear(e){const i=Object.keys(this);let n=i.length,r=!1;for(;n--;){const a=i[n];(!e||N$(this,this[a],a,e,!0))&&(delete this[a],r=!0)}return r}normalize(e){const i=this,n={};return pt.forEach(this,(r,a)=>{const s=pt.findKey(n,a);if(s){i[s]=XN(r),delete i[a];return}const o=e?tje(a):String(a).trim();o!==a&&delete i[a],i[o]=XN(r),n[o]=!0}),this}concat(...e){return this.constructor.concat(this,...e)}toJSON(e){const i=Object.create(null);return pt.forEach(this,(n,r)=>{n!=null&&n!==!1&&(i[r]=e&&pt.isArray(n)?n.join(", "):n)}),i}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([e,i])=>e+": "+i).join(`
`)}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e,...i){const n=new this(e);return i.forEach(r=>n.set(r)),n}static accessor(e){const n=(this[tX]=this[tX]={accessors:{}}).accessors,r=this.prototype;function a(s){const o=D1(s);n[o]||(ije(r,s),n[o]=!0)}return pt.isArray(e)?e.forEach(a):a(e),this}}Ou.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);pt.reduceDescriptors(Ou.prototype,({value:t},e)=>{let i=e[0].toUpperCase()+e.slice(1);return{get:()=>t,set(n){this[i]=n}}});pt.freezeMethods(Ou);function A$(t,e){const i=this||ZC,n=e||i,r=Ou.from(n.headers);let a=n.data;return pt.forEach(t,function(o){a=o.call(i,a,r.normalize(),e?e.status:void 0)}),r.normalize(),a}function Jfe(t){return!!(t&&t.__CANCEL__)}function RU(t,e,i){kn.call(this,t??"canceled",kn.ERR_CANCELED,e,i),this.name="CanceledError"}pt.inherits(RU,kn,{__CANCEL__:!0});function Qfe(t,e,i){const n=i.config.validateStatus;!i.status||!n||n(i.status)?t(i):e(new kn("Request failed with status code "+i.status,[kn.ERR_BAD_REQUEST,kn.ERR_BAD_RESPONSE][Math.floor(i.status/100)-4],i.config,i.request,i))}function nje(t){const e=/^([-+\w]{1,25})(:?\/\/|:)/.exec(t);return e&&e[1]||""}function rje(t,e){t=t||10;const i=new Array(t),n=new Array(t);let r=0,a=0,s;return e=e!==void 0?e:1e3,function(l){const c=Date.now(),u=n[a];s||(s=c),i[r]=l,n[r]=c;let d=a,p=0;for(;d!==r;)p+=i[d++],d=d%t;if(r=(r+1)%t,r===a&&(a=(a+1)%t),c-s<e)return;const h=u&&c-u;return h?Math.round(p*1e3/h):void 0}}function aje(t,e){let i=0,n=1e3/e,r,a;const s=(c,u=Date.now())=>{i=u,r=null,a&&(clearTimeout(a),a=null),t.apply(null,c)};return[(...c)=>{const u=Date.now(),d=u-i;d>=n?s(c,u):(r=c,a||(a=setTimeout(()=>{a=null,s(r)},n-d)))},()=>r&&s(r)]}const U_=(t,e,i=3)=>{let n=0;const r=rje(50,250);return aje(a=>{const s=a.loaded,o=a.lengthComputable?a.total:void 0,l=s-n,c=r(l),u=s<=o;n=s;const d={loaded:s,total:o,progress:o?s/o:void 0,bytes:l,rate:c||void 0,estimated:c&&o&&u?(o-s)/c:void 0,event:a,lengthComputable:o!=null,[e?"download":"upload"]:!0};t(d)},i)},iX=(t,e)=>{const i=t!=null;return[n=>e[0]({lengthComputable:i,total:t,loaded:n}),e[1]]},nX=t=>(...e)=>pt.asap(()=>t(...e)),sje=xu.hasStandardBrowserEnv?function(){const e=xu.navigator&&/(msie|trident)/i.test(xu.navigator.userAgent),i=document.createElement("a");let n;function r(a){let s=a;return e&&(i.setAttribute("href",s),s=i.href),i.setAttribute("href",s),{href:i.href,protocol:i.protocol?i.protocol.replace(/:$/,""):"",host:i.host,search:i.search?i.search.replace(/^\?/,""):"",hash:i.hash?i.hash.replace(/^#/,""):"",hostname:i.hostname,port:i.port,pathname:i.pathname.charAt(0)==="/"?i.pathname:"/"+i.pathname}}return n=r(window.location.href),function(s){const o=pt.isString(s)?r(s):s;return o.protocol===n.protocol&&o.host===n.host}}():function(){return function(){return!0}}(),oje=xu.hasStandardBrowserEnv?{write(t,e,i,n,r,a){const s=[t+"="+encodeURIComponent(e)];pt.isNumber(i)&&s.push("expires="+new Date(i).toGMTString()),pt.isString(n)&&s.push("path="+n),pt.isString(r)&&s.push("domain="+r),a===!0&&s.push("secure"),document.cookie=s.join("; ")},read(t){const e=document.cookie.match(new RegExp("(^|;\\s*)("+t+")=([^;]*)"));return e?decodeURIComponent(e[3]):null},remove(t){this.write(t,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function lje(t){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(t)}function cje(t,e){return e?t.replace(/\/?\/$/,"")+"/"+e.replace(/^\/+/,""):t}function eme(t,e){return t&&!lje(e)?cje(t,e):e}const rX=t=>t instanceof Ou?{...t}:t;function bI(t,e){e=e||{};const i={};function n(c,u,d){return pt.isPlainObject(c)&&pt.isPlainObject(u)?pt.merge.call({caseless:d},c,u):pt.isPlainObject(u)?pt.merge({},u):pt.isArray(u)?u.slice():u}function r(c,u,d){if(pt.isUndefined(u)){if(!pt.isUndefined(c))return n(void 0,c,d)}else return n(c,u,d)}function a(c,u){if(!pt.isUndefined(u))return n(void 0,u)}function s(c,u){if(pt.isUndefined(u)){if(!pt.isUndefined(c))return n(void 0,c)}else return n(void 0,u)}function o(c,u,d){if(d in e)return n(c,u);if(d in t)return n(void 0,c)}const l={url:a,method:a,data:a,baseURL:s,transformRequest:s,transformResponse:s,paramsSerializer:s,timeout:s,timeoutMessage:s,withCredentials:s,withXSRFToken:s,adapter:s,responseType:s,xsrfCookieName:s,xsrfHeaderName:s,onUploadProgress:s,onDownloadProgress:s,decompress:s,maxContentLength:s,maxBodyLength:s,beforeRedirect:s,transport:s,httpAgent:s,httpsAgent:s,cancelToken:s,socketPath:s,responseEncoding:s,validateStatus:o,headers:(c,u)=>r(rX(c),rX(u),!0)};return pt.forEach(Object.keys(Object.assign({},t,e)),function(u){const d=l[u]||r,p=d(t[u],e[u],u);pt.isUndefined(p)&&d!==o||(i[u]=p)}),i}const tme=t=>{const e=bI({},t);let{data:i,withXSRFToken:n,xsrfHeaderName:r,xsrfCookieName:a,headers:s,auth:o}=e;e.headers=s=Ou.from(s),e.url=Kfe(eme(e.baseURL,e.url),t.params,t.paramsSerializer),o&&s.set("Authorization","Basic "+btoa((o.username||"")+":"+(o.password?unescape(encodeURIComponent(o.password)):"")));let l;if(pt.isFormData(i)){if(xu.hasStandardBrowserEnv||xu.hasStandardBrowserWebWorkerEnv)s.setContentType(void 0);else if((l=s.getContentType())!==!1){const[c,...u]=l?l.split(";").map(d=>d.trim()).filter(Boolean):[];s.setContentType([c||"multipart/form-data",...u].join("; "))}}if(xu.hasStandardBrowserEnv&&(n&&pt.isFunction(n)&&(n=n(e)),n||n!==!1&&sje(e.url))){const c=r&&a&&oje.read(a);c&&s.set(r,c)}return e},uje=typeof XMLHttpRequest<"u",dje=uje&&function(t){return new Promise(function(i,n){const r=tme(t);let a=r.data;const s=Ou.from(r.headers).normalize();let{responseType:o,onUploadProgress:l,onDownloadProgress:c}=r,u,d,p,h,f;function m(){h&&h(),f&&f(),r.cancelToken&&r.cancelToken.unsubscribe(u),r.signal&&r.signal.removeEventListener("abort",u)}let g=new XMLHttpRequest;g.open(r.method.toUpperCase(),r.url,!0),g.timeout=r.timeout;function v(){if(!g)return;const b=Ou.from("getAllResponseHeaders"in g&&g.getAllResponseHeaders()),T={data:!o||o==="text"||o==="json"?g.responseText:g.response,status:g.status,statusText:g.statusText,headers:b,config:t,request:g};Qfe(function(S){i(S),m()},function(S){n(S),m()},T),g=null}"onloadend"in g?g.onloadend=v:g.onreadystatechange=function(){!g||g.readyState!==4||g.status===0&&!(g.responseURL&&g.responseURL.indexOf("file:")===0)||setTimeout(v)},g.onabort=function(){g&&(n(new kn("Request aborted",kn.ECONNABORTED,t,g)),g=null)},g.onerror=function(){n(new kn("Network Error",kn.ERR_NETWORK,t,g)),g=null},g.ontimeout=function(){let I=r.timeout?"timeout of "+r.timeout+"ms exceeded":"timeout exceeded";const T=r.transitional||Zfe;r.timeoutErrorMessage&&(I=r.timeoutErrorMessage),n(new kn(I,T.clarifyTimeoutError?kn.ETIMEDOUT:kn.ECONNABORTED,t,g)),g=null},a===void 0&&s.setContentType(null),"setRequestHeader"in g&&pt.forEach(s.toJSON(),function(I,T){g.setRequestHeader(T,I)}),pt.isUndefined(r.withCredentials)||(g.withCredentials=!!r.withCredentials),o&&o!=="json"&&(g.responseType=r.responseType),c&&([p,f]=U_(c,!0),g.addEventListener("progress",p)),l&&g.upload&&([d,h]=U_(l),g.upload.addEventListener("progress",d),g.upload.addEventListener("loadend",h)),(r.cancelToken||r.signal)&&(u=b=>{g&&(n(!b||b.type?new RU(null,t,g):b),g.abort(),g=null)},r.cancelToken&&r.cancelToken.subscribe(u),r.signal&&(r.signal.aborted?u():r.signal.addEventListener("abort",u)));const y=nje(r.url);if(y&&xu.protocols.indexOf(y)===-1){n(new kn("Unsupported protocol "+y+":",kn.ERR_BAD_REQUEST,t));return}g.send(a||null)})},pje=(t,e)=>{const{length:i}=t=t?t.filter(Boolean):[];if(e||i){let n=new AbortController,r;const a=function(c){if(!r){r=!0,o();const u=c instanceof Error?c:this.reason;n.abort(u instanceof kn?u:new RU(u instanceof Error?u.message:u))}};let s=e&&setTimeout(()=>{s=null,a(new kn(`timeout ${e} of ms exceeded`,kn.ETIMEDOUT))},e);const o=()=>{t&&(s&&clearTimeout(s),s=null,t.forEach(c=>{c.unsubscribe?c.unsubscribe(a):c.removeEventListener("abort",a)}),t=null)};t.forEach(c=>c.addEventListener("abort",a));const{signal:l}=n;return l.unsubscribe=()=>pt.asap(o),l}},hje=function*(t,e){let i=t.byteLength;if(!e||i<e){yield t;return}let n=0,r;for(;n<i;)r=n+e,yield t.slice(n,r),n=r},fje=async function*(t,e){for await(const i of mje(t))yield*hje(i,e)},mje=async function*(t){if(t[Symbol.asyncIterator]){yield*t;return}const e=t.getReader();try{for(;;){const{done:i,value:n}=await e.read();if(i)break;yield n}}finally{await e.cancel()}},aX=(t,e,i,n)=>{const r=fje(t,e);let a=0,s,o=l=>{s||(s=!0,n&&n(l))};return new ReadableStream({async pull(l){try{const{done:c,value:u}=await r.next();if(c){o(),l.close();return}let d=u.byteLength;if(i){let p=a+=d;i(p)}l.enqueue(new Uint8Array(u))}catch(c){throw o(c),c}},cancel(l){return o(l),r.return()}},{highWaterMark:2})},gL=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",ime=gL&&typeof ReadableStream=="function",gje=gL&&(typeof TextEncoder=="function"?(t=>e=>t.encode(e))(new TextEncoder):async t=>new Uint8Array(await new Response(t).arrayBuffer())),nme=(t,...e)=>{try{return!!t(...e)}catch{return!1}},vje=ime&&nme(()=>{let t=!1;const e=new Request(xu.origin,{body:new ReadableStream,method:"POST",get duplex(){return t=!0,"half"}}).headers.has("Content-Type");return t&&!e}),sX=64*1024,Sj=ime&&nme(()=>pt.isReadableStream(new Response("").body)),D_={stream:Sj&&(t=>t.body)};gL&&(t=>{["text","arrayBuffer","blob","formData","stream"].forEach(e=>{!D_[e]&&(D_[e]=pt.isFunction(t[e])?i=>i[e]():(i,n)=>{throw new kn(`Response type '${e}' is not supported`,kn.ERR_NOT_SUPPORT,n)})})})(new Response);const yje=async t=>{if(t==null)return 0;if(pt.isBlob(t))return t.size;if(pt.isSpecCompliantForm(t))return(await new Request(xu.origin,{method:"POST",body:t}).arrayBuffer()).byteLength;if(pt.isArrayBufferView(t)||pt.isArrayBuffer(t))return t.byteLength;if(pt.isURLSearchParams(t)&&(t=t+""),pt.isString(t))return(await gje(t)).byteLength},bje=async(t,e)=>{const i=pt.toFiniteNumber(t.getContentLength());return i??yje(e)},Ije=gL&&(async t=>{let{url:e,method:i,data:n,signal:r,cancelToken:a,timeout:s,onDownloadProgress:o,onUploadProgress:l,responseType:c,headers:u,withCredentials:d="same-origin",fetchOptions:p}=tme(t);c=c?(c+"").toLowerCase():"text";let h=pje([r,a&&a.toAbortSignal()],s),f;const m=h&&h.unsubscribe&&(()=>{h.unsubscribe()});let g;try{if(l&&vje&&i!=="get"&&i!=="head"&&(g=await bje(u,n))!==0){let T=new Request(e,{method:"POST",body:n,duplex:"half"}),w;if(pt.isFormData(n)&&(w=T.headers.get("content-type"))&&u.setContentType(w),T.body){const[S,U]=iX(g,U_(nX(l)));n=aX(T.body,sX,S,U)}}pt.isString(d)||(d=d?"include":"omit");const v="credentials"in Request.prototype;f=new Request(e,{...p,signal:h,method:i.toUpperCase(),headers:u.normalize().toJSON(),body:n,duplex:"half",credentials:v?d:void 0});let y=await fetch(f);const b=Sj&&(c==="stream"||c==="response");if(Sj&&(o||b&&m)){const T={};["status","statusText","headers"].forEach(P=>{T[P]=y[P]});const w=pt.toFiniteNumber(y.headers.get("content-length")),[S,U]=o&&iX(w,U_(nX(o),!0))||[];y=new Response(aX(y.body,sX,S,()=>{U&&U(),m&&m()}),T)}c=c||"text";let I=await D_[pt.findKey(D_,c)||"text"](y,t);return!b&&m&&m(),await new Promise((T,w)=>{Qfe(T,w,{data:I,headers:Ou.from(y.headers),status:y.status,statusText:y.statusText,config:t,request:f})})}catch(v){throw m&&m(),v&&v.name==="TypeError"&&/fetch/i.test(v.message)?Object.assign(new kn("Network Error",kn.ERR_NETWORK,t,f),{cause:v.cause||v}):kn.from(v,v&&v.code,t,f)}}),Tj={http:xVe,xhr:dje,fetch:Ije};pt.forEach(Tj,(t,e)=>{if(t){try{Object.defineProperty(t,"name",{value:e})}catch{}Object.defineProperty(t,"adapterName",{value:e})}});const oX=t=>`- ${t}`,wje=t=>pt.isFunction(t)||t===null||t===!1,rme={getAdapter:t=>{t=pt.isArray(t)?t:[t];const{length:e}=t;let i,n;const r={};for(let a=0;a<e;a++){i=t[a];let s;if(n=i,!wje(i)&&(n=Tj[(s=String(i)).toLowerCase()],n===void 0))throw new kn(`Unknown adapter '${s}'`);if(n)break;r[s||"#"+a]=n}if(!n){const a=Object.entries(r).map(([o,l])=>`adapter ${o} `+(l===!1?"is not supported by the environment":"is not available in the build"));let s=e?a.length>1?`since :
`+a.map(oX).join(`
`):" "+oX(a[0]):"as no adapter specified";throw new kn("There is no suitable adapter to dispatch the request "+s,"ERR_NOT_SUPPORT")}return n},adapters:Tj};function _$(t){if(t.cancelToken&&t.cancelToken.throwIfRequested(),t.signal&&t.signal.aborted)throw new RU(null,t)}function lX(t){return _$(t),t.headers=Ou.from(t.headers),t.data=A$.call(t,t.transformRequest),["post","put","patch"].indexOf(t.method)!==-1&&t.headers.setContentType("application/x-www-form-urlencoded",!1),rme.getAdapter(t.adapter||ZC.adapter)(t).then(function(n){return _$(t),n.data=A$.call(t,t.transformResponse,n),n.headers=Ou.from(n.headers),n},function(n){return Jfe(n)||(_$(t),n&&n.response&&(n.response.data=A$.call(t,t.transformResponse,n.response),n.response.headers=Ou.from(n.response.headers))),Promise.reject(n)})}const ame="1.7.7",S5={};["object","boolean","number","function","string","symbol"].forEach((t,e)=>{S5[t]=function(n){return typeof n===t||"a"+(e<1?"n ":" ")+t}});const cX={};S5.transitional=function(e,i,n){function r(a,s){return"[Axios v"+ame+"] Transitional option '"+a+"'"+s+(n?". "+n:"")}return(a,s,o)=>{if(e===!1)throw new kn(r(s," has been removed"+(i?" in "+i:"")),kn.ERR_DEPRECATED);return i&&!cX[s]&&(cX[s]=!0,console.warn(r(s," has been deprecated since v"+i+" and will be removed in the near future"))),e?e(a,s,o):!0}};function Sje(t,e,i){if(typeof t!="object")throw new kn("options must be an object",kn.ERR_BAD_OPTION_VALUE);const n=Object.keys(t);let r=n.length;for(;r-- >0;){const a=n[r],s=e[a];if(s){const o=t[a],l=o===void 0||s(o,a,t);if(l!==!0)throw new kn("option "+a+" must be "+l,kn.ERR_BAD_OPTION_VALUE);continue}if(i!==!0)throw new kn("Unknown option "+a,kn.ERR_BAD_OPTION)}}const Uj={assertOptions:Sje,validators:S5},fv=Uj.validators;class Hb{constructor(e){this.defaults=e,this.interceptors={request:new eX,response:new eX}}async request(e,i){try{return await this._request(e,i)}catch(n){if(n instanceof Error){let r;Error.captureStackTrace?Error.captureStackTrace(r={}):r=new Error;const a=r.stack?r.stack.replace(/^.+\n/,""):"";try{n.stack?a&&!String(n.stack).endsWith(a.replace(/^.+\n.+\n/,""))&&(n.stack+=`
`+a):n.stack=a}catch{}}throw n}}_request(e,i){typeof e=="string"?(i=i||{},i.url=e):i=e||{},i=bI(this.defaults,i);const{transitional:n,paramsSerializer:r,headers:a}=i;n!==void 0&&Uj.assertOptions(n,{silentJSONParsing:fv.transitional(fv.boolean),forcedJSONParsing:fv.transitional(fv.boolean),clarifyTimeoutError:fv.transitional(fv.boolean)},!1),r!=null&&(pt.isFunction(r)?i.paramsSerializer={serialize:r}:Uj.assertOptions(r,{encode:fv.function,serialize:fv.function},!0)),i.method=(i.method||this.defaults.method||"get").toLowerCase();let s=a&&pt.merge(a.common,a[i.method]);a&&pt.forEach(["delete","get","head","post","put","patch","common"],f=>{delete a[f]}),i.headers=Ou.concat(s,a);const o=[];let l=!0;this.interceptors.request.forEach(function(m){typeof m.runWhen=="function"&&m.runWhen(i)===!1||(l=l&&m.synchronous,o.unshift(m.fulfilled,m.rejected))});const c=[];this.interceptors.response.forEach(function(m){c.push(m.fulfilled,m.rejected)});let u,d=0,p;if(!l){const f=[lX.bind(this),void 0];for(f.unshift.apply(f,o),f.push.apply(f,c),p=f.length,u=Promise.resolve(i);d<p;)u=u.then(f[d++],f[d++]);return u}p=o.length;let h=i;for(d=0;d<p;){const f=o[d++],m=o[d++];try{h=f(h)}catch(g){m.call(this,g);break}}try{u=lX.call(this,h)}catch(f){return Promise.reject(f)}for(d=0,p=c.length;d<p;)u=u.then(c[d++],c[d++]);return u}getUri(e){e=bI(this.defaults,e);const i=eme(e.baseURL,e.url);return Kfe(i,e.params,e.paramsSerializer)}}pt.forEach(["delete","get","head","options"],function(e){Hb.prototype[e]=function(i,n){return this.request(bI(n||{},{method:e,url:i,data:(n||{}).data}))}});pt.forEach(["post","put","patch"],function(e){function i(n){return function(a,s,o){return this.request(bI(o||{},{method:e,headers:n?{"Content-Type":"multipart/form-data"}:{},url:a,data:s}))}}Hb.prototype[e]=i(),Hb.prototype[e+"Form"]=i(!0)});class T5{constructor(e){if(typeof e!="function")throw new TypeError("executor must be a function.");let i;this.promise=new Promise(function(a){i=a});const n=this;this.promise.then(r=>{if(!n._listeners)return;let a=n._listeners.length;for(;a-- >0;)n._listeners[a](r);n._listeners=null}),this.promise.then=r=>{let a;const s=new Promise(o=>{n.subscribe(o),a=o}).then(r);return s.cancel=function(){n.unsubscribe(a)},s},e(function(a,s,o){n.reason||(n.reason=new RU(a,s,o),i(n.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){if(this.reason){e(this.reason);return}this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const i=this._listeners.indexOf(e);i!==-1&&this._listeners.splice(i,1)}toAbortSignal(){const e=new AbortController,i=n=>{e.abort(n)};return this.subscribe(i),e.signal.unsubscribe=()=>this.unsubscribe(i),e.signal}static source(){let e;return{token:new T5(function(r){e=r}),cancel:e}}}function Tje(t){return function(i){return t.apply(null,i)}}function Uje(t){return pt.isObject(t)&&t.isAxiosError===!0}const Dj={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(Dj).forEach(([t,e])=>{Dj[e]=t});function sme(t){const e=new Hb(t),i=Lfe(Hb.prototype.request,e);return pt.extend(i,Hb.prototype,e,{allOwnKeys:!0}),pt.extend(i,e,null,{allOwnKeys:!0}),i.create=function(r){return sme(bI(t,r))},i}const go=sme(ZC);go.Axios=Hb;go.CanceledError=RU;go.CancelToken=T5;go.isCancel=Jfe;go.VERSION=ame;go.toFormData=mL;go.AxiosError=kn;go.Cancel=go.CanceledError;go.all=function(e){return Promise.all(e)};go.spread=Tje;go.isAxiosError=Uje;go.mergeConfig=bI;go.AxiosHeaders=Ou;go.formToJSON=t=>Xfe(pt.isHTMLForm(t)?new FormData(t):t);go.getAdapter=rme.getAdapter;go.HttpStatusCode=Dj;go.default=go;const ome=Ofe(),Dje="https://courthive.net",XC=go.create({baseURL:Dje});XC.interceptors.request.use(t=>{const e=localStorage.getItem(ome);return e&&(t.headers.Authorization=`Bearer ${e}`),t},t=>Promise.reject(t));XC.interceptors.response.use(t=>{var e,i;return(e=t.data)!=null&&e.error&&Jt({message:(i=t.data.error)==null?void 0:i.message,intent:"is-danger"}),t},t=>{var e;if(t.message==="Network Error"&&Jt({message:t.message,intent:"is-danger"}),t.response){((e=t.response)==null?void 0:e.status)===401&&lme();const i=t.response.data.message||t.response.data.error||t.response.data;Jt({message:i,intent:"is-danger"})}});const Eje=()=>{const t=localStorage.getItem(ome);XC.defaults.headers.common.Authorization=`Bearer ${t}`},lme=()=>{XC.defaults.headers.common.Authorization=void 0},nu={...XC,addAuthorization:Eje,removeAuthorization:lme};async function Pje({identifier:t}){return await nu.post("/service/tournamentdetails",{identifier:t})}async function vL({tournamentId:t}){return await nu.post("/factory/fetch",{tournamentId:t})}async function Cje({provider:t}){return await nu.post("/provider/add",t)}async function Rje({provider:t}){return await nu.post("/provider/modify",t)}async function Mje({providerId:t}){return await nu.post("/provider/detail",{providerId:t})}async function Nje({providerAbbr:t}){return await nu.post("/provider/calendar",{providerAbbr:t})}async function RE(){return await nu.post("/provider/allProviders",{})}async function cme(){return await nu.post("/auth/allusers",{})}async function Aje({email:t}){return await nu.post("/auth/remove",{email:t})}async function mD({tournamentRecord:t}){return await nu.post("/factory/save",{tournamentRecord:t})}async function _je({providerId:t,tournamentId:e}){return await nu.post("/factory/remove",{providerId:t,tournamentId:e})}function U5(t){return t[t.length-1]}function JC(t,...e){return e.forEach(i=>{t.includes(i)||t.push(i)}),t}function uX(t,e){return t?t.split(e):[]}function D5(t,e,i){const n=e===void 0||t>=e,r=i===void 0||t<=i;return n&&r}function ume(t,e,i){return t<e?e:t>i?i:t}function eT(t,e,i={},n=0,r=""){const a=Object.keys(i).reduce((o,l)=>{let c=i[l];return typeof c=="function"&&(c=c(n)),`${o} ${l}="${c}"`},t);r+=`<${a}></${t}>`;const s=n+1;return s<e?eT(t,e,i,s,r):r}function E5(t){return t.replace(/>\s+/g,">").replace(/\s+</,"<")}function Ej(t){return new Date(t).setHours(0,0,0,0)}function mw(){return new Date().setHours(0,0,0,0)}function tT(...t){switch(t.length){case 0:return mw();case 1:return Ej(t[0])}const e=new Date(0);return e.setFullYear(...t),e.setHours(0,0,0,0)}function ME(t,e){const i=new Date(t);return i.setDate(i.getDate()+e)}function kje(t,e){return ME(t,e*7)}function E_(t,e){const i=new Date(t),n=i.getMonth()+e;let r=n%12;r<0&&(r+=12);const a=i.setMonth(n);return i.getMonth()!==r?i.setDate(0):a}function NE(t,e){const i=new Date(t),n=i.getMonth(),r=i.setFullYear(i.getFullYear()+e);return n===1&&i.getMonth()===2?i.setDate(0):r}function dX(t,e){return(t-e+7)%7}function zb(t,e,i=0){const n=new Date(t).getDay();return ME(t,dX(e,i)-dX(n,i))}function dme(t,e){return Math.round((t-e)/6048e5)+1}function xje(t){const e=zb(t,4,1),i=zb(new Date(e).setMonth(0,4),4,1);return dme(e,i)}function pme(t,e){const i=zb(new Date(t).setMonth(0,1),e,e),n=zb(t,e,e),r=dme(n,i);if(r<53)return r;const a=zb(new Date(t).setDate(32),e,e);return n===a?1:r}function Oje(t){return pme(t,0)}function Lje(t){return pme(t,6)}function w0(t,e){const i=new Date(t).getFullYear();return Math.floor(i/e)*e}function zv(t,e,i){if(e!==1&&e!==2)return t;const n=new Date(t);return e===1?i?n.setMonth(n.getMonth()+1,0):n.setDate(1):i?n.setFullYear(n.getFullYear()+1,0,0):n.setMonth(0,1),n.setHours(0,0,0,0)}const Pj=/dd?|DD?|mm?|MM?|yy?(?:yy)?/,Fje=/[\s!-/:-@[-`{-~年月日]+/;let k$={};const pX={y(t,e){return new Date(t).setFullYear(parseInt(e,10))},m(t,e,i){const n=new Date(t);let r=parseInt(e,10)-1;if(isNaN(r)){if(!e)return NaN;const a=e.toLowerCase(),s=o=>o.toLowerCase().startsWith(a);if(r=i.monthsShort.findIndex(s),r<0&&(r=i.months.findIndex(s)),r<0)return NaN}return n.setMonth(r),n.getMonth()!==hme(r)?n.setDate(0):n.getTime()},d(t,e){return new Date(t).setDate(parseInt(e,10))}},$je={d(t){return t.getDate()},dd(t){return zM(t.getDate(),2)},D(t,e){return e.daysShort[t.getDay()]},DD(t,e){return e.days[t.getDay()]},m(t){return t.getMonth()+1},mm(t){return zM(t.getMonth()+1,2)},M(t,e){return e.monthsShort[t.getMonth()]},MM(t,e){return e.months[t.getMonth()]},y(t){return t.getFullYear()},yy(t){return zM(t.getFullYear(),2).slice(-2)},yyyy(t){return zM(t.getFullYear(),4)}};function hme(t){return t>-1?t%12:hme(t+12)}function zM(t,e){return t.toString().padStart(e,"0")}function fme(t){if(typeof t!="string")throw new Error("Invalid date format.");if(t in k$)return k$[t];const e=t.split(Pj),i=t.match(new RegExp(Pj,"g"));if(e.length===0||!i)throw new Error("Invalid date format.");const n=i.map(a=>$je[a]),r=Object.keys(pX).reduce((a,s)=>(i.find(l=>l[0]!=="D"&&l[0].toLowerCase()===s)&&a.push(s),a),[]);return k$[t]={parser(a,s){const o=a.split(Fje).reduce((l,c,u)=>{if(c.length>0&&i[u]){const d=i[u][0];d==="M"?l.m=c:d!=="D"&&(l[d]=c)}return l},{});return r.reduce((l,c)=>{const u=pX[c](l,o[c],s);return isNaN(u)?l:u},mw())},formatter(a,s){let o=n.reduce((l,c,u)=>l+=`${e[u]}${c(a,s)}`,"");return o+=U5(e)}}}function II(t,e,i){if(t instanceof Date||typeof t=="number"){const n=Ej(t);return isNaN(n)?void 0:n}if(t){if(t==="today")return mw();if(e&&e.toValue){const n=e.toValue(t,e,i);return isNaN(n)?void 0:Ej(n)}return fme(e).parser(t,i)}}function QC(t,e,i){if(isNaN(t)||!t&&t!==0)return"";const n=typeof t=="number"?new Date(t):t;return e.toDisplay?e.toDisplay(n,e,i):fme(e).formatter(n,i)}const Bje=document.createRange();function vg(t){return Bje.createContextualFragment(t)}function mme(t){return t.parentElement||(t.parentNode instanceof ShadowRoot?t.parentNode.host:void 0)}function yL(t){return t.getRootNode().activeElement===t}function gD(t){t.style.display!=="none"&&(t.style.display&&(t.dataset.styleDisplay=t.style.display),t.style.display="none")}function vD(t){t.style.display==="none"&&(t.dataset.styleDisplay?(t.style.display=t.dataset.styleDisplay,delete t.dataset.styleDisplay):t.style.display="")}function P_(t){t.firstChild&&(t.removeChild(t.firstChild),P_(t))}function Vje(t,e){P_(t),e instanceof DocumentFragment?t.appendChild(e):typeof e=="string"?t.appendChild(vg(e)):typeof e.forEach=="function"&&e.forEach(i=>{t.appendChild(i)})}const C_=new WeakMap,{addEventListener:jje,removeEventListener:Gje}=EventTarget.prototype;function R_(t,e){let i=C_.get(t);i||(i=[],C_.set(t,i)),e.forEach(n=>{jje.call(...n),i.push(n)})}function gme(t){let e=C_.get(t);e&&(e.forEach(i=>{Gje.call(...i)}),C_.delete(t))}if(!Event.prototype.composedPath){const t=(e,i=[])=>{i.push(e);let n;return e.parentNode?n=e.parentNode:e.host?n=e.host:e.defaultView&&(n=e.defaultView),n?t(n,i):i};Event.prototype.composedPath=function(){return t(this.target)}}function vme(t,e,i){const[n,...r]=t;if(e(n))return n;if(!(n===i||n.tagName==="HTML"||r.length===0))return vme(r,e,i)}function yme(t,e){const i=typeof e=="function"?e:n=>n instanceof Element&&n.matches(e);return vme(t.composedPath(),i,t.currentTarget)}const E1={en:{days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],daysShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],daysMin:["Su","Mo","Tu","We","Th","Fr","Sa"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],monthsShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],today:"Today",clear:"Clear",titleFormat:"MM y"}},P5={autohide:!1,beforeShowDay:null,beforeShowDecade:null,beforeShowMonth:null,beforeShowYear:null,clearButton:!1,dateDelimiter:",",datesDisabled:[],daysOfWeekDisabled:[],daysOfWeekHighlighted:[],defaultViewDate:void 0,disableTouchKeyboard:!1,enableOnReadonly:!0,format:"mm/dd/yyyy",language:"en",maxDate:null,maxNumberOfDates:1,maxView:3,minDate:null,nextArrow:"»",orientation:"auto",pickLevel:0,prevArrow:"«",showDaysOfWeek:!0,showOnClick:!0,showOnFocus:!0,startView:0,title:"",todayButton:!1,todayButtonMode:0,todayHighlight:!1,updateOnBlur:!0,weekNumbers:0,weekStart:0},{language:x$,format:Hje,weekStart:zje}=P5;function hX(t,e){return t.length<6&&e>=0&&e<7?JC(t,e):t}function bme(t,e){switch(t===4?e===6?3:!e+1:t){case 1:return xje;case 2:return Oje;case 3:return Lje}}function fX(t,e,i){return e.weekStart=t,e.weekEnd=(t+6)%7,i===4&&(e.getWeekNumber=bme(4,t)),t}function mX(t,e,i,n){const r=II(t,e,i);return r!==void 0?r:n}function O$(t,e,i=3){const n=parseInt(t,10);return n>=0&&n<=i?n:e}function qM(t,e,i,n=void 0){e in t&&(i in t||(t[i]=n?n(t[e]):t[e]),delete t[e])}function L$(t,e){const i=Object.assign({},t),n={},r=e.constructor.locales,a=!!e.rangeSideIndex;let{datesDisabled:s,format:o,language:l,locale:c,maxDate:u,maxView:d,minDate:p,pickLevel:h,startView:f,weekNumbers:m,weekStart:g}=e.config||{};if(qM(i,"calendarWeeks","weekNumbers",w=>w?1:0),qM(i,"clearBtn","clearButton"),qM(i,"todayBtn","todayButton"),qM(i,"todayBtnMode","todayButtonMode"),i.language){let w;if(i.language!==l&&(r[i.language]?w=i.language:(w=i.language.split("-")[0],r[w]||(w=!1))),delete i.language,w){l=n.language=w;const S=c||r[x$];c=Object.assign({format:Hje,weekStart:zje},r[x$]),l!==x$&&Object.assign(c,r[l]),n.locale=c,o===S.format&&(o=n.format=c.format),g===S.weekStart&&(g=fX(c.weekStart,n,m))}}if(i.format){const w=typeof i.format.toDisplay=="function",S=typeof i.format.toValue=="function",U=Pj.test(i.format);(w&&S||U)&&(o=n.format=i.format),delete i.format}let v=h;"pickLevel"in i&&(v=O$(i.pickLevel,h,2),delete i.pickLevel),v!==h&&(v>h&&("minDate"in i||(i.minDate=p),"maxDate"in i||(i.maxDate=u)),s&&!i.datesDisabled&&(i.datesDisabled=[]),h=n.pickLevel=v);let y=p,b=u;if("minDate"in i){const w=tT(0,0,1);y=i.minDate===null?w:mX(i.minDate,o,c,y),y!==w&&(y=zv(y,h,!1)),delete i.minDate}if("maxDate"in i&&(b=i.maxDate===null?void 0:mX(i.maxDate,o,c,b),b!==void 0&&(b=zv(b,h,!0)),delete i.maxDate),b<y?(p=n.minDate=b,u=n.maxDate=y):(p!==y&&(p=n.minDate=y),u!==b&&(u=n.maxDate=b)),i.datesDisabled){const w=i.datesDisabled;if(typeof w=="function")n.datesDisabled=null,n.checkDisabled=(S,U)=>w(new Date(S),U,a);else{const S=n.datesDisabled=w.reduce((U,P)=>{const E=II(P,o,c);return E!==void 0?JC(U,zv(E,h,a)):U},[]);n.checkDisabled=U=>S.includes(U)}delete i.datesDisabled}if("defaultViewDate"in i){const w=II(i.defaultViewDate,o,c);w!==void 0&&(n.defaultViewDate=w),delete i.defaultViewDate}if("weekStart"in i){const w=Number(i.weekStart)%7;isNaN(w)||(g=fX(w,n,m)),delete i.weekStart}if(i.daysOfWeekDisabled&&(n.daysOfWeekDisabled=i.daysOfWeekDisabled.reduce(hX,[]),delete i.daysOfWeekDisabled),i.daysOfWeekHighlighted&&(n.daysOfWeekHighlighted=i.daysOfWeekHighlighted.reduce(hX,[]),delete i.daysOfWeekHighlighted),"weekNumbers"in i){let w=i.weekNumbers;if(w){const S=typeof w=="function"?(U,P)=>w(new Date(U),P):bme(w=parseInt(w,10),g);S&&(m=n.weekNumbers=w,n.getWeekNumber=S)}else m=n.weekNumbers=0,n.getWeekNumber=null;delete i.weekNumbers}if("maxNumberOfDates"in i){const w=parseInt(i.maxNumberOfDates,10);w>=0&&(n.maxNumberOfDates=w,n.multidate=w!==1),delete i.maxNumberOfDates}i.dateDelimiter&&(n.dateDelimiter=String(i.dateDelimiter),delete i.dateDelimiter);let I=d;"maxView"in i&&(I=O$(i.maxView,d),delete i.maxView),I=h>I?h:I,I!==d&&(d=n.maxView=I);let T=f;if("startView"in i&&(T=O$(i.startView,T),delete i.startView),T<h?T=h:T>d&&(T=d),T!==f&&(n.startView=T),i.prevArrow){const w=vg(i.prevArrow);w.childNodes.length>0&&(n.prevArrow=w.childNodes),delete i.prevArrow}if(i.nextArrow){const w=vg(i.nextArrow);w.childNodes.length>0&&(n.nextArrow=w.childNodes),delete i.nextArrow}if("disableTouchKeyboard"in i&&(n.disableTouchKeyboard="ontouchstart"in document&&!!i.disableTouchKeyboard,delete i.disableTouchKeyboard),i.orientation){const w=i.orientation.toLowerCase().split(/\s+/g);n.orientation={x:w.find(S=>S==="left"||S==="right")||"auto",y:w.find(S=>S==="top"||S==="bottom")||"auto"},delete i.orientation}if("todayButtonMode"in i){switch(i.todayButtonMode){case 0:case 1:n.todayButtonMode=i.todayButtonMode}delete i.todayButtonMode}return Object.entries(i).forEach(([w,S])=>{S!==void 0&&w in P5&&(n[w]=S)}),n}const gX={show:{key:"ArrowDown"},hide:null,toggle:{key:"Escape"},prevButton:{key:"ArrowLeft",ctrlOrMetaKey:!0},nextButton:{key:"ArrowRight",ctrlOrMetaKey:!0},viewSwitch:{key:"ArrowUp",ctrlOrMetaKey:!0},clearButton:{key:"Backspace",ctrlOrMetaKey:!0},todayButton:{key:".",ctrlOrMetaKey:!0},exitEditMode:{key:"ArrowDown",ctrlOrMetaKey:!0}};function qje(t){return Object.keys(gX).reduce((e,i)=>{const n=t[i]===void 0?gX[i]:t[i],r=n&&n.key;if(!r||typeof r!="string")return e;const a={key:r,ctrlOrMetaKey:!!(n.ctrlOrMetaKey||n.ctrlKey||n.metaKey)};return r.length>1&&(a.altKey=!!n.altKey,a.shiftKey=!!n.shiftKey),e[i]=a,e},{})}const vX=t=>t.map(e=>`<button type="button" class="%buttonClass% ${e}" tabindex="-1"></button>`).join(""),Wje=E5(`<div class="datepicker">
  <div class="datepicker-picker">
    <div class="datepicker-header">
      <div class="datepicker-title"></div>
      <div class="datepicker-controls">
        ${vX(["prev-button prev-btn","view-switch","next-button next-btn"])}
      </div>
    </div>
    <div class="datepicker-main"></div>
    <div class="datepicker-footer">
      <div class="datepicker-controls">
        ${vX(["today-button today-btn","clear-button clear-btn"])}
      </div>
    </div>
  </div>
</div>`),Yje=E5(`<div class="days">
  <div class="days-of-week">${eT("span",7,{class:"dow"})}</div>
  <div class="datepicker-grid">${eT("span",42)}</div>
</div>`),Kje=E5(`<div class="week-numbers calendar-weeks">
  <div class="days-of-week"><span class="dow"></span></div>
  <div class="weeks">${eT("span",6,{class:"week"})}</div>
</div>`);let C5=class{constructor(e,i){Object.assign(this,i,{picker:e,element:vg('<div class="datepicker-view"></div>').firstChild,selected:[],isRangeEnd:!!e.datepicker.rangeSideIndex}),this.init(this.picker.datepicker.config)}init(e){"pickLevel"in e&&(this.isMinView=this.id===e.pickLevel),this.setOptions(e),this.updateFocus(),this.updateSelection()}prepareForRender(e,i,n){this.disabled=[];const r=this.picker;r.setViewSwitchLabel(e),r.setPrevButtonDisabled(i),r.setNextButtonDisabled(n)}setDisabled(e,i){i.add("disabled"),JC(this.disabled,e)}performBeforeHook(e,i){let n=this.beforeShow(new Date(i));switch(typeof n){case"boolean":n={enabled:n};break;case"string":n={classes:n}}if(n){const r=e.classList;if(n.enabled===!1&&this.setDisabled(i,r),n.classes){const a=n.classes.split(/\s+/);r.add(...a),a.includes("disabled")&&this.setDisabled(i,r)}n.content&&Vje(e,n.content)}}renderCell(e,i,n,r,{selected:a,range:s},o,l=[]){e.textContent=i,this.isMinView&&(e.dataset.date=r);const c=e.classList;if(e.className=`datepicker-cell ${this.cellClass}`,n<this.first?c.add("prev"):n>this.last&&c.add("next"),c.add(...l),(o||this.checkDisabled(r,this.id))&&this.setDisabled(r,c),s){const[u,d]=s;n>u&&n<d&&c.add("range"),n===u&&c.add("range-start"),n===d&&c.add("range-end")}a.includes(n)&&c.add("selected"),n===this.focused&&c.add("focused"),this.beforeShow&&this.performBeforeHook(e,r)}refreshCell(e,i,n,[r,a]){const s=e.classList;s.remove("range","range-start","range-end","selected","focused"),i>r&&i<a&&s.add("range"),i===r&&s.add("range-start"),i===a&&s.add("range-end"),n.includes(i)&&s.add("selected"),i===this.focused&&s.add("focused")}changeFocusedCell(e){this.grid.querySelectorAll(".focused").forEach(i=>{i.classList.remove("focused")}),this.grid.children[e].classList.add("focused")}};class Zje extends C5{constructor(e){super(e,{id:0,name:"days",cellClass:"day"})}init(e,i=!0){if(i){const n=vg(Yje).firstChild;this.dow=n.firstChild,this.grid=n.lastChild,this.element.appendChild(n)}super.init(e)}setOptions(e){let i;if("minDate"in e&&(this.minDate=e.minDate),"maxDate"in e&&(this.maxDate=e.maxDate),e.checkDisabled&&(this.checkDisabled=e.checkDisabled),e.daysOfWeekDisabled&&(this.daysOfWeekDisabled=e.daysOfWeekDisabled,i=!0),e.daysOfWeekHighlighted&&(this.daysOfWeekHighlighted=e.daysOfWeekHighlighted),"todayHighlight"in e&&(this.todayHighlight=e.todayHighlight),"weekStart"in e&&(this.weekStart=e.weekStart,this.weekEnd=e.weekEnd,i=!0),e.locale){const n=this.locale=e.locale;this.dayNames=n.daysMin,this.switchLabelFormat=n.titleFormat,i=!0}if("beforeShowDay"in e&&(this.beforeShow=typeof e.beforeShowDay=="function"?e.beforeShowDay:void 0),"weekNumbers"in e)if(e.weekNumbers&&!this.weekNumbers){const n=vg(Kje).firstChild;this.weekNumbers={element:n,dow:n.firstChild,weeks:n.lastChild},this.element.insertBefore(n,this.element.firstChild)}else this.weekNumbers&&!e.weekNumbers&&(this.element.removeChild(this.weekNumbers.element),this.weekNumbers=null);"getWeekNumber"in e&&(this.getWeekNumber=e.getWeekNumber),"showDaysOfWeek"in e&&(e.showDaysOfWeek?(vD(this.dow),this.weekNumbers&&vD(this.weekNumbers.dow)):(gD(this.dow),this.weekNumbers&&gD(this.weekNumbers.dow))),i&&Array.from(this.dow.children).forEach((n,r)=>{const a=(this.weekStart+r)%7;n.textContent=this.dayNames[a],n.className=this.daysOfWeekDisabled.includes(a)?"dow disabled":"dow"})}updateFocus(){const e=new Date(this.picker.viewDate),i=e.getFullYear(),n=e.getMonth(),r=tT(i,n,1),a=zb(r,this.weekStart,this.weekStart);this.first=r,this.last=tT(i,n+1,0),this.start=a,this.focused=this.picker.viewDate}updateSelection(){const{dates:e,rangepicker:i}=this.picker.datepicker;this.selected=e,i&&(this.range=i.dates)}render(){if(this.today=this.todayHighlight?mw():void 0,this.prepareForRender(QC(this.focused,this.switchLabelFormat,this.locale),this.first<=this.minDate,this.last>=this.maxDate),this.weekNumbers){const e=this.weekStart,i=zb(this.first,e,e);Array.from(this.weekNumbers.weeks.children).forEach((n,r)=>{const a=kje(i,r);n.textContent=this.getWeekNumber(a,e),r>3&&n.classList[a>this.last?"add":"remove"]("next")})}Array.from(this.grid.children).forEach((e,i)=>{const n=ME(this.start,i),r=new Date(n),a=r.getDay(),s=[];this.today===n&&s.push("today"),this.daysOfWeekHighlighted.includes(a)&&s.push("highlighted"),this.renderCell(e,r.getDate(),n,n,this,n<this.minDate||n>this.maxDate||this.daysOfWeekDisabled.includes(a),s)})}refresh(){const e=this.range||[];Array.from(this.grid.children).forEach(i=>{this.refreshCell(i,Number(i.dataset.date),this.selected,e)})}refreshFocus(){this.changeFocusedCell(Math.round((this.focused-this.start)/864e5))}}function yX(t,e){if(!t||!t[0]||!t[1])return;const[[i,n],[r,a]]=t;if(!(i>e||r<e))return[i===e?n:-1,r===e?a:12]}class Xje extends C5{constructor(e){super(e,{id:1,name:"months",cellClass:"month"})}init(e,i=!0){i&&(this.grid=this.element,this.element.classList.add("months","datepicker-grid"),this.grid.appendChild(vg(eT("span",12,{"data-month":n=>n}))),this.first=0,this.last=11),super.init(e)}setOptions(e){if(e.locale&&(this.monthNames=e.locale.monthsShort),"minDate"in e)if(e.minDate===void 0)this.minYear=this.minMonth=this.minDate=void 0;else{const i=new Date(e.minDate);this.minYear=i.getFullYear(),this.minMonth=i.getMonth(),this.minDate=i.setDate(1)}if("maxDate"in e)if(e.maxDate===void 0)this.maxYear=this.maxMonth=this.maxDate=void 0;else{const i=new Date(e.maxDate);this.maxYear=i.getFullYear(),this.maxMonth=i.getMonth(),this.maxDate=tT(this.maxYear,this.maxMonth+1,0)}e.checkDisabled&&(this.checkDisabled=this.isMinView||e.datesDisabled===null?e.checkDisabled:()=>!1),"beforeShowMonth"in e&&(this.beforeShow=typeof e.beforeShowMonth=="function"?e.beforeShowMonth:void 0)}updateFocus(){const e=new Date(this.picker.viewDate);this.year=e.getFullYear(),this.focused=e.getMonth()}updateSelection(){const{dates:e,rangepicker:i}=this.picker.datepicker;this.selected=e.reduce((n,r)=>{const a=new Date(r),s=a.getFullYear(),o=a.getMonth();return n[s]===void 0?n[s]=[o]:JC(n[s],o),n},{}),i&&i.dates&&(this.range=i.dates.map(n=>{const r=new Date(n);return isNaN(r)?void 0:[r.getFullYear(),r.getMonth()]}))}render(){this.prepareForRender(this.year,this.year<=this.minYear,this.year>=this.maxYear);const e=this.selected[this.year]||[],i=this.year<this.minYear||this.year>this.maxYear,n=this.year===this.minYear,r=this.year===this.maxYear,a=yX(this.range,this.year);Array.from(this.grid.children).forEach((s,o)=>{const l=zv(new Date(this.year,o,1),1,this.isRangeEnd);this.renderCell(s,this.monthNames[o],o,l,{selected:e,range:a},i||n&&o<this.minMonth||r&&o>this.maxMonth)})}refresh(){const e=this.selected[this.year]||[],i=yX(this.range,this.year)||[];Array.from(this.grid.children).forEach((n,r)=>{this.refreshCell(n,r,e,i)})}refreshFocus(){this.changeFocusedCell(this.focused)}}function Jje(t){return[...t].reduce((e,i,n)=>e+=n?i:i.toUpperCase(),"")}class bX extends C5{constructor(e,i){super(e,i)}init(e,i=!0){i&&(this.navStep=this.step*10,this.beforeShowOption=`beforeShow${Jje(this.cellClass)}`,this.grid=this.element,this.element.classList.add(this.name,"datepicker-grid"),this.grid.appendChild(vg(eT("span",12)))),super.init(e)}setOptions(e){if("minDate"in e&&(e.minDate===void 0?this.minYear=this.minDate=void 0:(this.minYear=w0(e.minDate,this.step),this.minDate=tT(this.minYear,0,1))),"maxDate"in e&&(e.maxDate===void 0?this.maxYear=this.maxDate=void 0:(this.maxYear=w0(e.maxDate,this.step),this.maxDate=tT(this.maxYear,11,31))),e.checkDisabled&&(this.checkDisabled=this.isMinView||e.datesDisabled===null?e.checkDisabled:()=>!1),this.beforeShowOption in e){const i=e[this.beforeShowOption];this.beforeShow=typeof i=="function"?i:void 0}}updateFocus(){const e=new Date(this.picker.viewDate),i=w0(e,this.navStep),n=i+9*this.step;this.first=i,this.last=n,this.start=i-this.step,this.focused=w0(e,this.step)}updateSelection(){const{dates:e,rangepicker:i}=this.picker.datepicker;this.selected=e.reduce((n,r)=>JC(n,w0(r,this.step)),[]),i&&i.dates&&(this.range=i.dates.map(n=>{if(n!==void 0)return w0(n,this.step)}))}render(){this.prepareForRender(`${this.first}-${this.last}`,this.first<=this.minYear,this.last>=this.maxYear),Array.from(this.grid.children).forEach((e,i)=>{const n=this.start+i*this.step,r=zv(new Date(n,0,1),2,this.isRangeEnd);e.dataset.year=n,this.renderCell(e,n,n,r,this,n<this.minYear||n>this.maxYear)})}refresh(){const e=this.range||[];Array.from(this.grid.children).forEach(i=>{this.refreshCell(i,Number(i.textContent),this.selected,e)})}refreshFocus(){this.changeFocusedCell(Math.round((this.focused-this.start)/this.step))}}function $0(t,e){const i={bubbles:!0,cancelable:!0,detail:{date:t.getDate(),viewDate:new Date(t.picker.viewDate),viewId:t.picker.currentView.id,datepicker:t}};t.element.dispatchEvent(new CustomEvent(e,i))}function M_(t,e){const{config:i,picker:n}=t,{currentView:r,viewDate:a}=n;let s;switch(r.id){case 0:s=E_(a,e);break;case 1:s=NE(a,e);break;default:s=NE(a,e*r.navStep)}s=ume(s,i.minDate,i.maxDate),n.changeFocus(s).render()}function Ime(t){const e=t.picker.currentView.id;e!==t.config.maxView&&t.picker.changeView(e+1).render()}function wme(t){t.setDate({clear:!0})}function Sme(t){const e=mw();t.config.todayButtonMode===1?t.setDate(e,{forceRefresh:!0,viewDate:e}):t.setFocusedDate(e,!0)}function Tme(t){const e=()=>{t.config.updateOnBlur?t.update({revert:!0}):t.refresh("input"),t.hide()},i=t.element;yL(i)?i.addEventListener("blur",e,{once:!0}):e()}function IX(t,e){const i=t.picker,n=new Date(i.viewDate),r=i.currentView.id,a=r===1?E_(n,e-n.getMonth()):NE(n,e-n.getFullYear());i.changeFocus(a).changeView(r-1).render()}function Qje(t){Ime(t)}function eGe(t){M_(t,-1)}function tGe(t){M_(t,1)}function iGe(t,e){const i=yme(e,".datepicker-cell");if(!i||i.classList.contains("disabled"))return;const{id:n,isMinView:r}=t.picker.currentView,a=i.dataset;r?t.setDate(Number(a.date)):n===1?IX(t,Number(a.month)):IX(t,Number(a.year))}function nGe(t){t.preventDefault()}const F$=["left","top","right","bottom"].reduce((t,e)=>(t[e]=`datepicker-orient-${e}`,t),{}),wX=t=>t&&`${t}px`;function SX(t,e){if("title"in e&&(e.title?(t.controls.title.textContent=e.title,vD(t.controls.title)):(t.controls.title.textContent="",gD(t.controls.title))),e.prevArrow){const i=t.controls.prevButton;P_(i),e.prevArrow.forEach(n=>{i.appendChild(n.cloneNode(!0))})}if(e.nextArrow){const i=t.controls.nextButton;P_(i),e.nextArrow.forEach(n=>{i.appendChild(n.cloneNode(!0))})}if(e.locale&&(t.controls.todayButton.textContent=e.locale.today,t.controls.clearButton.textContent=e.locale.clear),"todayButton"in e&&(e.todayButton?vD(t.controls.todayButton):gD(t.controls.todayButton)),"minDate"in e||"maxDate"in e){const{minDate:i,maxDate:n}=t.datepicker.config;t.controls.todayButton.disabled=!D5(mw(),i,n)}"clearButton"in e&&(e.clearButton?vD(t.controls.clearButton):gD(t.controls.clearButton))}function TX(t){const{dates:e,config:i,rangeSideIndex:n}=t,r=e.length>0?U5(e):zv(i.defaultViewDate,i.pickLevel,n);return ume(r,i.minDate,i.maxDate)}function UX(t,e){!("_oldViewDate"in t)&&e!==t.viewDate&&(t._oldViewDate=t.viewDate),t.viewDate=e;const{id:i,year:n,first:r,last:a}=t.currentView,s=new Date(e).getFullYear();switch(i){case 0:return e<r||e>a;case 1:return s!==n;default:return s<r||s>a}}function $$(t){return window.getComputedStyle(t).direction}function Ume(t){const e=mme(t);if(!(e===document.body||!e))return window.getComputedStyle(e).overflow!=="visible"?e:Ume(e)}let rGe=class{constructor(e){const{config:i,inputField:n}=this.datepicker=e,r=Wje.replace(/%buttonClass%/g,i.buttonClass),a=this.element=vg(r).firstChild,[s,o,l]=a.firstChild.children,c=s.firstElementChild,[u,d,p]=s.lastElementChild.children,[h,f]=l.firstChild.children,m={title:c,prevButton:u,viewSwitch:d,nextButton:p,todayButton:h,clearButton:f};this.main=o,this.controls=m;const g=n?"dropdown":"inline";a.classList.add(`datepicker-${g}`),SX(this,i),this.viewDate=TX(e),R_(e,[[a,"mousedown",nGe],[o,"click",iGe.bind(null,e)],[m.viewSwitch,"click",Qje.bind(null,e)],[m.prevButton,"click",eGe.bind(null,e)],[m.nextButton,"click",tGe.bind(null,e)],[m.todayButton,"click",Sme.bind(null,e)],[m.clearButton,"click",wme.bind(null,e)]]),this.views=[new Zje(this),new Xje(this),new bX(this,{id:2,name:"years",cellClass:"year",step:1}),new bX(this,{id:3,name:"decades",cellClass:"decade",step:10})],this.currentView=this.views[i.startView],this.currentView.render(),this.main.appendChild(this.currentView.element),i.container?i.container.appendChild(this.element):n.after(this.element)}setOptions(e){SX(this,e),this.views.forEach(i=>{i.init(e,!1)}),this.currentView.render()}detach(){this.element.remove()}show(){if(this.active)return;const{datepicker:e,element:i}=this,n=e.inputField;if(n){const r=$$(n);r!==$$(mme(i))?i.dir=r:i.dir&&i.removeAttribute("dir"),this.place(),i.classList.add("active"),e.config.disableTouchKeyboard&&n.blur()}else i.classList.add("active");this.active=!0,$0(e,"show")}hide(){this.active&&(this.datepicker.exitEditMode(),this.element.classList.remove("active"),this.active=!1,$0(this.datepicker,"hide"))}place(){const{classList:e,style:i}=this.element;i.display="block";const{width:n,height:r}=this.element.getBoundingClientRect(),a=this.element.offsetParent;i.display="";const{config:s,inputField:o}=this.datepicker,{left:l,top:c,right:u,bottom:d,width:p,height:h}=o.getBoundingClientRect();let{x:f,y:m}=s.orientation,g=l,v=c;if(a===document.body||!a)g+=window.scrollX,v+=window.scrollY;else{const U=a.getBoundingClientRect();g-=U.left-a.scrollLeft,v-=U.top-a.scrollTop}const y=Ume(o);let b=0,I=0,{clientWidth:T,clientHeight:w}=document.documentElement;if(y){const U=y.getBoundingClientRect();U.top>0&&(I=U.top),U.left>0&&(b=U.left),U.right<T&&(T=U.right),U.bottom<w&&(w=U.bottom)}let S=0;f==="auto"&&(l<b?(f="left",S=b-l):l+n>T?(f="right",T<u&&(S=T-u)):$$(o)==="rtl"?f=u-n<b?"left":"right":f="left"),f==="right"&&(g+=p-n),g+=S,m==="auto"&&(c-r>I?m=d+r>w?"top":"bottom":m="bottom"),m==="top"?v-=r:v+=h,e.remove(...Object.values(F$)),e.add(F$[f],F$[m]),i.left=wX(g),i.top=wX(v)}setViewSwitchLabel(e){this.controls.viewSwitch.textContent=e}setPrevButtonDisabled(e){this.controls.prevButton.disabled=e}setNextButtonDisabled(e){this.controls.nextButton.disabled=e}changeView(e){const i=this.currentView;return e!==i.id&&(this._oldView||(this._oldView=i),this.currentView=this.views[e],this._renderMethod="render"),this}changeFocus(e){return this._renderMethod=UX(this,e)?"render":"refreshFocus",this.views.forEach(i=>{i.updateFocus()}),this}update(e=void 0){const i=e===void 0?TX(this.datepicker):e;return this._renderMethod=UX(this,i)?"render":"refresh",this.views.forEach(n=>{n.updateFocus(),n.updateSelection()}),this}render(e=!0){const{currentView:i,datepicker:n,_oldView:r}=this,a=new Date(this._oldViewDate),s=e&&this._renderMethod||"render";if(delete this._oldView,delete this._oldViewDate,delete this._renderMethod,i[s](),r&&(this.main.replaceChild(i.element,r.element),$0(n,"changeView")),!isNaN(a)){const o=new Date(this.viewDate);o.getFullYear()!==a.getFullYear()&&$0(n,"changeYear"),o.getMonth()!==a.getMonth()&&$0(n,"changeMonth")}}};function Dme(t,e,i,n,r,a){if(D5(t,r,a)){if(n(t)){const s=e(t,i);return Dme(s,e,i,n,r,a)}return t}}function aGe(t,e,i){const n=t.picker,r=n.currentView,a=r.step||1;let s=n.viewDate,o;switch(r.id){case 0:s=ME(s,i?e*7:e),o=ME;break;case 1:s=E_(s,i?e*4:e),o=E_;break;default:s=NE(s,e*(i?4:1)*a),o=NE}s=Dme(s,o,e<0?-a:a,l=>r.disabled.includes(l),r.minDate,r.maxDate),s!==void 0&&n.changeFocus(s).render()}function sGe(t,e){const{config:i,picker:n,editMode:r}=t,a=n.active,{key:s,altKey:o,shiftKey:l}=e,c=e.ctrlKey||e.metaKey,u=()=>{e.preventDefault(),e.stopPropagation()};if(s==="Tab"){Tme(t);return}if(s==="Enter"){if(!a)t.update();else if(r)t.exitEditMode({update:!0,autohide:i.autohide});else{const m=n.currentView;m.isMinView?t.setDate(n.viewDate):(n.changeView(m.id-1).render(),u())}return}const d=i.shortcutKeys,p={key:s,ctrlOrMetaKey:c,altKey:o,shiftKey:l},h=Object.keys(d).find(m=>{const g=d[m];return!Object.keys(g).find(v=>g[v]!==p[v])});if(h){let m;if(h==="toggle"?m=h:r?h==="exitEditMode"&&(m=h):a?h==="hide"?m=h:h==="prevButton"?m=[M_,[t,-1]]:h==="nextButton"?m=[M_,[t,1]]:h==="viewSwitch"?m=[Ime,[t]]:i.clearButton&&h==="clearButton"?m=[wme,[t]]:i.todayButton&&h==="todayButton"&&(m=[Sme,[t]]):h==="show"&&(m=h),m){Array.isArray(m)?m[0].apply(null,m[1]):t[m](),u();return}}if(!a||r)return;const f=(m,g)=>{l||c||o?t.enterEditMode():(aGe(t,m,g),e.preventDefault())};s==="ArrowLeft"?f(-1,!1):s==="ArrowRight"?f(1,!1):s==="ArrowUp"?f(-1,!0):s==="ArrowDown"?f(1,!0):(s==="Backspace"||s==="Delete"||s&&s.length===1&&!c)&&t.enterEditMode()}function oGe(t){t.config.showOnFocus&&!t._showing&&t.show()}function lGe(t,e){const i=e.target;(t.picker.active||t.config.showOnClick)&&(i._active=yL(i),i._clicking=setTimeout(()=>{delete i._active,delete i._clicking},2e3))}function cGe(t,e){const i=e.target;i._clicking&&(clearTimeout(i._clicking),delete i._clicking,i._active&&t.enterEditMode(),delete i._active,t.config.showOnClick&&t.show())}function uGe(t,e){e.clipboardData.types.includes("text/plain")&&t.enterEditMode()}function dGe(t,e){const{element:i,picker:n}=t;if(!n.active&&!yL(i))return;const r=n.element;yme(e,a=>a===i||a===r)||Tme(t)}function Eme(t,e){return t.map(i=>QC(i,e.format,e.locale)).join(e.dateDelimiter)}function Pme(t,e,i=!1){if(e.length===0)return i?[]:void 0;const{config:n,dates:r,rangeSideIndex:a}=t,{pickLevel:s,maxNumberOfDates:o}=n;let l=e.reduce((c,u)=>{let d=II(u,n.format,n.locale);return d===void 0||(d=zv(d,s,a),D5(d,n.minDate,n.maxDate)&&!c.includes(d)&&!n.checkDisabled(d,s)&&(s>0||!n.daysOfWeekDisabled.includes(new Date(d).getDay()))&&c.push(d)),c},[]);if(l.length!==0)return n.multidate&&!i&&(l=l.reduce((c,u)=>(r.includes(u)||c.push(u),c),r.filter(c=>!l.includes(c)))),o&&l.length>o?l.slice(o*-1):l}function N_(t,e=3,i=!0,n=void 0){const{config:r,picker:a,inputField:s}=t;if(e&2){const o=a.active?r.pickLevel:r.startView;a.update(n).changeView(o).render(i)}e&1&&s&&(s.value=Eme(t.dates,r))}function DX(t,e,i){const n=t.config;let{clear:r,render:a,autohide:s,revert:o,forceRefresh:l,viewDate:c}=i;a===void 0&&(a=!0),a?s===void 0&&(s=n.autohide):s=l=!1,c=II(c,n.format,n.locale);const u=Pme(t,e,r);!u&&!o||(u&&u.toString()!==t.dates.toString()?(t.dates=u,N_(t,a?3:1,!0,c),$0(t,"changeDate")):N_(t,l?3:1,!0,c),s&&t.hide())}function EX(t,e){return e?i=>QC(i,e,t.config.locale):i=>new Date(i)}class Cme{constructor(e,i={},n=void 0){e.datepicker=this,this.element=e,this.dates=[];const r=this.config=Object.assign({buttonClass:i.buttonClass&&String(i.buttonClass)||"button",container:null,defaultViewDate:mw(),maxDate:void 0,minDate:void 0},L$(P5,this));let a;if(e.tagName==="INPUT"?(a=this.inputField=e,a.classList.add("datepicker-input"),i.container&&(r.container=i.container instanceof HTMLElement?i.container:document.querySelector(i.container))):r.container=e,n){const u=n.inputs.indexOf(a),d=n.datepickers;if(u<0||u>1||!Array.isArray(d))throw Error("Invalid rangepicker object.");d[u]=this,this.rangepicker=n,this.rangeSideIndex=u}this._options=i,Object.assign(r,L$(i,this)),r.shortcutKeys=qje(i.shortcutKeys||{});const s=uX(e.value||e.dataset.date,r.dateDelimiter);delete e.dataset.date;const o=Pme(this,s);o&&o.length>0&&(this.dates=o),a&&(a.value=Eme(this.dates,r));const l=this.picker=new rGe(this),c=[e,"keydown",sGe.bind(null,this)];a?R_(this,[c,[a,"focus",oGe.bind(null,this)],[a,"mousedown",lGe.bind(null,this)],[a,"click",cGe.bind(null,this)],[a,"paste",uGe.bind(null,this)],[document,"mousedown",dGe.bind(null,this)],[window,"resize",l.place.bind(l)]]):(R_(this,[c]),this.show())}static formatDate(e,i,n){return QC(e,i,n&&E1[n]||E1.en)}static parseDate(e,i,n){return II(e,i,n&&E1[n]||E1.en)}static get locales(){return E1}get active(){return!!(this.picker&&this.picker.active)}get pickerElement(){return this.picker?this.picker.element:void 0}setOptions(e){const i=L$(e,this);Object.assign(this._options,e),Object.assign(this.config,i),this.picker.setOptions(i),N_(this,3)}show(){if(this.inputField){const{config:e,inputField:i}=this;if(i.disabled||i.readOnly&&!e.enableOnReadonly)return;!yL(i)&&!e.disableTouchKeyboard&&(this._showing=!0,i.focus(),delete this._showing)}this.picker.show()}hide(){this.inputField&&(this.picker.hide(),this.picker.update().changeView(this.config.startView).render())}toggle(){this.picker.active?this.inputField&&this.picker.hide():this.show()}destroy(){this.hide(),gme(this),this.picker.detach();const e=this.element;return e.classList.remove("datepicker-input"),delete e.datepicker,this}getDate(e=void 0){const i=EX(this,e);if(this.config.multidate)return this.dates.map(i);if(this.dates.length>0)return i(this.dates[0])}setDate(...e){const i=[...e],n={},r=U5(e);r&&typeof r=="object"&&!Array.isArray(r)&&!(r instanceof Date)&&Object.assign(n,i.pop());const a=Array.isArray(i[0])?i[0]:i;DX(this,a,n)}update(e=void 0){if(!this.inputField)return;const i=Object.assign(e||{},{clear:!0,render:!0,viewDate:void 0}),n=uX(this.inputField.value,this.config.dateDelimiter);DX(this,n,i)}getFocusedDate(e=void 0){return EX(this,e)(this.picker.viewDate)}setFocusedDate(e,i=!1){const{config:n,picker:r,active:a,rangeSideIndex:s}=this,o=n.pickLevel,l=II(e,n.format,n.locale);l!==void 0&&(r.changeFocus(zv(l,o,s)),a&&i&&r.changeView(o),r.render())}refresh(e=void 0,i=!1){e&&typeof e!="string"&&(i=e,e=void 0);let n;e==="picker"?n=2:e==="input"?n=1:n=3,N_(this,n,!i)}enterEditMode(){const e=this.inputField;!e||e.readOnly||!this.picker.active||this.editMode||(this.editMode=!0,e.classList.add("in-edit"))}exitEditMode(e=void 0){if(!this.inputField||!this.editMode)return;const i=Object.assign({update:!1},e);delete this.editMode,this.inputField.classList.remove("in-edit"),i.update&&this.update(i)}}function PX(t){const e=Object.assign({},t);return delete e.inputs,delete e.allowOneSidedRange,delete e.maxNumberOfDates,e}function pGe(t,e,i,n){R_(t,[[i,"changeDate",e]]),new Cme(i,n,t)}function P1(t,e){if(t._updating)return;t._updating=!0;const i=e.target;if(i.datepicker===void 0)return;const n=t.datepickers,[r,a]=n,s={render:!1},o=t.inputs.indexOf(i),l=o===0?1:0,c=n[o].dates[0],u=n[l].dates[0];c!==void 0&&u!==void 0?o===0&&c>u?(r.setDate(u,s),a.setDate(c,s)):o===1&&c<u&&(r.setDate(c,s),a.setDate(u,s)):t.allowOneSidedRange||(c!==void 0||u!==void 0)&&(s.clear=!0,n[l].setDate(n[o].dates,s)),n.forEach(d=>{d.picker.update().render()}),delete t._updating}class hGe{constructor(e,i={}){let n=Array.isArray(i.inputs)?i.inputs:Array.from(e.querySelectorAll("input"));if(n.length<2)return;e.rangepicker=this,this.element=e,this.inputs=n=n.slice(0,2),Object.freeze(n),this.allowOneSidedRange=!!i.allowOneSidedRange;const r=P1.bind(null,this),a=PX(i),s=this.datepickers=[];n.forEach(o=>{pGe(this,r,o,a)}),Object.freeze(s),Object.defineProperty(this,"dates",{get(){return s.map(o=>o.dates[0])}}),s[0].dates.length>0?P1(this,{target:n[0]}):s[1].dates.length>0&&P1(this,{target:n[1]})}setOptions(e){this.allowOneSidedRange=!!e.allowOneSidedRange;const i=PX(e);this.datepickers.forEach(n=>{n.setOptions(i)})}destroy(){this.datepickers.forEach(e=>{e.destroy()}),gme(this),delete this.element.rangepicker}getDates(e=void 0){const i=e?n=>QC(n,e,this.datepickers[0].config.locale):n=>new Date(n);return this.dates.map(n=>n===void 0?n:i(n))}setDates(e,i){const{datepickers:[n,r],inputs:[a,s],dates:[o,l]}=this;this._updating=!0,n.setDate(e),r.setDate(i),delete this._updating,r.dates[0]!==l?P1(this,{target:s}):n.dates[0]!==o&&P1(this,{target:a})}}var dp=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function eR(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var Rme={exports:{}};(function(t){(function(){var e=function(l,c){var u=this;e.count=(e.count||0)+1,this.count=e.count,this.isOpened=!1,this.input=a(l),this.input.setAttribute("autocomplete","off"),this.input.setAttribute("aria-autocomplete","list"),this.input.setAttribute("aria-expanded","false"),this.input.setAttribute("aria-controls","awesomplete_list_"+this.count),this.input.setAttribute("aria-owns","awesomplete_list_"+this.count),this.input.setAttribute("role","combobox"),this.options=c=c||{},n(this,{minChars:2,maxItems:10,autoFirst:!1,data:e.DATA,filter:e.FILTER_CONTAINS,sort:c.sort===!1?!1:e.SORT_BYLENGTH,container:e.CONTAINER,item:e.ITEM,replace:e.REPLACE,tabSelect:!1,listLabel:"Results List",statusNoResults:"No results found",statusXResults:"{0} results found",statusTypeXChar:"Type {0} or more characters for results"},c),this.index=-1,this.container=this.container(l),this.ul=a.create("ul",{hidden:"hidden",role:"listbox",id:"awesomplete_list_"+this.count,inside:this.container,"aria-label":this.listLabel}),this.status=a.create("span",{className:"visually-hidden",role:"status","aria-live":"assertive","aria-atomic":!0,inside:this.container,textContent:""}),this._events={input:{input:this.evaluate.bind(this),blur:this.close.bind(this,{reason:"blur"}),keydown:function(d){var p=d.keyCode;u.opened&&(p===13&&u.selected||p===9&&u.selected&&u.tabSelect?(d.preventDefault(),u.select(void 0,void 0,d)):p===27?u.close({reason:"esc"}):(p===38||p===40)&&(d.preventDefault(),u[p===38?"previous":"next"]()))}},form:{submit:this.close.bind(this,{reason:"submit"})},ul:{mousedown:function(d){d.preventDefault()},click:function(d){var p=d.target;if(p!==this){for(;p&&!/li/i.test(p.nodeName);)p=p.parentNode;p&&d.button===0&&(d.preventDefault(),u.select(p,d.target,d))}}}},a.bind(this.input,this._events.input),a.bind(this.input.form,this._events.form),a.bind(this.ul,this._events.ul),this.input.hasAttribute("list")?(this.list="#"+this.input.getAttribute("list"),this.input.removeAttribute("list")):this.list=this.input.getAttribute("data-list")||c.list||[],e.all.push(this)};e.prototype={set list(l){if(Array.isArray(l))this._list=l;else if(typeof l=="string"&&l.indexOf(",")>-1)this._list=l.split(/\s*,\s*/);else if(l=a(l),l&&l.children){var c=[];r.apply(l.children).forEach(function(u){if(!u.disabled){var d=u.textContent.trim(),p=u.value||d,h=u.label||d;p!==""&&c.push({label:h,value:p})}}),this._list=c}document.activeElement===this.input&&this.evaluate()},get selected(){return this.index>-1},get opened(){return this.isOpened},close:function(l){this.opened&&(this.input.setAttribute("aria-expanded","false"),this.ul.setAttribute("hidden",""),this.isOpened=!1,this.index=-1,this.status.setAttribute("hidden",""),this.input.setAttribute("aria-activedescendant",""),a.fire(this.input,"awesomplete-close",l||{}))},open:function(){this.input.setAttribute("aria-expanded","true"),this.ul.removeAttribute("hidden"),this.isOpened=!0,this.status.removeAttribute("hidden"),this.autoFirst&&this.index===-1&&this.goto(0),a.fire(this.input,"awesomplete-open")},destroy:function(){if(a.unbind(this.input,this._events.input),a.unbind(this.input.form,this._events.form),!this.options.container){var l=this.container.parentNode;l.insertBefore(this.input,this.container),l.removeChild(this.container)}this.input.removeAttribute("autocomplete"),this.input.removeAttribute("aria-autocomplete"),this.input.removeAttribute("aria-expanded"),this.input.removeAttribute("aria-controls"),this.input.removeAttribute("aria-owns"),this.input.removeAttribute("role");var c=e.all.indexOf(this);c!==-1&&e.all.splice(c,1)},next:function(){var l=this.ul.children.length;this.goto(this.index<l-1?this.index+1:l?0:-1)},previous:function(){var l=this.ul.children.length,c=this.index-1;this.goto(this.selected&&c!==-1?c:l-1)},goto:function(l){var c=this.ul.children;this.selected&&c[this.index].setAttribute("aria-selected","false"),this.index=l,l>-1&&c.length>0&&(c[l].setAttribute("aria-selected","true"),this.input.setAttribute("aria-activedescendant",this.ul.id+"_item_"+this.index),this.ul.scrollTop=c[l].offsetTop-this.ul.clientHeight+c[l].clientHeight,a.fire(this.input,"awesomplete-highlight",{text:this.suggestions[this.index]}))},select:function(l,c,u){if(l?this.index=a.siblingIndex(l):l=this.ul.children[this.index],l){var d=this.suggestions[this.index],p=a.fire(this.input,"awesomplete-select",{text:d,origin:c||l,originalEvent:u});p&&(this.replace(d),this.close({reason:"select"}),a.fire(this.input,"awesomplete-selectcomplete",{text:d,originalEvent:u}))}},evaluate:function(){var l=this,c=this.input.value;c.length>=this.minChars&&this._list&&this._list.length>0?(this.index=-1,this.ul.innerHTML="",this.suggestions=this._list.map(function(u){return new i(l.data(u,c))}).filter(function(u){return l.filter(u,c)}),this.sort!==!1&&(this.suggestions=this.suggestions.sort(this.sort)),this.suggestions=this.suggestions.slice(0,this.maxItems),this.suggestions.forEach(function(u,d){l.ul.appendChild(l.item(u,c,d))}),this.ul.children.length===0?(this.status.textContent=this.statusNoResults,this.close({reason:"nomatches"})):(this.input.setAttribute("aria-activedescendant",""),this.open(),this.status.textContent=this.statusXResults.replaceAll("{0}",this.ul.children.length))):(this.close({reason:"nomatches"}),this.minChar<=1||c.length>=this.minChars?this.status.textContent=this.statusNoResults:this.status.textContent=this.statusTypeXChar.replaceAll("{0}",this.minChars))}},e.all=[],e.FILTER_CONTAINS=function(l,c){return RegExp(a.regExpEscape(c.trim()),"i").test(l)},e.FILTER_STARTSWITH=function(l,c){return RegExp("^"+a.regExpEscape(c.trim()),"i").test(l)},e.SORT_BYLENGTH=function(l,c){return l.length!==c.length?l.length-c.length:l<c?-1:1},e.CONTAINER=function(l){return a.create("div",{className:"awesomplete",around:l})},e.ITEM=function(l,c,u){var d=c.trim()===""?l:l.replace(RegExp(a.regExpEscape(c.trim()),"gi"),"<mark>$&</mark>");return a.create("li",{innerHTML:d,role:"option","aria-selected":"false",tabindex:"-1",id:"awesomplete_list_"+this.count+"_item_"+u})},e.REPLACE=function(l){this.input.value=l.value},e.DATA=function(l){return l};function i(l){var c=Array.isArray(l)?{label:l[0],value:l[1]}:typeof l=="object"&&"label"in l&&"value"in l?l:{label:l,value:l};this.label=c.label||c.value,this.value=c.value}Object.defineProperty(i.prototype=Object.create(String.prototype),"length",{get:function(){return this.label.length}}),i.prototype.toString=i.prototype.valueOf=function(){return""+this.label};function n(l,c,u){for(var d in c){var p=c[d],h=l.input.getAttribute("data-"+d.toLowerCase());typeof p=="number"?l[d]=parseInt(h):p===!1?l[d]=h!==null:p instanceof Function?l[d]=null:l[d]=h,!l[d]&&l[d]!==0&&(l[d]=d in u?u[d]:p)}}var r=Array.prototype.slice;function a(l,c){return typeof l=="string"?(c||document).querySelector(l):l||null}function s(l,c){return r.call((c||document).querySelectorAll(l))}a.create=function(l,c){var u=document.createElement(l);for(var d in c){var p=c[d];if(d==="inside")a(p).appendChild(u);else if(d==="around"){var h=a(p);h.parentNode.insertBefore(u,h),u.appendChild(h),h.getAttribute("autofocus")!=null&&h.focus()}else d in u?u[d]=p:u.setAttribute(d,p)}return u},a.bind=function(l,c){if(l)for(var u in c){var d=c[u];u.split(/\s+/).forEach(function(p){l.addEventListener(p,d)})}},a.unbind=function(l,c){if(l)for(var u in c){var d=c[u];u.split(/\s+/).forEach(function(p){l.removeEventListener(p,d)})}},a.fire=function(l,c,u){var d=document.createEvent("HTMLEvents");d.initEvent(c,!0,!0);for(var p in u)d[p]=u[p];return l.dispatchEvent(d)},a.regExpEscape=function(l){return l.replace(/[-\\^$*+?.()|[\]{}]/g,"\\$&")},a.siblingIndex=function(l){for(var c=0;l=l.previousElementSibling;c++);return c};function o(){s("input.awesomplete").forEach(function(l){new e(l)})}return typeof self<"u"&&(self.Awesomplete=e),typeof Document<"u"&&(document.readyState!=="loading"?o():document.addEventListener("DOMContentLoaded",o)),e.$=a,e.$$=s,t.exports&&(t.exports=e),e})()})(Rme);var fGe=Rme.exports;const mGe=eR(fGe);function gGe({list:t,element:e,callback:i,currentValue:n,withCatchTab:r,onChange:a}){var c;const s=new mGe(e,{list:t});e.parentElement.style.width="100%";let o=!1;const l=u=>{o=!0,Ot(i)&&i(u.text.value),e.value=u.text.label,s.suggestions=[]};if(r){const u=d=>d.which===9&&d.preventDefault();e.addEventListener("keydown",u,!1),e.addEventListener("keyup",u,!1)}if(typeof a=="function"&&e.addEventListener("change",a),e.setAttribute("autocomplete","off"),e.addEventListener("awesomplete-selectcomplete",u=>l(u),!1),e.addEventListener("keyup",function(u){var d;(u.which===13||u.which===9)&&!o&&((d=s.suggestions)!=null&&d.length)&&(s.next(),s.select(0)),o=!1}),n){const u=(c=t.find(d=>d.value===n))==null?void 0:c.label;u&&(e.value=u)}return{typeAhead:s}}function Mme(t,e,i,n,r){if(r){const a=e.target.value;r(a)?(n.innerHTML="",n.classList.remove("is-danger"),i.classList.remove("is-danger"),i.classList.add("is-success")):(n.innerHTML=t.error||"Invalid",i.classList.remove("is-success"),i.classList.add("is-danger"),n.classList.add("is-danger"))}}function R5(t,e){for(const i of e.options){if(i.hide)continue;const n=document.createElement("option");n.className="font-medium",i.value&&n.setAttribute("value",i.value),(i.selected||e.value===i.value)&&n.setAttribute("selected","true"),i.disabled&&n.setAttribute("disabled","true"),n.innerHTML=i.label,t.appendChild(n)}}function yD(t){var s,o;const e=document.createElement("div");if(e.className="field font-medium",t.class&&e.classList.add(t.class),t.width?e.style=`width: ${t.width}`:e.style="flex-grow: 1",t.label&&!t.checkbox){const l=document.createElement("label");l.style=t.labelStyle||"font-weight: bold; font-size: larger;",l.innerHTML=t.label,e.appendChild(l)}let i,n,r=[];const a=document.createElement("div");if(a.className="control font-medium",t.controlVisible===!1&&(a.style.display=xt),t.controlId&&(a.id=t.controlId),t.text){const l=document.createElement("div");t.id&&(l.id=t.id),l.className="content",l.innerHTML=t.text,a.appendChild(l)}else if(t.radio){const l=document.createElement("div");l.id=t.id,l.className="control";for(const c of t.options??[]){const u=document.createElement("label");u.className="radio";const d=document.createElement("input");c.field&&r.push({input:d,field:c.field}),c.id&&(d.id=c.id),d.name=t.id,d.type="radio",d.value=c.text,c.checked&&(d.checked=!0),u.appendChild(d),l.appendChild(u);const p=document.createElement("span");p.style.marginLeft=".25em",p.style.marginRight="1em",p.innerHTML=c.text,l.appendChild(p)}a.appendChild(l),i=l}else if(t.options){const l=document.createElement("div");l.className="select font-medium",l.style="width: 100%",t.zIndex&&(l.style.zIndex=t.zIndex);const c=document.createElement("select");if(t.dataPlaceholder&&c.setAttribute("data-placeholder",t.dataPlaceholder),t.dataType&&c.setAttribute("data-type",t.dataType),t.multiple&&c.setAttribute("multiple",!0),t.disabled&&(c.disabled=!0),t.id&&(l.id=t.id),c.style="width: 100%",R5(c,t),l.appendChild(c),a.appendChild(l),t.help){const u=document.createElement("p");u.className="help font-medium is-info",u.innerHTML=(s=t.help)==null?void 0:s.text,u.style.display=(o=t.help)!=null&&o.visible?"":xt,a.appendChild(u)}i=c,Ot(t.onChange)&&c.addEventListener("change",u=>t.onChange(u,t))}else if(t.checkbox){const l=document.createElement("div");l.className="flexrow nowrap",l.style.display="inline-block";const c=document.createElement("input");Ot(t.onChange)&&c.addEventListener("change",p=>t.onChange(p,t)),i=c;const u=t.intent??"is-success";c.className=`is-checkradio ${u}`,c.type="checkbox",c.id=t.id,t.checked&&(c.checked=!0),l.appendChild(c);const d=document.createElement("label");d.setAttribute("for",t.id),t.color&&(d.style.color=t.color),d.innerHTML=t.label,l.appendChild(d),a.appendChild(l)}else{const l=document.createElement("input");if(l.className="input font-medium",t.class&&l.classList.add(t.class),l.setAttribute("type",t.type||"text"),l.setAttribute("autocomplete",t.autocomplete||"off"),l.setAttribute("placeholder",t.placeholder||""),t.disabled&&l.setAttribute("disabled",!0),t.id&&l.setAttribute("id",t.id),a.appendChild(l),t.iconLeft){a.classList.add("has-icons-left");const u=document.createElement("span");u.className="icon is-small is-left font-medium";const d=document.createElement("i");d.className=t.iconLeft,u.appendChild(d),a.appendChild(u)}if(t.type==="password"){a.classList.add("has-icons-right");const u=document.createElement("span");u.className="icon is-small is-right font-medium";const d=document.createElement("i");d.className=t.iconRight,u.appendChild(d),a.appendChild(u)}i=l;const c=document.createElement("p");if(c.className="help font-medium",a.appendChild(c),t.validator&&l.addEventListener("input",u=>Mme(t,u,l,c,t.validator)),t.date){const u=t.maxNumberOfDates||1,d=!t.maxNumberOfDates||u===1;n=new Cme(i,{maxDate:t.maxDate,minDate:t.minDate,format:"yyyy-mm-dd",maxNumberOfDates:u,autohide:d})}else t.typeAhead&&gGe({...t.typeAhead,element:l});Ot(t.onKeyDown)&&l.addEventListener("keydown",u=>t.onKeyDown(u,t)),Ot(t.onChange)&&l.addEventListener("change",u=>t.onChange(u,t)),Ot(t.onInput)&&l.addEventListener("input",u=>t.onInput(u,t)),Ot(t.onKeyUp)&&l.addEventListener("keyup",u=>t.onKeyUp(u,t)),t.value!==void 0&&(l.value=t.value),t.selectOnFocus&&l.addEventListener("focus",()=>l.select())}return e.appendChild(a),t.visible===!1&&(e.style.display=xt),{field:e,inputElement:i,datepicker:n,subFields:r}}function Sr(t,e,i){const n=document.createElement("div");n.style="display: flex; width: 100%;",n.classList.add("flexcol");const r={},a={};let s;for(const o of e){if((o.text||o.html)&&!o.field){const l=o.fieldPair&&document.createElement("div");l&&(l.className="flexrow");const c=document.createElement("div");c.className="flexaligncenter",c.style=o.style||o.header&&"font-weight: bold; font-size: larger;"||"height: 2.5em; padding-right: 1em;";const u=document.createElement("div");if(o.id&&(u.id=o.id),u.className="content",u.innerHTML=o.text,c.appendChild(u),l){l.appendChild(c);const{field:d,inputElement:p,datepicker:h}=yD(o.fieldPair);h&&(r[`${o.field}.date`]=h),p&&(r[o.fieldPair.field]=p),a[o.fieldPair.field]=d,l.appendChild(d),n.appendChild(l)}else n.appendChild(c);continue}if(o.divider){const l=document.createElement("hr");l.classList.add("dropdown-divider"),n.appendChild(l);continue}if(o.spacer){const l=document.createElement("div"),c=typeof o.spacer=="number"&&`${o.spacer}em`||typeof o.spacer=="string"&&o.spacer||"1em";l.style.marginBlockEnd=c,n.appendChild(l);continue}if(!(!o.label&&!o.field||o.hide)&&o.field){const l=o.fieldPair&&document.createElement("div");l&&(l.className="flexrow");const{field:c,inputElement:u,datepicker:d,subFields:p}=yD(o);if(p&&p.forEach(h=>r[h.field]=h.input),d&&(r[`${o.field}.date`]=d),o.focus&&(s=u),r[o.field]=u,a[o.field]=c,l){l.appendChild(c);const{field:h,inputElement:f,datepicker:m}=yD(o.fieldPair);m&&(r[`${o.field}.date`]=m),f&&(r[o.fieldPair.field]=f),a[o.fieldPair.field]=h,l.appendChild(h),n.appendChild(l)}else n.appendChild(c)}}if(s&&setTimeout(()=>s.focus(),200),t.appendChild(n),i!=null&&i.length)for(const o of i){if(o.dateRange&&Array.isArray(o.fields)){const[l,c]=o.fields;if(r[l]&&r[c]){const u=new hGe(r[l],{inputs:[r[l],r[c]],minDate:o.minDate,maxDate:o.maxDate,format:"yyyy-mm-dd",autohide:!0});r[`${l}.date`]=u}}o.control&&(Ot(o.onChange)&&r[o.control].addEventListener("change",l=>o.onChange({e:l,inputs:r,fields:a})),Ot(o.onInput)&&r[o.control]&&r[o.control].addEventListener("input",l=>o.onInput({e:l,inputs:r,fields:a})),Ot(o.onFocusOut)&&r[o.control]&&r[o.control].addEventListener("focusout",l=>o.onFocusOut({e:l,inputs:r,fields:a})))}return r}var CX,ea="colors",Nc="sizes",vi="space",vGe={gap:vi,gridGap:vi,columnGap:vi,gridColumnGap:vi,rowGap:vi,gridRowGap:vi,inset:vi,insetBlock:vi,insetBlockEnd:vi,insetBlockStart:vi,insetInline:vi,insetInlineEnd:vi,insetInlineStart:vi,margin:vi,marginTop:vi,marginRight:vi,marginBottom:vi,marginLeft:vi,marginBlock:vi,marginBlockEnd:vi,marginBlockStart:vi,marginInline:vi,marginInlineEnd:vi,marginInlineStart:vi,padding:vi,paddingTop:vi,paddingRight:vi,paddingBottom:vi,paddingLeft:vi,paddingBlock:vi,paddingBlockEnd:vi,paddingBlockStart:vi,paddingInline:vi,paddingInlineEnd:vi,paddingInlineStart:vi,top:vi,right:vi,bottom:vi,left:vi,scrollMargin:vi,scrollMarginTop:vi,scrollMarginRight:vi,scrollMarginBottom:vi,scrollMarginLeft:vi,scrollMarginX:vi,scrollMarginY:vi,scrollMarginBlock:vi,scrollMarginBlockEnd:vi,scrollMarginBlockStart:vi,scrollMarginInline:vi,scrollMarginInlineEnd:vi,scrollMarginInlineStart:vi,scrollPadding:vi,scrollPaddingTop:vi,scrollPaddingRight:vi,scrollPaddingBottom:vi,scrollPaddingLeft:vi,scrollPaddingX:vi,scrollPaddingY:vi,scrollPaddingBlock:vi,scrollPaddingBlockEnd:vi,scrollPaddingBlockStart:vi,scrollPaddingInline:vi,scrollPaddingInlineEnd:vi,scrollPaddingInlineStart:vi,fontSize:"fontSizes",background:ea,backgroundColor:ea,backgroundImage:ea,borderImage:ea,border:ea,borderBlock:ea,borderBlockEnd:ea,borderBlockStart:ea,borderBottom:ea,borderBottomColor:ea,borderColor:ea,borderInline:ea,borderInlineEnd:ea,borderInlineStart:ea,borderLeft:ea,borderLeftColor:ea,borderRight:ea,borderRightColor:ea,borderTop:ea,borderTopColor:ea,caretColor:ea,color:ea,columnRuleColor:ea,fill:ea,outline:ea,outlineColor:ea,stroke:ea,textDecorationColor:ea,fontFamily:"fonts",fontWeight:"fontWeights",lineHeight:"lineHeights",letterSpacing:"letterSpacings",blockSize:Nc,minBlockSize:Nc,maxBlockSize:Nc,inlineSize:Nc,minInlineSize:Nc,maxInlineSize:Nc,width:Nc,minWidth:Nc,maxWidth:Nc,height:Nc,minHeight:Nc,maxHeight:Nc,flexBasis:Nc,gridTemplateColumns:Nc,gridTemplateRows:Nc,borderWidth:"borderWidths",borderTopWidth:"borderWidths",borderRightWidth:"borderWidths",borderBottomWidth:"borderWidths",borderLeftWidth:"borderWidths",borderStyle:"borderStyles",borderTopStyle:"borderStyles",borderRightStyle:"borderStyles",borderBottomStyle:"borderStyles",borderLeftStyle:"borderStyles",borderRadius:"radii",borderTopLeftRadius:"radii",borderTopRightRadius:"radii",borderBottomRightRadius:"radii",borderBottomLeftRadius:"radii",boxShadow:"shadows",textShadow:"shadows",transition:"transitions",zIndex:"zIndices"},yGe=(t,e)=>typeof e=="function"?{"()":Function.prototype.toString.call(e)}:e,tR=()=>{const t=Object.create(null);return(e,i,...n)=>{const r=(a=>JSON.stringify(a,yGe))(e);return r in t?t[r]:t[r]=i(e,...n)}},JN=Symbol.for("sxs.internal"),M5=(t,e)=>Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)),RX=t=>{for(const e in t)return!0;return!1},{hasOwnProperty:bGe}=Object.prototype,Cj=t=>t.includes("-")?t:t.replace(/[A-Z]/g,e=>"-"+e.toLowerCase()),IGe=/\s+(?![^()]*\))/,S0=t=>e=>t(...typeof e=="string"?String(e).split(IGe):[e]),MX={appearance:t=>({WebkitAppearance:t,appearance:t}),backfaceVisibility:t=>({WebkitBackfaceVisibility:t,backfaceVisibility:t}),backdropFilter:t=>({WebkitBackdropFilter:t,backdropFilter:t}),backgroundClip:t=>({WebkitBackgroundClip:t,backgroundClip:t}),boxDecorationBreak:t=>({WebkitBoxDecorationBreak:t,boxDecorationBreak:t}),clipPath:t=>({WebkitClipPath:t,clipPath:t}),content:t=>({content:t.includes('"')||t.includes("'")||/^([A-Za-z]+\([^]*|[^]*-quote|inherit|initial|none|normal|revert|unset)$/.test(t)?t:`"${t}"`}),hyphens:t=>({WebkitHyphens:t,hyphens:t}),maskImage:t=>({WebkitMaskImage:t,maskImage:t}),maskSize:t=>({WebkitMaskSize:t,maskSize:t}),tabSize:t=>({MozTabSize:t,tabSize:t}),textSizeAdjust:t=>({WebkitTextSizeAdjust:t,textSizeAdjust:t}),userSelect:t=>({WebkitUserSelect:t,userSelect:t}),marginBlock:S0((t,e)=>({marginBlockStart:t,marginBlockEnd:e||t})),marginInline:S0((t,e)=>({marginInlineStart:t,marginInlineEnd:e||t})),maxSize:S0((t,e)=>({maxBlockSize:t,maxInlineSize:e||t})),minSize:S0((t,e)=>({minBlockSize:t,minInlineSize:e||t})),paddingBlock:S0((t,e)=>({paddingBlockStart:t,paddingBlockEnd:e||t})),paddingInline:S0((t,e)=>({paddingInlineStart:t,paddingInlineEnd:e||t}))},B$=/([\d.]+)([^]*)/,wGe=(t,e)=>t.length?t.reduce((i,n)=>(i.push(...e.map(r=>r.includes("&")?r.replace(/&/g,/[ +>|~]/.test(n)&&/&.*&/.test(r)?`:is(${n})`:n):n+" "+r)),i),[]):e,SGe=(t,e)=>t in TGe&&typeof e=="string"?e.replace(/^((?:[^]*[^\w-])?)(fit-content|stretch)((?:[^\w-][^]*)?)$/,(i,n,r,a)=>n+(r==="stretch"?`-moz-available${a};${Cj(t)}:${n}-webkit-fill-available`:`-moz-fit-content${a};${Cj(t)}:${n}fit-content`)+a):String(e),TGe={blockSize:1,height:1,inlineSize:1,maxBlockSize:1,maxHeight:1,maxInlineSize:1,maxWidth:1,minBlockSize:1,minHeight:1,minInlineSize:1,minWidth:1,width:1},yg=t=>t?t+"-":"",Nme=(t,e,i)=>t.replace(/([+-])?((?:\d+(?:\.\d*)?|\.\d+)(?:[Ee][+-]?\d+)?)?(\$|--)([$\w-]+)/g,(n,r,a,s,o)=>s=="$"==!!a?n:(r||s=="--"?"calc(":"")+"var(--"+(s==="$"?yg(e)+(o.includes("$")?"":yg(i))+o.replace(/\$/g,"-"):o)+")"+(r||s=="--"?"*"+(r||"")+(a||"1")+")":"")),UGe=/\s*,\s*(?![^()]*\))/,DGe=Object.prototype.toString,tS=(t,e,i,n,r)=>{let a,s,o;const l=(c,u,d)=>{let p,h;const f=m=>{for(p in m){const y=p.charCodeAt(0)===64,b=y&&Array.isArray(m[p])?m[p]:[m[p]];for(h of b){const I=/[A-Z]/.test(v=p)?v:v.replace(/-[^]/g,w=>w[1].toUpperCase()),T=typeof h=="object"&&h&&h.toString===DGe&&(!n.utils[I]||!u.length);if(I in n.utils&&!T){const w=n.utils[I];if(w!==s){s=w,f(w(h)),s=null;continue}}else if(I in MX){const w=MX[I];if(w!==o){o=w,f(w(h)),o=null;continue}}if(y&&(g=p.slice(1)in n.media?"@media "+n.media[p.slice(1)]:p,p=g.replace(/\(\s*([\w-]+)\s*(=|<|<=|>|>=)\s*([\w-]+)\s*(?:(<|<=|>|>=)\s*([\w-]+)\s*)?\)/g,(w,S,U,P,E,R)=>{const C=B$.test(S),M=.0625*(C?-1:1),[_,A]=C?[P,S]:[S,P];return"("+(U[0]==="="?"":U[0]===">"===C?"max-":"min-")+_+":"+(U[0]!=="="&&U.length===1?A.replace(B$,(N,k,O)=>Number(k)+M*(U===">"?1:-1)+O):A)+(E?") and ("+(E[0]===">"?"min-":"max-")+_+":"+(E.length===1?R.replace(B$,(N,k,O)=>Number(k)+M*(E===">"?-1:1)+O):R):"")+")"})),T){const w=y?d.concat(p):[...d],S=y?[...u]:wGe(u,p.split(UGe));a!==void 0&&r(NX(...a)),a=void 0,l(h,S,w)}else a===void 0&&(a=[[],u,d]),p=y||p.charCodeAt(0)!==36?p:`--${yg(n.prefix)}${p.slice(1).replace(/\$/g,"-")}`,h=T?h:typeof h=="number"?h&&I in EGe?String(h)+"px":String(h):Nme(SGe(I,h??""),n.prefix,n.themeMap[I]),a[0].push(`${y?`${p} `:`${Cj(p)}:`}${h}`)}}var g,v};f(c),a!==void 0&&r(NX(...a)),a=void 0};l(t,e,i)},NX=(t,e,i)=>`${i.map(n=>`${n}{`).join("")}${e.length?`${e.join(",")}{`:""}${t.join(";")}${e.length?"}":""}${Array(i.length?i.length+1:0).join("}")}`,EGe={animationDelay:1,animationDuration:1,backgroundSize:1,blockSize:1,border:1,borderBlock:1,borderBlockEnd:1,borderBlockEndWidth:1,borderBlockStart:1,borderBlockStartWidth:1,borderBlockWidth:1,borderBottom:1,borderBottomLeftRadius:1,borderBottomRightRadius:1,borderBottomWidth:1,borderEndEndRadius:1,borderEndStartRadius:1,borderInlineEnd:1,borderInlineEndWidth:1,borderInlineStart:1,borderInlineStartWidth:1,borderInlineWidth:1,borderLeft:1,borderLeftWidth:1,borderRadius:1,borderRight:1,borderRightWidth:1,borderSpacing:1,borderStartEndRadius:1,borderStartStartRadius:1,borderTop:1,borderTopLeftRadius:1,borderTopRightRadius:1,borderTopWidth:1,borderWidth:1,bottom:1,columnGap:1,columnRule:1,columnRuleWidth:1,columnWidth:1,containIntrinsicSize:1,flexBasis:1,fontSize:1,gap:1,gridAutoColumns:1,gridAutoRows:1,gridTemplateColumns:1,gridTemplateRows:1,height:1,inlineSize:1,inset:1,insetBlock:1,insetBlockEnd:1,insetBlockStart:1,insetInline:1,insetInlineEnd:1,insetInlineStart:1,left:1,letterSpacing:1,margin:1,marginBlock:1,marginBlockEnd:1,marginBlockStart:1,marginBottom:1,marginInline:1,marginInlineEnd:1,marginInlineStart:1,marginLeft:1,marginRight:1,marginTop:1,maxBlockSize:1,maxHeight:1,maxInlineSize:1,maxWidth:1,minBlockSize:1,minHeight:1,minInlineSize:1,minWidth:1,offsetDistance:1,offsetRotate:1,outline:1,outlineOffset:1,outlineWidth:1,overflowClipMargin:1,padding:1,paddingBlock:1,paddingBlockEnd:1,paddingBlockStart:1,paddingBottom:1,paddingInline:1,paddingInlineEnd:1,paddingInlineStart:1,paddingLeft:1,paddingRight:1,paddingTop:1,perspective:1,right:1,rowGap:1,scrollMargin:1,scrollMarginBlock:1,scrollMarginBlockEnd:1,scrollMarginBlockStart:1,scrollMarginBottom:1,scrollMarginInline:1,scrollMarginInlineEnd:1,scrollMarginInlineStart:1,scrollMarginLeft:1,scrollMarginRight:1,scrollMarginTop:1,scrollPadding:1,scrollPaddingBlock:1,scrollPaddingBlockEnd:1,scrollPaddingBlockStart:1,scrollPaddingBottom:1,scrollPaddingInline:1,scrollPaddingInlineEnd:1,scrollPaddingInlineStart:1,scrollPaddingLeft:1,scrollPaddingRight:1,scrollPaddingTop:1,shapeMargin:1,textDecoration:1,textDecorationThickness:1,textIndent:1,textUnderlineOffset:1,top:1,transitionDelay:1,transitionDuration:1,verticalAlign:1,width:1,wordSpacing:1},AX=t=>String.fromCharCode(t+(t>25?39:97)),qb=t=>(e=>{let i,n="";for(i=Math.abs(e);i>52;i=i/52|0)n=AX(i%52)+n;return AX(i%52)+n})(((e,i)=>{let n=i.length;for(;n;)e=33*e^i.charCodeAt(--n);return e})(5381,JSON.stringify(t))>>>0),q1=["themed","global","styled","onevar","resonevar","allvar","inline"],PGe=t=>{if(t.href&&!t.href.startsWith(location.origin))return!1;try{return!!t.cssRules}catch{return!1}},CGe=t=>{let e;const i=()=>{const{cssRules:r}=e.sheet;return[].map.call(r,(a,s)=>{const{cssText:o}=a;let l="";if(o.startsWith("--sxs"))return"";if(r[s-1]&&(l=r[s-1].cssText).startsWith("--sxs")){if(!a.cssRules.length)return"";for(const c in e.rules)if(e.rules[c].group===a)return`--sxs{--sxs:${[...e.rules[c].cache].join(" ")}}${o}`;return a.cssRules.length?`${l}${o}`:""}return o}).join("")},n=()=>{if(e){const{rules:o,sheet:l}=e;if(!l.deleteRule){for(;Object(Object(l.cssRules)[0]).type===3;)l.cssRules.splice(0,1);l.cssRules=[]}for(const c in o)delete o[c]}const r=Object(t).styleSheets||[];for(const o of r)if(PGe(o)){for(let l=0,c=o.cssRules;c[l];++l){const u=Object(c[l]);if(u.type!==1)continue;const d=Object(c[l+1]);if(d.type!==4)continue;++l;const{cssText:p}=u;if(!p.startsWith("--sxs"))continue;const h=p.slice(14,-3).trim().split(/\s+/),f=q1[h[0]];f&&(e||(e={sheet:o,reset:n,rules:{},toString:i}),e.rules[f]={group:d,index:l,cache:new Set(h)})}if(e)break}if(!e){const o=(l,c)=>({type:c,cssRules:[],insertRule(u,d){this.cssRules.splice(d,0,o(u,{import:3,undefined:1}[(u.toLowerCase().match(/^@([a-z]+)/)||[])[1]]||4))},get cssText(){return l==="@media{}"?`@media{${[].map.call(this.cssRules,u=>u.cssText).join("")}}`:l}});e={sheet:t?(t.head||t).appendChild(document.createElement("style")).sheet:o("","text/css"),rules:{},reset:n,toString:i}}const{sheet:a,rules:s}=e;for(let o=q1.length-1;o>=0;--o){const l=q1[o];if(!s[l]){const c=q1[o+1],u=s[c]?s[c].index:a.cssRules.length;a.insertRule("@media{}",u),a.insertRule(`--sxs{--sxs:${o}}`,u),s[l]={group:a.cssRules[u+1],index:u,cache:new Set([o])}}RGe(s[l])}};return n(),e},RGe=t=>{const e=t.group;let i=e.cssRules.length;t.apply=n=>{try{e.insertRule(n,i),++i}catch{}}},C1=Symbol(),MGe=tR(),NGe=(t,e)=>MGe(t,()=>(...i)=>{let n={type:null,composers:new Set};for(const r of i)if(r!=null)if(r[JN]){n.type==null&&(n.type=r[JN].type);for(const a of r[JN].composers)n.composers.add(a)}else r.constructor!==Object||r.$$typeof?n.type==null&&(n.type=r):n.composers.add(AGe(r,t));return n.type==null&&(n.type="span"),n.composers.size||n.composers.add(["PJLV",{},[],[],{},[]]),_Ge(t,n,e)}),AGe=({variants:t,compoundVariants:e,defaultVariants:i,...n},r)=>{const a=`${yg(r.prefix)}c-${qb(n)}`,s=[],o=[],l=Object.create(null),c=[];for(const p in i)l[p]=String(i[p]);if(typeof t=="object"&&t)for(const p in t){u=l,d=p,bGe.call(u,d)||(l[p]="undefined");const h=t[p];for(const f in h){const m={[p]:String(f)};String(f)==="undefined"&&c.push(p);const g=h[f],v=[m,g,!RX(g)];s.push(v)}}var u,d;if(typeof e=="object"&&e)for(const p of e){let{css:h,...f}=p;h=typeof h=="object"&&h||{};for(const g in f)f[g]=String(f[g]);const m=[f,h,!RX(h)];o.push(m)}return[a,n,s,o,l,c]},_Ge=(t,e,i)=>{const[n,r,a,s]=kGe(e.composers),o=typeof e.type=="function"||e.type.$$typeof?(d=>{function p(){for(let h=0;h<p[C1].length;h++){const[f,m]=p[C1][h];d.rules[f].apply(m)}return p[C1]=[],null}return p[C1]=[],p.rules={},q1.forEach(h=>p.rules[h]={apply:f=>p[C1].push([h,f])}),p})(i):null,l=(o||i).rules,c=`.${n}${r.length>1?`:where(.${r.slice(1).join(".")})`:""}`,u=d=>{d=typeof d=="object"&&d||xGe;const{css:p,...h}=d,f={};for(const v in a)if(delete h[v],v in d){let y=d[v];typeof y=="object"&&y?f[v]={"@initial":a[v],...y}:(y=String(y),f[v]=y!=="undefined"||s.has(v)?y:a[v])}else f[v]=a[v];const m=new Set([...r]);for(const[v,y,b,I]of e.composers){i.rules.styled.cache.has(v)||(i.rules.styled.cache.add(v),tS(y,[`.${v}`],[],t,S=>{l.styled.apply(S)}));const T=_X(b,f,t.media),w=_X(I,f,t.media,!0);for(const S of T)if(S!==void 0)for(const[U,P,E]of S){const R=`${v}-${qb(P)}-${U}`;m.add(R);const C=(E?i.rules.resonevar:i.rules.onevar).cache,M=E?l.resonevar:l.onevar;C.has(R)||(C.add(R),tS(P,[`.${R}`],[],t,_=>{M.apply(_)}))}for(const S of w)if(S!==void 0)for(const[U,P]of S){const E=`${v}-${qb(P)}-${U}`;m.add(E),i.rules.allvar.cache.has(E)||(i.rules.allvar.cache.add(E),tS(P,[`.${E}`],[],t,R=>{l.allvar.apply(R)}))}}if(typeof p=="object"&&p){const v=`${n}-i${qb(p)}-css`;m.add(v),i.rules.inline.cache.has(v)||(i.rules.inline.cache.add(v),tS(p,[`.${v}`],[],t,y=>{l.inline.apply(y)}))}for(const v of String(d.className||"").trim().split(/\s+/))v&&m.add(v);const g=h.className=[...m].join(" ");return{type:e.type,className:g,selector:c,props:h,toString:()=>g,deferredInjector:o}};return M5(u,{className:n,selector:c,[JN]:e,toString:()=>(i.rules.styled.cache.has(n)||u(),n)})},kGe=t=>{let e="";const i=[],n={},r=[];for(const[a,,,,s,o]of t){e===""&&(e=a),i.push(a),r.push(...o);for(const l in s){const c=s[l];(n[l]===void 0||c!=="undefined"||o.includes(c))&&(n[l]=c)}}return[e,i,n,new Set(r)]},_X=(t,e,i,n)=>{const r=[];e:for(let[a,s,o]of t){if(o)continue;let l,c=0,u=!1;for(l in a){const d=a[l];let p=e[l];if(p!==d){if(typeof p!="object"||!p)continue e;{let h,f,m=0;for(const g in p){if(d===String(p[g])){if(g!=="@initial"){const v=g.slice(1);(f=f||[]).push(v in i?i[v]:g.replace(/^@media ?/,"")),u=!0}c+=m,h=!0}++m}if(f&&f.length&&(s={["@media "+f.join(", ")]:s}),!h)continue e}}}(r[c]=r[c]||[]).push([n?"cv":`${l}-${a[l]}`,s,u])}return r},xGe={},OGe=tR(),LGe=(t,e)=>OGe(t,()=>(...i)=>{const n=()=>{for(let r of i){r=typeof r=="object"&&r||{};let a=qb(r);if(!e.rules.global.cache.has(a)){if(e.rules.global.cache.add(a),"@import"in r){let s=[].indexOf.call(e.sheet.cssRules,e.rules.themed.group)-1;for(let o of[].concat(r["@import"]))o=o.includes('"')||o.includes("'")?o:`"${o}"`,e.sheet.insertRule(`@import ${o};`,s++);delete r["@import"]}tS(r,[],[],t,s=>{e.rules.global.apply(s)})}}return""};return M5(n,{toString:n})}),FGe=tR(),$Ge=(t,e)=>FGe(t,()=>i=>{const n=`${yg(t.prefix)}k-${qb(i)}`,r=()=>{if(!e.rules.global.cache.has(n)){e.rules.global.cache.add(n);const a=[];tS(i,[],[],t,o=>a.push(o));const s=`@keyframes ${n}{${a.join("")}}`;e.rules.global.apply(s)}return n};return M5(r,{get name(){return r()},toString:r})}),BGe=class{constructor(t,e,i,n){this.token=t==null?"":String(t),this.value=e==null?"":String(e),this.scale=i==null?"":String(i),this.prefix=n==null?"":String(n)}get computedValue(){return"var("+this.variable+")"}get variable(){return"--"+yg(this.prefix)+yg(this.scale)+this.token}toString(){return this.computedValue}},VGe=tR(),jGe=(t,e)=>VGe(t,()=>(i,n)=>{n=typeof i=="object"&&i||Object(n);const r=`.${i=(i=typeof i=="string"?i:"")||`${yg(t.prefix)}t-${qb(n)}`}`,a={},s=[];for(const l in n){a[l]={};for(const c in n[l]){const u=`--${yg(t.prefix)}${l}-${c}`,d=Nme(String(n[l][c]),t.prefix,l);a[l][c]=new BGe(c,d,l,t.prefix),s.push(`${u}:${d}`)}}const o=()=>{if(s.length&&!e.rules.themed.cache.has(i)){e.rules.themed.cache.add(i);const l=`${n===t.theme?":root,":""}.${i}{${s.join(";")}}`;e.rules.themed.apply(l)}return i};return{...a,get className(){return o()},selector:r,toString:o}}),GGe=tR(),Ame=t=>{let e=!1;const i=GGe(t,n=>{e=!0;const r="prefix"in(n=typeof n=="object"&&n||{})?String(n.prefix):"",a=typeof n.media=="object"&&n.media||{},s=typeof n.root=="object"?n.root||null:globalThis.document||null,o=typeof n.theme=="object"&&n.theme||{},l={prefix:r,media:a,theme:o,themeMap:typeof n.themeMap=="object"&&n.themeMap||{...vGe},utils:typeof n.utils=="object"&&n.utils||{}},c=CGe(s),u={css:NGe(l,c),globalCss:LGe(l,c),keyframes:$Ge(l,c),createTheme:jGe(l,c),reset(){c.reset(),u.theme.toString()},theme:{},sheet:c,config:l,prefix:r,getCssText:c.toString,toString:c.toString};return String(u.theme=u.createTheme(o)),u});return e||i.reset(),i},HGe=()=>CX||(CX=Ame()),Tn=(...t)=>HGe().css(...t);function zGe({variant:t}){return Tn({margin:"2.5px 0",variants:{variant:{showAddress:{lineHeight:"2.3em"}}}})({variant:t})}const qGe=Tn({justifyContent:"flex-start",alignItems:"center",whiteSpace:"nowrap",fontWeight:500,display:"flex"}),WGe=Tn({textTransform:"$participant$textTransform",fontSize:"0.875rem",fontWeight:500,variants:{variant:{winner:{fontWeight:700,color:"$winnerName"},loser:{fontWeight:500}}}}),YGe=Tn({"&::WebkitScrollbar":{display:"none"},justifyContent:"space-between",flexDirection:"column",marginInlineEnd:"0rem",scrollbarWidth:"none",overflowX:"scroll",fontWeight:500,display:"flex",width:"100%",variants:{variant:{doubles:{marginTop:"0.25rem",fontSize:"0.75rem",lineHeight:"1rem"}}}});function KGe({drawPosition:t,sideNumber:e}){return Tn({minHeight:"$participant$minHeight",justifyContent:"space-between",paddingInlineStart:"0.75rem",backgroundColor:"$matchUp",paddingInlineEnd:"0rem",boxSizing:"border-box",paddingBottom:".2rem",position:"relative",alignItems:"center",paddingTop:".2rem",minWidth:"15rem",cursor:"pointer",display:"flex",flexGrow:1,"& p":{fontFamily:"Sharp Sans, Arial, sans-serif",color:"$color"},variants:{sideNumber:{1:{borderBottom:"1px solid $internalDividers"}}}})({sideNumber:e,css:t&&{"&:before":{backgroundColor:"$backgroundColor",content:`${t}`,justifyContent:"center",alignContent:"center",insetInlineStart:-10,position:"absolute",color:"#55AFFE",display:"flex",width:20}}})}function ZGe({winnerChevron:t,isDoubles:e}){const i=(e?.4:.3)*2;return Tn({variants:{variant:{winner:{"&::before":{borderTop:`${i}rem solid transparent`,borderBottom:`${i}rem solid transparent`,borderInlineStart:"8px solid #008f70",position:"absolute",insetInlineStart:0,display:"block",content:""}}}}})({variant:t?"winner":void 0})}const N5=Tn({fontSize:"smaller",color:"gray"});var XGe=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function _me(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var kme={exports:{}};/*!
	Copyright (c) 2018 Jed Watson.
	Licensed under the MIT License (MIT), see
	http://jedwatson.github.io/classnames
*/(function(t){(function(){var e={}.hasOwnProperty;function i(){for(var a="",s=0;s<arguments.length;s++){var o=arguments[s];o&&(a=r(a,n(o)))}return a}function n(a){if(typeof a=="string"||typeof a=="number")return a;if(typeof a!="object")return"";if(Array.isArray(a))return i.apply(null,a);if(a.toString!==Object.prototype.toString&&!a.toString.toString().includes("[native code]"))return a.toString();var s="";for(var o in a)e.call(a,o)&&a[o]&&(s=r(s,o));return s}function r(a,s){return s?a?a+" "+s:a+s:a}t.exports?(i.default=i,t.exports=i):window.classNames=i})()})(kme);var JGe=kme.exports;const qy=_me(JGe);function QGe({individualParticipant:t,className:e}){var i,n;const{city:r,state:a,countryCode:s}=((n=(i=t==null?void 0:t.person)==null?void 0:i.addresses)==null?void 0:n[0])||{},o=[r,a,s].filter(Boolean).join(", ")||" ",l=document.createElement("div");return l.className=qy(N5(),e),l.innerHTML=o,l}const eHe=Tn({willChange:"opacity",position:"fixed",zIndex:9998,bottom:0,right:0,left:0,top:0}),tHe=Tn({display:"block"}),iHe=Tn({position:"fixed",right:0,left:0}),nHe=Tn({paddingRight:"15px",alignItems:"center",margin:"30px auto",paddingLeft:"15px",position:"fixed",height:"100vh",display:"flex",width:"100%",zIndex:9999,bottom:0,right:0,left:0,top:0}),rHe=Tn({boxShadow:"0 3px 6px rgba(0, 0, 0, 0.16), 0 3px 6px rgba(0, 0, 0, 0.23)",backgroundColor:"white",position:"relative",borderRadius:"3px",minHeight:"auto",width:"100%"}),aHe=Tn({borderBottom:"1px solid rgba(0, 0, 0, 0.1)",alignItems:"center",position:"relative",display:"flex"}),sHe=Tn({fontWeight:"600",fontSize:"20px"}),kX=Tn({borderTop:"1px solid rgba(0, 0, 0, 0.1)",justifyContent:"right",alignItems:"center",position:"relative",display:"flex"}),xX="Nothing to see here";function Id(t){return typeof t=="function"}function QN(t){return typeof t=="string"}function OX(t){return Array.isArray(t)}function V$(t){return typeof t=="object"&&!Array.isArray(t)}function oHe(t){if(t)for(;t.firstChild;)t.removeChild(t.firstChild)}const A_=(()=>{const t=iHe(),e={},i=".5";let n=[],r,a=[],s=[],o;const l=m=>{{const g=s.pop();g&&document.body.removeChild(g)}},c=()=>{o&&(o.style.opacity=0,o.style.display="none")},u=m=>{const g=s.length;if(m&&e[g]===!1)return;const v=a.pop(),y=n.pop();Id(v)&&v({content:y}),document.body.classList.remove(t),document.body.style.top=null,window.scrollTo({top:r,behavior:"instant"}),c(),l()},d=()=>{o=document.createElement("div"),o.className=eHe(),o.id="cmdl-backdrop",o.onclick=()=>u(!0),document.body.appendChild(o)},p=({config:m})=>{r=window.scrollY,document.body.classList.add(t),document.body.style.top=`-${r}px`,o||d(),o.style.display="",(m==null?void 0:m.backdrop)!==!1&&(o.style.backgroundColor="rgba(0, 0, 0, 0.2)",o.style.transition="opacity 0.15s linear",o.style.opacity=1)},h=({config:m,attr:g,attrs:v,unit:y="em",value:b})=>{var I;let T;return QN(g)?T=Rj({element:m,attr:g}):OX(v)&&(T=(I=v.map(w=>Rj({element:m,attr:w})).filter(Boolean))==null?void 0:I[0]),T!==void 0&&(b=T),isNaN(b)?b:`${b}${y}`},f=({buttons:m,config:g,modalNumber:v})=>{var y,b;const I=document.createElement("div");I.className=kX(),I.style.padding=h({config:g,attrs:["footer.padding","padding"],value:i});const T={label:((y=g==null?void 0:g.dictionary)==null?void 0:y.close)||"Close",onClick:A_.close,intent:"is-info"};for(const w of m){if(w.hide)continue;const S={...T};V$(w)&&Object.assign(S,w);const U=document.createElement("button");S.disabled!==void 0&&(U.disabled=S.disabled),S.id&&(U.id=S.id),U.className=((b=S==null?void 0:S.footer)==null?void 0:b.className)||"button font-medium",U.classList.add(S.intent),U.style="margin-right: .5em;",U.innerHTML=S.label||S.text,U.onclick=P=>{P.stopPropagation(),Id(S.onClick)&&S.onClick({e:P,content:n[v]}),S.close!==!1&&(Id(S.close)&&S.close(),A_.close())},I.appendChild(U)}return I};return{close:u,open:({title:m="",content:g,buttons:v,footer:y,config:b,onClose:I}={})=>{p({config:b}),a.push(I);const T=s.length+1;e[T]=b==null?void 0:b.clickAway;const w=document.createElement("section"),S=`cmdl-${T}`;w.className=tHe(),w.role="dialog",w.tabIndex=-1,w.id=S;const U=document.createElement("div");U.className=nHe(),U.style.maxWidth=`${(b==null?void 0:b.maxWidth)||450}px`,U.onclick=()=>u(!0);const P=document.createElement("div");P.className=rHe(),P.onclick=O=>O.stopPropagation();const E=document.createElement("div"),R=document.createElement("div");E.appendChild(R),P.appendChild(E);const C=({title:O,config:$})=>{E.className=O?aHe():"",E.style.padding=h({config:$,attrs:["title.padding","padding"],value:i}),R.className=O?sHe():"",R.innerHTML=O};m&&C({title:m});const M=document.createElement("div");P.appendChild(M);const _=({content:O,config:$})=>{M.style.fontSize=h({config:$,attr:"fontSize",value:"15px"}),M.style.position="relative",M.style.padding=h({config:$,attrs:["content.padding","padding"],value:i}),Id(O)?n[T]=O(M):V$(O)?M.appendChild(O):QN(O)?M.innerHTML=O:M.innerHTML=xX};if(_({content:g,config:b}),OX(v))y=f({buttons:v,config:b,modalNumber:T}),P.appendChild(y);else if(y){const O=document.createElement("div");O.className=kX(),O.style.padding=h({config:b,attrs:["footer.padding","padding"]}),V$(y)?O.appendChild(y):QN(y)?O.innerHTML=y:O.innerHTML=xX,P.appendChild(O)}U.appendChild(P),w.appendChild(U),document.body.appendChild(w),s.push(w);const A=({content:O,config:$})=>{n[T]=void 0,oHe(M),_({content:O,config:$})},N=({buttons:O,config:$})=>{P.removeChild(y),y=f({buttons:O,config:$,modalNumber:T}),P.appendChild(y)},k=({onClose:O})=>{a.length=0,a.push(O)};return{setContent:A,setButtons:N,update:({content:O,buttons:$,title:F,config:V,onClose:j})=>{b=V||b,O&&A({content:O,config:b}),$&&N({buttons:$,config:b}),j&&k({onClose:j}),F&&C({title:F,config:b})}}}}})();function Rj({element:t,attr:e}){if(!QN(e))return;const i=e.split(".");for(const n of i)if(t=t==null?void 0:t[n],!t)return;return t}function lHe({individualParticipant:t,attribute:e,className:i}){const n=t==null?void 0:t.person,r=Rj({element:n,attr:e});if(!r)return;const a=document.createElement("div");return a.className=qy(N5(),i),a.innerHTML=r,a}function cHe({individualParticipant:t,className:e}){var i;const n=(i=t==null?void 0:t.teams)==null?void 0:i[0],r=(n==null?void 0:n.participantName)||" ",a=document.createElement("div");return a.className=qy(N5(),e),a.classList.add("tmx-tm"),a.setAttribute("id",n==null?void 0:n.participantId),a.innerHTML=r,a}function uHe(t){var e,i,n,r;const a=(i=(e=t==null?void 0:t.composition)==null?void 0:e.configuration)==null?void 0:i.participantDetail;if(a==="TEAM")return cHe(t);if(((r=(n=t==null?void 0:t.composition)==null?void 0:n.configuration)==null?void 0:r.showAddress)??a==="ADDRESS")return QGe(t);if(a){const s=lHe({...t,attribute:a});if(s)return s}return document.createElement("div")}const dHe=Tn({color:"$participant$seed",marginInlineStart:".5rem",textTransform:"uppercase",fontSize:"0.75rem",lineHeight:"1rem"});function pHe({className:t,composition:e,side:i}){const n=(i==null?void 0:i.seedValue)==="~"?"":(i==null?void 0:i.seedValue)!==void 0&&i.seedValue||(i==null?void 0:i.seedNumber);if(!n)return"";const r=(e==null?void 0:e.configuration)||{},{bracketedSeeds:a}=r,s=typeof a=="boolean"&&["(",")"]||a==="square"&&["[","]"]||["",""],o=`${s[0]}${n}${s[1]}`,l=r.seedingElement==="sup"?"sup":"span",c=document.createElement(l);return c.className=t,c.innerHTML=o,c}const hHe=Tn({WebkitBoxSizing:"border-box",marginInlineEnd:".5em",boxSizing:"border-box",display:"inline-block",position:"relative",fontSize:"smaller",fontWeight:"bold",borderRadius:2,color:"blue",variants:{color:{green:{color:"green"},red:{color:"red"}}}});function fHe({individualParticipant:t,composition:e,className:i,matchUp:n,spacer:r}){var a,s,o,l,c,u,d;const p=e==null?void 0:e.configuration,h=((a=p==null?void 0:p.scaleAttributes)==null?void 0:a.eventType)||(n==null?void 0:n.matchUpType)||"SINGLES",f=t==null?void 0:t.rankings,m=t==null?void 0:t.ratings,g=p==null?void 0:p.scaleAttributes,v=g==null?void 0:g.scaleType,y=g==null?void 0:g.scaleName,b=g==null?void 0:g.accessor,I=v==="RATING"?m:f,T=(o=(s=I==null?void 0:I.SINGLES)==null?void 0:s.find(M=>(M==null?void 0:M.scaleName)===y))==null?void 0:o.scaleValue,w=(c=(l=I==null?void 0:I.DOUBLES)==null?void 0:l.find(M=>(M==null?void 0:M.scaleName)===y))==null?void 0:c.scaleValue,S=T&&b?T[b]:T||"",U=w&&b?w[b]:w||"",P=h==="SINGLES"?S:U,E=(u=p==null?void 0:p.scaleAttributes)==null?void 0:u.fallback,R=!r&&(P||E&&(S||U)),C=document.createElement("span");return R&&(C.className=qy(i,hHe({color:(d=p==null?void 0:p.scaleAttributes)==null?void 0:d.scaleColor}))),C.innerHTML=R||"",C}var mHe=Object.defineProperty,Fi=(t,e)=>{for(var i in e)mHe(t,i,{get:e[i],enumerable:!0})};function bL(){return"2.2.9"}var xme={};Fi(xme,{competitionGovernor:()=>Ome,drawsGovernor:()=>Mye,entriesGovernor:()=>V0e,eventGovernor:()=>Y0e,generationGovernor:()=>dSe,matchUpFormatGovernor:()=>SSe,matchUpGovernor:()=>TSe,mocksGovernor:()=>C9,participantGovernor:()=>gTe,policyGovernor:()=>h0e,publishingGovernor:()=>$Te,queryGovernor:()=>y0e,reportGovernor:()=>YTe,scheduleGovernor:()=>KTe,scoreGovernor:()=>h7,tieFormatGovernor:()=>oUe,tournamentGovernor:()=>gUe,venueGovernor:()=>RUe});var Ome={};Fi(Ome,{getLinkedTournamentIds:()=>yR,getTournamentIds:()=>gR,linkTournaments:()=>Eye,mutate:()=>Lme,query:()=>Rye,unlinkTournament:()=>Cye,unlinkTournaments:()=>Pye});var Lme={};Fi(Lme,{linkTournaments:()=>Eye,unlinkTournament:()=>Cye,unlinkTournaments:()=>Pye});var Wb="SINGLES",On="SINGLES",py="DOUBLES",Nn="DOUBLES",ac="TEAM",Xn="TEAM",gHe={SINGLES_MATCHUP:Wb,SINGLES:On,DOUBLES_MATCHUP:py,DOUBLES:Nn,TEAM_MATCHUP:ac,TEAM:Xn},Fme={[On]:[On,"S"],[Nn]:[Nn,"D"],[Xn]:[Xn,"T"],S:[On,"S"],D:[Nn,"D"],T:[Xn,"T"]};function ra(t,e){return(t??0)-(e??0)}function di(t){return typeof t=="number"?parseInt(t.toString()):typeof t=="string"?parseInt(t):0}function kd(t){return isNaN(t)?!1:t&&(t&t-1)===0}function LX(t){if(!t.length)return;let e=[...t].sort(ra),i=Math.floor(e.length/2);return e.length%2?e[i]:(e[i-1]+e[i])/2}function vHe(t){if(!kd(t))return!1;let e=t,i=1;for(;e!==2;)i+=1,e=e/2;return i}function A5(t){return isNaN(t)?0:t%2&&t+1||t}function _5(t){return Math.pow(2,Math.round(Math.log(t)/Math.log(2)))}function Er(t){return!isNaN(parseFloat(t))}function $me(t){let e=di(t);if(!isNaN(e))return e===0?!1:(e&-e)===1}function MU(t){if(isNaN(t))return!1;for(;!kd(t);)t++;return t}function kc(t,e){return t=Math.ceil(t),e=Math.floor(e),Math.floor(Math.random()*(e-t+1))+t}function wi(t){return Number.isSafeInteger(typeof t=="string"?+t:t)}function yHe(t=1,e=3,i=!0){let n=0;for(let r=0;r<e;r++)n+=Math.random()*(t/e);return i&&t>1?Math.round(n):n}function bHe(t,e){e||(e=1);let i=1/e;return Math.round(t*i)/i}function Bme(t,e,i,n,r=2){let a=1-Math.random(),s=1-Math.random(),o=Math.sqrt(-2*Math.log(a))*Math.cos(2*Math.PI*s);return o=o/10+.5,o>1||o<0?o=Bme(t,e,i):(o=Math.pow(o,i),o*=e-t,o+=t),n&&(o=bHe(o,n)),parseFloat(o.toFixed(r))}function __(t,e=2){return parseFloat(Number(Math.round(t*1e3)/1e3).toFixed(e))}function Pi(t){return Array.isArray(t)?t==null?void 0:t.filter((e,i,n)=>n.lastIndexOf(e)===i):[]}function IHe(t){return Array.isArray(t)?t==null?void 0:t.map(e=>e===null?void 0:e):t}function co(t){return Array.isArray(t)?t.map(e=>[Math.random(),e]).sort((e,i)=>e[0]-i[0]).map(e=>e[1]):[]}function iT(t){return wi(t)?t:1/0}function Ol(t){return Array.isArray(t)?t.reduce((e,i)=>(e[i]||(e[i]=0),e[i]++,e),{}):{}}function wHe(t){return Vme(Ol(t))}function Vme(t){return Object.keys(t).reduce((e,i)=>{let n=t[i];return e[n]?e[n].push(i):e[n]=[i],e},{})}function SHe(t,e,i){return i.indexOf(t)===e}function jme(t){return t.filter(SHe)}function Ul(t){return Array.isArray(t)&&t.length?t.splice(Math.floor(Math.random()*t.length),1)[0]:void 0}function Cu(t){let e=Math.floor(Math.random()*t.length);return t[e]}function Mt(t,e){return Array.from({length:e-t},(i,n)=>n+t)}function yp(t,e){return e.reduce((i,n,r)=>(n===t&&i.push(r),i),[])}function Ar(t,e){return!Array.isArray(t)||!Array.isArray(e)?[]:t.filter(i=>e.indexOf(i)!==-1).filter((i,n,r)=>r.indexOf(i)===n)}function FX(t,e){return!Array.isArray(t)||!Array.isArray(e)?[]:t.filter(i=>!e.includes(i))}function vo(t,e){return!Array.isArray(t)||!Array.isArray(e)?!1:t.some(i=>e.includes(i))}function THe(t,e){return Array.isArray(e)&&e.reduce((i,n)=>(i[n]=1+i[n]||1,i),{})[t]||0}function UHe(t,e,i,n){return Array.isArray(t)?[].concat(...t.slice(0,e),...t.slice(e,e+i).sort(n),...t.slice(e+i,t.length)):[]}function Na(t,e){return Array.isArray(t)?t.reduce((i,n,r)=>{let a=Math.floor(r/e);return i[a]=[].concat(i[a]||[],n),i},[]):[]}function Gme(t,[e,...i]){return t.length?[t.slice(0,e),...Gme(t.slice(e),[...i,e])]:[]}function DHe(t){return t.reduce((e,i)=>{let n=e[e.length-1];return(!n||n[n.length-1]!==i-1)&&e.push([]),e[e.length-1].push(i),e},[])}function Hme(t){return Array.isArray(t)?t.reduce((e,i)=>!isNaN(parseInt(i))&&e,!0):!1}function zme(t){return Array.isArray(t)?t.reduce((e,i)=>isNaN(parseInt(i))&&e,!0):!1}function Mj(t,e,i){return Array.isArray(t)?t.reduce((n,r,a)=>{let s=i?!!(Math.floor(a/e)%2):!1,o=a%e,l=s?e-1-o:o;return n[l]||(n[l]=[]),n[l].push(r),n},[]):[]}function EHe(t,e=1){if(!Array.isArray(t)||!t.every(wi))return[];let i=Math.min(...t,e),n=Math.max(...t);return Mt(i,n+1).filter(r=>!t.includes(r))}function Sl(t){return typeof t=="function"}function ur(t){return typeof t=="string"}function tn(t){return t!==null&&typeof t=="object"&&!Array.isArray(t)}function PHe(t,e){if(!tn(t)||!tn(e))return!1;let i=Object.keys(t),n=Object.keys(e);if(i.length!==n.length)return!1;for(let r of i)if(t[r]!==e[r])return!1;return!0}function qme(t,e){return Array.isArray(t)?Object.assign({},...(t??[]).filter(tn).map(i=>i[e]&&{[i[e]]:i}).filter(Boolean)):{}}var CHe=t=>e=>Object.keys(t).every(i=>e[i]===t[i]);function Nj(t,e){if(t===void 0)return null;if(!tn(t)||t===null)return t;let i=Object.keys(t),n=r=>r===void 0?null:r;return Object.assign({},...i.map(r=>Array.isArray(t[r])?{[r]:e?t[r]:t[r].map(a=>Nj(a))}:{[r]:e?n(t[r]):Nj(t[r])}))}function Aj(t){return Array.isArray(t)?t.length+t.map(Aj).reduce((e,i)=>e+i,0):tn(t)&&t!==null?Object.keys(t).length+Object.keys(t).map(e=>Aj(t[e])).reduce((e,i)=>e+i,0):0}function RHe(t){if(t===null||typeof t!="object")return;let e=JSON.stringify(t),i=Aj(t),n=e.split("").reduce((r,a)=>r+a.charCodeAt(0),0);return[e.length,i,n].map(r=>r.toString(36)).join("")}function IL(t,e){return!Array.isArray(t)||!ur(e)?!1:Ar(t,Fme[e]).length}var pe={success:!0},Wme="error",MHe={SUCCESS:pe,ERROR:Wme};function Yme({collectionValueProfiles:t,matchUpCount:e}){let i=[];if(!Array.isArray(t))return i.push(`collectionValueProfiles is not an array: ${t}`),{errors:i};if(t.length&&t.length!==e)return i.push("collectionValueProfiles do not align with matchUpsCount"),{errors:i};for(let r of t){if(typeof r!="object")return i.push(`valueProfile is not type object: ${r}`),{errors:i};let{matchUpValue:a,collectionPosition:s}=r;if(typeof a!="number"||typeof s!="number"||s>e||s<1)return i.push("Invalid value profile: value and collectionPosition must be numeric. collectionPosition cannot be greater than matchUpCount"),{errors:i}}let n=t.map(r=>r.collectionPosition);return n.length!==Pi(n).length?(i.push("collectionPositions are not unique"),{errors:i}):{...pe}}var NHe={};Fi(NHe,{addNotice:()=>Ti,callListener:()=>jj,createInstanceState:()=>pze,cycleMutationStatus:()=>l6,deepCopyEnabled:()=>o6,deleteNotice:()=>c6,deleteNotices:()=>oR,disableNotifications:()=>ave,enableNotifications:()=>iA,getDevContext:()=>oc,getMethods:()=>lve,getNotices:()=>cve,getProvider:()=>Gj,getTopics:()=>ru,getTournamentId:()=>ww,getTournamentRecord:()=>u6,getTournamentRecords:()=>Sw,globalLog:()=>pve,handleCaughtError:()=>LL,hasTopic:()=>xL,removeTournamentRecord:()=>dve,setDeepCopy:()=>xE,setDevContext:()=>kE,setGlobalLog:()=>rve,setGlobalMethods:()=>sve,setGlobalSubscriptions:()=>fze,setMethods:()=>ove,setStateMethods:()=>hve,setStateProvider:()=>dze,setSubscriptions:()=>mze,setTournamentId:()=>OE,setTournamentRecord:()=>uve,setTournamentRecords:()=>OL,timeKeeper:()=>hze});var _j={message:"Chronological error; time violation.",code:"ANACHRONISM"},AE={message:"Duplicate entry",code:"DUPLICATE_ENTRY"},Kme={message:"Cannot remove main structure",code:"ERR_CANNOT_REMOVE_MAIN_STRUCTURE"},kj={message:"records must be an object with tournamentId keys",code:"ERR_INVALID_TOURNAMENTS"},Tr={message:"Missing tournamentRecords",code:"ERR_MISSING_TOURNAMENTS"},dt={message:"Missing tournamentRecord",code:"ERR_MISSING_TOURNAMENT"},iR={message:"Invalid tournamentRecord",code:"ERR_INVALID_TOURNAMENT"},nT={message:"Missing tournamentId",code:"ERR_MISSING_TOURNAMENT_ID"},Yb={message:"Invalid drawDefinition",code:"ERR_INVALID_DRAWDEF"},Ht={message:"Missing drawDefinition",code:"ERR_MISSING_DRAWDEF"},Zme={message:"Existing drawDefinition(s)",code:"ERR_EXISTING_DRAWDEFS"},sc={message:"drawDefinition not found",code:"ERR_NOT_FOUND_DRAWDEF"},Wy={message:"Invalid structure",code:"ERR_INVALID_STRUCTURE"},k5={message:"Incomplete source structure",code:"ERR_INCOMPLETE_STRUCTURE"},x5={message:"Invalid drawPosition for seedAssignment",code:"ERR_INVALID_SEEDING_POSITION"},rT={message:"drawPosition already assigned",code:"ERR_EXISTING_POSITION_ASSIGNMENT"},Xme={message:"Schedule not cleared",code:"ERR_UNCHANGED_SCHEDULE_NOT_CLEARED"},Jme={message:"drawPosition not cleared",code:"ERR_FAILURE_POSITION_NOT_CLEARED"},AHe={message:"drawPosition not found",code:"ERR_NOT_FOUND_DRAW_POSITION"},O5={message:"Unrecognized drawType",code:"ERR_UNRECOGNIZED_DRAW_TYPE"},nR={message:"Missing drawPositions",code:"ERR_MISSING_DRAW_POSITIONS"},wL={message:"drawPosition is active",code:"ERR_ACTIVE_DRAW_POSITION"},_He={message:"drawPosition is occupied",code:"ERR_OCCUPIED_DRAW_POSITION"},NU={message:"Invlid drawPosition",code:"ERR_INVALID_DRAW_POSITION"},AU={message:"Missing drawPosition",code:"ERR_MISSING_DRAW_POSITION"},L5={message:"Invalid drawType",code:"ERR_INVALID_DRAW_TYPE"},SL={message:"Invalid drawSize",code:"ERR_INVALID_DRAW_SIZE"},F5={message:"Cannot set drawSize to be less than existing entries",code:"ERR_INVALID_DRAW_SIZE_MISMATCH"},rR={message:"Missing drawSize",code:"ERR_MISSING_DRAW_SIZE"},jd={message:"Missing drawId",code:"ERR_MISSING_DRAW_ID"},Qme={message:"drawId exists",code:"ERR_EXISTING_DRAW_ID"},ege={message:"participantId cannot be assigned to multiple seedNumbers",code:"INVALID_PARTICIPANT_SEEDING"},tge={message:"seedsCount greater than drawSize",code:"ERR_INVALID_SEED_COUNT"},ige={message:"Missing seedCountThresholds",code:"ERR_MISSING_SEED_COUNT_THRESHOLD"},nge={message:"Invalid action",code:"ERR_INVALID_ACTION"},xj={message:"Invalid assignment",code:"ERR_INVALID_ASSIGNMENT"},rge={message:"Missing seedAssignments",code:"ERR_MISSING_SEED_ASSIGNMENTS"},age={message:"Invalid seedNumber",code:"ERR_INVALID_SEED_NUMBER"},sge={message:"Invalid seedPosition",code:"ERR_INVALID_SEED_POSITION"},$5={message:"Missing targetLink",code:"ERR_MISSING_LINK_TARGET"},oge={message:"Existing round",code:"ERR_EXISTING_ROUND"},kHe={message:"Missing roundNumber",code:"ERR_MISSING_ROUND_NUMBER"},mc={message:"Missing structureId",code:"ERR_MISSING_STRUCTURE_ID"},yr={message:"structure not found",code:"ERR_NOT_FOUND_STRUCTURE"},B5={message:"Missing structures",code:"ERR_MISSING_STRUCTURES"},Yy={message:"Missing structure",code:"ERR_MISSING_STRUCTURE"},lge={message:"drawDefinition contains unlinked structures",code:"ERR_MISSING_STRUCTURE_LINKS"},jh={message:"Invalid eventType",code:"ERR_INVALID_EVENT_TYPE"},Qn={message:"Missing event / eventId",code:"ERR_MISSING_EVENT_ID"},Wc={message:"Event not found",code:"ERR_NOT_FOUND_EVENT"},cge={message:"Event exists",code:"ERR_EXISTING_EVENT"},uge={message:"Missing entries",code:"ERR_MISSING_ENTRIES"},dge={message:"Invalid entries",code:"ERR_INVALID_ENTRIES"},V5={message:"Missing assignments",code:"ERR_MISSING_ASSIGNMENTS"},pge={message:"Missing stage",code:"ERR_MISSING_STAGE"},Ky={message:"Invalid stage",code:"ERR_INVALID_STAGE"},hge={message:"stageSequence limit",code:"ERR_LIMIT_STAGE_SEQUENCE"},fge={message:"Missing positionAssignments",code:"ERR_MISSING_POSITION_ASSIGNMENTS"},mge={message:"Cannot Assign BYE status if no assignment: { bye: true }",code:"ERR_UNCHANGED_CANNOT_ASSIGN_BYE"},Oj={message:"Unrecognized matchUpStatus",code:"ERR_UNRECOGNIZED_MATCHUP_STATUS"},aR={message:"Unrecognized matchUpFormat",code:"ERR_UNRECOGNIZED_MATCHUP_FORMAT"},eA={message:"Incompatible matchUpStatus",code:"ERR_INCOMPATIBLE_MATCHUP_STATUS"},_U={message:"Invalid matchUpStatus",code:"ERR_INVALID_MATCHUP_STATUS"},Eh={message:"Invalid tieFormat",code:"ERR_INVALID_TIE_FORMAT"},j5={message:"Invalid matchUpFormat",code:"ERR_INVALID_MATCHUP_FORMAT"},G5={message:"Missing matchUpFormat",code:"ERR_MISSING_MATCHUP_FORMAT"},gge={message:"Missing collectionDefinition",code:"ERR_MISSING_COLLECTION_DEFINITION"},kU={message:"Missing tieFormat",code:"ERR_MISSING_TIE_FORMAT"},Zs={message:"Missing matchUpId",code:"ERR_MISSING_MATCHUP_ID"},gw={message:"Missing matchUpIds",code:"ERR_MISSING_MATCHUP_IDS"},xs={message:"matchUp not found",code:"ERR_NOT_FOUND_MATCHUP"},Em={message:"Missing matchUps",code:"ERR_MISSING_MATCHUPS"},ll={message:"Missing matchUp",code:"ERR_MISSING_MATCHUP"},cl={message:"Invalid matchUp",code:"ERR_INVALID_MATCHUP"},H5={message:"Missing policyType",code:"ERR_MISSING_POLICY_TYPE"},TL={message:"Missing policyDefinitions",code:"ERR_MISSING_POLICY_DEFINITIONS"},xHe={message:"Missing seeding policy",code:"ERR_MISSING_POLICY_SEEDING"},vge={message:"Missing avoidance policy",code:"ERR_MISSING_POLICY_AVOIDANCE"},z5={message:"Missing policy attributes",code:"ERR_MISSING_POLICY_ATTRIBUTES"},yge={message:"Invalid policyDefinitions",code:"ERR_INVALID_POLICY_DEFINITIONS"},q5={message:"existing policyType",code:"ERR_EXISTING_POLICY_TYPE"},OHe={message:"Policy not attached",code:"ERR_FAILURE_POLICY_NOT_ATTACHED"},aT={message:"Policy not found",code:"ERR_NOT_FOUND_POLICY"},LHe={message:"Missing scoring policy / matchUpFormats",code:"ERR_MISSING_POLICY_SCORING_MATCHUP_FORMATS"},W5={message:"Invalid sideNumber",code:"ERR_INVALID_SIDE_NUMBER"},FHe={message:"Invalid setNumber",code:"ERR_INVALID_SET_NUMBER"},UL={message:"Missing setObject",code:"ERR_MISSING_SET_ATTRIBUTE"},$He={message:"Missing setNumber",code:"ERR_MISSING_SET_NUMBER"},BHe={message:"Missing sideNumber",code:"ERR_MISSING_SIDE_NUMBER"},vw={message:"Missing courtId",code:"ERR_MISSING_COURT_ID"},si={message:"Missing value",code:"ERR_MISSING_VALUE"},bge={message:"Missing birthdate",code:"ERR_MISSING_BIRTH_DATE"},Ige={message:"Missing date",code:"ERR_MISSING_DATE"},wge={message:"No valid dates",code:"ERR_NO_VALID_DATES"},k_={message:"Invalid bookings",code:"ERR_INVALID_BOOKINGS"},tA={message:"Invalid dateAvailability",code:"ERR_INVALID_DATE_AVAILABILITY"},Sge={message:"Missing dateAvailability",code:"ERR_MISSING_DATE_AVAILABILITY"},Va={message:"Invalid Date",code:"ERR_INVALID_DATE"},Iu={message:"Invalid time",code:"ERR_INVALID_TIME"},Tge={message:"Invalid tournament dates",code:"ERR_INVALID_DATES_TOURNAMENT"},Lj={message:"Invalid game scores",code:"ERR_INVALID_SCORES_GAME"},Uge={message:"Invalid score",code:"ERR_INVALID_SCORE"},DL={message:"Invalid winningSide",code:"ERR_INVALID_WINNING_SIDE"},VHe={message:"No participants generated",code:"ERR_NO_PARTICIPANTS_GENERATED"},Y5={message:"Cannot modify tieFormat",code:"ERR_UNCHANGED_CANNOT_MODIFY_TIEFORMAT"},Dge={message:"Cannot modify participantType",code:"ERR_UNCHANGED_CANNOT_MODIFY_PARTICIPANT_TYPE"},EL={message:"Cannot remove participants",code:"ERR_UNCHANGED_CANNOT_REMOVE_PARTICIPANTS"},Fj={message:"Participant category mismatch",code:"ERR_CATEGORY_MISMATCH"},PL={message:"Cannot change winningSide",code:"ERR_UNCHANGED_CANNOT_CHANGE_WINNING_SIDE"},yw={message:"Invalid participant",code:"ERR_INVALID_PARTICIPANT"},xd={message:"Invalid participantId",code:"ERR_INVALID_PARTICIPANT_ID"},Pl={message:"Invalid participantIds",code:"ERR_INVALID_PARTICIPANT_IDS"},Ege={message:"Invalid participantRole",code:"ERR_INVALID_PARTICIPANT_ROLE"},Od={message:"Invalid participantType",code:"ERR_INVALID_PARTICIPANT_TYPE"},Pge={message:"Missing participantRole",code:"ERR_MISSING_PARTICIPANT_ROLE"},bw={message:"Missing participant",code:"ERR_MISSING_PARTICIPANT"},sR={message:"Missing participants",code:"ERR_MISSING_PARTICIPANTS"},da={message:"Missing participantId",code:"ERR_MISSING_PARTICIPANT_ID"},Or={message:"Participant Not Found",code:"ERR_NOT_FOUND_PARTICIPANT"},Cge={message:"participantId exists",code:"ERR_EXISTING_PARTICIPANT_ID"},jHe={message:"participant pair exists",code:"ERR_EXISTING_PARTICIPANT_PAIR"},Rge={message:"No participant removed",code:"ERR_UNCHANGED_NO_PARTICIPANT_REMOVED"},Yg={message:"Missing participantIds",code:"ERR_MISSING_PARTICIPANT_IDS"},Mge={message:"Missing participantsCount",code:"ERR_MISSING_PARTICIPANT_COUNT"},Nge={message:"Participant not checked in",code:"ERR_UNCHANGED_PARTICIPANT_NOT_CHECKED_IN"},Age={message:"Missing person details",code:"ERR_MISSING_PERSON_DETAILS"},xU={message:"Existing participant drawPosition assignment",code:"ERR_EXISTING_PARTICIPANT_DRAW_POSITION_ASSIGNMENT"},CL={message:"Existing participant",code:"ERR_EXISTING_PARTICIPANT"},K5={message:"participantsCount exceeds drawSize",code:"ERR_INVALID_PARTICIPANT_COUNT"},$j={message:"Invalid entry status",code:"ERR_INVALID_ENTRY_STATUS"},_ge={message:"Participant Entry Not Found",code:"ERR_NOT_FOUND_PARTICIPANT_ENTRY"},GHe={message:"Participant not entered in stage",code:"ERR_UNCHANGED_PARTICIPANT_NOT_ENTERED"},HHe={message:"Participant not found in stageSequence",code:"ERR_NOT_FOUND_PARTICIPANT_IN_STAGE"},kge={message:"entryStatus not allowed in stage",code:"ERR_INVALID_ENTRY_STATUS_IN_STAGE"},xge={message:"entryStatus not allowed for event",code:"ERR_INVALID_ENTRY_STATUS_IN_EVENT"},Bj={message:"No stage space available for entryStatus",code:"ERR_UNCHANGED_NO_AVAILABLE_STAGE_SPACE"},Oge={message:"Insufficient drawPositions to accommodate qualifiers",code:"ERR_UNCHANGED_NO_DRAW_POSITIONS_FOR_QUALIFIERS"},Z5={message:"Insufficient drawPositions to accommodate entries",code:"ERR_INSUFFICIENT_DRAW_POSITIONS"},Lge={message:"Missing penaltyType",code:"ERR_MISSING_PENALTY_TYPE"},X5={message:"Missing penaltyId",code:"ERR_MISSING_PENALTY_ID"},sT={message:"Penalty not found",code:"ERR_NOT_FOUND_PENALTY"},Fge={message:"Missing courtsCount/courtNames",code:"ERR_MISSING_COURTS_INFO"},OU={message:"Court not found",code:"ERR_NOT_FOUND_COURT"},$ge={message:"Court exists",code:"ERR_EXISTING_COURT"},Bge={message:"Venue exists",code:"ERR_EXISTING_VENUE"},Iw={message:"Venue not found",code:"ERR_NOT_FOUND_VENUE"},Kg={message:"Missing venueId",code:"ERR_MISSING_VENUE_ID"},Vge={message:"Invalid endTime",code:"ERR_INVALID_END_TIME"},J5={message:"Existing endTime",code:"ERR_EXISTING_END_TIME"},jge={message:"Invalid stopTime",code:"ERR_INVALID_STOP_TIME"},Gge={message:"Invalid startTime",code:"ERR_INVALID_START_TIME"},zHe={message:"Invalid resumeTime",code:"ERR_INVALID_RESUME_TIME"},Q5={message:"Invalid timeItem",code:"ERR_INVALID_TIME_ITEMS"},Hge={message:"Missing async state provider",code:"ERR_MISSING_ASYNC_STATE_PROVIDER"},e6={message:"Missing timeItem",code:"ERR_MISSING_TIME_ITEM"},t6={message:"Missing timeItems",code:"ERR_MISSING_TIME_ITEMS"},RL={message:"Missing context",code:"ERR_MISSING_CONTEXT"},zge={message:"Missing schedule",code:"ERR_MISSING_SCHEDULE"},wI={message:"Invalid scaleItem",code:"ERR_INVALID_SCALE_ITEM"},qge={message:"Modifications failed",code:"ERR_FAILURE_MODIFICATIONS"},LU={message:"No modifications applied",code:"ERR_UNCHANGED_NO_MODIFICATIONS_APPLIED"},Wge={message:"Unable to assign court",code:"ERR_UNCHANGED_COURT_NOT_ASSIGNED"},ML={message:"No Candidates",code:"ERR_UNCHANGED_NO_CANDIDATES"},Yge={message:"Invalid configuration",code:"ERR_INVALID_CONFIG"},Kge={message:"Invalid collectionDefinition",code:"ERR_INVALID_COLLECTION_DEFINITION"},Pm={message:"Invalid object",code:"ERR_INVALID_OBJECT"},bD={message:"Invalid gender",code:"ERR_INVALID_GENDER"},_E={message:"Invalid category",code:"ERR_INVALID_CATEGORY"},Ae={message:"Invalid values",code:"ERR_INVALID_VALUES"},Zge={message:"Duplicate value",code:"ERR_DUPLICATE_VALUE"},i6={message:"Team not found",code:"ERR_NOT_FOUND_TEAM"},Xge={message:"No valid actions",code:"ERR_NO_VALID_ACTIONS"},NL={message:"No valid attributes",code:"ERR_NO_VALID_ATTRIBUTES"},n6={message:"Value unchanged",code:"ABORT_UNCHANGED"},Ya={message:"Not found",code:"ERR_NOT_FOUND"},AL={message:"Not implemented",code:"ERR_NOT_IMPLEMENTED"},Jge={message:"Existing flight",code:"ERR_EXISTING_FLIGHT"},r6={message:"Existing flight profile",code:"ERR_EXISTING_FLIGHT_PROFILE"},Qge={message:"Existing outcome",code:"ERR_EXISTING_OUTCOME"},eve={message:"Existing matchUpId",code:"ERR_EXISTING_MATCHUP_ID"},Vj={message:"Existing stage",code:"ERR_EXISTING_STAGE"},a6={message:"Existing structure",code:"ERR_EXISTING_STRUCTURE"},_L={message:"Method not found",code:"ERR_NOT_FOUND_METHOD"},tve={message:"Scheduled matchUps",code:"ERR_SCHEDULED_MATCHUPS"},kL={message:"Scores present",code:"ERR_SCORES_PRESENT"},qHe={ANACHRONISM:_j,CANNOT_CHANGE_WINNING_SIDE:PL,CANNOT_MODIFY_TIEFORMAT:Y5,CANNOT_MODIFY_PARTICIPANT_TYPE:Dge,CANNOT_REMOVE_MAIN_STRUCTURE:Kme,CANNOT_REMOVE_PARTICIPANTS:EL,CATEGORY_MISMATCH:Fj,COURT_EXISTS:$ge,COURT_NOT_FOUND:OU,DRAW_DEFINITION_NOT_FOUND:sc,DRAW_ID_EXISTS:Qme,DRAW_POSITION_ACTIVE:wL,DRAW_POSITION_ASSIGNED:rT,DRAW_POSITION_NOT_CLEARED:Jme,DRAW_POSITION_NOT_FOUND:AHe,DRAW_SIZE_MISMATCH:F5,DUPLICATE_ENTRY:AE,DUPLICATE_VALUE:Zge,ENTRY_STATUS_NOT_ALLOWED_FOR_EVENT:xge,ENTRY_STATUS_NOT_ALLOWED_IN_STAGE:kge,EVENT_EXISTS:cge,EVENT_NOT_FOUND:Wc,EXISTING_DRAW_DEFINITIONS:Zme,EXISTING_END_TIME:J5,EXISTING_FLIGHT:Jge,EXISTING_MATCHUP_ID:eve,EXISTING_OUTCOME:Qge,EXISTING_PARTICIPANT_DRAW_POSITION_ASSIGNMENT:xU,EXISTING_PARTICIPANT:CL,EXISTING_POLICY_TYPE:q5,EXISTING_PROFILE:r6,EXISTING_ROUND:oge,EXISTING_STAGE:Vj,EXISTING_STRUCTURE:a6,INCOMPATIBLE_MATCHUP_STATUS:eA,INCOMPLETE_SOURCE_STRUCTURE:k5,INSUFFICIENT_DRAW_POSITIONS:Z5,INVALID_ACTION:nge,INVALID_ASSIGNMENT:xj,INVALID_BOOKINGS:k_,INVALID_CATEGORY:_E,INVALID_COLLECTION_DEFINITION:Kge,INVALID_CONFIGURATION:Yge,INVALID_DATE_AVAILABILITY:tA,INVALID_DATE:Va,INVALID_DRAW_DEFINITION:Yb,INVALID_DRAW_POSITION_FOR_SEEDING:x5,INVALID_DRAW_POSITION:NU,INVALID_DRAW_SIZE:SL,INVALID_END_TIME:Vge,INVALID_ENTRIES:dge,INVALID_EVENT_TYPE:jh,INVALID_GAME_SCORES:Lj,INVALID_GENDER:bD,INVALID_MATCHUP_FORMAT:j5,INVALID_MATCHUP_STATUS:_U,INVALID_MATCHUP_STATUS_BYE:mge,INVALID_MATCHUP:cl,INVALID_OBJECT:Pm,INVALID_PARTICIPANT_ID:xd,INVALID_PARTICIPANT_IDS:Pl,INVALID_PARTICIPANT_ROLE:Ege,INVALID_PARTICIPANT_SEEDING:ege,INVALID_PARTICIPANT_TYPE:Od,INVALID_PARTICIPANT:yw,INVALID_POLICY_DEFINITION:yge,INVALID_RECORDS:kj,INVALID_SCALE_ITEM:wI,INVALID_SEED_NUMBER:age,INVALID_SEED_POSITION:sge,INVALID_SET_NUMBER:FHe,INVALID_SIDE_NUMBER:W5,INVALID_SCORE:Uge,INVALID_STAGE:Ky,INVALID_START_TIME:Gge,INVALID_STRUCTURE:Wy,INVALID_STOP_TIME:jge,INVALID_TIE_FORMAT:Eh,INVALID_TIME:Iu,INVALID_TIME_ITEM:Q5,INVALID_TOURNAMENT_DATES:Tge,INVALID_TOURNAMENT_RECORD:iR,INVALID_VALUES:Ae,INVALID_WINNING_SIDE:DL,MATCHUP_NOT_FOUND:xs,METHOD_NOT_FOUND:_L,MISSING_ASSIGNMENTS:V5,MISSING_ASYNC_STATE_PROVIDER:Hge,MISSING_AVOIDANCE_POLICY:vge,MISSING_BIRTH_DATE:bge,MISSING_COLLECTION_DEFINITION:gge,MISSING_COURT_ID:vw,MISSING_COURTS_INFO:Fge,MISSING_DATE_AVAILABILITY:Sge,MISSING_DATE:Ige,MISSING_DRAW_DEFINITION:Ht,MISSING_DRAW_ID:jd,MISSING_DRAW_POSITION:AU,MISSING_DRAW_POSITIONS:nR,MISSING_DRAW_SIZE:rR,MISSING_ENTRIES:uge,MISSING_EVENT:Qn,MISSING_MATCHUP_FORMAT:G5,MISSING_MATCHUP_ID:Zs,MISSING_MATCHUP_IDS:gw,MISSING_MATCHUP:ll,MISSING_MATCHUPS:Em,MISSING_PARTICIPANT_COUNT:Mge,MISSING_PARTICIPANT_ID:da,MISSING_PARTICIPANT_IDS:Yg,MISSING_PARTICIPANT_ROLE:Pge,MISSING_PARTICIPANT:bw,MISSING_PARTICIPANTS:sR,MISSING_PENALTY_ID:X5,MISSING_PENALTY_TYPE:Lge,MISSING_PERSON_DETAILS:Age,MISSING_POLICY_ATTRIBUTES:z5,MISSING_POLICY_DEFINITION:TL,MISSING_POLICY_TYPE:H5,MISSING_POSITION_ASSIGNMENTS:fge,MISSING_ROUND_NUMBER:kHe,MISSING_SCHEDULE:zge,MISSING_SCORING_POLICY:LHe,MISSING_SEED_ASSIGNMENTS:rge,MISSING_SEEDCOUNT_THRESHOLDS:ige,MISSING_SEEDING_POLICY:xHe,MISSING_SET_NUMBER:$He,MISSING_SET_OBJECT:UL,MISSING_SIDE_NUMBER:BHe,MISSING_STAGE:pge,MISSING_STRUCTURE_ID:mc,MISSING_STRUCTURE:Yy,MISSING_STRUCTURES:B5,MISSING_TARGET_LINK:$5,MISSING_TIE_FORMAT:kU,MISSING_TIME_ITEM:e6,MISSING_TIME_ITEMS:t6,MISSING_TOURNAMENT_ID:nT,MISSING_TOURNAMENT_RECORD:dt,MISSING_TOURNAMENT_RECORDS:Tr,MISSING_VALUE:si,MISSING_VENUE_ID:Kg,MODIFICATIONS_FAILED:qge,NO_CANDIDATES:ML,NO_DRAW_POSITIONS_AVAILABLE_FOR_QUALIFIERS:Oge,NO_MODIFICATIONS_APPLIED:LU,NO_STAGE_SPACE_AVAILABLE_FOR_ENTRY_STATUS:Bj,NO_PARTICIPANT_REMOVED:Rge,NO_VALID_ACTIONS:Xge,NO_VALID_ATTRIBUTES:NL,NO_VALID_DATES:wge,NOT_FOUND:Ya,NOT_IMPLEMENTED:AL,PARTICIPANT_COUNT_EXCEEDS_DRAW_SIZE:K5,PARTICIPANT_ID_EXISTS:Cge,PARTICIPANT_NOT_CHECKED_IN:Nge,PARTICIPANT_NOT_FOUND:Or,PARTICIPANT_PAIR_EXISTS:jHe,PENALTY_NOT_FOUND:sT,POLICY_NOT_ATTACHED:OHe,POLICY_NOT_FOUND:aT,SCHEDULE_NOT_CLEARED:Xme,SCHEDULED_MATCHUPS:tve,SCORES_PRESENT:kL,SEEDSCOUNT_GREATER_THAN_DRAW_SIZE:tge,STAGE_SEQUENCE_LIMIT:hge,STRUCTURE_NOT_FOUND:yr,TEAM_NOT_FOUND:i6,UNABLE_TO_ASSIGN_COURT:Wge,UNLINKED_STRUCTURES:lge,UNRECOGNIZED_DRAW_TYPE:O5,UNRECOGNIZED_MATCHUP_FORMAT:aR,UNRECOGNIZED_MATCHUP_STATUS:Oj,VALUE_UNCHANGED:n6,VENUE_EXISTS:Bge},hr={disableNotifications:!1,tournamentId:void 0,tournamentRecords:{},subscriptions:{},modified:!1,methods:{},notices:[]},ive={addNotice:rze,callListener:cze,cycleMutationStatus:nze,deleteNotice:oze,deleteNotices:sze,disableNotifications:WHe,enableNotifications:YHe,getMethods:s6,getNotices:aze,getTopics:lze,getTournamentId:nve,getTournamentRecord:KHe,getTournamentRecords:ZHe,removeTournamentRecord:eze,setMethods:ize,setSubscriptions:tze,setTournamentId:JHe,setTournamentRecord:XHe,setTournamentRecords:QHe,handleCaughtError:uze};function WHe(){hr.disableNotifications=!0}function YHe(){hr.disableNotifications=!1}function nve(){return hr.tournamentId}function KHe(t){return hr.tournamentRecords[t]}function ZHe(){return hr.tournamentRecords}function XHe(t){let e=t==null?void 0:t.tournamentId;return e?(hr.tournamentRecords[e]=t,{success:!0}):{error:iR}}function JHe(t){return t?hr.tournamentRecords[t]?(hr.tournamentId=t,{success:!0}):{error:dt}:(hr.tournamentId=void 0,{success:!0})}function QHe(t){hr.tournamentRecords=t;let e=Object.keys(t);e.length===1?hr.tournamentId=e[0]:e.length||(hr.tournamentId=void 0)}function eze(t){if(typeof t!="string")return{error:Ae};if(!hr.tournamentRecords[t])return{error:Ya};delete hr.tournamentRecords[t];let e=Object.keys(hr.tournamentRecords);return e.length===1?hr.tournamentId=e[0]:e.length||(hr.tournamentId=void 0),{success:!0}}function tze(t){return typeof t.subscriptions!="object"?{error:Ae}:(Object.keys(t.subscriptions).forEach(e=>{typeof t.subscriptions[e]=="function"?hr.subscriptions[e]=t.subscriptions[e]:delete hr.subscriptions[e]}),{...pe})}function ize(t){return typeof t!="object"?{error:Ae}:(Object.keys(t).forEach(e=>{typeof t[e]=="function"&&(hr.methods[e]=t[e])}),{...pe})}function nze(){let t=hr.modified;return hr.modified=!1,t}function rze({topic:t,payload:e,key:i},n){if(!(typeof t!="string"||typeof e!="object")&&(hr.disableNotifications||(hr.modified=!0),!(hr.disableNotifications||!hr.subscriptions[t]&&!n)))return i&&(hr.notices=hr.notices.filter(r=>!(r.topic===t&&r.key===i))),hr.notices.push({topic:t,payload:e,key:i}),{...pe}}function s6(){return hr.methods??{}}function aze({topic:t}){return hr.notices.filter(e=>e.topic===t).map(e=>e.payload)}function sze(){hr.notices=[]}function oze({topic:t,key:e}){hr.notices=hr.notices.filter(i=>(!t||i.topic===t)&&i.key!==e)}function lze(){return{topics:Object.keys(hr.subscriptions)}}function cze({topic:t,notices:e},i){let n=hr.subscriptions[t];n&&typeof n=="function"&&n(e);let r=i==null?void 0:i[t];r&&typeof r=="function"&&r(e)}function uze({engineName:t,methodName:e,params:i,err:n}){let r;return typeof n=="string"?r=n.toUpperCase():n instanceof Error&&(r=n.message),console.log("ERROR",{tournamentId:nve(),params:JSON.stringify(i),engine:t,methodName:e,error:r}),{error:r}}var Vn={timers:{default:{elapsedTime:0}},globalSubscriptions:{},deepCopyAttributes:{stringify:[],ignore:[],toJSON:[]},globalMethods:[],deepCopy:!0},Ka=ive,$X=["addNotice","callListener","cycleMutationStatus","deleteNotice","deleteNotices","disableNotifications","enableNotifications","getMethods","getNotices","getTopics","getTournamentId","getTournamentRecord","getTournamentRecords","removeTournamentRecord","setSubscriptions","setTournamentId","setTournamentRecord","setTournamentRecords"];function dze(t){if(typeof t!="object")throw new Error("Global state provider can not be undefined or null");if(Ar(Object.keys(t),$X).length!==$X.length)throw new Error("Global state provider is missing required methods");return Ka=t,{success:!0}}function pze(){if(Ka.createInstanceState){try{Ka.createInstanceState()}catch(t){return{error:t}}return{success:!0}}else return{error:Hge}}function oc(t){return!t||typeof t!="object"?Vn.devContext??!1:typeof Vn.devContext!="object"?!1:Object.keys(t).every(e=>{var i;return((i=Vn.devContext)==null?void 0:i[e])===t[e]})&&Vn.devContext}function hze(t="reset",e="default"){var i,n;let r=Date.now();if(t==="report"){if(e==="allTimers")return Object.keys(Vn.timers).filter(a=>a!=="default"||Vn.timers[a].startTime).map(a=>{let s=Vn.timers[a],o=s.state==="stopped"?0:(r-((s==null?void 0:s.startTime)??0))/1e3,l=s.elapsedTime+o;return{state:Vn.timers[a].state,elapsedTime:l.toFixed(2),timer:a}});{let a=Vn.timers[e].state==="stopped"?0:(r-(((i=Vn.timers[e])==null?void 0:i.startTime)??0))/1e3,s=Vn.timers[e].elapsedTime+a;return{state:Vn.timers[e].state,elapsedTime:s.toFixed(2),timer:e}}}if(!Vn.timers[e]||t==="reset"){if(e==="allTimers")return Vn.timers={default:{elapsedTime:0}},!0;Vn.timers[e]={startTime:r,state:"active",elapsedTime:0}}return Vn.timers[e].elapsedTime||(Vn.timers[e].elapsedTime=0),t==="stop"&&Vn.timers[e].state!=="stopped"&&(Vn.timers[e].state="stopped")&&(Vn.timers[e].elapsedTime+=(r-(((n=Vn.timers[e])==null?void 0:n.startTime)??0))/1e3),t==="start"&&(Vn.timers[e].startTime=r)&&(Vn.timers[e].state="active"),Vn.timers[e]}function rve(t){Sl(t)?Vn.globalLog=t:delete Vn.globalLog}function kE(t){Vn.devContext=t}function ave(){Ka.disableNotifications()}function iA(){Ka.enableNotifications()}function xE(t,e){typeof t=="boolean"&&(Vn.deepCopy=t),typeof e=="object"&&(Array.isArray(e.ignore)&&(Vn.deepCopyAttributes.ignore=e.ignore),Array.isArray(e.toJSON)&&(Vn.deepCopyAttributes.toJSON=e.toJSON),Array.isArray(e.stringify)&&(Vn.deepCopyAttributes.stringify=e.stringify),e.threshold&&(Vn.deepCopyAttributes.threshold=e.threshold))}function o6(){return{enabled:Vn.deepCopy,...Vn.deepCopyAttributes}}function fze(t){return t!=null&&t.subscriptions?(Object.keys(t.subscriptions).forEach(e=>{Vn.globalSubscriptions[e]=t.subscriptions[e]}),{...pe}):{error:si,info:"missing subscriptions"}}function mze(t){return t!=null&&t.subscriptions?Ka.setSubscriptions({subscriptions:t.subscriptions}):{error:si,info:"missing subscriptions"}}function sve(t){return t?typeof t!="object"?{error:Ae}:(Object.keys(t).forEach(e=>{Sl(t[e])&&(Vn.globalMethods[e]=t[e])}),{...pe}):{error:si,info:"missing method declarations"}}function ove(t){return t?typeof t!="object"?{error:Ae}:Ka.setMethods(t):{error:si,info:"missing method declarations"}}function l6(){return Ka.cycleMutationStatus()}function Ti(t){if(typeof(t==null?void 0:t.topic)!="string")return;let e=Vn.globalSubscriptions[t.topic];return Ka.addNotice(t,e)}function lve(){return{...Vn.globalMethods,...Ka.getMethods()}}function cve(t){return Ka.getNotices(t)}function c6({key:t,topic:e}){return Ka.deleteNotice({key:t,topic:e})}function oR(){return Ka.deleteNotices()}function ru(){return Ka.getTopics()}function xL(t){var e,i;return(i=(e=ru())==null?void 0:e.topics)==null?void 0:i.includes(t)}async function jj(t){return Ka.callListener(t,Vn.globalSubscriptions)}function ww(){return Ka.getTournamentId()}function u6(t){return Ka.getTournamentRecord(t)}function Sw(){return Ka.getTournamentRecords()}function uve(t){return Ka.setTournamentRecord(t)}function OL(t){return Ka.setTournamentRecords(t)}function OE(t){return Ka.setTournamentId(t)}function dve(t){return Ka.removeTournamentRecord(t)}function Gj(){return Ka}function LL({engineName:t,methodName:e,params:i,err:n}){let r=Sl(Ka.handleCaughtError)&&Ka.handleCaughtError||ive.handleCaughtError,{tournamentRecord:a,...s}=i;return r({params:s,engineName:t,methodName:e,err:n})}function pve(t,e){if(Vn.globalLog)try{Vn.globalLog({log:t,engine:e})}catch(i){console.log("globalLog error",i),console.log(e,t),rve()}else console.log(e,t)}function hve(t,e,i,n){if(!tn(t))return{error:Ae};Er||(i=1);let r=Array.isArray(e)?e:[],a={},s=(o,l=0)=>{Object.keys(o).forEach(c=>{Sl(o[c])?a[c]=o[c]:tn(o[c])&&(e===!0||r!=null&&r.includes(c))&&(i===void 0||l<i)&&s(o[c],l+1)})};return s(t),n?sve(a):ove(a),{methods:a}}function gze(t,e,i){return Object.keys(t).filter(n=>!e.includes(t[n])&&(!i||(Array.isArray(t[n])?t[n].length:!0)))}function Zt(t,e,i,n){var r;if(typeof t!="object"||t===null)return t;(r=o6())!=null&&r.enabled||(n=!0);let a=["",void 0,null];e&&a.push(!1);let s=gze(t,a,i);return Object.assign({},...s.map(o=>Array.isArray(t[o])?{[o]:n?t[o]:t[o].map(l=>Zt(l))}:{[o]:n?t[o]:Zt(t[o])}))}function fe({context:t,result:e,stack:i,info:n}){return e&&!Array.isArray(e==null?void 0:e.stack)&&(e.stack=[]),e&&Array.isArray(e==null?void 0:e.stack)&&typeof i=="string"&&e.stack.push(i),e&&n&&(e.info=n),e&&typeof t=="object"&&Object.keys(t).length&&Object.assign(e,Zt(t)),e&&!(e!=null&&e.error)&&!(e!=null&&e.success)&&Object.assign(e,{...pe}),e??{success:!0}}var Ld="ANY",Rn="MALE",Fo="MIXED",Lv="OTHER",Kn="FEMALE",d6={ANY:Ld,MALE:Rn,FEMALE:Kn,MIXED:Fo,OTHER:Lv},vze="MIXED events can not contain mixed singles or { gender: ANY } collections",yze="events with { gender: ANY } can not contain MIXED singles collections";function FL(t){let e="tieFormatGenderValidityCheck",{referenceGender:i,matchUpType:n,gender:r}=t;return i&&r&&[Rn,Kn].includes(i)&&i!==r?fe({result:{valid:!1,error:bD},context:{gender:r},stack:e}):i===Fo&&(r===Ld||r===Fo&&n!==Nn)?fe({result:{error:bD,valid:!1},info:vze,stack:e}):i===Ld&&r===Fo&&n!==Nn?fe({result:{error:bD,valid:!1},info:yze,stack:e}):{valid:!0}}var bze="normal",BX="timed",Ize="final",p6="NOAD",nA="SET",wze={S:bze,F:Ize};function $L(t,e){if((t!=null&&t.bestOf||t!=null&&t.exactly)&&t!=null&&t.setFormat)return Sze(t,e)}function LE(t){return!isNaN(Number(t))&&Number(t)}function fve(t){let e=`T${t.minutes}`;return t.based&&(e+=t.based),t.modifier&&(e+=`@${t.modifier}`),e}function Sze(t,e){var i;let n=LE(t.bestOf)||void 0,r=LE(t.exactly)||void 0,a=n||r;if((i=t.setFormat)!=null&&i.timed&&t.simplified&&a===1)return fve(t.setFormat);let s=a&&`${nA}${a}`||"",o=VX(t.setFormat,e),l=o&&`S:${o}`||"",c=VX(t.finalSetFormat,e),u=a&&a>1&&c&&o!==c&&`F:${c}`||"";if(s&&o)return[s,l,u].filter(d=>d).join("-")}function VX(t,e){if(typeof t=="object"&&Object.keys(t).length){if(t.timed)return fve(t);if(t.tiebreakSet)return jX(t.tiebreakSet);let i=LE(t.setTo);if(i){let n=t.NoAD&&p6||"",r=jX(t.tiebreakFormat),a=r&&`/${r}`||"",s=LE(t.tiebreakAt),o=s&&(s!==i||e)&&`@${s}`||"";if(r!==!1)return`${i}${n}${a}${o}`}}}function jX(t){if(t){if(typeof t=="object"&&!t.tiebreakTo)return"";if(typeof t=="object"&&LE(t.tiebreakTo)){let e=`TB${t.tiebreakTo}${t.NoAD?p6:""}`;return t.modifier&&(e+=`@${t.modifier}`),e}else return!1}}function Do(t){if(ur(t)){let e=t.startsWith("T")&&BX||t.startsWith(nA)&&nA||"";if(e===BX){let i=gve(t),n={simplified:!0,setFormat:i,bestOf:1};if(i)return n}if(e===nA)return Tze(t)}}function Tze(t){let e=t.split("-"),i=lR(e[0].slice(3)),n=i===1||i%2!==0?i:void 0,r=i!==1&&i%2===0?i:void 0,a=e&&GX(e[1]),s=e&&GX(e[2]),o=a&&a.timed||s&&s.timed,l=n&&n<6||o&&r,c=!e[2]||s,u=a,d=Zt({setFormat:a,exactly:r,bestOf:n});if(s&&(d.finalSetFormat=s),l&&u&&c)return d}function GX(t){if((t==null?void 0:t[1])===":"){let e=t.split(":"),i=wze[e[0]],n=e[1];if(i&&n){if(n.startsWith("TB")){let f=HX(n);return f===!1?!1:typeof f=="object"?{tiebreakSet:f}:void 0}if(n.startsWith("T"))return gve(n);let r=t.match(/^[FS]:(\d+)([A-Za-z]*)/),a=r&&vve(r[2])||!1,s=!(r!=null&&r[2])||a,o=r?lR(r[1]):void 0,l=mve(n),c=l!==!1,u=c&&l||o,d=HX(n.split("/")[1]),p=d!==!1,h={setTo:o};return a&&(h.NoAD=!0),d?(h.tiebreakFormat=d,h.tiebreakAt=u):h.noTiebreak=!0,o&&s&&p&&c&&h||!1}}}function mve(t,e=!0){let i=(t==null?void 0:t.indexOf("@"))>0&&t.split("@");if(i)return(e?lR(i[1]):i[1])||!1}function HX(t){if(t)if(t.startsWith("TB")){let e=mve(t,!1),i=t.match(/^TB(\d+)([A-Za-z]*)/),n=i==null?void 0:i[1],r=i&&vve(i[2]),a=!(i!=null&&i[2])||r,s=lR(n);if(s&&a){let o={tiebreakTo:s};return e&&typeof e=="string"&&!wi(e)&&(o.modifier=e),r&&(o.NoAD=!0),o}else return!1}else return!1}function gve(t){var e;let i=t.slice(1),n=i.match(/^(\d+)(@?[A-Za-z]*)/),r=lR(n==null?void 0:n[1]);if(!r)return;let a={timed:!0,minutes:r},s=n==null?void 0:n[2],o=[void 0,"P","G"].includes(s);if(s&&!o){let l=(e=i.match(/^(\d+)(@)([A-Za-z]+)$/))==null?void 0:e[3];return l?(a.modifier=l,a):void 0}return s&&(a.based=n[2]),a}function vve(t){return t&&t.indexOf(p6)>=0}function lR(t){return isNaN(Number(t))?0:Number(t)}function Ll({matchUpFormat:t}){if(!ur(t)||t==="")return!1;let e=Do(t),i=t.match(/-S:([1-9])+\/TB([0-9]{1,2})@?([1-9]?)*/),n=i==null?void 0:i[1],r=i==null?void 0:i[2],a=i==null?void 0:i[3],s=t.match(/-F:([1-9])+\/TB([0-9]{1,2})@?([1-9]?)*/),o=s==null?void 0:s[1],l=s==null?void 0:s[2],c=s==null?void 0:s[3];return $L(e,!!(i&&r&&n===a||s&&l&&o===c))===t}var x_=/^[\d]{4}-(0[1-9]|1[0-2])-(0[1-9]|[1-2][\d]|3[0-1])$/,yve=/^((0[\d]|1[\d]|2[0-3]):[0-5][\d](:[0-5][\d])?)([.,][0-9]{3})?$/,_p=/^([\d]{4}-(0[1-9]|1[0-2])-(0[1-9]|[1-2][\d]|3[0-1]))([ T](0[\d]|1[\d]|2[0-3]):[0-5][\d](:[0-5][\d])?)?([.,][\d]{3})?Z?$/,Fv=/^([\d]{4}-(0[1-9]|1[0-2])-(0[1-9]|[1-2][\d]|3[0-1]))?([ T]?(0[\d]|1[\d]|2[0-3]):[0-5][\d](:[0-5][\d])?)?([.,][\d]{3})?Z?$/;function O_(t){let{scheduledDate:e}=t;if(!e&&t.scheduledTime&&(e=Mi(t.scheduledTime)),!e)return;let i=sr(t.scheduledTime),n=Mi(e);return n&&i&&(n+=`T${i}`),n}function Uze(t){return typeof t!="object"||Array.isArray(t)?!1:Object.prototype.toString.call(t)==="[object Date]"}function FU(t){let e=typeof t=="string"?t==null?void 0:t.split(" "):[];return t&&(e==null?void 0:e.length)>1&&!["AM","PM"].includes(e[1].toUpperCase())?!1:!!(!t||Fv.test(Tw(t,!0,!0)))}function Cl(t){return hy(t)||x_.test(t)}function Dze(t){let e=new Date(t),i=e.getSeconds()+60*e.getMinutes()+60*60*e.getHours();return Eze(i,{displaySeconds:!1})}function Eze(t,e){let i=parseInt(t,10),n=Math.floor(i/3600),r=Math.floor((i-n*3600)/60),a=i-n*3600-r*60;return(!e||e!=null&&e.displaySeconds?n+":"+r+":"+a:n+":"+r).split(":").map(Fc).join(":")}var h6=t=>{let e=FE(t)||hy(t)?new Date(t):new Date,i=e.getUTCMonth()+1,n=i<10?`0${i}`:`${i}`;return`${e.getUTCFullYear()}-${Fc(n)}-${Fc(e.getUTCDate())}`};function Pze(t){let e=FE(t)||hy(t)?new Date(t):new Date;return Date.UTC(e.getFullYear(),e.getMonth(),e.getDate())}function Lu(t,e="-",i="YMD"){if(!t)return"";typeof t=="string"&&t.indexOf("T")<0&&(t=t+"T00:00");let n=new Date(t),r=""+(n.getMonth()+1),a=""+n.getDate(),s=n.getFullYear();return r.length<2&&(r="0"+r),a.length<2&&(a="0"+a),i==="DMY"?[a,r,s].join(e):i==="MDY"?[r,a,s].join(e):i==="YDM"?[s,a,r].join(e):i==="DYM"?[a,s,r].join(e):i==="MYD"?[r,s,a].join(e):[s,r,a].join(e)}function L_(t){let e=t?new Date(t):new Date,i=e.getTimezoneOffset();return new Date(e.getTime()-i*60*1e3)}function Cze(t){return L_(t).getTime()}function FE(t){if(typeof t=="boolean")return!1;let e=t instanceof Date&&t||!isNaN(t)&&new Date(t)||!1;return e&&!isNaN(e.valueOf())}function oT(t,e){if(!Cl(t)||!Cl(e))return[];let i=Mi(t)+"T00:00",n=Mi(e)+"T00:00",r=new Date(i),a=new Date(n),s=FE(a)&&FE(r)&&c(r,a),o=[],l=0;if(s){let u=r,d=u.getTime();for(;d<=a.getTime()&&l<300;)l+=1,o.push(new Date(u)),d=u.setDate(u.getDate()+1)}return o.map(u=>Lu(u));function c(u,d){return u<=d}}var Rze=/^([+-]?\d{4}(?!\d{2}\b))((-?)((0[1-9]|1[0-2])(\3([12]\d|0[1-9]|3[01]))?|W([0-4]\d|5[0-2])(-?[1-7])?|(00[1-9]|0[1-9]\d|[12]\d{2}|3([0-5]\d|6[1-6])))([T\s]((([01]\d|2[0-3])((:?)[0-5]\d)?|24:?00)([.,]\d+(?!:))?)?(\17[0-5]\d([.,]\d+)?)?([zZ]|([+-])([01]\d|2[0-3]):?([0-5]\d)?)?)?)?$/;function hy(t){return typeof t!="string"?!1:Rze.test(t)}function f6(t){if(typeof t!="string")return!1;let e=t.split("Z")[0].split(":"),i=e.every(n=>!isNaN(parseInt(n)));return!(e.length<2||!i||parseInt(e[0])>23||parseInt(e[1])>60)}function sn(t){let e=sr(t);if(!e)return 0;let[i,n]=e.split(":").map(r=>parseInt(r));return i*60+n}function Mze(t){let e=Math.floor(t/60),i=t-e*60;return e>23&&(e=e%24),[Fc(e),Fc(i)].join(":")}function F_(t){return f6(t)?t.split(":").slice(0,2).map(Fc).join(":"):void 0}function sr(t){return hy(t)&&t.indexOf("T")>0?F_(t.split("T").reverse()[0]):F_(t)}function Mi(t){return hy(t)||_p.test(t)?t.split("T")[0]:void 0}function W1(t,e){let i=new Date(t);return i.setDate(i.getDate()+e),Mi(i.toISOString())}function $_(t){t=typeof t!="string"?"00:00":t;let e={},i={};return{0:e.time,1:e.ampm}=t.split(" ")||[],{0:i.hours,1:i.minutes}=e.time.split(":")||[],i.ampm=e.ampm,isNaN(i.hours)||isNaN(i.minutes)||i.ampm&&!["AM","PM"].includes(i.ampm.toUpperCase())?{}:i}function Nze(t){let e=$_(t);return e.ampm&&e.hours&&(e.ampm.toLowerCase()==="pm"&&parseInt(e.hours)<12&&(e.hours=(e.hours&&parseInt(e.hours)||0)+12),e.ampm.toLowerCase()==="am"&&e.hours==="12"&&(e.hours="00")),`${e.hours||"12"}:${e.minutes||"00"}`.split(":").map(Fc).join(":")}function Aze(t){var e;let i=$_(t);if(!(typeof i=="object"&&!Object.keys(i).length))return i.ampm?t:(i.hours>12?(i.hours-=12,i.ampm="PM"):i.hours==="12"?i.ampm="PM":(i.hours==="00"&&(i.hours="12"),i.ampm="AM"),((e=i.hours)==null?void 0:e[0])==="0"&&(i.hours=i.hours.slice(1)),`${i.hours||"12"}:${i.minutes||"00"} ${i.ampm}`)}function Tw(t,e,i){let n=Mi(t),r=sr(t),a=n?r:t;return t?e&&(n&&i&&t||Nze(a))||Aze(a):void 0}function bve(t,e){let i=$_(t),n=$_(e);if(parseInt(i.hours)<parseInt(n.hours))return-1;if(parseInt(i.hours)>parseInt(n.hours))return 1;if(i.hours===n.hours){if(parseInt(i.minutes)<parseInt(n.minutes))return-1;if(parseInt(i.minutes)>parseInt(n.minutes))return 1}return 0}function m6(t,e=7){let i=Mi(t)+"T00:00",n=new Date(i),r=new Date(n.setDate(n.getDate()+e));return Lu(r)}function _ze(t){return m6(t)}function kze(t,e,i,n=!1){let r=new Date(e,0,1+(t-1)*7),a=n?0:1;return r.setDate(r.getDate()+(a-r.getDay())),Lu(r,i)}function xze(t,e,i){let n=new Date(t,0);return Lu(new Date(n.setDate(e)),i)}function Xr(t,e=void 0){let[i,n]=(t||"00:00").split(":").map(Fc),r=L_(e).setHours(i,n,0,0);return L_(r)}function cR(t,e,i=!0){let n=new Date(t),r=(new Date(e).getTime()-n.getTime())/1e3/60;return i?Math.abs(Math.round(r)):Math.round(r)}function nl(t,e){let i=sr(t);if(!i)return"00:00";let n=isNaN(e)?0:e;return sr(g6(Xr(i),n).toISOString())}function g6(t,e){let i=new Date(t);return new Date(i.getTime()+e*6e4)}function Fc(t){return t.toString()[1]?t:"0"+t}function Gh(t,e){let i=new Date(t),n=new Date(e);return i.getFullYear()===n.getFullYear()&&i.getMonth()===n.getMonth()&&i.getDate()===n.getDate()}var Ive={addDays:m6,addWeek:_ze,addMinutesToTimeString:nl,convertTime:Tw,getIsoDateString:O_,getUTCdateString:h6,DateHHMM:Dze,extractDate:Mi,extractTime:sr,formatDate:Lu,getDateByWeek:kze,isISODateString:hy,isDate:FE,isTimeString:f6,offsetDate:L_,offsetTime:Cze,sameDay:Gh,timeStringMinutes:sn,timeToDate:Xr,timeUTC:Pze,validTimeValue:FU,validDateString:x_,timeValidation:Fv,dateValidation:_p},Oze=(t,e)=>t.filter(Boolean).every(i=>typeof i===e),Lze=t=>t.filter(Boolean).every(Er);function SI(t){let e=t.category;if(typeof e!="object")return{error:_E};let{ageCategoryCode:i,ageMaxDate:n,ageMinDate:r,ageMax:a,ageMin:s}=e,o=e.categoryName,l;if(!Oze([i,n,r,o],"string")||!Lze([a,s]))return{error:_E};let c=t.consideredDate??Mi(new Date().toLocaleDateString("sv"));if(!Cl(c))return{error:Va};let[u]=c.split("-").slice(0,3).map($=>parseInt($)),d=W1(c,-1),[p,h]=d.split("-").slice(1,3).map($=>parseInt($)),f=`${Fc(p)}-${Fc(h)}`,m=W1(c,1),[g,v]=m.split("-").slice(1,3).map($=>parseInt($)),y=`${Fc(g)}-${Fc(v)}`,b=s&&W1(c,-1*365*s),I=a&&W1(c,-1*365*a),T=[],w=$=>!T.includes($)&&T.push($);i=i??o;let S=/^([UO]?)(\d{1,2})([UO]?)$/,U=/^C(\d{1,2})-(\d{1,2})$/,P=i==null?void 0:i.includes("-"),E=P&&(i==null?void 0:i.match(U)),R=i==null?void 0:i.match(S),C=($,F)=>`${$}-${F}`,M=$=>{let F=u-$,V=C(F,y);e.ageMinDate&&e.ageMinDate!==V&&w(`Invalid submitted ageMinDate: ${r}`),r=V,i&&(e.ageMax&&e.ageMax!==$-1&&(w(`Invalid submitted ageMax: ${a}`),I=void 0),a=$-1)},_=$=>{let F=u-$-1,V=C(F,y);e.ageMin&&e.ageMin>$&&w(`Invalid submitted ageMin: ${s}`),e.ageMax&&e.ageMax>$&&w(`Invalid submitted ageMax: ${a}`),e.ageMinDate&&e.ageMinDate!==V&&w(`Invalid submitted ageMinDate: ${r}`),r=V,i&&(e.ageMax&&e.ageMax!==$&&(w(`Invalid submitted ageMax: ${a}`),b=void 0),a=$)},A=$=>{let F=u-$,V=C(F,f);e.ageMaxDate&&e.ageMaxDate!==V&&w(`Invalid submitted ageMaxDate: ${n}`),n=V,i&&(e.ageMin&&e.ageMin!==$+1&&(w(`Invalid submitted ageMin: ${s}`),b=void 0),s=$+1)},N=$=>{let F=u-$-1,V=C(F,f);e.ageMaxDate&&e.ageMaxDate!==V&&w(`Invalid submitted ageMaxDate: ${n}`),n=V,i&&(e.ageMin&&e.ageMin!==$&&(w(`Invalid submitted ageMin: ${s}`),b=void 0),s=$)},k=$=>{let[F,V,j]=($.match(S)||[]).slice(1),B=parseInt(V);F==="U"?(e.ageMaxDate&&e.ageMaxDate!==n&&w(`Invalid submitted ageMaxDate: ${e.ageMaxDate}`),M(B)):F==="O"&&A(B),j==="U"?(e.ageMaxDate&&e.ageMaxDate!==n&&w(`Invalid submitted ageMaxDate: ${e.ageMaxDate}`),_(B)):j==="O"&&N(B),n=n??b,r=r??I};if(E){if(n=void 0,r=void 0,a=void 0,s=void 0,e.ageMin){let V=u-e.ageMin;n=C(V,f)}if(e.ageMax){let V=u-e.ageMax-1;r=C(V,y)}let[$,F]=((i==null?void 0:i.match(U))??[]).slice(1).map(V=>parseInt(V));$<=F?(s=$,a=F,l=!0):w(`Invalid combined age range ${i}`)}else P?i==null||i.split("-").forEach(k):R?k(i):(s&&A(s),a&&_(a));a&&e.ageMin&&e.ageMin>a&&(w(`Invalid submitted ageMin: ${e.ageMin}`),s=void 0);let O=Zt({consideredDate:c,combinedAge:l,ageMaxDate:n,ageMinDate:r,ageMax:a,ageMin:s});return T.length&&(O.errors=T),O}function $E({category:t}){if(!tn(t))return{error:Ae};let e=SI({category:t});if(e.error)return{error:e};let{ratingMax:i,ratingMin:n}=t;return i&&!Er(i)?fe({result:{error:Ae},context:{ratingMax:i}}):n&&!Er(n)?fe({result:{error:Ae},context:{ratingMin:n}}):{...e}}function uR({childCategory:t,withDetails:e,category:i}){let n=$E({category:i}),r=$E({category:t}),a=r.ageMin&&(n.ageMin&&r.ageMin<n.ageMin||n.ageMax&&r.ageMin>n.ageMax),s=r.ageMax&&(n.ageMax&&r.ageMax>n.ageMax||n.ageMin&&r.ageMax<n.ageMin),o=r.ageMinDate&&n.ageMaxDate&&new Date(r.ageMinDate)>new Date(n.ageMaxDate),l=r.ageMaxDate&&n.ageMinDate&&new Date(r.ageMaxDate)<new Date(n.ageMinDate),c=(i==null?void 0:i.ratingType)&&(t==null?void 0:t.ratingType)&&i.ratingType===t.ratingType&&(i.ratingMin&&t.ratingMin&&t.ratingMin<i.ratingMin||i.ratingMax&&t.ratingMax&&t.ratingMax>i.ratingMax||i.ratingMin&&t.ratingMax&&t.ratingMax<i.ratingMin||i.ratingMax&&t.ratingMin&&t.ratingMin>i.ratingMax),u=(i==null?void 0:i.ballType)&&(t==null?void 0:t.ballType)&&i.ballType!==t.ballType,d=Zt({invalidRatingRange:c,invalidAgeMinDate:o,invalidAgeMaxDate:l,invalidBallType:u,invalidAgeMax:s,invalidAgeMin:a,valid:!c&&!o&&!l&&!u&&!s&&!a},!0);return e&&Object.assign(d,{categoryDetails:n,childCategoryDetails:r}),d}function dR({checkCategory:t=!0,collectionDefinition:e,checkCollectionIds:i,checkGender:n=!0,referenceCategory:r,referenceGender:a,event:s}){a=a??(s==null?void 0:s.gender);let o="validateCollectionDefinition",l=[];if(typeof e!="object")return l.push(`collectionDefinition must be an object: ${e}`),fe({result:{errors:l,error:Pm},stack:o});let{collectionValueProfiles:c,collectionGroupNumber:u,collectionValue:d,collectionId:p,matchUpCount:h,matchUpFormat:f,matchUpValue:m,matchUpType:g,scoreValue:v,setValue:y,category:b,gender:I}=e;if(i&&typeof p!="string"&&l.push(`collectionId is not type string: ${p}`),typeof h!="number"&&l.push(`matchUpCount is not type number: ${h}`),g&&!IL([On,Nn],g)&&l.push(`matchUpType must be SINGLES or DOUBLES: ${g}`),[!!(c!=null&&c.length)].concat([m,d,v,y].map(wi)).filter(Boolean).length!==1&&l.push("Missing value definition for matchUps: matchUpValue, collectionValue, or collectionValueProfiles"),m&&typeof m!="number"&&l.push(`matchUpValue is not type number: ${m}`),d&&typeof d!="number"&&l.push(`collectionValue is not type number: ${d}`),c&&h){let T=Yme({collectionValueProfiles:c,matchUpCount:h});T.errors&&l.push(...T.errors)}if(u&&typeof u!="number"&&l.push(`collectionGroupNumber is not type number: ${d}`),f&&!Ll({matchUpFormat:f})&&l.push(`Invalid matchUpFormat: ${f}`),n){let T=FL({referenceGender:a,matchUpType:g,gender:I});if(T.error)return fe({context:{referenceGender:a,gender:I},result:T,stack:o})}if(t&&r&&b){let T=uR({category:r,childCategory:b});if(!T.valid)return fe({result:{error:_E},context:T,stack:o})}return l.length?fe({result:{errors:l,error:Kge},stack:o}):{valid:!0}}function Go(t){var e,i,n,r;let a=!!((t==null?void 0:t.enforceCategory)!==!1&&t!=null&&t.category),s=!!((t==null?void 0:t.enforceGender)!==!1&&t!=null&&t.gender),o=t==null?void 0:t.checkCollectionIds,l=t==null?void 0:t.tieFormat,c=t==null?void 0:t.event,u="validateTieFormat",d=[],p=Fze({...t,stack:u});if(p!=null&&p.error)return p;let h,f=l.collectionDefinitions.every(b=>{let{setValue:I,scoreValue:T,collectionValue:w}=b;(I||T)&&!w&&(h=!0);let{valid:S,errors:U}=dR({referenceCategory:t.category,referenceGender:t.gender,collectionDefinition:b,checkCollectionIds:o,checkCategory:a,checkGender:s,event:c});return S?!0:(Array.isArray(U)&&d.push(...U),!1)}),m=typeof((e=l.winCriteria)==null?void 0:e.valueGoal)=="number"&&((i=l.winCriteria)==null?void 0:i.valueGoal)>0&&!h||((n=l.winCriteria)==null?void 0:n.aggregateValue);if(!(m||(r=l.winCriteria)!=null&&r.aggregateValue))return h?d.push("aggregateValue is required"):d.push("Either non-zero valueGoal, or { aggregateValue: true } must be specified in winCriteria"),fe({context:{tieFormat:l,errors:d,aggregateValueImperative:h},result:{error:Eh},stack:u});let g=l.collectionDefinitions.map(({collectionId:b})=>b),v=!o||g.length===Pi(g).length,y=f&&m&&v;return y?{valid:y,errors:d}:fe({result:{error:Eh},context:{tieFormat:l,errors:d},stack:u})}function Fze(t){let{tieFormat:e,stack:i}=t;return!t||!e||!tn(e)?fe({result:{error:Eh},context:{tieFormat:e,message:"tieformat must be an object"},stack:i}):tn(e.winCriteria)?Array.isArray(e.collectionDefinitions)?{...pe}:fe({result:{error:Eh},context:{tieFormat:e,message:"collectionDefinitions must be an array"},stack:i}):fe({result:{error:Eh},context:{tieFormat:e,message:"tieformat.winCritiera must be an object"},stack:i})}var lT="resourceSubType",cT="resourceType",uT="identifier",$ze={RESOURCE_SUB_TYPE:lT,RESOURCE_TYPE:cT,IDENTIFIER:uT};function $t(t,e,i,n,r=0){if(Gj().makeDeepCopy)return Gj().makeDeepCopy(t,e,i,n);let a=o6(),{stringify:s,toJSON:o,ignore:l,modulate:c}=a||{};if(!(a!=null&&a.enabled)&&!i||typeof t!="object"||Sl(t)||t===null||typeof(a==null?void 0:a.threshold)=="number"&&r>=a.threshold)return t;let u=Array.isArray(t)?[]:{},d=Object.keys(t).filter(h=>!i||!l||Array.isArray(l)&&!l.includes(h)||Sl(l)&&!l(h)),p=(h,f)=>{u[h]=Sl(f==null?void 0:f.toString)?f.toString():JSON.stringify(f)};for(let h of d){let f=t[h],m=Sl(c)?c(f):void 0;if(m!==void 0)u[h]=m;else if(e&&h==="extensions"&&Array.isArray(f)){let g=v6(f);Object.assign(u,...g)}else n&&h==="extensions"?u[h]=[]:Array.isArray(s)&&s.includes(h)?p(h,f):Array.isArray(o)&&o.includes(h)&&Sl(f==null?void 0:f.toJSON)?u[h]=f.toJSON():f===null?u[h]=void 0:Uze(f)?u[h]=new Date(f).toISOString():u[h]=$t(f,e,i,n,r+1)}return u}function v6(t){return t==null?void 0:t.map(e=>{let{name:i,value:n}=e;return i&&n&&{[`_${i}`]:n}}).filter(Boolean)}function wve(t=1,e){return Mt(0,t).map(()=>bn(e))}function bn(t){let e=[];for(let o=0;o<256;o++)e[o]=(o<16?"0":"")+o.toString(16);let i=Math.random()*4294967295|0,n=Math.random()*4294967295|0,r=Math.random()*4294967295|0,a=Math.random()*4294967295|0,s=e[i&255]+e[i>>8&255]+e[i>>16&255]+e[i>>24&255]+"-"+e[n&255]+e[n>>8&255]+"-"+e[n>>16&15|64]+e[n>>24&255]+"-"+e[r&63|128]+e[r>>8&255]+"-"+e[r>>16&255]+e[r>>24&255]+e[a&255]+e[a>>8&255]+e[a>>16&255]+e[a>>24&255];return typeof t=="string"?`${t}_${s.replace(/-/g,"")}`:s}var Sve={collectionDefinitions:[{collectionName:"Male Singles",matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpCount:4,matchUpValue:1,gender:"MALE"},{collectionName:"Female Singles",matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",gender:"FEMALE",matchUpCount:4,matchUpValue:1},{collectionName:"Male Doubles",matchUpFormat:"SET1-S:8/TB7@7",matchUpType:"DOUBLES",matchUpCount:2,matchUpValue:1,gender:"MALE"},{collectionName:"Female Doubles",matchUpFormat:"SET1-S:8/TB7@7",matchUpType:"DOUBLES",gender:"FEMALE",matchUpCount:2,matchUpValue:1},{collectionName:"Mixed Doubles",matchUpFormat:"SET1-S:8/TB7@7",matchUpType:"DOUBLES",matchUpCount:4,matchUpValue:1,gender:"MIXED"}],tieFormatName:"USTA_GOLD_TEAM_CHALLENGE",winCriteria:{valueGoal:9}},Tve={collectionDefinitions:[{collectionName:"Round 1",matchUpCount:3,matchUpFormat:"SET1-S:T20",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Round 2",matchUpCount:3,matchUpFormat:"SET1-S:T20",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Round 3",matchUpCount:3,matchUpFormat:"SET1-S:T20",matchUpType:"DOUBLES",scoreValue:1}],tieFormatName:"Doubles Shuffle",unrestrictedSelections:!0,winCriteria:{aggregateValue:!0}},Uve={collectionDefinitions:[{collectionName:"Male Singles",gender:"MALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Female Singles",gender:"FEMALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Mixed Doubles",gender:"MIXED",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1}],tieFormatName:"USTA_SOUTHERN_LEVEL_5",winCriteria:{valueGoal:8}},Dve={collectionDefinitions:[{category:{ageCategoryCode:"16U"},collectionName:"16U Singles",matchUpCount:4,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Singles",matchUpCount:4,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1},{category:{ageCategoryCode:"16U"},collectionName:"16U Doubles",matchUpCount:2,matchUpFormat:"SET1-S:6/TB7",matchUpType:"DOUBLES",matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Doubles",matchUpCount:2,matchUpFormat:"SET1-S:6/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Tiebreak Doubles",matchUpCount:1,matchUpFormat:"SET1-S:TB10",matchUpType:"DOUBLES",matchUpValue:1,processCodes:["RANKING.IGNORE"]}],tieFormatName:"USTA_SECTION_BATTLE",winCriteria:{valueGoal:9}},Eve={collectionDefinitions:[{collectionName:"Male Singles",gender:"MALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Female Singles",gender:"FEMALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Male Doubles",gender:"MALE",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Female Doubles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Mixed Doubles",gender:"MIXED",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1}],tieFormatName:"USTA_INTERSECTIONAL",winCriteria:{valueGoal:8}},Pve={collectionDefinitions:[{scoreValue:1,matchUpType:"SINGLES",collectionName:"Men's Singles",matchUpFormat:"SET1-S:T60",gender:"MALE",matchUpCount:1},{scoreValue:1,matchUpType:"SINGLES",collectionName:"Women's Singles",matchUpFormat:"SET1-S:T60",gender:"FEMALE",matchUpCount:1},{matchUpValue:1,matchUpType:"DOUBLES",collectionName:"Mixed Doubles",matchUpFormat:"SET1-S:T60",gender:"MIXED",matchUpCount:1}],tieFormatName:"Time Tennis Pro Circuit",winCriteria:{aggregateValue:!0}},Cve={collectionDefinitions:[{collectionName:"Mixed Doubles",gender:"MIXED",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Male Singles",matchUpCount:1,gender:"MALE",matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Female Singles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"DOMINANT_DUO_MIXED",winCriteria:{valueGoal:2}},Rve={collectionDefinitions:[{scoreValue:1,matchUpType:"SINGLES",collectionName:"Men's Singles",matchUpFormat:"SET1-S:T60",gender:"MALE",matchUpCount:3},{scoreValue:1,matchUpType:"SINGLES",collectionName:"Women's Singles",matchUpFormat:"SET1-S:T60",gender:"FEMALE",matchUpCount:3},{scoreValue:1,matchUpType:"DOUBLES",collectionName:"Men's Doubles",matchUpFormat:"SET1-S:T60",gender:"MALE",matchUpCount:1},{matchUpValue:1,matchUpType:"DOUBLES",collectionName:"Women's Doubles",matchUpFormat:"SET1-S:T60",gender:"FEMALE",matchUpCount:1},{matchUpValue:1,matchUpType:"DOUBLES",collectionName:"Mixed Doubles",matchUpFormat:"SET1-S:T60",gender:"MIXED",matchUpCount:1}],tieFormatName:"Time Tennis Dual",winCriteria:{aggregateValue:!0}},Mve={collectionDefinitions:[{category:{ageCategoryCode:"14U"},collectionName:"14U Singles",matchUpCount:2,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{category:{ageCategoryCode:"16U"},collectionName:"16U Singles",matchUpCount:2,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Singles",matchUpCount:2,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{category:{ageCategoryCode:"14U"},collectionName:"14U Doubles",collectionGroupNumber:1,matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{category:{ageCategoryCode:"16U"},collectionName:"16U Doubles",collectionGroupNumber:1,matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Doubles",collectionGroupNumber:1,matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1}],collectionGroups:[{groupNumber:1,groupName:"Doubles",groupValue:1,winCriteria:{valueGoal:2}}],tieFormatName:"USTA_BREWER_CUP",winCriteria:{valueGoal:4}},Nve={winCriteria:{valueGoal:23},tieFormatName:"USTA_OZAKI_CUP",collectionDefinitions:[{category:{ageCategoryCode:"18U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"18U Boys Singles",matchUpType:"SINGLES",matchUpCount:3,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"18U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"18U Girls Singles",matchUpType:"SINGLES",gender:"FEMALE",matchUpCount:3,matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Boys Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",matchUpCount:1,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"18U"},collectionName:"18U Girls Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"FEMALE",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Mixed Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"MIXED",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"16U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"16U Boys Singles",matchUpType:"SINGLES",matchUpCount:3,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"16U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"16U Girls Singles",matchUpType:"SINGLES",gender:"FEMALE",matchUpCount:3,matchUpValue:1},{category:{ageCategoryCode:"16U"},collectionName:"16U Boys Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",matchUpCount:1,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"16U"},collectionName:"16U Girls Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"FEMALE",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"16U"},collectionName:"16U Mixed Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"MIXED",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"14U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"14U Boys Singles",matchUpType:"SINGLES",matchUpCount:3,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"14U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"14U Girls Singles",matchUpType:"SINGLES",gender:"FEMALE",matchUpCount:3,matchUpValue:1},{category:{ageCategoryCode:"14U"},collectionName:"14U Boys Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",matchUpCount:1,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"14U"},collectionName:"14U Girls Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"FEMALE",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"14U"},collectionName:"14U Mixed Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"MIXED",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"12U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"12U Boys Singles",matchUpType:"SINGLES",matchUpCount:3,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"12U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"12U Girls Singles",matchUpType:"SINGLES",gender:"FEMALE",matchUpCount:3,matchUpValue:1},{category:{ageCategoryCode:"12U"},collectionName:"12U Boys Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",matchUpCount:1,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"12U"},collectionName:"12U Girls Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"FEMALE",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"12U"},collectionName:"12U Mixed Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"MIXED",matchUpCount:1,matchUpValue:1}]},Fu="SET3-S:6/TB7",Bze="SET3-S:6NOAD",Ave="SET3-S:6/TB7-F:TB10",Vze="SET3-S:4/TB7",jze="SET3-S:4/TB5@3",Gze="SET1-S:T20",Hze="SET1-S:8/TB7",zze="SET1-S:8/TB7@7",qze={FORMAT_STANDARD:Fu,FORMAT_STANDARD_NOAD:Bze,FORMAT_ATP_DOUBLES:Ave,FORMAT_SHORT_SETS:Vze,FORMAT_FAST4:jze,FORMAT_PRO_SET:Hze,FORMAT_COLLEGE_PRO_SET:zze,TIMED20:Gze},_ve={collectionDefinitions:[{collectionName:"Doubles",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Singles",matchUpCount:2,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"DOMINANT_DUO",winCriteria:{valueGoal:2}},kve={collectionDefinitions:[{collectionName:"Doubles",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7@7",matchUpType:"DOUBLES",collectionValue:1},{collectionName:"Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"USTA_COLLEGE",winCriteria:{valueGoal:4}},xve={collectionDefinitions:[{collectionName:"Male Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Female Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Male Doubles",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Female Doubles",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1}],tieFormatName:"USTA_LEVEL_1",winCriteria:{valueGoal:10}},Ove={collectionDefinitions:[{collectionName:"Female Doubles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Male Doubles",gender:"MALE",matchUpCount:1,matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Female Singles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"SINGLES",scoreValue:1},{collectionName:"Male Singles",matchUpCount:1,gender:"MALE",matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"SINGLES",scoreValue:1},{collectionName:"Mixed Doubles",matchUpCount:1,gender:"MIXED",matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Mixed Doubles",matchUpCount:1,gender:"MIXED",matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Overtime",matchUpCount:1,gender:"MIXED",matchUpFormat:"SET1-S:T20",matchUpType:"DOUBLES",scoreValue:1}],tieFormatName:"USTA_WTT_ITT",winCriteria:{aggregateValue:!0}},Lve={collectionDefinitions:[{collectionName:"Male Singles",gender:"MALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Female Singles",gender:"FEMALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Male Doubles",gender:"MALE",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Female Doubles",gender:"FEMALE",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Mixed Doubles",gender:"MIXED",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1}],tieFormatName:"USTA_ZONAL",winCriteria:{valueGoal:10}},Fve={collectionDefinitions:[{collectionGroupNumber:1,matchUpType:"DOUBLES",matchUpCount:1,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:1},{collectionGroupNumber:1,matchUpType:"SINGLES",matchUpCount:3,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:1},{collectionGroupNumber:2,matchUpType:"DOUBLES",matchUpCount:1,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:2},{collectionGroupNumber:2,matchUpType:"SINGLES",matchUpCount:3,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:2},{collectionGroupNumber:3,matchUpType:"DOUBLES",matchUpCount:1,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:3},{collectionGroupNumber:3,matchUpType:"SINGLES",matchUpCount:3,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:3}],collectionGroups:[{groupNumber:1,groupName:"Day 1"},{groupNumber:2,groupName:"Day 2"},{groupNumber:3,groupName:"Day 3"}],tieFormatName:"LAVER_CUP",winCriteria:{valueGoal:13}},$ve={collectionDefinitions:[{collectionName:"Female Doubles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Male Doubles",gender:"MALE",matchUpCount:1,matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Female Singles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"SINGLES",scoreValue:1},{collectionName:"Male Singles",matchUpCount:1,gender:"MALE",matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"SINGLES",scoreValue:1},{collectionName:"Mixed Doubles",matchUpCount:1,gender:"MIXED",matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Overtime",matchUpCount:1,gender:"MIXED",matchUpFormat:"SET1-S:T20",matchUpType:"DOUBLES",scoreValue:1}],tieFormatName:"USTA_TOC",winCriteria:{aggregateValue:!0}},B_="COLLEGE_DEFAULT",Hj="COLLEGE_JUCO",zj="COLLEGE_D3",Bve="DOMINANT_DUO",Vve="DOMINANT_DUO_MIXED",jve="LAVER_CUP",Gve="TEAM_DOUBLES_3_AGGREGATION",Hve="TIME_TENNIS_DUAL",zve="TIME_TENNIS_PRO_CIRCUIT",qve="USTA_BREWER_CUP",Wve="USTA_OZAKI_CUP",Yve="USTA_COLLEGE",Kve="USTA_GOLD_TEAM_CHALLENGE",Zve="USTA_LEVEL_1",Xve="USTA_INTERSECTIONAL",Jve="USTA_SECTION_BATTLE",Qve="USTA_SOUTHERN_LEVEL_5",eye="USTA_TOC",tye="USTA_WTT_ITT",iye="USTA_ZONAL",Wze={COLLEGE_D3:zj,COLLEGE_DEFAULT:B_,COLLEGE_JUCO:Hj,DOMINANT_DUO:Bve,DOMINANT_DUO_MIXED:Vve,LAVER_CUP:jve,TEAM_DOUBLES_3_AGGREGATION:Gve,TIME_TENNIS_DUAL:Hve,TIME_TENNIS_PRO_CIRCUIT:zve,USTA_BREWER_CUP:qve,USTA_OZAKI_CUP:Wve,USTA_COLLEGE:Yve,USTA_GOLD_TEAM_CHALLENGE:Kve,USTA_INTERSECTIONAL:Xve,USTA_LEVEL_1:Zve,USTA_SECTION_BATTLE:Jve,USTA_SOUTHERN_LEVEL_5:Qve,USTA_TOC:eye,USTA_WTT_ITT:tye,USTA_ZONAL:iye},nye="STANDARD",zX={[nye]:{hydrate:!0,doubles:{matchUpCount:3,matchUpValue:1},singles:{matchUpCount:6,matchUpValue:1},valueGoal:5},[zj]:{hydrate:!0,doubles:{matchUpFormat:"SET1-S:8/TB7@7",matchUpCount:3,matchUpValue:1},singles:{matchUpFormat:Fu,matchUpCount:6,matchUpValue:1},tieFormatName:zj,valueGoal:5},[B_]:{hydrate:!0,doubles:{matchUpFormat:"SET1-S:6/TB7",collectionValue:1,matchUpCount:3},singles:{matchUpFormat:Fu,matchUpCount:6,matchUpValue:1},tieFormatName:B_,valueGoal:4},[Hj]:{hydrate:!0,doubles:{matchUpFormat:"SET1-S:8/TB7",matchUpCount:3,matchUpValue:1},singles:{matchUpFormat:Fu,matchUpCount:6,matchUpValue:1},tieFormatName:Hj,valueGoal:5},[jve]:Fve,[Bve]:_ve,[Vve]:Cve,[Gve]:Tve,[Hve]:Rve,[zve]:Pve,[qve]:Mve,[Wve]:Nve,[Yve]:kve,[Kve]:Sve,[Xve]:Eve,[Zve]:xve,[Jve]:Dve,[Qve]:Uve,[tye]:Ove,[eye]:$ve,[iye]:Lve},Yze=t=>{let e=t!=null&&t.namedFormat&&Object.keys(zX).includes(t.namedFormat)?t.namedFormat:nye,i=Array.isArray(t==null?void 0:t.uuids)?t==null?void 0:t.uuids:[],n,{category:r,gender:a}=(t==null?void 0:t.event)??{},s=$t(zX[e],!1,!0),o=l=>{var c,u;if(!(t!=null&&t.isMock)&&!((c=t==null?void 0:t.event)!=null&&c.isMock)||!t.event)return(i==null?void 0:i.pop())??bn();let d=(u=t==null?void 0:t.event)==null?void 0:u.eventId;return i.pop()??`${d}-COL-${l+1}`};return s.hydrate?(n={winCriteria:{valueGoal:s.valueGoal},collectionDefinitions:[{collectionId:o(0),matchUpFormat:Ave,collectionName:"Doubles",matchUpType:Nn,...s.doubles},{collectionId:o(1),matchUpFormat:Fu,collectionName:"Singles",matchUpType:On,...s.singles}]},s.tieFormatName&&(n.tieFormatName=s.tieFormatName)):(s.collectionDefinitions.forEach((l,c)=>l.collectionId=o(c)),n=s),t!=null&&t.hydrateCollections&&n.collectionDefinitions.forEach(l=>{r&&!l.category&&(l.category=r),a&&!l.gender&&(l.gender=a)}),n},em=Yze,kp="SINGLES",TI="SINGLES",Yc="DOUBLES",tm="DOUBLES",aa="TEAM",Fl="TEAM",Kze="AGE",Zze="RATING",Xze="BOTH",Jze={AGE:Kze,BOTH:Xze,DOUBLES:Yc,DOUBLES_EVENT:tm,RATING:Zze,SINGLES:kp,SINGLES_EVENT:TI,TEAM_EVENT:Fl,TEAM:aa},Bt="MAIN",ri="QUALIFYING",ws="CONSOLATION",ja="VOLUNTARY_CONSOLATION",Mr="PLAY_OFF",BL=[Bt,ri,ws,Mr,ja],UI={[ri]:1,[Bt]:2,[Mr]:3,[ws]:3,[ja]:4},rye="finishingPositions",aye="aggregateEventStructures",sye={[Bt]:1,[Mr]:2,[ws]:3,[ri]:4,[ja]:5},Qze={[Mr]:1,[Bt]:2,[ws]:3,[ri]:4,[ja]:5},VL="CLUSTER",eqe="SEPARATE",fy="WATERFALL",jL="ITEM",Eo="CONTAINER",vd="DRAW",GL="RANDOM",Ru="TOP_DOWN",my="BOTTOM_UP",im="POSITION",nm="WINNER",Hh="LOSER",xp="FIRST_MATCHUP",lc="AD_HOC",tqe="AD_HOC",$U="FEED_IN",dT="COMPASS",pT="OLYMPIC",iqe="SINGLE_ELIMINATION",bp="SINGLE_ELIMINATION",pR="DOUBLE_ELIMINATION",hT="FIRST_MATCH_LOSER_CONSOLATION",hR="FIRST_ROUND_LOSER_CONSOLATION",Zy="LUCKY_DRAW",HL="CURTIS_CONSOLATION",nqe="CURTIS_CONSOLATION",y6="FEED_IN_CHAMPIONSHIP_TO_SF",BE="FEED_IN_CHAMPIONSHIP_TO_SF",b6="FEED_IN_CHAMPIONSHIP_TO_QF",VE="FEED_IN_CHAMPIONSHIP_TO_QF",I6="FEED_IN_CHAMPIONSHIP_TO_R16",jE="FEED_IN_CHAMPIONSHIP_TO_R16",oye="MODIFIED_FEED_IN_CHAMPIONSHIP",GE="MODIFIED_FEED_IN_CHAMPIONSHIP",fR="FEED_IN_CHAMPIONSHIP",rqe="DOUBLE_ROUND_ROBIN",Zu="ROUND_ROBIN",zh="ROUND_ROBIN_WITH_PLAYOFF",lye="DECIDER",cye="BACKDRAW",w6={0:{name:"East",abbreviation:"E"},"0-1":{name:"West",abbreviation:"W"},"0-2":{name:"North",abbreviation:"N"},"0-3":{name:"Northeast",abbreviation:"NE"},"0-1-1":{name:"South",abbreviation:"S"},"0-1-2":{name:"Southwest",abbreviation:"SW"},"0-2-1":{name:"Northwest",abbreviation:"NW"},"0-1-1-1":{name:"Southeast",abbreviation:"SE"}},S6={0:{name:"East",abbreviation:"E"},"0-1":{name:"West",abbreviation:"W"},"0-2":{name:"North",abbreviation:"N"},"0-1-1":{name:"South",abbreviation:"S"}},gy="WIN_RATIO",Uw="ROUND_OUTCOME",uye=[dT,HL,VE,jE,BE,fR,b6,I6,y6,hT,hR,Zy,GE,pT,Mr,zh],aqe=[lc,dT,HL,pR,VE,jE,BE,fR,$U,hT,hR,Zy,GE,pT,Mr,Zu,zh,bp],dye={MAIN:Bt,QUALIFYING:ri,CONSOLATION:ws,ITEM:jL,CONTAINER:Eo,FIRST_MATCHUP:xp,WINNER:nm,LOSER:Hh,AD_HOC:lc,FEED_IN:$U,FLEX_ROUNDS:tqe,COMPASS:dT,PLAY_OFF:Mr,OLYMPIC:pT,KNOCKOUT:iqe,SINGLE_ELIMINATION:bp,DOUBLE_ELIMINATION:pR,CURTIS:HL,FICSF:y6,FICQF:b6,FICR16:I6,MFIC:oye,VOLUNTARY_CONSOLATION:ja,FIRST_MATCH_LOSER_CONSOLATION:hT,FIRST_ROUND_LOSER_CONSOLATION:hR,MODIFIED_FEED_IN_CHAMPIONSHIP:GE,FEED_IN_CHAMPIONSHIP_TO_R16:jE,FEED_IN_CHAMPIONSHIP_TO_QF:VE,FEED_IN_CHAMPIONSHIP_TO_SF:BE,FEED_IN_CHAMPIONSHIP:fR,LUCKY_DRAW:Zy,ROUND_ROBIN_WITH_PLAYOFF:zh,ROUND_ROBIN:Zu,DECIDER:lye,BACKDRAW:cye,COMPASS_ATTRIBUTES:w6,OLYMPIC_ATTRIBUTES:S6,DRAW:vd,RANDOM:GL,TOP_DOWN:Ru,BOTTOM_UP:my,WATERFALL:fy,WIN_RATIO:gy,ROUND_OUTCOME:Uw,MULTI_STRUCTURE_DRAWS:uye,generatedDrawTypes:aqe,stageOrder:UI,finishOrder:sye,AGGREGATE_EVENT_STRUCTURES:aye,FINISHING_POSITIONS:rye},sqe=dye,Os="tournamentRecords",T6="policyDefinitions",Ia="tournamentRecord",U6="onlineResource",Po="drawDefinition",pye="tieFormatName",D6="matchUpFormat",qh="participantId",hye="scheduleDates",oqe="tournamentId",lqe="scheduleDate",cqe="roundNumber",zL="structureId",E6="participant",mR="matchUpIds",fye="entryStage",uqe="policyType",mye="structures",P6="eventType",Wp="matchUpId",qL="tieFormat",WL="inContext",YL="structure",KL="courtIds",dqe="personId",ZL="venueIds",C6="matchUps",gye="courtId",vye="eventId",ef="matchUp",yye="drawId",$u="error",Zg="event",BU="param",R6="uuids",pqe="averageMatchUpMinutes",hqe="recoveryMinutes",fqe="periodLength",mqe="number",tl="object",Ms="array",ps="_validate",bye="_message",cc="_invalid",Wo="_ofType",M6="_anyOf",fT="_oneOf",qX={[U6]:t=>Ar(Object.keys(t),[lT,cT,uT]).length===3,[pye]:t=>t&&em({namedFormat:t}),[R6]:t=>!t||Array.isArray(t)&&t.every(ur),[qL]:t=>!Go({tieFormat:t}).error,[P6]:t=>[kp,Yc,aa].includes(t),[fye]:t=>BL.includes(t)},gqe={[Os]:Tr,[Ia]:dt,[T6]:TL,[Po]:Ht,[qh]:da,[D6]:G5,[oqe]:nT,[zL]:mc,[mR]:gw,[E6]:bw,[U6]:Pm,[P6]:jh,[mye]:B5,[Wp]:Zs,[qL]:Eh,[YL]:Yy,[gye]:vw,[C6]:Em,[vye]:Wc,[ef]:ll,[KL]:si,[ZL]:si,[yye]:jd,[Zg]:Qn},vqe={[Os]:tl,[T6]:tl,[Ia]:tl,[Po]:tl,[U6]:tl,[hye]:Ms,[E6]:tl,[mR]:Ms,[mye]:Ms,[qL]:tl,[YL]:tl,[KL]:Ms,[ZL]:Ms,[C6]:Ms,[ef]:tl,[Zg]:tl,[R6]:Ms};function ei(t,e,i){if(!t&&!tn(t))return{error:Ae};if(!(e!=null&&e.length)||t!=null&&t._bypassParamCheck)return{valid:!0};if(!Array.isArray(e))return{error:Ae};let{paramError:n,errorParam:r}=Iqe(t,e);if(!n)return{valid:!0};let a=n[ps]&&(n[$u]||n[cc])||(t==null?void 0:t[r])===void 0&&(n[$u]||n[cc]||gqe[r]||Ae)||Ae,s=r??(n[fT]&&Object.keys(n[fT]).join(", "));return fe({info:{param:s,message:n[bye]},result:{error:a},stack:i})}function Iye(t,e){let i=Object.keys(t),n=Object.keys(e);return Ar(i,n)}function yqe(t,e){if(!e)return;let i=Iye(t,e);return i.length!==1?{error:Ae}:i.reduce((n,r)=>({...n,[r]:!0}),{})}function bqe(t,e){if(!e)return;let i=Iye(t,e).filter(n=>t[n]);return i.length<1?{error:Ae}:i.reduce((n,r)=>({...n,[r]:!0}),{})}function Iqe(t,e){let i,n;return{paramError:e.find(({_ofType:r,_oneOf:a,_anyOf:s,_validate:o,_info:l,...c})=>{let u=a&&yqe(t,a);if(u!=null&&u.error)return u.error;u&&Object.assign(c,u);let d=s&&bqe(t,s);if(d!=null&&d.error)return d.error;d&&Object.assign(c,d);let p=Object.keys(c).filter(f=>typeof c[f]=="boolean"),h=p.find(f=>{let m=o&&!Sl(o),g=t[f]!==void 0&&!o&&wqe(t,f,r),v=c[f]&&[void 0,null].includes(t[f]),y=m||g||v||o&&t[f]!==void 0&&!Sqe(t[f],o)||qX[f]&&!qX[f](t[f]);return y&&(i=f,n=l),y});return!p.length||h}),errorParam:i,paramInfo:n}}function wqe(t,e,i){return i=i||vqe[e]||"string",i==="array"?!Array.isArray(t[e]):typeof t[e]!==i}function Sqe(t,e){return Sl(e)?e(t):!0}var N6="DYNAMIC",bg="RANKING",rg="RATING",vy="SCALE",Ph="SEEDING",Tqe={RANKING:bg,RATING:rg,SCALE:vy,SEEDING:Ph};function VU(t){var e;let i=ei(t,[{[E6]:!0}]);if(i.error)return i;let n=(e=t.participant.timeItems)==null?void 0:e.filter(({itemType:a})=>(a==null?void 0:a.startsWith(vy))&&[bg,rg,Ph].includes(a.split(".")[1])),r={ratings:{},rankings:{},seedings:{}};if(n!=null&&n.length){let a=o=>n.filter(l=>(l==null?void 0:l.itemType)===o).sort((l,c)=>new Date(l.createdAt||void 0).getTime()-new Date(c.createdAt||void 0).getTime()).pop(),s=Pi(n.map(({itemType:o})=>o));for(let o of s){let l=a(o);if(l){let[,c,u,d,p]=l.itemType.split("."),h=p?`${d}.${p}`:d,f=c===Ph&&"seedings"||c===bg&&"rankings"||"ratings";r[f][u]||(r[f][u]=[]),r[f][u].push({scaleValue:l.itemValue,scaleDate:l.itemDate,scaleName:h})}}}return{...pe,...r}}function DI(t){if(t===null)return{};let{source:e,template:i}=t||{};if(!i)return e;let n={};return r(e,i,n),n;function r(a,s,o){if(!a||!s)return;let l=Object.keys(a),c=Object.keys(s),u=Object.assign({},...c.filter(h=>h.indexOf("||")).map(h=>h.split("||").map(f=>({[f]:h}))).flat()),d=c.concat(...Object.keys(u)),p=d.includes("*");for(let h of l)if(d.indexOf(h)>=0||p){let f=u[h]||h,m=s[f]||p,g=a[h];if(typeof m=="object"&&typeof g!="function"&&!Array.isArray(m))if(Array.isArray(g)){let v=g.map(y=>{let b={};return r(y,m,b)!==!1?b:void 0}).filter(Boolean);o[h]=v}else g&&(o[h]={},r(g,m,o[h]));else{let v=a[h];if(Array.isArray(m)&&!m.includes(v))return!1;(s[h]||p&&s[h]!==!1)&&(o[h]=v)}}}}var qj="voluntaryConsolation",Pf="competitiveBands",A6="roundRobinTally",rm="positionActions",Ga="matchUpActions",rA="rankingPoints",mT="roundNaming",jU="participant",HE="progression",Xg="scheduling",zE="avoidance",Uqe="participant",Dqe="display",Kc="scoring",Tu="seeding",gT="feedIn",Eqe="audit",V_="draws",Pqe={POLICY_TYPE_VOLUNTARY_CONSOLATION:qj,POLICY_TYPE_COMPETITIVE_BANDS:Pf,POLICY_TYPE_ROUND_ROBIN_TALLY:A6,POLICY_TYPE_POSITION_ACTIONS:rm,POLICY_TYPE_MATCHUP_ACTIONS:Ga,POLICY_TYPE_RANKING_POINTS:rA,POLICY_TYPE_ROUND_NAMING:mT,POLICY_TYPE_PARTICIPANT:jU,POLICY_TYPE_PROGRESSION:HE,POLICY_TYPE_SCHEDULING:Xg,POLICY_TYPE_AVOIDANCE:zE,POLICY_TYPE_DISPLAY:Dqe,POLICY_TYPE_PRIVACY:Uqe,POLICY_TYPE_FEED_IN:gT,POLICY_TYPE_SCORING:Kc,POLICY_TYPE_SEEDING:Tu,POLICY_TYPE_AUDIT:Eqe,POLICY_TYPE_DRAWS:V_};function Ig({tournamentParticipants:t=[],policyDefinitions:e={},contextProfile:i,participantId:n,internalUse:r,personId:a}){let s=t.find(l=>n&&l.participantId===n||a&&l.person&&l.person.personId===a),o=$t(s,!1,r);if(o){let l=e==null?void 0:e[jU];if(i!=null&&i.withScaleValues){let{ratings:c,rankings:u}=VU({participant:o});o.rankings=u,o.ratings=c}if(l!=null&&l.participant)return DI({template:l.participant,source:o})}return o}var Cqe="element required",Rqe="missing name";function uo(t){if(!t||typeof t!="object")return{error:si};if(t.element&&typeof(t==null?void 0:t.element)!="object")return{error:Ae};if(!(t!=null&&t.name))return{error:si,info:Rqe};if(!(t!=null&&t.element)){if(t.discover&&t.tournamentRecords){for(let e of Object.keys(t.tournamentRecords)){let i=t.tournamentRecords[e],n=uo({element:i,name:t.name});if(n.error)return fe({result:n,stack:"removeExtension"})}return{...pe}}return{error:si,info:Cqe}}return t!=null&&t.element.extensions?(t.element.extensions=t.element.extensions.filter(e=>(e==null?void 0:e.name)!==t.name),{...pe}):{...pe,info:Ya}}function Op({requiredAttributes:t=["name","value"],extension:e}){if(!e||typeof e!="object"||typeof e.name!="string")return!1;let i=Object.keys(e);return t.filter(n=>i.includes(n)).length===t.length}function pn(t){if(typeof t!="object")return{error:si};let e="addExtension";if(t!=null&&t.element&&typeof t.element!="object")return fe({result:{error:Ae},stack:e});if(!Op({extension:t.extension}))return fe({result:{error:Ae,info:"invalid extension"},stack:e});if(!t.element)if(t.discover&&!t.tournamentId&&t.tournamentRecords){for(let n of Object.values(t.tournamentRecords)){let r=pn({extension:t.extension,element:n});if(r.error)return fe({result:r,stack:e})}return{...pe}}else return fe({result:{error:si},stack:e});if(t.element.extensions||(t.element.extensions=[]),(t==null?void 0:t.creationTime)??!0){let n=new Date().toISOString();Object.assign(t.extension,{createdAt:n})}let i=t.element.extensions.find(({name:n})=>n===t.extension.name);return i?i.value=t.extension.value:t.extension.value&&t.element.extensions.push(t.extension),{...pe}}function _6(t){return!t||typeof t!="object"?{error:si}:t.tournamentRecord?pn({creationTime:t.creationTime,element:t.tournamentRecord,extension:t.extension}):{error:dt}}function XL(t){return!t||typeof t!="object"?{error:si}:t.drawDefinition?pn({creationTime:t.creationTime,element:t.drawDefinition,extension:t.extension}):{error:sc}}function Jg(t){return!t||typeof t!="object"?{error:si}:t.event?pn({creationTime:t.creationTime,extension:t.extension,element:t.event}):{error:Wc}}function wye(t){var e;if(!t||typeof t!="object")return{error:si};if(!t.participantId)return{error:da};let i=((e=t.tournamentRecord)==null?void 0:e.participants)||[],n=Ig({participantId:t.participantId,tournamentParticipants:i});return n?pn({creationTime:t.creationTime,extension:t.extension,element:n}):{error:Or}}function k6(t){return!t||typeof t!="object"?{error:si}:t.tournamentRecord?uo({element:t.tournamentRecord,name:t.name}):{error:dt}}function Sye(t){return!t||typeof t!="object"?{error:si}:t.drawDefinition?uo({element:t.drawDefinition,name:t.name}):{error:sc}}function JL(t){return!t||typeof t!="object"?{error:si}:t!=null&&t.event?uo({element:t.event,name:t.name}):{error:Wc}}function Tye(t){var e;if(!t||typeof t!="object")return{error:si};if(!t.participantId)return{error:da};let i=((e=t.tournamentRecord)==null?void 0:e.participants)||[],n=Ig({participantId:t.participantId,tournamentParticipants:i});return n?uo({element:n,name:t.name}):{error:Or}}function gR({tournamentRecords:t}){return{tournamentIds:tn(t)?Object.keys(t):[],...pe}}var Mqe="extensionQueries";function xi({discover:t,element:e,name:i,...n}){var r;if(!e||!i){if(t&&n){let s=Object.keys(n).filter(c=>typeof t=="boolean"||Array.isArray(t)&&t.includes(c)).find(c=>{var u;return Array.isArray((u=n[c])==null?void 0:u.extensions)?n[c].extensions.find(d=>(d==null?void 0:d.name)===i):!1}),o=s&&n[s];!o&&n.tournamentRecords&&(o=Object.values(n.tournamentRecords).find(c=>{var u;return(u=c.extensions)==null?void 0:u.length}));let l=(r=o==null?void 0:o.extensions)==null?void 0:r.find(c=>(c==null?void 0:c.name)===i);return{extension:l,info:l?void 0:Ya}}return fe({result:{error:si},stack:Mqe})}if(!Array.isArray(e.extensions))return{info:"no extensions"};let a=e.extensions.find(s=>(s==null?void 0:s.name)===i);return{extension:a,info:a?void 0:Ya}}var Nqe="activeSuspension",qE="appliedPolicies",Uye="context",QL="delegatedOutcome",Pd="disabled",EI="disableAutoCalc",eF="disableLinks",j_="display",qv="drawDeletions",Aqe="drawProfile",G_="entryProfile",_qe="eventProfile",kqe="eventWithdrawalRequests",xqe="factory",Xu="flightProfile",Wj="groupingAttribute",am="lineUps",yy="linkedTournamentsIds",tF="matchUpHistory",x6="participantRepresentatives",GU="personRequests",mS="positionActions",Oqe="rankingPoints",Lqe="registration",Yp="roundTarget",vR="scheduleLimits",sm="scheduleTiming",PI="schedulingProfile",Fqe="statusDetail",vT="subOrder",wg="tally",ID="tieFormatModification",Dye={ACTIVE_SUSPENSION:Nqe,APPLIED_POLICIES:qE,CONTEXT:Uye,DELEGATED_OUTCOME:QL,DISABLED:Pd,DISABLE_LINKS:eF,DISABLE_AUTO_CALC:EI,DISPLAY:j_,DRAW_DELETIONS:qv,DRAW_PROFILE:Aqe,ENTRY_PROFILE:G_,EVENT_PROFILE:_qe,EVENT_WITHDRAWAL_REQUESTS:kqe,FLIGHT_PROFILE:Xu,GROUPING_ATTRIBUTE:Wj,LINEUPS:am,LINKED_TOURNAMENTS:yy,MATCHUP_HISTORY:tF,PARTICIPANT_REPRESENTATIVES:x6,PERSON_REQUESTS:GU,POSITION_ACTIONS:mS,RANKING_POINTS:Oqe,REGISTRATION:Lqe,ROUND_TARGET:Yp,SCHEDULE_LIMITS:vR,SCHEDULE_TIMING:sm,SCHEDULING_PROFILE:PI,STATUS_DETAIL:Fqe,SUB_ORDER:vT,TALLY:wg,TIE_FORMAT_MODIFICATIONS:ID,FACTORY:xqe},WX=[QL,Pd,EI,eF,Xu,am,yy,tF,x6,GU,Yp,vR,sm,PI,vT,wg,ID];function Eye({tournamentRecords:t}){if(typeof t!="object"||!Object.keys(t).length)return{error:Tr};let e=gR({tournamentRecords:t}),{tournamentIds:i}=e;return(i==null?void 0:i.length)>1?pn({tournamentRecords:t,discover:!0,extension:{name:yy,value:{tournamentIds:i}}}):{...pe}}function Pye({tournamentRecords:t}){if(typeof t!="object"||!Object.keys(t).length)return{error:Tr};let e=uo({name:yy,tournamentRecords:t,discover:!0});return fe({result:e,stack:"unlinkTournaments"})}function Cye({tournamentRecords:t,tournamentId:e}){if(typeof t!="object")return{error:Ae};if(!e)return{error:nT};let i=gR({tournamentRecords:t}),{tournamentIds:n}=i;if(!n.includes(e))return{error:nT};let r;return n.every(a=>{var s;let o=t[a],{extension:l}=xi({element:o,name:yy});if(!l)return!0;let c=((s=l==null?void 0:l.value)==null?void 0:s.tournamentIds)||[];if(!(c!=null&&c.length)||c.length===1&&c.includes(e)||a===e){let p=k6({name:yy,tournamentRecord:o});return p.error&&(r=p.error),p.success}let u=c.filter(p=>p!==e);l.value={tournamentIds:u};let d=_6({tournamentRecord:o,extension:l});return d.error&&(r=d.error),d.success}),r?{error:r}:{...pe}}var Rye={};Fi(Rye,{getLinkedTournamentIds:()=>yR,getTournamentIds:()=>gR});function yR({tournamentRecords:t}){return typeof t!="object"||!Object.keys(t).length?{error:Tr}:{linkedTournamentIds:Object.assign({},...Object.keys(t).map(e=>{var i;let n=t[e],r=n==null?void 0:n.tournamentId,{extension:a}=xi({element:n,name:yy}),s=(((i=a==null?void 0:a.value)==null?void 0:i.tournamentIds)||[]).filter(o=>o!==r);return{[e]:s}}))}}var Mye={};Fi(Mye,{adHocPositionSwap:()=>IIe,addAdHocMatchUps:()=>RF,addDrawDefinitionTimeItem:()=>L8,addFinishingRounds:()=>_R,addGoesTo:()=>wy,addPlayoffStructures:()=>CF,addQualifyingStructure:()=>bIe,addVoluntaryConsolationStage:()=>hIe,addVoluntaryConsolationStructure:()=>D8,allPlayoffPositionsFilled:()=>x8,alternateDrawPositionAssignment:()=>iIe,assignDrawPosition:()=>qIe,assignDrawPositionBye:()=>yc,attachConsolationStructures:()=>jIe,attachPlayoffStructures:()=>e7,attachQualifyingStructure:()=>O8,attachStructures:()=>PF,autoSeeding:()=>L8e,automatedPlayoffPositioning:()=>XU,automatedPositioning:()=>GR,checkValidEntries:()=>AF,deleteAdHocMatchUps:()=>YIe,drawMatic:()=>T7,findDrawDefinition:()=>a7,generateAdHocMatchUps:()=>_F,generateAdHocRounds:()=>S7,generateAndPopulatePlayoffStructures:()=>J8,generateDrawDefinition:()=>oM,generateDrawMaticRound:()=>p7,generateDrawStructuresAndLinks:()=>c7,generateDrawTypeAndModifyDrawDefinition:()=>u7,generateQualifyingStructure:()=>G8,generateVoluntaryConsolation:()=>bwe,getAssignedParticipantIds:()=>rb,getAvailableMatchUpsCount:()=>MF,getAvailablePlayoffProfiles:()=>zR,getDrawDefinitionTimeItem:()=>i8,getDrawParticipantRepresentativeIds:()=>n7,getDrawStructures:()=>Ju,getDrawTypeCoercion:()=>QR,getEligibleVoluntaryConsolationParticipants:()=>i7,getMatchUpsMap:()=>Us,getParticipantIdFinishingPositions:()=>r7,getPositionAssignments:()=>QE,getPositionsPlayedOff:()=>JU,getSeedingThresholds:()=>R8,getSeedsCount:()=>eM,getStructureSeedAssignments:()=>Zc,getTeamLineUp:()=>Iy,getValidGroupSizes:()=>VR,isAdHoc:()=>Ho,isCompletedStructure:()=>Eg,isValidForQualifying:()=>l7,luckyLoserDrawPositionAssignment:()=>Kbe,modifyDrawDefinition:()=>GIe,modifyDrawName:()=>t7,modifySeedAssignment:()=>nIe,mutate:()=>Nye,positionActions:()=>o7,pruneDrawDefinition:()=>zIe,qualifierDrawPositionAssignment:()=>tIe,query:()=>XIe,removeDrawPositionAssignment:()=>XE,removeRoundMatchUps:()=>KIe,removeSeededParticipant:()=>yIe,removeStructure:()=>dIe,renameStructures:()=>uIe,resetDrawDefinition:()=>HIe,resetVoluntaryConsolationStructure:()=>Wye,setDrawParticipantRepresentativeIds:()=>Aye,setPositionAssignments:()=>Qbe,setStructureOrder:()=>lIe,setSubOrder:()=>ZIe,shiftAdHocRounds:()=>Jbe,swapAdHocRounds:()=>eIe,swapDrawPositionAssignments:()=>gIe,updateTeamLineUp:()=>Fw,withdrawParticipantAtDrawPosition:()=>Vbe});var Nye={};Fi(Nye,{adHocPositionSwap:()=>IIe,addAdHocMatchUps:()=>RF,addDrawDefinitionTimeItem:()=>L8,addPlayoffStructures:()=>CF,addQualifyingStructure:()=>bIe,addVoluntaryConsolationStage:()=>hIe,addVoluntaryConsolationStructure:()=>D8,alternateDrawPositionAssignment:()=>iIe,assignDrawPosition:()=>qIe,assignDrawPositionBye:()=>yc,attachConsolationStructures:()=>jIe,attachPlayoffStructures:()=>e7,attachQualifyingStructure:()=>O8,attachStructures:()=>PF,automatedPlayoffPositioning:()=>XU,automatedPositioning:()=>GR,deleteAdHocMatchUps:()=>YIe,luckyLoserDrawPositionAssignment:()=>Kbe,modifyDrawDefinition:()=>GIe,modifyDrawName:()=>t7,modifySeedAssignment:()=>nIe,pruneDrawDefinition:()=>zIe,qualifierDrawPositionAssignment:()=>tIe,removeDrawPositionAssignment:()=>XE,removeRoundMatchUps:()=>KIe,removeSeededParticipant:()=>yIe,removeStructure:()=>dIe,renameStructures:()=>uIe,resetDrawDefinition:()=>HIe,resetVoluntaryConsolationStructure:()=>Wye,setDrawParticipantRepresentativeIds:()=>Aye,setPositionAssignments:()=>Qbe,setStructureOrder:()=>lIe,setSubOrder:()=>ZIe,shiftAdHocRounds:()=>Jbe,swapAdHocRounds:()=>eIe,swapDrawPositionAssignments:()=>gIe,updateTeamLineUp:()=>Fw,withdrawParticipantAtDrawPosition:()=>Vbe});var O6=t=>e=>t[e],L6=(t=[])=>t.map(Ca).filter(Boolean),Yj=(t=[])=>t.map(Gi).filter(Boolean),Gi=(t={})=>O6(t)("participantId"),Ca=(t={})=>O6(t)("matchUpId"),WE=(t={})=>O6(t)("drawId");function Aye({representativeParticipantIds:t,drawDefinition:e}){if(!e)return{error:sc};if(!Array.isArray(t))return{error:Ae};let i=Yj((e==null?void 0:e.entries)||[]);return t.length&&Ar(t,i).length<t.length?{error:Ae}:XL({drawDefinition:e,extension:{name:x6,value:t}})}var ul="ABANDONED",Dw="AWAITING_RESULT",gn="BYE",Kp="CANCELLED",$r="COMPLETED",HU="DEAD_RUBBER",Ki="DEFAULTED",oa="DOUBLE_DEFAULT",Kr="DOUBLE_WALKOVER",ad="IN_PROGRESS",$l="INCOMPLETE",F6="NOT_PLAYED",ss="RETIRED",Qg="SUSPENDED",jr="TO_BE_PLAYED",un="WALKOVER",$qe=[Dw,$r,Ki,ad,$l,ss,Qg],_ye=[Dw,$r,Ki,Kr,oa,ad,$l,ss,Qg,un],kye=[ul,Dw,gn,Kp,$r,HU,Ki,Kr,oa,ad,$l,F6,ss,Qg,jr,un],xye=[gn,Kr,oa,$r,Ki,ss,un],Oye=[ul,Dw,Kp,HU,ad,$l,F6,Qg,jr,void 0],va=[Kp,ul,$r,HU,Ki,Kr,oa,ss,un],$6=[ul,$r,Ki,Kr,oa,ad,ss,un],Lye=[ad,$l,Qg,jr],Fye={ABANDONED:ul,AWAITING_RESULT:Dw,BYE:gn,CANCELLED:Kp,COMPLETED:$r,DEAD_RUBBER:HU,DEFAULTED:Ki,DOUBLE_WALKOVER:Kr,DOUBLE_DEFAULT:oa,IN_PROGRESS:ad,INCOMPLETE:$l,NOT_PLAYED:F6,RETIRED:ss,SUSPENDED:Qg,TO_BE_PLAYED:jr,WALKOVER:un};function Ew(t,e,i){var n,r;let a=h=>{var f,m;return(m=(f=xi({element:h,name:Yp}))==null?void 0:f.extension)==null?void 0:m.value},s=i==null?void 0:i.deprioritizeCompleted,o=(i==null?void 0:i.mode)===aye&&Qze,l=(i==null?void 0:i.mode)===rye&&sye,c=l||o||UI,u=h=>(h==null?void 0:h.stage)===Bt&&(h==null?void 0:h.stageSequence)===1,d=h=>u(h)?-1:c[h==null?void 0:h.stage],p=h=>h==null?void 0:h.matchUps.every(({matchUpStatus:f})=>va.includes(f)?1:-1);return s&&p(t)-p(e)||o&&d(t)-d(e)||((t==null?void 0:t.stage)&&c[t.stage]||0)-((e==null?void 0:e.stage)&&c[e.stage]||0)||(a(t)||0)-(a(e)||0)||!l&&!o&&(((n=e==null?void 0:e.positionAssignments)==null?void 0:n.length)??1/0)-(((r=t==null?void 0:t.positionAssignments)==null?void 0:r.length)??1/0)||((t==null?void 0:t.stageSequence)??0)-((e==null?void 0:e.stageSequence)??0)||(H_(t)||0)-(H_(e)||0)}function H_(t){return((t==null?void 0:t.matchUps)||[]).reduce((e,i)=>{var n;let r=(((n=i.finishingPositionRange)==null?void 0:n.winner)||[]).reduce((a,s)=>a+s,0);return!e||r<e?r:e},void 0)}function fi(t){let e=ei(t,[{[Po]:!0,[zL]:!0}]);if(e.error)return e;let{drawDefinition:i,structureId:n}=t,{structures:r}=Ju({drawDefinition:i}),a=r==null?void 0:r.map(l=>l.structures?[...l.structures].concat(l):l).flat(),s=a==null?void 0:a.find(l=>l.structureId===n);if(!s)return{error:yr};let o=s.structureType===jL?a==null?void 0:a.find(l=>{var c;return(c=l.structures)==null?void 0:c.some(u=>u.structureId===n)}):void 0;return{structure:s,containingStructure:o}}function Ju({withStageGrouping:t,drawDefinition:e,stageSequences:i,stageSequence:n,roundTarget:r,sortConfig:a,stages:s,stage:o}){var l;let c=!e&&Ht||!(e!=null&&e.structures)&&B5||void 0;if(c)return{error:c,structures:[],stageStructures:{}};let u=m=>{var g,v;let y=(v=(g=xi({element:m,name:Yp}))==null?void 0:g.extension)==null?void 0:v.value;return!r||r===y},d=((l=e==null?void 0:e.structures)==null?void 0:l.filter(h).filter(f).filter(u).sort((m,g)=>Ew(m,g,a)))??[],p=t?Object.assign({},...BL.map(m=>{let g=d==null?void 0:d.filter(v=>v.stage===m);return(g==null?void 0:g.length)&&{[m]:g}}).filter(Boolean)):{};return{structures:d,stageStructures:p};function h(m){return!o&&!Array.isArray(s)||o&&m.stage===o||Array.isArray(s)&&s.includes(m.stage)}function f(m){return!n&&!Array.isArray(i)||n&&m.stageSequence===n||Array.isArray(i)&&i.includes(m.stageSequence)}}function $ye({drawDefinition:t}){if(!t)return{error:Ht};let e={};return{allPositionedParticipantIds:(t.structures||[]).map(i=>{let n=i.stage;e[n]||(e[n]=[]);let{positionAssignments:r}=Gn({structure:i}),a=(r==null?void 0:r.map(Gi).filter(Boolean))??[];return e[n].push(...a),a}).flat(),stagePositionedParticipantIds:e}}function Gn({drawDefinition:t,structureId:e,structure:i}){let n,r=[];if(!i){if(!t)return{positionAssignments:r,error:Ht};if({structure:i,error:n}=fi({drawDefinition:t,structureId:e}),n)return{positionAssignments:r,error:n}}return i.structures?r=[].concat(...i.structures.map(a=>Gn({structure:a}).positionAssignments)):i.positionAssignments?r=i.positionAssignments:n=fge,{positionAssignments:r,error:n}}function Aa({drawDefinition:t,structureId:e,structure:i}){var n;let r=((n=Gn({drawDefinition:t,structureId:e,structure:i}))==null?void 0:n.positionAssignments)||[],a=r==null?void 0:r.filter(u=>u.participantId??u.bye??u.qualifier),s=r&&(r==null?void 0:r.length)===(a==null?void 0:a.length),o=r==null?void 0:r.filter(u=>!u.participantId&&!u.bye&&!u.qualifier),l=r==null?void 0:r.filter(u=>!u.participantId&&u.bye),c=r==null?void 0:r.filter(u=>!u.participantId&&u.qualifier);return{allPositionsAssigned:s,positionAssignments:r,unassignedPositions:o,assignedPositions:a,qualifierPositions:c,byePositions:l}}var B6="addDrawDefinition",iF="addMatchUps",Sg="addParticipants",V6="addScaleItems",Bye="addEvent",j6="addVenue",kf="audit",G6="dataIssue",H6="deleteParticipants",z6="deleteVenue",q6="deletedDrawIds",W6="deletedMatchUpIds",Y6="modifyDrawDefinition",Vye="modifyDrawEntries",jye="modifyEventEntries",K6="modifyMatchUp",Ss="modifyParticipants",Z6="modifyPositionAssignments",X6="modifySeedAssignments",Xy="modifyTournamentDetail",Jy="modifyVenue",Kj="mutations",Zj="publishEvent",Gye="publishEventSeeding",Hye="publishOrderOfPlay",zye="publishParticipants",J6="unPublishEvent",Q6="unPublishEventSeeding",e8="unPublishOrderOfPlay",Bqe="unPublishParticipants",nF="updateInContextMatchUp",Vqe={ADD_DRAW_DEFINITION:B6,ADD_MATCHUPS:iF,ADD_PARTICIPANTS:Sg,ADD_SCALE_ITEMS:V6,ADD_EVENT:Bye,ADD_VENUE:j6,AUDIT:kf,DATA_ISSUE:G6,DELETE_PARTICIPANTS:H6,DELETE_VENUE:z6,DELETED_DRAW_IDS:q6,DELETED_MATCHUP_IDS:W6,MODIFY_DRAW_DEFINITION:Y6,MODIFY_DRAW_ENTRIES:Vye,MODIFY_EVENT_ENTRIES:jye,MODIFY_MATCHUP:K6,MODIFY_PARTICIPANTS:Ss,MODIFY_POSITION_ASSIGNMENTS:Z6,MODIFY_SEED_ASSIGNMENTS:X6,MODIFY_TOURNAMENT_DETAIL:Xy,MODIFY_VENUE:Jy,MUTATIONS:Kj,PUBLISH_EVENT_SEEDING:Gye,PUBLISH_EVENT:Zj,PUBLISH_ORDER_OF_PLAY:Hye,PUBLISH_PARTICIPANTS:zye,UNPUBLISH_EVENT_SEEDING:Q6,UNPUBLISH_EVENT:J6,UNPUBLISH_ORDER_OF_PLAY:e8,UPDATE_INCONTEXT_MATCHUP:nF};function rF(t,e){var i;if(!t)return{error:Ht};let n=Date.now();t.updatedAt&&n===new Date(t.updatedAt).getTime()&&(n+=1);let r=new Date(n).toISOString(),a=e==null?void 0:e.filter(Boolean);return t.updatedAt=r,(i=t.structures)==null||i.filter(Boolean).forEach(s=>{(!(a!=null&&a.length)||a!=null&&a.includes(s.structureId))&&(s.updatedAt=r)}),{...pe}}function Tg({drawDefinition:t,tournamentId:e,matchUps:i,eventId:n}){return t&&rF(t),Ti({payload:{matchUps:i,tournamentId:e,eventId:n},topic:iF}),{...pe}}function Cm({drawDefinition:t,tournamentId:e,matchUpIds:i,eventId:n,action:r}){t&&rF(t),Ti({topic:W6,payload:{tournamentId:e,matchUpIds:i,eventId:n,action:r}});for(let a of i)c6({key:a});return{...pe}}function Qi({drawDefinition:t,tournamentId:e,structureId:i,context:n,eventId:r,matchUp:a}){return a?(t&&zn({drawDefinition:t,structureIds:i?[i]:void 0,tournamentId:e,eventId:r}),Ti({topic:K6,payload:{matchUp:a,tournamentId:e,context:n},key:a.matchUpId}),{...pe}):(console.log(ll),{error:ll})}function jqe({tournamentId:t,inContextMatchUp:e}){return e?(Ti({payload:{inContextMatchUp:e,tournamentId:t},topic:nF,key:e.matchUpId}),{...pe}):{error:ll}}function bR({tournamentId:t,eventId:e,drawDefinition:i}){return i?(rF(i),Ti({payload:{drawDefinition:i,tournamentId:t,eventId:e},topic:B6,key:i.drawId}),{...pe}):(console.log(Ht),{error:Ht})}function Gqe({tournamentId:t,eventId:e,drawId:i}){return Ti({payload:{drawId:i,tournamentId:t,eventId:e},topic:q6,key:i}),c6({key:i}),{...pe}}function zn({drawDefinition:t,tournamentId:e,structureIds:i,eventId:n}){return t?(rF(t,i),Ti({payload:{tournamentId:e,eventId:n,drawDefinition:t},topic:Y6,key:t.drawId}),{...pe}):{error:Ht}}function qye({drawDefinition:t,tournamentId:e,structure:i,eventId:n}){if(!t)return{error:Ht};if(!i)return{error:Yy};let r=i.seedAssignments,a=i.structureId,s=t.drawId;return Ti({payload:{tournamentId:e,eventId:n,drawId:s,structureId:a,seedAssignments:r},topic:X6,key:t.drawId}),zn({structureIds:[a],drawDefinition:t,tournamentId:e,eventId:n}),{...pe}}function Ug({drawDefinition:t,tournamentId:e,structure:i,event:n}){if(!t)return{error:Ht};if(!i)return{error:Yy};let r=Gn({structure:i}),a=i.structureId,s=t.drawId,o=n==null?void 0:n.eventId;return Ti({topic:Z6,payload:{positionAssignments:r,tournamentId:e,structureId:a,eventId:o,drawId:s},key:a}),zn({structureIds:[a],drawDefinition:t,tournamentId:e,eventId:o}),{...pe}}function Wye({tournamentRecord:t,drawDefinition:e,resetEntries:i,event:n}){var r,a;if(!e)return{error:Ht};let s=(r=e.structures)==null?void 0:r.find(l=>l.stage===ja);if(!s)return{error:yr};let o=((a=s.matchUps)==null?void 0:a.map(({matchUpId:l})=>l))||[];return s.positionAssignments=[],s.seedAssignments=[],s.matchUps=[],Cm({tournamentId:t==null?void 0:t.tournamentId,action:"resetVoluntaryConsolationStructure",matchUpIds:o,drawDefinition:e}),i&&(e.entries=e.entries.filter(l=>l.entryStage!==ja)),zn({tournamentId:t==null?void 0:t.tournamentId,eventId:n==null?void 0:n.eventId,drawDefinition:e,structureIds:[s.structureId]}),{...pe}}function t8({drawPositions:t,structure:e}){var i;if([ri,Bt].includes(e.stage)&&e.stageSequence===1)return;let{positionAssignments:n}=Gn({structure:e});(i=n==null?void 0:n.filter(({drawPosition:r})=>t==null?void 0:t.includes(r)))==null||i.forEach(r=>{pn({element:r,extension:{name:eF,value:!0}})})}function aF(t){var e,i;let{appliedPolicies:n,positionAction:r,drawDefinition:a}=t;if(((e=n==null?void 0:n.audit)==null?void 0:e[mS])===!1)return;let{extension:s}=xi({name:mS,element:a}),o=Array.isArray(s==null?void 0:s.value)?(s==null?void 0:s.value)??[]:[];if(!(o!=null&&o.length)){let c=a.structures.find(u=>u.stage===Bt);if(c){let u=(i=Gn({structure:c}).positionAssignments)==null?void 0:i.map(({drawPosition:d,participantId:p,bye:h,qualifier:f})=>({drawPosition:d,participantId:p,qualifier:f,bye:h}));o.push({name:"initialMainAssignments",initialAssignments:u})}}let l={value:o.concat(r),name:mS};pn({element:a,extension:l})}function zU({tournamentRecord:t,drawDefinition:e,event:i}){var n;let r=((n=(t==null?void 0:t.events)||i&&[i])==null?void 0:n.map(l=>l==null?void 0:l.drawDefinitions).flat().filter(Boolean))||e&&[e]||[],a={},s={},o=r.map(l=>{var c;return(c=l==null?void 0:l.structures)==null?void 0:c.filter(u=>u==null?void 0:u.structures)}).flat().filter(Boolean);for(let l of o){let{structures:c,structureId:u}=l??{};c&&u&&(a[u]=c==null?void 0:c.map(d=>d.structureId))&&c.forEach(d=>s[d.structureId]=l==null?void 0:l.structureId)}return{containedStructures:a,containerStructures:s}}function sF(t){var e;let{sides:i,matchUpType:n}=t||{},r=(e=t.potentialParticipants)!=null&&e.length?t.potentialParticipants.flat().map(s=>n===Nn?(s==null?void 0:s.individualParticipantIds)||[]:s.participantId).flat():[],a=(i||[]).map(s=>{var o;return n===Nn&&(((o=s==null?void 0:s.participant)==null?void 0:o.individualParticipantIds)||[])||(s==null?void 0:s.participantId)&&[s.participantId]||[]}).flat();return{individualParticipantIds:a.concat(r).flat(),enteredIndividualParticipantIds:a,potentialIndividualParticipantIds:r}}function au(t){return(t==null?void 0:t.tournamentRecords)??((t==null?void 0:t.tournamentRecord)&&{[t.tournamentRecord.tournamentId]:t.tournamentRecord})??{}}var IR="SIGN_IN_STATUS",Yye="SIGNED_OUT",YE="SIGNED_IN",$o="TEAM",Hi="INDIVIDUAL",gc="GROUP",Ai="PAIR",Pn="TEAM",wD={TEAM_PARTICIPANT:$o,INDIVIDUAL:Hi,GROUP:gc,TEAM:Pn,PAIR:Ai},Hqe={INDIVIDUAL:Hi,GROUP:gc,PAIR:Ai,TEAM:Pn,SIGN_IN_STATUS:IR,SIGNED_OUT:Yye,SIGNED_IN:YE};function oF({participantsProfile:t,participants:e=[],deepCopy:i}){let n=new Map,r=i!==!1?$t(e,t==null?void 0:t.convertExtensions,!0):e,a=r.filter(l=>l.participantType===Pn),s=r.filter(l=>l.participantType===gc),o=r.filter(l=>l.participantType===Ai);return r.forEach(l=>{if(l.participantType===Hi){let{participantId:c}=l;l.groupParticipantIds=[],l.teamParticipantIds=[],l.pairParticipantIds=[],l.groups=[],l.teams=[],a.forEach(u=>{((u==null?void 0:u.individualParticipantIds)||[]).forEach(d=>{var p;d===c&&!((p=l.teamParticipantIds)!=null&&p.includes(u.participantId))&&(l.teamParticipantIds.push(u.participantId),n.get(u.participantId)||n.set(u.participantId,{participantName:u.participantName,participantId:u.participantId}),l.teams.push({participantRoleResponsibilities:u.participantRoleResponsibilities,participantOtherName:u.participantOtherName,participantName:u.participantName,participantId:u.participantId,teamId:u.teamId}))})}),o.forEach(u=>{((u==null?void 0:u.individualParticipantIds)||[]).forEach(d=>{d===c&&!l.pairParticipantIds.includes(u.participantId)&&l.pairParticipantIds.push(u.participantId)})}),s.forEach(u=>{((u==null?void 0:u.individualParticipantIds)||[]).forEach(d=>{d===c&&!l.groupParticipantIds.includes(u.participantId)&&(l.groupParticipantIds.push(u.participantId),l.groups.push({participantRoleResponsibilities:u.participantRoleResponsibilities,participantOtherName:u.participantOtherName,participantName:u.participantName,participantId:u.participantId}))})})}}),{participantsWithGroupings:r,groupInfo:Object.fromEntries(n)}}function Kye(t){return t&&typeof String.fromCodePoint<"u"?t.toUpperCase().replace(/./g,e=>String.fromCodePoint(e.charCodeAt(0)+127397)):t}function zqe(t){let e=Object.assign({},...ag.filter(i=>i.ioc).map(i=>({[i.ioc]:i.iso})));return Kye(e[t])}var ag=[{ioc:"",iso2:"",iso:"",label:"NONE",phone:""},{ioc:"AND",iso2:"AD",iso:"AND",label:"Andorra",phone:"376"},{ioc:"UAE",iso2:"AE",iso:"ARE",label:"United Arab Emirates",phone:"971"},{ioc:"AFG",iso2:"AF",iso:"AFG",label:"Afghanistan",phone:"93"},{ioc:"ANT",iso2:"AG",iso:"ATG",label:"Antigua and Barbuda",phone:"1-268"},{ioc:"AIA",iso2:"AI",iso:"AIA",label:"Anguilla",phone:"1-264"},{ioc:"ALB",iso2:"AL",iso:"ALB",label:"Albania",phone:"355"},{ioc:"ARM",iso2:"AM",iso:"ARM",label:"Armenia",phone:"374"},{ioc:"ANG",iso2:"AO",iso:"AGO",label:"Angola",phone:"244"},{ioc:"",iso2:"AQ",iso:"ATA",label:"Antarctica",phone:"672"},{ioc:"ARG",iso2:"AR",iso:"ARG",label:"Argentina",phone:"54"},{ioc:"ASA",iso2:"AS",iso:"ASM",label:"American Samoa",phone:"1-684"},{ioc:"AUT",iso2:"AT",iso:"AUT",label:"Austria",phone:"43"},{ioc:"AUS",iso2:"AU",iso:"AUS",label:"Australia",phone:"61",suggested:!0},{ioc:"ARU",iso2:"AW",iso:"ABW",label:"Aruba",phone:"297"},{ioc:"AZE",iso2:"AZ",iso:"AZE",label:"Azerbaijan",phone:"994"},{ioc:"BIH",iso2:"BA",iso:"BIH",label:"Bosnia and Herzegovina",phone:"387"},{ioc:"BAR",iso2:"BB",iso:"BRB",label:"Barbados",phone:"1-246"},{ioc:"BAN",iso2:"BD",iso:"BGD",label:"Bangladesh",phone:"880"},{ioc:"BEL",iso2:"BE",iso:"BEL",label:"Belgium",phone:"32"},{ioc:"BUR",iso2:"BF",iso:"BFA",label:"Burkina Faso",phone:"226"},{ioc:"BUL",iso2:"BG",iso:"BGR",label:"Bulgaria",phone:"359"},{ioc:"BRN",iso2:"BH",iso:"BHR",label:"Bahrain",phone:"973"},{ioc:"BDI",iso2:"BI",iso:"BDI",label:"Burundi",phone:"257"},{ioc:"BEN",iso2:"BJ",iso:"BEN",label:"Benin",phone:"229"},{ioc:"",iso2:"BL",iso:"BLM",label:"Saint Barthelemy",phone:"590"},{ioc:"BER",iso2:"BM",iso:"BMU",label:"Bermuda",phone:"1-441"},{ioc:"BRU",iso2:"BN",iso:"BRN",label:"Brunei Darussalam",phone:"673"},{ioc:"BOL",iso2:"BO",iso:"BOL",label:"Bolivia",phone:"591"},{ioc:"BRA",iso2:"BR",iso:"BRA",label:"Brazil",phone:"55"},{ioc:"BAH",iso2:"BS",iso:"BHS",label:"Bahamas",phone:"1-242"},{ioc:"BHU",iso2:"BT",iso:"BTN",label:"Bhutan",phone:"975"},{ioc:"",iso2:"BV",iso:"BVT",label:"Bouvet Island",phone:"47"},{ioc:"BOT",iso2:"BW",iso:"BWA",label:"Botswana",phone:"267"},{ioc:"BLR",iso2:"BY",iso:"BLR",label:"Belarus",phone:"375"},{ioc:"BIZ",iso2:"BZ",iso:"BLZ",label:"Belize",phone:"501"},{ioc:"CAN",iso2:"CA",iso:"CAN",label:"Canada",phone:"1",suggested:!0},{ioc:"",iso2:"CC",iso:"CCK",label:"Cocos (Keeling) Islands",phone:"61"},{ioc:"CGO",iso2:"CD",iso:"COG",label:"Congo, Republic of the",phone:"242"},{ioc:"CAF",iso2:"CF",iso:"CAF",label:"Central African Republic",phone:"236"},{ioc:"COD",iso2:"CG",iso:"CGD",label:"Congo, Democratic Republic of the",phone:"243"},{ioc:"SUI",iso2:"CH",iso:"CHE",label:"Switzerland",phone:"41"},{ioc:"CIV",iso2:"CI",iso:"CIV",label:"Cote d'Ivoire",phone:"225"},{ioc:"COK",iso2:"CK",iso:"COK",label:"Cook Islands",phone:"682"},{ioc:"CHI",iso2:"CL",iso:"CHL",label:"Chile",phone:"56"},{ioc:"CMR",iso2:"CM",iso:"CMR",label:"Cameroon",phone:"237"},{ioc:"CHN",iso2:"CN",iso:"CHN",label:"China",phone:"86"},{ioc:"COL",iso2:"CO",iso:"COL",label:"Colombia",phone:"57"},{ioc:"CRC",iso2:"CR",iso:"CRI",label:"Costa Rica",phone:"506"},{ioc:"CUB",iso2:"CU",iso:"CUB",label:"Cuba",phone:"53"},{ioc:"CPV",iso2:"CV",iso:"CPV",label:"Cape Verde",phone:"238"},{ioc:"CUW",iso2:"CW",iso:"CUW",label:"Curacao",phone:"599"},{ioc:"CXR",iso2:"CX",iso:"CXR",label:"Christmas Island",phone:"61"},{ioc:"CYP",iso2:"CY",iso:"CYP",label:"Cyprus",phone:"357"},{ioc:"CZE",iso2:"CZ",iso:"CZE",label:"Czech Republic",phone:"420"},{ioc:"GER",iso2:"DE",iso:"DEU",label:"Germany",phone:"49",suggested:!0},{ioc:"DJI",iso2:"DJ",iso:"DJI",label:"Djibouti",phone:"253"},{ioc:"DEN",iso2:"DK",iso:"DNK",label:"Denmark",phone:"45"},{ioc:"DMA",iso2:"DM",iso:"DMA",label:"Dominica",phone:"1-767"},{ioc:"DOM",iso2:"DO",iso:"DOM",label:"Dominican Republic",phone:"1-809"},{ioc:"ALG",iso2:"DZ",iso:"DZA",label:"Algeria",phone:"213"},{ioc:"ECU",iso2:"EC",iso:"ECU",label:"Ecuador",phone:"593"},{ioc:"EST",iso2:"EE",iso:"ESE",label:"Estonia",phone:"372"},{ioc:"EGY",iso2:"EG",iso:"EGY",label:"Egypt",phone:"20"},{ioc:"",iso2:"EH",iso:"ESH",label:"Western Sahara",phone:"212"},{ioc:"ERI",iso2:"ER",iso:"ERI",label:"Eritrea",phone:"291"},{ioc:"ESP",iso2:"ES",iso:"ESP",label:"Spain",phone:"34"},{ioc:"ETH",iso2:"ET",iso:"ETH",label:"Ethiopia",phone:"251"},{ioc:"FIN",iso2:"FI",iso:"FIN",label:"Finland",phone:"358"},{ioc:"FIJ",iso2:"FJ",iso:"FJI",label:"Fiji",phone:"679"},{ioc:"FLK",iso2:"FK",iso:"FLK",label:"Falkland Islands (Malvinas)",phone:"500"},{ioc:"FSM",iso2:"FM",iso:"FSM",label:"Micronesia, Federated States of",phone:"691"},{ioc:"FAR",iso2:"FO",iso:"FRO",label:"Faroe Islands",phone:"298"},{ioc:"FRA",iso2:"FR",iso:"FRA",label:"France",phone:"33",suggested:!0},{ioc:"GAB",iso2:"GA",iso:"GAB",label:"Gabon",phone:"241"},{ioc:"GBR",iso2:"GB",iso:"GBR",label:"United Kingdom",phone:"44"},{ioc:"GRN",iso2:"GD",iso:"GRD",label:"Grenada",phone:"1-473"},{ioc:"GEO",iso2:"GE",iso:"GEO",label:"Georgia",phone:"995"},{ioc:"FGU",iso2:"GF",iso:"GUF",label:"French Guiana",phone:"594"},{ioc:"",iso2:"GG",iso:"GGY",label:"Guernsey",phone:"44"},{ioc:"",iso2:"GH",iso:"GHA",label:"Ghana",phone:"233"},{ioc:"GIB",iso2:"GI",iso:"GIB",label:"Gibraltar",phone:"350"},{ioc:"GRL",iso2:"GL",iso:"GRL",label:"Greenland",phone:"299"},{ioc:"GAM",iso2:"GM",iso:"GMB",label:"Gambia",phone:"220"},{ioc:"GUI",iso2:"GN",iso:"GIN",label:"Guinea",phone:"224"},{ioc:"GUD",iso2:"GP",iso:"GLP",label:"Guadeloupe",phone:"590"},{ioc:"GEQ",iso2:"GQ",iso:"GNQ",label:"Equatorial Guinea",phone:"240"},{ioc:"GRE",iso2:"GR",iso:"GRC",label:"Greece",phone:"30"},{ioc:"",iso2:"GS",iso:"SGS",label:"South Georgia and the South Sandwich Islands",phone:"500"},{ioc:"GUA",iso2:"GT",iso:"GTM",label:"Guatemala",phone:"502"},{ioc:"GUM",iso2:"GU",iso:"GUM",label:"Guam",phone:"1-671"},{ioc:"GBS",iso2:"GW",iso:"GNB",label:"Guinea-Bissau",phone:"245"},{ioc:"GUY",iso2:"GY",iso:"GUY",label:"Guyana",phone:"592"},{ioc:"HKG",iso2:"HK",iso:"HKG",label:"Hong Kong",phone:"852"},{ioc:"",iso2:"HM",iso:"HMD",label:"Heard Island and McDonald Islands",phone:"672"},{ioc:"HON",iso2:"HN",iso:"HND",label:"Honduras",phone:"504"},{ioc:"CRO",iso2:"HR",iso:"HRV",label:"Croatia",phone:"385"},{ioc:"HAI",iso2:"HT",iso:"HTI",label:"Haiti",phone:"509"},{ioc:"HUN",iso2:"HU",iso:"HUN",label:"Hungary",phone:"36"},{ioc:"INA",iso2:"ID",iso:"IDN",label:"Indonesia",phone:"62"},{ioc:"IRL",iso2:"IE",iso:"IRL",label:"Ireland",phone:"353"},{ioc:"ISR",iso2:"IL",iso:"ISR",label:"Israel",phone:"972"},{ioc:"",iso2:"IM",iso:"IMN",label:"Isle of Man",phone:"44"},{ioc:"IND",iso2:"IN",iso:"IND",label:"India",phone:"91"},{ioc:"",iso2:"IO",iso:"IOT",label:"British Indian Ocean Territory",phone:"246"},{ioc:"IRQ",iso2:"IQ",iso:"IRQ",label:"Iraq",phone:"964"},{ioc:"IRI",iso2:"IR",iso:"IRN",label:"Iran, Islamic Republic of",phone:"98"},{ioc:"ISL",iso2:"IS",iso:"ISL",label:"Iceland",phone:"354"},{ioc:"ITA",iso2:"IT",iso:"ITA",label:"Italy",phone:"39"},{ioc:"",iso2:"JE",iso:"JEY",label:"Jersey",phone:"44"},{ioc:"JAM",iso2:"JM",iso:"JAM",label:"Jamaica",phone:"1-876"},{ioc:"JOR",iso2:"JO",iso:"JOR",label:"Jordan",phone:"962"},{ioc:"JPN",iso2:"JP",iso:"JPN",label:"Japan",phone:"81",suggested:!0},{ioc:"KEN",iso2:"KE",iso:"KEN",label:"Kenya",phone:"254"},{ioc:"KGZ",iso2:"KG",iso:"KGZ",label:"Kyrgyzstan",phone:"996"},{ioc:"CAM",iso2:"KH",iso:"KHM",label:"Cambodia",phone:"855"},{ioc:"KIR",iso2:"KI",iso:"KIR",label:"Kiribati",phone:"686"},{ioc:"COM",iso2:"KM",iso:"COM",label:"Comoros",phone:"269"},{ioc:"SKN",iso2:"KN",iso:"KNA",label:"Saint Kitts and Nevis",phone:"1-869"},{ioc:"KOR",iso2:"KP",iso:"KOR",label:"Korea, Democratic People's Republic of",phone:"850"},{ioc:"PRK",iso2:"KR",iso:"PRK",label:"Korea, Republic of",phone:"82"},{ioc:"KUW",iso2:"KW",iso:"KWT",label:"Kuwait",phone:"965"},{ioc:"CAY",iso2:"KY",iso:"CYM",label:"Cayman Islands",phone:"1-345"},{ioc:"KAZ",iso2:"KZ",iso:"KAZ",label:"Kazakhstan",phone:"7"},{ioc:"LAO",iso2:"LA",iso:"LAO",label:"Lao People's Democratic Republic",phone:"856"},{ioc:"LIB",iso2:"LB",iso:"LBN",label:"Lebanon",phone:"961"},{ioc:"LCA",iso2:"LC",iso:"LCA",label:"Saint Lucia",phone:"1-758"},{ioc:"LIE",iso2:"LI",iso:"LIE",label:"Liechtenstein",phone:"423"},{ioc:"SRI",iso2:"LK",iso:"LKA",label:"Sri Lanka",phone:"94"},{ioc:"LBR",iso2:"LR",iso:"LBR",label:"Liberia",phone:"231"},{ioc:"LES",iso2:"LS",iso:"LSO",label:"Lesotho",phone:"266"},{ioc:"LTU",iso2:"LT",iso:"LTU",label:"Lithuania",phone:"370"},{ioc:"LUX",iso2:"LU",iso:"LUX",label:"Luxembourg",phone:"352"},{ioc:"LAT",iso2:"LV",iso:"LVA",label:"Latvia",phone:"371"},{ioc:"LBA",iso2:"LY",iso:"LBY",label:"Libya",phone:"218"},{ioc:"MAR",iso2:"MA",iso:"MAR",label:"Morocco",phone:"212"},{ioc:"MON",iso2:"MC",iso:"MCO",label:"Monaco",phone:"377"},{ioc:"MDA",iso2:"MD",iso:"MDA",label:"Moldova, Republic of",phone:"373"},{ioc:"MNE",iso2:"ME",iso:"MNE",label:"Montenegro",phone:"382"},{ioc:"",iso2:"MF",iso:"MAF",label:"Saint Martin (French part)",phone:"590"},{ioc:"MAD",iso2:"MG",iso:"MDG",label:"Madagascar",phone:"261"},{ioc:"MSH",iso2:"MH",iso:"MHL",label:"Marshall Islands",phone:"692"},{ioc:"MKD",iso2:"MK",iso:"MKD",label:"Macedonia, the Former Yugoslav Republic of",phone:"389"},{ioc:"MLI",iso2:"ML",iso:"MLI",label:"Mali",phone:"223"},{ioc:"MYA",iso2:"MM",iso:"MMR",label:"Myanmar",phone:"95"},{ioc:"MGL",iso2:"MN",iso:"MNG",label:"Mongolia",phone:"976"},{ioc:"MAC",iso2:"MO",iso:"MAC",label:"Macao",phone:"853"},{ioc:"NMA",iso2:"MP",iso:"NMP",label:"Northern Mariana Islands",phone:"1-670"},{ioc:"MRT",iso2:"MQ",iso:"MTQ",label:"Martinique",phone:"596"},{ioc:"MTN",iso2:"MR",iso:"MRT",label:"Mauritania",phone:"222"},{ioc:"MNT",iso2:"MS",iso:"MSR",label:"Montserrat",phone:"1-664"},{ioc:"MLT",iso2:"MT",iso:"MLT",label:"Malta",phone:"356"},{ioc:"MRI",iso2:"MU",iso:"MUS",label:"Mauritius",phone:"230"},{ioc:"MDV",iso2:"MV",iso:"MDV",label:"Maldives",phone:"960"},{ioc:"MAW",iso2:"MW",iso:"MWI",label:"Malawi",phone:"265"},{ioc:"MEX",iso2:"MX",iso:"MEX",label:"Mexico",phone:"52"},{ioc:"MAS",iso2:"MY",iso:"MYS",label:"Malaysia",phone:"60"},{ioc:"MOZ",iso2:"MZ",iso:"MOZ",label:"Mozambique",phone:"258"},{ioc:"NAM",iso2:"NA",iso:"NAM",label:"Namibia",phone:"264"},{ioc:"NCL",iso2:"NC",iso:"NCL",label:"New Caledonia",phone:"687"},{ioc:"NIG",iso2:"NE",iso:"NER",label:"Niger",phone:"227"},{ioc:"NFI",iso2:"NF",iso:"NFK",label:"Norfolk Island",phone:"672"},{ioc:"NGR",iso2:"NG",iso:"NGA",label:"Nigeria",phone:"234"},{ioc:"NCA",iso2:"NI",iso:"NIC",label:"Nicaragua",phone:"505"},{ioc:"NED",iso2:"NL",iso:"NLD",label:"Netherlands",phone:"31"},{ioc:"NOR",iso2:"NO",iso:"NOR",label:"Norway",phone:"47"},{ioc:"NEP",iso2:"NP",iso:"NPL",label:"Nepal",phone:"977"},{ioc:"NRU",iso2:"NR",iso:"NRU",label:"Nauru",phone:"674"},{ioc:"NIU",iso2:"NU",iso:"NIU",label:"Niue",phone:"683"},{ioc:"NZL",iso2:"NZ",iso:"NZL",label:"New Zealand",phone:"64"},{ioc:"OMA",iso2:"OM",iso:"OMN",label:"Oman",phone:"968"},{ioc:"PAN",iso2:"PA",iso:"PAN",label:"Panama",phone:"507"},{ioc:"PER",iso2:"PE",iso:"PER",label:"Peru",phone:"51"},{ioc:"FPO",iso2:"PF",iso:"PYF",label:"French Polynesia",phone:"689"},{ioc:"PNG",iso2:"PG",iso:"PNG",label:"Papua New Guinea",phone:"675"},{ioc:"PHI",iso2:"PH",iso:"PHL",label:"Philippines",phone:"63"},{ioc:"PAK",iso2:"PK",iso:"PAK",label:"Pakistan",phone:"92"},{ioc:"POL",iso2:"PL",iso:"POL",label:"Poland",phone:"48"},{ioc:"SPM",iso2:"PM",iso:"SPM",label:"Saint Pierre and Miquelon",phone:"508"},{ioc:"",iso2:"PN",iso:"PCN",label:"Pitcairn",phone:"870"},{ioc:"PUR",iso2:"PR",iso:"PRI",label:"Puerto Rico",phone:"1"},{ioc:"PLE",iso2:"PS",iso:"PSE",label:"Palestine, State of",phone:"970"},{ioc:"POR",iso2:"PT",iso:"PRT",label:"Portugal",phone:"351"},{ioc:"PLW",iso2:"PW",iso:"PLW",label:"Palau",phone:"680"},{ioc:"PAR",iso2:"PY",iso:"PRY",label:"Paraguay",phone:"595"},{ioc:"QAT",iso2:"QA",iso:"QAT",label:"Qatar",phone:"974"},{ioc:"REU",iso2:"RE",iso:"REU",label:"Reunion",phone:"262"},{ioc:"ROU",iso2:"RO",iso:"ROU",label:"Romania",phone:"40"},{ioc:"SRB",iso2:"RS",iso:"SRB",label:"Serbia",phone:"381"},{ioc:"RUS",iso2:"RU",iso:"RUS",label:"Russia",phone:"7"},{ioc:"RWA",iso2:"RW",iso:"RWA",label:"Rwanda",phone:"250"},{ioc:"KSA",iso2:"SA",iso:"SAU",label:"Saudi Arabia",phone:"966"},{ioc:"SOL",iso2:"SB",iso:"SLB",label:"Solomon Islands",phone:"677"},{ioc:"SEY",iso2:"SC",iso:"SYC",label:"Seychelles",phone:"248"},{ioc:"SUD",iso2:"SD",iso:"SDN",label:"Sudan",phone:"249"},{ioc:"SWE",iso2:"SE",iso:"SWE",label:"Sweden",phone:"46"},{ioc:"SIN",iso2:"SG",iso:"SGP",label:"Singapore",phone:"65"},{ioc:"HEL",iso2:"SH",iso:"SHN",label:"Saint Helena",phone:"290"},{ioc:"SLO",iso2:"SI",iso:"SVN",label:"Slovenia",phone:"386"},{ioc:"",iso2:"SJ",iso:"SJM",label:"Svalbard and Jan Mayen",phone:"47"},{ioc:"SVK",iso2:"SK",iso:"SVK",label:"Slovakia",phone:"421"},{ioc:"SLE",iso2:"SL",iso:"SLE",label:"Sierra Leone",phone:"232"},{ioc:"SMR",iso2:"SM",iso:"SMR",label:"San Marino",phone:"378"},{ioc:"SEN",iso2:"SN",iso:"SEN",label:"Senegal",phone:"221"},{ioc:"SOM",iso2:"SO",iso:"SOM",label:"Somalia",phone:"252"},{ioc:"SUR",iso2:"SR",iso:"SUR",label:"Suriname",phone:"597"},{ioc:"",iso2:"SS",iso:"SSD",label:"South Sudan",phone:"211"},{ioc:"STP",iso2:"ST",iso:"STP",label:"Sao Tome and Principe",phone:"239"},{ioc:"ESA",iso2:"SV",iso:"SLV",label:"El Salvador",phone:"503"},{ioc:"",iso2:"SX",iso:"SMX",label:"Sint Maarten",phone:"1-721"},{ioc:"SYR",iso2:"SY",iso:"SYR",label:"Syria",phone:"963"},{ioc:"",iso2:"SZ",iso:"SWZ",label:"Swaziland",phone:"268"},{ioc:"TKS",iso2:"TC",iso:"TCA",label:"Turks and Caicos Islands",phone:"1-649"},{ioc:"CHA",iso2:"TD",iso:"TCD",label:"Chad",phone:"235"},{ioc:"",iso2:"TF",iso:"ATF",label:"French Southern Territories",phone:"262"},{ioc:"TOG",iso2:"TG",iso:"TGO",label:"Togo",phone:"228"},{ioc:"THA",iso2:"TH",iso:"THA",label:"Thailand",phone:"66"},{ioc:"TJK",iso2:"TJ",iso:"TJK",label:"Tajikistan",phone:"992"},{ioc:"",iso2:"TK",iso:"TKL",label:"Tokelau",phone:"690"},{ioc:"TLS",iso2:"TL",iso:"TLS",label:"Timor-Leste",phone:"670"},{ioc:"TKM",iso2:"TM",iso:"TKM",label:"Turkmenistan",phone:"993"},{ioc:"TUN",iso2:"TN",iso:"TUN",label:"Tunisia",phone:"216"},{ioc:"TGA",iso2:"TO",iso:"TON",label:"Tonga",phone:"676"},{ioc:"TUR",iso2:"TR",iso:"TUR",label:"Turkey",phone:"90"},{ioc:"TTO",iso2:"TT",iso:"TTO",label:"Trinidad and Tobago",phone:"1-868"},{ioc:"TUV",iso2:"TV",iso:"TUV",label:"Tuvalu",phone:"688"},{ioc:"TPE",iso2:"TW",iso:"TWN",label:"Taiwan",phone:"886"},{ioc:"TAN",iso2:"TZ",iso:"TZA",label:"United Republic of Tanzania",phone:"255"},{ioc:"UKR",iso2:"UA",iso:"UKR",label:"Ukraine",phone:"380"},{ioc:"UGA",iso2:"UG",iso:"UGA",label:"Uganda",phone:"256"},{ioc:"USA",iso2:"US",label:"United States",phone:"1",suggested:!0,iso:"USA"},{ioc:"URU",iso2:"UY",iso:"URY",label:"Uruguay",phone:"598"},{ioc:"UZB",iso2:"UZ",iso:"UZB",label:"Uzbekistan",phone:"998"},{ioc:"",iso2:"VA",iso:"VAT",label:"Holy See (Vatican City State)",phone:"379"},{ioc:"VIN",iso2:"VC",iso:"VCT",label:"Saint Vincent and the Grenadines",phone:"1-784"},{ioc:"VEN",iso2:"VE",iso:"VEN",label:"Venezuela",phone:"58"},{ioc:"IVB",iso2:"VG",iso:"VGB",label:"British Virgin Islands",phone:"1-284"},{ioc:"ISV",iso2:"VI",iso:"VIR",label:"US Virgin Islands",phone:"1-340"},{ioc:"VIE",iso2:"VN",iso:"VNM",label:"Vietnam",phone:"84"},{ioc:"VAN",iso2:"VU",iso:"VUT",label:"Vanuatu",phone:"678"},{ioc:"WAF",iso2:"WF",iso:"WLF",label:"Wallis and Futuna",phone:"681"},{ioc:"SAM",iso2:"WS",iso:"WSM",label:"Samoa",phone:"685"},{ioc:"KOS",iso2:"XK",iso:"KOS",label:"Kosovo",phone:"383"},{ioc:"YEM",iso2:"YE",iso:"YEM",label:"Yemen",phone:"967"},{ioc:"MAY",iso2:"YT",iso:"MYT",label:"Mayotte",phone:"262"},{ioc:"RSA",iso2:"ZA",iso:"ZAF",label:"South Africa",phone:"27"},{ioc:"ZAM",iso2:"ZM",iso:"ZMB",label:"Zambia",phone:"260"},{ioc:"ZIM",iso2:"ZW",iso:"ZWE",label:"Zimbabwe",phone:"263"}];function Zye({participant:t,withISO2:e,withIOC:i}){let{person:n,individualParticipants:r}=t,a=[n,r==null?void 0:r.map(({person:o})=>o)].flat().filter(Boolean);function s(o){let{nationalityCode:l}=o||{};if(l){let c=ag.find(({iso:u})=>u===l);i&&c!=null&&c.ioc&&!o.iocNationalityCode&&(o.iocNationalityCode=c.ioc),e&&c!=null&&c.iso2&&!o.iso2NationalityCode&&(o.iso2NationalityCode=c.iso2),c!=null&&c.label&&!o.countryName&&(o.countryName=c.label)}}a.forEach(s)}function qqe({participantMap:t,template:e}){var i;let n=Object.values(t);for(let r of n){let a=r.participant;if((i=a.individualParticipantIds)!=null&&i.length){a.individualParticipants=[];for(let s of a.individualParticipantIds){let o=t[s].participant;a.individualParticipants.push(e?DI({template:e,source:o}):o)}}}}function ev(t){var e;let{tournamentRecord:i,participantId:n}=t,r=t.tournamentRecords||i&&{[i.tournamentId]:i}||{};for(let a of Object.values(r)){let s=(e=a.participants)==null?void 0:e.find(o=>o.participantId===n);if(s)return{participant:s,tournamentId:a.tournamentId}}return{error:Or}}function Xye(t){let{tournamentRecord:e,participantId:i}=t;if(i){let n=ev({tournamentRecord:e,participantId:i});return n.participant??n}return t.element||t.drawDefinition||t.event||t.tournamentRecord||{error:si}}function su(t){let{returnPreviousValues:e,itemSubTypes:i,itemType:n}=t,r=Xye(t);if(r.error)return r;if(i&&!Array.isArray(i))return{error:Ae,context:{itemSubTypes:i}};if(!Array.isArray(r.timeItems))return{error:t6};let a=r.timeItems.filter(o=>(o==null?void 0:o.itemType)===n).filter(o=>!(i!=null&&i.length)||i.some(l=>{var c;return(c=o==null?void 0:o.itemSubTypes)==null?void 0:c.includes(l)})).sort((o,l)=>{let c=new Date(o.createdAt||void 0).getTime(),u=new Date(l.createdAt||void 0).getTime();return c-u}),s=$t(a.pop(),!1,!0);if(s){let o={timeItem:s,...pe};return e&&Object.assign(o,{previousItems:a}),o}else return{info:Ya}}function i8({returnPreviousValues:t,drawDefinition:e,itemSubTypes:i,itemType:n}){if(!e)return{error:jd};if(!e.timeItems)return{info:Ya};let{timeItem:r,previousItems:a,info:s}=su({element:e,returnPreviousValues:t,itemSubTypes:i,itemType:n});return r&&{timeItem:r,previousItems:a}||{info:s}}function wR({returnPreviousValues:t,itemSubTypes:e,itemType:i,event:n}){if(!n)return{error:Qn};if(!n.timeItems)return{info:Ya};let{timeItem:r,previousItems:a,info:s}=su({returnPreviousValues:t,element:n,itemSubTypes:e,itemType:i});return r&&{timeItem:r,previousItems:a}||{info:s}}function lF({returnPreviousValues:t,tournamentRecord:e,itemSubTypes:i,itemType:n}){if(!e)return{error:dt};if(!e.timeItems)return{info:Ya};let{timeItem:r,previousItems:a,info:s}=su({element:e,returnPreviousValues:t,itemSubTypes:i,itemType:n});return r&&{timeItem:r,previousItems:a}||{info:s}}function n8({returnPreviousValues:t,tournamentRecord:e,participantId:i,itemSubTypes:n,itemType:r}){if(!e)return{error:dt};if(!i)return{error:da};let a=ev({tournamentRecord:e,participantId:i});if(a.error)return a;let{participant:s}=a;if(!(s!=null&&s.timeItems))return{info:Ya};let{timeItem:o,previousItems:l,info:c}=su({element:a.participant,returnPreviousValues:t,itemSubTypes:n,itemType:r});return o&&{timeItem:o,previousItems:l}||{info:c}}var Wqe={[gc]:"groupParticipantIds",[Ai]:"pairParticipantIds",[Pn]:"teamParticipantIds"},Yqe={[gc]:"groups",[Pn]:"teams"};function Jye({withIndividualParticipants:t,convertExtensions:e,tournamentRecord:i,withSignInStatus:n,withScaleValues:r,withGroupings:a,internalUse:s,withISO2:o,withIOC:l}){let c=[],u={};for(let p of i.participants??[]){let h=p==null?void 0:p.participantId;h&&Xqe({participantMap:u,participantId:h})}for(let p of i.participants??[]){let h=$t(p,e,s),{participantId:f,individualParticipantIds:m,participantType:g}=h;if(!u[f]){c.push(f);continue}if(Object.assign(u[f].participant,h),m){let v=Zqe({individualParticipantIds:m,participantCopy:h,participantMap:u,participantType:g,participantId:f});v.missingParticipantIds.length&&c.push(...v.missingParticipantIds)}if(n&&(u[f].participant.signedIn=Kqe(h)),r){let{ratings:v,rankings:y,seedings:b}=VU({participant:h});u[f].participant.seedings=b,u[f].participant.rankings=y,u[f].participant.ratings=v}(l||o)&&Zye({participant:u[f].participant,withISO2:o,withIOC:l})}if(t){let p=tn(t)?t:void 0;qqe({participantMap:u,template:p})}let d;return a&&(d=oF({participants:Object.values(u).map(({participant:p})=>p),participantsProfile:{convertExtensions:e},deepCopy:!1}).groupInfo),{missingParticipantIds:c,participantMap:u,groupInfo:d}}function Kqe(t){let{timeItem:e}=su({itemType:IR,element:t});return(e==null?void 0:e.itemValue)===YE}function Zqe({individualParticipantIds:t,participantCopy:e,participantMap:i,participantType:n,participantId:r}){var a;let s=[];for(let o of t){let l=(a=i[o])==null?void 0:a.participant;if(!l){s.push(o);continue}if(l[Wqe[n]].push(r),[Pn,gc].includes(n)){let{participantRoleResponsibilities:c,participantOtherName:u,participantName:d,participantId:p,teamId:h}=e,f=Yqe[n];l[f].push({participantRoleResponsibilities:c,participantOtherName:u,participantName:d,participantId:p,teamId:h})}if(n===Ai){let c=t.find(u=>u!==o);i[o].pairIdMap[r]=c,i[o].pairIdMap[c]=r}}return{missingParticipantIds:s}}function Xqe({participantMap:t,participantId:e}){if(t[e])return;let i={walkoverWins:0,defaultWins:0,walkovers:0,defaults:0,losses:0,wins:0};t[e]={structureParticipation:{},potentialMatchUps:{},scheduleConflicts:{},scheduleItems:[],participant:{groupParticipantIds:[],pairParticipantIds:[],teamParticipantIds:[],seedings:{},rankings:{},ratings:{},groups:[],teams:[]},statistics:{},opponents:{},pairIdMap:{},matchUps:{},events:{},draws:{},counters:{[On]:{...i},[Nn]:{...i},[Pn]:{...i},...i}}}function Qy({participantsProfile:t,useParticipantMap:e,tournamentRecord:i,contextProfile:n,inContext:r}){if(e)return Jye({...t,...n,tournamentRecord:i});let a=$t(i.participants,!1,!0)||[];(t!=null&&t.withIOC||t!=null&&t.withISO2)&&a.forEach(o=>Zye({participant:o,...t}));let s;if((r||t!=null&&t.withGroupings)&&a!=null&&a.length&&({participantsWithGroupings:a,groupInfo:s}=oF({participantsProfile:t,deepCopy:!1,participants:a})),(t==null?void 0:t.withScaleValues)&&(a==null?void 0:a.length))for(let o of a){let{ratings:l,rankings:c}=VU({participant:o});o.rankings=c,o.ratings=l}return{participants:a,groupInfo:s}}function fn({onlySpecifiedPolicyTypes:t=!1,policyTypes:e=[],tournamentRecord:i,drawDefinition:n,structure:r,event:a}){if(!Array.isArray(e))return{error:H5};let s={};return i&&o(i),a&&o(a),n&&o(n),r&&o(r),{appliedPolicies:s,...pe};function o(l){var c,u;let d=(u=(c=l==null?void 0:l.extensions)==null?void 0:c.find(p=>p.name===qE))==null?void 0:u.value;if(d)for(let p of Object.keys(d))(t?e.includes(p):!e.length||e.includes(p))&&(s[p]=$t(d[p],!1,!0))}}function Rm({policyTypes:t=[],tournamentRecord:e,drawDefinition:i,structure:n,event:r}){if(!Array.isArray(t))return{error:H5};let{appliedPolicies:a}=fn({tournamentRecord:e,drawDefinition:i,structure:n,event:r}),s={};for(let o of t){let l=a==null?void 0:a[o];l&&(s[o]=l)}return Object.keys(s).length?{policyDefinitions:s}:{info:aT.message}}var Qye="WALKOVER",YX="RETIRED",r8="COMPETITIVE",KE="ROUTINE",ZE="DECISIVE",aA="winRatio",Jqe={[Pf]:{policyName:"Competitive Bands Default",profileBands:{[ZE]:20,[KE]:50}}},a8=Jqe;function Mm({policyDefinitions:t,tournamentRecord:e,contextProfile:i,drawDefinition:n,event:r}){let a={policies:{}};if(!i)return a;let s=Rm({tournamentRecord:e,drawDefinition:n,event:r}).policyDefinitions;if(i.withCompetitiveness){let o=(t==null?void 0:t[Pf])??(s==null?void 0:s[Pf])??a8[Pf];a.policies[Pf]=o}return a}function eb({tournamentRecord:t,drawDefinition:e,policyType:i,structure:n,event:r}){if(!t)return{error:dt};let{appliedPolicies:a}=fn({tournamentRecord:t,drawDefinition:e,structure:n,event:r});return a!=null&&a[i]?{policy:a[i]}:{info:aT==null?void 0:aT.message}}function SR({tournamentRecord:t,categoryName:e,categoryType:i,event:n}){var r,a,s,o,l,c;e=e??((r=n==null?void 0:n.category)==null?void 0:r.categoryName)??((a=n==null?void 0:n.category)==null?void 0:a.ageCategoryCode),i=i??((s=n==null?void 0:n.category)==null?void 0:s.categoryType)??((o=n==null?void 0:n.category)==null?void 0:o.subType);let{policy:u}=eb({policyType:Xg,tournamentRecord:t,event:n}),d=(l=t?xi({element:t,name:sm}).extension:void 0)==null?void 0:l.value,p=(c=n&&xi({name:sm,element:n}).extension)==null?void 0:c.value;return{scheduleTiming:{tournamentScheduling:d,eventScheduling:p,categoryName:e,categoryType:i,policy:u}}}function s8({drawDefinition:t,attributes:e}){let{extension:i}=xi({element:t,name:G_}),n=(i==null?void 0:i.value)||{};return e.forEach(r=>{Object.keys(r).forEach(a=>{n[a]?Object.assign(n[a],r[a]):n[a]=r[a]})}),i={name:G_,value:n},XL({drawDefinition:t,extension:i}),{entryProfile:n}}function TR({drawDefinition:t}){let{extension:e}=xi({element:t,name:G_});return{entryProfile:(e==null?void 0:e.value)||{}}}var Bu="ALTERNATE",UR="CONFIRMED",dl="DIRECT_ACCEPTANCE",DR="FEED_IN",ER="JUNIOR_EXEMPT",om="LUCKY_LOSER",PR="ORGANISER_ACCEPTANCE",CR="QUALIFIER",Qqe="REGISTERED",RR="SPECIAL_EXEMPT",ou="UNGROUPED",tb="UNPAIRED",yT="WILDCARD",Wh="WITHDRAWN",sA=[UR,dl,ER,PR,RR],ebe=[DR,om,CR],ib=[UR,dl,DR,ER,PR,RR,yT],sd=[UR,dl,ER,om,CR,PR,RR,yT],tbe=[Bu,UR,dl,DR,ER,om,PR,CR,Qqe,RR,ou,tb,yT,Wh],e3e={ALTERNATE:Bu,CONFIRMED:UR,DIRECT_ACCEPTANCE:dl,DIRECT_ENTRY_STATUSES:ib,DRAW_SPECIFIC_STATUSES:ebe,EQUIVALENT_ACCEPTANCE_STATUSES:sA,FEED_IN:DR,JUNIOR_EXEMPT:ER,LUCKY_LOSER:om,ORGANISER_ACCEPTANCE:PR,QUALIFIER:CR,SPECIAL_EXEMPT:RR,STRUCTURE_SELECTED_STATUSES:sd,UNGROUPED:ou,UNPAIRED:tb,VALID_ENTRY_STATUSES:tbe,WILDCARD:yT,WITHDRAWN:Wh};function o8({stage:t,drawDefinition:e}){let{entryProfile:i}=TR({drawDefinition:e}),n=Object.keys(i).includes(t);if(!n&&BL.includes(t)){let r=[{[t]:{drawSize:void 0,alternates:!0}}];return s8({drawDefinition:e,attributes:r}),!0}return n}function t3e({stage:t,drawDefinition:e}){var i;let{entryProfile:n}=TR({drawDefinition:e});return((i=n[t])==null?void 0:i.alternates)||0}function i3e({stage:t,drawDefinition:e}){var i;let{entryProfile:n}=TR({drawDefinition:e});return((i=n[t])==null?void 0:i.wildcardsCount)||0}function Xj({stage:t,drawDefinition:e,entryStatus:i}){return e.entries.reduce((n,r)=>r.entryStage===t&&r.entryStatus===i?n+1:n,0)}function Pw({provisionalPositioning:t,placementGroup:e,drawDefinition:i,stageSequence:n,entryStatuses:r,structureId:a,roundTarget:s,stages:o,stage:l}){var c;let u=((c=i.entries)==null?void 0:c.reduce((d,p)=>{var h,f;let m=(f=(h=xi({name:Yp,element:p}))==null?void 0:h.extension)==null?void 0:f.value,g=l&&p.entryStage===l||(o==null?void 0:o.length)&&p.entryStage&&o.includes(p.entryStage),v=!r||p.entryStatus&&r.includes(p.entryStatus),y=p.entryStageSequence??1;return g&&(!n||y===n)&&v&&(!s||!m||s===m)?d.concat(p):d},[]))??[];if(a&&l===Mr){let{playoffEntries:d,error:p}=n3e({provisionalPositioning:t,drawDefinition:i,structureId:a});return p&&console.log("playoff entries error"),(d!=null&&d.length?d:u).filter(h=>!e||h.placementGroup===e)}return u}function n3e({provisionalPositioning:t,drawDefinition:e,structureId:i}){let n=[],r=(e.links??[]).find(a=>a.linkType===im&&a.target.structureId===i);if(r){let{finishingPositions:a,structureId:s}=r.source,{structure:o}=fi({drawDefinition:e,structureId:s});(o==null?void 0:o.structureType)===Eo&&(o.structures??[]).forEach(l=>{let c=l.positionAssignments??[],{structureId:u}=l,d=u,p=Object.assign({},...c.map(m=>{var g;let{participantId:v}=m,y=(g=xi({element:m,name:wg}).extension)==null?void 0:g.value;return y&&v?{[v]:y}:void 0}).filter(Boolean)),h=Object.keys(p).reduce((m,g)=>{let v=p[g],y=v.groupOrder||t&&v.provisionalOrder;return m.includes(y)||m.push(y),m},[]).length===Object.keys(p).length,f=Object.keys(p).filter(m=>{let g=p[m],v=g.groupOrder||t&&g.provisionalOrder;return a==null?void 0:a.includes(v)});(!t||h)&&f.forEach(m=>{let g=p[m],{groupOrder:v,provisionalOrder:y,GEMscore:b}=g,I=v||t&&y,T=[...a??[]].sort(ra).indexOf(I)+1;n.push({entryStage:Mr,entryStatus:DR,placementGroup:T,groupingValue:d,participantId:m,GEMscore:b})})})}return{playoffEntries:n}}function r3e({stage:t,drawDefinition:e}){return ib.reduce((i,n)=>(Xj({drawDefinition:e,entryStatus:n,stage:t})||0)+i,0)}function Zc({provisionalPositioning:t,returnAllProxies:e,drawDefinition:i,structureId:n,structure:r}){var a;let s,o=[];r||({structure:r,error:s}=fi({drawDefinition:i,structureId:n}));let l=Gn({structure:r}).positionAssignments;if(s||!r)return{seedAssignments:[],error:yr};n||(n=r.structureId);let{stage:c,stageSequence:u}=r,d=c===Mr&&i&&Pw({provisionalPositioning:t,drawDefinition:i,stageSequence:u,structureId:n,stage:c}),p=d?d.filter(m=>m.placementGroup===1).sort((m,g)=>m.GEMscore<g.GEMscore&&1||m.GEMscore>g.GEMscore&&-1||0).map((m,g)=>{let v=g+1;return{participantId:m.participantId,seedValue:v,seedProxy:!0,seedNumber:v}}):[],h=p==null?void 0:p.slice(0,e?p.length:l.length/2);h.length?o=h:r.seedAssignments?o=r.seedAssignments:s=rge;let f=r.seedLimit??((a=r==null?void 0:r.positionAssignments)==null?void 0:a.length);return{seedAssignments:o,stageSequence:u,seedLimit:f,stage:c,error:s}}function rp(t){if(!t)return;let{tieFormatId:e,tieFormats:i}=t;if(t.tieFormat)return t.tieFormat;if(e&&Array.isArray(i))return i.find(n=>n.tieFormatId===e)}function SD({item:t,drawDefinition:e,structure:i,event:n}){var r,a,s;if(t){if(t.tieFormat)return t.tieFormat;if(t.tieFormatId)return e.tieFormat?e.tieFormat:((r=e.tieFormats)==null?void 0:r.find(o=>t.tieFormatId===o.tieFormatId))||(n.tieFormat?n.tieFormat:(a=n.tieFormats)==null?void 0:a.find(o=>t.tieFormatId===o.tieFormatId));if(i.tieFormat)return i.tieFormat;if(i.tieFormatId){let o=(s=e.tieFormats)==null?void 0:s.find(l=>i.tieFormatId===l.tieFormatId);if(o)return o}}}function Ws({drawDefinition:t,structure:e,matchUp:i,event:n}){return{tieFormat:SD({item:i,drawDefinition:t,structure:e,event:n})||SD({item:e,drawDefinition:t,structure:e,event:n})||rp(t)||rp(n)}}function a3e({matchUps:t}){let e=t.reduce((i,n)=>!n.collectionPosition||i.includes(n.collectionPosition)?i:i.concat(n.collectionPosition),[]).map(i=>({[i]:t.filter(n=>n.collectionPosition===i)}));return{collectionPositionMatchUps:Object.assign({},...e)}}function Us({drawDefinition:t,structure:e}){let i={},n=[];return((t==null?void 0:t.structures)??[e]).filter(r=>r&&typeof r=="object").forEach(r=>{if(!r)return;let{structureId:a,matchUps:s,structures:o}=r,l=Array.isArray(o);if(l)l&&o.forEach(c=>{let{structureName:u}=c,d=c.matchUps;i[c.structureId]={matchUps:d,itemStructureIds:[],structureName:u},d&&(n.push(...d),d.forEach(p=>{p.tieMatchUps&&n.push(...p.tieMatchUps)})),i[a]||(i[a]={itemStructureIds:[],matchUps:[]}),i[a].itemStructureIds||(i[a].itemStructureIds=[]),i[a].itemStructureIds.push(c.structureId)});else{let c=s;i[a]={matchUps:c,itemStructureIds:[]},c==null||c.forEach(u=>{n.push(u),u.tieMatchUps&&n.push(...u.tieMatchUps)})}}),{mappedMatchUps:i,drawMatchUps:n}}function by({mappedMatchUps:t,matchUpsMap:e,structureId:i,inContext:n}){t=(e==null?void 0:e.mappedMatchUps)??t;let r=t[i],a=((r==null?void 0:r.itemStructureIds)||[]).map(s=>{let{matchUps:o,structureName:l}=t[s];return n?o.map(c=>Object.assign($t(c,!0,!0),{containerStructureId:i,structureId:s,structureName:l})):o}).flat();return((r==null?void 0:r.matchUps)||[]).concat(...a)}function ibe({groupedOrder:t,roundPositionsCount:e}){if(!t||(t==null?void 0:t.length)<=e)return t;let i=Na(t,t.length/e).map(r=>r.reduce((a,s)=>a+s)),n=i.slice().sort(ra);return i.map(r=>n.indexOf(r)+1)}function cF(t){if(!tn(t))return!1;let{matchUpId:e,drawPositions:i}=t,n=typeof e=="string",r=!i||Array.isArray(i)&&i.length<=2&&i.every(a=>wi(a)||a===void 0||a===null);return n&&r}function lu(t){return Array.isArray(t)?t.every(cF):!1}function yo({matchUps:t=[],interpolate:e}){var i;if(!lu(t))return{roundMatchUps:[],error:Ae};let n=t.reduce((p,h)=>{let f=typeof h.roundNumber=="string"?di(h.roundNumber):h.roundNumber;return!h.roundNumber||p.includes(f)?p:p.concat(f)},[]).sort(ra).map(p=>{let h=t.filter(g=>g.roundNumber===p),f=h.find(({matchUpType:g})=>g===Xn)?h.filter(({matchUpType:g})=>g===Xn):h,m=g=>g.sort((v,y)=>ra(v.roundPosition,y.roundPosition));return{[p]:m(f)}}),r=t.reduce((p,h)=>{let f=typeof h.roundNumber=="string"?di(h.roundNumber):h.roundNumber;return p[f]||(p[f]=Zt({abbreviatedRoundName:h.abbreviatedRoundName,finishingRound:h.finishingRound,roundName:h.roundName})),p},{}),a=Object.assign({},...n);if(e){let p=Math.max(...Object.keys(a).map(f=>di(f)).filter(f=>!isNaN(f))),h=(i=a[p])==null?void 0:i.length;if(h>1&&kd(h)){let f=p+1,m=f+h/2;Mt(f,m).forEach((g,v)=>{a[g]=Mt(0,h/(2+v*2)).map(()=>({}))})}}let s=0,o=Object.assign({},...Object.keys(a).map(p=>{var h,f,m;let g=(h=a[p])==null?void 0:h.length,v=(m=(f=a[p])==null?void 0:f.filter(b=>{var I;return!va.includes(b.matchUpStatus)&&!((I=b.score)!=null&&I.scoreStringSide1)}))==null?void 0:m.length,y=g&&g===v;return s=Math.max(s,g),{[p]:{matchUpsCount:g,inactiveCount:v,inactiveRound:y}}})),l=0,c=0,u=Object.keys(a).map(p=>di(p)).filter(p=>!isNaN(p));u.forEach(p=>{var h,f,m,g,v;let y=a[p].sort((I,T)=>I.roundPosition-T.roundPosition),b=y.map(I=>(I==null?void 0:I.drawPositions)||[]).flat();if(o[p].roundNumber=p,o[p].roundFactor=o[p].matchUpsCount?s/o[p].matchUpsCount:1,o[p].finishingRound=(h=r[p])==null?void 0:h.finishingRound,o[p].roundName=(f=r[p])==null?void 0:f.roundName,o[p].abbreviatedRoundName=(m=r[p])==null?void 0:m.abbreviatedRoundName,o[p].finishingPositionRange=(v=(g=a[p])==null?void 0:g[0])==null?void 0:v.finishingPositionRange,p===1||!o[p-1]){let I=b.sort(ra),T=Na(I,2);o[p].drawPositions=I,o[p].pairedDrawPositions=T}else{let I=o[p-1],T=I.drawPositions,w=I.matchUpsCount/o[p].matchUpsCount,S=Na(T,w),U=y.map(P=>{let{roundPosition:E}=P,R=[...P.drawPositions||[],void 0,void 0].slice(0,2);if(!E)return R;let C=(R==null?void 0:R.filter(Boolean))||[];if(!(C!=null&&C.length))return[void 0,void 0];if(p<3&&(C==null?void 0:C.length)===2)return R==null?void 0:R.slice().sort(ra);let M=Ar(T,C).length!==(C==null?void 0:C.length);if(C!=null&&C.length&&M)return(C==null?void 0:C.length)===1?[C[0],void 0]:R==null?void 0:R.slice().sort(ra);let _=(E-1)*2;return S.slice(_,_+2).map(A=>C==null?void 0:C.find(N=>A.includes(N)))});o[p].drawPositions=U==null?void 0:U.flat(),o[p].pairedDrawPositions=U}o[p+1]&&o[p+1].matchUpsCount===o[p].matchUpsCount&&(o[p+1].feedRound=!0,o[p+1].feedRoundIndex=c,o[p].preFeedRound=!0,c+=1),o[p]&&!o[p].feedRound&&(o[p].roundIndex=l,l+=1)});let d=!!Object.values(o).find(({matchUpsCount:p})=>!kd(p));return{hasNoRoundPositions:t.some(p=>!p.roundPosition),roundsNotPowerOf2:d,maxMatchUpsCount:s,roundMatchUps:a,roundNumbers:u,roundProfile:o,...pe}}function oA(t){if(!Array.isArray(t))return"";let e=t.filter(Er);return e.length?Pi([Math.min(...e),Math.max(...e)]).join("-"):""}function s3e({drawDefinition:t,structureId:e,matchUpsMap:i}){if(!t)return{error:Ht};if(!e)return{error:mc};let{structure:n}=fi({drawDefinition:t,structureId:e});if((n==null?void 0:n.stage)!==ws)return{error:Ky,info:"Structure is not CONSOLATION stage"};let{links:r}=t,a=(r==null?void 0:r.filter(d=>d.target.structureId===e))||[],s=(a==null?void 0:a.reduce((d,p)=>{let{structureId:h}=p.source;return d.includes(h)?d:d.concat(h)},[]))||[],o=Object.assign({},...s.map(d=>{let p=by({structureId:d,matchUpsMap:i}),h=yo({matchUps:p}).roundProfile;return{[d]:h}})),l=by({matchUpsMap:i,structureId:e}),{roundProfile:c}=yo({matchUps:l}),u={};return a==null||a.forEach(d=>{var p,h,f;let{structureId:m,roundNumber:g}=d.source,{feedProfile:v,groupedOrder:y,positionInterleave:b,roundNumber:I}=d.target,T=o[m],w=(p=T[1])==null?void 0:p.drawPositions,S=(h=T[g])==null?void 0:h.matchUpsCount;if(!S)return;let U=S?w.length/S:0,P=w.length/U,E=w.slice(),R=ibe({roundPositionsCount:P,groupedOrder:y}),C=(R==null?void 0:R.length)||1;if(C<=P){let A=w.length/C,N=Na(E,A);v===my&&N.forEach(k=>k.reverse()),E=(R==null?void 0:R.length)&&(R==null?void 0:R.map(k=>N[k-1]).flat())||E}let M=Na(E,U);if(b){let A=Mt(0,b.interleave).map(()=>{}),N=Mt(0,b.offset).map(()=>{});M=M.map(O=>[O,...A]),M.unshift(N),M=M.flat(1);let k=M.length-b.offset;M=M.slice(0,k)}u[I]||(u[I]={});let _=(f=c==null?void 0:c[I])!=null&&f.feedRound?2:1;M.forEach((A,N)=>{let k=1+N*_;u[I][k]||(u[I][k]=oA(A))})}),{sourceDrawPositionRanges:u}}function nbe({drawDefinition:t}){if(typeof t!="object")return{error:Yb};let e={},{structures:i=[],links:n=[]}=t||{},r=i.reduce((s,o)=>{let{stage:l}=o;return s[l]?s[l].push(o):s[l]=[o],s},{});for(let s of Object.keys(r)){let o=r[s].find(({stageSequence:c})=>c===1);if(!o)continue;let{structureId:l}=o;a({aggregator:{},targetRound:0,exitProfiles:e,exitProfile:"0",structureId:l,stage:s})}return{exitProfiles:e};function a({exitProfiles:s,exitProfile:o,structureId:l,targetRound:c,aggregator:u,stage:d}){s[l]||(s[l]=[]),o==="0"&&[ws,Mr].includes(d)||s[l].push(o);let p=n.filter(h=>h.source.structureId===l&&h.source.roundNumber>=c);for(let h of p){let f=h.source.roundNumber,m=h.target.roundNumber,g=h.target.structureId,v=i.find(b=>b.structureId===g).stage,y=[v,g,m,f].join("|");if(u[y])return;u[y]=!0,a({exitProfile:`${o}-${f}`,structureId:g,exitProfiles:s,targetRound:m,aggregator:u,stage:v})}}}function o3e({drawDefinition:t,roundProfile:e,structureId:i,matchUpsMap:n}){var r;if(!t)return{error:Ht};if(!i)return{error:mc};if(!e){let o=by({matchUpsMap:n,structureId:i});if({roundProfile:e}=yo({matchUps:o}),!e)return{error:si}}let a=(Math.min(...((r=e==null?void 0:e[1])==null?void 0:r.drawPositions)??[])||1)-1,s=Object.keys(e);return{drawPositionsRanges:Object.assign({},...(s||[]).map(o=>{var l,c;let u=(l=e==null?void 0:e[o])==null?void 0:l.matchUpsCount,d=((c=e==null?void 0:e[1])==null?void 0:c.drawPositions)??[],p=Na(d,d.length/u),h=p.map(oA),f=p.map(b=>b.map(I=>I-a)).map(oA),m=s.map(b=>{var I;if(b>o)return;let T=((I=e==null?void 0:e[b])==null?void 0:I.drawPositions)??[];return Na(T,T.length/u)}).filter(Boolean),g=Mt(0,u).map(b=>m.map(I=>I[b]).flat().filter(Boolean).sort(ra)).map(b=>Pi(b)),v=g.map(b=>DHe(b).map(oA).join(", ")),y=Object.assign({},...Mt(0,u).map(b=>({[b+1]:{firstRoundDrawPositionsRange:h[b],firstRoundOffsetDrawPositionsRange:f[b],possibleDrawPositions:g[b],drawPositionsRange:v[b]}})));return{[o]:y}}))}}function l8({roundsNotPowerOf2:t,drawDefinition:e,structure:i,matchUps:n}){var r;if(!i)return!1;n=n??i.matchUps??[],t=t??yo({matchUps:n}).roundsNotPowerOf2;let a=!!((r=i.positionAssignments)!=null&&r.find(({drawPosition:s})=>s))||!!(n!=null&&n.find(({drawPositions:s})=>s==null?void 0:s.length));return(!(e!=null&&e.drawType)||e.drawType!==Zy)&&!(i!=null&&i.structures)&&t&&a}function Ho({structure:t}){if(!t)return!1;let e=t.matchUps||t.roundMatchUps&&Object.values(t.roundMatchUps).flat(),i=!!(e!=null&&e.find(r=>r==null?void 0:r.roundPosition)),n=!!(e!=null&&e.find(r=>{var a;return(a=r==null?void 0:r.drawPositions)==null?void 0:a.length}));return!(t!=null&&t.structures)&&(t==null?void 0:t.stage)!==ja&&(!e.length||!i&&!n)}var c8={[mT]:{policyName:"Round Naming Default",namingConventions:{round:"Round",pre:"Pre"},qualifyingFinishMap:{1:"Final"},abbreviatedRoundNamingMap:{1:"F",2:"SF",4:"QF"},roundNamingMap:{1:"Final",2:"Semifinal",4:"Quarterfinal"},affixes:{roundNumber:"R",preFeedRound:"Q",preQualifying:"P"},stageConstants:{[Bt]:"",[Mr]:"P",[ri]:"Q",[ws]:"C"}}},l3e=c8;function c3e({roundNamingPolicy:t,drawDefinition:e,structure:i,matchUps:n}){var r,a,s;let{roundProfile:o,roundMatchUps:l}=yo({matchUps:n}),{structureAbbreviation:c,stage:u}=i,d=Ho({structure:i}),p=l8({structure:i}),h=i.structures,f={},m=c8[mT],g=i.stage===ri,v=g?Math.max(...((e==null?void 0:e.structures)??[]).filter(A=>A.stage===ri).map(({stageSequence:A})=>A??1),0):0,y=(i.stageSequence??1)<v?i.stageSequence??1:"",b=y&&(((r=t==null?void 0:t.affixes)==null?void 0:r.preQualifying)||m.affixes.preQualifying)||"",I=(t==null?void 0:t.roundNamingMap)||m.roundNamingMap||{},T=(t==null?void 0:t.abbreviatedRoundNamingMap)||m.abbreviatedRoundNamingMap||{},w=((a=t==null?void 0:t.affixes)==null?void 0:a.preFeedRound)||m.affixes.preFeedRound,S=((s=t==null?void 0:t.affixes)==null?void 0:s.roundNumber)||m.affixes.roundNumber,U=((t==null?void 0:t.namingConventions)||m.namingConventions).round,P=u&&u!==Bt?u[0]:"",E=(t==null?void 0:t.stageConstants)||m.stageConstants,R=u&&(E==null?void 0:E[u])||P,C=`${b}${R}${y}`,M=o?Object.keys(o):[],_=g&&E!=null&&E[ri]?`${E==null?void 0:E[ri]}-`:"";if(h||d||p)Object.assign(f,...M.map(A=>{let N=`${_}${U} ${A}`,k=`${S}${A}`;return{[A]:{roundName:N,abbreviatedRoundName:k}}}));else{let A=g&&((t==null?void 0:t.qualifyingFinishMap)||(m==null?void 0:m.qualifyingFinishMap)||{});Object.assign(f,...M.map(N=>{if(!(o!=null&&o[N]))return;let{matchUpsCount:k,preFeedRound:O}=o[N],$=k*2,F=(A==null?void 0:A[o==null?void 0:o[N].finishingRound])||A&&`${S}${$}`||I[k]||`${S}${$}`,V=O?`-${w}`:"",j=`${F}${V}`,B=[C,c,j].filter(Boolean).join("-"),z=`${T[k]||`${S}${$}`}${V}`,W=[C,c,z].filter(Boolean).join("-");return{[N]:{abbreviatedRoundName:W,roundName:B}}}))}return{roundNamingProfile:f,roundProfile:o,roundMatchUps:l}}var u3e=(t,e)=>(t||0)+(e||0);function rbe(t,e){let i=Array.isArray(t)?t[0]:t;return isNaN(i)&&Qye||i<=e[ZE]&&ZE||i<=e[KE]&&KE||r8}function abe({score:t}){let e=(t==null?void 0:t.sets)||[],i=e.reduce((r,a)=>(r[0]+=a.side1Score||0,r[1]+=a.side2Score||0,r),[0,0]),n=e.reduce((r,a)=>(r[0]+=a.side1TiebreakScore||0,r[1]+=a.side2TiebreakScore||0,r),[0,0]);return n.reduce(u3e)&&(i[n[0]>n[1]?0:1]+=1),{sets:e,games:i,score:t}}function d3e(t){let e=Math.min(...t.games),i=Math.max(...t.games);return Math.round(e/i*100)}function sbe(t){return t.map(d3e).sort().map(e=>parseFloat(e.toFixed(2)))}function MR({tournamentRecord:t,profileBands:e,matchUp:i}){if(!i)return{error:ll};let{score:n,winningSide:r}=i;if(!r)return{error:Ae};let a=!e&&t&&eb({policyType:Pf,tournamentRecord:t}).policy,s=e||(a==null?void 0:a.profileBands)||a8[Pf].profileBands,o=abe({score:n}),l=sbe([o]),c=rbe(l,s),u=Array.isArray(l)?l[0]:l;return{...pe,competitiveness:c,pctSpread:u}}function obe({matchUp:t}){var e,i,n;if(!t)return{error:ll};if(t&&!t.sides)return{error:cl};if(t&&!t.hasContext)return{error:RL};let r=(e=t.sides??[])==null?void 0:e.map(c=>c==null?void 0:c.participantId).filter(Boolean),a=((i=t.sides)==null?void 0:i.filter(c=>{var u;return((u=c.participant)==null?void 0:u.participantType)===Hi}).map(c=>c.participantId).filter(Boolean))??[],s=(((n=t.sides??[])==null?void 0:n.map(c=>{var u;return(u=c.participant)==null?void 0:u.individualParticipants}).filter(Boolean))??[]).map(c=>(c??[]).map(u=>u==null?void 0:u.participantId).filter(Boolean)),o=[...a,...s.flat()].filter(Boolean)??[],l=Pi(o.concat(r)).filter(Boolean)??[];return{nestedIndividualParticipantIds:s,allRelevantParticipantIds:l,individualParticipantIds:o,sideParticipantIds:r,...pe}}var z_="CHECK_IN",q_="CHECK_OUT",p3e="SCHEDULE",Cw="SCHEDULE.ASSIGNMENT.VENUE",Yh="SCHEDULE.ALLOCATION.COURTS",Dg="SCHEDULE.ASSIGNMENT.COURT",uF="SCHEDULE.COURT.ORDER",Rw="SCHEDULE.DATE",h3e="COMPLETED.DATE",u8="HOME_PARTICIPANT_ID",d8="SCHEDULE.ASSIGN.OFFICIAL",Mw="SCHEDULE.TIME.SCHEDULED",yd="SCHEDULE.TIME.START",xf="SCHEDULE.TIME.STOP",Ch="SCHEDULE.TIME.RESUME",lm="SCHEDULE.TIME.END",dF="SCHEDULE.TIME.MODIFIERS",lbe="TO_BE_ANNOUNCED",cbe="NEXT_AVAILABLE",ube="FOLLOWED_BY",dbe="AFTER_REST",pbe="RAIN_DELAY",f3e="NOT_BEFORE",Jj=[lbe,cbe,ube,dbe,pbe],m3e="ELIGIBILITY",g3e="REGISTRATION",v3e="SUSPENSION",y3e="MEDICAL",b3e="PENALTY",hbe="SCALE",fbe="RATING",mbe="RANKING",p8="SEEDING",tv="PUBLISH",vc="PUBLIC",iv="STATUS",I3e="MODIFICATION",w3e="RETRIEVAL",S3e="other",T3e={MUTUALLY_EXCLUSIVE_TIME_MODIFIERS:Jj,AFTER_REST:dbe,ALLOCATE_COURTS:Yh,ASSIGN_COURT:Dg,ASSIGN_OFFICIAL:d8,ASSIGN_VENUE:Cw,CHECK_IN:z_,CHECK_OUT:q_,COMPLETED_DATE:h3e,COURT_ORDER:uF,ELIGIBILITY:m3e,END_TIME:lm,FOLLOWED_BY:ube,MEDICAL:y3e,MODIFICATION:I3e,NEXT_AVAILABLE:cbe,NOT_BEFORE:f3e,OTHER:S3e,PENALTY:b3e,PUBLIC:vc,PUBLISH:tv,RANKING:mbe,RATING:fbe,RAIN_DELAY:pbe,REGISTRATION:g3e,RESUME_TIME:Ch,RETRIEVAL:w3e,SCALE:hbe,SCHEDULE:p3e,SCHEDULED_DATE:Rw,SCHEDULED_TIME:Mw,SEEDING:p8,START_TIME:yd,STATUS:iv,STOP_TIME:xf,SUSPENSION:v3e,TIME_MODIFIERS:dF,TO_BE_ANNOUNCED:lbe};function Nw({matchUp:t}){if(!t)return{error:ll};if(!t.hasContext)return{error:RL};if(!t.sides||t.sides.filter(Boolean).length!==2)return{error:cl};let{nestedIndividualParticipantIds:e,allRelevantParticipantIds:i,sideParticipantIds:n}=obe({matchUp:t}),r=(t.timeItems??[]).filter(o=>(o==null?void 0:o.itemType)&&[z_,q_].includes(o.itemType)).sort((o,l)=>(o.createdAt?new Date(o.createdAt).getTime():0)-(l.createdAt?new Date(l.createdAt).getTime():0)),a=r.map(o=>o.itemValue).filter(o=>r.filter(l=>(l==null?void 0:l.itemValue)===o).reverse()[0].itemType===z_);e==null||e.forEach((o,l)=>{let c=n==null?void 0:n[l],u=(o==null?void 0:o.length)&&o.every(d=>a.includes(d));c&&u&&!a.includes(c)&&a.push(c)}),n==null||n.forEach((o,l)=>{a.includes(o)&&((e==null?void 0:e[l])??[]).forEach(c=>{c&&!a.includes(c)&&a.push(c)})});let s=n==null?void 0:n.reduce((o,l)=>a.includes(l)&&o,!0);return{allRelevantParticipantIds:i,allParticipantsCheckedIn:s,checkedInParticipantIds:a,...pe}}var Br=t=>e=>{let i=tn(e)&&(e==null?void 0:e.matchUpType)||ur(e)&&e;return i&&Fme[t].includes(i)};function TD(t){var e;let{matchUpAverageTimes:i,matchUpFormat:n}=t||{},r=(i==null?void 0:i.map(({matchUpFormatCodes:s})=>s==null?void 0:s.filter(o=>o===n)).flat().filter(Boolean).sort((s,o)=>((s==null?void 0:s.length)||0)-((o==null?void 0:o.length)||0)))||[],a=r.includes(n)?n:r[0];return(e=i==null?void 0:i.find(({matchUpFormatCodes:s,averageTimes:o})=>(s==null?void 0:s.find(l=>a===l))&&o))==null?void 0:e.averageTimes}function UD(t){var e;let{matchUpRecoveryTimes:i,averageMinutes:n,matchUpFormat:r}=t||{};return(e=i==null?void 0:i.find(({matchUpFormatCodes:a,averageTimes:s,recoveryTimes:o})=>{if(s&&n){let{greaterThan:l=0,lessThan:c=360}=s;if(n>l&&n<c)return!0}return(a==null?void 0:a.find(l=>l===r))&&o}))==null?void 0:e.recoveryTimes}function gbe({timesBlockArray:t,categoryName:e,categoryType:i}){return t.filter(n=>Array.isArray(n)).map(n=>n.sort((r,a)=>{var s,o;return(((s=a.categoryNames)==null?void 0:s.length)||0)-(((o=r.categoryNames)==null?void 0:o.length)||0)}).find(({categoryTypes:r,categoryNames:a})=>!(a!=null&&a.length)&&!(r!=null&&r.length)||(a==null?void 0:a.includes(e))||(r==null?void 0:r.includes(i)))).find(Boolean)}function U3e({tournamentScheduling:t,eventScheduling:e,averageMinutes:i,defaultTiming:n,matchUpFormat:r,categoryName:a,categoryType:s,policy:o}){var l;let c=(e==null?void 0:e.matchUpRecoveryTimes)&&UD({...e,averageMinutes:i,matchUpFormat:r}),u=(t==null?void 0:t.matchUpRecoveryTimes)&&UD({...t,averageMinutes:i,matchUpFormat:r}),d=(o==null?void 0:o.matchUpRecoveryTimes)&&UD({...o,averageMinutes:i,matchUpFormat:r}),p=[c,u,d,(l=o==null?void 0:o.defaultTimes)==null?void 0:l.recoveryTimes,n==null?void 0:n.recoveryTimes];return gbe({categoryName:a,categoryType:s,timesBlockArray:p})}function D3e({matchUpFormat:t,categoryName:e,categoryType:i,defaultTiming:n,tournamentScheduling:r,eventScheduling:a,policy:s}){var o;let l=(a==null?void 0:a.matchUpAverageTimes)&&TD({...a,matchUpFormat:t}),c=(r==null?void 0:r.matchUpAverageTimes)&&TD({...r,matchUpFormat:t}),u=(s==null?void 0:s.matchUpAverageTimes)&&TD({...s,matchUpFormat:t}),d=[l,c,u,(o=s==null?void 0:s.defaultTimes)==null?void 0:o.averageTimes,n==null?void 0:n.averageTimes];return gbe({categoryName:e,categoryType:i,timesBlockArray:d})}var vbe="DOUBLES_SINGLES",ybe="SINGLES_DOUBLES",Vu="total",Qj="participantConflict",Wm="matchUpConflict",bbe="ISSUE_IDS",Sv="CONFLICT",Tv="WARNING",eG="ERROR",tG="ISSUE",lA="STATE",E3e={SINGLES_DOUBLES:ybe,DOUBLES_SINGLES:vbe,TOTAL:Vu,CONFLICT_MATCHUP_ORDER:Wm,CONFLICT_PARTICIPANTS:Qj,SCHEDULE_ISSUE_IDS:bbe,SCHEDULE_CONFLICT:Sv,SCHEDULE_WARNING:Tv,SCHEDULE_ERROR:eG,SCHEDULE_ISSUE:tG,SCHEDULE_STATE:lA};function NR({defaultAverageMinutes:t=90,defaultRecoveryMinutes:e=0,tournamentRecord:i,matchUpFormat:n,categoryName:r,categoryType:a,eventType:s,event:o}){if(!i)return{error:dt};s=s??(o==null?void 0:o.eventType)??TI;let l={averageTimes:[{minutes:{default:t}}],recoveryTimes:[{minutes:{default:e}}]},{scheduleTiming:c}=SR({tournamentRecord:i,categoryName:r,categoryType:a,event:o}),u={...c,matchUpFormat:n,categoryType:a,defaultTiming:l};return pF({eventType:s,timingDetails:u})}function pF({timingDetails:t,eventType:e}){let i=D3e(t),n=Object.keys((i==null?void 0:i.minutes)||{}),r=(i==null?void 0:i.minutes)&&((n==null?void 0:n.includes(e))&&i.minutes[e]||i.minutes.default),a=U3e({...t,averageMinutes:r}),s=Object.keys((a==null?void 0:a.minutes)||{}),o=(a==null?void 0:a.minutes)&&((s==null?void 0:s.includes(e))&&a.minutes[e]||a.minutes.default),l=Br(TI)(e)?ybe:vbe,c=(a==null?void 0:a.minutes)&&((s==null?void 0:s.includes(l))&&a.minutes[l]||o);return{averageMinutes:r,recoveryMinutes:o,typeChangeRecoveryMinutes:c}}function j$(t){return t.createdAt?new Date(t.createdAt).getTime():0}function nb({timeItems:t,itemType:e}){let i=t.filter(r=>r&&r.itemType===e).sort((r,a)=>j$(r)-j$(a)).pop(),n=i&&j$(i);return{itemValue:i==null?void 0:i.itemValue,timeStamp:n}}function Ibe({timeStamp:t,schedule:e,matchUp:i}){let{itemValue:n,timeStamp:r}=nb({timeItems:(i==null?void 0:i.timeItems)||[],itemType:Mw});return!e||r&&t&&new Date(r).getTime()>new Date(t).getTime()?{scheduledTime:n}:e}function Aw({timeStamp:t,schedule:e,matchUp:i}){let{itemValue:n,timeStamp:r}=nb({timeItems:(i==null?void 0:i.timeItems)||[],itemType:Rw});return!e||r&&t&&new Date(r).getTime()>new Date(t).getTime()?{scheduledDate:n}:e}function hb(t){if(yve.test(t)){let e=h6();return new Date(`${e}T${t}`)}else return new Date(t)}function P3e({matchUp:t}){if(!t)return{error:ll};if(!t.timeItems)return{error:t6};let e=t.timeItems.filter(n=>[yd,xf,Ch,lm].includes(n==null?void 0:n.itemType)).sort((n,r)=>hb(n.itemValue).getTime()-hb(r.itemValue).getTime()),i=e.reduce((n,r)=>{var a,s;let o,l=(a=r==null?void 0:r.itemType)==null?void 0:a.split("."),c=`SCHEDULE.TIME.${((s=r==null?void 0:r.itemType)==null?void 0:s.startsWith("SCHEDULE.TIME"))&&l[2]}`;switch(c){case yd:o=0;break;case lm:if(n.lastValue&&[yd,Ch].includes(n.lastType)){let u=hb(r.itemValue).getTime()-hb(n.lastValue).getTime();o=n.milliseconds+u}else o=n.milliseconds;break;case xf:if([yd,"SCHECULE.TIME.RESUME"].includes(n.lastType)){let u=hb(r.itemValue).getTime()-hb(n.lastValue).getTime();o=n.milliseconds+u}else o=n.milliseconds;break;default:o=n.milliseconds;break}return{milliseconds:o,lastType:c,lastValue:r.itemValue}},{milliseconds:0,lastType:void 0,lastValue:void 0});if([yd,Ch].includes(i.lastType)){let n=new Date().getTime()-hb(i.lastValue).getTime();i.milliseconds+=n}return{milliseconds:i.milliseconds,time:C3e(i.milliseconds),relevantTimeItems:e}}function C3e(t){let e=(i,n=2)=>("00"+i).slice(-n);return e(t/36e5|0)+":"+e(t%36e5/6e4|0)+":"+e(t%6e4/1e3|0)}function R3e({matchUp:t}){var e;let i=(t==null?void 0:t.timeItems)||[],n=r=>r.createdAt?new Date(r.createdAt).getTime():0;return{startTime:(e=i.reduce((r,a)=>{let s=a.itemType===yd&&a;return s&&(!r||n(s)<n(r))?s:r},void 0))==null?void 0:e.itemValue}}function AR(t){let{disableNotice:e,venue:i,context:n}=t;if(typeof i!="object")return{error:Ae};let r=au(t);i.venueId||(i.venueId=bn());let a;for(let s of Object.values(r)){let o=M3e({disableNotice:!0,tournamentRecord:s,context:n,venue:i});if(o!=null&&o.error)return o;a=o.venue}return e||Ti({topic:j6,payload:{venue:i}}),Zt({...pe,venue:a})}function M3e({tournamentRecord:t,disableNotice:e,context:i,venue:n}){return t?n?(t.venues||(t.venues=[]),n.venueId||(n.venueId=bn()),t.venues.reduce((r,a)=>r||a.venueId===n.venueId,void 0)?{error:Bge}:(i&&pn({element:n,extension:{value:i,name:Uye}}),t.venues.push(n),e||Ti({payload:{venue:n,tournamentId:t.tournamentId},topic:j6}),{...pe,venue:$t(n)})):{error:si,info:"missing venue"}:{error:dt}}function tf({tournamentRecords:t,tournamentRecord:e,venueId:i}){if(!e)return{error:dt};if(!i)return{error:Kg};let n=(e.venues??[]).reduce((r,a)=>a.venueId===i?a:r,void 0);if(!n&&t){let r=(yR({tournamentRecords:t}).linkedTournamentIds??[])[e.tournamentId];for(let a of r){let s=t[a],o=tf({tournamentRecord:s,venueId:i});if(o.success&&o.venue)return AR({tournamentRecord:e,venue:o.venue}),{...pe,venue:n}}}return n?{...pe,venue:n}:{error:Iw}}function h8({convertExtensions:t,...e}){let{tournamentRecords:i,tournamentRecord:n,venueId:r}=e,a=tf({tournamentRecords:i,tournamentRecord:n,venueId:r});return $t(a,t,!0)}function _w({tournamentRecords:t,tournamentRecord:e,courtId:i}){if(!e)return{error:dt};if(!i)return{error:vw};let n="findCourt",r,a;if((e.venues??[]).forEach(s=>{(s.courts??[]).forEach(o=>{o.courtId===i&&(r=o,a=s)})}),r)return{...pe,court:r,venue:a};if(t){let s=(yR({tournamentRecords:t}).linkedTournamentIds??[])[e.tournamentId];for(let o of s){let l=t[o],c=_w({tournamentRecord:l,courtId:i});if(c.success)return c.venue&&AR({tournamentRecord:e,venue:c.venue}),{...pe,court:r,venue:a}}}return fe({result:{error:OU},stack:n})}function f8(t){return $t(_w(t),!1,!0)}function hF({tournamentRecord:t,internalUse:e,courtId:i}){if(!t)return{error:dt};if(!i)return{error:vw};let n=_w({tournamentRecord:t,courtId:i});if(n.error)return n;let r=n.court&&(({altitude:a,courtId:s,courtName:o,courtDimensions:l,latitude:c,longitude:u,surfaceCategory:d,surfaceType:p,surfacedDate:h,pace:f,notes:m})=>({altitude:a,courtId:s,courtName:o,courtDimensions:l,latitude:c,longitude:u,surfaceCategory:d,surfaceType:p,surfacedDate:h,pace:f,notes:m}))(n.court);return{...pe,courtInfo:$t(r,!1,e)}}function bT(t){var e;let i=ei(t,[{[Ia]:!0},{venueId:!0,[$u]:Kg}]);if(i.error)return i;let{tournamentRecord:n,venueId:r}=t,a=tf({tournamentRecord:n,venueId:r});if(a.error)return a;let s=(((e=a.venue)==null?void 0:e.courts)??[]).map(c=>(({courtInfo:u})=>({...u}))(hF({courtId:c.courtId,internalUse:!0,tournamentRecord:n}))),o=a.venue&&(({venueId:c,venueName:u,venueAbbreviation:d})=>({venueAbbreviation:d,venueName:u,venueId:c}))(a.venue),l=o&&{...o,courtsInfo:s};return{...pe,venueData:$t(l,!1,!0)}}function N3e({matchUp:t}){var e;let i=(t==null?void 0:t.timeItems)||[],n=r=>r.createdAt?new Date(r.createdAt).getTime():0;return{endTime:(e=i.reduce((r,a)=>{let s=a.itemType===lm&&a;return s&&(!r||n(s)>n(r))?s:r},void 0))==null?void 0:e.itemValue}}function kr({event:t,eventId:e}){var i,n;if(!t)return{error:Qn};let r=(i=xi({name:Xu,element:t}))==null?void 0:i.extension,a=e?$t(r==null?void 0:r.value,!1,!0):r==null?void 0:r.value;return e&&((n=t.drawDefinitions)==null||n.forEach(s=>{var o;(o=a==null?void 0:a.flights)==null||o.forEach(l=>{l.drawId===s.drawId&&Object.assign(l,{drawDefinition:s})})})),{flightProfile:a}}function zo(t){let{tournamentRecord:e,eventId:i,drawId:n}=t,r="findEvent",a={},s=t.tournamentRecords??(e&&{[e.tournamentId]:e})??{},o=Object.values(s).map(({events:c,tournamentId:u})=>(c&&c.forEach(d=>{a[d.eventId]={tournamentId:u}}),c??[])).flat(),l;if(n){let c,u=o.find(d=>{var p,h,f;let m=((d==null?void 0:d.drawDefinitions)??[]).find(g=>g.drawId===n);if(m)c=m,l=a[d.eventId].tournamentId;else{let g=(f=(h=d&&((p=kr({event:d}))==null?void 0:p.flightProfile))==null?void 0:h.flights)==null?void 0:f.find(v=>v.drawId===n);if(g)return l=a[d.eventId].tournamentId,{entries:g.drawEntries,drawName:g.drawName,tournamentId:l,drawId:n}}return m});if(u)return{event:u,drawDefinition:c,tournamentId:l}}if(i){let c=o.find(u=>(u==null?void 0:u.eventId)===i);if(c)l=a[c.eventId].tournamentId;else return{event:void 0,drawDefinition:void 0,...fe({result:{error:Wc},stack:r})};return{event:c,drawDefinition:void 0,tournamentId:l}}return{event:void 0,drawDefinition:void 0,...fe({result:{error:sc},context:{drawId:n,eventId:i},stack:r})}}function fF(t){var e,i,n,r,a,s,o,l,c,u;let d=t.event,p=t.matchUpType,{scheduleVisibilityFilters:h,afterRecoveryTimes:f,tournamentRecord:m,usePublishState:g,scheduleTiming:v,matchUpFormat:y,publishStatus:b,matchUp:I}=t;if(!I)return{error:ll};if(f&&!I.matchUpType&&!t.matchUpType&&(d||m)&&I.drawId){let A=t.drawDefinition||((e=d==null?void 0:d.drawDefinitions)==null?void 0:e.find(k=>k.drawId===I.drawId));!A&&m&&({drawDefinition:A,event:d}=zo({drawId:I.drawId,tournamentRecord:m}));let N=I.structureId&&((i=A==null?void 0:A.structures)==null?void 0:i.find(({structureId:k})=>k===I.structureId));p=t.matchUpType||(N==null?void 0:N.matchUpType)||(A==null?void 0:A.matchUpType)||(d==null?void 0:d.eventType)!==aa&&(d==null?void 0:d.eventType)}let{milliseconds:T,time:w}=P3e({matchUp:I}),{startTime:S}=R3e({matchUp:I}),{endTime:U}=N3e({matchUp:I}),P,{eventIds:E,drawIds:R}=h??{};if((!E||E.includes(I.eventId))&&(!R||R.includes(I.drawId))){let A=we=>we.createdAt?new Date(we.createdAt).getTime():0,N=new Map,k=((n=I.timeItems)==null?void 0:n.toSorted((we,ze)=>A(we)-A(ze)))??[];for(let we of k)N.set(we.itemType,we.itemValue);let O=N.get(u8),$=N.get(Yh),F=N.get(Mw),V=N.get(dF),j=N.get(Rw),B=N.get(d8),z=N.get(uF),W=N.get(Cw),Z=N.get(Dg),K,Q,J,se,ie,ce=I.matchUpType??p;if(v&&F&&f&&ce){let we={matchUpFormat:I.matchUpFormat??y,...v};({averageMinutes:Q=0,recoveryMinutes:J=0,typeChangeRecoveryMinutes:se=0}=pF({timingDetails:we,eventType:ce})),(Q||J)&&(K=U?nl(sr(U),J):nl(F,Q+J)),se&&(ie=U?nl(sr(U),se):nl(F,Q+se))}!j&&F&&(j=Mi(F));let oe=O_({scheduledDate:j,scheduledTime:F}),te={},le=((r=m&&W&&bT({tournamentRecord:m,venueId:W}))==null?void 0:r.venueData)||{};W&&(te[W]=le);let{venueName:ne,venueAbbreviation:me,courtsInfo:be}=le,Se=(a=Z&&(be==null?void 0:be.find(we=>we.courtId===Z)))==null?void 0:a.courtName;for(let we of $||[]){if(!m)break;we.venueId&&!te[we.venueid]&&(te[we.venueId]=(s=bT({venueId:we.venueId,tournamentRecord:m}))==null?void 0:s.venueData);let ze=te[we.venueId];we.venueName=ze==null?void 0:ze.venueName;let Qe=(o=ze==null?void 0:ze.courtsInfo)==null?void 0:o.find(ke=>ke.courtId===we.courtId);we.courtName=Qe==null?void 0:Qe.courtName}P=Zt({typeChangeTimeAfterRecovery:ie,timeAfterRecovery:K,scheduledDate:j,scheduledTime:F,isoDateString:oe,homeParticipantId:O,venueAbbreviation:me,allocatedCourts:$,timeModifiers:V,venueName:ne,venueId:W,courtOrder:z,courtName:Se,courtId:Z,official:B,typeChangeRecoveryMinutes:se,recoveryMinutes:J,averageMinutes:Q,milliseconds:T,startTime:S,endTime:U,time:w})}else P=Zt({milliseconds:T,startTime:S,endTime:U,time:w});let{scheduledDate:C}=Aw({matchUp:I}),{scheduledTime:M}=Ibe({matchUp:I});if(g&&(l=b==null?void 0:b.displaySettings)!=null&&l.draws){let A=b.displaySettings.draws,N=(c=(A==null?void 0:A[I.drawId])??(A==null?void 0:A.default))==null?void 0:c.scheduleDetails;if(N){let k=(u=N.find(O=>{var $;return C&&(($=O.dates)==null?void 0:$.includes(C))})??N.find(O=>{var $;return!(($=O.dates)!=null&&$.length)}))==null?void 0:u.attributes;if(k){let O=Object.assign({},...Object.keys(P).map($=>({[$]:!0})),k);P=DI({source:P,template:O})}}}let _=I.matchUpStatus&&va.includes(I.matchUpStatus)&&(Mi(U)||Mi(C)||Mi(M))||void 0;return{schedule:P,endDate:_}}function A3e({drawPositions:t,roundProfile:e,roundNumber:i}){var n;let r=[void 0,void 0];if(zme(t))return{orderedDrawPositions:r,displayOrder:r};let a=e==null?void 0:e[i],s=((n=a==null?void 0:a.pairedDrawPositions)==null?void 0:n.find(l=>vo(l||[],t.filter(Boolean))))??r,o=a==null?void 0:a.feedRound;if(Hme(t)){let l=[...t].sort(ra);return{orderedDrawPositions:l.length===2?l:s,displayOrder:o?l:s}}if(o){let l=[t.find(c=>!isNaN(di(c))),void 0];return{orderedDrawPositions:l,displayOrder:l}}return{orderedDrawPositions:s,displayOrder:s}}function W_({collectionPosition:t,collectionId:e,lineUp:i}){let n=[],r=[];if(i){let a=o=>o===void 0?-1:o,s=i.map(o=>{let{collectionAssignments:l,participantId:c}=o,u=l==null?void 0:l.find(d=>d.collectionPosition===t&&d.collectionId===e);return u&&{participantId:c,...u}}).filter(Boolean).sort((o,l)=>a(o.substitutionOrder)-a(l.substitutionOrder));for(let o of s){let{participantId:l,previousParticipantId:c,substitutionOrder:u}=o;n.includes(l)||(c&&r.push({previousParticipantId:c,substitutionOrder:u,participantId:l}),n=n.filter(d=>d!==c),n.push(l))}}return{assignedParticipantIds:n,substitutions:r}}function Qu({tournamentParticipants:t,tournamentRecord:e,participantIds:i}){let n="getPairedParticipant";if(!t&&!e)return{error:dt};if(!Array.isArray(i)||i.length>2)return{error:Pl};if(!i.length)return fe({result:{error:Yg},stack:n});t=t??(e==null?void 0:e.participants)??[];let r=t.filter(o=>o.participantType===Ai&&Ar(i,o.individualParticipantIds).length===i.length&&o.individualParticipantIds.length===i.length),a=r[0];if(!a)return fe({result:{error:Or},stack:n});let s=$t(r.slice(1),!1,!0);return{participant:$t(a),duplicatedPairParticipants:s,...pe}}function Iy({drawDefinition:t,participantId:e}){if(typeof t!="object")return{error:Ht};if(typeof e!="string")return{error:da};let{extension:i}=xi({element:t,name:am});return{lineUp:((i==null?void 0:i.value)||{})[e]}}function _3e({tournamentParticipants:t,positionAssignments:e,collectionPosition:i,drawPositions:n=[],participantMap:r,drawDefinition:a,collectionId:s,sideLineUps:o,matchUpType:l}){if(!s||!i)return{};let c=({attribute:d,lineUp:p,teamParticipant:h})=>{var f,m,g,v;let{assignedParticipantIds:y,substitutions:b}=W_({collectionPosition:i,collectionId:s,lineUp:p});if(l===Nn){if((y==null?void 0:y.length)<=2){let I=(m=(f=r==null?void 0:r[y[0]])==null?void 0:f.pairIdMap)==null?void 0:m[y[1]],T=(v=I&&((g=r[I])==null?void 0:g.participant)||Qu({participantIds:y,tournamentParticipants:t}).participant)==null?void 0:v.participantId;return{[d]:{participantId:T,teamParticipant:h,substitutions:b}}}else if((y==null?void 0:y.length)>2)return{[d]:{teamParticipant:h,substitutions:b}}}else{let I=y==null?void 0:y[0];return I&&{[d]:{participantId:I,teamParticipant:h,substitutions:b}}}};if(!(n!=null&&n.length)){let d=(o==null?void 0:o.map(p=>{var h;let{teamParticipant:f,sideNumber:m}=p,g=p.lineUp||((h=Iy({participantId:f.teamParticipantId,drawDefinition:a}))==null?void 0:h.lineUp);return c({attribute:m,lineUp:g,teamParticipant:f})}).filter(Boolean))||{};return{sideNumberCollectionAssignment:Object.assign({},...d)}}let u=(n==null?void 0:n.map(d=>{var p,h,f;let m=(p=e.find(b=>b.drawPosition===d))==null?void 0:p.participantId,g=o==null?void 0:o.find(b=>(b==null?void 0:b.drawPosition)===d),v=(g==null?void 0:g.teamParticipant)||m&&((h=r==null?void 0:r[m])==null?void 0:h.participant)||(t==null?void 0:t.find(({participantId:b})=>b===m)),y=(g==null?void 0:g.lineUp)||((f=Iy({participantId:m,drawDefinition:a}))==null?void 0:f.lineUp);return c({attribute:d,lineUp:y,teamParticipant:v})}).filter(Boolean))||{};return{drawPositionCollectionAssignment:Object.assign({},...u)}}function mF(t){var e,i,n;let r=ei(t,[{[ef]:!0}]);if(r.error)return r;let a=t==null?void 0:t.matchUp,s=a==null?void 0:a.matchUpType;if(!s&&(e=a==null?void 0:a.sides)!=null&&e.length){let o=(n=(i=a.sides.find(({participant:l})=>l))==null?void 0:i.participant)==null?void 0:n.participantType;s=o===Hi&&On||o===Ai&&Nn||o===Pn&&Pn||void 0}return{matchUpType:s}}function k3e({drawPositionCollectionAssignment:t,sideNumberCollectionAssignment:e,positionAssignments:i,displaySideNumber:n,seedAssignments:r,drawPosition:a,isFeedRound:s,sideNumber:o}){var l,c,u,d;let p=i.find(v=>v.drawPosition&&v.drawPosition===a),h=a&&t,f=o&&e,m=h?(l=h[a])==null?void 0:l.participantId:p==null?void 0:p.participantId,g=p?x3e({displaySideNumber:n,seedAssignments:r,participantId:m,assignment:p,sideNumber:o}):{...f==null?void 0:f[o]};if(s&&(o===1?Object.assign(g,{participantFed:!0}):Object.assign(g,{participantAdvanced:!0})),a&&h){let v=(c=h[a])==null?void 0:c.teamParticipant,y=(u=h[a])==null?void 0:u.participant,b=(d=h[a])==null?void 0:d.substitutions;y&&(g.participant=y),b&&(g.substitutions=b),v&&(g.teamParticipant=v)}return g}function x3e({displaySideNumber:t,seedAssignments:e,participantId:i,assignment:n,sideNumber:r}){let a={drawPosition:n.drawPosition,displaySideNumber:t,sideNumber:r};if(i){let s=O3e({seedAssignments:e,participantId:i});Object.assign(a,s,{participantId:i}),s!=null&&s.seedNumber&&(s==null?void 0:s.seedValue)===""&&(a.seedValue="~")}else n.bye&&Object.assign(a,{bye:!0});return n.qualifier&&Object.assign(a,{qualifier:!0}),a}function O3e({seedAssignments:t,participantId:e}){return t==null?void 0:t.find(i=>!i.seedProxy&&i.participantId===e)}function wbe({scheduleVisibilityFilters:t,sourceDrawPositionRanges:e,tournamentParticipants:i,positionAssignments:n,drawPositionsRanges:r,hydrateParticipants:a,afterRecoveryTimes:s,initialRoundOfPlay:o,additionalContext:l,roundNamingProfile:c,tournamentRecord:u,tieDrawPositions:d,appliedPolicies:p,isCollectionBye:h,seedAssignments:f,usePublishState:m,participantMap:g,contextContent:v,scheduleTiming:y,contextProfile:b,drawDefinition:I,publishStatus:T,scoringActive:w,matchUpTieId:S,isRoundRobin:U,roundProfile:P,sideLineUps:E,structure:R,context:C,matchUp:M,event:_}){var A,N,k,O,$,F,V,j,B,z,W,Z,K,Q,J;l=l??{};let se=(A=Ws({drawDefinition:I,structure:R,matchUp:M,event:_}))==null?void 0:A.tieFormat,{roundOffset:ie,structureId:ce,structureName:oe,stage:te,stageSequence:le}=R,{drawId:ne,drawName:me,drawType:be}=I??{},Se=se==null?void 0:se.collectionDefinitions,we=M.collectionId&&(Se==null?void 0:Se.find(Ke=>Ke.collectionId===M.collectionId)),ze=M.collectionId?we==null?void 0:we.matchUpFormat:M.matchUpFormat??(R==null?void 0:R.matchUpFormat)??(I==null?void 0:I.matchUpFormat)??(_==null?void 0:_.matchUpFormat),Qe=M.matchUpType||(we==null?void 0:we.matchUpType)||(R==null?void 0:R.matchUpType)||(I==null?void 0:I.matchUpType)||!Br(aa)(_==null?void 0:_.eventType)&&(_==null?void 0:_.eventType),ke=h?gn:M.matchUpStatus,{schedule:yt,endDate:lt}=fF({scheduleVisibilityFilters:t,afterRecoveryTimes:s,tournamentRecord:u,usePublishState:m,scheduleTiming:y,drawDefinition:I,matchUpFormat:ze,publishStatus:T,matchUpType:Qe,matchUp:M,event:_}),Ct=d??M.drawPositions??[],{collectionPosition:Nt,collectionId:Ce,roundPosition:Ge}=M,$e=M.roundNumber??l.roundNumber,at=Ce?_3e({tournamentParticipants:i,positionAssignments:n,collectionPosition:Nt,participantMap:g,drawDefinition:I,drawPositions:Ct,collectionId:Ce,sideLineUps:E,matchUpType:Qe}):void 0,ct=((N=c==null?void 0:c[$e])==null?void 0:N.roundName)||l.roundName,Vt=((k=c==null?void 0:c[$e])==null?void 0:k.abbreviatedRoundName)||l.abbreviatedRoundName,Me=(O=P==null?void 0:P[$e])==null?void 0:O.feedRound,De=($=P==null?void 0:P[$e])==null?void 0:$.preFeedRound,Je=(F=P==null?void 0:P[$e])==null?void 0:F.roundFactor,St=r==null?void 0:r[$e],bt=Ge?St==null?void 0:St[Ge]:void 0,Ie=e==null?void 0:e[$e],Ue=we!=null&&we.category?{...(C==null?void 0:C.category)||{},...we.category}:(C==null?void 0:C.category)??(_==null?void 0:_.category),Oe=((V=M.processCodes)==null?void 0:V.length)&&M.processCodes||((j=we==null?void 0:we.processCodes)==null?void 0:j.length)&&(we==null?void 0:we.processCodes)||((B=R==null?void 0:R.processCodes)==null?void 0:B.length)&&(R==null?void 0:R.processCodes)||((z=I==null?void 0:I.processCodes)==null?void 0:z.length)&&(I==null?void 0:I.processCodes)||((W=_==null?void 0:_.processCodes)==null?void 0:W.length)&&(_==null?void 0:_.processCodes)||(u==null?void 0:u.processCodes),Ee=(b==null?void 0:b.withCompetitiveness)&&MR({...v,matchUp:M}),Xe=M.finishingPositionRange??l.finishingPositionRange,Et=Ke=>Zt(Ke,void 0,!0),Fe={...Et(C),...Et({matchUpFormat:M.matchUpType===aa?void 0:ze,tieFormat:M.matchUpType!==aa?void 0:se,gender:(we==null?void 0:we.gender)??(_==null?void 0:_.gender),roundOfPlay:te!==ri&&wi(o)&&o+($e||0),endDate:M.endDate??lt,discipline:_==null?void 0:_.discipline,category:Ue,finishingPositionRange:Xe,abbreviatedRoundName:Vt,drawPositionsRange:bt,competitiveProfile:Ee,structureName:oe,stageSequence:le,drawPositions:Ct,matchUpStatus:ke,processCodes:Oe,isRoundRobin:U,matchUpTieId:S,preFeedRound:De,matchUpType:Qe,roundFactor:Je,roundOffset:ie,structureId:ce,roundNumber:$e,feedRound:Me,roundName:ct,drawName:me,drawType:be,schedule:yt,drawId:ne,stage:te}),...$t(Et(M),!0,!0)};if(ze&&(Z=M.score)!=null&&Z.scoreStringSide1){let Ke=Do(ze),{bestOf:zt,finalSetFormat:mt,setFormat:Tt}=Ke??{};(mt!=null&&mt.tiebreakSet||Tt!=null&&Tt.tiebreakSet||Tt!=null&&Tt.timed)&&(Fe.score.sets=Fe.score.sets.sort((Ut,zi)=>Ut.setNumber-zi.setNumber).map((Ut,zi)=>(zi+1===zt?(mt!=null&&mt.tiebreakSet||mt!=null&&mt.timed)&&(Ut.tiebreakSet=!0):(Tt!=null&&Tt.tiebreakSet||Tt!=null&&Tt.timed)&&(Ut.tiebreakSet=!0),Ut)))}if(Array.isArray(Ct)){let{orderedDrawPositions:Ke,displayOrder:zt}=A3e({drawPositions:Ct,roundProfile:P,roundNumber:$e}),mt=(K=P==null?void 0:P[$e])==null?void 0:K.feedRound,Tt=zt[0]!==Ke[0],Ut=Ke.concat(void 0,void 0).slice(0,2).map((zi,gi)=>{var Dt;let Ui=gi+1,Cr=Tt?3-Ui:Ui,nn=k3e({...at,positionAssignments:n,displaySideNumber:Cr,seedAssignments:f,drawPosition:zi,isFeedRound:mt,sideNumber:Ui}),tr=(Dt=M.sides)==null?void 0:Dt.find(Gr=>Gr.sideNumber===Ui),lr=Ge?(Ge-1)*2+gi+1:void 0,Xa=lr?Ie==null?void 0:Ie[lr]:void 0;return Et({sourceDrawPositionRange:Xa,...tr,...nn})});Object.assign(Fe,$t({sides:Ut},!0,!0))}if(i&&Fe.sides){let Ke=p==null?void 0:p[jU],zt=mt=>{var Tt;let Ut=(Tt=g==null?void 0:g[mt])==null?void 0:Tt.participant;return Ut&&DI({template:Ke==null?void 0:Ke.participant,source:Ut})};if(Fe.sides.filter(Boolean).forEach(mt=>{var Tt,Ut,zi,gi;if(mt.participantId){let Dt=$t(zt(mt.participantId)||(i?Ig({policyDefinitions:p,participantId:mt.participantId,tournamentParticipants:i,internalUse:!0,contextProfile:b}):void 0),void 0,!0);if(Dt){let Ui,Cr;if(I!=null&&I.entries){let nn=I.entries.find(lr=>lr.participantId===mt.participantId),tr=(Tt=_==null?void 0:_.entries)==null?void 0:Tt.find(lr=>lr.participantId===mt.participantId);Ui=(nn==null?void 0:nn.entryStatus)||(tr==null?void 0:tr.entryStatus),Dt.entryStatus=Ui,nn!=null&&nn.entryStage&&(Cr=nn.entryStage,Dt.entryStage=Cr)}a!==!1?Object.assign(mt,{participant:Dt}):Object.assign(mt,{participant:{entryStage:Cr,entryStatus:Ui}})}}if((zi=(Ut=mt==null?void 0:mt.participant)==null?void 0:Ut.individualParticipantIds)!=null&&zi.length&&!((gi=mt.participant.individualParticipants)!=null&&gi.length)){let Dt=mt.participant.individualParticipantIds.map(Ui=>zt(Ui)||(i?Ig({policyDefinitions:p,tournamentParticipants:i,internalUse:!0,contextProfile:b,participantId:Ui}):void 0));a!==!1&&Object.assign(mt.participant,{individualParticipants:Dt})}}),!Fe.matchUpType){let{matchUpType:mt}=mF({matchUp:Fe});mt&&Object.assign(Fe,{matchUpType:mt})}if(b!=null&&b.inferGender&&(!Fe.gender||Fe.gender===Fo)&&((Q=Fe.sides)==null?void 0:Q.length)===2&&Fe.matchUpType!==aa){let mt=Fe.sides.map(Tt=>{var Ut,zi,gi,Dt;if(Br(On)(Fe.matchUpType))return(zi=(Ut=Tt.participant)==null?void 0:Ut.person)==null?void 0:zi.sex;if(((Dt=(gi=Tt.participant)==null?void 0:gi.individualParticipants)==null?void 0:Dt.length)===2){let Ui=Pi(Tt.participant.individualParticipants.map(Cr=>{var nn;return(nn=Cr.person)==null?void 0:nn.sex})).filter(Boolean);if(Ui.length===1)return Ui[0]}});if(mt.filter(Boolean).length===2&&Pi(mt).length===1){let Tt=mt[0];Fe.inferredGender=Tt}}}if(Fe.tieMatchUps){let Ke=Fe.matchUpStatus===gn,zt=(J=Fe.sides)==null?void 0:J.map(({participant:mt,drawPosition:Tt,sideNumber:Ut,lineUp:zi})=>{let gi=(mt==null?void 0:mt.participantType)===aa&&mt;return{teamParticipant:gi&&Zt({participantRoleResponsibilities:gi.participantRoleResponsibilities,participantOtherName:gi.participanOthertName,participantName:gi.participantName,participantId:gi.participantId,teamId:gi.teamId}),drawPosition:Tt,sideNumber:Ut,lineUp:zi}});Fe.tieMatchUps=Fe.tieMatchUps.map(mt=>{let Tt=Fe.matchUpId,Ut={finishingPositionRange:Fe.finishingPositionRange,abbreviatedRoundName:Vt,roundNumber:$e,roundName:ct};return wbe({tieDrawPositions:Ct,scheduleVisibilityFilters:t,sourceDrawPositionRanges:e,sideLineUps:zt,drawPositionsRanges:r,initialRoundOfPlay:o,roundNamingProfile:c,additionalContext:Ut,appliedPolicies:p,isCollectionBye:Ke,usePublishState:m,publishStatus:T,matchUpTieId:Tt,isRoundRobin:U,roundProfile:P,matchUp:mt,event:_,tournamentParticipants:i,positionAssignments:n,tournamentRecord:u,seedAssignments:f,participantMap:g,contextContent:v,scheduleTiming:y,contextProfile:b,drawDefinition:I,scoringActive:w,structure:R,context:C})})}let ht=Fe.sides&&Fe.sides.filter(Ke=>Ke==null?void 0:Ke.participantId).length===2,ti=!Fe.winningSide;if(Object.assign(Fe,{readyToScore:w&&ht&&ti,hasContext:!0}),ht){let{allParticipantsCheckedIn:Ke,checkedInParticipantIds:zt}=Nw({matchUp:Fe});Object.assign(Fe,{allParticipantsCheckedIn:Ke,checkedInParticipantIds:zt})}return Array.isArray(b==null?void 0:b.exclude)&&(b==null||b.exclude.forEach(Ke=>delete Fe[Ke])),Fe}function L3e({timeStamp:t,schedule:e,matchUp:i}){let{itemValue:n,timeStamp:r}=nb({timeItems:(i==null?void 0:i.timeItems)||[],itemType:Yh});return!e||r&&t&&new Date(r).getTime()>new Date(t).getTime()?{allocatedCourts:$t(n,!1,!0)}:e}function F3e({timeStamp:t,schedule:e,matchUp:i}){let{itemValue:n,timeStamp:r}=nb({timeItems:(i==null?void 0:i.timeItems)||[],itemType:Dg});return!e||r&&t&&new Date(r).getTime()>new Date(t).getTime()?{courtId:n}:e}function $3e({timeStamp:t,schedule:e,matchUp:i}){let{itemValue:n,timeStamp:r}=nb({timeItems:(i==null?void 0:i.timeItems)||[],itemType:Cw});return!e||r&&t&&new Date(r).getTime()>new Date(t).getTime()?{venueId:n}:e}function Cf(t){if(!Array.isArray(t.matchUps))return[];let{matchUps:e,excludeMatchUpStatuses:i,hasParticipantsCount:n,isCollectionMatchUp:r,matchUpStatuses:a,hasWinningSide:s,matchUpFormats:o,roundPositions:l,matchUpFormat:c,collectionIds:u,isMatchUpTie:d,roundNumbers:p,matchUpIds:h,roundNames:f,filterMatchUpTypes:m=!0,filterMatchUpIds:g=!0,stageSequences:v,scheduledDates:y,scheduledDate:b,participantIds:I,processContext:T,tournamentIds:w,matchUpTypes:S,structureIds:U,readyToScore:P,courtIds:E,eventIds:R,venueIds:C,drawIds:M,stages:_}=t,A=Array.isArray(I)?I.filter(Boolean):[],N=Array.isArray(a)?a.filter(Boolean):[],k=Array.isArray(i)?i.filter(Boolean):[],O=Array.isArray(_)?_.filter(Boolean):[],$=Array.isArray(v)?v.filter(Boolean):[],F=Array.isArray(u)?u.filter(Boolean):[],V=Array.isArray(f)?f.filter(Boolean):[],j=Array.isArray(p)?p.filter(Boolean):[],B=Array.isArray(l)?l.filter(Boolean):[],z=Array.isArray(h)&&g?h.filter(Boolean):[],W=Array.isArray(S)&&m?S.filter(Boolean):[],Z=Array.isArray(E)?E.filter(Boolean):[],K=Array.isArray(C)?C.filter(Boolean):[],Q=Array.isArray(o)&&o.filter(Boolean)||typeof c=="string"&&[c]||[],J=Array.isArray(y)&&y.filter(Boolean)||typeof b=="string"&&b.length&&[b]||[],se=Array.isArray(w)?w.filter(Boolean):[],ie=Array.isArray(R)?R.filter(Boolean):[],ce=Array.isArray(M)?M.filter(Boolean):[],oe=Array.isArray(U)?U.filter(Boolean):[];return e.filter(te=>{var le;if(P&&!Br(ac)(te)&&!te.readyToScore||te.winningSide&&s&&![1,2].includes(te.winningSide)||d!==void 0&&(d&&!te.tieMatchUps||!d&&te.tieMatchUps)||r!==void 0&&(r&&!te.collectionId||!r&&te.collectionId)||O.length&&!O.includes(te.stage)||$.length&&!$.includes(te.stageSequence)||F.length&&(!te.collectionId||!F.includes(te.collectionId))||V.length&&(!te.roundName||!V.includes(te.roundName))||j.length&&(!te.roundNumber||!j.includes(te.roundNumber))||B.length&&(!te.roundPosition||!B.includes(te.roundPosition))||N.length&&(!te.matchUpStatus||!N.includes(te.matchUpStatus))||k.length&&te.matchUpStatus&&k.includes(te.matchUpStatus)||z.length&&!z.includes(te.matchUpId)||W.length&&(!te.matchUpType||!IL(W,te.matchUpType))||Q.length&&(!te.matchUpFormat||!Q.includes(te.matchUpFormat)))return!1;if(J!=null&&J.length){let{scheduledTime:ne}=Ibe({matchUp:te}),{scheduledDate:me}=Aw({matchUp:te}),be=Mi(ne)||me;if(!J.find(Se=>Gh(Se,be)))return!1}if(Z.length){let{courtId:ne}=F3e({matchUp:te}),{allocatedCourts:me}=L3e({matchUp:te}),be=me==null?void 0:me.map(({courtId:Se})=>Se);if(!Z.filter(Boolean).includes(ne)||be!=null&&be.includes(ne))return!1}if(K.length){let{venueId:ne}=$3e({matchUp:te});if(!K.filter(Boolean).includes(ne))return!1}if(T){if(se.length&&!se.includes(te.tournamentId)||ie.length&&!ie.includes(te.eventId)||ce.length&&!ce.includes(te.drawId)||oe.length&&!oe.includes(te.structureId))return!1;let ne=((le=te.sides)==null?void 0:le.map(({participantId:me})=>me).filter(Boolean))??[];if(n&&ne.length<n||A.length&&!A.some(me=>ne.includes(me)))return!1}return!0})}function Sn(t){var e,i,n,r,a,s,o;let{provisionalPositioning:l,tournamentRecord:c,contextFilters:u,matchUpFilters:d,contextProfile:p,drawDefinition:h,context:f={},structure:m,inContext:g,event:v}=t,{seedAssignments:y,contextContent:b,exitProfiles:I,matchUpsMap:T}=t,w={},S={};if(!m)return{collectionPositionMatchUps:w,error:Yy,roundMatchUps:S,matchUps:[]};let U=Array.isArray(d==null?void 0:d.eventIds)?d==null?void 0:d.eventIds.filter(Boolean):[],P=Array.isArray(d==null?void 0:d.structureIds)?d==null?void 0:d.structureIds.filter(Boolean):[],E=Array.isArray(d==null?void 0:d.drawIds)?d==null?void 0:d.drawIds.filter(Boolean):[],R=!(f!=null&&f.eventId)||!(U!=null&&U.length)&&!((e=u==null?void 0:u.eventIds)!=null&&e.filter(Boolean).length)||(U==null?void 0:U.includes(f.eventId))||((i=u==null?void 0:u.eventIds)==null?void 0:i.includes(f.eventId)),C=!(P!=null&&P.length)||P.includes(m.structureId),M=!h||!(E!=null&&E.length)||E.includes(h.drawId);if(!R||!C||!M)return{collectionPositionMatchUps:w,roundMatchUps:S,matchUps:[]};p&&!b&&(b=Mm({tournamentRecord:c,contextProfile:p,drawDefinition:h}));let{appliedPolicies:_}=fn({drawDefinition:h}),A={...t.tournamentAppliedPolicies,..._,...t.policyDefinitions},N=(n=A==null?void 0:A.scoring)==null?void 0:n.structures,k=m.stage&&((r=N==null?void 0:N.stage)==null?void 0:r[m.stage]),O=m.stageSequence&&((a=k==null?void 0:k.stageSequence)==null?void 0:a[m.stageSequence]),$=((s=A==null?void 0:A.scoring)==null?void 0:s.requireAllPositionsAssigned)||(k==null?void 0:k.requireAllPositionsAssigned)||(O==null?void 0:O.requireAllPositionsAssigned);T||(T=Us({drawDefinition:h,structure:m}));let{positionAssignments:F,allPositionsAssigned:V}=Aa({structure:m}),j=!$||V,{seedAssignments:B}=Zc({provisionalPositioning:l,drawDefinition:h,structure:m});y=y??B;let{structureId:z}=m;I=I||h&&nbe({drawDefinition:h}).exitProfiles;let W=I==null?void 0:I[z],Z=(W==null?void 0:W.length)&&(W[0].split("-").map(oe=>parseInt(oe)).reduce((oe,te)=>oe+te)||0),K=!!m.structures,Q=by({matchUpsMap:T,structureId:z,inContext:g}),J=A==null?void 0:A[mT],se=c3e({roundNamingPolicy:J,drawDefinition:h,structure:m,matchUps:Q}),{roundNamingProfile:ie,roundProfile:ce}=se;if(S=(se==null?void 0:se.roundMatchUps)??[],d&&(Q=Cf({matchUps:Q,...d,filterMatchUpTypes:!1,filterMatchUpIds:!1})),g){let{sourceDrawPositionRanges:oe}=s3e({drawDefinition:h,matchUpsMap:T,structureId:z}),te=h?o3e({drawDefinition:h,roundProfile:ce,matchUpsMap:T,structureId:z}).drawPositionsRanges:void 0,le=t.tournamentParticipants,ne=t.participantMap;!(le!=null&&le.length)&&!ne&&c&&({participants:le=[],participantMap:ne}=Qy({participantsProfile:t.participantsProfile,useParticipantMap:t.useParticipantMap,policyDefinitions:t.policyDefinitions,tournamentRecord:c,contextProfile:p,inContext:g})),Q=Q.map(me=>wbe({scheduleVisibilityFilters:t.scheduleVisibilityFilters,hydrateParticipants:t.hydrateParticipants,afterRecoveryTimes:t.afterRecoveryTimes,usePublishState:t.usePublishState,scheduleTiming:t.scheduleTiming,publishStatus:t.publishStatus,sourceDrawPositionRanges:oe,tournamentParticipants:le,positionAssignments:F,drawPositionsRanges:te,initialRoundOfPlay:Z,roundNamingProfile:ie,tournamentRecord:c,appliedPolicies:A,seedAssignments:y,contextContent:b,participantMap:ne,contextProfile:p,drawDefinition:h,scoringActive:j,isRoundRobin:K,roundProfile:ce,structure:m,context:f,matchUp:me,event:v})),(Q==null?void 0:Q.filter(me=>Array.isArray(me.tieMatchUps))).forEach(me=>{let be=me.tieMatchUps;Q=Q.concat(...be)}),u&&(Q=Cf({processContext:!0,...u,matchUps:Q}))}else(Q==null?void 0:Q.filter(oe=>Array.isArray(oe.tieMatchUps))).forEach(oe=>{let te=oe.tieMatchUps;Q=Q.concat(...te)});return d&&(Q=Cf({matchUps:Q,...d,filterMatchUpTypes:!1,filterMatchUpIds:!1})),(d!=null&&d.matchUpTypes||d!=null&&d.matchUpIds)&&(Q=Cf({matchUpTypes:d.matchUpTypes,matchUpIds:d.matchUpIds,matchUps:Q})),(d!=null&&d.matchUpTypes||d!=null&&d.matchUpIds||g)&&(S=yo({matchUps:Q}).roundMatchUps??[]),(o=Ws({drawDefinition:h,structure:m,event:v}))!=null&&o.tieFormat&&({collectionPositionMatchUps:w}=a3e({matchUps:Q})),{collectionPositionMatchUps:w,roundMatchUps:S,isRoundRobin:K,roundProfile:ce,matchUpsMap:T,matchUps:Q}}function Wv({matchUp:t}){return t?va.includes(t==null?void 0:t.matchUpStatus)||(t==null?void 0:t.winningSide):!1}function gF({requireParticipants:t=!0,scheduleVisibilityFilters:e,tournamentAppliedPolicies:i,tournamentParticipants:n,hydrateParticipants:r,afterRecoveryTimes:a,policyDefinitions:s,tournamentRecord:o,usePublishState:l,matchUpFilters:c,contextFilters:u,contextContent:d,participantMap:p,scheduleTiming:h,publishStatus:f,contextProfile:m,drawDefinition:g,exitProfiles:v,matchUpsMap:y,structureId:b,inContext:I,structure:T,context:w,event:S}){!T&&b&&({structure:T}=fi({drawDefinition:g,structureId:b}));let U=Sn({tournamentAppliedPolicies:i,scheduleVisibilityFilters:e,tournamentParticipants:n,hydrateParticipants:r,afterRecoveryTimes:a,policyDefinitions:s,tournamentRecord:o,usePublishState:l,matchUpFilters:c,contextFilters:u,contextContent:d,participantMap:p,scheduleTiming:h,publishStatus:f,contextProfile:m,drawDefinition:g,exitProfiles:v,matchUpsMap:y,structure:T,inContext:I,context:w,event:S}),P=[],E=[],R=[],C=[],M=[];if(U.error)return U;let{matchUps:_}=U,{assignedPositions:A}=Aa({structure:T}),N=A==null?void 0:A.filter(O=>O.participantId).map(O=>O.drawPosition),k;return _.filter(O=>{var $;let F=(($=c==null?void 0:c.matchUpTypes)==null?void 0:$.length)===1&&c.matchUpTypes[0]===Xn;return!(O.matchUpType!==Xn&&F)}).forEach(O=>{var $,F,V,j;if(O.matchUpStatus===ul){P.push(O);return}O.matchUpType===Xn&&(k=!0);let B=O.collectionId,z=B&&(($=O.sides)==null?void 0:$.every(se=>se.participantId)),W=!B&&((F=O.drawPositions)==null?void 0:F.filter(Boolean).length)===2,Z=!B&&((V=O.drawPositions)==null?void 0:V.every(se=>N==null?void 0:N.includes(se))),K=A==null?void 0:A.filter(se=>se.bye).map(se=>se.drawPosition),Q=!B&&((j=O.drawPositions)==null?void 0:j.find(se=>K==null?void 0:K.includes(se))),J=Lye.includes(O.matchUpStatus)&&(z||W&&(!t||Z));return Q?M.push(O):Wv({matchUp:O})?E.push(O):J?R.push(O):C.push(O)}),{includesTeamMatchUps:k,abandonedMatchUps:P,completedMatchUps:E,upcomingMatchUps:R,pendingMatchUps:C,byeMatchUps:M,structure:T}}function B3e({drawDefinition:t,roundNumber:e,structureId:i}){if(!t)return{error:Ht};if(!i)return{error:mc};let{links:n}=qU({drawDefinition:t,structureId:i}),r=n.source.reduce((s,o)=>!o.source.roundNumber||o.source.roundNumber===e?s.concat(o):s,[]),a=n.target.reduce((s,o)=>!o.target.roundNumber||o.target.roundNumber===e?s.concat(o):s,[]);return{links:{source:r,target:a}}}function G$({finishingPositions:t,linkCondition:e,linkType:i,source:n}){var r;let a=n.find(s=>{var o,l;let c=!((o=s.source)!=null&&o.finishingPositions)||!t||vo(t,(l=s.source)==null?void 0:l.finishingPositions);return e===s.linkCondition&&c&&s.linkType===i});return[nm,Hh].includes(a==null?void 0:a.linkType)&&!((r=a==null?void 0:a.source)!=null&&r.roundNumber)?fe({result:{error:Ae},stack:"getTargetLink",context:a}):a}function qU({drawDefinition:t,structureId:e,roundNumber:i}){return t?e?{links:(t.links||[]).filter(Boolean).reduce((n,r)=>{var a,s;return((a=r.source)==null?void 0:a.structureId)===e&&(!i||r.source.roundNumber===i)&&(n.source=n.source.concat(r)),((s=r.target)==null?void 0:s.structureId)===e&&(!i||r.target.roundNumber===i)&&(n.target=n.target.concat(r)),n},{source:[],target:[]})}:{error:mc}:{error:Ht}}function V3e({structureMatchUps:t,matchUp:e}){let{roundNumber:i,roundPosition:n}=e,r=t.filter(s=>s.roundNumber===i&&!s.matchUpTieId),a=t.filter(s=>s.roundNumber===i+1&&!s.matchUpTieId);if(a.length){let s;return a.length===r.length?s=a.find(o=>o.roundPosition===n):a.length===r.length/2&&(s=a.find(o=>o.roundPosition===Math.ceil(n/2))),{matchUp:s}}return{message:"no progression found"}}function H$({sourceRoundMatchUpCount:t,inContextDrawMatchUps:e,sourceRoundPosition:i,drawDefinition:n,targetLink:r}){var a;if(!r)return{error:$5};let{target:{structureId:s,feedProfile:o,groupedOrder:l,roundNumber:c,positionInterleave:u}}=r,{structure:d}=fi({drawDefinition:n,structureId:s}),{positionAssignments:p}=Gn({structure:d}),h=(e==null?void 0:e.filter(E=>E.structureId===(d==null?void 0:d.structureId))).filter(E=>E.roundNumber===c&&!E.matchUpTieId),f=h.length,m=Mt(1,f+1),g=f/t,v=Math.ceil(g*i),y=1-i%2;if(u!=null&&u.interleave&&g!==.5){let E=u.offset+(i-1)*u.interleave,R=i+E;v=Math.ceil(R/2),y=1-R%2}let b=m,I=m[v-1],T=ibe({roundPositionsCount:m.length,groupedOrder:l}),w=(T==null?void 0:T.length)||1;if(w<=m.length){let E=f/w,R=Na(m,E);o===my&&R.forEach(C=>C.reverse()),b=(T==null?void 0:T.length)&&(T==null?void 0:T.map(C=>R[C-1]).flat())||b}o===Ru?I=b[v-1]:o===my?((!(T!=null&&T.length)||w>m.length)&&(v=h.length+1-v),I=b[v-1]):o===GL&&oc()&&console.log(AL,{feedProfile:o});let S=I&&h.reduce((E,R)=>R.roundPosition===I?R:E,void 0),U;S!=null&&S.feedRound?(y=0,U=Math.min(...(S.drawPositions||[]).filter(Boolean))):U=((a=S==null?void 0:S.drawPositions)==null?void 0:a.length)===2&&(S==null?void 0:S.drawPositions[y]);let P=p==null?void 0:p.find(({drawPosition:E})=>E===U);if(P){let{extension:E}=xi({element:P,name:eF});if(E!=null&&E.value)return{disabledDrawPosition:U}}return{matchUp:S,targetDrawPosition:U,matchUpDrawPositionIndex:y}}function bo({inContextDrawMatchUps:t=[],useTargetMatchUpIds:e,inContextMatchUp:i,drawDefinition:n,matchUpId:r}){let a=i;t.length&&!a&&(a=t.find(o=>o.matchUpId===r));let{structure:s}=fi({structureId:a==null?void 0:a.structureId,drawDefinition:n});return(s==null?void 0:s.finishingPosition)===Uw?j3e({inContextDrawMatchUps:t,useTargetMatchUpIds:e,drawDefinition:n,structure:s,matchUp:a}):G3e({matchUp:a})}function j3e({inContextDrawMatchUps:t,useTargetMatchUpIds:e,drawDefinition:i,structure:n,matchUp:r}){var a,s,o;let{winnerMatchUpId:l,loserMatchUpId:c}=r,{links:u}=B3e({roundNumber:r.roundNumber,structureId:n.structureId,drawDefinition:i}),d=u==null?void 0:u.source,p=G$({source:d,linkType:nm}),h=G$({linkCondition:xp,linkType:Hh,source:d}),f=G$({source:d,linkType:Hh}),m=h&&f;f||(f=h);let g=(a=p==null?void 0:p.target)==null?void 0:a.feedProfile,v=(s=f==null?void 0:f.target)==null?void 0:s.feedProfile,y=(o=h==null?void 0:h.target)==null?void 0:o.feedProfile,b,I,T,w,S,U,P,E,R,C;if(e&&(l||c)&&(P=l&&g!==vd&&t.find(({matchUpId:A})=>A===l),w=c&&v!==vd&&t.find(({matchUpId:A})=>A===c),P||w))return{matchUp:r,targetLinks:{loserTargetLink:f,winnerTargetLink:p},targetMatchUps:{loserMatchUp:w,winnerMatchUp:P}};let{roundPosition:M}=r;C=C||t.filter(A=>A.structureId===n.structureId);let _=C.reduce((A,N)=>N.roundNumber===r.roundNumber&&!N.matchUpTieId?A+1:A,0);return f&&!w&&v!==vd&&({matchUpDrawPositionIndex:U,targetDrawPosition:S,matchUp:w}=H$({targetLink:f,sourceRoundMatchUpCount:_,inContextDrawMatchUps:t,sourceRoundPosition:M,drawDefinition:i})),m&&y!==vd&&({matchUpDrawPositionIndex:T,targetDrawPosition:I,matchUp:b}=H$({targetLink:h,sourceRoundMatchUpCount:_,inContextDrawMatchUps:t,sourceRoundPosition:M,drawDefinition:i})),p&&!P&&g!==vd&&({matchUpDrawPositionIndex:R,targetDrawPosition:E,matchUp:P}=H$({targetLink:p,sourceRoundMatchUpCount:_,inContextDrawMatchUps:t,sourceRoundPosition:M,drawDefinition:i})),P||(C=C||t.filter(A=>A.structureId===n.structureId),{matchUp:P}=V3e({structureMatchUps:C,matchUp:r})),Zt({matchUp:r,targetLinks:{loserTargetLink:f,winnerTargetLink:p,byeTargetLink:h},targetMatchUps:{winnerMatchUpDrawPositionIndex:R,loserMatchUpDrawPositionIndex:U,byeMatchUpDrawPositionIndex:T,winnerTargetDrawPosition:E,loserTargetDrawPosition:S,byeTargetDrawPosition:I,winnerMatchUp:P,loserMatchUp:w,byeMatchUp:b},targetMatchUpIds:!!(l||c)})}function G3e({matchUp:t}){return{targetLinks:{loserTargetLink:void 0,winnerTargetLink:void 0},targetMatchUps:{loserMatchUp:void 0,winnerMatchUp:void 0},matchUp:t}}function H3e({drawDefinition:t,inContextDrawMatchUps:e}){let i={};return e.forEach(n=>{var r,a,s,o,l,c;let{matchUpId:u,structureId:d,drawPositions:p=[]}=n,{structure:h}=fi({drawDefinition:t,structureId:d});if((h==null?void 0:h.finishingPosition)===gy){let{roundNumber:f}=n,m=f&&di(f)+1,g=h.matchUps??[],{roundMatchUps:v}=yo({matchUps:g});if(m&&v!=null&&v[m]){let y=[...p].sort(ra).map((b,I)=>{let T=v[m].find(w=>{var S;return(S=w.drawPositions)==null?void 0:S.includes(b)});return{matchUpId:T==null?void 0:T.matchUpId,roundNumber:m,schedule:T==null?void 0:T.schedule,sideNumber:I+1,structureName:h.structureName}});Object.assign(n,{sidesTo:y})}}else{let f=bo({useTargetMatchUpIds:!0,inContextDrawMatchUps:e,inContextMatchUp:n,drawDefinition:t,matchUpId:u}),{winnerMatchUp:m}=f.targetMatchUps,{loserMatchUp:g}=f.targetMatchUps;!n.winnerMatchUpId&&m&&(n.winnerMatchUpId=m.matchUpId),!n.loserMatchUpId&&g&&(n.loserMatchUpId=g.matchUpId);let v=z$({upcomingMatchUp:m}),y=z$({upcomingMatchUp:g});if(n.matchUpStatus!==gn&&(g==null?void 0:g.matchUpStatus)===gn){let{matchUp:I}=Sbe({matchUp:g,drawDefinition:t,inContextDrawMatchUps:e})||{};y=I&&z$({upcomingMatchUp:I})||y}let b=(r=n.schedule)==null?void 0:r.timeAfterRecovery;if(b&&((a=v==null?void 0:v.schedule)!=null&&a.scheduledTime&&sn(v.schedule.scheduledTime)<sn(b)&&(i[v.matchUpId]=n.matchUpId,v.schedule.scheduleConflict=n.matchUpId),(s=y==null?void 0:y.schedule)!=null&&s.scheduledTime&&sn(y.schedule.scheduledTime)<sn(b)&&(i[y.matchUpId]=n.matchUpId,y.schedule.scheduleConflict=n.matchUpId)),Object.assign(n,{winnerTo:v,loserTo:y}),(o=n.drawPositions)==null?void 0:o.filter(Boolean).length){let I=((c=(l=f.targetLinks)==null?void 0:l.loserTargetLink)==null?void 0:c.linkCondition)===xp,T=z3e(n);if(T.length){let w=Yj(m==null?void 0:m.sides),S=Yj(g==null?void 0:g.sides),U=T.find(({participantId:E})=>w.includes(E))?[]:T,P=T.find(({participantId:E})=>S.includes(E))?[]:T;g&&I&&P.length<2&&P.push({bye:!0,tbd:!0}),U!=null&&U.length&&m&&(!f.targetMatchUpIds&&m&&(m=e.find(({matchUpId:E})=>E===m.matchUpId)),m.potentialParticipants||(m.potentialParticipants=[]),m.potentialParticipants.push(U)),P!=null&&P.length&&g&&(f.targetMatchUpIds||(m=e.find(({matchUpId:E})=>E===g.matchUpId)),g.potentialParticipants||(g.potentialParticipants=[]),g.potentialParticipants.push(P))}}}}),Object.keys(i).length&&e.forEach(n=>{Object.keys(i).includes(n.matchUpId)&&(n.schedule.scheduleConflict=i[n.matchUpId])}),{scheduleConflictMatchUpIds:i}}function z3e(t){var e;return((e=t==null?void 0:t.sides)==null?void 0:e.map(({participant:i,participantId:n,qualifier:r})=>i||n&&{participantId:n}||r&&{qualifier:r}).filter(Boolean))||[]}function Sbe({matchUp:t,drawDefinition:e,inContextDrawMatchUps:i}){var n;let{matchUpId:r,matchUpStatus:a,structureId:s}=t||{};if(!t||!s||(t==null?void 0:t.matchUpStatus)===jr)return{matchUp:t};if(a===gn){let o;return t.winnerMatchUpId?o=i.find(({matchUpId:l})=>l===t.winnerMatchUpId):{winnerMatchUp:o}=((n=bo({inContextDrawMatchUps:i,drawDefinition:e,matchUpId:r}))==null?void 0:n.targetMatchUps)||{},Sbe({matchUp:o,drawDefinition:e,inContextDrawMatchUps:i})}return{matchUp:void 0}}function z$(t){if(t!=null&&t.upcomingMatchUp)return(({matchUpId:e,structureId:i,schedule:n,roundNumber:r,roundPosition:a,structureName:s})=>({matchUpId:e,structureId:i,schedule:n,roundNumber:r,roundPosition:a,structureName:s}))(t.upcomingMatchUp)}function pa(t){let e="getAllDrawMatchUps";Object.assign(t,{requireParticipants:!1});let i=WU(t);if(i.error)return fe({result:i,stack:e});let{abandonedMatchUps:n,completedMatchUps:r,upcomingMatchUps:a,pendingMatchUps:s,byeMatchUps:o,matchUpsMap:l}=i;return{matchUps:(n??[]).concat(...r??[],...a??[],...s??[],...o??[]),matchUpsMap:l}}function WU(t){if(!(t!=null&&t.drawDefinition))return{error:Ht};let{tournamentParticipants:e,contextContent:i,matchUpsMap:n}=t,{scheduleVisibilityFilters:r,tournamentAppliedPolicies:a,requireParticipants:s,participantsProfile:o,afterRecoveryTimes:l,policyDefinitions:c,tournamentRecord:u,usePublishState:d,contextFilters:p,matchUpFilters:h,scheduleTiming:f,participantMap:m,publishStatus:g,contextProfile:v,drawDefinition:y,nextMatchUps:b,inContext:I,context:T,event:w}=t,S=[],U=[],P=[],E=[],R=[];v&&!i&&(i=Mm({policyDefinitions:c,tournamentRecord:u,contextProfile:v,event:w}));let C;!(e!=null&&e.length)&&u&&(e=u==null?void 0:u.participants,(I||o!=null&&o.withGroupings)&&e!=null&&e.length&&({participantsWithGroupings:e,groupInfo:C}=oF({participants:e,participantsProfile:o})));let{structures:M}=Ju({drawDefinition:y});if(!M)return{error:yr};n||(n=Us({drawDefinition:y}));let _=y&&nbe({drawDefinition:y}).exitProfiles;M.forEach(k=>{let{byeMatchUps:O=[],pendingMatchUps:$=[],upcomingMatchUps:F=[],completedMatchUps:V=[],abandonedMatchUps:j=[]}=gF({matchUpFilters:b?void 0:h,contextFilters:b?void 0:p,inContext:I||b||p,hydrateParticipants:t.hydrateParticipants,tournamentAppliedPolicies:a,scheduleVisibilityFilters:r,tournamentParticipants:e,requireParticipants:s,afterRecoveryTimes:l,policyDefinitions:c,tournamentRecord:u,usePublishState:d,contextContent:i,participantMap:m,scheduleTiming:f,publishStatus:g,contextProfile:v,drawDefinition:y,exitProfiles:_,matchUpsMap:n,structure:k,context:T,event:w});S=S.concat(...j),U=U.concat(...V),P=P.concat(...F),E=E.concat(...$),R=R.concat(...O)});let A=k=>(!h&&!b&&!p||(h&&(k=Cf({matchUps:k,...h})),p&&(k=Cf({matchUps:k,...p,processContext:!0}))),k),N={abandonedMatchUps:A(S),completedMatchUps:A(U),upcomingMatchUps:A(P),pendingMatchUps:A(E),byeMatchUps:A(R),matchUpsMap:n,...pe,groupInfo:C};if(b){let k=typeof b=="object"||{abandoned:!0,completed:!0,upcoming:!0,pending:!0,bye:!0},{abandoned:O,completed:$,upcoming:F,pending:V,bye:j}=k,B=[].concat(...O&&S||[],...$&&U||[],...F&&P||[],...V&&E||[],...j&&R||[]);H3e({inContextDrawMatchUps:B,drawDefinition:y})}return N}function nf(t){let{participants:e=[],contextContent:i,participantMap:n}=t,{scheduleVisibilityFilters:r,tournamentAppliedPolicies:a,participantsProfile:s,afterRecoveryTimes:o,policyDefinitions:l,useParticipantMap:c,tournamentRecord:u,usePublishState:d,contextFilters:p,matchUpFilters:h,contextProfile:f,nextMatchUps:m,inContext:g,context:v,event:y}=t;if(!y)return{error:Qn};let{eventId:b,eventName:I,endDate:T,eventType:w,category:S,gender:U,matchUpFormat:P}=y??{},E={...v,...Zt({indoorOutDoor:y.indoorOutdoor??(u==null?void 0:u.indoorOutdoor),surfaceCategory:y.surfaceCategory??(u==null?void 0:u.surfaceCategory),endDate:y.endDate??(u==null?void 0:u.endDate),tournamentId:u==null?void 0:u.tournamentId,matchUpFormat:P,eventName:I,eventType:w,category:S,eventId:b,gender:U})};T&&(E.endDate=T),f&&!i&&(i=Mm({policyDefinitions:l,tournamentRecord:u,contextProfile:f,event:y}));let R;if(!(e!=null&&e.length)&&!n&&u){let _=Qy({participantsProfile:s,useParticipantMap:c,policyDefinitions:l,tournamentRecord:u,contextProfile:f,inContext:g});n=_.participantMap,e=_.participants??[],R=_.groupInfo}let C=y.drawDefinitions??[],M=SR({tournamentRecord:u,event:y}).scheduleTiming;return{matchUps:C.flatMap(_=>{let{matchUps:A}=pa({tournamentParticipants:e,tournamentAppliedPolicies:a,scheduleVisibilityFilters:r,context:E,participantsProfile:s,afterRecoveryTimes:o,policyDefinitions:l,tournamentRecord:u,usePublishState:d,contextFilters:p,contextProfile:f,drawDefinition:_,contextContent:i,matchUpFilters:h,participantMap:n,scheduleTiming:M,nextMatchUps:m,inContext:g,event:y});return A??[]}),groupInfo:R}}function Za(t){let e=ei(t,[{tournamentRecord:!0}]);if(e.error)return e;if(!(t!=null&&t.tournamentRecord))return{error:dt};let{participantMap:i,participants:n}=t,{scheduleVisibilityFilters:r,participantsProfile:a,afterRecoveryTimes:s,useParticipantMap:o,policyDefinitions:l,tournamentRecord:c,inContext:u=!0,usePublishState:d,contextProfile:p,matchUpFilters:h,contextFilters:f,nextMatchUps:m,context:g}=t,v=t.tournamentId??c.tournamentId,y=(c==null?void 0:c.events)??[];n||({participants:n,participantMap:i}=Qy({participantsProfile:a,useParticipantMap:o,policyDefinitions:l,tournamentRecord:c,contextProfile:p,inContext:u}));let{appliedPolicies:b}=fn({tournamentRecord:c}),I={...g,tournamentId:v,indoorOutDoor:c.indoorOutdoor,surfaceCategory:c.surfaceCategory,endDate:c.endDate},T=Mm({policyDefinitions:l,tournamentRecord:c,contextProfile:p});return{matchUps:y.flatMap(w=>{var S;return I.eventDrawsCount=((S=w.drawDefinitions)==null?void 0:S.length)??0,nf({context:I,scheduleVisibilityFilters:r,tournamentAppliedPolicies:b,participantsProfile:a,afterRecoveryTimes:s,policyDefinitions:l,tournamentRecord:c,usePublishState:d,contextContent:T,contextFilters:f,contextProfile:p,matchUpFilters:h,participantMap:i,nextMatchUps:m,participants:n,inContext:u,event:w}).matchUps??[]}).concat(...c.matchUps??[])}}function Fd({scheduleVisibilityFilters:t,afterRecoveryTimes:e,participantsProfile:i,tournamentRecords:n,policyDefinitions:r,usePublishState:a,matchUpFilters:s,contextFilters:o,nextMatchUps:l,inContext:c}){if(typeof n!="object"||!Object.keys(n).length)return{error:Tr};let u=Object.keys(n).map(d=>{let p=n[d];return Za({scheduleVisibilityFilters:t,afterRecoveryTimes:e,participantsProfile:i,policyDefinitions:r,tournamentRecord:p,usePublishState:a,matchUpFilters:s,contextFilters:o,nextMatchUps:l,inContext:c}).matchUps??[]}).flat();return{...pe,matchUps:u}}function kw(t,e){return q3e(t,e)||((t==null?void 0:t.stageSequence)||0)-((e==null?void 0:e.stageSequence)||0)||(t==null?void 0:t.roundNumber)&&e.roundNumber&&(t==null?void 0:t.roundNumber)-(e==null?void 0:e.roundNumber)||((t==null?void 0:t.roundPosition)??0)-((e==null?void 0:e.roundPosition)??0)}function q3e(t,e){return(UI[t==null?void 0:t.stage]||0)-(UI[e==null?void 0:e.stage]||0)}function po(t){let{participants:e,participantMap:i,contextContent:n}=t,{scheduleVisibilityFilters:r,tournamentAppliedPolicies:a,participantsProfile:s,afterRecoveryTimes:o,policyDefinitions:l,useParticipantMap:c,tournamentRecord:u,matchUpFilters:d,contextFilters:p,contextProfile:h,drawDefinition:f,nextMatchUps:m,inContext:g,context:v,event:y}=t,{eventId:b,eventName:I,endDate:T,eventType:w,category:S,gender:U,matchUpFormat:P}=y??{},E={...v,surfaceCategory:(y==null?void 0:y.surfaceCategory)??(u==null?void 0:u.surfaceCategory),indoorOutDoor:(y==null?void 0:y.indoorOutdoor)??(u==null?void 0:u.indoorOutdoor),matchUpFormat:P,eventType:w,eventName:I,category:S,eventId:b,endDate:T,gender:U},R;return!(e!=null&&e.length)&&!i&&u&&({participants:e=[],participantMap:i,groupInfo:R}=Qy({participantsProfile:s,useParticipantMap:c,policyDefinitions:l,tournamentRecord:u,contextProfile:h,inContext:g})),h&&!n&&(n=Mm({policyDefinitions:l,tournamentRecord:u,contextProfile:h,drawDefinition:f,event:y})),{...pa({context:E,tournamentAppliedPolicies:a,scheduleVisibilityFilters:r,tournamentParticipants:e,participantsProfile:s,afterRecoveryTimes:o,policyDefinitions:l,tournamentRecord:u,drawDefinition:f,contextContent:n,contextFilters:p,contextProfile:h,matchUpFilters:d,participantMap:i,nextMatchUps:m,inContext:g,event:y}),groupInfo:R}}function Kb({element:t,accessor:e}){if(typeof e!="string")return{values:[]};let i=$t(t),n=e.split("."),r=[],a;o({targetElement:i,attributes:n});let s={value:a};return r.length&&(s.values=r),s;function o({targetElement:l,attributes:c=[],significantCharacters:u}){for(let[p,h]of c.entries())if(l!=null&&l[h]){let f=c.slice(p+1);f.length?Array.isArray(l[h])?l[h].forEach(m=>o({targetElement:m,attributes:f})):(l=l[h],d({targetElement:l,index:p})):(a||(a=l[h]),r.includes(l[h])||r.push(l[h]))}function d({targetElement:p,index:h}){if(p&&h===c.length-1&&["string","number"].includes(typeof p)){let f=u?p.slice(0,u):p;a?r.includes(f)||r.push(f):(a=f,r.push(f))}}}}var Tbe=t=>e=>{var i;return!t||typeof e!="object"?void 0:Array.isArray(t)&&t.map(n=>{var r;return{[n]:(r=Kb({element:e,accessor:n}))==null?void 0:r.value}})||typeof t=="object"&&Object.keys(t).map(n=>{var r;return{[n]:(r=Kb({element:e,accessor:n}))==null?void 0:r.value}})||((i=typeof t=="string"&&Kb({element:e,accessor:t}))==null?void 0:i.value)},Bl=Tbe;function _R({finishingPositionOffset:t=0,finishingPositionLimit:e,positionsFed:i,roundsCount:n,roundLimit:r,matchUps:a,lucky:s,fmlc:o}){var l;if(!lu(a))return[];let{roundProfile:c,roundNumbers:u=[]}=yo({interpolate:!0,matchUps:a});n=n??Math.max(...u,0);let d=r?n-r:0,p=d&&((l=c==null?void 0:c[n-d])==null?void 0:l.matchUpsCount),h=c&&Object.values(c).map(Bl("matchUpsCount")),f=(v,y)=>{let b=Math.min(...v);p&&y&&b===1&&(b=p);let I=Math.max(...v);return e&&I>e&&(I=e),[b,I]},m=c&&Object.assign({},...u.map(v=>{let y=(n??0)+1-v-d,b=c[v].matchUpsCount,I={finishingPositionRange:{},finishingRound:y},T=h==null?void 0:h.slice(v-1).reduce((M,_)=>M+(_||0),0),w=o&&v!==1,S=1+t+(w?i??0:0),U=1,P=Mt(S,s?S+b*2:T+S+U),E=T+U-b,R=f(P.slice(E)),C=f(P.slice(0,E),!0);return I.finishingPositionRange={loser:R,winner:C},{[v]:I}})),g=oc({finishingRound:!0});return a.filter(Boolean).forEach(v=>{let y=v.roundNumber&&m[v.roundNumber];g&&!y&&console.log({roundFinishingData:m,matchUp:v}),v.finishingRound=y==null?void 0:y.finishingRound,v.finishingPositionRange=y==null?void 0:y.finishingPositionRange}),a}function wy({inContextDrawMatchUps:t,drawDefinition:e,matchUpsMap:i}){var n;if(!e)return{error:Ht};let r={loserMatchUpIds:{},winnerMatchUpIds:{}};if(t||({matchUps:t,matchUpsMap:i}=pa({inContext:!0,drawDefinition:e,matchUpsMap:i})),!(i!=null&&i.drawMatchUps.some(a=>a.finishingPositionRange))&&((n=e==null?void 0:e.structures)==null?void 0:n.length)===1&&!(e!=null&&e.structures[0].structures)){let a=(i==null?void 0:i.drawMatchUps)??[];_R({matchUps:a})}return(t??[]).filter(({collectionId:a})=>!a).forEach(a=>{let{matchUpId:s,structureId:o}=a,l=bo({inContextDrawMatchUps:t,drawDefinition:e,matchUpId:s}),{winnerMatchUp:c,loserMatchUp:u}=l.targetMatchUps,d=c==null?void 0:c.matchUpId,p=u==null?void 0:u.matchUpId,h=by({matchUpsMap:i,structureId:o}).find(f=>f.matchUpId===s);if(h&&(d&&(r.winnerMatchUpIds[h.matchUpId]=d,Object.assign(h,{winnerMatchUpId:d}),Object.assign(a,{winnerMatchUpId:d})),p&&(r.loserMatchUpIds[h.matchUpId]=p,a.loserMatchUpId=p,h.loserMatchUpId=p,a.finishingPositionRange))){let f=u.finishingPositionRange&&[...a.finishingPositionRange.loser,...u.finishingPositionRange.loser],m=f&&[Math.min(...f),Math.max(...f)];a.finishingPositionRange.loser=m,h.finishingPositionRange.loser=m}}),{inContextDrawMatchUps:t,goesToMap:r}}function od(t){var e;let i=au(t),n=t.matchUps??[],r=t.drawIds??[],{includeParticipantDependencies:a,tournamentRecord:s,drawDefinition:o}=t;if(!Array.isArray(n))return{error:Em};if(!Array.isArray(r))return{error:jd};let l=(e=t.matchUpIds)!=null&&e.length?t.matchUpIds:n.map(b=>b.matchUpId);if(!Array.isArray(l))return{error:gw};let c={},u={},d={},p={};s&&!Object.keys(i).length&&(i={[s.tournamentId]:s});let h=Object.values(i),f=h.reduce((b,I)=>b.concat(I.events??[]).map(T=>(T.drawDefinitions||[]).map(w=>w.links||[])).flat(1/0),[]).filter(({linkType:b})=>b===im),m=n;if(f.length){m=Fd({nextMatchUps:!0,tournamentRecords:i}).matchUps;let b=f.reduce((I,T)=>{var w,S;let U=(w=T.source)==null?void 0:w.structureId,P=(S=T.target)==null?void 0:S.structureId;return U&&P&&(d[P]=U),U&&!I.includes(U)&&I.push(U),I},[]);for(let I of b)c[I]=[];for(let I of m??[]){let T=I.containerStructureId||I.structureId;b.includes(T)&&c[T].push(I.matchUpId)}}let g=b=>{u[b]||(u[b]={dependentMatchUpIds:[],participantIds:[],matchUpIds:[],sources:[]},p[b]=[])},v=(b,I)=>{u[b].matchUpIds.forEach(T=>{u[I].matchUpIds.push(T)}),u[I].matchUpIds.push(b),u[b].dependentMatchUpIds.push(I),a&&u[b].participantIds.forEach(T=>u[I].participantIds.push(T))},y=b=>{let I=Object.keys(c).length;for(let T of b||[]){let{matchUpId:w,winnerMatchUpId:S,loserMatchUpId:U}=T;if(!l.length||l.includes(w)){if(g(w),a){let{individualParticipantIds:R}=sF(T);u[w].participantIds=R}S&&(g(S),v(w,S),p[S].push(w)),U&&(g(U),v(w,U),p[U].push(w)),u[w].sources.push(p[w]);let P=p[w].map(R=>u[R].sources[0]).flat(),E=p[w].map(R=>u[R].sources[1]).flat();if(u[w].sources.push(P,E),I){let R=T.containerStructureId||T.structureId,C=d[R];if(c[C])for(let M of c[C])g(M),v(M,w),p[M].push(w)}}}};if(o)wy({drawDefinition:o}),m!=null&&m.length||(m=po({drawDefinition:o}).matchUps),y(m);else{if(m!=null&&m.length||(m=Fd({nextMatchUps:!0,tournamentRecords:i}).matchUps),!r.length){let b=h!=null&&h.length?h.map(({events:I=[]})=>I.map(({drawDefinitions:T=[]})=>T.map(({drawId:w})=>w))).flat(1/0):[];b&&(r=b)}for(let b of r){let I=m==null?void 0:m.filter(T=>T.drawId===b).sort(kw);if(!(I!=null&&I.find(({roundPosition:T})=>!T))){let T=I==null?void 0:I.find(({tournamentId:S})=>S),{drawDefinition:w}=zo({tournamentRecord:i[T==null?void 0:T.tournamentId],drawId:b});w&&wy({drawDefinition:w})}y(I)}}return{positionDependencies:c,matchUpDependencies:u,sourceMatchUpIds:p,matchUps:m,...pe}}function ya(t){var e,i;let n=t==null?void 0:t.matchUp,r=(t==null?void 0:t.score)||(n==null?void 0:n.score),a=(e=r==null?void 0:r.sets)==null?void 0:e[0],{side1Score:s,side2Score:o,side1TiebreakScore:l,side2TiebreakScore:c,side1PointScore:u,side2PointScore:d}=a||{},p=s||o||l||c||u||d;return!!(((i=r==null?void 0:r.sets)==null?void 0:i.length)>1||p)}function kR({matchUpStatus:t}){return xye.includes(t)}function W3e({matchUpStatus:t}){return $6.includes(t)}function iG({matchUpStatus:t}){return Oye.includes(t)}function m8({matchUpStatus:t,winningSide:e,tieMatchUps:i,sides:n,score:r}){var a;let s=n==null?void 0:n.find(({participantId:l})=>l),o=(a=i==null?void 0:i.filter(m8))==null?void 0:a.length;return ya({score:r})||o||e&&s||t&&W3e({matchUpStatus:t})&&![Ki,un,ad].includes(t)}function xR(t){var e;let{drawDefinition:i,findContainer:n,structureId:r,event:a}=t,s=t.structure,o={isCollectionMatchUp:!1},{containedStructures:l}=zU({drawDefinition:i}),c=r?l[r]||[]:[];if(!s){let U=fi({drawDefinition:i,structureId:r});if(U.error)return U;s=n?U.containingStructure??U.structure:U.structure}if(Ho({structure:s}))return{structure:s,isAdHoc:!0,error:NU};let{matchUps:u}=pa({inContext:!0,matchUpFilters:o,drawDefinition:i,event:a}),d=u==null?void 0:u.filter(U=>U.structureId===r||c.includes(U.structureId)),{matchUpDependencies:p}=od({drawIds:[i.drawId],matchUps:u,drawDefinition:i}),h=[],f=[],m={},g=[];for(let U of u??[]){if(U.structureId===r||c.includes(U.structureId)){f.push(...U.drawPositions??[]);let P=U.roundNumber;for(let E of(U.drawPositions??[]).filter(Boolean))(!m[E]||P&&m[E]>P)&&(m[E]=P)}m8(U)&&(g.push(U),h.push(U.matchUpId,...((e=p==null?void 0:p[U==null?void 0:U.matchUpId])==null?void 0:e.matchUpIds)||[]))}let v=Pi(f.filter(Boolean)).sort(ra),y=Pi(h),b=Pi(d==null?void 0:d.map(({matchUpId:U,drawPositions:P})=>y.includes(U)?P:[]).flat().filter(Boolean)).sort(ra),{positionAssignments:I}=Gn({drawDefinition:i,structure:s}),T=I==null?void 0:I.filter(U=>U.bye).map(U=>U.drawPosition),w=I==null?void 0:I.filter(U=>U.qualifier).map(U=>U.drawPosition),S=(v==null?void 0:v.filter(U=>!b.includes(U)))||[];return{allDrawPositions:v,inContextStructureMatchUps:d,drawPositionInitialRounds:m,activeDependentMatchUpIds:y,qualifyingDrawPositions:w,inactiveDrawPositions:S,positionAssignments:I,activeDrawPositions:b,byeDrawPositions:T,activeMatchUps:g,structure:s}}function CI({drawPosition:t,matchUps:e=[]}){return{initialRoundNumber:e.filter(({drawPositions:i})=>t&&(i==null?void 0:i.includes(t))).map(({roundNumber:i})=>i).sort(ra)[0]}}var Vm={reset:"\x1B[0m",bright:"\x1B[1m",dim:"\x1B[2m",red:"\x1B[31m",brightred:"\x1B[91m",green:"\x1B[32m",brightgreen:"\x1B[92m",yellow:"\x1B[33m",brightyellow:"\x1B[93m",blue:"\x1B[34m",brightblue:"\x1B[94m",lightblue:"\x1B[105m",magenta:"\x1B[35m",brightmagenta:"\x1B[95m",cyan:"\x1B[36m",brightcyan:"\x1B[96m",white:"\x1B[37m",brightwhite:"\x1B[97m"},g8=[];function Jl(t,e){ur(t)&&(t={method:t}),(e||oc())&&g8.push(t)}function Y3e(t){return g8.slice()}function K3e(t){let e=Y3e().map(i=>{let{color:n,keyColors:r,method:a,newline:s}=i,o=Object.keys(Vm).includes(n)?Vm[n]:Vm.cyan,l=Object.keys(i).filter(u=>!["color","keyColors","method","newline"].includes(u)).map(u=>{let d=r&&Object.keys(r).includes(u)&&Vm[r[u]]?Vm[r[u]]:Vm.brightwhite;return`${Vm.white}${u}: ${d}${i[u]}`}).join(", "),c=(a==null?void 0:a.length)<15?"		":"	";return[s?`
`:"",o,a,c,Vm.white,l,Vm.reset,`
`].join("")});e!=null&&e.length&&console.log(...e)}function Z3e(){g8.length=0}function yc({provisionalPositioning:t,isPositionAction:e,tournamentRecord:i,drawDefinition:n,drawPosition:r,matchUpsMap:a,structureId:s,structure:o,event:l}){var c,u,d;if(!n)return{error:Ht};if(o||({structure:o}=fi({drawDefinition:n,structureId:s})),!o)return{error:yr};s||({structureId:s}=o);let p="assignDrawPositionBye";Jl({method:p,color:"cyan",drawPosition:r}),a||(a=Us({drawDefinition:n}));let{positionAssignments:h}=Gn({structure:o}),{activeDrawPositions:f}=xR({drawDefinition:n,structureId:s});if((c=h==null?void 0:h.find(C=>C.drawPosition===r))!=null&&c.bye)return{...pe};if(f!=null&&f.includes(r))return{error:wL};let m=h==null?void 0:h.find(C=>C.drawPosition===r);if(!m)return{error:NU};let{filled:g,containsBye:v,assignedParticipantId:y}=X3e(m);if(v)return{...pe};if(g&&!v)return fe({result:{error:rT},stack:p});let b=fn({tournamentRecord:i,drawDefinition:n,event:l}).appliedPolicies??{},I=pa({inContext:!0,drawDefinition:n,matchUpsMap:a}).matchUps??[],T={isCollectionMatchUp:!1},{matchUps:w}=Sn({provisionalPositioning:t,drawDefinition:n,matchUpFilters:T,matchUpsMap:a,structure:o});if(h==null||h.forEach(C=>{C.drawPosition===r&&(C.bye=!0)}),o.structureType===Eo)return J3e({tournamentRecord:i,drawDefinition:n,drawPosition:r,matchUps:w}),Ug({tournamentId:i==null?void 0:i.tournamentId,drawDefinition:n,structure:o,event:l}),KX({assignedParticipantId:y,isPositionAction:e,appliedPolicies:b,drawDefinition:n,drawPosition:r,structureId:s,stack:p});let{roundProfile:S,roundMatchUps:U}=yo({matchUps:w}),P=(u=S&&Object.keys(S).map(C=>parseInt(C)).reverse())==null?void 0:u.find(C=>{var M;return(M=S==null?void 0:S[C].drawPositions)==null?void 0:M.includes(r)}),E=P?U==null?void 0:U[P].find(({drawPositions:C})=>C==null?void 0:C.includes(r)):void 0;E&&Ube({tournamentRecord:i,drawDefinition:n,matchUp:E,event:l});let R=(d=E==null?void 0:E.drawPositions)==null?void 0:d.find(C=>C!==r);if(E&&R){let C=v8({sourceDrawPositions:E.drawPositions,matchUpId:E.matchUpId,inContextDrawMatchUps:I,drawPositionToAdvance:R,tournamentRecord:i,drawDefinition:n,matchUpsMap:a});if(C.error)return C}return Ug({tournamentId:i==null?void 0:i.tournamentId,drawDefinition:n,structure:o,event:l}),KX({assignedParticipantId:y,isPositionAction:e,appliedPolicies:b,drawDefinition:n,drawPosition:r,structureId:s,stack:p})}function KX({assignedParticipantId:t,isPositionAction:e,appliedPolicies:i,drawDefinition:n,drawPosition:r,structureId:a,stack:s}){return e&&aF({appliedPolicies:i,drawDefinition:n,positionAction:{removedParticipantId:t,drawPosition:r,structureId:a,name:s}}),fe({result:{...pe},stack:s})}function X3e(t){let e=t.bye,i=t.qualifier,n=t.participantId;return{containsBye:e,containsQualifier:i,assignedParticipantId:n,filled:e||i||n}}function Ube({tournamentRecord:t,drawDefinition:e,eventId:i,matchUp:n,event:r}){Object.assign(n,{matchUpStatus:gn,score:void 0,winningSide:void 0}),Qi({tournamentId:t==null?void 0:t.tournamentId,eventId:i??(r==null?void 0:r.eventId),context:"setMatchUpStatusBye",drawDefinition:e,matchUp:n})}function J3e({tournamentRecord:t,drawDefinition:e,drawPosition:i,matchUps:n,event:r}){n.forEach(a=>{var s;(s=a.drawPositions)!=null&&s.includes(i)&&Ube({eventId:r==null?void 0:r.eventId,tournamentRecord:t,drawDefinition:e,matchUp:a})})}function v8({drawPositionToAdvance:t,inContextDrawMatchUps:e,sourceDrawPositions:i,tournamentRecord:n,drawDefinition:r,matchUpsMap:a,matchUpId:s,event:o}){var l,c;Jl({method:"advanceDrawPosition",color:"cyan",drawPositionToAdvance:t});let u=a.drawMatchUps.find(T=>T.matchUpId===s),d=(l=e.find(T=>T.matchUpId===s))==null?void 0:l.structureId,{structure:p}=fi({drawDefinition:r,structureId:d}),{positionAssignments:h}=Gn({structure:p}),f=h==null?void 0:h.filter(T=>T.bye).map(T=>T.drawPosition),m=(c=u==null?void 0:u.drawPositions)==null?void 0:c.find(T=>T!==t),g=m&&(f==null?void 0:f.includes(m)),{targetLinks:{loserTargetLink:v},targetMatchUps:{loserMatchUp:y,winnerMatchUp:b,loserTargetDrawPosition:I}}=bo({inContextDrawMatchUps:e,drawDefinition:r,matchUpId:s});if(b&&b.structureId===(p==null?void 0:p.structureId)&&Q3e({drawPositionToAdvance:t,inContextDrawMatchUps:e,sourceDrawPositions:i,tournamentRecord:n,drawDefinition:r,winnerMatchUp:b,matchUpsMap:a,event:o}),y&&g&&y.structureId!==(p==null?void 0:p.structureId)){let{roundNumber:T}=y;if(T===1){let w=yc({structureId:v.target.structureId,drawPosition:I,tournamentRecord:n,drawDefinition:r,event:o});if(w.error)return w}else Dbe({loserTargetDrawPosition:I,tournamentRecord:n,loserTargetLink:v,drawDefinition:r,loserMatchUp:y,matchUpsMap:a,event:o})}return{...pe}}function Q3e({drawPositionToAdvance:t,inContextDrawMatchUps:e,sourceDrawPositions:i,tournamentRecord:n,drawDefinition:r,winnerMatchUp:a,matchUpsMap:s,event:o}){var l,c,u,d,p,h;let f="advanceWinner",m=s.drawMatchUps.find(F=>F.matchUpId===a.matchUpId),g=(l=e.find(F=>F.matchUpId===a.matchUpId))==null?void 0:l.structureId,{structure:v}=fi({drawDefinition:r,structureId:g}),{positionAssignments:y}=Gn({structure:v}),b=(c=y==null?void 0:y.find(({drawPosition:F})=>F===t))==null?void 0:c.bye,I=(u=m.drawPositions)==null?void 0:u.filter(Boolean),T=y==null?void 0:y.filter(F=>I==null?void 0:I.includes(F.drawPosition)),w=y==null?void 0:y.find(({drawPosition:F})=>F===t),S=i==null?void 0:i.find(F=>F!==t),U=(d=S&&(T==null?void 0:T.find(({drawPosition:F})=>F===S)))==null?void 0:d.bye,P=b&&U;if(P&&console.log({isByeAdvancedBye:P}),(I==null?void 0:I.length)>1&&b&&!U)return fe({result:{error:rT},stack:f});let E=I==null?void 0:I.find(F=>F!==t),R=P,C=[...(m.drawPositions||[]).filter(Boolean),void 0,void 0].slice(0,2),M=C.map(F=>!F&&!R||F===t?(R=!0,t):F).sort(ra);if(!R)return console.log("@@@@@@@",{advancingAssignmentIsBye:w,drawPositionToAdvance:t,existingAssignments:T}),fe({result:{error:rT},stack:f});let _=(p=y==null?void 0:y.find(({drawPosition:F})=>F===E))==null?void 0:p.bye,A=(h=y==null?void 0:y.find(({drawPosition:F})=>F===t))==null?void 0:h.bye;Object.assign(m,{matchUpStatus:A||_?gn:jr,score:void 0,winningSide:void 0,drawPositions:M});let N=m.drawPositions.find(F=>!C.includes(F));Jl({method:f,color:"brightyellow",changedDrawPosition:N,pairedDrawPositionIsBye:_,drawPositionIsBye:A}),Qi({tournamentId:n==null?void 0:n.tournamentId,matchUp:m,eventId:o==null?void 0:o.eventId,context:f,drawDefinition:r});let{targetLinks:{loserTargetLink:k},targetMatchUps:{loserMatchUp:O,loserTargetDrawPosition:$}}=bo({matchUpId:a.matchUpId,inContextDrawMatchUps:e,drawDefinition:r});if(_||A){let F=_?t:E;if(F)v8({drawPositionToAdvance:F,matchUpId:a.matchUpId,inContextDrawMatchUps:e,tournamentRecord:n,drawDefinition:r,matchUpsMap:s});else if(A&&k&&O)if(O.feedRound)Dbe({loserTargetDrawPosition:$,tournamentRecord:n,loserTargetLink:k,drawDefinition:r,loserMatchUp:O,matchUpsMap:s});else{let V=1-a.roundPosition%2,j=O.drawPositions[V],B=yc({structureId:k.target.structureId,drawPosition:j,tournamentRecord:n,drawDefinition:r,event:o});if(B.error)return B}}}function Dbe({loserTargetDrawPosition:t,tournamentRecord:e,loserTargetLink:i,drawDefinition:n,loserMatchUp:r,matchUpsMap:a,event:s}){let{roundNumber:o}=r;Jl({method:"assignFedDrawPositionBye",color:"cyan",loserTargetDrawPosition:t});let l=((a==null?void 0:a.mappedMatchUps)||{})[r.structureId].matchUps,{initialRoundNumber:c}=CI({drawPosition:t,matchUps:l});if(c===o){let u=yc({structureId:i.target.structureId,drawPosition:t,tournamentRecord:e,drawDefinition:n,event:s});if(u.error)return u}}function Ebe({positionAssignments:t,tournamentRecord:e,drawDefinition:i,matchUpsMap:n,structure:r,event:a}){let{matchUps:s}=Sn({drawDefinition:i,matchUpsMap:n,structure:r,event:a});s.forEach(o=>{let l=t.filter(({drawPosition:c})=>{var u;return(u=o.drawPositions)==null?void 0:u.includes(c)}).filter(c=>c.bye).length;o.winningSide||(Object.assign(o,{matchUpStatus:l?gn:jr}),Qi({tournamentId:e==null?void 0:e.tournamentId,context:"modifyRoundRobinMatchUpsStatus",eventId:a==null?void 0:a.eventId,drawDefinition:i,matchUp:o}))})}function OR(t){let{inContextDrawMatchUps:e,participantId:i,drawPosition:n}=t,{tournamentRecord:r,drawDefinition:a,structureId:s,matchUpsMap:o,event:l}=t,{structure:c}=fi({drawDefinition:a,structureId:s}),u=(Aa({drawDefinition:a,structure:c}).positionAssignments||[]).find(p=>i&&p.participantId===i||n&&p.drawPosition===n);if(u&&i&&!n&&(n=u==null?void 0:u.drawPosition),!n)return{error:AU};i||(i=u==null?void 0:u.participantId);let{activeDrawPositions:d}=xR({drawDefinition:a,structureId:s});return d.includes(n)?{error:wL}:(e||({matchUps:e}=pa({inContext:!0,drawDefinition:a,matchUpsMap:o})),nG({inContextDrawMatchUps:e,tournamentRecord:r,drawDefinition:a,structureId:s,drawPosition:n,matchUpsMap:o,event:l}).drawPositionCleared?(Ug({tournamentId:r==null?void 0:r.tournamentId,drawDefinition:a,structure:c,event:l}),{...pe,participantId:i}):{error:Jme})}function nG({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,drawPosition:n,matchUpsMap:r,structureId:a,event:s}){var o,l;let{structure:c}=fi({drawDefinition:i,structureId:a});if(!c)return{error:yr};let u=Aa({drawDefinition:i,structure:c}).positionAssignments||[],d=u.some(b=>{if(b.drawPosition===n)return delete b.participantId,delete b.qualifier,delete b.bye,!0});if(c.structureType===Eo)return Ebe({positionAssignments:u,tournamentRecord:e,drawDefinition:i,matchUpsMap:r,structure:c}),{drawPositionCleared:d,...pe};let p={isCollectionMatchUp:!1},{matchUps:h}=Sn({drawDefinition:i,matchUpFilters:p,matchUpsMap:r,structure:c,event:s}),{roundProfile:f,roundMatchUps:m}=yo({matchUps:h}),g=(o=f&&Object.keys(f))==null?void 0:o.map(b=>di(b)),v=n,y=(l=g==null?void 0:g.map(b=>{var I,T,w,S;let U=(T=(I=f==null?void 0:f[b])==null?void 0:I.pairedDrawPositions)==null?void 0:T.find(N=>N.includes(v)),P=U==null?void 0:U.find(N=>N!==v),E=u.find(N=>N.drawPosition===P),R=f==null?void 0:f[b+1],C=E==null?void 0:E.bye,M=(w=R==null?void 0:R.pairedDrawPositions)==null?void 0:w.find(N=>N.includes(P)),_=C&&M&&R&&((S=R.drawPositions)==null?void 0:S.includes(P)),A=U&&{pairedDrawPositionByeAdvancedPair:!_&&M,pairedDrawPosition:P,targetDrawPosition:v,relevantPair:U,roundNumber:b};return _&&(v=P),A}).filter(b=>b==null?void 0:b.targetDrawPosition))==null?void 0:l.reduce((b,I)=>{let{roundNumber:T,relevantPair:w,targetDrawPosition:S,pairedDrawPosition:U,pairedDrawPositionByeAdvancedPair:P}=I,E={roundNumber:T,targetDrawPosition:S,relevantPair:w},R=P&&{roundNumber:T+1,targetDrawPosition:U,relevantPair:P,subsequentRoundRemoval:!0},C=[E,R].filter(Boolean);return b.concat(...C)},[]);return y==null||y.forEach(({roundNumber:b,targetDrawPosition:I,relevantPair:T})=>{let w=m==null?void 0:m[b].find(S=>{var U;return vo((U=S.drawPositions)==null?void 0:U.filter(Boolean),T.filter(Boolean))});w&&(eWe({inContextDrawMatchUps:t,targetDrawPosition:I,tournamentRecord:e,drawDefinition:i,structureId:a,roundNumber:b,matchUpsMap:r}),Pbe({inContextDrawMatchUps:t,positionAssignments:u,tournamentRecord:e,drawDefinition:i,targetMatchUp:w,drawPosition:n,matchUpsMap:r,structure:c,event:s}))}),{tasks:y,drawPositionCleared:d,positionAssignments:u}}function eWe({inContextDrawMatchUps:t,targetDrawPosition:e,tournamentRecord:i,drawDefinition:n,matchUpsMap:r,roundNumber:a,structureId:s}){let{structure:o}=fi({drawDefinition:n,structureId:s});if(!o)return{error:yr};if(o.structureType===Eo)return;r=r||Us({drawDefinition:n});let l=((r==null?void 0:r.mappedMatchUps)||{})[s].matchUps,{initialRoundNumber:c}=CI({drawPosition:e,matchUps:l}),u=l==null?void 0:l.filter(p=>{var h;return p.roundNumber>=a&&p.roundNumber!==c&&((h=p.drawPositions)==null?void 0:h.includes(e))}),d=Gn({drawDefinition:n,structureId:s}).positionAssignments??[];return u==null||u.forEach(p=>Pbe({drawPosition:e,targetMatchUp:p,inContextDrawMatchUps:t,positionAssignments:d,tournamentRecord:i,drawDefinition:n,matchUpsMap:r,structure:o})),{...pe}}function Pbe({inContextDrawMatchUps:t,positionAssignments:e,tournamentRecord:i,drawDefinition:n,targetMatchUp:r,drawPosition:a,matchUpsMap:s,structure:o,event:l}){var c,u,d,p,h;let f="removeDrawPosition",m=(c=r.drawPositions)==null?void 0:c.slice(),g=r.matchUpStatus,v=r.winningSide;s=s??Us({drawDefinition:n});let y=s.mappedMatchUps[o.structureId].matchUps,{initialRoundNumber:b}=CI({drawPosition:a,matchUps:y});if(r.roundNumber&&b&&r.roundNumber>b){let C=(r.drawPositions??[]).map(M=>M===a?void 0:M);r.drawPositions=C}if(r.matchUpType===Xn){let C=(((u=t==null?void 0:t.find(M=>M.matchUpId===r.matchUpId))==null?void 0:u.sides)??[]).reduce((M,_,A)=>_.drawPosition===a?A:M,void 0);C!==void 0&&(p=(d=r.sides)==null?void 0:d[C])!=null&&p.lineUp&&((h=r.sides)==null||delete h[C].lineUp,Qi({tournamentId:i==null?void 0:i.tournamentId,context:`${f}-TEAM`,eventId:l==null?void 0:l.eventId,matchUp:r,drawDefinition:n}))}let I=bo({matchUpId:r.matchUpId,inContextDrawMatchUps:t,drawDefinition:n}),{targetLinks:{winnerTargetLink:T},targetMatchUps:{loserMatchUp:w,winnerMatchUp:S,loserMatchUpDrawPositionIndex:U}}=I,P=e.filter(({drawPosition:C})=>{var M;return(M=r.drawPositions)==null?void 0:M.includes(C)}).filter(C=>C.bye).length,E=P&&gn||r.matchUpStatus&&[Ki,un].includes(r.matchUpStatus)&&r.matcHUpStatus||jr;r.matchUpStatus=E,r.matchUpStatus&&[un,Ki].includes(r.matchUpStatus)&&(r.winningSide=void 0);let R=m==null?void 0:m.find(C=>{var M;return!((M=r.drawPositions)!=null&&M.includes(C))});if(m!=null&&m.includes(a)&&g===r.matchUpStatus&&v===r.winningSide||(R&&Jl({method:f,color:"brightyellow",removedDrawPosition:R}),Qi({tournamentId:i==null?void 0:i.tournamentId,context:`${f}-${a}`,eventId:l==null?void 0:l.eventId,matchUp:r,drawDefinition:n})),w&&w.structureId!==I.matchUp.structureId&&!P){let{drawPositions:C,roundNumber:M}=w;if(M===1){let _=C[U];nG({structureId:w.structureId,drawPosition:_,inContextDrawMatchUps:t,tournamentRecord:i,drawDefinition:n,matchUpsMap:s})}else{let _=Math.min(...C.filter(Boolean)),A=tWe({loserMatchUpDrawPosition:_,inContextDrawMatchUps:t,tournamentRecord:i,drawDefinition:n,loserMatchUp:w,matchUpsMap:s,event:l});if(A.error)return fe({result:A,stack:f});let N=((s==null?void 0:s.mappedMatchUps)||{})[w.structureId].matchUps,{initialRoundNumber:k}=CI({drawPosition:_,matchUps:N});k===1&&(Jl({method:f,color:"brightyellow",loserMatchUpDrawPosition:_}),nG({structureId:w.structureId,drawPosition:_,inContextDrawMatchUps:t,tournamentRecord:i,drawDefinition:n,matchUpsMap:s}))}}return S&&S.structureId!==I.matchUp.structureId&&T.target.feedProfile,{...pe}}function tWe({loserMatchUpDrawPosition:t,inContextDrawMatchUps:e,tournamentRecord:i,drawDefinition:n,loserMatchUp:r,matchUpsMap:a,event:s}){var o;let{structure:l}=fi({structureId:r.structureId,drawDefinition:n}),{positionAssignments:c}=Gn({structure:l});if((o=c==null?void 0:c.find(u=>u.drawPosition===t))!=null&&o.bye){let u=OR({drawPosition:t,structureId:r.structureId,inContextDrawMatchUps:e,tournamentRecord:i,drawDefinition:n,matchUpsMap:a,event:s});if(u.error)return u}return{...pe}}function rb({drawDefinition:t,stages:e}){if(!t)return{error:Ht};let i=((t==null?void 0:t.structures)??[]).filter(r=>!(e!=null&&e.length)||r.stage&&e.includes(r.stage)),n=Pi(i.map(r=>{let{positionAssignments:a}=Gn({structure:r});return a?a.map(Gi):[]}).flat().filter(Boolean));return{...pe,assignedParticipantIds:n}}function Cd(t){let e=((t==null?void 0:t.entries)??[]).filter(Boolean).reduce((n,r)=>{let{entryStage:a,entryStatus:s}=r,o=`_${a||Bt}${s||""}`;return n[o]||(n[o]=[]),n[o].push(r),n},{}),i=n=>isNaN(n)?1/0:n;return Object.keys(e).map(n=>e[n].sort((r,a)=>i(r.entryPosition)-i(a.entryPosition)).map((r,a)=>{let s=a+1;return{...r,entryPosition:s}})).flat()}function Pv(t){return[tb,ou].includes(t)}function Y_({autoEntryPositions:t=!0,ignoreAssignment:e,tournamentRecord:i,drawDefinition:n,participantIds:r,entryStatus:a,entryStage:s,extension:o,eventSync:l,drawId:c,stage:u,event:d}){var p,h,f,m,g,v,y,b,I,T,w,S;if(!r||!Array.isArray(r))return{error:xd,method:"modifyEntriesStatus",participantIds:r};if(!n&&!d)return{error:Qn};if(a&&!tbe.includes(a))return{error:$j};if(s&&!BL.includes(s))return{error:Ky};let U="modifyEntriesStatus",P=[];if(!a&&!o)return fe({result:{error:si},info:"Missing entryStatus",stack:U});if(o&&!Op({extension:o,requiredAttributes:["name"]}))return fe({result:{error:Ae},info:"Invalid extension",context:{extension:o},stack:U});let E=[];(p=d==null?void 0:d.drawDefinitions)==null||p.forEach(V=>{let j=rb({stages:u&&[u],drawDefinition:V}).assignedParticipantIds??[];E.push(...j)});let R=(i==null?void 0:i.participants)??[];if(!r.every(V=>{var j;let B=(j=Ig({tournamentParticipants:R,participantId:V}))==null?void 0:j.participantType;return!(B&&[Ai,$o].includes(B)&&Pv(a))&&!(a&&d!=null&&d.eventType&&B===Hi&&[Yc,Fl].includes(d.eventType)&&[Bu,...sA].includes(a))}))return{error:$j};let C=d&&kr({event:d}).flightProfile,M=(h=C==null?void 0:C.flights)==null?void 0:h.find(V=>V.drawId===c),_=V=>{let j=(V||[]).filter(z=>!u||!z.entryStage||u===z.entryStage).filter(({participantId:z})=>r.includes(z)),B=z=>a&&E.includes(z.participantId)&&!(sA.includes(z.entryStatus)&&sA.includes(a));return j.every(z=>B(z)&&!e?!1:(a&&(z.entryStatus=a,delete z.entryPosition),s&&(z.entryStage=s,delete z.entryPosition),o&&(o.value?pn({element:z,extension:o}):uo({element:z,name:o.name})),!0))?{...pe}:{error:xU}},A=({flight:V,drawDefinition:j})=>{d&&(d.entries=Cd({entries:d.entries??[]})),V&&(V.drawEntries=Cd({entries:V.drawEntries})),j&&(j.entries=Cd({entries:j.entries}))},N=V=>{let{flight:j,drawDefinition:B}=V,z="updateDrawEntries";if(j){let W=_(j.drawEntries);if(W.error)return fe({result:W,stack:z})}if(B){let W=_(B.entries);if(W.error)return fe({result:W,stack:z});P.includes(B.drawId)||P.push(B.drawId)}return{...pe}},k=((f=d==null?void 0:d.entries)==null?void 0:f.find(({entryPosition:V})=>V))??(((m=M==null?void 0:M.drawEntries)==null?void 0:m.find(({entryPosition:V})=>V))||((g=n==null?void 0:n.entries)==null?void 0:g.find(({entryPosition:V})=>V)));if(t&&!k&&A({flight:M,drawDefinition:n}),M||n){let V=N({flight:M,drawDefinition:n});if(V.error)return fe({result:V,stack:U})}let O=((v=d==null?void 0:d.drawDefinitions)==null?void 0:v.map(({drawId:V})=>V))??[],$=((y=C==null?void 0:C.flights)==null?void 0:y.filter(V=>!O.includes(V.drawId)))||[];for(let V of $){let j=V&&N({flight:V});if(j!=null&&j.error)return fe({result:j,stack:U})}let F=((b=C==null?void 0:C.flights)==null?void 0:b.length)===1&&(((I=d==null?void 0:d.drawDefinitions)==null?void 0:I.length)??0)<=((T=C==null?void 0:C.flights)==null?void 0:T.length);if(!M&&!n&&a&&ebe.includes(a))return{error:xge};if(!M&&!n||a===Wh||l&&F){let V=_(d==null?void 0:d.entries);if(V!=null&&V.error)return fe({result:V,stack:U});let j;if(a===Wh&&((w=C==null?void 0:C.flights)==null||w.every(B=>{let z=_(B.drawEntries);return z.error?(j=z.error,!1):(B.drawEntries=B.drawEntries.filter(({participantId:W})=>!r.includes(W)),!0)}),(S=d==null?void 0:d.drawDefinitions)==null||S.every(B=>{var z;let W=_(B.entries);return W.error?(j=W.error,!1):(B.entries=(z=B.entries)==null?void 0:z.filter(({participantId:Z})=>!r.includes(Z)),!0)})),j)return fe({result:{error:j},stack:U})}t&&A({flight:M,drawDefinition:n});for(let V of(d==null?void 0:d.drawDefinitions)??[])P.length&&!P.includes(V.drawId)||zn({tournamentId:i.tournamentId,eventId:d==null?void 0:d.eventId,drawDefinition:V});return{...pe}}function Rh({requireTimeStamp:t,scaleAttributes:e,participant:i}){var n,r;if(!i)return{error:bw};if(!tn(e))return{error:Ae};if(i.timeItems||(i.timeItems=[]),Array.isArray(i.timeItems)){let{accessor:a,scaleType:s,eventType:o,scaleName:l}=e,c=[vy,s,o,l].join("."),u=i.timeItems.filter(d=>(d==null?void 0:d.itemType)===c).filter(d=>!t||(d==null?void 0:d.itemDate)).sort((d,p)=>(d.createdAt?new Date(d.createdAt).getTime():0)-(p.createdAt?new Date(p.createdAt).getTime():0)).pop();if(u){let[d,p,h,f]=((n=u.itemType)==null?void 0:n.split("."))??[];if(d!==vy)return{error:wI};let m=((r=a&&Kb({element:u.itemValue,accessor:a}))==null?void 0:r.value)||u.itemValue,g={eventType:h,scaleDate:u.itemDate,scaleValue:m,scaleName:f,scaleType:p};return{...pe,scaleItem:g}}}return{...pe,scaleItem:void 0}}function iWe({publishedSeeding:t,usePublishState:e,withSeeding:i,participant:n,event:r}){var a,s,o;let l={},c=h=>[vy,Ph,r.eventType,h].join("."),u=Object.assign({},...(n.timeItems||[]).filter(({itemType:h})=>h.split(".")[1]===Ph).map(({itemType:h,itemValue:f})=>({[h]:f}))),d=((t==null?void 0:t.stageSeedingScaleNames)&&Object.values(t==null?void 0:t.stageSeedingScaleNames)||Array.isArray(t==null?void 0:t.seedingScaleNames)&&t.seedingScaleNames||[]).map(c),p=Ar(Object.keys(u),d);if((!e||!Object.keys(u).length&&!((a=t==null?void 0:t.drawIds)!=null&&a.length)||p.length)&&p.length){if(t!=null&&t.stageSeedingScaleNames){let h=Object.keys(t.stageSeedingScaleNames).map(m=>{let g=c(t.stageSeedingScaleNames[m]),v=u[g];return[m,v]}).filter(m=>m[1]).map(m=>({[m[0]]:{seedValue:m[1]}})),f=Object.assign({},...h);l.seedAssignments=f}else if(p){let h=p.map(f=>u[f]);l.seedValue=h.pop()}}else if(!e&&typeof i=="object"){let h=Object.keys(i).map(m=>{let g=c(i[m]),v=u[g];return[m,v]}).filter(m=>m[1]).map(m=>({[m[0]]:{seedValue:m[1]}})),f=Object.assign({},...h);l.seedAssignments=f}else{let{categoryName:h,ageCategoryCode:f}=r.category||{},m=[f,r.eventId,h].filter(Boolean),g;for(let v of m){let y={eventType:r.eventType,scaleType:Ph,scaleName:v},b=Rh({scaleAttributes:y,participant:n});if(b.scaleItem){g=b.scaleItem;break}}if(g&&(!e||t!=null&&t.published&&!((o=(s=t==null?void 0:t.published)==null?void 0:s.drawIds)!=null&&o.length))){let v=g.scaleValue;l.seedValue=v}}return l}function nWe({convertExtensions:t,seedAssignments:e,participant:i,withSeeding:n,seedValue:r,eventId:a,ranking:s,entry:o}){let{entryStatus:l,entryStage:c,entryPosition:u,extensions:d}=o,p=d!=null&&d.length&&t?Object.assign({},...v6(d??[])):{},h=Object.assign(p,{entryPosition:u,entryStatus:l,entryStage:c,ranking:s,eventId:a});i.events[a]=Zt(h,!1,!1,!0),n&&(e&&(i.events[a].seedAssignments=e),r&&(i.events[a].seedValue=r))}function Cbe(t){let{participantMap:e,participantId:i,matchUpStatus:n,roundPosition:r,structureId:a,matchUpType:s,roundNumber:o,matchUpId:l,potential:c,schedule:u,drawId:d,score:p}=t;!u||!Object.keys(u).length||n===gn||e[i].scheduleItems.push({...u,scheduledDate:Mi(u==null?void 0:u.scheduledDate),scheduledTime:sr(u==null?void 0:u.scheduledTime),checkScoreHasValue:ya({score:p}),matchUpStatus:n,roundPosition:r,structureId:a,matchUpType:s,roundNumber:o,matchUpId:l,potential:c,drawId:d})}function LR(t){var e,i,n;let r=ei(t,[{[Ia]:!0}]);if(r.error)return r;let{tournamentRecord:a,status:s=vc}=t,o=`${tv}.${iv}`;return $t((n=(i=(e=lF({tournamentRecord:a,itemType:o}))==null?void 0:e.timeItem)==null?void 0:i.itemValue)==null?void 0:n[s],!1,!0)}function rWe(t){let{tournamentId:e}=t??{};return!!e}function cu({event:t,status:e=vc}){var i,n,r;let a=`${tv}.${iv}`;return(r=(n=(i=wR({itemType:a,event:t}))==null?void 0:i.timeItem)==null?void 0:n.itemValue)==null?void 0:r[e]}function y8({drawDetails:t,drawId:e}){var i,n;return(n=(i=t==null?void 0:t[e])==null?void 0:i.publishingDetail)==null?void 0:n.published}function xw(t){var e,i,n,r,a,s,o,l,c;let{tournamentRecord:u,drawDefinition:d,eventIds:p,eventId:h,drawIds:f,drawId:m,event:g}=t??{};if(u&&!rWe(u))return{error:Ae};if(h&&!g)return{error:Wc};if(Array.isArray(p)&&p!=null&&p.length){let I={};for(let T of p){if(!ur(T))return{error:Ae};let w=(e=zo({tournamentRecord:u,eventId:T}))==null?void 0:e.event;if(!w)return{error:Wc};let S=q$({event:w});I[T]=S}return{...pe,publishState:I}}if(g){let I=q$({event:g}),T={};if(m)return d?{publishState:{status:{published:!!((i=I.status.publishedDrawIds)!=null&&i.includes(m)),drawDetail:(n=I.status.drawDetails)==null?void 0:n[m]},...pe}}:{error:sc};if(Array.isArray(f)&&f!=null&&f.length){let w=((r=g.drawDefinitions)==null?void 0:r.map(WE))??[];for(let S of f){if(!ur(S))return{error:Ae};if(!w.includes(S))return{error:sc};T[S]={status:{published:!!I.status.publishedDrawIds.includes(S),drawDetail:(a=I.status.drawDetails)==null?void 0:a[S]}}}}else T=I;return{...pe,publishState:T}}let v=[],y=!1,b={};for(let I of(u==null?void 0:u.events)??[]){let T=q$({event:I});b[I.eventId]=T,T.status.published&&(v.push(I.eventId),y=!0);for(let{drawId:w}of I.drawDefinitions??[]){let S=(o=(s=T.status)==null?void 0:s.publishedDrawIds)==null?void 0:o.includes(w);S&&(b[w]={status:{published:S}})}}if(u){let I=LR({tournamentRecord:u});b.tournament=I??{},((l=I==null?void 0:I.orderOfPlay)!=null&&l.published||(c=I==null?void 0:I.participants)!=null&&c.published)&&(y=!0),b.tournament.status={published:y,publishedEventIds:v}}return{...pe,publishState:b}}function q$({event:t}){var e;let i=cu({event:t});if(!i)return{status:{published:!1}};let n={published:void 0,seedingScaleNames:[],drawIds:[]};i.seeding&&Object.assign(n,i.seeding);let r=i.drawDetails??{};for(let l of((e=t.drawDefinitions)==null?void 0:e.map(WE))||[])r[l]||(r[l]={publishingDetail:{published:!1}});let a=r&&Object.keys(r).length&&Object.keys(r).filter(l=>y8({drawDetails:r,drawId:l})),s=a!=null&&a.length?a:i.drawIds??[];if(s!=null&&s.length&&!(a!=null&&a.length))for(let l of s)r[l]={publishingDetail:{published:!0}};let o=(s==null?void 0:s.length)>0;return{status:{publishedDrawIds:s,publishedSeeding:n,drawDetails:r,published:o}}}function vF(t,e){return(t||"").localeCompare(e||"")}function aWe({finishingPositionRange:t={},participantMap:e,finishingRound:i,participantWon:n,matchUpStatus:r,participantId:a,stageSequence:s,roundNumber:o,structureId:l,matchUpId:c,drawId:u,stage:d}){let p=e[a],h=y=>Math.abs(y[0]-y[1]);p.structureParticipation[l]||(p.structureParticipation[l]={rankingStage:d,walkoverWinCount:0,defaultWinCount:0,stageSequence:s,winCount:0,structureId:l,drawId:u});let f=p.structureParticipation[l],{winner:m,loser:g}=t,v=n?m:g;n&&(f.winCount+=1,r===un&&(f.walkoverWinCount+=1),r===Ki&&(f.defaultWinCount+=1)),v&&(!f.finishingPositionRange||h(v)<h(f.finishingPositionRange))&&(f.finishingPositionRange=v),i&&((!f.finishingRound||i<f.finishingRound)&&(f.finishingMatchUpId=c,f.finishingRound=i,f.roundNumber=o),i===1&&(f.participantWon=n))}function ZX(t){var e,i,n,r,a,s,o,l,c,u;let{withScheduleItems:d,scheduleAnalysis:p,withTeamMatchUps:h,participantMap:f,withOpponents:m,withMatchUps:g,withEvents:v,withDraws:y,finishingPositionRange:b,finishingRound:I,matchUpStatus:T,stageSequence:w,roundNumber:S,structureId:U,score:P,stage:E,withRankingProfile:R,tieWinningSide:C,roundPosition:M,matchUpTieId:_,matchUpSides:A,collectionId:N,matchUpType:k,winningSide:O,matchUpId:$,schedule:F,eventId:V,drawId:j,sides:B}=t,z=m&&(B==null?void 0:B.length)===2&&Object.assign({},...B.map(({sideNumber:W},Z)=>{let K=B[1-Z].participantId;return W&&{[W]:K}}).filter(Boolean));for(let W of B){let{participantId:Z,sideNumber:K,bye:Q}=W;if(Q)continue;let J=O===K,se=oe=>{var te,le;let ne=(te=f[oe])==null?void 0:te.participant,me=ne==null?void 0:ne.participantType,be=[{participantId:oe,participantType:me}];if(me!==$o)for(let Se of(ne==null?void 0:ne.individualParticipantIds)||[]){let we=(le=f[Se])==null?void 0:le.participant;be.push({participantType:we==null?void 0:we.participantType,participantId:Se})}return be},ie=(oe,te)=>{if(g){if(f[oe].matchUps[$]={participantWon:J,matchUpType:k,structureId:U,sideNumber:K,matchUpId:$,eventId:V,drawId:j,stage:E},m){let le=se(te);f[oe].matchUps[$].opponentParticipantInfo=le}N&&(f[oe].matchUps[$].collectionId=N)}m&&te&&(f[oe].opponents[te]={participantId:te,matchUpId:$,eventId:V,drawId:j}),R&&aWe({finishingPositionRange:b,participantMap:f,participantWon:J,finishingRound:I,matchUpStatus:T,participantId:oe,stageSequence:w,roundNumber:S,structureId:U,matchUpId:$,drawId:j,stage:E}),(p||d)&&Cbe({participantMap:f,participantId:oe,matchUpStatus:T,roundPosition:M,matchUpType:k,roundNumber:S,structureId:U,matchUpId:$,schedule:F,drawId:j,score:P})},ce=({participant:oe,partnerParticipantId:te})=>{var le,ne,me;let be=(Se,we)=>{Se&&(Se.partnerParticipantIds||(Se.partnerParticipantIds=[]),Se.partnerParticipantIds.includes(we)||Se.partnerParticipantIds.push(we))};y&&be((le=oe==null?void 0:oe.draws)==null?void 0:le[j],te),v&&be((ne=oe==null?void 0:oe.events)==null?void 0:ne[V],te),g&&be((me=oe==null?void 0:oe.matchUps)==null?void 0:me[$],te)};if(Z&&f[Z]){let oe=z==null?void 0:z[K];ie(Z,oe);let te=((e=f[Z])==null?void 0:e.participant.participantType)===Ai,le=((i=f[Z])==null?void 0:i.participant.individualParticipantIds)||[];if(_){if(h){let ne=me=>f[me].matchUps[_]={participantWon:C===K,matchUpId:_,matchUpType:Xn,sideNumber:K};ne(Z),le.forEach(ne)}if(y&&!f[Z].draws[j]){let ne=(r=(n=A.find(Se=>Se.sideNumber===K))==null?void 0:n.participant)==null?void 0:r.participantId,me=(o=(s=(a=f[ne])==null?void 0:a.draws)==null?void 0:s[j])==null?void 0:o.entryStatus,be=Se=>f[Se].draws[j]={entryStatus:me,eventId:V,drawId:j};be(Z),le.forEach(be)}}if(te&&(le.forEach(ne=>f[ne]&&ie(ne,oe)),le.forEach((ne,me)=>{let be=le[1-me],Se=f[ne];Se&&ce({participant:Se,partnerParticipantId:be})}),v&&A)){let ne=(c=(l=A.find(me=>me.sideNumber===K))==null?void 0:l.participant)==null?void 0:c.participantId;if(ne){let me=(u=f[ne])==null?void 0:u.events[V];me?(f[Z].events[V]={...me},le.forEach(be=>f[be].events[V]={...me})):console.log("Missing teamEntry",{eventId:V,teamParticipantId:ne})}}if(O){let ne=me=>{J?(f[me].counters[k].wins+=1,f[me].counters.wins+=1,T===un&&(f[me].counters[k].walkoverWins+=1,f[me].counters.walkoverWins+=1),T===Ki&&(f[me].counters[k].defaultWins+=1,f[me].counters.defaultWins+=1)):(f[me].counters[k].losses+=1,f[me].counters.losses+=1,T===un&&(f[me].counters[k].walkovers+=1,f[me].counters.walkovers+=1),T===Ki&&(f[me].counters[k].defaults+=1,f[me].counters.defaults+=1))};ne(Z),le.forEach(ne)}}}}function sWe(t){var e,i,n,r,a,s,o;let{participantFilters:l,convertExtensions:c,policyDefinitions:u,tournamentRecord:d,usePublishState:p,contextFilters:h,matchUpFilters:f,participantMap:m,contextProfile:g,withPotentialMatchUps:v,withRankingProfile:y,withScheduleItems:b,scheduleAnalysis:I,withTeamMatchUps:T,withStatistics:w,withOpponents:S,withMatchUps:U,withSeeding:P,withEvents:E,withDraws:R}=t,C=l==null?void 0:l.participantIds,M=j=>{var B,z;let W=[j];return(z=(B=m[j])==null?void 0:B.participant.individualParticipantIds)==null||z.forEach(Z=>W.push(Z)),W.some(Z=>!(C!=null&&C.length)||C.includes(Z))?W:[]},_={withMatchUps:U||y,withEvents:E||y,withDraws:R||y,withPotentialMatchUps:v,withRankingProfile:y,withScheduleItems:b,scheduleAnalysis:I,withTeamMatchUps:T,withStatistics:w,participantMap:m,withOpponents:S,withSeeding:P},A=[],N={},k=[],O={},$={},F={},V=({eventType:j,scaleNames:B,participantId:z})=>{var W,Z,K,Q,J;return(J=(Q=(K=(Z=(W=m[z])==null?void 0:W.participant)==null?void 0:Z.rankings)==null?void 0:K[j])==null?void 0:Q.find(se=>B.includes(se.scaleName)))==null?void 0:J.scaleValue};for(let j of(d==null?void 0:d.events)||[]){if(l!=null&&l.eventIds&&!l.eventIds.includes(j.eventId))continue;let{drawDefinitions:B=[],extensions:z=[],eventType:W,eventName:Z,category:K,entries:Q,eventId:J,gender:se}=j,{flightProfile:ie}=kr({event:j}),ce=(ie==null?void 0:ie.flights)??[],oe=xw({event:j}).publishState;oe&&(O[J]=oe);let te=(e=oe==null?void 0:oe.status)==null?void 0:e.publishedSeeding;if(E||P||y){let ne=c?Object.assign({},...v6(z??[])):{};$[J]={...ne,eventName:Z,eventType:W,category:K,eventId:J,gender:se};let me=[K==null?void 0:K.categoryName,K==null?void 0:K.ageCategoryCode].filter(Boolean);for(let be of Q){let{participantId:Se}=be;if(!Se||!m[Se])continue;let we=V({eventType:W,scaleNames:me,participantId:Se}),ze,Qe;if(P){let yt=m[Se].participant;({seedAssignments:ze,seedValue:Qe}=iWe({publishedSeeding:te,usePublishState:p,withSeeding:P,participant:yt,event:j}))}let ke=yt=>{var lt,Ct;if((Ct=(lt=m[yt])==null?void 0:lt.events)!=null&&Ct[J])return;let Nt=m[yt];nWe({convertExtensions:c,seedAssignments:ze,participant:Nt,withSeeding:P,seedValue:Qe,eventId:J,ranking:we,entry:be})};ke(Se),(m[Se].participant.individualParticipantIds||[]).forEach(ke)}}let le=(i=O==null?void 0:O[J])==null?void 0:i.publishedSeeding;if(R||y||P){let ne=be=>be?Object.assign({},...be.map(({participantId:Se,seedValue:we,seedNumber:ze})=>({[Se]:{seedValue:we,seedNumber:ze}}))):void 0,me=Pi([...B.map(WE),...ce.map(WE)]);for(let be of me){let Se=B.find(Oe=>Oe.drawId===be),we=[K==null?void 0:K.categoryName,K==null?void 0:K.ageCategoryCode].filter(Boolean),{structures:ze=[],drawOrder:Qe,drawName:ke,drawType:yt}=Se??{},lt=ce==null?void 0:ce.find(Oe=>Oe.drawId===be),Ct=(Se==null?void 0:Se.entries)||(lt==null?void 0:lt.drawEntries),Nt=lt==null?void 0:lt.flightNumber,Ce=((Se==null?void 0:Se.structures)||[]).sort((Oe,Ee)=>Ew(Oe,Ee)).map(({structureId:Oe,structures:Ee})=>[Oe,...(Ee||[]).map(({structureId:Xe})=>Xe)]).flat(1/0),Ge,$e,at,ct,Vt=0,Me=ze.filter(({stage:Oe,stageSequence:Ee})=>Oe===Bt&&Ee===1||Oe===ri).flatMap(Oe=>{let{positionAssignments:Ee}=Gn({structure:Oe}),{seedAssignments:Xe,stageSequence:Et,stage:Fe}=Oe;return Fe===Bt?(Vt=(Ee==null?void 0:Ee.length)??0,at=Ee,ct=Xe):Et===1&&(Ge=Ee,$e=Xe),Ee}).map(({participantId:Oe})=>Oe).filter(Boolean),De=ne(ct),Je=ne($e),St=Se?Ct.filter(({participantId:Oe})=>Me.includes(Oe)):Ct,bt=!p||(le==null?void 0:le.published)&&(((n=le==null?void 0:le.drawIds)==null?void 0:n.length)===0||((r=le==null?void 0:le.drawIds)==null?void 0:r.includes(be)));for(let Oe of St){if(!m[Oe.participantId])continue;let{entryStatus:Ee,entryStage:Xe,entryPosition:Et,participantId:Fe}=Oe,ht=V({participantId:Fe,scaleNames:we,eventType:W}),ti=Ke=>{var zt,mt,Tt,Ut,zi;if(!m[Ke]||(zt=m[Ke].draws)!=null&&zt[be])return;let gi=P&&bt,Dt=gi?{}:void 0,Ui=gi?((mt=De==null?void 0:De[Fe])==null?void 0:mt.seedValue)||((Tt=De==null?void 0:De[Fe])==null?void 0:Tt.seedNumber):void 0,Cr=Ui?De==null?void 0:De[Fe]:void 0,nn=gi?((Ut=Je==null?void 0:Je[Fe])==null?void 0:Ut.seedValue)||((zi=Je==null?void 0:Je[Fe])==null?void 0:zi.seedNumber):void 0,tr=nn?Je==null?void 0:Je[Fe]:void 0;Dt&&Ui&&(Dt[Bt]=Cr),Dt&&nn&&(Dt[ri]=tr);let lr=Ui||nn;lr&&(m[Ke].participant.seedings[W]||(m[Ke].participant.seedings[W]=[]),Cr&&m[Ke].participant.seedings[W].push({...Cr,scaleName:be}),tr&&m[Ke].participant.seedings[W].push({...tr,scaleName:be}),Dt&&(m[Ke].events[J].seedAssignments||(m[Ke].events[J].seedAssignments={}),Object.keys(Dt).forEach(Xa=>m[Ke].events[J].seedAssignments[Xa]=Dt[Xa]))),(R||y)&&(m[Ke].draws[be]=Zt({seedAssignments:Dt,entryPosition:Et,entryStatus:Ee,entryStage:Xe,seedValue:lr,eventId:J,ranking:ht,drawId:be},!1,!1,!0))};[ou,tb].includes(Ee)||(ti(Fe),(a=m[Fe].participant.individualParticipantIds||[])==null||a.forEach(ti))}let Ie=((Se==null?void 0:Se.structures)??[]).reduce((Oe,Ee)=>(Oe.includes(Ee.stage)||Oe.push(Ee.stage),Oe),[]),Ue=((Se==null?void 0:Se.links)??[]).length;F[be]={qualifyingPositionAssignments:Ge,qualifyingSeedAssignments:$e,mainPositionAssignments:at,qualifyingSeedingMap:Je,mainSeedAssignments:ct,orderedStructureIds:Ce,mainSeedingMap:De,flightNumber:Nt,linksCount:Ue,drawOrder:Qe,drawName:ke,drawType:yt,drawSize:Vt,drawId:be,stages:Ie}}}if(y||I||T||w||S||U||R){let ne=!!I||v,me=((s=nf({afterRecoveryTimes:!!I,policyDefinitions:u,tournamentRecord:d,inContext:!0,participantMap:m,contextFilters:h,matchUpFilters:f,contextProfile:g,nextMatchUps:ne,event:j}))==null?void 0:s.matchUps)??[];for(let be of me){let{finishingPositionRange:Se,potentialParticipants:we,tieMatchUps:ze=[],sides:Qe=[],winningSide:ke,matchUpType:yt,matchUpId:lt,eventId:Ct,drawId:Nt,collectionId:Ce,stageSequence:Ge,finishingRound:$e,matchUpStatus:at,roundPosition:ct,roundNumber:Vt,structureId:Me,schedule:De,score:Je,stage:St}=be;N[lt]=be;let bt={finishingPositionRange:Se,finishingRound:$e,stageSequence:Ge,roundPosition:ct,collectionId:Ce,roundNumber:Vt,structureId:Me,schedule:De,eventId:Ct,drawId:Nt,score:Je,stage:St};ZX({...bt,..._,matchUpStatus:at,winningSide:ke,matchUpType:yt,matchUpId:lt,sides:Qe});for(let Ie of ze){let{winningSide:Ue,sides:Oe=[],matchUpId:Ee,matchUpStatus:Xe,matchUpType:Et}=Ie;ZX({...bt,..._,winningSide:Ue,tieWinningSide:ke,matchUpTieId:lt,matchUpId:Ee,sides:Oe,matchUpSides:Qe,matchUpStatus:Xe,matchUpType:Et})}Array.isArray(we)&&(ne||I||b)&&((o=we.flat().map(Gi).filter(Boolean))==null||o.forEach(Ie=>{var Ue;(Ue=M(Ie))==null||Ue.forEach(Oe=>{m[Oe]&&(m[Oe].potentialMatchUps[lt]=Zt({tournamentId:d==null?void 0:d.tournamentId,matchUpId:lt,eventId:Ct,drawId:Nt}))}),(I||b)&&Cbe({potential:!0,participantMap:m,participantId:Ie,matchUpStatus:at,roundPosition:ct,structureId:Me,matchUpType:yt,roundNumber:Vt,matchUpId:lt,schedule:De,drawId:Nt,score:Je})}))}k.push(...me)}}if(w||y||I){let j=Object.values(m);for(let B of j){let{wins:z,losses:W,[On]:{wins:Z,losses:K},[Nn]:{wins:Q,losses:J}}=B.counters,se=(ie,ce,oe)=>{let te=ce+oe,le=ce,ne=te&&le/te;B.statistics[ie]={denominator:te,numerator:le,statValue:ne,statCode:ie}};if(w&&(se(aA,z,W),se(`${aA}.${On}`,Z,K),se(`${aA}.${Nn}`,Q,J)),y){let ie=(ce=[])=>Math.abs(ce[0]-ce[1]);for(let ce of Object.keys(B.draws)){let{orderedStructureIds:oe=[],flightNumber:te}=F[ce]||{};if(B.structureParticipation&&oe.length){let le,ne=0,me=oe.map(be=>{let Se=B.structureParticipation[be];if(!Se)return;le||(le=Se==null?void 0:Se.finishingPositionRange),ie(le)>ie(Se==null?void 0:Se.finishingPositionRange)&&(le=Se==null?void 0:Se.finishingPositionRange);let we=Se.stage!==ri;return we&&(ne+=1),Zt({...Se,participationOrder:we?ne:void 0,flightNumber:te})}).filter(Boolean);B.draws[ce]&&(B.draws[ce].finishingPositionRange=le,B.draws[ce].structureParticipation=me)}}}if(I){let ie=tn(I)?I.scheduledMinutesDifference:0,ce=B.scheduleItems||[],oe=B.potentialMatchUps||{},te=ce.reduce((ne,me)=>{let{scheduledDate:be,scheduledTime:Se}=me;return ne[be]||(ne[be]=[]),Se&&ne[be].push(me),ne},{});Object.values(te).forEach(ne=>ne.sort(bve));for(let ne of ce){let{typeChangeTimeAfterRecovery:me,timeAfterRecovery:be,scheduledDate:Se,scheduledTime:we}=ne,ze=te[Se],Qe=sn(we);for(let ke of ze){if(ke.matchUpId===ne.matchUpId||[un,Ki].includes(ke.matchUpStatus)&&!ke.checkScoreHasValue)continue;let yt=ne.matchUpType!==ke.matchUpType&&me||be,lt=ne.drawId===ke.drawId,Ct=oe[ne.matchUpId]&&oe[ke.matchUpId],Nt=sn(ke.scheduledTime),Ce=Math.abs(Nt-Qe),Ge=Nt>=Qe;if((ie&&!isNaN(ie)?Ce<=ie:Ge&&sn(ke.scheduledTime)<sn(yt))&&!(Ct&&lt)&&Ge){let $e=[ne.matchUpId,ke.matchUpId].sort(vF).join("|");B.scheduleConflicts[$e]={priorScheduledMatchUpId:ne.matchUpId,matchUpIdWithConflict:ke.matchUpId}}}}let le=B.participant.participantId;Object.keys(B.scheduleConflicts).length&&A.push(le),m[le].scheduleConflicts=B.scheduleConflicts}}}return{participantIdsWithConflicts:A,eventsPublishStatuses:O,derivedEventInfo:$,derivedDrawInfo:F,mappedMatchUps:N,participantMap:m,matchUps:k}}function FR({participantFilters:t={},tournamentRecord:e,participants:i=[]}){var n;if(!Object.keys(t).length)return i;let{accessorValues:r,drawEntryStatuses:a,positionedParticipants:s,eventEntryStatuses:o,participantRoles:l,participantRoleResponsibilities:c,participantTypes:u,participantIds:d,signInStatus:p,enableOrFiltering:h,eventIds:f,genders:m}=t,g=rh(f)&&((n=e==null?void 0:e.events)==null?void 0:n.filter(T=>f==null?void 0:f.includes(T.eventId)))||(e==null?void 0:e.events)||[],v=a&&oWe({drawEntryStatuses:a,tournamentEvents:g}),y=o&&lWe({eventEntryStatuses:o,tournamentEvents:g}),b=s!==void 0&&[!0,!1].includes(s)&&g.reduce((T,w)=>T.concat(...(w.drawDefinitions||[]).map(S=>$ye({drawDefinition:S}).allPositionedParticipantIds).filter(Boolean)),[]),I=T=>r==null?void 0:r.reduce((w,S)=>{let{accessor:U,value:P}=S,{values:E}=Kb({element:T,accessor:U});return w&&(E==null?void 0:E.includes(P))},!0);if(i=i==null?void 0:i.filter(T=>{var w,S;let U=(S=(w=su({element:T,itemType:IR}))==null?void 0:w.timeItem)==null?void 0:S.itemValue,{participantRoleResponsibilities:P,participantType:E,participantRole:R,participantId:C,person:M}=T,_=Array.isArray(m)&&(m==null?void 0:m.length)&&(M==null?void 0:M.sex)&&m.includes(M.sex);return h?m&&_||s&&b.includes(C)||s===!1&&!b.includes(C)||(v==null?void 0:v.includes(C))||(y==null?void 0:y.includes(C))||(d==null?void 0:d.includes(C))||p&&U===p||u&&E&&rh(u)&&u.includes(E)||l&&R&&rh(l)&&l.includes(R)||c&&rh(P)&&rh(c)&&c.find(A=>P==null?void 0:P.includes(A))||(r==null?void 0:r.length)&&rh(r)&&I(T):(!m||_)&&(s===void 0||s&&b.includes(C)||s===!1&&!b.includes(C))&&(!v||v.includes(C))&&(!y||y.includes(C))&&(!d||d.includes(C))&&(!p||U===p)&&(!u||E&&rh(u)&&u.includes(E))&&(!l||R&&rh(l)&&l.includes(R))&&(!c||rh(P)&&rh(c)&&c.find(A=>P==null?void 0:P.includes(A)))&&(!(r!=null&&r.length)||rh(r)&&I(T))}),g.length&&f){let T=g.filter(w=>f.includes(w.eventId)).map(w=>{let S=(w.entries||[]).map(P=>P.participantId);if(Br(kp)(w.eventType))return S;let U=((e==null?void 0:e.participants)??[]).filter(P=>S.includes(P.participantId)).map(P=>P.individualParticipantIds).flat(1);return S.concat(...U)}).flat(1);i=i==null?void 0:i.filter(w=>T.includes(w.participantId))}return i}function rh(t){return t&&Array.isArray(t)&&t.length}function oWe({drawEntryStatuses:t,tournamentEvents:e}){let i=({entryStatus:n})=>Array.isArray(t)?t.includes(n):!0;return Pi(e.reduce((n,r)=>{var a,s;let{flightProfile:o}=kr({event:r}),l=((a=o==null?void 0:o.flights)==null?void 0:a.map(({drawEntries:u})=>Array.isArray(u)?u.filter(i).map(Gi):[]).flat())||[],c=((s=r.drawDefinitions)==null?void 0:s.map(({entries:u})=>u?u.filter(i).map(Gi):[]))||[];return n.concat(...l,...c)},[]))}function lWe({eventEntryStatuses:t,tournamentEvents:e}){return Pi(e.reduce((i,n)=>{let r=(n.entries||[]).filter(({entryStatus:a})=>Array.isArray(t)?t.includes(a):!0).map(Gi);return i.concat(...r)},[]))}function br(t){var e;let{withIndividualParticipants:i,participantFilters:n={},withPotentialMatchUps:r,withRankingProfile:a,convertExtensions:s,policyDefinitions:o,withScheduleItems:l,tournamentRecord:c,scheduleAnalysis:u,withSignInStatus:d,withTeamMatchUps:p,withScaleValues:h,usePublishState:f,withStatistics:m,contextFilters:g,matchUpFilters:v,contextProfile:y,withOpponents:b,withMatchUps:I,internalUse:T,withSeeding:w,withEvents:S,withDraws:U,withISO2:P,withIOC:E}=t;if(!c)return{error:dt};(I||a)&&od({tournamentRecord:c});let R=Jye({convertExtensions:s,tournamentRecord:c,withSignInStatus:d,withScaleValues:h,internalUse:T,withISO2:P,withIOC:E}),{participantMap:C}=R,M=sWe({withMatchUps:I??a,withEvents:S??a,withDraws:U??a,withPotentialMatchUps:r,participantFilters:n,withRankingProfile:a,convertExtensions:s,withScheduleItems:l,policyDefinitions:o,tournamentRecord:c,scheduleAnalysis:u,withTeamMatchUps:p,usePublishState:f,withStatistics:m,contextFilters:g,matchUpFilters:v,participantMap:C,withOpponents:b,contextProfile:y,withSeeding:w}),{participantIdsWithConflicts:_,eventsPublishStatuses:A,derivedEventInfo:N,derivedDrawInfo:k,mappedMatchUps:O}=M,$=M.matchUps;C=M.participantMap;let F=u??r,V=({potentialMatchUps:K,scheduleConflicts:Q,scheduleItems:J,participant:se,statistics:ie,opponents:ce,matchUps:oe,events:te,draws:le})=>{let ne=Object.values(le),me=Object.values(ce);return b&&(ne==null||ne.forEach(be=>{be.opponents=me.filter(Se=>Se.drawId===be.drawId)})),Zt({...se,scheduleConflicts:u?Object.values(Q):void 0,draws:U||a?ne:void 0,events:S||a?Object.values(te):void 0,matchUps:I||a?Object.values(oe):void 0,opponents:b?me:void 0,potentialMatchUps:F?Object.values(K):void 0,statistics:m?Object.values(ie):void 0,scheduleItems:l?J:void 0},!1,!1,!0)},j=new Map;for(let K of Object.keys(C))j.set(K,V(C[K]));let B=[...j.values()],z=(e=o==null?void 0:o[jU])==null?void 0:e.participant,W=FR({participants:B,participantFilters:n,tournamentRecord:c});if(i){let K=tn(i)?i:void 0;for(let Q of W)for(let J of Q.individualParticipantIds??[]){Q.individualParticipants||(Q.individualParticipants=[]);let se=j.get(J),ie=K?DI({template:K,source:se}):se;Q.individualParticipants.push(ie)}}let Z=z?W.map(K=>DI({source:K,template:z})):W;return{participantMap:t.returnParticipantMap!==!1?C:void 0,mappedMatchUps:t.returnMatchUps!==!1?O:void 0,matchUps:t.returnMatchUps!==!1?$:void 0,missingParticipantIds:R.missingParticipantIds,participantIdsWithConflicts:_,eventsPublishStatuses:A,derivedEventInfo:N,derivedDrawInfo:k,participants:Z,...pe}}function Zb({participantId:t,drawDefinition:e,entryStatus:i,entryStage:n}){var r;if(!e)return{error:Ht};let a=(r=e.entries)==null?void 0:r.find(s=>s.participantId===t&&(!i||i===s.entryStatus)&&(!n||n===s.entryStage));return t&&a}function YU(t){var e,i,n,r,a,s,o,l,c;let{provisionalPositioning:u,drawDefinition:d,stageSequence:p,structureId:h,stage:f}=t;if(!d)return{error:Ht};let{entryProfile:m}=TR({drawDefinition:d}),g=f&&p&&((n=(i=(e=m==null?void 0:m[f])==null?void 0:e.stageSequence)==null?void 0:i[p])==null?void 0:n.qualifiersCount)||f&&((r=m==null?void 0:m[f])==null?void 0:r.qualifiersCount)||0,v={};if(!h)return{qualifiersCount:g,roundQualifiersCounts:v};let{structure:y}=fi({drawDefinition:d,structureId:h}),b=(a=d.links)==null?void 0:a.filter(w=>{var S;return((S=w==null?void 0:w.target)==null?void 0:S.structureId)===(y==null?void 0:y.structureId)}),I=0;if(b!=null&&b.length)for(let w of b){let S=(s=fi({structureId:w.source.structureId,drawDefinition:d}))==null?void 0:s.structure;if((S==null?void 0:S.stage)===ri){let U=w.source.roundNumber,P=w.target.roundNumber,E=0;if(S.structureType===Eo){let R=((o=S.structures)==null?void 0:o.length)??0,C=((l=w.source.finishingPositions)==null?void 0:l.length)??0;E=R*C}else E=((c=Sn({matchUpFilters:{roundNumbers:[U]},structure:S,afterRecoveryTimes:!1,provisionalPositioning:u,inContext:!1}).matchUps)==null?void 0:c.length)||0;v[P]||(v[P]=0),v[P]+=E,I+=E}}let T=Object.keys(v);if(T.length<=1){let w=T[0]||1;v[w]=Math.max(v[w]||0,g)}return I=Math.max(I,g),{qualifiersCount:I,roundQualifiersCounts:v}}function K_({stage:t,drawDefinition:e}){var i;let{entryProfile:n}=TR({drawDefinition:e});return((i=n==null?void 0:n[t])==null?void 0:i.drawSize)||0}function cWe(t){let{provisionalPositioning:e,drawDefinition:i,stageSequence:n,stage:r}=t,a=K_({stage:r,drawDefinition:i}),{qualifiersCount:s}=YU({provisionalPositioning:e,drawDefinition:i,stageSequence:n,stage:r});return a&&a-s}function Rbe({stage:t,drawDefinition:e}){return!!(t===ja||o8({stage:t,drawDefinition:e})&&K_({stage:t,drawDefinition:e}))}function Mbe({entryStatus:t=dl,drawDefinition:e,stageSequence:i,stage:n}){if(t===Bu)return t3e({stage:n,drawDefinition:e})?{positionsAvailable:1/0,...pe}:{error:kge};let r=cWe({drawDefinition:e,stageSequence:i,stage:n}),a=i3e({drawDefinition:e,stage:n}),s=Xj({entryStatus:yT,drawDefinition:e,stage:n}),o=Xj({entryStatus:dl,drawDefinition:e,stage:n}),l=s+o,c=l>=r,u=r-l;return n!==ja&&c?{error:Bj}:t===yT?s<a?{...pe}:{error:Bj}:{positionsAvailable:u,...pe}}function b8(t){let e=ei(t,[{[Po]:!0,[fye]:!0}]);if(e.error)return e;let{suppressDuplicateEntries:i=!0,entryStatus:n=dl,entryStageSequence:r,entryStage:a=Bt,ignoreStageSpace:s,drawDefinition:o,entryPosition:l,participant:c,roundTarget:u,extensions:d,extension:p,drawType:h,event:f}=t,m="addDrawEntry";if(h!==lc&&!Rbe({stage:a,drawDefinition:o}))return fe({result:{error:Ky},stack:m});let g=Mbe({stageSequence:r,stage:a,drawDefinition:o,entryStatus:n});if(!s&&!g.success&&(!h||h!==lc))return{error:g.error};if(p&&!Op({extension:p}))return fe({result:{error:Ae},info:"Invalid extension",context:{extension:p},stack:m});let v=t.participantId||(c==null?void 0:c.participantId);if(!v)return fe({result:{error:da},stack:m});let y=n===om&&Zb({participantId:v,drawDefinition:o,entryStatus:n}),b=a===ja&&Zb({participantId:v,drawDefinition:o,entryStage:a}),I=Zb({participantId:v,drawDefinition:o}),T=n!==om&&a!==ja&&I;if(T)return i?(Ti({payload:{drawId:o.drawId,eventId:f==null?void 0:f.eventId,error:AE,participantId:v},topic:G6}),{...pe}):fe({result:{error:AE},context:{participantId:v},stack:m});if(y||b)return fe({context:{invalidEntry:T,invalidLuckyLoser:y,invalidVoluntaryConsolation:b},result:{error:CL},stack:m});let w=Zt({entryStageSequence:r,participantId:v,entryPosition:l,entryStatus:n,entryStage:a,extensions:d});return p&&pn({element:w,extension:p}),u&&pn({extension:{name:"roundEntry",value:u},element:w}),o.entries||(o.entries=[]),o.entries.push(w),zn({drawDefinition:o}),{...pe}}function uWe(t){let e="addDrawEntries",{suppressDuplicateEntries:i=!0,entryStatus:n=dl,autoEntryPositions:r=!0,ignoreStageSpace:a,participantIds:s,drawDefinition:o,stageSequence:l,stage:c=Bt,roundTarget:u,extension:d,event:p}=t;if(!c)return{error:pge};if(!o)return{error:Ht};if(!Array.isArray(s))return{error:Pl};if(!Rbe({stage:c,drawDefinition:o}))return{error:Ky};if(d&&!Op({extension:d}))return fe({result:{error:Ae},info:"Invalid extension",context:{extension:d},stack:e});let h=Mbe({drawDefinition:o,stageSequence:l,entryStatus:n,stage:c});if(!a&&!h.success)return{error:h.error};let f=h.positionsAvailable??0;if(!a&&c!==ja&&f<s.length)return{error:K5};let m=[],g=o.drawId,v=p==null?void 0:p.eventId,y=s.reduce((b,I)=>{let T=n===om&&Zb({participantId:I,drawDefinition:o,entryStatus:n}),w=c===ja&&Zb({entryStage:c,drawDefinition:o,participantId:I}),S=Zb({participantId:I,drawDefinition:o});return n!==om&&c!==ja&&S&&(m.push(I),i&&Ti({payload:{error:AE,participantId:I,eventId:v,drawId:g},topic:G6})),T||w?b.concat(I):b},[]);return m.length&&!i?fe({context:{eventId:v,drawId:g,duplicateEntries:m},result:{error:AE},stack:e}):(s.filter(b=>b&&!y.includes(b)).forEach(b=>{let I={entryStageSequence:l,entryStage:c,participantId:b,entryStatus:n};d&&pn({element:I,extension:d}),u&&pn({extension:{name:Yp,value:u},element:I}),o.entries||(o.entries=[]),o.entries.push(I)}),r&&(o.entries=Cd({entries:o.entries})),zn({drawDefinition:o}),y!=null&&y.length||m!=null&&m.length?{info:"some participantIds could not be added",participantIdsNotAdded:y,duplicateEntries:m,...pe}:{...pe})}function I8({suppressDuplicateEntries:t=!0,autoEntryPositions:e=!0,entryStageSequence:i,ignoreStageSpace:n,participantIds:r,drawDefinition:a,entryStatus:s,roundTarget:o,entryStage:l,extension:c,drawId:u,event:d}){if(!(r!=null&&r.length))return{error:Yg};if(!d)return{error:Wc};if(!u)return{error:jd};let p=(d.entries||[]).map(Gi);if(r.filter(m=>!p.includes(m)).length)return{error:uge};if(a){let m=uWe({stageSequence:i,suppressDuplicateEntries:t,autoEntryPositions:e,stage:l,ignoreStageSpace:n,participantIds:r,drawDefinition:a,entryStatus:s,roundTarget:o,extension:c});if(m.error)return m}let{flightProfile:h}=kr({event:d}),f=h==null?void 0:h.flights.find(m=>m.drawId===u);return f!=null&&f.drawEntries&&(r.forEach(m=>{let g=s===om&&W$({participantId:m,entryStatus:s,flight:f}),v=l===ja&&W$({participantId:m,entryStage:l,flight:f});!(s!==om&&l!==ja&&W$({flight:f,participantId:m}))&&!g&&!v&&f.drawEntries.push({participantId:m,entryStatus:s,entryStage:l})}),e&&(f.drawEntries=Cd({entries:f.drawEntries}))),{...pe}}function W$({participantId:t,entryStatus:e,entryStage:i,flight:n}){var r;let a=(r=n.drawEntries)==null?void 0:r.find(s=>s.participantId===t&&(!e||e===s.entryStatus)&&(!i||i===s.entryStage));return t&&a}function $R({autoEntryPositions:t=!0,participantIds:e=[],entryStatuses:i,stage:n,event:r}){var a,s,o,l;let c="removeEventEntries";if(!(r!=null&&r.eventId))return{error:Qn};if(!Array.isArray(e)||e.some(m=>!ur(m)))return fe({result:{error:xd},stack:c});let u=(r.drawDefinitions??[]).flatMap(m=>rb({drawDefinition:m}).assignedParticipantIds??[]),d=((i==null?void 0:i.length)&&((a=r.entries)==null?void 0:a.filter(m=>m.entryStatus&&i.includes(m.entryStatus)))||[]).map(Gi).filter(m=>!u.includes(m)),p=(n&&((s=r.entries)==null?void 0:s.filter(m=>m.entryStage&&m.entryStage===n))||[]).map(Gi).filter(m=>!u.includes(m));if(e.length?e=e.filter(m=>(!(i!=null&&i.length)||d.includes(m))&&(!n||p.includes(m))):d.length&&p.length?e=Ar(d,p):d.length?e=d:p.length&&(e=p),(e==null?void 0:e.length)&&u.some(m=>e.includes(m)))return fe({result:{error:xU},stack:c});if(!(e!=null&&e.length))return{...pe,participantIdsRemoved:[]};let h=[];r.entries=(r.entries??[]).filter(m=>{let g=!e.includes(m==null?void 0:m.participantId);return g||h.push(m.participantId),g}),t&&(r.entries=Cd({entries:r.entries}));let{flightProfile:f}=kr({event:r});return(o=f==null?void 0:f.flights)==null||o.forEach(m=>{m.drawEntries=(m.drawEntries||[]).filter(g=>!e.includes(g.participantId))}),(l=r.drawDefinitions)==null||l.forEach(m=>{m.entries=(m.entries??[]).filter(g=>!e.includes(g.participantId))}),{...pe,participantIdsRemoved:h}}var Nbe={[Ga]:{policyName:"matchUpActionsDefault",enabledStructures:[{stages:[],stageSequences:[],enabledActions:[],disabledActions:[]}],participants:{enforceCategory:!0,enforceGender:!0},processCodes:{substitution:["RANKING.IGNORE","RATING.IGNORE"]},substituteAfterCompleted:!1,substituteWithoutScore:!1}},KU=Nbe;function Ip(t){var e,i;let{suppressDuplicateEntries:n=!0,entryStatus:r=dl,autoEntryPositions:a=!0,enforceGender:s=!0,entryStageSequence:o,policyDefinitions:l,entryStage:c=Bt,tournamentRecord:u,ignoreStageSpace:d,drawDefinition:p,roundTarget:h,extensions:f,extension:m,drawId:g,event:v}=t,y="addEventEntries";if(!Array.isArray(t.participantIds))return fe({result:{error:Pl},stack:y});let b=Pi(t.participantIds??[]);if(!v)return{error:Qn};if(!(b!=null&&b.length))return fe({result:{error:Yg},stack:y});if(!(v!=null&&v.eventId))return{error:Wc};let I=fn({tournamentRecord:u,event:v}).appliedPolicies??{},T=(l==null?void 0:l[Ga])??(I==null?void 0:I[Ga])??KU[Ga],w=(s??((e=T==null?void 0:T.participants)==null?void 0:e.enforceGender))!==!1,S=[],U=[];if(f&&(!Array.isArray(f)||!f.every(k=>Op({extension:k})))||m&&!Op({extension:m}))return fe({context:Zt({extension:m,extensions:f}),result:{error:Ae},info:"Invalid extension(s)",stack:y});let P=!!u,E=[],R,C=((i=u==null?void 0:u.participants)==null?void 0:i.filter(k=>{var O,$,F;if(!b.includes(k.participantId))return!1;let V=Br(On)(v.eventType)&&k.participantType===Hi&&!Pv(r),j=v.eventType===Nn&&k.participantType===Ai;return V&&(!v.gender||!w||[Fo,Ld].includes(v.gender)||v.gender===((O=k.person)==null?void 0:O.sex))||j&&!Pv(r)||v.eventType===Nn&&k.participantType===Hi&&Pv(r)?!0:V&&v.gender&&w&&![Fo,Ld].includes(v.gender)&&v.gender!==(($=k.person)==null?void 0:$.sex)?(E.push({participantId:k.participantId,sex:(F=k.person)==null?void 0:F.sex}),!1):v.eventType===Pn&&(k.participantType===Pn||Pv(r)&&k.participantType===Hi)}).map(k=>k.participantId))??[],M=b.filter(k=>!P||C.includes(k));v.entries||(v.entries=[]);let _=v.entries.map(k=>{var O;return k.participantId||((O=k.participant)==null?void 0:O.participantId)});if(M.forEach(k=>{var O;if(!_.includes(k)){let $=Zt({participantId:k,entryStatus:r,entryStage:c,extensions:f});m&&pn({element:$,extension:m}),h&&pn({extension:{name:Yp,value:h},element:$}),o&&($.entryStageSequence=o),S.push($.participantId),(O=v.entries)==null||O.push($)}}),g&&!Pv(c)){let k=I8({participantIds:M,suppressDuplicateEntries:n,autoEntryPositions:a,entryStageSequence:o,ignoreStageSpace:d,drawDefinition:p,entryStatus:r,roundTarget:h,entryStage:c,extension:m,drawId:g,event:v});k.error&&(R=k.error)}if(v.eventType&&[tm,Fl].includes(v.eventType)){let k=(v.entries||[]).map(V=>V.participantId),O=(v.entries||[]).filter(V=>Pv(V.entryStatus)).map(V=>V.participantId),$=((u==null?void 0:u.participants)??[]).filter(V=>k.includes(V.participantId)&&V.participantType&&[Ai,Pn].includes(V.participantType)).map(V=>V.individualParticipantIds).flat(1/0),F=O.filter(V=>$.includes(V));F.length&&(U.push(...F),$R({participantIds:F,autoEntryPositions:!1,event:v}))}if(M.length!==b.length)return fe({context:{mismatchedGender:E,gender:v.gender},result:{error:Pl},stack:y});a&&(v.entries=Cd({entries:v.entries||[]}));let A=S.length,N=U.length;return fe({result:{...pe,addedEntriesCount:A,removedEntriesCount:N},stack:y,info:R})}var Abe="ADMINISTRATION",dWe="CAPTAIN",pWe="COACH",vs="COMPETITOR",_be="MEDIA",kbe="MEDICAL",w8="OFFICIAL",xbe="OTHER",Obe="SECURITY",S8={ADMINISTRATION:Abe,CAPTAIN:dWe,COACH:pWe,COMPETITOR:vs,MEDIA:_be,MEDICAL:kbe,OFFICIAL:w8,OTHER:xbe,SECURITY:Obe};function T8({addIndividualParticipantsToEvents:t,individualParticipantIds:e,groupingParticipantId:i,tournamentRecord:n,suppressErrors:r}){let a="removeIndividualParticipantIds";if(!n)return fe({result:{error:dt},stack:a});if(!i||!e)return fe({result:{error:si},stack:a});let s=(n.participants??[]).find(u=>u.participantId===i);if(!s)return fe({result:{error:Or},stack:a});if(![Pn,gc].includes(s.participantType))return fe({result:{participantType:s.participantType,error:Od},stack:a});let o=Lbe({individualParticipantIds:e,groupingParticipant:s,tournamentRecord:n,suppressErrors:r}),{removed:l,error:c}=o;if(c)return fe({result:o,stack:a});if(t)for(let u of n.events??[]){let d=(u.entries??[]).map(({participantId:p})=>p).filter(Boolean);if(d.includes(i)){let p=l==null?void 0:l.filter(h=>!d.includes(h));Ip({participantIds:p,entryStatus:ou,tournamentRecord:n,event:u})}}return l&&Ti({topic:Ss,payload:{tournamentId:n.tournamentId,participants:[s]}}),{...pe,...o}}function Lbe({individualParticipantIds:t=[],groupingParticipant:e,tournamentRecord:i,suppressErrors:n,mappedMatchUps:r,participants:a}){var s,o;let l=[];if(!e)return{removed:l};let c=[],u=[];a||({participants:a,mappedMatchUps:r}=br({withMatchUps:!0,tournamentRecord:i,withEvents:!0}));let d=(o=(s=a==null?void 0:a.find(({participantId:f})=>f===e.participantId))==null?void 0:s.events)==null?void 0:o.map(({eventId:f})=>f),p=(e.individualParticipantIds??[]).filter(f=>{var m;let g=t==null?void 0:t.includes(f),v=g&&((m=a==null?void 0:a.find(b=>b.participantId===f))==null?void 0:m.matchUps.filter(({eventId:b})=>d.includes(b)).map(({matchUpId:b})=>r==null?void 0:r[b]).filter(({winningSide:b,score:I})=>b||ya({score:I}))),y=g&&!(v!=null&&v.length);if(g&&!y&&u.push(f),y){l.push(f);for(let b of i.events??[])for(let I of b.drawDefinitions??[]){let{extension:T}=xi({element:I,name:am}),w=T==null?void 0:T.value[e.participantId];T&&w&&(T.value[e.participantId]=w.filter(U=>U.participantId!==f),pn({element:I,extension:T}),bR({drawDefinition:I}));let S=po({drawDefinition:I,inContext:!1}).matchUps??[];for(let U of S){let P=U.sides??[];for(let E of P){let R=E.lineUp??[];R.find(C=>C.participantId===f)&&(E.lineUp=R.filter(C=>C.participantId!==f),Qi({tournamentId:i==null?void 0:i.tournamentId,drawDefinition:I,matchUp:U}))}}}}else c.push(f);return!y});e.individualParticipantIds=p;let h={groupingParticipantId:e.participantId,cannotRemove:u,notRemoved:c,removed:l};return u.length&&!n&&{...h,cannotRemove:u,error:EL}||h}function yF({participantRole:t=vs,individualParticipantIds:e=[],groupingTypes:i=[$o,gc],tournamentRecord:n}){if(!n)return{error:dt};let r=n.participants??[],{participants:a,mappedMatchUps:s}=br({withMatchUps:!0,tournamentRecord:n,withEvents:!0}),o=0;return r.filter(l=>(l.participantRole===t||!l.participantRole)&&l.participantType&&i.includes(l.participantType)).forEach(l=>{let{removed:c}=Lbe({groupingParticipant:l,individualParticipantIds:e,tournamentRecord:n,mappedMatchUps:s,participants:a});c&&o++}),o?pe:{error:Rge}}function Ow(t){var e,i;let n=ei(t,[{[Ia]:!0},{participantIds:!0,[Wo]:Ms,[$u]:Yg}]);if(n.error)return n;let{addIndividualParticipantsToEvents:r,tournamentRecord:a,participantIds:s}=t,o=((e=a.participants)==null?void 0:e.length)||0;if(!o)return{...pe};let l=(i=a.events||[])==null?void 0:i.filter(({eventType:g})=>g===aa).map(g=>{var v;return(v=g==null?void 0:g.drawDefinitions)==null?void 0:v.map(({drawId:y})=>y)}).flat(1/0),c=br({participantFilters:{participantIds:s},tournamentRecord:a,withDraws:!0}).participants??[],u=g=>{let v=(Za({matchUpFilters:{drawIds:g,matchUpTypes:[Nn]},tournamentRecord:a}).matchUps??[]).flatMap(({sides:y})=>y==null?void 0:y.map(({participantId:b})=>b||[])).filter(Boolean);return Ar(v,s)},d=l!=null&&l.length?u(l):[],p=c.filter(g=>{var v;return(v=g.draws)==null?void 0:v.filter(y=>(!(l!=null&&l.length)||!(l!=null&&l.includes(y.drawId)))&&y.positionAssignments).length});if(d!=null&&d.length||p.length)return{error:xU};let h={},f={};for(let g of a.events||[]){let v=$R({participantIds:s,event:g});if(v.error)return v;h[g.eventId]=v.participantIdsRemoved}a.participants=(a.participants??[]).filter(g=>{var v,y;let b=s.includes(g.participantId)||g.participantType===Ai&&((v=g.individualParticipantIds)==null?void 0:v.some(I=>s.includes(I)));if(!b&&g.participantType===aa&&(y=g.individualParticipantIds)!=null&&y.some(I=>s.includes(I))&&(g.individualParticipantIds=g.individualParticipantIds.filter(I=>!s.includes(I))),b&&r&&g.participantType&&[Ai,Pn].includes(g.participantType))for(let I of g.individualParticipantIds||[])s.includes(I)||(f[g.participantId]||(f[g.participantId]=[]),f[g.participantId].push(I));return!b});let m=o-a.participants.length;if(yF({individualParticipantIds:s,tournamentRecord:a}),r)for(let g of a.events||[]){let v=h[g.eventId].map(y=>f[y]||[]).flat();Ip({participantIds:v,entryStatus:ou,tournamentRecord:a,event:g})}return m&&Ti({payload:{participantIds:s,tournamentId:a.tournamentId},topic:H6}),m?{...pe,participantsRemovedCount:m}:{error:EL}}function Fbe({selected:t=!0,drawDefinition:e,entryStatuses:i,drawId:n,event:r,stage:a}){var s;let o=r.entries??[];if(n){let{flightProfile:c}=kr({event:r}),u=(s=c==null?void 0:c.flights)==null?void 0:s.find(d=>d.drawId===n);u?o=u.drawEntries:e.entries&&(o=e==null?void 0:e.entries)}let l=o.filter(c=>(!(i!=null&&i.length)||!c.entryStatus||i.includes(c.entryStatus))&&(!a||!c.entryStage||c.entryStage===a)&&(!t||c.entryStatus&&sd.includes(c.entryStatus)));return{entries:o,stageEntries:l}}function $be({removeGroupParticipant:t,tournamentRecord:e,drawDefinition:i,participantId:n,drawId:r,stage:a,event:s}){var o;let l="destroyGroupEntry";if(!e)return{error:dt};if(!n)return fe({result:{error:da},stack:l});if(!s)return{error:Qn};if(!s.eventType||![tm,Fl].includes(s.eventType))return fe({result:{error:jh},stack:l});let c=e.participants??[],u=c.find(y=>y.participantId===n);if(!u)return fe({result:{error:Or},stack:l});if(!u.participantType||![Ai,$o].includes(u.participantType)||u.participantType===$o&&s.eventType!==Fl||u.participantType===Ai&&s.eventType!==tm)return{error:Od};let d=(s.entries??[]).find(y=>y.participantId===n);if(!d)return{error:_ge};let{stageEntries:p}=Fbe({selected:!1,drawDefinition:i,drawId:r,event:s,stage:a}),h=p.map(Gi),f=c.filter(({participantId:y})=>h.includes(y)).map(({individualParticipantIds:y})=>y).flat().filter(Boolean),m=(o=u.individualParticipantIds)==null?void 0:o.filter(y=>yp(y,f).length===1),g=$R({participantIds:[n],event:s});if(g.error||m!=null&&m.length&&(g=Ip({participantIds:m,entryStatus:ou,entryStage:d.entryStage,tournamentRecord:e,drawDefinition:i,drawId:r,event:s}),g.error))return g;let v;return t&&Ow({participantIds:[n],tournamentRecord:e}).success&&(v=!0),{...pe,participantRemoved:v}}function U8({removeGroupParticipant:t,tournamentRecord:e,drawDefinition:i,participantId:n,drawId:r,event:a}){return $be({removeGroupParticipant:t,tournamentRecord:e,drawDefinition:i,participantId:n,drawId:r,event:a})}function Bbe(t){if(!t.tournamentRecord)return{error:dt};let{participantIds:e,...i}=t,n=0,r=[];for(let a of e){let s=$be({participantId:a,...i});s.success&&(n+=1),s.error&&r.push(s.error)}return n?{destroyedCount:n,...pe}:{error:r}}function XE(t){let{tournamentRecord:e,replaceWithBye:i,drawDefinition:n,destroyPair:r,entryStatus:a,matchUpsMap:s,drawId:o}=t,l="removeDrawPositionAssignment",c=OR(t);if(c.error)return fe({result:c,stack:l});let{participantId:u}=c,{drawPosition:d,event:p,structureId:h}=t,f=fn({tournamentRecord:e,drawDefinition:n,event:p}).appliedPolicies??{};if([Bu,Wh].includes(a)&&u){let{tournamentRecord:g}=t,{participant:v}=ev({tournamentRecord:g,participantId:u}),{participantType:y,individualParticipantIds:b}=v??{};if(r&&y===Ai){let I=U8({tournamentRecord:g,drawDefinition:n,participantId:u,event:p});if(I.error)return fe({result:I,stack:l});b&&Y_({participantIds:b,tournamentRecord:g,drawDefinition:n,entryStatus:a,drawId:o,event:p})}else Y_({participantIds:[u],tournamentRecord:g,drawDefinition:n,entryStatus:a,drawId:o,event:p})}if(i){let g=yc({tournamentRecord:e,drawDefinition:n,drawPosition:d,structureId:h,matchUpsMap:s,event:p});if(g.error)return fe({result:g,stack:l})}let{structure:m}=fi({drawDefinition:n,structureId:h});return t8({structure:m,drawPositions:[d]}),aF({appliedPolicies:f,drawDefinition:n,positionAction:{name:"removeDrawPositionAssignment",replaceWithBye:i,drawPosition:d,entryStatus:a,structureId:h}}),c}function Vbe(t){return Object.assign(t,{entryStatus:Wh}),XE(t)}function rG(t){return ur(t)?t.split(" ").map(e=>e.split("").map((i,n)=>n?i.toLowerCase():i.toUpperCase()).join("")).join(" "):t}function ys(t){return ur(t)?rG(t.replace(/_/g," ")):""}var sg=({finishingPosition:t=Uw,qualifyingRoundNumber:e,structureAbbreviation:i,seedAssignments:n=[],stageSequence:r=1,structureOrder:a,seedingProfile:s,matchUpFormat:o,structureType:l,structureName:c,matchUpType:u,matchUps:d=[],structureId:p,roundOffset:h,roundLimit:f,stageOrder:m,structures:g,stage:v})=>{let y={structureId:p??bn(),structureAbbreviation:i,finishingPosition:t,seedAssignments:n,matchUpFormat:o,stageSequence:r,structureName:c};a&&(y.structureOrder=a),l&&(y.structureType=l),s&&(typeof s=="string"?y.seedingProfile=s:typeof s=="object"&&typeof s.positioning=="string"&&(y.seedingProfile=s.positioning)),u&&(y.matchUpType=u),h&&(y.roundOffset=h),m&&(y.stageOrder=m),f&&(y.roundLimit=f),v&&(y.stage=v),e&&(y.qualifyingRoundNumber=e);let b=d.flatMap(({drawPositions:I})=>I).filter(Boolean);return g?y.structures=g:(y.matchUps=d,y.positionAssignments=Pi(b).sort((I,T)=>I-T).map(I=>({drawPosition:I}))),y},$c=sg;function D8({structureName:t=ys(ja),structureAbbreviation:e,drawDefinition:i,matchUpType:n,structureId:r}){if(!i)return{error:Ht};let a=$c({stage:ja,structureAbbreviation:e,structureName:t,matchUps:[],structureId:r,matchUpType:n});return i.structures||(i.structures=[]),i.structures.push(a),zn({drawDefinition:i,structureIds:[a.structureId]}),{...pe}}function E8({drawPositions:t}){if(!(t!=null&&t.length))return{error:nR};let e=r=>t.filter(a=>a!==r).map(a=>[r,a]),i=[].concat(...(t??[]).map(e)),n=Pi(i.map(bF)).map(r=>r.split("|").map(a=>+a));return{groupMatchUps:i,uniqueMatchUpGroupings:n}}function bF(t=[]){return!Array.isArray(t)||!t.length?"":[...t].sort(ra).join("|")}function jbe({groupSize:t,drawPositionOffset:e}){if(!t)return[];let i=d=>[...Array(d)].map((p,h)=>h),n=i(2*Math.round(t/2)+1).slice(1),r=i(n.length-1).map(()=>[]),a=n.slice(0,n.length/2),s=n.slice(n.length/2);n.slice(1).forEach((d,p)=>{a.forEach((g,v)=>{r[p].push([a[v],s[v]])});let h=a.shift(),f=a.pop(),m=s.shift();a=[h,m,...a].filter(Boolean),s=[...s,f].filter(Boolean)});let o=a.shift(),l=a.pop(),c=s.shift();a=[o,c,...a].filter(Boolean),s=[...s,l].filter(Boolean);let u=d=>d[0].reduce((p,h)=>p+h);return[...r].reverse().sort((d,p)=>u(d)-u(p)).map(d=>d.filter(p=>p.every(h=>h<=t)).map(p=>{let h=p.map(f=>f+e);return bF(h)}))}function hWe({rounds:t,hash:e}){return t!=null&&t.length?t==null?void 0:t.reduce((i,n,r)=>n.includes(e)?r+1:i,void 0):{error:si}}var fWe={getRoundRobinGroupMatchUps:E8,determineRoundNumber:hWe,drawPositionsHash:bF,groupRounds:jbe};function BR(t){var e;let{groupNameBase:i="Group",playoffAttributes:n,stageSequence:r=1,structureOptions:a,appliedPolicies:s,seedingProfile:o,stage:l=Bt,matchUpType:c,roundTarget:u,structureId:d,groupNames:p,drawSize:h,idPrefix:f,isMock:m,uuids:g}=t,v=t.structureName??((e=n==null?void 0:n[0])==null?void 0:e.name)??ys(Bt),{groupCount:y,groupSize:b}=mWe({structureOptions:a,appliedPolicies:s,drawSize:h}),I=gy,T,w=Mt(1,y+1).map(U=>{let P=gWe({groupSize:b,structureOrder:U,matchUpType:c,drawSize:h,idPrefix:f,isMock:m});T=Array.isArray(P)?Math.max(...P.map(({roundNumber:R})=>R??0)):0;let E=(p==null?void 0:p[U-1])??`${i} ${U}`;return sg({structureId:g==null?void 0:g.pop(),structureType:jL,finishingPosition:I,structureOrder:U,structureName:E,matchUps:P})}),S=sg({structureId:d??(g==null?void 0:g.pop()),structureType:Eo,finishingPosition:I,seedingProfile:o,structureName:v,stageSequence:r,structures:w,stage:l});return u&&pn({extension:{name:Yp,value:u},element:S}),{structures:[S],maxRoundNumber:T,groupCount:y,links:[],groupSize:b,...pe}}function mWe({appliedPolicies:t,structureOptions:e,drawSize:i}){let n=e==null?void 0:e.groupSize,r=(e==null?void 0:e.groupSizeLimit)||8,{validGroupSizes:a}=VR({groupSizeLimit:r,drawSize:i}),s=a&&Math.max(...a);n&&a!=null&&a.includes(n)||(n&&n>4||!(a!=null&&a.includes(4))?n=s:n=4);let o=Math.ceil(i/n);return{groupSize:n,groupCount:o}}function VR(t){let{groupSizeLimit:e=10,drawSize:i=0}=t??{},n=Mt(3,e+1).filter(r=>{let a=Math.ceil(i/r),s=a*r-i,o=Math.ceil(i/a),l=Math.ceil(s/a);return(!s||s<r)&&o===r&&o>=3&&l<2});return{...pe,validGroupSizes:n}}function gWe({structureOrder:t,matchUpType:e,groupSize:i,drawSize:n,idPrefix:r,isMock:a,uuids:s}){let o=(t-1)*i,l=Mt(1+o,i+1+o),c=E8({drawPositions:l}).uniqueMatchUpGroupings??[],u=jbe({groupSize:i,drawPositionOffset:o});return c.map(p).sort((h,f)=>(h.roundNumber??1/0)-(f.roundNumber??1/0));function d(h){return u.reduce((f,m,g)=>m.includes(h)?g+1:f,void 0)}function p(h){let f=bF(h),m=d(f),g=[1,n],v=vWe({structureOrder:t,drawPositions:h,roundNumber:m,idPrefix:r,uuids:s}),y={matchUpStatus:m?jr:gn,matchUpType:e,finishingPositionRange:{winner:g,loser:g},drawPositions:h,roundNumber:m,matchUpId:v};return a&&(y.isMock=!0),y}}function vWe({structureOrder:t,drawPositions:e,roundNumber:i,idPrefix:n,uuids:r}){return n?`${n}-${t}-${i}-DP-${e.join("-")}`:(r==null?void 0:r.pop())||bn()}function P8(t){let{roundRobinGroupsCount:e,participantsCount:i,cluster:n}=t;if(!wi(i))return{seedBlocks:void 0,...fe({result:{error:Ae},context:{participantsCount:i},stack:"getSeedBlocks"})};let r=MU(i);if(e){let h=Math.min(e,r),f=[],m=1;for(Mt(0,h).forEach(()=>{f.push([m]),m++});m<r;){let g=Mt(m,m+h);m+=h,f.push(g)}return{...pe,seedBlocks:f}}let a=Mt(1,r+1),s=[],o=r/2;for(;o>1;){let h=Na(a,o),f=h.length;h.forEach((m,g)=>{let v,y=g<f/2,b=g%2===0,I=m[0],T=m[m.length-1];n&&f>4?f===8?v=y?T:I:v=b?I:T:v=y?I:T,vo(m,s)||s.push(v)}),o=o/2}let l=a.filter(h=>!s.includes(h));for(;l.length;)l.length%2===0?s.push(l.pop()):s.push(l.shift());let c=Mt(0,20).map(h=>Math.pow(2,h));c.unshift(1);let u=c.indexOf(r),d=0,p=[];return Mt(0,u).forEach(h=>{p.push(s.slice(d,d+c[h])),d+=c[h]}),{...pe,seedBlocks:p}}function C8({roundRobinGroupsCount:t,drawSize:e}){let i="getSeedGroups";if(!wi(e))return{seedGroups:void 0,...fe({result:{error:Ae},context:{drawSize:e},stack:i})};if(t){if(!wi(t))return{seedGroups:void 0,...fe({context:{roundRobinGroupsCount:t},result:{error:Ae},stack:i})};let n=1,r=Math.floor(e/t);return{seedGroups:Mt(0,r).map(()=>{let a=Mt(n,n+t);return n+=t,a})}}else{let{seedBlocks:n}=P8({participantsCount:e,roundRobinGroupsCount:t}),r=0;return{seedGroups:(n||[]).map(a=>(a||[]).map(()=>(r+=1,r)))}}}function R8({roundRobinGroupsCount:t,participantsCount:e}){var i;if(t){let{validGroupSizes:a}=VR({drawSize:e});if(!((i=a==null?void 0:a.map(s=>Math.ceil(e/s)))!=null&&i.includes(t)))return fe({context:{roundRobinGroupsCount:t},result:{error:Ae}})}let{seedGroups:n}=C8({drawSize:e,roundRobinGroupsCount:t}),r=(n==null?void 0:n.map(a=>Math.min(...a)))||[];return{...pe,seedingThresholds:r}}function IT(t){if(!t)return 1/0;if(wi(t))return di(t);let e=t.split("-")[0];return wi(e)?di(e):1/0}function yWe({size:t}){let e=[t],i=t;for(;i/2===Math.floor(i/2);)i=i/2,e.push(i);return e.includes(1)||e.push(1),e.sort(ra),e.reverse(),e}function bWe({blockPattern:t,index:e}){let i=0;for(let n of t){if(i===e)return n;let r=0;for(;r<n.length;){if(i===e)return n;i+=1,r++}}}function IWe({positioning:t,size:e}){let i=yWe({size:e}),n=[],r=[],a=p=>p[0],s=p=>p[p.length-1],o=(p,h)=>(t&&[VL,fy].includes(t)&&h%2?s(p):a(p))||a(p),l=(p,h)=>{if(p.every(f=>!r.includes(f))){let f=o(p,h);return r.push(f),f}},c=p=>{let h=p.filter(f=>!r.includes(f));if(h.length)return r.push(...h),h},u=(p,h)=>{let f=o(p,h);if(!r.includes(f))return r.push(f),f},d=Mt(1,e+1);for(let p of i)if(p===1){let h=Na(d,2),f=h.map(l).filter(Boolean);f.length&&n.push(f);let m=h.flatMap(c).filter(Boolean);m.length&&n.push(m)}else{let h=Na(d,p).map(u).filter(Boolean);h.length&&n.push(h)}return{divisions:i,divisionGroupings:n}}function Lw({provisionalPositioning:t,returnAllProxies:e,appliedPolicies:i,seedingProfile:n,drawDefinition:r,allPositions:a,structure:s}){var o;let l=[];if(!s)return{error:Yy};let{matchUps:c,roundMatchUps:u}=Sn({matchUpFilters:{roundNumbers:[1]},provisionalPositioning:t,structure:s}),{seedAssignments:d}=Zc({provisionalPositioning:t,returnAllProxies:e,drawDefinition:r,structure:s}),{positionAssignments:p}=Aa({structure:s}),h=p==null?void 0:p.length,f=(d==null?void 0:d.length)??0,m=[],g=Object.keys(u).map(k=>parseInt(k)).sort((k,O)=>k-O).map(k=>{let O=u[k].map(F=>F.drawPositions).flat(1/0).filter(Boolean),$=O.filter(F=>!m.includes(F));return m=m.concat(...O),$}).filter(k=>k.length).reverse(),v=g.pop()??[],y=v&&Math.min(...v)-1||0;n=n??((o=i==null?void 0:i.seeding)==null?void 0:o.seedingProfile);let b=(v==null?void 0:v.length)||0,I=g.filter(k=>k.filter(O=>O<=f).length),{stage:T,structureType:w,roundLimit:S}=s,U=w===Eo,P=!U&&(g==null?void 0:g.length),E=!U&&T===ri&&S,R=I.flat(1/0),C=P?R==null?void 0:R.length:0,M=a?h:f,_=l8({drawDefinition:r,structure:s,matchUps:c}),A=_?0:!P&&M||M&&R.length<M&&M-R.length||0;if(E){let k=s!=null&&s.matchUps?s.matchUps.filter(({roundNumber:$})=>$===s.roundLimit).length:0,O=v.length/k;if(!P){let $=jR(n),F=Na(v,O),V=1,j=Mt(0,F[0].length).map(()=>{let B=Mt(V,V+F.length);return V+=F.length,B});({validSeedBlocks:l}=Gbe({drawPositionBlocks:F,nonRandom:n==null?void 0:n.nonRandom,positioning:$,seedGroups:j}))}}else U?{validSeedBlocks:l}=wWe({nonRandom:n==null?void 0:n.nonRandom,seedingProfile:n,structure:s}):P?l=I.map(k=>({seedNumbers:k,drawPositions:k})):_&&Na(v,2).map((k,O)=>({drawPositions:[k[0]],seedNumbers:[O+1]})).forEach(k=>l.push(k));if(!U&&!_&&!E){let{blocks:k}=SWe({drawPositionOffset:y,seedNumberOffset:C,seedCountGoal:A,seedingProfile:n,baseDrawSize:b});k.forEach(O=>l.push(O))}let N=l.flatMap(k=>k.drawPositions).reduce((k,O)=>(v==null?void 0:v.includes(O))&&k,!0);return!_&&!P&&!U&&!N?{error:sge,validSeedBlocks:[],isContainer:U,isFeedIn:P}:{isLuckyStructure:_,validSeedBlocks:l,isContainer:U,isFeedIn:P}}function wWe({seedingProfile:t,structure:e,nonRandom:i}){var n;let r=e.structures||[],a=r.length,s=(n=Gn({structure:e}))==null?void 0:n.positionAssignments,o=jR(t),l=(s==null?void 0:s.length)??0,{seedGroups:c}=C8({roundRobinGroupsCount:a,drawSize:l}),u=r.map(d=>{var p;return(p=Gn({structure:d}).positionAssignments)==null?void 0:p.map(h=>h.drawPosition)});return Gbe({drawPositionBlocks:u,positioning:o,seedGroups:c,nonRandom:i})}function Gbe({drawPositionBlocks:t,positioning:e,seedGroups:i,nonRandom:n}){let r=[],{divisionGroupings:a}=IWe({size:i.length,positioning:e}),s=[];return i.forEach((o,l)=>{let c=bWe({blockPattern:a,index:l});o.forEach((u,d)=>{let p=l%2?t.length-d-1:d,h=t[p].slice().filter((m,g)=>c.includes(g+1)&&m);e!==fy?h=n?h:co(h):l%2&&h.reverse();let f=h.find(m=>!s.includes(m));f&&(s.push(f),r.push({drawPositions:[f],seedNumbers:[u]}))})}),{validSeedBlocks:r}}function SWe(t){let{drawPositionOffset:e=0,roundRobinGroupsCount:i,seedNumberOffset:n=0,seedingProfile:r,seedCountGoal:a,baseDrawSize:s}=t,o=1,l=[],{seedBlocks:c}=P8({cluster:jR(r)===VL,participantsCount:s,roundRobinGroupsCount:i});o=0;for(let d of c){if(o+1>a)break;let p=d.map(f=>f+e),h=u(o+1,d.length).map(f=>+f+n);o+=d.length,l.push({drawPositions:p,seedNumbers:h})}return{blocks:l};function u(d,p){return Array.from(new Array(p),(h,f)=>f+d)}}function Z_({appliedPolicies:t,drawDefinition:e,seedBlockInfo:i,drawPosition:n,structureId:r,seedNumber:a}){var s,o,l,c,u,d;let{structure:p}=fi({drawDefinition:e,structureId:r});t||(t=fn({drawDefinition:e}).appliedPolicies);let h=i==null?void 0:i.validSeedBlocks;return!h&&p&&(h=(s=Lw({appliedPolicies:t,drawDefinition:e,structure:p}))==null?void 0:s.validSeedBlocks),(l=(o=t==null?void 0:t.seeding)==null?void 0:o.validSeedPositions)!=null&&l.ignore?!0:(u=(c=t==null?void 0:t.seeding)==null?void 0:c.validSeedPositions)!=null&&u.strict?(((d=h.find(f=>f.seedNumbers.includes(a)))==null?void 0:d.drawPositions)||[]).includes(n):[].concat(...h.map(f=>f.drawPositions)).includes(n)}function Hbe(t){var e,i,n;let{provisionalPositioning:r,drawDefinition:a,seedingProfile:s,seedBlockInfo:o,structureId:l,randomize:c}=t,{structure:u}=fi({drawDefinition:a,structureId:l}),{seedAssignments:d}=Zc({returnAllProxies:t.returnAllProxies,provisionalPositioning:r,drawDefinition:a,structure:u}),{positionAssignments:p}=Aa({structure:u}),h=(e=p==null?void 0:p.filter(A=>A.participantId??A.bye??A.qualifier))==null?void 0:e.map(A=>A.drawPosition).filter(Boolean),{appliedPolicies:f}=fn({drawDefinition:a}),m=((o==null?void 0:o.validSeedBlocks)||u&&((i=Lw({returnAllProxies:t.returnAllProxies,provisionalPositioning:r,appliedPolicies:f,drawDefinition:a,seedingProfile:s,structure:u}))==null?void 0:i.validSeedBlocks)||[]).filter(A=>A.drawPositions.filter(N=>!(h!=null&&h.includes(N))).length)[0],g=d==null?void 0:d.map(A=>A.participantId).filter(Boolean),v=p==null?void 0:p.map(A=>A.participantId).filter(Boolean),y=g==null?void 0:g.filter(A=>v==null?void 0:v.includes(A)),b=g==null?void 0:g.filter(A=>!(v!=null&&v.includes(A))),I=d==null?void 0:d.filter(A=>b==null?void 0:b.includes(A.participantId)),T=d==null?void 0:d.filter(A=>!A.participantId),w=(I!=null&&I.length&&I.length>0?I.length:(T==null?void 0:T.length)??0)&&(m==null?void 0:m.drawPositions.filter(A=>!(h!=null&&h.includes(A))))||[],S=c?co(w):w,U=[],P=S.map(()=>{var A;let N=(A=_(I,U))==null?void 0:A.participantId;return N&&U.push(N),N}).filter(Boolean),E=d==null?void 0:d.filter(A=>y==null?void 0:y.includes(A.participantId)).map(A=>A.seedNumber),R=((m==null?void 0:m.seedNumbers)||[]).filter(A=>!(E!=null&&E.includes(A))),C=d==null?void 0:d.filter(A=>R.includes(A.seedNumber)).map(A=>A.participantId),M=(n=f==null?void 0:f.seeding)==null?void 0:n.duplicateSeedNumbers;return{nextSeedBlock:m,unplacedSeedParticipantIds:M===void 0||M?P:C,unplacedSeedNumbers:R,unfilledPositions:S,unplacedSeedAssignments:I};function _(A,N){let k=A.filter(F=>!N.includes(F.participantId)),O=Math.min(...k.map(F=>IT(F.seedValue))),$=k.filter(F=>IT(F.seedValue)===O);return co($).pop()}}function jR(t){if(typeof t=="string")return t;if(typeof t=="object")return t.positioning}function ZU({provisionalPositioning:t,tournamentRecord:e,drawDefinition:i,seedingProfile:n,participantId:r,seedBlockInfo:a,structureId:s,seedNumber:o,seedValue:l,eventId:c,event:u}){var d,p,h;let f="assignSeed",{structure:m}=fi({drawDefinition:i,structureId:s}),{positionAssignments:g}=Aa({structure:m}),v=Zc({provisionalPositioning:t,drawDefinition:i,structure:m}).seedAssignments,y=v.map(U=>U.seedNumber),b=Zb({drawDefinition:i,participantId:r});if(r&&!b)return fe({result:{error:xd},context:{participantId:r},stack:f});let I=u?(p=(d=kr({event:u}).flightProfile)==null?void 0:d.flights)==null?void 0:p.length:0,T=I&&I>1,w=(h=g==null?void 0:g.find(U=>U.participantId===r))==null?void 0:h.drawPosition;if(w&&!Z_({drawPosition:w,drawDefinition:i,seedBlockInfo:a,structureId:s,seedNumber:o}))return fe({result:{error:x5},context:{assignedDrawPosition:w},info:"invalid seed position",stack:f});y.includes(o)||v.push({seedNumber:o,seedValue:l});let S;return v.forEach(U=>{U.participantId===r&&U.seedNumber!==o&&(U.participantId=void 0),U.seedNumber===o&&(U.participantId=r,!(n!=null&&n.groupSeedingThreshold)&&!T&&(U.seedValue=l??o),S=!0)}),S?(qye({tournamentId:e==null?void 0:e.tournamentId,drawDefinition:i,structure:m,eventId:c}),{...pe}):fe({result:{error:age},stack:f})}function M8({inContextTargetMatchUp:t,drawPositionSideIndex:e,teamParticipantId:i,tournamentRecord:n,drawDefinition:r,matchUp:a,event:s}){var o,l,c,u;let d=(l=(o=t==null?void 0:t.sides)==null?void 0:o[e])==null?void 0:l.sideNumber,p=d&&((c=a.sides)==null?void 0:c.find(g=>g.sideNumber===d)),{extension:h}=xi({element:r,name:am}),f=(h==null?void 0:h.value)||{},m=$t(f[i],!1,!0);if(p)(u=a==null?void 0:a.sides)==null||u.forEach(g=>{g.sideNumber===d&&(g.lineUp=m)});else{a.sides=[1,2].map(v=>{var y;return{...((y=a.sides)==null?void 0:y.find(b=>b.sideNumber===v))??{},sideNumber:v}});let g=a.sides.find(v=>v.sideNumber===d);g&&(g.lineUp=m)}Qi({tournamentId:n==null?void 0:n.tournamentId,context:"updateSidLineUp",eventId:s==null?void 0:s.eventId,drawDefinition:r,matchUp:a})}function zbe(t){let{sourceMatchUp:e}=t,{targetMatchUp:i,structure:n,matchUpsMap:r,drawPosition:a}=t,s=i.roundNumber>1&&i.roundNumber-1,o=by({structureId:n.structureId,matchUpsMap:r});!e&&a&&(e=o.find(({drawPositions:f,roundNumber:m})=>m===s&&(f==null?void 0:f.includes(a))));let l=e==null?void 0:e.roundPosition,c=l%2?1:-1,u=l+c,d=s&&o.find(({roundNumber:f,roundPosition:m})=>f===s&&m===u),p=d==null?void 0:d.matchUpStatus,h=[Kr,oa].includes(p);return{pairedPreviousMatchUp:d,pairedPreviousMatchUpIsDoubleExit:h}}function TWe({drawPosition:t,drawPositions:e}){let i=!1,n=!!(e!=null&&e.includes(t));return{updatedDrawPositions:n?e||[]:[...e,void 0,void 0].slice(0,2).map(r=>!r&&!n?(n=!0,i=!0,t):r).sort(ra).filter(Boolean),positionAdded:i,positionAssigned:n}}function qbe({structureId:t,matchUpsMap:e,matchUp:i}){let n=i==null?void 0:i.roundPosition,r=n%2?1:-1,a=n+r;return{pairedPreviousMatchUp:by({matchUpsMap:e,structureId:t}).find(({roundNumber:s,roundPosition:o})=>s===(i==null?void 0:i.roundNumber)&&o===a)}}function Wbe({inContextDrawMatchUps:t,sourceMatchUpStatus:e,sourceMatchUpId:i,matchUpsMap:n,matchUp:r}){let a=t.find(o=>o.matchUpId===i),{pairedPreviousMatchUp:s}=qbe({structureId:a==null?void 0:a.structureId,matchUp:a,matchUpsMap:n});if(a&&s){let o=s==null?void 0:s.matchUpId,l=t.find(u=>u.matchUpId===o),c=(a==null?void 0:a.structureId)===(l==null?void 0:l.structureId)?(a==null?void 0:a.roundPosition)<(l==null?void 0:l.roundPosition)&&1||2:a.structureId===(l==null?void 0:l.structureId)&&2||1;r.matchUpStatusCodes=(r.matchUpStatusCodes??[]).map(u=>{let d=ur(u)||!isNaN(u)?{code:u}:u;return d.sideNumber===c?{...d,previousMatchUpStatus:e}:d})}}function cA({inContextDrawMatchUps:t,drawPosition:e,matchUpId:i}){let n=t.filter(({winnerMatchUpId:r,loserMatchUpId:a})=>a===i||r===i).sort((r,a)=>r.roundPosition-a.roundPosition);return t.find(r=>r.matchUpId===i).feedRound?1:n.reduce((r,a,s)=>{var o;return(o=a.drawPositions)!=null&&o.includes(e)?s+1:r},void 0)}function wT({inContextDrawMatchUps:t,sourceMatchUpStatus:e,tournamentRecord:i,sourceMatchUpId:n,drawDefinition:r,matchUpStatus:a,drawPosition:s,matchUpsMap:o,matchUpId:l,event:c}){var u,d,p,h;let f="assignMatchUpDrawPosition";o||(o=Us({drawDefinition:r})),t||(t=pa({inContext:!0,drawDefinition:r,matchUpsMap:o}).matchUps??[]);let m=t.find(N=>N.matchUpId===l),g=m==null?void 0:m.structureId,v=(u=r==null?void 0:r.structures)==null?void 0:u.find(N=>N.structureId===g);if(!v)return{error:yr};let y=(d=o==null?void 0:o.drawMatchUps)==null?void 0:d.find(N=>N.matchUpId===l),b=(y==null?void 0:y.drawPositions)??[],{positionAdded:I,positionAssigned:T,updatedDrawPositions:w}=TWe({drawPositions:b,drawPosition:s}),{positionAssignments:S}=Gn({drawDefinition:r,structure:v}),U=(p=S==null?void 0:S.filter(N=>w.includes(N.drawPosition)))==null?void 0:p.find(({bye:N})=>N),P=(y==null?void 0:y.matchUpStatus)&&[un,Ki].includes(y.matchUpStatus)&&w.filter(Boolean).length<2;if(a=U&&gn||a||P&&y.matchUpStatus||(y==null?void 0:y.matchUpStatus)&&[Kr,oa].includes(y.matchUpStatus)&&y.matchUpStatus||jr,y&&I){t=pa({inContext:!0,drawDefinition:r,matchUpsMap:o}).matchUps??[];let N=P&&cA({inContextDrawMatchUps:t,drawPosition:s,matchUpId:l})||void 0;y!=null&&y.matchUpStatusCodes&&Wbe({inContextDrawMatchUps:t,sourceMatchUpStatus:e,sourceMatchUpId:n,matchUpsMap:o,matchUp:y}),Object.assign(y,{drawPositions:w,winningSide:N,matchUpStatus:a}),Qi({tournamentId:i==null?void 0:i.tournamentId,eventId:m==null?void 0:m.eventId,context:f,drawDefinition:r,matchUp:y})}let E=bo({inContextDrawMatchUps:t,inContextMatchUp:m,drawDefinition:r,matchUpId:l}),{targetMatchUps:{winnerMatchUp:R,loserMatchUp:C,loserTargetDrawPosition:M},targetLinks:{loserTargetLink:_}}=E,A=by({structureId:v.structureId,matchUpsMap:o});if(T&&U){if(R)if([gn,Kr,oa].includes(a)){let N=wT({matchUpId:R.matchUpId,inContextDrawMatchUps:t,tournamentRecord:i,drawDefinition:r,drawPosition:s,matchUpsMap:o});if(N.error)return N}else{let{structureId:N}=R;N!==v.structureId&&console.log("winnerMatchUp in different structure... participant is in different targetDrawPosition")}}else if(R&&m&&!m.feedRound){let{pairedPreviousMatchUpIsDoubleExit:N}=zbe({targetMatchUp:y,drawPosition:s,matchUpsMap:o,structure:v});if(N){let k=wT({matchUpId:R.matchUpId,inContextDrawMatchUps:t,tournamentRecord:i,drawDefinition:r,drawPosition:s,matchUpsMap:o});if(k.error)return k}}if((y==null?void 0:y.matchUpType)===Xn){let N=t==null?void 0:t.find(({matchUpId:$})=>$===y.matchUpId),k=((N==null?void 0:N.sides)??[]).reduce(($,F,V)=>F.drawPosition===s?V:$,void 0),O=(h=S==null?void 0:S.find($=>$.drawPosition===s))==null?void 0:h.participantId;O&&k!==void 0&&M8({inContextTargetMatchUp:N,drawPositionSideIndex:k,teamParticipantId:O,tournamentRecord:i,drawDefinition:r,matchUp:y})}if((_==null?void 0:_.linkCondition)===xp&&w.filter(Boolean).length===2&&!U&&A.filter(({drawPositions:N,roundNumber:k})=>k===1&&vo(N,w)).every(({matchUpStatus:N})=>[$r,ss].includes(N))&&C){let{structureId:N}=C,k=yc({drawPosition:M,tournamentRecord:i,drawDefinition:r,structureId:N,matchUpsMap:o,event:c});if(k.error)return k}return T?{...pe}:fe({result:{error:rT},context:{drawPosition:s},stack:f})}function Ybe({inContextDrawMatchUps:t,drawDefinition:e,assignments:i,matchUpsMap:n,structure:r}){var a,s,o,l;let c=((o=(s=(a=zU({drawDefinition:e}))==null?void 0:a.containedStructures)==null?void 0:s[r.structureId])==null?void 0:o.map(({structureId:f})=>f))||[];c.push(r==null?void 0:r.structureId);let u=(i==null?void 0:i.map(({drawPosition:f})=>f))||[],d=(t==null?void 0:t.filter(f=>c.includes(f.structureId)&&Ar(f.drawPositions??[],u).length))??[],p=d.map(({matchUpId:f})=>f),h=((l=n==null?void 0:n.drawMatchUps)==null?void 0:l.filter(f=>p.includes(f.matchUpId)))??[];return{drawPositions:u,matchUps:h,targetMatchUps:d}}function N8({lineUp:t}){if(!Array.isArray(t))return;let e={};return Pi(t.flatMap(({collectionAssignments:i})=>i==null?void 0:i.map(({collectionId:n,collectionPosition:r})=>[n,r].join("|"))).filter(Boolean)).forEach(i=>{let[n,r]=i.split("|"),a=parseInt(r),{assignedParticipantIds:s}=W_({collectionPosition:a,collectionId:n,lineUp:t});s.forEach(o=>{e[o]||(e[o]=[]),e[o].push({collectionId:n,collectionPosition:a})})}),Object.keys(e).map(i=>({participantId:i,collectionAssignments:e[i]}))}function Sy(t){return`${t} must be an array`}function IF({lineUp:t,tieFormat:e}){let i=[];if(!Array.isArray(t))return i.push(Sy("lineUp")),{valid:!1,errors:i,error:Ae};let n=t.every(a=>{if(typeof a!="object")return i.push("lineUp entries must be objects"),!1;let{participantId:s,collectionAssignments:o}=a;return s?typeof s!="string"?(i.push("participantIds must be strings"),!1):Array.isArray(o)?o.every(l=>{if(typeof l!="object")return i.push("collectionAssignments must be objects"),!1;let{collectionPosition:c}=l;return typeof c!="number"?(i.push("collectionPosition must be a number"),!1):!0}):(i.push(Sy("collectionAssignments")),!1):(i.push("Missing participantId"),!1)}),r=Pi(t.map(Gi)).length===t.length;return r||i.push("Duplicated participantId(s)"),{valid:n&&r,errors:i,error:i.length?Ae:void 0}}function Fw({drawDefinition:t,participantId:e,tieFormat:i,lineUp:n}){if(typeof t!="object")return{error:Ht};if(typeof e!="string")return{error:da};let r=IF({lineUp:n,tieFormat:i});if(!r.valid)return r;let{extension:a}=xi({element:t,name:am}),s=(a==null?void 0:a.value)||{};return s[e]=N8({lineUp:n}),pn({element:t,extension:{name:am,value:s}}),bR({drawDefinition:t}),{...pe}}function A8({inContextDrawMatchUps:t,inheritance:e=!0,tournamentRecord:i,drawDefinition:n,matchUpsMap:r,assignments:a,structure:s,event:o}){if(!n)return{error:Ht};let{drawPositions:l,matchUps:c,targetMatchUps:u}=Ybe({inContextDrawMatchUps:t,matchUpsMap:r,assignments:a,structure:s});for(let d of u)d.matchUpType===ac&&(d.sides??[]).forEach((p,h)=>{var f;if(p!=null&&p.drawPosition&&l!=null&&l.includes(p.drawPosition)){let m=c.find(({matchUpId:g})=>g===d.matchUpId);if((f=m==null?void 0:m.sides)!=null&&f[h]){if(delete m.sides[h].lineUp,e===!1){let g=d.tieFormat,v=p.participantId;g&&v&&Fw({drawDefinition:n,participantId:v,lineUp:[],tieFormat:g})}Qi({tournamentId:i==null?void 0:i.tournamentId,context:"resetLineUps",eventId:o==null?void 0:o.eventId,drawDefinition:n,matchUp:m})}}});return{...pe}}function Lp({provisionalPositioning:t,inContextDrawMatchUps:e,isQualifierPosition:i,sourceMatchUpStatus:n,tournamentRecord:r,drawDefinition:a,seedingProfile:s,participantId:o,seedBlockInfo:l,drawPosition:c,matchUpsMap:u,structureId:d,event:p}){var h,f,m,g,v;let y="assignDrawPosition";if(!o&&!i)return fe({result:{error:da},stack:y});u=u??Us({drawDefinition:a}),e||({matchUps:e}=pa({inContext:!0,drawDefinition:a,matchUpsMap:u}));let b=fi({drawDefinition:a,structureId:d});if(b.error)return fe({result:b,stack:y});let{structure:I}=b;if(!I)return{error:yr};if(Ho({structure:I}))return fe({result:{error:cl},stack:y});let{seedAssignments:T}=Zc({provisionalPositioning:t,drawDefinition:a,structure:I}),w=(h=T==null?void 0:T.find(A=>A.participantId===o))==null?void 0:h.seedNumber,{appliedPolicies:S}=fn({tournamentRecord:r,drawDefinition:a,structure:I,event:p});if(w&&!Z_({seedNumber:w,appliedPolicies:S,drawDefinition:a,seedBlockInfo:l,drawPosition:c,structureId:d}))return fe({result:{error:x5},context:{drawPosition:c},stack:y});let U=Aa({structure:I}).positionAssignments||[],P=U==null?void 0:U.find(A=>A.drawPosition===c);if(!P)return fe({result:{error:NU},context:{drawPosition:c},stack:y});if(U!=null&&U.map(Gi).includes(o))return fe({result:{error:xU},context:{drawPosition:c},stack:y});let{containsParticipant:E,containsBye:R}=_(P);if(R){let A=OR({inContextDrawMatchUps:e,tournamentRecord:r,drawDefinition:a,drawPosition:c,structureId:d,matchUpsMap:u,event:p});if(A.error)return fe({result:A,stack:y})}if(E&&P.participantId!==o){let{activeDrawPositions:A}=xR({drawDefinition:a,structureId:d});if(A.includes(c))return fe({result:{error:wL},stack:y});A8({assignments:[P],inContextDrawMatchUps:e,tournamentRecord:r,drawDefinition:a,matchUpsMap:u,structure:I})}if(P.participantId=o,i&&(P.qualifier=!0),I.stage===Bt&&(!I.stageSequence||I.stageSequence>1)||I.stage&&[ws,Mr].includes(I.stage)){let A=I.stage===ri?ri:Bt,N=(((m=(f=a.structures)==null?void 0:f.find(k=>(k==null?void 0:k.stage)===A&&(k==null?void 0:k.stageSequence)===1))==null?void 0:m.seedAssignments)??[]).find(k=>k.participantId===o);if(N!=null&&N.participantId){let{participantId:k,seedNumber:O,seedValue:$}=N;ZU({eventId:p==null?void 0:p.eventId,provisionalPositioning:t,tournamentRecord:r,drawDefinition:a,seedingProfile:s,participantId:k,seedNumber:O,seedValue:$,structureId:d,event:p})}}if(I.structureType!==Eo)UWe({provisionalPositioning:t,inContextDrawMatchUps:e,sourceMatchUpStatus:n,tournamentRecord:r,drawDefinition:a,drawPosition:c,matchUpsMap:u,structure:I,event:p});else{Ebe({positionAssignments:U,tournamentRecord:r,drawDefinition:a,matchUpsMap:u,structure:I});let{drawPositions:A,matchUps:N,targetMatchUps:k}=Ybe({assignments:[P],inContextDrawMatchUps:e,drawDefinition:a,matchUpsMap:u,structure:I});if(A&&(N==null?void 0:N.length)===1&&N[0].matchUpType===Xn){let O=((k==null?void 0:k[0].sides)??[]).reduce(($,F,V)=>A!=null&&A.includes(F.drawPosition)?V:$,void 0);M8({inContextTargetMatchUp:k[0],teamParticipantId:o,matchUp:N[0],drawPositionSideIndex:O,tournamentRecord:r,drawDefinition:a})}}let C=(g=a.entries)==null?void 0:g.find(A=>A.participantId===o),M=(v=p==null?void 0:p.entries)==null?void 0:v.find(A=>A.participantId===o);return!C&&M&&b8({entryStatus:M.entryStatus,entryStage:I.stage,ignoreStageSpace:!0,drawDefinition:a,participantId:o,event:p}),Ug({tournamentId:r==null?void 0:r.tournamentId,drawDefinition:a,structure:I,event:p}),{positionAssignments:U,...pe};function _(A){let N=A.bye,k=A.qualifier,O=A.participantId;return{containsBye:N,containsQualifier:k,containsParticipant:O,filled:N||k||O}}}function UWe({provisionalPositioning:t,inContextDrawMatchUps:e,sourceMatchUpStatus:i,tournamentRecord:n,drawDefinition:r,drawPosition:a,matchUpsMap:s,structure:o,event:l}){let c={isCollectionMatchUp:!1},{matchUps:u}=Sn({provisionalPositioning:t,matchUpFilters:c,drawDefinition:r,matchUpsMap:s,structure:o,event:l}),{roundMatchUps:d}=yo({matchUps:u}),{initialRoundNumber:p}=CI({drawPosition:a,matchUps:u}),h=p&&(d==null?void 0:d[p].find(f=>{var m;return(m=f.drawPositions)==null?void 0:m.includes(a)}));if(h){let f=wT({matchUpId:h.matchUpId,inContextDrawMatchUps:e,sourceMatchUpStatus:i,tournamentRecord:n,drawDefinition:r,drawPosition:a,matchUpsMap:s});if(f.error)return fe({stack:"assignDrawPositionToMatchUps",context:{drawPosition:a},result:f})}return{...pe}}function _8(t){let{participantIdAttributeName:e="participantId",isQualifierPosition:i,positionActionName:n,tournamentRecord:r,drawDefinition:a,participantId:s,drawPosition:o,structureId:l,event:c}=t,u="positionParticipantAction";if(!a)return{error:Ht};let d=fn({tournamentRecord:r,drawDefinition:a,event:c}).appliedPolicies??{},{inContextDrawMatchUps:p,matchUpsMap:h}=t;h||(h=Us({drawDefinition:a}),Object.assign(t,{matchUpsMap:h})),p||({matchUps:p}=pa({inContext:!0,drawDefinition:a,matchUpsMap:h}),Object.assign(t,{inContextDrawMatchUps:p}));let{positionAssignments:f}=Gn({drawDefinition:a,structureId:l}),m=f==null?void 0:f.find(I=>I.drawPosition===o);if(m!=null&&m.participantId){let I=m.participantId,T=Lp({inContextDrawMatchUps:p,tournamentRecord:r,drawDefinition:a,participantId:s,drawPosition:o,structureId:l,matchUpsMap:h,event:c});return T.success?b({appliedPolicies:d,removedParticipantId:I}):fe({result:T,stack:u})}let g=OR({inContextDrawMatchUps:p,tournamentRecord:r,drawDefinition:a,drawPosition:o,structureId:l,matchUpsMap:h,event:c});if(g.error)return fe({result:g,stack:u});let v=g.participantId,y=Lp({inContextDrawMatchUps:p,isQualifierPosition:i,tournamentRecord:r,drawDefinition:a,participantId:s,drawPosition:o,structureId:l,matchUpsMap:h,event:c});if(!y.success)return fe({result:y,stack:u});return b({appliedPolicies:d,removedParticipantId:v});function b({appliedPolicies:I,removedParticipantId:T}){let{structure:w}=fi({drawDefinition:a,structureId:l});t8({drawPositions:[o],structure:w});let S={[e]:s,name:n,drawPosition:o,structureId:l};return aF({appliedPolicies:I,drawDefinition:a,positionAction:S}),fe({context:{removedParticipantId:T},result:{...pe},stack:u})}}function DWe({luckyLoserParticipantId:t,tournamentRecord:e,drawDefinition:i,drawPosition:n,structureId:r}){return _8({positionActionName:"luckyLoserDrawPositionAssignment",participantId:t,tournamentRecord:e,drawDefinition:i,drawPosition:n,structureId:r})}function Kbe(t){return DWe(t)}function Zbe({params:t,modMap:e,structure:i}){let{tournamentRecord:n,drawDefinition:r,event:a}=t;for(let s of i.matchUps)e[s.matchUpId]&&(s.roundNumber=e[s.matchUpId],Qi({tournamentId:n==null?void 0:n.tournamentId,eventId:a==null?void 0:a.eventId,drawDefinition:r,matchUp:s}))}function Xbe(t,e){let i=[{drawDefinition:!0,structureId:!0}];Array.isArray(e)&&i.push(...e);let n=ei(t,i);if(n.error)return n;let r=fi(t);if(r.error)return r;let a=r.structure;if(!Ho({structure:a}))return fe({result:{error:Wy,message:"structure must be adHoc"}});let{roundMatchUps:s=[],roundNumbers:o}=yo({matchUps:a==null?void 0:a.matchUps});return o!=null&&o.length?{valid:!0,structure:a,roundMatchUps:s,roundNumbers:o}:{error:Em}}function Jbe(t){var e;let i=Xbe(t,[{targetRoundNumber:!0,roundNumber:!0,[Wo]:mqe}]);if(i.error)return i;let{structure:n,roundMatchUps:r,roundNumbers:a}=i,{targetRoundNumber:s,roundNumber:o}=t;if(!(a!=null&&a.includes(o))||!(a!=null&&a.includes(s)))return fe({result:{error:Ae},info:"roundNumbers must be valid rounds"});let l=s>o,c=l?Mt(o+1,s+1):Mt(s,o),u={};return c.forEach(d=>((r==null?void 0:r[d])??[]).forEach(({matchUpId:p})=>{u[p]=d-(l?1:-1)})),(e=r==null?void 0:r[o])==null||e.forEach(({matchUpId:d})=>u[d]=s),Zbe({params:t,modMap:u,structure:n}),{...pe}}function Qbe({structurePositionAssignments:t,provisionalPositioning:e,tournamentRecord:i,drawDefinition:n,event:r}){var a;if(!n)return{error:Ht};if(!Array.isArray(t))return{error:Ae};let s="setPositionAssignments";for(let l of t){let{structureId:c,positionAssignments:u}=l;if(!u)continue;let d=fi({drawDefinition:n,structureId:c});if(d.error)return d;let p=d.structure;if(!p)return{error:yr};let h=(a=Gn({structure:p}).positionAssignments)==null?void 0:a.map(({drawPosition:v})=>v),f=u==null?void 0:u.map(({drawPosition:v})=>v);if(Ar(h,f).length!==(h==null?void 0:h.length))return fe({result:{error:Ae},info:"drawPositions do not match",stack:s});let m=Us({drawDefinition:n}),{matchUps:g}=pa({inContext:!0,drawDefinition:n,matchUpsMap:m});for(let v of u||[]){let{drawPosition:y,participantId:b,bye:I,qualifier:T}=v;if(I){let w=yc({tournamentRecord:i,drawDefinition:n,drawPosition:y,matchUpsMap:m,structureId:c,structure:p,event:r});if(w!=null&&w.error)return w}else if(T)u.forEach(w=>{w.drawPosition===y&&(w.qualifier=!0,delete w.participantId,delete w.bye)});else if(b){let w=Lp({provisionalPositioning:e,inContextDrawMatchUps:g,tournamentRecord:i,drawDefinition:n,participantId:b,drawPosition:y,matchUpsMap:m,structureId:c,event:r});if(w!=null&&w.error)return w}}Ug({tournamentId:i==null?void 0:i.tournamentId,drawDefinition:n,structure:p,event:r})}let o=t.map(({structureId:l})=>l);return zn({tournamentId:i==null?void 0:i.tournamentId,eventId:r==null?void 0:r.eventId,drawDefinition:n,structureIds:o}),{...pe}}function eIe(t){let e=Xbe(t,[{roundNumbers:!0,[Wo]:Ms,[ps]:s=>s.length===2&&s.every(Er)}]);if(e.error)return e;let{structure:i,roundMatchUps:n,roundNumbers:r}=e;if(!t.roundNumbers.every(s=>r==null?void 0:r.includes(s)))return fe({result:{error:Ae,message:"roundNumbers must be valid rounds"}});let a={};return t.roundNumbers.forEach((s,o)=>((n==null?void 0:n[s])??[]).forEach(({matchUpId:l})=>{a[l]=t.roundNumbers[1-o]})),Zbe({params:t,modMap:a,structure:i}),{...pe}}function EWe({qualifyingParticipantId:t,tournamentRecord:e,drawDefinition:i,drawPosition:n,structureId:r}){return _8({positionActionName:"qualifierDrawPositionAssignment",participantId:t,isQualifierPosition:!0,tournamentRecord:e,drawDefinition:i,drawPosition:n,structureId:r})}function tIe(t){return EWe(t)}function iIe({alternateParticipantId:t,tournamentRecord:e,drawDefinition:i,drawPosition:n,structureId:r,event:a}){return _8({positionActionName:"alternateDrawPositionAssignment",participantIdAttributeName:"alternateParticipantid",participantId:t,tournamentRecord:e,drawDefinition:i,drawPosition:n,structureId:r,event:a})}function nIe({validation:t=!0,tournamentRecord:e,drawDefinition:i,participantId:n,structureId:r,seedValue:a,event:s}){if(!i)return{error:Ht};if(!r)return{error:mc};let o=((e==null?void 0:e.participants)??[]).find(p=>p.participantId===n);if(e&&!o)return{error:xd};let{structure:l}=fi({drawDefinition:i,structureId:r});if(!l)return{error:yr};if(!(!t||Er(a)||a===void 0||a===""||typeof a=="string"&&a.split("-").every(p=>Er(p)&&di(p)>0)))return{error:Ae};let{seedAssignments:c}=Zc({drawDefinition:i,structure:l}),u=c==null?void 0:c.map(p=>p.seedNumber),d=c==null?void 0:c.find(p=>p.participantId===n);if(d){let p=typeof a=="string"?a.includes("-")&&a.split("-").map(h=>parseInt(h)).join("-")||parseInt(a)>0&&parseInt(a)||"":a&&a>0&&a||"";d.seedValue=p}else{let p={seedNumber:Math.max(0,...u||[])+1,participantId:n};a&&(p.seedValue=a),l.seedAssignments||(l.seedAssignments=[]),l.seedAssignments.push(p)}return qye({tournamentId:e==null?void 0:e.tournamentId,eventId:s==null?void 0:s.eventId,drawDefinition:i,structure:l}),{...pe}}function rIe({drawDefinition:t,structureId:e}){if(!t)return{error:Ht};let{structure:i}=fi({drawDefinition:t,structureId:e}),n=((t==null?void 0:t.links)||[]).filter(r=>{var a;return((a=r.source)==null?void 0:a.structureId)===e}).map(r=>{var a;return(a=r.target)==null?void 0:a.structureId});return{playoffStructures:((t==null?void 0:t.structures)||[]).filter(r=>n.includes(r.structureId)),structure:i}}function wF({withStageGrouping:t,stageSequences:e,stageSequence:i,roundTarget:n,stages:r,event:a,stage:s}){if(!a)return{error:Qn};let o={},l=[];for(let c of a.drawDefinitions||[]){let{structures:u,stageStructures:d}=Ju({withStageGrouping:t,stageSequences:e,drawDefinition:c,stageSequence:i,roundTarget:n,stages:r,stage:s});if(l.push(...u),d)for(let p of Object.keys(d))o[p]||(o[p]=[]),o[p].push(...d[p])}return{structures:l,stageStructures:o}}function k8({withStageGrouping:t,tournamentRecord:e,stageSequences:i,stageSequence:n,roundTarget:r,stages:a,stage:s}){if(!e)return{error:dt};let o={},l=[];for(let c of e.events||[]){let{structures:u,stageStructures:d}=wF({withStageGrouping:t,stageSequences:i,stageSequence:n,roundTarget:r,stages:a,event:c,stage:s});if(u&&l.push(...u),d)for(let p of Object.keys(d))o[p]||(o[p]=[]),o[p].push(...d[p])}return{structures:l,stageStructures:o}}function Eg(t){if(!(t!=null&&t.drawDefinition))return!1;let e=gF(t),i=e==null?void 0:e.includesTeamMatchUps,{completedMatchUps:n,pendingMatchUps:r,upcomingMatchUps:a}=e||{};return i&&(n=n==null?void 0:n.filter(({matchUpType:s})=>s===Xn),r=r==null?void 0:r.filter(({matchUpType:s})=>s===Xn),a=a==null?void 0:a.filter(({matchUpType:s})=>s===Xn)),!!(n!=null&&n.length&&!(r!=null&&r.length)&&!(a!=null&&a.length))}function x8(t){var e,i;let{drawDefinition:n,structureId:r}=t;if(!n)return{error:Ht};let{playoffStructures:a}=rIe({drawDefinition:n,structureId:r});if(!(a!=null&&a.length))return!1;let s=((i=(e=n==null?void 0:n.entries)==null?void 0:e.filter(l=>(l==null?void 0:l.entryStatus)&&sd.includes(l.entryStatus)))==null?void 0:i.length)??0,o=0;return(a||[]).reduce((l,c)=>{var u;return!!((u=Gn({structure:c}).positionAssignments??[])!=null&&u.filter(d=>(d.participantId&&o++,(d==null?void 0:d.bye)??(d==null?void 0:d.participantId))).length&&l)},!!a.length)||o===s}function aG({significantCharacters:t,accessors:e=[],value:i}){let n=[],r=e[0];if(i!=null&&i[r]){let s=e.slice(1);if(Array.isArray(i[r]))i[r].forEach(o=>{let l=aG({accessors:s,significantCharacters:t,value:o});n.push(...l)});else if(i=i[r],s.length){let o=aG({accessors:s,significantCharacters:t,value:i});n.push(...o)}else a({value:i})}function a({value:s}){if(s&&["string","number"].includes(typeof s)){let o=t?s.slice(0,t):s;n.push(o)}}return n}function PWe({targetParticipantIds:t,policyAttributes:e,idCollections:i,participants:n}){if(!Array.isArray(e))return{error:z5};if(!Array.isArray(n))return{error:sR};let r={};return t.forEach(a=>{let s=n.find(l=>l.participantId===a),{values:o}=aIe({policyAttributes:e,idCollections:i,participants:n,participant:s});o&&o.forEach(l=>{r[l]||(r[l]=[]),r[l].includes(a)||r[l].push(a)})}),r}function aIe({policyAttributes:t,idCollections:e,participants:i,participant:n}){if(!Array.isArray(t))return{error:z5};if(!n)return{error:bw};let r=[];return t.forEach(a=>{let{directive:s,groupings:o,key:l,significantCharacters:c}=a||{};if(l){let u=l.split(".");r.push(...aG({significantCharacters:c,value:n,accessors:u}))}else if(s){let u=a==null?void 0:a.includeIds,d=((e==null?void 0:e[s])||[]).filter(p=>!u||u.includes(p));d!=null&&d.length&&i!=null&&i.length&&d.forEach(p=>{var h;let f=i.find(m=>m.participantId===p);if((h=f==null?void 0:f.individualParticipantIds)!=null&&h.includes(n.participantId)){let m=f==null?void 0:f.participantId;r.push(m)}})}else o&&Object.keys(o).forEach(u=>{o[u].includes(n.participantId)&&r.push(u)})}),{values:Pi(r)}}function XX({candidatePositionAssignments:t,participantsWithGroupings:e,policyAttributes:i,idCollections:n}){let r=Object.assign({},...e.map(a=>({[a.participantId]:a})));return t.map(a=>{let s=r[a.participantId],{values:o}=aIe({participants:e,policyAttributes:i,idCollections:n,participant:s});return{...a,values:o}})}function sIe({participantIdGroups:t,positionAssignments:e,groupsToAvoid:i}){return Object.assign({},...e.filter(n=>n==null?void 0:n.participantId).map(n=>{let{drawPosition:r,participantId:a}=n,s=t?t[a]||[]:[],o=!!i.some(l=>s.includes(l));return{[r]:{participantGroups:s,includesGroupsToAvoid:o}}}))}function CWe(t){let{unfilledPositions:e,chunkedDrawPositions:i}=t,n=sIe(t);return i.map(a=>{let s=e.filter(c=>a.includes(c)),o=r(s),l=s.filter(c=>!o.includes(c)).filter(c=>{var u;let d=JX(c);return!((u=n[d])!=null&&u.includesGroupsToAvoid)});return{unassigned:s,unpaired:o,pairedNoConflict:l}});function r(a){return a.filter(o=>!s(o));function s(o){let l=JX(o);return!a.includes(l)}}}function RWe(t){let{unfilledPositions:e,chunkedDrawPositions:i}=t,n=sIe(t);return i.map(r=>{let a=e.filter(l=>r.includes(l)),s=a.length===r.length?a:[],o=r.filter(l=>{var c;return(c=n[l])==null?void 0:c.includesGroupsToAvoid}).length;return{unassigned:a,unpaired:s,pairedNoConflict:o?[]:a,conflictsCount:o}})}function JX(t){return Number(t%2?t+1:t-1)}function MWe({allGroups:t,participantId:e}){return Object.keys(t).filter(i=>t[i].includes(e))}function NWe({selectedParticipantGroups:t,participantIdGroups:e,positionAssignments:i,drawPositionChunks:n,unfilledPositions:r,isRoundRobin:a}){let s=n.map(o=>a?RWe({groupsToAvoid:t,chunkedDrawPositions:o,participantIdGroups:e,positionAssignments:i,unfilledPositions:r}):CWe({groupsToAvoid:t,chunkedDrawPositions:o,participantIdGroups:e,positionAssignments:i,unfilledPositions:r}));if(a){let o=s.map(u=>u.map(d=>d.unassigned).filter(d=>d==null?void 0:d.length)).filter(u=>u==null?void 0:u.length).sort((u,d)=>(d.length||0)-(u.length||0)),l=s.map(u=>u.map(d=>d.unpaired).filter(d=>d==null?void 0:d.length)).filter(u=>u==null?void 0:u.length),c=s.map(u=>u.map(d=>d.pairedNoConflict).filter(d=>d==null?void 0:d.length)).filter(u=>u==null?void 0:u.length).sort((u,d)=>(d.length||0)-(u.length||0));return{unassigned:o,unpaired:l,pairedNoConflict:c}}else{let o=s.map(u=>u.map(d=>d.unassigned).filter(d=>d==null?void 0:d.length)).filter(u=>u==null?void 0:u.length),l=s.map(u=>u.map(d=>d.unpaired).filter(d=>d==null?void 0:d.length)).filter(u=>u==null?void 0:u.length),c=s.map(u=>u.map(d=>d.pairedNoConflict).filter(d=>d==null?void 0:d.length)).filter(u=>u==null?void 0:u.length);return{unassigned:o,unpaired:l,pairedNoConflict:c}}}function oIe({positionAssignments:t,participantIds:e}){let i=t.map(n=>n.participantId);return e.filter(n=>!i.includes(n))}function AWe({useSpecifiedGroupKey:t=!1,targetParticipantIds:e,largestFirst:i=!0,allGroups:n,groupKey:r}){var a;let s=Object.assign({},...Object.keys(n).map(u=>[u,n[u].filter(d=>e.includes(d))]).filter(u=>u[1].length).map(([u,d])=>({[u]:d}))),o=Object.keys(s).reduce((u,d)=>s[d].length>u?s[d].length:u,0),l=Object.keys(s).filter(u=>s[u].length===o),c=Cu(i?l:Object.keys(s));return r=t&&(a=s[r])!=null&&a.length?r:c,{participantId:r&&s[r]?Cu(s[r]):Cu(e),groupKey:r}}function _We({drawPositionGroups:t,positionAssignments:e}){let i=Object.assign({},...e.map(n=>({[n.drawPosition]:n})));return t.map(n=>n.filter(Boolean).map(r=>i[r]).filter(Boolean).filter(r=>!r.participantId&&!r.bye).map(r=>r.drawPosition)).flat().filter(Boolean)}function kWe({candidatePositionAssignments:t,unseededParticipantIds:e,participantIdGroups:i,drawPositionChunks:n,drawPositionGroups:r,pairedPriority:a,allGroups:s,groupKey:o}){let l=r.reduce((U,P)=>P.length>U?P.length:U,0)<=2,c=oIe({positionAssignments:t,participantIds:e}),u=_We({positionAssignments:t,drawPositionGroups:r}),{participantId:d,groupKey:p}=AWe({targetParticipantIds:c,useSpecifiedGroupKey:l,allGroups:s,groupKey:o}),h=MWe({participantId:d,allGroups:s}),f=NWe({positionAssignments:t,isRoundRobin:l,selectedParticipantGroups:h,participantIdGroups:i,drawPositionChunks:n,unfilledPositions:u}),{unassigned:m,unpaired:g,pairedNoConflict:v}=f,y=(v==null?void 0:v.length)&&v[0],b=(g==null?void 0:g.length)&&g[0],I=a&&y?y:b,T=a?b:y,w=(I==null?void 0:I.length)&&I||(T==null?void 0:T.length)&&T,S;if(w!=null&&w.length){let U=Ul(w);S=Ul(U)}else{let U=Ul(m[0]);S=Ul(U)}return{newGroupKey:p,selectedParticipantId:d,targetDrawPosition:S}}function X_({isRoundRobin:t,groupedParticipants:e}){let i=[];return t?e.forEach(n=>{let r=n.map(o=>o.drawPosition),a=E8({drawPositions:r}).uniqueMatchUpGroupings??[],s=Object.assign({},...n.map(o=>({[o.drawPosition]:o})));a.forEach(o=>{vo(s[o[0]].values||[],s[o[1]].values||[])&&(i.push(o),n.conflict=!0)})}):e.forEach(n=>{var r,a;vo(((r=n[0])==null?void 0:r.values)||[],((a=n[1])==null?void 0:a.values)||[])&&(i.push(n),n.conflict=!0)}),i}function xWe({positionedParticipants:t,potentialDrawPositions:e,drawPositionGroups:i,avoidanceConflicts:n,isRoundRobin:r}){return n.map(a=>{let s=a.map(o=>o.drawPosition);return a.filter(o=>e.includes(o.drawPosition)).map(o=>{let l=e.filter(c=>!(s!=null&&s.includes(c))).filter(c=>{let u=i.find(m=>m.includes(c)).find(m=>m!==c),d=t.find(m=>m.drawPosition===u),p=X_({isRoundRobin:r,groupedParticipants:[[o,d]]}),h=[t.find(m=>m.drawPosition===c),d],f=X_({isRoundRobin:r,groupedParticipants:[h]});return!p.length&&!f.length});if(l.length)return{drawPosition:o.drawPosition,possibleDrawPositions:l}}).filter(Boolean)}).flat(1)}function QX(t){let{initialPositionAssignments:e,participantsWithGroupings:i,opponentsToPlaceCount:n,unseededByePositions:r,drawPositionGroups:a,policyAttributes:s,idCollections:o,allGroups:l}=t,c=[],u,d=Math.min(...(a||[]).map(b=>b==null?void 0:b.length).filter(Boolean)),p=d>2,h=$t(e,!1,!0).filter(b=>!b.qualifier),f=e.filter(b=>!b.participantId&&(!b.bye||(r==null?void 0:r.includes(b.drawPosition)))).map(b=>b.drawPosition);Mt(0,n).forEach(()=>{let{newGroupKey:b,selectedParticipantId:I,targetDrawPosition:T}=kWe({...t,candidatePositionAssignments:h,allGroups:l,groupKey:u});u=b,h.forEach(w=>{w.drawPosition===T&&(w.participantId=I)})});let m=XX({candidatePositionAssignments:h,participantsWithGroupings:i,policyAttributes:s,idCollections:o}),g=Na(m,d),v=X_({groupedParticipants:g,isRoundRobin:p}),y=0;for(;y<20&&v.length;){let b=xWe({positionedParticipants:m,potentialDrawPositions:f,avoidanceConflicts:v,drawPositionGroups:a,isRoundRobin:p});if(b.length){let I=OWe({candidatePositionAssignments:h,swapOptions:b});I.error&&console.log({result:I}),m=XX({candidatePositionAssignments:h,participantsWithGroupings:i,policyAttributes:s,idCollections:o}),g=Na(m,d),v=X_({groupedParticipants:g,isRoundRobin:p}),y++}else y=20}return h.forEach(b=>{if(b.bye&&b.participantId){let I=xj;c.push(I)}if(b.qualifier&&b.participantId){let I=xj;c.push(I)}}),{positionAssignments:h,conflicts:v.length,groupedParticipants:g,errors:c}}function OWe({candidatePositionAssignments:t,swapOptions:e}){let i=Ul(e);if(!i)return{error:{message:"No swap options"}};let n=i.drawPosition,r=Ul(i.possibleDrawPositions),a=t.find(c=>c.drawPosition===n),s=t.find(c=>c.drawPosition===r)??{},o={participantId:s==null?void 0:s.participantId,qualifier:s==null?void 0:s.qualifier,bye:s==null?void 0:s.bye},l={participantId:a.participantId,qualifier:a.qualifier,bye:a.bye};return Object.assign(a,o),Object.assign(s,l),{...pe}}function LWe({provisionalPositioning:t,unseededParticipantIds:e,inContextDrawMatchUps:i,unseededByePositions:n,tournamentRecord:r,drawDefinition:a,seedBlockInfo:s,participants:o,matchUpsMap:l,structureId:c,avoidance:u,drawSize:d,event:p}){var h;if(!u)return{error:vge};let{candidatesCount:f=1,policyAttributes:m,targetDivisions:g}=u,{roundsToSeparate:v}=u,y="randomUnseededSeparation",{structure:b}=fi({drawDefinition:a,structureId:c}),{matchUps:I}=Sn({provisionalPositioning:t,matchUpsMap:l,structure:b,event:p});if(g&&kd(g)&&!v){let j=vHe(g)||0,B=I.reduce((z,W)=>W.roundNumber>z?W.roundNumber:z,0);v=B<j?1:B-j+1}let{positionAssignments:T}=Aa({structure:b}),w=oF({participantsProfile:{convertExtensions:!0},deepCopy:!1,participants:o}).participantsWithGroupings,S=T==null?void 0:T.filter(j=>!j.participantId),U=T==null?void 0:T.map(j=>j.drawPosition),P=(b==null?void 0:b.structureType)===Eo,E=P?{structure:b,matchUps:I,allDrawPositions:U,roundsToSeparate:v}:{matchUps:I,allDrawPositions:U,roundsToSeparate:v},{drawPositionGroups:R,drawPositionChunks:C}=P?FWe(E):$We(E),M={groupParticipants:o.filter(j=>j.participantType===gc).map(j=>j.participantId),teamParticipants:o.filter(j=>j.participantType===Pn).map(j=>j.participantId),pairParticipants:o.filter(j=>j.participantType===Ai).map(j=>j.participantId)},_=PWe({targetParticipantIds:e,policyAttributes:m,idCollections:M,participants:o});if(_.error)return fe({result:_,stack:y});let A=Object.assign({},...e.map(j=>{let B=Object.keys(_).filter(z=>(_[z]??[]).includes(j));return{[j]:B}})),N=oIe({participantIds:e,positionAssignments:T});if(N.length>((S==null?void 0:S.length)||0))return{error:Z5};let k,O=N.length,$=Mt(0,f).map(()=>QX({initialPositionAssignments:T,participantsWithGroupings:w,unseededParticipantIds:e,opponentsToPlaceCount:O,pairedPriority:!1,unseededByePositions:n,participantIdGroups:A,drawPositionChunks:C,drawPositionGroups:R,policyAttributes:m,idCollections:M,allGroups:_,drawSize:d}));if(k=$.reduce((j,B)=>!j||(B.conflicts||0)<(j.conflicts||0)?B:j,void 0),!k||k.conflicts){let j=Mt(0,f).map(()=>QX({initialPositionAssignments:T,participantsWithGroupings:w,unseededParticipantIds:e,opponentsToPlaceCount:O,pairedPriority:!0,unseededByePositions:n,participantIdGroups:A,drawPositionChunks:C,drawPositionGroups:R,policyAttributes:m,idCollections:M,allGroups:_,drawSize:d}));k=$.concat(...j).filter(B=>{var z;return!((z=B.errors)!=null&&z.length)}).reduce((B,z)=>!B||(z.conflicts||0)<(B.conflicts||0)?z:B,void 0)}if(!k)return{error:ML};let F=(((h=Gn({structure:b}))==null?void 0:h.positionAssignments)??[]).filter(j=>j.participantId).map(j=>j.participantId),V=k.positionAssignments.filter(j=>!F.includes(j.participantId));for(let j of V)if(j.bye){let B=yc({tournamentRecord:r,drawDefinition:a,seedBlockInfo:s,structureId:c,matchUpsMap:l,event:p,...j});if(B.error)return fe({result:B,stack:y})}else if(j.participantId){let B=Lp({automaticPlacement:!0,inContextDrawMatchUps:i,tournamentRecord:r,drawDefinition:a,seedBlockInfo:s,structureId:c,matchUpsMap:l,event:p,...j});if(B.error)return fe({result:B,stack:y,context:{assignment:j}})}return{...pe}}function FWe(t){let{structure:{structures:e}}=t,i=e.map(n=>n.positionAssignments.map(r=>r.drawPosition));return{drawPositionGroups:i,drawPositionChunks:[i]}}function $We({allDrawPositions:t,roundsToSeparate:e,matchUps:i}){let n=i.filter(u=>u.roundNumber===1).map(u=>u.drawPositions),r=n.flat().sort(ra),a=Math.max(...r),s=t.filter(u=>u>a),o=r.length,l=Mt(o===2?1:2,o).filter(u=>u===_5(u)),c=l.slice(0,e||l.length).reverse().map(u=>Na(r,u));return s.length&&console.log({fedDrawPositions:s}),{drawPositionGroups:n,drawPositionChunks:c}}function BWe({provisionalPositioning:t,inContextDrawMatchUps:e,unseededByePositions:i,multipleStructures:n,tournamentRecord:r,drawDefinition:a,seedBlockInfo:s,participants:o,matchUpsMap:l,structureId:c,structure:u,drawSize:d,event:p}){var h,f;let m="positionUnseededParticipants";u||({structure:u}=fi({drawDefinition:a,structureId:c})),c||({structureId:c}=u);let{positionAssignments:g}=Aa({structure:u}),{seedAssignments:v}=Zc({provisionalPositioning:t,drawDefinition:a,structure:u}),y=v==null?void 0:v.map(R=>R.participantId).filter(Boolean),{stage:b,stageSequence:I}=u,T=b===ri?(f=(h=xi({element:u,name:Yp}))==null?void 0:h.extension)==null?void 0:f.value:void 0,w=Pw({provisionalPositioning:t,drawDefinition:a,stageSequence:I,entryStatuses:ib,structureId:c,roundTarget:T,stage:b}),S=w.filter(R=>!(y!=null&&y.includes(R.participantId))).map(R=>R.participantId),U=g==null?void 0:g.filter(R=>!R.participantId&&!R.bye&&!R.qualifier).map(R=>R.drawPosition);if(!n&&S.length>((U==null?void 0:U.length)||0))return fe({result:{error:Z5},context:{unseededParticipantsCount:S.length,unfilledDrawPositionsCount:U==null?void 0:U.length},stack:m});let{appliedPolicies:P}=fn({tournamentRecord:r,drawDefinition:a,event:p}),E=P==null?void 0:P[zE];if(u.stage===Mr){let R=w.reduce((C,M)=>(C[M.groupingValue]||(C[M.groupingValue]=[]),C[M.groupingValue].push(M.participantId),C),{});Object.keys(R).length&&(E||(E={policyName:"Playoff Avoidance"}),E.policyAttributes||(E.policyAttributes=[]),E.policyAttributes.push({groupings:R}))}return E&&o?LWe({provisionalPositioning:t,unseededParticipantIds:S,inContextDrawMatchUps:e,unseededByePositions:i,tournamentRecord:r,drawDefinition:a,seedBlockInfo:s,participants:o,matchUpsMap:l,structureId:c,avoidance:E,drawSize:d,entries:w}):VWe({provisionalPositioning:t,unseededParticipantIds:S,inContextDrawMatchUps:e,unfilledDrawPositions:U,multipleStructures:n,tournamentRecord:r,drawDefinition:a,seedBlockInfo:s,structureId:c,matchUpsMap:l,drawSize:d,event:p})}function VWe({provisionalPositioning:t,unseededParticipantIds:e,inContextDrawMatchUps:i,unfilledDrawPositions:n,multipleStructures:r,tournamentRecord:a,drawDefinition:s,seedBlockInfo:o,matchUpsMap:l,structureId:c,drawSize:u,event:d}){let p=u>2?co(n):n.reverse();for(let h of e){let f=p.pop();if(!r||f){let m=Lp({provisionalPositioning:t,inContextDrawMatchUps:i,tournamentRecord:a,drawDefinition:s,seedBlockInfo:o,participantId:h,drawPosition:f,matchUpsMap:l,structureId:c,event:d});if(m!=null&&m.error&&console.log("!!!!!",{result:m}),m==null?void 0:m.error)return fe({result:m,stack:"randomUnseededDistribution"})}}return{...pe}}function jWe(t){let e=t.structure??fi(t).structure,i="positionQualifiers",n=[];if(e.stage===ws)return fe({result:{error:Ky},stack:i});let{unplacedRoundQualifierCounts:r,positionAssignments:a,roundDrawPositions:s}=GWe(t);for(let o of Object.keys(r)){let l=a==null?void 0:a.filter(c=>s[o].includes(c.drawPosition)&&!c.participantId&&!c.qualifier&&!c.bye).map(c=>c.drawPosition);if(r[o]>(l||0))return fe({result:{error:Oge},context:{unfilledDrawPositions:l},stack:i});Mt(0,r[o]).forEach(()=>{let c=Ul(l);n.push(c),a==null||a.forEach(u=>{u.drawPosition===c&&(u.qualifier=!0,delete u.participantId,delete u.bye)})})}return{...pe,qualifierDrawPositions:n}}function GWe({drawDefinition:t,structure:e,structureId:i}){e||({structure:e}=fi({drawDefinition:t,structureId:i})),i||({structureId:i}=e);let{positionAssignments:n}=Aa({structure:e}),{stage:r,stageSequence:a}=e,{qualifiersCount:s,roundQualifiersCounts:o}=YU({drawDefinition:t,stageSequence:a,structureId:i,stage:r}),l=(o?Object.keys(o):[]).map(m=>di(m)),{matchUps:c}=Sn({structure:e}),{roundProfile:u}=yo({matchUps:c}),d=Object.assign({},...l.filter(m=>u==null?void 0:u[m]).map(m=>{var g,v;return{[m]:((v=(g=u==null?void 0:u[m])==null?void 0:g.drawPositions)==null?void 0:v.filter(Boolean))??[]}})),p=n==null?void 0:n.filter(m=>m.qualifier).map(m=>m.drawPosition),h=s-((p==null?void 0:p.length)??0),f=p==null?void 0:p.length;return{unplacedRoundQualifierCounts:Object.assign({},...l.map(m=>{let g=n==null?void 0:n.filter(v=>{var y,b;return v.qualifier&&((b=(y=d[m])==null?void 0:y.drawPositions)==null?void 0:b.includes(v.drawPosition))}).map(v=>v.drawPosition);return{[m]:((o==null?void 0:o[m])??0)-((g==null?void 0:g.length)??0)}})),unplacedQualifiersCount:h,placedQualifiersCount:f,roundQualifiersCounts:o,positionAssignments:n,roundDrawPositions:d,qualifiersCount:s}}function eJ({provisionalPositioning:t,inContextDrawMatchUps:e,tournamentRecord:i,appliedPolicies:n,validSeedBlocks:r,drawDefinition:a,seedingProfile:s,seedBlockInfo:o,participants:l,groupsCount:c,structureId:u,matchUpsMap:d,structure:p,event:h}){let f=[],m=[],g=0;if(p||({structure:p}=fi({drawDefinition:a,structureId:u})),u||(u=p==null?void 0:p.structureId),n||(n=fn({drawDefinition:a}).appliedPolicies),!r){let v=p&&Lw({provisionalPositioning:t,appliedPolicies:n,drawDefinition:a,seedingProfile:s,structure:p});v!=null&&v.error&&m.push(v.error),r=v==null?void 0:v.validSeedBlocks}return c=c??(r==null?void 0:r.length)??0,Mt(0,c).forEach(()=>{if(g<(c||0)){let v=HWe({provisionalPositioning:t,inContextDrawMatchUps:e,tournamentRecord:i,drawDefinition:a,seedingProfile:s,seedBlockInfo:o,participants:l,structureId:u,matchUpsMap:d,event:h});v!=null&&v.success&&(g++,f.push(...v.seedPositions??[])),v.error&&m.push({seedPositionError:v.error})}}),m.length?{error:m}:{...pe,seedPositions:f}}function HWe({provisionalPositioning:t,inContextDrawMatchUps:e,tournamentRecord:i,drawDefinition:n,seedingProfile:r,seedBlockInfo:a,participants:s,structureId:o,matchUpsMap:l,event:c}){let{unplacedSeedParticipantIds:u,unfilledPositions:d}=Hbe({provisionalPositioning:t,randomize:!0,drawDefinition:n,seedingProfile:r,seedBlockInfo:a,structureId:o,event:c}),{appliedPolicies:p}=fn({drawDefinition:n}),{avoidance:h}=p??{};h&&s&&(u==null?void 0:u.length)>2;let f=[];for(let m of u){let g=d.pop();if(!g)return{error:AU};f.push(g);let v=Lp({provisionalPositioning:t,inContextDrawMatchUps:e,tournamentRecord:i,drawDefinition:n,seedingProfile:r,participantId:m,seedBlockInfo:a,drawPosition:g,matchUpsMap:l,structureId:o,event:c});if(!v.success)return v}return{...pe,seedPositions:f}}function zWe({provisionalPositioning:t,drawDefinition:e,structure:i}){let{positionAssignments:n}=Aa({structure:i}),{seedAssignments:r}=Zc({provisionalPositioning:t,drawDefinition:e,structure:i}),a=Object.assign({},...(r||[]).filter(s=>s.participantId).map(s=>({[s.participantId]:s})));return n==null?void 0:n.map(s=>a[s.participantId]?{...s,seedNumber:a[s.participantId].seedNumber,seedValue:a[s.participantId].seedValue}:"").filter(Boolean)}function qWe({orderedSortedFirstRoundSeededDrawPositions:t,validSeedBlocks:e,byesToPlace:i}){let n=[];e.forEach(a=>{if(i-n.length>a.drawPositions.length)n.push(...a.drawPositions);else{let s=sG(Na(a.drawPositions,2)),o,l=t[n.length];for(;o=uA(s,l);)n.push(o),l=t[n.length]}});let r=n.map(a=>Array.isArray(a)?co(a):a).flat(1/0);return $me(i)&&e.map(a=>a.seedNumbers[0]).includes(i)?t:r}function uA(t,e){if(Array.isArray(t)&&t.length!==2)return t.pop();if(!Array.isArray(t[0]))return t.includes(e)?t.indexOf(e)?t.pop():t.shift():Math.round(Math.random())?t.pop():t.shift();let i=t[0].flat(1/0).length,n=t[1].flat(1/0).length;if(i===n){let r=t[0].flat(1/0).includes(e)?t[0]:t[1];return uA(e?r:t[Math.round(Math.random())],e)}return i<n?uA(t[1],e):uA(t[0],e)}function sG(t){let e=Math.floor(t.length/2);return t.length>2?[sG(t.slice(0,e)),sG(t.slice(e))]:t}function WWe({provisionalPositioning:t,relevantMatchUps:e,appliedPolicies:i,drawDefinition:n,seedingProfile:r,seedBlockInfo:a,byesToPlace:s,structure:o}){var l;a||(a=Lw({provisionalPositioning:t,appliedPolicies:i,drawDefinition:n,seedingProfile:r,structure:o}));let{isFeedIn:c,isLuckyStructure:u,isContainer:d}=a,{validSeedBlocks:p}=a;(l=i==null?void 0:i.seeding)!=null&&l.containerByesIgnoreSeeding&&(p=[]);let h=zWe({provisionalPositioning:t,drawDefinition:n,structure:o})??[],f=Pi([].concat(...e.map(T=>T.drawPositions))),m=h.filter(T=>f.includes(T.drawPosition)),g=(T,w)=>IT(T.seedValue)-IT(w.seedValue),v=p.reduce((T,w)=>{let S=m.filter(U=>{var P;return(P=w.drawPositions)==null?void 0:P.includes(U.drawPosition)}).sort(g);return T.concat(...S)},[]).map(T=>T.drawPosition),y=qWe({orderedSortedFirstRoundSeededDrawPositions:v,validSeedBlocks:p,byesToPlace:s}),b=tJ({orderedSeedDrawPositions:v,relevantMatchUps:e}).slice(0,s),I=tJ({orderedSeedDrawPositions:y,relevantMatchUps:e}).slice(0,s);return{strictSeedOrderByePositions:b,blockSeedOrderByePositions:I,isLuckyStructure:u,positionedSeeds:h,isContainer:d,isFeedIn:c}}function tJ({orderedSeedDrawPositions:t,relevantMatchUps:e}){let i=e.map(n=>n.drawPositions).map(n=>n==null?void 0:n.sort((r,a)=>r-a)).filter(n=>(n==null?void 0:n[0])+1===(n==null?void 0:n[1]));return t.map(n=>i.find(r=>r==null?void 0:r.includes(n))).filter(Boolean).map(n=>n==null?void 0:n.reduce((r,a)=>t.includes(a)?r:a,void 0)).filter(Boolean)}function YWe({provisionalPositioning:t,seedOrderByePositions:e,isLuckyStructure:i,appliedPolicies:n,drawDefinition:r,seedLimit:a,structure:s,isFeedIn:o}){var l,c;let u=(l=n==null?void 0:n.seeding)==null?void 0:l.seedingProfile,d=s.stage===ri,{positionAssignments:p}=Aa({structure:s}),h=p==null?void 0:p.filter(k=>k.participantId).map(k=>k.drawPosition),f={isCollectionMatchUp:!1},{matchUps:m,roundMatchUps:g}=Sn({provisionalPositioning:t,matchUpFilters:f,structure:s}),v=(g==null?void 0:g[1])||[],y=s.structureType===Eo?m:v,b=Pi([].concat(...y.map(k=>k.drawPositions))),I=Math.min(...b)-1,T=h==null?void 0:h.filter(k=>b.includes(k)),w=k=>{let O=Math.ceil(k.length/2),$=[k.slice(0,O),k.slice(O)],F=$.map(Q=>[].concat(...Q.flat(1/0)).length),V=Math.min(...F.flat(1/0)),j=Math.max(...F.flat(1/0)),B=F.indexOf(j),z=V!==j,W=co($),[Z,K]=!V||z?[$[B],$[1-B]]:[W[0],W[1]];return{greaterHalf:Z,lesserHalf:K}},S=k=>{let{greaterHalf:O,lesserHalf:$}=w(k),{greaterHalf:F,lesserHalf:V}=w(O),j=co(F.flat(1/0)).pop(),B=F.flat().filter(z=>z!==j);return{newlyFilteredChunks:[...$,...V,B],drawPosition:j}},U=k=>!e.includes(k),P=k=>!(T!=null&&T.includes(k)),E=k=>{let O=Na(k.sort(ra),Math.ceil(k.length/4)).map(V=>V.filter(P)),$=[].concat(...O.flat(1/0)).length,F=[];for(let V=0;V<$;V++){let{newlyFilteredChunks:j,drawPosition:B}=S(O);F.push(B),O=j}return F},{validSeedBlocks:R}=Lw({provisionalPositioning:t,allPositions:!0,appliedPolicies:n,drawDefinition:r,structure:s}),C=R==null?void 0:R.map(k=>{var O;return(O=k.drawPositions)==null?void 0:O.map($=>$+I)}),M;if(o){let k=b.length,{seedBlocks:O}=P8({cluster:jR(u)===VL,participantsCount:k});M=O.map($=>$.map(F=>F+I)).map(E).filter($=>$.length)}else d?M=C==null?void 0:C.map(k=>k.filter(P)):M=C==null?void 0:C.map(E).filter(k=>k.length);let _=y.map(k=>k.drawPositions).map(k=>k==null?void 0:k.sort((O,$)=>O-$)).filter(k=>(k==null?void 0:k[0])+1===(k==null?void 0:k[1])),A=k=>_.reduce((O,$)=>$.includes(k)?$.reduce((F,V)=>V!==k?V:F,void 0):O,void 0),N=M.map(k=>k.map(A)).flat(1/0).filter(P).filter(U).filter(Boolean);if(d&&!s.structures){let k=a%4,O=N.slice(0,k),$=(c=g[s.roundLimit])==null?void 0:c.length,F=Na(N.slice(k),$).map(co).flat();N=O.concat(F)}return{unseededByePositions:N}}function KWe({provisionalPositioning:t,drawDefinition:e,matchUpsMap:i,structure:n,event:r}){var a;let s={isCollectionMatchUp:!1},{matchUps:o,roundMatchUps:l}=Sn({afterRecoveryTimes:!1,provisionalPositioning:t,drawDefinition:e,matchUpFilters:s,matchUpsMap:i,structure:n,event:r}),c=(l==null?void 0:l[1])||[],u=(n==null?void 0:n.structureType)===Eo,d=u?o:c,p=u?((a=n==null?void 0:n.structures)==null?void 0:a.length)||0:o.length,{structureId:h,stage:f,stageSequence:m}=n,g=Pw({entryStatuses:sd,provisionalPositioning:t,drawDefinition:e,stageSequence:m,structureId:h,stage:f}),{qualifiersCount:v}=YU({provisionalPositioning:t,drawDefinition:e,stageSequence:m,structureId:h,stage:f}),y=g.length+v,{positionAssignments:b,unassignedPositions:I}=Aa({structure:n}),T=I==null?void 0:I.map(R=>R.drawPosition),w=b==null?void 0:b.filter(R=>R.bye).length,S=b==null?void 0:b.filter(R=>R.bye).map(R=>R.drawPosition),U=d.map(R=>R.drawPositions).filter(R=>R==null?void 0:R.reduce((C,M)=>!(S!=null&&S.includes(M))&&C,!0)).flat(1/0).filter(R=>T==null?void 0:T.includes(R)),P=b==null?void 0:b.length,E=P?P-y:0;return E>p&&n.stageSequence===1&&n.stage!==ws&&(E=p),{placedByes:w,byesCount:E,relevantMatchUps:d,placedByePositions:S,roundMatchUps:l,positionsToAvoidDoubleBye:U}}function iJ({provisionalPositioning:t,tournamentRecord:e,appliedPolicies:i,drawDefinition:n,seedBlockInfo:r,seedingProfile:a,matchUpsMap:s,structureId:o,structure:l,seedLimit:c,seedsOnly:u,event:d}){var p;l||({structure:l}=fi({drawDefinition:n,structureId:o})),o||(o=l==null?void 0:l.structureId);let h=!((l==null?void 0:l.structures)??(l==null?void 0:l.stage)===ri),{byesCount:f,placedByes:m,relevantMatchUps:g}=KWe({provisionalPositioning:t,drawDefinition:n,matchUpsMap:s,structure:l,event:d}),v=f-(m||0);if(v<=0)return{...pe};let{strictSeedOrderByePositions:y,blockSeedOrderByePositions:b,isLuckyStructure:I,isFeedIn:T}=WWe({provisionalPositioning:t,relevantMatchUps:g,appliedPolicies:i,drawDefinition:n,seedingProfile:a,seedBlockInfo:r,byesToPlace:v,structure:l}),w=(l==null?void 0:l.structureType)&&[Eo,jL].includes(l.structureType)&&((p=i==null?void 0:i.seeding)==null?void 0:p.containerByesIgnoreSeeding),S=h&&b!=null&&b.length?b:y,{unseededByePositions:U}=YWe({provisionalPositioning:t,seedOrderByePositions:S,isLuckyStructure:I,appliedPolicies:i,drawDefinition:n,seedLimit:c,structure:l,isFeedIn:T}),P=M=>M%2,E=(M,_)=>(M||[]).every(A=>P(A)?_!==A+1:_!==A-1),R=[].concat(...S);if(!u)for(;U.length;){let M=U.find(_=>E(R,_));M?(R.push(M),U=U.filter(_=>_!==M)):(R.push(...U),U=[])}w&&(R=co(R),oc({ignoreSeededByes:w})&&console.log({byePositions:R}));let C=R.slice(0,v);for(let M of C){let _=yc({provisionalPositioning:t,tournamentRecord:e,drawDefinition:n,drawPosition:M,matchUpsMap:s,structureId:o,structure:l,event:d});if(_!=null&&_.error)return _}return{...pe,unseededByePositions:U,byeDrawPositions:C}}function GR(t){var e,i,n,r;let{drawDefinition:a}=t,{applyPositioning:s=!0,provisionalPositioning:o,multipleStructures:l,placeByes:c=!0,tournamentRecord:u,placementGroup:d,seedingProfile:p,structureId:h,seedLimit:f,seedsOnly:m,drawType:g,drawSize:v,event:y}=t,b=[];s||(ave(),a=$t(a,!1,!0));let I=$=>(s||iA(),fe({result:$,stack:"automatedPositioning"})),T=$=>(s||iA(),$),w=fi({drawDefinition:a,structureId:h});if(w.error)return I(w);let S=w.structure;if(!S)return{error:yr};let U=t.appliedPolicies||((e=fn({drawDefinition:a,structure:S,event:y}))==null?void 0:e.appliedPolicies),{qualifiersCount:P}=YU({stageSequence:S.stageSequence,provisionalPositioning:o,stage:S.stage,drawDefinition:a,structureId:h}),E=ib;if(!((i=Pw({stageSequence:S.stageSequence,provisionalPositioning:o,stage:S.stage,placementGroup:d,drawDefinition:a,entryStatuses:E,structureId:h}))!=null&&i.length)&&!P)return T({...pe});let R=t.matchUpsMap??Us({drawDefinition:a}),C=t.inContextDrawMatchUps??((n=pa({inContext:!0,drawDefinition:a,matchUpsMap:R}))==null?void 0:n.matchUps),M=[],_=Lw({provisionalPositioning:o,appliedPolicies:U,drawDefinition:a,seedingProfile:p,structure:S});if(_.error)return _;let{validSeedBlocks:A}=_;b.push({validSeedBlocks:A});let N=t.participants||(u?(r=br({withIndividualParticipants:!0,convertExtensions:!0,tournamentRecord:u}))==null?void 0:r.participants:[]);if(jR(S.seedingProfile||p)===fy){let $=c?iJ({provisionalPositioning:o,tournamentRecord:u,appliedPolicies:U,drawDefinition:a,seedBlockInfo:_,matchUpsMap:R,structure:S,seedLimit:f,seedsOnly:m,event:y}):void 0;if($!=null&&$.error)return I($);M=$.unseededByePositions,b.push({action:"positionByes",unseededByePositions:M});let F=S.seedingProfile?{positioning:S.seedingProfile}:p;if($=eJ({seedingProfile:F,provisionalPositioning:o,inContextDrawMatchUps:C,tournamentRecord:u,appliedPolicies:U,validSeedBlocks:A,drawDefinition:a,seedBlockInfo:_,participants:N,matchUpsMap:R,structure:S,event:y}),$.error)return I($);b.push({seedPositions:$.seedPositions,action:"positionSeedBlocks"})}else{if(g!==Zy){let F=S.seedingProfile?{positioning:S.seedingProfile}:p,V=eJ({seedingProfile:F,provisionalPositioning:o,inContextDrawMatchUps:C,tournamentRecord:u,appliedPolicies:U,validSeedBlocks:A,drawDefinition:a,seedBlockInfo:_,participants:N,matchUpsMap:R,structure:S,event:y});if(V.error)return I(V);b.push({action:"positionSeedBlocks",seedPositions:V.seedPositions})}let $=c?iJ({provisionalPositioning:o,tournamentRecord:u,appliedPolicies:U,drawDefinition:a,seedBlockInfo:_,matchUpsMap:R,structure:S,seedLimit:f,seedsOnly:m,event:y}):void 0;if($!=null&&$.error)return I($);M=$==null?void 0:$.unseededByePositions,b.push({action:"positionByes",byeDrawPositions:$==null?void 0:$.byeDrawPositions,unseededByePositions:M})}let k={};if(!m){let $=jWe({inContextDrawMatchUps:C,tournamentRecord:u,appliedPolicies:U,validSeedBlocks:A,drawDefinition:a,seedBlockInfo:_,participants:N,matchUpsMap:R,structure:S});if($.error||($.conflicts&&(k.qualifierConflicts=$.conflicts),b.push({action:"positionQualifiers",qualifierDrawPositions:$.qualifierDrawPositions}),$=BWe({provisionalPositioning:o,inContextDrawMatchUps:C,unseededByePositions:M,multipleStructures:l,tournamentRecord:u,drawDefinition:a,seedBlockInfo:_,participants:N,matchUpsMap:R,structureId:h,structure:S,drawSize:v,event:y}),$.error))return I($);$.conflicts&&(k.unseededConflicts=$.conflicts),b.push({action:"positionUnseededParticipants"})}let{positionAssignments:O}=Gn({drawDefinition:a,structure:S});return zn({drawDefinition:a,structureIds:[h]}),s||iA(),{positionAssignments:O,conflicts:k,...pe,positioningReport:b}}function XU(t){var e;let{applyPositioning:i=!0,provisionalPositioning:n,tournamentRecord:r,drawDefinition:a,seedingProfile:s,structureId:o,placeByes:l,seedsOnly:c}=t;if(!a)return{error:sc};if(!Eg({drawDefinition:a,structureId:o})&&!n)return{error:k5};let u=(e=rIe({drawDefinition:a,structureId:o}).playoffStructures)==null?void 0:e.sort((h,f)=>H_(h)-H_(f)),d=[],p=[];if(u)for(let h of u){let{structureId:f}=h,m=GR({structureId:f,provisionalPositioning:n,applyPositioning:i,tournamentRecord:r,drawDefinition:a,seedingProfile:s,placeByes:l,seedsOnly:c});if(m.error)return m;m.positionAssignments&&d.push({positionAssignments:m.positionAssignments,structureId:f}),m.positioningReport&&p.push(m.positioningReport)}return{...pe,structurePositionAssignments:d,positioningReports:p}}function lIe({drawDefinition:t,orderMap:e}){return t?((typeof e!="object"||!Object.values(e).every(i=>wi(i)))&&fe({result:{error:Ae},context:{orderMap:e}}),t.structures||(t.structures=[]),t.structures.forEach(i=>{let n=e[i.structureId];n&&(i.structureOrder=n)}),t.structures.sort((i,n)=>iT(i.structureOrder)-iT(n.structureOrder)),{...pe}):{error:Ht}}function SF({drawDefinition:t}){var e,i,n,r,a,s,o;let l=t.structures??[],c=t.links??[],u=new Map,d=S=>{let U=u.get(S)||u.set(S,{drawSources:[],drawTargets:[],progeny:[],sources:[],targets:[]})&&u.get(S);if(U&&!(U!=null&&U.stage)){let P=l.find(E=>E.structureId===S);U.stage=P==null?void 0:P.stage}return U},p={},h={},f=c.map(S=>{let U=S.source.structureId,P=S.target.structureId,E=d(U),R=d(P);return[my,Ru,GL,fy].includes(S.target.feedProfile)?(E==null||E.targets.push(P),R==null||R.sources.push(U)):S.target.feedProfile===vd&&(R==null||R.drawSources.push(U),E==null||E.drawTargets.push(P)),h[P]=h[P]||S.target.feedProfile===vd,p[P]=Pi([...p[P]||[],U]).filter(Boolean),[S.source.structureId,S.target.structureId]});for(let S of u.keys()){let U=u.get(S);if(U){let P=U.targets??[];for(;P.length;){let E=P.pop(),R=E&&u[E];(e=R==null?void 0:R.targets)!=null&&e.length?P.push(...R.targets):R&&(U.rootStage=R.stage)}if(U.rootStage||(U.rootStage=U.stage),!((i=U.targets)!=null&&i.length)){let E=U.sources??[];for(;E.length;){let R=E.pop(),C=R&&u[R];if((n=C==null?void 0:C.sources)!=null&&n.length){for(let M of C.sources)(r=U.progeny)!=null&&r.includes(M)||(a=U.progeny)==null||a.push(M);E.push(...C.sources)}}}}}let m=0;for(let S of u.keys()){let U=u.get(S);if(U&&U.rootStage===ri){let P=[(s=U.drawTargets)==null?void 0:s[0]],E=0;for(;P.length;){E+=1;let R=P.pop(),C=R?u.get(R):void 0;(o=C==null?void 0:C.drawTargets)!=null&&o.length&&P.push(C.drawTargets[0])}U.distanceFromMain=E,E>m&&(m=E)}}let g=f.length;Mt(0,Math.ceil(g/2)).forEach(()=>{f=Mt(0,g).map(S=>{let U=f[S],P=f.reduce((E,R)=>vo(U,R)?E.concat(...R):E,[])||[];return Pi(U.concat(...P))})});let v=f[0],y=(S,U)=>Ar(S,U).length===S.length,b=f.slice(1).reduce((S,U)=>S&&y(U,v),!0),I=[v].filter(Boolean),T=[v].filter(Boolean);l.forEach(S=>{let{structureId:U,stage:P}=S;I.find(E=>E.includes(U))||(I.push([U]),P!==ja&&T.push([U]))});let w=b&&T.length===1;return!(c!=null&&c.length)&&l.length===1&&d(l[0].structureId),{structureProfiles:Object.fromEntries(u),allStructuresLinked:w,maxQualifyingDepth:m,sourceStructureIds:p,hasDrawFeedProfile:h,structureGroups:I}}function cIe({drawDefinition:t}){let{maxQualifyingDepth:e,structureProfiles:i}=SF({drawDefinition:t});for(let n of t.structures){let r=i[n.structureId];r.distanceFromMain&&(n.stageSequence=e+1-r.distanceFromMain)}return{...pe}}function O8(t){let e=ei(t,[{[Ia]:!0,[Po]:!0}]);if(e.error)return e;let{tournamentRecord:i,drawDefinition:n,structure:r,link:a}=t;return ZWe({tournamentId:i.tournamentId,drawDefinition:n,structure:r,link:a})}function ZWe(t){var e;let i=ei(t,[{[Po]:!0,[YL]:!0},{link:!0,[Wo]:tl,[Wme]:$5}]);if(i.error)return i;let{drawDefinition:n,tournamentId:r,structure:a,eventId:s,link:o}=t,l=o.target.structureId,c=fi({drawDefinition:n,structureId:l});if(c.error)return fe({stack:"attachQualifyingStructure",context:{targetStructureId:l},result:c});n.structures||(n.structures=[]),n.links||(n.links=[]),n.structures.push(a),n.links.push(o),cIe({drawDefinition:n});let u=((e=Sn({structure:a}))==null?void 0:e.matchUps)||[];return Tg({drawDefinition:n,tournamentId:r,matchUps:u,eventId:s}),zn({drawDefinition:n,structureIds:[a.structureId]}),{...pe}}function uIe({drawDefinition:t,structureDetails:e}){if(!Array.isArray(e))return{error:Ae};if(!t)return{error:Ht};let i=Object.assign({},...e.map(n=>{if(!tn(n))return;let{structureId:r,structureName:a}=n||{};if(!(!r||!a))return{[r]:a}}).filter(Boolean));if(!Object.values(i).length)return{error:si};for(let n of t.structures||[]){let r=i[n.structureId];if(r&&(n.structureName=r),n.structures)for(let a of n.structures){let s=i[a.structureId];s&&(a.structureName=s)}}return{...pe}}function L8({drawDefinition:t,timeItem:e}){if(!t)return{error:sc};if(!e)return{error:e6};let i=e&&Object.keys(e),n=["itemType","itemValue"];if(n.filter(a=>i.includes(a)).length!==n.length)return{error:Q5};t.timeItems||(t.timeItems=[]);let r=new Date().toISOString();return Object.assign(e,{createdAt:r}),t.timeItems.push(e),bR({drawDefinition:t}),{...pe}}function dIe(t){var e;let{tournamentRecord:i,drawDefinition:n,structureId:r,event:a}=t,s=ei(t,[{drawDefinition:!0,structureId:!0}]);if(s.error)return s;let o=n.structures??[],l=o.find(y=>y.structureId===r);if(!l)return{error:yr};let c=o.find(({stage:y,stageSequence:b})=>y===Bt&&b===1),u=r===(c==null?void 0:c.structureId),d=o.filter(({stage:y})=>y===ri).map(Bl("structureId"));if(u&&!d.length)return{error:Kme};let p=d.includes(r),h=XWe({isQualifyingStructure:p,structure:l,...t});if(h!=null&&h.error)return h;let{structureIdsToRemove:f,relatedStructureIdsMap:m}=QWe({qualifyingStructureIds:d,isQualifyingStructure:p,isMainStageSequence1:u,mainStageSequence1:c,drawDefinition:n,structureId:r}),{removedMatchUpIds:g,removedStructureIds:v}=e4e({relatedStructureIdsMap:m,qualifyingStructureIds:d,isMainStageSequence1:u,mainStageSequence1:c,drawDefinition:n,structureIdsToRemove:f,structureId:r});if(JWe({removedMatchUpIds:g,drawDefinition:n}),u){let y=(e=c.matchUps??[])==null?void 0:e.map(Bl("matchUpId"));g.push(...y),c.positionAssignments=[],c.seedAssignments=[],c.matchUps=[],c.extensions&&(c.extensions=[])}return p&&cIe({drawDefinition:n}),Cm({tournamentId:i==null?void 0:i.tournamentId,matchUpIds:g,action:"removeStructure",eventId:a==null?void 0:a.eventId,drawDefinition:n}),zn({drawDefinition:n,eventId:a==null?void 0:a.eventId}),{...pe,removedMatchUpIds:g,removedStructureIds:v}}function XWe({isQualifyingStructure:t,tournamentRecord:e,drawDefinition:i,structureId:n,structure:r,event:a,force:s}){var o,l,c,u,d,p;let h=[n];if(t){let f=g=>{var v;return(v=i.links)==null?void 0:v.find(y=>y.target.structureId===g)},m=(o=f(n))==null?void 0:o.source.structureId;for(;m;)h.push(m),m=(l=f(m))==null?void 0:l.source.structureId}if((c=pa({matchUpFilters:{structureIds:h},drawDefinition:i}).matchUps)!=null&&c.some(({score:f})=>ya({score:f}))){let f=(u=fn({tournamentRecord:e,drawDefinition:i,structure:r,event:a}))==null?void 0:u.appliedPolicies;if(!(s??((p=(d=f==null?void 0:f[Kc])==null?void 0:d.allowDeletionWithScoresPresent)==null?void 0:p.structures)))return{error:kL}}return{...pe}}function JWe({removedMatchUpIds:t,drawDefinition:e}){let{matchUps:i}=pa({drawDefinition:e});i==null||i.forEach(n=>{n.winnerMatchUpId&&t.includes(n.winnerMatchUpId)&&delete n.winnerMatchUpId,n.loserMatchUpId&&t.includes(n.loserMatchUpId)&&delete n.loserMatchUpId})}function QWe({qualifyingStructureIds:t,isQualifyingStructure:e,isMainStageSequence1:i,mainStageSequence1:n,drawDefinition:r,structureId:a}){let s=(r.structures??[]).map(Bl("structureId")),o=u=>{var d;return((d=r.links)==null?void 0:d.map(p=>p.source.structureId===u&&p.target.structureId!==(n==null?void 0:n.structureId)&&p.target.structureId).filter(Boolean))??[]},l=u=>{var d;return((d=r.links)==null?void 0:d.map(p=>t.includes(p.source.structureId)&&p.target.structureId===u&&p.source.structureId).filter(Boolean))??[]},c=new Map;return s.forEach(u=>c.set(u,e?l(u):o(u))),{structureIdsToRemove:i?c.get(a):[a],relatedStructureIdsMap:c}}function e4e({relatedStructureIdsMap:t,qualifyingStructureIds:e,isMainStageSequence1:i,mainStageSequence1:n,drawDefinition:r,structureIdsToRemove:a,structureId:s}){let o=[],l=[];for(;a!=null&&a.length;){let c=a.pop();l.push(...n4e({idBeingRemoved:c,drawDefinition:r}));let u=i4e({qualifyingStructureIds:e,isMainStageSequence1:i,idBeingRemoved:c,drawDefinition:r,structureId:s});o.push(...u.removedStructureIds);let d=t4e({relatedStructureIdsMap:t,mainStageSequence1:n,idBeingRemoved:c,structureId:s});d!=null&&d.length&&a.push(...d)}return{removedMatchUpIds:l,removedStructureIds:o}}function t4e({idBeingRemoved:t,relatedStructureIdsMap:e,mainStageSequence1:i,structureId:n}){var r;return t&&((r=e.get(t))==null?void 0:r.filter(a=>a!==(i==null?void 0:i.structureId)||n===i.structureId))}function i4e({qualifyingStructureIds:t,isMainStageSequence1:e,idBeingRemoved:i,drawDefinition:n,structureId:r}){var a;let s=[];return n.links=((a=n.links)==null?void 0:a.filter(o=>o.source.structureId!==i&&o.target.structureId!==i))??[],(!e||e&&t.length||i!==r)&&(n.structures=(n.structures??[]).filter(o=>(i&&i===o.structureId&&s.push(i),o.structureId!==i))),{removedStructureIds:s}}function n4e({idBeingRemoved:t,drawDefinition:e}){let{structure:i}=fi({structureId:t,drawDefinition:e}),n=Sn({structure:i}).matchUps;return L6(n)}function J_({stageSequence:t=1,drawDefinition:e,drawSize:i,stage:n}){if(!e)return{error:Ht};if(!o8({drawDefinition:e,stage:n}))return{error:Ky};let r=r3e({drawDefinition:e,stage:n}),{qualifiersCount:a}=YU({drawDefinition:e,stageSequence:t,stage:n}),s=r+a;if(i<s)return{error:F5};let{entryProfile:o}=s8({attributes:[{[n]:{drawSize:i}}],drawDefinition:e});return zn({drawDefinition:e}),{...pe,entryProfile:o}}function pIe({qualifiersCount:t=0,drawDefinition:e,stage:i}){return e?o8({drawDefinition:e,stage:i})?i!==Bt?{error:F5,info:"qualifiersCount can only be set for main stage"}:(s8({attributes:[{[i]:{qualifiersCount:t}}],drawDefinition:e}),zn({drawDefinition:e}),{...pe}):{error:Ky}:{error:Ht}}function r4e({drawDefinition:t,drawSize:e}){if(!t)return{error:Ht};let i=J_({stage:ja,stageSequence:1,drawDefinition:t,drawSize:e});return i.error?i:(zn({drawDefinition:t}),{...pe})}function hIe(t){return r4e(t)}var a4e="qualifierDrawPositionAssignment",s4e="withdrawParticipantAtDrawPosition",o4e="alternateDrawPositionAssignment",l4e="luckyLoserDrawPositionAssignment",nJ="removeDrawPositionAssignment",fIe="swapDrawPositionAssignments",c4e="modifyPairAssignment",u4e="adHocPositionSwap",d4e="modifyParticipantOtherName",rJ="assignDrawPosition",p4e="removeSeededParticipant",h4e="assignDrawPositionBye",f4e="modifySeedAssignment",mIe="addPenalty",F8="MODIFY_PAIR",TF="QUALIFIER",$8="ALTERNATE",B8="WITHDRAW",RI="ASSIGN",oG="REMOVE",V8="LUCKY",DD="REMOVE_SEED",UF="SWAP",JE="NICKNAME",Xb="SEED_VALUE",MI="PENALTY",Q_="BYE",m4e={MODIFY_PAIR_ASSIGNMENT:F8,QUALIFYING_PARTICIPANT:TF,ALTERNATE_PARTICIPANT:$8,WITHDRAW_PARTICIPANT:B8,ASSIGN_PARTICIPANT:RI,LUCKY_PARTICIPANT:V8,REMOVE_ASSIGNMENT:oG,SWAP_PARTICIPANTS:UF,ADD_NICKNAME:JE,REMOVE_SEED:DD,ADD_PENALTY:MI,ASSIGN_BYE:Q_,SEED_VALUE:Xb};function gIe({tournamentRecord:t,drawDefinition:e,drawPositions:i,structureId:n,event:r}){if(!e)return{error:Ht};if(!n)return{error:mc};if((i==null?void 0:i.length)!==2)return{error:Ae,drawPositions:i};let a=Us({drawDefinition:e}),{matchUps:s}=pa({inContext:!0,drawDefinition:e,matchUpsMap:a}),{structure:o}=fi({drawDefinition:e,structureId:n});if(!o)return{error:yr};let l=fn({tournamentRecord:t,drawDefinition:e,event:r}).appliedPolicies??{},c;if(o.structureType===Eo?c=y4e({inContextDrawMatchUps:s,tournamentRecord:t,drawDefinition:e,drawPositions:i,matchUpsMap:a,structure:o,event:r}):c=g4e({inContextDrawMatchUps:s,tournamentRecord:t,drawDefinition:e,drawPositions:i,matchUpsMap:a,structure:o,event:r}),c.error)return c;if(t8({structure:o,drawPositions:i}),aF({appliedPolicies:l,drawDefinition:e,positionAction:{name:fIe,drawPositions:i,structureId:n}}),Ug({tournamentId:t==null?void 0:t.tournamentId,drawDefinition:e,structure:o,event:r}),r.eventType===Fl){let u=Sn({matchUpFilters:{matchUpTypes:[ac]},inContext:!0,structure:o}).matchUps.filter(p=>{var h;return(h=p.drawPositions)==null?void 0:h.some(f=>i.includes(f))}),d=Sn({matchUpFilters:{matchUpTypes:[ac]},structure:o}).matchUps;u.forEach(p=>{(p.sides||[]).forEach(h=>{var f;let m=h==null?void 0:h.drawPosition;if(i.includes(m)){let g=h.participantId,v=d.find(({matchUpId:b})=>b===p.matchUpId),y=(f=p==null?void 0:p.sides)==null?void 0:f.reduce((b,I,T)=>I.drawPosition===m?T:b,void 0);M8({inContextTargetMatchUp:p,drawPositionSideIndex:y,teamParticipantId:g,tournamentRecord:t,drawDefinition:e,matchUp:v,event:r})}})})}return zn({drawDefinition:e,structureIds:[n]}),{...pe}}function g4e({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,drawPositions:n,matchUpsMap:r,structure:a,event:s}){let o=a==null?void 0:a.positionAssignments.filter(c=>n==null?void 0:n.includes(c.drawPosition));if(!o)return{error:Ae,structure:a,info:"Missing positionAssignments"};if(o.filter(({bye:c})=>c).length===2)return{...pe};if(o.filter(({qualifier:c})=>c).length===2)return{...pe};let l=o.some(({qualifier:c})=>c);return o.some(({bye:c})=>c)&&!l?vIe({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,assignments:o,matchUpsMap:r,structure:a,event:s}):v4e({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,assignments:o,matchUpsMap:r,structure:a,event:s})}function vIe({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,assignments:n,matchUpsMap:r,structure:a,event:s}){let o=n.find(({bye:f})=>f),l=n.find(({participantId:f})=>f),c=o.drawPosition,{participantId:u,drawPosition:d}=l,{structureId:p}=a,h=XE({drawPosition:c,inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,structureId:p,matchUpsMap:r});return h.error||(h=XE({drawPosition:d,inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,structureId:p,matchUpsMap:r}),h.error)||(yc({drawPosition:d,tournamentRecord:e,drawDefinition:i,structureId:p,matchUpsMap:r,event:s}),h=Lp({drawPosition:c,inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,structureId:p,participantId:u,matchUpsMap:r,event:s}),h.error)?h:{...pe}}function v4e({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,assignments:n,matchUpsMap:r,structure:a,event:s}){let o=Object.assign({},...n.map((l,c)=>{let{drawPosition:u}=l,d={...n[1-c],drawPosition:u};return{[u]:d}}));return a.positionAssignments=a.positionAssignments.map(l=>o[l.drawPosition]||l),A8({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,matchUpsMap:r,assignments:n,structure:a,event:s}),{...pe}}function y4e({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,drawPositions:n,matchUpsMap:r,structure:a,event:s}){var o;let l=(o=a.structures)==null?void 0:o.reduce((u,d)=>{let p=d==null?void 0:d.positionAssignments.filter(h=>n==null?void 0:n.includes(h.drawPosition));return p&&u.push(...p),u},[]);if(l.filter(({bye:u})=>u).length===2)return{...pe};if(l.filter(({qualifier:u})=>u).length===2)return{...pe};A8({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,matchUpsMap:r,assignments:l,structure:a,event:s});let c=l.some(({qualifier:u})=>u);if(l.some(({bye:u})=>u)&&!c)vIe({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,assignments:l,matchUpsMap:r,structure:a,event:s});else{let u=$t(l,!1,!0);l.forEach((d,p)=>{let h=u[1-p].participantId;d.qualifier=u[1-p].qualifier,d.participantId=h})}return{...pe}}function yIe({tournamentRecord:t,drawDefinition:e,participantId:i,structureId:n}){var r;let a="removeSeededParticipant";if(!t)return{error:dt};if(!e)return{error:Ht};let s=(e.structures??[]).find(o=>o.structureId===n);return s?!s.stage||![Bt,ri].includes(s.stage)||s.stage===Bt&&s.stageSequence!==1?fe({result:{error:Wy},stack:a}):(r=s.seedAssignments)!=null&&r.find(o=>o.participantId===i)?{...pe}:fe({info:"participant not seeded",result:{error:Ya},context:{participantId:i}}):fe({result:{error:yr},stack:a})}function HR({targetEntryRound:t=1,finishingPositions:e,sourceRoundNumber:i,sourceStructureId:n,targetStructureId:r,linkType:a=nm}){return!n||!r?{error:mc}:{link:Zt({linkType:a,source:{roundNumber:i,structureId:n,finishingPositions:e},target:{feedProfile:vd,roundNumber:t,structureId:r}})}}function j8({roundPosition:t,roundNumber:e,idPrefix:i,uuids:n}){return i?`${i}-${e}-${t}`:(n==null?void 0:n.pop())||bn()}function ek({includeMatchUpType:t,matchUpType:e,roundNumber:i,matchUps:n,idPrefix:r,isMock:a,uuids:s,nodes:o}){let l=0,c=[],u=1,d=i-1,p=o==null?void 0:o.length;for(;l<(p||0);){let h=o==null?void 0:o[l],f=o==null?void 0:o[l+1];d&&(h.roundNumber=d),f&&d&&(f.roundNumber=d);let m=j8({roundPosition:u,roundNumber:i,idPrefix:r,uuids:s}),g={roundPosition:u,children:[h,f],matchUpId:m};c.push(g);let v={drawPositions:g.children.map(y=>y==null?void 0:y.drawPosition).filter(Boolean),matchUpStatus:jr,matchUpId:g.matchUpId,roundPosition:u,roundNumber:i};t&&e&&(v.matchUpType=e),a&&(v.isMock=!0),n.push(v),u++,l+=2}return{roundNodes:c,matchUps:n}}function Fp({finishingPositionOffset:t,finishingPositionLimit:e,qualifyingRoundNumber:i,qualifyingPositions:n,matchUpType:r,roundLimit:a,idPrefix:s,drawSize:o,isMock:l,uuids:c}){if(isNaN(o)||o<2||n&&o<=n)return{matchUps:[],roundsCount:0};if(n&&(!kd(o)||o%n)){let g=n;for(;g<o;)g=2*g;o=g}let u=n&&!(o%2)&&(!isNaN(n)||i&&!isNaN(i))&&(o/n===Math.round(o/n)||i&&o/i===Math.round(o/i));if(!kd(o)&&!u)return{matchUps:[],roundsCount:0};let d=Mt(1,o+1).map(g=>({drawPosition:g})),p,h=[],f=1;for({roundNodes:p,matchUps:h}=ek({matchUpType:r,roundNumber:f,idPrefix:s,matchUps:h,isMock:l,nodes:d,uuids:c}),f++,a=a??i;p.length>1;)n&&p.length===n&&(a=f-1),{roundNodes:p,matchUps:h}=ek({nodes:p,matchUpType:r,roundNumber:f,idPrefix:s,matchUps:h,isMock:l,uuids:c}),f++;let m=f-1;return h=_R({finishingPositionOffset:t,finishingPositionLimit:e,roundsCount:m,roundLimit:a,matchUps:h}),a?h=h.filter(g=>a&&(g.roundNumber??0)<=a):a=f-1,{drawSize:o,matchUps:h,roundsCount:m,roundLimit:a}}function G8(t){var e,i,n,r,a,s;let o="generateQualifyingStructure";if(!t.drawDefinition)return fe({result:{error:Ht},stack:o});if(t.drawSize&&!wi(t.drawSize)||t.participantsCount&&!wi(t.participantsCount)||t.qualifyingPositions&&!wi(t.qualifyingPositions))return fe({result:{error:Ae},stack:o});let l=t.drawSize??A5(t.participantsCount),{qualifyingRoundNumber:c,qualifyingPositions:u,targetStructureId:d,structureOptions:p,appliedPolicies:h,drawDefinition:f,matchUpFormat:m,structureName:g,structureId:v,roundTarget:y,drawType:b,idPrefix:I,isMock:T,uuids:w}=t;if(!t.drawSize)return fe({result:{error:rR},context:{drawSize:l},stack:o});if(u&&u>=t.drawSize)return fe({result:{error:Ae},context:{drawSize:l,qualifyingPositions:u},stack:o});let S,U,P,E,R=0,C,M=1,{structureProfiles:_}=SF({drawDefinition:f}),A=_[d];if(!A)return fe({result:{error:yr},context:{targetStructureId:d},stack:o});let N=f.matchUpType,k=y?`${y}-`:"",O=A.stage===ri,$=((i=(e=h==null?void 0:h[mT])==null?void 0:e.namingConventions)==null?void 0:i.pre)??((r=(n=l3e[mT])==null?void 0:n.namingConventions)==null?void 0:r.pre),F=O&&$?`${$}-`:"",V=g??(k?`${F}${ys(ri)} ${k}`:`${F}${ys(ri)}`);if(b===Zu){let{maxRoundNumber:z,structures:W,groupCount:Z}=BR({structureName:g??V,structureId:v??(w==null?void 0:w.pop()),stage:ri,structureOptions:p,appliedPolicies:h,stageSequence:M,matchUpType:N,roundTarget:y,idPrefix:I,drawSize:l,isMock:T,uuids:w});R=Z,S=z,P=W[0],C=[1]}else({drawSize:l,matchUps:E,roundLimit:S,roundsCount:U}=Fp({qualifyingRoundNumber:c,qualifyingPositions:u,matchUpType:N,idPrefix:I,drawSize:l,isMock:T,uuids:w})),S||(S=U),P=$c({structureName:g??V,structureId:v??(w==null?void 0:w.pop()),qualifyingRoundNumber:S,stage:ri,matchUpFormat:m,stageSequence:M,matchUpType:N,roundLimit:S,matchUps:E}),y&&pn({extension:{name:Yp,value:y},element:P}),R=(a=E==null?void 0:E.filter(z=>z.roundNumber===S))==null?void 0:a.length;let j=b===Zu?im:nm,B=P&&S&&((s=HR({sourceStructureId:P.structureId,sourceRoundNumber:S,targetStructureId:d,finishingPositions:C,linkType:j}))==null?void 0:s.link);return{qualifyingDrawPositionsCount:l,qualifiersCount:R,...pe,structure:P,link:B}}function bIe(t){if(!t.tournamentRecord)return{error:dt};let e=b4e(t);return e.error,e}function b4e(t){if(!t.drawDefinition)return{error:Ht};if(!t.targetStructureId)return{error:mc};let e=G8(t);if(e.error)return e;let{structure:i,link:n}=e;return!i||!n?{error:Ae}:O8({tournamentRecord:t.tournamentRecord,drawDefinition:t.drawDefinition,structure:i,link:n})}function IIe(t){var e;let i=ei(t,[{[Po]:!0,[zL]:!0,[Wp]:!0},{[cqe]:!0,[ps]:p=>Number.isInteger(p)&&p>0},{[ps]:p=>Array.isArray(p)&&p.length===2&&p.every(ur),[cc]:Pl,participantIds:!0}]);if(i.error)return i;let{drawDefinition:n,structureId:r,tournamentRecord:a,event:s}=t,{structure:o}=fi({drawDefinition:n,structureId:r});if(!o)return{error:yr};if(!Ho({structure:o}))return{error:Wy};let l=p=>{var h;return(h=p.sides)==null?void 0:h.map(f=>f.participantId).some(f=>t.participantIds.includes(f))},c=p=>p.roundNumber===t.roundNumber,u=p=>!ya(p),d=((o==null?void 0:o.matchUps)??[]).filter(c).filter(u).filter(l);if(d.length!==2)return{error:Pl};for(let p of d){let h=(e=p==null?void 0:p.sides)==null?void 0:e.find(f=>t.participantIds.includes(f==null?void 0:f.participantId));if(h){let f=t.participantIds.find(m=>m!==(h==null?void 0:h.participantId));h.participantId=f,Qi({tournamentId:a==null?void 0:a.tournamentId,eventId:s==null?void 0:s.eventId,drawDefinition:n,matchUp:p})}}return zn({drawDefinition:n,structureIds:[r]}),{...pe}}function I4e({includeMatchUpType:t,drawPosition:e,roundNumber:i,matchUpType:n,idPrefix:r,matchUps:a,isMock:s,uuids:o,nodes:l,fed:c}){let u=l.length,d=e?e-u:void 0,p=Mt(0,u).map(m=>d?d+m:void 0),h=[];for(let m=0;m<u;m++){let g=p.shift(),v={drawPosition:g,fed:c+1,feed:!0},y=l[m];y.roundNumber=i-1;let b=j8({roundPosition:y.roundPosition,roundNumber:i,idPrefix:r,uuids:o}),I={roundPosition:y.roundPosition,drawPositions:[g],matchUpStatus:jr,roundNumber:i,matchUpId:b};t&&(I.matchUpType=n),s&&(I.isMock=!0),a.push(I);let T={children:[y,v]};h.push(T)}let f=e?e-u:void 0;return{roundNodes:h,matchUps:a,drawPosition:f}}function Pg(t){let e=t.drawSize,{feedRoundsProfile:i,feedRounds:n=0,skipRounds:r=0,baseDrawSize:a}=t,{linkFedFinishingRoundNumbers:s,finishingPositionOffset:o,linkFedRoundNumbers:l,feedsFromFinal:c,isConsolation:u,matchUpType:d,idPrefix:p,isMock:h,uuids:f,fmlc:m}=t;a=a??_(e);let g=w4e({drawSize:a}),v=g.length,y=0;if(i!=null&&i.length)y=i.reduce((A,N)=>A+N,0);else if(e){let A=e-a;i=g.filter(N=>N<=A?(A-=N,!0):!1),y=i.reduce((N,k)=>N+k,0),n=i.length}else r>=v?n=0:c&&(n=v-c,r=0),i=g.filter((A,N)=>c&&!n||n&&N>=r+n||N<r?0:A),y=i.reduce((A,N)=>A+N,0),n=i.length;let b=[...g,...i].sort((A,N)=>N-A),I=b.length,T=[...(l??[]).map(A=>A-1),...(s??[]).map(A=>I-A)].map(A=>b[A]).reduce((A,N)=>A+N,0);y=y-T;let w=0,S=[],U,P=1,E=Mt(0,a).map((A,N)=>({drawPosition:N+1+y})),R=y+1;for(let A of g){if({roundNodes:U,matchUps:S}=ek({matchUpType:d,roundNumber:P,idPrefix:p,matchUps:S,isMock:h,nodes:E,uuids:f}),P++,i.includes(A)){let N=Ol(i)[A],k=Mt(0,N),O=I+1-P,$=(s==null?void 0:s.includes(O))??(l==null?void 0:l.includes(P));k.forEach(()=>{({roundNodes:U,matchUps:S,drawPosition:R}=I4e({drawPosition:!$&&R||void 0,nodes:U,matchUpType:d,roundNumber:P,idPrefix:p,matchUps:S,isMock:h,uuids:f,fed:w})),P++,w+=1})}E=U}I!==P-1&&console.log("ERROR");let C=a-y;S=_R({finishingPositionOffset:u?C:o,positionsFed:y,roundsCount:I,matchUps:S,fmlc:m});let M=U!=null&&U.length?U[0]:U;return M&&(M.roundNumber=P-1,M.matchUps=S),{draw:M,matchUps:S,roundsCount:I};function _(A){let N=_5(A);return N>A?N/2:N}}function w4e({drawSize:t}){let e=Math.ceil(Math.log(t)/Math.log(2));return Mt(0,e).reverse().map(i=>Math.pow(2,i))}function gS(t){let{finishingPositionOffset:e=0,addNameBaseToAttributeName:i,playoffStructureNameBase:n,finishingPositionNaming:r,finishingPositionLimit:a,playoffAttributes:s,stageSequence:o=1,exitProfile:l="0",exitProfileLimit:c,roundOffsetLimit:u,roundOffset:d=0,drawDefinition:p,staggeredEntry:h,sequenceLimit:f,stage:m=Bt,drawSize:g,idPrefix:v,isMock:y,uuids:b}=t;if(!(!s||!c||s!=null&&s[l])||g<2||f&&o>f)return{};let I=[],T=[],w=[],S=t.matchUpType??(p==null?void 0:p.matchUpType),U=e+1,P=e+g,E=`${U}-${P}`,R=s==null?void 0:s[l],C=n&&`${n} `||"",M=(s==null?void 0:s[E])??(r==null?void 0:r[E]),_=t.structureName||(M==null?void 0:M.name)||(R==null?void 0:R.name)&&(i?`${C}${R==null?void 0:R.name}`:R.name)||`${C}${E}`,A=(M==null?void 0:M.abbreviation)??(R==null?void 0:R.abbreviation),N=t.structureId??(R==null?void 0:R.structureId)??(b==null?void 0:b.pop()),k={idPrefix:v&&`${v}-${_}-RP`,finishingPositionOffset:e,matchUpType:S,drawSize:g,isMock:y,uuids:b},{matchUps:O}=h?Pg(k):Fp(k),$=$c({structureAbbreviation:A,stageSequence:o,structureName:_,matchUpType:S,roundOffset:d,structureId:N,matchUps:O,stage:m});I.push(...O),T.push($);let F=Math.ceil(Math.log(g)/Math.log(2)),V=u?Math.min(u-d,F):(!a||U<a)&&F||0;return g>2&&Mt(1,V+1).forEach(B=>j(B)),{structureId:$.structureId,matchUps:I,structureName:_,structures:T,links:w,...pe};function j(B){let z=g/Math.pow(2,B);if(z<2)return;let W=g/Math.pow(2,B)+e;if(a&&W+1>a)return;let{structures:Z,structureId:K,matchUps:Q,links:J}=gS({finishingPositionOffset:W,exitProfile:`${l}-${B}`,roundOffset:d+B,stageSequence:o+1,drawSize:z,addNameBaseToAttributeName:i,playoffStructureNameBase:n,finishingPositionNaming:r,finishingPositionLimit:a,playoffAttributes:s,exitProfileLimit:c,roundOffsetLimit:u,drawDefinition:p,sequenceLimit:f,matchUpType:S,idPrefix:v,uuids:b,stage:m});if($.structureId&&K){let se={linkType:Hh,source:{roundNumber:B,structureId:$.structureId},target:{roundNumber:1,feedProfile:Ru,structureId:K}};J&&$&&J.push(se),J!=null&&J.length&&w.push(...J)}return Z!=null&&Z.length&&T.push(...Z),Q!=null&&Q.length&&I.push(...Q),{structureId:K,childLinks:J,structures:T}}}function H8({drawDefinition:t,matchUpsMap:e,structureId:i}){let n=fi({drawDefinition:t,structureId:i});if(n.error)return fe({result:n});let{matchUps:r}=Sn({structure:n.structure,matchUpsMap:e});return{...yo({matchUps:r}),matchUps:r,matchUpsMap:e}}function aJ({finishingPositions:t,drawDefinition:e,structureId:i}){var n;let{roundProfile:r}=H8({drawDefinition:e,structureId:i});return(n=r&&Object.keys(r))==null?void 0:n.reduce((a,s)=>(wIe(r==null?void 0:r[s]).forEach(o=>{t.forEach(l=>{S4e({position:l,rangeDefinition:o})&&(a[l]={roundNumber:s})})}),a),{})}function S4e({position:t,rangeDefinition:e}){if(!Array.isArray(e)||e.reduce((r,a)=>r||isNaN(a),!1))return!1;let[i,n]=e;return Mt(i,(n||i)+1).includes(t)}function wIe(t){var e,i;return[Pi(((e=t==null?void 0:t.finishingPositionRange)==null?void 0:e.loser)||[]),Pi(((i=t==null?void 0:t.finishingPositionRange)==null?void 0:i.winner)||[])]}function T4e(t){return wIe(t).map(e=>Mt(e[0],e[1]&&e[1]+1||e[0]+1))}function JU({drawDefinition:t,structureIds:e,matchUpsMap:i}){if(e&&!Array.isArray(e))return{error:Ae,context:{structureIds:e}};if(!t)return{error:Ht};e=e??(t.structures??[]).filter(a=>a.stage!==ri).map(({structureId:a})=>a);let n=e.map(a=>{var s;let{roundProfile:o}=H8({drawDefinition:t,matchUpsMap:i,structureId:a});return(s=o&&Object.values(o))==null?void 0:s.map(T4e).flat()}).flat(),r=n.filter(a=>(a==null?void 0:a.length)===1).sort(ra).flat();return{positionsNotPlayedOff:Pi(n.flat()).filter(a=>!r.includes(a)),positionsPlayedOff:r}}function SIe({excludeRoundNumbers:t=[],playoffPositions:e=[],drawDefinition:i,structureId:n}){if(!i)return{error:Ht};if(!n)return{error:mc};if(!e)return{error:si,info:"missing playoffPositions"};let r=JU({drawDefinition:i});if(r.error)return r;let a=r.positionsPlayedOff,s=e.filter(v=>!a.includes(v)),o=aJ({finishingPositions:s,drawDefinition:i,structureId:n}),l=Object.values(o).reduce((v,y)=>v.includes(y.roundNumber)?v:v.concat(y.roundNumber),[]).map(v=>di(v)).filter(v=>!t.includes(v)),c=aJ({finishingPositions:a,drawDefinition:i,structureId:n}),u=c?Object.values(c):[],d=c?u.reduce((v,y)=>v.includes(y.roundNumber)?v:v.concat(y.roundNumber),[]).map(v=>di(v)):[],p=l.filter(v=>!d.includes(v)).sort(ra),{roundProfile:h}=H8({drawDefinition:i,structureId:n}),f=p.map(v=>{let y=h==null?void 0:h[v].finishingPositionRange.loser,[b,I]=y??[0,0];return Mt(b,(I||b)+1)}).flat().sort(ra),{playoffRoundsRanges:m}=U4e({playoffSourceRounds:p,roundProfile:h}),g=[...p,...d];return{playoffPositionsReturned:f,playedOffSourceRounds:d,playoffRoundsRanges:m,playoffSourceRounds:p,sourceRounds:g,roundProfile:h}}function U4e({playoffSourceRounds:t,roundProfile:e}){return{playoffRoundsRanges:t.map(i=>{let n=e[i].finishingPositionRange.loser,[r,a]=n,s=Mt(r,(a||r)+1);return{finishingPositionRange:n.join("-"),finishingPositions:s,roundNumber:i}})}}function zR({drawDefinition:t,structureId:e}){if(!t)return{error:Ht};let{matchUps:i,matchUpsMap:n}=po({inContext:!0,drawDefinition:t}),{positionsNotPlayedOff:r,positionsPlayedOff:a}=JU({drawDefinition:t,matchUpsMap:n}),{structures:s}=Ju({drawDefinition:t}),o=s.filter(c=>!e&&c.stage!==ja||c.structureId===e),l={};for(let c of o){let u=c==null?void 0:c.structureId,d=D4e({playoffPositions:r,drawDefinition:t,structure:c,matchUps:i}),{error:p,...h}=d;if(p)return d;l[u]={structureId:u,...h}}return e?{positionsPlayedOff:a,...l[e]}:{availablePlayoffProfiles:Object.values(l),availablePlayoffRounds:Object.values(l),positionsPlayedOff:a}}function D4e({playoffPositions:t,drawDefinition:e,structure:i,matchUps:n}){var r,a,s,o,l,c,u,d,p;let h=i==null?void 0:i.structureId,{links:f}=qU({drawDefinition:e,structureId:h});if(i.structureType===Eo||i.structures){let w=(a=(r=Gn({structure:i}))==null?void 0:r.positionAssignments)==null?void 0:a.length,S=i.structures.length,U=(w??0)/S,P=((s=f.source)==null?void 0:s.flatMap(({source:$})=>($==null?void 0:$.finishingPositions)||[]))||[],E=Mt(1,U+1).filter($=>!P.includes($)),R=((l=(o=n.find($=>$.containerStructureId===h&&$.finishingPositionRange))==null?void 0:o.finishingPositionRange)==null?void 0:l.winner)||[0,1],C=f==null?void 0:f.source.map(({target:$})=>$.structureId),{positionsPlayedOff:M=[],positionsNotPlayedOff:_=[]}=JU({structureIds:C,drawDefinition:e}),A=[...M,..._],N=Mt(R[0],R[1]+1).filter($=>!A.includes($)),k=Na(N,N.length/E.length),O=E.map(($,F)=>{let V=k[F],j=[Math.min(...V||[]),Math.max(...V||[])].join("-");return{finishingPosition:$,finishingPositions:V,finishingPositionRange:j}});return{positionsNotPlayedOff:N,playoffFinishingPositionRanges:O,finishingPositionsAvailable:E,finishingPositionsPlayedOff:P,positionsPlayedOff:M,groupCount:S,groupSize:U}}let m=((c=f==null?void 0:f.source)==null?void 0:c.filter(w=>w.linkCondition!==xp).map(w=>{var S;return(S=w.source)==null?void 0:S.roundNumber}))||[],g=((u=f==null?void 0:f.source)==null?void 0:u.filter(w=>w.linkCondition===xp).map(w=>{var S;return(S=w.source)==null?void 0:S.roundNumber}))||[],v=SIe({excludeRoundNumbers:m,playoffPositions:t,drawDefinition:e,structureId:h}),y=v!=null&&v.playoffSourceRounds?[...(v==null?void 0:v.playoffSourceRounds)||[]]:void 0,b=[...(v==null?void 0:v.playoffRoundsRanges)||[]],{roundProfile:I,error:T}=v;for(let w of g){let S=f==null?void 0:f.source.find(C=>C.source.roundNumber===w),U=S==null?void 0:S.target.roundNumber,P=S==null?void 0:S.target.structureId,E=n.filter(({roundNumber:C,structureId:M})=>M===P&&C===U),R=E.filter(({sides:C})=>C.find(M=>M.participantFed&&!M.participantId)).length;if(y&&R===E.length){y.push(w);let C=(p=(d=I==null?void 0:I[w])==null?void 0:d.finishingPositionRange)==null?void 0:p.loser;if(C){let M=Math.min(...C),_=M+R,A=Mt(M,_),N={finishingPositionRange:[M,_-1].join("-"),finishingPositions:A,roundNumber:w};b.push(N)}}}return y&&y.sort(ra),b.sort((w,S)=>w.roundNumber-S.roundNumber),{playoffRounds:y,playoffRoundsRanges:b,error:T}}function E4e({playoffGroups:t,drawDefinition:e,structureId:i}){var n,r;if(!e)return{error:Ht};if(!ur(i)||!Array.isArray(t))return{error:Ae};let a=t.map(({finishingPositions:s})=>s).flat();return{positionRangeMap:(r=(n=zR({drawDefinition:e,structureId:i}).playoffFinishingPositionRanges)==null?void 0:n.filter(s=>a.includes(s.finishingPosition)))==null?void 0:r.reduce((s,o)=>(s[o.finishingPosition]=o,s),{})}}function TIe(t){var e,i;let{finishingPositionOffset:n=0,playoffAttributes:r,stageSequence:a=1,staggeredEntry:s,structureName:o,stage:l=Bt,matchUpType:c,structureId:u,idPrefix:d,drawSize:p,isMock:h,uuids:f}=t,m={finishingPositionOffset:n,matchUpType:c,drawSize:p,idPrefix:d,isMock:h,uuids:f},{matchUps:g}=s?Pg(m):Fp(m),v=$c({structureName:o||((e=r==null?void 0:r[0])==null?void 0:e.name)||ys(Bt),structureId:u||(f==null?void 0:f.pop()),stageSequence:a,matchUpType:c,matchUps:g,stage:l}),y=[v],b=[];if(p>2){let I=p/2,{matchUps:T}=Fp({finishingPositionOffset:n+I,idPrefix:d&&`${d}-c`,drawSize:I,matchUpType:c,isMock:h}),w=ys(ws),S=((i=r==null?void 0:r["0-1"])==null?void 0:i.name)??t.consolationStructureName??(o?`${o} ${w}`:w),U=$c({structureName:S,matchUps:T,structureId:f==null?void 0:f.pop(),stage:ws,stageSequence:1,matchUpType:c});y.push(U);let P={linkType:Hh,source:{roundNumber:1,structureId:v.structureId},target:{roundNumber:1,feedProfile:Ru,structureId:U.structureId}};b.push(P)}return{...pe,structures:y,links:b}}function UIe({consolationStructure:t,roundOffset:e=0,mainStructure:i,roundsCount:n,feedPolicy:r,fmlc:a}){let s=t.matchUps.reduce((c,u)=>(u.drawPositions||[]).filter(Boolean).length&&!c.includes(u.roundNumber)?c.concat(u.roundNumber):c,[]),o=(r==null?void 0:r.roundGroupedOrder)||[],l=r==null?void 0:r.roundFeedProfiles;return Mt(1+e,n+1+e).map(c=>{let u=l!=null&&l[c-1]?l[c-1]:c%2&&Ru||my,d=c-e<=2?c-e:(c-e-2)*2+2,p={linkType:Hh,source:{roundNumber:c,structureId:i.structureId},target:{feedProfile:u,roundNumber:d,structureId:t.structureId}},h=o[c-1];return h&&(p.target.groupedOrder=h),oc()&&(p.source.structureName=i.structureName,p.target.structureName=t.structureName),c===2&&a&&(p.linkCondition=xp,p.target.feedProfile=Ru),s.includes(d)?p:void 0}).filter(Boolean)}function DIe(t){var e,i;let{playoffStructureNameBase:n,finishingPositionOffset:r,stageSequence:a=1,playoffAttributes:s,structureNameMap:o,staggeredEntry:l,stage:c=Bt,matchUpType:u,structureId:d,drawSize:p,idPrefix:h,isMock:f,uuids:m}=t,g={finishingPositionOffset:r,matchUpType:u,drawSize:p,idPrefix:h,isMock:f,uuids:m},{matchUps:v,roundsCount:y}=l?Pg(g):Fp(g),b=t.structureName??((e=s==null?void 0:s[0])==null?void 0:e.name)??ys(Bt),I=sg({structureId:d||(m==null?void 0:m.pop()),structureName:b,stageSequence:a,matchUpType:u,matchUps:v,stage:c}),T=[I],w=[];if(p>2){let S=[0,2].slice(0,p/16).map((U,P)=>{let E=P+1,{consolationStructure:R}=P4e({idPrefix:h&&`${h}-c${P}`,structureId:m==null?void 0:m.pop(),playoffStructureNameBase:n,playoffAttributes:s,structureNameMap:o,stageSequence:E,roundOffset:U,matchUpType:u,drawSize:p,isMock:f,index:P,uuids:m});T.push(R);let C=UIe({consolationStructure:R,roundsCount:2,mainStructure:I,roundOffset:U});return{consolationStructure:R,links:C}}).map(U=>U.links).flat();if(w.push(...S),p>=4&&p<=16||p>32){let{matchUps:U}=Fp({idPrefix:h&&`${h}-p3t4`,finishingPositionOffset:2,drawSize:2,matchUpType:u,isMock:f}),P=((i=s==null?void 0:s["3-4"])==null?void 0:i.name)??ys(Mr),E=(o==null?void 0:o[P])||P,R=n?`${n} ${E}`:E,C=sg({structureId:m==null?void 0:m.pop(),matchUps:U,stageSequence:2,stage:Mr,structureName:R,matchUpType:u}),M={linkType:Hh,source:{roundNumber:y-1,structureId:I.structureId},target:{structureId:C.structureId,feedProfile:Ru,roundNumber:1}};T.push(C),w.push(M)}}return{structures:T,links:w,...pe}}function P4e({playoffStructureNameBase:t,stageSequence:e=1,playoffAttributes:i,structureNameMap:n,roundOffset:r=0,matchUpType:a,structureId:s,idPrefix:o,drawSize:l,isMock:c,index:u,uuids:d}){var p,h;let f=l/(2*Math.pow(2,r)),{matchUps:m,roundsCount:g}=Pg({finishingPositionOffset:f,baseDrawSize:f,isConsolation:!0,feedRounds:1,matchUpType:a,idPrefix:o,isMock:c,uuids:d}),v=u===0&&((p=i==null?void 0:i["0-1"])==null?void 0:p.name)||u===1&&((h=i==null?void 0:i["0-3"])==null?void 0:h.name)||`${ys(ws)} ${u+1}`,y=(n==null?void 0:n[v])||v,b=t?`${t} ${y}`:y;return{consolationStructure:sg({matchUps:m,stage:ws,structureName:b,stageSequence:e,matchUpType:a,structureId:s}),consolationRoundsCount:g}}function Sb(t){var e,i,n,r;let{finishingPositionOffset:a,stageSequence:s=1,playoffAttributes:o,feedsFromFinal:l,staggeredEntry:c,structureName:u,stage:d=Bt,structureId:p,matchUpType:h,skipRounds:f,feedRounds:m,idPrefix:g,drawSize:v,isMock:y,uuids:b,fmlc:I}=t,T=t.feedPolicy||((e=t.policyDefinitions)==null?void 0:e[gT])||((i=t.appliedPolicies)==null?void 0:i[gT]),w={finishingPositionOffset:a,matchUpType:h,skipRounds:f,drawSize:v,idPrefix:g,isMock:y,uuids:b},{matchUps:S}=c?Pg(w):Fp(w),U=$c({structureName:u||((n=o==null?void 0:o[0])==null?void 0:n.name)||ys(Bt),structureId:p||(b==null?void 0:b.pop()),stageSequence:s,matchUpType:h,matchUps:S,stage:d}),P=[U],E=[],R=v/2,{matchUps:C,roundsCount:M}=Pg({finishingPositionOffset:R,idPrefix:g&&`${g}-c`,isConsolation:!0,feedsFromFinal:l,baseDrawSize:R,matchUpType:h,feedRounds:m,skipRounds:f,isMock:y,uuids:b,fmlc:I});if(v>2){let _=((r=o==null?void 0:o["0-1"])==null?void 0:r.name)??ys(ws),A=t.playoffStructureNameBase?`${t.playoffStructureNameBase} ${_}`:_,N=$c({matchUps:C,structureId:b==null?void 0:b.pop(),stage:ws,stageSequence:1,structureName:A,matchUpType:h});P.push(N);let k=UIe({consolationStructure:N,mainStructure:U,roundsCount:M,feedPolicy:T,fmlc:I});E.push(...k)}return{...pe,structures:P,links:E}}function EIe({requireSequential:t=!0,playoffMatchUpFormat:e,playoffAttributes:i,sourceStructureId:n,policyDefinitions:r,stageSequence:a,drawDefinition:s,playoffGroups:o,matchUpType:l,feedPolicy:c,groupCount:u,idPrefix:d,isMock:p,uuids:h}){var f,m,g,v,y,b;c=c||(r==null?void 0:r[gT]);let I="processPlayoffGroups",T=0,w=[],S=[],U=[],{error:P,positionRangeMap:E}=E4e({structureId:n,drawDefinition:s,playoffGroups:o});if(P)return fe({result:{error:P},stack:I});if(!(!E||o!=null&&o.every(R=>{let{finishingPositions:C=[]}=R;if(!C.length)return!1;let M=[...C].sort(ra).map((_,A)=>(C[A+1]||_)-_).every(_=>_<2);return(!t||M)&&C.every(_=>E[_])})))return fe({context:{validFinishingPositions:Object.values(E)},result:{error:Ae},stack:I});for(let R of o){let C=R.finishingPositions,M=E&&C.map(V=>{var j;return(j=E[V])==null?void 0:j.finishingPositions}).flat(),_=u*C.length,A=MU(_),N=A===2&&bp||R.drawType||bp;M&&(T=Math.min(...M)-1);let k=M&&`${Math.min(...M)}-${Math.max(...M)}`,O=R.structureName||k&&((m=(f=R.playoffAttributes)==null?void 0:f[k])==null?void 0:m.name)||((v=(g=R.playoffAttributes)==null?void 0:g[0])==null?void 0:v.name),$={addNameBaseToAttributeName:R.addNameBaseToAttributeName,playoffStructureNameBase:R.playoffStructureNameBase,finishingPositionNaming:R.finishingPositionNaming,finishingPositionLimit:R.finishingPositionLimit,structureId:R.structureId??(h==null?void 0:h.pop()),playoffAttributes:R.playoffAttributes,structureNameMap:R.structureNameMap,sequenceLimit:R.sequenceLimit,structureName:O,idPrefix:d&&`${d}-po`,appliedPolicies:r,finishingPositionOffset:T,stage:Mr,stageSequence:a,matchUpType:l,drawSize:A,isMock:p,uuids:h},F=({playoffStructures:V,playoffLinks:j})=>{let[B]=V,z=WM({playoffStructureId:B.structureId,finishingPositions:C,sourceStructureId:n});U.push(z),U.push(...j),S.push(...V),w.push({structureId:B.structureId,finishingPositions:C}),T+=_};if(N===bp){let{matchUps:V}=Fp({finishingPositionLimit:T+_,idPrefix:d&&`${d}-po`,finishingPositionOffset:T,matchUpType:l,drawSize:A,isMock:p,uuids:h}),j=$c({structureId:R.structureId??(h==null?void 0:h.pop()),matchUpFormat:e,stage:Mr,structureName:O,stageSequence:a,matchUps:V});S.push(j);let B=WM({playoffStructureId:j.structureId,finishingPositions:C,sourceStructureId:n});U.push(B),T+=_,w.push({structureId:j.structureId,finishingPositions:C})}else if([dT,pT,Mr].includes(N)){let V={playoffAttributes:R.playoffAttributes??i,playoffStructureNameBase:R.playoffStructureNameBase,structureId:R.structureId??(h==null?void 0:h.pop()),structureName:R.structureName,idPrefix:d&&`${d}-po`,addNameBaseToAttributeName:!0,finishingPositionOffset:T,stage:Mr,roundOffset:0,stageSequence:a,drawSize:A,isMock:p,uuids:h};N===dT?Object.assign(V,{playoffAttributes:(R==null?void 0:R.playoffAttributes)??i??w6,roundOffsetLimit:3}):N===pT&&Object.assign(V,{playoffAttributes:(R==null?void 0:R.playoffAttributes)??i??S6,roundOffsetLimit:2});let j=gS(V);if(j.error)return j;if((y=j.links)!=null&&y.length&&U.push(...j.links),(b=j.structures)!=null&&b.length&&S.push(...j.structures),S.sort(Ew),j.structureId){let B=WM({playoffStructureId:j.structureId,finishingPositions:C,sourceStructureId:n});U.push(B),w.push({structureId:j.structureId,finishingPositions:C})}T+=_}else if([hT,fR,jE,VE,BE,GE].includes(N)){let V=[h==null?void 0:h.pop(),h==null?void 0:h.pop()],j={playoffStructureNameBase:R.playoffStructureNameBase,structureId:R.structureId??(h==null?void 0:h.pop()),playoffAttributes:R.playoffAttributes,idPrefix:d&&`${d}-po`,finishingPositionOffset:T,uuids:V,stage:Mr,structureName:O,matchUpType:l,feedPolicy:c,drawSize:A,isMock:p},B={[hT]:{fmlc:!0,feedRounds:1},[GE]:{feedRounds:1},[jE]:{feedsFromFinal:3},[VE]:{feedsFromFinal:2},[BE]:{feedsFromFinal:1}};Object.assign(j,B[N]||{});let{structures:z,links:W}=Sb(j),[Z]=z,K=WM({playoffStructureId:Z.structureId,finishingPositions:C,sourceStructureId:n});U.push(K),U.push(...W),S.push(...z),w.push({structureId:Z.structureId,finishingPositions:C}),T+=_}else if([Zu].includes(N)){let{structures:V,links:j}=BR({...$,structureOptions:R.structureOptions||{groupSize:4}});F({playoffStructures:V,playoffLinks:j})}else if([hR].includes(N)){let{structures:V,links:j}=TIe($);F({playoffStructures:V,playoffLinks:j})}else if([nqe].includes(N)){let{structures:V,links:j}=DIe($);F({playoffStructures:V,playoffLinks:j})}else if([lc].includes(N)){let V=$c({structureId:R.structureId??(h==null?void 0:h.pop()),structureName:R.structureName,finishingPosition:aA,stage:Mr,stageSequence:a,matchUps:[]});F({playoffStructures:[V],playoffLinks:[]})}}return{finishingPositionTargets:w,positionRangeMap:E,structures:S,links:U}}function WM({playoffStructureId:t,finishingPositions:e,sourceStructureId:i}){return{linkType:im,source:{structureId:i,finishingPositions:e},target:{structureId:t,feedProfile:vd,roundNumber:1}}}function qR({matchUp:t,tieFormat:e,isMock:i,uuids:n}){let{collectionDefinitions:r}=e??{};return{tieMatchUps:(r??[]).map(a=>WR({matchUp:t,collectionDefinition:a,uuids:n,isMock:i})).filter(Boolean).flat()}}function WR({collectionPositionOffset:t=0,collectionDefinition:e,matchUpsLimit:i,matchUp:n,isMock:r,uuids:a}){let{matchUpCount:s,matchUpType:o,collectionId:l,processCodes:c}=e||{},u=i??s??0,d=p=>{if(!r&&!(n!=null&&n.isMock))return(a==null?void 0:a.pop())??bn();let h=e==null?void 0:e.collectionId;return(a==null?void 0:a.pop())??`${n==null?void 0:n.matchUpId}-${h}-TMU-${p+1}`};return Mt(0,u).map(p=>{let h=t+p+1;return{sides:[{sideNumber:1},{sideNumber:2}],matchUpId:d(p),matchUpStatus:jr,collectionPosition:h,collectionId:l,processCodes:c,matchUpType:o,isMock:r}})}function C4e(t){var e,i,n;let r="generateAndPopulateRRplayoffStructures";if(!t.playoffGroups)return fe({result:{error:si},info:"playoffGroups required",stack:r});let{sourceStructureId:a,requireSequential:s,tournamentRecord:o,drawDefinition:l,playoffGroups:c,groupCount:u,groupSize:d,event:p}=t,h=EIe({requireSequential:s,sourceStructureId:a,playoffGroups:c,groupCount:u,groupSize:d,...t});if(h.error)return fe({result:h,stack:r});let{structures:f=[],links:m=[],finishingPositionTargets:g,positionRangeMap:v}=h,y=g==null?void 0:g.map(({finishingPositions:R})=>R).flat().map(R=>v[R].finishingPositions).flat();l.structures.push(...f),l.links.push(...m);let{matchUps:b,matchUpsMap:I}=pa({inContext:!0,drawDefinition:l}),T=f.map(({structureId:R})=>R),w=b==null?void 0:b.filter(({structureId:R})=>T.includes(R)).map(Ca),S=(e=I==null?void 0:I.drawMatchUps)==null?void 0:e.filter(({matchUpId:R})=>w==null?void 0:w.includes(R));if(S!=null&&S.length){let R=(i=Ws({drawDefinition:l,event:p}))==null?void 0:i.tieFormat;R&&S.forEach(C=>{let{tieMatchUps:M}=qR({isMock:t.isMock,tieFormat:R,matchUp:C});Object.assign(C,{tieMatchUps:M,matchUpType:ac})})}let{positionAssignments:U}=Gn({structureId:a,drawDefinition:l}),P={};U==null||U.forEach(R=>{var C,M,_;let A=(_=(M=(C=xi({element:R,name:wg}))==null?void 0:C.extension)==null?void 0:M.value)==null?void 0:_.groupOrder;A&&(P[A]||(P[A]=[]),P[A].push(R.participantId))});let E=XU({provisionalPositioning:t.provisionalPositioning,structureId:a,applyPositioning:!0,event:t.event,tournamentRecord:o,drawDefinition:l});return E.error&&((n=E.error)==null?void 0:n.code)!==k5.code?fe({result:E,stack:r}):{structures:f,links:m,positionsPlayedOff:y,drawDefinition:l,...pe}}function iS({value:t,sourceRange:e,targetRange:i}){let n=Math.min(...e),r=Math.max(...e),a=Math.min(...i),s=Math.max(...i);return(t-n)*(s-a)/(r-n)+a}var Eu="ELO",PIe="NTRP",R4e="TRN",CIe="UTR",z8="WTN",M4e={ELO:Eu,NTRP:PIe,TRN:R4e,UTR:CIe,WTN:z8},N4e={[Eu]:{defaultInitialization:1500,decimalsCount:0,range:[0,3e3],ascending:!0},[PIe]:{accessors:["ntrpRating","dntrpRatingHundredths"],attributes:{ustaRatingType:""},accessor:"dntrpRatingHundredths",defaultInitialization:3,decimalsCount:1,ascending:!0,range:[1,7]},[CIe]:{defaultInitialization:6,accessors:["utrRating"],accessor:"utrRating",decimalsCount:2,ascending:!0,range:[1,16]},[z8]:{attributes:{confidence:{generator:!0,range:[60,100]}},accessors:["wtnRating","confidence"],defaultInitialization:23,accessor:"wtnRating",ascending:!1,decimalsCount:2,range:[40,1]}},Ea=N4e;function A4e({sourceRatingType:t,sourceRating:e}){let i=Ea[t].range,n=i[0]>i[1],r=Ea[Eu].range;return iS({value:n?i[0]-e:e,sourceRange:i,targetRange:r})}function _4e({targetRatingType:t,sourceRating:e}){let i=Ea[t].decimalsCount||0,n=Ea[t].range,r=n[0]>n[1],a=Math.max(...n),s=Ea[Eu].range,o=iS({targetRange:n,sourceRange:s,value:e}),l=parseFloat(o.toFixed(i));return r?a-l:l}function sJ(t){var e;let i=ei(t,[{ratings:!0,[Wo]:tl}]);if(i.error)return i;let n=t.matchUpType&&[On,Nn].includes(t.matchUpType)?t.matchUpType:On,r=Object.keys(Ea),a=t.targetRatingType&&r.includes(t.targetRatingType)?t.targetRatingType:Eu,s=t.ratings[n]?t.ratings[n].reduce((p,h)=>p.includes(h.scaleName)?p:p.concat(h.scaleName),[]):[];if(!s)return{error:Ya};let o=((e=t.ratings[n])==null?void 0:e.find(p=>p.scaleName===a))??t.ratings[n][0];if(s[0]===a)return o;let l=o.scaleName,c=Ea[o.scaleName].accessor,u=c?o.scaleValue[c]:o.scaleValue,d=A4e({sourceRatingType:l,sourceRating:u});return{convertedRating:_4e({targetRatingType:a,sourceRating:d}),sourceRating:u}}function k4e({participantResults:t,sides:e,score:i}){var n,r;let a=e.find(({sideNumber:c})=>c===1),s=e.find(({sideNumber:c})=>c===2),o=(n=a==null?void 0:a.participant)==null?void 0:n.ratings,l=(r=s==null?void 0:s.participant)==null?void 0:r.ratings;if(o!=null&&o[On]&&l!=null&&l[On]){let c=Eu,{convertedRating:u}=sJ({ratings:o,targetRatingType:c}),{convertedRating:d}=sJ({ratings:l,targetRatingType:c}),{side1pressure:p,side2pressure:h}=x4e({side1ConvertedRating:u,side2ConvertedRating:d,score:i});p&&t[a==null?void 0:a.participantId].pressureScores.push(p),h&&t[s==null?void 0:s.participantId].pressureScores.push(h);let f=Math.max(...Ea[Eu].range),m=__((d-u)/f),g=__((u-d)/f);t[a==null?void 0:a.participantId].ratingVariation.push(m),t[s==null?void 0:s.participantId].ratingVariation.push(g)}}function x4e({side1ConvertedRating:t,side2ConvertedRating:e,score:i}){var n,r;let a=t>e?t:e,s=t>e?e:t,o=Math.abs(t-e),l=Ea[Eu].range,c=Math.max(...l),u=(c-a)*0,d=(a+u)/c*o,p=(n=i==null?void 0:i.sets)==null?void 0:n.reduce((I,T)=>I+((T==null?void 0:T.side1Score)??0),0),h=(r=i==null?void 0:i.sets)==null?void 0:r.reduce((I,T)=>I+(T.side2Score??0),0),f=t>e?2:1,m=(p||0)*(s+(f===1?d:0)),g=(h||0)*(s+(f===2?d:0)),v=m+g,y=v?__(m/v):0,b=v?__(g/v):0;return{side1pressure:y,side2pressure:b}}function q8({winningSide:t,matchUpFormat:e=Fu,matchUpStatus:i,tallyPolicy:n,score:r}){let a=[0,0],s=r==null?void 0:r.sets,o=typeof t=="number"&&t-1,l=Do(e),c=W8((l==null?void 0:l.bestOf)??1);if(typeof o=="number"&&(i===Ki&&n!=null&&n.setsCreditForDefaults||i===un&&n!=null&&n.setsCreditForWalkovers))a[o]=c;else for(let u of s||[]){let{winningSide:d}=u;d&&(a[d-1]+=1)}return typeof o=="number"&&i===ss&&(+a[1-o]===c&&(a[1-o]-=1),n!=null&&n.setsCreditForRetirements&&(a[o]=c)),a}function RIe({matchUpFormat:t=Fu,winningSide:e,matchUpStatus:i,tallyPolicy:n,score:r}){var a,s;let{sets:o}=r||{};if(!o)return[0,0];let l=typeof e=="number"&&e-1,c=Do(t),u=(c==null?void 0:c.bestOf)??1,d=W8(u),p=((a=c==null?void 0:c.setFormat)==null?void 0:a.tiebreakAt)||0,h=[[],[]];if(typeof l=="number"&&(i===Ki&&n!=null&&n.gamesCreditForDefaults||i===un&&n!=null&&n.gamesCreditForWalkovers)){let f=((s=c==null?void 0:c.setFormat)==null?void 0:s.setTo)||0,m=d*f;h[l].push(m)}else o.forEach((f,m)=>{var g;let v=(f.setNumber||m+1)>d&&c!=null&&c.finalSetFormat?"finalSetFormat":"setFormat",y=(g=c==null?void 0:c[v])==null?void 0:g.based,b=c==null?void 0:c[v].tiebreakSet,{side1Score:I,side2Score:T}=f;oJ(y)&&(h[0].push(di(I||0)),h[1].push(di(T||0))),b&&f.winningSide&&(n==null?void 0:n.gamesCreditForTiebreakSets)!==!1&&h[f.winningSide-1].push(1)});if(i===ss&&typeof l=="number"){let f=o.length>d&&c!=null&&c.finalSetFormat?"finalSetFormat":"setFormat",m=c==null?void 0:c[f];if(oJ(m.based)){let g=(m==null?void 0:m.setTo)||0,v=b=>{if(!(!c||b===""))return+b===p-1||+b===p?di(p||0)+1:+b<p?g:p},y=q8({winningSide:e,score:{sets:o},matchUpStatus:i,matchUpFormat:t,tallyPolicy:n});if(h.map(b=>b[l]<=b[1-l]).reduce((b,I)=>b+(I?1:0),0)>y[1-l]){let b=h[l].length,I=v(h[1-l][b-1]);I&&(h[l][b-1]=I)}d>h[l].length&&n!=null&&n.gamesCreditForRetirements&&h[l].push(g)}}return[h[0].reduce((f,m)=>f+m,0),h[1].reduce((f,m)=>f+m,0)]}function MIe({matchUpFormat:t,score:e}){var i;let n=t?Do(t):void 0,r=(n==null?void 0:n.bestOf)??1,a=W8(r),s=[0,0],o=[0,0];return(i=e==null?void 0:e.sets)==null||i.forEach((l,c)=>{var u;let d=(l.setNumber||c+1)>a&&n!=null&&n.finalSetFormat?"finalSetFormat":"setFormat",p=(u=n==null?void 0:n[d])==null?void 0:u.based;if(NIe(p)){let{side1Score:h,side2Score:f}=l;h&&(o[0]+=di(h||0)),f&&(o[1]+=di(f||0))}else l.side1TiebreakScore&&(o[0]+=di(l.side1TiebreakScore||0)),l.side2TiebreakScore&&(o[1]+=di(l.side2TiebreakScore||0)),(l.side1TiebreakScore||l.side2TiebreakScore)&&l.winningSide&&(s[l.winningSide-1]+=1)}),{pointsTally:o,tiebreaksTally:s}}function W8(t){return t&&Math.ceil(t/2)||1}function NIe(t){return t==="P"}function oJ(t){return!NIe(t)}function O4e({participantResults:t,matchUpFormat:e,tallyPolicy:i,perPlayer:n,totalSets:r}){var a;let s=e&&Do(e)||{},o=s.bestOf,l=o&&Math.ceil(o/2)||1,c=(a=s.setFormat)==null?void 0:a.setTo;Object.keys(t).forEach(u=>{let d=t[u].setsWon,p=t[u].setsLost,h=i!=null&&i.groupTotalSetsPlayed?r:n*(l||0)||d+p,f=Math.round(d/h*1e3)/1e3;(f===1/0||isNaN(f))&&(f=h);let m=t[u].tieMatchUpsWon,g=t[u].tieMatchUpsLost,v=m+g,y=Math.round(m/v*1e3)/1e3;(y===1/0||isNaN(y))&&(y=m);let b=t[u].matchUpsWon,I=t[u].matchUpsLost,T=b+I,w=Math.round(b/T*1e3)/1e3;(w===1/0||isNaN(w))&&(w=b);let S=t[u].gamesWon||0,U=t[u].gamesLost||0,P=(n||0)*(l||0)*(c||0),E=Math.max(P,S+U),R=Math.round(S/E*1e3)/1e3;(R===1/0||isNaN(R))&&(R=0);let C=t[u].pointsWon+t[u].pointsLost,M=Math.round(t[u].pointsWon/C*1e3)/1e3;(M===1/0||isNaN(M))&&(M=0),t[u].setsWon=d,t[u].setsLost=p,t[u].setsPct=f,t[u].tieMatchUpsWon=m,t[u].tieMatchUpsPct=y,t[u].matchUpsPct=w,t[u].gamesWon=S,t[u].gamesLost=U,t[u].gamesPct=R,t[u].pointsPct=M,t[u].result=`${t[u].matchUpsWon}/${t[u].matchUpsLost}`})}function YR({participantIds:t,pressureRating:e,matchUpFormat:i,tallyPolicy:n,perPlayer:r,matchUps:a}){var s,o,l,c,u,d,p;let h={},f=(n==null?void 0:n.excludeMatchUpStatuses)||[],m=a==null?void 0:a.filter(v=>(v.tieMatchUps||!f.includes(v.matchUpStatus))&&(!(t!=null&&t.length)||Ar(t,[nS(v,0),nS(v,1)]).length===2)),g=(s=m==null?void 0:m.flatMap(({score:v,tieMatchUps:y})=>{var b;return y?y.filter(({matchUpStatus:I})=>!f.includes(I)).flatMap(({score:I})=>{var T;return((T=I==null?void 0:I.sets)==null?void 0:T.length)??0}):((b=v==null?void 0:v.sets)==null?void 0:b.length)??0}))==null?void 0:s.reduce((v,y)=>v+y,0);for(let v of m??[]){let{matchUpStatus:y,tieMatchUps:b,tieFormat:I,score:T,winningSide:w,sides:S}=v,U=I&&v._disableAutoCalc&&I.collectionDefinitions.every(({scoreValue:M})=>M),P=w&&L4e(v),E=w&&F4e(v);if(!P&&!E)if(y&&va.includes(y)){let M=nS(v,0),_=nS(v,1);M&&(Ym(h,M),h[M].matchUpsCancelled+=1),_&&(Ym(h,_),h[_].matchUpsCancelled+=1)}else if(b!=null&&b.length){r=0;for(let M of b){if(M.winningSide){let _=(o=S==null?void 0:S.find(({sideNumber:N})=>N===M.winningSide))==null?void 0:o.participantId,A=(l=S==null?void 0:S.find(({sideNumber:N})=>N===M.winningSide))==null?void 0:l.participantId;_&&A&&(Ym(h,_),Ym(h,A),h[_].tieMatchUpsWon+=1,h[A].tieMatchUpsLost+=1,Br(On)(M.matchUpType)?(h[_].tieSinglesWon+=1,h[A].tieSinglesLost+=1):Br(Nn)(M.matchUpType)&&(h[_].tieDoublesWon+=1,h[A].tieDoublesLost+=1))}lJ({score:M.score,manualGamesOverride:U,participantResults:h,sides:S})}}else lJ({manualGamesOverride:U,participantResults:h,score:T,sides:S});else if(Ym(h,P),Ym(h,E),b==null?void 0:b.length){r=0;for(let M of b){let{matchUpType:_}=M,A=Br(Nn)(_),N=Br(On)(_);M.winningSide&&(M.winningSide===w?(P&&(h[P].tieMatchUpsWon+=1,N&&(h[P].tieSinglesWon+=1),A&&(h[P].tieDoublesWon+=1)),E&&(h[E].tieMatchUpsLost+=1,N&&(h[E].tieSinglesLost+=1),A&&(h[E].tieDoublesLost+=1))):M.winningSide!==w&&(E&&(h[E].tieMatchUpsWon+=1,N&&(h[E].tieSinglesWon+=1),A&&(h[E].tieDoublesWon+=1)),P&&(h[P].tieMatchUpsLost+=1,N&&(h[P].tieSinglesLost+=1),A&&(h[P].tieDoublesLost+=1)))),cJ({matchUpFormat:M.matchUpFormat,matchUpStatus:M.matchUpStatus,matchUpType:M.matchUpType,score:M.score,sides:M.sides,winningParticipantId:P,losingParticipantId:E,manualGamesOverride:U,participantResults:h,isTieMatchUp:!0,pressureRating:e,tallyPolicy:n,winningSide:w})}AIe({winningParticipantId:P,losingParticipantId:E,participantResults:h,matchUpStatus:y})}else cJ({matchUpFormat:v.matchUpFormat??i,matchUpType:v.matchUpType,isTieMatchUp:void 0,winningParticipantId:P,manualGamesOverride:U,losingParticipantId:E,participantResults:h,pressureRating:e,matchUpStatus:y,tallyPolicy:n,winningSide:w,score:T,sides:S});let R=(c=T==null?void 0:T.sets)==null?void 0:c.reduce((M,_)=>M+((_==null?void 0:_.side1Score)??0),0),C=(u=T==null?void 0:T.sets)==null?void 0:u.reduce((M,_)=>M+(_.side2Score??0),0);if(U){let M=(d=S==null?void 0:S.find(({sideNumber:A})=>A===1))==null?void 0:d.participantId,_=(p=S==null?void 0:S.find(({sideNumber:A})=>A===2))==null?void 0:p.participantId;Ym(h,M),Ym(h,_),M&&(h[M].gamesWon+=R,h[M].gamesLost+=C),_&&(h[_].gamesWon+=C,h[_].gamesLost+=R)}}return O4e({participantResults:h,matchUpFormat:i,tallyPolicy:n,perPlayer:r,totalSets:g}),{participantResults:h}}function L4e(t){let e=t.winningSide-1;return nS(t,e)}function F4e(t){let e=1-(t.winningSide-1);return nS(t,e)}function nS(t,e){if(!(t!=null&&t.sides))return console.log("no sides:",{matchUp:t}),"foo";let i=t.sides[e];return i?i.participantId:(console.log("No Side",{matchUp:t,index:e}),"foo")}function Ym(t,e){e&&!t[e]&&(t[e]={allDefaults:0,defaults:0,defeats:[],gamesLost:0,gamesWon:0,matchUpsCancelled:0,matchUpsLost:0,matchUpsWon:0,pointsLost:0,pointsWon:0,pressureScores:[],ratingVariation:[],retirements:0,setsLost:0,setsWon:0,tieSinglesWon:0,tieSinglesLost:0,tieDoublesWon:0,tieDoublesLost:0,tieMatchUpsLost:0,tieMatchUpsWon:0,victories:[],walkovers:0})}function lJ({manualGamesOverride:t,participantResults:e,score:i,sides:n}){let{sets:r}=i||{},a=[[],[]],s=[0,0];for(let l of r||[]){let{winningSide:c,side1Score:u,side2Score:d}=l;c&&(s[c-1]+=1),a[0].push(di(u||0)),a[1].push(di(d||0))}let o=[a[0].reduce((l,c)=>l+c,0),a[1].reduce((l,c)=>l+c,0)];n.forEach((l,c)=>{let{participantId:u}=l;u&&(Ym(e,u),e[u].setsWon+=s[c],e[u].setsLost+=s[1-c],t||(e[u].gamesWon+=o[c],e[u].gamesLost+=o[1-c]))})}function cJ({winningParticipantId:t,manualGamesOverride:e,losingParticipantId:i,participantResults:n,pressureRating:r,matchUpFormat:a,matchUpStatus:s,isTieMatchUp:o,matchUpType:l,tallyPolicy:c,winningSide:u,score:d,sides:p}){let h=u&&u-1,f=1-h;r&&l===On&&k4e({participantResults:n,sides:p,score:d}),o||AIe({winningParticipantId:t,losingParticipantId:i,participantResults:n,matchUpStatus:s});let m=q8({matchUpStatus:s,matchUpFormat:a,tallyPolicy:c,winningSide:u,score:d}),g=RIe({matchUpStatus:s,matchUpFormat:a,tallyPolicy:c,winningSide:u,score:d}),{pointsTally:v}=MIe({score:d,matchUpFormat:a});t&&(n[t].setsWon+=m[h],n[t].setsLost+=m[f],e||(n[t].gamesWon+=g[h],n[t].gamesLost+=g[f]),n[t].pointsWon+=v[h],n[t].pointsLost+=v[f]),i&&(n[i].setsWon+=m[f],n[i].setsLost+=m[h],e||(n[i].gamesWon+=g[f],n[i].gamesLost+=g[h]),n[i].pointsWon+=v[f],n[i].pointsLost+=v[h])}function AIe({winningParticipantId:t,losingParticipantId:e,participantResults:i,matchUpStatus:n}){e&&(n===un&&(i[e].walkovers+=1),n===Ki&&(i[e].defaults+=1),n===ss&&(i[e].retirements+=1),[Ki,ss,un].includes(n)&&(i[e].allDefaults+=1),i[e].matchUpsLost+=1),t&&(i[t].matchUpsWon+=1),e&&t&&(i[e].defeats.push(t),i[t].victories.push(e))}function $4e({matchUps:t,order:e,report:i}){let n={};t.forEach(({sides:a})=>{a.forEach(s=>{s.participantId&&s.participant&&(n[s.participantId]=s.participant.participantName)})});let r=[];return Array.isArray(i)&&i.forEach((a,s)=>{var o,l;if((o=a.excludedDirectives)!=null&&o.length){let c=a.excludedDirectives.map(({attribute:p})=>p).join(", "),u=`${c.length} directives were excluded due to participants limit}`;r.push(u);let d=`Excluded: ${c}`;r.push(d)}else{let c=(m,g)=>parseFloat(a.reversed?m:g)-parseFloat(a.reversed?g:m),u=a.groups?Object.values(a.groups).flat(1/0).length:((l=a.participantIds)==null?void 0:l.length)??0,d=m=>{m.groups&&Object.keys(m.groups).sort(c).forEach(g=>{let v=m.groups[g].map(b=>n[b]).join(", "),y=`${g} ${m.attribute}: ${v}`;r.push(y)})},p=a.reversed?" in reverse order":"",h=a.groups?"grouped":"separated",f=`Step ${s+1}: ${u} particiants were ${h}${p} by ${a.attribute}`;if(r.push(f),a.idsFilter){let m=`${a.attribute} was calculated considering ONLY TIED PARTICIPANTS`;r.push(m)}d(a)}r.push("----------------------")}),r.push("Final Order:"),e.forEach(a=>{let{participantId:s,resolved:o}=a,l=a.groupOrder||a.provisionalOrder;r.push(`${l}: ${n[s]} => resolved: ${!!o}`)}),r.join(`\r
`)}function _Ie({participantResults:t,participantIds:e,attribute:i}){return kIe({participantResults:t,participantIds:e}).reduce((n,r)=>{let{participantId:a,results:s}=r,o=s==null?void 0:s[i];return!isNaN(o)&&a&&(n[o]?n[o].push(a):n[o]=[a]),n},{})}function kIe(t){return(t.participantIds||Object.keys(t.participantResults)).reduce((e,i,n)=>(e.push({participantId:i,i:n,results:t.participantResults[i]}),e),[])}var B4e=[{attribute:"matchUpsPct",idsFilter:!1},{attribute:"allDefaults",reversed:!0,idsFilter:!1},{attribute:"defaults",reversed:!0,idsFilter:!1},{attribute:"walkovers",reversed:!0,idsFilter:!1},{attribute:"retirements",reversed:!0,idsFilter:!1},{attribute:"setsPct",idsFilter:!1},{attribute:"gamesPct",idsFilter:!1},{attribute:"pointsPct",idsFilter:!1},{attribute:"matchUpsPct",idsFilter:!0},{attribute:"setsPct",idsFilter:!0},{attribute:"gamesPct",idsFilter:!0},{attribute:"pointsPct",idsFilter:!0}],Y$={matchUpsPct:20,tieMatchUpsPct:16,pointsPct:4,gamesPct:8,setsPct:12};function uJ(t){let{requireCompletion:e=!0,participantResults:i,subOrderMap:n,tallyPolicy:r}=t,a=[];if(e&&!V4e(t))return{};let s=["tieMatchUpsWon","tieSinglesWon","tieDoublesWon","matchUpsWon","pointsWon","gamesWon","setsWon","gamesPct","setsPct","pointsPct","matchUpsPct"].includes(r==null?void 0:r.groupOrderKey)?r.groupOrderKey:"matchUpsWon",o=_Ie({participantResults:i,attribute:s});a.push({attribute:s,groups:o});let l=Object.keys(o).map(g=>parseFloat(g)).sort((g,v)=>v-g).map(g=>o[g]).map(g=>{let v=xIe({participantIds:g,...t});return a.push(...v.report??[]),v.order}).map((g,v)=>g.map(y=>y.resolved?y:{...y,subGroup:[v].concat(...y.subGroup??[])})).flat(),c,u=0,d=1,p;l.forEach((g,v)=>{var y;v&&(g.resolved||p&&!g.resolved)&&(d+=1),p=g.resolved;let b=parseInt(((y=g.subGroup)==null?void 0:y.join(""))||0);g.resolved?(g.position=v+1,d=g.position):(c&&b>c&&(d+=u,u=0),g.position=d,u+=1),c=b});let h=l.map(({position:g})=>g),f=Ol(h);return l.forEach(g=>{let{participantId:v,position:y}=g||{},b=i[v];g.GEMscore=m(b);let I=f[y];(g==null?void 0:g.position)!==void 0&&(I>1&&(g.ties=I,n&&(g.subOrder=n[v])),g.rankOrder=y,g.groupOrder=y+(g.subOrder||1)-1)}),{groupOrder:l,report:a.flat(1/0).filter(Boolean)};function m(g){return(Array.isArray(r==null?void 0:r.GEMscore)?Object.keys(Y$).filter(v=>r.GEMscore.includes(v)):Object.keys(Y$)).map(v=>(g[v]||0)*Math.pow(10,Y$[v].toFixed(3))).reduce((v,y)=>v+y,0)}}function V4e({participantResults:t,participantsCount:e}){let i=kIe({participantResults:t}).filter(n=>e-1===n.results.matchUpsWon+n.results.matchUpsLost+n.results.matchUpsCancelled);return e===i.length}function j4e({disableHeadToHead:t,participantIds:e,matchUpFormat:i,tallyPolicy:n,attribute:r,idsFilter:a,matchUps:s,reversed:o}){let{participantResults:l}=YR({participantIds:a&&e,matchUpFormat:i,tallyPolicy:n,matchUps:s}),c=_Ie({participantResults:l,participantIds:e,attribute:r}),u=[{attribute:r,reversed:o,groups:c,idsFilter:a}],d;return Object.keys(c).length>1&&e.length&&(d=Object.keys(c).map(p=>parseFloat(p)).sort((p,h)=>o?p-h:h-p).map(p=>c[p]).map(p=>{let h=xIe({participantResults:l,disableHeadToHead:t,participantIds:p,matchUpFormat:i,tallyPolicy:n,matchUps:s});return u.push(...h.report??[]),h.order}).map((p,h)=>p.map(f=>f.resolved?f:{...f,subGroup:[h].concat(...f.subGroup??[])})).flat()),{order:d,report:u}}function xIe({participantResults:t,disableHeadToHead:e,participantIds:i,matchUpFormat:n,tallyPolicy:r,matchUps:a}){let s=[],o=[],l;if((i==null?void 0:i.length)===1)return{order:[{resolved:!0,participantId:i[0]}]};if((i==null?void 0:i.length)===2&&(!(r!=null&&r.headToHead)||!r.headToHead.disabled&&!e)){let u=G4e({participantIds:i,participantResults:t});if(u){let d=u[0].participantId;return o.push({attribute:"head2Head",participantIds:i,headToHeadWinner:d}),{order:u,headToHeadWinner:d,report:o}}}let c=((r==null?void 0:r.tallyDirectives)||B4e).filter(u=>{let d=!(Er(u.maxParticipants)&&(i==null?void 0:i.length)>u.maxParticipants);return d||s.push(u),d});return s.length&&o.push({excludedDirectives:s,participantIds:i}),c.every(({attribute:u,reversed:d,idsFilter:p,disableHeadToHead:h})=>(l=j4e({disableHeadToHead:h,participantIds:i,matchUpFormat:n,tallyPolicy:r,attribute:u,idsFilter:p,matchUps:a,reversed:d}),o.push(l.report),!l.order)),l.order?{order:l.order,report:o}:{order:i==null?void 0:i.map(u=>({participantId:u})),report:o}}function G4e({participantIds:t,participantResults:e}){if(t){if(e[t[0]].victories.includes(t[1]))return t.map(i=>({resolved:!0,participantId:i}));if(e[t[1]].victories.includes(t[0]))return t.reverse().map(i=>({resolved:!0,participantId:i}))}}function QU({policyDefinitions:t,generateReport:e,pressureRating:i,matchUpFormat:n,matchUps:r=[],subOrderMap:a,perPlayer:s}){if(!(r!=null&&r.length)||!lu(r))return{error:Em};let o=Pi(r.map(({structureId:I})=>I));if(o.length!==1)return fe({result:{error:Ae,info:"Maximum one structureId"},stack:"tallyParticipantResults",context:{structureIds:o}});let l=r.filter(I=>I&&I.matchUpStatus!==gn),c=l.length&&Pi(l.map(({drawPositions:I})=>I).flat()).length,u=l.filter(I=>Wv({matchUp:I})).length===l.length;u||(s=0);let d=r.every(({matchUpType:I,tieMatchUps:T})=>I===Xn&&(T==null?void 0:T.every(w=>Wv({matchUp:w})))),p=t==null?void 0:t[A6],h=r.filter(I=>Wv({matchUp:I})||I.matchUpType===Xn),{participantResults:f}=YR({matchUps:h,pressureRating:i,matchUpFormat:n,tallyPolicy:p,perPlayer:s}),m,g,{groupOrder:v,report:y}=uJ({matchUps:h,participantResults:f,participantsCount:c,matchUpFormat:n,tallyPolicy:p,subOrderMap:a});if(i&&H4e({participantResults:f}),u&&v)m=y,g=v,v.forEach(I=>{let{participantId:T,groupOrder:w,rankOrder:S,subOrder:U,ties:P,GEMscore:E}=I,R=f[T];Object.assign(R,{groupOrder:w,rankOrder:S,GEMscore:E,subOrder:U,ties:P})});else{let{groupOrder:I,report:T}=uJ({requireCompletion:!1,participantResults:f,participantsCount:c,matchUpFormat:n,tallyPolicy:p,subOrderMap:a,matchUps:r});m=T,g=I,I&&I.forEach(w=>{let{participantId:S,groupOrder:U,GEMscore:P}=w,E=f[S];Object.assign(E,{provisionalOrder:U,GEMscore:P})})}let b={completedTieMatchUps:d,readableReport:"",participantResults:f,bracketComplete:u,order:[],report:m};if((u||d)&&(b.order=g),e||oc({tally:!0})){let I=$4e({matchUps:r,report:m,order:g});oc({tally:!0})&&console.log(I),b.readableReport=I}return b}function H4e({participantResults:t}){let e=r=>r.reduce((a,s)=>a+parseFloat(s),0),i=r=>parseFloat((e(r)/r.length).toFixed(2)),n=Object.keys(t).map(r=>{let a=t[r],{pressureScores:s}=a,o=s!=null&&s.length?i(s):0;return{participantId:r,averagePressure:o}}).sort((r,a)=>(a.averagePressure||0)-(r.averagePressure||0)).map((r,a)=>({...r,order:a+1}));for(let r of n)t[r.participantId].pressureOrder=r.order}function OIe({positionAssignments:t}){let e=(t||[]).filter(Bl(qh)).map(r=>{let{extension:a}=xi({element:r,name:vT}),s=di(a==null?void 0:a.value),o=!isNaN(s)&&s;return o&&{participantId:r.participantId,subOrder:o}}).filter(Boolean),i=e.map(({subOrder:r})=>r),n=Ol(i);return{subOrderMap:Object.assign({},...e.filter(({subOrder:r})=>n[r]===1).map(({participantId:r,subOrder:a})=>({[r]:a})))}}function Y8({positionAssignments:t,tournamentRecord:e,drawDefinition:i,matchUpFormat:n,matchUps:r,event:a}){if(!lu(r))return{error:Ae};if(!t)return{error:Ae};let{policyDefinitions:s}=Rm({policyTypes:[A6],tournamentRecord:e,drawDefinition:i,event:a}),{subOrderMap:o}=OIe({positionAssignments:t}),l=r.length?QU({policyDefinitions:s,matchUpFormat:n,subOrderMap:o,matchUps:r}):void 0;if(l!=null&&l.error)return l;let{participantResults:c={},bracketComplete:u,report:d}=l??{},p=Object.keys(c);return t.forEach(h=>{let{participantId:f}=h;if(p.includes(f)){let m={value:c[f],name:wg};pn({element:h,extension:m}),c[f].ties||uo({element:h,name:vT})}else uo({element:h,name:wg}),uo({element:h,name:vT})}),zn({drawDefinition:i}),{...pe,participantResults:c,bracketComplete:u,report:d}}function LIe({matchUps:t,matchUpId:e}){return{matchUp:(t||[]).find(i=>i.matchUpId===e)}}function or(t){let e=ei(t,[{[Po]:!0,[Wp]:!0}]);if(e.error)return e;let{tournamentParticipants:i,afterRecoveryTimes:n,contextProfile:r,drawDefinition:a,matchUpsMap:s,matchUpId:o,inContext:l,context:c,event:u}=t,{structures:d=[]}=Ju({drawDefinition:a}),p=t.contextContent||r&&Mm({contextProfile:r,drawDefinition:a});for(let h of d){let{matchUps:f}=Sn({tournamentParticipants:i,afterRecoveryTimes:n,contextContent:p,drawDefinition:a,contextProfile:r,matchUpsMap:s,inContext:l,structure:h,context:c,event:u}),{matchUp:m}=LIe({matchUps:f,matchUpId:o});if(m)return{matchUp:m,structure:h}}return{error:xs}}function DF(t){var e;return!tn(t)||!t.notes?{error:si}:tn(t.element)?!ur(t.notes)&&!((e=t.notes)!=null&&e.testing)?{error:Ae}:(Object.assign(t.element,{notes:t.notes}),{...pe}):{error:Ae}}function K8(t){return tn(t)?tn(t.element)?(t.element.notes&&delete t.element.notes,{...pe}):{error:Ae}:{error:si}}var EF={matchUpStatus:jr,matchUpStatusCodes:[],score:{scoreStringSide1:"",scoreStringSide2:"",sets:void 0},matchUpFormat:void 0,winningSide:void 0};function wp(t){var e,i,n,r,a,s,o,l;let c="modifyMatchUpScore",u=t.matchUpFormat,d=t.matchUp,p,{matchUpStatusCodes:h,tournamentRecord:f,drawDefinition:m,matchUpStatus:g,removeScore:v,winningSide:y,matchUpId:b,event:I,notes:T,score:w}=t,S=t.appliedPolicies&&Object.keys(t.appliedPolicies).length?t.appliedPolicies:(e=fn({policyTypes:[Kc],tournamentRecord:f,drawDefinition:m,structure:p,event:I}))==null?void 0:e.appliedPolicies,U=d.matchUpType===Xn;if(U&&m){if(b&&d.matchUpId!==b){let A=or({drawDefinition:m,matchUpId:b,event:I});if(!A.matchUp)return{error:xs};({matchUp:d,structure:p}=A)}}else d.matchUpId!==b&&console.log("!!!!!");g&&[un,Kr].includes(g)||v?Object.assign(d,{...EF}):w&&(d.score=w);let P=g&&(d==null?void 0:d.matchUpStatus)===Ki&&g!==Ki;g&&(d.matchUpStatus=g),u&&(d.matchUpFormat=u),h&&(d.matchUpStatusCodes=h),y&&(d.winningSide=y),t.removeWinningSide&&(d.winningSide=void 0),!p&&m&&({structure:p}=or({drawDefinition:m,matchUpId:b,event:I})),g&&!d.winningSide&&ya(d)&&!va.includes(g)&&![Dw,Qg,$l].includes(g)&&(d.matchUpStatus=ad);let E;if((P&&(i=d==null?void 0:d.processCodes)!=null&&i.length||g===Ki)&&(E=(r=(n=S==null?void 0:S[Kc])==null?void 0:n.processCodes)==null?void 0:r.incompleteAssignmentsOnDefault),!d.collectionId){let A=(p==null?void 0:p.structureType)===Eo,N=Ho({structure:p});if(l8({drawDefinition:m,structure:p})||N||A){let k=F=>{u=U?"SET1-S:T100":u??d.matchUpFormat??(F==null?void 0:F.matchUpFormat)??(m==null?void 0:m.matchUpFormat)??(I==null?void 0:I.matchUpFormat);let V=U?{matchUpTypes:[Xn]}:void 0,{matchUps:j}=Sn({afterRecoveryTimes:!1,tournamentRecord:f,inContext:!0,matchUpFilters:V,drawDefinition:m,structure:F,event:I});return N&&(F.positionAssignments=Pi(j.flatMap(B=>(B.sides??[]).map(z=>z.participantId)).filter(Boolean)).map(B=>({participantId:B}))),Y8({positionAssignments:F.positionAssignments,tournamentRecord:f,drawDefinition:m,matchUpFormat:u,matchUps:j,event:I})},O=A&&p.structures.find(F=>F==null?void 0:F.matchUps.find(V=>V.matchUpId===b)),$=k(O||p);if($.error)return fe({result:$,stack:c})}}if(T){let A=DF({element:d,notes:T});if(A.error)return fe({result:A,stack:c})}let R=f==null?void 0:f.tournamentId,C=ru().topics.includes(nF),M=(C||E)&&Us({drawDefinition:m}),_=M&&((a=pa({matchUpFilters:{matchUpIds:[b]},nextMatchUps:!0,tournamentRecord:f,inContext:!0,drawDefinition:m,matchUpsMap:M}).matchUps)==null?void 0:a[0]);if(C&&_&&jqe({tournamentId:R,inContextMatchUp:_}),Array.isArray(E)&&_&&!((s=_.sides)!=null&&s.every(({participantId:A})=>A)))if(g===Ki)d.processCodes=Pi([...d.processCodes??[],...E]);else for(let A of E||[]){let N=A&&((o=d==null?void 0:d.processCodes)==null?void 0:o.lastIndexOf(A));(l=d==null?void 0:d.processCodes)==null||l.splice(N,1)}return Qi({eventId:I==null?void 0:I.eventId,context:c,drawDefinition:m,tournamentId:R,matchUp:d}),{...pe}}function Z8(t){var e,i,n,r;let{matchUpStatusCodes:a,matchUpStatus:s,structure:o,matchUp:l,dualMatchUp:c,inContextMatchUp:u,autoCalcDisabled:d}=t,p=kR({matchUpStatus:s})||[Kp,ul].includes(s)&&c||d,h=((e=l==null?void 0:l.sides)==null?void 0:e.map(y=>y.participantId).filter(Boolean).length)||((i=u==null?void 0:u.sides)==null?void 0:i.map(y=>y.participantId).filter(Boolean).length),f="attemptToModifyScore";if(!(Ho({structure:o})&&h===1||s===Ki&&h||z4e({structure:o,matchUp:l,inContextMatchUp:u})||((r=(n=t.appliedPolicies)==null?void 0:n[Kc])==null?void 0:r.requireParticipantsForScoring)===!1))return fe({result:{error:V5},stack:f});let m=[un].includes(s),g=p?s:t.winningSide&&$r||$l,v=wp({...t,matchUpStatusCodes:p&&a||[],matchUpStatus:g,context:f,removeScore:m});return fe({result:v,stack:f})}function z4e({structure:t,matchUp:e,inContextMatchUp:i}){var n;let{drawPositions:r}=e,{positionAssignments:a}=Aa({structure:t}),s=a==null?void 0:a.filter(l=>(r==null?void 0:r.includes(l.drawPosition))&&l.participantId),o=(n=i==null?void 0:i.sides)==null?void 0:n.every(l=>l.participantId);return(s==null?void 0:s.length)===2||o}function FIe({collectionGroups:t=[]}){let e=Object.assign({},...t.filter(n=>wi(n==null?void 0:n.groupValue)&&(n==null?void 0:n.groupNumber)).map(n=>({[n.groupNumber]:{...n,allGroupMatchUpsCompleted:!0,matchUpsCount:0,sideWins:[0,0],values:[0,0]}}))),i=Object.keys(e).map(n=>di(n));return{groupValueGroups:e,groupValueNumbers:i}}function q4e({collectionDefinition:t,groupValueNumbers:e,groupValueGroups:i,sideTieValues:n,tieMatchUps:r}){let a=r.filter(y=>y.collectionId===t.collectionId),s=[0,0],o=[0,0],l=a.every(y=>va.includes(y.matchUpStatus)),{collectionValueProfiles:c,collectionGroupNumber:u,collectionValue:d,matchUpValue:p,winCriteria:h,scoreValue:f,setValue:m}=t,g=u&&e.includes(u),v=[0,0];if(a.forEach(y=>{y.winningSide&&(v[y.winningSide-1]+=1)}),wi(p)?a.forEach(y=>{y.winningSide&&(s[y.winningSide-1]+=p)}):wi(m)?a.forEach(y=>{var b,I;(I=(b=y.score)==null?void 0:b.sets)==null||I.forEach(T=>{T.winningSide&&(s[T.winningSide-1]+=m)})}):wi(f)?a.forEach(y=>{var b,I;(I=(b=y.score)==null?void 0:b.sets)==null||I.forEach(T=>{let{side1TiebreakScore:w=0,side2TiebreakScore:S=0,side1Score:U=0,side2Score:P=0}=T;(y.matchUpStatus===$r||y.winningSide||T.winningSide)&&(U||P?(s[0]+=U,s[1]+=P):(w||S)&&T.winningSide&&(s[T.winningSide-1]+=1))})}):Array.isArray(c)&&a.forEach(y=>{if(y.winningSide){let b=y.collectionPosition,I=W4e({collectionDefinition:t,collectionPosition:b});wi(I)&&(s[y.winningSide-1]+=I)}}),wi(d)){let y;if(h!=null&&h.aggregateValue)l&&(wi(p||m||f)&&s[0]!==s[1]?y=s[0]>s[1]?1:2:v[0]!==v[1]&&(y=v[0]>v[1]?1:2));else if(h!=null&&h.valueGoal)y=s.reduce((b,I,T)=>I>=h.valueGoal?T+1:b,0);else{let b=Math.floor(t.matchUpCount/2)+1;y=v.reduce((I,T,w)=>T>=b?w+1:I,0)}y&&(g?i[u].values[y-1]+=d:o[y-1]+=d)}else g?(i[u].values[0]+=s[0]||0,i[u].values[1]+=s[1]||0):o=s;g?(i[u].sideWins[0]+=v[0]||0,i[u].sideWins[1]+=v[1]||0,i[u].allGroupMatchUpsCompleted=i[u].allGroupMatchUpsCompleted&&l,i[u].matchUpsCount+=a.length):o.forEach((y,b)=>n[b]+=y||0)}function W4e({collectionDefinition:t,collectionPosition:e}){var i,n;return(n=(i=t.collectionValueProfiles||[])==null?void 0:i.find(r=>r.collectionPosition===e))==null?void 0:n.matchUpValue}function KR(t){var e,i,n,r,a;let{sideAdjustments:s=[0,0],separator:o="-",drawDefinition:l,matchUpsMap:c,structure:u,matchUp:d,event:p}=t;if(!Array.isArray(s)||s.length!==2||isNaN(s.reduce((P,E)=>P+E)))return{error:Ae};if(!d)return{error:ll};let h=((e=Ws({matchUp:d,drawDefinition:l,structure:u,event:p}))==null?void 0:e.tieFormat)||(t==null?void 0:t.tieFormat);if(!h)return{error:kU};let f=Go({tieFormat:h});if(f.error)return f;let m=(h==null?void 0:h.collectionDefinitions)||[],g=(d==null?void 0:d.tieMatchUps)??[],v=[0,0],{groupValueGroups:y,groupValueNumbers:b}=FIe(h);for(let P of m)q4e({collectionDefinition:P,groupValueNumbers:b,groupValueGroups:y,sideTieValues:v,tieMatchUps:g});for(let P of b){let E=y[P],{allGroupMatchUpsCompleted:R,matchUpCount:C,winCriteria:M,groupValue:_,sideWins:A,values:N}=E,k;if(M!=null&&M.aggregateValue)R&&N[0]!==N[1]&&(k=N[0]>N[1]?1:2);else if(M!=null&&M.valueGoal)k=N.reduce((O,$,F)=>$>=M.valueGoal?F+1:O,void 0);else{let O=Math.floor(C/2)+1;k=A.reduce(($,F,V)=>F>=O?V+1:$,void 0)}k&&(v[k-1]+=_||0)}let I=v.map((P,E)=>(P||0)+s[E]),T={side1Score:I[0],side2Score:I[1],winningSide:void 0},w=I.join(o),S=I.slice().reverse().join(o),U;if(h!=null&&h.winCriteria){let{valueGoal:P,aggregateValue:E,tallyDirectives:R}=h.winCriteria;if(P?U=(i=I.map((C,M)=>({sideNumber:M+1,points:C})).find(({points:C})=>C>=P))==null?void 0:i.sideNumber:E&&g.every(C=>C.matchUpStatus&&va.includes(C.matchUpStatus)||C.winningSide)&&I[0]!==I[1]&&(U=I[0]>I[1]?1:2),!U&&R){let C=d.matchUpId,M=d.hasContext?d:((n=c==null?void 0:c.drawMatchUps)==null?void 0:n[C])||l&&((r=or({inContext:!0,drawDefinition:l,matchUpId:C}))==null?void 0:r.matchUp);if(M){let{completedTieMatchUps:_,order:A}=QU({matchUps:[M]});if(_&&A!=null&&A.length){let N=A[0].participantId;U=(a=M.sides.find(({participantId:k})=>k===N))==null?void 0:a.sideNumber}}}}return U&&(T.winningSide=U),{scoreStringSide1:w,scoreStringSide2:S,winningSide:U,set:T}}function ZR({inContextDualMatchUp:t,drawDefinition:e,tournamentId:i,dualMatchUp:n,eventId:r}){var a,s;if(n){t||(t=(a=or({matchUpId:n.matchUpId,inContext:!0,drawDefinition:e}))==null?void 0:a.matchUp);let{extension:o}=xi({element:e,name:am}),l=$t((o==null?void 0:o.value)||{},!1,!0),c=({displaySideNumber:u,drawPosition:d,sideNumber:p})=>({drawPosition:d,sideNumber:p,displaySideNumber:u});n.sides=(s=t==null?void 0:t.sides)==null?void 0:s.map(u=>{var d;let p=u.participantId,h=p&&l[p]||void 0,{lineUp:f,...m}=((d=n.sides)==null?void 0:d.find(({sideNumber:v})=>v===u.sideNumber))??{},g=f!=null&&f.length?f:h;return{...c(u),...m,lineUp:g}}),Qi({context:"ensureSidLineUps",matchUp:n,drawDefinition:e,tournamentId:i,eventId:r})}}function us(t){if(t)return $t(t,!1,!0)}function X8(t){let e=ei(t,[{[Os]:!0}]);return e.error?e:Object.keys(t.tournamentRecords).reduce((i,n)=>{i.tournamentIdMap[n]=[];let r=t.tournamentRecords[n].events??[],a=r.map(({eventId:o})=>o),s=r.map(o=>(o.drawDefinitions??[]).map(({drawId:l})=>l)).flat();return i.tournamentIdMap[n].push(...a,...s),i.eventIds.push(...a),i.drawIds.push(...s),i},{eventIds:[],drawIds:[],tournamentIdMap:{}})}function $Ie({tournamentRecords:t,eventId:e,drawId:i}){let{tournamentIdMap:n}=X8({tournamentRecords:t});return(n?Object.keys(n):[]).find(r=>e&&(n==null?void 0:n[r].includes(e))||i&&(n==null?void 0:n[r].includes(i)))}function Nm(t){var e,i,n,r;let{exitWhenNoValues:a,drawDefinition:s,matchUpStatus:o,removeScore:l,matchUpsMap:c,matchUpId:u,event:d}=t,p=t.tournamentRecords||t.tournamentRecord&&{[(e=t.tournamentRecord)==null?void 0:e.tournamentId]:t.tournamentRecord}||{},h=t.tournamentId||((i=t.tournamentRecord)==null?void 0:i.tournamentId);p&&$Ie({tournamentRecords:p,...t});let f=h&&p[h];if(!f)return{error:dt};let m=or({drawDefinition:s,event:d,matchUpId:u});if(m.error)return m;if(!m.matchUp)return{error:xs};let{matchUp:g,structure:v}=m;if(!g.tieMatchUps)return{error:cl};ZR({tournamentId:f==null?void 0:f.tournamentId,eventId:d==null?void 0:d.eventId,dualMatchUp:g,drawDefinition:s});let{extension:y}=xi({name:EI,element:g});if(y!=null&&y.value)if(l)uo({element:g,name:EI});else return{...pe,score:g.score};let b=(n=Ws({drawDefinition:s,structure:v,matchUp:g,event:d}))==null?void 0:n.tieFormat;g.tieFormat=us(b);let I=KR({drawDefinition:s,matchUpsMap:c,structure:v,matchUp:g,event:d}),{winningSide:T,set:w,scoreStringSide1:S,scoreStringSide2:U}=I,P=(w==null?void 0:w.side1Score)||(w==null?void 0:w.side2Score);if(a&&!g.score&&!P)return{...pe};let E={scoreStringSide1:S,scoreStringSide2:U,sets:w?[w]:[]},R=T&&[1,2].includes(T),C=R&&$r||m8({matchUpStatus:o??g.matchUpStatus,tieMatchUps:g.tieMatchUps,winningSide:g.winningSide,score:E})&&ad||jr,M=!!(g.winningSide&&!R),_=g.tieMatchUps.find(({score:N,winningSide:k,matchUpStatus:O})=>{var $;return(($=N==null?void 0:N.sets)==null?void 0:$.length)&&(N.sets[0].side1Score||N.sets[0].side2Score)||O&&va.includes(O)||k}),A;if(g.tieFormat&&!R&&!_){let N=(r=Ws({drawDefinition:s,structure:v,event:d}))==null?void 0:r.tieFormat;N&&JSON.stringify(b)===JSON.stringify(N)&&(g.tieFormatId=void 0,g.tieFormat=void 0,A=!0)}return wp({appliedPolicies:t.appliedPolicies,matchUpStatus:C,score:E,removeWinningSide:M,tournamentRecord:f,drawDefinition:s,removeScore:l,winningSide:T,matchUpId:u,matchUp:g,event:d}),{...pe,score:E,removeWinningSide:M,tieFormatRemoved:A,winningSide:T}}function Y4e({winnerMatchUpDrawPositionIndex:t,inContextDrawMatchUps:e,projectedWinningSide:i,sourceMatchUpStatus:n,winningDrawPosition:r,tournamentRecord:a,winnerTargetLink:s,sourceMatchUpId:o,drawDefinition:l,winnerMatchUp:c,dualMatchUp:u,matchUpsMap:d,event:p}){var h,f,m,g,v;let y="directWinner";if(s){let b=c.drawPositions||[],I=b[t],T=s.source.structureId,w=fi({structureId:T,drawDefinition:l});if(w.error)return w;let{structure:S}=w,{positionAssignments:U}=Aa({structureId:T,drawDefinition:l}),P=(h=U==null?void 0:U.find(A=>A.drawPosition===r))==null?void 0:h.participantId,E=s.target.structureId,{positionAssignments:R}=Aa({structureId:E,drawDefinition:l}),C=(f=R==null?void 0:R.find(A=>A.participantId===P))==null?void 0:f.drawPosition,M=R==null?void 0:R.filter(A=>{let N=b.includes(A.drawPosition),k=!A.participantId&&!A.bye&&!A.qualifier;return N&&k}).map(A=>A.drawPosition),_=M==null?void 0:M.includes(I);if(P&&s.target.roundNumber===1&&_)Lp({drawPosition:I,participantId:P,structureId:E,inContextDrawMatchUps:e,sourceMatchUpStatus:n,tournamentRecord:a,drawDefinition:l,matchUpsMap:d,event:p});else if(P&&M!=null&&M.length){let A=M.pop();A&&Lp({participantId:P,structureId:E,inContextDrawMatchUps:e,sourceMatchUpStatus:n,tournamentRecord:a,drawDefinition:l,drawPosition:A,matchUpsMap:d,event:p})}else if(C){let A=wT({drawPosition:C,matchUpId:c.matchUpId,inContextDrawMatchUps:e,sourceMatchUpStatus:n,tournamentRecord:a,sourceMatchUpId:o,drawDefinition:l,matchUpsMap:d});if(A.error)return fe({result:A,stack:y})}else if((S==null?void 0:S.stage)!==ri){let A="winner target position unavaiallble";return console.log(A),{error:A}}if(S!=null&&S.seedAssignments&&S.structureId!==E){let A=S.seedAssignments.find(({participantId:k})=>k===P),N=A==null?void 0:A.participantId;A&&N&&ZU({eventId:c==null?void 0:c.eventId,structureId:E,...A,tournamentRecord:a,drawDefinition:l,participantId:N})}}else{let b=wT({matchUpId:c.matchUpId,drawPosition:r,inContextDrawMatchUps:e,sourceMatchUpStatus:n,tournamentRecord:a,sourceMatchUpId:o,drawDefinition:l,matchUpsMap:d});if(b.error)return b}if(u&&i){let b=(m=u.sides)==null?void 0:m.find(I=>I.sideNumber===i);if(b!=null&&b.lineUp){let I=u.roundPosition,T=c.roundPosition,w=I===T&&I!==1||Math.floor(I/2)===T?2:1,S=(g=d==null?void 0:d.drawMatchUps)==null?void 0:g.find(({matchUpId:E})=>E===c.matchUpId),U=[1,2].map(E=>{var R;return{...((R=S.sides)==null?void 0:R.find(C=>C.sideNumber===E))||{},sideNumber:E}});S.sides=U;let P=S.sides.find(E=>E.sideNumber===w);if(P){let E=(v=b.lineUp)==null?void 0:v.filter(R=>R==null?void 0:R.participantId);P.lineUp=N8({lineUp:E}),Qi({tournamentId:a==null?void 0:a.tournamentId,eventId:c==null?void 0:c.eventId,matchUp:S,context:y,drawDefinition:l})}}}return{...pe}}function K4e(t){var e,i,n;let{loserMatchUpDrawPositionIndex:r,inContextDrawMatchUps:a,projectedWinningSide:s,sourceMatchUpStatus:o,loserDrawPosition:l,tournamentRecord:c,loserTargetLink:u,drawDefinition:d,loserMatchUp:p,dualMatchUp:h,matchUpsMap:f,event:m}=t,g="directLoser",v=u.linkCondition,y=p.drawPositions||[],b=v===xp&&p.roundNumber===2&&Math.min(...y.filter(Boolean)),I=b||y[r],T=b||y[1-r],w=u.source.structureId,{structure:S}=fi({structureId:w,drawDefinition:d}),{matchUps:U}=Sn({afterRecoveryTimes:!1,inContext:!0,drawDefinition:d,structure:S,event:m}),P=U.filter(B=>{var z;return(z=B.drawPositions)==null?void 0:z.includes(l)}).filter(B=>{let z=B.sides.find(Z=>Z.drawPosition===l),W=B.matchUpStatus===un||B.matchUpStatus===Ki&&!ya(B);return(z==null?void 0:z.sideNumber)===B.winningSide&&!W}),E=v===xp&&P.length===0,{positionAssignments:R}=Aa({structureId:w,drawDefinition:d}),C=(e=R==null?void 0:R.find(B=>B.drawPosition===l))==null?void 0:e.participantId,M=u.target.structureId,{positionAssignments:_}=Aa({structureId:M,drawDefinition:d}),A=_==null?void 0:_.filter(({drawPosition:B})=>y.includes(B));if(A!=null&&A.some(B=>B.participantId===C))return{...pe};let N=A==null?void 0:A.filter(B=>{let z=y.includes(B.drawPosition),W=!B.participantId&&!B.bye&&!B.qualifier;return z&&W}).map(B=>B.drawPosition),k=N==null?void 0:N.includes(I),O=u.target.roundNumber>1&&(N==null?void 0:N.length),$=u.target.roundNumber===1&&k;if(b){let B=F();if(B.error)return fe({result:B,stack:g})}else if($){let B=j();if(B.error)return fe({result:B,stack:g})}else if(C&&O){N.sort(ra);let B=N[0],z=Lp({participantId:C,structureId:M,drawPosition:B,inContextDrawMatchUps:a,sourceMatchUpStatus:o,tournamentRecord:c,drawDefinition:d,matchUpsMap:f,event:m});if(z.error)return fe({result:z,stack:g})}else return fe({context:{loserDrawPosition:l,loserTargetLink:u,targetDrawPositionIsUnfilled:k},result:{error:k?NU:_He},stack:g});if(S!=null&&S.seedAssignments&&S.structureId!==M){let B=S.seedAssignments.find(({participantId:W})=>W===C),z=B==null?void 0:B.participantId;B&&z&&ZU({eventId:p==null?void 0:p.eventId,structureId:M,...B,tournamentRecord:c,drawDefinition:d,participantId:z})}if(h&&s){let B=(i=h.sides)==null?void 0:i.find(z=>z.sideNumber===3-s);if(B!=null&&B.lineUp){let{roundNumber:z,eventId:W}=p,{roundPosition:Z}=h,K=z===1?2-Z%2:1,Q=(n=f==null?void 0:f.drawMatchUps)==null?void 0:n.find(({matchUpId:ie})=>ie===p.matchUpId),J=[1,2].map(ie=>{var ce;return{...((ce=Q.sides)==null?void 0:ce.find(oe=>oe.sideNumber===ie))||{},sideNumber:ie}});Q.sides=J;let se=Q.sides.find(ie=>ie.sideNumber===K);se&&(se.lineUp=N8({lineUp:B.lineUp}),Qi({tournamentId:c==null?void 0:c.tournamentId,matchUp:Q,context:g,drawDefinition:d,eventId:W}))}}return{...pe};function F(){let B="loserLinkFedFMLC";return fe(E?{result:j(),stack:B}:{result:V(),stack:B})}function V(){let B=yc({drawPosition:T,structureId:M,tournamentRecord:c,drawDefinition:d,event:m});return fe({result:B,stack:"assignLoserPositionBye"})}function j(){let B=C?Lp({drawPosition:I,participantId:C,structureId:M,inContextDrawMatchUps:a,sourceMatchUpStatus:o,tournamentRecord:c,drawDefinition:d,matchUpsMap:f,event:m}):{error:da};return fe({result:B,stack:"assignLoserDrawPosition"})}}function BIe(t){var e;let i="directParticipants",n=Z8(t);if(n.error)return fe({result:n,stack:i});let r=kR({matchUpStatus:t.matchUpStatus}),{dualWinningSideChange:a,projectedWinningSide:s,inContextDrawMatchUps:o,tournamentRecord:l,drawDefinition:c,matchUpStatus:u,dualMatchUp:d,matchUpsMap:p,winningSide:h,targetData:f,matchUpId:m,structure:g,matchUp:v,event:y}=t,b=!!v.collectionId,I=Ho({structure:g}),T=v.drawPositions,w;if(b){let{matchUpTieId:S,matchUpsMap:U}=t,P=Nm({appliedPolicies:t.appliedPolicies,matchUpId:S,tournamentRecord:l,drawDefinition:c,matchUpsMap:U,event:y});if(w=P&&{tieMatchUpResult:P},T=(e=o.find(({matchUpId:E})=>E===S))==null?void 0:e.drawPositions,!a)return fe({result:{...pe,...w},stack:i})}if(I)return fe({result:{...pe,...w},stack:i});if(T){let S=s?s-1:h-1,U=1-S,P=T[S],E=T[U],{targetLinks:{loserTargetLink:R,winnerTargetLink:C,byeTargetLink:M},targetMatchUps:{winnerMatchUpDrawPositionIndex:_,loserMatchUpDrawPositionIndex:A,winnerMatchUp:N,loserMatchUp:k,byeMatchUp:O}}=f;if(N){let $=Y4e({sourceMatchUpStatus:r&&u||$r,winnerMatchUpDrawPositionIndex:_,sourceMatchUpId:m,inContextDrawMatchUps:o,projectedWinningSide:s,winningDrawPosition:P,tournamentRecord:l,winnerTargetLink:C,drawDefinition:c,winnerMatchUp:N,dualMatchUp:d,matchUpsMap:p,event:y});if($.error)return fe({result:$,stack:i})}if(k){let $=K4e({sourceMatchUpStatus:r&&u||$r,loserMatchUpDrawPositionIndex:A,sourceMatchUpId:m,inContextDrawMatchUps:o,projectedWinningSide:s,loserDrawPosition:E,tournamentRecord:l,loserTargetLink:R,drawDefinition:c,loserMatchUp:k,winningSide:h,matchUpsMap:p,dualMatchUp:d,event:y});if($.error)return fe({result:$,stack:i})}if(O){let $=O.drawPositions||[],F=Math.min(...$.filter(Boolean)),V=M.target.structureId,j=yc({drawPosition:F,structureId:V,tournamentRecord:l,drawDefinition:c,event:y});if(j.error)return fe({result:j,stack:i})}}else return fe({result:{error:nR},stack:i});return fe({result:{...pe,...w},stack:i})}function J8(t){var e,i,n,r;let a="genPlayoffStructure";if(!t.drawDefinition)return fe({result:{error:Ht},stack:a});let s=zR(t);if(s.error)return fe({result:s,stack:a});let{structureId:o,addNameBaseToAttributeName:l,playoffStructureNameBase:c,finishingPositionNaming:u,finishingPositionLimit:d,playoffAttributes:p,playoffPositions:h,roundOffsetLimit:f,tournamentRecord:m,exitProfileLimit:g,roundProfiles:v,roundNumbers:y,idPrefix:b,isMock:I,event:T,uuids:w}=t,S=$t(t.drawDefinition,!1,!0),{structure:U}=fi({structureId:o,drawDefinition:S});if(!U)return fe({result:{error:yr},stack:a});if(U.structureType===Eo||U.structures)return C4e({sourceStructureId:U.structureId,...t,...s,drawDefinition:S});let{playoffRoundsRanges:P,playoffRounds:E}=s,{playoffPositionsReturned:R,error:C,playoffSourceRounds:M,playoffRoundsRanges:_}=SIe(t);if(C)return fe({result:{error:C},stack:a});let A=(v==null?void 0:v.length)&&Object.assign({},...v),N=y||typeof v=="object"&&v.map(ie=>Object.keys(ie)).flat(),k=Array.isArray(N)&&N.map(ie=>!isNaN(ie)&&di(ie)).filter(Boolean);if(k){if(!Array.isArray(k))return fe({result:{error:Ae},context:{validRoundNumbers:k},stack:a});k.forEach(ie=>{if(!(E!=null&&E.includes(ie)))return fe({result:{error:Ae},context:{roundNumber:ie},stack:a})})}h&&h.forEach(ie=>{if(!(R!=null&&R.includes(ie)))return fe({result:{error:Ae},context:{playoffPosition:ie},stack:a})});let O=k||M,$=k?P:_,F=[],V=[];for(let ie of O??[]){let ce=$==null?void 0:$.find(we=>we.roundNumber===ie);if(!ce)return fe({result:{error:Ae},context:{roundNumber:ie},stack:a});let oe=ce.finishingPositions.length,te=Math.min(...ce.finishingPositions)-1,le=2,ne=ie&&(A==null?void 0:A[ie])&&le+A[ie]-1,me=gS({exitProfile:`0-${ie}`,addNameBaseToAttributeName:l,playoffStructureNameBase:c,finishingPositionOffset:te,playoffAttributes:p,exitProfileLimit:g,stage:Mr,roundOffset:0,drawDefinition:S,sequenceLimit:ne,stageSequence:le,drawSize:oe,idPrefix:b,isMock:I,uuids:w,finishingPositionNaming:u,finishingPositionLimit:d,roundOffsetLimit:f});if(me.error)return fe({result:me,stack:a});let{structures:be,links:Se}=me;if(be!=null&&be.length&&F.push(...be),Se!=null&&Se.length&&V.push(...Se),me.structureId&&ie){let we={linkType:Hh,source:{structureId:o,roundNumber:ie},target:{structureId:me.structureId,feedProfile:Ru,roundNumber:1}};V.push(we)}}if(!F.length)return fe({result:{error:Ae},info:"No structures generated",stack:a});S.structures.push(...F),S.links.push(...V);let{matchUps:j,matchUpsMap:B}=pa({inContext:!0,drawDefinition:S}),z=F.map(({structureId:ie})=>ie),W=j==null?void 0:j.filter(({structureId:ie})=>z.includes(ie)).map(Ca),Z=(e=B==null?void 0:B.drawMatchUps)==null?void 0:e.filter(({matchUpId:ie})=>W==null?void 0:W.includes(ie));if(Z!=null&&Z.length){let ie=(i=Ws({drawDefinition:S,event:T}))==null?void 0:i.tieFormat;ie&&Z.forEach(ce=>{let{tieMatchUps:oe}=qR({matchUp:ce,tieFormat:ie,isMock:I});Object.assign(ce,{tieMatchUps:oe,matchUpType:Xn})})}(n=j==null?void 0:j.filter(ie=>Wv({matchUp:ie})&&ie.structureId===o))==null||n.forEach(ie=>{let{matchUpId:ce,score:oe,winningSide:te}=ie,le=bo({inContextDrawMatchUps:j,drawDefinition:S,matchUpId:ce}),ne=BIe({inContextDrawMatchUps:j,tournamentRecord:m,drawDefinition:S,matchUpsMap:B,winningSide:te,targetData:le,matchUpId:ce,structure:U,matchUp:ie,score:oe,event:T});ne.error&&console.log(ne.error)}),(r=j==null?void 0:j.filter(ie=>ie.matchUpStatus===gn&&ie.structureId===o))==null||r.forEach(ie=>{let{matchUpId:ce}=ie,oe=bo({inContextDrawMatchUps:j,drawDefinition:S,matchUpId:ce}),{targetLinks:{loserTargetLink:te},targetMatchUps:{loserMatchUpDrawPositionIndex:le,loserMatchUp:ne}}=oe;if(te&&ne){let me=te.target.structureId,be=ne.drawPositions[le],Se=yc({drawPosition:be,structureId:me,tournamentRecord:m,drawDefinition:S,event:T});Se.error&&console.log(Se.error)}});let K=[],Q=wy({inContextDrawMatchUps:j,drawDefinition:S,matchUpsMap:B}).goesToMap,{structure:J}=fi({drawDefinition:t.drawDefinition,structureId:o}),{matchUps:se}=Sn({structure:J});return se.forEach(ie=>{var ce,oe;let te=Q==null?void 0:Q.loserMatchUpIds[ie.matchUpId];if(te&&ie.loserMatchUpId!==te){ie.loserMatchUpId=te;let ne={tournamentId:m==null?void 0:m.tournamentId,eventId:(ce=t.event)==null?void 0:ce.eventId,context:a,matchUp:ie};K.push(ne)}let le=Q==null?void 0:Q.winnerMatchUpIds[ie.matchUpId];if(le&&ie.winnerMatchUpId!==le){ie.winnerMatchUpId=le;let ne={tournamentId:m==null?void 0:m.tournamentId,eventId:(oe=t.event)==null?void 0:oe.eventId,context:a,matchUp:ie};K.push(ne)}}),{structures:F,matchUpModifications:K,links:V,drawDefinition:S,...pe}}function VIe({element:t}){if(!t)return{error:Ae};if(!t.timeItems)return{};if(!Array.isArray(t.timeItems))return{error:Ae};let e=(i,n)=>(r,a)=>(a[i]&&(r[a[i]]=a[n]),r);return t.timeItems.reduce(e("itemType","itemValue"),{})}function Zp(t){let{duplicateValues:e=!0,creationTime:i=!0,removePriorValues:n,timeItem:r}=t;if(!r)return{error:e6};let a=Xye(t);if(a.error)return a;if(!(tn(r)&&ur(r.itemType)&&Object.keys(r).includes("itemValue")))return{error:Q5};if(!a.timeItems)a.timeItems=[];else if(Z4e({element:a,duplicateValues:e,timeItem:r}))return{...pe};if(r.itemSubTypes&&!r.itemSubTypes.length&&delete r.itemSubTypes,i){let s=new Date().toISOString();Object.assign(r,{createdAt:s})}return n&&(a.timeItems=a.timeItems.filter(({itemType:s})=>r.itemType!==s)),n&&!r.itemValue||a.timeItems.push(r),{...pe}}function Z4e({element:t,duplicateValues:e,timeItem:i}){var n;let{itemType:r,itemSubTypes:a,itemValue:s}=i,o=r&&((n=su({itemSubTypes:a,itemType:r,element:t}))==null?void 0:n.timeItem);return o&&JSON.stringify(o==null?void 0:o.itemValue)===JSON.stringify(s)&&!e}function Q8({creationTime:t=!0,removePriorValues:e,tournamentRecord:i,duplicateValues:n,participantId:r,timeItem:a}){if(!i)return{error:dt};if(!r)return{error:da};let s=ev({tournamentRecord:i,participantId:r});return s.error?s:Zp({element:s.participant,removePriorValues:e,duplicateValues:n,creationTime:t,timeItem:a})}function XR(t){let{removePriorValues:e,tournamentRecord:i,duplicateValues:n,creationTime:r,timeItem:a}=t;if(!i)return{error:dt};let s=Zp({element:i,removePriorValues:e,duplicateValues:n,creationTime:r,timeItem:a});if(s.error)return s;let o=VIe({element:i});return Ti({payload:{parentOrganisation:i.parentOrganisation,tournamentId:i.tournamentId,timeItemValues:o},topic:Xy}),s}function $w(t){let{removePriorValues:e,duplicateValues:i,creationTime:n,timeItem:r,event:a}=t;return a?Zp({removePriorValues:e,duplicateValues:i,element:a,creationTime:n,timeItem:r}):{error:Wc}}function jIe(t){return PF({...t,itemType:"attachConsolationStructures"})}function e7(t){return PF({...t,itemType:"attachPlayoffStructures"})}function PF({itemType:t="attachStructures",matchUpModifications:e,tournamentRecord:i,drawDefinition:n,structures:r,links:a=[],event:s}){var o,l,c;let u="attachStructures";if(!n)return{error:Ht};if(!Array.isArray(r)||!Array.isArray(a))return fe({result:{error:Ae},stack:u});let d=b=>{var I;return[b.source.structureId,b.source.roundNumber||((I=b.source.finishingPositions)==null?void 0:I.join("|")),b.target.roundNumber].join("|")},p=(o=n.links)==null?void 0:o.map(d);if(a.some(b=>{let I=d(b);return p==null?void 0:p.includes(I)}))return fe({result:{error:a6},info:"playoff structure exists",stack:u});a.length&&((l=n.links)==null||l.push(...a));let h=r.map(({structureId:b})=>b),f=(c=n.structures)==null?void 0:c.map(({structureId:b})=>b);n.structures=(n.structures??[]).map(b=>h.includes(b.structureId)?r.find(({structureId:I})=>I===b.structureId):b);let m=r==null?void 0:r.filter(({structureId:b})=>!(f!=null&&f.includes(b)));m.length&&n.structures.push(...m),wy({drawDefinition:n});let g=r.map(b=>{var I;return((I=Sn({structure:b}))==null?void 0:I.matchUps)||[]}).flat();Tg({tournamentId:i==null?void 0:i.tournamentId,eventId:s==null?void 0:s.eventId,drawDefinition:n,matchUps:g});let v=r.map(({structureId:b})=>b);if(zn({drawDefinition:n,structureIds:v}),e==null?void 0:e.length){let b={};e.forEach(T=>{var w;let S=(w=T.matchUp)==null?void 0:w.matchUpId;S&&(b[S]=T)});let I=T=>{T.matchUps.forEach(w=>{if(b[w.matchUpId]){let{tieMatchUps:S,...U}=b[w.matchUpId].matchUp;if(Object.assign(w,U),S==null?void 0:S.length){let P={};S.forEach(E=>b[E.matchUpId]=E),w.tieMatchUps.forEach(E=>Object.assign(E,P[E.matchUpId]))}b[w.matchUpId].matchUp=w,Qi(b[w.matchUpId])}})};n.structures.forEach(T=>{if(f!=null&&f.includes(T.structureId))if(T.structures)for(let w of T.structures)I(w);else I(T)})}let y=m.map(Bl("structureId"));if(i){let b={itemValue:{structureIds:v,drawId:n.drawId},itemType:t};Zp({element:i,timeItem:b})}return{...pe,addedStructureIds:y}}function CF(t){var e,i;let{structures:n,links:r,matchUpModifications:a,error:s}=J8(t);if(s)return{error:s};let o=t.drawDefinition;return e7({tournamentId:(e=t.tournamentRecord)==null?void 0:e.tournamentId,eventId:((i=t.event)==null?void 0:i.eventId)||t.eventId,matchUpModifications:a,drawDefinition:o,structures:n,links:r})}function Ty(t){let e=ei(t,[{_anyOf:{[Os]:!1,[Ia]:!1,[Po]:!1,[Zg]:!1},[T6]:!0}]);if(e.error)return e;let i=[],n=t.drawDefinition??t.event??((t.tournamentId||!t.tournamentRecords)&&t.tournamentRecord);if(n){let r=dJ(t,n);if(r.error)return r;i.push(...(r==null?void 0:r.applied)??[]),t.drawDefinition&&zn({drawDefinition:t.drawDefinition,tournamentId:t.tournamentId})}else if(t.tournamentRecords){let r=Object.keys(t.tournamentRecords);if(!r.length)return{error:dt};for(let a of r){let s=t.tournamentRecords[a],o=dJ(t,s);if(o.error)return o;i.push(...(o==null?void 0:o.applied)??[])}}else return{error:dt};return i.length?{...pe,applied:i}:{error:q5}}function dJ(t,e){let i=fn(t).appliedPolicies??{};e.extensions||(e.extensions=[]);let n=[],r=Object.keys(t.policyDefinitions);if(!r.length)return{error:TL};for(let a of r)if(!i[a]||t.allowReplacement){let s=t.policyDefinitions[a];if(!s)continue;if(!tn(s))return{error:Ae};let{policyName:o,...l}=s;if(!l||!Object.keys(l).length||o&&!ur(o))return{error:Ae};i[a]=t.policyDefinitions[a],n.push(a)}return n!=null&&n.length?{...pn({element:e,extension:{name:qE,value:i}}),applied:n}:{applied:n,error:q5}}function t7({tournamentRecord:t,drawDefinition:e,flightProfile:i,drawName:n,drawId:r,event:a}){var s;if(!n||typeof n!="string")return fe({result:{error:Ae},context:{drawName:n}});i||(i=kr({event:a}).flightProfile);let o=(s=i==null?void 0:i.flights)==null?void 0:s.find(l=>l.drawId===r);if(o){o.drawName=n;let l={name:Xu,value:{...i,flights:i.flights}};Jg({event:a,extension:l})}return e&&(e.drawName=n,zn({tournamentId:t==null?void 0:t.tournamentId,drawDefinition:e})),!o&&!e?{error:Ht}:{...pe,flight:o}}function GIe({tournamentRecord:t,drawDefinition:e,drawUpdates:i,drawId:n,event:r}){var a;if(!tn(i))return{error:Ae};let s=kr({event:r}).flightProfile,o=i.drawName&&t7({drawName:i.drawName,tournamentRecord:t,drawDefinition:e,flightProfile:s,drawId:n,event:r});if(o!=null&&o.error)return o==null?void 0:o.error;let l=(o==null?void 0:o.flight)||((a=s==null?void 0:s.flights)==null?void 0:a.find(c=>c.drawId===n));if(!l&&!e)return{error:Ht};if(l){let c={name:Xu,value:{...s,flights:s.flights}};Jg({event:r,extension:c})}return e&&(i.policyDefinitions&&Ty({policyDefinitions:i.policyDefinitions,drawDefinition:e}),zn({tournamentId:t==null?void 0:t.tournamentId,drawDefinition:e})),{...pe}}function HIe({tournamentRecord:t,removeScheduling:e,drawDefinition:i}){var n,r;if(!i)return{error:Ht};let a=Us({drawDefinition:i}),s=l=>{var c;return(c=a==null?void 0:a.drawMatchUps)==null?void 0:c.find(u=>u.matchUpId===l)};for(let l of i.structures||[]){let{positionAssignments:c,stage:u,stageSequence:d}=l;c&&(d!==1||![ri,Bt].includes(u))&&(l.positionAssignments=c.map(f=>(delete f.participantId,f)),l.seedAssignments=[]);let{matchUps:p,isRoundRobin:h}=Sn({afterRecoveryTimes:!1,inContext:!0,matchUpsMap:a,structure:l});for(let f of p){let{matchUpId:m,roundNumber:g}=f,v=f.sides||[],y=s(m);if(y){if(delete y.extensions,delete y.notes,y.matchUpStatus!==gn&&Object.assign(y,EF),g&&g>1&&((n=y.drawPositions)==null?void 0:n.length)&&!h){let b=v==null?void 0:v.map(({drawPosition:T,participantFed:w})=>!w&&T).filter(Boolean),I=y.drawPositions.map(T=>b.includes(T)?void 0:T);y.drawPositions=I}e?delete y.timeItems:(r=y.timeItems)!=null&&r.length&&(y.timeItems=y.timeItems.filter(b=>b.itemType&&![Yh,Dg,Cw,d8,Rw,Mw].includes(b.itemType))),Qi({tournamentId:t==null?void 0:t.tournamentId,context:"resetDrawDefiniton",drawDefinition:i,matchUp:y})}}}i.extensions=i.extensions.filter(l=>l.name!==mS);let o=(i.structures||[]).map(({structureId:l})=>l);return zn({drawDefinition:i,structureIds:o}),{...pe}}function JR({tournamentRecord:t}){var e;if(!t)return{error:dt};let i={positionsNoOutcomes:[],canBePruned:[],matchPlay:[],inactive:[],drawAnalysis:{}},n={};return((e=t.events)==null?void 0:e.map(r=>{let a=r.eventId;return n[a]=r,((r==null?void 0:r.drawDefinitions)||[]).map(s=>({drawDefinition:s,eventId:a}))}).flat().filter(Boolean)).forEach(({drawDefinition:r,eventId:a})=>{let s=0,o=0,l=0,{allStructuresLinked:c}=SF({drawDefinition:r}),u=n[a],d=((r==null?void 0:r.structures)||[]).map(I=>{let{stage:T,stageSequence:w,structureId:S}=I,U=UI[T],{inContextStructureMatchUps:P}=xR({drawDefinition:r,structure:I,event:u}),E=P==null?void 0:P.filter(({winningSide:B})=>B),R=E.filter(Boolean).length||0;o+=R,l+=P.length-o;let C=Math.max(E.filter(({roundNumber:B})=>B===1).map(({roundPosition:B})=>B)),{positionAssignments:M}=Gn({structure:I}),_=M==null?void 0:M.filter(({participantId:B})=>B);s+=(_==null?void 0:_.length)??0;let A=((M==null?void 0:M.length)??0)-((_==null?void 0:_.length)??0),{roundMatchUps:N,roundProfile:k,roundNumbers:O,maxMatchUpsCount:$}=yo({matchUps:P}),F=k&&Object.keys(k).filter(B=>!k[B].inactiveRound).map(B=>parseInt(B)),V=k&&Object.keys(k).filter(B=>k[B].inactiveRound).map(B=>parseInt(B)),j=k&&Object.values(k).every(B=>B.inactiveRound);return{positionsAssignedCount:(_==null?void 0:_.length)??0,maxWinningSideFirstRoundPosition:C,unassignedPositionsCount:A,inactiveStructure:j,maxMatchUpsCount:$,inactiveRounds:V,roundMatchUps:N,activeRounds:F,roundNumbers:O,roundProfile:k,structureId:S,stageSequence:w,orderNumber:U,stage:T}}),p=d.find(I=>I.orderNumber===2&&I.stageSequence===1),h=d.filter(({inactiveStructure:I})=>!I).length,{links:f}=qU({structureId:p.structureId,drawDefinition:r}),m=di(p.activeRounds[0])===1&&p.activeRounds.length===1&&h===1,g=d==null?void 0:d.every(({inactiveStructure:I})=>I),v=!f.length&&p.activeRounds.length&&(p.roundProfile[1].inactiveCount||p.inactiveRounds.length),y=r.drawId;s&&!o&&i.positionsNoOutcomes.push(y),g&&i.inactive.push(y),m&&i.matchPlay.push(y),v&&i.canBePruned.push(y);let b={matchUpsWithWinningSideCount:o,matchUpsNoOutcomeCount:l,positionsAssignedCount:s,allStructuresLinked:c,structuresData:d,inactiveDraw:g,isMatchPlay:m,drawId:y};i.drawAnalysis[y]=b}),{...pe,drawsAnalysis:i}}function zIe({matchPlayDrawPositions:t=!0,tournamentRecord:e,drawDefinition:i,drawId:n}){var r;if(!e)return{error:dt};if(!i)return{error:Ht};let a=[],{drawsAnalysis:s}=JR({tournamentRecord:e});if(s.canBePruned.includes(n)){let o=s.matchPlay.includes(n),l=s.drawAnalysis[n],{structures:[c]}=Ju({stageSequence:1,drawDefinition:i,stage:Bt}),u=l.structuresData.find(({structureId:f})=>c.structureId===f),d=(c.matchUps??[]).sort((f,m)=>f.roundPosition-m.roundPosition);a=d.filter(({roundNumber:f})=>!u.inactiveRounds.includes(f));let p=a.map(Ca),h=d.map(Ca).filter(f=>!p.includes(f));if(o){let f=a.filter(({roundNumber:b})=>!u.inactiveRounds.includes(b)).filter(({winningSide:b})=>b),m=f.map(Ca),g=p.filter(b=>!m.includes(b));h.push(...g);let v=f.flatMap(b=>b.drawPositions??[]).filter(Boolean).flat(),y=Object.assign({},...v.map((b,I)=>({[b]:I+1})));if(f.forEach(b=>{t?b.drawPositions=b.drawPositions.map(I=>y[I]):delete b.drawPositions}),t){let b=(r=c==null?void 0:c.positionAssignments)==null?void 0:r.filter(I=>v.includes(I.drawPosition)).map(I=>(I.drawPosition=y[I.drawPosition],I));c.positionAssignments=b}else c.positionAssignments=[];c.matchUps=f,a=f}Cm({tournamentId:e==null?void 0:e.tournamentId,matchUpIds:h,drawDefinition:i}),zn({drawDefinition:i})}return{...pe,matchUps:a}}function qIe({tournamentRecord:t,drawDefinition:e,participantId:i,drawPosition:n,structureId:r,qualifier:a,event:s,bye:o}){if(!e)return{error:Ht};if(!n)return{error:AU};if(!r)return{error:mc};if(o){let l=yc({tournamentRecord:t,drawDefinition:e,drawPosition:n,structureId:r,event:s});if(l.error)return l}else{if(a)return{error:AL};{let l=Lp({tournamentRecord:t,drawDefinition:e,participantId:i,drawPosition:n,structureId:r,event:s});if(l.error)return l}}return{...pe}}function WIe(t){var e,i,n,r,a;let s=t.matchUpIds??[],{drawDefinition:o}=t,l=t.structureId??((i=(e=o==null?void 0:o.structures)==null?void 0:e.find(h=>{var f;return(f=h.matchUps)==null?void 0:f.some(({matchUpId:m})=>s.includes(m))}))==null?void 0:i.structureId)??((r=(n=o==null?void 0:o.structures)==null?void 0:n[0])==null?void 0:r.structureId);if(!l)return{error:yr};let c=(a=o.structures)==null?void 0:a.find(h=>h.structureId===l);if(!c)return{error:yr};let u=c==null?void 0:c.matchUps,d=u==null?void 0:u.find(h=>!!h.roundPosition);if(c.structures||d||c.finishingPosition===Uw)return{error:Wy};let p=u.filter(({roundNumber:h})=>{var f;return(f=t.roundNumbers)==null?void 0:f.includes(h)}).map(Ca);return s=s.filter(h=>!p.includes(h)),t.roundNumbers&&!s.length&&(s=p),{existingMatchUps:u,matchUpIds:s,structureId:l,structure:c}}function YIe(t){let e=ei(t,[{[Po]:!0},{[fT]:{[mR]:!1,roundNumbers:!1},[cc]:Ae,[Wo]:Ms}]);if(e.error)return e;let{removeIncomplete:i=!1,removeUnAssigned:n=!0,removeCompleted:r=!1,tournamentRecord:a,drawDefinition:s,event:o}=t,l=WIe(t);if(l.error)return l;let{structure:c,structureId:u,existingMatchUps:d,matchUpIds:p}=l,h=[],f=(d==null?void 0:d.filter(({matchUpId:v,score:y,winningSide:b})=>{if(b&&!r)return!1;if(b||ya({score:y})){if(!b&&!i)return!1;h.push(v)}else if(!n)return!1;return p==null?void 0:p.includes(v)}))??[],m=f.map(Ca),g=f.map(({tieMatchUps:v})=>v==null?void 0:v.map(Ca)).filter(Boolean).flat();if(m.length){c.matchUps=(c.matchUps??[]).filter(({matchUpId:b})=>!m.includes(b)),Cm({tournamentId:a==null?void 0:a.tournamentId,matchUpIds:[...g,...m],action:"deleteAdHocMatchUps",eventId:o==null?void 0:o.eventId,drawDefinition:s});let v=Pi(c.matchUps.map(Bl("roundNumber"))),y=EHe(v);if(y.length){y.reverse();for(let b of y)c.matchUps.forEach(I=>{I.roundNumber&&I.roundNumber>b&&(I.roundNumber-=1,Qi({tournamentId:a==null?void 0:a.tournamentId,context:["adHoc round deletion"],eventId:o==null?void 0:o.eventId,drawDefinition:s,matchUp:I}))})}if(h.length){c.positionAssignments=Pi(c.matchUps.flatMap(S=>(S.sides??[]).map(U=>U.participantId)).filter(Boolean)).map(S=>({participantId:S}));let b=(c==null?void 0:c.matchUpFormat)??(s==null?void 0:s.matchUpFormat)??(o==null?void 0:o.matchUpFormat),I=l.existingMatchUps.some(S=>S.matchUpType===ac)?{matchUpTypes:[ac]}:void 0,{matchUps:T}=Sn({afterRecoveryTimes:!1,inContext:!0,matchUpFilters:I,structure:c,event:o});Ho({structure:c})&&(c.positionAssignments=Pi(T.flatMap(S=>(S.sides??[]).map(U=>U.participantId)).filter(Boolean)).map(S=>({participantId:S})));let w=Y8({positionAssignments:c.positionAssignments,tournamentRecord:a,drawDefinition:s,matchUpFormat:b,matchUps:T,event:o});w.error&&console.log(w)}zn({structureIds:[u],eventId:o==null?void 0:o.eventId,drawDefinition:s})}return!m.length&&p.length?{error:kL}:{...pe,deletedMatchUpsCount:[...m,...g].length}}function KIe({removeCompletedMatchUps:t,tournamentRecord:e,drawDefinition:i,structureId:n,roundNumber:r,event:a}){if(!e)return{error:dt};if(!i)return{error:Ht};if(!r)return fe({result:{error:si},info:"roundNumber required"});let s=fi({drawDefinition:i,structureId:n});if(s.error)return s;let o=s.structure;return o!=null&&o.structures?{error:Wy}:Ho({structure:o})?X4e({tournamentId:e.tournamentId,removeCompletedMatchUps:t,eventId:a.eventId,drawDefinition:i,roundNumber:r,structure:o}):(console.log("not implemented"),{...pe})}function X4e({removeCompletedMatchUps:t,drawDefinition:e,tournamentId:i,roundNumber:n,structure:r,eventId:a}){let s=(r==null?void 0:r.matchUps)??[],o=[],l=[],c=!1;if(s.reduce((u,d)=>{let p=d==null?void 0:d.roundNumber;return p?u.includes(p)?u:u.concat(p):u},[]).sort(ra).includes(n)){let u=s.filter(d=>{let p=d.roundNumber===n&&(!va.includes(d.matchUpStatus)||t);return p&&(l.push(d.matchUpId),d.tieMatchUps&&o.push(...d.tieMatchUps.map(Ca))),!p});l.length&&(Cm({matchUpIds:[...o,...l],drawDefinition:e,tournamentId:i,eventId:a}),u.some(d=>d.roundNumber===n)||(u.forEach(d=>{d.roundNumber>n&&(d.roundNumber-=1,Qi({drawDefinition:e,tournamentId:i,eventId:a,matchUp:d}))}),c=!0),r.matchUps=u)}return{deletedMatchUpsCount:l.length,roundRemoved:c,...pe}}function RF(t){var e,i,n,r,a,s;let{suppressNotifications:o,tournamentRecord:l,drawDefinition:c,matchUps:u,event:d}=t;if(typeof c!="object")return{error:Ht};let p=t==null?void 0:t.structureId;if(!p&&((e=c.structures)==null?void 0:e.length)===1&&(p=(n=(i=c.structures)==null?void 0:i[0])==null?void 0:n.structureId),typeof p!="string")return{error:mc};if(!lu(u))return{error:Ae,info:Sy("matchUps")};let h=(r=c.structures)==null?void 0:r.find(y=>y.structureId===p);if(!h)return{error:yr};let f=(h==null?void 0:h.matchUps).find(y=>!!y.roundPosition);if(h.structures||f||h.finishingPosition===Uw)return{error:Wy};let m=((s=(a=Za({tournamentRecord:l,inContext:!1}))==null?void 0:a.matchUps)==null?void 0:s.map(Ca))??[],g=u.map(Ca);if(vo(m,g))return{error:eve,info:"One or more matchUpIds already present in tournamentRecord"};h.matchUps.push(...u);let v=u.map(({tieMatchUps:y})=>y).filter(Boolean).flat();return o||(Tg({tournamentId:l==null?void 0:l.tournamentId,matchUps:[...v,...u],eventId:d==null?void 0:d.eventId,drawDefinition:c}),zn({drawDefinition:c,structureIds:[p]})),{...pe}}function ZIe({tournamentRecord:t,drawDefinition:e,drawPosition:i,structureId:n,subOrder:r,event:a}){var s;if(!e)return{error:Ht};if(!n)return{error:mc};if(!i)return{error:AU};let{structure:o}=fi({drawDefinition:e,structureId:n});if(!o)return{error:yr};let l=o;o.structures&&o.structureType===Eo&&(l=(s=o.structures)==null?void 0:s.find(f=>{var m;return(m=f.positionAssignments)==null?void 0:m.find(g=>g.drawPosition===i)}));let c=l==null?void 0:l.positionAssignments,u=c==null?void 0:c.find(f=>f.drawPosition===i);u&&pn({element:u,extension:{name:vT,value:r}});let d=((a==null?void 0:a.eventType)===Xn||e.matchUpType===Xn||((a==null?void 0:a.tieFormat)??(e==null?void 0:e.tieFormat)??(o==null?void 0:o.tieFormat)))&&{matchUpTypes:[Xn]},{matchUps:p}=Sn({structure:l,afterRecoveryTimes:!1,inContext:!0,matchUpFilters:d,event:a}),h=(o==null?void 0:o.matchUpFormat)??e.matchUpFormat;return Y8({positionAssignments:c,tournamentRecord:t,drawDefinition:e,matchUpFormat:h,matchUps:p,event:a}),zn({drawDefinition:e,structureIds:[n]}),{...pe}}var XIe={};Fi(XIe,{addGoesTo:()=>wy,allPlayoffPositionsFilled:()=>x8,checkValidEntries:()=>AF,findDrawDefinition:()=>a7,getAssignedParticipantIds:()=>rb,getAvailableMatchUpsCount:()=>MF,getAvailablePlayoffProfiles:()=>zR,getDrawDefinitionTimeItem:()=>i8,getDrawParticipantRepresentativeIds:()=>n7,getDrawStructures:()=>Ju,getDrawTypeCoercion:()=>QR,getEligibleVoluntaryConsolationParticipants:()=>i7,getMatchUpsMap:()=>Us,getParticipantIdFinishingPositions:()=>r7,getPositionAssignments:()=>QE,getPositionsPlayedOff:()=>JU,getSeedingThresholds:()=>R8,getSeedsCount:()=>eM,getStructureSeedAssignments:()=>Zc,getTeamLineUp:()=>Iy,getValidGroupSizes:()=>VR,isAdHoc:()=>Ho,isCompletedStructure:()=>Eg,isValidForQualifying:()=>l7,positionActions:()=>o7});function i7({excludedMatchUpStatuses:t=[],includeEventParticipants:e,includeQualifyingStage:i,finishingRoundLimit:n,policyDefinitions:r,roundNumberLimit:a,tournamentRecord:s,drawDefinition:o,matchUpsLimit:l,requirePlay:c,requireLoss:u,allEntries:d,winsLimit:p,event:h}){var f,m,g,v,y;if(!o)return{error:Ht};let b=[Bt,Mr];i&&b.push(ri);let I=h!=null&&h.eventType?{matchUpTypes:[h.eventType]}:void 0,T=o!=null&&o.matchUpType?{matchUpTypes:[o.matchUpType]}:void 0,w=e&&h?((f=nf({contextFilters:{stages:b},matchUpFilters:I,tournamentRecord:s,inContext:!0,event:h}))==null?void 0:f.matchUps)??[]:((m=po({contextFilters:{stages:b},matchUpFilters:T,tournamentRecord:s,inContext:!0,drawDefinition:o}))==null?void 0:m.matchUps)??[],S=Pw({stage:ja,drawDefinition:o}).map(({participantId:j})=>j),U={},P={},E={},R={};r||(r=Rm({policyTypes:[qj],tournamentRecord:s,drawDefinition:o,event:h}).policyDefinitions);let C=r==null?void 0:r[qj];t=t.length&&t||(C==null?void 0:C.excludedMatchUpStatuses)||[],e=e??(C==null?void 0:C.includeEventParticipants),d=d??(C==null?void 0:C.allEntries),n=n??(C==null?void 0:C.finishingRoundLimit),a=a??(C==null?void 0:C.roundNumberLimit),l=l??(C==null?void 0:C.matchUpsLimit),c===void 0&&(c=(C==null?void 0:C.requirePlay)!==void 0?C.requirePlay:!0),u===void 0&&(u=(C==null?void 0:C.requireLoss)!==void 0?C.requireLoss:!0),p=p??(C==null?void 0:C.winsLimit);for(let j of w){if(c&&j.winningSide&&![1,2].includes(j.winningSide)&&j.matchUpStatus!==Kr||j.finishingRound&&n&&j.finishingRound>=n||j.finishingRound&&a&&j.finishingRound<=a)continue;let B=(g=j.sides)==null?void 0:g.find(({sideNumber:W})=>j.winningSide&&W===3-j.winningSide),z=(v=j.sides)==null?void 0:v.find(({sideNumber:W})=>j.winningSide&&W===j.winningSide);if((y=j.sides)==null||y.forEach(W=>{var Z;let K=(Z=W==null?void 0:W.participant)==null?void 0:Z.participantId;K&&(E[K]=W.participant,j.matchUpStatus===Kr&&!c&&(P[K]=W.participant,U[K]||(U[K]=0),(!j.matchUpStatus||!t.includes(j.matchUpStatus))&&(U[K]+=1)))}),B==null?void 0:B.participant){let W=B.participant.participantId;P[W]=B.participant,U[W]||(U[W]=0),j.matchUpStatus&&!t.includes(j.matchUpStatus)&&(U[W]+=1)}if(z!=null&&z.participant){let W=z.participant.participantId;R[W]||(R[W]=0),R[W]+=1,U[W]||(U[W]=0),j.matchUpStatus&&!t.includes(j.matchUpStatus)&&(U[W]+=1)}}let M=(s==null?void 0:s.participants)&&!c&&!u&&d,_=M?((e&&h?h.entries:o.entries)??[]).filter(j=>![Wh,ou].includes(j.entryStatus)).map(({participantId:j})=>j):[],A=Object.keys(P),N=M?((s==null?void 0:s.participants)??[]).filter(({participantId:j})=>_.includes(j)):u&&Object.values(P)||Object.values(E),k=j=>!u||A.includes(j),O=j=>!c||(U[j]||0)>=0,$=j=>!p||(R[j]||0)<=p,F=j=>!l||U[j]<=l,V=j=>!S.includes(j);return{eligibleParticipants:N.filter(j=>k(j.participantId)&&O(j.participantId)&&$(j.participantId)&&F(j.participantId)&&V(j.participantId)).map(j=>{var B;return{...j,individualParticipants:(B=j.individualParticipantIds)==null?void 0:B.map(z=>{var W;return(W=s==null?void 0:s.participants)==null?void 0:W.find(Z=>Z.participantId===z)})}}),losingParticipantIds:A,...pe}}function MF(t){var e,i,n,r,a,s,o,l;let c=ei(t,[{drawDefinition:!0}]);if(c.error)return c;let{drawDefinition:u,roundNumber:d}=t,p=t.structureId??(((e=u.structures)==null?void 0:e.length)===1&&((n=(i=u.structures)==null?void 0:i[0])==null?void 0:n.structureId));if(typeof p!="string")return{error:mc};let h=(r=u.structures)==null?void 0:r.find(w=>w.structureId===p);if(!h)return{error:yr};let f,m=(a=h.matchUps??[])==null?void 0:a.reduce((w,S)=>(S.roundPosition&&(f=!0),((S==null?void 0:S.roundNumber)||0)>w?S.roundNumber:w),0);if(h.structures||f||h.finishingPosition===Uw)return{error:Wy};let g=((s=u==null?void 0:u.entries)==null?void 0:s.filter(w=>{let S=w.entryStatus;return sd.includes(S)}))??[],v=Math.floor((g==null?void 0:g.length)/2)||1,y=d??m??1,b=((l=(o=h.matchUps)==null?void 0:o.filter(w=>w.roundNumber===y))==null?void 0:l.length)??0,I=v-b,T=I>0?I:0;return{...pe,availableMatchUpsCount:T,lastRoundNumber:m,roundMatchUpsCount:v}}function n7({drawDefinition:t}){var e;let i=xi({name:"participantRepresentatives",element:t});return i.error?i:{representativeParticipantIds:((e=i.extension)==null?void 0:e.value)||[]}}function J4e({tournamentParticipants:t,drawDefinition:e,event:i}){if(!e)return{error:Ht};let n=pa({tournamentParticipants:t,inContext:!0,drawDefinition:e,event:i}),r=$t(n.matchUps,!1,!0),a=Pi(r.reduce((o,l)=>o.concat(...l.sides.map(c=>c.participantId).filter(Boolean)),[])),s=Object.assign({},...a.map(o=>{let l=r.filter(c=>c.sides.map(u=>u.participantId).filter(Boolean).includes(o));return{[o]:l}}));return{participantIds:a,participantIdMatchUps:s}}function r7({byeAdvancements:t=!1,tournamentRecord:e,drawDefinition:i}){if(!i)return{error:Ht};let{participantIds:n,participantIdMatchUps:r}=J4e({tournamentParticipants:e==null?void 0:e.participants,drawDefinition:i}),a=(n==null?void 0:n.map(s=>{let o=r[s].filter(d=>[$r,gn].includes(d.matchUpStatus)||d.winningSide),l=o.map(d=>{let p=d.sides.find(f=>f.bye),h=d.sides.find(f=>f.participantId===s).sideNumber;return(d.winningSide||t&&p&&h)===h?d.finishingPositionRange.winner:d.finishingPositionRange.loser}),c=d=>Math.abs(d[0]-d[1]),u=l.reduce((d,p)=>d&&c(d)<c(p)?d:p,void 0);return{[s]:{relevantMatchUps:o,finishingPositionRanges:l,finishingPositionRange:u}}}))||[];return Object.assign({},...a)}function nv({tournamentRecords:t,tournamentRecord:e,tournamentId:i,drawId:n}){if(!e&&!t)return{error:dt};if(!n)return{error:jd};if(!e&&t){if(typeof i!="string"&&(i=$Ie({tournamentRecords:t,drawId:n}),!i))return{error:nT};if(e=t[i],!e)return{error:dt}}let r=e&&zo({tournamentRecord:e,drawId:n});return r!=null&&r.drawDefinition?{drawDefinition:r.drawDefinition,event:r.event,tournamentRecord:e,...pe}:fe({result:{error:sc},stack:"findDrawDefinition"})}function a7(t){let{drawDefinition:e,error:i}=nv(t);return i?{error:i}:{drawDefinition:$t(e)}}function lG({targetRoundNumber:t,finishingPosition:e,drawDefinition:i,structureId:n,linkType:r}){let{links:a}=qU({drawDefinition:i,structureId:n})||{},s=((a==null?void 0:a.target)||[]).filter(({linkType:o})=>o===r).filter(({target:o})=>!t||t===o.roundNumber).map(o=>{let l=o.source.structureId,{structure:c}=fi({structureId:l,drawDefinition:i});if(!(e&&(c==null?void 0:c.finishingPosition)!==e))return o}).filter(Boolean);return{sourceStructureIds:s.map(({source:o})=>o.structureId),relevantLinks:s}}function Q4e({tournamentParticipants:t,returnParticipants:e,drawPosition:i,participant:n,drawId:r,event:a}){var s;let o=((s=a==null?void 0:a.entries)==null?void 0:s.filter(({entryStatus:l})=>[ou,tb].includes(l)).map(({participantId:l})=>l))||[];if(o.length){let l=n.individualParticipantIds,c=e?t.filter(({participantId:d})=>o.includes(d)):void 0,u=e?t.filter(({participantId:d})=>l.includes(d)):void 0;return{validModifyAssignedPairAction:Zt({payload:{participantId:n.participantId,replacementIndividualParticipantId:void 0,existingIndividualParticipantId:void 0,drawPosition:i,drawId:r},method:c4e,availableIndividualParticipantIds:o,availableIndividualParticipants:c,existingIndividualParticipantIds:l,existingIndividualParticipants:u,type:F8},!1,!1,!0)}}return{}}function Uy(t){var e,i,n,r,a;let{inContextDrawMatchUps:s,targetData:o,drawDefinition:l,relevantLink:c}=t;if((c==null?void 0:c.linkCondition)===xp&&((e=o==null?void 0:o.matchUp)==null?void 0:e.matchUpStatus)===gn)return!1;let{targetMatchUps:{loserMatchUp:u,winnerMatchUp:d},targetLinks:p}=o,h=u&&bo({matchUpId:u.matchUpId,inContextDrawMatchUps:s,drawDefinition:l}),f=(i=h==null?void 0:h.targetMatchUps)==null?void 0:i.loserMatchUp,m=(n=h==null?void 0:h.targetMatchUps)==null?void 0:n.loserMatchUpDrawPositionIndex,g=(r=f==null?void 0:f.sides[m])==null?void 0:r.participant,v=[Ki,un].includes(u==null?void 0:u.matchUpStatus)&&!g,y=((a=d==null?void 0:d.drawPositions)==null?void 0:a.filter(Boolean).length)||0;if(u!=null&&u.winningSide&&!v||d!=null&&d.winningSide&&y===2&&(!d.feedRound||![un,Ki].includes(d==null?void 0:d.matchUpStatus)))return!0;let b=d&&bo({matchUpId:d.matchUpId,inContextDrawMatchUps:s,drawDefinition:l}),I=h&&Uy({relevantLink:p==null?void 0:p.loserTargetLink,targetData:h,inContextDrawMatchUps:s,drawDefinition:l});return!!(b&&Uy({targetData:b,inContextDrawMatchUps:s,drawDefinition:l})||I)}var JIe={[rm]:{policyName:"positionActionsDefault",enabledStructures:[{stages:[ri,Bt],stageSequences:[1],enabledActions:[],disabledActions:[]},{stages:[],stageSequences:[],enabledActions:[JE,MI,TF,Xb],disabledActions:[]}],disbledStructures:[],otherFlightEntries:!1,activePositionOverrides:[]}},dA="positionAction",cG="matchUpAction";function QIe({actionType:t=dA,appliedPolicies:e,drawDefinition:i,structure:n}){var r,a;let s=t===dA&&rm||t===cG&&Ga,o=t===dA&&JIe||t===cG&&Nbe,l=s&&((e==null?void 0:e[s])||(o==null?void 0:o[s])),c=((a=(r=i.links)==null?void 0:r.filter(h=>{var f;return((f=h==null?void 0:h.target)==null?void 0:f.structureId)===(n==null?void 0:n.structureId)}))==null?void 0:a.map(({target:h})=>h.feedProfile))??[],{enabledStructures:u,disabledStructures:d}=l||{},p=d==null?void 0:d.find(h=>{let{stages:f,stageSequences:m,structureTypes:g,feedProfiles:v}=h;return(!(v!=null&&v.length)||Array.isArray(v)&&v.some(y=>c.includes(y)))&&(!(f!=null&&f.length)||Array.isArray(f)&&(f==null?void 0:f.includes(n==null?void 0:n.stage)))&&(!(g!=null&&g.length)||Array.isArray(g)&&(g==null?void 0:g.includes(n==null?void 0:n.structureType)))&&(!(m!=null&&m.length)||Array.isArray(m)&&m.includes(n==null?void 0:n.stageSequence))});return{enabledStructures:u,actionsDisabled:p,actionsPolicy:l}}function pJ({activePositionOverrides:t,activeDrawPositions:e,action:i}){return i&&t.includes(i)?!0:!e.length}function ewe({enabledStructures:t,drawDefinition:e,structure:i}){var n,r;if(t===!1)return{};if(!(t!=null&&t.length))return{policyActions:{enabledActions:[],disabledActions:[]}};let{stage:a,stageSequence:s,structureType:o}=i||{},l=((r=(n=e.links)==null?void 0:n.filter(c=>{var u;return((u=c==null?void 0:c.target)==null?void 0:u.structureId)===(i==null?void 0:i.structureId)}))==null?void 0:r.map(({target:c})=>c.feedProfile))||[];return{policyActions:t.find(c=>{let{stages:u,stageSequences:d,structureTypes:p,feedProfiles:h}=c||{},f=!(u!=null&&u.length)||Array.isArray(u)&&u.includes(a),m=!(d!=null&&d.length)||Array.isArray(d)&&d.includes(s),g=!(p!=null&&p.length)||Array.isArray(p)&&p.includes(o),v=!(h!=null&&h.length)||Array.isArray(h)&&h.some(y=>l.includes(y));return m&&g&&v&&c&&f})}}function Jo({action:t,policyActions:e}){var i;let n=!(e!=null&&e.enabledActions)||((i=e==null?void 0:e.disabledActions)==null?void 0:i.length)&&e.disabledActions.includes(t);return n?!1:((e==null?void 0:e.enabledActions.length)===0||(e==null?void 0:e.enabledActions.includes(t)))&&!n}var twe="replaceTieMatchUpParticipantId",iwe="assignTieMatchUpParticipantId",uG="removeTieMatchUpParticipantId",hJ="assignMatchUpSideParticipant",e5e="removeMatchUpSideParticipant",nwe="substituteParticipant",dG="REMOVE_SUBSTITUTION",rwe="REPLACE_PARTICIPANT",s7="REMOVE_PARTICIPANT",pG="setMatchUpStatus",hG="SUBSTITUTION",awe="SCHEDULE",t5e="PENALTY",fG="REFEREE",swe="STATUS",mG="START",owe="SCORE",gG="END",i5e={REPLACE_TEAM_POSITION_METHOD:twe,ASSIGN_TEAM_POSITION_METHOD:iwe,REMOVE_TEAM_POSITION_METHOD:uG,REPLACE_PARTICIPANT:rwe,SUBSTITUTION_METHOD:nwe,REMOVE_SUBSTITUTION:dG,REMOVE_PARTICIPANT:s7,SCHEDULE_METHOD:pG,SUBSTITUTION:hG,SCHEDULE:awe,PENALTY:t5e,REFEREE:fG,STATUS:swe,SCORE:owe,START:mG,END:gG};function n5e({specifiedPolicyDefinitions:t,inContextDrawMatchUps:e,matchUpParticipantIds:i,matchUpActionsPolicy:n,inContextMatchUp:r,policyActions:a,enforceGender:s,participantId:o,sideNumber:l,matchUpId:c,matchUp:u,drawId:d,side:p}){var h,f,m,g,v,y,b,I,T,w,S,U,P,E,R;let C=[],M=(h=r.sides)==null?void 0:h.find(J=>J.participant),_=r.gender===Fo&&r.sideNumber&&((f=r.sides)==null?void 0:f.filter(J=>J.particiapntId).length)===1&&((g=(m=M==null?void 0:M.participant)==null?void 0:m.person)==null?void 0:g.sex),A=r.matchUpType,N=(s??((v=n==null?void 0:n.participants)==null?void 0:v.enforceGender))!==!1?r.gender:void 0,k=(b=(y=r.sides)==null?void 0:y.flatMap(J=>{var se;return((se=J.participant)==null?void 0:se.individualParticipants)||J.participant}).filter(Boolean))==null?void 0:b.map(Gi),O=(I=r.sides)==null?void 0:I.filter(J=>!l||J.sideNumber===l).flatMap(J=>{var se;return((se=J.participant)==null?void 0:se.individualParticipants)||J.participant}).filter(Boolean),$=O==null?void 0:O.map(Gi),F=(w=(T=e==null?void 0:e.find(J=>J.matchUpId===r.matchUpTieId))==null?void 0:T.sides)==null?void 0:w.map(J=>{var se,ie;return(ie=(se=J==null?void 0:J.participant)==null?void 0:se.individualParticipants)==null?void 0:ie.filter(({participantId:ce,person:oe})=>!($!=null&&$.includes(ce))&&(!N||N===Ld||oe.sex===N||N===Fo&&!_||_&&oe.sex!==_))}),V=l?F==null?void 0:F[l-1]:F==null?void 0:F.map((J,se)=>({participants:J,sideNumber:se+1})),j=l?(S=F==null?void 0:F[l-1])==null?void 0:S.map(Gi):F==null?void 0:F.map((J,se)=>({participants:J==null?void 0:J.map(Gi),sideNumber:se+1})),B=l&&(Br(Wb)(A)&&!($!=null&&$.length)||Br(py)(A)&&(($==null?void 0:$.length)??0)<2)||!l&&(Br(Wb)(A)&&(($==null?void 0:$.length)??0)<2||Br(py)(A)&&(($==null?void 0:$.length)??0)<4),z=j==null?void 0:j.filter(J=>!(k!=null&&k.includes(J))),W=V==null?void 0:V.filter(({participantId:J})=>z.includes(J));if(B&&z!=null&&z.length&&C.push({availableParticipantIds:z,method:iwe,availableParticipants:W,type:RI,payload:{participantId:void 0,tieMatchUpId:c,sideNumber:l,drawId:d}}),$!=null&&$.length&&(!ya(u)||(U=p==null?void 0:p.substitutions)!=null&&U.length)&&C.push({method:uG,type:s7,existingParticipantIds:$,payload:{participantId:void 0,tieMatchUpId:c,drawId:d}}),W!=null&&W.length&&(!l&&$!=null&&$.length||l&&p!=null&&p.participant)&&C.push({availableParticipantIds:z,method:twe,availableParticipants:W,type:rwe,existingParticipantIds:$,payload:{existingParticipantId:void 0,participantId:void 0,tieMatchUpId:c,drawId:d}}),Jo({policyActions:a,action:dG})&&((P=p==null?void 0:p.substitutions)==null?void 0:P.length)){let J=((E=p.participant)==null?void 0:E.participantType)===Hi&&[p.participantId]||((R=p.participant)==null?void 0:R.participantType)===Ai&&p.participant.individualParticipantIds||[],se=p.substitutions.map(ie=>ie.participantId).filter(ie=>J.includes(ie));(!o||se.includes(o))&&C.push({method:uG,type:dG,substitutedParticipantIds:se,payload:{participantId:void 0,tieMatchUpId:c,drawId:d}})}let Z=t==null?void 0:t[Ga],K=Z==null?void 0:Z.substituteWithoutScore,Q=Z==null?void 0:Z.substituteAfterCompleted;if(Jo({policyActions:a,action:hG})&&i.length===2&&(!l&&$!=null&&$.length||l&&p!=null&&p.participant)&&(K||ya(u))&&(Q||u.matchUpStatus&&!va.includes(u.matchUpStatus))&&O!=null&&O.length&&V.length){let J=O.map(Gi);C.push({info:"list of team players available for substitution",method:nwe,availableParticipantIds:j,existingParticipantIds:J,availableParticipants:V,existingParticipants:O,type:hG,payload:{substituteParticipantId:void 0,existingParticipantId:void 0,sideNumber:l,matchUpId:c,drawId:d}})}return C}function r5e({tournamentParticipants:t=[],possiblyDisablingAction:e,activeDrawPositions:i,positionAssignments:n,returnParticipants:r,appliedPolicies:a,drawDefinition:s,drawPosition:o,validActions:l,structureId:c,structure:u,drawId:d,event:p}){var h,f,m,g,v;if(i.includes(o))return{};let y=(h=l.find(C=>C.type===RI))==null?void 0:h.availableParticipantIds,b=(f=a==null?void 0:a[rm])==null?void 0:f.otherFlightEntries,I=(m=a==null?void 0:a[rm])==null?void 0:m.restrictQualifyingAlternates,T=(s.entries??[]).filter(({entryStage:C})=>!I||(u.stage===ri?C===ri:C!==ri)).sort((C,M)=>(C.entryPosition??1/0)-(M.entryPosition??1/0)).map(({participantId:C})=>C).filter(Boolean),{allPositionedParticipantIds:w}=$ye({drawDefinition:s}),S=n.map(C=>C.participantId).filter(Boolean),U=T.filter(C=>u.stage&&[ri,Bt,Mr].includes(u.stage)?!(w!=null&&w.includes(C)):!S.includes(C)),P=((p==null?void 0:p.entries)??[]).filter(C=>C.entryStatus===Bu&&lwe({restrictQualifyingAlternates:I,structure:u,entry:C})&&(u.stage&&[ri,Bt,Mr].includes(u.stage)?!(w!=null&&w.includes(C.participantId)):!S.includes(C.participantId))).sort((C,M)=>(C.entryPosition??1/0)-(M.entryPosition??1/0)).map(C=>C.participantId),E=Pi(U.concat(P));if(b){let C=(v=(g=p?kr({event:p}).flightProfile:void 0)==null?void 0:g.flights)==null?void 0:v.filter(M=>M.drawId!==d).map(M=>M.drawEntries.filter(_=>_.participantId&&![Wh,ou,tb].includes(_.entryStatus)&&!T.includes(_.participantId)).map(({participantId:_})=>_)).flat().filter(Boolean);C!=null&&C.length&&E.push(...C)}y!=null&&y.length&&(E=E.filter(C=>!y.includes(C)));let R=r?t==null?void 0:t.filter(C=>E.includes(C.participantId)):void 0;return R==null||R.forEach(C=>{let M=(s.entries??[]).find(_=>_.participantId===C.participantId);C.entryPosition=M==null?void 0:M.entryPosition}),R==null||R.sort((C,M)=>(C.entryPosition||1/0)-(M.entryPosition||1/0)),E.length?{validAlternatesAction:Zt({payload:{drawId:d,structureId:c,drawPosition:o},willDisableLinks:e,method:o4e,availableAlternatesParticipantIds:E,type:$8,availableAlternates:R})}:{}}function lwe({restrictQualifyingAlternates:t,structure:e,entry:i}){let{stage:n}=e;if(!i.entryStage||i.entryStage===n||n===ri&&!t||i.entryStage===Bt&&n===ws)return!0}function a5e({eventEntries:t,structure:e}){let i=r=>r.entryStatus===Bu&&lwe({structure:e,entry:r}),n=(r,a)=>(r.entryPosition||1/0)-(a.entryPosition||1/0);return t.filter(i).sort(n).map(Gi)}function s5e({restrictAdHocRoundParticipants:t,tournamentParticipants:e,matchUpParticipantIds:i,otherFlightEntries:n,drawDefinition:r,structureId:a,sideNumber:s,matchUpId:o,structure:l,matchUp:c,drawId:u,event:d}){var p,h,f,m,g,v,y;let b=[],I=(l==null?void 0:l.matchUps)??[],T=(h=(p=c.sides)==null?void 0:p.find(A=>A.sideNumber===s))==null?void 0:h.participantId,w=I.filter(({roundNumber:A})=>A===c.roundNumber),S=((f=r==null?void 0:r.entries)==null?void 0:f.filter(({entryStatus:A})=>A&&ib.includes(A)).map(Gi))??[],U=w.map(A=>(A.sides??[]).flatMap(Gi)).flat().filter(Boolean),P=S.filter(A=>!i.includes(A)&&(!t||!U.includes(A))),E=e==null?void 0:e.filter(A=>P==null?void 0:P.includes(A.participantId)).map(A=>$t(A,void 0,!0));E==null||E.forEach(A=>{let N=(r.entries??[]).find(k=>k.participantId===A.participantId);A.entryPosition=N==null?void 0:N.entryPosition}),P.length&&b.push({payload:{drawId:u,matchUpId:o,structureId:a,sideNumber:s},method:hJ,type:RI,availableParticipantIds:P,participantsAvailable:E});let R=(d==null?void 0:d.entries)??[],C=a5e({eventEntries:R,structure:l}),M=Pi(S.concat(C));if(n){let A=(g=(m=d?kr({event:d}):void 0)==null?void 0:m.flights)==null?void 0:g.filter(N=>N.drawId!==u).flatMap(N=>N.drawEntries.filter(k=>k.participantId&&![Wh,ou,tb].includes(k.entryStatus)).map(({participantId:k})=>k)).filter(Boolean);A!=null&&A.length&&M.push(...A)}M=M.filter(A=>!i.includes(A)&&!P.includes(A)&&(!t||!U.includes(A)));let _=e==null?void 0:e.filter(A=>M.includes(A.participantId)).map(A=>$t(A,void 0,!0));if(_==null||_.forEach(A=>{let N=(r.entries??[]).find(k=>k.participantId===A.participantId);A.entryPosition=N==null?void 0:N.entryPosition}),_==null||_.sort((A,N)=>(A.entryPosition||1/0)-(N.entryPosition||1/0)),M.length&&b.push({payload:{drawId:u,matchUpId:o,structureId:a,sideNumber:s},availableParticipantIds:M,participantsAvailable:_,method:hJ,type:Bu}),!ya(c)&&s&&T){b.push({payload:{drawId:u,matchUpId:o,structureId:a,sideNumber:s},method:e5e,type:s7});let A=B=>B.sides.map(Gi),N=({matchUpId:B})=>B!==c.matchUpId,k=B=>!ya(B),O=(y=(v=c.sides)==null?void 0:v.find(B=>B.sideNumber!==s))==null?void 0:y.participantId,$=I.filter(({roundNumber:B})=>B!==c.roundNumber).filter(N).map(A),F=[O,...$.filter(B=>B.includes(T)).flat()].filter(Boolean),V=B=>!F.flat().includes(B),j=w.filter(k).filter(N).map(A).flat().filter(V);if(j.length){let B=e==null?void 0:e.filter(z=>j.includes(z.participantId)).map(z=>$t(z,void 0,!0));b.push({payload:{participantIds:[T],roundNumber:c.roundNumber,structureId:a,sideNumber:s,matchUpId:o,drawId:u},swappableParticipantIds:j,method:u4e,type:UF,swappableParticipants:B})}}return b}function NF(t){var e,i,n,r,a,s,o,l,c;if(!t)return{error:Ae};let{drawDefinition:u,event:d}=t,{restrictAdHocRoundParticipants:p=!0,policyDefinitions:h,enforceGender:f,participantId:m,sideNumber:g,matchUpId:v}=t,y=t.tournamentRecord??(t.tournamentId&&ur(t.tournamentId)&&((e=t.tournamentRecords)==null?void 0:e[t.tournamentId]));if(!y)return{error:dt};if(!v||!ur(v))return{error:Zs};if(g&&![1,2].includes(g))return fe({result:{error:Ae},context:{sideNumber:g}});if(!u){let be=(Za({tournamentRecord:y}).matchUps??[]).find(we=>we.matchUpId===v);d=((y==null?void 0:y.events)??[]).find(we=>we.eventId===(be==null?void 0:be.eventId));let Se=((d==null?void 0:d.drawDefinitions)??[]).find(we=>we.drawId===(be==null?void 0:be.drawId));Se&&(u=Se)}if(!u)return{error:Ht};let b=br({withIndividualParticipants:!0,tournamentRecord:y}).participants,{drawId:I}=u,{matchUp:T,structure:w}=or({drawDefinition:u,matchUpId:v,event:d});if(!T)return{error:xs};let S=fn({tournamentRecord:y,drawDefinition:u,structure:w,event:d}).appliedPolicies??{};Object.assign(S,h??{});let U=(i=S==null?void 0:S[rm])==null?void 0:i.otherFlightEntries,P=(S==null?void 0:S[Ga])??KU[Ga],{enabledStructures:E}=QIe({actionType:cG,appliedPolicies:S,drawDefinition:u,structure:w}),{policyActions:R}=ewe({enabledStructures:E,drawDefinition:u,structure:w}),C=t.matchUpsMap??Us({drawDefinition:u}),M=t.inContextDrawMatchUps??pa({tournamentParticipants:b,inContext:!0,drawDefinition:u,matchUpsMap:C,event:d}).matchUps,_=M==null?void 0:M.find(be=>be.matchUpId===v),A=g&&((n=_==null?void 0:_.sides)==null?void 0:n.find(be=>be.sideNumber===g)),N=((r=_==null?void 0:_.sides)==null?void 0:r.map(be=>{var Se;return be.participantId||((Se=be.participant)==null?void 0:Se.participantid)}).filter(Boolean))??[],{assignedPositions:k,allPositionsAssigned:O}=Aa({structure:w}),{structureId:$}=w??{},F=[];if(!$)return{validActions:F};let V=Ho({structure:w}),j=T.collectionId;if(V&&!j){let be=s5e({restrictAdHocRoundParticipants:p,tournamentParticipants:b,matchUpParticipantIds:N,otherFlightEntries:U,drawDefinition:u,structureId:$,sideNumber:g,matchUpId:v,structure:w,matchUp:T,drawId:I,event:d});F.push(...be)}let B=Eg({drawDefinition:u,structure:w}),z=k==null?void 0:k.filter(be=>be.participantId).map(be=>be.drawPosition),W=k==null?void 0:k.filter(be=>be.bye).map(be=>be.drawPosition),Z=T.matchUpStatus===gn||!j&&((a=T.drawPositions)==null?void 0:a.reduce((be,Se)=>(W==null?void 0:W.includes(Se))||be,!1));if(Z)return{validActions:F,isByeMatchUp:Z};Jo({policyActions:R,action:fG})&&F.push({type:fG,payload:{matchUpId:v}});let K=!kR({matchUpStatus:T.matchUpStatus}),Q=(s=S==null?void 0:S.scoring)==null?void 0:s.structures,J=(w==null?void 0:w.stage)&&(Q==null?void 0:Q.stage)&&(Q==null?void 0:Q.stage[w.stage]),se=(w==null?void 0:w.stageSequence)&&(J==null?void 0:J.stageSequence)&&J.stageSequence[w.stageSequence],ie=!((o=S==null?void 0:S.scoring)!=null&&o.requireAllPositionsAssigned||J!=null&&J.requireAllPositionsAssigned||se!=null&&se.requireAllPositionsAssigned)||O,ce=T.sides&&T.sides.filter(be=>be==null?void 0:be.participantId).length===2,oe=T.matchUpStatus&&[Kr,oa].includes(T.matchUpStatus),te=bo({inContextDrawMatchUps:M,drawDefinition:u,matchUpId:v}),le=Uy({inContextDrawMatchUps:M,drawDefinition:u,targetData:te}),ne=(((l=_==null?void 0:_.drawPositions)==null?void 0:l.length)===2&&_.drawPositions.every(be=>z==null?void 0:z.includes(be))&&((c=_==null?void 0:_.sides)==null?void 0:c.length)===2&&_.sides.every(({participantId:be})=>be)||ce)&&!(oe&&le),me={method:mIe,type:MI,payload:{drawId:I,matchUpId:v,penaltyCode:void 0,penaltyType:void 0,participantIds:[],notes:void 0}};if(K&&F.push({payload:{drawId:I,matchUpId:v,schedule:{}},method:pG,type:awe}),Jo({policyActions:R,action:MI})&&(A!=null&&A.participant||!g&&N!=null&&N.length)&&F.push(me),K&&ne&&F.push({type:swe}),ie&&ne){let{matchUpId:be,matchUpFormat:Se}=T,we={drawId:I,matchUpId:be,matchUpFormat:Se,outcome:{scoreStringSide1:void 0,scoreStringSide2:void 0,sets:[]},winningSide:void 0};F.push({info:"set outcome and winningSide",method:pG,type:owe,payload:we}),Jo({policyActions:R,action:mG})&&F.push({type:mG}),Jo({policyActions:R,action:gG})&&F.push({type:gG})}if(j&&_){let be=n5e({specifiedPolicyDefinitions:h,inContextDrawMatchUps:M,matchUpParticipantIds:N,matchUpActionsPolicy:P,inContextMatchUp:_,policyActions:R,enforceGender:f,participantId:m,sideNumber:g,matchUpId:v,matchUp:T,drawId:I,side:A});F.push(...be)}return{structureIsComplete:B,validActions:F,isDoubleExit:oe,...pe}}function o5e({tournamentParticipants:t=[],sourceStructuresComplete:e,possiblyDisablingAction:i,isWinRatioFedStructure:n,activeDrawPositions:r,positionAssignments:a,drawDefinition:s,drawPosition:o,structureId:l,structure:c,drawId:u,event:d}){var p,h,f,m,g,v,y;if(r.includes(o)||n&&!e)return{};let{sourceStructureIds:b,targetStructureIds:I}=((p=s.links)==null?void 0:p.reduce((U,P)=>{var E,R;let C=(E=P.source)==null?void 0:E.structureId,M=(R=P.target)==null?void 0:R.structureId;return U.sourceStructureIds.includes(C)||U.sourceStructureIds.push(C),U.targetStructureIds.includes(M)||U.targetStructureIds.push(M),U},{sourceStructureIds:[],targetStructureIds:[]}))||{},T=[],w=((h=s.links)==null?void 0:h.filter(U=>{var P;return((P=U.target)==null?void 0:P.structureId)===c.structureId}))??[];for(let U of w){let P=(f=U==null?void 0:U.source)==null?void 0:f.structureId,{structure:E}=fi({structureId:P,drawDefinition:s}),R=(E==null?void 0:E.finishingPosition)===Uw&&((b==null?void 0:b.length)!==1||(I==null?void 0:I.length)!==1),C={};if(R){let{matchUps:A}=Sn({drawDefinition:s,structure:c,event:d}),{initialRoundNumber:N}=CI({drawPosition:o,matchUps:A}),k=(v=(g=(m=s.links)==null?void 0:m.find(O=>{var $;return(($=O.target)==null?void 0:$.structureId)===(c==null?void 0:c.structureId)&&O.target.roundNumber===N}))==null?void 0:g.source)==null?void 0:v.roundNumber;C.roundNumbers=[k]}let{completedMatchUps:M}=gF({structureId:P,inContext:!0,matchUpFilters:C,drawDefinition:s}),_=a.map(A=>A.participantId).filter(Boolean);(y=M==null?void 0:M.filter(({matchUpType:A,winningSide:N})=>N&&((d==null?void 0:d.eventType)!==aa||A===aa)).map(({winningSide:A,sides:N})=>A&&(N==null?void 0:N[1-(A-1)])).map(Gi).filter(A=>A&&!_.includes(A)))==null||y.forEach(A=>{T.includes(A)||T.push(A)})}let S=t==null?void 0:t.filter(U=>T==null?void 0:T.includes(U.participantId));return S==null||S.forEach(U=>{let P=(s.entries??[]).find(E=>E.participantId===U.participantId);U.entryPosition=P==null?void 0:P.entryPosition}),T!=null&&T.length?{validLuckyLosersAction:{type:V8,method:l4e,availableLuckyLosers:S,availableLuckyLoserParticipantIds:T,willDisableLinks:i,payload:{drawId:u,structureId:l,drawPosition:o}}}:{}}function l5e({positionSourceStructureIds:t,unassignedParticipantIds:e,possiblyDisablingAction:i,provisionalPositioning:n,tournamentParticipants:r,isWinRatioFedStructure:a,positionAssignments:s,returnParticipants:o,appliedPolicies:l,drawDefinition:c,seedingProfile:u,isByePosition:d,drawPosition:p,structureId:h,event:f}){var m,g,v;let{drawId:y}=c,b=[],I,T,w=[],S=(g=(m=l==null?void 0:l[Tu])==null?void 0:m.validSeedPositions)==null?void 0:g.ignore;if(S||({unplacedSeedParticipantIds:I,unplacedSeedAssignments:T,unfilledPositions:w}=Hbe({provisionalPositioning:n,returnAllProxies:!0,randomize:!0,drawDefinition:c,seedingProfile:u,structureId:h,event:f})),w!=null&&w.length||(w=s.filter(U=>!U.participantId&&!U.bye&&!U.qualifier).map(U=>U.drawPosition)),d||b.push({payload:{drawId:y,structureId:h,drawPosition:p,isPositionAction:!0},willDisableLinks:i,method:h4e,type:Q_}),a&&S){let U=s.map(M=>M.participantId).filter(Boolean),P={structureIds:t},{completedMatchUps:E}=WU({inContext:!0,matchUpFilters:P,drawDefinition:c}),R=Pi((v=(E??[]).filter(({matchUpType:M})=>(f==null?void 0:f.eventType)!==aa||M===aa))==null?void 0:v.map(({sides:M})=>M==null?void 0:M.map(Gi)).flat().filter(M=>M&&!U.includes(M))),C=o?r==null?void 0:r.filter(M=>R==null?void 0:R.includes(M.participantId)).map(M=>$t(M,void 0,!0)):void 0;return C==null||C.forEach(M=>{let _=(c.entries??[]).find(A=>A.participantId===M.participantId);M.entryPosition=_==null?void 0:_.entryPosition}),C!=null&&C.length&&b.push(Zt({payload:{drawId:y,structureId:h,drawPosition:p},willDisableLinks:i,method:rJ,type:RI,availableParticipantIds:R,participantsAvailable:C})),{validAssignmentActions:b}}if(w.includes(p)||d){let U;if(T!=null&&T.length){let E=T.filter(R=>I==null?void 0:I.includes(R.participantId));E.sort(c5e),U=E.map(R=>R.participantId)}else U=e;let P=o?r==null?void 0:r.filter(E=>U.includes(E.participantId)).map(E=>$t(E,void 0,!0)):void 0;P!=null&&P.length&&b.push(Zt({payload:{drawId:y,structureId:h,drawPosition:p},willDisableLinks:i,method:rJ,type:RI,availableParticipantIds:U,participantsAvailable:P}))}return{validAssignmentActions:b}}function c5e(t,e){return t.bye||IT(t.seedValue)<IT(e.seedValue)||t.seedValue&&!e.seedValue?-1:(t.seedNumber||0)-(e.seedNumber||0)}function u5e({drawPositionInitialRounds:t,tournamentParticipants:e,positionAssignments:i,returnParticipants:n,appliedPolicies:r,drawDefinition:a,drawPosition:s,structureId:o,drawId:l}){var c,u,d;let p=[],h=[],f=[],m=[],g=i.map(U=>U.participantId).filter(Boolean),v=r==null?void 0:r[rm],y=!(v!=null&&v.disableRoundRestrictions)&&t[s],b=v==null?void 0:v.requireCompletedStructures,{sourceStructureIds:I,relevantLinks:T}=lG({targetRoundNumber:y,linkType:nm,drawDefinition:a,structureId:o})||{};I!=null&&I.length&&m.push(...I);let{sourceStructureIds:w,relevantLinks:S}=lG({targetRoundNumber:y,linkType:im,drawDefinition:a,structureId:o})||{};w!=null&&w.length&&m.push(...w);for(let U of T){let P=(c=a.structures)==null?void 0:c.find(R=>R.structureId===U.source.structureId);if((P==null?void 0:P.stage)!==ri)continue;let E=Eg({structureId:U.source.structureId,drawDefinition:a});if(!b||E){let R=P.qualifyingRoundNumber,{matchUps:C}=Sn({matchUpFilters:{roundNumbers:[R],hasWinningSide:!0},afterRecoveryTimes:!1,tournamentParticipants:e,inContext:!0,structure:P});for(let M of C){let _=M.sides.find(N=>(N==null?void 0:N.sideNumber)===M.winningSide),A=M.matchUpStatus===gn&&((u=M.sides)==null?void 0:u.find(({participantId:N})=>N));if(_||A){let{participantId:N,participant:k}=_||A||{};N&&!g.includes(N)&&(k&&n&&p.push(k),h.push(N))}}}}for(let U of S){let P=(d=a.structures)==null?void 0:d.find(R=>R.structureId===U.source.structureId);if((P==null?void 0:P.stage)!==ri)continue;let E=Eg({structureId:U.source.structureId,drawDefinition:a});if(!b||E){let{positionAssignments:R}=Gn({structure:P}),C=(R==null?void 0:R.map(M=>{var _;let A=M.participantId,N=(_=xi({element:M,name:wg}).extension)==null?void 0:_.value;return N?{participantId:A,groupOrder:N==null?void 0:N.groupOrder}:{}}).filter(({groupOrder:M,participantId:_})=>M===1&&!g.includes(_)).map(({participantId:M})=>M))??[];if(C&&h.push(...C),n){let M=e.filter(({participantId:_})=>C.includes(_));p.push(...M)}}}return h.length&&f.push(Zt({qualifyingParticipants:n?p:void 0,method:a4e,type:TF,qualifyingParticipantIds:h,payload:{qualifyingParticipantId:void 0,drawPosition:s,structureId:o,drawId:l}})),{validAssignmentActions:f,sourceStructureIds:m}}function d5e({onlyAssignedPositions:t=!0,possiblyDisablingAction:e,tournamentParticipants:i,inactiveDrawPositions:n,activeDrawPositions:r,positionAssignments:a,returnParticipants:s,byeDrawPositions:o,drawDefinition:l,isByePosition:c,drawPosition:u,structureId:d,structure:p,drawId:h,event:f}){if(r.includes(u))return{};let m=E=>!t||E.participantId||E.qualifier||E.bye,g=n==null?void 0:n.filter(E=>E!==u&&!(c&&o.includes(E))),v=(a==null?void 0:a.filter(E=>m(E)&&(g==null?void 0:g.includes(E.drawPosition))))??[],y=v.map(({drawPosition:E})=>E),{matchUps:b}=Sn({afterRecoveryTimes:!1,inContext:!0,drawDefinition:l,structure:p,event:f}),I=b.filter(({drawPositions:E})=>vo(E,y)),T=Object.assign({},...I.map(E=>{var R;return(R=E.sides)==null?void 0:R.filter(({sourceDrawPositionRange:C})=>C).map(({drawPosition:C,sourceDrawPositionRange:M})=>({[C]:M}))}).flat()),w=v.map(E=>E.participantId).filter(Boolean),S=(i??[]).filter(E=>w.includes(E.participantId)),U=Object.assign({},...S.map(E=>({[E.participantId]:E}))),P=v.map(E=>{let R=U==null?void 0:U[E.participantId],C=T[E.drawPosition];return Zt({...E,participant:s?$t(R,!1,!0):void 0,sourceDrawPositionRange:C})});return P.length?{validSwapAction:{payload:{drawId:h,structureId:d,drawPositions:[u]},willDisableLinks:e,method:fIe,type:UF,availableAssignments:P}}:{}}function o7(t){var e;let i=ei(t,[{event:!0,drawDefinition:!0,structureId:!0}]);if(i.error)return i;let{policyDefinitions:n,returnParticipants:r=!0,provisionalPositioning:a,tournamentRecord:s,drawDefinition:o,drawPosition:l,event:c}=t,u=t.tournamentParticipants??(s&&br({withIndividualParticipants:!0,tournamentRecord:s}).participants)??[],d=fi({structureId:t.structureId,drawDefinition:o});if(d.error)return d;let p=d.containingStructure||d.structure;if(!p)return{error:yr};let h=p.structureId;if(d=xR({drawDefinition:o,structureId:h}),l===void 0&&!d.isAdHoc)return{error:AU};if(d.isAdHoc)return NF(t);if(d.error)return d;let{drawPositionInitialRounds:f,inactiveDrawPositions:m,activeDrawPositions:g,byeDrawPositions:v}=d,y=fn({tournamentRecord:s,drawDefinition:o,structure:p,event:c}).appliedPolicies??{};Object.assign(y,n??{});let{actionsPolicy:b,enabledStructures:I,actionsDisabled:T}=QIe({actionType:dA,appliedPolicies:y,drawDefinition:o,structure:p}),w=(b==null?void 0:b.activePositionOverrides)||[],{sourceStructureIds:S}=lG({finishingPosition:gy,targetRoundNumber:1,linkType:im,drawDefinition:o,structureId:h})||{},U;S!=null&&S.length&&(U=S.every(J=>Eg({structureId:J,drawDefinition:o})));let P=S.length,E=S.length&&!U,{policyActions:R}=ewe({enabledStructures:I,drawDefinition:o,structure:p}),C=![ri,Bt].includes(p.stage)||p.stageSequence!==1,{drawId:M}=o,_=[],{assignedPositions:A,positionAssignments:N}=Aa({structure:p}),k=A==null?void 0:A.find(J=>J.drawPosition===l),O=!!k;if(!((e=N==null?void 0:N.map(J=>J.drawPosition))!=null&&e.includes(l)))return{error:NU};let{stage:$,stageSequence:F}=p,V=[$];$===ws&&V.push(Bt),$===Bt&&V.push(ws);let j=Pw({entryStatuses:ib,provisionalPositioning:a,drawDefinition:o,stageSequence:F,structureId:h,stages:V}),B=rb({drawDefinition:o,stages:V}).assignedParticipantIds??[],z=j.filter(J=>!B.includes(J.participantId)).map(J=>J.participantId),W=v.includes(l),Z=g.includes(l);if(T)return{info:"Actions Disabled for structure",isActiveDrawPosition:Z,isDrawPosition:!0,hasPositionAssigned:O,validActions:[],isByePosition:W};if(Jo({policyActions:R,action:RI})&&!Z&&N&&!E&&(!k||W)){let{validAssignmentActions:J}=l5e({positionSourceStructureIds:S,unassignedParticipantIds:z,possiblyDisablingAction:C,isWinRatioFedStructure:P,tournamentParticipants:u,positionAssignments:N,returnParticipants:r,appliedPolicies:y,drawDefinition:o,isByePosition:W,drawPosition:l,structureId:h,event:c});J==null||J.forEach(se=>_.push(se))}if(Jo({policyActions:R,action:TF})&&!Z){let{validAssignmentActions:J}=u5e({drawPositionInitialRounds:f,tournamentParticipants:u,positionAssignments:N,returnParticipants:r,appliedPolicies:y,drawDefinition:o,drawPosition:l,structureId:h,drawId:M});J==null||J.forEach(se=>_.push(se))}let{participantId:K}=k||{},Q=K&&u.find(J=>J.participantId===K);if(k){Jo({policyActions:R,action:oG})&&!Z&&(_.push({type:oG,method:nJ,payload:{drawId:M,structureId:h,drawPosition:l},willDisableLinks:C}),W||_.push({type:B8,method:s4e,payload:{drawId:M,structureId:h,drawPosition:l},willDisableLinks:C}),Jo({policyActions:R,action:Q_})&&!W&&_.push({type:Q_,method:nJ,payload:{drawId:M,structureId:h,drawPosition:l,replaceWithBye:!0},willDisableLinks:C}));let J=p.stage===ri||p.stage===Bt&&p.stageSequence===1;if(!W&&pJ({activePositionOverrides:w,activeDrawPositions:g,action:Xb})&&Jo({policyActions:R,action:Xb})&&Z_({drawDefinition:o,structureId:h,drawPosition:l})&&J){let{seedAssignments:se}=Zc({returnAllProxies:!0,drawDefinition:o,structure:p}),{seedNumber:ie,seedValue:ce}=(se==null?void 0:se.find(oe=>oe.participantId===K))??{};_.push({type:Xb,method:f4e,participant:Q,seedNumber:ie,payload:{drawId:M,structureId:h,participantId:K,seedValue:ce}})}if(!W&&pJ({activePositionOverrides:w,activeDrawPositions:g,action:DD})&&Jo({policyActions:R,action:DD})&&Z_({drawDefinition:o,structureId:h,drawPosition:l})&&J){let{seedAssignments:se}=Zc({returnAllProxies:!0,drawDefinition:o,structure:p}),{seedNumber:ie}=(se==null?void 0:se.find(ce=>ce.participantId===K))??{};_.push({method:p4e,type:DD,participant:Q,seedNumber:ie,payload:{participantId:K,structureId:h,drawId:M}})}if(!W&&K){if(Jo({policyActions:R,action:MI})){let se={type:MI,method:mIe,participant:Q,payload:{penaltyCode:void 0,penaltyType:void 0,participantIds:[],notes:void 0,drawId:M}};_.push(se)}if(Jo({policyActions:R,action:JE})){let se={type:JE,method:d4e,participant:Q,payload:{participantId:K,otherName:void 0}};_.push(se)}}if(Jo({policyActions:R,action:UF})){let{validSwapAction:se}=d5e({possiblyDisablingAction:C,tournamentParticipants:u,inactiveDrawPositions:m,activeDrawPositions:g,positionAssignments:N,returnParticipants:r,byeDrawPositions:v,drawDefinition:o,isByePosition:W,drawPosition:l,structureId:h,structure:p,drawId:M});se&&_.push(se)}}if(Jo({policyActions:R,action:$8})&&!E){let{validAlternatesAction:J}=r5e({possiblyDisablingAction:C,tournamentParticipants:u,positionAssignments:N,activeDrawPositions:g,returnParticipants:r,appliedPolicies:y,drawDefinition:o,drawPosition:l,validActions:_,structureId:h,structure:p,drawId:M,event:c});J&&_.push(J)}if(Jo({policyActions:R,action:V8})&&!E&&!Z&&N){let{validLuckyLosersAction:J}=o5e({sourceStructuresComplete:U,possiblyDisablingAction:C,isWinRatioFedStructure:P,tournamentParticipants:u,activeDrawPositions:g,positionAssignments:N,drawDefinition:o,drawPosition:l,structureId:h,structure:p,drawId:M});J&&_.push(J)}if((Q==null?void 0:Q.participantType)===Ai&&Jo({policyActions:R,action:F8})){let{validModifyAssignedPairAction:J}=Q4e({tournamentParticipants:u,returnParticipants:r,drawPosition:l,participant:Q,drawId:M,event:c});J&&_.push(J)}return{isActiveDrawPosition:Z,isDrawPosition:!0,hasPositionAssigned:O,isByePosition:W,validActions:_,...pe}}function QR({policyDefinitions:t,appliedPolicies:e,drawType:i}){var n,r;let a=(n=t==null?void 0:t[V_])==null?void 0:n.drawTypeCoercion,s=(r=e==null?void 0:e[V_])==null?void 0:r.drawTypeCoercion;return(typeof a=="boolean"?a:void 0)??(i&&(a==null?void 0:a[i]))??(typeof s=="boolean"?s:void 0)??(i&&(s==null?void 0:s[i]))??!0}function QE({tournamentRecord:t,drawDefinition:e,stage:i=Bt,structureId:n,structure:r}){var a;if(!t)return{error:dt};if(!r&&!e)return{error:Ht};if(!r&&!n&&((a=e==null?void 0:e.structures)==null?void 0:a.filter(l=>l.stage===i).length)===1&&(r=e.structures.find(l=>l.stage===i)),!r&&!n)return{error:mc};let{error:s,positionAssignments:o}=Gn({drawDefinition:e,structureId:n,structure:r});return{positionAssignments:o??[],structureId:r==null?void 0:r.structureId,error:s}}function l7({structureId:t,drawDefinition:e}){if(!e)return{error:Ht};if(!ur(t))return{error:Ae};let i=qU({drawDefinition:e,structureId:t});if(i.error)return i;let n=i.links.target.flatMap(a=>a.target.feedProfile).filter(Boolean),r=!Ar([my,Ru,GL,fy],n).length;return{...pe,valid:r}}function cwe({participantsCount:t,participantCount:e}){if(t=t??e,!t)return{error:Ae};let i=MU(t);return i?{drawSize:i}:fe({result:{error:Ae},stack:"getEliminationDrawSize",context:{participantsCount:t}})}function eM(t){let{drawSizeProgression:e=!1,policyDefinitions:i,drawSize:n}=t||{},{requireParticipantCount:r=!0,tournamentRecord:a,drawDefinition:s,event:o}=t||{},l="getSeedsCount",c=(t==null?void 0:t.participantsCount)??(t==null?void 0:t.participantCount);if(!i){let f=Rm({tournamentRecord:a,drawDefinition:s,event:o});if(f.error)return fe({result:f,stack:l});i=f.policyDefinitions}let u=wi(c);if(c&&!u)return fe({result:{error:Ae},context:{participantsCount:c},stack:l});if(r&&!u)return fe({result:{error:Mge},stack:l});if(isNaN(n))if(c)({drawSize:n}=cwe({participantsCount:c}));else return fe({result:{error:rR},stack:l});let d=r&&c||n;if(d&&d>n)return{error:K5};let p=i==null?void 0:i[Tu];if(!p)return{error:yge};let h=p.seedsCountThresholds;return h?(p.drawSizeProgression!==void 0&&(e=p.drawSizeProgression),{seedsCount:h.filter(f=>e?f.drawSize<=n:n===f.drawSize).reduce((f,m)=>c&&c>=m.minimumParticipantCount?m.seedsCount:f,0)}):{error:ige}}function AF({consideredEntries:t,policyDefinitions:e,tournamentRecord:i,appliedPolicies:n,participantMap:r,enforceGender:a,participants:s,event:o}){var l;if((!s||!r)&&i&&({participants:s,participantMap:r}=br({tournamentRecord:i})),!s)return{error:sR};if(!Array.isArray(s))return{error:Ae};if(!o)return{error:Qn};let c=(e==null?void 0:e[Ga])??(n==null?void 0:n[Ga])??KU[Ga],u=(a??((l=c==null?void 0:c.participants)==null?void 0:l.enforceGender))!==!1,{eventType:d,gender:p}=o,h=d===tm,f=d===Fl&&Pn||h&&Ai||Hi,m=Object.assign({},...(t??o.entries??[]).map(y=>({[y.participantId]:y.entryStatus}))),g=Object.keys(m),v=s.filter(y=>g.includes(y.participantId)).filter(y=>{let b=p5e({participant:y,participantType:f,eventType:d,entryStatusMap:m}),I=h5e({genderEnforced:u,participantMap:r,eventGender:p,participant:y,isDoubles:h,mismatch:b});return b||!I});if(v.length){let y=v.map(b=>b.participantId);return{error:dge,invalidParticipantIds:y}}return{...pe,valid:!0}}function p5e({participant:t,participantType:e,eventType:i,entryStatusMap:n}){let r=n[t.participantId],a=i&&[tm,Fl].includes(i)&&t.participantType===Hi&&(Pv(r)||r===Wh);return t.participantType!==e&&!a}function h5e(t){var e,i,n;let{participant:r,participantMap:a,eventGender:s,mismatch:o,isDoubles:l,genderEnforced:c}=t,u=!o&&l&&Pi(((e=r==null?void 0:r.individualParticipantIds)==null?void 0:e.map(f=>{var m,g,v;return(v=(g=(m=a==null?void 0:a[f])==null?void 0:m.participant)==null?void 0:g.person)==null?void 0:v.sex}).filter(Boolean))??[])||[],d=!s||!(u!=null&&u.length)||Ld===s||[Rn,Kn].includes(s)&&u[0]===s||Fo===s&&(u.length===1&&((i=r.individualParticipantIds)==null?void 0:i.length)===1||u.length===2),p=(n=r==null?void 0:r.person)==null?void 0:n.sex,h=!(r!=null&&r.person)||!s||[Ld,Fo].includes(s)||[Rn,Kn].includes(s)&&p===s;return!c||d&&h}function uwe({qualifyingProfiles:t,appliedPolicies:e,idPrefix:i,isMock:n,uuids:r}){var a;let s="generateQualifyingSTructures",o=[],l=[],c=[],u=(g,v)=>g.stageSequence-v.stageSequence,d=(g,v)=>g.roundTarget-v.roundTarget,p=0,h=0,f,m=1;for(let g of t.sort(d)){let v=g.structureProfiles||[];m=g.roundTarget||m;let y=1,b=0,I,T,w;for(let S of(v||[]).sort(u)){let U=A5(S.drawSize||S.participantsCount),{qualifyingRoundNumber:P,structureOptions:E,matchUpFormat:R,structureName:C,structureId:M,drawType:_}=S,A=S.matchUpType,N=S.qualifyingPositions||f5e({drawSize:U,qualifyingRoundNumber:P}),k,O,$;if(!wi(U))return fe({result:{error:rR},stack:s});let F=t.length>1?`${m}-`:"",V=v.length>1||F?y:"",j=C||(F||V?`${ys(ri)} ${F}${V}`:ys(ri));if(_===Zu){let{structures:B,groupCount:z,maxRoundNumber:W}=BR({structureName:S.structureName||j,structureId:M||(r==null?void 0:r.pop()),stage:ri,structureOptions:E,appliedPolicies:e,stageSequence:y,matchUpType:A,roundTarget:m,drawSize:U,idPrefix:i,isMock:n,uuids:r});b=z,k=W,O=B[0],f=[1]}else({drawSize:U,matchUps:$,roundLimit:k}=Fp({qualifyingRoundNumber:P,qualifyingPositions:N,matchUpType:A,drawSize:U,idPrefix:i,isMock:n,uuids:r})),O=$c({structureName:S.structureName||j,structureId:M||(r==null?void 0:r.pop()),qualifyingRoundNumber:k,stage:ri,matchUpFormat:R,stageSequence:y,matchUpType:A,roundLimit:k,matchUps:$}),m&&pn({extension:{name:Yp,value:m},element:O}),b=((a=$==null?void 0:$.filter(B=>B.roundNumber===k))==null?void 0:a.length)||0;if(y>1){let{link:B}=HR({sourceStructureId:T,sourceRoundNumber:I,targetStructureId:O.structureId,finishingPositions:w===im?[1]:void 0,linkType:w});c.push(B),p+=(U||0)-b}else p+=U||0;w=_===Zu?im:nm,T=O.structureId,I=k,l.push(O),y+=1}h+=b,o.push({qualifiersCount:b,finalQualifyingRoundNumber:I,finalQualifyingStructureId:T,finishingPositions:f,roundTarget:m,linkType:w}),m+=1}return{qualifiersCount:h,qualifyingDrawPositionsCount:p,qualifyingDetails:o,structures:l,...pe,links:c}}function f5e({drawSize:t,qualifyingRoundNumber:e}){let i=t,n=0;for(;n<e;)i=Math.floor(i/2),n+=1;return i}function dwe(t){let{drawTypeCoercion:e,enforceMinimumDrawSize:i}=t,n=di(t.drawSize),r=e&&t.drawType!==lc&&(typeof e=="boolean"||e<=2)&&n===2&&bp||t.drawType||bp,a=uye.includes(r);if(n&&a){if(e&&(typeof e=="boolean"&&n<4||n<=e))r=bp;else if(n<4&&i)return{...fe({context:{enforceMinimumDrawSize:i,drawSize:n,drawType:r},result:{error:SL},stack:"getCoercedDrawType"}),drawType:r}}return{drawType:r}}function m5e(t){let{drawDefinition:e,structureOptions:i,requireSequential:n}=t,r={structureName:ys(Bt),...t,stage:Bt},{structures:a,groupCount:s,groupSize:o}=BR(r);if(s<1)return{error:Yge};let l=(i==null?void 0:i.playoffGroups)||[{finishingPositions:[1],structureName:ys(Mr)}],[c]=a,{structures:u,links:d}=EIe({sourceStructureId:c.structureId,requireSequential:n,drawDefinition:e,playoffGroups:l,groupCount:s,groupSize:o,...t});return u&&a.push(...u),{...pe,structures:a,links:d}}function g5e({mainStructure:t,consolationStructure:e,deciderStructure:i}){let n=e.matchUps.reduce((c,u)=>(u.drawPositions||[]).filter(Boolean).length&&!c.includes(u.roundNumber)?c.concat(u.roundNumber):c,[]),r=t.matchUps.reduce((c,u)=>!c||u.roundNumber>c?u.roundNumber:c,void 0),a=e.matchUps.reduce((c,u)=>!c||u.roundNumber>c?u.roundNumber:c,void 0),s=n.map((c,u)=>{let d=n.indexOf(c)%2?Ru:my,p=1+u;return{linkType:Hh,source:{roundNumber:p,structureId:t.structureId},target:{feedProfile:d,roundNumber:c,structureId:e.structureId}}}),o={linkType:nm,source:{roundNumber:a,structureId:e.structureId},target:{feedProfile:Ru,roundNumber:r,structureId:t.structureId}},l=[{linkType:nm,source:{roundNumber:r,structureId:t.structureId},target:{feedProfile:Ru,roundNumber:1,structureId:i.structureId}},{linkType:Hh,source:{roundNumber:r,structureId:t.structureId},target:{feedProfile:Ru,roundNumber:1,structureId:i.structureId}}];return[...s,o,...l]}function v5e({structureName:t,matchUpType:e,idPrefix:i,drawSize:n,isMock:r,uuids:a}){let s=[],{matchUps:o}=Pg({linkFedFinishingRoundNumbers:[1],drawSize:n+1,matchUpType:e,idPrefix:i,isMock:r}),l=sg({structureName:t||ys(Bt),structureId:a==null?void 0:a.pop(),stageSequence:1,stage:Bt,matchUpType:e,matchUps:o});s.push(l);let c=n/2,{matchUps:u}=Pg({finishingPositionOffset:c,idPrefix:i&&`${i}-c`,drawSize:n-1,isConsolation:!0,matchUpType:e,isMock:r,uuids:a}),d=sg({structureName:ys(cye),matchUps:u,structureId:a==null?void 0:a.pop(),stage:ws,stageSequence:2,matchUpType:e});s.push(d);let{matchUps:p}=Fp({idPrefix:i&&`${i}-p1t2`,drawSize:2,matchUpType:e,isMock:r}),h=sg({structureName:ys(lye),matchUps:p,structureId:a==null?void 0:a.pop(),stageSequence:3,stage:Mr,matchUpType:e});s.push(h);let f=g5e({mainStructure:l,consolationStructure:d,deciderStructure:h});return{structures:s,links:f,...pe}}function y5e(t){let{qualifyingRoundNumber:e,finishingPositionOffset:i,qualifyingPositions:n,matchUpType:r,idPrefix:a,drawSize:s,isMock:o,uuids:l}=t;if(!wi(s)||s<2)return{matchUps:[],roundsCount:0};if(kd(s))return Fp(t);let c=b5e(s),u=c.shift(),d=Mt(1,((u==null?void 0:u.participantsCount)||0)+1).map(g=>({drawPosition:g})),p=[],h=1;({matchUps:p}=ek({roundNumber:h,matchUpType:r,idPrefix:a,matchUps:p,isMock:o,nodes:d,uuids:l})),h++;let f=t.roundLimit||e;for(let g of c){let v=g.participantsCount/2,y=Mt(1,v+1);n&&v===n&&(f=h-1);let b=y.map(I=>{let T=j8({roundPosition:I,roundNumber:h,idPrefix:a,uuids:l});return{roundPosition:I,roundNumber:h,matchUpId:T}});p.push(...b),h++}let m=h-1;return p=_R({finishingPositionOffset:i,lucky:!0,roundsCount:m,roundLimit:f,matchUps:p}),f&&(p=p.filter(g=>g.roundNumber<=f)),{matchUps:p,roundsCount:m,roundLimit:f}}function b5e(t){let e=di(t),i=e%2?e+1:e,n=!!(Math.ceil(i/2)%2),r=[{participantsCount:i,preFeedRound:n}];for(;i>2;){let a=Math.ceil(i/2),s=a===1,o=!!(!s&&a%2);i=!s&&o?a+1:a;let l=!!(i!==2&&Math.ceil(i/2)%2);r.push({participantsCount:i,preFeedRound:l,feedRound:o})}return r}function pwe(t){var e,i;let{playoffAttributes:n,stageSequence:r=1,stage:a=Bt,matchUpType:s,drawSize:o,uuids:l}=t,c=()=>!t.isMock&&!t.idPrefix?void 0:`${t.drawDefinition.drawId}-s-0`,u=t.structureId||c()||(l==null?void 0:l.pop()),d=t.appliedPolicies??fn(t),p=((e=t.policyDefinitions)==null?void 0:e[gT])||(d==null?void 0:d[gT]);t.skipRounds=t.skipRounds||o<=4&&(p!=null&&p.feedFromMainFinal?0:1)||0;let h=t.structureName??((i=n==null?void 0:n[0])==null?void 0:i.name)??ys(Bt),f=()=>{let{matchUps:m}=Fp(t);return{structures:[$c({stageSequence:r,structureName:h,matchUpType:s,structureId:u,matchUps:m,stage:a})],links:[],...pe}};return{generators:{[lc]:()=>({structures:[$c({finishingPosition:gy,stageSequence:r,structureName:h,matchUps:[],matchUpType:s,structureId:u,stage:a})],links:[],...pe}),[Zy]:()=>{let{matchUps:m}=y5e(t);return{structures:[$c({stageSequence:r,structureName:h,matchUpType:s,structureId:u,matchUps:m,stage:a})],links:[],...pe}},[bp]:()=>f(),[pR]:()=>v5e(t),[dT]:()=>gS({...t,roundOffsetLimit:3,playoffAttributes:n??w6}),[pT]:()=>gS({...t,roundOffsetLimit:2,playoffAttributes:n??S6}),[Mr]:()=>gS(t),[$U]:()=>{let{matchUps:m}=Pg({drawSize:o,uuids:l,matchUpType:s});return{structures:[$c({stageSequence:r,structureName:h,matchUpType:s,structureId:u,stage:Bt,matchUps:m})],links:[],...pe}},[hR]:()=>TIe(t),[hT]:()=>Sb({...t,feedRounds:1,fmlc:!0}),[oye]:()=>Sb({...t,feedRounds:1}),[y6]:()=>Sb({...t,feedsFromFinal:1}),[b6]:()=>Sb({...t,feedsFromFinal:2}),[I6]:()=>Sb({...t,feedsFromFinal:3}),[fR]:()=>Sb(t),[HL]:()=>DIe(t),[Zu]:()=>BR(t),[zh]:()=>m5e(t)}}}function c7(t){var e,i,n,r,a;let{enforceMinimumDrawSize:s=!0,overwriteExisting:o,appliedPolicies:l,staggeredEntry:c,drawDefinition:u,tieFormat:d,isMock:p,uuids:h}=t||{},f=di(t.drawSize),m=t.drawTypeCoercion??QR({appliedPolicies:l,drawType:t.drawType}),g="generateDrawStructuresAndLinks",v=dwe({drawType:t.drawType,enforceMinimumDrawSize:s,drawTypeCoercion:m,drawSize:f});if(v.error)return v;let y=v.drawType,b=[],I=[],T=(t==null?void 0:t.matchUpType)??On,w=(e=u==null?void 0:u.structures)==null?void 0:e.filter(({stage:K})=>K===ri);w&&b.push(...w);let S=w==null?void 0:w.map(({structureId:K})=>K),U=(i=u==null?void 0:u.structures)==null?void 0:i.find(({stage:K,stageSequence:Q})=>K===Bt&&Q===1),P=(n=u==null?void 0:u.links)==null?void 0:n.filter(K=>K.target.structureId===(U==null?void 0:U.structureId)&&(S==null?void 0:S.includes(K.source.structureId))),E=(K,Q)=>{var J;if(K.linkType===im&&Q!=null&&Q.structures){let se=K.source.finishingPositions||[];return Q.structures.length*se.length}else if(K.linkType===nm&&(J=Q==null?void 0:Q.matchUps)!=null&&J.length){let se=K.source.roundNumber;return Q.matchUps.filter(({roundNumber:ie})=>ie===se).length}},R=w==null?void 0:w.map(K=>{var Q,J,se;let ie=P==null?void 0:P.find(ne=>ne.target.structureId===K.structureId),ce=((J=(Q=Gn({structure:K}))==null?void 0:Q.positionAssignments)==null?void 0:J.length)??0;if(!ie)return ce;let oe=ie==null?void 0:ie.source.structureId,te=(se=u.structures)==null?void 0:se.find(ne=>ne.structureId===oe),le=E(ie,te)||0;return ce-le}).filter(Boolean).reduce((K,Q)=>K+Q,0),C=P==null?void 0:P.map(K=>{let Q=K.source.structureId,J=w==null?void 0:w.find(se=>se.structureId===Q);return E(K,J)}).filter(Boolean).reduce((K,Q)=>K+Q,0),M=!!(U&&!((r=U==null?void 0:U.matchUps)!=null&&r.length));if(w!=null&&w.length&&!M)return{error:Vj};let _=!(w!=null&&w.length)&&t.qualifyingProfiles,A=(_==null?void 0:_.length)&&uwe({idPrefix:t.idPrefix,qualifyingProfiles:_,appliedPolicies:l,isMock:p,uuids:h});if(A!=null&&A.error)return A;let{qualifyingDrawPositionsCount:N,qualifyingDetails:k,qualifiersCount:O}=A||{qualifyingDrawPositionsCount:R,qualifiersCount:C};N&&(A!=null&&A.structures&&b.push(...A.structures),A!=null&&A.links&&I.push(...A.links)),Object.assign(t,Zt({drawSize:f,matchUpType:T,tieFormat:d}));let $=y!==lc&&(!f||f<2||!c&&![$U,Zy].includes(y)&&([zh,Zu].includes(y)&&f<3||![Zu,zh].includes(y)&&!kd(f)));if($&&!N)return fe({context:{drawSize:f,invalidDrawSize:$},result:{error:SL},stack:g});let{generators:F,error:V}=pwe(t);if(V)return{error:V};let j=F[y];if(!j)return{error:O5};let B=j==null?void 0:j();if(B.error)return B;let{structures:z,links:W}=B;if(z!=null&&z.length){let K=z.find(({stage:Q,stageSequence:J})=>Q===Bt&&J===1);if(U&&K){if(M){let Q=K.structureId;if(K.structureId=U.structureId,W==null?void 0:W.length)for(let J of W)J.source.structureId===Q&&(J.source.structureId=U.structureId),J.target.structureId===Q&&(J.target.structureId=U.structureId)}else if(!o)return{error:Vj}}b.push(...z)}b.sort(Ew),W!=null&&W.length&&I.push(...W);let Z=B.structures.find(({stage:K,stageSequence:Q})=>K===Bt&&Q===1);for(let K of k||[]){let{finalQualifyingRoundNumber:Q,finalQualifyingStructureId:J,roundTarget:se,finishingPositions:ie,linkType:ce}=K,oe=Z&&((a=HR({targetStructureId:Z.structureId,sourceStructureId:J,sourceRoundNumber:Q,finishingPositions:ie,targetEntryRound:se,linkType:ce}))==null?void 0:a.link);if(oe!=null&&oe.error)return oe;oe&&I.push(oe)}return P&&I.push(...P),{...pe,qualifyingResult:{qualifyingDrawPositionsCount:N,qualifiersCount:O},structures:b,links:I}}function u7(t){var e,i;let{modifyOriginal:n=!0,stageSequence:r=1,isMock:a}=t||{},s="generateDrawTypeAndModifyDrawDefinition";if(!t.drawDefinition)return fe({result:{error:Ht},stack:s});let o=n?t.drawDefinition:$t(t.drawDefinition,!1,!0),{tieFormat:l,matchUpType:c}=t;if(l){let T=Go({tieFormat:l});if(T.error)return T}l=us(l??((e=Ws({drawDefinition:o}))==null?void 0:e.tieFormat)),c=c??(o.matchUpType||On),t.tieFormat=l,t.matchUpType=c;let u=K_({drawDefinition:o,stage:Bt});t.drawSize=t.drawSize??u,!u&&t.drawSize&&J_({drawSize:t.drawSize,drawDefinition:o,stageSequence:r,stage:Bt});let d=Us({drawDefinition:o}).drawMatchUps.map(Ca),p=c7(t);if(p.error)return fe({result:p,stack:s});let{structures:h,links:f,qualifyingResult:m}=p;o.structures=h,o.links=f;let g=Math.max(t.qualifiersCount??0,(m==null?void 0:m.qualifiersCount)||0);if(m!=null&&m.qualifyingDrawPositionsCount&&!K_({stage:ri,drawDefinition:o})){let T=J_({drawSize:m.qualifyingDrawPositionsCount,stage:ri,drawDefinition:o});if(T.error)return T}if(g){let T=pIe({qualifiersCount:g,drawDefinition:o,stage:Bt});if(T.error)return T}let v=t.drawSize??u;Object.assign(t,Zt({drawSize:v,matchUpType:c,tieFormat:l}));let{matchUps:y,matchUpsMap:b}=pa({drawDefinition:o});l&&(y==null||y.forEach(T=>{if(!d.includes(T.matchUpId)){let{tieMatchUps:w}=qR({tieFormat:l,matchUp:T,isMock:a});Object.assign(T,{tieMatchUps:w,matchUpType:c})}}));let{inContextDrawMatchUps:I}=wy({drawDefinition:o,matchUpsMap:b});return zn({tournamentId:(i=t.tournamentRecord)==null?void 0:i.tournamentId,drawDefinition:o}),{inContextDrawMatchUps:I,drawDefinition:o,matchUpsMap:b,...pe,structures:h,matchUps:y,links:f}}function tM(t){let{removePriorValues:e,tournamentRecord:i,participantId:n,scaleItem:r}=t,a,s;if(!fwe({scaleItem:r}))return{error:wI};if(n&&Array.isArray(i.participants)&&(s=i.participants.find(o=>o.participantId===n),s)){if(s.participantType===$o&&(r==null?void 0:r.eventType)!==Fl)return{error:wI};let o=mwe({removePriorValues:e,participant:s,scaleItem:r});if(o.error)return o;a=!o.valueChanged;let{topics:l}=ru();l.includes(Ss)&&Ti({topic:Ss,payload:{tournamentId:i.tournamentId,participants:[s]}})}return a&&{...pe,info:n6,existingValue:r==null?void 0:r.scaleValue}||s&&{...pe,newValue:r==null?void 0:r.scaleValue}||{error:Or}}function hwe(t){var e;let{scaleItemsWithParticipantIds:i=[],removePriorValues:n,tournamentRecord:r,auditData:a,context:s}=t;if(!r)return{error:dt};if(!r.participants)return{error:sR};let o=0,l={},c=[];for(let p of i){let h=p==null?void 0:p.participantId;if(Array.isArray(p==null?void 0:p.scaleItems))for(let f of p.scaleItems)if(fwe({scaleItem:f}))Array.isArray(l[h])||(l[h]=[]),l[h].push(f);else return{error:wI}}for(let p of r.participants){let{participantId:h}=p||{};if(Array.isArray(l[h]))for(let f of l[h]){if(p.participantType===$o&&(f==null?void 0:f.eventType)!==Fl)return fe({context:{participantId:h,scaleItem:f,participantType:p.participantType},info:"Invalid participantType for eventType",result:{error:wI}});mwe({participant:p,scaleItem:f,removePriorValues:n}),c.push(p),o++}}let u=o?void 0:LU,{topics:d}=ru();if(d.includes(Ss)&&o&&Ti({topic:Ss,payload:{tournamentId:r.tournamentId,participants:c}}),s){let{eventId:p,drawId:h,...f}=s,m=((e=f.scaleAttributes)==null?void 0:e.scaleType)&&[f.scaleAttributes.scaleType];if(Object.keys(f).length){let g={itemType:V6,itemValue:f};if(m&&(g.itemSubTypes=m),h||p){let{drawDefinition:v,event:y}=zo({tournamentRecord:r,eventId:p,drawId:h});h&&L8({drawDefinition:v,timeItem:g}),p&&$w({event:y,timeItem:g})}else XR({tournamentRecord:r,timeItem:g})}}return a&&d.includes(kf)&&Ti({topic:kf,payload:a}),Zt({...pe,modificationsApplied:o,info:u})}function fwe({scaleItem:t}){let e=t&&Object.keys(t),i=["scaleType","eventType","scaleName"];return i.filter(n=>e==null?void 0:e.includes(n)).length===i.length}function mwe({removePriorValues:t,participant:e,scaleItem:i}){if(!e)return{error:bw};let n=i&&Object.keys(i),r=["scaleType","eventType","scaleName"];if(r.filter(c=>n.includes(c)&&i[c]).length!==r.length)return{error:wI};let a=new Date().toISOString();e.timeItems||(e.timeItems=[]);let{scaleItem:s}=Rh({scaleAttributes:i,participant:e}),o=c=>[void 0,null,""].includes(c),l=!(o(s==null?void 0:s.scaleValue)&&o(i.scaleValue))&&JSON.stringify(s==null?void 0:s.scaleValue)!==JSON.stringify(i.scaleValue);if(l){let{scaleType:c,eventType:u,scaleName:d}=i,p=[vy,c,u,d].join("."),h=Zt({itemValue:i.scaleValue,itemDate:i.scaleDate,createdAt:a,itemType:p});i.scaleId&&(h.itemSubTypes=[i.scaleId]),t&&(e.timeItems=e.timeItems.filter(f=>f.itemType!==p)),e.timeItems.push(h)}return{...pe,valueChanged:l,newValue:i.scaleValue}}function d7(t){let{tournamentRecord:e,modifiedScaleValues:i,removePriorValues:n}=t,r=ei(t,[{[Ia]:!0},{modifiedScaleValues:!0,[Wo]:tl}]);if(r.error)return r;for(let a in i){let s=tM({scaleItem:i[a],removePriorValues:n,tournamentRecord:e,participantId:a});if(s.error)return s}return{...pe}}function ST(t){let{tournamentRecord:e,scaleAttributes:i,participantId:n}=t,r=t.tournamentRecords||e&&{[e.tournamentId]:e}||{};if(!n)return{error:da};let{participant:a,tournamentId:s}=ev({tournamentRecords:r,tournamentRecord:e,participantId:n});return a?{...Rh({participant:a,scaleAttributes:i}),tournamentId:s}:{error:Or}}var I5e=(t=0)=>250/Math.pow(t+5,.4),w5e=()=>1;function S5e(t=3,e=2){let i=t/e;return isNaN(i)?B0.kDefault():i}var B0={nSpread:400,diffThreshold:.125,kCalc:I5e,kMultiplier:S5e,kDefault:w5e};function gwe(t){let{winnerRating:e,loserRating:i}=t,{ratings:n=Ea,winnerCountables:r=1,loserCountables:a=0,ratingType:s=Eu,maxCountables:o,countables:l}=t||{},c=n==null?void 0:n[s];if(!c)return{error:si};let u=c.range||t.ratingRange;e=e||c.defaultInitialization,i=i||c.defaultInitialization;let d=u[0]>u[1],p=c.decimalsCount||0,h=d?u.slice().reverse():u,f=(N,k)=>parseFloat(k)>=Math.min(...N)&&parseFloat(k)<=Math.max(...N);(!f(u,e)||!f(u,i))&&(f(u,e)||(e=c.defaultInitialization),f(u,i)||(i=c.defaultInitialization));let m=iS({targetRange:Ea[Eu].range,sourceRange:h,value:d?u[0]-e:e}),g=iS({targetRange:Ea[Eu].range,sourceRange:h,value:d?u[0]-i:i}),v=(N,k)=>1/(1+Math.pow(10,(k-N)/B0.nSpread)),y=v(m,g),b=v(g,m),I=B0.kCalc(r),T=B0.kCalc(a),w=B0.kMultiplier(o,l),S=m+w*I*(1-y),U=g+w*T*(0-b),P=iS({sourceRange:Ea[Eu].range,value:S,targetRange:h}),E=iS({sourceRange:Ea[Eu].range,value:U,targetRange:h}),R=d?u[0]-P:P,C=parseFloat(R.toFixed(p)),M=d?u[0]-E:E,_=parseFloat(M.toFixed(p)),A=Math.max(...u)?Math.abs(e-i)/Math.max(...u):0;return(P>E&&A>B0.diffThreshold||C<0||_<0)&&(C=e,_=i),{newWinnerRating:C,newLoserRating:_}}var T5e=t=>(t==null?void 0:t.reduce((e,i)=>(i.winningSide&&(e[i.winningSide-1]+=1),e),[0,0]))||[0,0];function vwe(t){var e,i;let n=ei(t,[{[Ia]:!0},{matchUpIds:!0,[Wo]:Ms,[$u]:gw},{ratingType:!1,[ps]:I=>Ea[I]}]);if(n.error)return n;let{updateParticipantRatings:r,removePriorValues:a=!0,tournamentRecord:s,ratingType:o=Eu,refreshDynamic:l,considerGames:c,drawDefinition:u,matchUpIds:d,asDynamic:p}=t,h=Ea[o],{accessor:f}=h,m={},g=(t.matchUps||l&&po({drawDefinition:u,tournamentRecord:s,inContext:!0,matchUpFilters:{matchUpStatuses:va}}).matchUps||Za({matchUpFilters:{matchUpIds:d,matchUpStatuses:va},tournamentRecord:s,inContext:!0}).matchUps)??[],v=`${o}.${N6}`,y=p?v:o;g.sort(kw);for(let I of g){let{endDate:T,matchUpFormat:w,score:S,sides:U,winningSide:P}=I,E=I.matchUpType,R={eventType:E,scaleName:o,scaleType:rg},C={scaleName:v,eventType:E,scaleType:rg},M=Object.assign({},...(U??[]).map(j=>{let{sideNumber:B,participant:z}=j;return B&&{[B]:[z==null?void 0:z.participantId,...(z==null?void 0:z.individualParticipantIds)??[]].filter(Boolean).flat()}})),_=Object.assign({},...Object.values(M).flat().map(j=>{let B=m[j],z=!l||B?ST({scaleAttributes:C,tournamentRecord:s,participantId:j}).scaleItem:void 0,W=ST({tournamentRecord:s,scaleAttributes:R,participantId:j}).scaleItem,Z=f?{[f]:void 0}:void 0;return j&&{[j]:z??W??{scaleName:y,eventType:E,scaleDate:T,scaleType:rg,scaleValue:Z}}})),A=w?Do(w):{},N=(A==null?void 0:A.bestOf)||1,k=(A==null?void 0:A.setsTo)||1,O=c?N&k:N,$=(S==null?void 0:S.sets)&&T5e(S.sets)||P===1&&[1,0]||[0,1],F=P?M[P]:[],V=P?M[3-P]:[];for(let j of F){let B=(e=_[j])==null?void 0:e.scaleValue,z=typeof B=="object"?B[f]:B;for(let W of V){let Z=(i=_[W])==null?void 0:i.scaleValue,K=typeof Z=="object"?Z[f]:Z,Q=P?$[P]:[0,0],J=P?$[3-P]:[0,0],{newWinnerRating:se,newLoserRating:ie}=gwe({winnerCountables:Q,loserCountables:J,maxCountables:O,winnerRating:z,loserRating:K,ratingType:o}),ce=f?{...B,[f]:se}:se,oe=f?{...Z,[f]:ie}:ie;_[j].scaleValue=ce,_[W].scaleValue=oe,_[j].scaleName=y,_[W].scaleName=y}}Object.assign(m,_),r&&d7({tournamentRecord:s,modifiedScaleValues:m,removePriorValues:a})}let b=g.map(({matchUpId:I})=>I);return{...pe,modifiedScaleValues:m,outputScaleName:y,processedMatchUpIds:b}}function _F(t){var e;let{matchUpIds:i=[],drawDefinition:n,roundNumber:r,newRound:a,isMock:s,event:o}=t;if(typeof n!="object")return{error:Ht};let{participantIdPairings:l,matchUpsCount:c}=t,u=MF(t);if(u.error)return fe({result:u});let{lastRoundNumber:d,availableMatchUpsCount:p=0,roundMatchUpsCount:h=0}=u;if(!c)a?c=h:p>0&&(c=p);else if(c>h&&t.restrictMatchUpsCount!==!1)return fe({result:{error:Ae,info:"matchUpsCount error",context:{roundMatchUpsCount:h}}});if(l&&!Array.isArray(l)||c&&!wi(c)||i&&!Array.isArray(i)||!l&&!c)return{error:Ae,info:"matchUpsCount or pairings error"};if(c&&t.restrictMatchUpsCount!==!1&&c>32)return{error:Ae,info:"matchUpsCount must be less than 33"};if(r&&!t.ignoreLastRoundNumber&&r-1>(d||0))return{error:Ae,info:"roundNumber error"};let f=r??(a&&(d??0)+1||d||1);l=l??Mt(0,c).map(()=>({participantIds:[void 0,void 0]}));let m=v=>{if(!t.idPrefix)return;let y=n.drawId,b=t.idPrefix??"ah";return`${y}-${b}-${f}-${v}`},g=l==null?void 0:l.map((v,y)=>{let b=(v==null?void 0:v.participantIds)??[void 0,void 0];b.push(void 0,void 0);let I=b.slice(0,2).map((w,S)=>Zt({sideNumber:S+1,participantId:w})),T=i[y]??m(y)??bn();return{roundNumber:f,matchUpStatus:jr,matchUpId:T,sides:I}});if(g!=null&&g.length){let v=(e=Ws({drawDefinition:n,event:o}))==null?void 0:e.tieFormat;v&&g.forEach(y=>{let{tieMatchUps:b}=qR({tieFormat:v,matchUp:y,isMock:s});Object.assign(y,{tieMatchUps:b,matchUpType:Xn})})}return{roundNumber:f,matchUpsCount:(g==null?void 0:g.length)??0,matchUps:g,...pe}}function U5e({maxIterations:t=4e3,valueSortedPairings:e,pairingValues:i,valueObjects:n,deltaObjects:r}){let a=Object.assign({},...e.map(y=>({[y.pairing]:y.value}))),s=Object.keys(i),o=[],l=fJ({actorsCount:s.length,valueSortedPairings:e,pairingValueMap:a,deltaObjects:r,valueObjects:n}),c=[K$(l)];o.push(l);let u=l.value,d=l,p=1,h=0,f=s.length,m;do f-=1,m=s.length*i[s[0]].length;while(m>t&&f>5);let g=[];s.forEach(y=>{i[y].slice(0,f).forEach(b=>{h+=1;let I=Jb(y,b.opponent);if(!g.includes(I)){let T=fJ({stipulated:[[y,b.opponent]],actorsCount:s.length,valueSortedPairings:e,pairingValueMap:a,deltaObjects:r,valueObjects:n});if(!c.includes(K$(T))){c.push(K$(T)),o.push(T);let{maxDelta:w,value:S}=T;w<d.maxDelta&&(d=T),(S<u||S===u&&Math.round(Math.random()))&&(u=S),g.push(I),p+=1}}}),o=o.filter(b=>Math.abs(b.value-u)<5)}),o.sort((y,b)=>y.maxDiff-b.maxDiff);let v=Ul(o);return{candidatesCount:p,deltaCandidate:d,maxIterations:t,iterations:h,candidate:v}}function K$(t){return t.participantIdPairings.map(({participantIds:e})=>e.sort().join("|")).sort().join("/")}function fJ({valueSortedPairings:t,stipulated:e=[],pairingValueMap:i,deltaObjects:n,valueObjects:r,actorsCount:a}){let s=[].concat(...e),o=[],l=0;e.filter(Boolean).forEach(d=>{let[p,h]=d,f=Jb(p,h),m=i[f];o.push({participantIds:d,value:m}),l+=i[f]}),Na(t,a).map(d=>co(d).map(p=>({...p,value:p.value+Math.random()*Math.round(Math.random())}))).flat().forEach(d=>{let p=d.pairing.split("|");if(!p.reduce((h,f)=>s.includes(f)||h,!1)){s.push(...p);let h=d.value;l+=h,o.push({participantIds:p,value:h})}}),o.sort((d,p)=>d.value-p.value);let c=o.reduce((d,p)=>{let[h,f]=p.participantIds,m=Jb(h,f),g=n[m];return g>d?g:d},0),u=o.reduce((d,p)=>{let[h,f]=p.participantIds,m=Jb(h,f),g=r[m];return g>d?g:d},0);return{value:l,participantIdPairings:o,maxDelta:c,maxDiff:u}}function Jb(t,e){return[t,e].sort(vF).join("|")}function ywe({participantIds:t}){let e={},i=[];t.forEach(r=>{e[r]=t.filter(a=>a!==r),e[r].forEach(a=>{let s=Jb(a,r);i.includes(s)||i.push(s)})});let n=Object.assign({},...i.map(r=>({[r]:0})));return{uniquePairings:i,possiblePairings:e,deltaObjects:n}}function D5e({matchUps:t}){let e=[];for(let i of t){let n=i.sides.map(Gi);if(n.length===2){let[r,a]=n,s=Jb(r,a);e.includes(s)||e.push(s)}}return{encounters:e}}function E5e({possiblePairings:t,valueObjects:e}){let i={};for(let r of Object.keys(t)){let a=t[r].map(s=>n(r,s));i[r]=a.sort((s,o)=>s.value-o.value)}function n(r,a){let s=Jb(r,a);return{opponent:a,value:e[s]}}return{pairingValues:i}}var P5e=0;function C5e({tournamentParticipants:t,adHocRatings:e,eventType:i,scaleName:n,pairing:r}){var a;let s=((a=Ea[n])==null?void 0:a.defaultInitialization)??P5e;return r.split("|").map(o=>{var l;if(i===Yc){let c=(l=t==null?void 0:t.find(u=>u.participantId===o))==null?void 0:l.individualParticipantIds;return c?c==null?void 0:c.map(u=>e[u]||s):s*2}else return e[o]||s})}function R5e(t){let{tournamentParticipants:e,adHocRatings:i={},possiblePairings:n,uniquePairings:r,maxIterations:a,minimizeDelta:s,deltaObjects:o,valueObjects:l,eventType:c,scaleName:u,salted:d}=t;r.forEach(b=>{let I=C5e({tournamentParticipants:e,adHocRatings:i,scaleName:u,eventType:c,pairing:b}),T=typeof d=="number"&&d||.5,w=d&&(Math.round(Math.random())?T:T*-1)||0,S=Math.abs(I[0]-I[1])+w,U=Math.abs(I[0]-I[1]);o[b]=U,l[b]||(l[b]=0),l[b]+=S?Math.pow(S,2):0});let p=r.map(b=>({pairing:b,value:l[b]})).sort((b,I)=>b.value-I.value),{pairingValues:h}=E5e({possiblePairings:n,valueObjects:l}),{candidate:f,candidatesCount:m,deltaCandidate:g,iterations:v}=U5e({valueSortedPairings:p,maxIterations:a,pairingValues:h,deltaObjects:o,valueObjects:l}),{participantIdPairings:y}=s?g:f;return{participantIdPairings:y,candidatesCount:m,deltaCandidate:g,iterations:v,candidate:f}}var M5e=100,N5e=100,A5e=4e3;function p7(t){var e,i;let{encounterValue:n=M5e,sameTeamValue:r=N5e,maxIterations:a=A5e,updateParticipantRatings:s,generateMatchUps:o=!0,ignoreLastRoundNumber:l,iterationMatchUps:c,tournamentRecord:u,dynamicRatings:d,refreshDynamic:p,participantIds:h,drawDefinition:f,roundNumber:m,structureId:g,matchUpIds:v,eventType:y,scaleName:b,idPrefix:I,isMock:T,salted:w,event:S}=t;if(!f)return{error:Ht};if(!t.structure&&!g)return{error:yr};let U=t.structure||fi({drawDefinition:f,structureId:g}).structure;if(!tn(U))return{error:Yy};if(!(h!=null&&h.length))return{error:Yg};let P=[...c??[],...(U==null?void 0:U.matchUps)??[]],{encounters:E}=D5e({matchUps:P}),R=(u==null?void 0:u.participants)??[],C={};if(d){let Q=Pi(U!=null&&U.matchUps?U.matchUps.map(({roundNumber:se})=>se):[]),J=Math.max(...Q,0);if(J){let se=(e=U==null?void 0:U.matchUps)==null?void 0:e.filter(({roundNumber:ce})=>ce===J).map(({matchUpId:ce})=>ce),ie=vwe({ratingType:b??((i=S==null?void 0:S.category)==null?void 0:i.ratingType),updateParticipantRatings:s,tournamentRecord:u,asDynamic:!0,refreshDynamic:p,drawDefinition:f,matchUpIds:se});if(ie.error)return ie;ie.modifiedScaleValues&&(C=ie.modifiedScaleValues)}}let{valueObjects:M}=_5e({tournamentParticipants:R,encounterValue:n,sameTeamValue:r,encounters:E}),{uniquePairings:_,possiblePairings:A,deltaObjects:N}=ywe({participantIds:h}),k=Object.values(C).length?C:t.adHocRatings,O={tournamentParticipants:R,possiblePairings:A,participantIds:h,uniquePairings:_,drawDefinition:f,maxIterations:a,adHocRatings:k,deltaObjects:N,valueObjects:M,eventType:y,scaleName:b,structure:U,salted:w},{candidatesCount:$,participantIdPairings:F,deltaCandidate:V,iterations:j,candidate:B}=R5e(O);if(!$)return{error:ML};let z,W;if(o){let Q=_F({structureId:U==null?void 0:U.structureId,ignoreLastRoundNumber:l,participantIdPairings:F,newRound:!0,drawDefinition:f,roundNumber:m,matchUpIds:v,idPrefix:I,isMock:T,event:S});if(Q.error)return Q;z=Q.roundNumber,W=Q.matchUps}let{maxDelta:Z,maxDiff:K}=B;return{roundNumber:z,participantIdPairings:F,modifiedScaleValues:C,candidatesCount:$,deltaCandidate:V,...pe,iterations:j,matchUps:W,maxDelta:Z,maxDiff:K}}function _5e({encounters:t,tournamentParticipants:e,encounterValue:i,sameTeamValue:n}){let r={};for(let s of t)r[s]||(r[s]=0),r[s]+=i;let a=e==null?void 0:e.filter(({participantType:s})=>s===Pn);if(a)for(let s of a){let o=s.individualParticipantIds??[],{uniquePairings:l}=ywe({participantIds:o});for(let c of l)r[c]||(r[c]=0),r[c]+=n}return{valueObjects:r}}function bwe(t){var e,i,n,r;let{drawType:a=bp,attachConsolation:s=!0,applyPositioning:o=!0,tournamentRecord:l,staggeredEntry:c,automated:u,placeByes:d,isMock:p,event:h}=t,f=t==null?void 0:t.drawDefinition;if(!f)return{error:Ht};let m=ja,g=Pw({stageSequence:1,drawDefinition:f,stage:m}),v=[Zu,pR,zh].includes(a)?g.length:MU(g.length);if(!c&&a===$U&&g.length<2||a===Zu&&g.length<3)return{error:SL};let{tieFormat:y,matchUpType:b}=t;if(y){let A=Go({tieFormat:y});if(A.error)return A}y=us(y??((e=Ws({drawDefinition:f}))==null?void 0:e.tieFormat)),b=b??f.matchUpType;let{structures:I}=Ju({stageSequence:1,drawDefinition:f,stage:m});if(I.length>1)return{error:hge};if((n=(i=I==null?void 0:I[0])==null?void 0:i.matchUps)!=null&&n.length)return{error:a6};let T=(r=I==null?void 0:I[0])==null?void 0:r.structureId;Object.assign(t,Zt({structureName:t.structureName??ys(ja),structureId:T,matchUpType:b,tieFormat:y,drawSize:v,stage:m}));let w=pwe(t);if(w.error)return w;let S=w.generators[a];if(!S)return{error:O5};let U=S==null?void 0:S();if(U.error)return U;let{structures:P,links:E}=U,R=P.map(A=>Sn({structure:A}).matchUps).flat();y&&R.forEach(A=>{let{tieMatchUps:N}=qR({matchUp:A,tieFormat:y,isMock:p});Object.assign(A,{tieMatchUps:N,matchUpType:b})}),(!o||!s)&&(f=$t(f,!1,!0)),f.links||(f.links=[]),E.length&&f.links.push(...E);let C=P.map(({structureId:A})=>A);f.structures||(f.structures=[]);let M=f.structures.map(({structureId:A})=>A);f.structures=f.structures.map(A=>C.includes(A.structureId)?P.find(({structureId:N})=>N===A.structureId):A);let _=P.filter(({structureId:A})=>!M.includes(A));return _.length&&f.structures.push(..._),u&&GR({seedingProfile:t.seedingProfile,applyPositioning:o,tournamentRecord:l,drawDefinition:f,structureId:T,placeByes:d,drawSize:v,event:h}),s&&zn({drawDefinition:f}),{links:E,structures:P,...pe}}var h7={};Fi(h7,{addGame:()=>Pwe,addPoint:()=>Ewe,addSet:()=>Rwe,addShot:()=>Cwe,analyzeScore:()=>b7,analyzeSet:()=>tP,calculateHistoryScore:()=>Twe,checkScoreHasValue:()=>ya,checkSetIsComplete:()=>OF,clearHistory:()=>Dwe,generate:()=>Iwe,generateScoreString:()=>Mh,generateTieMatchUpScore:()=>KR,getSetComplement:()=>w7,getTiebreakComplement:()=>BF,helpers:()=>_we,isValidMatchUpFormat:()=>Ll,keyValueScore:()=>a0e,mutate:()=>Swe,parseMatchUpFormat:()=>Do,parseScoreString:()=>rk,query:()=>u0e,redo:()=>Mwe,reverseScore:()=>wwe,setServingSide:()=>Uwe,stringifyMatchUpFormat:()=>$L,tidyScore:()=>c0e,umo:()=>Awe,undo:()=>Nwe,validateScore:()=>I7,validateTieFormat:()=>Go});var Iwe={};Fi(Iwe,{generateScoreString:()=>Mh,generateTieMatchUpScore:()=>KR,reverseScore:()=>wwe});function Mh(t){let{winnerFirst:e=!0,setTBlast:i=!0,addOutcomeString:n,reversed:r=!1,matchUpStatus:a,matchUpFormat:s,autoComplete:o,winningSide:l,sets:c}=t;if(!c)return{error:si,info:"missing sets"};let u=s&&Do(s),{bestOf:d,finalSetFormat:p,setFormat:h}=u??{},f=r||!(!e||!l||l===1),m=n?k5e({matchUpStatus:a}):"",g=(c==null?void 0:c.sort(x5e).map(v).filter(Boolean).join(" "))||"";if(!m)return g;if(l===2)return`${m} ${g}`;return`${g} ${m}`;function v(y){let b=d&&y.setNumber===d&&p?p:h,I=B=>Er(B==null?void 0:B.side1Score)||Er(B==null?void 0:B.side2Score),T=(B=>Er(B==null?void 0:B.side1TiebreakScore)||Er(B==null?void 0:B.side2TiebreakScore))(y),w=(b==null?void 0:b.tiebreakSet)||!I(y)&&T,{side1Score:S,side2Score:U,side1TiebreakScore:P,side2TiebreakScore:E}=y,R=P||(Er(P)||T&&o?0:""),C=E||(Er(E)||T&&o?0:"");if(w)return`[${(f?[C,R]:[R,C]).join("-")}]`;let M=T?Math.min(R,C):"",_=M===R?1:2,A=Er(M)?`(${M})`:"",N=S||(Er(S)||o?0:""),k=U||(Er(U)||o?0:""),O=B=>!i&&_===B?A:"",$=`${N}${O(1)}`,F=`${k}${O(2)}`,V=i&&T?`(${M})`:"",j=f?`${[F,$].join("-")}${V}`:`${[$,F].join("-")}${V}`;return["-"," "].includes(j)&&(j=""),j}}function k5e({matchUpStatus:t}){let e={[ss]:"RET",[un]:"WO",[oa]:"DF/DF",[Kr]:"WO/WO",[Qg]:"SUS",[ul]:"ABN",[Ki]:"DEF",[HU]:"DR"};return t&&e[t]||""}function x5e(t,e){return t.setNumber-e.setNumber}function wwe(t){if(!(t!=null&&t.score))return{error:si};let{sets:e}=t.score,i=e.map(s=>{let{side1TiebreakScore:o,side2TiebreakScore:l,winningSide:c,side1Score:u,side2Score:d,setNumber:p}=s;return Zt({winningSide:c?3-c:void 0,side1TiebreakScore:l,side2TiebreakScore:o,side1Score:d,side2Score:u,setNumber:p})}),n=t==null?void 0:t.setTBlast,r=Mh({setTBlast:n,sets:i}),a=Mh({sets:i,reversed:!0,setTBlast:n});return{reversedScore:{sets:i,scoreStringSide1:r,scoreStringSide2:a},...pe}}var Swe={};Fi(Swe,{addGame:()=>Pwe,addPoint:()=>Ewe,addSet:()=>Rwe,addShot:()=>Cwe,calculateHistoryScore:()=>Twe,clearHistory:()=>Dwe,redo:()=>Mwe,setServingSide:()=>Uwe,umo:()=>Awe,undo:()=>Nwe});function ab({matchUp:t}){let{extension:e}=xi({name:tF,element:t});if(!e)return{error:Ya};let{history:i=[],undoHistory:n=[]}=e.value;return{history:i,undoHistory:n,...pe}}function Twe(t){var e,i;if(!t)return{error:si};let{matchUp:n,updateScore:r}=t;if(!n)return{error:ll};let a=((e=ab({matchUp:n}))==null?void 0:e.history)||[];if(!Array.isArray(a))return{error:Ae,info:"history is not an array"};let{matchUpFormat:s}=n;if(!s)return{error:G5};if(!Ll({matchUpFormat:s}))return{error:j5};let o=Do(s),{bestOf:l,finalSetFormat:c,setFormat:u}=o,d=["0","15","30","40","A","G"],p={sets:[]},h=[],f,m=[0,0],g=1,v=0,y,b=0,I=C=>[1,2].includes(C),T=()=>(v+=1,{winningSide:void 0,side1Score:0,side2Score:0,setNumber:v,games:[]}),w=()=>({winningSide:void 0,points:[]}),S=()=>({winningSide:void 0,side1Score:"",side2Score:"",shots:[]}),U=S(),P=w(),E=T(),R=0;for(let C of a){R+=1,y=p.sets.length+1===l;let M=y&&c?c:u,{tiebreakAt:_,setTo:A,NoAD:N,tiebbreakFormat:k}=M,O=E.side1Score===_&&E.side1Score===E.side2Score,$=!!M.tiebreakSet,F=$?M.tiebreakSet:k,{tiebreakTo:V,NoAD:j}=F||{},B=()=>{f=void 0,m=[0,0],g=3-g,E.side1TiebreakScore="",E.side2TiebreakScore="",E.side1PointScore="",E.side2PointScore="",b=0},z=K=>{E.winningSide=K;let{s:Q,...J}=E;p.sets.push(J),U=S(),P=w(),E=T(),B()},W=K=>{P.winningSide=K;let{g:Q,...J}=P;E.games.push(J),U=S(),P=w(),B();let se=`side${K}Score`;E[se]+=1},Z=K=>{U.winningSide=K;let{p:Q,...J}=U;P.points.push(J),U=S(),b=0;let se=()=>m.reduce((ce,oe)=>ce+oe)%4/4>.5?g:3-g,ie=K-1;if(O||$){m[ie]+=1,f=se(),E[`side${K}TiebreakScore`]=m[ie],E[`side${3-K}TiebreakScore`]=m[1-ie];let ce=j?1:2;if(m[ie]>=V&&m[ie]>=m[1-ie]+ce)return W(K),{gameCompleted:!0}}else if(m[1-ie]===4&&m[ie]===3?m[1-ie]-=1:m[ie]+=1,E.side1PointScore=d[m[0]],E.side2PointScore=d[m[1]],m[ie]===5||m[ie]===4&&m[1-ie]<3||N&&m[ie]===4)return W(K),{gameCompleted:!0}};if(I(C.srv)&&(g=C.srv),["p","s","g","o"].includes(C.u)&&h.push(C.u),C.shotOutcome&&(U.shots.push(C),C.shotType==="SERVE"&&["OUT","NET"].includes(C.shotOutcome)&&(b+=1),b===2)){let K=3-g;Z(K)}if(I(C.p)||wi(C.pointNumber)){let K=C.winningSide||C.p;if((i=Z(K))!=null&&i.gameCompleted)continue}if(I(C.g)||wi(C.gameNumber)){let K=C.winningSide||C.g;P.winningSide=K;let Q=`side${K}Score`,J=`side${3-K}Score`;if(h.length&&(h.includes("p"),h=[]),W(K),E[Q]===A&&E[Q]-E[J]>=(N?1:2)&&(z(K),y))break}if(I(C.s)||wi(C.setNumber)){let K=C.winningSide||C.s;if(z(K),h.length&&(h.includes("p"),h.includes("g"),h=[]),y)break}}return R!==a.length&&console.log({error:"Match completed with excess history"}),(E.side1Score||E.side2Score||E.games.length||E.side1TiebreakScore||E.side2TiebreakScore)&&p.sets.push(E),p.scoreStringSide1=Mh({...p,matchUpFormat:s}),p.scoreStringSide2=Mh({...p,matchUpFormat:s,reversed:!0}),g=f||g,r&&(n.score=p),{...pe,servingSide:g,score:p}}function sb({undoHistory:t,history:e,matchUp:i}){return pn({element:i,extension:{value:{history:e,undoHistory:t},name:tF}})}function Uwe({matchUp:t,sideNumber:e}){if(![1,2].includes(e))return{error:W5};let{history:i=[]}=ab({matchUp:t});return i.push({srv:e}),sb({matchUp:t,history:i})}function Dwe({matchUp:t}){return sb({matchUp:t})}function Ewe({matchUp:t,point:e}){if(!e||!t)return{error:si};if(typeof e!="object")return{error:Ae,context:{point:e}};let{history:i=[]}=ab({matchUp:t});return i.push(e),sb({matchUp:t,history:i})}function Pwe({matchUp:t,game:e}){if(typeof e!="object")return{error:Ae,context:{game:e}};let{history:i=[]}=ab({matchUp:t});return i.push(e),sb({matchUp:t,history:i})}function Cwe({matchUp:t,shot:e}){if(typeof e!="object")return{error:si};let{history:i=[]}=ab({matchUp:t});return i.push(e),sb({matchUp:t,history:i})}function Rwe({matchUp:t,set:e}){if(typeof e!="object")return{error:si};let{history:i=[]}=ab({matchUp:t});return i.push(e),sb({matchUp:t,history:i})}function Mwe({matchUp:t}){let{history:e=[],undoHistory:i=[]}=ab({matchUp:t});return i.length&&e.push(i.pop()),sb({matchUp:t,history:e,undoHistory:i})}function Nwe({matchUp:t}){let{history:e=[],undoHistory:i=[]}=ab({matchUp:t});return i.push(e.pop()),sb({matchUp:t,history:e,undoHistory:i})}var Awe={},_we={};Fi(_we,{keyValueScore:()=>a0e,parseMatchUpFormat:()=>Do,stringifyMatchUpFormat:()=>$L,tidyScore:()=>c0e});var Qb=" ",vG="DEF",O5e="COMPLETED",kwe="WO",L5e="WO/WO",xwe="ABN",Owe="SUS",Lwe="RET",Fwe="INT",$we=[Lwe,vG,kwe,L5e,xwe,Owe,Fwe],yG="DEFAULTED",Bwe="WALKOVER",Vwe="ABANDONED",jwe="SUSPENDED",Gwe="RETIRED",Hwe="INTERRUPTED",F5e=[Gwe,yG,Bwe],$5e="Enter Score",NI="()",Dy="[]",f7=["up","left","shift+tab"],m7=["enter","down","tab","right"],tk="backspace",zwe="r",qwe="s",Wwe="a",Ywe="d",Kwe="w",Zwe="i",kF=[zwe,Ywe,Kwe,Wwe,qwe,Zwe],xF="space",Z$=["[","("],ik=[...f7,...m7,xF,"]"],Xwe="-",B5e="/",eI=Xwe,Nh=Xwe,Jwe=[B5e],V5e=0,j5e=["=","+","num_1","num_2","shift+=","shift+-"],g7=["0","1","2","3","4","5","6","7","8","9"].concat(kF),Qwe=g7.map(t=>`shift+${t}`),e0e=[eI,tk].concat(ik,Jwe),t0e=[g7,Qwe,e0e].join(","),G5e=[t0e,f7,m7,j5e].join(","),H5e={OUTCOMEKEYS:kF,SIDE1KEYS:g7,SIDE2KEYS:Qwe,MODIFIERS:e0e,PROMPT:$5e,MOVEUP:f7,MOVEDOWN:m7,HOTKEYS:G5e};function T0({scoreString:t,lowSide:e,outcome:i}){if({scoreString:t}=i0e({scoreString:t}),e===2){let n=(t&&t[t.length-1])!==Qb?Qb:"";return t+n+i}else return i+Qb+t}function i0e({scoreString:t}){if(!t)return{scoreString:""};let e=!1;for(let i of $we){let n=t==null?void 0:t.indexOf(i);n===0?t=t.slice(i.length+1).trim()+Qb:n>0&&(t=t.slice(0,n)),n>=0&&(e=!0)}return t!=null&&t.trim()||(t=""),{scoreString:t,removed:e}}function bG({analysis:t,scoreString:e,sets:i,lowSide:n}){var r,a,s;let o,l;if(!e)return{scoreString:e,sets:i};let{scoreString:c,removed:u}=i0e({scoreString:e});if(e=c,u)return{scoreString:e,sets:i,outcomeRemoved:!0};let d=i[i.length-1]||{},p=Object.values(d).filter(y=>y!==void 0).length;d.setNumber&&p===1&&(i=i.slice(0,i.length-1),d=i[i.length-1]||{});let{tiebreakSet:h}=t.setFormat,{tiebreakTo:f,NoAD:m}=h||{},{isTiebreakEntry:g}=vS({brackets:Dy,scoreString:e}),v=q5e(e);if(v>=0){o=e.slice(0,v);let{isTiebreakEntry:y}=vS({brackets:NI,scoreString:o}),{lastOpenBracketIndex:b,isTiebreakEntry:I}=vS({brackets:Dy,scoreString:o}),T=o&&o[o.length-1].trim(),w=o&&!isNaN(T),S=t.isIncompleteSetScore;if(g&&I){let U=o.slice(b+1).split(Nh),P=(U==null?void 0:U.length)>0&&U[0]!==void 0&&!isNaN(parseInt(U[0]))&&parseInt(U[0])||void 0,E=(U==null?void 0:U.length)>1&&U[1]!==void 0&&parseInt(U[1])||void 0,R=[P,E];if(E){let C=n===1?1:0;R[C]=((R==null?void 0:R[1-C])||0)+(m?1:2),(R[C]||0)<f&&(R[C]=f),o=e.slice(0,b+1),o+=R.join(Nh)}else P!==void 0?(o=e.slice(0,b+1),o+=P):(o=e.slice(0,b),S=!0);d.side1TiebreakScore=R[0]||0,d.side2TiebreakScore=R[1]||0}if(o.length||(o=void 0),S){let U=(r=d.side1Score)==null?void 0:r.toString();if(U){let P=U==null?void 0:U.slice(0,U.length-1);d.side1Score=!isNaN(P)&&parseInt(P)||void 0,d.side1Score===void 0&&(d.side2Score=void 0)}t.isTimedSet?(l=d.side1Score?i:(i==null?void 0:i.slice(0,i.length-1))||[],l[i.length-1]=d):l=(i==null?void 0:i.slice(0,i.length-1))||[]}else if(w){let U=(a=d.side2Score)==null?void 0:a.toString(),P=(s=d.side1Score)==null?void 0:s.toString();if(!t.isTiebreakEntry&&!t.isMatchTiebreak)if(d.side2Score){let E=U==null?void 0:U.slice(0,U.length-1);d.side2Score=!isNaN(E)&&parseInt(E)||void 0}else{let E=P==null?void 0:P.slice(0,P.length-1);d.side1Score=!isNaN(E)&&parseInt(E)||void 0}t.isTimedSet?d.side1Score?(l=i||[],l[i.length-1]=d):l=(i==null?void 0:i.slice(0,i.length-1))||[]:(l=i||[],l[i.length-1]=d),l[l.length-1]&&Object.assign(l[l.length-1],{winningSide:void 0})}else y?(l=i||[],Object.assign(l[l.length-1]||{},{winningSide:void 0,side1TiebreakScore:void 0,side2TiebreakScore:void 0})):(g&&!I?l=(i==null?void 0:i.slice(0,i.length-1))||[]:(l=i,l[i.length-1]=d),g||(l[l.length-1].side2Score=0,l[l.length-1].winningSide=void 0));return{scoreString:o,sets:l}}return{scoreString:e,sets:i}}function vS({brackets:t=NI,scoreString:e}){if(!e)return{};let[i,n]=t.split(""),r=e.split(""),a=Math.max(...yp(i,r)),s=Math.max(...yp(n,r));return{isTiebreakEntry:a>s,lastOpenBracketIndex:a}}function z5e({scoreString:t}){if(!t)return!1;let e=t&&t[t.length-1].trim(),i=t&&!isNaN(e),[n,r]=Dy.split(""),a=t.split(""),s=Math.max(...yp(n,a)),o=Math.max(...yp(r,a)),l=Math.max(...yp(Nh,a));return i&&s>o&&l>s}function q5e(t){return t.split("").reduce((e,i,n)=>(i.match(/\d+/g)&&e.push(n),e),[]).pop()}function n0e(t){let{lowValue:e=0,NoAD:i=!1,tiebreakTo:n}=t||{},r=i?1:2;return e+1>=n?e+r:parseInt(n)}function mJ({matchUpFormat:t,matchUpStatus:e,winningSide:i,sets:n}){var r;let a=Do(t),{bestOf:s}=a,o=Math.ceil(s/2),l=((r=n==null?void 0:n.reduce((c,u)=>{let{winningSide:d}=u;return d&&c[d-1]++,c},[0,0]))==null?void 0:r.indexOf(o))+1||void 0;return F5e.includes(e)&&i&&(l=i),{matchUpWinningSide:l}}function OF({ignoreTiebreak:t=!1,matchUpScoringFormat:e,matchUpFormat:i,isTiebreakSet:n,isDecidingSet:r,isTimedSet:a,set:s}){var o;if(!s)return{error:si,info:"missing set"};e=e||i&&Do(i);let l=r&&e.finalSetFormat||(e==null?void 0:e.setFormat)||{},{side1Score:c,side2Score:u}=s,{setTo:d,tiebreakAt:p}=l,h=c||u,f=LF({set:s}),m=Math.abs(c-u),g=c>=d||u>=d,v=n||c>=d&&u>=d||p&&p<d&&(c===p||u===p),y=t||v&&(f===1&&s.side1TiebreakScore>s.side2TiebreakScore||f===2&&s.side2TiebreakScore>s.side1TiebreakScore),b=!v&&l.NoAD||v||n&&(o=l.tiebreakFormat)!=null&&o.NoAD?1:2,I=m>=b;return!!((a&&h||g&&(I||v)||n)&&(!v||y))}function LF({set:t}){if(t.side1Score||t.side2Score){if(t.side1Score>t.side2Score)return 1;if(t.side2Score>t.side1Score)return 2}else if(t.side1TiebreakScore||t.side2TiebreakScore){if(t.side1TiebreakScore>t.side2TiebreakScore)return 1;if(t.side2TiebreakScore>t.side1TiebreakScore)return 2}}function v7({analysis:t,set:e}){let i=LF({set:e}),{isDecidingSet:n,isTiebreakSet:r,matchUpScoringFormat:a}=t;return OF({matchUpScoringFormat:a,isDecidingSet:n,isTiebreakSet:r,set:e})&&i}function W5e({analysis:t,scoreString:e,sets:i,value:n}){let r;if(!(i!=null&&i.length))return{sets:[]};let a=i[i.length-1];n=di(n);let{validSide2Score:s,requiresTiebreak:o}=Y5e({analysis:t,set:a,value:n});if(s){r=!0,e=(e||"")+n,a.side2Score=n;let l=v7({analysis:t,set:i[i.length-1]});if(a.winningSide=l||void 0,o){let c=NI.split("")[0];e+=c}else t.isDecidingSet||(e+=Qb)}return{sets:i,scoreString:e,updated:r}}function Y5e({analysis:t,set:e={},value:i}){let n=t.isDecidingSet&&t.matchUpScoringFormat.finalSetFormat||t.matchUpScoringFormat.setFormat,{tiebreakAt:r,setTo:a,NoAD:s}=n,{side1Score:o}=e,l,c;return r&&r<a?o===r?l=i<=a:l=i<=r:o===a?s?l=i<a:l=i<=a+1:o===a-1?s?l=i<=a:l=i<=a+1:o===a+1?l=i===a||i===a-1:l=i<=a,l&&(r&&r<a?c=o===a&&i===r||o===r&&i===a:c=o>=a&&i>=a&&o!==i),{validSide2Score:l,requiresTiebreak:c}}function r0e({lowSide:t,value:e,sets:i,scoreString:n,winningSide:r,matchUpStatus:a}){let s;return e===zwe?n?(s=!0,n=T0({scoreString:n,lowSide:t,outcome:Lwe}),r=t===2?1:2,a=Gwe):(s=!0,n=T0({scoreString:n,lowSide:t,outcome:vG}),r=t===2?1:2,a=yG):e===Ywe?(s=!0,n=T0({scoreString:n,lowSide:t,outcome:vG}),r=t===2?1:2,a=yG):e===Kwe?(s=!0,i=[],n=kwe,r=t===2?1:2,a=Bwe):e===qwe&&n?(s=!0,n=T0({scoreString:n,lowSide:t,outcome:Owe}),a=jwe,r=void 0):e===Wwe?(s=!0,n=T0({scoreString:n,lowSide:t,outcome:xwe}),a=Vwe,r=void 0):e===Zwe&&n&&(s=!0,n=T0({scoreString:n,lowSide:t,outcome:Fwe}),a=Hwe,r=void 0),{updated:s,sets:i,scoreString:n,matchUpStatus:a,winningSide:r}}function K5e(t){let{sets:e,info:i,scoreString:n,winningSide:r,matchUpStatus:a}=t,{analysis:s,lowSide:o,value:l}=t,c,u;!(e!=null&&e.length)&&l!==tk&&(e=[{setNumber:1}]);let d=e.length-1;if(kF.includes(l)){let p=e[e.length-1]||{},{side1Score:h,side2Score:f}=p;h&&!f?i="missing side2Score":s.finalSetIsComplete||r?i="final set is already complete":s.isIncompleteSetScore?i="incomplete set scoreString":s.isIncompleteSetScore||({sets:e,scoreString:n,winningSide:r,matchUpStatus:a,updated:c}=r0e({lowSide:o,value:l,sets:e,scoreString:n,matchUpStatus:a,winningSide:r}))}else if(l===tk){if({scoreString:n,sets:e,outcomeRemoved:u}=bG({analysis:s,scoreString:n,sets:e}),(n==null?void 0:n.trim())===""&&(n=n.trim()),n||(e=[]),u){let p=e[e.length-1]||{},{side1Score:h,side2Score:f}=p;if(h&&f){let m=h>f&&1||f>h&&2||void 0;m&&(p.winningSide=m,e.push({setNumber:e.length+1}))}}a=void 0,r=void 0,c=!0}else if(s.hasOutcome)i="has outcome";else{if(r)return{sets:e,scoreString:n,winningSide:r,matchUpStatus:a,updated:!1,info:"matchUp is complete"};if(l===xF){let p=e[e.length-1]||{},{side1Score:h,side2Score:f}=p,m=h>f&&1||f>h&&2||void 0;m&&!r&&!s.isIncompleteSetScore&&(e[e.length-1].winningSide=m,e.push({setNumber:e.length+1}),n+=" ",c=!0)}else if(l===eI&&e[d].side1Score!==void 0&&e[d].side2Score===void 0&&n&&s.isNumericEnding)n+="-",e[d].side2Score=0,a=void 0,r=void 0,c=!0;else if(!isNaN(l)){let p;if(e[d].side2Score===void 0){let h=di((e[d].side1Score||0).toString()+l).toString().slice(0,2);e[d].side1Score=di(h),p=e[d].side1Score.toString(),c=!0}else{let h=di((e[d].side2Score||0).toString()+l).toString().slice(0,2);e[d].side2Score=di(h),p=[e[d].side1Score,e[d].side2Score].join("-"),c=!0}if(c){let h=(e.slice(0,d)||[]).filter(f=>f).map(f=>{let{side1Score:m,side2Score:g}=f;return[m,g].join("-")}).join(" ");h?n=h+" "+p:n=p}}}return{sets:e,scoreString:n,winningSide:r,matchUpStatus:a,info:i,updated:c}}function Z5e({analysis:t,auto:e,lowSide:i,scoreString:n="",sets:r,value:a}){var s;let o,l,{tiebreakSet:{tiebreakTo:c,NoAD:u}}=t.setFormat,[d]=Dy.split("");if(t.isMatchTiebreakEntry||(n+=d),r[t.setNumber-1]){let{lastOpenBracketIndex:p}=vS({brackets:Dy,scoreString:n}),h=(n.slice((p??0)+1)+(e?"":a)).split(Nh);if((((s=h[i-1])==null?void 0:s.length)||0)>=2)l="tiebreak digit limit";else if(e){i===1&&(h[0]=(h[0]||"")+a),i===2&&(h[1]=(h[1]||"")+a);let f=[h[0]||0,h[1]||0].map(v=>di(v)),m=i===1?1:0;f[m]=f[1-m]+(u?1:2),f[m]<c&&(f[m]=c);let g=r[r.length-1];g.side1TiebreakScore=f[0],g.side2TiebreakScore=f[1],n=n.slice(0,(p??0)+1),n+=f.join(Nh),o=!0}else{let f=[h[0]||0,h[1]||0].map(g=>di(g)),m=r[r.length-1];m.side1TiebreakScore=f[0],m.side2TiebreakScore=f[1],n+=a,o=!0}}else{let p=n0e({lowValue:di(a||0),tiebreakTo:c,NoAD:u}),h=[di(a),p];i===2&&h.reverse();let f={side1TiebreakScore:h[0],side2TiebreakScore:h[1],setNumber:(r==null?void 0:r.length)+1||1};r.push(f),n+=h.join(Nh),o=!0}return{info:l,scoreString:n,sets:r,updated:o}}function X5e({analysis:t,lowSide:e,scoreString:i,value:n}){let{setTo:r,tiebreakAt:a,NoAD:s}=(t==null?void 0:t.setFormat)||{},o=n===parseInt(a||r);if(a&&a<r&&n>a)return{scoreString:i};if(s&&n===r||n>r)return{scoreString:i};let l=f(),c=[n,l];e===2&&c.reverse();let u=NI.split("")[0],d=c.join(eI)+(o?u:Qb);i=(i||"")+d;let p={side1Score:c[0],side2Score:c[1]},h=v7({analysis:t,set:p});return p.winningSide=h||void 0,{scoreString:i,set:p};function f(){return o?n+1:n+1===r?n+(s?1:2):r}}function J5e({matchUpFormat:t,scoreString:e,winningSide:i,value:n,sets:r}){var a,s,o;let l=(((a=r==null?void 0:r.filter(j=>j==null?void 0:j.winningSide))==null?void 0:a.length)||0)+(i?0:1),c=Do(t),u=l===(c==null?void 0:c.bestOf),d=u&&(c==null?void 0:c.finalSetFormat)||(c==null?void 0:c.setFormat)||{},p=d==null?void 0:d.timed,h=u&&r[(c==null?void 0:c.bestOf)-1],f=h==null?void 0:h.winningSide,{isTiebreakEntry:m}=vS({brackets:NI,scoreString:e}),{isTiebreakEntry:g}=vS({brackets:Dy,scoreString:e}),v=m||g,y=!!d.tiebreakSet,b=(s=e==null?void 0:e[e.length-1])==null?void 0:s.trim(),I=e&&!isNaN(b),T=!v&&b===eI,w=m&&Z$.includes(b),S=g&&Z$.includes(b),U=g&&b===Nh,P=e==null?void 0:e.split(""),[E]=Dy.split(""),R=P&&Math.max(...yp(E,P)),C=P&&Math.max(...yp(Nh,P)),M=P&&C>R,_=(o=r[r.length-1])==null?void 0:o.winningSide,A=(r==null?void 0:r.length)&&!_,N=$we.find(j=>(e==null?void 0:e.indexOf(j))>=0),k=!isNaN(n),O=n===xF,$=ik.includes(n),F=e==null?void 0:e.split("").find(j=>Z$.includes(j)),V=$&&g&&!S&&(U||!z5e({scoreString:e}));return{isTiebreakSetValue:y&&k,matchUpScoringFormat:c,setNumber:l,setFormat:d,matchTiebreakHasJoiner:M,isGameScoreEntry:A,isSpace:O,isCloser:$,isTiebreakCloser:$&&F&&v&&I,isDecidingSet:u,isTiebreakSet:y,isTimedSet:p,isNumericEnding:I,isNumericValue:k,hasOpener:F,hasOutcome:N,finalSet:h,finalSetIsComplete:f,lastSetIsComplete:_,isInvalidSetTiebreakValue:O&&v&&w,isInvalidMatchTiebreakValue:V,isTiebreakEntry:v,isSetTiebreakEntry:m,isMatchTiebreakEntry:g,isIncompleteSetScore:T,isIncompleteSetTiebreak:w,isIncompleteMatchTiebreak:S,isPartialMatchTiebreakValue:U}}function a0e(t){let{lowSide:e=1,value:i}=t,{scoreString:n,sets:r,winningSide:a,matchUpStatus:s}=t,{matchUpFormat:o,shiftFirst:l,auto:c=!0}=t,u,d,p=l&&e===2||!l&&e===1;if(!t0e.includes(i))return{updated:!1,info:"invalid key"};l&&(e=3-e);let{matchUpWinningSide:h}=mJ({sets:r,winningSide:a,matchUpStatus:s,matchUpFormat:o});a=h;let f=J5e({value:i,winningSide:a,scoreString:n,sets:r,matchUpFormat:o});if(Jwe.includes(i)&&(i=eI),f.hasOpener&&f.isTiebreakEntry&&!f.isTiebreakSet&&p&&di(i)===0&&(f.isTiebreakCloser=!0),ik.includes(i)&&f.hasOpener&&(i=""),ik.includes(i)&&(i=xF),f.lastSetIsComplete){let m=(n==null?void 0:n.length)&&n[n.length-1];n&&m!==" "&&(n+=" ")}if(f.isTimedSet)({info:d,sets:r,scoreString:n,updated:u,matchUpStatus:s,winningSide:a}=K5e({analysis:f,lowSide:e,scoreString:n,sets:r,matchUpStatus:s,winningSide:a,value:i}));else if(kF.includes(i))f.finalSetIsComplete||a?d="final set is already complete":!f.isTiebreakEntry&&!f.isIncompleteSetScore?{sets:r,scoreString:n,matchUpStatus:s,winningSide:a,updated:u}=r0e({lowSide:e,sets:r,scoreString:n,matchUpStatus:s,winningSide:a,value:i}):f.isTiebreakEntry||f.isIncompleteSetScore?d="incomplete set scoreString or tiebreak entry":console.log("handle case",{value:i});else if(i===tk)u=!0,{scoreString:n,sets:r}=bG({analysis:f,scoreString:n,sets:r,lowSide:e}),n||(r=[]),s=void 0,a=void 0;else if(f.hasOutcome)d="has outcome";else if(i===eI&&!f.isMatchTiebreakEntry)(!f.isSetTiebreakEntry||f.isSetTiebreakEntry&&!f.isNumericEnding)&&(u=!0,{scoreString:n,sets:r}=bG({analysis:f,scoreString:n,sets:r,lowSide:e}),s=void 0);else if(i===Nh&&f.isMatchTiebreakEntry&&!f.isSetTiebreakEntry)f.matchTiebreakHasJoiner?d="existing joiner":f.isNumericEnding&&(u=!0,n+=Nh);else if([eI,Nh].includes(i))d="invalid location for joiner";else{if(a)return{updated:!1,info:"matchUp is complete"};if(f.isIncompleteSetScore)f.isNumericValue&&({sets:r,scoreString:n,updated:u}=W5e({analysis:f,scoreString:n,sets:r,value:i}));else if(f.isInvalidMatchTiebreakValue)d="invalid matchUp tiebreak character";else if(f.isInvalidSetTiebreakValue)d="invalid set tiebreak character";else if(f.isTiebreakCloser){let m=f.isSetTiebreakEntry?NI:Dy,g=m.split("").reverse()[0],v=m.split("")[0],y=r[r.length-1],{tiebreakFormat:b}=f.setFormat,{tiebreakTo:I,NoAD:T}=b||{},w=LF({set:y});if(!f.isTiebreakSet){let U=parseInt(n.split(v).reverse()[0]),P=n0e({lowValue:U,tiebreakTo:I,NoAD:T});w===1?(y.side1TiebreakScore=P,y.side2TiebreakScore=U):(y.side1TiebreakScore=U,y.side2TiebreakScore=P)}n=(n||"")+g,f.isDecidingSet||(n+=Qb);let S=v7({analysis:f,set:y});y.winningSide=S||void 0,u=!0}else if(f.isTiebreakSetValue)({info:d,scoreString:n,sets:r,updated:u}=Z5e({analysis:f,auto:c,lowSide:e,scoreString:n,sets:r,value:i}));else if(f.isSetTiebreakEntry){let[m]=NI.split(""),g=Math.max(...yp(m,n.split(""))),v=n.slice(g+1),y=v&&di(v)===V5e,b=di(v?v+i:i),{tiebreakFormat:I}=f.setFormat,{tiebreakTo:T,NoAD:w}=I||{};!y&&v.length<2?w&&b>T-1?d="invalid low value for NoAD tiebreak":(u=!0,n=(n||"")+i):d=y?"tiebreak begins with zero":"tiebreak digit limit"}else if(f.isCloser)d=`invalid key: ${i}`;else if(f.isGameScoreEntry)d="game scoreString entry";else if(f.lastSetIsComplete||!r.length){u=!0;let{scoreString:m,set:g}=X5e({analysis:f,lowSide:e,scoreString:n,value:di(i)});g&&(g.setNumber=(r==null?void 0:r.length)+1||1),r=(r==null?void 0:r.concat(g).filter(Boolean))||[g],n=m||void 0}else console.log("error: unknown outcome")}if(u){r=r==null?void 0:r.filter(Boolean);let{matchUpWinningSide:m}=mJ({sets:r,winningSide:a,matchUpStatus:s,matchUpFormat:o});return a=m,m&&(!s||[jr,$l].includes(s))?(s=O5e,r=r.filter(g=>{let{side1Score:v,side2Score:y,side1TiebreakScore:b,side2TiebreakScore:I}=g;return v||y||b||I})):n&&!a&&![jwe,Vwe,Hwe].includes(s)&&(s=void 0),{updated:u,scoreString:n,sets:r,winningSide:a,matchUpStatus:s,info:d}}return{updated:u,scoreString:n,sets:r,winningSide:a,matchUpStatus:s,info:d}}var FF="\\d+-\\d+",eP="\\d+-\\d+\\(\\d+\\)",y7="\\[\\d+-\\d+\\]",Q5e="\\d+-\\d+\\(\\d+-\\d+\\)",e6e=new RegExp(`(${FF}),`,"g"),t6e=new RegExp(`(${eP}),`,"g"),i6e=[FF,eP,y7,Q5e],n6e=["0","1","2","00","01","10","11","002","012","102","112","000","001","010","100","011","101","110","111","002","012","102","112","0002","0012","0102","1002","0112","1012","1102","1112","3","03","13","013","103"],r6e=n6e.map(t=>{let e=t.split("").map(i=>i6e[i]).join(" ");return new RegExp(`^${e}$`)});function gJ(t){return!t||r6e.some(e=>e.test(t))}function a6e(t){let e="[];",i="()",n=e+i,r=[e[0],i[0]],a=Object.assign({},...n.split("").map(l=>({[l]:0}))),s="",o=t.split("").map(l=>{let c=n.includes(l)&&l,u=r.includes(c);if(u&&c)return a[c]+=1,s=c,l;if(!u&&c&&s&&c!==s){a[s]-=1;let d=e.includes(s)&&e||i.includes(s)&&i||"",p=d.split("").find(h=>h!==s);if(d.includes(c))a[s]||(s="");else return a[c]||(s=""),p}return l}).join("");return t!==o?o:t}function pA(t){return/^\(\d+\)$/.test(t)||/^\(\d+$/.test(t)}function s6e(t){return/^\(\d+-\d+\)$/.test(t)||/^\[\d+-\d+\]$/.test(t)}function TT(t){let e=(i=>i==null?void 0:i.split("-").join("").split("/").join(""))(t);if(/^\d+$/.test(e)&&e.length===2){let i=e.split("");return Math.abs(i.reduce((n,r)=>+n-+r))===1}return!1}function nk(t,e){let i=[t.slice(e,e+2),e?t.slice(0,1):t.slice(2)].map(r=>parseInt(r.join("")));e&&i.reverse();let n=i;if(Math.abs(n.reduce((r,a)=>+r-+a))>=2)return n.join("-")}function vJ(t){return t.length===2?t.split("").join("-"):([", ",",","/"," "].forEach(e=>t=t.split(e).join("-")),t=t.replace(/-{2,}/,"-"),t)}function o6e(t){return t.startsWith("(")&&t.endsWith(")")}function l6e({score:t,applied:e}){t=a6e(t);let i=/\)(\d+)/g;if(i.test(t))for(let w of t.match(i)){let S=w.replace(")",") ");t=t.replace(w,S)}t=t.replace(/\)\//g,") / "),t=t.replace(/\/\)/g,")");let n=/\(([\d- ]+)\)/g,r=/\(([\d- ]+)\)/,a=t.match(n);for(let w of a||[]){let[S]=w.match(r).slice(1),U=S.replace(/ /g,"");t=t.replace(w,`(${U})`)}let s=/\(\(\d-\d\)\)/g;if(s.test(t)){let w=t.match(s);w.length&&w.forEach(S=>{let U=S.match(/\((\(\d-\d\))\)/).slice(1)[0];t=t.replace(S,U)})}if(s=/\(\((\d)\)\)/g,s.test(t)){let w=t.match(s);w.length&&w.forEach(S=>{let U=S.match(/\((\(\d\))\)/).slice(1)[0];t=t.replace(S,U)})}/(^|\s)6-,/.test(t)&&(t=t.replace(/(^|\s)6-,/g,"6-0,"));let o=new RegExp(/[-,]{2,}/g);t=t.replace(o,"-"),["- "," -"].forEach(w=>{let S=new RegExp(`(\\d+)${w}(\\d+)`,"g"),U=t.match(S);U&&U.forEach(P=>t=t.replace(P,P.split(w).join("-")))}),/^[(-/,]+$/.test(t)&&(t=""),/\)[-/,]+$/.test(t)&&(t=t.slice(0,t.length-1)),/\d \/\d/.test(t)&&(t=t.replace(/ \//g,"/")),t.includes(" /")&&(t=t.replace(/ \//g," "));let l=/\(\d+, \)/g;l.test(t)&&t.match(l).forEach(w=>{let[S]=w.match(/\((\d+), \)/).slice(1);S.length===2?t=t.replace(w,`(${S})`):S.length===1&&S==="6"&&(t=t.replace(w,"(6-0)"))});let c=/\((\d+)\/\)/g;c.test(t)&&t.match(c).forEach(w=>{let[S]=w.match(/\((\d+)\/\)/).slice(1);S.length===2?t=t.replace(w,`(${S})`):S.length===1&&S==="6"?t=t.replace(w,"(6-0)"):t=t.replace(w,`(${S})`)});let u=/\d\/\d\/,/g;u.test(t)&&t.match(u).forEach(w=>{let[S]=w.match(/(\d\/\d)\/,/).slice(1);t=t.replace(w,`${S},`),e.push("slashComma")});let d=/\(\/(\d+)\)/g;d.test(t)&&t.match(d).forEach(w=>{let[S]=w.match(/\(\/(\d+)\)/).slice(1);S.length===2?t=t.replace(w,`(${S})`):S.length===1&&parseInt(S)<6?t=t.replace(w,`(6-${S})`):t=t.replace(w,`(${S})`)});let p,h,f,m,g,v=()=>{g=Ol(t.split("")),h=g["("]===(g[")"]||0)+1,p=(g["("]||0)+1===g[")"],f=g["["]===g["]"]+1,m=h&&!f};v();let y=/(\d+-\d+\(\d+)0,/;if(y.test(t)){let[w]=t.match(y).slice(1);t=t.replace(y,w+")")}if(g["("]===g[")"]&&g["("]>1){let w=t.split(")(").join(") (").split(" ");w.every(o6e)?t=w.map(S=>{let U=S.slice(1,S.length-1);return U.length>2?U:S}).join(" "):t=w.join(" ")}v();let b=/[A-Za-z]+/.test(t),I=/\d+/.test(t);if(!b&&!I)return{score:""};if(/^\[.+\]$/.test(t)&&"()/,- ".split("").some(w=>g[w])&&(t=t.slice(1,t.length-1)),/^\(.+\)$/.test(t)&&g["("]===1&&g[")"]===1&&"[]/,".split("").some(w=>g[w]>1)&&(t=t.slice(1,t.length-1)),t.startsWith("(")&&t.endsWith("))")&&(t=t.slice(1,t.length-1)),g["("]>(g[")"]||0)&&t[t.length-1]==="("&&(t=t.slice(0,t.length-1)+")",v()),g["("]===1&&!g[")"]&&t[0]==="("&&(t=t+")",v()),g["("]>(g[")"]||0)&&t.slice(0,2)==="(("&&(t=t.slice(1)),p){if(/^9\d/.test(t))t="("+t.slice(1);else if(t[0]!=="(")t="("+t;else{let w=[],S=0;for(let U of t.split("").reverse())U===")"&&(S?w.push("("):S+=1),U==="("&&(S-=1),w.push(U);w.reverse(),t=w.join("")}v()}if(g[")"]>(g["("]||0)&&t[0]===")"&&(t="("+t.slice(1),v()),m&&(t.endsWith(9)||/\d+0$/.test(t))&&(t=t.slice(0,t.length-1)+")",v()),m&&(!t.endsWith(")")||t.startsWith("(("))&&(t=t+")",v()),m){let w="",S=0;for(let U of t.split(""))U==="("&&(S?w+=")":S+=1),U===")"&&(S-=1),w+=U;t=w}v(),f&&!h&&(t=t+"]"),t.includes("([")&&t.includes("])")&&(t=t.split("([").join("[").split("])").join("]"),v()),/\(\d+0$/.test(t)&&(t=t.slice(0,t.length-1)+")"),v(),g[")"]===1&&!g["("]&&t.endsWith(")")&&(t=t.slice(0,t.length-1)),t.startsWith("(")&&t.endsWith(")")&&g["("]===1&&g[")"]===1&&(t=t.slice(1,t.length-1),v());let T=w=>{let S=w.indexOf("("),U=w.indexOf(")");return S>=0&&U>=0&&S<U};if(/^\([\d ]+.*[\d ]+\)$/.test(t)&&g["("]===g[")"]){let w=t.slice(1,t.length-1);T(w)&&(t=w,v())}return{score:t,applied:e}}function $F(t){if(!/^[\d-]+(\(\d\))*$/.test(t))return t;let e=yp("-",t.split(""));if(!e.length)return t;let i=t.split("-"),n=!(i.length%2),r=!!(e.length%2);return n&&r&&e.length>i.length/2&&e.filter((a,s)=>s%2).forEach(a=>{t=t.substring(0,a)+" "+t.substring(a+1)}),t}function c6e({score:t,applied:e}){return t.includes("( ")&&(e.push("removeParenSpacingAfterOpen"),t=t.split("( ").map(i=>i.trim()).join("(")),t.includes(" )")&&(e.push("removeParenSpacingBeforeClose"),t=t.split(" )").map(i=>i.trim()).join(")")),[e6e,t6e].forEach(i=>{let n=t.match(i);n!=null&&n.length&&(n.forEach(r=>{t=t.replace(r,r.slice(0,r.length-1)+" ")}),e.push("setsEndComma"))}),t=t.split(" ").filter(Boolean).map($F).join(" "),{score:t,applied:e}}function u6e({score:t}){if(typeof t!="string")return{score:t};let e=p=>p==null?void 0:p.split("-").join("").split("/").join(""),i=p=>p.split("[").join("(").split("]").join(")");t=t.split(", ").join(" ");let n=t.split(" ");t=n.map(p=>{let h=/^-(\d+)$/;if(h.test(p)){let[f]=p.match(h).slice(1);if(f.length===2)return f.split("").join("-")}return p}).join(" "),n=t.split(" ");let r=n.filter(pA),a=0,s="";for(let p of r){let h=yp(p,n).filter(v=>!a||v>a)[0],f=n.slice(a,h-1),m=n[h-1],g=e(m);if(/^\d+$/.test(g)&&g.length===2){let v=g.split(""),y=Math.abs(v.reduce((b,I)=>+b-+I));if(y===1){let b=[f.join(" "),[m,p].join("")].join(" ");s+=b,a=h+1}else if(y===0){let b=Math.max(...v);if([4,5,6,7,8,9].includes(b)){let I=[6,4].includes(b)?b+1:b-1,T=[b,I].sort().reverse().join("-"),w=[f.join(" "),[T,p].join("")].join(" ");s+=w,a=h+1}}}}if(r.length&&s.length){let p=n.slice(a).join(" ");return s=[s,p].join(" "),{score:s.trim()}}if(n.length===2&&["(","["].some(p=>n[1].includes(p))){let p=e(n[0]).split("");if(Math.abs(p.reduce((h,f)=>+h-+f,0))===1)return n[1]=i(n[1]),{score:n.join("")}}let o=n.map(p=>s6e(p)&&"bracket"||TT(p)&&"set");if(o.includes("set")&&o.includes("bracket")){let p,h="";return n.forEach((f,m)=>{o[m]==="bracket"&&p==="set"?(f=i(f),h+=f):h+=` ${f}`,p=o[m]}),{score:h.trim()}}n=t.split(" ");let l,c=n.map(p=>{let h=new RegExp(/^(\d+)-(\d+)$/);if(h.test(p)){let[f,m]=p.match(h).slice(1),g=Math.abs([f,m].reduce((y,b)=>+y-+b)),v=Math.max(f,m);if(g===1)return l="tiebreakSet",l;if(g>=2&&v>=7&&l==="tiebreakSet")return l="tiebreak",l}}),u=yp("tiebreak",c);if(u.length){let p="";n.forEach((h,f)=>{u.includes(f)?p+=`(${h}) `:u.includes(f+1)?p+=`${h}`:p+=`${h} `}),t=p.trim()}let d=/(\d+-\d+)\((\d+)-(\d+)\)$/;if(d.test(t)){let[p,h,f]=t.match(d).slice(1),m=Math.max(h,f)>=10;!TT(p)&&m&&(t=t.replace(d,`${p} [${h}-${f}]`))}return c=[],t=t.split(" ").map(p=>{let h=/^\((.*)\)$/,f=h.test(p),m=new RegExp(y7).test(p)&&"super"||new RegExp(eP).test(p)&&"tiebreak"||new RegExp(FF).test(p)&&"standard"||"unknown";return c.push(m),m==="standard"&&f?p.match(h)[1]:p}).join(" "),{score:t}}function d6e({score:t,applied:e}){for(let U of[".",","," ","/"]){let P=new RegExp(`^(\\d+)\\${U}(\\d+)$`);if(P.test(t)){let E=t.match(P).slice(1).map(C=>parseInt(C)),R=Math.abs(E[0]-E[1]);R<=10&&R>=2&&(t=t.split(U).join("-"),e.push("variedJoinerPattern"))}}t.includes(";")&&(t=t.split(";").join(" "),e.push("semicolon set separation"));let i=/(^|\s)(\d)\/(\d)(\d)\/(\d)(\(|$)/;if(i.test(t)){let[U,P,E,R,C,M]=t.match(i).slice(1);t=t.replace(i,`${U}${P}-${E} ${R}-${C}${M}`),e.push("smashSlashPattern")}/.*\s6[/-]+$/.test(t)&&(t+="0",e.push("incompleteFinalSetPattern"));let n=/\(6,\)/g;n.test(t)&&(t=t.replace(n,"(6, 0)"),e.push("missingZeroPattern1"));let r=/^\d{3,}\(/,a=/\(\d+\)\d+/;[r,a].forEach(()=>{t=t.split(" ").map(U=>(r.test(U)&&(U=U.replace("("," (")),a.test(U)&&(U=U.replace(")",") ")),U)).join(" "),e.push("spaceConsiderationPatterns")});let s=$F(t);s!==t&&(t=s,e.push("deDashMash"));let o=/^(\d)[-/,]+(\d{2})[-/,]+(\d)$/;if(o.test(t)){let[U,P,E]=t.match(o).slice(1),[R,C]=P.split("");t=`${U}-${R} ${C}-${E}`,e.push("smashSetPattern")}let l=/^(\d+)[ -](\d+)$/,c=/^([\d -]+)\/([\d -]+)$/;if(c.test(t)){let[U,P]=t.match(c).slice(1),E=U.trim(),R=P.trim();if(l.test(E)&&l.test(R)){let C=E.match(l).slice(1,3).join("-"),M=R.match(l).slice(1,3).join("-");t=`${C} ${M}`,e.push("slashSeparationPattern")}}let u=/^([\d -]+),([\d -]+)$/;if(u.test(t)){let[U,P]=t.match(u).slice(1),E=U.trim(),R=P.trim();if(l.test(E)&&l.test(R)){let C=E.match(l).slice(1,3).join("-"),M=R.match(l).slice(1,3).join("-");t=`${C} ${M}`,e.push("commaSeparationPattern")}}let d=/^\d \d,/;if(d.test(t)){let U=t.match(d)[0],P=U.slice(0,U.length-1).split(" ").join("-");t=t.replace(U,P),e.push("singleSetCommaSeparationPattern")}let p=0,h=/(\d+)-(\d{2})-(\d+)/;for(;h.test(t)&&p<3;){let[U,P,E]=t.match(h).slice(1),R=P.split(""),C=`${U}-${R[0]} ${R[1]}-${E}`;t=t.replace(h,C),e.push("noSetSeparationPattern"),p+=1}let f=/(^|\s)7-6\s(\d+)\s/g,m=t.match(f);if(m!=null&&m.length){let U=/(^|\s)7-6\s(\d+)\s/;m.forEach(P=>{let E=P.match(U).slice(2)[0];t=t.replace(P,`7-6(${E}) `),e.push("floatingTiebreakPattern1")})}let g=t.match(/\d \d /);g==null||g.forEach(U=>{let P=U.slice(0,U.length-1).split(" ").join("-");t=t.replace(U,P),e.push("spaceSeparatedSetPattern1")}),g=t.match(/ \d \d$/),g==null||g.forEach(U=>{let P=" "+U.slice(1).split(" ").join("-");t=t.replace(U,P),e.push("spaceSeparatedSetPattern2")});let v=/^\d, *\d\/\d, *\d/;if(v.test(t)){let U=t.match(v)[0],P=U.split("/").map(E=>`(${E})`).join(" ")+" ";t=t.replace(U,P),e.push("slashCommaSetPattern")}let y=/\(6-\)/g;y.test(t)&&(t=t.replace(y,"(6-0)"),e.push("missingZeroPattern2"));let b=new RegExp("(?<!-)(\\d+)\\/(\\d+)(?!-)","g");if(b.test(t)){let U=t.match(b),P=new RegExp("(?<!-)(\\d+)\\/(\\d+)(?!-)"),E=t;U.forEach(R=>{let[C,M]=R.match(P).slice(1),_=`${C}-${M}`;E=E.replace(R,_)}),t=E,e.push("slashSetPattern")}let I=/(.*)\s(1\d)\s(\d+)$/;if(I.test(t)){let[U,P,E]=t.match(I).slice(1);U.replace(/\D/g,"").length>=4&&(t=U+` ${P}${E}`,e.push("spaceSeparatedSuperPattern"))}let T=/(^|\s)(\d+-\d+)\s(\d+)(\s|$)/g;for(let U of t.match(T)||[]){let[P,E,R,C]=U.match(/(^|\s)(\d+-\d+)\s(\d+)(\s|$)/).slice(1),[M,_]=E.split("-").map(A=>parseInt(A));Math.abs(M-_)===1&&(t=t.replace(U,`${P}${E}(${R})${C}`),e.push("spaceSeparatedSetPattern"))}let w=/\d-\d \(\d{1,2}\)(\s|$|,)/g;for(let U of t.match(w)||[]){let P=/(\d-\d) \((\d{1,2})\)(\s|$|,)/,[E,R,C]=U.match(P).slice(1),[M,_]=E.split("-").map(A=>parseInt(A));Math.abs(M-_)===1&&(t=t.replace(U,`${E}(${R})${C}`),e.push("floatingTiebreakPattern2"))}let S=/(^|\s)(\d \d)\(/g;for(let U of t.match(S)||[]){let P=/(^|\s)(\d \d)\(/,[E,R]=U.match(P).slice(1);t=t.replace(U,`${E}${R.split(" ").join("-")}(`),e.push("spacedTiebreakPattern")}return{score:t,applied:e}}function p6e({score:t,matchUpStatus:e}){var i;let n=t==null?void 0:t.split(" ");t=n.map(l=>{if(l.endsWith("]")){let c=l.split("[");if(TT(c[0]))return c[0]+`(${c[1].slice(0,c[1].length-1)})`}return l}).join(" ");let r=new RegExp(/(\([\d ]+\))/g);if(r.test(t))for(let l of t.match(r)){let c=(i=l.replace(" ","-").match(/\((.*)\)/))==null?void 0:i[1];if(Er(c)&&(c==null?void 0:c[0])>2){if([2,4].includes(c.length))c=c.split("").join("-");else if(c.length===3){let u=c.indexOf("1");c=nk(c.split(""),u)}}t=t.replace(l,`(${c})`)}n=t==null?void 0:t.split(" ");let a=new RegExp(/^(\d[-/]+\d)\((\d+)[-/]+(\d+)\)$/),s=n.length-1;t=n.map((l,c)=>{let u=[void 0,"","COMPLETED"].includes(e)||c!==s;if(a.test(l)&&u){let[d,p,h]=Array.from(l.match(a)).slice(1),f=Math.min(p,h);return`${d}(${f})`}return l}).join(" "),n=t==null?void 0:t.split(" "),a=new RegExp(/^(\d{2})\((\d+)\)$/),t=n.map(l=>{if(a.test(l)){let[c,u]=Array.from(l.match(a)).slice(1),d=c.split("");return`${d[0]}-${d[1]}(${u})`}return l}).join(" "),n=t==null?void 0:t.split(" "),a=new RegExp(/^\((\d[-/]+\d)\)(\d+)$/),t=n.map(l=>{if(a.test(l)){let[c,u]=Array.from(l.match(a)).slice(1);return TT(c)?`${c}(${u})`:c}return l}).join(" "),n=t==null?void 0:t.split(" "),a=new RegExp(/^1-0\((\d+)\)$/),t=n.map(l=>{if(a.test(l)){let[c]=l.match(a).slice(1);return`[${c<9?10:parseInt(c)+2}-${c}]`}return l}).join(" ");let o=/\((\d)+0 /;if(o.test(t)){let l=t.match(o)[1];t=t.replace(o,`(${l}) `)}return{score:t}}function h6e({score:t,attributes:e,identifier:i}){var n,r,a;if(typeof t!="string")return{score:t,identifier:i};let s=new RegExp(/\([\d,/ ]+\)/g),o=t.match(s);for(let h of o||[]){let f=(r=(n=h.match(/^\((.*)\)$/))==null?void 0:n.slice(1))==null?void 0:r[0],m=t.split(h)[0].split(")").reverse()[0].replace(/\D/g,"");if((f==null?void 0:f.length)===2&&(m==null?void 0:m.length)>=2){let y=m.slice(m.length-2).split("").map(b=>parseInt(b));if(Math.abs(y[0]-y[1])===1)continue}let g=vJ(f),v=$F(g);t=t.replace(h,`(${v})`).trim()}let l=new RegExp(/\[[\d,/ ]+\]/g);(a=t.match(l))==null||a.forEach(h=>{let f=vJ(h.match(/^\[(.*)\]$/)[1]);t=t.replace(h,`(${f}) `).trim()});let c=[")","]"],u=[")(","), (",") (",")[",") [","](","] ("];if(t.startsWith("(")&&c.some(h=>t.endsWith(h))&&u.some(h=>t.includes(h))){let h="",f=t.split(/[)\]]/).filter(Boolean).map(b=>(b.startsWith(",")&&(b=b.slice(1)),b.trim())),m=f.every(b=>b.includes(",")||pA(b)),g=f.every(b=>b.includes("/")||pA(b)),v=f.every(b=>b.includes("-")||pA(b)),y=m&&","||v&&"-"||g&&"/";if(y){let b;f.forEach(I=>{if(I.startsWith("("))if(b==="set"&&(h+=" "),I.includes(y))h+=I.slice(1).split(y).map(T=>T.trim()).join("-"),b="set";else{let T=I.slice(1);h+=`(${T}) `,b="tiebreak"}else if(I.startsWith("[")){let T=I.slice(1).split(y).map(S=>parseInt(S.trim())),w=Math.min(...T);b==="set"?h+=`(${w}) `:h+=`[${T.join("-")}] `,b="tiebreak"}}),t=h.trim()}}let d=Ol(t.split(""));d["("]===1&&d[")"]===1&&t.startsWith("(")&&t.endsWith(")")&&(t=t.slice(1,t.length-1),d["-"]===1&&TT(t)&&Er(e==null?void 0:e.removed)&&(t=t+`(${e.removed})`,e.removed=void 0));let p=/\(\)/g;return p.test(t)&&(t=t.replace(p,"").trim()),{score:t}}function s0e({score:t}){let e=t.split(""),i=[],n,r=()=>n=[void 0,void 0,void 0],a=()=>{let o=`${n[0]}-${n[1]}`;return n[2]&&(o+=` (${n[2]})`),r(),n.push(n),o};r();let s=()=>n[0]!==void 0&&n[1]!==void 0&&Math.abs(parseInt(n[0])-parseInt(n[1]));for(;e.length;){let o=e.shift(),l=Er(o)&&parseInt(o),c=n[0]!==void 0&&n[1]!==void 0;if(Er(l)){if(n[0]===void 0){n[0]=l;continue}if(n[1]===void 0&&(n[1]=l,s())){i.push(a()),n=[void 0,void 0];continue}if(c&&e.length===1&&Er(e[0])){let u=e.pop();n[0]=n[0].toString()+n[1].toString(),n[1]=u,i.push(a()),n=[void 0,void 0]}c&&s()}}return{sets:i}}function IG(t){let e=t.indexOf("1"),i=t.split(""),n=i.every(r=>!isNaN(r));if(n&&t.length===3&&e===0){let r=nk(i,e);if(r)return r}if(n&&t.length===7&&e>3){let r=i.slice(4),a=nk(r,e-4);if(a)return`${i[0]}-${i[1]} ${i[2]}-${i[3]} ${a}`}}function o0e(t){let{score:e}=t,{applied:i,matchUpStatus:n}=t,r=e==null?void 0:e.toString().split(""),a=r==null?void 0:r.every(o=>Er(o)),s=o=>Math.abs(o[0]-o[1]);if(typeof e=="number"||a){e=e.toString().toLowerCase(),a&&(e=r.join(""));let o=a?r.map(l=>parseInt(l)):e.split("").map(l=>parseInt(l));if(s0e({score:e}),o.length,e.length===3&&s(o.slice(0,2))===1){let[l,c,u]=o;e=`${l}-${c}(${u})`,i.push("numericTiebreakPattern1")}else if(e.length===3&&o[0]===1){let[l,c,u]=o;e=`[${l}${c}-${u}]`,i.push("numericTiebreakPattern2")}else if(e.length===4&&s(o.slice(0,2))===1&&"987654".split("").includes(o[0].toString())){let[l,c,u,d]=o,p=Math.min(u,d);e=`${l}-${c}(${p})`,i.push("numericTiebreakPattern3")}else if(e.length===4&&o[0]===1&&o[2]===1){let[l,c,u,d]=o;e=`[${l}${c}-${u}${d}]`,i.push("bigSuper")}else if(e.length===4){let[l,c,u,d]=o;e=`${l}${c} ${u}${d}`,i.push("split4")}else if(e.length===5&&s(o.slice(0,2))===1){let[l,c,u,d,p]=o;e=`${l}-${c}(${u}) ${d}-${p}`,i.push("numericTiebreakPattern4")}else if(e.length===5&&s(o.slice(3))===1){let[l,c,u,d,p]=o;e=`${l}-${c} ${u}-${d}(${p})`,i.push("numericTiebreakPattern5")}else if(o.length===7)if(s(o.slice(0,2))>1&&s(o.slice(2,4))>1&&o[4]===1){let[l,c,u,d,p,h,f]=o;e=`${l}-${c} ${u}-${d} [${p}${h}-${f}]`,i.push("numericTiebreakPattern6")}else if(s(o.slice(0,2))===1&&s(o.slice(3,5))>1&&s(o.slice(5,7))>1){let[l,c,u,d,p,h,f]=o;e=`${l}-${c}(${u}) ${d}-${p} ${h}-${f}`,i.push("numericTiebreakPattern7")}else if(s(o.slice(0,2))>1&&s(o.slice(2,4))===1&&s(o.slice(5,7))>1){let[l,c,u,d,p,h,f]=o;e=`${l}-${c} ${u}-${d}(${p}) ${h}-${f}`,i.push("numericTiebreakPattern8")}else if(s(o.slice(0,2))>1&&s(o.slice(2,4))>1&&s(o.slice(4,6))===1){let[l,c,u,d,p,h,f]=o;e=`${l}-${c} ${u}-${d} ${p}-${h}(${f})`,i.push("numericTiebreakPattern9")}else e=e.slice(0,2)+" "+e.slice(2,4)+" "+e.slice(4),i.push("numericMatchTiebreakPattern");else if(e.length%2){let l=IG(e);l&&e!==l&&i.push("parsedSuperPattern"),e=l??e}else{let l=Na(e.split(""),2).map(g=>g.join("")),c=l.map(g=>{let[v,y]=g.split("").map(T=>parseInt(T)),b=Math.abs(v-y),I=v>y?1:2;return b>1&&I||I*-1}),u=c.reduce((g,v)=>g>0&&v>0,1),d=Ol(c),p=c.map(g=>Math.abs(g)),h=Ol(p),f=c[0]<0,m=!f&&c[1]<0;if(c[0]>0&&c[1]>0&&c[0]!==c[1])e=[l.slice(0,2).join(" "),l.slice(2).join("-")].join(" "),i.push("numeric3rdSetTiebreakPattern");else if(u)e=l.join(" "),i.push("chunkSplit");else if(o.length===6){if(d[1]===2||d[2]===2)if(!Object.values(h).includes(3))e=l.join(" "),i.push("chunkSplit");else{let[g,v,y,b,I,T]=o,w=c.reduce((S,U,P)=>U<0?P:S,void 0);if(w===0){let S=Math.min(y,b);e=`${g}-${v}(${S}) ${I}-${T}`,i.push("chunkSplitTiebreak1")}else if(w===1){let S=Math.min(I,T);e=`${g}-${v} ${y}-${b}(${S})`,i.push("chunkSplitTiebreak2")}else e=`${g}-${v} ${y}-${b}`,i.push("chunkSplitTrimExtraneous")}}else if(o.length===8){let[g,v,y,b,I,T,w,S]=o;f||m?o[5]===1&&(f?e=`${g}-${v}(${y}) ${b}-${I} [${T}${w}-${S}]`:e=`${g}-${v} ${y}-${b}(${I}) [${T}${w}-${S}]`):(c[0],c[1])}}}return{score:e,applied:i,matchUpStatus:n}}function l0e(t){let e=[0,0],i=[],n=t.split(" "),r=/(\d+)-(\d+)/;n.forEach(l=>{if(r.test(l)){let c=l.match(r).slice(1).map(d=>parseInt(d)),u=c[0]>c[1]&&1||c[1]>c[0]&&2;u&&(e[u-1]+=1,i.push(u))}});let a=e[0]>e[1]&&1||e[1]>e[0]&&2,s=e[0]>0&&e[0]===e[1],o=e.reduce((l,c)=>l+c,0);return{setsWon:e,setsTied:s,setWinners:i,totalSets:o,winningSide:a}}function f6e({score:t,matchUpStatus:e,attributes:i}){let n=[],r,a=t.split(" "),s=a.length;t=a.map((u,d)=>{if(new RegExp(eP).test(u)){let h=u.slice(3),f=u.slice(0,3),m=f.split("-");if(!TT(f)&&!e){let g=Math.max(...m),v=f.indexOf(g),y=[g,g-1];return v&&y.reverse(),y.join("-")+h}}else if(u.length===2&&Er(u))return u.split("").join("-");u=$F(u);let p=new RegExp(`^${y7}$`).test(u)&&"super"||new RegExp(`^${eP}$`).test(u)&&"tiebreak"||new RegExp(`^${FF}$`).test(u)&&"standard"||"unknown";if(n.push(p),s>1&&p==="standard"&&d<2){let[h,f]=u.split("-"),m=Math.abs(parseInt(h)-parseInt(f)),g=Math.max(h,f),v=Math.min(h,f),y=[parseInt(h),parseInt(f)].indexOf(v);if(g>9&&m>2){let b=g.toString().split(""),I=b.find(T=>parseInt(T)>v||d&&parseInt(T)<=r)??b[0];I&&(u=y?[I,v].join("-"):[v,I].join("-"))}g>(r||0)&&(r=g)}if(p==="standard"){let[h,f]=u.split("-");if(!Math.abs(parseInt(h)-parseInt(f))&&e!=="RETIRED")return""}return u}).filter(Boolean).join(" ");let{setsWon:o,setWinners:l,totalSets:c}=l0e(t);if(c===1&&(i==null?void 0:i.removed)==="6"&&(t+=" 6-0"),t.split(" ").length>2&&Math.max(...o)>=2&&l[0]===l[1]&&(t=t.split(" ").slice(0,2).join(" ")),Math.max(...o)>2){let u=[0,0];t=t.split(" ").map((d,p)=>(u[l[p]]+=1,Math.max(...u)>2?void 0:d)).filter(Boolean).join(" ")}return{score:t,profile:n}}function m6e({score:t}){let{setsTied:e,winningSide:i}=l0e(t),n=/\s\((\d+)\)$/;if(!i&&e&&n.test(t)){let o=t.match(n).slice(1)[0],l=o<=8?10:o+2;t=t.replace(n,` [${l}-${o}]`)}let r=t.split(" "),a=r[r.length-1];if(!a.includes("-")||a.indexOf("(")>0)return{score:t};let s=a.split("(").join("").split(")").join("").split("-");if(!s.every(o=>Er(o)))return{score:t};if(s[0]==="76"){let o=s[1].length===2?Math.min(...s[1].split("").map(l=>parseInt(l))):s[1];t=[...r.slice(0,r.length-1),`7-6(${o})`].join(" ")}else{s=s.map(c=>parseInt(c));let o=Math.max(...s),l=Math.abs(s[0]-s[1]);if(o>=10){if(l>2&&s.every(c=>+c>=10)){let c=s.map(u=>u===o?u-10:10).sort();l=Math.abs(c[0]-c[1]),l>2&&(s=c)}t=[...r.slice(0,r.length-1),`[${s.join("-")}]`].join(" ")}else r.length===3&&o>=7&&l>2&&(t=[...r.slice(0,r.length-1),`[${s.join("-")}]`].join(" "))}return{score:t}}function g6e({score:t}){return t=(t==null?void 0:t.toString().toLowerCase())||"",{score:t}}function v6e({score:t,applied:e}){return typeof t!="string"?{score:t}:(t.toLowerCase().includes("o")&&(t=t.toLowerCase().split(" ").map(i=>i.split("o").join("0")).join(" "),e.push("replaceOh")),{score:t,applied:e})}function y6e({score:t,applied:e}){return typeof t!="string"?{score:t}:(t=t.toLowerCase().split(" ").map(i=>{if(/^\d+$/.test(i)&&i.length>2){let n=i.indexOf("1");if(i.length%2){if(i.length===3&&n===0){let r=nk(i.split(""),n);return e.push("getSuper"),r}}else{let{score:r,applied:a}=o0e({score:i,applied:[]});r!==i&&(i=r,e.push(...a))}}return i}).join(" "),{score:t,applied:e})}function b6e({score:t,applied:e}){return typeof t!="string"?{score:t}:[3,4].includes(t.length)&&IG(t)?{score:IG(t)}:(t=t.toLowerCase().split(" ").map(i=>{if(/^\d+$/.test(i)&&i.length===1){e.push("removeErroneous1");return}return i}).filter(Boolean).join(" "),{score:t,applied:e})}function I6e({score:t,applied:e}){return["walkover","wo","w/o","w-o"].includes(t==null?void 0:t.toString().toLowerCase())?(e.push("handleWalkover"),{matchUpStatus:"walkover",score:"",applied:e}):{score:t}}function w6e({score:t,profile:e,applied:i}){var n;t=t==null?void 0:t.toString().toLowerCase();let r=/^(.*\d+.*)(ret|con)+[A-Za-z ]*$/;if(r.test(t)){let[o]=t.match(r).slice(1);return i.push("handleRetired"),{score:o.trim(),matchUpStatus:"retired",applied:i}}let a=(n=e==null?void 0:e.matchUpStatuses)==null?void 0:n.retired,s=["rtd",...Array.isArray(a)?a:[a].filter(Boolean)].find(o=>t==null?void 0:t.endsWith(o));return s?(i.push("handleRetired"),{matchUpStatus:"retired",score:t==null?void 0:t.replace(s,"").trim(),applied:i}):{score:t}}function S6e({score:t,attributes:e}){(t.endsWith(" am")||t.endsWith(" pm"))&&(t=""),t=t.replace(/[A-Za-z]+/g,"").trim(),[".",","].some(r=>t.endsWith(r))&&(t=t.slice(0,t.length-1));let i="()/-".split("").some(r=>t.includes(r));/ \d$/.test(t)&&i&&(e={removed:t.slice(t.length-2).trim()},t=t.slice(0,t.length-2));let n=/(.*)[A-Za-z]+$/;return n.test(t)&&(t=t.match(n).slice(1)[0].trim()),{score:t,attributes:e}}function T6e({score:t}){return new RegExp(/-\d+\/\d+-/).test(t)&&(t=t.split("/").join(" ")),{score:t}}function U6e({score:t}){let e=new RegExp(/^\d+\/\d+/),i=t.split(" ");i.some(r=>e.test(r))&&(t=i.map(r=>e.test(r)?r.replace("/","-"):r).join(" "));let n=/^(\d+), *(\d+)$/;if(n.test(t)){let[r,a]=t.match(n).slice(1);t=[r,a].join("-")}return{score:t}}function D6e({score:t}){let e=new RegExp(/\(\d+\/\d+\)/g),i=t.match(e);for(let n of i||[]){let r=n.replace("/","-");t=t.replace(n,r)}return{score:t}}function E6e({score:t}){if(t.includes(",")){let e=t.split(",").map(n=>n.trim()),i=n=>/\d \d/.test(n);e.every(i)&&(t=e.map(n=>{let r=/\d+ \d+/g;for(let a of n.match(r)){let[s,o]=a.match(/(\d+) (\d+)/).slice(1);n=n.replace(a,`${s}-${o}`)}return n}).join(" "))}if(t.includes(" ")){let e=t.replace(/[ ,]/g,"");e.split("").every(i=>Er(i))&&e.length===4&&(t=e)}return{score:t}}function P6e({score:t}){let e=new RegExp(/^\[\d+\](.*)$/);e.test(t)&&(t=t.match(e).slice(1)[0].trim());let i=/\(,/g;return i.test(t)&&(t=t.replace(i,"(")),{score:t}}var C6e={handleTiebreakSlashSeparation:D6e,handleSetSlashSeparation:T6e,punctuationAdjustments:l6e,handleGameSeparation:U6e,joinFloatingTiebreak:u6e,handleBracketSpacing:c6e,handleSpaceSeparator:E6e,separateScoreBlocks:y6e,matchKnownPatterns:d6e,removeDanglingBits:S6e,removeErroneous:b6e,handleWalkover:I6e,properTiebreak:p6e,handleNumeric:o0e,handleRetired:w6e,containedSets:h6e,sensibleSets:f6e,stringScore:g6e,superSquare:m6e,setBuilder:s0e,excisions:P6e,replaceOh:v6e},X$={},R6e=["handleNumeric","handleWalkover","handleRetired","replaceOh","stringScore","punctuationAdjustments","excisions","handleSpaceSeparator","matchKnownPatterns","removeDanglingBits","handleBracketSpacing","matchKnownPatterns","containedSets","separateScoreBlocks","handleGameSeparation","removeErroneous","joinFloatingTiebreak","handleSetSlashSeparation","handleTiebreakSlashSeparation","properTiebreak","sensibleSets","superSquare"],M6e=["handleNumeric","separateScoreBlocks","sensibleSets","superSquare"];function c0e(t){if(!t.score)return{error:Ae};let{score:e,sheetName:i,identifier:n,fileName:r,stepLog:a,fullLog:s,profile:o}=t,l=[],c,u=[],d,p,h=e,f=g=>{g.forEach(v=>{p=C6e[v]({profile:o,identifier:n,matchUpStatus:c,attributes:d,applied:u,score:h});let y=p.score!==h;y&&l.push({method:v,score:p.score}),a&&(s||y||p.matchUpStatus!==c)&&console.log(c?{score:p.score,matchUpStatus:c}:{score:p.score},v),p.matchUpStatus&&(c=p.matchUpStatus),p.attributes&&(d=p.attributes),p.applied&&(u=p.applied),h=p.score})};f(R6e);let m=gJ(h);return m||(h=e.toString().replace(/\D/g,""),d!=null&&d.removed&&(d.removed=void 0),f(M6e),m=gJ(h),m||(h="")),u.forEach(g=>{X$[g]||(X$[g]=0),X$[g]+=1}),{matchUpStatus:c==null?void 0:c.toUpperCase(),modifications:l,attributes:d,isValid:m,score:h}}var u0e={};Fi(u0e,{analyzeScore:()=>b7,analyzeSet:()=>tP,checkScoreHasValue:()=>ya,checkSetIsComplete:()=>OF,getSetComplement:()=>w7,getTiebreakComplement:()=>BF,isValidMatchUpFormat:()=>Ll,parseScoreString:()=>rk,validateScore:()=>I7,validateTieFormat:()=>Go});function b7({existingMatchUpStatus:t,matchUpFormat:e,matchUpStatus:i,winningSide:n,score:r}){var a,s;let o=(r==null?void 0:r.sets)??[],l=((o==null?void 0:o.filter(S=>S==null?void 0:S.winningSide))||[]).reduce((S,U)=>{let{winningSide:P}=U;if(!P)return S;let E=P-1;return S[E]++,S},[0,0]),c=n?n-1:void 0,u=c!==void 0?1-c:void 0,d=c!==void 0&&l[c],p=u!==void 0&&l[u],h=e?Do(e):void 0,f=Math.max(...l),m=Ol(l)[f],g=((a=h==null?void 0:h.setFormat)==null?void 0:a.timed)||((s=h==null?void 0:h.finalSetFormat)==null?void 0:s.timed),v=h==null?void 0:h.bestOf,y=v&&Math.ceil(v/2)||1,b=i??t,I=b&&[Ki,ss,un].includes(b),T=!h||!o.length||o.every((S,U)=>{let P=U+1,E=P===v,R=P===o.length,{side1Score:C,side2Score:M,side1TiebreakScore:_,side2TiebreakScore:A,winningSide:N}=S,k=Math.max(C??0,M??0),O=_??A,{finalSetFormat:$,setFormat:F}=h,V=E&&$||F;if(O){let{tiebreakTo:j,NoAD:B}=(V==null?void 0:V.tiebreakFormat)||{},z=Math.max(_??0,A??0);if(B&&z>j||z<j&&N&&(R&&!I||!R))return!1}return V.setTo?!(!V.noTiebreak&&k>V.setTo+1):!0}),w=(!e||f===y)&&m===1&&l.indexOf(f)+1||void 0;return{valid:!!(T&&(n&&d>p&&n===w||n&&I||!n&&!w&&(![$r,Ki,ss,un].includes(b)||g&&b===$r)))}}function I7({existingMatchUpStatus:t,matchUpFormat:e,matchUpStatus:i,winningSide:n,score:r}){if(typeof r!="object")return{error:Ae};let{sets:a,scoreStringSide1:s,scoreStringSide2:o}=r,l="scoreString must be a string!";if(s!==void 0&&typeof s!="string")return{error:Ae,info:l};if(o!==void 0&&typeof o!="string")return{error:Ae,info:l};if(a!==void 0&&!Array.isArray(a))return{error:Ae,info:Sy("sets")};if(a!=null&&a.length){let c=a.map(d=>d==null?void 0:d.setNumber).filter(Boolean);if(c.length!==Pi(c).length)return{error:Ae,info:"setNumbers not unique"};for(let d of a){let{side1Score:p,side2Score:h,side1TiebreakScore:f,side2TiebreakScore:m,side1PointScore:g,side2PointScore:v,winningSide:y,setNumber:b}=d;if(![[p,h],[f,m],[g,v]].filter(I=>I.some(T=>![void 0,null].includes(T))).every(I=>I.every(T=>wi(T))))return{error:Ae,info:"non-numeric values"};if(![b,y].filter(I=>![void 0,null].includes(I)).every(I=>wi(I)))return{error:Ae,info:"non-numeric values"};if(y&&![1,2].includes(y))return{error:Ae,info:"winningSide must be 1 or 2"}}let{valid:u}=b7({existingMatchUpStatus:t,matchUpStatus:i,matchUpFormat:e,winningSide:n,score:r});if(!u)return{error:Uge,info:"score is invalid for matchUpFormat or winningSide does not match calculated winningSide"}}return{valid:!0}}var w7=t=>{let{isSide1:e,lowValue:i,setTo:n,tiebreakAt:r,NoAD:a}=t;if(i===void 0)return!1;let s=di(i);(s==null?void 0:s.toString().length)>2&&(s=parseInt(s.toString().slice(0,2))),r&&r<n&&s>r&&(s=r);let o;return a&&!r?(s>n&&(o=n),o=s<n?n:n-1):o=s+1<n&&n||r&&r<n&&s===r&&n||!r&&s+2||n+1,[e?s:o,e?o:s]},BF=t=>{let{isSide1:e,lowValue:i,tiebreakTo:n,tiebreakNoAd:r}=t;if(i===void 0)return!1;let a=typeof i=="string"?parseInt(i):i;(a==null?void 0:a.toString().length)>2&&(a=parseInt(a.toString().slice(0,2))),r&&a>n-1&&(a=n-1);let s=N6e({lowValue:a,NoAD:r,tiebreakTo:n});return[e?a:s,e?s:a]};function N6e(t){let{lowValue:e,NoAD:i,tiebreakTo:n}=t,r=i?1:2;return e+1>=n?e+r:n}function rk({tiebreakTo:t=7,scoreString:e=""}){return e==null?void 0:e.split(" ").filter(Boolean).map((n,r)=>i({set:n,setNumber:r+1}));function i({set:n,setNumber:r}){let a=/\(([^)]+)\)/,s=/\[([^)]+)\]/,o=a.exec(n),l=s.exec(n),c=(n==null?void 0:n.startsWith("["))&&l&&l[1].split("-").map(b=>parseInt(b)),u=o&&n.replace(o[0],"")||l&&n.replace(l[0],"")||n,d=!c&&u.split("-").map(b=>parseInt(b)),p=c?c[0]>c[1]&&1||c[0]<c[1]&&2||void 0:d[0]>d[1]&&1||d[0]<d[1]&&2||void 0,h=o?o[1]:void 0,f=(h&&BF({lowValue:h,isSide1:p===2,tiebreakTo:t}))??[],[m,g]=d||[],[v,y]=c||f||[];return{side1Score:m,side2Score:g,side1TiebreakScore:v,side2TiebreakScore:y,winningSide:p,setNumber:r}}}function A6e({matchUpScoringFormat:t,isDecidingSet:e,isTiebreakSet:i,isTimedSet:n,setObject:r}){if(!r)return;let a=LF({set:r});return OF({matchUpScoringFormat:t,set:r,isDecidingSet:e,isTiebreakSet:i,isTimedSet:n})&&a||void 0}function tP(t){let{setObject:e,matchUpScoringFormat:i}=t;if(!e)return{error:UL};let{setNumber:n}=e||{},{bestOf:r,exactly:a}=i||{},s=r||a,o=!!(n&&s&&n===s),l=o&&(i==null?void 0:i.finalSetFormat)||(i==null?void 0:i.setFormat),c=!!(l!=null&&l.tiebreakSet),u=!!(l!=null&&l.timed),d=!c&&!u,p=!!(n&&s&&n<=s),h=[e==null?void 0:e.side1Score,e==null?void 0:e.side2Score],f=[e==null?void 0:e.side1PointScore,e==null?void 0:e.side2PointScore],m=[e==null?void 0:e.side1TiebreakScore,e==null?void 0:e.side2TiebreakScore],g=h.filter(O=>O!==void 0).length,v=f.filter(O=>O!==void 0).length,y=m.filter(O=>O!==void 0).length,b=h==null?void 0:h.filter(O=>!isNaN(O)).length,I=m==null?void 0:m.filter(O=>!isNaN(O)).length,{tiebreakAt:T}=l||{},w=T&&h.filter(O=>O>=T).length===2,S=w&&(h[0]>h[1]&&1||h[1]>h[0]&&2||void 0),U=!!(I&&!b),P=!!(e!=null&&e.winningSide),{error:E,result:R}=_6e({sideTiebreakScores:m,sideGameScores:h,setFormat:l,setObject:e}),{error:C,result:M}=k6e({sideTiebreakScores:m,setObject:e,setFormat:l}),_=d&&!U&&R||c&&U&&M||u,A=p&&!(c&&!U)&&!(d&&U)&&(!P||_),N=A6e({isTimedSet:u,matchUpScoringFormat:i,isDecidingSet:o,isTiebreakSet:U,setObject:e}),k={expectTiebreakSet:c,expectTimedSet:u,hasTiebreakCondition:w,isCompletedSet:P,isDecidingSet:o,isTiebreakSet:U,isValidSet:A,isValidSetNumber:p,isValidSetOutcome:_,leadingSide:S,setFormat:l,sideGameScores:h,sideGameScoresCount:g,sidePointScores:f,sidePointScoresCount:v,sideTiebreakScores:m,sideTiebreakScoresCount:y,winningSide:N};return(e==null?void 0:e.winningSide)!==void 0&&(U?(k.isValidTiebreakSetOutcome=M,M||(k.tiebreakSetError=C)):(k.isValidStandardSetOutcome=R,R||(k.standardSetError=E))),k}function _6e({setObject:t,setFormat:e,sideGameScores:i,sideTiebreakScores:n}){if(!t)return{result:!1,error:UL};let r=!!(e!=null&&e.tiebreakSet),a=!!(e!=null&&e.timed);if(!e||r||a)return{result:!1,error:Ae};if((i==null?void 0:i.filter(S=>!isNaN(S)).length)!==2)return{result:!1,error:Lj};let{setTo:s,tiebreakAt:o,tiebreakFormat:l,NoAD:c}=e||{};if(!(s&&i!=null&&i.find(S=>S>=s)))return{result:!1,error:Lj};let u=[1,2].includes(t==null?void 0:t.winningSide);if(!t||!u)return{result:!1,error:DL};let d=(t==null?void 0:t.winningSide)-1,p=1-d,h=i[d],f=i[p],m=h-f;if(!(h>f))return{result:!1,error:{message:"winningSide game scoreString is not high"}};let g=o&&l,v=(n==null?void 0:n.filter(S=>!isNaN(S)).length)===2,y=n==null?void 0:n[d],b=n==null?void 0:n[p],I=o&&i.filter(S=>S>=o).length===2;if(g){let{NoAD:S,tiebreakTo:U}=l;if(I){if(m>1)return{result:!1,error:{message:"invalid winning game scoreString (5)"}};if(!v)return{result:!1,error:{message:"invalid tiebreak scores (1)"}};if(isNaN(U))return{result:!1,error:{message:"tiebreakTo error"}};if(!(U&&n!=null&&n.find(M=>M>=U)))return{result:!1,error:{message:"invalid tiebreak scores (2)"}};let P=o<s?s:s+1;if(h>P)return{result:!1,error:{message:"invalid winning game scoreString (1)"}};if(!y||!b||y<b)return{result:!1,error:{message:"winningSide tiebreak value is not high"}};let E=S?1:2,R=y-b,C=b>=U-1;if(R&&C&&R<E)return{result:!1,error:{message:"invalid tiebreak scores (3)"}}}if(h>s&&!I)return{result:!1,error:{message:"invalid winning game scoreString (2)"}}}let T=c?1:2,w=f>=s-1;return m&&w&&!I&&m<T?{result:!1,error:{message:"invalid winning game scoreString (3)"}}:m>T&&h>s?{result:!1,error:{message:"invalid winning game scoreString (4)"}}:{result:!0}}function k6e({setObject:t,setFormat:e,sideTiebreakScores:i}){if(!t)return{result:!1,error:UL};let n=!!(e!=null&&e.tiebreakSet),r=!!(e!=null&&e.timed);if(!e||!n||r)return{result:!1,error:{message:"not tiebreak set"}};let a=[1,2].includes(t==null?void 0:t.winningSide);if(!t||!a)return{result:!1,error:DL};let{tiebreakSet:s}=e||{},{NoAD:o,tiebreakTo:l}=s||{};if((i==null?void 0:i.filter(g=>!isNaN(g)).length)!==2)return{result:!1,error:{message:"invalid tiebreak scores (1)"}};if(isNaN(l))return{result:!1,error:{message:"tiebreakTo error"}};if(!(i!=null&&i.find(g=>g>=l)))return{result:!1,error:{message:"invalid tiebreak scores (2)"}};let c=(t==null?void 0:t.winningSide)-1,u=1-c,d=i[c],p=i[u];if(!d||!p||d<p)return{result:!1,error:{message:"winningSide tiebreak value is not high"}};let h=o?1:2,f=d-p,m=p>=l-1;return f&&m&&f<h?{result:!1,error:{message:"invalid tiebreak scores (3)"}}:{result:!0}}function x6e(t){var e,i,n;let{existingDrawDefinition:r,hydrateCollections:a,enforceGender:s,tieFormatName:o,matchUpType:l,eventType:c,isMock:u,event:d}=t,{tieFormat:p,matchUpFormat:h}=t;if(l===aa&&c===aa){let f=(i=(e=r==null?void 0:r.structures)==null?void 0:e.find(({stage:m})=>m===Bt))==null?void 0:i.tieFormat;p=p||f||o&&((n=d==null?void 0:d.tieFormat)==null?void 0:n.tieFormatName)===o&&d.tieFormat||o&&em({namedFormat:o,hydrateCollections:a,isMock:u,event:d})||(d==null?void 0:d.tieFormat)||em({event:d,isMock:u,hydrateCollections:a}),h=void 0}else h||(p=void 0,d!=null&&d.matchUpFormat||(h=Fu));if(p){let f=Go({gender:d==null?void 0:d.gender,enforceGender:s,tieFormat:p});if(f.error)return f}return{tieFormat:p,matchUpFormat:h}}function O6e(t){var e,i,n,r,a;let s=t.drawDefinition,{existingQualifyingPlaceholderStructureId:o,appliedPolicies:l,drawEntries:c,structureId:u,idPrefix:d,isMock:p,event:h}=t,f=t.qualifyingProfiles,m=f!=null&&f.length?uwe({uuids:t.uuids,qualifyingProfiles:f,appliedPolicies:l,idPrefix:d,isMock:p}):void 0;if(m!=null&&m.error)return m;s.structures=(e=s.structures)==null?void 0:e.filter(({structureId:U})=>U!==o),s.links=(i=s.links)==null?void 0:i.filter(({source:U})=>U.structureId!==o);let{qualifiersCount:g,qualifyingDrawPositionsCount:v,qualifyingDetails:y}=m??{};v&&(m!=null&&m.structures&&((n=s.structures)==null||n.push(...m.structures)),m!=null&&m.links&&((r=s.links)==null||r.push(...m.links)));let b=(a=s.structures)==null?void 0:a.find(({stage:U,stageSequence:P})=>U===Bt&&P===1),{qualifiersCount:I}=YU({stageSequence:1,drawDefinition:s,structureId:u,stage:Bt}),T=Math.max(g??0,I??0),w=pIe({qualifiersCount:T,drawDefinition:s,stage:Bt});if(w.error||(w=J_({drawSize:v,stage:ri,drawDefinition:s}),w.error))return w;L6e({drawDefinition:s,drawEntries:c,event:h});let S=F6e({mainStructure:b,qualifyingDetails:y,drawDefinition:s});return S.error?S:{drawDefinition:s,structureId:u}}function L6e({drawDefinition:t,drawEntries:e,event:i}){for(let n of(e??[]).filter(({entryStage:r})=>r===ri)){let r={...n,entryStage:n.entryStage??Bt,drawDefinition:t,event:i};b8(r)}}function F6e({mainStructure:t,qualifyingDetails:e,drawDefinition:i}){var n;for(let r of e||[]){let{finalQualifyingRoundNumber:a,finalQualifyingStructureId:s,roundTarget:o,finishingPositions:l,linkType:c}=r,u=t&&((n=HR({targetStructureId:t.structureId,sourceStructureId:s,sourceRoundNumber:a,finishingPositions:l,targetEntryRound:o,linkType:c}))==null?void 0:n.link);if(u!=null&&u.error)return u;u&&(i.links||(i.links=[]),i.links.push(u))}return{error:void 0}}function d0e(t){var e,i;let{participantIds:n}=t,r=((i=(e=t.drawDefinition)==null?void 0:e.entries)==null?void 0:i.filter(a=>{let s=a.entryStatus;return!t.restrictEntryStatus||sd.includes(s)}).map(Gi))??[];if(n){let a=n.filter(s=>!(r!=null&&r.includes(s)));if(a!=null&&a.length)return fe({result:{error:xd},info:{invalidParticipantIds:a}})}else n=r;return t.roundsCount&&t.restrictRoundsCount!==!1&&t.roundsCount>n.length-1&&(!t.enableDoubleRobin||t.roundsCount>(n.length-1)*2)?{error:Ae,info:"Not enough participants for roundsCount"}:t.roundsCount&&t.restrictRoundsCount!==!1&&t.roundsCount>31?{error:Ae,info:"roundsCount must be less than 32"}:{participantIds:n}}function S7(t){var e;let i=[],{roundsCount:n=1,drawDefinition:r,matchUpsCount:a,structureId:s,idPrefix:o,isMock:l,event:c}=t,u,d=d0e(t);if(d.error)return d;for(let p of Mt(1,n+1)){let h=_F({restrictMatchUpsCount:t.restrictMatchUpsCount,ignoreLastRoundNumber:!!u,newRound:!u,drawDefinition:r,matchUpsCount:a,structureId:s,roundNumber:u,idPrefix:o,isMock:l,event:c});if(h.error)return fe({result:h,info:{iteration:p}});(e=h.matchUps)!=null&&e.length&&i.push(...h.matchUps),u=((h==null?void 0:h.roundNumber)??1)+1}return{matchUps:i}}function $6e(t){var e;let{tournamentRecord:i,participantIds:n,scaleName:r,eventType:a,adHocRatings:s={}}=t,o=t.scaleAccessor??((e=Ea[r])==null?void 0:e.accessor),l=i.participants??[];for(let c of n??[]){let u=l==null?void 0:l.find(p=>p.participantId===c),d=yJ({scaleName:`${r}.${N6}`,participant:u,eventType:a});!d&&r&&(d=yJ({scaleAccessor:o,participant:u,scaleName:r,eventType:a})),d&&!s[c]&&(s[c]=d)}return s}function yJ({scaleType:t=rg,scaleAccessor:e,participant:i,scaleName:n,eventType:r}){var a,s;let o=(s=(a=i&&Rh({scaleAttributes:{eventType:r??TI,scaleType:t,scaleName:n},participant:i}))==null?void 0:a.scaleItem)==null?void 0:s.scaleValue;return e&&tn(o)?o[e]:o}function T7(t){var e,i;let n=V6e(t);if(n!=null&&n.error)return n;let r=d0e(t);if(r.error)return r;let a=B6e(t);if(a.error)return a;let s=$6e(t),o=((e=t.tournamentRecord)==null?void 0:e.isMock)??t.isMock,l=t.eventType??((i=t.event)==null?void 0:i.eventType),c=[],u=[],d;for(let p of Mt(1,(t.roundsCount??1)+1)){let h=p7({...t,participantIds:r.participantIds,structure:a.structure,ignoreLastRoundNumber:!0,iterationMatchUps:c,adHocRatings:s,roundNumber:d,eventType:l,isMock:o});if(h.error)return h;let{matchUps:f,...m}=h;m.modifiedScaleValues&&(s=m.modifiedScaleValues),u.push({...m,iteration:p,matchUpsCount:f==null?void 0:f.length}),d=((m==null?void 0:m.roundNumber)??1)+1,f!=null&&f.length&&c.push(...f)}return{...pe,matchUps:c,roundResults:u}}function B6e(t){var e,i,n;if(t.structureId)return t.structureId;let r=t.drawDefinition,a=(i=(e=r==null?void 0:r.structures)==null?void 0:e.filter(o=>o.stageSequence===1))==null?void 0:i.reduce((o,l)=>{let c=l.stage&&UI[l.stage];return Ho({structure:l})&&c>(UI[o==null?void 0:o.stage]||1)?l:o},void 0),s=(n=r==null?void 0:r.structures)==null?void 0:n.find(o=>o.structureId===(a==null?void 0:a.structureId));return s?Ho({structure:s})?{structure:s}:{error:Yb}:{error:yr}}function V6e(t){var e;return t.roundsCount&&typeof t.roundsCount!="number"?{error:Ae,info:"roundsCount must be a number"}:typeof t.drawDefinition!="object"||t.drawDefinition.drawType&&t.drawDefinition.drawType!==lc?{error:Yb}:!Array.isArray((e=t.drawDefinition)==null?void 0:e.entries)&&t.participantIds&&!Array.isArray(t.participantIds)?{error:Ae,info:"Missing Entries"}:{error:void 0}}function j6e(t){var e,i;let{tournamentRecord:n,drawDefinition:r,structureId:a,idPrefix:s,isMock:o,event:l}=t,c=(e=l==null?void 0:l.entries)==null?void 0:e.filter(({entryStage:p,entryStatus:h})=>(!p||p===Bt)&&h&&sd.includes(h)),u=c==null?void 0:c.map(Gi),d=c?Math.floor(c.length/2):0;if(t.automated)return G6e({...t,participantIds:u});{let p=S7({roundsCount:t.roundsCount,drawDefinition:r,matchUpsCount:d,idPrefix:s,isMock:o,event:l});if(p.error)return p;(i=p.matchUps)!=null&&i.length&&RF({matchUps:p.matchUps,suppressNotifications:!0,tournamentRecord:n,drawDefinition:r,structureId:a,event:l})}return{...pe}}function G6e(t){var e,i;let{restrictEntryStatus:n,generateMatchUps:r,structureId:a,matchUpIds:s,scaleName:o,scaleAccessor:l}=t.drawMatic??{},c=T7({...t,eventType:((e=t.drawMatic)==null?void 0:e.eventType)??t.matchUpType,generateMatchUps:r??!0,scaleAccessor:l??t.scaleAccessor,scaleName:o??t.scaleName,participantIds:t.participantIds,roundsCount:t.roundsCount,restrictEntryStatus:n,structureId:a,matchUpIds:s});return c.error?c:((i=c==null?void 0:c.matchUps)!=null&&i.length&&RF({tournamentRecord:t.tournamentRecord,drawDefinition:t.drawDefinition,suppressNotifications:!0,matchUps:c.matchUps,event:t.event,structureId:a}),{...pe})}function H6e({requireParticipantCount:t=!0,enforcePolicyLimits:e=!0,drawSizeProgression:i,participantsCount:n,participantCount:r,appliedPolicies:a,drawDefinition:s,seedingProfile:o,structureId:l,seedsCount:c}){var u,d;n=n??r;let p=fi({drawDefinition:s,structureId:l});if(p.error)return p;let h=p.structure;if(!h)return{error:yr};let{positionAssignments:f}=Aa({structure:h}),m=(f==null?void 0:f.length)||0;if(c>m)return{error:tge};let g=(u=h.structures)==null?void 0:u.length,v=wi(o==null?void 0:o.groupSeedingThreshold)&&(o==null?void 0:o.groupSeedingThreshold),y=(d=C8({roundRobinGroupsCount:g,drawSize:m}))==null?void 0:d.seedGroups,{seedsCount:b}=eM({policyDefinitions:a,requireParticipantCount:t,drawSizeProgression:i,participantsCount:n,drawSize:m});return b&&a!=null&&a[Tu]&&c>b&&e&&(c=b),h.seedLimit=c,h.seedAssignments=Mt(1,c+1).map(I=>{let T=y==null?void 0:y.find(U=>U.includes(I)),w=T&&Math.min(...T),S=v&&I>=v?w:I;return{participantId:void 0,seedNumber:I,seedValue:S}}),zn({drawDefinition:s,structureIds:[l]}),{...pe,seedLimit:c}}function Bw({sortDescending:t=!1,tournamentRecord:e,scaleAttributes:i,scaleSortMethod:n,stageSequence:r,entries:a,event:s,stage:o}){if(!e)return{error:dt};return a=a??(s==null?void 0:s.entries)??[],{scaledEntries:a.filter(u=>(!o||!u.entryStage||u.entryStage===o)&&(!r||!u.entryStageSequence||u.entryStageSequence===r)&&sd.includes(u.entryStatus)).map(u=>{let{participantId:d}=u,{scaleItem:p}=ST({tournamentRecord:e,scaleAttributes:i,participantId:d});return{...u,...p}}).filter(u=>{let d=u.scaleValue;return!n&&(isNaN(d)||!parseFloat(d))?!1:d}).sort(n||l)};function l(u,d){return t?c(d)-c(u):c(u)-c(d)}function c(u){return parseFloat(u.scaleValue||(t?-1:1e5))}}function p0e(t){let e="prepareStage",{drawDefinition:i}=t,{structures:n}=Ju({stageSequence:t.stageSequence||1,roundTarget:t.roundTarget,stage:t.stage,drawDefinition:i}),r=t.preparedStructureIds||[],a=n==null?void 0:n.find(({structureId:h})=>!r.includes(h));if(!a)return fe({result:{error:yr},stack:e});let s=a==null?void 0:a.structureId,{seedsCount:o,stageEntries:l,seedLimit:c}=J6e({...t,structureId:s});(t.seededParticipants||t.event||t.seedingScaleName)&&W6e({...t,seedsCount:o,structure:a,structureId:s});let u=t.automated!==!1&&t.drawType!==lc&&!(t.qualifyingOnly&&t.stage!==ri),d=((n==null?void 0:n.length)||0)>1,p=u?q6e({...t,multipleStructures:d,seedLimit:c,structureId:s}):{};return p!=null&&p.error?fe({result:p,stack:e}):{...p,stageEntries:l,structureId:s,seedsCount:o}}function z6e({entries:t,stage:e,stageSequence:i,roundTarget:n}){return t.filter(r=>{var a,s;let o=(s=(a=xi({name:Yp,element:r}))==null?void 0:a.extension)==null?void 0:s.value;return(!r.entryStage||r.entryStage===e)&&(!i||!r.entryStageSequence||r.entryStageSequence===i)&&(!n||!o||o===n)&&ib.includes(r.entryStatus)})}function q6e(t){let e=typeof t.automated=="object"&&t.automated.seedsOnly,i=GR({...t,seedsOnly:e});if(i.error)return i;let n=i==null?void 0:i.positionAssignments,r=i==null?void 0:i.positioningReport;return{conflicts:i.conflicts,positionAssignments:n,positioningReport:r}}function W6e(t){let{seededParticipants:e,seedingScaleName:i,entries:n,event:r}=t,a=n.map(Gi);e?Y6e({...t,enteredParticipantIds:a}):(r||i)&&K6e({...t,enteredParticipantIds:a})}function Y6e(t){let{provisionalPositioning:e,enteredParticipantIds:i,seededParticipants:n,tournamentRecord:r,appliedPolicies:a,drawDefinition:s,seedingProfile:o,structureId:l,structure:c,event:u}=t,d=c?Lw({provisionalPositioning:e,appliedPolicies:a,drawDefinition:s,seedingProfile:o,structure:c}):void 0;n.filter(({participantId:p})=>i.includes(p)).filter(p=>!p.seedNumber||p.seedNumber<=n.length).sort((p,h)=>p.seedNumber<h.seedNumber?-1:p.seedNumber<h.seedNumber?1:0).forEach(p=>{let{participantId:h,seedNumber:f,seedValue:m}=p;ZU({provisionalPositioning:e,tournamentRecord:r,drawDefinition:s,seedingProfile:o,participantId:h,seedBlockInfo:d,structureId:l,seedNumber:f,seedValue:m,event:u})})}function K6e(t){let e=t.seedsCount,{provisionalPositioning:i,enteredParticipantIds:n,seedAssignmentProfile:r,assignSeedsCount:a,tournamentRecord:s,drawDefinition:o,seedByRanking:l,seedingProfile:c,structureId:u,event:d}=t,{categoryName:p,ageCategoryCode:h}=(d==null?void 0:d.category)||{},f=d==null?void 0:d.eventType,m=Z6e({...t,ageCategoryCode:h,categoryName:p,eventType:f})||l&&X6e({...t,ageCategoryCode:h,categoryName:p,eventType:f}),g=(m==null?void 0:m.length)??0;g<e&&(e=g),m==null||m.filter(({participantId:v})=>n.includes(v)).slice(0,a||e).forEach((v,y)=>{let b=y+1,{participantId:I,scaleValue:T}=v,w=(r==null?void 0:r[b])||T||b;ZU({provisionalPositioning:i,tournamentRecord:s,drawDefinition:o,seedingProfile:c,participantId:I,structureId:u,seedNumber:b,seedValue:w,event:d})})}function Z6e(t){let{tournamentRecord:e,seedingScaleName:i,stageSequence:n,entries:r,stage:a,event:s}=t,{categoryName:o,ageCategoryCode:l}=(s==null?void 0:s.category)||{},c=s==null?void 0:s.eventType,u={scaleName:i||o||l||s.eventId,scaleType:Ph,eventType:c};return Bw({scaleAttributes:u,tournamentRecord:e,stageSequence:n,entries:r,stage:a}).scaledEntries}function X6e(t){let{tournamentRecord:e,stageSequence:i,event:n,entries:r,stage:a}=t,{categoryName:s,ageCategoryCode:o}=(n==null?void 0:n.category)||{},l=n==null?void 0:n.eventType;return Bw({scaleAttributes:{scaleName:s||o,scaleType:bg,eventType:l},tournamentRecord:e,stageSequence:i,entries:r,stage:a}).scaledEntries}function J6e(t){let{seedsCount:e}=t;t.seededParticipants&&(e=t.seededParticipants.length),e>t.drawSize&&(e=t.drawSize);let i=z6e(t);e>i.length&&(e=i.length);let{seedLimit:n}=H6e({enforcePolicyLimits:t.enforcePolicyLimits??!0,appliedPolicies:t.appliedPolicies,participantsCount:i.length,seedingProfile:t.seedingProfile,drawDefinition:t.drawDefinition,structureId:t.structureId,seedsCount:e});return n&&n<e&&(e=n),{seedsCount:e,stageEntries:i,seedLimit:n}}function Q6e(t){var e;let i=u7({...t,modifyOriginal:!1});if(i.error)return i;let n=i.drawDefinition,{suppressDuplicateEntries:r=!0,ignoreStageSpace:a,appliedPolicies:s,qualifyingOnly:o,seedingProfile:l,participants:c,drawEntries:u,placeByes:d,drawSize:p,drawType:h,entries:f}=t,m=[],g=[],v=e8e({suppressDuplicateEntries:r,ignoreStageSpace:a,drawDefinition:n,drawEntries:u,drawType:h,entries:f});if(v.error)return v;let y=h===Zy?0:di(t.seedsCount??0),b=p0e({...t,qualifyingOnly:!p||o,appliedPolicies:s,drawDefinition:n,seedingProfile:l,participants:c,stage:Bt,seedsCount:y,placeByes:d,drawSize:p,entries:f});if(b.error&&!b.conflicts)return b;(e=b.positioningReport)!=null&&e.length&&m.push({[Bt]:b.positioningReport});let I=b.structureId;return b.conflicts&&(g=b.conflicts),h===lc&&t.roundsCount&&j6e({...t,drawDefinition:n,structureId:I}),{drawDefinition:n,positioningReports:m,conflicts:g,structureId:I}}function e8e(t){let{ignoreStageSpace:e,drawDefinition:i,drawEntries:n,drawType:r,entries:a}=t;for(let s of a){if(n&&s.entryStage&&s.entryStage!==Bt)continue;let o={...s,ignoreStageSpace:e??r===lc,entryStage:s.entryStage??Bt,event:t.event,drawDefinition:i,drawType:r},l=b8(o);if(n&&l.error)return l}return{error:void 0}}var t8e=()=>({matchUpType:void 0,drawName:void 0,drawId:void 0,structures:[],entries:[],links:[]}),i8e=t8e;function n8e(t){let{drawId:e=bn(),processCodes:i,matchUpType:n,drawType:r}=t??{},a=i8e();return Object.assign(a,{processCodes:i,matchUpType:n,drawType:r,drawId:e})}function U7(t){let e=t.structureIds,{tournamentRecord:i,drawDefinition:n,matchUpFormat:r,structureId:a,matchUpId:s,event:o}=t,l=ei(t,[{[Po]:!0,[D6]:!0}]);if(l.error)return l;if(!Ll({matchUpFormat:r}))return{error:aR};let c="setMatchUpFormat";if(s){let u=or({drawDefinition:n,matchUpId:s,event:o});if(u.error)return u;let d=u.matchUp;if((d==null?void 0:d.matchUpType)===aa)return{info:"Cannot set matchUpFormat when { matchUpType: TEAM }",error:cl};d&&(d.matchUpFormat=r,Qi({tournamentId:i==null?void 0:i.tournamentId,eventId:o==null?void 0:o.eventId,context:c,drawDefinition:n,matchUp:d}))}else if(Array.isArray(e)){if((o==null?void 0:o.eventType)===aa)return{error:jh};for(let u of e){let d=fi({drawDefinition:n,structureId:u});if(d.error)return d;d.structure&&(d.structure.matchUpFormat=r)}}else if(a){if((o==null?void 0:o.eventType)===aa)return{error:jh};let u=fi({drawDefinition:n,structureId:a});if(u.error)return u;u.structure&&(u.structure.matchUpFormat=r)}else n&&(n.matchUpFormat=r);return e=e??(a?[a]:void 0),zn({drawDefinition:n,structureIds:e}),{...pe}}function r8e({tieFormat:t}){let e=Go({checkCollectionIds:!1,tieFormat:t});if(e.error)return e;for(let i of t.collectionDefinitions)i.collectionId||(i.collectionId=bn());return{tieFormat:t}}function a8e({tournamentRecord:t,drawDefinition:e,matchUpFormat:i,matchUpType:n,tieFormat:r,event:a}){if((i||r)&&!(i&&(a==null?void 0:a.matchUpFormat)===i||a!=null&&a.tieFormat&&r&&JSON.stringify(a.tieFormat)===JSON.stringify(r))){if(r){let s=r8e({tieFormat:r});if(s.error)return s;e.tieFormat=s.tieFormat??r}else if(i){let s=U7({tournamentRecord:t,drawDefinition:e,matchUpFormat:i,event:a});if(s.error)return{info:"matchUpFormat or tieFormat error",error:s.error}}n&&(e.matchUpType=n)}return{error:void 0}}var h0e={};Fi(h0e,{attachPolicies:()=>Ty,findPolicy:()=>eb,getAppliedPolicies:()=>fn,getPolicyDefinitions:()=>Rm,mutate:()=>f0e,query:()=>g0e,removePolicy:()=>m0e});var f0e={};Fi(f0e,{attachPolicies:()=>Ty,removePolicy:()=>m0e});function m0e(t){let e=ei(t,[{[uqe]:!0,_anyOf:{[Os]:!1,[Ia]:!1,[Po]:!1,[Zg]:!1}}]);if(e.error)return e;let i,n=t.drawDefinition??t.event??((t.tournamentId||!t.tournamentRecords)&&t.tournamentRecord);if(n)return bJ(t,n);if(t.tournamentRecords){let r=Object.keys(t.tournamentRecords);if(!r.length)return{error:dt};for(let a of r){let s=t.tournamentRecords[a],o=bJ(t,s);if(o.error)return o;i=!0}}else return{error:dt};return i?{...pe}:{error:aT}}function bJ(t,e){let i=fn(t).appliedPolicies??{};return i[t.policyType]?(delete i[t.policyType],Object.keys(i).length?pn({element:e,extension:{name:qE,value:i}}):uo({element:e,name:qE}),{...pe}):{error:aT}}var g0e={};Fi(g0e,{findPolicy:()=>eb,getAppliedPolicies:()=>fn,getPolicyDefinitions:()=>Rm});var v0e={[Tu]:{validSeedPositions:{ignore:!0},duplicateSeedNumbers:!0,drawSizeProgression:!0,seedingProfile:{drawTypes:{[zh]:{positioning:fy},[Zu]:{positioning:fy}},positioning:eqe},policyName:"USTA SEEDING",seedsCountThresholds:[{drawSize:4,minimumParticipantCount:3,seedsCount:2},{drawSize:16,minimumParticipantCount:12,seedsCount:4},{drawSize:32,minimumParticipantCount:24,seedsCount:8},{drawSize:64,minimumParticipantCount:48,seedsCount:16},{drawSize:128,minimumParticipantCount:96,seedsCount:32},{drawSize:256,minimumParticipantCount:192,seedsCount:64}]}},wG=v0e;function s8e({appliedPolicies:t,policyDefinitions:e,drawDefinition:i,stack:n}){if(e&&typeof e!="object")return fe({info:"policyDefinitions must be an object",result:{error:Ae},stack:n});let r={[zE]:t==null?void 0:t[zE]};return e?o8e({policyDefinitions:e,appliedPolicies:t,policiesToAttach:r,drawDefinition:i}):r.avoidance&&Ty({drawDefinition:i,policyDefinitions:r}),!(t!=null&&t[Tu])&&!(e!=null&&e[Tu])&&(Ty({policyDefinitions:wG,drawDefinition:i}),t&&Object.assign(t,wG)),{error:void 0}}function o8e({policyDefinitions:t,appliedPolicies:e,policiesToAttach:i,drawDefinition:n}){for(let r of Object.keys(t))JSON.stringify(e==null?void 0:e[r])!==JSON.stringify(t[r])&&(i[r]=t[r]);Object.keys(i).length&&(Ty({policyDefinitions:i,drawDefinition:n}),e&&Object.assign(e,i))}function l8e(t){var e,i,n,r,a;let{tournamentRecord:s,matchUpFormat:o,appliedPolicies:l,policyDefinitions:c,matchUpType:u,tieFormat:d,drawType:p,stack:h,event:f}=t,m=t.drawId?(e=f==null?void 0:f.drawDefinitions)==null?void 0:e.find(w=>w.drawId===t.drawId):void 0;m&&p!==m.drawType&&(m.drawType=p);let g=m??n8e({processCodes:t.processCodes,drawId:t.drawId,drawType:p}),v=a8e({tournamentRecord:s,drawDefinition:g,matchUpFormat:o,matchUpType:u,tieFormat:d,event:f});if(v.error)return fe({result:v,stack:h});let y=s8e({appliedPolicies:l,policyDefinitions:c,drawDefinition:g,stack:h});if(y.error)return y;let b=(n=(i=m==null?void 0:m.structures)==null?void 0:i.find(w=>w.stage===Bt&&w.stageSequence===1))==null?void 0:n.structureId,I=m?(r=m.structures)==null?void 0:r.filter(w=>w.stage===ri):[],T=(I==null?void 0:I.length)===1&&!((a=I[0].matchUps)!=null&&a.length)&&I[0].structureId;return{drawDefinition:g,structureId:b,existingDrawDefinition:m,existingQualifyingPlaceholderStructureId:T}}function c8e(t){var e,i;let n="generateOrGetExisting",r=[],a=[],s=l8e(t);if(s.error)return fe({result:s,stack:n});let o=s.existingDrawDefinition,l=s.drawDefinition??{},c=s.structureId,u=t.drawEntries??t.eventEntries??[],d=s.existingQualifyingPlaceholderStructureId&&O6e({...t,...s})||Q6e({...t,...s,entries:u});return d.error?fe({result:d,stack:n}):((e=d.positioningReports)!=null&&e.length&&r.push(...d.positioningReports??[]),(i=d.conflicts)!=null&&i.length&&a.push(...d.conflicts??[]),l=d.drawDefinition,c=d.structureId,{existingDrawDefinition:o,positioningReports:r,drawDefinition:l,structureId:c,conflicts:a,entries:u})}function u8e(t){var e,i,n;let{qualifyingPlaceholder:r,qualifyingProfiles:a,existingDrawDefinition:s,positioningReports:o,appliedPolicies:l,qualifyingOnly:c,drawDefinition:u,seedingProfile:d,participants:p,structureId:h,entries:f,stack:m}=t,g=r&&!(a!=null&&a.length)&&!s,v=[];if(a){let y=(w,S)=>w.stageSequence-S.stageSequence,b=(w,S)=>w.roundTarget-S.roundTarget,I=[],T=1;a.sort(b);for(let w of a){if(!Array.isArray(w.structureProfiles))return fe({info:Sy("structureProfiles"),result:{error:si},stack:m});T=w.roundTarget||T;let S=((e=w.structureProfiles)==null?void 0:e.sort(y))||[],U=1;for(let P of S){let{qualifyingRoundNumber:E,qualifyingPositions:R,seededParticipants:C,seedingScaleName:M,seedsCount:_=0,seedByRanking:A,placeByes:N,drawSize:k}=P,O=p0e({...t,seedingProfile:P.seedingProfile??d,stageSequence:U,qualifyingRoundNumber:E,preparedStructureIds:I,qualifyingPositions:R,seededParticipants:C,stage:ri,seedingScaleName:M,appliedPolicies:l,drawDefinition:u,qualifyingOnly:c,seedByRanking:A,participants:p,roundTarget:T,seedsCount:_,placeByes:N,drawSize:k,entries:f});if(O.error)return O;O.structureId&&I.push(O.structureId),U+=1,(i=O.conflicts)!=null&&i.length&&v.push(...O.conflicts),(n=O.positioningReport)!=null&&n.length&&o.push({[ri]:O.positioningReport})}T+=1}}else if(h&&g){let y=$c({structureName:ys(ri),stage:ri}),{link:b}=HR({sourceStructureId:y.structureId,targetStructureId:h,sourceRoundNumber:0,linkType:im});u.structures||(u.structures=[]),u.structures.push(y),u.links||(u.links=[]),u.links.push(b)}return{qualifyingConflicts:v,error:void 0}}var y0e={};Fi(y0e,{addGoesTo:()=>wy,allCompetitionMatchUps:()=>Fd,allDrawMatchUps:()=>po,allEventMatchUps:()=>nf,allPlayoffPositionsFilled:()=>x8,allTournamentMatchUps:()=>Za,analyzeDraws:()=>JR,analyzeMatchUp:()=>nP,analyzeTournament:()=>k7,bulkUpdatePublishedEventIds:()=>L7,calculateWinCriteria:()=>jw,categoryCanContain:()=>uR,checkMatchUpIsComplete:()=>Wv,checkValidEntries:()=>AF,compareTieFormats:()=>cm,competitionScheduleMatchUps:()=>sM,courtGridRows:()=>XF,credits:()=>d8e,drawMatchUps:()=>X7,eventMatchUps:()=>e2,filterMatchUps:()=>Cf,filterParticipants:()=>FR,findDrawDefinition:()=>a7,findExtension:()=>xi,findVenue:()=>tf,getAggregateTeamResults:()=>_7,getAllDrawMatchUps:()=>pa,getAllEventData:()=>F7,getAllStructureMatchUps:()=>Sn,getAllowedDrawTypes:()=>VF,getAllowedMatchUpFormats:()=>M7,getAppliedPolicies:()=>fn,getAssignedParticipantIds:()=>rb,getAvailableMatchUpsCount:()=>MF,getAvailablePlayoffProfiles:()=>zR,getCategoryAgeDetails:()=>SI,getCheckedInParticipantIds:()=>Nw,getCompetitionDateRange:()=>GF,getCompetitionMatchUps:()=>iP,getCompetitionParticipants:()=>D7,getCompetitionPenalties:()=>N7,getCompetitionVenues:()=>iM,getCourtInfo:()=>hF,getCourts:()=>J7,getDrawData:()=>zF,getDrawDefinitionTimeItem:()=>i8,getDrawParticipantRepresentativeIds:()=>n7,getDrawStructures:()=>Ju,getDrawTypeCoercion:()=>QR,getEligibleVoluntaryConsolationParticipants:()=>i7,getEntriesAndSeedsCount:()=>JF,getEvent:()=>t9,getEventData:()=>qF,getEventMatchUpFormatTiming:()=>j7,getEventProperties:()=>Q7,getEventPublishStatus:()=>cu,getEventStructures:()=>wF,getEventTimeItem:()=>wR,getEvents:()=>e9,getFlightProfile:()=>kr,getHomeParticipantId:()=>q7,getLinkedTournamentIds:()=>yR,getMatchUpCompetitiveProfile:()=>MR,getMatchUpContextIds:()=>W7,getMatchUpDailyLimits:()=>i2,getMatchUpDailyLimitsUpdate:()=>G7,getMatchUpDependencies:()=>od,getMatchUpFormat:()=>Y7,getMatchUpFormatTiming:()=>NR,getMatchUpFormatTimingUpdate:()=>V7,getMatchUpScheduleDetails:()=>fF,getMatchUpType:()=>mF,getMatchUpsMap:()=>Us,getMatchUpsStats:()=>K7,getMatchUpsToSchedule:()=>WF,getMaxEntryPosition:()=>B7,getModifiedMatchUpFormatTiming:()=>QF,getPairedParticipant:()=>Qu,getParticipantEventDetails:()=>E7,getParticipantIdFinishingPositions:()=>r7,getParticipantMembership:()=>P7,getParticipantResults:()=>YR,getParticipantScaleItem:()=>ST,getParticipantSchedules:()=>C7,getParticipantSignInStatus:()=>R7,getParticipantTimeItem:()=>n8,getParticipants:()=>br,getPersonRequests:()=>ob,getPolicyDefinitions:()=>Rm,getPositionAssignments:()=>QE,getPositionsPlayedOff:()=>JU,getPredictiveAccuracy:()=>z7,getProfileRounds:()=>ZF,getPublishState:()=>xw,getRoundMatchUps:()=>yo,getRounds:()=>Z7,getScaleValues:()=>VU,getScaledEntries:()=>Bw,getScheduledRoundsDetails:()=>nM,getSchedulingProfile:()=>_m,getSchedulingProfileIssues:()=>$7,getSeedingThresholds:()=>R8,getSeedsCount:()=>eM,getStructureSeedAssignments:()=>Zc,getTeamLineUp:()=>Iy,getTieFormat:()=>O7,getTimeItem:()=>su,getTournamentIds:()=>gR,getTournamentInfo:()=>Vw,getTournamentPenalties:()=>jF,getTournamentPersons:()=>A7,getTournamentPoints:()=>HF,getTournamentPublishStatus:()=>LR,getTournamentStructures:()=>k8,getTournamentTimeItem:()=>lF,getValidGroupSizes:()=>VR,getVenueData:()=>bT,getVenuesAndCourts:()=>Am,isAdHoc:()=>Ho,isCompletedStructure:()=>Eg,isValidForQualifying:()=>l7,isValidMatchUpFormat:()=>Ll,matchUpActions:()=>NF,participantScaleItem:()=>Rh,participantScheduledMatchUps:()=>H7,positionActions:()=>o7,publicFindCourt:()=>f8,publicFindVenue:()=>h8,tallyParticipantResults:()=>QU,tieFormatGenderValidityCheck:()=>FL,tournamentMatchUps:()=>t2,validMatchUp:()=>cF,validMatchUps:()=>lu,validateCollectionDefinition:()=>dR,validateLineUp:()=>IF});function d8e(){return`
    This project would not have been possible without the generous input and patience
    of tournament organizers and directors who worked with early versions of CourtHive/TMX.

    Thanks to Pavel, Ivan, Mladen, Zdenko, Antonia, Jakov, Kreso, Barry, Jeff, Bobby... to name just a few. 

    The project would not have even begun without the support of Miro, or the introduction by Sretchko.
    The project would not have succeeded without the enthusiasm of Randy and Bruce.
    Thanks to serendipity and Luca and the ensuing TODS conversations with ITF.
    Thanks to Scott and Jake for sanity checks, suggestions, and camaraderie.
    Thanks to Zoran for inspiring the async support and getting into the weeds with subscriptions.
    Thanks to Dave for backing the conversion of TMX 1.x source into the factory repository.
    Thanks to Vuk and Pavle and Rich and Chris and Deepa for the direct engagement with the APIs.
    Thanks to Joe for repeatedly challenging me and the many pointers to useful tooling.
    Thanks to Shannon for the validation of the approach from his deep domain experience.
    Thanks to Nikola for the ongoing camaraderie and explorations of what we can do with TODS.

    And a special thanks to my family for putting up with the long days and weeks and months of coding
    and conversations at all hours.
  `}var b0e={};Fi(b0e,{filterParticipants:()=>FR,getCompetitionParticipants:()=>D7,getPairedParticipant:()=>Qu,getParticipantEventDetails:()=>E7,getParticipantMembership:()=>P7,getParticipantScaleItem:()=>ST,getParticipantSchedules:()=>C7,getParticipantSignInStatus:()=>R7,getParticipantTimeItem:()=>n8,getParticipants:()=>br,getScaleValues:()=>VU,participantScaleItem:()=>Rh,validateLineUp:()=>IF});function D7(t){let{tournamentRecords:e}=t||{};if(typeof e!="object"||!Object.keys(e).length)return{error:Tr};let i=[],n={},r={},a={},s=[],o={},l=[];for(let c of Object.values(e)){let{participantIdsWithConflicts:u,mappedMatchUps:d,participantMap:p,participants:h,matchUps:f,derivedEventInfo:m,derivedDrawInfo:g}=br({...t,tournamentRecord:c});Object.assign(o,d),Object.assign(n,p),Object.assign(r,m),Object.assign(a,g),i.push(...h??[]),s.push(...f??[]),u==null||u.forEach(v=>{l.includes(v)||l.push(v)})}return{participantIdsWithConflicts:l,derivedEventInfo:r,derivedDrawInfo:a,participantMap:n,mappedMatchUps:o,participants:i,...pe,matchUps:s}}function E7({tournamentRecord:t,participantId:e}){if(!t)return{error:dt};if(!e)return{error:da};let i=[e].concat((t.participants??[]).filter(n=>{var r;return(n==null?void 0:n.participantType)&&[Pn,Ai].includes(n.participantType)&&((r=n.individualParticipantIds)==null?void 0:r.includes(e))}).map(n=>n.participantId));return{eventDetails:(t.events??[]).filter(n=>{let r=((n==null?void 0:n.entries)??[]).map(a=>a.participantId);return vo(r,i)}).map(n=>({eventName:n.eventName,eventId:n.eventId}))}}function P7({tournamentRecord:t,participantId:e}){if(!t)return{error:dt};if(!e)return{error:da};let{participants:i}=br({participantFilters:{participantTypes:[Pn,Ai,gc]},tournamentRecord:t});return(i??[]).filter(n=>{var r;return(r=n.individualParticipantIds)==null?void 0:r.includes(e)}).reduce((n,r)=>{let a=r.participantType;return a&&(n[a]||(n[a]=[]),n[a].push(r)),n},{})}function C7({participantFilters:t={},tournamentRecord:e}){if(!e)return{error:dt};if(typeof t!="object")return{error:Pm,context:{participantFilters:t}};let i={eventIds:t.eventIds},n=Za({tournamentRecord:e,contextFilters:i}).matchUps??[],r=Object.assign({},...n.map(l=>({[l.matchUpId]:l}))),a=n.filter(({schedule:l})=>l&&Object.keys(l).length),s=od({tournamentRecord:e,matchUps:n}).sourceMatchUpIds??[],o={};for(let l of a){let{sides:c}=l,u,d=(c==null?void 0:c.map(h=>{if(h.participant)return[h.participant].concat(...h.participant.individualParticipants||[]);s[l.matchUpId]&&!u&&(u=(s[l.matchUpId]||[]).map(f=>r[f]).filter(({winningSide:f,bye:m})=>!f&&!m))}).filter(Boolean).flat())??[];for(let h of d){let{participantId:f}=h;o[f]||(o[f]={potentialMatchUps:[],participant:h,matchUps:[]}),o[f].matchUps.push(l)}let p=(u==null?void 0:u.map(({sides:h})=>h).flat().map(({participant:h})=>h&&[h].concat(...h.individualParticipants||[])).filter(Boolean).flat())||[];for(let h of p){let{participantId:f}=h;o[f]||(o[f]={potentialMatchUps:[],participant:h,matchUps:[]}),o[f].potentialMatchUps.push(l)}}return{participantSchedules:Object.values(o).filter(({participant:l})=>!(t.participantIds&&!t.participantIds.includes(l.participantId)||t.participantTypes&&!t.participantTypes.includes(l.participantType))),...pe}}function R7({tournamentRecord:t,participantId:e}){if(!t)return{error:dt};if(!e)return{error:da};let{participant:i}=ev({tournamentRecord:t,participantId:e});if(!i)return{error:Or};let{timeItem:n}=su({itemType:IR,element:i});return n&&n.itemValue===YE&&YE}var I0e={};Fi(I0e,{analyzeDraws:()=>JR,analyzeTournament:()=>k7,getAggregateTeamResults:()=>_7,getAllowedDrawTypes:()=>VF,getAllowedMatchUpFormats:()=>M7,getAppliedPolicies:()=>fn,getCompetitionDateRange:()=>GF,getCompetitionPenalties:()=>N7,getPolicyDefinitions:()=>Rm,getTournamentInfo:()=>Vw,getTournamentPenalties:()=>jF,getTournamentPersons:()=>A7,getTournamentPoints:()=>HF,getTournamentStructures:()=>k8,getTournamentTimeItem:()=>lF});function M7({tournamentRecord:t,categoryName:e,categoryType:i}){var n;if(!t)return{error:dt};let{appliedPolicies:r}=fn({tournamentRecord:t});return(((n=r==null?void 0:r[Kc])==null?void 0:n.matchUpFormats)||[]).filter(({categoryNames:a,categoryTypes:s})=>!e&&!s||e&&(a==null?void 0:a.includes(e))||i&&(s==null?void 0:s.includes(i)))}function VF({tournamentRecord:t,categoryName:e,categoryType:i}){var n;if(!t)return{error:dt};let{appliedPolicies:r}=fn({tournamentRecord:t});return(((n=r==null?void 0:r[V_])==null?void 0:n.allowedDrawTypes)||[]).filter(({categoryNames:a,categoryTypes:s})=>!e&&!s||e&&(a==null?void 0:a.includes(e))||i&&(s==null?void 0:s.includes(i)))}function jF({tournamentRecord:t}){if(!t)return{error:dt};let e=((t==null?void 0:t.participants)??[]).reduce((i,n)=>{let{participantId:r}=n;return(n.penalties??[]).forEach(a=>{let{penaltyId:s}=a||{};i[s]?i[s].participants.push(r):i[s]={...a,participantIds:[r]}}),i},{});return{penalties:Object.values(e)}}function N7({tournamentRecords:t}){if(typeof t!="object"||!Object.keys(t).length)return{error:Tr};let e=[];for(let i of Object.values(t)){let{penalties:n}=jF({tournamentRecord:i});e.push(...n??[])}return{penalties:e}}function w0e({event:t}){return{eventInfo:(({eventId:e,eventName:i,eventType:n,eventLevel:r,surfaceCategory:a,matchUpFormat:s,category:o,gender:l,startDate:c,endDate:u,ballType:d,discipline:p,onlineResources:h,notes:f})=>({eventId:e,eventName:i,eventType:n,eventLevel:r,surfaceCategory:a,matchUpFormat:s,category:o,gender:l,startDate:c,endDate:u,ballType:d,discipline:p,onlineResources:h,notes:f}))(t)}}var p8e={[jU]:{policyName:"Staff Privacy Policy",participant:{contacts:!1,individualParticipants:!1,individualParticipantIds:!1,onlineResources:!1,participantName:!0,participantOtherName:!0,participantId:!0,participantRole:!0,participantRoleResponsibilities:!0,participantStatus:!0,penalties:!1,representing:!0,participantType:!0,person:{addresses:!1,biographicalInformation:!1,birthDate:!1,contacts:!1,nationalityCode:!0,nativeFamilyName:!1,nativeGivenName:!1,onlineResources:!1,otherNames:!0,parentOrganisationId:!1,passportFamilyName:!1,passportGivenName:!1,personId:!1,personOtherIds:!1,previousNames:!1,sex:!1,standardFamilyName:!0,standardGivenName:!0,status:!1,tennisId:!1,wheelchair:!0}}}},h8e=p8e;function Vw(t){var e,i,n,r;let{tournamentRecord:a}=t??{};if(!a)return{error:dt};let s=(({tournamentId:d,tournamentRank:p,tournamentStatus:h,formalName:f,tournamentName:m,promotionalName:g,onlineResources:v,localTimeZone:y,activeDates:b,startDate:I,endDate:T,hostCountryCode:w,venues:S,notes:U,updatedAt:P})=>({tournamentId:d,tournamentRank:p,tournamentStatus:h,formalName:f,tournamentName:m,promotionalName:g,onlineResources:v,localTimeZone:y,activeDates:b,startDate:I,endDate:T,hostCountryCode:w,venues:S,notes:U,updatedAt:P}))(a),o=((e=br({participantFilters:{participantRoles:[Abe,w8,_be,kbe,Obe]},policyDefinitions:h8e,tournamentRecord:a}))==null?void 0:e.participants)??[];o&&(s.tournamentContacts=o);let l=(i=xw({tournamentRecord:a}))==null?void 0:i.publishState,c=((r=(n=l==null?void 0:l.tournament)==null?void 0:n.status)==null?void 0:r.publishedEventIds)||[],u=[];for(let d of a.events??[])if(!(t!=null&&t.usePublishState)||c.includes(d.eventId)){let p=w0e({event:d}).eventInfo;p&&u.push(p)}return s.timeItemValues=VIe({element:a}),s.publishState=l==null?void 0:l.tournament,s.eventInfo=u,{tournamentInfo:$t(Zt(s),!1,!0),...pe}}function GF({tournamentRecords:t}){if(!tn(t))return{error:Tr};let e=Object.keys(t??{}).reduce((r,a)=>{let s=t[a],{tournamentInfo:{startDate:o,endDate:l}}=Vw({tournamentRecord:s}),c=o&&new Date(Mi(o));(!r.startDate||c&&c<r.startDate)&&(r.startDate=c);let u=l&&new Date(Mi(l));return(!r.endDate||u&&u>r.endDate)&&(r.endDate=u),r},{startDate:void 0,endDate:void 0}),i=e.startDate&&Mi(e.startDate.toISOString()),n=e.endDate&&Mi(e.endDate.toISOString());return!i||!n?{error:Ige}:{startDate:i,endDate:n}}function A7({tournamentRecord:t,participantFilters:e}){if(!t)return{error:dt};let i=t.participants||[];e&&(i=FR({participants:i,participantFilters:e,tournamentRecord:t}));let n={},r=a=>{if(a.person){let{personId:s}=a.person;n[s]?n[s].participantIds.push(a.participantId):n[s]={...a.person,participantIds:[a.participantId]}}};return i.forEach(a=>{a.person&&r(a)}),{tournamentPersons:Object.values(n)}}function _7(t){var e,i,n,r,a,s,o,l;let c=ei(t,[{[Ia]:!0}]);if(c.error)return c;let u=t.finishingPositionRangeBounsPoints||{},d={},p=b=>{var I,T,w;let S=(I=b==null?void 0:b.individualParticipants)==null?void 0:I.map(U=>{var P;return((P=U.teams)==null?void 0:P.length)===1&&U.teams[0]});return((T=b==null?void 0:b.teams)==null?void 0:T.length)===1&&((w=b==null?void 0:b.teams)==null?void 0:w[0])||(S==null?void 0:S[0].participantId)===(S==null?void 0:S[1].participantId)&&(S==null?void 0:S[0])},{matchUps:h,participants:f}=br({participantFilters:{participantTypes:[Hi]},withRankingProfile:!0,withStatistics:!0,...t});for(let b of f??[]){if(b.participantType===$o)continue;((i=(e=b.draws)==null?void 0:e[0])==null?void 0:i.drawId)==="draw-0-3"&&console.log(b.participantType,b.draws[0].finishingPositionRange);let I=p(b);if(I)for(let T of(b==null?void 0:b.draws)??[]){let w=(n=T==null?void 0:T.finishingPositionRange)==null?void 0:n.join("-");if(w&&u!=null&&u[w]){let S=I==null?void 0:I.participantId,U=T==null?void 0:T.drawId,P=`${S}|${U}|${w}`;d[P]=u[w]}}}let m=b=>({teamName:b,standingPoints:0,pointsPlayed:0,pointsPct:0,points:0,bonus:0,diff:0,loss:0,win:0}),g=(b,I,T)=>{b[I]===void 0&&(b[I]=0),b[I]+=T},v={},y={};for(let b of h??[]){let{sides:I,matchUpFormat:T}=b,w=T&&Do(T);if((I==null?void 0:I.length)===2&&(r=w.setFormat)!=null&&r.timed&&(!w.finalSetFormat||(a=w.finalSetFormat)!=null&&a.timed))for(let S of I){let U=p(S.participant),P=U==null?void 0:U.participantId,E=(s=S.participant)==null?void 0:s.participantId,R=U==null?void 0:U.participantName,C=S.sideNumber,M=((o=S.participant)==null?void 0:o.individualParticipantIds)||E&&[E]||[];if(M.forEach(_=>{_&&!v[_]&&(v[_]=m(R))}),P&&C){y[P]||(y[P]=m(R));let _=[...M.map(N=>v[N]),y[P]];b.winningSide&&(C===b.winningSide?_.forEach(N=>g(N,"win",1)):_.forEach(N=>g(N,"loss",1)));let A=((l=b.score)==null?void 0:l.sets)||[];for(let N of A){let k=(N==null?void 0:N[`side${3-C}Score`])||0,O=(N==null?void 0:N[`side${C}Score`])||0,$=O-k;_.forEach(F=>g(F,"pointsPlayed",O+k)),_.forEach(F=>g(F,"points",O)),_.forEach(F=>g(F,"diff",$))}}}}for(let b of Object.keys(d)){let[I]=b.split("|");y[I]&&(y[I].bonus+=d[b],y[I].pointsPct=parseFloat((y[I].points/y[I].pointsPlayed).toFixed(2)),y[I].standingPoints=y[I].win+y[I].bonus)}for(let b of Object.keys(v))v[b].pointsPct=parseFloat((v[b].points/v[b].pointsPlayed).toFixed(2));return{...pe,individualResults:v,teamResults:y}}function f8e(t){var e,i,n,r,a,s,o;let l=((i=(e=t.participants)==null?void 0:e.filter(({participantType:p})=>p===Pn))==null?void 0:i.length)===2,c=((n=t.events)==null?void 0:n.length)===1&&t.events[0],u=((r=c==null?void 0:c.drawDefinitions)==null?void 0:r.length)===1&&c.drawDefinitions[0],d=((o=(s=((a=u==null?void 0:u.structures)==null?void 0:a.length)===1&&u.structures[0])==null?void 0:s.positionAssignments)==null?void 0:o.length)===2;return!!(c.tieFormat&&l&&d)}function k7({tournamentRecord:t}){var e;if(!t)return{error:dt};let{drawsAnalysis:i}=JR({tournamentRecord:t}),n={isDual:f8e(t),drawsAnalysis:i},r=br({tournamentRecord:t});return(e=r.missingParticipantIds)!=null&&e.length&&(n.missingParticipantIds=r.missingParticipantIds),{...pe,analysis:n}}function S0e(t,e){return t&&e&&Array.isArray(e)&&e[t-1]||typeof e=="object"&&e[t]}function m8e(t){let{participation:e={},awardProfiles:i,startDate:n,eventType:r,drawSize:a,drawType:s,category:o,endDate:l,level:c}=t,{participationOrder:u,flightNumber:d,rankingStage:p}=e,h=f=>!n&&!l||!f.dateRanges?!0:f.dateRanges.some(m=>{let g=!n||!m.startDate||new Date(n)>new Date(m.startDate),v=!l||!m.endDate||new Date(l)<=new Date(m.endDate);return g&&v});return{awardProfile:i.find(f=>{var m,g,v,y,b,I,T,w,S,U;return h(f)&&(!f.maxFlightNumber||d<=f.maxFlightNumber)&&(!((m=f.drawTypes)!=null&&m.length)||((g=f.drawTypes)==null?void 0:g.includes(s)))&&(!((v=f.drawSizes)!=null&&v.length)||f.drawSizes.includes(a))&&(!((y=f.stages)!=null&&y.length)||f.stages.includes(p))&&(!((b=f.levels)!=null&&b.length)||f.levels.includes(c))&&(!f.maxDrawSize||a<=f.maxDrawSize)&&(!f.drawSize||f.drawSize===a)&&(!f.maxLevel||c<=f.maxLevel)&&(!d||!((T=(I=f.flights)==null?void 0:I.flightNumbers)!=null&&T.length)||f.flights.flightNumbers.includes(d))&&(!f.participationOrder||f.participationOrder===u)&&(!((w=f.category)!=null&&w.ageCategoryCodes)||f.category.ageCategoryCodes.includes(o==null?void 0:o.ageCategoryCode))&&(!((S=f.eventTypes)!=null&&S.length)||((U=f.eventTypes)==null?void 0:U.includes(r)))})}}function IJ({participantWon:t,flightNumber:e,valueObj:i,drawSize:n,flights:r,level:a}){var s,o;let l=(g,v)=>{if(g){if(Array.isArray(v)){let y=v.find(b=>b.flight===g||b.f===g);return y.value||y.v}if(typeof v=="object"){let y=v.flights||v.f;if(Array.isArray(y))return y[g-1]}}},c=(g,v)=>{let y=(g==null?void 0:g.value)||(g==null?void 0:g.v)||(wi(g)?g:0),b=S0e(a,g==null?void 0:g.level);return{value:l(v,b)||wi(b)&&b||y}},u=0,d,p,h,f,m=t&&"won"||t===!1&&"lost"||void 0;if(Array.isArray(i)){let g=i.find(b=>{var I;return b.drawSize===n||((I=b.drawSizes)==null?void 0:I.includes(n))}),v=i.find(b=>b.drawSize&&b.threshold&&n>b.drawSize),y=i.find(b=>{var I;return!b.drawSize&&!((I=b.drawSizes)!=null&&I.length)});m!==void 0&&(g=g==null?void 0:g[m],v=v==null?void 0:v[m],y=y==null?void 0:y[m]),p=c(g,e).value,h=c(v,e).value,f=c(y,e).value,u=p||h||f,d=p&&g.requireWin||h&&v.requireWin||(y==null?void 0:y.requireWin)}else if(typeof i=="object"){let g=(s=i==null?void 0:i.drawSizes)==null?void 0:s[n],v=i;m!==void 0&&(g=g==null?void 0:g[m],v=v==null?void 0:v[m]),p=c(g,e).value,f=c(v,e).value,u=p||f,d=p?g.requireWin:v==null?void 0:v.requireWin}else wi(i)&&m===void 0&&(u=i);return e&&(o=r==null?void 0:r.pct)!=null&&o[e]&&(u=Math.round(u*r.pct[e])),{awardPoints:u,requireWin:d}}function HF({participantFilters:t,policyDefinitions:e,tournamentRecord:i,level:n}){var r;if(!i)return{error:dt};let{policyDefinitions:a}=Rm({policyTypes:[rA],tournamentRecord:i}),s=(e==null?void 0:e[rA])??(a==null?void 0:a[rA]);if(!s)return{error:TL};let o=s.awardProfiles,l=s.requireWinFirstRound,c=s.requireWinForPoints,{participants:u,derivedEventInfo:d,derivedDrawInfo:p,mappedMatchUps:h}=br({withRankingProfile:!0,participantFilters:t,tournamentRecord:i}),f=u==null?void 0:u.filter(y=>{var b;return(b=y.draws)==null?void 0:b.length}),m={},g={},v={};for(let y of f??[]){let{participantType:b,participantId:I,person:T,draws:w}=y;for(let S of w){let{drawId:U,structureParticipation:P,eventId:E}=S,R=d[E],C=p[U],M=C==null?void 0:C.drawType,{category:_,eventType:A}=R||{},N=S.startDate||R.startDate||i.startDate,k=S.endDate||R.endDate||i.endDate;if(A===Fl&&I!==$o)continue;let O;if(o){let $=c,F=0,V=0,j=0,B;for(let z of P){let{finishingPositionRange:W,participationOrder:Z,participantWon:K,flightNumber:Q,rankingStage:J,winCount:se}=z;F+=se||0;let ie=C==null?void 0:C.drawSize,{awardProfile:ce}=m8e({awardProfiles:o,participation:z,eventType:A,startDate:N,category:_,drawSize:ie,drawType:M,endDate:k,level:n});if(ce){if(!ie)continue;let oe=Array.isArray(W)&&Math.max(...W),te=Pi(W||[]).join("-"),le=oe&&J!==ri&&(W==null?void 0:W.includes(ie));ce.requireWinForPoints!==void 0&&($=ce.requireWinForPoints),ce.requireWinFirstRound!==void 0&&(l=ce.requireWinFirstRound);let{finishingPositionPoints:ne={},finishingPositionRanges:me,finishingRound:be,pointsPerWin:Se,flights:we}=ce,ze=Array.isArray(ce.perWinPoints)?(r=ce.perWinPoints)==null?void 0:r.find(lt=>{var Ct;return(Ct=lt.participationOrders)==null?void 0:Ct.includes(Z)}):ce.perWinPoints,Qe=ne.participationOrders,ke=0,yt;if((!Qe||Qe.includes(Z))&&me&&oe){let lt=me[oe];lt&&({awardPoints:ke,requireWin:yt}=IJ({flightNumber:Q,valueObj:lt,drawSize:ie,flights:we,level:n}))}if(!ke&&be&&Z===1&&oe){let lt=be[oe];lt&&({awardPoints:ke,requireWin:yt}=IJ({participantWon:K,flightNumber:Q,valueObj:lt,drawSize:ie,flights:we,level:n}))}if(le&&l!==void 0&&($=l),yt!==void 0&&($=yt),ke>V&&(!$||se)&&(V=ke,B=oe),!ke&&Se&&se&&(j+=se*Se,B=te),!ke&&se&&ze){let lt=S0e(n,ze==null?void 0:ze.level);lt?j+=se*lt:ze.value&&(j+=se*ze.value)}}if(O=V+j,b===$o){let oe=(y.matchUps||[]).filter(({structureId:te})=>te===z.structureId);for(let{matchUpId:te}of oe){let le=h[te],ne=le.sides.find(me=>me.participantId===I).sideNumber;if(le.winningSice===ne)for(let me of le.tieMatchUps)me.winningSide}}}if(j||V){let z={winCount:F,positionPoints:V,rangeAccessor:B,perWinPoints:j,eventType:A,drawId:U,points:O},W=T==null?void 0:T.personId;W?(m[W]||(m[W]=[]),m[W].push(z)):b===Ai?(v[I]||(v[I]=[]),v[I].push(z)):b===$o&&(g[I]||(g[I]=[]),g[I].push(z))}}}}return{participantsWithOutcomes:f,personPoints:m,pairPoints:v,teamPoints:g,...pe}}var T0e={};Fi(T0e,{compareTieFormats:()=>cm,getTieFormat:()=>O7,tieFormatGenderValidityCheck:()=>FL,validateCollectionDefinition:()=>dR});function ak(t){var e;if(!t)return{};let i=[],n=t.tieFormatName,r=(e=t.collectionDefinitions)==null?void 0:e.map(a=>{let{matchUpType:s,matchUpFormat:o,matchUpCount:l,category:c,gender:u}=a;i.includes(o)||i.push(o);let d=c==null?void 0:c.ageCategoryCode;return[l,s===py?"D":"S",d,o,u].join(";")}).join("|");return{tieFormatName:t&&n||"UNNAMED",matchUpFormats:i,tieFormatDesc:r}}function cm({considerations:t={},descendant:e,ancestor:i}){var n,r;let a={},s={},{matchUpFormats:o,tieFormatDesc:l}=ak(e),{matchUpFormats:c,tieFormatDesc:u}=ak(i),d=Pi((o??[]).filter(S=>!(c??[]).includes(S)).concat((c??[]).filter(S=>!(o??[]).includes(S)))),p=!!(t!=null&&t.collectionName&&e.collectionDefinitions.map(({collectionName:S})=>S).join("|")!==i.collectionDefinitions.map(({collectionName:S})=>S).join("|")),h=!!(t!=null&&t.collectionOrder&&e.collectionDefinitions.map(({collectionOrder:S})=>S).join("|")!==i.collectionDefinitions.map(({collectionOrder:S})=>S).join("|")),f=Object.assign({},...((e==null?void 0:e.collectionDefinitions)||[]).map(S=>({[S.collectionId]:S}))),m=Object.assign({},...((i==null?void 0:i.collectionDefinitions)||[]).map(S=>({[S.collectionId]:S})));a.collectionIds=FX(Object.keys(f),Object.keys(m)),s.collectionIds=FX(Object.keys(m),Object.keys(f)),a.collectionsValue=wJ(f),s.collectionsValue=wJ(m),a.groupsCount=((n=i==null?void 0:i.collectionGroups)==null?void 0:n.length)??(0-(((r=e==null?void 0:e.collectionGroups)==null?void 0:r.length)??0)||0),s.groupsCount=a.groupsCount?-1*a.groupsCount:0;let g=a.collectionsValue.totalValue-s.collectionsValue.totalValue,v=a.collectionsValue.totalMatchUps-s.collectionsValue.totalMatchUps,y=s.collectionsValue.assignmentValues.length!==a.collectionsValue.assignmentValues.length,b=s.collectionsValue.assignmentValues.some((S,U)=>{let P=a.collectionsValue.assignmentValues[U];return!P||S.valueKey!==P.valueKey||S.value!==P.value?!0:Array.isArray(S.value)?S.value.every((E,R)=>P.value[R]===E):!1}),I=p||h||u!==l||y||b||g!==0,T=[...s.collectionsValue.invalidValues,...a.collectionsValue.invalidValues],w=T.length&&T;return{matchUpFormatDifferences:d,matchUpCountDifference:v,descendantDifferences:a,ancestorDifferences:s,orderDifference:h,valueDifference:g,nameDifference:p,descendantDesc:l,ancestorDesc:u,...pe,different:I,invalid:w}}function wJ(t){let e=[],i=[],n=0;return{totalValue:Object.keys(t).sort(vF).reduce((r,a)=>{let s=t[a],{collectionValueProfiles:o,collectionValue:l,matchUpCount:c,matchUpValue:u,scoreValue:d,setValue:p}=s,h={collectionValueProfiles:o,collectionValue:l,matchUpValue:u,scoreValue:d,setValue:p},f=Object.keys(h).filter(g=>![void 0,null].includes(h[g])&&(!Array.isArray(h[g])||h[g].length>0));f.length!==1&&e.push({collectionId:a});let m=f[0];if(m){let g=m==="collectionValueProfiles"?Object.values(o):h[m];i.push({valueKey:m,value:g})}return n+=c,o!=null&&o.length?r+o.reduce((g,v)=>g+v.value,0):c?wi(u)?r+u*c:wi(d)?r+d*c:wi(p)?r+p*c:r+l:r},0),totalMatchUps:n,invalidValues:e,assignmentValues:i}}function x7(t){Object.assign(t,{inContext:!0});let{matchUp:e,error:i}=U0e(t);return{matchUp:$t(e,!0,!0),error:i}}function U0e({participantsProfile:t,afterRecoveryTimes:e,tournamentRecord:i,contextContent:n,contextProfile:r,drawDefinition:a,nextMatchUps:s,matchUpId:o,inContext:l,eventId:c,drawId:u,event:d}){var p;if(!i)return{error:dt};if(typeof o!="string")return{error:Zs};if(!a||!d){let m=(Za({tournamentRecord:i,nextMatchUps:s}).matchUps??[]).find(g=>g.matchUpId===o);if(!m)return{error:xs};({eventId:c,drawId:u}=m),{event:d,drawDefinition:a}=zo({tournamentRecord:i,eventId:c,drawId:u})}if(!a)return{error:sc};r&&!n&&(n=Mm({tournamentRecord:i,contextProfile:r}));let h={surfaceCategory:(d==null?void 0:d.surfaceCategory)??i.surfaceCategory,indoorOutDoor:(d==null?void 0:d.indoorOutdoor)??i.indoorOutdoor,endDate:(d==null?void 0:d.endDate)??i.endDate,tournamentId:i.tournamentId,eventId:c??(d==null?void 0:d.eventId),drawId:u},{participants:f=[]}=Qy({participantsProfile:t,tournamentRecord:i,contextProfile:r,inContext:l});if(s){let m=(po({context:l?h:void 0,participants:f,afterRecoveryTimes:e,contextContent:n,contextProfile:r,drawDefinition:a,nextMatchUps:s,inContext:l,event:d}).matchUps??[]).find(v=>v.matchUpId===o);if(!m)return{error:xs};let g=(p=a==null?void 0:a.structures)==null?void 0:p.find(v=>v.structureId===m.structureId);return{drawDefinition:a,structure:g,matchUp:m}}else{let{matchUp:m,structure:g}=or({context:l?h:void 0,tournamentParticipants:f,afterRecoveryTimes:e,contextContent:n,drawDefinition:a,contextProfile:r,matchUpId:o,inContext:l,event:d});return{matchUp:m,structure:g,drawDefinition:a}}}function O7({tournamentRecord:t,drawDefinition:e,structureId:i,matchUpId:n,structure:r,eventId:a,drawId:s,event:o}){var l,c,u,d,p;if(!t)return{error:dt};if(!s&&!o&&!i&&!n)return fe({result:{error:si},stack:"getTieFormat"});a&&!o&&(o=(l=t.events)==null?void 0:l.find(y=>y.eventId===a));let h=x7({tournamentRecord:t,drawDefinition:e,matchUpId:n,drawId:s,event:o});if(n&&h!=null&&h.error)return h;if(!e&&h!=null&&h.drawDefinition&&(e=h==null?void 0:h.drawDefinition),r=r??(h==null?void 0:h.structure),!r&&i&&!n){if(!e)return{error:jd};let y=fi({drawDefinition:e,structureId:i});if(y.error)return y;r=y.structure}let f=((r==null?void 0:r.tieFormat)||(r==null?void 0:r.tieFormatId))&&((c=Ws({structure:r,drawDefinition:e,event:o}))==null?void 0:c.tieFormat),m=((e==null?void 0:e.tieFormat)||(e==null?void 0:e.tieFormatId))&&((u=Ws({drawDefinition:e,event:o}))==null?void 0:u.tieFormat),g=(d=Ws({event:o}))==null?void 0:d.tieFormat,v=(p=Ws({matchUp:h==null?void 0:h.matchUp,drawDefinition:e,structure:r,event:o}))==null?void 0:p.tieFormat;return{...pe,matchUp:h==null?void 0:h.matchUp,structureDefaultTieFormat:us(f),eventDefaultTieFormat:us(g),drawDefaultTieFormat:us(m),tieFormat:us(v),structure:r}}var D0e={};Fi(D0e,{bulkUpdatePublishedEventIds:()=>L7,getAllEventData:()=>F7,getCourtInfo:()=>hF,getDrawData:()=>zF,getEventData:()=>qF,getEventPublishStatus:()=>cu,getPublishState:()=>xw,getTournamentPublishStatus:()=>LR,getVenueData:()=>bT});function L7({tournamentRecord:t,outcomes:e}){var i;if(!t)return{error:dt};if(!(e!=null&&e.length))return{error:si,info:"Missing outcomes"};let n=e.reduce((a,s)=>{let{drawId:o,eventId:l}=s;return l&&o&&(a[l]?a[l].includes(o)||a[l].push(o):a[l]=[o]),a},{}),r=Object.keys(n);return{publishedEventIds:((i=t.events)==null?void 0:i.filter(a=>r.includes(a.eventId))).filter(a=>{let s=cu({event:a}),{drawDetails:o,drawIds:l}=s??{},{eventId:c}=a;return n[c].filter(u=>{let d=o?Object.keys(s.drawDetails).filter(p=>y8({drawId:p,drawDetails:o})):[];return(l==null?void 0:l.includes(u))||d.includes(u)}).length}).map(a=>a.eventId),eventIdPublishedDrawIdsMap:n}}function E0e({dates:t=[],extension:e}){var i;if(!e)return!1;if(typeof e.value=="boolean"&&e.value)return!0;if(!t.length)return!1;let n=tn(e.value)?(i=e.value)==null?void 0:i.dates:void 0;if(Array.isArray(n))return n!=null&&n.length?!!n.filter(r=>!t.length||t.includes(r)).length:!1}function P0e({convertExtensions:t,ignoreDisabled:e,venue:i,court:n}){var r;let a={...$t(n,t,!0),venueId:i.venueId},{extension:s}=xi({name:Pd,element:n});if(e&&s){let o=tn(s.value)?(r=s.value)==null?void 0:r.dates:void 0,l=(s==null?void 0:s.value)===!0?[]:a.dateAvailability.map(c=>{let u=c.date;if(!(!u||o.includes(u)))return c}).filter(Boolean);a.dateAvailability=l}return{inContextCourt:a}}function Am(t){let{convertExtensions:e,ignoreDisabled:i,venueIds:n=[],dates:r}=t,a=t.tournamentRecords||t.tournamentRecord&&{[t.tournamentRecord.tournamentId]:t.tournamentRecord}||{},s=[],o=[],l=[],c=[];return Object.keys(a).filter(u=>!t.tournamentId||u===t.tournamentId).forEach(u=>{let d=a[u];for(let p of d.venues??[])if(!(n.length&&!n.includes(p.venueId))){if(i){let{extension:h}=xi({name:Pd,element:p});if(h!=null&&h.value)continue}s.includes(p.venueId)||(c.push($t(p,e,!0)),s.push(p.venueId));for(let h of p.courts??[])if(!o.includes(h.courtId)){if(i){let{extension:m}=xi({name:Pd,element:h});if(E0e({extension:m,dates:r}))continue}let{inContextCourt:f}=P0e({convertExtensions:e,ignoreDisabled:i,venue:p,court:h});l.push(f),o.push(h.courtId)}}}),{courts:l,venues:c,...pe}}function g8e({convertExtensions:t,tournamentRecord:e,ignoreDisabled:i,dates:n}){if(!e)return{error:Tr};let r=$t(e.venues??[],t).filter(s=>{if(!i)return s;let{extension:o}=xi({name:Pd,element:s});return!(o!=null&&o.value)&&s}).filter(Boolean),a=r.reduce((s,o)=>{let l=((o==null?void 0:o.courts)||[]).filter(c=>{if(!i&&!(n!=null&&n.length))return c;let{extension:u}=xi({name:Pd,element:c});return E0e({extension:u,dates:n})}).filter(Boolean).map(c=>{let{inContextCourt:u}=P0e({convertExtensions:t,ignoreDisabled:i,venue:o,court:c});return u});return l.length?s.concat(l):s},[]);return{venues:r,courts:a}}function iM({tournamentRecords:t,requireCourts:e,dates:i}){return typeof t!="object"||!Object.keys(t).length?{error:Tr}:Object.keys(t).reduce((n,r)=>{let a=t[r],{venues:s}=g8e({tournamentRecord:a,dates:i});return s==null||s.forEach(o=>{let{venueId:l,courts:c}=o;(!e||c!=null&&c.length)&&!n.venueIds.includes(l)&&(n.venues.push(o),n.venueIds.push(l))}),n},{venues:[],venueIds:[]})}function F7({tournamentRecord:t,policyDefinitions:e}){if(!t)return{error:dt};let i=t.events||[],n=(t==null?void 0:t.participants)||[],{tournamentInfo:r}=Vw({tournamentRecord:t}),{venues:a}=Am({tournamentRecord:t}),s=i.map(o=>{let{eventId:l}=o,c=w0e({event:o}).eventInfo,u=SR({tournamentRecord:t,event:o}).scheduleTiming,d=(o.drawDefinitions||[]).map(h=>{let f=(({drawId:b,drawName:I,matchUpFormat:T,updatedAt:w})=>({matchUpFormat:T,updatedAt:w,drawName:I,drawId:b}))(h),{abandonedMatchUps:m,completedMatchUps:g,upcomingMatchUps:v,pendingMatchUps:y}=WU({requireParticipants:!0,tournamentParticipants:n,context:{eventId:l},policyDefinitions:e,tournamentRecord:t,inContext:!0,scheduleTiming:u,drawDefinition:h,event:o});return{drawInfo:f,matchUps:{abandonedMatchUps:m,completedMatchUps:g,upcomingMatchUps:v,pendingMatchUps:y}}}),p=cu({event:o});return Object.assign(c,{drawsData:d,publish:p}),c});return{allEventData:{tournamentInfo:r,venuesData:a,eventsData:s}}}function C0e({publishStatus:t,drawId:e}){var i,n,r;return t!=null&&t.drawDetails?(r=(n=(i=t.drawDetails)==null?void 0:i[e])==null?void 0:n.publishingDetail)==null?void 0:r.published:t!=null&&t.drawIds?t.drawIds.includes(e):!0}var R0e="PUBLIC",v8e="ADMIN",y8e={PUBLIC_DISPLAY:R0e,ADMIN_DISPLAY:v8e};function zF(t){var e,i,n;let{tournamentParticipants:r=[],includePositionAssignments:a,policyDefinitions:s,tournamentRecord:o,inContext:l=!0,usePublishState:c,status:u=vc,pressureRating:d,refreshResults:p,contextProfile:h,drawDefinition:f,noDeepCopy:m,sortConfig:g,context:v,event:y}=t;if(!f)return{error:Ht};let b=(({matchUpFormat:A,updatedAt:N,drawType:k,drawName:O,drawId:$})=>({matchUpFormat:A,updatedAt:N,drawName:O,drawType:k,drawId:$}))(f);b.display=(e=xi({element:f,name:j_}).extension)==null?void 0:e.value;let I={},T,{allStructuresLinked:w,sourceStructureIds:S,hasDrawFeedProfile:U,structureGroups:P}=SF({drawDefinition:f});if(!w)return{error:lge};let E=(t==null?void 0:t.publishStatus)??cu({event:y,status:u}),R=t.eventPublished??!!((n=(i=xw({event:y}).publishState)==null?void 0:i.status)!=null&&n.published),C=!1,M=!1,_=P.map(A=>{let N={},k=A.map(O=>{let{structure:$}=fi({drawDefinition:f,structureId:O}),{seedAssignments:F}=Zc({drawDefinition:f,structure:$});return($==null?void 0:$.stage)===Bt&&$.stageSequence===1&&(T=F),($==null?void 0:$.stage)===ri&&(I[$.stageSequence??0]=F),$}).sort((O,$)=>Ew(O,$,g)).map(O=>{var $,F;if(!O)return;let V=O==null?void 0:O.structureId,j=[];O.stage&&[Bt,ws,Mr].includes(O.stage)&&(j=T),(O==null?void 0:O.stage)===ri&&(j=I[O.stageSequence??0]);let{matchUps:B,roundMatchUps:z,roundProfile:W}=Sn({seedAssignments:($=O==null?void 0:O.seedAssignments)!=null&&$.length?void 0:j,context:{drawId:b.drawId,...v},hydrateParticipants:t.hydrateParticipants,participantsProfile:t.participantsProfile,tournamentParticipants:r,policyDefinitions:s,tournamentRecord:o,usePublishState:c,publishStatus:E,contextProfile:h,drawDefinition:f,inContext:l,structure:O,event:y}),{positionAssignments:Z}=Gn({structure:O}),K=Z==null?void 0:Z.filter(Bl(qh)).map(ie=>{var ce,oe;let te=(oe=(ce=xi({element:ie,name:wg}))==null?void 0:ce.extension)==null?void 0:oe.value,{drawPosition:le,participantId:ne}=ie;return M=!0,{participantResult:te,participantId:ne,drawPosition:le}});if(B.length&&(!(K!=null&&K.length)&&t.allParticipantResults||p&&!O.structures)){let{subOrderMap:ie}=OIe({positionAssignments:Z}),ce=B.some(te=>te.matchUpType===ac)?B.filter(te=>te.matchUpType===ac):B,oe=QU({matchUpFormat:O.matchUpFormat,matchUps:ce,policyDefinitions:s,pressureRating:d,subOrderMap:ie});K=Z==null?void 0:Z.filter(Bl(qh)).map(te=>{var le;let{drawPosition:ne,participantId:me}=te;return M=!0,{participantResult:me&&((le=oe==null?void 0:oe.participantResults)==null?void 0:le[me]),participantId:me,drawPosition:ne}})}let Q=O?(({stageSequence:ie,structureName:ce,structureType:oe,matchUpFormat:te,stage:le})=>({stageSequence:ie,structureName:ce,structureType:oe,matchUpFormat:te,stage:le}))(O):{},J=(F=xi({element:O,name:j_}).extension)==null?void 0:F.value;Q.display=(J==null?void 0:J[R0e])??J,Q.sourceStructureIds=S[V],Q.hasDrawFeedProfile=U[V],Q.positionAssignments=Z,Q.structureActive=B.reduce((ie,ce)=>{var oe;let te=[Kr,oa,ad,$r,Kp,Ki,ss,un].includes(ce.matchUpStatus);return ie||te||!!ce.winningSide||!!((oe=ce.score)!=null&&oe.scoreStringSide1)},!1);let se=B.reduce((ie,ce)=>ie&&[gn,$r,ss,un,Ki,ul].includes(ce.matchUpStatus),!!B.length);return Q.structureCompleted=se,N[V]=se,Q.structureActive&&(C=!0),{...Q,participantResults:K,seedAssignments:j,roundMatchUps:z,roundProfile:W,structureId:V}});return k.forEach(O=>{var $;a||delete O.positionAssignments,O.sourceStructuresComplete=($=O.sourceStructureIds)==null?void 0:$.every(F=>N[F])}),k}).flat();return b.drawActive=C,b.participantPlacements=M,b.drawGenerated=_==null?void 0:_.reduce((A,N)=>A||!!(N!=null&&N.roundMatchUps),!1),b.drawCompleted=_==null?void 0:_.reduce((A,N)=>A&&N.structureCompleted,!0),b.drawPublished=c?R&&C0e({publishStatus:E,drawId:b.drawId}):void 0,{structures:!c||b.drawPublished?m&&_||$t(_,!1,!0):void 0,drawInfo:m?b:$t(b,!1,!0),...pe}}function qF(t){var e,i,n;let{includePositionAssignments:r,participantsProfile:a,policyDefinitions:s,usePublishState:o,status:l=vc,contextProfile:c,sortConfig:u}=t,d=ei(t,[{tournamentRecord:!0},{[M6]:{event:!1,eventId:!1}}]);if(d.error)return d;let p=$t(t.tournamentRecord,!1,!0),h=t.event?void 0:zo({tournamentRecord:p,eventId:t.eventId}).event,f=t.event?$t(t.event,!1,!0):h&&$t(h,!1,!0)||void 0;if(!f)return{error:Wc};let{eventId:m}=f,{tournamentId:g,endDate:v}=p,y=cu({event:f,status:l}),b=xw({event:f}).publishState??{},I=!!((e=b==null?void 0:b.status)!=null&&e.published),{participants:T}=br({withGroupings:!0,withEvents:!1,withDraws:!1,policyDefinitions:s,...a,tournamentRecord:p}),w=({stage:N,drawId:k})=>{var O,$,F;if(!o)return!0;let V=($=(O=y==null?void 0:y.drawDetails)==null?void 0:O[k])==null?void 0:$.stageDetails;return!V||!Object.keys(V).length?!0:(F=V[N])==null?void 0:F.published},S=({structureId:N,drawId:k})=>{var O,$,F;if(!o)return!0;let V=($=(O=y==null?void 0:y.drawDetails)==null?void 0:O[k])==null?void 0:$.structureDetails;return!V||!Object.keys(V).length?!0:(F=V[N])==null?void 0:F.published},U=({drawId:N})=>o?C0e({publishStatus:y,drawId:N}):!0,P=({drawId:N,structure:k})=>{var O,$,F,V;if(!o)return k;let j=(V=(F=($=(O=y==null?void 0:y.drawDetails)==null?void 0:O[N])==null?void 0:$.structureDetails)==null?void 0:F[k.structureId])==null?void 0:V.roundLimit;if(wi(j)){let B=Mt(1,j+1),z={},W={};for(let Z of B)k.roundMatchUps[Z]&&(z[Z]=k.roundMatchUps[Z],W[Z]=k.roundProfile[Z]);k.roundMatchUps=z,k.roundProfile=W}return k},E=f.drawDefinitions||[],R=!o||I?E.filter(U).map(N=>(({drawInfo:k,structures:O})=>({...k,structures:O}))(zF({allParticipantResults:t.allParticipantResults,hydrateParticipants:t.hydrateParticipants,context:{eventId:m,tournamentId:g,endDate:v},pressureRating:t.pressureRating,refreshResults:t.refreshResults,includePositionAssignments:r,tournamentParticipants:T,noDeepCopy:!0,policyDefinitions:s,tournamentRecord:p,usePublishState:o,contextProfile:c,drawDefinition:N,publishStatus:y,sortConfig:u,event:f}))).map(({structures:N,...k})=>{let O=N==null?void 0:N.filter(({stage:$,structureId:F})=>S({structureId:F,drawId:k.drawId})&&w({stage:$,drawId:k.drawId})).map($=>P({drawId:k.drawId,structure:$}));return{...k,structures:O}}).filter(N=>{var k;return(k=N.structures)==null?void 0:k.length}):void 0,C=(Array.isArray(p.venues)?p.venues:[]).map(N=>(({venueData:k})=>({...k}))(bT({venueId:N.venueId,tournamentRecord:p}))),M=(({eventId:N,eventName:k,eventType:O,eventLevel:$,surfaceCategory:F,matchUpFormat:V,category:j,gender:B,startDate:z,endDate:W,ballType:Z,discipline:K})=>({eventId:N,eventName:k,eventType:O,eventLevel:$,surfaceCategory:F,matchUpFormat:V,category:j,gender:B,startDate:z,endDate:W,ballType:Z,discipline:K}))(f);M.display=(i=xi({element:f,name:j_}).extension)==null?void 0:i.value;let{tournamentInfo:_}=Vw({tournamentRecord:p}),A={tournamentInfo:_,venuesData:C,eventInfo:M,drawsData:R};return A.eventInfo.publishState=b,A.eventInfo.published=(n=b==null?void 0:b.status)==null?void 0:n.published,{...pe,eventData:A,participants:T}}var M0e={};Fi(M0e,{courtGridRows:()=>XF,findVenue:()=>tf,getMatchUpsToSchedule:()=>WF,getPersonRequests:()=>ob,getProfileRounds:()=>ZF,getScheduledRoundsDetails:()=>nM,getSchedulingProfile:()=>_m,getSchedulingProfileIssues:()=>$7,publicFindCourt:()=>f8});function UT({matchUpPotentialParticipantIds:t,matchUpNotBeforeTimes:e,timeAfterRecovery:i,matchUp:n}){var r,a,s,o;let{individualParticipantIds:l}=sF(n);i=i??((r=n.schedule)==null?void 0:r.timeAfterRecovery);let c=h=>{t[h]||(t[h]=[]),t[h]=Pi(t[h].concat(...l))},u=h=>{i&&(!e[h]||i>e[h])&&(e[h]=i)},d=((a=n.winnerTo)==null?void 0:a.matchUpId)||n.winnerMatchUpId;d&&(i&&u(d),c(d));let p=((s=n.loserTo)==null?void 0:s.matchUpId)||n.loserMatchUpId;p&&(i&&u(p),c(p)),(o=n.sidesTo)!=null&&o.length&&n.sidesTo.forEach(({matchUpId:h})=>{h&&(i&&u(h),c(h))})}function WF(t){let e=ei(t,[{[C6]:!0}]);if(e.error)return e;let{matchUpPotentialParticipantIds:i,dateScheduledMatchUpIds:n=[],scheduleCompletedMatchUps:r,matchUpNotBeforeTimes:a,matchUpScheduleTimes:s,orderedMatchUpIds:o,clearDate:l,matchUps:c}=t,u=s?Object.keys(s):[],d=(o??[]).map(h=>c.find(f=>f.matchUpId===h)).filter(Boolean).filter(h=>{let f=!l&&(n.includes(h.matchUpId)||u.includes(h.matchUpId)),m=[gn,Ki,$r,ul,ss,un,Kr,oa].includes(h==null?void 0:h.matchUpStatus);return r||!f&&!h.winningSide&&!m}),p=i&&a?d.reduce((h,f)=>{let{drawId:m,tournamentId:g}=f;return h.matchUpMap[g]||(h.matchUpMap[g]={}),h.matchUpMap[g][m]?h.matchUpMap[g][m].push(f):h.matchUpMap[g][m]=[f],UT({matchUpPotentialParticipantIds:i,matchUpNotBeforeTimes:a,matchUp:f}),h},{matchUpMap:{}}).matchUpMap:{};return{matchUpsToSchedule:d,matchUpMap:p}}function YF({defaultRecoveryMinutes:t=0,defaultAverageMinutes:e,tournamentRecords:i,matchUpFormat:n,categoryName:r,categoryType:a,tournamentId:s,eventType:o,eventId:l}){if(!Ll({matchUpFormat:n}))return{error:aR};let c=Object.keys(i).filter(d=>!s||d===s),u;return c.forEach(d=>{var p;if(u)return;let h=i[d],f=l?(p=zo({tournamentRecord:h,eventId:l}))==null?void 0:p.event:void 0;return u=NR({tournamentRecord:h,matchUpFormat:n,categoryName:r,categoryType:a,eventType:o,event:f}),(u==null?void 0:u.averageMinutes)||(u==null?void 0:u.recoveryMinutes)}),{recoveryMinutes:(u==null?void 0:u.recoveryMinutes)||t,averageMinutes:(u==null?void 0:u.averageMinutes)||e,typeChangeRecoveryMinutes:(u==null?void 0:u.typeChangeRecoveryMinutes)||(u==null?void 0:u.recoveryMinutes)||t}}function nM(t){let e=ei(t,[{[M6]:{tournamentRecords:!1,tournamentRecord:!1}},{rounds:!0,[Wo]:Ms}]);if(e.error)return e;let{scheduleCompletedMatchUps:i,periodLength:n=30}=t,r=t.tournamentRecords||t.tournamentRecord&&{[t.tournamentRecord.tournamentId]:t.tournamentRecord}||{};if(typeof r!="object")return{error:Tr};let a={},s=[],o=t.rounds.toSorted((f,m)=>(f.sortOrder??0)-(m.sortOrder??0)),l=t.containedStructureIds??Object.assign({},...Object.values(r).map(f=>zU({tournamentRecord:f}).containedStructures)),c=t.matchUps??Fd({nextMatchUps:!0,tournamentRecords:r}).matchUps,u=0,d={},p={},h={};return{scheduledRoundsDetails:o.flatMap(f=>{var m;let g=f.periodLength||n,v=[];l!=null&&l[f.structureId]?v.push(...l[f.structureId]):v.push(f.structureId);let y=c?Cf({tournamentIds:[f.tournamentId],roundNumbers:[f.roundNumber],matchUpIds:f.matchUpIds,eventIds:[f.eventId],drawIds:[f.drawId],processContext:!0,structureIds:v,matchUps:c}).sort(kw):[],{segmentNumber:b,segmentsCount:I}=f.roundSegment||{};if(wi(b)&&kd(y==null?void 0:y.length)&&kd(I)&&b>0&&b<=I&&I<(y==null?void 0:y.length)&&!((m=f.matchUpIds)!=null&&m.length)){let U=y.length/I,P=U*(b-1);y=y.slice(P,P+U)}let T=r[f.tournamentId],w=zo({drawId:f.drawId,tournamentRecord:T}).event,S=[];for(let U of y){let P=U.matchUpFormat;P&&(a[P]||(a[P]=[],a[P].push(U)),S.push(P))}for(let U of S){let{eventType:P,category:E}=w??{},{categoryName:R,ageCategoryCode:C}=E??{},{typeChangeRecoveryMinutes:M,recoveryMinutes:_,averageMinutes:A,error:N}=YF({categoryName:R??C,categoryType:E==null?void 0:E.categoryType,tournamentId:f.tournamentId,eventId:f.eventId,tournamentRecords:r,matchUpFormat:U,eventType:P});if(N)return{error:N,round:f};let k=y.filter($=>(i||!va.includes($.matchUpStatus))&&$.matchUpStatus!==gn).map(Ca);k.forEach($=>{h[$]={typeChangeRecoveryMinutes:M,recoveryMinutes:_,averageMinutes:A},d[$]=_,p[$]=A}),s.push(...k),u=Math.max(A||0,u);let O=`${A}|${g}`;return{roundPeriodLength:g,recoveryMinutes:_,averageMinutes:A,matchUpIds:k,hash:O}}}),greatestAverageMinutes:u,matchUpFormatCohorts:a,recoveryMinutesMap:d,averageMinutesMap:p,orderedMatchUpIds:s,minutesMap:h,...pe}}function N0e({schedulingProfile:t,venueIds:e,eventIds:i,drawIds:n}){let r=[],a=t==null?void 0:t.map(o=>{let l=Mi(o==null?void 0:o.scheduleDate);if(!l){r.push(`Invalid date: ${o==null?void 0:o.scheduledDate}`);return}let c=((o==null?void 0:o.venues)||[]).map(u=>{let{rounds:d,venueId:p}=u;if(!(e!=null&&e.includes(p))){r.push(`Missing venueId: ${p}`);return}let h=d.filter(f=>{let m=i.includes(f.eventId)&&n.includes(f.drawId);return m||r.push(`Invalid eventId: ${f.eventId} or drawId: ${f.drawId}`),m});if(h.length)return{venueId:p,rounds:h}}).filter(Boolean);return c.length&&l&&{...o,venues:c}}).filter(Boolean),s=r.length;return{updatedSchedulingProfile:a,modifications:s,issues:r}}function KF({tournamentRecords:t,schedulingProfile:e}){if(!e)return{valid:!0};if(!Array.isArray(e))return{valid:!1,error:Ae};let{venueIds:i,tournamentsMap:n}=I8e({tournamentRecords:t}),r,a,s=e.every(o=>{let{scheduleDate:l,venues:c}=o;return Cl(l)?c.every(u=>{let{venueId:d,rounds:p}=u;return typeof d!="string"?(a="venueId should be a string",!1):Array.isArray(p)?i.includes(d)?!!p.every(h=>{var f,m,g,v;if(!h)return a="empty round",!1;let{roundSegment:y,tournamentId:b,structureId:I,roundNumber:T,eventId:w,drawId:S}=h,U=(v=(g=(m=(f=n==null?void 0:n[b])==null?void 0:f[w])==null?void 0:m[S])==null?void 0:g[I])==null?void 0:v.includes(T);U||(a="Invalid rounds");let{segmentNumber:P,segmentsCount:E}=y||{},R=!y||wi(P)&&kd(E)&&P<=E;return R||(a="Invalid segment"),U&&R}):(r=Iw,!1):(a="rounds should be an array",!1)}):!1});return!s&&!r&&(r=Ae),{valid:!!s,error:r,info:a}}function b8e(t){let{tournamentRecord:e={},tournamentMap:i={},requireCourts:n}=t,r=[],a=[],s=[],o=[],l=((e==null?void 0:e.venues)||[]).map(({venueId:u,courts:d})=>(!n||(d==null?void 0:d.length))&&u),c=e==null?void 0:e.tournamentId;return c&&(r.push(c),i[c]={},((e==null?void 0:e.events)||[]).forEach(u=>{let d=u.eventId;s.push(d),i[c][d]={},(u.drawDefinitions||[]).forEach(p=>{let h=p.drawId;o.push(h),i[c][d][h]={};let{structures:f}=Ju({drawDefinition:p});(f||[]).forEach(m=>{var g;let v=m.structureId,{matchUps:y}=Sn({structure:m}),{roundMatchUps:b}=yo({matchUps:y}),I=b&&Object.keys(b).map(T=>parseInt(T));i[c][d][h][v]=I,a.push(v),(g=m.structures)!=null&&g.length&&m.structures.forEach(T=>{a.push(T.structureId),i[c][d][h][T.structureId]=I})})})})),{tournamentMap:i,tournamentIds:r,structureIds:a,venueIds:l,eventIds:s,drawIds:o}}function I8e(t){let e=(t==null?void 0:t.tournamentRecords)&&Object.values(t==null?void 0:t.tournamentRecords)||[],i={},{venueIds:n,eventIds:r,drawIds:a,structureIds:s,tournamentIds:o}=e.reduce((l,c)=>{let{tournamentIds:u,tournamentMap:d,structureIds:p,venueIds:h,eventIds:f,drawIds:m}=b8e({tournamentRecord:c});return h.forEach(g=>{l.venueIds.includes(g)||l.venueIds.push(g)}),l.tournamentIds.push(...u),l.structureIds.push(...p),l.eventIds.push(...f),l.drawIds.push(...m),Object.assign(i,d),l},{tournamentIds:[],structureIds:[],venueIds:[],eventIds:[],drawIds:[]});return{tournamentsMap:i,tournamentIds:o,structureIds:s,venueIds:n,eventIds:r,drawIds:a}}function _m({tournamentRecords:t,tournamentRecord:e}){if(typeof t!="object"||!Object.keys(t).length)return{error:Tr};let{extension:i}=xi({element:e,name:PI,tournamentRecords:t,discover:!0}),n=(i==null?void 0:i.value)||[];if(n.length){let{venueIds:r}=iM({requireCourts:!0,tournamentRecords:t}),{eventIds:a,drawIds:s}=X8({tournamentRecords:t}),{updatedSchedulingProfile:o,modifications:l,issues:c}=N0e({schedulingProfile:n,venueIds:r,eventIds:a,drawIds:s});if(l){n=o;let u=e1({tournamentRecords:t,tournamentRecord:e,schedulingProfile:n});return u.error?u:{schedulingProfile:n,modifications:l,issues:c}}}return{schedulingProfile:n,modifications:0}}function e1({tournamentRecords:t,tournamentRecord:e,schedulingProfile:i}){let n=KF({tournamentRecords:t,schedulingProfile:i});return n.error?n:i?pn({tournamentRecords:t,discover:!0,extension:{name:PI,value:i}}):uo({element:e,name:PI,tournamentRecords:t,discover:!0})}function rM(t){let{tournamentRecord:e}=t,i=t.tournamentRecords||e&&{[e.tournamentId]:e}||{};if(!t.schedulingProfile){let{modifications:c,issues:u}=_m({tournamentRecords:i,tournamentRecord:e});return{success:!c,modifications:c,issues:u}}let{venueIds:n}=iM({tournamentRecords:i}),{eventIds:r,drawIds:a}=X8({tournamentRecords:i}),{updatedSchedulingProfile:s,modifications:o,issues:l}=N0e({schedulingProfile:t.schedulingProfile,venueIds:n,eventIds:r,drawIds:a});return o?{...e1({schedulingProfile:s,tournamentRecords:i}),modifications:o,issues:l}:{...pe,modifications:o,issues:l}}function $7(t){let{scheduleDates:e=[],tournamentRecords:i,periodLength:n=30}=t??{};if(typeof i!="object")return{error:iR};if(!Array.isArray(e))return{error:Ae};if(!e.every(Cl))return{error:Va};let r=[],a=0,s={},{schedulingProfile:o}=_m({tournamentRecords:i});if(!o)return{issues:r,...pe};let{matchUps:l}=Fd({nextMatchUps:!0,tournamentRecords:i});for(let u of o){let{scheduleDate:d,venues:p=[]}=u;if(!(e!=null&&e.length)||e.includes(d)){for(let h of p||[])if(h){let{rounds:f}=h,m=[],{orderedMatchUpIds:g,scheduledRoundsDetails:v}=nM({tournamentRecords:i,periodLength:n,matchUps:l,rounds:f}),{matchUpDependencies:y}=od({tournamentRecords:i,matchUps:l}),b=I=>{let T;return v==null||v.find((w,S)=>{let U=w.matchUpIds.includes(I);return U&&(T=S),U}),T};if(g==null||g.forEach((I,T)=>{var w;let S=g.slice(T+1),U=Ar(S,((w=y==null?void 0:y[I])==null?void 0:w.matchUpIds)||[]);U.length&&m.push({matchUpId:I,shouldBeAfter:U})}),m.length){a+=m.length;let I=m.map(({matchUpId:T,shouldBeAfter:w})=>{let S=b(T),U=Pi(w.map(b));return s[d]||(s[d]={}),s[d][S]||(s[d][S]=[]),U.forEach(P=>{s[d][S].includes(P)||s[d][S].push(P)}),{matchUpId:T,matchUpRoundIndex:S,earlierRoundIndices:U,shouldBeAfter:w}});r.push(...I)}}}}let c={matchUpIdShouldBeAfter:Object.assign({},...r.map(u=>{let{matchUpId:d,shouldBeAfter:p,earlierRoundIndices:h}=u;return{[d]:{earlierRoundIndices:h,shouldBeAfter:p}}}))};return{issuesCount:a,profileIssues:c,roundIndexShouldBeAfter:s,...pe}}function ob(t){let{tournamentRecords:e,requestType:i}=t,n=ei(t,[{[Os]:!0}]);if(n.error)return n;let r={};for(let a of Object.values(e)){let{extension:s}=xi({element:a,name:GU}),o=(s==null?void 0:s.value)||[];for(let l of o){let{personId:c,requests:u}=l||{};r[c]||(r[c]=[]);for(let d of u)i&&d.requestType!==i||r[c].push(d)}}return{personRequests:r,...pe}}function SG(t){let{containerStructureId:e,roundSegment:i,isRoundRobin:n,tournamentId:r,roundNumber:a,structureId:s,eventId:o,drawId:l}=t,c=n?e:s,u=[r,o,l,c,a].join("|");return Zt({structureId:c,roundSegment:i,tournamentId:r,roundNumber:a,eventId:o,drawId:l,id:u})}function SJ({round:t,matchUps:e,events:i,tournamentRecords:n}){let r=i.find(p=>p.eventId===t.eventId),{eventType:a,category:s,categoryType:o}=r||{},{categoryName:l,ageCategoryCode:c}=s||{},u=Ol(e.map(({matchUpFormat:p})=>p)),d=0;return Object.keys(u).forEach(p=>{let h=u[p],f=YF({categoryName:l||c,tournamentId:t.tournamentId,eventId:t.eventId,tournamentRecords:n,matchUpFormat:p,categoryType:o,eventType:a});if(f.error)return f;let m=f.averageMinutes*h;isNaN(d)||(d+=m)}),{roundMinutes:d}}function w8e(t){return(t||[]).reduce((e,i)=>{var n,r;let a=(((n=i.finishingPositionRange)==null?void 0:n.winner)||[]).reduce((o,l)=>o+l,0),s=(((r=i.finishingPositionRange)==null?void 0:r.winner)||[]).join("-")||"";return!e.minFinishingSum||a<e.minFinishingSum?{minFinishingSum:a,winnerFinishingPositionRange:s}:e},{minFinishingSum:0,winnerFinishingPositionRange:""})}function TJ(t){let e=t.length,i=t.filter(({sides:c})=>c==null?void 0:c.some(({bye:u})=>u)).length||0,n=t.filter(({winningSide:c,matchUpStatus:u})=>c||va.includes(u)).length||0,r=t.filter(({schedule:c,matchUpStatus:u})=>(c==null?void 0:c.scheduledDate)&&(c==null?void 0:c.scheduledTime)&&u!==gn).length||0,a=e-i,s=a===n,o=a-r,l=a-r;return{unscheduledCount:o,incompleteCount:l,scheduledCount:r,completedCount:n,matchUpsCount:e,isScheduled:a===r,isComplete:s,byeCount:i}}function ZF({tournamentRecords:t,schedulingProfile:e,tournamentRecord:i,withRoundId:n}){if(i&&!t){if(typeof i!="object")return{error:iR};t={[i.tournamentId]:i}}if(e){let a=KF({tournamentRecords:t,schedulingProfile:e});if(a.error)return a}if(!e&&t){let a=_m({tournamentRecords:t});if(a.error)return a;e=a.schedulingProfile}if(!e)return{error:Ya};let r={};return{profileRounds:e.map(({venues:a,scheduleDate:s})=>a.map(({rounds:o})=>o.map(l=>{var c;let u=SG(l);return(c=u.roundSegment)!=null&&c.segmentsCount&&(r[u.id]=u.roundSegment.segmentsCount),Zt({id:n?u.id:void 0,scheduleDate:s,...u})}))).flat(1/0),segmentedRounds:r}}function XF({courtPrefix:t="C|",minRowsCount:e,courtsData:i}){if(!Array.isArray(i))return{error:Ae};let n=i==null?void 0:i.reduce((s,o)=>{let l=o.matchUps||[],c=Math.max(0,...l.map(u=>u.schedule.courtOrder||0));return c>s?c:s},1),r=e?Math.max(e,n):n,a=Mt(0,r).map(s=>({matchUps:Mt(0,i.length).map(o=>{let l=i[o],{courtId:c,venueId:u}=l;return{schedule:{courtOrder:s+1,venueId:u,courtId:c}}})}));return i.forEach((s,o)=>{var l;for(let c of s.matchUps){let u=(l=c.schedule)==null?void 0:l.courtOrder;u&&(a[u-1].matchUps[o]=c)}}),{courtPrefix:t,rows:a.map((s,o)=>Object.assign({rowId:`rowId-${o+1}`},...s.matchUps.map((l,c)=>({[`${t}${c}`]:l}))))}}var A0e={};Fi(A0e,{getEntriesAndSeedsCount:()=>JF,getMaxEntryPosition:()=>B7});function JF({policyDefinitions:t,drawDefinition:e,drawSize:i,drawId:n,event:r,stage:a}){if(!r)return{error:Qn};let{entries:s,stageEntries:o}=Fbe({drawDefinition:e,drawId:n,stage:a,event:r}),l=o.length,{drawSize:c}=cwe({participantsCount:l}),u=eM({drawSize:i??c,participantsCount:l,policyDefinitions:t});if(u.error)return fe({result:u,stack:"getEntriesAndSeedsCount"});let{seedsCount:d}=u;return{entries:s,seedsCount:d,stageEntries:o}}function B7(t){let{entries:e=[],entryStatus:i,stage:n}=t;return Math.max(...e.filter(r=>(!n||n===r.entryStage)&&(!i||r.entryStatus===i)&&!isNaN(r.entryPosition)).map(({entryPosition:r})=>di(r||0)),0)}var _0e={};Fi(_0e,{allCompetitionMatchUps:()=>Fd,allDrawMatchUps:()=>po,allEventMatchUps:()=>nf,allTournamentMatchUps:()=>Za,analyzeMatchUp:()=>nP,calculateWinCriteria:()=>jw,checkMatchUpIsComplete:()=>Wv,competitionScheduleMatchUps:()=>sM,drawMatchUps:()=>X7,eventMatchUps:()=>e2,filterMatchUps:()=>Cf,getAllDrawMatchUps:()=>pa,getAllStructureMatchUps:()=>Sn,getCheckedInParticipantIds:()=>Nw,getCompetitionMatchUps:()=>iP,getEventMatchUpFormatTiming:()=>j7,getHomeParticipantId:()=>q7,getMatchUpCompetitiveProfile:()=>MR,getMatchUpContextIds:()=>W7,getMatchUpDailyLimits:()=>i2,getMatchUpDailyLimitsUpdate:()=>G7,getMatchUpDependencies:()=>od,getMatchUpFormat:()=>Y7,getMatchUpFormatTiming:()=>NR,getMatchUpFormatTimingUpdate:()=>V7,getMatchUpScheduleDetails:()=>fF,getMatchUpType:()=>mF,getMatchUpsStats:()=>K7,getModifiedMatchUpFormatTiming:()=>QF,getParticipantResults:()=>YR,getPredictiveAccuracy:()=>z7,getRoundMatchUps:()=>yo,getRounds:()=>Z7,isValidMatchUpFormat:()=>Ll,matchUpActions:()=>NF,participantScheduledMatchUps:()=>H7,tallyParticipantResults:()=>QU,tournamentMatchUps:()=>t2,validMatchUp:()=>cF,validMatchUps:()=>lu});function k0e({tournamentRecords:t,extensionName:e}){if(typeof t!="object"||!Object.keys(t).length)return{error:Tr};let i=[],n;for(let r of Object.values(t)){let{extension:a}=xi({element:r,name:e});a&&!n&&(i.push({params:{extension:a,discover:!0},method:"addExtension"}),n=!0);let s=r.events??[];for(let o of s){let{eventId:l}=o,{extension:c}=xi({name:e,element:o});c&&i.push({params:{eventId:l,extension:c},method:"addEventExtension"})}}return{methods:i}}function V7({tournamentRecords:t}){return k0e({extensionName:sm,tournamentRecords:t})}var J$="ADULT",Q$="JUNIOR",YM="WHEELCHAIR",x0e={[Xg]:{allowModificationWhenMatchUpsScheduled:{courts:!1,venues:!1},defaultTimes:{averageTimes:[{categoryNames:[],minutes:{default:90}}],recoveryTimes:[{minutes:{[Nn]:30,default:60}}]},defaultDailyLimits:{[On]:2,[Nn]:2,total:3},matchUpAverageTimes:[{matchUpFormatCodes:[Fu],averageTimes:[{categoryNames:[],minutes:{default:90}},{categoryTypes:[YM],minutes:{default:120}}]},{matchUpFormatCodes:["SET3-S:6/TB7-F:TB10"],averageTimes:[{categoryNames:[],minutes:{default:85}}]},{matchUpFormatCodes:["SET3-S:6/TB7-F:TB7"],averageTimes:[{categoryNames:[],minutes:{default:70}}]},{matchUpFormatCodes:["SET3-S:4NOAD-F:TB7"],averageTimes:[{categoryNames:[],minutes:{default:55}}]},{matchUpFormatCodes:["SET3-S:4/TB7"],averageTimes:[{categoryNames:[],minutes:{default:60}}]},{matchUpFormatCodes:["SET3-S:4/TB7-F:TB7"],averageTimes:[{categoryNames:[],minutes:{default:50}}]},{matchUpFormatCodes:["SET3-S:4/TB7-F:TB10"],averageTimes:[{categoryNames:[],minutes:{default:55}}]},{matchUpFormatCodes:["SET3-S:4/TB5@3"],averageTimes:[{categoryNames:[],minutes:{default:45}}]},{matchUpFormatCodes:["SET1-S:8/TB7","SET1-S:8/TB7@7"],averageTimes:[{categoryNames:[],minutes:{default:40}}]},{matchUpFormatCodes:["SET1-S:5/TB9@4"],averageTimes:[{categoryNames:[],minutes:{default:30}}]},{matchUpFormatCodes:["SET1-S:6/TB7"],averageTimes:[{categoryNames:[],minutes:{default:30}}]},{matchUpFormatCodes:["SET1-S:6NOAD"],averageTimes:[{categoryNames:[],minutes:{default:30}}]},{matchUpFormatCodes:["SET1-S:4/TB7","SET1-S:4/TB5@3","SET3-S:TB10","SET1-S:T20"],averageTimes:[{categoryNames:[],minutes:{default:20}}]},{matchUpFormatCodes:["SET1-S:4NOAD"],averageTimes:[{categoryNames:[],minutes:{default:20}}]},{matchUpFormatCodes:["SET1-S:TB10"],averageTimes:[{categoryNames:[],minutes:{default:10}}]}],matchUpRecoveryTimes:[{matchUpFormatCodes:["SET3-S:6/TB7","SET3-S:6/TB7-F:TB10","SET3-S:6/TB7-F:TB7"],recoveryTimes:[{categoryTypes:[J$,YM],minutes:{default:60,[Nn]:30}},{categoryTypes:[Q$],minutes:{default:60,[Nn]:60}}]},{matchUpFormatCodes:["SET3-S:4/TB7-F:TB7","SET3-S:4/TB7-F:TB10","SET3-S:4NOAD-F:TB7","SET3-S:4/TB7","SET3-S:4/TB5@3"],recoveryTimes:[{categoryTypes:[J$,YM],minutes:{default:30}},{categoryTypes:[Q$],minutes:{default:60}}]},{matchUpFormatCodes:["SET1-S:8/TB7","SET1-S:8/TB7@7","SET1-S:5/TB9@4","SET1-S:6/TB7","SET1-S:6NOAD","SET1-S:4/TB7","SET1-S:4NOAD","SET3-S:TB10","SET1-S:T20"],recoveryTimes:[{categoryNames:[],minutes:{default:30}}]},{matchUpFormatCodes:["SET1-S:4/TB5@3"],recoveryTimes:[{categoryTypes:[J$,Q$],minutes:{default:30}},{categoryTypes:[YM],minutes:{default:15}}]},{matchUpFormatCodes:["SET1-S:TB10"],recoveryTimes:[{categoryNames:[],minutes:{default:15}}]}],matchUpDailyLimits:[]}},S8e=x0e;function j7({tournamentRecord:t,matchUpFormats:e,categoryType:i,event:n}){if(!n)return{error:Qn};let r=[],a;if(e!=null&&e.length){let d=[];r=e.map(p=>{let h=typeof p=="string"?{matchUpFormat:p}:p;if(!d.includes(h==null?void 0:h.matchUpFormat)&&Ll({matchUpFormat:h==null?void 0:h.matchUpFormat}))return d.push(h.matchUpFormat),h}).filter(Boolean)}else{let{policy:d}=eb({policyType:Kc,tournamentRecord:t,event:n});if(d!=null&&d.matchUpFormats)r=d==null?void 0:d.matchUpFormats;else{let{extension:p}=xi({name:sm,element:n}),h,f;p!=null&&p.value?{matchUpAverageTimes:h,matchUpRecoveryTimes:f}=p.value:{matchUpAverageTimes:h,matchUpRecoveryTimes:f}=S8e[Xg],r=Pi([...(h||[]).map(m=>m.matchUpFormatCodes),...(f||[]).map(m=>m.matchUpFormatCodes)].flat()).map(m=>({matchUpFormat:m})),a="default scheduling policy in use"}}let{eventType:s,eventId:o,category:l}=n,c=(l==null?void 0:l.categoryName)??(l==null?void 0:l.ageCategoryCode)??o;if(!o)return{error:Qn};let u=r.map(({matchUpFormat:d,description:p})=>{let h=NR({tournamentRecord:t,matchUpFormat:d,categoryName:c,categoryType:i,eventType:s,event:n});return{matchUpFormat:d,description:p,...h}});return Zt({eventMatchUpFormatTiming:u,info:a})}function QF(t){let e=ei(t,[{[Ia]:!0},{[ps]:m=>Ll({matchUpFormat:m}),[cc]:aR,[D6]:!0}]);if(e.error)return e;let{tournamentRecord:i,matchUpFormat:n,event:r}=t,{extension:a}=xi({name:sm,element:r}),s=a==null?void 0:a.value,{extension:o}=xi({element:i,name:sm}),l=o==null?void 0:o.value,c=(s==null?void 0:s.matchUpAverageTimes)&&TD({...s,matchUpFormat:n}),u=(l==null?void 0:l.matchUpAverageTimes)&&TD({...l,matchUpFormat:n}),d=[c,u].find(m=>m),p=(s==null?void 0:s.matchUpRecoveryTimes)&&UD({...s,matchUpFormat:n}),h=(l==null?void 0:l.matchUpRecoveryTimes)&&UD({...l,matchUpFormat:n}),f=[p,h].find(m=>m);return{matchUpFormat:n,recoveryTimes:f,averageTimes:d}}function G7({tournamentRecords:t}){return k0e({extensionName:vR,tournamentRecords:t})}var aM=({scheduleAttributes:t=["scheduledDate","scheduledTime"],schedule:e={}})=>!!Object.keys(e).filter(i=>t.includes(i)).filter(i=>e[i]).length;function H7({scheduleAttributes:t=["scheduledDate","scheduledTime"],matchUps:e=[]}){if(!lu(e))return{error:Em};if(!Array.isArray(t))return{error:Ae};let i=e.filter(Boolean).filter(({schedule:n})=>aM({schedule:n,scheduleAttributes:t})).reduce((n,r)=>{let{schedule:a}=r,s=Mi(a==null?void 0:a.scheduledDate),o=sr(a==null?void 0:a.scheduledTime);return s&&o&&(n[s]?n[s].push(r):n[s]=[r]),n},{});return Object.keys(i).forEach(n=>{i[n].sort((r,a)=>{var s,o;return bve(sr((s=r.schedule)==null?void 0:s.scheduledTime),sr((o=a.schedule)==null?void 0:o.scheduledTime))})}),{...pe,scheduledMatchUps:i}}function T8e({tournamentRecords:t}){var e;let i={},n=[];for(let r of Object.values(t))for(let a of r.events??[]){let s=cu({event:a}),o=s==null?void 0:s.drawDetails;tn(o)?(Object.assign(i,o),n.push(...Object.keys(o).filter(l=>y8({drawId:l,drawDetails:o})))):(e=s==null?void 0:s.drawIds)!=null&&e.length&&n.push(...s.drawIds)}return{drawIds:n,detailsMap:i}}function sk({schedulingProfile:t,matchUps:e=[]}){let i={},n=({eventId:o,drawId:l,structureId:c,roundNumber:u})=>`${o}|${l}|${c}${u}`;t!=null&&t.length&&t.map(({venues:o})=>o.map(({rounds:l})=>l)).flat().forEach(o=>{o.sort((l,c)=>(l.sortOrder||0)-(c.sortOrder||0)).forEach(({eventId:l,drawId:c,structureId:u,roundNumber:d},p)=>{let h=n({eventId:l,drawId:c,structureId:u,roundNumber:d});i[h]=p})});let r=[],a={noScheduledDate:[]};for(let o of e){let l=o.schedule||{},c=l.scheduledDate&&Mi(l.scheduledDate)||l.scheduledTime&&Mi(l.scheduledTime)||"noScheduledDate";a[c]||(a[c]=[]),a[c].push(o)}let s=Object.keys(a).sort();for(let o of s){let l=a[o],c={noScheduledTime:[]};for(let d of l){let p=d.schedule||{},h=p.scheduledTime&&sr(p.scheduledTime)||"noScheduledTime";c[h]||(c[h]=[]),c[h].push(d)}let u=Object.keys(c).sort();for(let d of u){let p=c[d];p.sort((h,f)=>{let m=i[n(h)]||0,g=i[n(f)]||0;return m-g}),r.push(...p)}}return r}function e2(t){let{participants:e,contextContent:i,participantMap:n}=t,{tournamentAppliedPolicies:r,scheduleVisibilityFilters:a,participantsProfile:s,afterRecoveryTimes:o,policyDefinitions:l,useParticipantMap:c,tournamentRecord:u,usePublishState:d,contextFilters:p,matchUpFilters:h,contextProfile:f,nextMatchUps:m,tournamentId:g,inContext:v,context:y,event:b}=t;if(!b)return{error:Qn};let{eventId:I,eventName:T,endDate:w,eventType:S,category:U,gender:P}=b??{},E={...y,...Zt({surfaceCategory:b.surfaceCategory??(u==null?void 0:u.surfaceCategory),indoorOutDoor:b.indoorOutdoor??(u==null?void 0:u.indoorOutdoor),tournamentId:g??(u==null?void 0:u.tournamentId),endDate:w??(u==null?void 0:u.endDate),eventName:T,eventType:S,category:U,eventId:I,gender:P})},R;!e&&u&&({participants:e,participantMap:n,groupInfo:R}=Qy({participantsProfile:s,policyDefinitions:l,useParticipantMap:c,tournamentRecord:u,contextProfile:f,inContext:v})),f&&!i&&(i=Mm({policyDefinitions:l,tournamentRecord:u,contextProfile:f,event:b}));let C=cu({event:b});return{...(b.drawDefinitions??[]).reduce((M,_)=>{var A;let N=WU({hydrateParticipants:t.hydrateParticipants,context:E,tournamentAppliedPolicies:r,scheduleVisibilityFilters:a,tournamentParticipants:e,participantsProfile:s,afterRecoveryTimes:o,policyDefinitions:l,tournamentRecord:u,usePublishState:d,contextContent:i,contextFilters:p,matchUpFilters:h,participantMap:n,publishStatus:C,contextProfile:f,drawDefinition:_,nextMatchUps:m,inContext:v,event:b});return(A=Object.keys(N))==null||A.forEach(k=>{Array.isArray(N[k])&&(M[k]||(M[k]=[]),M[k]=M[k].concat(N[k]))}),M},{}),...pe,groupInfo:R}}function t2(t){if(!(t!=null&&t.tournamentRecord))return{error:dt};let e=t.contextContent,{scheduleVisibilityFilters:i,participantsProfile:n,afterRecoveryTimes:r,policyDefinitions:a,tournamentRecord:s,inContext:o=!0,usePublishState:l,contextFilters:c,matchUpFilters:u,contextProfile:d,nextMatchUps:p,context:h}=t,f=t.tournamentId??s.tournamentId,m=(s==null?void 0:s.events)??[],{participants:g,participantMap:v,groupInfo:y}=Qy({participantsProfile:n,policyDefinitions:a,tournamentRecord:s,contextProfile:d,inContext:o});d&&!e&&(e=Mm({policyDefinitions:a,tournamentRecord:s,contextProfile:d}));let{appliedPolicies:b}=fn({tournamentRecord:s}),I=(c==null?void 0:c.eventIds)??[];return{...m.filter(T=>!I.includes(T.eventId)).map(T=>{var w,S,U;let P={eventDrawsCount:((S=(w=kr({event:T}).flightProfile)==null?void 0:w.flights)==null?void 0:S.length)||((U=T.drawDefinitions)==null?void 0:U.length)||0,...h};return e2({hydrateParticipants:t.hydrateParticipants,context:P,tournamentAppliedPolicies:b,scheduleVisibilityFilters:i,participantsProfile:n,afterRecoveryTimes:r,policyDefinitions:a,tournamentRecord:s,usePublishState:l,contextFilters:c,contextProfile:d,contextContent:e,matchUpFilters:u,participantMap:v,participants:g,tournamentId:f,nextMatchUps:p,inContext:o,event:T})}).reduce((T,w)=>{var S;return(S=w&&Object.keys(w).filter(U=>!["success","matchUpsMap"].includes(U)))==null||S.forEach(U=>{Array.isArray(w[U])&&(T[U]||(T[U]=[]),T[U]=T[U].concat(w[U]),T.matchUpsCount!==void 0?T.matchUpsCount+=w[U].length:T.matchUpsCount=w[U].length)}),T},{matchUpsCount:0}),groupInfo:y,participants:g}}function iP({scheduleVisibilityFilters:t,hydrateParticipants:e,participantsProfile:i,tournamentRecords:n,useParticipantMap:r,policyDefinitions:a,usePublishState:s,matchUpFilters:o,contextFilters:l,nextMatchUps:c,inContext:u}){if(typeof n!="object"||!Object.keys(n).length)return{error:Tr};let d=Object.keys(n).map(f=>{let m=n[f];return t2({scheduleVisibilityFilters:t,hydrateParticipants:e,participantsProfile:i,useParticipantMap:r,policyDefinitions:a,tournamentRecord:m,usePublishState:s,matchUpFilters:o,contextFilters:l,nextMatchUps:c,inContext:u})}),p={},h={};return{...d.reduce((f,m)=>(Object.keys(m).forEach(g=>{if(g==="groupInfo")Object.assign(h,m[g]);else if(g==="participants")for(let v of m[g]??[])p[v.participantId]=v;else Array.isArray(m[g])&&(f[g]||(f[g]=[]),f[g]=f[g].concat(m[g]))}),f),{}),groupInfo:h,mappedParticipants:p}}function sM(t){var e,i,n,r,a,s,o;if(typeof(t==null?void 0:t.tournamentRecords)!="object"||!Object.keys(t==null?void 0:t.tournamentRecords).length)return{error:Tr};let{courts:l,venues:c}=Am(t),u=_m(t).schedulingProfile,{sortDateMatchUps:d=!0,courtCompletedMatchUps:p,alwaysReturnCompleted:h,activeTournamentId:f,tournamentRecords:m,withCourtGridRows:g,minCourtGridRows:v,usePublishState:y,status:b=vc,sortCourtsData:I}=t,T=f??ww()??Object.keys(m)[0],w=y?LR({tournamentRecord:m[T],status:b}):void 0,S=h?iP({...t,matchUpFilters:{...t.matchUpFilters,matchUpStatuses:[$r]},contextFilters:t.contextFilters}).completedMatchUps:[];if(y&&!((e=w==null?void 0:w.orderOfPlay)!=null&&e.published))return{completedMatchUps:S,dateMatchUps:[],courtsData:[],venues:c};let U,P;y&&({drawIds:U,detailsMap:P}=T8e({tournamentRecords:m})),U!=null&&U.length&&(t.contextFilters||(t.contextFilters={}),(i=t.contextFilters)!=null&&i.drawIds?t.contextFilters.drawIds=t.contextFilters.drawIds.filter(F=>U.includes(F)):t.contextFilters.drawIds=U),(n=w==null?void 0:w.eventIds)!=null&&n.length&&(t.matchUpFilters||(t.matchUpFilters={}),(r=t.matchUpFilters)!=null&&r.eventIds&&t.matchUpFilters.eventIds.length?t.matchUpFilters.eventIds=t.matchUpFilters.eventIds.filter(F=>w.eventIds.includes(F)):t.matchUpFilters.eventIds=w.eventIds),(a=w==null?void 0:w.scheduledDates)!=null&&a.length&&(t.matchUpFilters||(t.matchUpFilters={}),t.matchUpFilters.scheduledDates&&t.matchUpFilters.scheduledDates.length?t.matchUpFilters.scheduledDates=t.matchUpFilters.scheduledDates.filter(F=>w.scheduledDates.includes(F)):t.matchUpFilters.scheduledDates=w.scheduledDates),h&&(t.matchUpFilters||(t.matchUpFilters={}),(o=(s=t.matchUpFilters)==null?void 0:s.excludeMatchUpStatuses)!=null&&o.length?t.matchUpFilters.excludeMatchUpStatuses.includes($r)||t.matchUpFilters.excludeMatchUpStatuses.push($r):t.matchUpFilters.excludeMatchUpStatuses=[$r]);let{completedMatchUps:E,upcomingMatchUps:R,pendingMatchUps:C,groupInfo:M,mappedParticipants:_}=iP({...t,matchUpFilters:t.matchUpFilters,contextFilters:t.contextFilters}),A=[...R??[],...C??[]];P&&(!(U!=null&&U.length)||Object.keys(P).length)&&(A=A.filter(F=>{var V,j;let{drawId:B,structureId:z,stage:W}=F;if(!((j=(V=P==null?void 0:P[B])==null?void 0:V.publishingDetail)!=null&&j.published))return!1;if(P[B].stageDetails){let Z=Object.keys(P[B].stageDetails),K=Z.filter(J=>!P[B].stageDetails[J].published),Q=Z.filter(J=>P[B].stageDetails[J].published);return K.length&&K.includes(W)?!1:Q.length&&Q.includes(W)?!0:K.length&&!K.includes(W)&&!Q.length}if(P[B].structureDetails){let Z=Object.keys(P[B].structureDetails),K=Z.filter(J=>!P[B].structureDetails[J].published),Q=Z.filter(J=>P[B].structureDetails[J].published);return K.length&&K.includes(z)?!1:Q.length&&Q.includes(z)?!0:K.length&&!K.includes(z)&&!Q.length}return!0}));let N=d?sk({matchUps:A,schedulingProfile:u}):A,k=l==null?void 0:l.map(F=>{let V=$(F);return{surfaceCategory:(F==null?void 0:F.surfaceCategory)??"",matchUps:V,...F}}),O={completedMatchUps:h?S:E,mappedParticipants:t.hydrateParticipants?void 0:_,dateMatchUps:N,courtsData:k,groupInfo:M,venues:c};if(g){let{rows:F,courtPrefix:V}=XF({minRowsCount:v,courtsData:k});O.courtPrefix=V,O.rows=F}return{...O,...pe};function $({courtId:F}){let V=(p?N.concat(E??[]):N).filter(j=>{var B,z,W;return((B=j.schedule)==null?void 0:B.courtId)===F||((W=(z=j.schedule)==null?void 0:z.allocatedCourts)==null?void 0:W.map(({courtId:Z})=>Z).includes(F))});return I?sk({matchUps:V,schedulingProfile:u}):V}}function i2({tournamentRecords:t,tournamentId:e}){if(typeof t!="object"||!Object.keys(t).length)return{error:Tr};let i=Object.keys(t).filter(r=>!e||r===e),n;return i.forEach(r=>{let a=t[r],{matchUpDailyLimits:s}=U8e({tournamentRecord:a});n=s}),{matchUpDailyLimits:n}}function U8e(t){var e;let i=ei(t,[{[Ia]:!0}]);if(i.error)return i;let{tournamentRecord:n}=t,{policy:r}=eb({policyType:Xg,tournamentRecord:n}),{extension:a}=xi({element:n,name:vR}),s=(e=a==null?void 0:a.value)==null?void 0:e.dailyLimits,o=r==null?void 0:r.defaultDailyLimits;return{matchUpDailyLimits:s||o}}function z7(t){var e,i,n,r;let{matchUps:a}=t,{singlesForDoubles:s,tournamentRecord:o,drawDefinition:l,excludeMargin:c,exclusionRule:u,zoneDoubling:d,matchUpType:p,scaleName:h,eventId:f,zonePct:m,drawId:g,event:v}=t;if(!o&&!a)return{error:dt};if(p&&![On,Nn].includes(p))return{error:Ae,info:{matchUpType:p}};if(a&&!lu(a))return{error:Ae,context:{matchUps:a}};let y=Ea[h],b=(y==null?void 0:y.ascending)??t.ascending??!1,I=(y==null?void 0:y.accessor)??t.valueAccessor,T=Array.isArray(y==null?void 0:y.range)?Math.abs(y.range[0]-y.range[1]):0,w=wi(m)&&T?(m??0/100)*T:t.zoneMargin??T,S={withScaleValues:!0,withCompetitiveness:!0},U={matchUpTypes:p?[p]:[On,Nn]},P=o==null?void 0:o.participants;(e=a==null?void 0:a[0])!=null&&e.hasContext?g?a=a.filter(O=>O.drawId===g):f&&(a=a.filter(O=>O.eventId===f)):a===void 0&&(a=g&&!l&&[]||!g&&f&&!v&&[]||g&&((i=po({inContext:!0,drawDefinition:l,contextFilters:U,contextProfile:S,participants:P}))==null?void 0:i.matchUps)||!g&&f&&((n=nf({inContext:!0,contextFilters:U,contextProfile:S,participants:P,event:v}))==null?void 0:n.matchUps)||((r=Za({tournamentRecord:o,contextFilters:U,contextProfile:S}))==null?void 0:r.matchUps)||[]),p&&(a=a.filter(O=>O.matchUpType===p));let E=a.filter(({winningSide:O,score:$,sides:F,matchUpStatus:V})=>![ss,Ki,un,HU,ul].includes(V??"")&&ya({score:$})&&(F==null?void 0:F.length)===2&&O),R=E8e({matchUps:E,excludeMargin:c,exclusionRule:u,valueAccessor:I,ascending:b,scaleName:h}),C=!d||Br(On)(p)?w:(w||0)*2,M=w?E.map(({competitiveProfile:O,matchUpType:$,score:F,sides:V})=>{let j=O0e({singlesForDoubles:s,valueAccessor:I,matchUpType:$,scaleName:h,sides:V}),B=Math.abs(j[0].value-j[1].value);return{competitiveness:O==null?void 0:O.competitiveness,valuesGap:B,score:F}}).filter(({valuesGap:O})=>O<=C):[],_=D8e({zoneData:M}),A=_&&[].concat(Object.values(_)).flat().length,N=A&&Object.assign({},...Object.keys(_).map(O=>({[O]:Math.round(1e4*_[O].length/A)/100}))),k=E.length-((M==null?void 0:M.length)||0);return{...pe,relevantMatchUps:E,zoneDistribution:N,zoneData:M,accuracy:R,nonZone:k}}function D8e({zoneData:t}){let e={[r8]:[],[KE]:[],[ZE]:[]};for(let i of t){let{competitiveness:n,score:r,valuesGap:a}=i;e[n]&&e[n].push({score:r,valuesGap:a})}return e}function O0e({singlesForDoubles:t,exclusionRule:e,valueAccessor:i,matchUpType:n,scaleName:r,sides:a}){let s=e==null?void 0:e.range.sort(),o=l=>{let c=l==null?void 0:l[e==null?void 0:e.valueAccessor];return{exclude:e&&c>=s[0]&&c<=s[1],exclusionValue:c}};return a.sort((l,c)=>l.sideNumber-c.sideNumber).map(({participant:l})=>{let c=[],u=l==null?void 0:l.individualParticipants;if(u!=null&&u.length){let d=[],p=0;for(let h of u){let{scaleValue:f,value:m}=UJ({singlesForDoubles:t,valueAccessor:i,participant:h,matchUpType:n,scaleName:r}),{exclude:g,exclusionValue:v}=o(f);g&&c.push(v),d.push(f),m&&!isNaN(p)?p+=m:p=void 0}return{participantName:l.participantName,exclusionValues:c,scaleValues:d,value:p}}else if(l){let{scaleValue:d,value:p}=UJ({singlesForDoubles:t,valueAccessor:i,matchUpType:n,participant:l,scaleName:r}),{exclude:h,exclusionValue:f}=o(d);return h&&c.push(f),{participantName:l.participantName,exclusionValues:c,scaleValue:d,value:p}}else return{}})}function UJ({singlesForDoubles:t,valueAccessor:e,matchUpType:i,participant:n,scaleName:r}){var a,s,o,l,c;let u=t?On:i,d=(s=(a=n==null?void 0:n.rankings)==null?void 0:a[u])==null?void 0:s.find(f=>f.scaleName===r),p=(c=((l=(o=n==null?void 0:n.ratings)==null?void 0:o[u])==null?void 0:l.find(f=>f.scaleName===r))||d)==null?void 0:c.scaleValue,h=e?p==null?void 0:p[e]:p;return{scaleValue:p,value:h}}function E8e({excludeMargin:t,exclusionRule:e,valueAccessor:i,ascending:n,scaleName:r,matchUps:a}){let s={affirmative:[],negative:[],excluded:[]};for(let c of a){let{matchUpType:u,sides:d,score:p,winningSide:h}=c;if(!h)continue;if(e&&(!e.valueAccessor||!e.range))return{info:"exclusionRule requires valueAccessor and range",error:si};let f=h-1,m=O0e({exclusionRule:e,valueAccessor:i,matchUpType:u,scaleName:r,sides:d});if(e){let T=m.map(({exclusionValues:w})=>w).flat();if(T.length){s.excluded.push({scoreString:p==null?void 0:p.scoreStringSide1,exclusionValues:T,winningSide:h,sideValues:m});continue}}if(m.filter(T=>![void 0,"",null].includes(T.value)).length<2){s.excluded.push({scoreString:p==null?void 0:p.scoreStringSide1,missingValues:!0,winningSide:h,sideValues:m});continue}let g=m[f].value-m[1-f].value,v=parseFloat(t||0),y=v&&Math.abs(g)<v;if(y){s.excluded.push({scoreString:p==null?void 0:p.scoreStringSide1,excludeMargin:t,winningSide:h,excludeGap:y,sideValues:m,valuesGap:g});continue}let b=n?g:g*-1,I=h===1?p==null?void 0:p.scoreStringSide1:p==null?void 0:p.scoreStringSide2;b>0?s.affirmative.push({winningScoreString:I,winningSide:h,sideValues:m,valuesGap:g,score:p}):s.negative.push({winningScoreString:I,winningSide:h,sideValues:m,valuesGap:g,score:p})}let o=s.affirmative.length+s.negative.length,l=o&&s.affirmative.length/o*100;return s.percent=l?Math.round(100*l)/100:0,s}function jw({collectionDefinitions:t=[],collectionGroups:e=[]}){let i=0,{groupValueNumbers:n}=FIe({collectionGroups:e}),r;for(let a of t||[]){let{collectionValueProfiles:s,collectionGroupNumber:o,collectionValue:l,matchUpCount:c,matchUpValue:u,scoreValue:d,setValue:p}=a,h=o&&n.includes(o);if(wi(p||d))r=!0;else{if(h)continue;if(typeof l=="number"&&wi(l))i+=l;else if(Array.isArray(s)&&s!=null&&s.length)for(let f of s)i+=f.matchUpValue;else typeof u=="number"&&wi(u)&&(i+=(c??0)*u)}}for(let a of e)i+=a.groupValue??0;return r||!i?{aggregateValue:!0,...pe}:{valueGoal:Math.floor(i/2)+1,...pe}}function q7(t){let{timeStamp:e,schedule:i,matchUp:n}=t,r=ei(t,[{[ef]:!0}]);if(r.error)return r;let{itemValue:a,timeStamp:s}=nb({timeItems:(n==null?void 0:n.timeItems)||[],itemType:u8});return!i||s&&e&&new Date(s).getTime()>new Date(e).getTime()?{homeParticipantId:a}:i}function W7({matchUps:t,matchUpId:e}){if(!lu(t))return{error:Ae};let i=t.find(o=>o.matchUpId===e),{drawId:n,eventId:r,structureId:a,tournamentId:s}=i||{};return{matchUpId:e,drawId:n,eventId:r,structureId:a,tournamentId:s}}function t1(t,e){if(!tn(t))return{error:Ae};if(!Array.isArray(e))return{error:Ae};let i={};for(let{param:n,error:r,attr:a}of e){let s=P8e({params:t,param:n,attr:a,error:r});if(s!=null&&s.error)return s;i[n]=s}return i}function P8e({params:t,param:e,attr:i,error:n}){if(e===YL&&tn(t.drawDefinition)&&ur(t.structureId)){let r=(t.drawDefinition.structures??[]).find(({structureId:a})=>a===t.structureId);return!r.length&&n?{error:n}:{structure:r}}if(e===ef){let r=U0e({...t,...i});return r.error&&n?{...r,error:n}:r}return{error:Ya,info:{param:e}}}function Y7(t){var e,i;let{structureId:n,matchUpId:r,event:a}=t,s=t.drawDefinition,o=ei(t,[{[Ia]:!0},{[M6]:{[zL]:!1,[Wp]:!1,[yye]:!1,[Zg]:!1}}]);if(o[$u])return o;let l=(e=t1(t,[{[BU]:ef,[$u]:si}]))==null?void 0:e.matchUp;if(r&&l!=null&&l.error)return l;!s&&l!=null&&l.drawDefinition&&(s=l==null?void 0:l.drawDefinition);let c=l==null?void 0:l.structure;if(!c&&n&&!r){if(!s)return{error:jd};let f=fi({drawDefinition:s,structureId:n});if(f.error)return f;c=f.structure}let u=c==null?void 0:c.matchUpFormat,d=s==null?void 0:s.matchUpFormat,p=a==null?void 0:a.matchUpFormat,h=((i=l==null?void 0:l.matchUp)==null?void 0:i.matchUpFormat)||u||d||p;return{structureDefaultMatchUpFormat:u,eventDefaultMatchUpFormat:p,drawDefaultMatchUpFormat:d,matchUpFormat:h}}function K7({profileBands:t,tournamentRecord:e,matchUps:i}){if(!lu(i))return{error:Em};let n=!t&&eb({policyType:Pf,tournamentRecord:e}).policy,r=t||(n==null?void 0:n.profileBands)||a8[Pf].profileBands,a=i.filter(({winningSide:p})=>p),s=a.map(abe),o=(p,h)=>{let f=rbe(h,r);return p[f]+=1,p},l=sbe(s).reduce((p,h)=>o(p,h),{[r8]:0,[KE]:0,[ZE]:0,[Qye]:0}),c=Object.keys(l).reduce((p,h)=>(l[h]||0)+p,0),u=Object.keys(l).map(p=>{let h=parseFloat((l[p]/c).toFixed(4));return{[p]:h*100}}),d=a.filter(({matchUpStatus:p})=>p===YX).length;return u.push({[YX]:parseFloat((d/c).toFixed(4))*100}),{competitiveBands:Object.assign({},...u),...pe}}var{stageOrder:DJ}=sqe;function C8e(t,e){return t.eventName.localeCompare(e.eventName)||t.eventId.localeCompare(e.eventId)||(DJ[t==null?void 0:t.stage]||0)-(DJ[e==null?void 0:e.stage]||0)||e.matchUpsCount-t.matchUpsCount||`${t.stageSequence}-${t.roundNumber}-${t.minFinishingSum}`.localeCompare(`${e.stageSequence}-${e.roundNumber}-${e.minFinishingSum}`)}function Z7({excludeScheduleDateProfileRounds:t,excludeScheduledRounds:e,excludeCompletedRounds:i,inContextMatchUps:n,tournamentRecords:r,schedulingProfile:a,tournamentRecord:s,withSplitRounds:o,matchUpFilters:l,scheduleDate:c,withRoundId:u,venueId:d,context:p}){var h;if(n&&!Array.isArray(n||typeof n[0]!="object"))return{error:Ae,inContextMatchUps:n};if(s&&!r){if(typeof s!="object")return{error:iR};r={[s.tournamentId]:s}}let f=typeof r!="object"||!Object.keys(r).length;if((d||c||!n||!a&&(t||i||a||o))&&f)return{error:Tr};let m=Object.assign({},...Object.values(r??{}).map(({venues:S=[],tournamentId:U})=>({[U]:S==null?void 0:S.map(({venueId:P})=>P)}))),g=Object.values(r??{}).map(({events:S=[],tournamentId:U,startDate:P,endDate:E})=>S.map(R=>({...R,validVenueIds:m[U],startDate:R.startDate??P,endDate:R.endDate??E}))).flat(),{segmentedRounds:v,profileRounds:y}=r&&(t||i||a||o)&&ZF({tournamentRecords:r,schedulingProfile:a})||{},b=t&&Object.assign({},...y.map(S=>({[S.id]:S}))),I=n||r&&((h=Fd({tournamentRecords:r,matchUpFilters:l}))==null?void 0:h.matchUps)||[],T=[],w=I&&Object.values(I.reduce((S,U)=>{var P;let E=SG(U).id,R=v==null?void 0:v[E],C=[...((P=S[E])==null?void 0:P.matchUps)??[],U],{containerStructureId:M,stageSequence:_,structureName:A,tournamentId:N,isRoundRobin:k,matchUpType:O,roundNumber:$,roundOffset:F,structureId:V,eventName:j,roundName:B,drawName:z,eventId:W,drawId:Z}=U,K=k?M:V;return{...S,[E]:{id:u?E:void 0,structureId:K,stageSequence:_,segmentsCount:R,structureName:A,tournamentId:N,matchUpType:O,roundNumber:$,roundOffset:F,eventName:j,roundName:B,drawName:z,matchUps:C,eventId:W,drawId:Z}}},{})).map(S=>{let{minFinishingSum:U,winnerFinishingPositionRange:P}=w8e(S.matchUps),E=S.segmentsCount;if(E){let O=S.matchUps.length/E;return Na(S.matchUps.sort(($,F)=>$.roundPosition-F.roundPosition),O).map(($,F)=>{let{unscheduledCount:V,incompleteCount:j,matchUpsCount:B,isScheduled:z,isComplete:W,byeCount:Z}=TJ($),K=SJ({matchUps:S.matchUps,tournamentRecords:r,events:g,round:S});return Zt({...S,...p,roundSegment:{segmentsCount:E,segmentNumber:F+1},winnerFinishingPositionRange:P,unscheduledCount:V,incompleteCount:j,minFinishingSum:U,matchUpsCount:B,isScheduled:z,roundTiming:K,isComplete:W,byeCount:Z,matchUps:$})})}let{unscheduledCount:R,incompleteCount:C,matchUpsCount:M,isScheduled:_,isComplete:A,byeCount:N}=TJ(S.matchUps),k=SJ({matchUps:S.matchUps,tournamentRecords:r,events:g,round:S});return Zt({...S,...p,winnerFinishingPositionRange:P,unscheduledCount:R,incompleteCount:C,minFinishingSum:U,matchUpsCount:M,isScheduled:_,roundTiming:k,isComplete:A,byeCount:N})}).flat().filter(S=>{if(t){let F=Mi(t),V=u?S.id:SG(S).id;if(F&&b[V]&&Mi(b[V].scheduleDate)===F)return!1}let{isComplete:U,isScheduled:P}=S,E=!i||!U,R=!e||!P,C=d||c?g==null?void 0:g.find(({eventId:F})=>F===S.eventId):void 0,M=(C==null?void 0:C.startDate)??(s==null?void 0:s.startDate),_=(C==null?void 0:C.endDate)??(s==null?void 0:s.endDate),A=!c||!M||new Date(c)>=new Date(M),N=!c||!_||new Date(c)<=new Date(_),k=A&&N,O=!d||(C==null?void 0:C.validVenueIds.includes(d)),$=E&&R&&O&&k;return $||T.push(S),$}).sort(C8e)||[];return{...pe,rounds:w,excludedRounds:T}}function nP(t){var e;let{matchUp:i,sideNumber:n,setNumber:r,isTiebreakValue:a,isPointValue:s}=t||{},{matchUpFormat:o}=t||{};if(!i)return{error:ll};o=o||(i==null?void 0:i.matchUpFormat);let l=Do(o),c=!!(i!=null&&i.winningSide),u=(e=i.score)==null?void 0:e.sets,d=u==null?void 0:u.length,p=r&&r-1,h=!!(u!=null&&u.find((Z,K)=>Z.setNumber===r&&K===p)),f=(u==null?void 0:u.filter(Z=>Z==null?void 0:Z.winningSide))||[],m=(f==null?void 0:f.length)||0,g=r&&(u==null?void 0:u.slice(r))||[],v=!!(d&&r&&g!=null&&g.reduce((Z,K)=>(!K||!K.side1Score&&!K.side2Score&&!K.side1TiebreakScore&&!K.side2TiebreakScore&&!K.side1PointScore&&!K.side2PointScore)&&Z,!0)),y=r<=d&&u.find(Z=>Z.setNumber===r),b=y&&tP({setObject:y,matchUpScoringFormat:l}),{isCompletedSet:I,sideGameScores:T,sideTiebreakScores:w}=b||{},S=!!(y&&!I&&v||r&&r===d+1&&!c),U=[1,2].includes(n),P=U?n-1:0,E=y&&U&&(!a&&!s&&T[P]!==void 0&&T[P]||a&&w[P]!==void 0&&w[P]),R=!!E,C=f==null?void 0:f.map(Z=>tP({setObject:Z,matchUpScoringFormat:l}).isValidSetOutcome).reduce((Z,K)=>Z&&K,!0),M=f.reduce((Z,K)=>{let{winningSide:Q}=K,J=Q-1;return Z[J]++,Z},[0,0]),_=i==null?void 0:i.winningSide,A=_&&_-1,N=1-A,k=M[A],O=M[N],$=Math.max(...M),F=Ol(M)[$],{bestOf:V,exactly:j}=l??{},B=V&&Math.ceil(V/2)||j||1,z=$===B&&F===1&&M.indexOf($)+1||void 0,W=k>O&&_===z;return{completedSetsHaveValidOutcomes:C,validMatchUpWinningSide:W,calculatedWinningSide:z,matchUpScoringFormat:l,validMatchUpOutcome:z&&C&&W,isLastSetWithValues:v,completedSetsCount:m,isCompletedMatchUp:c,isValidSideNumber:U,hasExistingValue:R,existingValue:E,isExistingSet:h,isActiveSet:S,...b}}function X7({participants:t,tournamentAppliedPolicies:e,scheduleVisibilityFilters:i,participantsProfile:n,afterRecoveryTimes:r,policyDefinitions:a,useParticipantMap:s,tournamentRecord:o,usePublishState:l,contextFilters:c,contextContent:u,matchUpFilters:d,participantMap:p,publishStatus:h,contextProfile:f,drawDefinition:m,nextMatchUps:g,tournamentId:v,inContext:y,context:b,event:I}){let{eventId:T,eventName:w,endDate:S,eventType:U,category:P,gender:E}=I??{},R={...b,...Zt({surfaceCategory:(I==null?void 0:I.surfaceCategory)??(o==null?void 0:o.surfaceCategory),indoorOutDoor:(I==null?void 0:I.indoorOutdoor)??(o==null?void 0:o.indoorOutdoor),endDate:S??(I==null?void 0:I.endDate)??(o==null?void 0:o.endDate),tournamentId:v??(o==null?void 0:o.tournamentId),eventName:w,eventType:U,category:P,eventId:T,gender:E})},C;return!(t!=null&&t.length)&&o&&({participants:t,participantMap:p,groupInfo:C}=Qy({participantsProfile:n,policyDefinitions:a,useParticipantMap:s,tournamentRecord:o,contextProfile:f,inContext:y})),I&&f&&!u&&(u=Mm({policyDefinitions:a,tournamentRecord:o,contextProfile:f,drawDefinition:m,event:I})),{...WU({context:R,tournamentAppliedPolicies:e,scheduleVisibilityFilters:i,tournamentParticipants:t,participantsProfile:n,afterRecoveryTimes:r,policyDefinitions:a,tournamentRecord:o,usePublishState:l,participantMap:p,contextContent:u,contextFilters:c,matchUpFilters:d,publishStatus:h,contextProfile:f,drawDefinition:m,nextMatchUps:g,inContext:y,event:I}),groupInfo:C}}var L0e={};Fi(L0e,{getCompetitionVenues:()=>iM,getCourts:()=>J7,getVenuesAndCourts:()=>Am,publicFindVenue:()=>h8});function J7({tournamentRecord:t,venueId:e,venueIds:i}){return t?{courts:(t.venues||[]).filter(n=>e?n.venueId===e:i?i.includes(n.venueId):!0).map(n=>{let{venueId:r}=n,a=$t(n.courts||[]);return a.forEach(s=>Object.assign(s,{venueId:r})),a}).flat()}:{error:dt}}var F0e={};Fi(F0e,{categoryCanContain:()=>uR,getCategoryAgeDetails:()=>SI,getEvent:()=>t9,getEventProperties:()=>Q7,getEventStructures:()=>wF,getEventTimeItem:()=>wR,getEvents:()=>e9,getFlightProfile:()=>kr,getScaledEntries:()=>Bw});function Q7({tournamentRecord:t,event:e}){var i,n;if(!t)return{error:dt};if(!e)return{error:Qn};let r=e.entries||[],a=t.participants||[],s=((i=e.category)==null?void 0:i.categoryName)||((n=e.category)==null?void 0:n.ageCategoryCode),{eventType:o}=e,l=r.map(h=>h.participantId),c=a.filter(h=>l.includes(h.participantId)),u,d,p;return{entryScaleAttributes:c.map(h=>{var f,m,g,v,y,b;let{participantId:I,participantName:T,name:w}=h,S={scaleType:p8,eventType:o,scaleName:s},U=(m=(f=Rh({participant:h,scaleAttributes:S}))==null?void 0:f.scaleItem)==null?void 0:m.scaleValue;S={scaleType:mbe,eventType:o,scaleName:s};let P=(v=(g=Rh({participant:h,scaleAttributes:S}))==null?void 0:g.scaleItem)==null?void 0:v.scaleValue;S={scaleType:fbe,eventType:o,scaleName:s};let E=(b=(y=Rh({participant:h,scaleAttributes:S}))==null?void 0:y.scaleItem)==null?void 0:b.scaleValue;return u=!!(u||U),d=!!(d||P),p=!!(p||E),{participantId:I,participantName:T||w,seed:U,ranking:P,rating:E}}),hasSeededParticipants:u,hasRankedParticipants:d,hasRatedParticipants:p}}function e9({tournamentRecord:t,withScaleValues:e,scaleEventType:i,inContext:n,eventIds:r,drawIds:a,context:s}){var o,l,c,u;if(!t)return{error:dt};let{tournamentId:d}=t,p=(t.events??[]).filter(({eventId:f})=>!r||Array.isArray(r)&&r.includes(f)).map(f=>{var m;let g=(m=f.drawDefinitions)==null?void 0:m.map(WE);if(a!=null&&a.length&&!Ar(a,g).length)return;let v=$t(f);return n&&Object.assign(v,{tournamentId:d}),s&&Object.assign(v,s),v}).filter(Boolean),h={};if(e){let f=br({withScaleValues:!0,tournamentRecord:t}).participantMap,m=g=>g.reduce((v,y)=>v+parseFloat(y),0);for(let g of p){let v=i??g.eventType,y=g.eventId;h[y]||(h[y]={ratingsStats:{},ratings:{},ranking:{},draws:{}});let b=(g.entries??[]).filter(({entryStatus:E})=>sd.includes(E)).map(Gi),I=E=>{var R,C,M,_,A,N;if((R=E==null?void 0:E.ratings)!=null&&R[v])for(let k of((C=E==null?void 0:E.ratings)==null?void 0:C[v])??[]){let O=k.scaleName;h[y].ratings[O]||(h[y].ratings[O]=[]);let $=(M=Ea[O])==null?void 0:M.accessor;if($){let F=parseFloat((_=k.scaleValue)==null?void 0:_[$]);F&&h[y].ratings[O].push(F)}}if((A=E==null?void 0:E.rankings)!=null&&A[v])for(let k of((N=E==null?void 0:E.rankings)==null?void 0:N[v])??[]){let O=k.scaleName;h[y].ranking[O]||(h[y].ranking[O]=[]),k.scaleValue&&h[y].ranking[O].push(k.scaleValue)}};for(let E of b){let R=(o=f==null?void 0:f[E])==null?void 0:o.participant;if((R==null?void 0:R.participantType)!==Hi)for(let C of(R==null?void 0:R.individualParticipantIds)??[]){let M=(l=f==null?void 0:f[C])==null?void 0:l.participant;I(M)}else I(R)}let T=h[y].ratings;for(let E of Object.keys(T)){let R=T[E];if(!R.length)continue;let C=(c=LX(R))==null?void 0:c.toFixed(2);h[y].ratingsStats[E]={avg:parseFloat((m(R)/R.length).toFixed(2)),median:C?parseFloat(C):void 0,max:Math.max(...R),min:Math.min(...R)}}let w=(E,R)=>{var C,M;let _=A=>{var N,k,O,$,F,V,j,B,z,W;if((N=h[y].draws)!=null&&N[E]&&(k=A==null?void 0:A.ratings)!=null&&k[v])for(let Z of((O=A==null?void 0:A.ratings)==null?void 0:O[v])??[]){let K=Z.scaleName;($=h[y].draws[E])!=null&&$.ratings[K]||(h[y].draws[E].ratings[K]=[]);let Q=(F=Ea[K])==null?void 0:F.accessor;if(Q){let J=parseFloat((V=Z.scaleValue)==null?void 0:V[Q]);J&&h[y].draws[E].ratings[K].push(J)}}if((j=h[y].draws)!=null&&j[E]&&(B=A==null?void 0:A.rankings)!=null&&B[v])for(let Z of((z=A==null?void 0:A.rankings)==null?void 0:z[v])??[]){let K=Z.scaleName;(W=h[y].draws[E])!=null&&W.ranking[K]||(h[y].draws[E].ranking[K]=[]);let Q=Z.scaleValue;Q&&h[y].draws[E].ranking[K].push(Q)}};for(let A of R.filter(Boolean)){let N=(C=f==null?void 0:f[A])==null?void 0:C.participant;if((N==null?void 0:N.participantType)!==Hi)for(let k of(N==null?void 0:N.individualParticipantIds)??[]){let O=(M=f==null?void 0:f[k])==null?void 0:M.participant;_(O)}else _(N)}},S=[],U=E=>(a==null?void 0:a.length)&&a.includes(E)||S.includes(E);for(let E of g.drawDefinitions??[]){let R=E.drawId;if(U(R))continue;let C=rb({drawDefinition:E}).assignedParticipantIds??[];h[y].draws[R]||(h[y].draws[R]={ratingsStats:{},ratings:{},ranking:{}}),S.push(R),w(R,C)}let P=kr({event:g}).flightProfile;for(let E of(P==null?void 0:P.flights)??[]){let R=E.drawId;if(U(R))continue;let C=E.drawEntries.map(Gi);w(R,C)}for(let E of S){let R=h[y].draws[E].ratings;for(let C of Object.keys(R)){let M=R[C];if(!M.length)continue;let _=(u=LX(M))==null?void 0:u.toFixed(2);h[y].draws[E].ratingsStats[C]={avg:parseFloat((m(M)/M.length).toFixed(2)),median:_?parseFloat(_):void 0,max:Math.max(...M),min:Math.min(...M)}}}}}return Zt({eventScaleValues:h,events:p,...pe})}function t9({tournamentRecord:t,drawDefinition:e,context:i,event:n}){var r;if(!t)return{error:dt};if(!n)return{error:Qn};let a=$t(n);i&&Object.assign(a,i);let s=e&&((r=a.drawDefinitions)==null?void 0:r.find(({drawId:o})=>e.drawId===o));return Zt({drawDefinition:s,event:a})}function R8e(t){var e,i;let n="validateAndDeriveDrawValues",{appliedPolicies:r,policyDefinitions:a}=A8e(t),s=_8e({...t,policyDefinitions:a,appliedPolicies:r}),o=N8e(t),l=k8e({...t,consideredEntries:o,appliedPolicies:r});if(l!=null&&l.error)return fe({result:l,stack:n});let c=x8e({...t,consideredEntries:o}),u=M8e({...t,appliedPolicies:r,policyDefinitions:a,drawSize:c});if(u.error)return fe({result:u,stack:n});let d=u.drawType;if(isNaN(c)&&d!==lc)return fe({result:{error:rR},stack:n});let p=(a==null?void 0:a[Tu])??(r==null?void 0:r[Tu]),h=t.seedingProfile??((i=(e=p==null?void 0:p.seedingProfile)==null?void 0:e.drawTypes)==null?void 0:i[d??""])??(p==null?void 0:p.seedingProfile);t.seedingProfile&&(a[Tu]||(a[Tu]={...wG[Tu]}),a[Tu].seedingProfile=h);let f=O8e({...t,drawType:d});return f!=null&&f.error?fe({result:f,stack:n}):{drawSize:c,drawType:d,enforceGender:s,seedingProfile:h,appliedPolicies:r,policyDefinitions:a}}function M8e(t){let{policyDefinitions:e,appliedPolicies:i,enforceMinimumDrawSize:n=!0,drawSize:r}=t,a=t.drawTypeCoercion??QR({drawType:t.drawType,policyDefinitions:e,appliedPolicies:i}),s=dwe({drawType:t.drawType,enforceMinimumDrawSize:n,drawTypeCoercion:a,drawSize:r});return s.error?s:{drawType:s.drawType}}function $0e(t){return t==null?void 0:t.filter(e=>e.entryStatus&&[...sd,CR].includes(e.entryStatus))}function N8e({considerEventEntries:t=!0,drawEntries:e,eventEntries:i,qualifyingOnly:n}){return(n&&[]||$0e(e)||(t?i:[])).filter(({entryStage:r})=>!r||r===Bt)}function A8e(t){let{tournamentRecord:e,event:i}=t,n=fn({tournamentRecord:e,event:i}).appliedPolicies??{},r=$t(t.policyDefinitions??{},!1,!0);return{appliedPolicies:n,policyDefinitions:r}}function _8e({enforceGender:t,policyDefinitions:e,appliedPolicies:i}){var n,r,a,s;return t??((r=(n=e==null?void 0:e[Ga])==null?void 0:n.participants)==null?void 0:r.enforceGender)??((s=(a=i==null?void 0:i[Ga])==null?void 0:a.participants)==null?void 0:s.enforceGender)}function k8e(t){let{consideredEntries:e,appliedPolicies:i,policyDefinitions:n,enforceGender:r,participantMap:a,participants:s,event:o}=t;return o&&s&&AF({consideredEntries:e,policyDefinitions:n,appliedPolicies:i,participantMap:a,enforceGender:r,participants:s,event:o})}function x8e(t){return!t.drawSize&&t.consideredEntries.length&&![lc,pR,$U,Zu,zh].includes(t.drawType??"")&&MU(t.consideredEntries.length)||t.drawSize&&di(t.drawSize)||!1}function O8e(t){var e,i;let{tournamentRecord:n,event:r,ignoreAllowedDrawTypes:a,drawType:s}=t,o=!a&&n&&VF({tournamentRecord:n,categoryType:(e=r==null?void 0:r.category)==null?void 0:e.categoryType,categoryName:(i=r==null?void 0:r.category)==null?void 0:i.categoryName});return o!=null&&o.length&&!o.includes(s)?{error:L5}:{...pe}}function oM(t){let{voluntaryConsolation:e,tournamentRecord:i,event:n}=t,r="generateDrawDefinition",{participants:a,participantMap:s}=br({withIndividualParticipants:!0,convertExtensions:!0,internalUse:!0,tournamentRecord:i}),o=$0e(n==null?void 0:n.entries)??[],l=R8e({...t,participantMap:s,participants:a,eventEntries:o});if(l.error)return fe({result:l,stack:r});let{appliedPolicies:c,policyDefinitions:u,drawSize:d,drawType:p,enforceGender:h,seedingProfile:f}=l,m=n==null?void 0:n.eventType,g=t.matchUpType??m,v=x6e({...t,enforceGender:h,eventType:m,matchUpType:g});if(v.error)return fe({result:v,stack:r});let{matchUpFormat:y,tieFormat:b}=v;if(t.drawId&&typeof t.drawId!="string")return fe({result:{error:Ae},stack:r});let I=c8e({...t,policyDefinitions:u,tournamentRecord:i,appliedPolicies:c,matchUpFormat:y,seedingProfile:f,participants:a,eventEntries:o,matchUpType:g,tieFormat:b,drawSize:d,drawType:p,event:n});if(I.error)return fe({result:I,stack:r});let{existingDrawDefinition:T,positioningReports:w,drawDefinition:S,structureId:U,conflicts:P,entries:E}=I;if(!S)return fe({result:{error:Ae},stack:r});let R=u8e({...t,existingDrawDefinition:T,positioningReports:w,appliedPolicies:c,drawDefinition:S,seedingProfile:f,participants:a,structureId:U,entries:E,params:t,stack:r});if(R.error)return R;let{qualifyingConflicts:C}=R;return S.drawName=t.drawName??(p&&ys(p)),d&&typeof e=="object"&&d>=4&&D8({...e,drawDefinition:S,matchUpType:g}),{existingDrawDefinition:!!T,qualifyingConflicts:C,positioningReports:w,drawDefinition:S,structureId:U,...pe,conflicts:P}}function B0e({scaleAttributes:t,scaledEntries:e,stageEntries:i,seedsCount:n,scaleName:r}){if(!t)return{error:si,info:"missing scaleAttributes"};let a=Object.assign({},...(e||[]).slice(0,n).map(({participantId:o},l)=>({[o]:l+1})));r=r||t.scaleName;let s=new Date().toISOString();return{scaleItemsWithParticipantIds:i.map(({participantId:o})=>({scaleItems:[{scaleValue:a[o],eventType:t.eventType,scaleType:Ph,scaleName:r,scaleDate:s}],participantId:o}))}}function L8e({tournamentRecord:t,drawDefinition:e,policyDefinitions:i,scaleAttributes:n,scaleName:r,drawSize:a,drawId:s,event:o,stage:l,sortDescending:c,scaleSortMethod:u}){let d=JF({policyDefinitions:i,drawDefinition:e,drawSize:a,drawId:s,event:o,stage:l});if(d.error)return d;let{entries:p,seedsCount:h,stageEntries:f}=d;if(!f||!h)return{error:Ae};let m=Bw({tournamentRecord:t,scaleAttributes:n,scaleSortMethod:u,sortDescending:c,entries:p,stage:l}).scaledEntries??[],{scaleItemsWithParticipantIds:g}=B0e({scaleAttributes:n,scaledEntries:m,stageEntries:f,seedsCount:h,scaleName:r});return{scaleItemsWithParticipantIds:g}}var V0e={};Fi(V0e,{addDrawEntries:()=>I8,addEventEntries:()=>Ip,addEventEntryPairs:()=>q0e,destroyPairEntries:()=>Bbe,destroyPairEntry:()=>U8,getEntriesAndSeedsCount:()=>JF,getMaxEntryPosition:()=>B7,modifyEntriesStatus:()=>Y_,modifyEventEntries:()=>W0e,mutate:()=>j0e,promoteAlternate:()=>H0e,promoteAlternates:()=>n9,query:()=>A0e,removeDrawEntries:()=>z0e,removeEventEntries:()=>$R,setEntryPosition:()=>i9,setEntryPositions:()=>G0e});var j0e={};Fi(j0e,{addDrawEntries:()=>I8,addEventEntries:()=>Ip,addEventEntryPairs:()=>q0e,destroyPairEntries:()=>Bbe,destroyPairEntry:()=>U8,modifyEntriesStatus:()=>Y_,modifyEventEntries:()=>W0e,promoteAlternate:()=>H0e,promoteAlternates:()=>n9,removeDrawEntries:()=>z0e,removeEventEntries:()=>$R,setEntryPosition:()=>i9,setEntryPositions:()=>G0e});function i9({tournamentRecord:t,drawDefinition:e,participantId:i,entryPosition:n,skipRefresh:r,event:a}){let s="setEntryPositions";if(!t)return{error:dt};if(!i)return fe({result:{error:da},stack:s});if(n!==void 0&&!Number.isSafeInteger(n))return{error:Ae,entryPosition:n};((a==null?void 0:a.entries)||[]).forEach(l=>{l.participantId===i&&(l.entryPosition=n)}),((e==null?void 0:e.entries)||[]).forEach(l=>{l.participantId===i&&(l.entryPosition=n)});let o=l=>{l.entries.forEach(c=>{c.entryPosition===n&&c.participantId!==i&&(c.entryPosition+=.1)})};return r||(a!=null&&a.entries&&(o(a),a.entries=Cd({entries:a.entries})),e!=null&&e.entries&&(o(e),e.entries=Cd({entries:e.entries}))),{...pe}}function G0e({tournamentRecord:t,entryPositions:e,drawDefinition:i,event:n}){if(!t)return{error:dt};if(!Array.isArray(e))return{error:Ae};for(let r of e){let{participantId:a,entryPosition:s}=r,o=i9({skipRefresh:!0,tournamentRecord:t,drawDefinition:i,participantId:a,entryPosition:s,event:n});if(o.error)return o}return n!=null&&n.entries&&(n.entries=Cd({entries:n.entries})),i!=null&&i.entries&&(i.entries=Cd({entries:i.entries})),{...pe}}function H0e(t){let{participantId:e}=t;return e&&typeof e!="string"?{error:Ae,participantId:e}:n9({...t,participantIds:[e].filter(Boolean)})}function n9({tournamentRecord:t,drawDefinition:e,participantIds:i,stageSequence:n,stage:r=Bt,eventId:a,event:s}){if(!t)return{error:dt};if(!Array.isArray(i))return{error:Ae,participantIds:i};if(!s)return{error:Qn};let o="promoteAlternates";if(s){let l=EJ({element:s,participantIds:i,stageSequence:n,stage:r});if(l.error)return l}if(e){let l=EJ({element:e,participantIds:i,stageSequence:n,stage:r});if(l.error)return a?fe({context:{drawPromotionError:l.error,drawId:e.drawId},result:{...pe},stack:o}):l}return{...pe}}function EJ({participantIds:t,stageSequence:e,element:i,stage:n}){let r=(i.entries||[]).filter(d=>d.entryStatus===Bu),a=(i.entries||[]).filter(d=>t.includes(d.participantId)),s=r.reduce((d,p)=>{let{entryPosition:h}=p;return isNaN(h)&&d||(!d||h<d.entryPosition)&&p||d},void 0),o=a.length?a:[s].filter(Boolean);if(!(o!=null&&o.length))return{error:_ge};let l=o.filter(({entryStatus:d})=>d!==Bu);if(l.length)return{error:$j,invalidEntryStatus:l};let c=o.filter(({entryStage:d})=>d&&d!==n);if(c.length)return{error:GHe,invalidStage:c};let u=e&&o.filter(d=>d.stageSequence!==e);if(u!=null&&u.length)return{error:HHe,invalidStageSequence:u};for(let d of o){d.entryStatus=dl;let p=d==null?void 0:d.entryPosition;isNaN(p)||i.entries.forEach(f=>{f.entryStatus===Bu&&f.entryPosition>p&&(f.entryPosition=f.entryPosition-1)});let h=Math.max(...i.entries.filter(f=>f.entryStatus===dl&&!isNaN(f.entryPosition)).map(({entryPosition:f})=>di(f||0)),0);d.entryPosition=h||0}return{...pe}}function z0e({autoEntryPositions:t=!0,participantIds:e,drawDefinition:i,drawId:n,stages:r,event:a}){var s;if(!a)return{error:Qn};if(!n)return{error:jd};if(!(e!=null&&e.length))return{error:Yg};let o=rb({drawDefinition:i,stages:r}).assignedParticipantIds??[];if(vo(o,e))return{error:xU};let l=d=>{let p=d.participantId;return!e.includes(p)},{flightProfile:c}=kr({event:a}),u=(s=c==null?void 0:c.flights)==null?void 0:s.find(d=>d.drawId===n);return u!=null&&u.drawEntries&&(u.drawEntries=u.drawEntries.filter(l),t&&(u.drawEntries=Cd({entries:u.drawEntries}))),i!=null&&i.entries&&(i.entries=i.entries.filter(l),t&&(i.entries=Cd({entries:i.entries}))),{...pe}}function $p(t){var e,i,n,r,a;let s="addParticipant",{allowDuplicateParticipantIdPairs:o,returnParticipant:l,disableNotice:c,pairOverride:u,participant:d}=t,p=t.tournamentId?(e=t.tournamentRecords)==null?void 0:e[t.tournamentId]:t.tournamentRecord??(t.activeTournamentId&&((i=t.tournamentRecords)==null?void 0:i[t.activeTournamentId]));if(!p)return{error:dt};if(!d)return fe({result:{error:bw},stack:s});d.participantId||(d.participantId=bn()),p.participants||(p.participants=[]);let{participantId:h,individualParticipantIds:f}=d;if(p.participants.reduce((I,T)=>T.participantId===h||I,!1))return{error:Cge};let{participantType:m,participantRole:g}=d;if(!m||!Object.keys(wD).includes(m))return{error:Od,participantType:m};if(!g)return{error:Pge};let v=p.participants||[],y=v.filter(I=>I.participantType===Hi).map(I=>I.participantId);if(m!==Hi&&d.person)return{error:Ae,person:d.person};if(f&&!Array.isArray(f))return{error:Ae,individualParticipantIds:f};if(m===Ai){if(d.person)return{error:Ae,person:d.person};if(d.individualParticipantIds){if(d.individualParticipantIds.length!==2&&!u)return fe({info:"PAIR must be 2 individualParticipantIds",result:{error:Pl},stack:s});{let w=v.filter(S=>S.participantType===Hi).map(S=>S.participantId);if(!Array.isArray(d.individualParticipantIds))return fe({result:{error:Pl},stack:s});if(!d.individualParticipantIds.reduce((S,U)=>w.includes(U)&&S,!0))return fe({result:{error:Pl},stack:s})}}else return fe({result:{error:Yg},stack:s});let I=v.filter(w=>w.participantType===Ai).map(w=>({individualParticipantIds:w.individualParticipantIds,participant:w})),T=d.participantType===Ai&&I.find(w=>Ar(w.individualParticipantIds,d.individualParticipantIds).length===2);if(T&&!o)return{...pe,existingParticipant:!0,participant:l&&$t(T.participant)};if(!d.participantName){let w=v.filter(U=>{var P;return(P=d.individualParticipantIds)==null?void 0:P.includes(U.participantId)}),S=w.map(U=>{var P;return(P=U.person)==null?void 0:P.standardFamilyName}).filter(Boolean).join("/");w.length===1&&(S+="/Unknown"),d.participantName=S}}else if(m===Hi){if(!((n=d.person)!=null&&n.standardFamilyName)||!((r=d.person)!=null&&r.standardGivenName))return{error:Age};if(!d.participantName){let I=`${d.person.standardFamilyName.toUpperCase()}, ${d.person.standardGivenName}`;d.participantName=I}}else if(m&&[Pn,gc].includes(m)){if(f||(d.individualParticipantIds=[]),(a=d.individualParticipantIds)==null?void 0:a.length)for(let I of d.individualParticipantIds){if(typeof I!="string")return fe({result:{participantId:I,error:Ae},stack:s});if(!y.includes(I))return fe({result:{participantId:I,error:Or},stack:s})}}else return{error:Od};p.participants.push(d),c||Ti({payload:{tournamentId:p.tournamentId,participants:[d]},topic:Sg});let b={participant:l&&$t(d),...pe};return Zt(b)}function ed({allowDuplicateParticipantIdPairs:t,returnParticipants:e,tournamentRecord:i,participants:n=[]}){if(!i)return{error:dt};i.participants||(i.participants=[]);let r=i.participants.map(d=>d.participantId)||[];n.forEach(d=>{d.participantId||(d.participantId=bn())});let a=n.filter(d=>!r.includes(d.participantId)),s=n.filter(d=>r.includes(d.participantId)),o=a.filter(d=>d.participantType===Hi),l=a.filter(d=>d.participantType!==Hi),c=o.concat(...l),u=[];if(c.length){for(let p of c){let h=$p({allowDuplicateParticipantIdPairs:t,returnParticipant:!0,disableNotice:!0,tournamentRecord:i,participant:p});if(h.error)return h;h.success&&!h.existingParticipant&&u.push(h.participant)}u.length&&Ti({topic:Sg,payload:{tournamentId:i.tournamentId,participants:u}});let d={participants:e&&$t(u),addedCount:u.length,...pe};return s.length&&Object.assign(d,{notAdded:s,info:CL}),Zt(d)}else return{info:"No new participants to add",addedCount:0,...pe}}function q0e(t){let e=ei(t,[{[Ia]:!0,[Zg]:!0}]);if(e.error)return e;let{allowDuplicateParticipantIdPairs:i,entryStatus:n=Bu,participantIdPairs:r=[],entryStage:a=Bt,tournamentRecord:s,drawDefinition:o,event:l,uuids:c}=t;if(l.eventType!==Nn)return{error:jh};let u=[],d=new Map;for(let I of s.participants??[]){let{participantType:T,participantId:w,person:S,individualParticipantIds:U}=I;T===Hi&&S!=null&&S.sex?d.set(w,S.sex):T===Ai&&U&&u.push(U)}let p=r.filter(I=>{if(I.length!==2)return!0;if(!l.gender||l.gender===Ld)return!1;if(!d.has(I[0])||!d.has(I[1]))return!0;let T=I.map(S=>d.get(S)),w=l.gender===Rn&&(T[0]!==Rn||T[1]!==Rn)||l.gender===Kn&&(T[0]!==Kn||T[1]!==Kn);return l.gender===Fo&&(T.sort(vF),(T[0]!==Kn||T[1]!==Rn)&&(w=!0)),w});if(p.length)return{error:Pl,invalidParticipantIdPairs:p};let h=r.map(I=>({participantId:(c==null?void 0:c.pop())??bn(),participantRole:vs,individualParticipantIds:I,participantType:Ai})),f=i?h:h.filter(I=>!u.find(T=>Ar(T,I.individualParticipantIds).length===2)),m,g=[];if(f){let I=ed({allowDuplicateParticipantIdPairs:i,participants:f,returnParticipants:!0,tournamentRecord:s});if(I.error)return I;g=I.participants||[],m=I.info}let v=r.map(I=>{let T=g.find(S=>Ar(S.individualParticipantIds,I).length===2);if(T)return T;let{participant:w}=Qu({tournamentRecord:s,participantIds:I});return w}).map(I=>I.participantId),y=Ip({participantIds:v,tournamentRecord:s,drawDefinition:o,entryStatus:n,entryStage:a,event:l});f.length&&Ti({payload:{participants:f},topic:Sg});let b=f.map(Gi);return{...y,info:m,newParticipantIds:b}}function W0e({entryStatus:t=dl,unpairedParticipantIds:e=[],participantIdPairs:i=[],entryStage:n=Bt,tournamentRecord:r,event:a}){if(!r)return{error:dt};if(!a)return{error:Qn};let s=r.participants??[],o=s.filter(m=>m.participantType===Hi).map(m=>m.participantId),l=e.concat(...i).flat(1/0).filter(m=>!o.includes(m));if(l.length)return{error:Pl,invalidParticipantIds:l};let c=i.filter(m=>m.length!==2);if(c.length)return{error:Pl,invalidParticipantIdPairs:c};let u=s.filter(m=>m.participantType===Ai).map(m=>m.individualParticipantIds),d=i.filter(m=>!u.find(g=>Ar(g,m).length===2)).map(m=>({participantType:Ai,participantRole:vs,individualParticipantIds:m})),p=ed({participants:d,tournamentRecord:r});if(p.error)return p;let h=i.map(m=>{let{participant:g}=Qu({tournamentRecord:r,participantIds:m});return g}).map(m=>({participantId:m,entryStatus:t,entryStage:n})),f=e.map(m=>({entryStatus:ou,participantId:m,entryStage:n}));return a.entries=(a.entries??[]).filter(m=>m.entryStage===n),a.entries=a.entries.concat(...h,...f),{...pe}}var Y0e={};Fi(Y0e,{addDrawDefinition:()=>lM,addEvent:()=>i1,addFlight:()=>s2,assignSeedPositions:()=>oSe,attachFlightProfile:()=>u9,categoryCanContain:()=>uR,deleteDrawDefinitions:()=>n2,deleteEvents:()=>cSe,deleteFlightAndFlightDraw:()=>aSe,deleteFlightProfileAndFlightDraws:()=>eSe,generate:()=>K0e,generateEventsFromTieFormat:()=>X0e,getCategoryAgeDetails:()=>SI,getEvent:()=>t9,getEventProperties:()=>Q7,getEventStructures:()=>wF,getEventTimeItem:()=>wR,getEvents:()=>e9,getFlightProfile:()=>kr,getScaledEntries:()=>Bw,modifyEvent:()=>uSe,modifyEventMatchUpFormatTiming:()=>tSe,modifyPairAssignment:()=>sSe,mutate:()=>J0e,query:()=>F0e,refreshEventDrawOrder:()=>c9,removeEventMatchUpFormatTiming:()=>r2,removeScaleValues:()=>d9,removeSeeding:()=>lSe,setEventDates:()=>o9,setEventDisplay:()=>a2,setEventEndDate:()=>s9,setEventStartDate:()=>a9,updateDrawIdsOrder:()=>l9,validateCategory:()=>$E});var K0e={};Fi(K0e,{generateEventsFromTieFormat:()=>X0e});function F8e({tournamentId:t,event:e}){return e?(Ti({payload:{tournamentId:t,event:e},key:e.eventId,topic:Bye}),{...pe}):{error:Qn}}var $8e={collectionDefinitions:[{collectionName:"Doubles",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7@7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"COLLEGE_D3",winCriteria:{valueGoal:5}},B8e={collectionDefinitions:[{collectionName:"Doubles",collectionValue:1,matchUpCount:3,matchUpFormat:"SET1-S:6/TB7",matchUpType:"DOUBLES"},{collectionName:"Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"COLLEGE_DEFAULT",winCriteria:{valueGoal:5}},V8e={collectionDefinitions:[{collectionName:"Doubles",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"COLLEGE_JUCO",winCriteria:{valueGoal:5}},Z0e={COLLEGE_D3:$8e,COLLEGE_DEFAULT:B8e,COLLEGE_JUCO:V8e,DOMINANT_DUO:_ve,DOMINANT_DUO_MIXED:Cve,LAVER_CUP:Fve,TEAM_DOUBLES_3_AGGREGATION:Tve,TIME_TENNIS_DUAL:Rve,TIME_TENNIS_PRO_CIRCUIT:Pve,USTA_BREWER_CUP:Mve,USTA_OZAKI_CUP:Nve,USTA_COLLEGE:kve,USTA_GOLD_TEAM_CHALLENGE:Sve,USTA_INTERSECTIONAL:Eve,USTA_LEVEL_1:xve,USTA_SECTION_BATTLE:Dve,USTA_SOUTHERN_LEVEL_5:Uve,USTA_TOC:$ve,USTA_WTT_ITT:Ove,USTA_ZONAL:Lve};function i1({suppressNotifications:t,tournamentRecord:e,internalUse:i,event:n}){var r,a,s,o;if(!e)return{error:dt};if(e.events||(e.events=[]),!n)return{error:Qn};let{startDate:l,endDate:c}=e;if(!i&&((r=n.entries)!=null&&r.length||(a=n.drawDefinitions)!=null&&a.length)){let d=Zt({drawDefinitions:!!((s=n.drawDefinitions)!=null&&s.length),entries:!!((o=n.entries)!=null&&o.length)});return{info:"entries/drawDefinitions cannot exist",error:Ae,context:d}}let u={eventType:TI,drawDefinitions:[],entries:[],startDate:l,endDate:c,...n};if(n.eventType===Fl){if(n.tieFormat){let d=Go({tieFormat:n.tieFormat});if(d.error)return d}else if(n.tieFormatName){if(!Z0e[n.tieFormatName])return{context:{tieFormatName:n.tieFormatName},error:Ae};let d=em({isMock:e==null?void 0:e.isMock,namedFormat:n.tieFormatName,event:n});u.tieFormat=d}}if(u.eventId||(u.eventId=bn()),e.events.reduce((d,p)=>d||p.eventId===u.eventId,void 0))return{error:cge};{let d=u;if(e.events.push(d),!t){let{topics:p}=ru();if(p.includes(iF)){let m=nf({event:n}).matchUps??[];Tg({tournamentId:e==null?void 0:e.tournamentId,eventId:n.eventId,matchUps:m})}let{drawDefinitions:h,...f}=n;for(let m of h||[])bR({drawDefinition:m});F8e({tournamentId:e==null?void 0:e.tournamentId,event:f})}return{...pe,event:u}}}function X0e(t){var e,i,n,r;let a=ei(t,[{[fT]:{[qL]:!0,[pye]:!0}},{[Ia]:!0}]);if(a.error)return a;let s=t.tieFormat||em({namedFormat:t.tieFormatName}),o=t.uuids||[wve(s.collectionDefinitions.length)],l={[Rn]:[],[Kn]:[]};if(t.addEntriesFromTeams){let u=(i=(e=t.tournamentRecord.participants)==null?void 0:e.filter(d=>d.participantType===$o))==null?void 0:i.flatMap(d=>d.individualParticipantIds??[]);for(let d of t.tournamentRecord.participants??[])if(u!=null&&u.includes(d.participantId)){let p=(n=d.person)==null?void 0:n.sex;p&&[Rn,Kn].includes(p)&&l[p].push(d.participantId)}}let c=[];for(let u of s.collectionDefinitions??[]){let d=((r=o==null?void 0:o.pop())==null?void 0:r.toString())||bn(),p=u.matchUpType,h=u.gender,f={matchUpFormat:u.matchUpFormat,eventName:u.collectionName,category:u.category,gender:h,eventType:p,eventId:d};if(t.addEntriesFromTeams){let m=p===tm?ou:t.entryStatus||dl,g=h===Fo?[...l[Rn],...l[Kn]]:l[h]??[];if(g.length){let v=Ip({participantIds:g,entryStatus:m,event:f});if(v.error)return v}}if(c.push(f),t.addEvents!==!1){let m=i1({internalUse:!0,tournamentRecord:t.tournamentRecord,event:f});if(m.error)return m}}return{...pe,events:c}}var J0e={};Fi(J0e,{addDrawDefinition:()=>lM,addEvent:()=>i1,addFlight:()=>s2,assignSeedPositions:()=>oSe,attachFlightProfile:()=>u9,deleteDrawDefinitions:()=>n2,deleteEvents:()=>cSe,deleteFlightAndFlightDraw:()=>aSe,deleteFlightProfileAndFlightDraws:()=>eSe,modifyEvent:()=>uSe,modifyEventMatchUpFormatTiming:()=>tSe,modifyPairAssignment:()=>sSe,refreshEventDrawOrder:()=>c9,removeEventMatchUpFormatTiming:()=>r2,removeScaleValues:()=>d9,removeSeeding:()=>lSe,setEventDates:()=>o9,setEventDisplay:()=>a2,setEventEndDate:()=>s9,setEventStartDate:()=>a9,updateDrawIdsOrder:()=>l9,validateCategory:()=>$E});function n1({removePriorValues:t=!0,status:e=vc,statusObject:i,event:n}){if(!tn(i))return{error:Ae};let r=cu({event:n,status:e}),a=`${tv}.${iv}`,s={itemValue:{[e]:{...r,...i}},itemType:a};return $w({timeItem:s,removePriorValues:t,event:n})}function r1(t){var e,i,n,r,a,s,o;let l=ei(t,[{[Ia]:!0,[Zg]:!0},{eventDataParams:!1,[Wo]:tl}]);if(l.error)return l;let{includePositionAssignments:c,removePriorValues:u,tournamentRecord:d,status:p=vc,event:h,drawIdsToRemove:f,drawIdsToAdd:m}=t,{appliedPolicies:g}=fn({tournamentRecord:d,event:h}),v={...g,...t.policyDefinitions},y=((e=h==null?void 0:h.drawDefinitions)==null?void 0:e.map(({drawId:C})=>C))??[],b=t.drawDetails?Object.keys(t.drawDetails):[],I=b.length?[]:t.drawIds,T=(m??[]).concat(...f??[],...I??[],...b),w=T.filter(C=>!y.includes(C));if(w.length)return fe({result:{error:sc},context:{invalidDrawIds:w}});let S=cu({event:h,status:p}),U=Object.keys((S==null?void 0:S.drawDetails)||{}).filter(C=>y.includes(C)).reduce((C,M)=>(C[M]=S.drawDetails[M],C),{});for(let C of y)if((!T.length||T.includes(C))&&(f!=null&&f.includes(C)||I!=null&&I.length&&!I.includes(C)?U[C]={...U[C],publishingDetail:{published:!1}}:(m!=null&&m.includes(C)||I!=null&&I.includes(C)||!(I!=null&&I.length))&&(U[C]={...U[C],publishingDetail:{published:!0}})),(i=t.drawDetails)==null?void 0:i[C]){let M=t.drawDetails[C],_=M.structureDetails??U[C].structureDetails,A=M.stageDetails??U[C].stageDetails??{},{structureIdsToRemove:N=[],structureIdsToAdd:k=[],publishingDetail:O={},stagesToRemove:$=[],stagesToAdd:F=[]}=M;if((k||F)&&(O.published=!0),U[C]={publishingDetail:O,structureDetails:_,stageDetails:A},k.length||N.length){let j=(((r=(n=h==null?void 0:h.drawDefinitions)==null?void 0:n.find(z=>z.drawId===C))==null?void 0:r.structures)??[]).map(({structureId:z})=>z),B=(k??[]).concat(N??[]).filter(z=>!j.includes(z));if(B.length)return fe({result:{error:yr},context:{invalidStructureIds:B}});_=_??{};for(let z of j)N.includes(z)?_[z]={published:!1}:_[z]={published:!0};U[C].structureDetails=_}let V=(((s=(a=h==null?void 0:h.drawDefinitions)==null?void 0:a.find(j=>j.drawId===C))==null?void 0:s.structures)??[]).map(({stage:j})=>j);if(F.length){for(let j of F)A[j]={published:!0};for(let j of V)A[j]||(A[j]={published:!1})}if(F.length||$.length){for(let j of $)A[j]={published:!1};for(let j of V)A[j]||(A[j]={published:!0})}(F.length||$.length)&&(U[C].stageDetails=A)}n1({statusObject:{drawDetails:U},removePriorValues:u,status:p,event:h});let{topics:P}=ru(),E=P.includes(Zj),R=E||t.returnEventData?(o=qF({includePositionAssignments:c,...t.eventDataParams,usePublishState:!0,tournamentRecord:d,policyDefinitions:v,event:h}))==null?void 0:o.eventData:void 0;return E&&Ti({payload:{eventData:R,tournamentId:d.tournamentId},topic:Zj}),{...pe,eventData:R}}var Q0e="deleteDrawDefinitions",TG="autoSchedulingAudit",hA="deleteEvents",j8e={AUTO_SCHEDULING_AUDIT:TG,DELETE_EVENTS:hA,DELETE_DRAW_DEFINITIONS:Q0e};function n2(t){var e,i,n,r,a;if(!t.tournamentRecord)return{error:dt};let s="deleteDrawDefinitions",o=t.drawIds??[],l=t.event,{autoPublish:c=!0,tournamentRecord:u,auditData:d,eventId:p,force:h}=t,{appliedPolicies:f}=fn({tournamentRecord:u,event:l}),m={...f,...t.policyDefinitions},g=Array.isArray(o)?o[0]:void 0;if(!l){let M=zo({tournamentRecord:u,eventId:p,drawId:g});if(M.error)return M;l=M.event}let v=[],y=[],b=[];if(!(l!=null&&l.drawDefinitions))return fe({info:"event has no drawDefinition",result:{...pe},stack:s});let I=l.drawDefinitions.map(({drawId:M})=>M);if(o.length||(o=I),o=o.filter(M=>I.includes(M)),!o.length)return fe({info:"nothing to do; no matching drawIds in event.",result:{...pe},stack:s});let T=$t(kr({event:l}).flightProfile,!1,!0),w=({participantId:M,drawPosition:_,qualifier:A,bye:N})=>({bye:N,qualifier:A,drawPosition:_,participantId:M}),S=h??((i=(e=f==null?void 0:f[Kc])==null?void 0:e.allowDeletionWithScoresPresent)==null?void 0:i.drawDefinitions),U=cu({event:l})??{},P=U.drawIds??(U.drawDetails&&Object.keys(U.drawDetails))??[],E,R=[],C=l.drawDefinitions.filter(M=>{var _,A,N,k,O,$,F,V;if(o.includes(M.drawId)){let j=((_=po({event:l,drawDefinition:M}))==null?void 0:_.matchUps)??[];if(j.some(({score:ce})=>ya({score:ce}))&&!S)return R.push(M.drawId),!0;let{drawId:B,drawType:z,drawName:W}=M,Z=(A=T==null?void 0:T.flights)==null?void 0:A.find(ce=>ce.drawId===M.drawId);Z&&(Z.drawEntries=(N=Z.drawEntries)==null?void 0:N.filter(ce=>sd.includes(ce.entryStatus))),P.includes(B)&&(P=P.filter(ce=>ce!==B),E=!0);let K=(O=(k=Ju({stageSequence:1,drawDefinition:M,stage:Bt}))==null?void 0:k.structures)==null?void 0:O[0],Q=(F=($=K?QE({structureId:K.structureId,tournamentRecord:u,drawDefinition:M}):void 0)==null?void 0:$.positionAssignments)==null?void 0:F.map(w),J=(V=Ju({stage:ri,drawDefinition:M}))==null?void 0:V.structures,se=J!=null&&J.length?J.map(ce=>{var oe;let te=ce.stageSequence;return{positionAssignments:(oe=QE({structureId:ce.structureId,tournamentRecord:u,drawDefinition:M}))==null?void 0:oe.positionAssignments.map(w),stageSequence:te}}):void 0,ie={action:Q0e,payload:{drawDefinitions:[M],eventId:p??(l==null?void 0:l.eventId),auditData:d}};b.push(ie),v.push(Zt({tournamentId:u.tournamentId,eventId:p??(l==null?void 0:l.eventId),qualifyingPositionAssignments:se,positionAssignments:Q,auditData:d,drawType:z,drawName:W,drawId:B})),j==null||j.forEach(({matchUpId:ce})=>y.push(ce))}return!o.includes(M.drawId)});if(R.length&&!h)return fe({context:{drawIdsWithScoresPresent:R},result:{error:kL},stack:s});if(l.drawDefinitions=C,T&&Jg({event:l,extension:{name:Xu,value:T}}),rM({tournamentRecord:u}),E){let M={};for(let A of P)M[A]=((n=U.drawDetails)==null?void 0:n[A])??{published:!0};let _=n1({statusObject:{drawDetails:M},event:l});if(_.error)return{error:_.error}}if(b.length)if(xL(kf)){let M=u.tournamentId;Ti({topic:kf,payload:{tournamentId:M,detail:b}});let _=(((a=(r=su({element:l,itemType:qv}))==null?void 0:r.timeItem)==null?void 0:a.itemValue)||0)+1;Zp({element:l,timeItem:{itemType:qv,itemValue:_},removePriorValues:!0})}else G8e({appliedPolicies:f,event:l,deletedDrawsDetail:v,auditData:d});if(y.length&&Cm({tournamentId:u==null?void 0:u.tournamentId,matchUpIds:y}),o.forEach(M=>Gqe({drawId:M})),c&&E){let M=r1({...t.eventDataParams,drawIdsToRemove:o,policyDefinitions:m,tournamentRecord:u,event:l});if(M.error)return{...pe,info:M.error}}return{...pe}}function G8e({appliedPolicies:t,event:e,deletedDrawsDetail:i,auditData:n}){var r;if(((r=t==null?void 0:t.audit)==null?void 0:r[qv])===!1)return;let{extension:a}=xi({name:qv,element:e}),s={...n,deletedDrawsDetail:i},o={value:Array.isArray(a==null?void 0:a.value)?a==null?void 0:a.value.concat(s):[s],name:qv};pn({element:e,extension:o})}function eSe({autoPublish:t=!0,tournamentRecord:e,auditData:i,event:n,force:r}){var a;if(!e)return{error:dt};if(!n)return{error:Qn};let{flightProfile:s}=kr({event:n});if(s){let o=(a=s.flights)==null?void 0:a.map(({drawId:c})=>c).filter(Boolean),l=n2({eventId:n.eventId,tournamentRecord:e,autoPublish:t,auditData:i,drawIds:o,event:n,force:r});return l.error?l:JL({event:n,name:Xu})}return{...pe}}function r9(t){let{matchUpFormat:e,recoveryTimes:i,averageTimes:n,tournamentId:r,eventId:a}=t,s=(t==null?void 0:t.tournamentRecords)??((t==null?void 0:t.tournamentRecord)&&{[t.tournamentRecord.tournamentId]:t.tournamentRecord})??{};if(!Object.keys(s).length)return{error:Tr};let o=Object.keys(s).filter(c=>!r||r===c);if(r&&!o.includes(r))return{error:Ae};let l;for(let c of o){let u=s[c],{event:d}=zo({tournamentRecord:u,eventId:a});a&&d&&(l=!0);let p=H8e({tournamentRecord:u,event:d,matchUpFormat:e,averageTimes:n,recoveryTimes:i});if(p.error)return p}return!a||l?{...pe}:{error:Wc}}function H8e({tournamentRecord:t,recoveryTimes:e,matchUpFormat:i,averageTimes:n,event:r}){if(!t)return{error:dt};if(n&&!Array.isArray(n))return{error:Ae};if(e&&!Array.isArray(e))return{error:Ae};let a=sm;if(r){let{extension:s}=xi({element:r,name:a}),o=(s==null?void 0:s.value)||{},l=PJ({...o,matchUpFormat:i,averageTimes:n,recoveryTimes:e});pn({element:r,extension:{name:a,value:l}})}else{let{extension:s}=xi({element:t,name:a}),o=(s==null?void 0:s.value)||{},l=PJ({...o,matchUpFormat:i,averageTimes:n,recoveryTimes:e});pn({extension:{name:a,value:l},element:t})}return{...pe}}function PJ(t){let{matchUpRecoveryTimes:e=[],matchUpAverageTimes:i=[],matchUpFormat:n}=t,{averageTimes:r,recoveryTimes:a}=t;r=(r||[]).filter(l=>{var c,u;return((c=l==null?void 0:l.categoryNames)==null?void 0:c.length)||((u=l==null?void 0:l.categoryTypes)==null?void 0:u.length)});let s=(r==null?void 0:r.length)&&i.map(l=>{var c;return l!=null&&l.matchUpFormatCodes.includes(n)?{...l,matchUpFormatCodes:(c=l.matchUpFormatCodes)==null?void 0:c.filter(u=>u!==n)}:l}).filter(({matchUpFormatCodes:l})=>l==null?void 0:l.length).concat({matchUpFormatCodes:[n],averageTimes:r});a=(a||[]).filter(l=>{var c,u;return((c=l==null?void 0:l.categoryNames)==null?void 0:c.length)||((u=l==null?void 0:l.categoryTypes)==null?void 0:u.length)});let o=(a==null?void 0:a.length)&&e.map(l=>{var c;return l!=null&&l.matchUpFormatCodes.includes(n)?{...l,matchUpFormatCodes:(c=l.matchUpFormatCodes)==null?void 0:c.filter(u=>u!==n)}:l}).filter(({matchUpFormatCodes:l,averageTimes:c})=>(l==null?void 0:l.length)||c).concat({matchUpFormatCodes:[n],recoveryTimes:a});return{matchUpAverageTimes:(s==null?void 0:s.length)&&s||i,matchUpRecoveryTimes:(o==null?void 0:o.length)&&o||e}}function tSe(t){let{tournamentRecord:e,recoveryMinutes:i,averageMinutes:n,matchUpFormat:r,categoryType:a,eventId:s,event:o}=t;if(!e)return{error:dt};if(!Ll({matchUpFormat:r}))return{error:Ae};if(!o)return{error:Qn};let{averageTimes:l=[],recoveryTimes:c=[]}=QF({tournamentRecord:e,matchUpFormat:r,event:o}),u=o.category,d=(u==null?void 0:u.categoryName)||(u==null?void 0:u.ageCategoryCode)||(o==null?void 0:o.eventId),p={categoryNames:[d],minutes:{}},h={categoryNames:[d],minutes:{}},f=b=>{var I,T;if((I=b.categoryTypes)!=null&&I.includes(a)&&console.log("encountered:",{categoryType:a}),!((T=b.categoryNames)!=null&&T.includes(d)&&(b.categoryNames=b.categoryNames.filter(w=>w!==d),p={minutes:b.minutes,categoryNames:[d]},!b.categoryNames.length)))return b},m=n&&!isNaN(di(n)),g=i&&!isNaN(di(i)),v=l.map(f).filter(b=>{var I;return(I=b==null?void 0:b.categoryNames)==null?void 0:I.length}),y=c.map(f).filter(b=>{var I;return(I=b==null?void 0:b.categoryNames)==null?void 0:I.length});return m&&(Object.assign(p.minutes,{[(o==null?void 0:o.eventType)||On]:n}),v.push(p)),g&&(Object.assign(h.minutes,{[(o==null?void 0:o.eventType)||On]:i}),y.push(h)),!m&&!g?{error:Ae}:r9({averageTimes:m&&v,recoveryTimes:g&&y,tournamentRecord:e,matchUpFormat:r,eventId:s,event:o})}function r2(t){if(t.event)return CJ({event:t.event});{t.tournamentRecord&&!t.tournamentRecords&&(t.tournamentRecords={[t.tournamentRecord.tournamentId]:t.tournamentRecord});let e=ei(t,[{[Os]:!0,[vye]:!0}]);if(e.error)return e;let{tournamentRecords:i,eventId:n}=t;for(let r of Object.values(i??{})){let{event:a}=zo({tournamentRecord:r,eventId:n});if(a)return CJ({event:a})}}return{error:Wc}}function CJ({event:t}){return JL({event:t,name:sm})}var z8e="MON",q8e="TUE",W8e="WED",Y8e="THU",K8e="FRI",Z8e="SAT",X8e="SUN",iSe={MON:z8e,TUE:q8e,WED:W8e,THU:Y8e,FRI:K8e,SAT:Z8e,SUN:X8e};function nSe(t){return!Array.isArray(t)||Pi(t).length!==t.length?!1:t.every(e=>Object.keys(iSe).includes(e))}function a9({tournamentRecord:t,event:e,startDate:i}){if(!t)return{error:dt};if(!e)return{error:Qn};if(!_p.test(i))return{error:Va};let n=rSe(t);if(n.error)return n;let{tournamentStartDate:r,tournamentEndDate:a}=n,s=new Date(Mi(i)).getTime();if(!r||!a||s<r||s>a)return{error:Va};let o=e.endDate&&new Date(Mi(e.endDate)).getTime();return o&&s>o&&(e.endDate=i),e.startDate=i,{...pe}}function s9(t){let{tournamentRecord:e,event:i,endDate:n}=t;if(!e)return{error:dt};if(!i)return{error:Qn};if(!_p.test(n))return{error:Va};let r=rSe(e);if(r.error)return r;let{tournamentStartDate:a,tournamentEndDate:s}=r,o=new Date(Mi(n)).getTime();if(!a||!s||o<a||o>s)return{error:Va};let l=i.startDate&&new Date(Mi(i.startDate)).getTime();return l&&o<l&&(i.startDate=n),i.endDate=n,{...pe}}function o9(t){var e;let i=ei(t,[{tournamentRecord:!0,event:!0},{[ps]:c=>_p.test(c),[cc]:Va,startDate:!1,endDate:!1},{[ps]:c=>c.filter(Boolean).every(u=>_p.test(u)),[cc]:Va,activeDates:!1},{[ps]:nSe,weekdays:!1}]);if(i.error)return i;let{tournamentRecord:n,weekdays:r,event:a,startDate:s,endDate:o}=t,l=(e=t.activeDates)==null?void 0:e.filter(Boolean);if(s&&o){let c=new Date(Mi(s)).getTime(),u=new Date(Mi(o)).getTime();if(c>u)return{error:Ae}}if(l){let c=s||n.startDate,u=o||n.endDate,d=!c||l.every(h=>new Date(h)>=new Date(c)),p=!u||l.every(h=>new Date(h)<=new Date(u));if(!d||!p)return{error:Va}}if(s){let c=a9({tournamentRecord:n,event:a,startDate:s});if(c.error)return c}if(o){let c=s9({tournamentRecord:n,event:a,endDate:o});if(c.error)return c}return l&&(a.activeDates=l),r&&(a.weekdays=r),{...pe}}function rSe(t){let{startDate:e,endDate:i}=t;return!_p.test(e)||!_p.test(i)?fe({result:{error:Tge},context:{startDate:e,endDate:i}}):{tournamentStartDate:new Date(Mi(e)).getTime(),tournamentEndDate:new Date(Mi(i)).getTime()}}function l9({event:t,orderedDrawIdsMap:e}){var i,n;if(typeof t!="object")return{error:Qn};if(!e)return{error:si,info:"Missing drawIdsOrderMap"};if(typeof e!="object")return{error:Ae,info:"orderedDrawIdsMap must be an object"};let r=Object.values(e);if(!r.every(s=>!isNaN(s)))return{error:Ae,info:"drawOrder must be numeric"};if(Pi(r).length!==r.length)return{error:Ae,info:"drawOrder values must be unique"};if((i=t.drawDefinitions)!=null&&i.length){let s=(t.drawDefinitions||[]).map(({drawId:l})=>l),o=Object.keys(e);if(o!=null&&o.length&&Ar(s,o).length!==s.length)return{error:Ae,info:"Missing drawIds"};t.drawDefinitions.forEach(l=>{l.drawOrder=e[l.drawId]})}let{flightProfile:a}=kr({event:t});return(n=a==null?void 0:a.flights)==null||n.forEach(s=>{s.flightNumber=e[s.drawId]}),{...pe}}function c9({tournamentRecord:t,event:e}){var i;if(!t)return{error:dt};if(!e)return{error:Qn};let{flightProfile:n}=kr({event:e}),r=(n==null?void 0:n.flights)&&Object.assign({},...n.flights.sort((a,s)=>a.flightNumber-s.flightNumber).map((a,s)=>({[a.drawId]:s+1})))||((i=e.drawDefinitions)==null?void 0:i.length)&&Object.assign({},...e.drawDefinitions.sort((a,s)=>a.drawOrder-s.drawOrder).map((a,s)=>({[a.drawId]:s+1})))||void 0;return r?l9({event:e,orderedDrawIdsMap:r}):{...pe}}function aSe({autoPublish:t=!0,tournamentRecord:e,auditData:i,drawId:n,event:r,force:a}){var s,o;if(!e)return{error:dt};if(!n)return{error:jd};if(!r)return{error:Qn};let{flightProfile:l}=kr({event:r});if(l&&(s=l.flights)!=null&&s.find(c=>c.drawId===n)){let c=l.flights.filter(d=>d.drawId!==n),u={name:Xu,value:{...l,flights:c}};Jg({event:r,extension:u})}if((o=r.drawDefinitions)!=null&&o.find(c=>c.drawId===n)){let c=n2({drawIds:[n],eventId:r.eventId,tournamentRecord:e,autoPublish:t,auditData:i,event:r,force:a});if(c.error)return c}return c9({tournamentRecord:e,event:r})}function sSe(t){var e,i;let n=ei(t,[{[Zg]:!0,[Ia]:!0,[R6]:!1},{replacementIndividualParticipantId:!0,[ps]:y=>ur(y),existingIndividualParticipantId:!0,[$u]:da,participantId:!0}]),{replacementIndividualParticipantId:r,existingIndividualParticipantId:a,tournamentRecord:s,drawDefinition:o,participantId:l,event:c,uuids:u}=t;if(n.error)return n;if((c==null?void 0:c.eventType)!==Yc)return{error:jh};if(!(((e=c==null?void 0:c.entries)==null?void 0:e.filter(({entryStatus:y})=>[ou,tb].includes(y)).map(({participantId:y})=>y))||[]).includes(r))return{error:xd};let d=(s.participants||[]).find(y=>y.participantId===l);if((d==null?void 0:d.participantType)!==Ai)return{error:yw,participant:d};let p=d.individualParticipantIds,h=[r,...p.filter(y=>y!==a)],{participant:f}=Qu({participantIds:h,tournamentRecord:s}),m;if(f)m=f.participantId;else{let y={participantId:u==null?void 0:u.pop(),participantRole:vs,individualParticipantIds:h,participantType:Ai},b=$p({participant:y,returnParticipant:!0,tournamentRecord:s});if(b.error)return b;m=b.participant.participantId}let{flightProfile:g}=kr({event:c});if(o){let y=(i=g==null?void 0:g.flights)==null?void 0:i.find(({drawId:b})=>b===o.drawId);y&&(y.drawEntries=y.drawEntries.map(b=>b.participantId===l?{...b,participantId:m}:b)),o.entries=o.entries.map(b=>b.participantId===l?{...b,participantId:m}:b);for(let b of o.structures||[])if(b.structures){b.positionAssignments=void 0;for(let I of b.structures)I.positionAssignments=I.positionAssignments.map(T=>T.participantId===l?{...T,participantId:m}:T)}else b.positionAssignments&&(b.positionAssignments=b.positionAssignments.map(I=>I.participantId===l?{...I,participantId:m}:I))}c.entries=c.entries.map(y=>y.participantId===l&&{...y,participantId:m}||y.participantId===r&&{...y,participantId:a}||y);let v=s.events.some(({entries:y,eventId:b,drawDefinitions:I})=>c.eventId===b?I.some(({drawId:T,entries:w})=>T===(o==null?void 0:o.drawId)?!1:w==null?void 0:w.find(S=>S.participantId===l)):y==null?void 0:y.find(T=>T.participantId===l));if(!v){let y=Ow({addIndividualParticipantsToEvents:!1,participantIds:[l],tournamentRecord:s});if(y.error)return y}return{...pe,participantOtherEntries:v,newPairParticipantId:m}}function lM(t){var e,i,n,r,a,s,o,l,c,u,d,p;let{flight:h,suppressNotifications:f,modifyEventEntries:m,existingDrawCount:g,allowReplacement:v,checkEntryStatus:y,tournamentRecord:b,drawDefinition:I,event:T}=t;if(!I)return{error:Ht};if(!T)return{error:Qn};T.drawDefinitions||(T.drawDefinitions=[]);let{drawId:w,drawName:S,entries:U}=I,{entries:P}=T,E=0;if(g!==void 0&&g!==T.drawDefinitions.length)return{error:Ae,info:"drawDefintions count mismatch"};let{flightProfile:R}=kr({event:T}),C=h&&((e=R==null?void 0:R.flights)==null?void 0:e.find(z=>z.flightNumber===h.flightNumber)),M=(r=(n=(i=R==null?void 0:R.links)==null?void 0:i.find(z=>{var W;return((W=z==null?void 0:z.target)==null?void 0:W.drawId)===w}))==null?void 0:n.source)==null?void 0:r.drawId;if(M&&!T.drawDefinitions.find(z=>z.drawId===M))return fe({result:{error:Ht},info:{sourceDrawId:M}});if(C&&C.drawId!==I.drawId)return fe({result:{error:Yb},info:{relevantFlight:C}});let _=U==null?void 0:U.every(({participantId:z,entryStatus:W})=>{let Z=C==null?void 0:C.drawEntries.find(K=>K.participantId===z);return!W||(Z==null?void 0:Z.entryStatus)===W}),A=!y||P&&(U==null?void 0:U.every(({participantId:z,entryStatus:W,entryStage:Z})=>{var K;return((K=P.find(Q=>Q.participantId===z&&(!Q.entryStage||Q.entryStage===Z)))==null?void 0:K.entryStatus)===W}));if(C&&!_)return fe({result:{error:Yb},context:{drawEntriesPresentInFlight:_,matchingEventEntries:A,relevantFlight:C},info:"Draw entries are not present in flight or do not match entryStatuses"});if(m&&(U==null||U.filter(Boolean).forEach(z=>{if(z!=null&&z.entryStatus&&sd.includes(z==null?void 0:z.entryStatus)){let W=P==null?void 0:P.filter(Boolean).find(Z=>Z.participantId===z.participantId);W&&z.entryStatus&&(W==null?void 0:W.entryStatus)!==z.entryStatus&&(W.entryStatus=z.entryStatus,E+=1)}})),P&&!A)return fe({result:{info:"Draw entries do not match event entryStatuses",context:{matchingEventEntries:A,eventEntries:P},error:Yb}});let N=((s=(a=R==null?void 0:R.flights)==null?void 0:a.map(({flightNumber:z})=>!isNaN(z)&&di(z)))==null?void 0:s.filter(Boolean))||[],k=((o=T.drawDefinitions.map(({drawOrder:z})=>z&&di(z)))==null?void 0:o.filter(Boolean))||[],O=Math.max(0,...k,...N)+1,$=(l=R==null?void 0:R.flights)==null?void 0:l.find(z=>z.drawId===w),F;if($){$.drawName=I.drawName,F={name:Xu,value:{...R,flights:R.flights}};let z=$.flightNumber;z&&!k.includes(z)?O=z:$.flightNumber=O}else{let z=(R==null?void 0:R.flights)||[];z.push({manuallyAdded:!0,flightNumber:O,drawEntries:U,drawName:S,drawId:w}),F={name:Xu,value:{...R||{},flights:z}}}Jg({event:T,extension:F}),Object.assign(I,{drawOrder:O});let V=T.drawDefinitions.find(z=>z.drawId===w),j=b==null?void 0:b.tournamentId,B=T.eventId;if(V){if(!v)return{error:Qme};let z=((u=(c=po({drawDefinition:V}))==null?void 0:c.matchUps)==null?void 0:u.map(Ca))??[],W=(d=po({drawDefinition:I}))==null?void 0:d.matchUps;if(!f){z!=null&&z.length&&Cm({matchUpIds:z,action:"modifyDrawDefinition",tournamentId:j,eventId:B}),W!=null&&W.length&&Tg({matchUps:W,tournamentId:j,eventId:B}),T.drawDefinitions=T.drawDefinitions.map(K=>K.drawId===w?I:K);let Z=(p=I.structures)==null?void 0:p.map(({structureId:K})=>K);zn({drawDefinition:I,tournamentId:j,structureIds:Z,eventId:B})}}else if(T.drawDefinitions.push(I),!f){let{matchUps:z}=po({drawDefinition:I,event:T});z&&Tg({tournamentId:b==null?void 0:b.tournamentId,matchUps:z}),bR({drawDefinition:I,tournamentId:j,eventId:B})}return{...pe,modifiedEventEntryStatusCount:E}}function oSe(t){let{provisionalPositioning:e,useExistingSeedLimit:i,tournamentRecord:n,drawDefinition:r,seedingProfile:a,structureId:s,assignments:o,drawId:l,event:c}=t,u=0;if(!(o!=null&&o.length))return{error:V5};if(!n)return{error:dt};if(!l)return{error:jd};let d=Zc({provisionalPositioning:e,drawDefinition:r,structureId:s});if(d.error)return d;let{seedAssignments:p,seedLimit:h}=d,f=Object.assign({},...(p??[]).filter(v=>v.seedNumber).map(v=>({[v.seedNumber]:v})));o.forEach(v=>{let{seedNumber:y}=v;h&&y<=h&&(!i||f[y])&&(f[y]=v)});let m=Object.values(f),g=m.map(v=>v==null?void 0:v.participantId).filter(Boolean);if(g.length!==jme(g).length)return{error:ege};for(let v of m){let y=ZU({...v,provisionalPositioning:e,tournamentRecord:n,drawDefinition:r,seedingProfile:a,structureId:s,event:c});if(y!=null&&y.error)return y;y!=null&&y.success&&u++}return u?{...pe,modifications:u}:{error:LU}}function u9({deleteExisting:t,event:e,flightProfile:i}){var n;let r="attachFlightProfile";if(!i)return fe({result:{error:si},stack:r});if(!e)return fe({result:{error:Qn},stack:r});let{flightProfile:a}=kr({event:e});return a&&!t?fe({result:{error:r6},stack:r}):(n=e.drawDefinitions)!=null&&n.length?fe({result:{error:Zme},stack:r}):(Jg({event:e,extension:{name:Xu,value:i}}),{flightProfile:$t(i,!1,!0),...pe})}function J8e({tournamentRecord:t,scaleAttributes:e,participantIds:i}){var n;if(!t)return{error:dt};if(!i)return{error:Yg};if(!e)return{error:si,info:"scaleAttributes required"};let{scaleType:r,eventType:a,scaleName:s}=e,o=[hbe,r,a,s].join(".");return(n=t.participants)==null||n.forEach(l=>{i.includes(l.participantId)&&l.timeItems&&(l.timeItems=l.timeItems.filter(c=>c&&(c==null?void 0:c.itemType)!==o))}),{...pe}}function d9({tournamentRecord:t,scaleAttributes:e,drawDefinition:i,entryStatuses:n,drawId:r,event:a,stage:s}){var o;if(!a)return{error:Qn};if(n&&!Array.isArray(n))return fe({result:{error:Ae},info:Sy("entryStatus"),stack:"removeScaleValues"});let l=a.entries;if(r){let{flightProfile:u}=kr({event:a}),d=(o=u==null?void 0:u.flights)==null?void 0:o.find(p=>p.drawId===r);d?l=d.drawEntries:l=i==null?void 0:i.entries}let c=(l||[]).filter(u=>(!s||!u.entryStage||u.entryStage===s)&&(!n||n.includes(u.entryStatus))).map(Gi);return J8e({tournamentRecord:t,scaleAttributes:e,participantIds:c})}function a2({removePriorValues:t,tournamentRecord:e,displaySettings:i,status:n=vc,event:r}){if(!e)return fe({result:{error:dt}});if(!r)return fe({result:{error:Qn}});if(!tn(i))return fe({result:{error:si}});if(tn(i.draws))for(let s of Object.keys(i.draws)){let o=i.draws[s].scheduleDetails??[];if(o.length){let l=[];for(let c of o){let u=l.find(d=>PHe(d.attributes,c.attributes));u!=null&&u.dates&&c.dates?u.dates.push(...c.dates):l.push(c)}i.draws[s].scheduleDetails=l}}let a=n1({statusObject:{displaySettings:i},removePriorValues:t,status:n,event:r});return a.error?a:{...pe}}function lSe({tournamentRecord:t,drawDefinition:e,entryStatuses:i,scaleName:n,drawId:r,event:a,stage:s}){var o,l;if(!t)return{error:dt};if(!a)return{error:Qn};n=n||((o=a.category)==null?void 0:o.categoryName)||((l=a.category)==null?void 0:l.ageCategoryCode);let c={eventType:a.eventType,scaleType:Ph,scaleName:n};return d9({tournamentRecord:t,scaleAttributes:c,drawDefinition:e,entryStatuses:i,drawId:r,event:a,stage:s})}function cSe(t){let e=ei(t,[{[Ia]:!0},{eventIds:!0,[Wo]:Ms}]);if(e.error)return e;let{removePairParticipants:i,tournamentRecord:n,eventIds:r}=t,a=[],s=[],o=[],l=[];if(n.events=(n.events||[]).filter(c=>{if(r.includes(c.eventId)){let p={action:hA,payload:{events:[c]}};a.push(p),s.push({tournamentId:n.tournamentId,eventName:c.eventName,eventType:c.eventType,category:c.category,eventId:c.eventId,gender:c.gender})}let u=c.eventType===Yc?(c.entries||[]).map(({entryStatus:p,participantId:h})=>p!==ou&&h).filter(Boolean):[],d=r.includes(c.eventId);return d?l.push(...u):o.push(...u),!d}),i){let c=l.filter(u=>!o.includes(u));n.participants=n.participants.filter(({participantId:u})=>!c.includes(u))}if(rM({tournamentRecord:n}),a.length)if(xL(kf)){let c=n.tournamentId;Ti({topic:kf,payload:{type:hA,tournamentId:c,detail:a}})}else XR({tournamentRecord:n,timeItem:{itemValue:s,itemType:hA}});return{...pe}}function uSe(t){var e,i,n;let r=ei(t,[{tournamentRecord:!0,eventId:!0,event:!0},{eventUpdates:!0,_ofType:tl}]);if(r.error)return r;let{eventUpdates:a,event:s}=t,o="modifyEvent",l=t7e(t),c=i7e({enteredParticipants:l}),{enteredParticipantGenders:u,enteredParticipantTypes:d}=c,p=(i=(e=kr({event:s}))==null?void 0:e.flightProfile)==null?void 0:i.flights,h=!((n=s.drawDefinitions)!=null&&n.length)&&!(p!=null&&p.length),f=n7e({noFlightsNoDraws:h,enteredParticipantGenders:u,eventUpdates:a,stack:o});if(f.error)return f;let m=r7e({enteredParticipantTypes:d,eventUpdates:a,stack:o});if(m.error)return m;let g=Q8e({...t,...c,enteredParticipants:l,stack:o});if(g.error)return g;let v=e7e({...t,stack:o});return v.error?v:(a.eventType&&(s.eventType=a.eventType),a.eventName&&(s.eventName=a.eventName),a.gender&&(s.gender=a.gender),{...pe})}function Q8e(t){var e,i,n,r,a,s;let o=(e=t.eventUpdates)==null?void 0:e.category;if(!o)return{...pe};let l=$E({category:o});if(l.error)return l;if(t.event.eventType===aa){let c=((n=(i=t.event)==null?void 0:i.drawDefinitions)==null?void 0:n.map(p=>rp(p)))??[],u=rp(t.event),d=(((r=nf(t))==null?void 0:r.matchUps)??[]).map(p=>rp(p))??[];if(![u,...c,...d].filter(Boolean).every(p=>p.collectionDefinitions.every(h=>!h.category||uR({category:t.eventUpdates.category,childCategory:h.category}))))return fe({result:{error:_E},stack:t.stack})}if((a=t.enteredParticipants)!=null&&a.length){let c=t.eventUpdates.startDate||t.event.startDate||t.tournamentRecord.startDate,u=t.eventUpdates.endDate||t.event.endDate||t.tournamentRecord.endDate,d=t.enteredParticipants.map(f=>f.participantType===Hi?f:f.individualParticpants??[]).flat(),p=SI({category:o,consideredDate:c}),h=SI({category:o,consideredDate:u});if(p!=null&&p.ageMinDate||p!=null&&p.ageMaxDate||h!=null&&h.ageMinDate||h!=null&&h.ageMaxDate)for(let f of d){let m=(s=f.person)==null?void 0:s.birthDate;if(!m)return fe({result:{error:bge},stack:t.stack});let g=new Date(m).getTime();if(p.ageMinDate||p.ageMaxDate){let v=new Date(p.ageMinDate).getTime(),y=new Date(p.ageMaxDate).getTime();if(g<v||g>y)return fe({result:{error:Fj},stack:t.stack})}if(h.ageMin||h.ageMax){let v=new Date(h.ageMinDate).getTime(),y=new Date(h.ageMaxDate).getTime();if(g<v||g>y)return fe({result:{error:Fj},stack:t.stack})}}}return{...pe}}function e7e(t){let{tournamentRecord:e,eventUpdates:i,event:n,stack:r}=t;if(i.startDate||i.endDate){let a=o9({startDate:i.startDate,endDate:i.endDate,tournamentRecord:e,event:n});if(a.error)return fe({result:a,stack:r})}return{...pe}}function t7e(t){var e;let{tournamentRecord:i,event:n}=t,r=((e=n==null?void 0:n.entries)==null?void 0:e.filter(({entryStatus:a})=>{let s=a;return[...sd,Bu].includes(s)}).map(({participantId:a})=>a))??[];return r?br({participantFilters:{participantIds:r},withIndividualParticipants:!0,tournamentRecord:i}).participants??[]:[]}function i7e({enteredParticipants:t}){let e=[],i=t.reduce((r,a)=>{var s,o;let l=(s=a.person)!=null&&s.sex?[a.person.sex]:((o=a.individualParticpants)==null?void 0:o.map(c=>{var u;return(u=c.person)==null?void 0:u.sex}))||[];return e.push(...l),r.includes(a.participantType)?r:r.concat(a.participantType)},[]),n=Pi(e);return{enteredParticipantTypes:i,enteredParticipantGenders:n}}function n7e({noFlightsNoDraws:t,enteredParticipantGenders:e,eventUpdates:i,stack:n}){let r=!e.length||!i.gender||i.gender===Ld||e.length===1&&e[0]===i.gender||t&&i.gender===Fo;return i.gender&&!r?fe({context:{gender:i.gender,validGender:r},result:{error:bD},stack:n}):{...pe}}function r7e({enteredParticipantTypes:t,eventUpdates:e,stack:i}){let n=(t.includes(aa)&&[aa]||t.includes(Hi)&&[kp]||t.includes(Ai)&&[Yc]||[Yc,kp,aa]).includes(e.eventType??"");return e.eventType&&!n?fe({context:{participantType:e.eventType,validEventType:n},result:{error:jh},stack:i}):{...pe}}function s2({qualifyingPositions:t,drawEntries:e=[],drawName:i,drawId:n,event:r,stage:a}){var s,o,l;let c="addFlight";if(!r)return fe({result:{error:Qn},stack:c});if(!i)return fe({result:{error:si},stack:c});if(e!=null&&e.length){let g=(r.entries??[]).map(Gi),v=e.map(Gi);if(Ar(v,g).length!==v.length)return fe({result:{error:Ae},stack:c})}let u=(s=kr({event:r}))==null?void 0:s.flightProfile,d=((l=(o=u==null?void 0:u.flights)==null?void 0:o.map(({flightNumber:g})=>!isNaN(g)&&di(g)))==null?void 0:l.filter(Boolean))||[],p=Math.max(0,...d)+1,h={drawId:n||bn(),flightNumber:p,drawEntries:e,drawName:i};if(a&&(h.stage=a),t&&(h.qualifyingPositions=t),((u==null?void 0:u.flights)||[]).find(({drawId:g})=>g===h.drawId))return fe({result:{error:Jge},stack:c});let f=((u==null?void 0:u.flights)||[]).concat(h),m={name:Xu,value:{...u||{},flights:f}};return Jg({event:r,extension:m})}var dSe={};Fi(dSe,{drawMatic:()=>T7,garman:()=>ySe,generateAdHocMatchUps:()=>_F,generateAdHocRounds:()=>S7,generateAndPopulatePlayoffStructures:()=>J8,generateCourts:()=>p9,generateDrawDefinition:()=>oM,generateDrawMaticRound:()=>p7,generateDrawStructuresAndLinks:()=>c7,generateDrawTypeAndModifyDrawDefinition:()=>u7,generateFlightProfile:()=>o7e,generateLineUps:()=>vSe,generateQualifyingStructure:()=>G8,generateSeedingScaleItems:()=>B0e,generateStatCrew:()=>l7e,generateVoluntaryConsolation:()=>bwe,roundRobinGroups:()=>fWe});var a7e="splitLevelBased",pSe="splitWaterfall",hSe="splitShuttle",s7e={SPLIT_LEVEL_BASED:a7e,SPLIT_WATERFALL:pSe,SPLIT_SHUTTLE:hSe};function o7e(t){let{drawNameRoot:e="Flight",attachFlightProfile:i,tournamentRecord:n,scaleAttributes:r,scaleSortMethod:a,deleteExisting:s,sortDescending:o,drawNames:l=[],flightsCount:c,splitMethod:u,uuids:d=[],event:p,stage:h}=t;if(!p)return{error:Qn};let f=p.entries??[],{flightProfile:m}=kr({event:p});if(m&&i&&!s)return{error:r6};let g=t.scaledEntries??Bw({tournamentRecord:n,scaleAttributes:r,scaleSortMethod:a,sortDescending:o,event:p,stage:h}).scaledEntries,v=g.map(Gi),y=co(f.filter(({participantId:E})=>!v.includes(E)).filter(E=>(!h||!E.entryStage||E.entryStage===h)&&(!E.entryStatus||ib.includes(E.entryStatus)))),b=g.concat(...y),I=b.length,T=Math.ceil(I/c),w=Na(b,T);u===pSe?w=Mj(b,c):u===hSe&&(w=Mj(b,c,!0));function S(E){return(E||[]).map(({participantId:R,scaleValue:C})=>{let M=f.find(_=>_.participantId===R);return M!=null&&M.scaleValue&&C&&(M.scaleValue=C),M}).sort((R,C)=>R.scaleValue-C.scaleValue).map((R,C)=>(R.scaleValue&&(R.seedNumber=C+1),R))}let U=Mt(0,c).map(E=>{let R=E+1;return{flightNumber:R,drawId:(d==null?void 0:d.pop())??bn(),drawEntries:S(w[E]),drawName:(l==null?void 0:l.length)&&l[E]||`${e} ${R}`}}),P={scaleAttributes:r,splitMethod:u,flights:U};if(i){let E=u9({flightProfile:P,deleteExisting:s,event:p});return{splitEntries:oc()&&w||void 0,...E}}else return{flightProfile:P,...pe}}function fSe({json:t,tagName:e}){let i=Object.keys(t).filter(a=>Array.isArray(t[a])).map(a=>({key:a,value:t[a].filter(s=>typeof s=="object"&&Object.keys(s).length===1)})),n=Object.keys(t).filter(a=>typeof t[a]=="object"&&!Array.isArray(t[a])).map(a=>({key:a,value:t[a]})),r=Object.keys(t).filter(a=>["string","number"].includes(typeof t[a])).map(a=>({key:a,value:t[a]}));return mSe({tagName:e,attributes:r,childArrays:i,childObjects:n})}function mSe(t){let{tagName:e,attributes:i=[],childArrays:n=[],childObjects:r}=t,a=`\r
`,s=h=>{let f=Object.keys(h)[0],m=h[f];return{key:f,value:m}},o=n==null?void 0:n.map(({key:h,value:f})=>mSe({tagName:h,childObjects:f.map(s)})).join(`\r
`),l=r==null?void 0:r.map(({key:h,value:f})=>fSe({tagName:h,json:f??[]})).join(`\r
`),c=i==null?void 0:i.map(({key:h,value:f})=>`${h}="${f}"`).join(" "),u=c?` ${c}`:"";if(e==="childArray")return l;let d=l!=null&&l.length?`${a}${l}${a}`:"",p=o!=null&&o.length?`${a}${o}${a}`:"";return`<${e}${u}>${d}${p}</${e}>`}function l7e(t){var e,i,n;let r=ei(t,[{[Ia]:!0}]);if(r.error)return r;let{tournamentRecord:a}=t,{startDate:s,tournamentId:o,tournamentName:l}=a,{participantMap:c,matchUps:u,mappedMatchUps:d}=br({withMatchUps:!0,withEvents:!0,tournamentRecord:a}),p=a.participants.filter(w=>w.participantType===Pn),h=(u==null?void 0:u.filter(w=>w.matchUpType===Pn))??[],f=(h==null?void 0:h.reduce((w,S)=>{let U=(S==null?void 0:S.tieMatchUps)??[];return U&&[...w,...U]},[]))??[],m=(u==null?void 0:u.filter(w=>w.matchUpType===On))??[],g=(u==null?void 0:u.filter(w=>w.matchUpType===Nn))??[],v=f.length===m.length+g.length,y=h.length===1&&v,b={mappedMatchUps:d,participantMap:c,tournamentName:l,tournamentId:o,tournament:v?"N":"Y",startDate:s},I=[],T=[];if(y){let w=h[0],{json:S,xml:U}=RJ({teamParticipants:p,teamMatchUp:w,...b,doubles:g,singles:m});T.push(S),I.push(U)}else for(let w of h){let S=(e=w==null?void 0:w.sides)==null?void 0:e.map(({participant:R})=>R==null?void 0:R.participantId).filter(Boolean);if((S==null?void 0:S.length)!==2)continue;let U=S.map(R=>{var C;return R&&((C=c==null?void 0:c[R])==null?void 0:C.participant)}),{xml:P,json:E}=RJ({doubles:(i=w.tieMatchUps)==null?void 0:i.filter(R=>R.matchUpType===Nn),singles:(n=w.tieMatchUps)==null?void 0:n.filter(R=>R.matchUpType===On),teamParticipants:U,teamMatchUp:w,...b});T.push(E),I.push(P)}return{json:T,xml:I,...pe}}function RJ({teamParticipants:t,mappedMatchUps:e,participantMap:i,tournamentName:n,tournamentId:r,teamMatchUp:a,tournament:s,startDate:o,doubles:l,singles:c}){var u,d,p,h;let f=t==null?void 0:t.find(U=>{var P;return(P=U.participantRoleResponsibilities)==null?void 0:P.includes("Home")}),m=t==null?void 0:t.filter(U=>U.participantId!==(f==null?void 0:f.participantId)),g=Lu(o,"/","MDY"),v=(f==null?void 0:f.participantName)||((u=m==null?void 0:m[1])==null?void 0:u.participantName),y=(f==null?void 0:f.participantId)||((d=m==null?void 0:m[1])==null?void 0:d.participantId),b=(p=m==null?void 0:m[0])==null?void 0:p.participantName,I=(h=m==null?void 0:m[0])==null?void 0:h.participantId,T={},w=t.map(U=>({team:{...d7e({teamParticipant:U,teamMatchUp:a,uniValues:T,participantMap:i,mappedMatchUps:e,homeid:y})}})),S=Zt({venue:{tournamentname:s?n:void 0,neutralgame:f?"N":"Y",gameid:r,officials:{},tournament:s,rules:{},homename:v,visname:b,homeid:y,visid:I,date:g},childArray:w,singles_matches:c==null?void 0:c.map(U=>MJ({matchUp:U,homeid:y,uniValues:T})),doubles_matches:l==null?void 0:l.map(U=>MJ({matchUp:U,homeid:y,uniValues:T}))});return{json:S,xml:fSe({json:S,tagName:"tngame"})}}function c7e({homeid:t,uniValues:e,participant:i}){var n,r,a,s,o,l,c,u,d,p,h,f,m,g,v;if(!i)return{};let y=((n=i.individualParticipants)==null?void 0:n.length)===2,b=y?Pi((r=i.individualParticipants)==null?void 0:r.map(_=>{var A,N;return(N=(A=_.teams)==null?void 0:A[0])==null?void 0:N.participantId})):[],I=y?Pi((a=i.individualParticipants)==null?void 0:a.map(_=>{var A,N;return(N=(A=_.teams)==null?void 0:A[0])==null?void 0:N.teamId})):[],T=!y&&((o=(s=i.teams)==null?void 0:s[0])==null?void 0:o.participantId)||(b==null?void 0:b.length)===1&&b[0]||void 0,w=!y&&((c=(l=i.teams)==null?void 0:l[0])==null?void 0:c.teamId)||(I==null?void 0:I.length)===1&&I[0]||T,S=y?void 0:i.participantName,U=(d=(u=i.individualParticipants)==null?void 0:u[0])==null?void 0:d.participantName,P=(h=(p=i.individualParticipants)==null?void 0:p[1])==null?void 0:h.participantName,E=t&&(T===t?"H":"V")||"",R=y?void 0:e[T][i.participantId],C=e[T][(m=(f=i.individualParticipants)==null?void 0:f[0])==null?void 0:m.participantId],M=e[T][(v=(g=i.individualParticipants)==null?void 0:g[1])==null?void 0:v.participantId];return Zt({vh:E,uni:R,uni_1:C,uni_2:M,team:w,name:S,name_1:U,name_2:P})}function u7e({sets:t,sideNumber:e}){return Object.assign({},...(t==null?void 0:t.map(i=>{let{setNumber:n,side1Score:r,side2Score:a,side1TiebreakScore:s,side2TiebreakScore:o}=i,l=`set_${n}`,c=`tie_${n}`,u=e===1?r:a,d=e===1?s:o;return{[l]:u,[c]:d}}))??[])}function d7e({teamParticipant:t,teamMatchUp:e,participantMap:i,mappedMatchUps:n,homeid:r,uniValues:a}){var s,o,l,c,u,d,p,h,f,m,g,v,y,b;let{participantId:I,participantName:T}=t,w=r&&(I===r?"H":"V")||"",S=(s=i==null?void 0:i[I])==null?void 0:s.matchUps,U=S&&Object.keys(S),P=(l=(o=e==null?void 0:e.sides)==null?void 0:o.find(({participant:O})=>O.participantId===I))==null?void 0:l.sideNumber,E=((d=(u=(c=e==null?void 0:e.score)==null?void 0:c.sets)==null?void 0:u[0])==null?void 0:d[`side${P}Score`])??0;a[I]={};let R={SINGLES:{w:0,l:0},DOUBLES:{w:0,l:0}},C=[],M=[],_=0;for(let O of U??[]){let $=n==null?void 0:n[O],F=(p=$.sides.find(({participant:j})=>j.participantId===I))==null?void 0:p.sideNumber,V=((m=(f=(h=$.score)==null?void 0:h.sets)==null?void 0:f[0])==null?void 0:m[`side${F}Score`])??0;_+=V;for(let j of $.tieMatchUps??[]){let{matchUpType:B,winningSide:z}=j,W=z&&(z===F?"w":"l")||"";W&&(R[B][W]+=1);let Z=W==="w"?"1":"0",K=W==="l"?"1":"0";if(B===On){let Q=M.length+1;M.push({singles_pair:{pair:Q,won:Z,lost:K,tied:"0"}})}else if(B===Nn){let Q=C.length+1;C.push({doubles_pair:{pair:Q,won:Z,lost:K,tied:"0"}})}}}let A=[{singles:{childArray:M,won:R.SINGLES.w,lost:R.SINGLES.l}},{doubles:{childArray:C,won:R.DOUBLES.w,lost:R.DOUBLES.l}}],N=[],k=1;for(let O of t.individualParticipantIds){let $=i==null?void 0:i[O];if($){let{participant:F,counters:V}=$,j={won:((g=V==null?void 0:V.DOUBLES)==null?void 0:g.wins)||0,lost:((v=V==null?void 0:V.DOUBLES)==null?void 0:v.losses)||0},B={won:((y=V==null?void 0:V.SINGLES)==null?void 0:y.wins)||0,lost:((b=V==null?void 0:V.SINGLES)==null?void 0:b.losses)||0},{participantName:z,participantId:W}=F;a[I][W]=k,N.push({player:{name:z,uni:k,singles:B,doubles:j}})}k+=1}return{vh:w,id:I,name:T,score:E||_,totals:A,childArray:N}}function MJ({matchUp:t,homeid:e,uniValues:i}){let{collectionPosition:n,orderOfFinish:r,matchUpType:a,sides:s}=t??{},o=s==null?void 0:s.map(l=>{var c;let{sideNumber:u,participant:d}=l,p=u7e({sets:(c=t.score)==null?void 0:c.sets,sideNumber:u});return{[a===On?"singles_score":"doubles_score"]:{...c7e({homeid:e,uniValues:i,participant:d}),...p}}});return{[a===On?"singles_match":"doubles_match"]:{match:n,order:r,childArray:o}}}var p7e="ASC",gSe="ASC",h7e="DESC",UG="DESC",f7e={ASC:p7e,ASCENDING:gSe,DESC:h7e,DESCENDING:UG};function vSe(t){var e,i,n,r,a;let{tieFormat:s}=t,{useDefaultEventRanking:o,tournamentRecord:l,drawDefinition:c,scaleAccessor:u,singlesOnly:d,attach:p,event:h}=t;if((h==null?void 0:h.eventType)!==Fl)return{error:jh};if(!l)return{error:dt};if(!s&&!c)return{error:sc};if(s=s??((e=Ws({drawDefinition:c,event:h}))==null?void 0:e.tieFormat),Go({tieFormat:s}).error)return{error:Eh};if(typeof u!="object"&&!o)return{error:Ae,context:{scaleAccessor:u}};let f={},m=((c==null?void 0:c.entries)??(h==null?void 0:h.entries)??[]).filter(N=>(N==null?void 0:N.entryStatus)===dl).map(Gi),{participants:g=[]}=br({withIndividualParticipants:!0,withScaleValues:!0,tournamentRecord:l}),v=g.filter(({participantId:N})=>m.includes(N)),y=N=>N===bg?"rankings":"ratings",b=((i=h==null?void 0:h.category)==null?void 0:i.categoryName)??((n=h==null?void 0:h.category)==null?void 0:n.ageCategoryCode),{scaleName:I=b,scaleType:T=bg,sortOrder:w,accessor:S}=u||{},U=y(T),P=(N,k)=>{var O,$,F;let V=(O=N[U])==null?void 0:O[k];if(!V&&o&&(V=($=N[U])==null?void 0:$[Wb]),Array.isArray(V)){let j=(F=V.find(B=>B.scaleName===I))==null?void 0:F.scaleValue;if(Er(j))return j;if(S&&typeof j=="object")return j[S]}return 0},E=(N,k,O)=>{let $=w===UG?k:N,F=w===UG?N:k;return P($,O)-P(F,O)},R=(N,k)=>E(N,k,Wb),C=(N,k)=>E(N,k,py),M=[],_=(s==null?void 0:s.collectionDefinitions)??[];for(let N of v){let k=((r=N.individualParticipants)==null?void 0:r.sort(R))??[],O=d?k:((a=N.individualParticipants)==null?void 0:a.sort(C))??[],$={};for(let V of _){let j=[],{collectionId:B,matchUpCount:z,matchUpType:W,gender:Z}=V,K=Br(Wb)(W);Mt(0,z).forEach(Q=>{let J=K?k:O??[],se=Q+1,ie=[];Mt(0,K?1:2).forEach(ce=>{var oe;let te=(oe=J==null?void 0:J.find(le=>{var ne;let me=Z&&([Rn,Kn].includes(Z)&&Z||Z===Fo&&[Rn,Kn][ce]);return(!me||me===((ne=le.person)==null?void 0:ne.sex))&&!j.includes(le.participantId)}))==null?void 0:oe.participantId;te&&(ie.push(te),j.push(te),$[te]||($[te]=[]),$[te].push({collectionPosition:se,collectionId:B}))}),K||M.push(ie)})}let F=Object.keys($).map(V=>({collectionAssignments:$[V],participantId:V}));f[N.participantId]=F}let A=[];for(let N of M){let{participant:k}=Qu({tournamentParticipants:g,participantIds:N});if(!k){let O={individualParticipantIds:N,participantRole:vs,participantType:Ai};A.push(O)}}if(p){for(;A.length;)$p({participant:A.pop(),tournamentRecord:l});pn({element:c,extension:{name:am,value:f}})}return{...pe,lineUps:f,participantsToAdd:A}}function p9(t){if(!t)return{error:si};let e=ei(t,[{dates:!1,[ps]:s=>Array.isArray(s)&&s.every(Cl)},{uuids:!1,[ps]:s=>Array.isArray(s)&&s.every(ur)},{startTime:!1,endTime:!1,[ps]:f6},{idPrefix:!1,namePrefix:!1,[ps]:ur},{count:!0,[ps]:Er}]);if(e.error)return e;let{startDate:i,endDate:n}=t.tournamentRecord??{},r=t.dates||i&&n&&oT(i,n)||[],a=Mt(1,t.count+1).map(s=>{var o,l;return Zt({courtId:((o=t.uuids)==null?void 0:o.pop())??(t.idPrefix&&`${t.idPrefix}-${s}`)??bn(),courtName:((l=t.courtNames)==null?void 0:l.pop())??(t.namePrefix&&`${t.namePrefix} ${s}`),dateAvailability:r.map(c=>({startTime:t.startTime??"08:00",endTime:t.endTime??"20:00",date:c}))})});return{...pe,courts:a}}var ySe={};Fi(ySe,{default:()=>v7e,garman:()=>wSe});function cM({court:t,date:e}){let i=e&&t.dateAvailability.find(r=>Gh(r.date,e)),n=t.dateAvailability.find(r=>!r.date);return i||n}function a1(t){let e=ei(t,[{courtDate:!0,_ofType:tl}]);if(e.error)return e;let{includeBookingTypes:i=[],courtDate:n}=t,r=[],a=Xr(n.startTime);(n.bookings||[]).filter(o=>!o.bookingType||!i.includes(o.bookingType)).sort((o,l)=>F_(o.startTime).localeCompare(F_(l.startTime))).forEach(o=>{let l={startTime:sr(a.toISOString()),endTime:o.startTime};Xr(o.startTime)>a&&r.push(l),Xr(o.endTime)>a&&(a=Xr(o.endTime))});let s={startTime:sr(a.toISOString()),endTime:n.endTime};return Xr(n.endTime)>a&&r.push(s),{timeSlots:r}}function m7e({averageMatchUpMinutes:t,includeBookingTypes:e,periodStartTime:i,periodEndTime:n}){let r=s=>{var o;let{timeSlots:l}=a1({includeBookingTypes:e,courtDate:s});return!!((o=l==null?void 0:l.filter(a))!=null&&o.length)};function a(s){let o=Xr(s.startTime),l=Xr(s.endTime);return o>i||l<n?!1:cR(i,l)>=t}return{enoughTime:r}}function bSe(t){let e=ei(t,[{periodStart:!0,date:!0},{courts:!0,_ofType:Ms}]);if(e.error)return e;let{averageMatchUpMinutes:i,includeBookingTypes:n,periodStart:r,date:a}=t,s=t.courts,o=Xr(r),l=g6(o,i),{enoughTime:c}=m7e({averageMatchUpMinutes:i,includeBookingTypes:n,periodStartTime:o,periodEndTime:l});return{availableToScheduleCount:((s==null?void 0:s.filter(u=>{if(!Array.isArray(u.dateAvailability))return!1;let d=cM({date:a,court:u});return!!(d&&c(d))}))||[]).length,...pe}}function o2(t){var e;let{remainingScheduleTimes:i=[],clearScheduleDates:n,periodLength:r=30,scheduleDate:a,courts:s=[]}=t,{bookings:o=[]}=t;if(!Array.isArray(s)||!s.length)return{error:Ae,courts:s};if(!Array.isArray(o))return{error:k_};if(!Cl(a))return{error:Va};n&&(Array.isArray(n)?n.includes(a)&&(o=[]):o=[]);let{courtBookings:l,unassignedBookings:c}=o.reduce((h,f)=>{let{courtId:m}=f;return m?h.courtBookings[m]?h.courtBookings[m].push(f):h.courtBookings[m]=[f]:h.unassignedBookings.push(f),h},{courtBookings:{},unassignedBookings:[]}),u=s.map((h,f)=>{let{courtId:m,courtName:g}=h,v=l[m]||[],y=cM({date:a,court:h})||{},{bookings:b=[],startTime:I,endTime:T,date:w}=y,S=[i[f]&&{startTime:I,endTime:i[f]},...$t(b,!1,!0),...v].filter(Boolean);return{courtId:m,courtName:g,dateAvailability:{bookings:S,startTime:I,endTime:T,date:w}}});c.sort((h,f)=>sn(h.startTime)-sn(f.startTime));let d=()=>u.map(h=>{let f=h.dateAvailability,{timeSlots:m=[]}=a1({courtDate:f});return{courtName:h.courtName,courtId:h.courtId,timeSlots:m}}).flat(),p=[];for(let h of c){let{startTime:f,endTime:m,averageMinutes:g,recoveryMinutes:v,matchUpId:y}=h,b=sn(f),I=sn(m),T=d().reduce((w,{courtId:S,courtName:U,timeSlots:P})=>{let E;return P.find(({startTime:R,endTime:C})=>{E=sn(R)-b;let M=b>=sn(R);return I<=sn(C)&&w.startDifference!==0&&((E===0||E+r>=0)&&(w.startDifference===void 0||E<w.startDifference)||M)})?{courtName:U,courtId:S,startDifference:E}:w},{});if(T.courtId){let w={averageMinutes:g,recoveryMinutes:v,matchUpId:y,startTime:f,endTime:m};p.push(w),(e=u.find(({courtId:S})=>S===T.courtId))==null||e.dateAvailability.bookings.push(w)}else console.log({unassignedBooking:h})}return{virtualCourts:u.map(({courtId:h,courtName:f,dateAvailability:m})=>({dateAvailability:[m],courtName:f,courtId:h})),assignedBookings:p}}function l2({averageMatchUpMinutes:t,periodLength:e=30,recoveryMinutes:i}){let n=(t||90)+(i||0);return e>n?n:e||30}function ISe(t){let{startTime:e="8:00",endTime:i="20:30",count:n=10,date:r}=t??{};return Mt(0,n).map(()=>({dateAvailability:[{date:r,startTime:e,endTime:i}]}))}function DT({scheduleDate:t,startTime:e,endTime:i,courts:n}){let r=e&&"startTime"||i&&"endTime"||void 0;return n.reduce((a,s)=>{let o=cM({date:t,court:s}),l=r&&((o==null?void 0:o[r])||s[r]);return l&&(!a||e&&sn(l)<sn(a)||i&&sn(l)>sn(a))?l:a},void 0)}function g7e({averageMinutes:t,startTime:e,endTime:i,courts:n,date:r}){e=e||DT({courts:n,scheduleDate:r,startTime:!0}),i=i||DT({courts:n,scheduleDate:r,endTime:!0});let a;if(e&&i){let s=Xr(e),o=Xr(i);for(let l of n||[]){if(!Array.isArray(l.dateAvailability))continue;let c=cM({court:l,date:r}),{timeSlots:u}=a1({courtDate:c});u==null||u.forEach(d=>{let p=Xr(d.startTime),h=Xr(d.endTime);if(p>o||p<s||h<s)return!1;if(cR(p,h)>=t){let f=sr(p.toISOString());(!a||f<a)&&(a=f)}})}}return{firstTimeSlotStartTime:a}}function h9(t){let e=ei(t,[{courts:!0,_ofType:Ms}]);if(e.error)return e;let{date:i=h6(),startTime:n="08:00",endTime:r="19:00",periodLength:a,courts:s}=t,{calculateStartTimeFromCourts:o=!0,remainingScheduleTimes:l,averageMatchUpMinutes:c,clearScheduleDates:u,courtsCount:d,bookings:p}=t;a=a||l2({averageMatchUpMinutes:c}),i=Mi(i),n=sr(n),r=sr(r);let h=0,f=0,m=0,g=0,v=0;!s&&d&&(s=ISe({startTime:n,endTime:r,count:d,date:i}));let{virtualCourts:y}=o2({remainingScheduleTimes:l,clearScheduleDates:u,scheduleDate:i,periodLength:a,bookings:p,courts:s}),{firstTimeSlotStartTime:b}=g7e({averageMinutes:c,courts:y,startTime:n,endTime:r,date:i});o&&b&&(n=b??n);let I=sn(n),T=sn(r)-I,w=Math.floor(T/a),S=Mt(0,w+1).map(U=>{let P=I+U*a,E=Mze(P),R=bSe({courts:y??[],averageMatchUpMinutes:c,periodStart:E,date:i});if(R.error)return{error:R.error};let{availableToScheduleCount:C=0}=R,M=C>f?C-f:0;v+=U?C:0;let _=U?v/U:C,A=a*_/c,N=U?A*(U-1)+_:_,k=C?f&&N-h||M:0;h=N,f=C,m+=k;let O=di(m)-g;return g+=O,{periodStart:E,add:O,availableToScheduleCount:C,newCourts:M,totalMatchUps:g}});return{scheduleTimes:S.reduce((U,P)=>{let E=Mt(0,P.add).map(()=>({scheduleTime:P.periodStart}));return U.concat(...E)},[]).flat(),timingProfile:S,totalMatchUps:g}}var wSe={getCourtsAvailableAtPeriodStart:bSe,generateTimeSlots:a1,getScheduleTimes:h9,courtGenerator:ISe},v7e=wSe,SSe={};Fi(SSe,{isValid:()=>Ll,isValidMatchUpFormat:()=>Ll,parse:()=>Do,stringify:()=>$L});var TSe={};Fi(TSe,{allCompetitionMatchUps:()=>Fd,allDrawMatchUps:()=>po,allEventMatchUps:()=>nf,allTournamentMatchUps:()=>Za,analyzeMatchUp:()=>nP,applyLineUps:()=>qSe,assignMatchUpSideParticipant:()=>DSe,assignTieMatchUpParticipantId:()=>ok,bulkMatchUpStatusUpdate:()=>jSe,calculateWinCriteria:()=>jw,checkInParticipant:()=>m9,checkMatchUpIsComplete:()=>Wv,checkOutParticipant:()=>f9,competitionScheduleMatchUps:()=>sM,disableTieAutoCalc:()=>$Se,drawMatchUps:()=>X7,enableTieAutoCalc:()=>OSe,eventMatchUps:()=>e2,filterMatchUps:()=>Cf,findMatchUp:()=>x7,getAllDrawMatchUps:()=>pa,getAllStructureMatchUps:()=>Sn,getCheckedInParticipantIds:()=>Nw,getCompetitionMatchUps:()=>iP,getEventMatchUpFormatTiming:()=>j7,getHomeParticipantId:()=>q7,getMatchUpCompetitiveProfile:()=>MR,getMatchUpContextIds:()=>W7,getMatchUpDailyLimits:()=>i2,getMatchUpDailyLimitsUpdate:()=>G7,getMatchUpDependencies:()=>od,getMatchUpFormat:()=>Y7,getMatchUpFormatTiming:()=>NR,getMatchUpFormatTimingUpdate:()=>V7,getMatchUpScheduleDetails:()=>fF,getMatchUpType:()=>mF,getMatchUpsStats:()=>K7,getModifiedMatchUpFormatTiming:()=>QF,getParticipantResults:()=>YR,getPredictiveAccuracy:()=>z7,getRoundMatchUps:()=>yo,getRounds:()=>Z7,isValidMatchUpFormat:()=>Ll,matchUpActions:()=>NF,mutate:()=>USe,participantScheduledMatchUps:()=>H7,query:()=>_0e,removeDelegatedOutcome:()=>LSe,removeMatchUpSideParticipant:()=>y9,removeTieMatchUpParticipantId:()=>PSe,replaceTieMatchUpParticipantId:()=>v9,resetAdHocMatchUps:()=>HSe,resetMatchUpLineUps:()=>D9,resetScorecard:()=>P9,resetTieFormat:()=>E9,setDelegatedOutcome:()=>GSe,setMatchUpFormat:()=>BSe,setMatchUpStatus:()=>dM,setOrderOfFinish:()=>zSe,substituteParticipant:()=>FSe,tallyParticipantResults:()=>QU,toggleParticipantCheckInState:()=>c2,tournamentMatchUps:()=>t2,updateTieMatchUpScore:()=>Nm,validMatchUp:()=>cF,validMatchUps:()=>lu});var USe={};Fi(USe,{applyLineUps:()=>qSe,assignMatchUpSideParticipant:()=>DSe,assignTieMatchUpParticipantId:()=>ok,bulkMatchUpStatusUpdate:()=>jSe,checkInParticipant:()=>m9,checkOutParticipant:()=>f9,disableTieAutoCalc:()=>$Se,enableTieAutoCalc:()=>OSe,findMatchUp:()=>x7,removeDelegatedOutcome:()=>LSe,removeMatchUpSideParticipant:()=>y9,removeTieMatchUpParticipantId:()=>PSe,replaceTieMatchUpParticipantId:()=>v9,resetAdHocMatchUps:()=>HSe,resetMatchUpLineUps:()=>D9,resetScorecard:()=>P9,resetTieFormat:()=>E9,setDelegatedOutcome:()=>GSe,setMatchUpFormat:()=>BSe,setMatchUpStatus:()=>dM,setOrderOfFinish:()=>zSe,substituteParticipant:()=>FSe,toggleParticipantCheckInState:()=>c2,updateTieMatchUpScore:()=>Nm});function DSe({tournamentRecord:t,drawDefinition:e,participantId:i,sideNumber:n,matchUpId:r,event:a}){var s,o;if(i&&typeof i!="string")return{error:xd};if(!e)return{error:Ht};if(!r)return{error:Zs};let l=n===void 0;if(l&&(n=1),![1,2].includes(n))return fe({result:{error:Ae,context:{sideNumber:n}}});let{matchUp:c,structure:u}=or({drawDefinition:e,matchUpId:r,event:a});if(!c)return{error:xs};if(!(!(u!=null&&u.structures)&&!(e.drawType&&e.drawType!==lc)&&!((s=u==null?void 0:u.matchUps)!=null&&s.find(({roundPosition:d})=>!!d))))return{error:L5};if(!i&&((o=c==null?void 0:c.score)!=null&&o.scoreStringSide1||va.includes(c==null?void 0:c.matchUpstatus)||c!=null&&c.matchUpStatus&&[Kr,oa].includes(c.matchUpStatus)))return{error:EL,info:"matchUp has completed status or score"};if(c){if(c.sides=[1,2].map(d=>{var p;let h=((p=c.sides)==null?void 0:p.find(f=>f.sideNumber===d))??{sideNumber:d};return n===d?{...h,participantId:i}:h}),l)for(let d of c.sides)d.sideNumber&&(d.sideNumber=3-d.sideNumber);Qi({tournamentId:t==null?void 0:t.tournamentId,context:"assignSideParticipant",drawDefinition:e,matchUp:c})}return{...pe,sidesSwapped:l}}function Vl({removePriorValues:t,tournamentRecord:e,duplicateValues:i,drawDefinition:n,disableNotice:r,matchUpId:a,timeItem:s,event:o}){let{matchUp:l}=or({drawDefinition:n,event:o,matchUpId:a});if(!l)return{error:xs};let c=Zp({removePriorValues:t,element:l,duplicateValues:i,timeItem:s});return r||Qi({tournamentId:e==null?void 0:e.tournamentId,eventId:o==null?void 0:o.eventId,context:"addTimeItem",drawDefinition:n,matchUp:l}),c}function f9(t){var e;let i=[{[Ia]:!0},{[Po]:!0},{[qh]:!0},{[Wp]:!0}],n=ei(t,i);if(n.error)return n;let r=t1(t,[{[BU]:ef,attr:{[WL]:!0}}]);if(r.error)return r;let{tournamentRecord:a,drawDefinition:s,participantId:o,matchUpId:l}=t,c=(e=r==null?void 0:r.matchUp)==null?void 0:e.matchUp,{matchUpStatus:u,score:d}=c??{};if(u&&$6.includes(u)||u&&va.includes(u)||ya({score:d}))return{error:nge};let p=Nw({matchUp:c});if(p!=null&&p.error)return p;let{checkedInParticipantIds:h,allRelevantParticipantIds:f}=p??{};if(!(f!=null&&f.includes(o)))return{error:xd};if(!(h!=null&&h.includes(o)))return{error:Nge};let m=obe({matchUp:c});if(m!=null&&m.error)return m;let{sideParticipantIds:g,nestedIndividualParticipantIds:v}=m??{},y=g==null?void 0:g.indexOf(o);return y!==void 0&&[0,1].includes(y)&&((v==null?void 0:v[y])??[]).forEach(b=>{Vl({drawDefinition:s,matchUpId:l,timeItem:{itemType:q_,itemValue:b}})}),Vl({tournamentRecord:a,drawDefinition:s,matchUpId:l,timeItem:{itemValue:o,itemType:q_}}),{...pe,checkedOut:!0}}function m9(t){var e;let i=[{[Ia]:!0},{[Po]:!0},{[qh]:!0},{[Wp]:!0}],n=ei(t,i);if(n[$u])return n;let r=t1(t,[{[BU]:ef,attr:{[WL]:!0}}]);if(r[$u])return r;let{tournamentRecord:a,drawDefinition:s,participantId:o,matchUpId:l}=t,c=Nw({matchUp:(e=r==null?void 0:r.matchUp)==null?void 0:e.matchUp});if(c!=null&&c.error)return c;let{checkedInParticipantIds:u,allRelevantParticipantIds:d}=c??{};if(!(d!=null&&d.includes(o)))return{[$u]:xd};let p={...pe,checkedIn:!0};return u!=null&&u.includes(o)||Vl({tournamentRecord:a,drawDefinition:s,matchUpId:l,timeItem:{itemValue:o,itemType:z_}}),p}function c2(t){var e,i;let n=ei(t,[{[qh]:!0,[Po]:!0,[Wp]:!0}]);if(n.error)return n;let r=t.tournamentId??t.activeTournamentId,a=t.tournamentRecord??(r&&((e=t.tournamentRecords)==null?void 0:e[r]));if(!a)return{error:dt};let s=(i=t1(t,[{[BU]:ef,attr:{[WL]:!0},[$u]:xs}]).matchUp)==null?void 0:i.matchUp;if(!s)return{error:xs};let{checkedInParticipantIds:o=[]}=Nw({matchUp:s}),{participantId:l,matchUpId:c,drawDefinition:u}=t;return l&&o.includes(l)?f9({tournamentRecord:a,drawDefinition:u,participantId:l,matchUpId:c,matchUp:s}):m9({tournamentRecord:a,drawDefinition:u,participantId:l,matchUpId:c,matchUp:s})}function g9({tournamentRecord:t,drawDefinition:e,tieMatchUpId:i,event:n}){var r,a;if(!t)return{error:dt};if(!e)return{error:jd};if(!n)return{error:Wc};let s=Us({drawDefinition:e}),{matchUp:o}=or({matchUpId:i,drawDefinition:e,matchUpsMap:s});if(!o)return{error:xs};let{matchUp:l,structure:c}=or({tournamentParticipants:t.participants,matchUpId:i,inContext:!0,drawDefinition:e,matchUpsMap:s,event:n});if(!l)return{error:xs};let{collectionPosition:u,drawPositions:d,collectionId:p,matchUpTieId:h,matchUpType:f}=l;if(f&&!IL([On,Nn],f))return{error:cl};let{positionAssignments:m}=Gn({structure:c}),g=m==null?void 0:m.filter(U=>d==null?void 0:d.includes(U.drawPosition)),{matchUp:v}=or({matchUpId:h,drawDefinition:e,matchUpsMap:s}),y=((r=v==null?void 0:v.sides)==null?void 0:r.map(Gi))??[],b=(g==null?void 0:g.map(Gi))??[],I=[...y,...b],{participants:T}=br({tournamentRecord:t,participantFilters:{participantTypes:[Pn],participantIds:I}}),{matchUp:w}=or({matchUpId:h,inContext:!0,drawDefinition:e,matchUpsMap:s}),S=(a=Ws({matchUp:v,drawDefinition:e,structure:c,event:n}))==null?void 0:a.tieFormat;return{inContextDualMatchUp:w,inContextTieMatchUp:l,relevantAssignments:g,collectionPosition:u,teamParticipants:T,collectionId:p,matchUpType:f,dualMatchUp:v,tieMatchUp:o,tieFormat:S,structure:c,...pe}}function v9(t){var e,i,n,r,a,s,o,l,c,u,d,p,h,f,m,g;let v=g9(t);if(v.error)return v;let y="replaceTieMatchUpParticipantid",{existingParticipantId:b,tournamentRecord:I,newParticipantId:T,drawDefinition:w,substitution:S,event:U}=t;if(!b||!T)return fe({result:{error:da},stack:y});if(b===T)return{...pe};let{inContextDualMatchUp:P,inContextTieMatchUp:E,collectionPosition:R,collectionId:C,dualMatchUp:M,tieMatchUp:_,tieFormat:A}=v,N=E==null?void 0:E.matchUpType,k=(e=E==null?void 0:E.sides)==null?void 0:e.find(te=>{var le,ne,me;return((le=te.participant)==null?void 0:le.participantId)===b||((me=(ne=te.participant)==null?void 0:ne.individualParticipantIds)==null?void 0:me.includes(b))});if(!k)return{error:Or};let O=((i=br({tournamentRecord:I,participantFilters:{participantIds:[b,T]}}))==null?void 0:i.participants)??[];if(O.length!==2)return fe({result:{error:da},stack:y});if(O[0].participantType!==O[1].participantType)return fe({result:{error:Od},stack:y});let{appliedPolicies:$}=fn({tournamentRecord:I,drawDefinition:w,event:U}),F=((n=t.policyDefinitions)==null?void 0:n[Ga])??($==null?void 0:$[Ga])??KU[Ga],V=O.find(({participantId:te})=>te===T);if((t.enforceGender??((r=F==null?void 0:F.participants)==null?void 0:r.enforceGender))!==!1&&[Rn,Kn].includes(E==null?void 0:E.gender)&&(E==null?void 0:E.gender)!==((a=V==null?void 0:V.person)==null?void 0:a.sex))return{error:yw,info:"Gender mismatch"};let j=(s=F==null?void 0:F.processCodes)==null?void 0:s.substitution;ZR({tournamentId:I.tournamentId,eventId:U.eventId,inContextDualMatchUp:P,drawDefinition:w,dualMatchUp:M});let B=(o=M==null?void 0:M.sides)==null?void 0:o.find(({sideNumber:te})=>te===k.sideNumber);if(!B)return fe({result:{sideNumber:k.sideNumber,existingParticipantId:b,error:Ya},stack:y});if((c=(l=E==null?void 0:E.sides)==null?void 0:l.flatMap(te=>{var le,ne;return((le=te.participant)==null?void 0:le.individualParticipantIds)||((ne=te.participant)==null?void 0:ne.participantId)||[]}))!=null&&c.includes(T))return fe({result:{error:CL},stack:y});let z=(d=(u=P==null?void 0:P.sides)==null?void 0:u.find(({sideNumber:te})=>te===k.sideNumber))==null?void 0:d.participantId,W=B.lineUp,Z=W==null?void 0:W.find(({participantId:te})=>T===te),K=W==null?void 0:W.reduce((te,le)=>le.substitutionOrder>te?le.substitutionOrder:te,0),Q=(W==null?void 0:W.map(te=>{var le;let ne=$t(te,!1,!0);if(![b,T].includes(ne.participantId))return ne;if(!S&&[b,T].includes(ne.participantId)&&(ne.collectionAssignments=(le=ne.collectionAssignments)==null?void 0:le.filter(me=>!(me.collectionPosition===R&&me.collectionId===C))),S&&b===ne.participantId&&(ne.collectionAssignments=ne.collectionAssignments.map(me=>me.collectionPosition===R&&me.collectionId===C&&me.substitutionOrder===void 0?{...me,substitutionOrder:K}:me)),ne.participantId===T){ne.collectionAssignments||(ne.collectionAssignments=[]);let me={collectionId:C,collectionPosition:R};S&&(me.previousParticipantId=b,me.substitutionOrder=(K??0)+1),ne.collectionAssignments.push(me)}return ne}))??[];if(!Z){let te={collectionId:C,collectionPosition:R};S&&(te.substitutionOrder=(K??0)+1,te.previousParticipantId=b);let le={collectionAssignments:[te],participantId:T};Q.push(le)}let J=N===Nn,{assignedParticipantIds:se}=W_({lineUp:W,collectionPosition:R,collectionId:C}),{assignedParticipantIds:ie}=W_({lineUp:Q,collectionPosition:R,collectionId:C});if(B.lineUp=Q,z&&A){let te=Fw({participantId:z,lineUp:Q,drawDefinition:w,tieFormat:A});if(te.error)return fe({result:te,stack:y})}else console.log("team participantId not found");let ce,oe;if(J){let{tournamentRecord:te}=t,le=Qu({participantIds:ie,tournamentRecord:te});if(!le.participant){let me=$p({returnParticipant:!0,pairOverride:!0,tournamentRecord:te,participant:{participantRole:vs,individualParticipantIds:ie,participantType:Ai}});if(me.error)return fe({result:me,stack:y});ce=(p=me.participant)==null?void 0:p.participantId}le=Qu({participantIds:se,tournamentRecord:te});let ne=(h=le.participant)==null?void 0:h.participantId;ne&&Ow({participantIds:[ne],tournamentRecord:te}).success&&(oe=ne)}if(S||((f=k.substitutions)==null?void 0:f.length)===1){if(S)j&&_&&(_.processCodes=Pi([...(_==null?void 0:_.processCodes)??[],...j]));else for(let te of j||[]){let le=(m=_==null?void 0:_.processCodes)==null?void 0:m.lastIndexOf(te);le!==void 0&&((g=_==null?void 0:_.processCodes)==null||g.splice(le,1))}_&&Qi({tournamentId:I==null?void 0:I.tournamentId,matchUp:_,context:y,drawDefinition:w})}return M&&Qi({tournamentId:I==null?void 0:I.tournamentId,matchUp:M,context:y,drawDefinition:w}),{...pe,modifiedLineUp:Q,participantRemoved:oe,participantAdded:ce}}function ESe({collectionPosition:t,teamParticipantId:e,dualMatchUpSide:i,drawDefinition:n,participantIds:r,collectionId:a}){var s;if(!a||!t||!Array.isArray(r))return{modifiedLineUp:(i==null?void 0:i.lineUp)||[],error:Ae};let o=(i==null?void 0:i.lineUp)||((s=Iy({participantId:e,drawDefinition:n}))==null?void 0:s.lineUp),l=[],c=[];return{modifiedLineUp:(o==null?void 0:o.map(u=>{var d;if(!r.includes(u.participantId))return u;let p=(d=u.collectionAssignments)==null?void 0:d.filter(h=>{let f=h.collectionId===a&&h.collectionPosition===t;return f&&(h.previousParticipantId&&l.push(h.previousParticipantId),c.push({participantId:u.participantId,...h})),!f});return{participantId:u.participantId,collectionAssignments:p}}).filter(Boolean))||[],assignmentsRemoved:c,previousParticipantIds:l}}function y7e({individualParticipantIds:t,groupingParticipantId:e,tournamentRecord:i}){var n,r;let a=(i.events||[]).filter(o=>{var l;return(o==null?void 0:o.eventType)===aa&&((l=o==null?void 0:o.entries)==null?void 0:l.some(c=>c.participantId===e))}),s=o=>!t.includes(o.participantId);for(let o of a){o.entries=(o.entries||[]).filter(s);let{flightProfile:l}=kr({event:o});(n=l==null?void 0:l.flights)==null||n.forEach(c=>{c.drawEntries=(c.drawEntries||[]).filter(s)}),(r=o==null?void 0:o.drawDefinitions)==null||r.forEach(c=>{c.entries=(c.entries||[]).filter(s)})}return{...pe}}function u2({individualParticipantIds:t,groupingParticipantId:e,removeFromOtherTeams:i,tournamentRecord:n}){let r="addIndividualParticipantIds";if(!n)return fe({result:{error:dt},stack:r});if(!e||!t)return fe({result:{error:si},stack:r});let a=n.participants??[],s=a.find(d=>d.participantId===e);if(!s)return fe({result:{error:Or},stack:r});if(s!=null&&s.participantType&&![Pn,gc].includes(s.participantType))return fe({context:{participantType:s.participantType},result:{error:Od},stack:r});let o=t.filter(d=>{var p;return((p=a.find(h=>h.participantId===d))==null?void 0:p.participantType)!==Hi});if(o.length)return fe({result:{error:Pl,invalidParticipantIds:o},stack:r});s.individualParticipantIds||(s.individualParticipantIds=[]);let l=s.individualParticipantIds,c=t.filter(d=>!l.includes(d));c.length&&(i&&yF({individualParticipantIds:c,tournamentRecord:n}),s.individualParticipantIds=s.individualParticipantIds.concat(...c));let{topics:u}=ru();if(u.includes(Ss)){let d=a.find(({participantId:p})=>p===e);Ti({topic:Ss,payload:{participants:[d]}})}return y7e({individualParticipantIds:t,groupingParticipantId:e,tournamentRecord:n}),{groupingParticipant:$t(s,!1,!0),added:c.length,...pe}}function d2(t){let{updateParticipantName:e=!0,groupingParticipantId:i,removeFromOtherTeams:n,tournamentRecord:r,pairOverride:a,participant:s}=t;if(!r)return{error:dt};if(!s)return{error:bw};if(!s.participantId)return $p({tournamentRecord:r,participant:s});let{participant:o}=ev({participantId:s.participantId,tournamentRecord:r});if(!o)return $p({tournamentRecord:r,participant:s});let{participantRoleResponsibilties:l,individualParticipantIds:c,participantOtherName:u,participantName:d,participantRole:p,participantType:h,onlineResources:f,contacts:m,person:g}=s;if(h&&o.participantType!==h)return{error:Dge};let v={};if(m&&(v.contacts=m),f&&(v.onlineResources=f),u&&ur(u)&&(v.participantOtherName=u),d&&ur(d)&&(v.participantName=d),Array.isArray(c)){let{participants:y}=br({participantFilters:{participantTypes:[Hi]},tournamentRecord:r}),b=y==null?void 0:y.map(Gi);if(b){let I=c.filter(T=>ur(T)&&b.includes(T));([gc,Xn].includes(h||o.participantType)||h===Ai&&(I.length===2||a))&&(v.individualParticipantIds=I),o.participantType===wD.PAIR&&e&&(v.participantName=b7e({individualParticipants:y,newValues:v}))}}return Object.keys(S8).includes(p)&&(v.participantRole=p),Object.keys(wD).includes(h)&&(v.participantType=h),Array.isArray(l)&&(v.participantRoleResponsibilties=l),o.participantType===wD.INDIVIDUAL&&g&&I7e({updateParticipantName:e,existingParticipant:o,newValues:v,person:g}),Object.assign(o,Zt(v)),i&&u2({individualParticipantIds:[o.participantId],groupingParticipantId:i,removeFromOtherTeams:n,tournamentRecord:r}),Ti({topic:Ss,payload:{tournamentId:r.tournamentId,participants:[o]}}),{participant:$t(o),...pe}}function b7e({individualParticipants:t,newValues:e}){let i=e.individualParticipantIds,n=t.filter(({participantId:r})=>i.includes(r)).map(({person:r})=>r==null?void 0:r.standardFamilyName).filter(Boolean).sort().join("/");return i.length===1&&(n+="/Unknown"),n}function I7e({updateParticipantName:t,existingParticipant:e,newValues:i,person:n}){let r={},{standardFamilyName:a,standardGivenName:s,nationalityCode:o,personId:l,birthdate:c,tennisId:u,sex:d}=n;d&&Object.keys(d6).includes(d)&&(r.sex=d);let p;if(ur(l)&&(r.personId=l),o&&ur(o)&&(w7e(o)||o==="")&&(r.nationalityCode=o),a&&typeof ur(a)&&a.length>1&&(r.standardFamilyName=a,p=!0),s&&typeof ur(s)&&s.length>1&&(r.standardGivenName=s,p=!0),p&&t){let h=`${r.standardGivenName} ${r.standardFamilyName}`;i.participantName=h}c&&Cl(c)&&(r.birthdate=c),u&&ur(u)&&(r.tennisId=u),Object.assign(e.person,r)}function w7e(t){return ag.flatMap(({iso:e,ioc:i})=>[e,i]).filter(Boolean).includes(t)}function ok(t){var e,i,n,r,a,s,o,l,c,u,d,p,h,f,m,g,v,y,b,I;let T=g9(t);if(T.error)return T;let w="assignTieMatchUpParticipantId",S=t.teamParticipantId,{tournamentRecord:U,drawDefinition:P,participantId:E,event:R}=t;if(!E)return fe({result:{error:da},stack:w});if(t.sideNumber&&![1,2].includes(t.sideNumber))return fe({result:{error:W5},stack:w});let{inContextDualMatchUp:C,inContextTieMatchUp:M,relevantAssignments:_,collectionPosition:A,teamParticipants:N,collectionId:k,matchUpType:O,dualMatchUp:$,tieFormat:F}=T;if((i=(e=M==null?void 0:M.sides)==null?void 0:e.flatMap(we=>{var ze,Qe;return((ze=we.participant)==null?void 0:ze.individualParticipantIds)||((Qe=we.participant)==null?void 0:Qe.participantId)||[]}))!=null&&i.includes(E))return fe({result:{...pe},stack:w});S=S??(t.sideNumber?(r=(n=C==null?void 0:C.sides)==null?void 0:n.find(we=>we.sideNumber===t.sideNumber))==null?void 0:r.participantId:void 0);let V=(s=(a=br({participantFilters:{participantIds:[E]},tournamentRecord:U}))==null?void 0:a.participants)==null?void 0:s[0];if(!V)return fe({result:{error:Or},stack:w});let{appliedPolicies:j}=fn({tournamentRecord:U,drawDefinition:P,event:R}),B=((o=t.policyDefinitions)==null?void 0:o[Ga])??(j==null?void 0:j[Ga])??KU[Ga];if((t.enforceGender??((l=B==null?void 0:B.participants)==null?void 0:l.enforceGender))!==!1&&[Rn,Kn].includes(M==null?void 0:M.gender)&&(M==null?void 0:M.gender)!==((c=V.person)==null?void 0:c.sex))return{error:yw,info:"Gender mismatch"};let{individualParticipantIds:z,participantType:W}=V;if(Br(On)(O)&&W!==Hi)return{error:Od};let Z=W===Hi?[E]:z,K=S&&(N==null?void 0:N.find(({participantId:we})=>we===S))||(N==null?void 0:N.find(({individualParticipantIds:we})=>vo(Z,we)));if(!K)return{error:i6};if(S||(S=K.participantId),!S)return{error:Or};let Q=(u=_==null?void 0:_.find(we=>we.participantId===(K==null?void 0:K.participantId)))==null?void 0:u.drawPosition,J=(p=(d=$==null?void 0:$.sides)==null?void 0:d.find(we=>we.participantId===S))==null?void 0:p.sideNumber,se=(f=(h=M==null?void 0:M.sides)==null?void 0:h.find(we=>Q&&we.drawPosition===Q))==null?void 0:f.sideNumber,ie=J??se??t.sideNumber;if(!F)return{error:kU};if(!((m=F.collectionDefinitions)!=null&&m.find(we=>we.collectionId===k)))return{error:gge};ZR({tournamentId:U.tournamentId,eventId:R.eventId,inContextDualMatchUp:C,drawDefinition:P,dualMatchUp:$});let ce=(g=$==null?void 0:$.sides)==null?void 0:g.find(we=>we.sideNumber===ie),oe=(v=M==null?void 0:M.sides)==null?void 0:v.find(we=>we.sideNumber===ie),te=(I=(b=(ce==null?void 0:ce.lineUp)??((y=Iy({participantId:S,drawDefinition:P}))==null?void 0:y.lineUp))==null?void 0:b.filter(we=>{var ze;return(ze=we.collectionAssignments)==null?void 0:ze.find(Qe=>Qe.collectionPosition===A&&Qe.collectionId===k&&!Qe.previousParticipantId)}))==null?void 0:I.map(we=>we==null?void 0:we.participantId),le=(te==null?void 0:te.length)>1&&te||(W===Ai?V.individualParticipantIds:[E]),ne=ESe({collectionPosition:A,teamParticipantId:S,dualMatchUpSide:ce,drawDefinition:P,participantIds:le,collectionId:k});if(ne.error)return fe({result:ne,stack:w});let{modifiedLineUp:me}=ne,be;if(O===Nn){if(W!==Ai){let we=eB({collectionPosition:A,teamParticipantId:S,drawDefinition:P,modifiedLineUp:me,participantId:E,collectionId:k,tieFormat:F});if(we!=null&&we.error)return fe({result:we,stack:w});if(we=Se({side:oe}),we.error)return we;be=we.deletedParticipantId,ce&&(ce.lineUp=me),$&&Qi({tournamentId:U==null?void 0:U.tournamentId,matchUp:$,context:w,drawDefinition:P})}else if(W===Ai)for(let we of le)eB({collectionPosition:A,teamParticipantId:S,drawDefinition:P,modifiedLineUp:me,participantId:we,collectionId:k,tieFormat:F})}else{let we=eB({collectionPosition:A,teamParticipantId:S,drawDefinition:P,modifiedLineUp:me,participantId:E,collectionId:k,tieFormat:F});if(we!=null&&we.error)return we}if(ce&&(ce.lineUp=me),$&&Qi({tournamentId:U==null?void 0:U.tournamentId,matchUp:$,context:w,drawDefinition:P}),be){let{error:we}=Ow({participantIds:[be],tournamentRecord:U});we&&console.log("cleanup")}return{...pe,modifiedLineUp:me};function Se({side:we}){let ze;if(we.participant){let Qe=we.participant.individualParticipantIds||[];if(Qe.filter(Boolean).length===1){let{participant:ke}=Qu({participantIds:Qe,tournamentRecord:U});Qe.push(E);let{participant:yt}=Qu({participantIds:Qe,tournamentRecord:U});if(!yt&&ke){ke.individualParticipantIds=Qe;let lt=d2({pairOverride:!0,tournamentRecord:U,participant:ke});if(lt.error)return lt}else ze=ke==null?void 0:ke.participantId}}else{let Qe=$p({participant:{individualParticipantIds:[E],participantRole:vs,participantType:Ai},pairOverride:!0,tournamentRecord:U});if(Qe.error)return Qe}return{...pe,deletedParticipantId:ze}}}function eB({collectionPosition:t,teamParticipantId:e,drawDefinition:i,modifiedLineUp:n,participantId:r,collectionId:a,tieFormat:s}){var o,l;let c=(o=Iy({participantId:e,drawDefinition:i}))==null?void 0:o.lineUp,u=(l=n||c)==null?void 0:l.find(p=>(p==null?void 0:p.participantId)===r),d={collectionId:a,collectionPosition:t};if(u)u.collectionAssignments.push(d);else{let p={collectionAssignments:[d],participantId:r};n.push(p)}return Fw({participantId:e,lineUp:n,drawDefinition:i,tieFormat:s})}function PSe(t){var e,i,n,r,a,s,o,l,c,u,d,p,h,f,m,g,v,y,b,I,T,w,S;let{tournamentRecord:U,drawDefinition:P,participantId:E,event:R}=t,C="removeTieMatchUpParticiapantId";if(!E)return fe({result:{error:da},stack:C});let M=g9(t);if(M.error)return M;let{appliedPolicies:_}=fn({tournamentRecord:U,drawDefinition:P,event:R}),A=(n=(i=((e=t.policyDefinitions)==null?void 0:e[Ga])??(_==null?void 0:_[Ga])??KU[Ga])==null?void 0:i.processCodes)==null?void 0:n.substitution,{inContextDualMatchUp:N,inContextTieMatchUp:k,relevantAssignments:O,collectionPosition:$,teamParticipants:F,collectionId:V,matchUpType:j,dualMatchUp:B,tieMatchUp:z,tieFormat:W}=M;if(!B)return fe({result:{error:ll},stack:C});let Z=(r=k==null?void 0:k.sides)==null?void 0:r.find(te=>{var le,ne,me;return((le=te.participant)==null?void 0:le.participantId)===E||((me=(ne=te.participant)==null?void 0:ne.individualParticipantIds)==null?void 0:me.includes(E))});if(!Z)return fe({result:{error:Or},stack:C});let K=((a=t.policyDefinitions)==null?void 0:a[Kc])??(_==null?void 0:_[Kc]);if(!((s=Z.substitutions)!=null&&s.length)&&(ya({score:k==null?void 0:k.score})||k!=null&&k.winningSide)&&(K==null?void 0:K.requireParticipantsForScoring)!==!1)return fe({result:{error:Qge},stack:C});let Q=(l=(o=N==null?void 0:N.sides)==null?void 0:o.find(({sideNumber:te})=>te===Z.sideNumber))==null?void 0:l.participantId;if(!Q)return fe({result:{error:Or},stack:C});let J=(u=(c=br({participantFilters:{participantIds:[E]},tournamentRecord:U}))==null?void 0:c.participants)==null?void 0:u[0];if(!J)return fe({result:{error:Or},stack:C});if(j===On&&J.participantType===Ai)return fe({result:{error:yw},stack:C});let se=J.participantType===Hi?[E]:J.individualParticipantIds;ZR({tournamentId:U.tournamentId,eventId:R.eventId,inContextDualMatchUp:N,drawDefinition:P,dualMatchUp:B});let ie=(d=B.sides)==null?void 0:d.find(({sideNumber:te})=>te===Z.sideNumber);if(!ie&&(((p=B.sides)==null?void 0:p.filter(({lineUp:te})=>!te).length)||0)<2){let te=F==null?void 0:F.map(({participantId:le})=>{var ne;return{drawPosition:(ne=O==null?void 0:O.find(me=>me.participantId===le))==null?void 0:ne.drawPosition,teamParticipantId:le}});ie=(h=B.sides)==null?void 0:h.find(le=>{var ne;return((ne=te==null?void 0:te.find(({drawPosition:me})=>me===le.drawPosition))==null?void 0:ne.teamParticipantId)===Q})}if(!ie)return fe({result:{error:Or,context:{participantId:E}}});let{modifiedLineUp:ce,previousParticipantIds:oe}=ESe({collectionPosition:$,teamParticipantId:Q,dualMatchUpSide:ie,participantIds:se,drawDefinition:P,collectionId:V});if(ie.lineUp=ce,Q&&W&&Fw({participantId:Q,lineUp:ce,drawDefinition:P,tieFormat:W}),j===Nn&&J.participantType===Hi){let te=(f=k==null?void 0:k.sides)==null?void 0:f.find(me=>me.sideNumber===(ie==null?void 0:ie.sideNumber)),{participantId:le}=te??{},ne=le&&((g=(m=br({participantFilters:{participantIds:[le]},tournamentRecord:U,withDraws:!0}))==null?void 0:m.participants)==null?void 0:g[0]);if(ne){let me=((v=ne==null?void 0:ne.individualParticipantIds)==null?void 0:v.filter(be=>be!==E))??[];if(oe&&me.push(...oe),me.length>2)return fe({result:{error:Pl},stack:C});if((y=ne.draws)!=null&&y.length){if(me.length===1){let{participant:be}=Qu({participantIds:me,tournamentRecord:U});if(!be){let Se=$p({participant:{participantRole:vs,individualParticipantIds:me,participantType:Ai},pairOverride:!0,tournamentRecord:U});if(Se.error)return fe({result:Se,stack:C})}}}else if(me.length){ne.individualParticipantIds=me;let be=d2({participant:ne,pairOverride:!0,tournamentRecord:U});if(be.error)return fe({result:be,stack:C})}else{let be=Ow({participantIds:[le],tournamentRecord:U});be.error&&console.log("cleanup",{result:be})}}else return fe({result:{error:Or},stack:C})}if(((b=Z.substitutions)==null?void 0:b.length)===1&&!((w=(T=(I=k==null?void 0:k.sides)==null?void 0:I.find(te=>te.sideNumber!==Z.sideNumber))==null?void 0:T.substitutions)!=null&&w.length)&&(S=z==null?void 0:z.processCodes)!=null&&S.length){for(let te of A||[]){let le=z.processCodes.lastIndexOf(te);z.processCodes.splice(le,1)}Qi({tournamentId:U==null?void 0:U.tournamentId,matchUp:z,context:C,drawDefinition:P})}return Qi({tournamentId:U==null?void 0:U.tournamentId,matchUp:B,context:C,drawDefinition:P}),{...pe,modifiedLineUp:ce}}function y9(t){var e,i;let n=ei(t,[{[Ia]:!0,[Po]:!0,[Wp]:!0}]);if(n.error)return n;let{drawDefinition:r,sideNumber:a,matchUpId:s,event:o}=t;if(a&&![1,2].includes(a))return{error:Ae,sideNumber:a};let{matchUp:l,structure:c}=or({drawDefinition:r,matchUpId:s,event:o});return l?Ho({structure:c})?((e=l.sides)==null||e.forEach(u=>{(!a||u.sideNumber===a)&&delete u.participantId}),Qi({tournamentId:(i=t.tournamentRecord)==null?void 0:i.tournamentId,context:"assignSideParticipant",drawDefinition:r,matchUp:l}),{...pe}):{error:L5}:{error:xs}}function S7e({matchUpStatuses:t=[gn,un,Ki],drawPositionMatchUps:e,loserDrawPosition:i,sourceMatchUps:n}){var r;let a=e==null?void 0:e.reduce((d,p)=>!d||p.roundNumber>d.roundNumber?p:d,void 0),s=(r=a==null?void 0:a.drawPositions)==null?void 0:r.find(d=>d!==i),o=n.filter(d=>{var p;return(p=d==null?void 0:d.drawPositions)==null?void 0:p.includes(s)}).map(d=>d.matchUpStatus),l=n.filter(d=>{var p;return(p=d==null?void 0:d.drawPositions)==null?void 0:p.includes(i)}).map(d=>d.matchUpStatus),c=vo(o||[],t),u=vo(l||[],t);return{sourceMatchUp:a,winnerHadMatchUpStatus:c,winnerMatchUpStatuses:o,loserHadMatchUpStatus:u,loserMatchUpStatuses:l}}function T7e({inContextDrawMatchUps:t,sourceMatchUpStatus:e,targetDrawPosition:i,tournamentRecord:n,sourceMatchUpId:r,drawDefinition:a,structureId:s,dualMatchUp:o,roundNumber:l,matchUpsMap:c,event:u}){let{structure:d}=fi({drawDefinition:a,structureId:s});if((d==null?void 0:d.structureType)===Eo)return{...pe};c=c??Us({drawDefinition:a});let p=((c==null?void 0:c.mappedMatchUps)||{})[s].matchUps,{initialRoundNumber:h}=CI({drawPosition:i,matchUps:p}),f=p==null?void 0:p.filter(g=>{var v;return g.roundNumber>=l&&g.roundNumber!==h&&((v=g.drawPositions)==null?void 0:v.includes(i))}),{positionAssignments:m}=Gn({drawDefinition:a,structureId:s});for(let g of f??[])U7e({inContextDrawMatchUps:t,sourceMatchUpStatus:e,positionAssignments:m,targetDrawPosition:i,tournamentRecord:n,sourceMatchUpId:r,drawDefinition:a,dualMatchUp:o,matchUpsMap:c,matchUp:g,event:u});return{...pe}}function U7e({inContextDrawMatchUps:t,positionAssignments:e,sourceMatchUpStatus:i,targetDrawPosition:n,tournamentRecord:r,sourceMatchUpId:a,drawDefinition:s,dualMatchUp:o,matchUpsMap:l,matchUp:c,event:u}){var d,p,h;let f="removeSubsequentDrawPosition";if(o){let g=(p=(d=t.find(({matchUpId:y})=>c.matchUpId===y).sides)==null?void 0:d.find(y=>y.drawPosition===n))==null?void 0:p.sideNumber,v=(h=c.sides)==null?void 0:h.find(y=>y.sideNumber===g);v&&delete v.lineUp}c.drawPositions=(c.drawPositions||[]).map(g=>g===n?void 0:g).filter(Boolean);let m=e.filter(({drawPosition:g})=>{var v;return(v=c.drawPositions)==null?void 0:v.includes(g)}).filter(g=>g.bye).length;return c.matchUpStatus=m&&gn||[Ki,un].includes(c.matchUpStatus)&&c.matchUpStatus||jr,[un,Ki].includes(c.matchUpStatus)&&(c.winningSide=void 0),c.matchUpStatusCodes&&Wbe({inContextDrawMatchUps:t,sourceMatchUpStatus:i,sourceMatchUpId:a,matchUpsMap:l,matchUp:c}),Qi({tournamentId:r==null?void 0:r.tournamentId,eventId:u==null?void 0:u.eventId,context:`${f}-${n}`,drawDefinition:s,matchUp:c}),{...pe}}function s1(t){let{dualWinningSideChange:e,inContextDrawMatchUps:i,tournamentRecord:n,drawDefinition:r,matchUpStatus:a,matchUpsMap:s,dualMatchUp:o,targetData:l,matchUpId:c,structure:u,event:d}=t,p=!!t.matchUp.collectionId,h=Ho({structure:u}),{drawPositions:f,winningSide:m}=l.matchUp||{};if(!h&&!f)return{error:nR};let{targetLinks:{loserTargetLink:g,winnerTargetLink:v,byeTargetLink:y},targetMatchUps:{loserMatchUp:b,winnerMatchUp:I,byeMatchUp:T}}=l,w=wp({...t,matchUpStatus:a||jr,removeWinningSide:!0});if(w.error)return w;let S;if(p){let{matchUpTieId:k,matchUpsMap:O}=t;if(S=Nm({appliedPolicies:t.appliedPolicies,matchUpId:k,tournamentRecord:n,drawDefinition:r,matchUpsMap:O,event:d}),!e&&!S.removeWinningSide)return{...pe}}if(h)return{...pe};let{matchUps:U}=Sn({afterRecoveryTimes:!1,inContext:!0,drawDefinition:r,matchUpsMap:s,structure:u}),{positionAssignments:P}=Aa({structure:u}),E=m-1,R=1-E,C=f[E],M=f[R],{winnerParticipantId:_,loserParticipantId:A}=(P==null?void 0:P.reduce((k,O)=>(O.drawPosition===M&&(k.loserParticipantId=O.participantId),O.drawPosition===C&&(k.winnerParticipantId=O.participantId),k),{winnerParticipantId:void 0,loserParticipantId:void 0}))||{},N=U.filter(k=>{var O;return(O=k.drawPositions)==null?void 0:O.includes(M)});if(I&&CSe({sourceMatchUpStatus:a,sourceMatchUpId:c,inContextDrawMatchUps:i,winningDrawPosition:C,winnerParticipantId:_,tournamentRecord:n,winnerTargetLink:v,drawDefinition:r,winnerMatchUp:I,dualMatchUp:o,matchUpsMap:s}),b){let{winnerHadMatchUpStatus:k}=S7e({drawPositionMatchUps:N,loserDrawPosition:M,sourceMatchUps:U}),O=g.linkCondition===xp;if(k&&O){let F=Math.min(...b.drawPositions);DG({targetLink:g,inContextDrawMatchUps:i,drawDefinition:r,drawPosition:F,matchUpsMap:s,event:d})}let $=D7e({sourceMatchUpStatus:a,sourceMatchUpId:c,loserParticipantId:A,tournamentRecord:n,loserTargetLink:g,drawDefinition:r,loserMatchUp:b,dualMatchUp:o,matchUpsMap:s,event:d});if($.error)return $}if(T){let k=Math.min(...T.drawPositions);DG({sourceMatchUpId:c,targetLink:y,inContextDrawMatchUps:i,drawDefinition:r,drawPosition:k,matchUpsMap:s,event:d})}return{...pe,...S&&{tieMatchUpResult:S}}}function CSe({inContextDrawMatchUps:t,winningDrawPosition:e,sourceMatchUpStatus:i,winnerParticipantId:n,tournamentRecord:r,winnerTargetLink:a,sourceMatchUpId:s,drawDefinition:o,winnerMatchUp:l,matchUpsMap:c,dualMatchUp:u,event:d}){var p,h;let{structureId:f,roundNumber:m}=l,g="removeDirectedWinner";if(a){let v=a.target.structureId,{structure:y}=fi({drawDefinition:o,structureId:v});if(!y)return{error:yr};let{positionAssignments:b}=Aa({structure:y});y.seedAssignments=(y.seedAssignments??[]).filter(P=>P.participantId!==n);let I=(p=b==null?void 0:b.find(P=>P.participantId===n))==null?void 0:p.drawPosition,{matchUps:T}=Sn({drawDefinition:o,structure:y,event:d}),w=T.map(P=>P.drawPositions).flat(1/0).filter(Boolean),S=Ol(w);if((I?S[I]:void 0)===1)b==null||b.forEach(P=>{P.participantId===n&&delete P.participantId});else{let P=T.filter(({drawPositions:E})=>E.includes(I));console.log("not removing from position assignments since instances > 1",{drawPositionMatchUps:P,winnerTargetLink:a})}let U=(h=c==null?void 0:c.drawMatchUps)==null?void 0:h.find(({matchUpId:P})=>P===l.matchUpId);U&&Qi({tournamentId:r==null?void 0:r.tournamentId,eventId:d==null?void 0:d.eventId,matchUp:U,context:g,drawDefinition:o})}return m&&T7e({targetDrawPosition:e,inContextDrawMatchUps:t,sourceMatchUpStatus:i,tournamentRecord:r,sourceMatchUpId:s,drawDefinition:o,dualMatchUp:u,matchUpsMap:c,roundNumber:m,structureId:f}),{...pe}}function D7e({sourceMatchUpStatus:t,loserParticipantId:e,tournamentRecord:i,loserTargetLink:n,sourceMatchUpId:r,drawDefinition:a,loserMatchUp:s,matchUpsMap:o,dualMatchUp:l,event:c}){var u,d,p;let h="removeDirectedLoser",f=n.target.structureId,{structure:m}=fi({drawDefinition:a,structureId:f});if(!m)return{error:yr};let{positionAssignments:g}=Aa({structure:m}),v=(u=g==null?void 0:g.find(y=>y.participantId===e))==null?void 0:u.drawPosition;if(g==null||g.forEach(y=>{y.participantId===e&&delete y.participantId}),m.seedAssignments=(m.seedAssignments??[]).filter(y=>y.participantId!==e),l){let y=s==null?void 0:s.sides.reduce((T,w,S)=>w.drawPosition===v?S:T,void 0),b=(d=o==null?void 0:o.drawMatchUps)==null?void 0:d.find(({matchUpId:T})=>T===s.matchUpId),I=(p=b==null?void 0:b.sides)==null?void 0:p[y];I&&(delete I.lineUp,Qi({tournamentId:i==null?void 0:i.tournamentId,eventId:c==null?void 0:c.eventId,matchUp:b,context:h,drawDefinition:a}))}return{...pe}}function DG({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,drawPosition:n,matchUpsMap:r,targetLink:a,event:s}){let o=a.target.structureId,l="removeDirectedBye";Jl({color:"brightyellow",method:l,drawPosition:n});let c=OR({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,drawPosition:n,matchUpsMap:r,structureId:o,event:s});return fe({result:c,stack:l})}function E7e(t){var e,i;let{matchUpFormat:n,score:r}=t,a=(e=r==null?void 0:r.sets)==null?void 0:e.length,s=n&&Do(n),{setFormat:o,finalSetFormat:l,bestOf:c}=s??{};return((i=c&&a===c&&l||o)==null?void 0:i.timed)||!1}function P7e({tournamentRecord:t,drawDefinition:e,structure:i,matchUp:n}){var r;let a="attemptToSetMatchUpStatusBYE";if(n!=null&&n.winningSide)return fe({result:{error:_U},context:{matchUpStatus:gn},stack:a});let{positionAssignments:s}=Aa({structure:i}),o=s==null?void 0:s.filter(l=>l.bye).map(l=>l.drawPosition);return(r=n.drawPositions)!=null&&r.some(l=>o==null?void 0:o.includes(l))?(n.matchUpStatus=gn,n.matchUpStatusCodes=[],Qi({tournamentId:t==null?void 0:t.tournamentId,context:a,drawDefinition:e,matchUp:n}),{...pe}):fe({result:{error:mge},info:"matchUp does not include BYE",stack:a})}function ED(t){var e,i;let{tournamentRecord:n,appliedPolicies:r,drawDefinition:a,matchUpsMap:s,targetData:o,structure:l,event:c}=t,u="doubleExitAdvancement";if(l.structureType===Eo)return fe({result:{...pe},stack:u});let{matchUp:d,targetMatchUps:p,targetLinks:h}=o,{loserMatchUp:f,winnerMatchUp:m,loserTargetDrawPosition:g}=p,v=[un,Ki].includes(f==null?void 0:f.matchUpStatus)&&!((e=f.sides)!=null&&e.map(y=>y.participantId??y.participant).filter(Boolean).length);if(f&&f.matchUpStatus!==gn){let{loserTargetLink:y}=h;if((i=r==null?void 0:r.progression)!=null&&i.doubleExitPropagateBye){let b=RSe({loserTargetDrawPosition:g,tournamentRecord:n,loserTargetLink:y,drawDefinition:a,loserMatchUp:f,matchUpsMap:s,event:c});if(b.error)return fe({result:b,stack:u})}else if(!v){let{feedRound:b,drawPositions:I,matchUpId:T}=f,w=b?2:2-I.indexOf(g),S=NJ({...t,targetMatchUp:f,walkoverWinningSide:w,tournamentRecord:n,sourceMatchUp:d,matchUpId:T});if(S.error)return fe({result:S,stack:u})}}if(m){let y=NJ({...t,matchUpId:m.matchUpId,targetMatchUp:m,tournamentRecord:n,sourceMatchUp:d});if(y.error)return fe({result:y,stack:u})}return fe({result:{...pe},stack:u})}function NJ(t){var e,i,n;let{inContextDrawMatchUps:r,tournamentRecord:a,drawDefinition:s,sourceMatchUp:o,targetMatchUp:l,matchUpsMap:c}=t,u=s.structures.find(({structureId:Q})=>Q===l.structureId),d=t.matchUpStatus===oa?oa:Kr,p=t.matchUpStatus===oa?Ki:un,h="conditionallyAdvanceDrawPosition",f=c.drawMatchUps.find(Q=>Q.matchUpId===l.matchUpId);if(!f)return{error:ll};let m=(o==null?void 0:o.drawPositions)||[],g=(e=f.drawPositions)==null?void 0:e.filter(Boolean),v=(o==null?void 0:o.structureId)===l.structureId;if(v&&vo(m,g)&&(g=g.filter(Q=>!m.includes(Q))),v&&g.length>1)return fe({result:{error:rT},stack:h});let{pairedPreviousMatchUpIsDoubleExit:y,pairedPreviousMatchUp:b}=zbe(t),I=bo({matchUpId:l.matchUpId,inContextDrawMatchUps:r,drawDefinition:s}),{targetMatchUps:T,targetLinks:w}=I,{loserTargetDrawPosition:S,winnerMatchUp:U,loserMatchUp:P}=T;if(P){let{loserTargetLink:Q}=w,J=RSe({loserTargetDrawPosition:S,loserMatchUp:P,tournamentRecord:a,loserTargetLink:Q,drawDefinition:s,matchUpsMap:c});if(J.error)return fe({result:J,stack:h})}let E=((i=f.drawPositions)==null?void 0:i.filter(Boolean))||[],R=E.length===1,C=t.walkoverWinningSide||R&&cA({drawPosition:E[0],matchUpId:l.matchUpId,inContextDrawMatchUps:r})||void 0,M=[un,Ki].includes(f.matchUpStatus)&&!E.length,_=f.finishingRound===1,A=M&&!_?d:p,N=r.find(Q=>Q.matchUpId===b.matchUpId),k=[],O;o&&((o==null?void 0:o.structureId)===(N==null?void 0:N.structureId)?o.roundPosition<(b==null?void 0:b.roundPosition)?O=1:O=2:l.feedRound?o.structureId===l.structureId?O=2:O=1:C&&(O=3-C));let $=t.matchUpStatus,F=b==null?void 0:b.matchUpStatus;O===1?k=[{matchUpStatus:KM($),previousMatchUpStatus:$,sideNumber:1},{matchUpStatus:KM(F),previousMatchUpStatus:F,sideNumber:2}]:O===2&&(k=[{matchUpStatus:KM(F),previousMatchUpStatus:F,sideNumber:1},{matchUpStatus:KM($),previousMatchUpStatus:$,sideNumber:2}]),k.length&&(k=k.map(Q=>Zt(Q)));let V=wp({...t,winningSide:C,matchUp:f,matchUpStatusCodes:k,context:h,matchUpStatus:A});if(V.error)return fe({result:V,stack:h});if(M)return ED({...t,matchUpStatus:A,targetData:I});if(!U)return fe({result:{...pe},stack:h});let j=g.length===2?g[C-1]:g[0],{positionAssignments:B}=Gn({structure:u}),z=B==null?void 0:B.find(Q=>Q.drawPosition===j),W=c.drawMatchUps.find(Q=>Q.matchUpId===U.matchUpId),Z=(n=W==null?void 0:W.drawPositions)==null?void 0:n.filter(Boolean),K=Z.length===1;if(j){if(z!=null&&z.bye){let Q=bo({matchUpId:W.matchUpId,inContextDrawMatchUps:r,drawDefinition:s});if(K){let J=Z.filter(Boolean)[0],se=cA({drawPosition:J,matchUpId:W.matchUpId,inContextDrawMatchUps:r}),ie=wp({appliedPolicies:t.appliedPolicies,matchUpId:W.matchUpId,matchUp:W,matchUpStatus:p,matchUpStatusCodes:[],removeScore:!0,context:h,drawDefinition:s,winningSide:se});return ie.error?fe({result:ie,stack:h}):v8({drawPositionToAdvance:J,matchUpId:W.matchUpId,inContextDrawMatchUps:r,drawDefinition:s,matchUpsMap:c})}else if([un,Ki].includes(U.matchUpStatus)){let J=ED({...t,matchUpId:W.matchUpId,matchUpStatus:A,targetData:Q});if(J.error)return fe({result:J,stack:h})}return fe({result:{...pe},stack:h})}return wT({matchUpId:U.matchUpId,drawPosition:j,inContextDrawMatchUps:r,drawDefinition:s})}else if(y){if(!W)return{error:ll};if(K){let se=Z[0],ie=cA({matchUpId:l.matchUpId,inContextDrawMatchUps:r,drawPosition:se});console.log("existing drawPosition is winningSide",{walkoverWinningSide:ie})}let Q=[un,Ki].includes(W.matchUpStatus)?p:d,J=wp({matchUpId:W.matchUpId,appliedPolicies:t.appliedPolicies,matchUp:W,matchUpStatusCodes:[],removeScore:!0,context:h,drawDefinition:s,matchUpStatus:Q});if(J.error)return fe({result:J,stack:h});if(Q===d){let se=ED({...t,matchUpId:l.matchUpId,matchUpStatus:Q,targetData:I});if(se.error)return se}}return fe({result:{...pe},stack:h})}function RSe(t){var e;let{loserTargetDrawPosition:i,tournamentRecord:n,loserTargetLink:r,drawDefinition:a,matchUpsMap:s,event:o}=t,l=(e=r==null?void 0:r.target)==null?void 0:e.structureId,{structure:c}=fi({drawDefinition:a,structureId:l});return c?yc({drawPosition:i,tournamentRecord:n,drawDefinition:a,structureId:l,matchUpsMap:s,event:o}):{error:Yy}}function KM(t){return t===Kr?un:t===oa?Ki:t}function C7e(t){let{tournamentRecord:e,drawDefinition:i,matchUpStatus:n,structure:r,matchUp:a}=t,s=!!(a.tieMatchUps&&!a.rondPosition&&t.inContextDrawMatchUps.find(v=>v.matchUpId===a.matchUpId).containerStructureId),o="attemptToSetMatchUpStatus",l=n===gn,c=a.winningSide,u=[Kr,oa].includes(n),d=kR({matchUpStatus:n}),p=iG({matchUpStatus:n}),h=!d&&!p,f=t.matchUpTieId||c&&d&&!u,m=c&&u,g=()=>wp({...t,removeScore:[Kp,un].includes(n),matchUpStatus:n||jr});return h&&{error:Oj}||f&&EG(t)||m&&R7e(t)||c&&s1(t)||p&&g()||l&&P7e({tournamentRecord:e,drawDefinition:i,structure:r,matchUp:a})||!d&&{error:Oj}||u&&M7e(t)||s&&EG(t)||fe({result:{error:_U},stack:o})}function R7e(t){let e=s1(t);return e.error?e:ED(t)}function M7e(t){let e=EG({...t,removeScore:!0});return e.error?e:ED(t)}function EG(t){var e;let i="scoreModification";if(t.isCollectionMatchUp&&(e=t.dualMatchUp)!=null&&e.winningSide&&!t.projectedWinningSide){let a=s1(t);if(a.error)return fe({result:a,stack:i})}let n=!!t.matchUp.collectionId,r=wp({...t,context:i});if(n){let{matchUpTieId:a,drawDefinition:s,matchUpsMap:o}=t,l=Nm({tournamentRecord:t.tournamentRecord,appliedPolicies:t.appliedPolicies,matchUpId:a,event:t.event,drawDefinition:s,matchUpsMap:o});if(l.error)return fe({result:l,stack:i});Object.assign(r,{tieMatchUpResult:l})}return fe({result:r,stack:i})}function N7e({drawDefinition:t,structure:e,matchUp:i}){var n,r,a,s;let{drawPositions:o}=i,{positionAssignments:l}=Gn({drawDefinition:t,structure:e}),c=(n=l==null?void 0:l.filter(({drawPosition:p})=>o==null?void 0:o.includes(p)))==null?void 0:n.map(p=>{var h;let{extension:f}=xi({element:p,name:wg});return(h=f==null?void 0:f.value)==null?void 0:h.groupOrder}),{containerStructures:u}=zU({drawDefinition:t}),d=u[e.structureId];return{structureIds:(s=(a=(r=qU({drawDefinition:t,structureId:d}))==null?void 0:r.links)==null?void 0:a.source)==null?void 0:s.filter(p=>{var h;return vo(c,((h=p.source)==null?void 0:h.finishingPositions)||[])}).map(p=>p.source.structureId)}}function MSe({drawDefinition:t,structure:e,matchUp:i}){let n=[];if(e.finishingPosition===gy&&Eg({drawDefinition:t,structure:e})){let{structureIds:r}=N7e({drawDefinition:t,structure:e,matchUp:i});r!=null&&r.length&&n.push(...r)}return{connectedStructureIds:n}}function A7e(t){var e,i,n;let r,{inContextDrawMatchUps:a,inContextMatchUp:s,drawDefinition:o,winningSide:l}=t,c=(e=t.targetData.targetLinks)==null?void 0:e.winnerTargetLink;if(c.target.feedProfile===vd){let u=s.sides.find(({sideNumber:p})=>p!==l).participantId,d=a.find(p=>p.structureId===c.target.structureId&&p.roundNumber===c.target.roundNumber&&p.sides.some(({participantId:h})=>h===u));if((d==null?void 0:d.matchUpStatus)===jr){let p=bo({matchUpId:d.matchUpId,inContextDrawMatchUps:a,drawDefinition:o});if(!Uy({inContextDrawMatchUps:a,drawDefinition:o,targetData:p})){let{structure:h}=fi({structureId:d.structureId,drawDefinition:o}),f=Gn({structure:h}).positionAssignments;for(let m of f||[])if(m.participantId===u){let g=s.sides.find(({sideNumber:v})=>v===l).participantId;if(m.participantId=g,h==null?void 0:h.positionAssignments)h.positionAssignments=f;else if(h!=null&&h.structures){let v=Object.assign({},...(f||[]).map(y=>({[y.drawPosition]:y.participantId})));for(let y of h.structures)(i=y.positionAssignments)==null||i.forEach(b=>b.participantId=v[b.drawPosition])}Ug({tournamentId:(n=t.tournamentRecord)==null?void 0:n.tournamentId,event:t.event,drawDefinition:o,structure:h}),r=!0}}}}return{...pe,qualifierReplaced:r}}function _7e(t){var e,i,n,r,a;let s,{inContextDrawMatchUps:o,inContextMatchUp:l,drawDefinition:c,winningSide:u}=t,d=(e=t.targetData.targetLinks)==null?void 0:e.winnerTargetLink;if(d.target.feedProfile===vd){let p=(i=l.sides.find(({sideNumber:m})=>m===u))==null?void 0:i.participantId,h=o.filter(m=>m.structureId===d.target.structureId&&m.roundNumber===d.target.roundNumber&&m.sides.some(({participantId:g,qualifier:v})=>v&&!g)),f=Cu(h);if((f==null?void 0:f.matchUpStatus)===jr){let m=bo({matchUpId:f.matchUpId,inContextDrawMatchUps:o,drawDefinition:c});if(!Uy({inContextDrawMatchUps:o,drawDefinition:c,targetData:m})){let g=(n=f.sides.find(b=>b.qualifier&&!b.participantId))==null?void 0:n.drawPosition,{structure:v}=fi({structureId:f.structureId,drawDefinition:c});if(!v)return{error:yr};let y=Gn({structure:v}).positionAssignments;for(let b of y||[])if(b.drawPosition===g&&!b.participantId){if(b.participantId=p,v.positionAssignments)v.positionAssignments=y;else if(v.structures){let I=Object.assign({},...(y||[]).map(T=>({[T.drawPosition]:T.participantId})));for(let T of v.structures)(r=T.positionAssignments)==null||r.forEach(w=>w.participantId=I[w.drawPosition])}Ug({tournamentId:(a=t.tournamentRecord)==null?void 0:a.tournamentId,event:t.event,drawDefinition:c,structure:v}),s=!0}}}}return{...pe,qualifierPlaced:s}}function k7e(t){var e,i;let n="attemptToSetWinningSide",r,{appliedPolicies:a,disableAutoCalc:s,drawDefinition:o,dualMatchUp:l,winningSide:c,structure:u,matchUp:d}=t;if(l!=null&&l._disableAutoCalc&&s!==!1)return Z8(t);if(d.winningSide&&d.winningSide!==c){let{connectedStructureIds:m}=MSe({drawDefinition:o,structure:u,matchUp:d});m.length&&(console.log({connectedStructureIds:m}),r=!0);let g=s1(t);if(g.error)return g}let p=BIe(t);if(p.error)return fe({result:p,stack:n});let h,f;return t.qualifierChanging&&(e=a==null?void 0:a[HE])!=null&&e.autoReplaceQualifiers&&(h=A7e(t).qualifierReplaced),t.qualifierAdvancing&&(i=a==null?void 0:a[HE])!=null&&i.autoPlaceQualifiers&&(f=_7e(t).qualifierPlaced),fe({result:Zt({...pe,...p,connectedStructures:r,qualifierReplaced:h,qualifierPlaced:f}),stack:n})}var fA={drawPositionToRemove:"green",iteration:"brightred",winner:"green",loser:"brightred"};function NSe(t){var e,i,n,r;let{inContextDrawMatchUps:a,appliedPolicies:s,drawDefinition:o,matchUpsMap:l,targetData:c,matchUp:u}=t,{matchUpId:d}=u,{iteration:p=0}=t;p+=1;let h="removeDoubleExit";Jl({color:"brightyellow",method:h,matchUpId:d,iteration:p,keyColors:fA});let{targetMatchUps:{loserMatchUp:f,winnerMatchUp:m,loserTargetDrawPosition:g},targetLinks:{loserTargetLink:v}}=c;if(m&&m.matchUpStatus!==gn){let{stage:I,roundNumber:T,roundPosition:w,structureName:S}=m;Jl({winner:"winner",roundPosition:w,structureName:S,roundNumber:T,keyColors:fA,stage:I}),AJ({...t,targetMatchUp:m,sourceMatchUp:u,iteration:p})}let y=(f==null?void 0:f.matchUpStatus)===gn&&((f==null?void 0:f.feedRound)||(f==null?void 0:f.roundNumber)===1),b=((i=(e=c==null?void 0:c.targetLinks)==null?void 0:e.loserTargetLink)==null?void 0:i.linkCondition)===xp;if(y&&b){let I=a.filter(({roundNumber:S,structureId:U})=>U===u.structureId&&S===1),T=I.map(({roundPosition:S})=>S),w=Na(T.sort(),2).find(S=>S.includes(u.roundPosition));if(((n=I.filter(({roundPosition:S})=>w.includes(S)))==null?void 0:n.map(({matchUpStatus:S})=>S)).every(S=>[oa,Kr].includes(S)))return fe({result:{...pe},stack:h})}if(f&&(f.matchUpStatus!==gn||y)){let I=a.find(({matchUpId:R})=>R===f.matchUpId),{structure:T}=fi({drawDefinition:o,structureId:I.structureId}),{stage:w,roundNumber:S,roundPosition:U,feedRound:P,structureName:E}=f;if(Jl({loser:"loser",roundPosition:U,structureName:E,roundNumber:S,keyColors:fA,feedRound:P,stage:w}),((r=s==null?void 0:s.progression)==null?void 0:r.doubleExitPropagateBye)||y)DG({drawPosition:g,targetLink:v,inContextDrawMatchUps:a,drawDefinition:o,matchUpsMap:l});else{let R=AJ({...t,targetMatchUp:f,structure:T,iteration:p});if(R.error)return fe({result:R,stack:h})}}return fe({result:{...pe},stack:h})}function AJ(t){var e,i,n,r,a,s;let{inContextDrawMatchUps:o,appliedPolicies:l,drawDefinition:c,sourceMatchUp:u,targetMatchUp:d,matchUpsMap:p,structure:h,iteration:f}=t,m="conditionallyRemoveDrawPosition";Jl({method:m,structureName:h==null?void 0:h.structureName,iteration:f});let g=bo({matchUpId:d.matchUpId,inContextDrawMatchUps:o,drawDefinition:c}),{targetMatchUps:{winnerMatchUp:v}}=g,y=p==null?void 0:p.drawMatchUps.find(E=>E.matchUpId===d.matchUpId),b=[],I,T,w;if(d.feedRound)w=(i=(e=v==null?void 0:v.drawPositions)==null?void 0:e.filter(Boolean))==null?void 0:i.find(E=>d.drawPositions.includes(E));else if(!u)w=(n=Ar((d==null?void 0:d.drawPositions)||[],(v==null?void 0:v.drawPositions)||[]))==null?void 0:n[0];else if(T=(r=qbe({structureId:h.structureId,matchUp:u,matchUpsMap:p}))==null?void 0:r.pairedPreviousMatchUp,I=[Kr,oa].includes(T==null?void 0:T.matchUpStatus),b=((a=T==null?void 0:T.drawPositions)==null?void 0:a.filter(Boolean))||[],[...va,gn].includes(T==null?void 0:T.matchUpStatus)||(T==null?void 0:T.winningSide)){let E=u.drawPositions||[],R=(s=d.drawPositions)==null?void 0:s.filter(Boolean);vo(E,R)&&(R=R==null?void 0:R.filter(C=>!E.includes(C))),w=E.concat(b).find(C=>R==null?void 0:R.includes(C))}if(v&&w){let{stage:E,roundNumber:R,roundPosition:C,structureName:M}=v;Jl({method:"removeDirectedWinner",drawPositionToRemove:w,color:"brightgreen",roundPosition:C,structureName:M,roundNumber:R,keyColors:fA,stage:E}),CSe({winningDrawPosition:w,winnerMatchUp:v,inContextDrawMatchUps:o,drawDefinition:c,matchUpsMap:p})}let S=NSe({targetData:g,matchUp:d,inContextDrawMatchUps:o,appliedPolicies:l,drawDefinition:c,matchUpsMap:p,structure:h,iteration:f});if(S.error)return fe({result:S,stack:m});let U=x7e({pairedPreviousDoubleExit:I,noContextTargetMatchUp:y}),P=!I;return S=wp({...t,matchUpId:d.matchUpId,matchUp:y,removeWinningSide:!0,matchUpStatusCodes:[],context:m,matchUpStatus:U,removeScore:P,score:{scoreStringSide1:"",scoreStringSide2:"",sets:void 0}}),S.error?fe({result:S,stack:m}):{...pe}}function x7e({pairedPreviousDoubleExit:t,noContextTargetMatchUp:e}){return e.matchUpStatus===gn?gn:t?[oa,Ki].includes(e==null?void 0:e.matchUpStatus)?Ki:un:jr}function O7e(t){var e,i,n,r,a;let s,{inContextDrawMatchUps:o,inContextMatchUp:l,drawDefinition:c}=t,u=(e=t.targetData.targetLinks)==null?void 0:e.winnerTargetLink;if(u.target.feedProfile===vd){let d=(n=(i=l.sides)==null?void 0:i.find(({sideNumber:h})=>h===l.winningSide))==null?void 0:n.participantId,p=o.find(h=>{var f;return h.structureId===u.target.structureId&&h.roundNumber===u.target.roundNumber&&((f=h.sides)==null?void 0:f.some(({participantId:m})=>m===d))});if(p&&p.matchUpStatus===jr){let h=bo({matchUpId:p.matchUpId,inContextDrawMatchUps:o,drawDefinition:c});if(!Uy({inContextDrawMatchUps:o,drawDefinition:c,targetData:h})){let{structure:f}=fi({structureId:p.structureId,drawDefinition:c}),m=Gn({structure:f}).positionAssignments;for(let g of m||[])if(g.participantId===d){if(g.participantId=void 0,f==null?void 0:f.positionAssignments)f.positionAssignments=m;else if(f!=null&&f.structures){let v=Object.assign({},...(m||[]).map(y=>({[y.drawPosition]:y.participantId})));for(let y of(f==null?void 0:f.structures)||[])(r=y.positionAssignments)==null||r.forEach(b=>b.participantId=v[b.drawPosition])}Ug({tournamentId:(a=t.tournamentRecord)==null?void 0:a.tournamentId,event:t.event,drawDefinition:c,structure:f}),s=!0}}}}return{qualifierRemoved:s}}function L7e(t){var e;let{matchUp:i,matchUpStatus:n,score:r,winningSide:a}=t,s="noDownStreamDependencies";if([Kr,oa].includes(i==null?void 0:i.matchUpStatus)&&![Kr,oa].includes(n)){let g=NSe(t);if(g.error)return fe({result:g,stack:s})}let o=n===Kr,l=ya({score:r})&&!o&&(t.isCollectionMatchUp&&!t.projectedWinningSide||!a),c=((e=t==null?void 0:t.inContextMatchUp)==null?void 0:e.collectionId)&&E7e(t.inContextMatchUp),u=t.removeScore||!c&&![$l,ul].includes(n||$l),d=t.isCollectionMatchUp&&t.dualMatchUp.winningSide&&!t.projectedWinningSide||i.winningSide&&!a&&!ya({score:r}),p=n&&n!==jr,h=g=>{var v,y;let b,{structure:I,drawDefinition:T,dualMatchUp:w,disableAutoCalc:S}=t;if(w!=null&&w._disableAutoCalc&&S!==!1)return Z8({...t,removeWinningSide:d});let{connectedStructureIds:U}=MSe({drawDefinition:T,structure:I,matchUp:i});U.length&&(console.log({connectedStructureIds:U}),b=!0),Object.assign(t,{removeScore:g});let P=s1(t);if(P.error)return P;if(t.removingQualifier&&(y=(v=t.appliedPolicies)==null?void 0:v[HE])!=null&&y.autoRemoveQualifiers){let E=O7e(t);return{...pe,connectedStructures:b,...E}}return{...pe,connectedStructures:b}};if(d&&a&&t.isCollectionMatchUp)return _J(t);let f=[Kp,ul].includes(n)&&t.dualWinningSideChange,m=(a||f)&&k7e(t)||l&&h(u)||p&&C7e(t)||d&&h(u)||i&&_J({...t,removeScore:!0})||{...pe};return fe({result:m,stack:s})}function _J(t){var e;let i="ndd:scoreModification";if(t.isCollectionMatchUp&&(e=t.dualMatchUp)!=null&&e.winningSide&&!t.projectedWinningSide&&!t.autoCalcDisabled){let r=s1(t);if(r.error)return r}let n=wp({...t,context:i});if(t.isCollectionMatchUp){let{matchUpTieId:r,drawDefinition:a,event:s,matchUpsMap:o}=t,{removeWinningSide:l}=Nm({tournamentRecord:t.tournamentRecord,appliedPolicies:t.appliedPolicies,matchUpId:r,drawDefinition:a,matchUpsMap:o,event:s});l&&console.log("REMOVE WINNING SIDE")}return fe({result:n,stack:i})}function b9(t){var e,i,n;let r=ei(t,[{[Ia]:!0,[Po]:!0,[Wp]:!0},{homeParticipantId:!0,[$u]:da}]);if(r.error)return r;let a=t1(t,[{[BU]:ef,attr:{[WL]:!0}}]);if(a.error)return a;let s=(n=(i=(e=a==null?void 0:a.matchUp)==null?void 0:e.matchUp)==null?void 0:i.sides)==null?void 0:n.map(h=>h==null?void 0:h.participantId);if(t.homeParticipantId&&!(s!=null&&s.includes(t.homeParticipantId)))return{error:xd};let{disableNotice:o,homeParticipantId:l,removePriorValues:c,tournamentRecord:u,drawDefinition:d,matchUpId:p}=t;return Vl({duplicateValues:!1,removePriorValues:c,tournamentRecord:u,drawDefinition:d,disableNotice:o,matchUpId:p,timeItem:{itemType:u8,itemValue:l}})}function ASe({timeStamp:t,schedule:e,matchUp:i}){let{itemValue:n,timeStamp:r}=nb({timeItems:(i==null?void 0:i.timeItems)||[],itemType:dF});return!e||r&&t&&new Date(r).getTime()>new Date(t).getTime()?{timeModifiers:n}:e}function rv(t){var e;let i="addMatchUpScheduledTime",n=t.matchUp,{removePriorValues:r,tournamentRecord:a,drawDefinition:s,disableNotice:o,scheduledTime:l,matchUpId:c}=t;if(!c)return fe({result:{error:Zs},stack:i});if(!FU(l))return fe({result:{error:Iu},stack:i});if(!n){let f=or({drawDefinition:s,matchUpId:c});if(f.error)return fe({result:f,stack:i});n=f.matchUp}let u=Mi(l),d=Aw({matchUp:n}).scheduledDate,p=u&&!d;if((e=ASe({matchUp:n}).timeModifiers||[])!=null&&e.length){let f=_Se({disableNotice:!0,removePriorValues:r,tournamentRecord:a,timeModifiers:[],drawDefinition:s,matchUpId:c,matchUp:n});if(f!=null&&f.error)return fe({result:f,stack:i})}let h=Tw(l,!0,p);return Vl({duplicateValues:!1,removePriorValues:r,tournamentRecord:a,drawDefinition:s,disableNotice:o,matchUpId:c,timeItem:{itemType:Mw,itemValue:h}})}function _Se({removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:n,timeModifiers:r,matchUpId:a,matchUp:s}){let o="addMatchUpTimeModifiers";if(!a)return fe({result:{error:Zs},stack:o});if(r!==void 0&&!Array.isArray(r))return fe({info:Sy("timeModifiers"),result:{error:Ae},stack:o});if(!s){let d=or({drawDefinition:i,matchUpId:a});if(d.error)return fe({result:d,stack:o});s=d.matchUp}let l=ASe({matchUp:s}).timeModifiers||[],c=r.filter(d=>!l.includes(d));if(r.length&&!c.length)return{...pe};if(c.some(d=>Jj.includes(d))){l=l.filter(p=>!Jj.includes(p));let d=rv({disableNotice:!0,removePriorValues:t,scheduledTime:"",tournamentRecord:e,drawDefinition:i,matchUpId:a});if(d.error)return fe({result:d,stack:o})}let u=r!=null&&r.length?[...c,...l]:void 0;return Vl({duplicateValues:!1,removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:n,matchUpId:a,timeItem:{itemType:dF,itemValue:u}})}function p2({scheduledDate:t,removePriorValues:e,tournamentRecord:i,drawDefinition:n,disableNotice:r,matchUpId:a}){if(!a)return{error:Zs};let s=t&&_p.test(t);if(t&&!s)return{error:Va};let o={itemValue:Mi(t),itemType:Rw};return Vl({duplicateValues:!1,removePriorValues:e,tournamentRecord:i,drawDefinition:n,disableNotice:r,matchUpId:a,timeItem:o})}function h2({removePriorValues:t,tournamentRecords:e,tournamentRecord:i,drawDefinition:n,disableNotice:r,courtDayDate:a,matchUpId:s,courtIds:o}){var l,c;if(!i&&!e)return{error:dt};if(!s)return{error:Zs};let u=or({drawDefinition:n,matchUpId:s});if(u.error)return u;if(((l=u==null?void 0:u.matchUp)==null?void 0:l.matchUpType)!==ac)return{error:cl};if(!(o===void 0||Array.isArray(o)&&o.length&&o.every(p=>typeof p=="string")))return{error:Ae,context:{courtIds:o}};let d;if(o){let p=e||i&&{[i.tournamentId]:i},h=Am({tournamentRecords:p});if(h.error)return h;let f=(c=h.courts)==null?void 0:c.filter(m=>o.includes(m.courtId));if((f==null?void 0:f.length)!==o.length)return{error:Ae,context:{courtIds:o}};d=f==null?void 0:f.map(m=>({venueId:m.venueId,courtId:m.courtId}))}return Vl({duplicateValues:!1,removePriorValues:t,tournamentRecord:i,drawDefinition:n,disableNotice:r,matchUpId:s,timeItem:{itemType:Yh,itemDate:a,itemValue:d}})}function o1({removePriorValues:t,tournamentRecords:e,tournamentRecord:i,drawDefinition:n,disableNotice:r,matchUpId:a,venueId:s}){if(!i)return{error:dt};if(!a)return{error:Zs};if(s){let o=tf({tournamentRecords:e,tournamentRecord:i,venueId:s});if(o.error)return o}return Vl({duplicateValues:!1,removePriorValues:t,tournamentRecord:i,drawDefinition:n,disableNotice:r,matchUpId:a,timeItem:{itemType:Cw,itemValue:s}})}function Gw({removePriorValues:t,tournamentRecords:e,tournamentRecord:i,drawDefinition:n,disableNotice:r,courtDayDate:a,matchUpId:s,courtId:o}){var l;if(!i&&!e)return{error:dt};if(!s)return{error:Zs};if(o){let c=_w({tournamentRecords:e,tournamentRecord:i,courtId:o});if(c.error)return c;let u=(l=c.venue)==null?void 0:l.venueId;o1({tournamentRecords:e,tournamentRecord:i,drawDefinition:n,disableNotice:r,matchUpId:s,venueId:u})}return Vl({duplicateValues:!1,removePriorValues:t,tournamentRecord:i,drawDefinition:n,disableNotice:r,matchUpId:s,timeItem:{itemType:Dg,itemDate:a,itemValue:o}})}function pp(t,e){let i=yve.test(t)?t:sr(t),n=Mi(t)||Mi(e)||Lu(new Date);return new Date(`${n}T${i}`).getTime()}function f2(t){var e;let i="addMatchUpScheduleItems",n=ei(t,[{drawDefinition:!0,matchUpId:!0},{schedule:!0,[Wo]:tl}],i);if(n.error)return n;let{matchUpDependencies:r,inContextMatchUps:a}=t,{errorOnAnachronism:s=!1,checkChronology:o=!0,removePriorValues:l,tournamentRecords:c,tournamentRecord:u,drawDefinition:d,disableNotice:p,drawMatchUps:h,matchUpId:f,schedule:m,event:g}=t,v,y;if(h)v=h.find(N=>N.matchUpId===f);else{let N=or({drawDefinition:d,event:g,matchUpId:f});if(N.error)return N;v=N.matchUp}let{endTime:b,courtId:I,courtIds:T,courtOrder:w,resumeTime:S,homeParticipantId:U,scheduledDate:P,scheduledTime:E,startTime:R,stopTime:C,timeModifiers:M,venueId:_}=m;o&&(!r||!a)&&({matchUpDependencies:r,matchUps:a}=od({drawDefinition:d}));let A=(e=r==null?void 0:r[f])==null?void 0:e.matchUpIds;if(m.scheduledDate&&o&&A){let N=a==null?void 0:a.filter(k=>{var O,$;return(((O=k.schedule)==null?void 0:O.scheduledDate)||Mi(($=k.schedule)==null?void 0:$.scheduledTime))&&A.includes(k.matchUpId)}).map(({schedule:k})=>{let O=O_(k);return new Date(O).getTime()});if(N!=null&&N.length){let k=O_(m),O=new Date(k).getTime();if(Math.max(...N)>=O){if(s)return fe({result:{error:_j},stack:i});y=_j}}}if(P!==void 0){let N=p2({disableNotice:!0,removePriorValues:l,tournamentRecord:u,drawDefinition:d,scheduledDate:P,matchUpId:f});if(N!=null&&N.error)return fe({result:N,stack:i,context:{scheduledDate:P}})}if(E!==void 0){let N=rv({disableNotice:!0,removePriorValues:l,tournamentRecord:u,drawDefinition:d,scheduledTime:E,matchUpId:f,matchUp:v});if(N!=null&&N.error)return fe({result:N,stack:i,context:{scheduledTime:E}})}if(R!==void 0){let N=w9({disableNotice:!0,removePriorValues:l,tournamentRecord:u,drawDefinition:d,matchUpId:f,startTime:R,event:g});if(N!=null&&N.error)return fe({result:N,stack:i,context:{startTime:R}})}if(C!==void 0){let N=T9({disableNotice:!0,removePriorValues:l,tournamentRecord:u,drawDefinition:d,matchUpId:f,stopTime:C,event:g});if(N!=null&&N.error)return fe({result:N,stack:i,context:{stopTime:C}})}if(S!==void 0){let N=U9({disableNotice:!0,removePriorValues:l,tournamentRecord:u,drawDefinition:d,resumeTime:S,matchUpId:f,event:g});if(N!=null&&N.error)return fe({result:N,stack:i,context:{resumeTime:S}})}if(b!==void 0){let N=S9({disableNotice:!0,removePriorValues:l,tournamentRecord:u,drawDefinition:d,matchUpId:f,endTime:b,event:g});if(N!=null&&N.error)return fe({result:N,stack:i,context:{endTime:b}})}if(T!==void 0){let N=h2({disableNotice:!0,removePriorValues:l,tournamentRecord:u,drawDefinition:d,matchUpId:f,courtIds:T});if(N!=null&&N.error)return fe({result:N,stack:i,context:{courtIds:T}})}if(I!==void 0&&P!==void 0){let N=Gw({courtDayDate:P,disableNotice:!0,removePriorValues:l,tournamentRecords:c,tournamentRecord:u,drawDefinition:d,matchUpId:f,courtId:I});if(N!=null&&N.error)return fe({result:N,stack:i,context:{courtId:I}})}if(_!==void 0){let N=o1({disableNotice:!0,removePriorValues:l,tournamentRecords:c,tournamentRecord:u,drawDefinition:d,matchUpId:f,venueId:_});if(N!=null&&N.error)return fe({result:N,stack:i,context:{venueId:_}})}if(w!==void 0&&wi(w)){let N=I9({disableNotice:!0,removePriorValues:l,tournamentRecord:u,drawDefinition:d,courtOrder:w,matchUpId:f});if(N!=null&&N.error)return fe({result:N,stack:i,context:{courtOrder:w}})}if(M!==void 0){let N=_Se({disableNotice:!0,removePriorValues:l,tournamentRecord:u,drawDefinition:d,timeModifiers:M,matchUpId:f,matchUp:v});if(N!=null&&N.error)return fe({result:N,stack:i,context:{timeModifiers:M}})}return ur(U)&&b9({disableNotice:!0,homeParticipantId:U,removePriorValues:l,tournamentRecord:u,drawDefinition:d,matchUpId:f}),p||Qi({tournamentId:u==null?void 0:u.tournamentId,eventId:g==null?void 0:g.eventId,context:i,drawDefinition:d,matchUp:v}),y?{...pe,warnings:[y]}:{...pe}}function I9({removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:n,courtOrder:r,matchUpId:a}){if(!a)return{error:Zs};if(r&&!wi(r))return{error:Ae,info:"courtOrder must be numeric"};let s=r&&di(r);return Vl({duplicateValues:!1,removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:n,matchUpId:a,timeItem:{itemType:uF,itemValue:s}})}function kSe({removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:n,participantId:r,officialType:a,matchUpId:s}){if(!s)return{error:Zs};if(!r)return{error:da};if(e){let l=br({tournamentRecord:e,participantFilters:{participantTypes:[Hi],participantRoles:[w8]}}).participants??[];if(!Ig({tournamentParticipants:l,participantId:r}))return{error:Or}}let o={itemType:"SCHEDULE.ASSIGNMENT.OFFICIAL",itemValue:r};return a&&(o.itemSubTypes=[a]),Vl({duplicateValues:!1,removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:n,matchUpId:s,timeItem:o})}function w9({removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:n,matchUpId:r,startTime:a,event:s}){if(!r)return{error:Zs};if(!FU(a))return{error:Iu};let{matchUp:o}=or({drawDefinition:i,event:s,matchUpId:r}),{scheduledDate:l}=Aw({matchUp:o}),c=((o==null?void 0:o.timeItems)??[]).filter(u=>[xf,Ch,lm].includes(u==null?void 0:u.itemType)).map(u=>pp(u.itemValue,l)).reduce((u,d)=>!u||d<u?d:u,void 0);if(!c||pp(a,l)<c){o!=null&&o.timeItems&&(o.timeItems=o.timeItems.filter(d=>d.itemType!==yd));let u=Tw(a,!0,!0);return Vl({duplicateValues:!1,removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:n,matchUpId:r,timeItem:{itemType:yd,itemValue:u}})}else return{error:Gge}}function S9({validateTimeSeries:t=!0,removePriorValues:e,tournamentRecord:i,drawDefinition:n,disableNotice:r,matchUpId:a,endTime:s,event:o}){if(!a)return{error:Zs};if(!FU(s))return{error:Iu};let{matchUp:l}=or({drawDefinition:n,event:o,matchUpId:a}),{scheduledDate:c}=Aw({matchUp:l}),u=((l==null?void 0:l.timeItems)??[]).filter(d=>[yd,Ch,xf].includes(d==null?void 0:d.itemType)).map(d=>pp(d.itemValue,c)).reduce((d,p)=>!d||p>d?p:d,void 0);if(!t||!u||pp(s,c)>u){l!=null&&l.timeItems&&(l.timeItems=l.timeItems.filter(p=>p.itemType!==lm));let d=Tw(s,!0,!0);return Vl({duplicateValues:!1,removePriorValues:e,tournamentRecord:i,drawDefinition:n,disableNotice:r,matchUpId:a,timeItem:{itemType:lm,itemValue:d}})}else return{error:Vge}}function T9({removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:n,matchUpId:r,stopTime:a,event:s}){if(!r)return{error:Zs};if(!FU(a))return{error:Iu};let{matchUp:o}=or({drawDefinition:i,event:s,matchUpId:r}),{scheduledDate:l}=Aw({matchUp:o}),c=(o==null?void 0:o.timeItems)??[];if(c.reduce((f,m)=>m.itemType===lm||f,void 0))return{error:J5};let u=c.filter(f=>[yd,Ch,xf].includes(f==null?void 0:f.itemType)).sort((f,m)=>pp(f.itemValue,l)-pp(m.itemValue,l)),d=u[u.length-1],p=d&&d.itemType===xf,h=u.filter(f=>!p||f.createdAt!==d.createdAt).map(f=>pp(f.itemValue,l)).reduce((f,m)=>!f||m>f?m:f,void 0);if(pp(a,l)>h){if(o!=null&&o.timeItems&&p){let m=d.createdAt;o.timeItems=o.timeItems.filter(g=>g.createdAt!==m)}let f={itemValue:Tw(a,!0,!0),itemType:xf};return Vl({duplicateValues:!0,removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:n,matchUpId:r,timeItem:f})}else return{error:jge}}function U9({removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:n,resumeTime:r,matchUpId:a,event:s}){if(!a)return{error:Zs};if(!FU(r))return{error:Iu};let{matchUp:o}=or({drawDefinition:i,event:s,matchUpId:a}),{scheduledDate:l}=Aw({matchUp:o}),c=(o==null?void 0:o.timeItems)??[];if(c.reduce((f,m)=>m.itemType===lm||f,void 0))return{error:J5};let u=c.filter(f=>[yd,Ch,xf].includes(f==null?void 0:f.itemType)).sort((f,m)=>pp(f.itemValue,l)-pp(m.itemValue,l)),d=u[u.length-1],p=d&&d.itemType===Ch,h=u.filter(f=>!p||f.createdAt!==d.createdAt).map(f=>pp(f.itemValue,l)).reduce((f,m)=>!f||m>f?m:f,void 0);if(pp(r,l)>h){if(o!=null&&o.timeItems&&p){let m=d.createdAt;o.timeItems=o.timeItems.filter(g=>g.createdAt!==m)}let f={itemValue:Tw(r,!0,!0),itemType:Ch};return Vl({duplicateValues:!0,removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:n,matchUpId:a,timeItem:f})}else return{error:zHe}}function F7e({drawDefinition:t,matchUpStatus:e,matchUpsMap:i,winningSide:n,dualMatchUp:r,tieFormat:a,structure:s,matchUp:o,event:l,score:c}){var u;let d=$t(r,void 0,!0);for(let h of(d==null?void 0:d.tieMatchUps)||[])h.matchUpId===o.matchUpId&&(h.winningSide=n,h.score=c,!ya({score:c})&&!e?Object.assign(h,{...EF}):e&&(h.matchUpStatus=e));a=a??((u=Ws({matchUp:o,structure:s,drawDefinition:t,event:l}))==null?void 0:u.tieFormat);let{winningSide:p}=KR({matchUp:d,drawDefinition:t,matchUpsMap:i,structure:s,tieFormat:a,event:l});return{projectedWinningSide:p}}function $7e(t){var e;let{tournamentRecord:i,inContextMatchUp:n,structure:r,drawDefinition:a}=t,s=n.roundNumber,o=n.sides.find(w=>w.sideNumber===n.winningSide),l=n.sides.find(w=>w.sideNumber!==n.winningSide),{drawPosition:c,participantId:u}=o,{drawPosition:d,participantId:p}=l,h="swapWinnerLoser",{matchUps:f}=Sn(t),m=f.filter(({drawPositions:w,roundNumber:S})=>(w==null?void 0:w.includes(c))&&S>s);oc({changeWinner:!0})&&console.log({existingWinnerSubsequentMatchUps:m}),m.forEach(w=>{var S,U;w.drawPositions=((S=w.drawPositions)==null?void 0:S.map(P=>P===c?d:P))||[],Qi({tournamentId:i==null?void 0:i.tournamentId,eventId:(U=t.event)==null?void 0:U.eventId,context:h,drawDefinition:a,matchUp:w})});let{stage:g,stageSequence:v}=r,y=a.structures.filter(({stage:w,stageSequence:S})=>w===g&&S>v).map(({structureId:w})=>w),{targetLinks:{loserTargetLink:b,winnerTargetLink:I}}=t.targetData,T=[b==null?void 0:b.target.structureId,(e=I==null?void 0:I.target)==null?void 0:e.structureId].filter(Boolean);return a.structures.filter(({stage:w,structureId:S})=>w!==g&&T.includes(S)).forEach(({stage:w,stageSequence:S,structureId:U})=>{y.includes(U)||y.push(U),a.structures.filter(({stage:P,stageSequence:E})=>P===w&&E>S).forEach(({structureId:P})=>{y.includes(P)||y.push(P)})}),a.structures.filter(({structureId:w})=>y.includes(w)).forEach(w=>{let{positionAssignments:S}=Gn({structure:w}),U=S==null?void 0:S.find(({participantId:E})=>E===u),P=S==null?void 0:S.find(({participantId:E})=>E===p);U&&(U.participantId=p),P&&(P.participantId=u)}),wp({...t,context:h})}function uM(t){var e,i,n;let r="setMatchUpStatus";t.matchUpStatus&&[un,Kr].includes(t.matchUpStatus)&&(t.score=void 0);let{allowChangePropagation:a,disableScoreValidation:s,tournamentRecords:o,tournamentRecord:l,disableAutoCalc:c,enableAutoCalc:u,drawDefinition:d,matchUpStatus:p,winningSide:h,matchUpId:f,event:m,score:g}=t;if(!d)return{error:Ht};if(p&&[Kp,$l,ul,jr].includes(p)&&h)return{error:Ae,winningSide:h,matchUpStatus:p};if(![void 0,...kye].includes(p))return fe({result:{error:_U},info:"matchUpStatus does not exist",stack:"setMatchUpStatus"});let v=Us({drawDefinition:d}),{matchUps:y}=pa({nextMatchUps:!0,tournamentRecord:l,inContext:!0,drawDefinition:d,matchUpsMap:v,event:m}),b=v.drawMatchUps.find(z=>z.matchUpId===f),I=y==null?void 0:y.find(z=>z.matchUpId===f);if(!b||!y)return{error:xs};if((b.winningSide||h)&&p===gn)return{context:"Cannot have Bye with winningSide",error:eA,matchUpStatus:p};let T=I==null?void 0:I.structureId,{structure:w}=fi({drawDefinition:d,structureId:T}),S=Br(Xn)(b.matchUpType),U=(e=I==null?void 0:I.drawPositions)==null?void 0:e.filter(Boolean),P=I==null?void 0:I.matchUpTieId,E=bo({matchUpId:P||f,inContextDrawMatchUps:y,drawDefinition:d});Object.assign(t,{inContextDrawMatchUps:y,inContextMatchUp:I,matchUpTieId:P,matchUpsMap:v,targetData:E,structure:w,matchUp:b});let R=Uy(t),C;if(S){if(c)pn({extension:{name:EI,value:!0},element:b});else if(u){let z=b.winningSide,{winningSide:W,scoreStringSide1:Z,scoreStringSide2:K,set:Q}=KR({drawDefinition:d,matchUpsMap:v,structure:w,matchUp:b,event:m}),J={scoreStringSide1:Z,scoreStringSide2:K,sets:Q?[Q]:[]};if(C=W!==z,R&&C)return fe({stack:"winningSideWithDownstreamDependencies",result:{error:PL},context:{winningSide:h,matchUp:b}});uo({name:EI,element:b}),Object.assign(t,{winningSide:W,dualWinningSideChange:C,projectedWinningSide:W,score:J})}ZR({tournamentId:l==null?void 0:l.tournamentId,inContextDualMatchUp:I,eventId:m==null?void 0:m.eventId,dualMatchUp:b,drawDefinition:d})}if(S&&p&&[Dw].includes(p))return{info:"Not supported for matchUpType: TEAM",error:Ae};if(g&&!S&&!s){let z=b.matchUpFormat??(w==null?void 0:w.matchUpFormat)??(d==null?void 0:d.matchUpFormat)??(m==null?void 0:m.matchUpFormat),W=I7({existingMatchUpStatus:b.matchUpStatus,matchUpFormat:z,matchUpStatus:p,winningSide:h,score:g});if(W.error)return W}let M=((i=fn({policyTypes:[HE,Kc],tournamentRecord:l,drawDefinition:d,event:m}))==null?void 0:i.appliedPolicies)??{};tn(t.policyDefinitions)&&Object.assign(M,t.policyDefinitions);let _=V7e({assignedDrawPositions:U,inContextMatchUp:I,appliedPolicies:M,drawDefinition:d,matchUpStatus:p,structure:w,matchUp:b});if(_!=null&&_.error)return _;let A=(I==null?void 0:I.stage)===ri&&I.finishingRound===1,N=A&&h,k=A&&b.winningSide&&!h&&(!t.matchUpStatus||t.matchUpStatus&&iG({matchUpStatus:t.matchUpStatus}))&&(!t.outcome||!ya({outcome:t.outcome})),O=N&&h!==b.winningSide&&b.winningSide;if(Object.assign(t,{qualifierAdvancing:N,qualifierChanging:O,removingQualifier:k,appliedPolicies:M}),P){let{matchUp:z}=or({matchUpId:P,inContext:!0,drawDefinition:d,matchUpsMap:v,event:m});if(z){let W=(n=Ws({matchUp:z,drawDefinition:d,structure:w,event:m}))==null?void 0:n.tieFormat,{projectedWinningSide:Z}=F7e({drawDefinition:d,matchUpStatus:p,dualMatchUp:z,matchUpsMap:v,winningSide:h,tieFormat:W,structure:w,matchUp:b,event:m,score:g}),K=z.winningSide;C=Z!==K;let Q=z._disableAutoCalc;Object.assign(t,{isCollectionMatchUp:!0,dualWinningSideChange:C,projectedWinningSide:Z,autoCalcDisabled:Q,matchUpTieId:P,dualMatchUp:z,tieFormat:W})}}let $=kR({matchUpStatus:p});if(!P){if(R&&!h&&(p&&iG({matchUpStatus:p})||p&&[Kr,oa].includes(p)))return{error:eA,activeDownstream:R,winningSide:h};if(h&&h===b.winningSide&&p&&!$)return{context:"winningSide must include directing matchUpStatus",error:eA,directingMatchUpStatus:$,matchUpStatus:p}}let{schedule:F}=t;if(F){let z=f2({disableNotice:!0,tournamentRecords:o,tournamentRecord:l,drawDefinition:d,matchUpId:f,schedule:F});if(z.error)return z}let V=!S&&!C&&h&&b.winningSide&&b.winningSide!==h;if(a&&V&&b.roundPosition)return $7e(t);let j=h&&!P||t.projectedWinningSide;Jl({activeDownstream:R,matchUpWinner:j,method:r,winningSide:h});let B=!R&&L7e(t)||j&&B7e(t)||($||t.autoCalcDisabled)&&xSe(t)||{error:Xge};return fe({result:B,stack:r})}function B7e(t){let{matchUp:e,winningSide:i,matchUpTieId:n,dualWinningSideChange:r}=t;return i===e.winningSide||n&&!r?xSe(t):fe({stack:"winningSideWithDownstreamDependencies",result:{error:PL},context:{winningSide:i,matchUp:e}})}function xSe(t){let{tournamentRecord:e,matchUp:i,event:n}=t,r=t.isCollectionMatchUp&&i.winningSide&&!t.winningSide&&!ya({score:t.score}),a=t.isCollectionMatchUp?t.matchUpStatus||r&&jr||t.winningSide&&$r||$l:t.matchUpStatus||$r,s=t.removeScore||[Kp,un].includes(a)&&![$l,ul].includes(a),o=wp({...t,matchUpStatus:a,removeWinningSide:r,context:"sms",removeScore:s});if(o.error)return o;if(t.isCollectionMatchUp){let{matchUpTieId:l,drawDefinition:c,matchUpsMap:u}=t,d=Nm({appliedPolicies:t.appliedPolicies,matchUpId:l,tournamentRecord:e,drawDefinition:c,matchUpsMap:u,event:n});if(d.error)return d;Object.assign(o,{tieMatchUpResult:d})}return o}function V7e({assignedDrawPositions:t,inContextMatchUp:e,appliedPolicies:i,drawDefinition:n,matchUpStatus:r,structure:a,matchUp:s}){var o,l;if(((o=i==null?void 0:i[Kc])==null?void 0:o.requireParticipantsForScoring)===!1)return{...pe};let c=(l=e==null?void 0:e.sides)==null?void 0:l.map(p=>p.participantId).filter(Boolean).length,u=s!=null&&s.sides?[]:Gn({structureId:a==null?void 0:a.structureId,drawDefinition:n}).positionAssignments,d=c&&c===2||s.collectionId&&Ho({structure:a})&&c&&c>=1||(t==null?void 0:t.length)===2&&(u==null?void 0:u.filter(p=>t.includes(p.drawPosition)).every(p=>p.participantId));return r&&_ye.includes(r)&&!d?fe({info:"matchUpStatus requires assigned participants",context:{matchUpStatus:r,requiredParticipants:d},result:{error:_U}}):{...pe}}function OSe({tournamentRecord:t,drawDefinition:e,matchUpId:i,event:n}){if(!e)return{error:Ht};let{matchUp:r}=or({drawDefinition:e,matchUpId:i,event:n});return(r==null?void 0:r.matchUpType)!==ac?{error:cl}:uM({enableAutoCalc:!0,tournamentRecord:t,drawDefinition:e,matchUpId:i,event:n})}function LSe({drawDefinition:t,event:e,matchUpId:i}){if(!t)return{error:Ht};if(!i)return{error:Zs};let{matchUp:n}=or({drawDefinition:t,event:e,matchUpId:i});return n?uo({name:QL,element:n}):{error:xs}}function j7e({substituteParticipantId:t,existingParticipantId:e,tournamentRecord:i,drawDefinition:n,sideNumber:r,matchUpId:a,event:s}){var o,l,c,u,d;let p="substituteParticipant";if(!n)return{error:Ht};if(!a)return{error:Zs};if(!e||!t)return fe({result:{error:da},stack:p});let{matchUp:h}=or({drawDefinition:n,matchUpId:a,event:s});if(!h)return{error:xs};if(!h.collectionId)return fe({result:{error:cl},stack:p});let f=Us({drawDefinition:n}),{matchUps:m}=pa({tournamentParticipants:i==null?void 0:i.participants,inContext:!0,drawDefinition:n,matchUpsMap:f}),g=m==null?void 0:m.find(y=>y.matchUpId===a),v=(l=(o=m==null?void 0:m.find(y=>y.matchUpId===(g==null?void 0:g.matchUpTieId)))==null?void 0:o.sides)==null?void 0:l.find(y=>y.participant.individualParticipants.some(({participantId:b})=>b===e));return!v||r&&v.sideNumber!==r?{error:xd}:(d=(u=(c=v.participant)==null?void 0:c.individualParticipants)==null?void 0:u.map(Gi).filter(y=>y!==e))!=null&&d.includes(t)?v9({newParticipantId:t,tieMatchUpId:a,existingParticipantId:e,substitution:!0,tournamentRecord:i,drawDefinition:n,event:s}):fe({result:{error:xd},stack:p})}function FSe(t){return j7e(t)}function $Se({drawDefinition:t,matchUpId:e,event:i}){if(!t)return{error:Ht};let{matchUp:n}=or({drawDefinition:t,matchUpId:e,event:i});return pn({extension:{name:EI,value:!0},element:n})}function BSe(t){let e="setMatchUpFormat",i=ei(t,[{tournamentRecord:!0},{[ps]:T=>Ll({matchUpFormat:T}),[cc]:aR,matchUpFormat:!0}]);if(i.error)return fe({result:i,stack:e});let{tournamentRecord:n,drawDefinition:r,scheduledDates:a,stageSequences:s,matchUpFormat:o,structureId:l,eventType:c,matchUpId:u,eventId:d,stages:p,drawId:h,event:f,force:m}=t;if(a&&!Array.isArray(a))return fe({result:{error:Ae,scheduledDates:a},stack:e});if(c&&!IL([kp,Yc],c))return fe({result:{error:jh},stack:e});let g=0,v=t.structureIds||l&&[l].filter(Boolean)||[],y=t.eventIds||d&&[d].filter(Boolean)||[],b=t.drawIds||h&&[h].filter(Boolean)||[];if((l||v!=null&&v.length)&&!r)return fe({result:{error:Ht},stack:e});if(h&&u&&r){let T=U7({tournamentRecord:n,drawDefinition:r,matchUpFormat:o,structureIds:v,structureId:l,matchUpId:u});if(T.error)return T;g+=1}let I=T=>{let w=[];for(let S of T.structures||[]){if(Array.isArray(p)&&!p.includes(S.stage)||Array.isArray(s)&&!s.includes(S.stageSequence)||v!=null&&v.length&&!v.includes(S.structureId))continue;v!=null&&v.length&&S.matchUpFormat!==o&&(S.matchUpFormat=o,w.push(S.structureId),g+=1);let U=((m||a)&&Sn({matchUpFilters:{matchUpStatuses:[jr]},structure:S}).matchUps)??[],P=(a&&Sn({matchUpFilters:{matchUpStatuses:[jr]},contextFilters:{scheduledDates:a},afterRecoveryTimes:!1,inContext:!0,structure:S}).matchUps)??[];if(U!=null&&U.length){let E=P?P.map(Ca):U.map(Ca);for(let R of U)E.includes(R.matchUpId)&&(R.matchUpFormat=a!=null&&a.length?o:void 0,Qi({tournamentId:n==null?void 0:n.tournamentId,eventId:f==null?void 0:f.eventId,context:e,drawDefinition:T,matchUp:R}))}}return!w.length&&T.matchUpFormat!==o&&(T.matchUpFormat=o,g+=1),w};for(let T of(n==null?void 0:n.events)||[])if(!(y!=null&&y.length&&!y.includes(T.eventId)||c&&c!==T.eventType||c===aa))if(Array.isArray(s)||Array.isArray(p)||v!=null&&v.length||b!=null&&b.length)for(let w of T.drawDefinitions||[]){if(Array.isArray(b)&&!b.includes(w.drawId))continue;let S=I(w);zn({structureIds:S,drawDefinition:w})}else T.matchUpFormat!==o&&(T.matchUpFormat=o,g+=1);return g?{...pe,modificationsCount:g}:{...pe,info:LU}}function D9({inheritance:t=!0,tournamentRecord:e,drawDefinition:i,matchUpId:n,event:r}){var a,s;if(!i)return{error:Ht};let o=(a=or({drawDefinition:i,matchUpId:n}))==null?void 0:a.matchUp;if(!(o!=null&&o.tieMatchUps))return{error:cl};let l=(s=or({inContext:!0,drawDefinition:i,matchUpId:n,event:r}))==null?void 0:s.matchUp,c=0;return((o==null?void 0:o.sides)||[]).forEach(u=>{u.lineUp&&delete u.lineUp}),((l==null?void 0:l.sides)||[]).forEach(u=>{if(c+=1,t===!1){let d=l==null?void 0:l.tieFormat,p=u.participantId;d&&p&&Fw({drawDefinition:i,participantId:p,lineUp:[],tieFormat:d})}Qi({tournamentId:e==null?void 0:e.tournamentId,context:"resetMatchUpLineUps",eventId:r==null?void 0:r.eventId,drawDefinition:i,matchUp:o})}),{...pe,modificationsCount:c}}function VSe(t){let{matchUpFormat:e,matchUpStatus:i,winningSide:n,score:r,setTBlast:a}=t;if(!r)return{sets:[]};let s=r.sets||[],o=Mh({winnerFirst:!1,matchUpFormat:e,matchUpStatus:i,setTBlast:a,sets:s}),l=Mh({winnerFirst:!1,reversed:!0,matchUpFormat:e,matchUpStatus:i,setTBlast:a,sets:s}),c=Mh({matchUpFormat:e,matchUpStatus:i,winningSide:n,setTBlast:a,sets:s}),u=o===c?l:o;return n&&(o=n===1?c:u,l=n===2?c:u),{score:{sets:s,scoreStringSide1:o,scoreStringSide2:l}}}function dM(t){var e,i;let n=ei(t,[{[Wp]:!0,[Po]:!0}]);if(n.error)return n;let r=au(t);if(!t.drawDefinition){let I=t.tournamentRecord??(t.tournamentId&&r[t.tournamentId]);t.tournamentRecord||(t.tournamentRecord=I);let T=zo({eventId:t.eventId,drawId:t.drawId,tournamentRecord:I});if(T.error)return T;T.drawDefinition&&(t.drawDefinition=T.drawDefinition),t.event=T.event}let{disableScoreValidation:a,policyDefinitions:s,tournamentRecord:o,disableAutoCalc:l,enableAutoCalc:c,drawDefinition:u,matchUpId:d,schedule:p,event:h,notes:f}=t,m=t.matchUpFormat||((e=t.outcome)==null?void 0:e.matchUpFormat),{policy:g}=eb({policyType:Kc,tournamentRecord:o,event:h}),v=t.allowChangePropagation!==void 0&&t.allowChangePropagation||(g==null?void 0:g.allowChangePropagation)!==void 0&&g.allowChangePropagation||void 0,{outcome:y,setTBlast:b}=t;if(y!=null&&y.winningSide&&![1,2].includes(y.winningSide))return{error:DL};if(m){let I=U7({tournamentRecord:o,drawDefinition:u,matchUpFormat:m,matchUpId:d,event:h});if(I.error)return I}if((i=y==null?void 0:y.score)!=null&&i.sets&&!y.score.scoreStringSide1){let{score:I}=VSe({...y,setTBlast:b});y.score=I,y.score.sets=y.score.sets.filter(T=>T.side1Score||T.side2Score||T.side1TiebreakScore||T.side2TiebreakScore)}return uM({matchUpStatusCodes:y==null?void 0:y.matchUpStatusCodes,matchUpStatus:y==null?void 0:y.matchUpStatus,winningSide:y==null?void 0:y.winningSide,allowChangePropagation:v,disableScoreValidation:a,score:y==null?void 0:y.score,tournamentRecords:r,policyDefinitions:s,tournamentRecord:o,disableAutoCalc:l,enableAutoCalc:c,drawDefinition:u,matchUpFormat:m,matchUpId:d,schedule:p,event:h,notes:f})}function jSe(t){if(!(t!=null&&t.outcomes))return{error:si};if(!Array.isArray(t.outcomes))return{error:si,info:{outcomes:t.outcomes}};let e=t.tournamentRecords||t.tournamentRecord&&{[t.tournamentRecord.tournamentId]:t.tournamentRecord}||{},i=t.outcomes??[],n=i.reduce((r,a)=>r.includes(a.tournamentId)?r:r.concat(a.tournamentId),[]);for(let r of n){let a=e[r];if(!a)return{error:dt};let s=i.filter(o=>o.tournamentId===r);if(s.length){let o=G7e({outcomes:s,tournamentRecord:a});if(o.error)return o}}return{...pe}}function G7e(t){var e;let{tournamentRecords:i,tournamentRecord:n,outcomes:r,policyDefinitions:a}=t,s={};r.forEach(o=>{let{eventId:l}=o;s[l]||(s[l]=[]),s[l].push(o)});for(let o of Object.keys(s)){let{event:l}=zo({tournamentRecord:n,eventId:o});for(let c of s[o]){let{drawId:u}=c,d=(e=l==null?void 0:l.drawDefinitions)==null?void 0:e.find(p=>p.drawId===u);if(d&&u){let{matchUpFormat:p,matchUpId:h}=c,f=dM({schedule:c==null?void 0:c.schedule,tournamentRecords:i,policyDefinitions:a,tournamentRecord:n,drawDefinition:d,matchUpFormat:p,matchUpId:h,outcome:c,drawId:u,event:l});if(f.error)return f}}}return{...pe}}function H7e({drawDefinition:t,matchUpId:e,outcome:i,matchUp:n}){var r,a;if(!n&&!t)return{error:Ht};if(!i)return{error:si,info:"missing outcome"};if(!n&&!e)return{error:ll};if(!n){let s=or({drawDefinition:t,matchUpId:e});if(s.error)return s;n=s.matchUp}return typeof i!="object"||!((r=i.score)!=null&&r.scoreStringSide1)||!((a=i.score)!=null&&a.scoreStringSide2)?{error:Ae}:pn({element:n,extension:{name:QL,value:i}})}function GSe(t){return H7e(t)}function E9(t){var e,i;let n="resetTieFormat",{drawDefinition:r,event:a,uuids:s}=t,o=ei(t,[{[Ia]:!0,[Wp]:!0}],n);if(o.error)return o;let l=t1(t,[{[BU]:ef}]);if(l[$u])return l;let c=(e=t.tournamentRecord)==null?void 0:e.tournamentId,{matchUp:u,structure:d}=(l==null?void 0:l.matchUp)??{};if(!(u!=null&&u.tieMatchUps))return fe({result:{error:cl},info:"Must be a TEAM matchUp",stack:n});if(!u.tieFormat)return{...pe};let p=(i=Ws({structure:d,drawDefinition:r,event:a}))==null?void 0:i.tieFormat;if(!p)return fe({result:{error:Ya},info:"No inherited tieFormat",stack:n});let h=[],f=[],m=[],g=[];for(let v of p.collectionDefinitions){let{matchUpCount:y,collectionId:b}=v;f.push(b);let I=(u.tieMatchUps||[]).filter(T=>T.collectionId===b);if(I.length>y)I.sort((T,w)=>(T.matchUpStatus===jr?1:0)-(w.matchUpStatus===jr?1:0)),m.push(...I.slice(0,y)),h.push(...I.slice(3).map(Ca));else if(m.push(...I),I.length<y){let T=y-I.length,w=WR({collectionDefinition:v,matchUpsLimit:T,matchUp:u,uuids:s});g.push(...w)}}for(let v of(u==null?void 0:u.tieMatchUps)||[])v.collectionId&&!f.includes(v.collectionId)&&h.push(v.matchUpId);return g.length&&(m.push(...g),Tg({eventId:a==null?void 0:a.eventId,matchUps:g,drawDefinition:r,tournamentId:c})),h.length&&Cm({matchUpIds:h,eventId:a==null?void 0:a.eventId,drawDefinition:r,tournamentId:c}),u&&(u.tieMatchUps=m,u.tieFormatId=void 0,u.tieFormat=void 0,Qi({structureId:d==null?void 0:d.structureId,eventId:a==null?void 0:a.eventId,context:n,drawDefinition:r,tournamentId:c,matchUp:u})),{...pe,newMatchUps:g,deletedMatchUpIds:h}}function P9(t){var e,i,n;let{tournamentRecord:r,drawDefinition:a,matchUpId:s,event:o}=t,l="resetScorecard";if(!a)return fe({result:{error:Ht},stack:l});if(!s)return fe({result:{error:Zs},stack:l});if(!ur(s))return fe({result:{error:Ae,matchUpId:s},stack:l});let c=Us({drawDefinition:a}),{matchUps:u}=pa({nextMatchUps:!0,inContext:!0,drawDefinition:a,matchUpsMap:c}),d=c.drawMatchUps.find(y=>y.matchUpId===s),p=u==null?void 0:u.find(y=>y.matchUpId===s);if(!d||!u)return{error:xs};if(d.matchUpType!==Fl)return{error:cl};let h=bo({inContextDrawMatchUps:u,drawDefinition:a,matchUpId:s}),f=p==null?void 0:p.structureId,{structure:m}=fi({drawDefinition:a,structureId:f});if(Object.assign(t,{inContextDrawMatchUps:u,inContextMatchUp:p,matchUpsMap:c,targetData:h,structure:m,matchUp:d}),Uy(t))return{error:PL};if((e=d.tieMatchUps)!=null&&e.length)for(let y of d.tieMatchUps){let b=uM({matchUpId:y.matchUpId,matchUpTieId:s,winningSide:void 0,removeScore:!0,tournamentRecord:r,drawDefinition:a,event:o});if(b.error)return fe({result:b,stack:l})}let g=(i=fn({tournamentRecord:r,drawDefinition:a,event:o}))==null?void 0:i.appliedPolicies,v=Nm({event:t.event,removeScore:!0,tournamentRecord:r,appliedPolicies:g,drawDefinition:a,matchUpsMap:c,matchUpId:s});if(v.error)return fe({result:v,stack:l});if(t.tiebreakReset&&!v.tieFormatRemoved){let y=(n=Ws({drawDefinition:a,structure:m,event:o}))==null?void 0:n.tieFormat;if(d.tieFormat&&y){let{matchUpCountDifference:b,descendantDifferences:I,ancestorDifferences:T,valueDifference:w}=cm({descendant:d.tieFormat,ancestor:y});if(I.collectionIds.length===1&&!T.collectionIds.length&&!T.groupsCount&&b===1&&w===1){let S=E9({tournamentRecord:r,drawDefinition:a,matchUpId:s,event:o});if(S.error)return S}}}return{...pe}}function HSe(t){let e=ei(t,[{[Po]:!0,[Zg]:!0},{[fT]:{[mR]:!1,roundNumbers:!1},[bye]:"At least one must be provided",[Wo]:Ms}]);if(e.error)return e;let i=WIe(t);if(i.error)return i;let{matchUpIds:n}=i,r=Br(Fl)(t.event.eventType),{tournamentRecord:a,drawDefinition:s,event:o}=t;for(let l of n){if(r){let u=P9({tiebreakReset:!0,tournamentRecord:a,drawDefinition:s,matchUpId:l,event:o});if(u.error||t.removeAssignments&&D9({inheritance:!1,drawDefinition:s,matchUpId:l}).error)return u}let c=uM({winningSide:void 0,removeScore:!0,tournamentRecord:a,drawDefinition:s,matchUpId:l,event:o});if(c.error)return c;if(t.removeAssignments){let u=y9({...t,matchUpId:l});if(u.error)return u}}return{...pe}}function z7e({tournamentRecord:t,drawDefinition:e,finishingOrder:i}){var n;if(!e)return{error:Ht};let r="setOrderOfFinish";if(!Array.isArray(i))return fe({info:Sy("finishingOrder"),result:{error:Ae},stack:r});let{completedMatchUps:a,matchUpsMap:s}=WU({inContext:!0,drawDefinition:e}),o=(a==null?void 0:a.map(Ca))??[],l=i.map(Ca),{matchUpTypes:c,roundNumbers:u,structureIds:d,matchUpTieIds:p}=(a??[]).filter(({matchUpId:b})=>l.includes(b)).reduce((b,I)=>{let{matchUpTieId:T,matchUpType:w,roundNumber:S,structureId:U}=I;return b.matchUpTypes.includes(w)||b.matchUpTypes.push(w),b.roundNumbers.includes(S)||b.roundNumbers.push(S),b.structureIds.includes(U)||b.structureIds.push(U),b.matchUpTieIds.includes(T)||b.matchUpTieIds.push(T),b},{matchUpTypes:[],roundNumbers:[],structureIds:[],matchUpTieIds:[]});if(c.length>1||p.length>1||u.length>1||d.length>1)return fe({info:"matchUpType, structureId and roundNumber must be equivalent",result:{error:Ae},stack:r});let h,f,m={},g=[],v=[];if(!i.every(({orderOfFinish:b,matchUpId:I})=>(g.push(I),b&&v.push(b),m[I]=b,h=o.includes(I),f=b===void 0||wi(b)&&Math.floor(b)>0,h&&f)))return fe({result:{error:h?Ae:_U},info:!h&&"matchUps must be completed"||!f&&"orderOfFinish must be integer > 0 or undefined"||void 0,stack:r});let y=a==null?void 0:a.filter(b=>b.structureId===d[0]&&b.roundNumber===u[0]&&b.matchUpType===c[0]&&b.matchUpTieId===p[0]&&!g.includes(b.matchUpId));for(let b of y??[]){let{orderOfFinish:I}=b||{};if(I){if(!wi(I))return fe({context:{orderOfFinish:I,matchUp:b},result:{error:Ae},stack:r});v.push(I)}}if(jme(v).length!==v.length||Math.max(...v)>v.length)return fe({info:"Values not unique or greater than expected number of values",result:{error:Ae},stack:r});if(d.length){let b=gF({matchUpFilters:{matchUpIds:l},structureId:d[0],drawDefinition:e,matchUpsMap:s});if(b.error)return fe({result:b,stack:r});(n=b.completedMatchUps)==null||n.forEach(I=>{I.orderOfFinish=m[I.matchUpId],Qi({tournamentId:t.tournamentId,context:"setOrderOfFinish",drawDefinition:e,matchUp:I})})}return{...pe}}function zSe(t){return z7e(t)}function qSe(t){var e,i,n,r;let{tournamentRecord:a,drawDefinition:s,matchUpId:o,lineUps:l,event:c}=t,u="applyLineUps",d=ei(t,[{[Ia]:!0,[Po]:!0,[Wp]:!0},{lineUps:!0,[Wo]:Ms}],u);if(d.error)return d;let p=a.participants||[],h=or({tournamentParticipants:p,inContext:!0,drawDefinition:s,matchUpId:o});if(h.error)return h;if(!h.matchUp)return{error:xs};let{matchUp:f,structure:m}=h,{drawPositions:g,matchUpType:v}=f;if(v!==Xn)return{error:cl};if(!(g!=null&&g.length))return{error:nR};let y=(e=Ws({matchUp:f,drawDefinition:s,structure:m,event:c}))==null?void 0:e.tieFormat,b={};for(let T of l){if(!Array.isArray(T))return{error:Ae,lineUp:T};let w={},S=[];for(let C of T){if(typeof C!="object")return{error:Ae,lineUpAssignment:C};let{participantId:M,collectionAssignments:_=[]}=C;if(!Array.isArray(_))return{error:Ae,collectionAssignments:_};let A=p.find(k=>k.participantId===M);if(!A)return{error:Or};if(A.participantType!==Hi)return{error:Od};let N=(n=(i=f.sides)==null?void 0:i.find(k=>{var O,$;return($=(O=k.participant)==null?void 0:O.individualParticipantIds)==null?void 0:$.includes(M)}))==null?void 0:n.sideNumber;N&&S.push(N);for(let k of _){if(typeof k!="object")return{error:Ae,collectionAssignment:k};let{collectionId:O,collectionPosition:$}=k,F=(r=y==null?void 0:y.collectionDefinitions)==null?void 0:r.find(B=>B.collectionId===O);if(!F)return{error:Ae,collectionId:O};let V=`${O}-${$}`;w[V]||(w[V]=[]);let j=w[V].length;if(Br(On)(F.matchUpType)&&j||F.matchUpType===Nn&&j>1)return{info:"Excessive collectionPosition assignments",error:Ae};w[V].push(M)}}let U=Object.values(w);for(let C of U)if(C.length===2){let{participant:M}=Qu({tournamentParticipants:p,participantIds:C});if(!M){let _=$p({participant:{participantType:Ai,participantRole:vs,individualParticipantIds:C},pairOverride:!0,tournamentRecord:a});if(_.error)return _}}let P=Ol(S),E=(P[1]||0)>(P[2]||0)&&1||(P[2]||0)>(P[1]||0)&&2||void 0,R=Object.keys(b).map(C=>parseInt(C));E&&!R.includes(E)&&(b[E]=T)}if(!Object.keys(b).length)return{error:n6};if(h=or({drawDefinition:s,matchUpId:o}),h.error)return h;if(!h.matchUp)return{error:xs};let{matchUp:I}=h;I.sides||(I.sides=[]);for(let T of[1,2]){let w=I.sides.find(U=>U.sideNumber===T),S=b[T];if(S)w?w.lineUp=S:I.sides.push({lineUp:S,sideNumber:T});else continue}return Qi({tournamentId:a==null?void 0:a.tournamentId,context:u,drawDefinition:s,matchUp:I}),{...pe}}var C9={};Fi(C9,{anonymizeTournamentRecord:()=>fTe,generate:()=>WSe,generateEventWithDraw:()=>b2,generateOutcome:()=>O9,generateOutcomeFromScoreString:()=>R9,generateParticipants:()=>l1,generateTournamentRecord:()=>pTe,modifyTournamentRecord:()=>mTe,mutate:()=>hTe});var WSe={};Fi(WSe,{generateEventWithDraw:()=>b2,generateOutcome:()=>O9,generateOutcomeFromScoreString:()=>R9,generateParticipants:()=>l1,generateTournamentRecord:()=>pTe});function R9(t){let{matchUpFormat:e,matchUpStatus:i,winningSide:n,scoreString:r,setTBlast:a}=t;if(!r)return{outcome:{...EF,winningSide:n,matchUpStatus:i}};if(n&&![1,2,void 0].includes(n))return{error:Ae,winningSide:n};let s=r&&rk({scoreString:r}),o={},l=Mh({sets:s,matchUpFormat:e,setTBlast:a}),c=Mh({sets:s,reversed:!0,matchUpFormat:e,setTBlast:a});return n===2?(o.scoreStringSide1=c,o.scoreStringSide2=l):(o.scoreStringSide1=l,o.scoreStringSide2=c),o.sets=rk({scoreString:o.scoreStringSide1}),Zt({outcome:{matchUpStatus:i,winningSide:n,score:o}})}function M9({matchUpScheduleTimes:t,matchUpDependencies:e,allDateMatchUpIds:i,matchUp:n}){var r;let a=(((r=e==null?void 0:e[n.matchUpId])==null?void 0:r.matchUpIds)||[]).filter(s=>i.includes(s)).filter(s=>!t[s]);return{dependenciesScheduled:!(a!=null&&a.length),remainingDependencies:a}}function pM({individualParticipantProfiles:t,participantId:e}){t[e]||(t[e]={typeChangeTimeAfterRecovery:void 0,timeAfterRecovery:void 0,priorMatchUpType:void 0,potentialRecovery:{},potentialCounted:{},potentialBookings:{},bookings:[],counters:{}})}function q7e({individualParticipantProfiles:t,recoveryValue:e,participantId:i,scheduleTime:n,drawId:r}){t[i].potentialRecovery[r]||(t[i].potentialRecovery[r]=[]),t[i].potentialRecovery[r].push(e),t[i].potentialBookings[r]||(t[i].potentialBookings[r]=[]),t[i].potentialBookings[r].push({timeAfterRecovery:e,scheduleTime:n})}function rP({matchUpPotentialParticipantIds:t,individualParticipantProfiles:e,typeChangeRecoveryMinutes:i,averageMatchUpMinutes:n=0,matchUpNotBeforeTimes:r,matchUpDependencies:a,recoveryMinutes:s=0,scheduleTime:o,matchUp:l}){var c,u;let d=sr((c=l==null?void 0:l.schedule)==null?void 0:c.endTime),p=d?nl(d,di(s)):nl(o,di(n)+di(s)),h=i&&(d?nl(sr(d),i):nl(o,di(n)+di(i))),f=((u=a==null?void 0:a[l.matchUpId])==null?void 0:u.participantIds)||[],m=(l.roundPosition&&t[l.matchUpId]||[]).flat();f.forEach(g=>{pM({individualParticipantProfiles:e,participantId:g});let v=e[g].priorMatchUpType!==l.matchUpType&&h||p;m.includes(g)?q7e({individualParticipantProfiles:e,drawId:l.drawId,recoveryValue:v,participantId:g,scheduleTime:o}):(e[g].timeAfterRecovery=v,e[g].bookings.push({scheduleTime:o,timeAfterRecovery:v}))}),UT({matchUpPotentialParticipantIds:t,matchUpNotBeforeTimes:r,timeAfterRecovery:p,matchUp:l})}function YSe({matchUpScheduleTimes:t,matchUpDependencies:e,scheduleTime:i,matchUpId:n,details:r}){var a,s,o,l,c;let u,d=(s=(a=r.minutesMap)==null?void 0:a[n])==null?void 0:s.recoveryMinutes,p=(((l=(o=r.minutesMap)==null?void 0:o[n])==null?void 0:l.averageMinutes)||0)+(d||0),h=nl(i,p),f=((c=e==null?void 0:e[n])==null?void 0:c.dependentMatchUpIds)||[];if(f.length){let m=f.reduce((g,v)=>{let y=t[v];if(!y)return g;let b={scheduleTime:y,matchUpId:v};return y&&!g.matchUpId||sn(y)<sn(g.scheduleTime)?b:g},{});m.scheduleTime&&sn(h)>sn(m.scheduleTime)&&(u=m)}return{scheduledDependent:u}}function W7e(t){let{sides:e,matchUpType:i}=t||{};return(e||[]).map(n=>{var r;return i===Nn&&(((r=n==null?void 0:n.participant)==null?void 0:r.individualParticipants)||[])||(n==null?void 0:n.participant)&&[n.participant]||[]}).flat()}var hM="DO_NOT_SCHEDULE",Y7e={DO_NOT_SCHEDULE:hM};function N9({averageMatchUpMinutes:t=90,requestConflicts:e={},potentials:i=!0,personRequests:n,scheduleTime:r,scheduleDate:a,matchUp:s}){let o=W7e(s).map(({person:h})=>h==null?void 0:h.personId);if(i){let h=((s==null?void 0:s.potentialParticipants)||[]).flat().map(({person:f})=>f==null?void 0:f.personId);o.push(...h)}let l=o.map(h=>{var f;return(f=n[h])==null?void 0:f.map(m=>({...m,personId:h}))}).filter(Boolean).flat().filter(h=>h.requestType===hM&&Gh(a,h.date)),c=[],u=s==null?void 0:s.matchUpId,d=Xr(sr(r),Mi(a)),p=sr(g6(d,t).toISOString());for(let h of l){let{requestId:f,startTime:m,endTime:g}=h;(r>m&&r<g||p>m&&p<g)&&(c.push({matchUpId:u,request:h,scheduleTime:r}),e[f]?(e[f].scheduleTimes.includes(r)||e[f].scheduleTimes.push(r),e[f].matchUpIds.includes(u)||e[f].matchUpIds.push(u)):e[f]={request:h,scheduleTimes:[r],matchUpIds:[u]})}return{conflicts:c}}function PG({matchUpPotentialParticipantIds:t,individualParticipantProfiles:e,matchUp:i,value:n}){let{matchUpType:r}=i,{individualParticipantIds:a}=sF(i),s=(t[i.matchUpId]||[]).filter(o=>!vo(o,a)).flat();[...a,...s].forEach(o=>{if(pM({individualParticipantProfiles:e,participantId:o}),!e[o].potentialCounted[i.drawId]){let l=e[o].counters;l[r]?l[r]+=n:n>0&&(l[r]=n),l[Vu]?l[Vu]+=n:n>0&&(l[Vu]=n),s.includes(o)&&(e[o].potentialCounted[i.drawId]=!0)}})}function K7e({matchUpPotentialParticipantIds:t,individualParticipantProfiles:e,dateScheduledMatchUpIds:i,greatestAverageMinutes:n,dateScheduledMatchUps:r,matchUpNotBeforeTimes:a,matchUpScheduleTimes:s,matchUpDependencies:o,clearScheduleDates:l,scheduleDate:c,minutesMap:u,matchUps:d}){var p,h;let f=[];i||(r=d==null?void 0:d.filter(v=>{let y=v.schedule||{},b=v.matchUpStatus===gn;return b&&f.push({tournamentId:v.tournamentId,matchUpId:v.matchUpId}),!b&&aM({schedule:y})&&(!c||v.schedule.scheduledDate===c)}),i=r.map(Ca));let m=Array.isArray(l)?l.includes(c):l,g=m?[]:d.filter(({matchUpId:v})=>i.includes(v));for(let v of g){PG({matchUpPotentialParticipantIds:t,individualParticipantProfiles:e,value:1,matchUp:v});let y=(p=v.schedule)==null?void 0:p.scheduledTime;if(y){s[v.matchUpId]=y;let b=(h=u==null?void 0:u[v.matchUpId])==null?void 0:h.recoveryMinutes;rP({individualParticipantProfiles:e,matchUpPotentialParticipantIds:t,matchUpNotBeforeTimes:a,matchUpDependencies:o,averageMatchUpMinutes:n,recoveryMinutes:b,scheduleTime:y,matchUp:v})}}return{dateScheduledMatchUpIds:i,byeScheduledMatchUpDetails:f,dateScheduledMatchUps:r,clearDate:m}}function m2({defaultRecoveryMinutes:t=0,averageMatchUpMinutes:e=90,dateScheduledMatchUps:i,tournamentRecords:n,venueIds:r=[],periodLength:a,scheduleDate:s,matchUps:o}){if(typeof n!="object")return{error:Tr};if(!lu(o)&&!Array.isArray(i))return{error:Em};a=a??l2({recoveryMinutes:t,averageMatchUpMinutes:e});let l=Object.assign({},...Object.values(n).map(d=>(d.events??[]).map(p=>{let{scheduleTiming:h}=SR({tournamentRecord:d,event:p});return{[p.eventId]:{event:p,scheduleTiming:h}}})).flat()),c={averageTimes:[{minutes:{default:e}}],recoveryTimes:[{minutes:{default:t}}]};i||(i=o==null?void 0:o.filter(d=>{let p=d.schedule;return aM({schedule:p})&&(!s||d.schedule.scheduledDate===s)}));let u=i==null?void 0:i.filter(d=>(!r.length||r.includes(d.schedule.venueId))&&d.matchUpStatus!==gn);return{bookings:u==null?void 0:u.map(({eventId:d,schedule:p,matchUpFormat:h})=>{let{event:f,scheduleTiming:m}=l[d],g=f==null?void 0:f.eventType,v={...m,defaultTiming:c,matchUpFormat:h},{averageMinutes:y,recoveryMinutes:b}=pF({timingDetails:v,eventType:g}),{courtId:I,venueId:T}=p,w=sr(p.scheduledTime),S=nl(w,y);return{recoveryMinutes:b,averageMinutes:y,periodLength:a,startTime:w,courtId:I,endTime:S,venueId:T}}).filter(Boolean),relevantMatchUps:u,dateScheduledMatchUps:i}}function Z7e({calculateStartTimeFromCourts:t=!0,remainingScheduleTimes:e,defaultRecoveryMinutes:i,averageMatchUpMinutes:n,clearScheduleDates:r,tournamentRecords:a,tournamentRecord:s,periodLength:o,scheduleDate:l,startTime:c,venueIds:u,matchUps:d,endTime:p}){if(s&&!a&&(a={[s.tournamentId]:s}),typeof a!="object"||!Object.keys(a).length)return{error:Tr};o=o??l2({recoveryMinutes:i,averageMatchUpMinutes:n});let{courts:h,venues:f}=Am({dates:[l],ignoreDisabled:!0,tournamentRecords:a}),m=(h==null?void 0:h.filter(T=>!u||u.includes(T.venueId)))??[];c=c??DT({courts:m,scheduleDate:l,startTime:!0}),p=p??DT({courts:m,scheduleDate:l,endTime:!0});let{bookings:g,dateScheduledMatchUps:v}=m2({defaultRecoveryMinutes:i,averageMatchUpMinutes:n,tournamentRecords:a,scheduleDate:l,periodLength:o,venueIds:u,matchUps:d}),y={calculateStartTimeFromCourts:t,remainingScheduleTimes:e,averageMatchUpMinutes:n,clearScheduleDates:r,date:l,periodLength:o,startTime:c,bookings:g,endTime:p,courts:m},{scheduleTimes:b}=h9(y),I=(u==null?void 0:u.length)===1&&u[0]||(f==null?void 0:f.length)===1&&f[0].venueId||void 0;return{dateScheduledMatchUpIds:v==null?void 0:v.map(Bl("matchUpId")),dateScheduledMatchUps:v,scheduleTimes:b,venueId:I}}function X7e({scheduledRoundsDetails:t,greatestAverageMinutes:e,garmanSinglePass:i}){let n=[],r=[],a,s,o,l;for(let c of t.filter(Boolean))l||(l=c.hash),(c.hash===l||i)&&(r=r.concat(c.matchUpIds)),c.hash!==l&&!i&&(l=c.hash,n.push({averageMinutes:o,recoveryMinutes:s,roundPeriodLength:a,matchUpIds:r}),r=c.matchUpIds),o=i?e:c.averageMinutes,s=c.recoveryMinutes,a=c.roundPeriodLength;return r.length&&n.push({matchUpIds:r,roundPeriodLength:a,recoveryMinutes:s,averageMinutes:o}),{groupedRounds:n}}function KSe({matchUpPotentialParticipantIds:t,individualParticipantProfiles:e,scheduleCompletedMatchUps:i,containedStructureIds:n,matchUpNotBeforeTimes:r,matchUpScheduleTimes:a,matchUpDependencies:s,clearScheduleDates:o,tournamentRecords:l,periodLength:c,scheduleDate:u,useGarman:d,matchUps:p,courts:h,venues:f}){var m;let g={},v=[],y=[],b=[];for(let I of f){let{rounds:T=[],venueId:w}=I,{scheduledRoundsDetails:S,greatestAverageMinutes:U,orderedMatchUpIds:P,minutesMap:E}=nM({scheduleCompletedMatchUps:i,containedStructureIds:n,tournamentRecords:l,periodLength:c,matchUps:p,rounds:T});b.push(...P??[]);let{groupedRounds:R}=X7e({scheduledRoundsDetails:S,greatestAverageMinutes:U,garmanSinglePass:!0}),C,M=[];d&&({scheduleTimes:M,dateScheduledMatchUpIds:C}=Z7e({averageMatchUpMinutes:(m=R[0])==null?void 0:m.averageMinutes,scheduleDate:Mi(u),venueIds:[I.venueId],clearScheduleDates:o,tournamentRecords:l,periodLength:c,matchUps:p}));let _=K7e({matchUpPotentialParticipantIds:t,individualParticipantProfiles:e,dateScheduledMatchUpIds:C,greatestAverageMinutes:U,matchUpNotBeforeTimes:r,matchUpScheduleTimes:a,matchUpDependencies:s,clearScheduleDates:o,scheduleDate:u,minutesMap:E,matchUps:p});({dateScheduledMatchUpIds:C}=_);let A=_,{byeScheduledMatchUpDetails:N,clearDate:k}=_;N!=null&&N.length&&y.push(...N);let{matchUpsToSchedule:O,matchUpMap:$}=WF({matchUpPotentialParticipantIds:t,scheduleCompletedMatchUps:i,dateScheduledMatchUpIds:C,matchUpNotBeforeTimes:r,matchUpScheduleTimes:a,orderedMatchUpIds:P,clearDate:k,matchUps:p}),F=h.filter(V=>V.venueId===w);g[w]={previousRemainingScheduleTimes:[],courtsCount:F.length,greatestAverageMinutes:U,scheduledRoundsDetails:S,dateScheduledMatchUps:A,matchUpsToSchedule:O,scheduleTimes:M,groupedRounds:R,venueCourts:F,minutesMap:E,matchUpMap:$},o||v.push(...C)}return{allDateScheduledByeMatchUpDetails:y,allDateScheduledMatchUpIds:v,venueScheduledRoundDetails:g,allDateMatchUpIds:b}}function J7e(t,e){let i=sn(t.scheduleTime),n=sn(t.timeAfterRecovery),r=sn(e.scheduleTime),a=sn(e.timeAfterRecovery),s=i===r||n===a,o=i>r&&i<a,l=r>i&&r<n,c=n>r&&n<a,u=a>i&&a<n;return Zt({hasOverlap:s||o||c||l||u,startAisContained:o,endAisContained:c,startBisContained:l,endBisContained:u},!0)}function A9({individualParticipantProfiles:t,matchUpNotBeforeTimes:e,matchUpDependencies:i,scheduleTime:n,matchUp:r,details:a}){var s,o,l,c,u;let d=(((s=i==null?void 0:i[r.matchUpId])==null?void 0:s.participantIds)||[]).flat(),p=((l=(o=a==null?void 0:a.minutesMap)==null?void 0:o[r.matchUpId])==null?void 0:l.averageMinutes)||0,h=((u=(c=a==null?void 0:a.minutesMap)==null?void 0:c[r.matchUpId])==null?void 0:u.recoveryMinutes)||0,f=d.every(v=>{var y;pM({individualParticipantProfiles:t,participantId:v});let b=t[v];if(!b.timeAfterRecovery)return!0;let I=sr((y=r==null?void 0:r.schedule)==null?void 0:y.endTime),T=I?nl(I,di(h)):nl(n,di(p)+di(h));return![...Object.keys(b.potentialBookings).filter(w=>w!==r.drawId).map(w=>b.potentialBookings[w]).flat(),...b.bookings].find(w=>J7e({scheduleTime:n,timeAfterRecovery:T},w).hasOverlap)}),m=e[r.matchUpId],g=(m?cR(Xr(m),Xr(n),!1):0)>=0;return{enoughTime:f&&g}}function ZSe({autoSchedulingAudit:t,tournamentRecords:e}){var i;Ti({topic:kf,payload:t});let n=o=>o?Object.values(o).reduce((l,c)=>l+c.length||0,0):0,r=((t==null?void 0:t.schedulingProfile)||[]).reduce((o,l)=>o+l.venues.reduce((c,u)=>c+u.rounds.length,0),0),a={scheduledDatesCount:(i=t.scheduledDates)==null?void 0:i.length,noTimeMatchUpIdsCount:n(t==null?void 0:t.noTimeMatchUpIds),scheduledMatchUpIdsCount:n(t==null?void 0:t.scheduledMatchUpIds),overLimitMatchUpIdsCount:n(t==null?void 0:t.overLimitMatchUpIds),requestConflictsCount:n(t==null?void 0:t.requestConflicts),profileRoundsCount:r},s={itemType:TG,itemValue:a};for(let o of Object.values(e)){let l=o.tournamentId;xL(kf)?Ti({payload:{type:TG,tournamentId:l,detail:a},topic:kf}):XR({tournamentRecord:o,timeItem:s})}}function _9({matchUpPotentialParticipantIds:t,individualParticipantProfiles:e,matchUpDailyLimits:i={},matchUp:n}){let{enteredIndividualParticipantIds:r}=sF(n),{matchUpId:a,matchUpType:s}=n,o=(n.roundPosition&&t[a]||[]).flat(),l=Pi(r.concat(...o));return l.forEach(c=>{pM({individualParticipantProfiles:e,participantId:c})}),{participantIdsAtLimit:l.filter(c=>{let u=e[c];if(u)return[s,Vu].find(d=>{var p;let h=((p=u.counters)==null?void 0:p[d])||0,f=i[d]||0;return h&&f&&h>=f})}),relevantParticipantIds:l}}function aP({scheduleCompletedMatchUps:t=!1,scheduleByeMatchUps:e=!1,errorOnAnachronism:i=!1,checkChronology:n=!0,matchUpDependencies:r,removePriorValues:a,tournamentRecords:s,tournamentRecord:o,matchUpDetails:l,matchUpIds:c,schedule:u}){var d,p,h;if(!o)return{error:dt};if(!l&&(!c||!Array.isArray(c)))return{error:gw};if(!l&&(!u||typeof u!="object"))return{error:zge};let f,m=[],g=0;if(n&&!r){let b=od({tournamentRecords:s,tournamentRecord:o});r=b.matchUpDependencies,f=b.matchUps}f||(f=((d=Za({tournamentRecord:o}))==null?void 0:d.matchUps)??[]);let v=f.reduce((b,I)=>{let{matchUpId:T,drawId:w,matchUpStatus:S}=I;return(e||S!==gn)&&(t||!va.includes(S))&&(b[w]?b[w].push(T):b[w]=[T]),b},{}),y=l==null?void 0:l.map(b=>b.matchUpId);for(let b of Object.keys(v)){let{drawDefinition:I}=nv({tournamentRecord:o,drawId:b});if(!I)continue;let T=v[b].filter(S=>(c==null?void 0:c.includes(S))??(y==null?void 0:y.includes(S))),w=po({inContext:!1,drawDefinition:I}).matchUps;for(let S of T){let U=((p=l==null?void 0:l.find(E=>E.matchUpId===S))==null?void 0:p.schedule)||u,P=f2({schedule:U,matchUpDependencies:r,errorOnAnachronism:i,removePriorValues:a,inContextMatchUps:f,tournamentRecords:s,tournamentRecord:o,checkChronology:n,drawDefinition:I,drawMatchUps:w,matchUpId:S});if((h=P==null?void 0:P.warnings)!=null&&h.length&&m.push(...P.warnings),P!=null&&P.success&&(g+=1),P.error)return P}}return m.length?{...pe,scheduled:g,warnings:m}:{...pe,scheduled:g}}function fM(t){var e;let{scheduleCompletedMatchUps:i=!1,scheduleByeMatchUps:n=!1,errorOnAnachronism:r,matchUpContextIds:a,removePriorValues:s,tournamentRecords:o,checkChronology:l,matchUpDetails:c,schedule:u}=t;if(t.matchUpIds&&!a)return aP(t);let d=ei(t,[{[Os]:!0},{[fT]:{matchUpContextIds:!1,matchUpDetails:!1},[cc]:Ae,[Wo]:Ms}]);if(d.error)return d;if((!c||a)&&!u)return{error:si,info:"schedule is required"};let p=[],h=0,{matchUpDependencies:f}=od({tournamentRecords:o});for(let m of Object.values(o)){let{tournamentId:g}=m,v=a==null?void 0:a.filter(b=>b.tournamentId===g).map(Ca),y=c==null?void 0:c.filter(b=>(b==null?void 0:b.tournamentId)===g);if(v!=null&&v.length||y!=null&&y.length){let b=aP({matchUpDetails:y,scheduleCompletedMatchUps:i,scheduleByeMatchUps:n,matchUpDependencies:f,errorOnAnachronism:r,removePriorValues:s,tournamentRecords:o,tournamentRecord:m,checkChronology:l,matchUpIds:v,schedule:u});if((e=b.warnings)!=null&&e.length&&p.push(...b.warnings),b.scheduled&&(h+=b.scheduled),b.error)return b}}return p.length?{...pe,scheduled:h,warnings:p}:{...pe,scheduled:h}}function Q7e({schedulingProfileModifications:t,checkPotentialRequestConflicts:e,scheduleCompletedMatchUps:i,schedulingProfileIssues:n,dateSchedulingProfiles:r,containedStructureIds:a,matchUpDependencies:s,matchUpDailyLimits:o,clearScheduleDates:l,tournamentRecords:c,schedulingProfile:u,personRequests:d,periodLength:p,matchUps:h,courts:f,dryRun:m}){var g,v,y,b,I,T,w;let S={},U={},P={},E={},R={},C={},M={},_={},A={},N={};for(let $ of r){let F=Mi($==null?void 0:$.scheduleDate),V=($==null?void 0:$.venues)||[],j={},B={},z=(oe,te)=>{oe.forEach(le=>{let ne=B[le].counters;ne[te]?ne[te]+=1:ne[te]=1,ne[Vu]?ne[Vu]+=1:ne[Vu]=1})};P[F]={},E[F]={},S[F]={},U[F]={},M[F]=[],_[F]=[],A[F]=[],N[F]=[];let W={};h.forEach(oe=>{var te;(te=oe.schedule)!=null&&te.scheduledDate&&Gh(F,Mi(oe.schedule.scheduledDate))&&UT({matchUpPotentialParticipantIds:j,matchUpNotBeforeTimes:W,matchUp:oe})});let{allDateScheduledByeMatchUpDetails:Z,venueScheduledRoundDetails:K,allDateMatchUpIds:Q}=KSe({matchUpPotentialParticipantIds:j,individualParticipantProfiles:B,scheduleCompletedMatchUps:i,containedStructureIds:a,matchUpNotBeforeTimes:W,matchUpScheduleTimes:C,matchUpDependencies:s,clearScheduleDates:l,tournamentRecords:c,useGarman:!0,periodLength:p,scheduleDate:F,matchUps:h,courts:f,venues:V}),J=10,se=0,ie,ce=10;for(;!ie;){for(let{venueId:oe}of V){let te=0,le=K[oe];for(;le.courtsCount&&(g=le.scheduleTimes)!=null&&g.length&&(v=le.matchUpsToSchedule)!=null&&v.length&&te<=le.courtsCount;){let{scheduleTime:ne,attempts:me=0}=le.scheduleTimes.shift(),be=le.matchUpsToSchedule.find(Se=>{var we,ze;let{matchUpId:Qe,matchUpType:ke}=Se,{participantIdsAtLimit:yt,relevantParticipantIds:lt}=_9({matchUpPotentialParticipantIds:j,individualParticipantProfiles:B,matchUpDailyLimits:o,matchUp:Se});if(yt.length)return _[F].includes(Qe)||_[F].push(Qe),!1;let{scheduledDependent:Ct}=YSe({matchUpScheduleTimes:C,matchUpDependencies:s,scheduleTime:ne,matchUpId:Qe,details:le});if(Ct)return!1;let{dependenciesScheduled:Nt,remainingDependencies:Ce}=M9({matchUpScheduleTimes:C,matchUpDependencies:s,allDateMatchUpIds:Q,matchUp:Se});if(!Nt)return E[F][Qe]||(E[F][Qe]=[]),E[F][Qe].push({scheduleTime:ne,remainingDependencies:Ce}),!1;let{enoughTime:Ge}=A9({individualParticipantProfiles:B,matchUpNotBeforeTimes:W,matchUpDependencies:s,scheduleTime:ne,details:le,matchUp:Se});if(!Ge)return P[F][Qe]||(P[F][Qe]=[]),P[F][Qe].push({scheduleTime:ne}),!1;let $e=le.greatestAverageMinutes,{conflicts:at}=N9({potentials:e,averageMatchUpMinutes:$e,requestConflicts:N,personRequests:d,scheduleTime:ne,scheduleDate:F,matchUp:Se});if(at!=null&&at.length)return R[F]||(R[F]=[]),R[F].push(...at),!1;z(lt,ke);let ct=(ze=(we=le.minutesMap)==null?void 0:we[Qe])==null?void 0:ze.recoveryMinutes;return rP({matchUpPotentialParticipantIds:j,individualParticipantProfiles:B,matchUpNotBeforeTimes:W,averageMatchUpMinutes:$e,matchUpDependencies:s,recoveryMinutes:ct,scheduleTime:ne,matchUp:Se}),C[Qe]=ne,!0});le.matchUpsToSchedule=le.matchUpsToSchedule.filter(({matchUpId:Se})=>Se!==(be==null?void 0:be.matchUpId)),be?te+=1:(U[F][oe]||(U[F][oe]=[]),U[F][oe].push({scheduleTime:ne,attempts:me+1}))}(y=le.matchUpsToSchedule)!=null&&y.length&&(U[F][oe]=(b=U[F][oe])==null?void 0:b.filter(ne=>{let me=ne.attempts<J;return me&&le.scheduleTimes.push(ne),!me})),(!((I=le.scheduleTimes)!=null&&I.length)||!((T=le.matchUpsToSchedule)!=null&&T.length))&&(le.complete=!0)}se+=1,ie=V.every(({venueId:oe})=>K[oe].complete)||se===ce}for(let{venueId:oe}of V){let te=K[oe].matchUpMap;Object.keys(te).forEach(le=>{let ne=c[le];ne&&Object.keys(te[le]).forEach(me=>{let{drawDefinition:be}=nv({tournamentRecord:ne,drawId:me});be&&te[le][me].forEach(({matchUpId:Se})=>{let we=C[Se];if(we){let ze=we.split(":").map(Fc).join(":"),Qe=`${Mi(F)}T${ze}`;m?M[F].push(Se):(rv({drawDefinition:be,scheduledTime:Qe,matchUpId:Se}).success&&M[F].push(Se),oe&&o1({tournamentRecord:ne,drawDefinition:be,matchUpId:Se,venueId:oe}))}})})}),A[F]=K[oe].matchUpsToSchedule.map(Ca),S[F][oe]=K[oe].scheduleTimes.sort((le,ne)=>sn(le.scheduleTime)-sn(ne.scheduleTime))}!m&&Z!=null&&Z.length&&fM({matchUpDetails:Z,scheduleByeMatchUps:!0,removePriorValues:!0,tournamentRecords:c,schedule:{scheduledDate:"",scheduledTime:"",courtOrder:"",courtId:"",venueId:""}});for(let oe of $.venues)for(let te of oe.rounds){let le=(((w=te.matchUps)==null?void 0:w.map(({matchUpId:me})=>me))||[]).filter(me=>M[F].includes(me));te.canScheduledMatchUpIds=le;let ne=Math.round(le.length/te.matchUpsCount*1e4)/100;(ne===1/0||isNaN(ne))&&(ne=0),te.possibleToSchedulePct=ne,te.matchUpsCount===le.length&&(te.possibleToSchedule=!0)}}let k=r.map(({scheduleDate:$})=>$),O={timeStamp:Date.now(),overLimitMatchUpIds:_,scheduledMatchUpIds:M,schedulingProfile:u,noTimeMatchUpIds:A,requestConflicts:N,scheduledDates:k};return ZSe({tournamentRecords:c,autoSchedulingAudit:O}),{...pe,schedulingProfileModifications:t,schedulingProfileIssues:n,scheduleTimesRemaining:S,dateSchedulingProfiles:r,skippedScheduleTimes:U,recoveryTimeDeferredMatchUpIds:P,dependencyDeferredMatchUpIds:E,matchUpScheduleTimes:C,overLimitMatchUpIds:_,scheduledMatchUpIds:M,noTimeMatchUpIds:A,requestConflicts:N,scheduledDates:k}}function kJ({averageMinutes:t,startTime:e,endTime:i,court:n,date:r}){if(!Array.isArray(n.dateAvailability))return{error:si,stack:"getEarliestCourtTime"};let a=DT({scheduleDate:r,courts:[n],startTime:!0}),s=DT({scheduleDate:r,courts:[n],endTime:!0});e=e||a,i=i||s;let o=cM({court:n,date:r}),{timeSlots:l}=a1({courtDate:o}),c=Xr(e),u=Xr(i);return{earliestCourtTime:l==null?void 0:l.reduce((d,p)=>{let h=Xr(p.startTime),f=Xr(p.endTime);if(h>u||f<c)return d;let m=c>h?c:h;if(cR(m,f)>=t){let g=sr(m.toISOString());(!d||g<d)&&(d=g)}return d},void 0),courtStartTime:a,courtEndTime:s}}function e9e({schedulingProfileModifications:t,checkPotentialRequestConflicts:e,scheduleCompletedMatchUps:i,schedulingProfileIssues:n,dateSchedulingProfiles:r,containedStructureIds:a,matchUpDependencies:s,matchUpDailyLimits:o,clearScheduleDates:l,tournamentRecords:c,periodLength:u=30,schedulingProfile:d,personRequests:p,matchUps:h=[],courts:f,dryRun:m}){var g,v;let y={},b={},I={},T={},w={},S={},U={},P={},E={};for(let M of r??[]){let _=Mi(M==null?void 0:M.scheduleDate),A=(M==null?void 0:M.venues)||[],N={},k={},O=(oe,te)=>{oe.forEach(le=>{let ne=k[le].counters;ne[te]?ne[te]+=1:ne[te]=1,ne[Vu]?ne[Vu]+=1:ne[Vu]=1})};y[_]={},b[_]={},S[_]=[],U[_]=[],P[_]=[],E[_]=[];let $={};h==null||h.forEach(oe=>{var te;(te=oe.schedule)!=null&&te.scheduledDate&&Gh(_,Mi(oe.schedule.scheduledDate))&&UT({matchUpPotentialParticipantIds:N,matchUpNotBeforeTimes:$,matchUp:oe})});let{allDateScheduledByeMatchUpDetails:F,allDateScheduledMatchUpIds:V,venueScheduledRoundDetails:j,allDateMatchUpIds:B}=KSe({matchUpPotentialParticipantIds:N,individualParticipantProfiles:k,scheduleCompletedMatchUps:i,containedStructureIds:a,matchUpNotBeforeTimes:$,matchUpScheduleTimes:w,matchUpDependencies:s,clearScheduleDates:l,tournamentRecords:c,periodLength:u,scheduleDate:_,matchUps:h,courts:f,venues:A}),z=h==null?void 0:h.filter(({matchUpId:oe})=>V.includes(oe)),{bookings:W}=m2({dateScheduledMatchUps:z,tournamentRecords:c,scheduleDate:_,periodLength:u}),{virtualCourts:Z}=o2({scheduleDate:_,periodLength:u,bookings:W,courts:f}),K=Z==null?void 0:Z.reduce((oe,te)=>{let{earliestCourtTime:le,courtEndTime:ne}=kJ({date:_,averageMinutes:0,court:te});return(!oe.startTime||Xr(le)<Xr(oe.startTime))&&(oe.startTime=le),(!oe.endTime||Xr(ne)>Xr(oe.endTime))&&(oe.endTime=ne),oe},{}),Q=K.startTime,J=({courtId:oe,booking:te})=>{var le;return(le=Z==null?void 0:Z.find(ne=>ne.courtId===oe))==null?void 0:le.dateAvailability[0].bookings.push(te)},se=10,ie=0,ce;for(;!ce;){for(let{venueId:oe}of A){let te=j[oe],le=te.matchUpsToSchedule.length,ne=[],me=[],be,Se=0;for(;!be;){for(let we of te.matchUpsToSchedule){if(me.length===te.courtsCount||ne.length===te.courtsCount){be=!0;break}let{matchUpId:ze,matchUpType:Qe}=we,{participantIdsAtLimit:ke,relevantParticipantIds:yt}=_9({matchUpPotentialParticipantIds:N,individualParticipantProfiles:k,matchUpDailyLimits:o,matchUp:we});if(ke.length){U[_].includes(ze)||U[_].push(ze);continue}let{dependenciesScheduled:lt,remainingDependencies:Ct}=M9({matchUpScheduleTimes:w,matchUpDependencies:s,allDateMatchUpIds:B,matchUp:we});if(!lt){b[_][ze]||(b[_][ze]=[]),b[_][ze].push({remainingDependencies:Ct});continue}let Nt=[],Ce=Z==null?void 0:Z.reduce((Ge,$e)=>{var at,ct,Vt,Me;if(me.includes($e.courtId))return Ge;let{earliestCourtTime:De}=kJ({averageMinutes:te.greatestAverageMinutes,startTime:Q,date:_,court:$e});if(Ge.scheduleTime&&sn(De)>=sn(Ge.scheduleTime))return Ge;let{scheduledDependent:Je}=YSe({matchUpScheduleTimes:w,matchUpDependencies:s,scheduleTime:De,matchUpId:ze,details:te});if(Je)return Ge;let{enoughTime:St}=A9({individualParticipantProfiles:k,matchUpNotBeforeTimes:$,matchUpDependencies:s,scheduleTime:De,details:te,matchUp:we});if(!St)return y[_][ze]||(y[_][ze]=[]),y[_][ze].includes(De)||y[_][ze].push(De),Ge;let bt=((ct=(at=te.minutesMap)==null?void 0:at[ze])==null?void 0:ct.averageMinutes)||te.greatestAverageMinutes,{conflicts:Ie}=N9({potentials:e,averageMatchUpMinutes:bt,requestConflicts:E,personRequests:p,scheduleTime:De,scheduleDate:_,matchUp:we});if(Ie!=null&&Ie.length)return Nt.push(...Ie),!1;O(yt,Qe);let Ue=(Me=(Vt=te.minutesMap)==null?void 0:Vt[ze])==null?void 0:Me.recoveryMinutes;return rP({matchUpPotentialParticipantIds:N,individualParticipantProfiles:k,matchUpNotBeforeTimes:$,averageMatchUpMinutes:bt,matchUpDependencies:s,recoveryMinutes:Ue,scheduleTime:De,matchUp:we}),(!Ge.scheduleTime||sn(De)<sn(Ge.scheduleTime))&&(Ge.averageMatchUpMinutes=bt,Ge.recoveryMinutes=Ue,Ge.scheduleTime=De,Ge.courtName=$e.courtName,Ge.courtId=$e.courtId),Ge},{});if(Ce.scheduleTime){let{averageMatchUpMinutes:Ge,recoveryMinutes:$e,scheduleTime:at,courtId:ct}=Ce;w[ze]=at,T[ze]=ct,ne.push(ze),me.push(ct);let Vt=at,Me=nl(Vt,Ge);J({courtId:ct,booking:{averageMatchUpMinutes:Ge,recoveryMinutes:$e,periodLength:u,matchUpId:ze,startTime:Vt,courtId:ct,endTime:Me,venueId:oe}}),te.matchUpsToSchedule=te.matchUpsToSchedule.filter(De=>De.matchUpId!==ze)}else Nt!=null&&Nt.length&&(I[_]||(I[_]=[]),I[_].push(...Nt))}(me.length===te.courtsCount||ne.length===te.courtsCount||!te.matchUpsToSchedule.length)&&(be=!0),te.matchUpsToSchedule.length&&ne<te.courtsCount&&(Xr(Q)<Xr(K.endTime)?Q=nl(Q,u):(be=!0,te.complete=!0)),Se+=1,!be&&Se>=le&&(be=!0)}(g=te.matchUpsToSchedule)!=null&&g.length||(te.complete=!0)}ie+=1,ce=A.every(({venueId:oe})=>j[oe].complete)||ie===se}for(let{venueId:oe}of A){let te=j[oe].matchUpMap;Object.keys(te).forEach(le=>{let ne=c[le];ne&&Object.keys(te[le]).forEach(me=>{let{drawDefinition:be}=nv({tournamentRecord:ne,drawId:me});be&&te[le][me].forEach(({matchUpId:Se})=>{let we=w[Se],ze=T[Se];if(we){let Qe=we.split(":").map(Fc).join(":"),ke=`${Mi(_)}T${Qe}`;m||(rv({drawDefinition:be,scheduledTime:ke,matchUpId:Se}),Gw({courtDayDate:_,tournamentRecords:c,tournamentRecord:ne,drawDefinition:be,matchUpId:Se,courtId:ze})),S[_].push(Se)}})})}),P[_]=j[oe].matchUpsToSchedule.map(Ca)}!m&&F!=null&&F.length&&fM({matchUpDetails:F,scheduleByeMatchUps:!0,removePriorValues:!0,tournamentRecords:c,schedule:{scheduledDate:"",scheduledTime:"",courtOrder:"",courtId:"",venueId:""}});for(let oe of M.venues)for(let te of oe.rounds){let le=(v=(te.matchUps??[]).map(({matchUpId:me})=>me))==null?void 0:v.filter(me=>S[_].includes(me));te.canScheduledMatchUpIds=le;let ne=Math.round(((le==null?void 0:le.length)||0)/te.matchUpsCount*1e4)/100;(ne===1/0||isNaN(ne))&&(ne=void 0),te.possibleToSchedulePct=ne,te.matchUpsCount===(le==null?void 0:le.length)&&(te.possibleToSchedule=!0)}}let R=(r??[]).map(({scheduleDate:M})=>M),C={timeStamp:Date.now(),overLimitMatchUpIds:U,scheduledMatchUpIds:S,schedulingProfile:d,noTimeMatchUpIds:P,requestConflicts:E,scheduledDates:R};return ZSe({tournamentRecords:c,autoSchedulingAudit:C}),{...pe,schedulingProfileModifications:t,schedulingProfileIssues:n,dateSchedulingProfiles:r,recoveryTimeDeferredMatchUpIds:y,dependencyDeferredMatchUpIds:b,matchUpScheduleTimes:w,overLimitMatchUpIds:U,scheduledMatchUpIds:S,noTimeMatchUpIds:P,requestConflicts:E,scheduledDates:R}}function g2(t){let{scheduleAttributes:e=["scheduledDate","scheduledTime","courtOrder"],ignoreMatchUpStatuses:i=va,scheduledDates:n,venueIds:r}=t,a=au(t),s=tn(a)?Object.values(a).map(({tournamentId:l})=>l).filter(Boolean):[];if(!(s!=null&&s.length))return{error:Tr};let o=0;for(let l of s){let c=a[l],u=t9e({ignoreMatchUpStatuses:i,scheduleAttributes:e,tournamentRecord:c,scheduledDates:n,venueIds:r});if(u.error)return u;o+=u.clearedScheduleCount??0}return{...pe,clearedScheduleCount:o}}function t9e({scheduleAttributes:t=["scheduledDate","scheduledTime","courtOrder"],ignoreMatchUpStatuses:e=va,tournamentRecord:i,scheduledDates:n,venueIds:r=[]}){if(typeof i!="object")return{error:dt};if(!Array.isArray(e)||!Array.isArray(r))return{error:Ae};r.length&&t.push("venueId");let a=Za({matchUpFilters:{scheduledDates:n},tournamentRecord:i}).matchUps??[],s={};a.forEach(({matchUpStatus:c,schedule:u,drawId:d,matchUpId:p})=>{(!c||!e.includes(c))&&aM({schedule:u,scheduleAttributes:t})&&(!(r!=null&&r.length)||r.includes(u.venueId))&&(s[d]||(s[d]=[]),s[d].push(p))});let o=i.tournamentId,l=0;for(let c in s){let{event:u,drawDefinition:d}=zo({tournamentRecord:i,drawId:c}),p=po({drawDefinition:d,matchUpFilters:{matchUpIds:s[c]}}).matchUps??[];for(let h of p){let f=!1;h.timeItems=(h.timeItems??[]).filter(m=>{let g=(m==null?void 0:m.itemType)&&![Yh,Dg,Cw,uF,Rw,Mw].includes(m==null?void 0:m.itemType);return g||(f=!0),g}),f&&(Qi({context:"clear schedules",eventId:u==null?void 0:u.eventId,drawDefinition:d,tournamentId:o,matchUp:h}),l+=1)}}return{...pe,clearedScheduleCount:l}}function v2(t){let{checkPotentialRequestConflicts:e=!0,scheduleCompletedMatchUps:i,clearScheduleDates:n,scheduleDates:r=[],tournamentRecords:a,periodLength:s,useGarman:o,dryRun:l,pro:c}=t,u=ei(t,[{[Os]:!0},{[ps]:P=>!P||Array.isArray(P)&&P.every(Cl),[hye]:!1,[Wo]:Ms}]);if(u.error)return u;let d=_m({tournamentRecords:a});if(d.error)return d;if(!d.schedulingProfile.length)return{...pe};let{modifications:p,issues:h=[],schedulingProfile:f=[]}=d,m=Object.assign({},...Object.values(a).map(P=>zU({tournamentRecord:P}).containedStructures)),g=r.map(P=>{if(Cl(P))return Mi(P)}).filter(Boolean),v=f.map(P=>P.scheduleDate).map(P=>Cl(P)&&Mi(P)).filter(P=>P&&(!r.length||g.includes(P)));if(!v.length)return{error:wge};if(n&&!l){let P=Array.isArray(n)?n:[];g2({tournamentRecords:a,scheduledDates:P})}let y=Am({ignoreDisabled:!1,tournamentRecords:a}).courts,{matchUps:b}=Fd({matchUpFilters:{matchUpTypes:[On,Nn]},afterRecoveryTimes:!0,nextMatchUps:!0,tournamentRecords:a}),{matchUpDependencies:I}=od({includeParticipantDependencies:!0,tournamentRecords:a,matchUps:b}),{matchUpDailyLimits:T}=i2({tournamentRecords:a}),{personRequests:w}=ob({requestType:hM,tournamentRecords:a}),S=f.filter(P=>{let E=Mi(P==null?void 0:P.scheduleDate);return v.includes(E)}).sort((P,E)=>new Date(P.scheduleDate).getTime()-new Date(E.scheduleDate).getTime()),U={schedulingProfileModifications:p,checkPotentialRequestConflicts:e,scheduleCompletedMatchUps:i,schedulingProfileIssues:h,dateSchedulingProfiles:S,containedStructureIds:m,matchUpDependencies:I,matchUpDailyLimits:T,clearScheduleDates:n,tournamentRecords:a,schedulingProfile:f,personRequests:w,periodLength:s,useGarman:o,matchUps:b,dryRun:l,courts:y};return c?e9e(U):Q7e(U)}function y2(t){let{tournamentRecord:e,tournamentRecords:i,activeTournamentId:n,...r}=t||{};return r.tournamentId||(r.tournamentId=bn()),r.startDate&&!hy(r.startDate)&&!x_.test(r.startDate)?{error:Va}:r.endDate&&!hy(r.endDate)&&!x_.test(r.endDate)?{error:Va}:(r.extensions&&(r.extensions=r.extensions.filter(Op)),{...r})}function k9({addParticipants:t=!0,participantAttribute:e,tournamentRecord:i,personAttribute:n,teamNames:r,accessor:a,uuids:s}){var o,l;if(!i)return{error:dt};let c={},u=(i.participants??[]).filter(({participantType:g,participantRole:v})=>g===Hi&&v===vs),d=0;for(let g of u){let v=a&&((o=Kb({element:g,accessor:a}))==null?void 0:o.value)||n&&((l=g.person)==null?void 0:l[n])||e&&g[e];if(v){if(!Object.keys(c).includes(v)){c[v]={participantName:(r==null?void 0:r[d])??v,participantId:(s==null?void 0:s.pop())??bn(),individualParticipantIds:[],participantRole:vs,participantType:Pn};let y={value:n??e,name:Wj};pn({element:c[v],extension:y}),d+=1}c[v].individualParticipantIds.push(g.participantId)}}let p=Object.keys(c),h=(i.participants??[]).map(g=>{if(g.participantType!==Pn||g.participantRole!==vs)return;let{extension:v}=xi({name:Wj,element:g}),y=v==null?void 0:v.value;if(p.includes(y))return g.participantId}).filter(Boolean),f=0,m=[];return Object.keys(c).forEach(g=>{let v=c[g],{participantId:y}=v;h.includes(y)||(i.participants||(i.participants=[]),t&&i.participants.push(v),m.push(v),f++)}),t&&f?(Ti({payload:{tournamentId:i.tournamentId,participants:m},topic:Sg}),{...pe,participantsAdded:f}):m.length?{...pe,newParticipants:m}:{error:VHe}}var i9e=[{AA:"Annexia"},{BA:"Bacteria"},{BO:"Borduria"},{BM:"Bensalem"},{BS:"Basenji"},{BI:"Balnibarbi"},{BV:"Bartovia"},{BZ:"Berzerkistan"},{CA:"Caldonia"},{CC:"Concordia"},{CH:"Chula"},{DA:"Deltora"},{DW:"Discworld"},{EA:"Eastasia"},{EP:"Ecotopia"},{ER:"Erewhon"},{FA:"Freedonia"},{FN:"Florin"},{FG:"Fogg"},{FK:"Fourecks"},{GA:"Genovia"},{GL:"Gilead"},{GD:"Gilead"},{GL:"Gondal"},{GO:"Gondor"},{GR:"Gruzinia"},{GT:"Goritania"},{GU:"Guilder"},{HA:"Heldscalla"},{HO:"Hidalgo"},{IL:"Illyria"},{KA:"Kinakuta"},{KG:"Kangan"},{KN:"Kreplachistan"},{KS:"Kallipolis"},{LH:"Lugash"},{LI:"Listenbourg"},{LT:"Lilliput"},{LU:"Luggnagg"},{LV:"Lichtenslava"},{MR:"Moher"},{NA:"Narnia"},{NV:"Novaria"},{OA:"Oceania"},{OS:"Orsinia"},{OV:"Octavia"},{PA:"Palombia"},{PG:"Penguina"},{QA:"Qasha"},{PM:"Panem"},{SA:"Solymbria"},{SD:"Syldavia"},{SG:"San Glucose"},{SL:"San Lorenzo"},{SR:"Sontar"},{SY:"Sylvania"},{TF:"Tralfamadore"},{TH:"Themyscira"},{UA:"Utopia"},{VA:"Vespugia"},{WA:"Wakanda"},{WX:"Wessex"},{ZA:"Zamunda"},{ZK:"Zubrowka"}],n9e=["Amber","Ansul","Atlantis","Braavos","Busytown","Castle Rock","Centralia","Coober Pedy","Chefchaouen","Chronopolis","Damanhur","Diaspar","Dictionopolis","Diomira","El Dorado","Elista","Ephesus","Gotham","Hadleyburg","Hallstatt","Hierusalem","Ilium","Inverness","Kowloon","Laputa","Longyearbyen","Lys","Matmata","Maycomb","Metropolis","Miyake-jima","Monowi","Nagoro","Navarre","New New York","Nimbin","Pemberley","Pseudopolis","Rivendell","Roswell","Shangri-La","Springfield","Supilinn","Thneedville","Trantor","Wobegon","Yonwood","Xanadu","Xylar","Zion"];function XSe({count:t=1,participantsCount:e=32}={}){let i=co(n9e),n=i.slice(0,t);return{cities:Mt(0,e).map(r=>r<Math.min(t,i.length)?n[r]:Cu(n))}}function JSe({count:t=1,participantsCount:e=32}={}){let i=co(i9e),n=i.slice(0,t).map(r=>Object.keys(r)).flat();return{states:Mt(0,e).map(r=>r<Math.min(t,i.length)?n[r]:Cu(n))}}function QSe({count:t=1,participantsCount:e=32}={}){let i=Mt(0,t).map(()=>Mt(0,5).map(()=>kc(0,9)).join(""));return{postalCodes:Mt(0,e).map(n=>n<t?i[n]:Cu(i))}}function lk({idPrefix:t,participantType:e,index:i,uuids:n}){let r=ur(e)?e[0]:"X";return t?`${t}-${r}-${i}`:(n==null?void 0:n.pop())||bn()}function eTe(t){let{cities:e,states:i,postalCodes:n,nationalityCode:r,participantIndex:a}=t;return{postalCode:n==null?void 0:n[a],state:i==null?void 0:i[a],city:e==null?void 0:e[a],countryCode:r}}var r9e={lastNames:["Abbey","Ahern","Ampleforth","Ananiadis","Andelic","Assange","Atreides","Austen","Bach","Banks","Barrington","Batty","Bauers","Beals","Beer","Bennett","Berry","Bonaparte","Brewer","Brockovich","Bukowski","Cassidy","Catton","Calvino","Carlin","Carson","Chip","Constant","Crane","Crowne","Cummings","Curie","Dallas","Diamond","Deckard","Drazic","Dunbar","Earhart","Eisenstein","Eldritch","Elliot","Ellul","Escher","Eyre","Faulkner","Fulcher","Fukuoka","Godel","Goldstein","Greer","Hedges","Herbert","Holmgren","Humperdinck","Huxley","Illich","Jeffers","Jensen","Jevons","Johnson","Johnstone","Jovovich","Kingsnorth","Langer","Fernwright","Fuller","Le Guin","Lem","Lovelace","Mander","McLuhan","Midgely","Mond","Montoya","Moore","Murry","Nagle","Nearing","Ogden","Ophuls","Parks","Paz","Peet","Perfect","Pendejo","Pevensie","Postman","Ripley","Rodda","Rumfoord","Runciter","Rugen","Sale","Schumacher","Shaftoe","Shelley","Shepard","Smith","Stratton","Stewart","Swift","Tillich","Turing","Tyrell","Twain","Yeats","Veblen","Yates","Vonnegut","Waterhouse","Watson","Wolin","Wirt","Waschuk","Wormwood"],firstFemale:["Ada","Amelia","Amelie","America","Anne","Antonia","Aravis","Astrid","Beatrice","Brienne","Buttercup","Caitlin","Cimorene","Cordelia","Desdemona","Ellen","Elizabeth","Emily","Emmie","Erin","Eva","Evelyn","Heather","Helen","Hermia","Hypatia","Imogen","Jane","Jasmine","Juliana","Juliet","Katniss","Leeloo","Lenina","Lilith","Linda","Lizzie","Louise","Lucy","Marie","Mary","Martha","Matilda","Milla","Miranda","Meg","Melba","Nicole","Ola","Portia","Pris","Rachael","Rachel","Rebecca","River","Rosa","Rosalind","Scout","Sharn","Susanne","Titania","Uhura","Ursula","Valentina","Viola","Virginia","Xena","Zoe"],firstMale:["Alan","Aldous","August","Axel","Barda","Barry","Bill","Bruce","Charles","Chris","Constantine","Darwin","David","Derrick","Edward","Emmanuel","Ernst","Estlin","Fezzik","Filby","Frank","Frito","George","Glen","Helmholtz","Inigo","Italo","Ivan","Jacques","James","Jared","Jerry","Joe","Johann","Julian","John Michael","Jonathan","Korben","Kirkpatrick","Kurt","Lief","Malachi","Mark","Marhsall","Masanobu","Maurits","Michael","Mustapha","Neil","Nikola","Octavio","Palmer","Paul","Pierre","Robinson","Rick","Rincewind","Roy","Shannon","Sheldon","Stafford","Stanislaw","Stanley","Syme","Thorstein","Thomas","Tyrone","Vizzini","Walton","Walker","Warren","Wendell","Westley","William","Winston","Zoran"]};function tB(t){let{count:e=100,sex:i}=t||{};if(!e||i&&![Rn,Kn].includes(i))return{personData:[],error:Ae};let n=Math.ceil(e*1.3),{lastNames:r,firstFemale:a,firstMale:s}=r9e,o=ag.map(({iso:m})=>m).filter(Boolean),l=Math.ceil(n/r.length),c=Math.ceil(n/a.length),u=Math.ceil(n/s.length),d=Mt(0,l).flatMap(()=>{let m=$t(r,!1,!0);return Mt(0,r.length).map(()=>Ul(m))}),p=Mt(0,c).flatMap(()=>{let m=$t(a,!1,!0);return Mt(0,a.length).map(()=>Ul(m))}),h=Mt(0,u).flatMap(()=>{let m=$t(s,!1,!0);return Mt(0,s.length).map(()=>Ul(m))}),f={};for(let m=0;m<n;m++){let g=d.pop(),v=i||Cu([Rn,Kn]),y=v===Rn?h.pop():p.pop(),b=Cu(o);f[`${y}${g}`]={nationalityCode:b,sex:v,firstName:y,lastName:g}}return{personData:Object.values(f).slice(0,e)}}function tTe(t){let e=(t==null?void 0:t.count)||1,{personExtensions:i,consideredDate:n,isMock:r=!0,gendersCount:a,personData:s,category:o,sex:l}=t||{};if(isNaN(e))return{error:Ae};let c=(a==null?void 0:a[Rn])||l===Rn&&e||0,u=(a==null?void 0:a[Kn])||l===Kn&&e||0;e=Math.max(e,c+u);let d=e-(c+u),p=c&&tB({count:c,sex:Rn}).personData||[],h=u&&tB({count:u,sex:Kn}).personData||[],f=[...p,...h,...d&&tB({count:d}).personData||[]],m=f.filter(U=>!l||c&&u||U.sex===l),g=[];if(Array.isArray(s)){let U=s.filter(P=>typeof P.firstName!="string"||typeof P.lastName!="string"||P.sex&&![Rn,Kn].includes(P.sex)||P.nationalityCode&&(typeof P.nationalityCode!="string"||P.nationalityCode.length>3||!ag.find(({iso:E,ioc:R})=>[E,R].includes(P.nationalityCode)))?!1:(P.nationalityCode&&g.push(P.nationalityCode),!0));if(U.length)m=U;else return{error:Ae}}let v=s?m:co(m);if(v.length<e){let{maleFirstNames:U,maleLastNames:P,femaleFirstNames:E,femaleLastNames:R,nationalityCodes:C}=f.reduce((M,_)=>{let{firstName:A,lastName:N,nationalityCode:k}=_;return _.sex===Rn?(M.maleFirstNames.includes(A)||M.maleFirstNames.push(A),M.maleLastNames.includes(N)||M.maleLastNames.push(N)):(M.femaleFirstNames.includes(A)||M.femaleFirstNames.push(A),M.femaleLastNames.includes(N)||M.femaleLastNames.push(N)),M.nationalityCodes.includes(k)||M.nationalityCodes.push(k),M},{maleFirstNames:[],maleLastNames:[],femaleFirstNames:[],femaleLastNames:[],nationalityCodes:[]});Mt(0,e-v.length).forEach(()=>{let M=l||Cu([Rn,Kn]),_=Cu(C),A=Cu(M===Rn?U:E),N=Cu(M===Rn?P:R),k={firstName:A,lastName:N,sex:M,nationalityCode:_};v.push(k)})}let{ageMinDate:y,ageMaxDate:b}=SI({consideredDate:n,category:o}),I=di((y==null?void 0:y.slice(0,4))||0)||di((b==null?void 0:b.slice(0,4))||0)-3,T=di((b==null?void 0:b.slice(0,4))||0)||di((y==null?void 0:y.slice(0,4))||0)+3,w=(y||b)&&[I,T],S=v.slice(0,e).map((U,P)=>{let[E,R]=w||[],C=w&&Ul(Mt(E,R)),M=Ul(Mt(0,365)),_=C&&xze(C,M);return Object.assign(Zt({extensions:i||[{name:"regionCode",value:P+1}],birthDate:_,isMock:r}),U)});return{persons:S.length&&S||v[0],nationalityCodes:g}}var a9e=["Ace Academy","Avengers","Ball Bouncers","Baseliners","Captivators","Civil Disobedients","Continentals","Court Royal","Court Sharks","Diamond Dogs","Danger Zone","Doubles Dominators","Double Faults","Tricksters","Eliminators","Court Crusaders","Fuzz Busters","Game Changers","Goal Gurus","Good Volley","Green Machine","Hawk Eyes","Inside Outers","Killer Instinct","Line Toers","Masters of Mayhem","Matter Catchers","Cheap Shot","Mean Machines","Mindspace Invaders","Net Centric","Net Positive","Smash Mullet","Over Your Head","Spin Meisters","Aggressors","Racket Machine","Slice Happy","Refs Nightmare","Sandeaters","Sun Seekers","Slicer Dicers","Stacked Deck","Cross Stringers","The Emergence","Total Demolition","Touch and Go","Unreturnables","Upside Downers","Vertically Challenged","Visual Spectacle"];function ck({nameRoot:t="TEAM",count:e=1}={}){let i=co(a9e).slice(0,e);return i.length<e&&Mt(0,e-i.length).forEach(n=>i.push(`${t} ${n+1}`)),{names:i}}function l1(t){let{scaledParticipantsCount:e,rankingRange:i}=t,{ratingsParameters:n=Ea,valuesInstanceLimit:r,ratingsValues:a=[],consideredDate:s,categories:o,category:l,nationalityCodesCount:c,nationalityCodeType:u,nationalityCodes:d,participantsCount:p=32,participantType:h,teamSize:f=8,personIds:m,idPrefix:g,uuids:v,personExtensions:y,addressProps:b,gendersCount:I,matchUpType:T,personData:w,sex:S,inContext:U,withISO2:P,withIOC:E,scaleAllParticipants:R}=t,C=h===Ai||T===py,M=h===Pn||T===Pn;i&&(!Array.isArray(i)||!i.every(ke=>Er(ke))||i.length!==2)&&(i=void 0),e=R?p:e;let _=1e3,A=e&&e>_?e:_;i=i||[1,A],i[1]+=1;let N=p*(C&&2||M&&(f??8)||1),k=tTe({count:N,personExtensions:y,consideredDate:s,gendersCount:I,personData:w,category:l,sex:S});if(k.error)return k;let{nationalityCodes:O,persons:$}=k,F={},V={},j={},B={},z=ke=>{Object.assign(F,ke.doublesRankings),Object.assign(V,ke.singlesRankings),Object.assign(B,ke.doublesRatings),Object.assign(j,ke.singlesRatings)};if(tn(l)){let ke=xJ({scaledParticipantsCount:e,ratingsParameters:n,participantType:h,ratingsValues:a,rankingRange:i,category:l});z(ke)}Array.isArray(o)&&o.forEach(ke=>{let yt=xJ({scaledParticipantsCount:e,ratingsParameters:n,participantType:h,ratingsValues:a,rankingRange:i,category:ke});z(yt)});let W=ag.filter(ke=>u==="IOC"&&ke.ioc||ke.iso);function Z(ke){let yt=Math.ceil(N/ke);return r&&yt>r?Math.ceil(N/r):ke}let{postalCodesProfile:K,postalCodesCount:Q,statesProfile:J,citiesProfile:se,citiesCount:ie,statesCount:ce}=b||{},oe=ke=>Object.keys(ke).map(yt=>Mt(0,J[yt]).map(()=>yt)).flat(),te=se&&oe(se)||(b==null?void 0:b.cities)||XSe({count:ie||N,participantsCount:N}).cities,le=J&&oe(J)||(b==null?void 0:b.states)||JSe({count:ce||N,participantsCount:N}).states,ne=K&&oe(K)||(b==null?void 0:b.postalCodes)||QSe({count:Q||N,participantsCount:N}).postalCodes,me={cities:te,states:le,postalCodes:ne},be=Z(c),Se=be?co(W).slice(0,c):d&&W.filter(ke=>d.includes(ke.iso))||W,we=co(Mt(0,Math.ceil(N/(be||1))).map(()=>Se).flat(1/0)),ze=ck({count:p}).names;return{participants:Mt(0,p).map(ke=>{let yt=C&&2||M&&(f??8)||1,lt=Mt(0,yt).map($e=>{let at=ke*yt+$e;return Qe(at)}),Ct=lt.map($e=>$e.participantId),Nt=lt.map($e=>$e.person.standardFamilyName).join("/"),Ce=C?Ai:Pn,Ge={participantId:lk({participantType:Ce,index:ke,idPrefix:g,uuids:v}),participantName:C?Nt:ze[ke],participantRole:vs,individualParticipantIds:Ct,participantType:Ce};return U&&(Ge.individualParticipants=lt),C||M?[Ge,...lt]:lt}).flat(),...pe};function Qe(ke){let yt=$[ke],{nationalityCode:lt,participantExtensions:Ct,participantTimeItems:Nt,extensions:Ce,firstName:Ge,birthDate:$e,lastName:at,personId:ct,sex:Vt}=yt||{},Me=Ge||"GivenName",De=at||"FamilyName",Je=`${Me} ${De}`,St=we[ke],bt=(O==null?void 0:O.length)&&lt||St&&(u==="IOC"?St.ioc||St.iso:St.iso||St.ioc)||lt;we!=null&&we.length&&!bt&&!lt&&console.log("%c Invalid Nationality Code",{participantIndex:ke,country:St});let Ie=eTe({...me,participantIndex:ke,nationalityCode:bt}),Ue=Zt({participantId:lk({participantType:Hi,index:ke,idPrefix:g,uuids:v}),extensions:Ct,timeItems:Nt,participantRole:vs,participantType:Hi,participantName:Je,person:{personId:ct||(m==null?void 0:m.length)&&m[ke]||bn(),birthDate:Cl($e)?$e:void 0,addresses:[Ie],standardFamilyName:De,standardGivenName:Me,nationalityCode:bt,extensions:Ce,sex:Vt}});if(E&&bt){let Ee=ag.find(({iso:Xe})=>Xe===bt);Ee!=null&&Ee.ioc&&(Ue.person.iocNationalityCode=Ee.ioc),Ee!=null&&Ee.label&&(Ue.person.countryName=Ee.label)}if(P&&bt){let Ee=ag.find(({iso:Xe})=>Xe===bt);Ee!=null&&Ee.iso2&&(Ue.person.iso2NationalityCode=Ee.iso2),Ee!=null&&Ee.label&&(Ue.person.countryName=Ee.label)}let Oe=Ee=>{var Xe,Et,Fe,ht;let ti=Ee.categoryName||Ee.ratingType||Ee.ageCategoryCode,Ke=(Xe=V[ti])==null?void 0:Xe[ke],zt=(Et=F[ti])==null?void 0:Et[ke];ZM({scaleValue:Ke,eventType:TI,scaleType:bg,participant:Ue,category:Ee}),ZM({scaleValue:zt,eventType:tm,scaleType:bg,participant:Ue,category:Ee});let mt=(Fe=j[ti])==null?void 0:Fe[ke],Tt=(ht=B[ti])==null?void 0:ht[ke];ZM({scaleValue:mt,eventType:TI,scaleType:rg,participant:Ue,category:Ee}),ZM({scaleValue:Tt,eventType:tm,scaleType:rg,participant:Ue,category:Ee})};return Array.isArray(o)?o.forEach(Ee=>Oe(Ee)):l&&Oe(l),Ue}}function ZM({scaleValue:t,participant:e,eventType:i,scaleType:n,category:r}){let a=r.categoryName||r.ratingType||r.ageCategoryCode,s=[vy,n,i,a].join("."),o={itemValue:t,itemType:s};a&&t&&(e.timeItems||(e.timeItems=[]),e.timeItems.push(o))}function xJ(t){let{category:e,scaledParticipantsCount:i,ratingsParameters:n,participantType:r,ratingsValues:a=[]}=t,s=e.rankingRange||t.rankingRange||[1,1e3],o={},l={},c={},u={},{categoryName:d,ageCategoryCode:p,ratingType:h}=e,f=e.categoryName||e.ratingType||e.ageCategoryCode;if((d||p)&&!h){let[m,g]=s||[];if(l[f]=co(Mt(m,g)).slice(0,i||kc(20,30)),[Ai,Pn].includes(r)){let[v,y]=s||[];o[f]=co(Mt(v,y)).slice(0,i||kc(20,30))}}if(h&&n[h]){let{ratingMax:m,ratingMin:g,ratingAttributes:v}=e,y={...n[h],...v||{}},{attributes:b={},decimalsCount:I,accessors:T,range:w,step:S}=y,U=M=>{let _={},A=Object.keys(M||{});for(let N of A){let k=M[N];if(typeof k=="object"&&k.generator){let{range:O}=k,[$,F]=O.slice().sort();_[N]=kc($,F)}else _[N]=k}return _},P=w[0]>w[1]?2:.7,[E,R]=w.slice().sort(),C=Mt(0,2e3).map(()=>Bme(E,R,P,S,I)).filter(M=>(!m||M<=m)&&(!g||M>=g)).slice(0,i||kc(20,30)).map(M=>T?Object.assign({},...T.map(_=>({[_]:M})),U(b)):M);c[f]=[...a,...C],[Ai,Pn].includes(r)&&(u[f]=[...a,...C])}return{singlesRankings:l,doublesRankings:o,singlesRatings:c,doublesRatings:u}}function x9(t){var e,i;let{alternatesCount:n=0,tieFormatName:r,drawSize:a}=t,s=0,o=0,l=0,c=0,u={},d={[Rn]:0,[Kn]:0,[Fo]:0,[Lv]:0,[Ld]:0};(i=(e=tn(t.tieFormat)?t.tieFormat:em({namedFormat:r}))==null?void 0:e.collectionDefinitions)==null||i.filter(Boolean).forEach(m=>{let{category:g,collectionId:v,matchUpType:y,matchUpCount:b,gender:I}=m;if([Rn,Kn].includes(I)){let T=b*(y===Nn?2:1);d[I]<T&&(d[I]=T)}else I===Fo&&(d[Rn]<b&&(d[Rn]=b),d[Kn]<b&&(d[Kn]=b));if(g){let T=JSON.stringify(g);u[T]=g}if(v||(m.collectionId=bn()),Br(Nn)(y)){let T=b;c+=b,s=Math.max(s,T)}if(Br(On)(y)){let T=b;l+=b,o=Math.max(o,T)}});let p=Object.keys(u).length?Math.max(l,c*2):Math.max(o,s*2),h=s*(a+n),f=o*(a+n);return{maxDoublesDraw:h,maxSinglesDraw:f,teamSize:p,genders:d}}function s9e({participantsProfile:t,eventProfiles:e,drawProfiles:i}){let{participantsCount:n,participantType:r=Hi}=t||{},a=n||0,s={[Kn]:0,[Fo]:0,[Lv]:0,[Rn]:0,[Ld]:0},o=0,l=0,c=0,u=0,d=0,p=({alternatesCount:f=0,uniqueParticipants:m,tieFormatName:g,drawSize:v=0,eventType:y,tieFormat:b,category:I,gender:T,stage:w})=>{let S=y===Yc,U=y===aa,P=!!(m||w===ri||I||T);if(U){u=Math.max(u,v+f),b=typeof b=="object"?b:em({namedFormat:g});let{teamSize:E,maxDoublesDraw:R,maxSinglesDraw:C,genders:M}=x9({alternatesCount:f,tieFormatName:g,tieFormat:b,drawSize:v});c=Math.max(c,E),l=Math.max(l,C),P||(o=Math.max(o,R)),Object.keys(M).forEach(_=>s[_]+=M[_])}else if(S)if(P){let E=(v+f)*2;d+=E,T&&(s[T]+=E)}else v+f&&v+f>o&&(o=v+f);else if(P){let E=v+f;T&&(s[T]+=E),d+=E}else v&&v>l&&(l=v+f)};if(e==null||e.forEach(f=>{let{tieFormatName:m,tieFormat:g,drawProfiles:v,eventType:y,category:b,gender:I}=f;if(v)for(let T of v){let{tieFormatName:w,tieFormat:S}=T;p({...T,tieFormatName:w||m,tieFormat:S||g,eventType:y,category:b,gender:I})}}),Array.isArray(i))for(let f of i)p(f);let h=Math.max(u*c,o*2,l);return o&&(r=Ai),(n||a)<h&&(n=h),n&&o&&[Ai,aa].includes(r)&&(l&&Math.floor(l/2)>o?n=Math.floor(l/2):(!l||o*2>=l)&&(n=Math.ceil(n/2))),n===void 0&&(n=!(e!=null&&e.length)&&!(i!=null&&i.length)?32:0),n<a&&(n=a),{uniqueParticipantsCount:d,participantsCount:n,largestTeamDraw:u,largestTeamSize:c,participantType:r,gendersCount:s}}function iTe({participantsProfile:t,tournamentRecord:e,eventProfiles:i,drawProfiles:n,startDate:r,uuids:a}){if((t==null?void 0:t.participantsCount)===0)return{addedCount:0,...pe};let{participantsCount:s,participantType:o,largestTeamDraw:l,largestTeamSize:c,gendersCount:u}=s9e({participantsProfile:t,eventProfiles:i,drawProfiles:n}),d=t==null?void 0:t.teamKey,p=l1({consideredDate:r,...t,participantsCount:s,participantType:o,gendersCount:u,uuids:a}).participants,h=0,f=ed({tournamentRecord:e,participants:p});if(f.error)return f;if(h+=f.addedCount,d){let y=k9({tournamentRecord:e,...d});if(y.error)return y}let m=p.filter(({participantType:y})=>y===Hi).map(Gi),g=t!=null&&t.idPrefix?`${Pn}-${t.idPrefix}`:void 0,v=Mt(0,l).map(y=>{let b=m.slice(y*c,(y+1)*c),I=lk({index:y,participantType:o,idPrefix:g,uuids:a});return{participantName:`Team ${y+1}`,participantRole:vs,individualParticipantIds:b,participantType:Pn,participantId:I}});return f=ed({participants:v,tournamentRecord:e}),f.error?f:(h+=f.addedCount,{addedCount:h,...pe})}function nTe({drawProfiles:t,category:e,gender:i}){let n={},r=t==null?void 0:t.reduce((s,o)=>{let{qualifyingPositions:l=0,participantsCount:c=0,uniqueParticipants:u,stage:d=Bt,drawSize:p=0}=o||{};Object.keys(s).includes(d)||(s[d]=0);let h=(c||p)-l;return u||i||e||d===ri?(Object.keys(n).includes(d)||(n[d]=0),n[d]+=h):s[d]=Math.max(s[d],h),s},{}),a=Object.keys(n);return a.forEach(s=>r[s]+=n[s]),{stageParticipantsCount:r,uniqueParticipantsCount:n,uniqueParticipantStages:a}}function rTe({allUniqueParticipantIds:t,stageParticipantsCount:e,eventParticipantType:i,targetParticipants:n}){let r=e[Bt]||0,a=e[ri]||0;return{stageParticipants:{QUALIFYING:n==null?void 0:n.filter(({participantType:s})=>s===i).filter(({participantId:s})=>!t.includes(s)).slice(0,a),MAIN:n==null?void 0:n.filter(({participantType:s})=>s===i).filter(({participantId:s})=>!t.includes(s)).slice(a,a+r)}}}var o9e={[un]:2,[Kr]:1,[oa]:1,[ss]:1,[Ki]:4};function O9(t){let{defaultWithScorePercent:e=2,winningSide:i}=t,{matchUpStatusProfile:n=o9e,matchUpFormat:r=Fu,pointsPerMinute:a=1,sideWeight:s=4}=t;if(!Ll({matchUpFormat:r}))return{error:j5};if(typeof n!="object")return{error:Ae};if(e>100&&(e=100),isNaN(e)||isNaN(a)||isNaN(s))return{error:Ae};let o=Object.keys(n).filter(E=>Object.keys(Fye).includes(E)&&E!==$r);if(Object.keys(o).reduce((E,R)=>E+n[R],0)>100)return{error:Ae,matchUpStatusProfile:n};let l=o.reduce((E,R)=>(E.pointer=E.pointer+n[R],E.valueMap.push([E.pointer,R]),E),{pointer:0,valueMap:[]}),c=kc(1,100),u=(l.valueMap.find(E=>c<=E[0])??[100,$r])[1],d={sets:[],scoreStringSide1:"",side2ScoreString:""};if([un,Ki].includes(u)){i=i||kc(1,2);let E={score:d,matchUpStatus:u,winningSide:i};if(!(u===Ki&&kc(1,100)>100-e))return{outcome:E}}else if([Kr,oa].includes(u))return{outcome:{score:d,matchUpStatus:u}};let p=Do(r),{bestOf:h=1,exactly:f,setFormat:m,finalSetFormat:g}=p??{},v=[],y=kc(0,1),b=i?[i-1]:[...Mt(0,s).map(()=>y),1-y],I=[ss,Ki,$l,Qg].includes(u)&&(Ul(Mt(1,f||h))||1),T,w=Mt(1,(f??h)+1);for(let E of w){let R=E===(f??h),{set:C,incomplete:M,winningSideNumber:_}=l9e({setFormat:R&&g||m,incomplete:I===E,pointsPerMinute:a,matchUpStatus:u,weightedRange:b,setNumber:E});if(v.push(C),M){T=_;break}if(nP({matchUp:{score:{sets:v},matchUpFormat:r}}).calculatedWinningSide)break}let S=nP({matchUp:{score:{sets:v},matchUpFormat:r,winningSide:i}}),U=T?i||T:S.calculatedWinningSide,{score:P}=VSe({winningSide:U,score:{sets:v},matchUpStatus:u});return{outcome:{winningSide:U,matchUpStatus:u,score:P}}}function l9e({weightedRange:t=[0,1],pointsPerMinute:e,matchUpStatus:i,incomplete:n,setFormat:r,setNumber:a}){let s={setNumber:a},{setTo:o,tiebreakFormat:l,tiebreakAt:c,tiebreakSet:u,timed:d,minutes:p}=r,h=kc(0,t.length-1),f=t[h],m;if(d){let g=p*e,v=Math.round(g*.2),y=g+Ul([1,-1])*v,b=yHe(y,2),I=[b,y-b];f&&I.reverse(),m=t[h]+1;let T=I[0]>I[1]&&1||I[1]>I[0]&&2||0;if(n){let[U,P]=I;return Object.assign(s,{side1Score:U,side2Score:P}),va.includes(i)?{set:s,incomplete:n,winningSideNumber:m}:{set:s,incomplete:n}}T||(I[kc(0,1)]+=1),T=I[0]>I[1]?1:2,T!==m&&I.reverse();let[w,S]=I;return Object.assign(s,{side1Score:w,side2Score:S,winningSide:m}),{set:s}}else{if(n)return s.side1Score=kc(0,c),s.side2Score=kc(0,c),va.includes(i)&&(m=t[h]+1),{set:s,incomplete:n,winningSideNumber:m};{let g=Mt(1,o+1).map(S=>Mt(0,o+2-S).map(()=>S)).flat(),v=g[kc(0,g.length-1)],y=o&&w7({isSide1:!0,tiebreakAt:c,lowValue:v,setTo:o}),b=!y,I=t.length===1&&t[h]+1;if(!b){I?(y[0]>y[1]?1:2)!==I&&y.reverse():f&&y.reverse();let[S,U]=y;Object.assign(s,{side1Score:S,side2Score:U})}let T=tP({matchUpScoringFormat:{setFormat:r},setObject:s}),w;if(T.hasTiebreakCondition||b){let{NoAD:S,tiebreakTo:U}=l||u||{},P=Mt(1,U+1).map(C=>Mt(0,U+2-C).map(()=>C)).flat(),E=P[kc(0,P.length-1)],R=BF({isSide1:!0,tiebreakNoAd:S,tiebreakTo:U,lowValue:E});if(R)if(b){let C=R[0]>R[1]?1:2;I?C!==I&&R.reverse():f&&R.reverse(),[s.side1TiebreakScore,s.side2TiebreakScore]=R,w=R[0]>R[1]&&1||R[1]>R[0]&&2||void 0}else T.leadingSide===2?[s.side1TiebreakScore,s.side2TiebreakScore]=R:[s.side2TiebreakScore,s.side1TiebreakScore]=R}s.winningSide=T.winningSide||T.leadingSide||I||w}}return{set:s}}function uk(t){var e,i,n;let{matchUpStatusProfile:r,completeAllMatchUps:a,randomWinningSide:s,tournamentRecord:o,completionGoal:l,drawDefinition:c,event:u}=t;if(!c)return{error:Ht};let d=t.matchUpFormat||c.matchUpFormat||(u==null?void 0:u.matchUpFormat),p=c.structures.slice().sort(Ew),h=0,{matchUps:f,matchUpsMap:m}=pa({matchUpFilters:{matchUpTypes:[Xn],roundNumbers:[1]},contextFilters:{stages:[Bt,ri]},inContext:!0,drawDefinition:c});if(f!=null&&f.length){let I=((e=u==null?void 0:u.category)==null?void 0:e.ageCategoryCode)||((i=u==null?void 0:u.category)==null?void 0:i.categoryName);if(I){let T=vSe({singlesOnly:!0,tournamentRecord:o,drawDefinition:c,scaleAccessor:{scaleName:I,sortOrder:gSe,scaleType:bg},event:u});if(T.error)return T;let{lineUps:w,participantsToAdd:S}=T;ed({tournamentRecord:o,participants:S}),pn({element:c,extension:{name:am,value:w}})}else{let T=(n=f[0])==null?void 0:n.structureId,{positionAssignments:w}=Gn({drawDefinition:c,structureId:T});if(w!=null&&w.length){let{participants:S}=br({participantFilters:{participantTypes:[Xn]},tournamentRecord:o}),U=P=>{let E=P.tieMatchUps.filter(Br(On)),R=P.tieMatchUps.filter(Br(Nn));E.forEach((C,M)=>{let _=C.matchUpId;C.sides.forEach(A=>{var N;let{drawPosition:k}=A,O=S==null?void 0:S.find($=>{var F;let{participantId:V}=$;return((F=w.find(j=>j.participantId===V))==null?void 0:F.drawPosition)===k});if(O){let $=(N=O.individualParticipantIds)==null?void 0:N[M];$&&ok({teamParticipantId:O.participantId,participantId:$,tournamentRecord:o,drawDefinition:c,tieMatchUpId:_,event:u})}})}),R.forEach((C,M)=>{let _=C.matchUpId;C.sides.forEach(A=>{var N,k;let{drawPosition:O}=A,$=S==null?void 0:S.find(F=>{var V;let{participantId:j}=F;return((V=w.find(B=>B.participantId===j))==null?void 0:V.drawPosition)===O});$&&((k=(N=$.individualParticipantIds)==null?void 0:N.slice(M*2,M*2+2))==null||k.forEach(F=>{ok({teamParticipantId:$.participantId,participantId:F,tournamentRecord:o,drawDefinition:c,tieMatchUpId:_,event:u})}))})})};f.forEach(U)}}}let g=typeof a=="string"&&a,v=g&&$r,y=p.length===2&&p[0].finishingPosition===gy&&Ar(p.map(({stage:I})=>I),[Bt,Mr]).length===2,b=p.map(({structureId:I})=>I);for(let I of b){if(h>=l)break;let T=c.structures.find(U=>U.structureId===I),w=Sn({contextFilters:{matchUpTypes:[Nn,On]},afterRecoveryTimes:!1,tournamentRecord:o,inContext:!0,drawDefinition:c,matchUpsMap:m,structure:T,event:u}).matchUps;w.length;let S=w.filter(({winningSide:U})=>!U).sort(kw).map(Ca);for(let U of S){if(!isNaN(l)&&h>=l)break;let{matchUps:P}=Sn({matchUpFilters:{matchUpTypes:[Nn,On]},afterRecoveryTimes:!1,tournamentRecord:o,inContext:!0,drawDefinition:c,matchUpsMap:m,structure:T,event:u}),E=P.find(C=>C.matchUpId===U),R=[Kr,oa].includes(E.matchUpStatus);if(E!=null&&E.readyToScore&&!R){let C=c9e({matchUpStatusProfile:r,tournamentRecord:o,drawDefinition:c,targetMatchUp:E,matchUpFormat:d,matchUpStatus:v,scoreString:g,winningSide:!s&&1,event:u});if(C!=null&&C.error)return C;h+=1}}y&&T.finishingPosition===gy&&t.completeRoundRobinPlayoffs&&XU({structureId:T.structureId,applyPositioning:!0,drawDefinition:c})}return{...pe,completedCount:h}}function aTe(t){let{matchUpStatusCodes:e,policyDefinitions:i,tournamentRecord:n,drawDefinition:r,targetMatchUp:a,matchUpStatus:s,matchUpFormat:o,scoreString:l,winningSide:c,event:u}=t;if(!a||a.matchUpStatus===gn)return;let{matchUpId:d}=a||{},{outcome:p}=R9({matchUpFormat:o,matchUpStatus:s,scoreString:l,winningSide:c});return e&&(p.matchUpStatusCodes=e),dM({tournamentRecord:n,policyDefinitions:i,drawDefinition:r,matchUpFormat:o,matchUpId:d,outcome:p,event:u})}function c9e(t){let{matchUpStatusProfile:e={},tournamentRecord:i,policyDefinitions:n,drawDefinition:r,matchUpStatus:a,matchUpFormat:s,targetMatchUp:o,scoreString:l,winningSide:c,event:u}=t;if(l||a)return aTe(t);let{matchUpId:d}=o||{},{outcome:p}=O9({matchUpStatusProfile:e,matchUpFormat:s,winningSide:c});return dM({policyDefinitions:n,tournamentRecord:i,drawDefinition:r,matchUpFormat:s,matchUpId:d,outcome:p,event:u})}function sTe({matchUpStatusProfile:t,completeAllMatchUps:e,randomWinningSide:i,tournamentRecord:n,drawProfiles:r,isMock:a,event:s}){var o,l,c,u;let d=kr({event:s}).flightProfile,{eventName:p,eventType:h,category:f}=s,{startDate:m}=n,g=[],v=(f==null?void 0:f.categoryName)||(f==null?void 0:f.ageCategoryCode)||(f==null?void 0:f.ratingType),y=(o=s.drawDefinitions)==null?void 0:o.map(({drawId:b})=>b);if(Array.isArray(d==null?void 0:d.flights))for(let[b,I]of d.flights.entries()){let{drawId:T,stage:w,drawName:S,drawEntries:U}=I;g.push(I.drawId);let P=r[b],{seedsCount:E,generate:R=!0}=P||{};if(R){let C=U.filter(Bl(qh)).map(Bl(qh)),M=v||p;if(n&&E&&E<=C.length&&Mt(1,E+1).forEach((O,$)=>{let F={scaleValue:O,scaleName:M,scaleType:Ph,eventType:h,scaleDate:m},V=C[$];tM({tournamentRecord:n,participantId:V,scaleItem:F})}),y==null?void 0:y.includes(T))break;let _=oM({...P,matchUpType:h,seedingScaleName:M,tournamentRecord:n,drawEntries:U,drawName:S,drawId:T,isMock:a,event:s,stage:w});if(_.error)return{error:_.error,drawIds:[]};let{drawDefinition:A}=_;if(!A)return{error:sc};let N=(l=r[b])==null?void 0:l.drawExtensions;if(Array.isArray(N)&&N.filter(Op).forEach(O=>pn({element:A,extension:O})),_=lM({suppressNotifications:!0,tournamentRecord:n,drawDefinition:A,event:s}),_.error)return{error:_.error,drawIds:[]};if(P!=null&&P.withPlayoffs){let O=(c=A.structures)==null?void 0:c[0].structureId,$=CF({idPrefix:P.idPrefix,...P.withPlayoffs,tournamentRecord:n,drawDefinition:A,structureId:O,isMock:a,event:s});if($!=null&&$.error)return $}let k=P==null?void 0:P.completionGoal;if((P==null?void 0:P.automated)!==!1&&(e||k)){let O=P==null?void 0:P.matchUpFormat,$=uk({completeAllMatchUps:!k&&e,matchUpStatusProfile:t,randomWinningSide:i,tournamentRecord:n,completionGoal:k,drawDefinition:A,matchUpFormat:O,event:s});if($.error)return{error:$.error,drawIds:[]};let F=$.completedCount;if((P==null?void 0:P.drawType)===zh){let V=(u=A.structures)==null?void 0:u.find(z=>z.stage===Bt);if(!V)return{error:yr};let j=XU({structureId:V.structureId,tournamentRecord:n,drawDefinition:A,event:s});if(j.error)return{error:j.error,drawIds:[]};let B=k?k-(F??0):void 0;if(j=uk({completeAllMatchUps:!k&&e,completionGoal:k?B:void 0,matchUpStatusProfile:t,randomWinningSide:i,tournamentRecord:n,drawDefinition:A,matchUpFormat:O,event:s}),j.error)return{error:j.error,drawIds:[]}}}}}return{...pe,drawIds:g}}function oTe(t){var e,i;let{participantsProfile:n={},uniqueParticipantsCount:r,ratingsParameters:a,tournamentRecord:s,eventProfile:o,eventIndex:l,event:c,uuids:u}=t,{category:d,gender:p,eventType:h}=c,f=Br(kp)(h)&&Hi||Br(Yc)(h)&&Ai||h,m=r[Bt]||0,g=r[ri]||0,v=(e=o.drawProfiles)!=null&&e.length?m+g:((i=o.participantsProfile)==null?void 0:i.participantsCount)??0,y=[Rn,Kn].includes(p)?p:void 0,b=n!=null&&n.idPrefix?`E-${l}-${n==null?void 0:n.idPrefix}`:void 0,{participants:I}=l1({uuids:o.uuids||u,...n,scaledParticipantsCount:o.scaledParticipantsCount,consideredDate:s==null?void 0:s.startDate,rankingRange:o.rankingRange,participantType:f,participantsCount:v,ratingsParameters:a,category:d,idPrefix:b,sex:y}),T=ed({tournamentRecord:s,participants:I});if(T.error)return T;let w=I==null?void 0:I.filter(({participantType:U})=>U===f),S=I==null?void 0:I.map(Gi);return{uniqueDrawParticipants:w,uniqueParticipantIds:S}}function u9e({autoEntryPositions:t,tournamentRecord:e,drawParticipants:i,drawProfile:n,event:r}){let{drawType:a=bp,qualifyingPositions:s=0,stage:o=Bt,drawSize:l=0,drawName:c,drawId:u}=n,d=l-s,p=i.slice(0,d).map(Gi);if(p.length){let m=Ip({participantIds:p,autoEntryPositions:t,entryStage:o,tournamentRecord:e,event:r});if(m.error)return m}let h=p.map(m=>({entryStatus:dl,entryStage:o,participantId:m})),f=s2({drawName:c||a,qualifyingPositions:s,drawEntries:h,drawId:u,event:r,stage:o});return f.error?f:{...pe}}function lTe({uniqueDrawParticipants:t,autoEntryPositions:e,stageParticipants:i,tournamentRecord:n,drawProfiles:r,category:a,gender:s,event:o}){let l=0;for(let c of r){let{qualifyingPositions:u=0,uniqueParticipants:d,stage:p=Bt,drawSize:h=0}=c,f=h-u,m=d||s||a||p===ri,g=m?t.slice(l,l+f):i[p||Bt]||[];m&&(l+=f);let v=u9e({autoEntryPositions:e,drawParticipants:g,tournamentRecord:n,drawProfile:c,event:o});if(v.error)return v}return{...pe}}function cTe(t){var e;let{allUniqueParticipantIds:i,matchUpStatusProfile:n,participantsProfile:r,completeAllMatchUps:a,autoEntryPositions:s,hydrateCollections:o,randomWinningSide:l,ratingsParameters:c,tournamentRecord:u,eventProfile:d,eventIndex:p,publish:h,isMock:f,uuids:m}=t,g=d.gender,v=d.eventName,{eventType:y=kp,policyDefinitions:b,drawProfiles:I=[],eventExtensions:T,surfaceCategory:w,tieFormatName:S,processCodes:U,discipline:P,eventLevel:E,timeItems:R,ballType:C,category:M}=d,_=d.eventId||bn(),A=d.tieFormat||(y===aa?em({namedFormat:S,event:{eventId:_,category:M,gender:g},hydrateCollections:o,isMock:f}):void 0),N=u.participants;for(let se of I)!g&&se.gender&&(g=se==null?void 0:se.gender);let{stageParticipantsCount:k,uniqueParticipantsCount:O,uniqueParticipantStages:$}=nTe({drawProfiles:I,category:M,gender:g}),F=Br(kp)(y)&&Hi||Br(Yc)(y)&&Ai||y,{uniqueDrawParticipants:V=[],uniqueParticipantIds:j=[]}=$?oTe({event:{eventType:y,category:M,gender:g},uniqueParticipantsCount:O,participantsProfile:r,ratingsParameters:c,tournamentRecord:u,eventProfile:d,eventIndex:p,uuids:m}):{},{eventAttributes:B}=d;typeof B!="object"&&(B={});let z=(M==null?void 0:M.categoryName)||(M==null?void 0:M.ageCategoryCode)||(M==null?void 0:M.ratingType);v=v||z||"Generated Event";let W={...B,surfaceCategory:w,processCodes:U,discipline:P,eventLevel:E,eventName:v,eventType:y,tieFormat:A,ballType:C,category:M,eventId:_,gender:g};if(T!=null&&T.length&&Array.isArray(T)){let se=T.filter(Op);se!=null&&se.length&&Object.assign(W,{extensions:se})}if(Array.isArray(R)&&R.forEach(se=>$w({event:Q,timeItem:se})),typeof b=="object")for(let se of Object.keys(b))Ty({policyDefinitions:{[se]:b[se]},event:W});W.category&&(W.category.categoryName=z);let Z,K=i1({suppressNotifications:!1,internalUse:!0,tournamentRecord:u,event:W});if(K.error)return K;let Q=K==null?void 0:K.event,{stageParticipants:J}=rTe({allUniqueParticipantIds:i,stageParticipantsCount:k,eventParticipantType:F,targetParticipants:N});if(I!=null&&I.length){let se=lTe({uniqueDrawParticipants:V,autoEntryPositions:s,stageParticipants:J,tournamentRecord:u,drawProfiles:I,category:M,gender:g,event:Q});if(se.error)return se;let ie=sTe({matchUpStatusProfile:n,completeAllMatchUps:a,randomWinningSide:l,tournamentRecord:u,drawProfiles:I,isMock:f,event:Q});if(ie.error)return ie;Z=ie.drawIds}else if((e=d==null?void 0:d.participantsProfile)!=null&&e.participantsCount){let se=V.map(Gi);if(se.length){let ie=Ip({participantIds:se,autoEntryPositions:s,tournamentRecord:u,entryStage:Bt,event:Q});if(ie.error)return ie}}return h&&r1({tournamentRecord:u,event:Q}),{drawIds:Z,eventId:_,uniqueParticipantIds:j}}function L9({tournamentRecords:t,scheduleDate:e,venueId:i,round:n}){if(!Cl(e))return{error:Va};let r="addSchedulingProfileRound",{extension:a}=xi({name:PI,tournamentRecords:t,discover:!0}),s=(a==null?void 0:a.value)||[],o=s.find(p=>Gh(e,p.scheduleDate));if(!o){let{startDate:p,endDate:h}=GF({tournamentRecords:t}),f=new Date(e);if(p&&f<new Date(p)||h&&f>new Date(h))return{error:Va};o={scheduleDate:e,venues:[]},s.push(o)}let l=o.venues.find(p=>p.venueId===i);l||(l={venueId:i,rounds:[]},o.venues.push(l));let c=["notBeforeTime"],u=p=>Object.keys(p).filter(h=>!c.includes(h)).sort().map(h=>tn(p[h])?u(p[h]):p[h]).flat().join("|");if(l.rounds.find(p=>u(p)===u(n)))return fe({result:{error:oge},stack:r});l.rounds.push(n);let d=e1({tournamentRecords:t,schedulingProfile:s});return d.error?d:{...pe}}function d9e({schedulingProfile:t,tournamentRecord:e}){if(typeof t!="object")return{error:Ae};let i=zU({tournamentRecord:e}).containedStructures,n=Za({tournamentRecord:e}).matchUps??[],{tournamentId:r}=e,a=[];for(let s of t){let{scheduleDate:o,venues:l=[]}=s;for(let c of l){let{rounds:u,venueId:d}=c;for(let p of u){let{drawId:h,winnerFinishingPositionRange:f,roundSegment:m}=p,g=n.filter(v=>{var y;let b=(f==null?void 0:f.indexOf("-"))>0&&f.split("-").map(T=>+T),I=(y=v.finishingPositionRange)==null?void 0:y.winner;return v.drawId===h&&(!p.roundNumber||v.roundNumber===p.roundNumber)&&(!I||!b||Ar(I,b).length===2||Pi(I).length===Pi(b).length&&Ar(I,b).length===Pi(I).length)})[0];if(g){let{eventId:v,roundNumber:y,drawName:b,structureName:I,roundName:T}=g,w=g.structureId;y&&!f&&(w=Object.keys(i).find(P=>i[P].includes(w))??w);let S={tournamentId:r,structureId:w,roundNumber:y,roundSegment:m,eventId:v,drawId:h},U=L9({tournamentRecords:{[r]:e},round:S,scheduleDate:o,venueId:d});if(U.error)return U;a.push({structureName:I,roundName:T,drawName:b,...S})}}}}return{scheduledRounds:a}}function b2(t){var e,i,n;let r=ei(t,[{drawProfile:!0,_ofType:tl}]);if(r.error)return r;let{allUniqueParticipantIds:a=[],participantsProfile:s={},matchUpStatusProfile:o,completeAllMatchUps:l,autoEntryPositions:c,hydrateCollections:u,randomWinningSide:d,ratingsParameters:p,tournamentRecord:h,isMock:f=!0,drawProfile:m,startDate:g,drawIndex:v,uuids:y}=t,b=$t(m,!1,!0),{excessParticipantAlternates:I=!0,matchUpFormat:T=Fu,drawType:w=bp,tournamentAlternates:S=0,alternatesCount:U=0,qualifyingPositions:P,qualifyingProfiles:E,generate:R=!0,eventExtensions:C,drawExtensions:M,completionGoal:_,tieFormatName:A,buildTeams:N,seedsCount:k,timeItems:O,drawName:$,category:F,idPrefix:V,publish:j,gender:B,stage:z}=b,W=b.drawSize||(b.ignoreDefaults?void 0:32),Z=b.eventId||bn(),K=m.eventType||m.matchUpType||kp,Q=K===Yc?Ai:Hi,J=tn(m.tieFormat)&&m.tieFormat||K===Pn&&em({event:{eventId:Z,category:F,gender:B},namedFormat:A,hydrateCollections:u,isMock:f})||void 0,se=(F==null?void 0:F.categoryName)||(F==null?void 0:F.ageCategoryCode)||(F==null?void 0:F.ratingType),ie=m.eventName||se||`Generated ${K}`,ce=(h==null?void 0:h.participants)||[],oe=((E==null?void 0:E.map(Ce=>Ce.structureProfiles||[]).flat().reduce((Ce,Ge)=>{let $e=!Ge.participantsCount||Ge.participantsCount>Ge.drawSize?Ge.drawSize:Ge.participantsCount||0;return Ce+$e},0))||0)*(Q===Ai?2:1),te=(!m.participantsCount||m.participantsCount>W?W:m.participantsCount)||0,le={eventName:ie,eventType:K,tieFormat:J,category:F,eventId:Z,gender:B};Array.isArray(O)&&O.forEach(Ce=>$w({event:le,timeItem:Ce}));let{eventAttributes:ne}=m;if(typeof ne!="object"&&(ne={}),Object.assign(le,ne),(C==null?void 0:C.length)&&Array.isArray(C)){let Ce=C.filter(Op);Ce!=null&&Ce.length&&Object.assign(le,{extensions:Ce})}let me=[];if((s==null?void 0:s.participantsCount)===0||m.uniqueParticipants||oe||!h||B||F){let Ce=(te||0)+U+oe,Ge=Ce,$e={[Rn]:0,[Kn]:0},at,ct;K===Pn&&({teamSize:at,genders:ct}=x9({alternatesCount:U,tieFormatName:A,tieFormat:J,drawSize:W}),Object.keys(ct).forEach(De=>{[Rn,Kn].includes(De)&&ct[De]&&($e[De]=W*ct[De])}),Ge=at*((W||0)+oe));let Vt=s!=null&&s.idPrefix?`D-${v}-${s==null?void 0:s.idPrefix}`:void 0,Me=l1({...s,scaledParticipantsCount:m.scaledParticipantsCount||s.scaledParticipantsCount,participantsCount:Ge,consideredDate:h==null?void 0:h.startDate,sex:B||(s==null?void 0:s.sex),rankingRange:m.rankingRange,uuids:m.uuids||y,ratingsParameters:p,participantType:Q,gendersCount:$e,idPrefix:Vt,category:F}).participants;if(le.category&&(le.category.categoryName=se),h){let De=ed({participants:Me,tournamentRecord:h});if(De.error)return De}if(Me.forEach(({participantId:De})=>me.push(De)),ce=Me,K===Pn){let De=ct[Rn]?Me.filter(({participantType:Fe,person:ht})=>Fe===Hi&&(ht==null?void 0:ht.sex)===Rn).map(Gi):[],Je=ct[Kn]?Me.filter(({participantType:Fe,person:ht})=>Fe===Hi&&(ht==null?void 0:ht.sex)===Kn).map(Gi):[],St=Me.filter(({participantType:Fe})=>Fe===Hi).map(Gi).filter(Fe=>!De.includes(Fe)&&!Je.includes(Fe)),bt=[...b.teamNames??[],...ck({count:Ce}).names],Ie=at-(ct[Rn]+ct[Kn]),Ue=0,Oe=0,Ee=0,Xe=Mt(0,Ce).map(Fe=>{let ht=Je.slice(Ue,Ue+ct[Kn]),ti=De.slice(Oe,Oe+ct[Rn]),Ke=St.slice(Ee,Ee+Ie);Ue+=ct[Kn],Oe+=ct[Rn],Ee+=Ie;let zt=N!==!1?[...ht,...ti,...Ke]:[];return{participantName:bt[Fe]||`Team ${Fe+1}`,participantOtherName:`TM${Fe+1}`,participantRole:vs,individualParticipantIds:zt,participantType:Pn,participantId:bn()}}),Et=ed({participants:Xe,tournamentRecord:h});if(!Et.success)return Et;ce=Xe}}let be=Ce=>{let{participantType:Ge}=Ce;return Br(kp)(K)&&Ge===Hi||Br(Yc)(K)&&Ge===Ai?!0:K===Pn&&Ge===Pn},Se=Ce=>{var Ge,$e;return!m.gender||((Ge=Ce.person)==null?void 0:Ge.sex)===m.gender?!0:($e=Ce.individualParticipantIds)==null?void 0:$e.some(at=>{let ct=ce.find(Vt=>Vt.participantId===at);return ct&&Se(ct)})},we=ce.filter(be).filter(Se).filter(({participantId:Ce})=>!a.includes(Ce)),ze=we.slice(0,te).map(Ce=>Ce.participantId);if(f&&ze!=null&&ze.length){let Ce=Ip({autoEntryPositions:c,entryStage:z,tournamentRecord:h,participantIds:ze,event:le});if(Ce.error)return Ce}let Qe=oe?we.slice(te,te+oe).map(Ce=>Ce.participantId):0;if(f&&Qe!=null&&Qe.length){let Ce=0,Ge=1,$e=(ct,Vt)=>ct.stageSequence-Vt.stageSequence,at=(ct,Vt)=>ct.roundTarget-Vt.roundTarget;for(let ct of E.sort(at)){Ge=ct.roundTarget||Ge;let Vt=1,Me;for(let De of ct.structureProfiles.sort($e)){let Je=(De.drawSize||A5(De.participantsCount))-(Me||0),St=Qe.slice(Ce,Ce+Je),bt=Ip({entryStage:ri,entryStageSequence:Vt,autoEntryPositions:c,tournamentRecord:h,participantIds:St,roundTarget:Ge,event:le});if(bt.error)return bt;Me=De.qualifyingPositions,Ce+=Je,Vt+=1}Ge+=1}}let ke=I&&((e=h==null?void 0:h.participants)==null?void 0:e.filter(({participantId:Ce})=>!ze.includes(Ce)).filter(be).filter(Se).slice(0,U||W-te||S).map(Ce=>Ce.participantId));if(f&&ke!=null&&ke.length){let Ce=Ip({participantIds:ke,autoEntryPositions:!1,entryStatus:Bu,tournamentRecord:h,event:le});if(Ce.error)return Ce.error}let yt=se||ie;h&&k&&k<=ze.length&&Mt(1,k+1).forEach((Ce,Ge)=>{let $e={scaleName:yt,scaleDate:g,scaleType:p8,scaleValue:Ce,eventType:K},at=ze[Ge];tM({tournamentRecord:h,participantId:at,scaleItem:$e})});let lt=oM({...$t(m,!1,!0),tournamentRecord:h,seedingScaleName:yt,matchUpFormat:T,eventId:Z,isMock:f,event:le});if(lt.error)return lt;if(!lt.drawDefinition)return{error:sc};let{drawDefinition:Ct}=lt,Nt=Ct.drawId;if(Array.isArray(M)&&M.filter(Op).forEach(Ce=>pn({element:Ct,extension:Ce})),R){if(lM({drawDefinition:Ct,event:le,suppressNotifications:!0}),m.withPlayoffs){let Ge=(i=Ct.structures)==null?void 0:i[0].structureId,$e=CF({...m.withPlayoffs,tournamentRecord:h,drawDefinition:Ct,structureId:Ge,idPrefix:V,isMock:f,event:le});if($e!=null&&$e.error)return $e}let Ce=m.automated===!1;if(f&&!Ce){let Ge=$e=>{var at;let ct=uk({completeAllMatchUps:$e.completeAllMatchUps,completionGoal:$e.completionGoal,matchUpStatusProfile:o,randomWinningSide:d,tournamentRecord:h,drawDefinition:Ct,matchUpFormat:T,event:le});if(ct.error)return ct;let Vt=ct.completedCount;if(w===zh){let Me=(at=Ct.structures)==null?void 0:at.find(St=>St.stage===Bt);if(!Me)return{error:yr};XU({structureId:Me.structureId,tournamentRecord:h,drawDefinition:Ct,event:le});let De=_?_-(Vt??0):void 0,Je=uk({completionGoal:_?De:void 0,matchUpStatusProfile:o,completeAllMatchUps:l,randomWinningSide:d,tournamentRecord:h,drawDefinition:Ct,matchUpFormat:T,event:le});if(Je.error)return Je}};if(_&&Ge({completionGoal:_}),m.outcomes){let{matchUps:$e}=po({inContext:!0,drawDefinition:Ct,event:le});for(let at of m.outcomes){let{matchUpStatus:ct=$r,matchUpStatusCodes:Vt,stageSequence:Me=1,matchUpIndex:De=0,structureOrder:Je,matchUpFormat:St,drawPositions:bt,roundPosition:Ie,stage:Ue=Bt,roundNumber:Oe,winningSide:Ee,scoreString:Xe}=at,Et=($e==null?void 0:$e.reduce((Ke,zt)=>{let{structureId:mt,matchUpId:Tt}=zt;return Ke[mt]?Ke[mt].push(Tt):Ke[mt]=[Tt],Ke},{}))??[],Fe=Object.assign({},...Object.keys(Et).map((Ke,zt)=>({[Ke]:zt+1}))),ht=(n=$e==null?void 0:$e.filter(Ke=>(!Ue||Ke.stage===Ue)&&(!Me||Ke.stageSequence===Me)&&(!Oe||Ke.roundNumber===Oe)&&(!Ie||Ke.roundPosition===Ie)&&(!Je||Fe[Ke.structureId]===Je)&&(!bt||Ar(bt,Ke.drawPositions).length===2)))==null?void 0:n[De],ti=aTe({matchUpStatusCodes:Vt,tournamentRecord:h,drawDefinition:Ct,targetMatchUp:ht,matchUpFormat:St,matchUpStatus:ct,scoreString:Xe,winningSide:Ee});if(ti!=null&&ti.error)return ti}}l&&Ge({completeAllMatchUps:l})}j&&r1({tournamentRecord:h,event:le})}else{let Ce=s2({drawEntries:Ct.entries,drawName:$||w,qualifyingPositions:P,drawId:Nt,event:le,stage:z});if(Ce.error)return Ce}return{...pe,event:Zt(le),uniqueParticipantIds:me,targetParticipants:ce,drawDefinition:Ct,eventId:Z,drawId:Nt}}var uTe=()=>({altitude:void 0,courtId:void 0,courtName:"",courtDimensions:void 0,latitude:void 0,longitude:void 0,surfaceCategory:void 0,surfaceType:void 0,surfacedDate:void 0,dateAvailability:[],onlineResources:[],pace:void 0,notes:void 0}),p9e=uTe;function dk(t){return parseInt(t)}function OJ({startTime:t="",endTime:e=""}={}){if(!t||!e||!Fv.test(t)||!Fv.test(e))return!1;let[i,n]=t.split(":").map(dk),[r,a]=e.split(":").map(dk);return r<i?!1:!(i===r&&a<n)}function h9e(t,e){let[i,n]=t.startTime.split(":").map(dk),[r,a]=e.startTime.split(":").map(dk);return i<r?-1:i>r?1:n<a?-1:n>a?1:0}function dTe({dateAvailability:t}){if(!t)return{error:Sge};if(!Array.isArray(t))return{error:tA};let e="Dates must be formated => YYYY-MM-DD",i="Times must be 24 hour => 00:00";for(let n of t){if(typeof n!="object")return{error:tA};let{date:r,startTime:a,endTime:s,bookings:o=[]}=n;if(!a||!s)return{error:tA};if(r&&!_p.test(r))return{error:Va,dateAvailability:{date:r},info:e};if(!Fv.test(a))return{error:Iu,dateAvailability:{startTime:a},info:i};if(!Fv.test(s))return{error:Iu,dateAvailability:{endTime:s},info:i};if(a===s)return{error:Iu,dateAvailability:{startTime:a,endTime:s},info:"startTime and endTime are equivalent"};if(!OJ({startTime:a,endTime:s}))return{error:Iu,dateAvailability:{startTime:a,endTime:s},info:"endTime must be after startTime"};if(o){if(!Array.isArray(o))return{error:k_};for(let l of o){if(typeof l!="object")return{error:k_};let{startTime:c,endTime:u}=l;if(!Fv.test(c))return{error:Iu,booking:{startTime:c},info:i};if(!Fv.test(u))return{error:Iu,booking:{endTime:u},info:i};if(c===u)return{error:Iu,dateAvailability:{startTime:c,endTime:u},info:"startTime and endTime are equivalent"};if(!OJ({startTime:c,endTime:u}))return{error:Iu,dateAvailability:{startTime:c,endTime:u},info:"endTime must be after startTime"}}}}return{valid:!0}}function I2({tournamentRecord:t,disableNotice:e,venueId:i,courtId:n,court:r}){let{venue:a}=tf({tournamentRecord:t,venueId:i});if(!a)return{error:Iw};a.courts||(a.courts=[]);let s={...uTe(),venueId:i,courtId:n};if(s.courtId||(s.courtId=bn()),a.courts.some(o=>o.courtId===s.courtId))return{error:$ge};{let o=((r==null?void 0:r.dateAvailability)||[]).map(u=>{var d;return{...u,date:Mi(u.date),startTime:sr(u.startTime),endTime:sr(u.endTime),bookings:(d=u.bookings)==null?void 0:d.map(({startTime:p,endTime:h,bookingType:f})=>({startTime:sr(p),endTime:sr(h),bookingType:f}))}}),l=Object.keys(s);for(let u of l)if(r!=null&&r[u])if(u==="dateAvailability"){let d=dTe({dateAvailability:o});if(!d.valid&&d.error)return d;s.dateAvailability=o}else s[u]=r[u];let c=s;return a.courts.push(c),e||Ti({payload:{venue:a,tournamentId:t.tournamentId},topic:Jy,key:a.venueId}),{...pe,court:$t(s),venueId:i}}}function F9(t){let{tournamentRecord:e,venueId:i}=t;if(typeof i!="string"||!i)return{error:Kg};let n=t.tournamentRecords??(e&&{[e.tournamentId]:e})??{},r=[],a;for(let s of Object.values(n)){let{venue:o}=tf({tournamentRecord:s,venueId:i});if(o){let l=f9e({...t,tournamentRecord:s});for(let c of(l==null?void 0:l.courts)??[])r.push(c==null?void 0:c.courtId);if(l.error)return l;a=!0}}return a?{...pe,courtIds:r}:{error:Iw}}function f9e({courtNameRoot:t="Court",dateAvailability:e=[],venueAbbreviationRoot:i,tournamentRecord:n,courtNames:r=[],courtTimings:a,courtsCount:s,startTime:o,courtIds:l,endTime:c,idPrefix:u,venueId:d,dates:p}){if(!d)return{error:Kg};let h=tf({tournamentRecord:n,venueId:d});if(h.error)return h;let{venue:f}=h;if(!Er(s)||!r)return{error:Fge};s=s??r.length;let m=Mt(0,s).map(g=>{let v=a==null?void 0:a[g],y=v?p.map(b=>({date:Lu(b),startTime:o,endTime:c,...v})):e;return v&&o&&c&&y.push({startTime:o,endTime:c}),{courtName:r[g]||i&&(f==null?void 0:f.venueAbbreviation)&&`${f==null?void 0:f.venueAbbreviation} ${g+1}`||`${t} ${g+1}`,dateAvailability:y}}).map((g,v)=>{let y=(l==null?void 0:l.pop())||u&&`${u}-${v+1}`;return I2({disableNotice:!0,tournamentRecord:n,courtId:y,venueId:d,court:g})}).map(g=>g.court).filter(Boolean);return m.length!==s?fe({info:"not all courts could be generated",result:{error:Ae}}):(f&&Ti({payload:{venue:f,tournamentId:n.tournamentId},topic:Jy,key:f.venueId}),{...pe,courts:$t(m)})}function $9({tournamentRecord:t,ignoreExistingVenues:e,venueProfiles:i,uuids:n}){let{startDate:r,endDate:a}=t,s=[];for(let[o,l]of i.entries()){let{venueAbbreviation:c,venueId:u=(n==null?void 0:n.pop())??bn(),dateAvailability:d,startTime:p="07:00",endTime:h="19:00",courtTimings:f,courtsCount:m,courtNames:g,venueName:v,idPrefix:y,courtIds:b}=l,I={venueName:v||`Venue ${o+1}`,venueAbbreviation:c,venueId:u},T=AR({tournamentRecord:t,venue:I});if(T.error){if(e)continue;return T}s.push(u);let w=oT(r,a),S=!Array.isArray(d)&&[{startTime:p,endTime:h}].concat(w.map(U=>({date:Lu(U),startTime:p,endTime:h})));if(m||g){let U=F9({dateAvailability:d||S,tournamentRecord:t,courtTimings:f,courtsCount:m,courtNames:g,startTime:p,idPrefix:y,courtIds:b,endTime:h,venueId:u,dates:w});if(U.error)return U}}return s}function m9e(t){var e,i,n;let{tournamentRecord:r,leagueProfiles:a,eventIds:s,venueIds:o,drawIds:l,allUniqueParticipantIds:c,uuids:u}=t,d=0;for(let h of a){let f=[],{tieFormatName:m=B_,teamProfiles:g=[],teamsCount:v=0,category:y,idPrefix:b,gender:I}=h,T=h.leagueName??h.eventName??`League ${d+1}`,w=h.leagueId??h.eventId??(u==null?void 0:u.pop())??bn();s.push(w);let S=tn(h.tieFormat)&&h.tieFormat||em({event:{eventId:w,category:y,gender:I},namedFormat:m,isMock:t.isMock})||void 0;if(!S)return{error:kU};let U=Math.max(v,g.length),P=Mt(0,U),{genders:E,teamSize:R}=x9({tieFormat:S,drawSize:U}),C={[Kn]:0,[Fo]:0,[Lv]:0,[Rn]:0,[Ld]:0};Object.keys(E).forEach(_=>C[_]+=E[_]);for(let _ of P){let A=((e=g==null?void 0:g[_])==null?void 0:e.teamName)??`Team ${_+1}`,N=((i=g==null?void 0:g[_])==null?void 0:i.teamId)||(u==null?void 0:u.pop())||bn(),k=h.startDate??t.startDate,O=l1({...h==null?void 0:h.participantsProfile,participantsCount:R,consideredDate:k,gendersCount:C,category:y,gender:I,uuids:u}).participants,$=O.map(W=>W.participantId),F=Pn,V=N??lk({participantType:F,idPrefix:b,index:_,uuids:u});f.push({participantId:V,entryStatus:dl,entryStage:Bt});let j=((n=g==null?void 0:g[_])==null?void 0:n.venueIds)??[],B={participantId:V,participantRole:vs,participantName:A,individualParticipantIds:$,participantType:F,homeVenueIds:j};j.forEach(W=>!o.includes(W)&&o.push(W)),c.push(...$),c.push(V);let z=ed({participants:[B,...O],tournamentRecord:r});if(z.error)return z}let M={eventName:T,entries:f,eventType:Pn,tieFormat:S,category:y,eventId:w,gender:I};if(r.events||(r.events=[]),r.events.push(M),f.length){let _=(Er(h.roundsCount)&&h.roundsCount)??h.roundsCount===rqe?(U-1)*2:U-1,A=oM({automated:h.automated,tournamentRecord:r,drawType:lc,roundsCount:_,drawSize:U,event:M});if(A.error)return A;let{drawDefinition:N}=A;if(N){let k=N==null?void 0:N.drawId;lM({drawDefinition:N,event:M,suppressNotifications:!0}),l.push(k)}}d++}let p=o.map(h=>({venueId:h}));$9({tournamentRecord:r,ignoreExistingVenues:!0,venueProfiles:p,uuids:u})}var g9e=["Generated Tournament","CourtHive Challenge","Replication Crisis","Open Competition","Factory Follies","Mock Tournament","Atomic Culture","Racket Rally","Stats Fail"];function pTe(t){var e,i,n;let{startDate:r,endDate:a}=t??{},{tournamentName:s=Ul(g9e),ratingsParameters:o=Ea,tournamentExtensions:l,policyDefinitions:c,schedulingProfile:u,venueProfiles:d,uuids:p}=t??{},h=(t==null?void 0:t.isMock)===!1?void 0:!0;if(r&&!Cl(r)||a&&!Cl(a))return{error:Va};if(t.leagueProfiles&&!Array.isArray(t.leagueProfiles)||t.eventProfiles&&!Array.isArray(t.eventProfiles)||t.drawProfiles&&!Array.isArray(t.drawProfiles))return{error:Ae};if(!r){let T=new Date;r=Lu(a??T),a=Lu(T.setDate(T.getDate()+7))}if(!a){let T=new Date(r);a=Lu(T.setDate(T.getDate()+7))}let f=y2({...t.tournamentAttributes??{},tournamentName:s,startDate:r,endDate:a,isMock:h}),m=d!=null&&d.length?$9({tournamentRecord:f,venueProfiles:d,uuids:p}):[];if(l!=null&&l.length&&Array.isArray(l)){let T=l.filter(w=>Op({extension:w}));T!=null&&T.length&&Object.assign(f,{extensions:T,isMock:h})}if(typeof c=="object")for(let T of Object.keys(c))Ty({policyDefinitions:{[T]:c[T]},tournamentRecord:f});if(!((e=t==null?void 0:t.leagueProfiles)!=null&&e.length)||(i=t.eventProfiles)!=null&&i.length||(n=t.drawProfiles)!=null&&n.length||t.participantsProfile){let T=iTe({tournamentRecord:f,...t});if(!T.success)return T}let g=[],v=[],y=[];if(t.leagueProfiles){let T=m9e({allUniqueParticipantIds:g,tournamentRecord:f,...t,eventIds:v,venueIds:m,drawIds:y});if(T!=null&&T.error)return T}if(t.drawProfiles){let T=v9e({allUniqueParticipantIds:g,ratingsParameters:o,tournamentRecord:f,...t,eventIds:v,drawIds:y});if(T!=null&&T.error)return T}if(t.eventProfiles){let T=y9e({allUniqueParticipantIds:g,ratingsParameters:o,tournamentRecord:f,...t,eventIds:v,drawIds:y});if(T!=null&&T.error)return T}let{scheduledRounds:b=void 0,schedulerResult:I={}}=u?b9e({...t,tournamentRecord:f}):{};return l6(),Zt({...pe,tournamentRecord:f,scheduledRounds:b,schedulerResult:I,eventIds:v,venueIds:m,drawIds:y})}function v9e(t){let{tournamentRecord:e,drawProfiles:i,allUniqueParticipantIds:n,eventIds:r,drawIds:a}=t,s=0;for(let o of i){let l=b2({allUniqueParticipantIds:n,tournamentRecord:e,drawProfile:o,drawIndex:s,...t});if(l.error)return l;let{drawId:c,eventId:u,event:d,uniqueParticipantIds:p}=l;if((o==null?void 0:o.addEvent)!==!1){if(l=i1({suppressNotifications:!1,internalUse:!0,tournamentRecord:e,event:d}),l.error)return l;c&&a.push(c),r.push(u)}p!=null&&p.length&&n.push(...p),s+=1}}function y9e(t){let{eventProfiles:e,allUniqueParticipantIds:i,eventIds:n,drawIds:r}=t,a=0;for(let s of e){let o=cTe({...t,eventIndex:a,eventProfile:s});if(o.error)return o;let{eventId:l,drawIds:c,uniqueParticipantIds:u}=o;c&&r.push(...c),n.push(l),u!=null&&u.length&&i.push(...u),a+=1}}function b9e(t){let{schedulingProfile:e,tournamentRecord:i,autoSchedule:n,periodLength:r,scheduleCompletedMatchUps:a}=t,s=d9e({schedulingProfile:e,tournamentRecord:i});if(s.error)return s;let o=s.scheduledRounds;if(n){let{tournamentId:l}=i,c={[l]:i};return{schedulerResult:v2({scheduleCompletedMatchUps:a,tournamentRecords:c,periodLength:r}),scheduledRounds:o}}return{scheduledRounds:o}}var hTe={};Fi(hTe,{anonymizeTournamentRecord:()=>fTe,modifyTournamentRecord:()=>mTe});function fTe({keepExtensions:t=[],anonymizeParticipantNames:e=!0,tournamentRecord:i,tournamentName:n,personIds:r=[],tournamentId:a}){var s,o,l,c,u;if(!i)return{error:dt};let d=Array.isArray(t)?WX.concat(...t):WX,p=B=>{var z;return Array.isArray(t)?(z=B==null?void 0:B.extensions)==null?void 0:z.filter(W=>d.includes(W.name)):B==null?void 0:B.extensions},h={};i.extensions=p(i);let f=a||bn();h[i.tournamentId]=f,i.tournamentId=f,i.createdAt=new Date().toISOString(),i.tournamentName=n||`Anonymized: ${Lu(new Date)}`,i.isMock=!0,delete i.parentOrganisation;for(let B of i.participants||[]){B.extensions=p(B),B.onlineResources=[];let z=bn();h[B.participantId]=z,B.participantId=z}for(let B of i.participants||[])Array.isArray(B.individualParticipantIds)&&(B.individualParticipantIds=B.individualParticipantIds.map(z=>h[z]));let m=0;for(let B of i.venues||[]){B.venueAbbreviation=`V${m}`,B.extensions=p(B),B.venueName=`Venue #${m}`,B.onlineResources=[],B.addresses=[];let z=bn();h[B.venueId]=z,B.isMock=!0,m+=1;let W=0;for(let Z of B.courts||[])Z.courtName=`V${m}C${W}`,Z.extensions=p(Z),Z.onlineResources=[],Z.isMock=!0,W+=1}let g=1;for(let B of i.events||[]){B.extensions=p(B),B.onlineResources=[],B.isMock=!0;let z=bn();h[B.eventId]=z,B.eventId=z;let W=((s=B.category)==null?void 0:s.categoryName)||((o=B.category)==null?void 0:o.ageCategoryCode)||((l=B.category)==null?void 0:l.ratingType)||B.gender;if(B.eventName=`Event ${g} ${W}`,Array.isArray(B.entries))for(let K of B.entries)K.participantId=h[K.participantId];for(let K of B.drawDefinitions||[]){K.extensions=p(K);let Q=bn();if(h[K.drawId]=Q,K.drawId=Q,K.isMock=!0,Array.isArray(K.entries))for(let se of K.entries)se.participantId=h[se.participantId];let J=se=>{se.extensions=p(se);let ie=bn();h[se.structureId]=ie,se.structureId=ie;for(let ce of se.positionAssignments||[])ce.participantId&&(ce.participantId=h[ce.participantId]);for(let ce of se.seedAssignments||[])ce.participantId&&(ce.participantId=h[ce.participantId]);for(let ce of se.matchUps||[]){ce.isMock=!0;for(let oe of ce.sides||[])oe.lineUp&&(oe.lineUp=oe.lineUp.map(({participantId:te,collectionAssignments:le})=>({participantId:h[te],collectionAssignments:le})))}};for(let se of K.structures||[])if(J(se),Array.isArray(se.structures))for(let ie of se.structures)J(ie);for(let se of K.links||[])se.source.structureId=h[se.source.structureId],se.target.structureId=h[se.target.structureId]}let{extension:Z}=xi({name:Xu,element:B});Array.isArray((c=Z==null?void 0:Z.value)==null?void 0:c.flights)&&((u=Z==null?void 0:Z.value.flights)==null||u.forEach(K=>{if(K.drawId=h[K.drawId],Array.isArray(K.drawEntries))for(let Q of K.drawEntries)Q.participantId=h[Q.participantId]})),g+=1}let v=i.startDate||Lu(new Date),y=(i.participants||[]).filter(({participantType:B})=>B===Hi),b=y.reduce((B,z)=>{var W;let Z=(W=z.person)==null?void 0:W.sex;return[Rn,Kn].includes(Z)?B[Z]+=1:B[Lv]+=1,B},{[Rn]:0,[Kn]:0,[Lv]:0}),I=Object.assign({},...Object.keys(b).map(B=>{var z;return{[B]:((z=tTe({category:{ageCategoryCode:"O18"},count:b[B],addressProps:{citiesCount:10},personExtensions:[],consideredDate:v,sex:B}))==null?void 0:z.persons)||[]}})),T={[Rn]:0,[Kn]:0,[Lv]:0},w=y.length,S=y.reduce((B,z)=>{var W,Z;let K=((Z=(W=z.person)==null?void 0:W.addresses)==null?void 0:Z[0])||{},{city:Q,state:J,postalCode:se}=K;return B.cities.includes(Q)||B.cities.push(Q),B.states.includes(J)||B.states.push(J),B.postalCodes.includes(se)||B.postalCodes.push(se),B},{cities:[],postalCodes:[],states:[]}),U=S.postalCodes.length,P=S.cities.length,E=S.states.length,{cities:R}=XSe({count:P||w,participantsCount:w}),{states:C}=JSe({count:E||w,participantsCount:w}),{postalCodes:M}=QSe({count:U||w,participantsCount:w}),_={cities:R,states:C,postalCodes:M};y.forEach((B,z)=>{var W,Z;let K=B==null?void 0:B.person,Q=(K==null?void 0:K.sex)||Lv,J=(W=Mi(K==null?void 0:K.birthDate))==null?void 0:W.split("-")[0],se=T[Q],ie=I[Q][se];if(T[Q]+=1,J){let[,ce,oe]=((Z=ie==null?void 0:ie.birthDate)==null?void 0:Z.split("-"))||[],te=[J,ce,oe].join("-");ie.birthDate=te}if(K!=null&&K.addresses){let ce=eTe({..._,participantIndex:z,nationalityCode:ie.nationalityCode});ie.addresses=[ce]}ie.personId=(r==null?void 0:r[z])||bn(),e?(ie.standardFamilyName=ie.lastName,ie.standardGivenName=ie.firstName,B.participantName=`${ie.standardGivenName} ${ie.standardFamilyName}`):(ie.standardFamilyName=K==null?void 0:K.standardFamilyName,ie.standardGivenName=K==null?void 0:K.standardGivenName),delete ie.firstName,delete ie.lastName,ie.extensions=p(K),B.person=ie,h[K==null?void 0:K.personId]=ie.personId}),(i.participants||[]).filter(({participantType:B})=>B===Ai).forEach(B=>{let{individualParticipantIds:z}=B;B.participantName=I9e({individualParticipantIds:z,individualParticipants:y})});let A=(i.participants||[]).filter(({participantType:B})=>B===Pn),N=A.length,k=ck({count:N}).names;A.forEach((B,z)=>{B.participantName=k[z]});let O=(i.participants||[]).filter(({participantType:B})=>B===gc),$=O.length,F=ck({count:$,nameRoot:"Group"}).names;O.forEach((B,z)=>{B.participantName=F[z]});let{extension:V}=xi({element:i,name:PI});Array.isArray(V==null?void 0:V.value)&&(V==null||V.value.forEach(B=>{B.tournamentId=h[B.tournamentId],B.structureId=h[B.structureId],B.eventId=h[B.eventId],B.drawId=h[B.drawId]}));let{extension:j}=xi({element:i,name:GU});return Array.isArray(j==null?void 0:j.value)&&(j==null||j.value.forEach(B=>{B.personId=h[B.personId]})),{...pe}}function I9e({individualParticipantIds:t,individualParticipants:e}){let i=e.filter(({participantId:n})=>t.includes(n)).map(({person:n})=>n==null?void 0:n.standardFamilyName).filter(Boolean).sort().join("/");return t.length===1&&(i+="/Unknown"),i}function mTe(t){var e,i,n;let{ratingsParameters:r=Ea,participantsProfile:a={},matchUpStatusProfile:s,completeAllMatchUps:o,autoEntryPositions:l,hydrateCollections:c,randomWinningSide:u,schedulingProfile:d,tournamentRecord:p,autoSchedule:h,eventProfiles:f,periodLength:m,venueProfiles:g,drawProfiles:v,isMock:y,uuids:b}=t;if(!p)return{error:dt};let I=[],T=[],w=[];f==null||f.forEach(C=>{var M;let _=(M=p.events)==null?void 0:M.find((A,N)=>C.eventIndex!==void 0&&N===C.eventIndex||C.eventName&&A.eventName===C.eventName||C.eventId&&A.eventId===C.eventId);_!=null&&_.gender&&(C.gender=_.gender)});let S=((e=p.participants)==null?void 0:e.length)||void 0;S&&a!=null&&a.idPrefix&&(a.idPrefix=`${a.idPrefix}-${S}`);let U=iTe({startDate:p.startDate,participantsProfile:a,tournamentRecord:p,eventProfiles:f,drawProfiles:v,uuids:b});if(!U.success)return U;if(f){let C=((i=p.events)==null?void 0:i.length)||0;for(let M of f){let{ratingsParameters:_}=M,A=(n=p.events)==null?void 0:n.find((N,k)=>M.eventIndex!==void 0&&k===M.eventIndex||M.eventName&&N.eventName===M.eventName||M.eventId&&N.eventId===M.eventId);if(A){let{gender:N,category:k,eventType:O}=A,{drawProfiles:$,publish:F}=M,V=Br(kp)(O)&&Hi||Br(Yc)(O)&&Ai||O;if($){let{stageParticipantsCount:j,uniqueParticipantsCount:B,uniqueParticipantStages:z}=nTe({drawProfiles:$,category:k,gender:N}),{uniqueDrawParticipants:W=[],uniqueParticipantIds:Z=[]}=z?oTe({event:{eventType:O,category:k,gender:N},uniqueParticipantsCount:B,participantsProfile:a,ratingsParameters:_,tournamentRecord:p,eventProfile:M,uuids:b}):{};I.push(...Z);let{stageParticipants:K}=rTe({targetParticipants:p.participants||[],allUniqueParticipantIds:I,stageParticipantsCount:j,eventParticipantType:V}),Q=lTe({uniqueDrawParticipants:W,autoEntryPositions:l,stageParticipants:K,tournamentRecord:p,drawProfiles:$,category:k,gender:N,event:A});if(Q.error||(Q=sTe({matchUpStatusProfile:s,completeAllMatchUps:o,randomWinningSide:u,tournamentRecord:p,drawProfiles:$,isMock:y,event:A}),Q.error))return Q;w.push(...Q.drawIds)}F&&r1({tournamentRecord:p,event:A})}else{let N=cTe({startDate:p.startDate,allUniqueParticipantIds:I,matchUpStatusProfile:s,participantsProfile:a,completeAllMatchUps:o,autoEntryPositions:l,randomWinningSide:u,ratingsParameters:_,tournamentRecord:p,eventProfile:M,eventIndex:C,uuids:b});if(N.error)return N;let{eventId:k,drawIds:O,uniqueParticipantIds:$}=N;O&&w.push(...O),T.push(k),$!=null&&$.length&&I.push(...$),C+=1}}}if(v){let C=(p.events||[]).map(M=>{var _;return((_=M.drawDefinitions)==null?void 0:_.map(()=>1))||[]}).flat().reduce((M,_)=>M+_,0);for(let M of v){let _=b2({startDate:p.startDate,allUniqueParticipantIds:I,matchUpStatusProfile:s,participantsProfile:a,completeAllMatchUps:o,autoEntryPositions:l,hydrateCollections:c,randomWinningSide:u,ratingsParameters:r,tournamentRecord:p,drawProfile:M,drawIndex:C,uuids:b});if(_.error)return _;let{drawId:A,eventId:N,event:k,uniqueParticipantIds:O}=_;if(_=i1({tournamentRecord:p,event:k,internalUse:!0}),_.error)return _;A&&w.push(A),T.push(N),O!=null&&O.length&&I.push(...O),C+=1}}let P=g!=null&&g.length?$9({tournamentRecord:p,venueProfiles:g}):[],E,R={};if(d!=null&&d.length){let C={[p.tournamentId]:p},M=e1({tournamentRecords:C,schedulingProfile:d});if(M.error)return M;if(h){let{tournamentId:_}=p,A={[_]:p};R=v2({tournamentRecords:A,periodLength:m})}}return{totalParticipantsCount:p.participants.length,scheduledRounds:E,schedulerResult:R,...pe,eventIds:T,venueIds:P,drawIds:w}}var gTe={};Fi(gTe,{addDynamicRatings:()=>d7,addIndividualParticipantIds:()=>u2,addParticipant:()=>$p,addParticipants:()=>ed,addPenalty:()=>LTe,addPersonRequests:()=>STe,addPersons:()=>FTe,createGroupParticipant:()=>CTe,createTeamsFromParticipantAttributes:()=>k9,deleteParticipants:()=>Ow,filterParticipants:()=>FR,findParticipant:()=>PTe,getCompetitionParticipants:()=>D7,getPairedParticipant:()=>Qu,getParticipantEventDetails:()=>E7,getParticipantMembership:()=>P7,getParticipantScaleItem:()=>ST,getParticipantSchedules:()=>C7,getParticipantSignInStatus:()=>R7,getParticipantTimeItem:()=>n8,getParticipants:()=>br,getScaleValues:()=>VU,mergeParticipants:()=>OTe,modifyIndividualParticipantIds:()=>TTe,modifyParticipant:()=>d2,modifyParticipantName:()=>RTe,modifyParticipantOtherName:()=>DTe,modifyParticipantsSignInStatus:()=>UTe,modifyPenalty:()=>kTe,modifyPersonRequests:()=>ITe,mutate:()=>vTe,participantScaleItem:()=>Rh,query:()=>b0e,regenerateParticipantNames:()=>ETe,removeIndividualParticipantIds:()=>T8,removeParticipantIdsFromAllTeams:()=>yF,removePenalty:()=>ATe,removePersonRequests:()=>wTe,removeRatings:()=>NTe,scaledTeamAssignment:()=>MTe,setParticipantScaleItem:()=>tM,setParticipantScaleItems:()=>hwe,validateLineUp:()=>IF});var vTe={};Fi(vTe,{addDynamicRatings:()=>d7,addIndividualParticipantIds:()=>u2,addParticipant:()=>$p,addParticipants:()=>ed,addPenalty:()=>LTe,addPersonRequests:()=>STe,addPersons:()=>FTe,createGroupParticipant:()=>CTe,createTeamsFromParticipantAttributes:()=>k9,deleteParticipants:()=>Ow,findParticipant:()=>PTe,mergeParticipants:()=>OTe,modifyIndividualParticipantIds:()=>TTe,modifyParticipant:()=>d2,modifyParticipantName:()=>RTe,modifyParticipantOtherName:()=>DTe,modifyParticipantsSignInStatus:()=>UTe,modifyPenalty:()=>kTe,modifyPersonRequests:()=>ITe,regenerateParticipantNames:()=>ETe,removeIndividualParticipantIds:()=>T8,removeParticipantIdsFromAllTeams:()=>yF,removePenalty:()=>ATe,removePersonRequests:()=>wTe,removeRatings:()=>NTe,scaledTeamAssignment:()=>MTe,setParticipantScaleItem:()=>tM,setParticipantScaleItems:()=>hwe});function yTe(t=0){(typeof t!="number"||isNaN(t))&&(t=0);let e=new Date;return e.setHours(e.getHours()+t),e.getTime().toString(36).slice(-6).toUpperCase()}function bTe({personRequests:t,personId:e,requests:i}){t[e]||(t[e]=[]);let n=i.filter(({requestType:r})=>r).map(r=>{let{date:a,startTime:s,endTime:o}=r;return r.requestType===hM&&(a=Mi(a),s=sr(s),o=sr(o),a&&s&&o)?{date:a,startTime:s,endTime:o,requestType:r.requestType}:r}).filter(Boolean);for(let r of n)r.requestId=yTe(),t[e].push(r);return{mergeCount:n.length}}function B9(t){let{tournamentRecords:e,personRequests:i}=t,n=ei(t,[{[Os]:!0}]);if(n.error)return n;if(!i)return{...pe};let r=Object.values(e);for(let a of r){let s=a.participants??[],o=[];for(let l of Object.keys(i))if(Ig({tournamentParticipants:s,personId:l})){let c=i[l];c.length&&o.push({personId:l,requests:c})}Object.keys(o).length&&pn({element:a,extension:{value:o,name:GU}})}return{...pe}}function ITe(t){let{tournamentRecords:e,requests:i,personId:n}=t,r=ei(t,[{[Os]:!0},{requests:!0,[Wo]:Ms,[cc]:Ae}]);if(r.error)return r;let a=i.map(({requestId:c})=>c).filter(Boolean),{personRequests:s}=ob({tournamentRecords:e}),o=c=>{s&&(s[c]=s[c].map(u=>{if(!a.includes(u.requestId))return u;let d=i.find(p=>p.requestId===u.requestId);if(d.requestType)return Object.assign(u,d)}).filter(Boolean))};if(n&&s!=null&&s[n])o(n);else if(s)for(let c of Object.keys(s))o(c);let l=i.filter(c=>!c.requestId);return l.length&&bTe({personRequests:s,personId:n,requests:l}),B9({tournamentRecords:e,personRequests:s})}function wTe(t){let{tournamentRecords:e,requestType:i,requestId:n,personId:r,date:a}=t,s=ei(t,[{[Os]:!0}]);if(s.error)return s;let{personRequests:o}=ob({tournamentRecords:e}),l=u=>{var d;o&&(o[u]=o[u].filter(p=>(!i||p.requestType!==i)&&(!n||p.requestId!==n)&&(!a||p.date!==a)),(d=o==null?void 0:o[u])!=null&&d.length||delete o[u])},c=!i&&!n&&!r&&!a;if(!c){if(r&&o!=null&&o[r])l(r);else if(o)for(let u of Object.keys(o))l(u)}return c||!o||!Object.keys(o).length?uo({name:GU,tournamentRecords:e,discover:!0}):B9({tournamentRecords:e,personRequests:o})}function STe(t){let{tournamentRecords:e,personId:i,requests:n}=t,r=ei(t,[{[Os]:!0,[dqe]:!0},{requests:!0,[Wo]:Ms,[cc]:Ae}]);if(r.error)return r;let{personRequests:a}=ob({tournamentRecords:e}),{mergeCount:s}=bTe({personRequests:a,personId:i,requests:n});return s&&a?B9({tournamentRecords:e,personRequests:a}):{error:Ae}}function TTe({individualParticipantIds:t,groupingParticipantId:e,tournamentRecord:i}){let n="modifyIndividualParticipantIds";if(!i)return fe({result:{error:dt},stack:n});if(!e||!t)return fe({result:{error:si},stack:n});let r=i.participants||[],a=r.find(h=>h.participantId===e);if(!a)return fe({result:{error:Or},stack:n});if(![Pn,gc].includes(a.participantType))return fe({result:{error:Od},context:{participantType:a.participantType},stack:n});let s=t.filter(h=>{var f;return((f=r.find(m=>m.participantId===h))==null?void 0:f.participantType)!==Hi});if(s.length)return fe({result:{error:Pl,invalidParticipantIds:s},stack:n});let o=a.individualParticipantIds||[],l=t.filter(h=>!o.includes(h)),c=o.filter(h=>!t.includes(h)),u=u2({individualParticipantIds:l,groupingParticipantId:e,tournamentRecord:i});if(u.error)return fe({result:u,stack:n});let d=T8({individualParticipantIds:c,groupingParticipantId:e,tournamentRecord:i});if(d.error)return fe({result:d,stack:n});let{topics:p}=ru();if(p.includes(Ss)){let h=r.find(({participantId:f})=>f===e);Ti({topic:Ss,payload:{tournamentId:i.tournamentId,participants:[h]}})}return{...u,...d}}function UTe({tournamentRecord:t,participantIds:e,signInState:i}){if(!t)return{error:dt};if(!Array.isArray(e))return{error:si};if(![YE,Yye].includes(i))return{error:Ae,signInState:i};let n=t.participants||[];if(!n.length)return{error:sR};let r=n.map(Gi),a=e.filter(c=>!r.includes(c));if(a.length)return{error:Ae,context:{invalidParticipantIds:a}};let s=[],o=new Date().toISOString();for(let c of n){let{participantId:u}=c;if(e.includes(u)){let d=Q8({duplicateValues:!1,tournamentRecord:t,participantId:u,timeItem:{itemType:IR,itemValue:i,createdAt:o}});if(d.error)return d;s.push(c)}}let{topics:l}=ru();return s.length&&l.includes(Ss)&&Ti({topic:Ss,payload:{tournamentId:t.tournamentId,participants:s}}),{...pe}}function DTe({tournamentRecord:t,participantId:e,participantOtherName:i}){if(!t)return{error:dt};if(!e)return{error:da};let{participant:n}=ev({tournamentRecord:t,participantId:e});if(!n)return{error:Or};n.participantOtherName=i;let{topics:r}=ru();return r.includes(Ss)&&Ti({topic:Ss,payload:{tournamentId:t.tournamentId,participants:[n]}}),{...pe}}function LJ({personFormat:t,person:e}){let i=m=>m.replace(/\W/g,""),n=m=>/^[a-z]*$/.test(i(m)),r=m=>/^[A-Z]*$/.test(i(m)),a=m=>/^[LAST]{4}/.test(i(m)),s=m=>m.toLowerCase().indexOf("l")<m.toLowerCase().indexOf("f"),o=m=>m.indexOf(",")>=0,l=m=>m.toLowerCase().indexOf("f.")>=0,c=m=>m.toLowerCase().indexOf("f")<0,u=m=>m.indexOf(" ")>0;if(!e)return;let d=u(t)?" ":"",p=rG((e==null?void 0:e.standardGivenName)??""),h=rG((e==null?void 0:e.standardFamilyName)??"");if(!t)return`${p}${d}${h}`;l(t)&&!o(t)&&!s(t)&&(p=`${p[0]}.`),n(t)?(p=p.toLowerCase(),h=h.toLowerCase()):r(t)?(p=p.toUpperCase(),h=h.toUpperCase()):a(t)&&(h=h.toUpperCase());let f=`${p}${d}${h}`;return c(t)?f=h:s(t)&&(o(t)?f=`${h},${d}${p}`:f=`${h}${d}${p}`),f}function w9e({participantMap:t,participant:e,formats:i}){let{participantType:n,individualParticipantIds:r,person:a}=e,s=n&&i[n];if(n!==$o&&s){let{personFormat:o,doublesJoiner:l}=s;n===Hi&&(e.participantName=LJ({person:a,personFormat:o})),n===Ai&&(e.participantName=r==null?void 0:r.map(c=>{var u;let d=(u=t[c])==null?void 0:u.person;return LJ({person:d,personFormat:o})}).filter(Boolean).join(l??"/"))}}function ETe({tournamentRecord:t,formats:e}){if(!t)return{error:dt};if(!tn(e))return{error:si};let i=t.participants??[],n=qme(i,"participantId");for(let r of i)w9e({participant:r,participantMap:n,formats:e});return{...pe}}function PTe(t){let{tournamentRecord:e,policyDefinitions:i,contextProfile:n,participantId:r,personId:a}=t,s=t.tournamentRecords||e&&{[e.tournamentId]:e}||{};if(typeof r!="string"&&typeof a!="string")return{error:si,stack:"publicFindParticipant"};let o,l;for(let c of Object.values(s)){l=c.tournamentId;let u=c.participants||[];if(o=Ig({tournamentParticipants:u,internalUse:!0,policyDefinitions:i,contextProfile:n,participantId:r,personId:a}),o)break}return{participant:o,tournamentId:l,...pe}}function CTe({individualParticipantIds:t=[],participantRoleResponsibilities:e,participantRole:i=xbe,tournamentRecord:n,participantId:r,groupName:a}){if(!n)return{error:dt};if(!a)return{error:si,info:"Missing groupName"};if(!Array.isArray(t))return{info:"Invalid individualParticipantIds",error:Ae};let s=(br({participantFilters:{participantTypes:[Hi]},tournamentRecord:n}).participants??[]).map(u=>u.participantId);for(let u of t)if(!s.includes(u))return{error:Od,participantId:u};let o=Zt({participantId:r||bn(),participantRoleResponsibilities:e,participantName:a,individualParticipantIds:t,participantType:gc,participantRole:i}),l=$p({participant:o,tournamentRecord:n});if(l.error)return l;let{topics:c}=ru();return c.includes(Sg)&&Ti({topic:Sg,payload:{tournamentId:n.tournamentId,participants:[o]}}),{...pe,participant:$t(o)}}function RTe({tournamentRecord:t,participantName:e,participantId:i}){if(!t)return{error:dt};if(!i)return{error:da};if(!e)return{error:si,info:"Missing participantName"};let{participant:n}=ev({tournamentRecord:t,participantId:i});if(!n)return{error:Or};n.participantName=e;let{topics:r}=ru();return r.includes(Ss)&&Ti({topic:Ss,payload:{tournamentId:t.tournamentId,participants:[n]}}),{...pe}}function MTe({clearExistingAssignments:t=!0,individualParticipantIds:e,reverseAssignmentOrder:i,initialTeamIndex:n=0,scaledParticipants:r=[],teamParticipantIds:a,tournamentRecord:s,scaleAttributes:o,teamNameBase:l,teamsCount:c,eventId:u,event:d}){var p,h,f,m,g;if(!s)return{error:dt};if(!Array.isArray(a)&&!wi(c)&&!u||!wi(n)||r&&!Array.isArray(r)||o&&(typeof o!="object"||!Object.keys(o).length))return{error:Ae};if(!o&&!r.length||!r&&!(e&&o))return{error:si,info:"Missing scaling details"};if(u&&!a){if((d==null?void 0:d.eventType)!==Fl)return{error:jh};a=(p=d==null?void 0:d.entries)==null?void 0:p.filter(({entryStatus:w})=>w===dl).map(Gi)}if(!(a!=null&&a.length)&&!c)return{info:"Missing teamParticipantIds or teamsCount",error:si};let v=e??r.map(({participantId:w})=>w);i&&(a==null||a.reverse(),n+=1),n>((a==null?void 0:a.length)||0)-1&&(n=0);let y=(a==null?void 0:a.slice(n).concat(...a.slice(0,n)))??[],b=[];for(let w of s.participants??[]){let{participantId:S,participantType:U}=w;if(y.includes(S)){if(U!==$o)return{error:Od,participant:w};b.push(w)}}if(c&&b.length<c){let w=c-((b==null?void 0:b.length)||0),S=l??"Team",U=Mt(0,w).map(C=>({participantName:`${S} ${C+1}`,participantType:$o,participantRole:vs})),{participants:P=[]}=ed({participants:U,returnParticipants:!0,tournamentRecord:s}),E=P.map(Gi),R=((h=s.participants)==null?void 0:h.filter(({participantId:C})=>E.includes(C)))??[];b.push(...R)}if(!b.length)return{error:i6};if(t)for(let w of b)w.individualParticipantIds=[];else{let w=b.map(S=>S).flat();e!=null&&e.length?v=v.filter(S=>!w.includes(S)):r=r==null?void 0:r.filter(({participantId:S})=>!w.includes(S))}if(!(e!=null&&e.length)&&!(r!=null&&r.length))return{error:ML,info:"Nothing to be done"};if(!r.length){for(let w of s.participants??[]){let{participantId:S,participantType:U}=w;if(!v.includes(S))continue;if(U!==Hi)return{error:Od,participant:w};let P=(f=Rh({scaleAttributes:o,participant:w}))==null?void 0:f.scaleItem,E=o!=null&&o.accessor?(m=P==null?void 0:P.scaleValue)==null?void 0:m[o==null?void 0:o.accessor]:P==null?void 0:P.scaleValue,R={participantId:S,scaleValue:E};r.push(R)}if(!r.length)return{error:Or}}r.sort((w,S)=>o!=null&&o.sortOrder?((S==null?void 0:S.scaleValue)||0)-((w==null?void 0:w.scaleValue)||0):((w==null?void 0:w.scaleValue)||1/0)-((S==null?void 0:S.scaleValue)||1/0));for(let w of r)if(!w.participantId)return{error:Ae,scaledParticipant:w};let I=0;for(;I<r.length;){for(let w of b){if(I+1>r.length)break;let S=r[I];w.individualParticipantIds.push(S.participantId),I++}b.reverse()}let T=b.map(Gi);for(let w of s.events??[]){if(w.eventType!==Fl)continue;let S=(w.entries??[]).filter(U=>T.includes(U.participantId));for(let U of S){let P=U.participantId,E=(g=b.find(C=>C.participantId===P))==null?void 0:g.individualParticipantIds;w.entries=(w.entries??[]).filter(C=>!E.includes(C.participantId)),(w.drawDefinitions??[]).forEach(C=>{C.entries=(C.entries??[]).filter(M=>!E.includes(M.participantId))});let{flightProfile:R}=kr({event:w});((R==null?void 0:R.flights)||[]).forEach(C=>{C.drawEntries=(C.drawEntries||[]).filter(M=>!E.includes(M.participantId))})}}return{...pe,scaledParticipants:r}}function NTe(t){let e=ei(t,[{[Ia]:!0,[P6]:!0},{ratingType:!1,[ps]:s=>Ea[s]}]);if(e.error)return e;let i=`${t.ratingType}.${N6}`,n=t.asDynamic?i:t.ratingType,r=[vy,rg,t.eventType,n].join("."),a=t.tournamentRecord.participants??[];for(let s of a)s.timeItems&&(s.timeItems=s.timeItems.filter(o=>o.itemType!==r));return{...pe}}function ATe(t){let{tournamentRecords:e}=t;if(typeof e!="object"||!Object.keys(e).length)return{error:Tr};for(let i of Object.values(e)){let n=S9e({...t,tournamentRecord:i});if(n.error&&n.error!==sT)return n}return{...pe}}function S9e({tournamentRecord:t,penaltyId:e}){if(!t)return{error:dt};if(!e)return{error:X5};let i=(t==null?void 0:t.participants)??[],n=[],r=!1,a;return i.forEach(s=>{let o=!1;s.penalties=(s.penalties??[]).filter(l=>(l.penaltyId===e&&(o=!0,r||(a=l,r=!0)),o&&n.push(s),l.penaltyId!==e))}),a&&Ti({topic:Ss,payload:{tournamentId:t.tournamentId,participants:n}}),a?{...pe,penalty:a}:{error:sT}}var T9e=({penaltyId:t=bn()}={})=>({refereeParticipantId:void 0,penaltyCode:void 0,penaltyType:void 0,extensions:void 0,matchUpId:void 0,createdAt:void 0,issuedAt:void 0,notes:void 0,penaltyId:t}),_Te=T9e;function kTe(t){let{tournamentRecords:e}=t;if(typeof e!="object"||!Object.keys(e).length)return{error:Tr};for(let i of Object.values(e)){let n=U9e({...t,tournamentRecord:i});if(n.error&&n.error!==sT||n.success)return n}return{error:sT}}function U9e({tournamentRecord:t,modifications:e,penaltyId:i}){if(!t)return{error:dt};if(!e)return{error:Ae,modifications:e};if(!i)return{error:X5};let n=(t==null?void 0:t.participants)??[],r=Object.keys(_Te()).filter(l=>l!=="penaltyId"),a=Object.keys(e).filter(l=>r.includes(l));if(!a.length)return{error:NL};let s,o=[];return n.forEach(l=>{let c=!1;l.penalties=(l.penalties??[]).map(u=>(u.penaltyId===i&&(c=!0,a.forEach(d=>Object.assign(u,{[d]:e[d]})),s||(s=u)),u)),c&&o.push(l)}),s&&Ti({topic:Ss,payload:{tournamentId:t.tournamentId,participants:o}}),s?{...pe,penalty:s}:{error:sT}}function xTe(t,e,i){return!t&&e?e:t&&!e||typeof t!="object"||typeof e!="object"?t:Pi(Object.keys(t).concat(Object.keys(e))).reduce((n,r)=>{if(!e[r])n[r]=t[r];else if(!t[r])n[r]=e[r];else if(typeof t[r]!=typeof e[r])n[r]=e[r];else if(Array.isArray(t[r]))if(i===!0||Array.isArray(i)&&i.includes(r)){let a=Pi(t[r].map(s=>JSON.stringify(s)).concat(e[r].map(s=>JSON.stringify(s)))).map(s=>JSON.parse(s));n[r]=a}else n[r]=e[r];else typeof t[r]=="object"?n[r]=xTe(t[r],e[r],i):n[r]=e[r];return n},{})}function OTe({participants:t=[],tournamentRecord:e,arraysToMerge:i}){if(!e)return{error:dt};e.participants||(e.participants=[]);let n=t.filter(Bl(qh)).map(c=>({[c.participantId]:c})),r=Object.assign({},...n),a=[];e.participants=e.participants.map(c=>{if(r[c.participantId]){let u=xTe(c,r[c.participantId],i);return a.push(u),u}return c});let s=e.participants.map(Bl(qh))||[],o=t.filter(({participantId:c})=>!s.includes(c)),{topics:l}=ru();return o.length&&(e.participants=e.participants.concat(...o),l.includes(Sg)&&Ti({topic:Sg,payload:{participants:o}})),a.length&&l.includes(Ss)&&Ti({topic:Ss,payload:{tournamentId:e.tournamentId,participants:a}}),{modifiedParticipantsCount:a.length,newParticipantsCount:o.length,...pe}}function LTe(t){var e;let{tournamentRecord:i,participantIds:n}=t,r=t.tournamentRecords??(i&&{[i.tournamentId]:i})??{},a;for(let s of Object.values(r)){let o=(e=br({tournamentRecord:s}).participants??[])==null?void 0:e.map(Gi).filter(l=>n.includes(l));o.length&&(a=D9e({...t,penaltyId:t.penaltyId??a,tournamentRecord:s,participantIds:o}).penaltyId)}return a?{...pe,penaltyId:a}:{error:Or}}function D9e({refereeParticipantId:t,tournamentRecord:e,participantIds:i,penaltyCode:n,penaltyType:r,extensions:a,penaltyId:s,matchUpId:o,issuedAt:l,notes:c}){if(!e)return{error:dt};if(!i)return{error:da};if(!r)return{error:Lge};let u=((e==null?void 0:e.participants)??[]).filter(h=>i.includes(h.participantId));if(!u.length)return{error:Or};let d=new Date().toISOString(),p=Object.assign(_Te({penaltyId:s}),{refereeParticipantId:t,penaltyCode:n,penaltyType:r,matchUpId:o,createdAt:d,issuedAt:l,notes:c});return Array.isArray(a)&&a.forEach(h=>pn({element:p,extension:h})),u.forEach(h=>{h.penalties||(h.penalties=[]),h.penalties.push(p)}),Ti({topic:Ss,payload:{tournamentId:e.tournamentId,participants:u}}),{...pe,penaltyId:p.penaltyId}}function FTe({participantRole:t=vs,tournamentRecord:e,persons:i}){var n;if(!e)return{error:dt};if(!Array.isArray(i))return{error:Ae};if(!Object.keys(S8).includes(t))return{error:Ege};let r=(e.participants||[]).map(({person:m})=>m==null?void 0:m.personId).filter(Boolean),a=[],s=i.filter(m=>m&&(!m.personId||!r.includes(m.personId))).map(m=>(m.personId||(m.personId=bn()),a.push(m.personId),m)),o=(m,g)=>Object.assign({},...Object.keys(m).filter(v=>!g.includes(v)).map(v=>({[v]:m[v]}))),l=s.map(m=>Zt({extensions:m.participantExtensions,timeItems:m.participantTimeItems,participantType:Hi,participantRole:t,person:o(m,["participantExtensions","participantTimeItems","pairedPersons"])})),c=0,u=0,d=ed({participants:l,tournamentRecord:e});if(d.error)return d;u=d.addedCount||0;let p=[],h=((n=br({participantFilters:{participantTypes:[Hi]},tournamentRecord:e}))==null?void 0:n.participants)??[];if(t===vs&&i.filter(({pairedPersons:m})=>m).forEach(({personId:m,pairedPersons:g})=>{Array.isArray(g)&&g.forEach(v=>{let y=[m,v.personId].map(b=>Ig({tournamentParticipants:h,personId:b})).filter(Boolean);if(y.length===2){let b=y.map(Gi);p.push(Zt({extensions:v.participantExtensions,timeItems:v.timeItems,participantRole:vs,individualParticipantIds:b,participantType:Ai}))}})}),p.length){if(d=ed({participants:p,tournamentRecord:e}),d.error)return d;c=d.addedCount||0}let f=u+c;return{...pe,addedCount:f,newPersonIds:a}}var $Te={};Fi($Te,{bulkUpdatePublishedEventIds:()=>L7,getAllEventData:()=>F7,getCourtInfo:()=>hF,getDrawData:()=>zF,getEventData:()=>qF,getEventPublishStatus:()=>cu,getPublishState:()=>xw,getTournamentPublishStatus:()=>LR,getVenueData:()=>bT,mutate:()=>BTe,publishEvent:()=>r1,publishEventSeeding:()=>VTe,publishOrderOfPlay:()=>qTe,publishParticipants:()=>zTe,query:()=>D0e,setEventDisplay:()=>a2,unPublishEvent:()=>WTe,unPublishEventSeeding:()=>jTe,unPublishOrderOfPlay:()=>HTe,unPublishParticipants:()=>GTe});var BTe={};Fi(BTe,{publishEvent:()=>r1,publishEventSeeding:()=>VTe,publishOrderOfPlay:()=>qTe,publishParticipants:()=>zTe,setEventDisplay:()=>a2,unPublishEvent:()=>WTe,unPublishEventSeeding:()=>jTe,unPublishOrderOfPlay:()=>HTe,unPublishParticipants:()=>GTe});function VTe({removePriorValues:t=!0,stageSeedingScaleNames:e,seedingScaleNames:i,tournamentRecord:n,status:r=vc,drawIds:a=[],event:s}){var o,l,c,u;if(!n)return{error:dt};if(!s)return{error:Qn};let d=cu({event:s,status:r}),p=(((o=d==null?void 0:d.seeding)==null?void 0:o.seedingScaleNames)||i)&&{...(l=d==null?void 0:d.seeding)==null?void 0:l.seedingScaleNames,...i},h=(((c=d==null?void 0:d.seeding)==null?void 0:c.stageSeedingScaleNames)||e)&&{...(u=d==null?void 0:d.seeding)==null?void 0:u.stageSeedingScaleNames,...e},f=Zt({stageSeedingScaleNames:h,seedingScaleNames:p,published:!0,drawIds:a});return n1({statusObject:{seeding:f},removePriorValues:t,status:r,event:s}),Ti({topic:Gye,payload:{tournamentId:n.tournamentId,eventId:s.eventId,drawIds:a}}),{...pe}}function jTe({removePriorValues:t=!0,seedingScaleNames:e,tournamentRecord:i,status:n=vc,drawIds:r,stages:a,event:s}){var o,l;if(!i)return{error:dt};if(!s)return{error:Qn};let c=cu({event:s});if(c){let u=c.seeding;if(Array.isArray(a)&&u.stageSeedingScaleNames)for(let d of a)u.stageSeedingScaleNames[d]&&delete u.stageSeedingScaleNames[d];Array.isArray(e)&&u!=null&&u.seedingScaleNames&&(u.seedingScaleNames=u.seedingScaleNames.filter(d=>!e.includes(d))),Array.isArray(r)&&u!=null&&u.drawIds&&(u.drawIds=u.drawIds.filter(d=>!r.includes(d))),(!Object.values(u.stageSeedingScaleNames??{}).length&&!((o=u.seedingScaleNames)!=null&&o.length)&&!((l=u.drawIds)!=null&&l.length)||!a&&!e&&!(r!=null&&r.length))&&(delete u.stageSeedingScaleNames,delete u.seedingScaleNames,delete u.drawIds,u.published=!1),n1({statusObject:{seeding:u},removePriorValues:t,status:n,event:s})}return Ti({topic:Q6,payload:{tournamentId:i.tournamentId,eventId:s.eventId}}),{...pe}}function GTe(t){let e=au(t);if(!Object.keys(e).length)return{error:Tr};for(let i of Object.values(e)){let n=E9e({tournamentRecord:i,...t});if(n.error)return n}return{...pe}}function E9e({removePriorValues:t=!0,tournamentRecord:e,status:i=vc}){if(!e)return{error:dt};let n=`${tv}.${iv}`,{timeItem:r}=su({element:e,itemType:n}),a=(r==null?void 0:r.itemValue)||{[i]:{}};return a[i]&&delete a[i].participants,Zp({timeItem:{itemValue:a,itemType:n},element:e,removePriorValues:t}),Ti({payload:{tournamentId:e.tournamentId},topic:Bqe}),{...pe}}function HTe(t){let e=au(t);if(!Object.keys(e).length)return{error:Tr};for(let i of Object.values(e)){let n=P9e({tournamentRecord:i,...t});if(n.error)return n}return{...pe}}function P9e({removePriorValues:t=!0,tournamentRecord:e,status:i=vc}){if(!e)return{error:dt};let n=`${tv}.${iv}`,{timeItem:r}=su({element:e,itemType:n}),a=(r==null?void 0:r.itemValue)||{[i]:{}};return a[i]&&delete a[i].orderOfPlay,Zp({timeItem:{itemValue:a,itemType:n},element:e,removePriorValues:t}),Ti({topic:e8,payload:{tournamentId:e.tournamentId}}),{...pe}}function zTe(t){let e=au(t);if(!Object.keys(e).length)return{error:Tr};for(let i of Object.values(e)){let n=C9e({tournamentRecord:i,...t});if(n.error)return n}return{...pe}}function C9e({removePriorValues:t,tournamentRecord:e,status:i=vc}){if(!e)return{error:dt};let n=`${tv}.${iv}`,{timeItem:r}=su({element:e,itemType:n}),a=(r==null?void 0:r.itemValue)||{[i]:{}};return a[i].participants={published:!0},Zp({timeItem:{itemValue:a,itemType:n},element:e,removePriorValues:t}),Ti({payload:{tournamentId:e.tournamentId},topic:zye}),{...pe}}function qTe(t){let e=au(t);if(!Object.keys(e).length)return{error:Tr};for(let i of Object.values(e)){let n=R9e({tournamentRecord:i,...t});if(n.error)return n}return{...pe}}function R9e({scheduledDates:t=[],removePriorValues:e,tournamentRecord:i,status:n=vc,eventIds:r=[]}){if(!i)return{error:dt};let a=`${tv}.${iv}`,{timeItem:s}=su({element:i,itemType:a}),o=(s==null?void 0:s.itemValue)||{[n]:{}};return o[n].orderOfPlay={published:!0,scheduledDates:t,eventIds:r},Zp({timeItem:{itemValue:o,itemType:a},element:i,removePriorValues:e}),Ti({topic:Hye,payload:{tournamentId:i.tournamentId,scheduledDates:t,eventIds:r}}),{...pe}}function WTe({removePriorValues:t=!0,tournamentRecord:e,status:i=vc,event:n}){if(!e)return{error:dt};if(!n)return{error:Qn};let r=`${tv}.${iv}`,{timeItem:a}=wR({itemType:r,event:n}),s=(a==null?void 0:a.itemValue)||{[i]:{}};return delete s[i].structureIds,delete s[i].drawDetails,delete s[i].drawIds,$w({event:n,timeItem:{itemValue:s,itemType:r},removePriorValues:t}),n1({statusObject:{structureIds:void 0,drawIds:void 0,seeding:void 0},removePriorValues:t,status:i,event:n}),Ti({topic:J6,payload:{tournamentId:e.tournamentId,eventId:n.eventId}}),{eventId:n.eventId,...pe}}var YTe={};Fi(YTe,{getEntryStatusReports:()=>N9e,getParticipantStats:()=>M9e,getStructureReports:()=>_9e,getVenuesReport:()=>x9e});function M9e({withCompetitiveProfiles:t,opponentParticipantId:e,withIndividualStats:i,teamParticipantId:n,tournamentRecord:r,withScaleValues:a,tallyPolicy:s,matchUps:o}){var l,c,u,d,p;if(!r)return{error:dt};if(o&&!Array.isArray(o))return{error:cl};if(o=o??Za({tournamentRecord:r,participantsProfile:a?{withScaleValues:a}:void 0}).matchUps,!(o!=null&&o.length))return{error:Em};let h=[];e&&h.push(e),n&&h.push(n);let f=h.length?{participantIds:h}:{participantTypes:[$o]},m=br({participantFilters:f,tournamentRecord:r}).participants??[];if(!m.every(({participantType:C})=>C===$o))return{error:Pl};h.length||h.push(...m.map(Gi));let g=new Map,v=new Map,y=new Map,b=new Map,I=(C,M="")=>v.get(C)||v.set(C,{participantName:M,participantId:C,competitorIds:[],competitiveness:{},matchUpStatuses:{},tiebreaks:[0,0],matchUps:[0,0],points:[0,0],games:[0,0],sets:[0,0]})&&v.get(C);for(let C of m){let{participantId:M,individualParticipantIds:_}=C;b.set(M,_??[]),I(M,C.participantName)}if(n&&!b.get(n))return fe({result:{error:Or},context:{teamParticipantId:n}});if(e&&!b.get(e))return fe({result:{error:Or},context:{opponentParticipantId:e}});let T=[],w=C=>{let M=[[],[]];for(let A of C){let N=A.participant;if(N!=null&&N.participantName){g.set(N.participantId,{participantName:N.participantName,ratings:N.ratings});let k=v.get(N.participantId);k&&(k.participantName=N.participantName)}}let _=({side:A,individualParticipantIds:N})=>{var k,O,$,F,V;return A.participantId&&(!(N!=null&&N.length)||N.includes(A.participantId))&&[A.participantId]||((O=(k=A.participant)==null?void 0:k.individualParticipantIds)==null?void 0:O.length)&&(!(N!=null&&N.length)||Ar(N,($=A.participant)==null?void 0:$.individualParticipantIds).length===((V=(F=A.participant)==null?void 0:F.individualParticipantIds)==null?void 0:V.length))&&A.participant.individualParticipantIds};if(b.size){let A=(N,k)=>{for(let O of C){if(!O.participant)continue;let $=_({individualParticipantIds:k,side:O});if($!=null&&$.length){let F=O.sideNumber;if(!F)continue;let V=[N];i&&V.push(...$),M[F-1]=V;let j=v.get(N);for(let B of $.filter(Boolean))j&&!j.competitorIds.includes(B)&&j.competitorIds.push(B)}}};if(n)(!e||C.every(N=>N.participant&&(_({individualParticipantIds:b.get(n),side:N})||_({individualParticipantIds:b.get(e),side:N}))))&&A(n,b.get(n));else for(let[N,k]of b)A(N,k)}else if(i)for(let A of C){if(!A.participant)continue;let N=_({individualParticipantIds:[],side:A}),k=A.sideNumber;k&&(M[k-1]=N)}return M};for(let C of o){if(!tn(C))return{error:cl};let{matchUpStatus:M,matchUpFormat:_,matchUpType:A,winningSide:N,score:k,sides:O}=C;if(!O||!k||A===ac||M===gn)continue;let $=w(O);if(!$.filter(Boolean).length)continue;let F=t&&N&&((l=MR({matchUp:C}))==null?void 0:l.competitiveness);T.push(C);let V=q8({matchUpStatus:M,matchUpFormat:_,tallyPolicy:s,winningSide:N,score:k}),j=RIe({matchUpStatus:M,matchUpFormat:_,tallyPolicy:s,winningSide:N,score:k}),{pointsTally:B,tiebreaksTally:z}=MIe({matchUpFormat:_,score:k});$.forEach((W,Z)=>{var K;for(let Q of W){let J=(K=g.get(Q))==null?void 0:K.participantName,se=I(Q,J);if(se){let ie=(ne,me)=>me.forEach((be,Se)=>se[ne][Se]+=be),ce=Z?[...z].reverse():z,oe=Z?[...B].reverse():B,te=Z?[...j].reverse():j,le=Z?[...V].reverse():V;if(ie("tiebreaks",ce),ie("points",oe),ie("games",te),ie("sets",le),N){let ne=N-1===Z?0:1;se.matchUps[ne]+=1}if(F){let ne=F.toLowerCase();se.competitiveness[ne]||(se.competitiveness[ne]=[0,0]),se.competitiveness[ne][Z]+=1}if(M){let ne=M.toLowerCase();se.matchUpStatuses[ne]||(se.matchUpStatuses[ne]=0),se.matchUpStatuses[ne]+=1}}}})}let S=["tiebreaks","matchUps","points","games","sets"],U=["competitive","routine","decisive"],P=new Map,E=(C,M)=>(C??0)+(M??0);for(let[C,M]of v.entries()){for(let _ of S){let A=M[_].reduce(E);if(A){let N=M[_][0]/A,k=`${_}Ratio`,O=parseFloat(N.toFixed(2));M[k]=O,y.set(C,!0),P.has(k)||P.set(k,[]),(c=P.get(k))==null||c.push(O)}}for(let _ of U){let A=(d=(u=M.competitiveness)==null?void 0:u[_])==null?void 0:d.reduce(E);if(A){let N=M.competitiveness[_][0]/A,k=`${_}Ratio`,O=parseFloat(N.toFixed(2));M[k]=O}}}if(!n){let C=(M,_)=>_-M;for(let M of v.values())for(let _ of S){let A=`${_}Ratio`;if(typeof M[A]=="number"){let N=(p=P.get(A))==null?void 0:p.sort(C).indexOf(M[A]);if(typeof N=="number"&&N>=0){let k=`${_}Rank`;M[k]=N+1}}}}let R={relevantMatchUps:T,...pe};return n?(R.teamStats=v.get(n),e&&(R.opponentStats=v.get(e))):R.participatingTeamsCount=y.size,R.allParticipantStats=[...v.values()],R}function pk({participant:t,eventType:e}){var i,n,r,a,s,o;let l=(i=t==null?void 0:t.person)==null?void 0:i.personId,c=(r=(n=t==null?void 0:t.person)==null?void 0:n.personOtherIds)==null?void 0:r[0],u=(a=t==null?void 0:t.person)==null?void 0:a.tennisId,d=(o=(s=t==null?void 0:t.ratings)==null?void 0:s[e])==null?void 0:o.find(({scaleName:m})=>m===z8),p=d==null?void 0:d.scaleValue,{wtnRating:h,confidence:f}=p||{};return{timeStamp:d==null?void 0:d.scaleDate,personOtherId:c,confidence:f,wtnRating:h,personId:l,tennisId:u}}function N9e({tournamentRecord:t}){if(!t)return{error:dt};let e=t.tournamentId,{participantMap:i}=br({withScaleValues:!0,withEvents:!0,withSeeding:!0,tournamentRecord:t,withDraws:!0}),n=(Za({matchUpFilters:{matchUpTypes:[Wb,py]},tournamentRecord:t}).matchUps??[]).flatMap(({sides:h,matchUpType:f})=>h==null?void 0:h.flatMap(m=>{var g,v;return f===py?(g=m==null?void 0:m.participant)==null?void 0:g.individualParticipantIds:((v=m==null?void 0:m.participant)==null?void 0:v.participantId)||m.participantId}).filter(Boolean)).filter(Boolean),r=[],a={},s={},o={},l=0,c=({id:h,entry:f,eventId:m,eventType:g})=>{var v;let{qualifyingSeeding:y,mainSeeding:b,entryStatus:I,entryStage:T,drawId:w}=f;a[h]||(a[h]=[]);let{participant:S,events:U}=(i==null?void 0:i[h])??{},P=pk({participant:S,eventType:g}),E=(v=U==null?void 0:U[m])==null?void 0:v.ranking;I===B8&&r.push(h),a[h].push({participantType:S==null?void 0:S.participantType,participantId:h,tournamentId:e,eventType:g,eventId:m,drawId:w,entryStatus:I,entryStage:T,...P,ranking:E,mainSeeding:b,qualifyingSeeding:y})};for(let h of t.events??[]){let f={},m=S=>{f[S]||(f[S]={count:0}),f[S].count+=1},{drawDefinitions:g=[],eventType:v,eventId:y}=h,b=g.flatMap(S=>{let{drawId:U,entries:P}=S;l+=1;let E=({stage:_,stageSequence:A})=>_===Bt&&A===1||_===ri,R=(S.structures??[]).filter(E).flatMap(({positionAssignments:_})=>_).filter(Boolean).map(({participantId:_})=>_),C=({participantId:_})=>R.includes(_),M=_=>{var A,N,k,O,$,F,V,j;let{participantId:B,entryStatus:z,entryStage:W}=_;m(z);let Z=(O=(k=(N=(A=i==null?void 0:i[B])==null?void 0:A.draws)==null?void 0:N[U])==null?void 0:k.seedAssignments)==null?void 0:O[Bt];return{qualifyingSeeding:(j=(V=(F=($=i==null?void 0:i[B])==null?void 0:$.draws)==null?void 0:F[U])==null?void 0:V.seedAssignments)==null?void 0:j[ri],participantId:B,mainSeeding:Z,entryStatus:z,entryStage:W,drawId:U}};return P==null?void 0:P.filter(C).map(M)}),I=S=>{var U;let P=S.participantId,E=(U=i==null?void 0:i[P].participant.individualParticipantIds)==null?void 0:U.filter(R=>n.includes(R));return P&&{[P]:{individualParticipantIds:E}}};v===tm?(()=>{let S=Object.assign({},...b.map(I).filter(Boolean)),U=P=>{S[P.participantId].individualParticipantIds.forEach(E=>{c({id:E,eventType:v,eventId:y,entry:P})})};b.forEach(U)})():b.forEach(S=>{c({id:S==null?void 0:S.participantId,eventType:v,eventId:y,entry:S})});let T=Object.values(f).reduce((S,U)=>S+U.count,0);Object.keys(f).forEach(S=>{f[S].pct=f[S].count/T*100}),o[y]={tournamentId:e,eventId:y,entries:b,entryStatuses:f};let w=Object.assign({},...sd.flatMap(S=>{var U,P;return[{[S+"_count"]:(U=f[S])==null?void 0:U.count},{[S+"_pct"]:(P=f[S])==null?void 0:P.pct}]}));s[y]={tournamentId:e,eventId:y,...w}}let u=Object.values(i??{}).filter(({participant:{participantType:h,participantRole:f}})=>h===Hi&&f===vs),d=u.filter(({participant:h})=>!n.includes(h.participantId)).map(({participant:h})=>h.participantId),p={nonParticipatingEntriesCount:d.length,individualParticipantsCount:u.length,eventsCount:Object.values(o).length,nonParticipatingParticipantIds:d,drawDefinitionsCount:l,tournamentId:e};return{entryStatusReports:Object.values(s).flat(),participantEntryReports:Object.values(a).flat(),eventReports:Object.values(o).flat(),withDrawnParticipantIds:r,tournamentEntryReport:p}}function A9e({eventType:t,matchUps:e,eventId:i,drawId:n}){let r={},a=f=>{let m=f==null?void 0:f.matchUpFormat;m&&(r[m]||(r[m]=0),r[m]+=1)},s=e.filter(f=>i?f.eventId===i:f.drawId===n).reduce((f,m)=>(a(m),(m.sides??[]).flatMap(g=>{var v;return(((v=g==null?void 0:g.participant)==null?void 0:v.individualParticipants)||[g==null?void 0:g.participant]).filter(Boolean)}).forEach(g=>f[g.participantId]=g),f),{}),o=Object.values(s),l=o.map(f=>pk({participant:f,eventType:t})).filter(({wtnRating:f})=>f),c=(o.length-l.length)/o.length*100,u=l.reduce((f,m)=>{let{wtnRating:g,confidence:v}=m;return f.totalWTN+=g,f.totalConfidence+=v,f},{totalWTN:0,totalConfidence:0}),d=l!=null&&l.length?u.totalWTN/l.length:0,p=l!=null&&l.length?u.totalConfidence/l.length:0,h=Object.values(r).reduce((f,m)=>f+(m||0),0);return{matchUpFormatCounts:r,matchUpsCount:h,avgConfidence:p,pctNoRating:c,avgWTN:d}}function _9e(t){var e;let{tournamentRecord:i,extensionProfiles:n,firstFlightOnly:r}=t;if(!i)return{error:nT};let a=[],s={},o={},l=[],c=Object.assign({},...(n??[]).map(({name:m,label:g,accessor:v})=>{var y,b,I;let T=(b=(y=xi({element:i,name:m}))==null?void 0:y.extension)==null?void 0:b.value,w=v?(I=Kb({element:T,accessor:v}))==null?void 0:I.value:T;return{[g||m]:w}})),u=i==null?void 0:i.tournamentId,d=Za({participantsProfile:{withScaleValues:!0},tournamentRecord:i}).matchUps??[],p=m=>{var g,v,y;return(y=(v=(g=su({itemType:V6,itemSubTypes:[Ph],element:{timeItems:m}}))==null?void 0:g.timeItem)==null?void 0:v.itemValue)==null?void 0:y.scaleBasis},h=({positionManipulations:m})=>{m==null||m.forEach(g=>{let{structureId:v,name:y}=g,b=g.drawPositions||[g.drawPosition];s[v]||(s[v]=[]),s[v].push(`${y}: ${b.join("/")}`)})},f=(e=i==null?void 0:i.events)==null?void 0:e.flatMap(({timeItems:m,drawDefinitions:g=[],extensions:v,eventType:y,eventName:b,eventId:I,category:T})=>{var w,S,U,P;let E=(U=(S=(w=v==null?void 0:v.find(O=>O.name===Xu))==null?void 0:w.value)==null?void 0:S.flights)==null?void 0:U.map(O=>({[O.drawId]:O.flightNumber})),R=E&&Object.assign({},...E),C=v==null?void 0:v.find(O=>O.name===qv),M=m==null?void 0:m.find(O=>O.itemType===qv),_=((P=C==null?void 0:C.value)==null?void 0:P.length)||(M==null?void 0:M.itemValue)||0,A=Object.values(R??{}),N=R&&Math.min(...A),k=p(m);return o[I]={seedingBasis:k?JSON.stringify(k):void 0,totalPositionManipulations:0,maxPositionManipulations:0,generatedDrawsCount:0,drawDeletionsCount:_,tournamentId:u,eventId:I},g.filter(O=>!r||!E||R[O.drawId]===N).flatMap(O=>{let{matchUpFormat:$,tieFormat:F,timeItems:V,extensions:j,structures:B,drawName:z,drawType:W,drawId:Z}=O,{matchUpFormatCounts:K,matchUpsCount:Q,avgConfidence:J,pctNoRating:se,avgWTN:ie}=A9e({eventType:y,matchUps:d,drawId:Z}),ce=p(V)||k,oe=k9e({extensions:j}),te=(oe==null?void 0:oe.length)||0;return h({positionManipulations:oe}),o[I].totalPositionManipulations+=te,o[I].generatedDrawsCount+=1,te>o[I].maxPositionManipulations&&(o[I].maxPositionManipulations=te),B==null?void 0:B.filter(le=>le.stageSequence===1&&[ri,Bt,ws,Mr].includes(le.stage)).map(le=>{var ne,me,be;let Se=[Bt,Mr].includes(le.stage)?d.find(Ke=>Ke.structureId===le.structureId&&Ke.finishingRound===1&&Ke.winningSide):void 0;le.stage===Bt&&a.push({eventName:b,drawName:z,structureId:le.structureId});let we=(me=(ne=Se==null?void 0:Se.sides)==null?void 0:ne.find(Ke=>Ke.sideNumber===Se.winningSide))==null?void 0:me.participant,ze=(we==null?void 0:we.participantType)===$o&&we.participantId,Qe=(we==null?void 0:we.participantType)===Ai?we.individualParticipants:[],ke=pk({participant:(Qe==null?void 0:Qe[0])||we,eventType:y}),{personId:yt,personOtherId:lt,tennisId:Ct,confidence:Nt,wtnRating:Ce}=ke||{},Ge=pk({participant:Qe==null?void 0:Qe[1],eventType:y}),{personId:$e,personOtherId:at,tennisId:ct,confidence:Vt,wtnRating:Me}=Ge||{},{ageCategoryCode:De,categoryName:Je,subType:St}=T??{},bt=le.matchUpFormat||$,Ie=(K[bt]||0)/Q*100,{tieFormatName:Ue,tieFormatDesc:Oe}=ak(F),{tieFormatName:Ee,tieFormatDesc:Xe}=ak(le.tieFormat),Et=Oe===Xe,Fe=!Et&&Ee,ht=le.tieFormat&&!Et&&Xe,ti=((be=oe==null?void 0:oe.filter(Ke=>Ke.structureId===le.structureId))==null?void 0:be.length)||0;return{...c,tournamentId:u,eventId:I,structureId:le.structureId,drawId:Z,eventType:y,category:St,categoryName:Je,ageCategoryCode:De,flightNumber:R==null?void 0:R[Z],drawType:W,stage:le.stage,seedingBasis:ce?JSON.stringify(ce):void 0,winningPersonId:yt,winningPersonOtherId:lt,winningPersonTennisId:Ct,winningPersonWTNrating:Ce,winningPersonWTNconfidence:Nt,winningPerson2Id:$e,winningPerson2OtherId:at,winningPerson2TennisId:ct,winningPerson2WTNrating:Me,winningPerson2WTNconfidence:Vt,winningTeamId:ze,positionManipulations:ti,pctNoRating:se,matchUpFormat:bt,pctInitialMatchUpFormat:Ie,matchUpsCount:Q,drawTieFormatName:Ue,drawTieFormatDesc:Oe,tieFormatName:Fe,tieFormatDesc:ht,avgConfidence:J,avgWTN:ie}})})});return a.forEach(({eventName:m,drawName:g,structureId:v})=>{var y;(y=s[v])!=null&&y.length&&l.push({eventName:m,drawName:g,actions:s[v]})}),{eventStructureReports:Object.values(o),structureReports:f,flightReports:l}}function k9e({extensions:t}){var e,i;return(i=(e=t==null?void 0:t.find(({name:n})=>n===mS))==null?void 0:e.value)==null?void 0:i.slice(1)}function x9e({ignoreDisabled:t=!0,tournamentRecords:e,tournamentId:i,venueIds:n=[],dates:r=[]}){var a,s;if(!Array.isArray(r))return{error:Ae,dates:r};if(!Array.isArray(n))return{error:Ae,venueIds:n};if(!(e&&Object.keys(e).filter(p=>!i||p===i)||[]).length)return{error:Tr};if(!r.every(Cl))return{error:Va};let o=Am({tournamentRecords:e,ignoreDisabled:t,dates:r});if(o.error)return o;let l=(a=o==null?void 0:o.venues)==null?void 0:a.filter(({venueId:p})=>!(n!=null&&n.length)||n.includes(p)),c=(s=o.courts)==null?void 0:s.reduce((p,h)=>{var f;return(f=h.dateAvailability)==null||f.forEach(m=>{let g=m.date;p.includes(g)||p.push(g)}),p},[]).filter(p=>!r.length||r.includes(p)),u={venueIds:l==null?void 0:l.map(({venueId:p})=>p)},{matchUps:d}=Fd({afterRecoveryTimes:!0,tournamentRecords:e,matchUpFilters:u});return{venuesReport:l==null?void 0:l.map(p=>O9e(c,p,d))}}function O9e(t,e,i){let{venueId:n,courts:r,venueName:a}=e,s={};return t.forEach(o=>{var l;let c=0,u=0,d=0;for(let f of r){let m=f.dateAvailability.find(v=>v.date===o),g=(l=m&&a1({courtDate:m}).timeSlots)==null?void 0:l.reduce((v,y)=>{let{startTime:b,endTime:I}=y,T=sn(I)-sn(b);return v+T},0);g&&(d+=1),c+=g}let p=i.filter(({schedule:f})=>f.venueId===n&&Gh(o,f.scheduledDate));p.forEach(({schedule:f})=>{let m=sr(f.scheduledTime),g=nl(m,f.averageMinutes),v=sn(g)-sn(m);u+=v});let h=c?(u/c*100).toFixed(2):"100";s[o]={scheduledMatchUpsCount:p.length,availableCourts:d,availableMinutes:c,scheduledMinutes:u,percentUtilization:h}}),{venueId:n,venueName:a,venueReport:s}}var KTe={};Fi(KTe,{addMatchUpCourtOrder:()=>I9,addMatchUpEndTime:()=>S9,addMatchUpOfficial:()=>kSe,addMatchUpResumeTime:()=>U9,addMatchUpScheduleItems:()=>f2,addMatchUpScheduledDate:()=>p2,addMatchUpScheduledTime:()=>rv,addMatchUpStartTime:()=>w9,addMatchUpStopTime:()=>T9,addSchedulingProfileRound:()=>L9,allocateTeamMatchUpCourts:()=>h2,assignMatchUpCourt:()=>Gw,assignMatchUpVenue:()=>o1,bulkRescheduleMatchUps:()=>nUe,bulkScheduleMatchUps:()=>fM,bulkScheduleTournamentMatchUps:()=>aP,bulkUpdateCourtAssignments:()=>QTe,calculateScheduleTimes:()=>V9,clearMatchUpSchedule:()=>aUe,clearScheduledMatchUps:()=>g2,courtGridRows:()=>XF,findMatchUpFormatTiming:()=>YF,findVenue:()=>tf,generateBookings:()=>m2,generateVirtualCourts:()=>o2,getMatchUpsToSchedule:()=>WF,getPersonRequests:()=>ob,getProfileRounds:()=>ZF,getScheduledRoundsDetails:()=>nM,getSchedulingProfile:()=>_m,getSchedulingProfileIssues:()=>$7,matchUpScheduleChange:()=>rUe,modifyMatchUpFormatTiming:()=>r9,mutate:()=>ZTe,proAutoSchedule:()=>JTe,proConflicts:()=>tUe,publicFindCourt:()=>f8,query:()=>M0e,removeEventMatchUpFormatTiming:()=>r2,removeMatchUpCourtAssignment:()=>XTe,reorderUpcomingMatchUps:()=>iUe,scheduleMatchUps:()=>eUe,scheduleProfileRounds:()=>v2,setMatchUpDailyLimits:()=>sUe,setMatchUpHomeParticipantId:()=>b9,setSchedulingProfile:()=>e1,toggleParticipantCheckInState:()=>c2,validateSchedulingProfile:()=>KF});var ZTe={};Fi(ZTe,{addMatchUpCourtOrder:()=>I9,addMatchUpEndTime:()=>S9,addMatchUpOfficial:()=>kSe,addMatchUpResumeTime:()=>U9,addMatchUpScheduleItems:()=>f2,addMatchUpScheduledDate:()=>p2,addMatchUpScheduledTime:()=>rv,addMatchUpStartTime:()=>w9,addMatchUpStopTime:()=>T9,addSchedulingProfileRound:()=>L9,allocateTeamMatchUpCourts:()=>h2,assignMatchUpCourt:()=>Gw,assignMatchUpVenue:()=>o1,bulkRescheduleMatchUps:()=>nUe,bulkScheduleMatchUps:()=>fM,bulkScheduleTournamentMatchUps:()=>aP,bulkUpdateCourtAssignments:()=>QTe,calculateScheduleTimes:()=>V9,clearMatchUpSchedule:()=>aUe,clearScheduledMatchUps:()=>g2,findMatchUpFormatTiming:()=>YF,generateBookings:()=>m2,generateVirtualCourts:()=>o2,matchUpScheduleChange:()=>rUe,modifyMatchUpFormatTiming:()=>r9,proAutoSchedule:()=>JTe,proConflicts:()=>tUe,removeEventMatchUpFormatTiming:()=>r2,removeMatchUpCourtAssignment:()=>XTe,reorderUpcomingMatchUps:()=>iUe,scheduleMatchUps:()=>eUe,scheduleProfileRounds:()=>v2,setMatchUpDailyLimits:()=>sUe,setMatchUpHomeParticipantId:()=>b9,setSchedulingProfile:()=>e1,toggleParticipantCheckInState:()=>c2,validateSchedulingProfile:()=>KF});function V9({calculateStartTimeFromCourts:t=!0,defaultRecoveryMinutes:e=0,averageMatchUpMinutes:i=90,remainingScheduleTimes:n,clearScheduleDates:r,tournamentRecords:a,periodLength:s,scheduleDate:o,startTime:l,venueIds:c,endTime:u}){if(typeof a!="object"||!Object.keys(a).length)return{error:Tr};s=s??l2({recoveryMinutes:e,averageMatchUpMinutes:i});let{courts:d,venues:p}=Am({dates:[o],ignoreDisabled:!0,tournamentRecords:a}),h=d==null?void 0:d.filter(E=>!c||c.includes(E.venueId));l||(l=h==null?void 0:h.reduce((E,R)=>{var C,M;let _=((M=(C=R.dateAvailability)==null?void 0:C.find(A=>!A.date||Gh(o,A.date)))==null?void 0:M.startTime)??R.startTime;return _&&(!E||sn(_)<sn(E))?_:E},void 0)),u||(u=h==null?void 0:h.reduce((E,R)=>{var C,M;let _=((M=(C=R.dateAvailability)==null?void 0:C.find(A=>!A.date||Gh(o,A.date)))==null?void 0:M.endTime)??R.endTime;return _&&(!E||sn(_)>sn(E))?_:E},void 0));let f=Object.values(a),m=Object.assign({},...f.map(E=>(E.events??[]).map(R=>{let{scheduleTiming:C}=SR({tournamentRecord:E,event:R});return{[R.eventId]:{event:R,scheduleTiming:C}}})).flat()),g=sM({sortDateMatchUps:!1,tournamentRecords:a,matchUpFilters:{scheduledDate:o,venueIds:c}}),v=(g==null?void 0:g.dateMatchUps)??[],y=(g==null?void 0:g.completedMatchUps)??[],b=[];b.push(...v),b.push(...y);let I={averageTimes:[{minutes:{default:i}}],recoveryTimes:[{minutes:{default:e}}]},T=b==null?void 0:b.map(({eventId:E,schedule:R,matchUpFormat:C})=>{let{event:M,scheduleTiming:_}=m[E],A=M==null?void 0:M.eventType,N={..._,defaultTiming:I,matchUpFormat:C},{averageMinutes:k,recoveryMinutes:O}=pF({eventType:A,timingDetails:N}),{courtId:$,venueId:F}=R,V=sr(R.scheduledTime),j=nl(V,k);return{recoveryMinutes:O,averageMinutes:k,periodLength:s,startTime:V,endTime:j,courtId:$,venueId:F}}),w={calculateStartTimeFromCourts:t,remainingScheduleTimes:n,averageMatchUpMinutes:i,date:o,clearScheduleDates:r,periodLength:s,startTime:l,endTime:u,bookings:T,courts:h},{scheduleTimes:S}=h9(w),U=(c==null?void 0:c.length)===1&&c[0]||(p==null?void 0:p.length)===1&&p[0].venueId||void 0,P=b.map(Ca);return{venueId:U,scheduleTimes:S,dateScheduledMatchUpIds:P}}function XTe(t){var e;let i=ei(t,[{[Os]:!0}]);if(i.error)return i;let{removePriorValues:n,tournamentRecords:r,tournamentId:a,courtDayDate:s,matchUpId:o,courtId:l,drawId:c}=t,u=r[a];if(!u)return{error:dt};let{drawDefinition:d,event:p}=nv({tournamentRecord:u,drawId:c});if(!d)return{error:Ht};let h=or({drawDefinition:d,event:p,matchUpId:o});if(h.error)return h;if(((e=h==null?void 0:h.matchUp)==null?void 0:e.matchUpType)===ac){let{itemValue:f}=nb({timeItems:h.matchUp.timeItems??[],itemType:Yh}),m=l&&f.filter(g=>g.courtId!==l);return Vl({duplicateValues:!1,removePriorValues:n,tournamentRecord:u,drawDefinition:d,matchUpId:o,timeItem:{itemType:Yh,itemValue:m}})}else return Gw({tournamentRecord:u,drawDefinition:d,courtDayDate:s,courtId:"",matchUpId:o})}function JTe({scheduleCompletedMatchUps:t,tournamentRecords:e,scheduledDate:i,matchUps:n}){if(!lu(n))return{error:Ae};if(n.some(({hasContext:h})=>!h))return{info:"matchUps must have { inContext: true, nextMatchUps: true }",error:RL};let r=sM({courtCompletedMatchUps:!0,withCourtGridRows:!0,minCourtGridRows:10,tournamentRecords:e,matchUpFilters:{localPerspective:!0,scheduledDate:i}});if(r.error)return r;let{rows:a}=r,s=[],o=h=>[(h.sides||[]).map(f=>{var m;return[f.participantId,(m=f.participant)==null?void 0:m.individualParticipantIds]}),(h.potentialParticipants||[]).flat().map(f=>[f.participantId,f.individualParticipantIds])].flat(1/0).filter(Boolean),l=a==null?void 0:a.reduce((h,f)=>{let m=[],g=[];Object.values(f).forEach(y=>{if(tn(y)&&(y.matchUpId&&(m.push(y.matchUpId),s.push(y)),y.sides)){let b=o(y);g.push(...b)}});let v=Object.values(f).filter(y=>tn(y)&&!y.matchUpId);return h.concat({matchUpIds:m,availableCourts:v,rowId:f.rowId,participantIds:g})},[]);n.filter(({matchUpStatus:h})=>h&&h!==gn&&(t||!va.includes(h))).sort(kw);let c=od({matchUps:n.concat(s),includeParticipantDependencies:!0,tournamentRecords:e}).matchUpDependencies,u=[],d=[];for(;n.length&&l.length;){let h=l.shift(),f=[];for(;n.length&&h.availableCourts.length;){let m=n.concat(f).map(U=>U.matchUpId),g=n.shift(),v=g==null?void 0:g.matchUpId,y=v&&c[v].matchUpIds.concat(c[v].dependentMatchUpIds),b=v&&m.some(U=>c[v].matchUpIds.includes(U)),I=v&&d.some(U=>c[v].dependentMatchUpIds.includes(U)),T=h.matchUpIds.some(U=>y.includes(U)),w=o(g),S=h.participantIds.some(U=>w.includes(U));if(g&&!T&&!b&&!S&&!I){let U=h.availableCourts.shift();Object.assign(g.schedule,U.schedule),Object.assign(U,g),u.push(g),h.participantIds.push(...w),h.matchUpIds.push(v)}else g&&f.push(g)}n.push(...f),d.push(...h.matchUpIds)}let p=u.map(({matchUpId:h,tournamentId:f,schedule:m,drawId:g})=>({tournamentId:f,matchUpId:h,drawId:g,schedule:{...m,scheduledDate:i}}));return r=fM({tournamentRecords:e,matchUpDetails:p}),{...r,scheduled:u,notScheduled:n}}function QTe(t){let{courtDayDate:e}=t,i=ei(t,[{courtAssignments:!0,[Wo]:Ms,[cc]:si},{[Os]:!0}]);if(i.error)return i;let n=t.courtAssignments.reduce((a,s)=>{let{tournamentId:o}=s;return a[o]||(a[o]=[]),a[o].push(s),a},{}),r;return Object.keys(n).every(a=>{let s=t[Os][a];if(!s)return r={error:dt},!1;let o=n[a].reduce((l,c)=>{let{drawId:u}=c;return l[u]||(l[u]=[]),l[u].push(c),l},{});Object.keys(o).every(l=>{let{drawDefinition:c}=zo({tournamentRecord:s,drawId:l});return c?(o[l].every(u=>{let{matchUpId:d,courtId:p}=u,h=Gw({tournamentRecord:s,drawDefinition:c,courtDayDate:e,matchUpId:d,courtId:p});if(h.success)return h==null?void 0:h.success;r={error:Wge}}),!0):(r={error:Ht},!1)})}),r||pe}function eUe(t){let{tournamentRecords:e,allDateMatchUpIds:i=[],averageMatchUpMinutes:n=90,recoveryMinutes:r=0,recoveryMinutesMap:a,matchUpPotentialParticipantIds:s={},individualParticipantProfiles:o={},matchUpNotBeforeTimes:l={},matchUpDailyLimits:c={},checkPotentialRequestConflicts:u=!0,remainingScheduleTimes:d,clearScheduleDates:p,periodLength:h=30,scheduleDate:f,matchUpIds:m,venueIds:g,startTime:v,endTime:y,dryRun:b}=t,I=ei(t,[{[Os]:!0,[mR]:!0},{[ps]:Cl,[cc]:Va,[lqe]:!0},{[ps]:W=>!W||!isNaN(W),[pqe]:!1,[cc]:Ae,[hqe]:!1,[fqe]:!1}]);if(I.error)return I;let T=t.competitionMatchUps??Fd({nextMatchUps:!0,tournamentRecords:e}).matchUps??[],w=t.matchUpDependencies??od({includeParticipantDependencies:!0,matchUps:T,tournamentRecords:e}).matchUpDependencies;T.forEach(W=>{var Z;(Z=W.schedule)!=null&&Z.scheduledDate&&Gh(f,Mi(W.schedule.scheduledDate))&&UT({matchUpPotentialParticipantIds:s,matchUpNotBeforeTimes:l,matchUp:W})});let S=m.map(W=>T.find(Z=>Z.matchUpId===W)).filter(Boolean),{venueId:U,scheduleTimes:P,dateScheduledMatchUpIds:E}=V9({tournamentRecords:e,remainingScheduleTimes:d,startTime:sr(v),endTime:sr(y),scheduleDate:Mi(f),averageMatchUpMinutes:n,clearScheduleDates:p,periodLength:h,venueIds:g}),R={},C=[],M={},_={},A={};T.filter(({matchUpId:W})=>E==null?void 0:E.includes(W)).forEach(W=>{var Z;PG({matchUpPotentialParticipantIds:s,individualParticipantProfiles:o,matchUp:W,value:1});let K=(Z=W.schedule)==null?void 0:Z.scheduledTime;if(K){M[W.matchUpId]=K;let Q=a==null?void 0:a[W.matchUpId];rP({recoveryMinutes:Q||r,matchUpPotentialParticipantIds:s,individualParticipantProfiles:o,matchUpNotBeforeTimes:l,averageMatchUpMinutes:n,matchUpDependencies:w,scheduleTime:K,matchUp:W})}});let N=S.filter(W=>{let Z=E==null?void 0:E.includes(W.matchUpId),K=[gn,Ki,$r,ul,ss,un].includes(W==null?void 0:W.matchUpStatus);return!Z&&!W.winningSide&&!K}),{matchUpMap:k,overLimitMatchUpIds:O,participantIdsAtLimit:$}=N.reduce((W,Z)=>{let{drawId:K,tournamentId:Q,matchUpType:J}=Z,{participantIdsAtLimit:se,relevantParticipantIds:ie}=_9({individualParticipantProfiles:o,matchUpPotentialParticipantIds:s,matchUpDailyLimits:c,matchUp:Z});return se!=null&&se.length?(W.overLimitMatchUpIds.push(Z.matchUpId),W.participantIdsAtLimit.push(...se),W):(ie.forEach(ce=>{pM({individualParticipantProfiles:o,participantId:ce});let oe=o[ce].counters;oe[J]?oe[J]+=1:oe[J]=1,oe[Vu]?oe[Vu]+=1:oe[Vu]=1}),W.matchUpMap[Q]||(W.matchUpMap[Q]={}),W.matchUpMap[Q][K]?W.matchUpMap[Q][K].push(Z):W.matchUpMap[Q][K]=[Z],UT({matchUpPotentialParticipantIds:s,matchUpNotBeforeTimes:l,matchUp:Z}),W)},{matchUpMap:{},overLimitMatchUpIds:[],participantIdsAtLimit:[]});N=N.filter(({matchUpId:W})=>!O.includes(W));let F=0,V=(P==null?void 0:P.length)??0,{personRequests:j}=ob({tournamentRecords:e,requestType:hM});for(;P!=null&&P.length&&N.length&&F<=V;){F++;let{scheduleTime:W}=P.shift(),Z=N.find(K=>{let{matchUpId:Q}=K,{dependenciesScheduled:J,remainingDependencies:se}=M9({matchUpScheduleTimes:M,matchUpDependencies:w,allDateMatchUpIds:i,matchUp:K});if(!J)return A[Q]||(A[Q]=[]),A[Q].push({scheduleTime:W,remainingDependencies:se}),!1;let{enoughTime:ie}=A9({individualParticipantProfiles:o,matchUpNotBeforeTimes:l,matchUpDependencies:w,scheduleTime:W,matchUp:K});if(!ie)return _[Q]||(_[Q]=[]),_[Q].push({scheduleTime:W}),!1;let{conflicts:ce}=N9({potentials:u,averageMatchUpMinutes:n,requestConflicts:R,personRequests:j,scheduleTime:W,scheduleDate:f,matchUp:K});if(ce!=null&&ce.length)return!1;let oe=a==null?void 0:a[K.matchUpId];return rP({recoveryMinutes:oe||r,matchUpPotentialParticipantIds:s,individualParticipantProfiles:o,matchUpNotBeforeTimes:l,averageMatchUpMinutes:n,matchUpDependencies:w,scheduleTime:W,matchUp:K}),M[K.matchUpId]=W,!0});N=N.filter(({matchUpId:K})=>K!==(Z==null?void 0:Z.matchUpId)),Z||C.push(W)}N.forEach(W=>{PG({individualParticipantProfiles:o,matchUpPotentialParticipantIds:s,value:-1,matchUp:W})});let B=[];Object.keys(k).forEach(W=>{let Z=e[W];Z&&Object.keys(k[W]).forEach(K=>{let{drawDefinition:Q}=nv({tournamentRecord:Z,drawId:K});Q&&k[W][K].forEach(({matchUpId:J})=>{let se=M[J];if(se){let ie=se.split(":").map(Fc).join(":"),ce=`${Mi(f)}T${ie}`;b?B.push(J):(rv({drawDefinition:Q,matchUpId:J,scheduledTime:ce}).success&&B.push(J),U&&o1({tournamentRecords:e,tournamentRecord:Z,drawDefinition:Q,matchUpId:J,venueId:U}))}})})});let z=L6(N);return{...pe,requestConflicts:Object.values(R),remainingScheduleTimes:P==null?void 0:P.map(({scheduleTime:W})=>W),individualParticipantProfiles:o,matchUpNotBeforeTimes:l,participantIdsAtLimit:$,skippedScheduleTimes:C,overLimitMatchUpIds:O,scheduledMatchUpIds:B,noTimeMatchUpIds:z,recoveryTimeDeferred:_,dependencyDeferred:A}}function tUe({tournamentRecords:t,matchUps:e}){if(!lu(e))return{error:Em};if(e.some(({matchUpId:h,hasContext:f})=>h&&!f))return{info:"matchUps must have { inContext: true, nextMatchUps: true }",error:RL};let i=Math.max(...e.map(({schedule:h})=>(h==null?void 0:h.courtOrder)||1).map(h=>di(h))),n=Mt(1,i+1).map(h=>e.filter(f=>{var m;return di((m=f.schedule)==null?void 0:m.courtOrder)===h})),r={},a={},s={};n.flat().filter(Boolean).sort(kw).forEach(({schedule:h})=>delete h[lA]);let o=Pi(e.map(({drawId:h})=>h)),l=od({includeParticipantDependencies:!0,tournamentRecords:t,drawIds:o}).matchUpDependencies,c=n.map((h,f)=>h.reduce((m,g)=>{if(!g.matchUpId)return m;let{matchUpId:v,winnerMatchUpId:y,loserMatchUpId:b,schedule:I,sides:T,potentialParticipants:w}=g,S=I==null?void 0:I.courtId;r[v]=f,a[S]=[],m.matchUpIds.push(v),s[v]=g;let U=l[v].matchUpIds;U.length&&m.sourceMatchUpIds.push(...U);let P=(T==null?void 0:T.map(R=>{var C;return[(C=R.participant)==null?void 0:C.individualParticipantIds,R.participantId]}).flat().filter(Boolean))??[],E=(w==null?void 0:w.flat().map(({individualParticipantIds:R,participantId:C})=>[R,C]).flat().filter(Boolean))||[];return m.participantIds.push(...E,...P),y&&m.targetMatchUpIds.push(y),b&&m.targetMatchUpIds.push(b),m},{sourceMatchUpIds:[],targetMatchUpIds:[],participantIds:[],matchUpIds:[]})),u=(h,f)=>l[h].sources.reduce((m,g,v)=>g.includes(f)&&v+1||m,0),d=c.map(()=>[]),p=(h,f,m,g)=>{if(!s[h].schedule[lA]){s[h].schedule[lA]=f,s[h].schedule[bbe]=g,d[r[h]].push({matchUpId:h,issueType:m,issueIds:g,issue:f});let v=s[h].schedule.courtId;a[v]||(a[v]=[]),a[v].push({matchUpId:h,issue:f,issueType:m,issueIds:g})}};return c.forEach((h,f)=>{let m=f?c[f-1]:void 0,g=c.slice(f+1),v={},y=Ol(h.participantIds),b=Object.keys(y).filter(w=>y[w]>1),I=h.matchUpIds.filter(w=>l[w].participantIds.some(S=>b.includes(S)));I.forEach(w=>{v[w]||(v[w]={}),v[w][Sv]||(v[w][Sv]=I.filter(S=>S!==w))});let T=m&&h.participantIds.filter(w=>m.participantIds.includes(w));T&&T.forEach(w=>{let S=h.matchUpIds.concat(m.matchUpIds).filter(U=>l[U].participantIds.includes(w));S.forEach(U=>{v[U]||(v[U]={}),v[U][Tv]||(v[U][Tv]=S.filter(P=>P!==U))})}),h.matchUpIds.forEach(w=>{var S,U,P,E;let R=l[w].matchUpIds;for(let M of g){let _=M.matchUpIds.filter(A=>R.includes(A));_!=null&&_.length&&(_.forEach(A=>p(A,eG,Wm,[w])),p(w,eG,Wm,_))}if((S=v[w])!=null&&S[Sv]&&p(w,Sv,Qj,v[w][Sv]),h.sourceMatchUpIds.includes(w)){let M=h.matchUpIds.filter(_=>l[_].matchUpIds.includes(w));p(w,Sv,Wm,M),h.matchUpIds.filter(_=>l[_].matchUpIds.includes(w)).forEach(_=>p(_,Sv,Wm,[w]))}let C=(U=m==null?void 0:m.matchUpIds)==null?void 0:U.filter(M=>u(w,M)>1);if(C!=null&&C.length&&(p(w,tG,Wm,C),C.forEach(M=>p(M,tG,Wm,[w]))),(P=v[w])!=null&&P[Tv]&&p(w,Tv,Qj,v[w][Tv]),(E=m==null?void 0:m.targetMatchUpIds)==null?void 0:E.includes(w)){let M=s[w].schedule.courtId,_=R.filter(A=>m.matchUpIds.includes(A));_.some(A=>s[A].schedule.courtId===M)||(_.forEach(A=>p(A,Tv,Wm,[w])),p(w,Tv,Wm,_))}})}),{courtIssues:a,rowIssues:d}}function iUe(t){let e="reorderUpcomingMatchUps",{tournamentRecords:i}=t;if(typeof i!="object"||!Object.keys(i).length)return fe({result:{error:Tr},stack:e});let{matchUpsContextIds:n,firstToLast:r}=t;if(!n)return fe({result:{error:si},stack:e});let a=n==null?void 0:n.length;if(!a)return{...pe};let s=0;return n.forEach((l,c)=>{let{tournamentId:u,drawId:d,matchUpId:p}=l,h=c+(r?-1:1);h<0&&(h=a-1),h===a&&(h=0);let f=n[h].schedule.scheduledTime,m=o({tournamentId:u,scheduledTime:f,matchUpId:p,drawId:d});if(m.success)s++;else return m}),s===a?pe:fe({result:{error:qge},stack:e});function o({tournamentId:l,scheduledTime:c,matchUpId:u,drawId:d}){let p=i[l],{drawDefinition:h}=nv({tournamentRecord:p,drawId:d});return h?rv({drawDefinition:h,scheduledTime:c,matchUpId:u}):{error:sc}}}function nUe(t){var e,i;let{scheduleChange:n,matchUpIds:r,dryRun:a}=t;if(!r||!Array.isArray(r))return{error:gw};if(typeof n!="object")return{error:Ae};let s=au(t),o=[],l=[];for(let u of Object.values(s)){let d=L9e({tournamentRecord:u,scheduleChange:n,matchUpIds:r,dryRun:a});if(d.error)return d;Array.isArray(d.notRescheduled)&&l.push(...d.notRescheduled);let p=L6(d.notRescheduled),h=[];(e=d.rescheduled)==null||e.forEach(f=>{let{matchUpId:m}=f;p.includes(m)&&h.push(m),o.push(f)}),h.length&&(l=((i=d==null?void 0:d.notRescheduled)==null?void 0:i.filter(({matchUpId:f})=>!h.includes(f)))||[])}let c=!!(o.length&&!l.length);return{...pe,rescheduled:o,notRescheduled:l,allRescheduled:c}}function L9e({tournamentRecord:t,scheduleChange:e,matchUpIds:i,dryRun:n}){var r;if(!t)return{error:dt};if(!i||!Array.isArray(i))return{error:gw};if(typeof e!="object")return{error:Ae};let a=[],s=[],{minutesChange:o,daysChange:l}=e;if(!o&&!l)return{...pe};if(o&&isNaN(o))return{error:Ae};if(l&&isNaN(l))return{error:Ae};let{matchUps:c}=Za({matchUpFilters:{matchUpIds:i},tournamentRecord:t}),u=({matchUpStatus:T})=>!va.includes(T),d=c==null?void 0:c.filter(T=>aM({schedule:T.schedule})).filter(T=>u({matchUpStatus:T.matchUpStatus}));if(!(d!=null&&d.length))return{...pe};let{tournamentInfo:p}=Vw({tournamentRecord:t}),{startDate:h,endDate:f}=p,m=d==null?void 0:d.reduce((T,w)=>{let{matchUpId:S,drawId:U}=w;return T[U]?T[U].push(S):T[U]=[S],T},{}),g=1440;for(let T of Object.keys(m)){let w=nv({tournamentRecord:t,drawId:T});if(w.error)return w;let S=w.drawDefinition,U=m[T].filter(P=>i.includes(P));for(let P of U)if(P&&S){let E=(r=d.find(N=>N.matchUpId===P))==null?void 0:r.schedule,{scheduledTime:R,scheduledDate:C}=E,M,_,A;if(!M&&l&&C){let N=Mi(C);A=W1(N,l),M=new Date(A)<new Date(h)||new Date(A)>new Date(f)}if(o&&R){let N=Mi(R),k=sn(sr(R))+o;if(M=k<0||k>g,!M){let O=nl(R,o),$=N&&A||C===N&&N;_=$?`${$}T${O}`:O}}if(M)s.push(P);else{if(!n){if(_){let N=rv({scheduledTime:_,drawDefinition:S,matchUpId:P});if(N.error)return N}if(A){let N=p2({scheduledDate:A,drawDefinition:S,matchUpId:P});if(N.error)return N}}(_||A)&&a.push(P)}}}let v=Za({matchUpFilters:{matchUpIds:i},tournamentRecord:t}).matchUps??[],y=v.filter(({matchUpId:T})=>a.includes(T)),b=v.filter(({matchUpId:T})=>s.includes(T)),I=y.length&&!b.length;return{...pe,rescheduled:y,notRescheduled:b,allRescheduled:I}}function rUe(t){let e="matchUpScheduleChange",{tournamentRecords:i}=t;if(typeof i!="object"||!Object.keys(i).length)return{error:Tr};let{sourceMatchUpContextIds:n,targetMatchUpContextIds:r,sourceCourtId:a,targetCourtId:s,courtDayDate:o}=t||{},{drawId:l,matchUpId:c,tournamentId:u}=n||{},{drawId:d,matchUpId:p,tournamentId:h}=r||{};if(!c&&!p)return fe({result:{error:si},stack:e});let{matchUps:f}=Fd({matchUpFilters:{matchUpIds:[c,p].filter(Boolean),drawIds:[l,d].filter(Boolean)},tournamentRecords:t.tournamentRecords}),m=f==null?void 0:f.find(({matchUpId:I})=>I===c),g=f==null?void 0:f.find(({matchUpId:I})=>I===p),v=0;if(s&&c&&!p){let I=y({tournamentId:u,matchUpId:c,courtId:s,matchUp:m,drawId:l,tournamentRecords:i,sourceCourtId:a,courtDayDate:o});if(I!=null&&I.success&&v++,I.error)return fe({result:I,stack:e})}else if(a&&s&&c&&p){let I=y({tournamentId:u,matchUpId:c,courtId:s,matchUp:m,drawId:l,tournamentRecords:i,sourceCourtId:a,courtDayDate:o});if(I.success&&v++,I.error)return fe({result:I,stack:e,info:"source"});let T=y({tournamentId:h,sourceCourtId:s,matchUpId:p,matchUp:g,courtId:a,drawId:d,tournamentRecords:i,courtDayDate:o});if(T.success&&v++,T.error)return fe({result:T,stack:e,info:"target"})}else return{error:si};return v?pe:fe({result:{error:LU},stack:e});function y(I){let{tournamentRecords:T,tournamentId:w,matchUp:S,drawId:U}=I,P=T[w],{drawDefinition:E}=nv({tournamentRecord:P,drawId:U});return S.matchUpType===Xn?b({...I,tournamentRecord:P,drawDefinition:E}):Gw({...I,tournamentRecord:P,drawDefinition:E})}function b({removePriorValues:I,tournamentRecords:T,tournamentRecord:w,drawDefinition:S,sourceCourtId:U,courtDayDate:P,matchUpId:E,matchUp:R,courtId:C}){let M=[C].concat(R.schedule.allocatedCourts.map(({courtId:_})=>_).filter(_=>_!==U));return h2({removePriorValues:I,tournamentRecords:T,tournamentRecord:w,drawDefinition:S,courtDayDate:P,matchUpId:E,courtIds:M})}}function aUe({scheduleAttributes:t=[Yh,Dg,Cw,Rw,Mw,yd,lm,Ch,xf],tournamentRecord:e,drawDefinition:i,matchUpId:n}){var r,a;let s="clearMatchUpSchedule",o=i?(r=po({matchUpFilters:{matchUpIds:[n]},inContext:!1,drawDefinition:i}).matchUps)==null?void 0:r[0]:(a=Za({matchUpFilters:{matchUpIds:[n]},tournamentRecord:e,inContext:!1}).matchUps)==null?void 0:a[0];if(!o)return{error:xs};let l=(o.timeItems??[]).filter(c=>(c==null?void 0:c.itemType)&&!t.includes(c==null?void 0:c.itemType));return o.timeItems=l,Qi({tournamentId:e.tournamentId,context:s,drawDefinition:i,matchUp:o}),{...pe}}function sUe(t){let{tournamentRecord:e,tournamentId:i,dailyLimits:n}=t,r=t.tournamentRecords||e&&{[e.tournamentId]:e}||{};if(typeof r!="object"||!Object.keys(r).length)return{error:Tr};if(typeof n!="object")return{error:Pm};let a=Object.keys(r).filter(s=>!i||i===s);if(i&&!a.includes(i))return{error:Ae};for(let s of a){let o=r[s],l=pn({extension:{name:vR,value:{dailyLimits:n}},element:o});if(l.error)return l}return{...pe}}var oUe={};Fi(oUe,{addCollectionDefinition:()=>H9,addCollectionGroup:()=>hUe,aggregateTieFormats:()=>mUe,compareTieFormats:()=>cm,getTieFormat:()=>O7,modifyCollectionDefinition:()=>j9,modifyTieFormat:()=>fUe,mutate:()=>lUe,orderCollectionDefinitions:()=>dUe,query:()=>T0e,removeCollectionDefinition:()=>G9,removeCollectionGroup:()=>uUe,tieFormatGenderValidityCheck:()=>FL,validateCollectionDefinition:()=>dR});var lUe={};Fi(lUe,{addCollectionDefinition:()=>H9,addCollectionGroup:()=>hUe,aggregateTieFormats:()=>mUe,modifyCollectionDefinition:()=>j9,modifyTieFormat:()=>fUe,orderCollectionDefinitions:()=>dUe,removeCollectionDefinition:()=>G9,removeCollectionGroup:()=>uUe});function Ey({drawDefinition:t,structureId:e,matchUpId:i,structure:n,matchUp:r,eventId:a,event:s}){var o;let l="getTieFormat",c;if(e=(n==null?void 0:n.structureId)??e,i=(r==null?void 0:r.matchUpId)??i,(i||e)&&!t)return{error:Ht};if(a&&s)c=rp(s);else if(i){if(t&&(!r||!n)){let u=or({drawDefinition:t,matchUpId:i});if(u.error)return u;if(((o=u.matchUp)==null?void 0:o.matchUpType)!==ac)return fe({result:{error:cl},stack:l});n||(n=u.structure),r||(r=u.matchUp)}c=SD({item:r,drawDefinition:t,structure:n,event:s})||SD({item:n,drawDefinition:t,structure:n,event:s})||rp(t)||rp(s)}else if(t&&e){if(!n){let u=fi({drawDefinition:t,structureId:e});if(u.error)return u;n=u==null?void 0:u.structure}c=SD({item:n,drawDefinition:t,structure:n,event:s})||rp(t)||rp(s)}else c=rp(t)||rp(s);return c?{...pe,structure:n,tieFormat:c,matchUp:r}:fe({result:{error:kU},stack:l})}function hk({matchUp:t,updateInProgressMatchUps:e}){return!t.winningSide&&![va].includes(t.matchUpStatus)&&(e||t.matchUpStatus!==ad&&!ya(t))}function iB({from:t,to:e}){let i=Object.keys(t),n=Ar(i,Object.keys(e)).length===i.length,r=i.filter(s=>t[s]!==e[s]).map(s=>({countChange:e[s]-t[s],collectionId:s})),a=i.every(s=>t[s]===e[s]);return{equivalent:n&&a,matchUpsCountChanges:r}}function F9e({updateInProgressMatchUps:t,tournamentRecord:e,drawDefinition:i,structure:n,tieFormat:r,eventId:a,matchUp:s,event:o,uuids:l}){var c,u,d,p;let h="updateTieFormat",f=e==null?void 0:e.tournamentId,m=0,g=0,v=0,y=0,b=r==null?void 0:r.collectionDefinitions.reduce((E,R)=>(E[R.collectionId]=(E[R.collectionId]||0)+R.matchUpCount,E),{}),I=({tieFormat:E})=>{let R=E==null?void 0:E.collectionDefinitions.reduce((C,M)=>(C[M.collectionId]=(C[M.collectionId]||0)+M.matchUpCount,C),{});return iB({from:R,to:b}).equivalent},T=(c=Ey({drawDefinition:i}))==null?void 0:c.tieFormat,w=(u=Ey({event:o}))==null?void 0:u.tieFormat;if(o&&a){for(let E of o.drawDefinitions??[])S({drawDefinition:E});o.tieFormat=us(r),y+=1}else if(s){if(!s.tieMatchUps)return fe({result:{error:cl},stack:h});let E=Ol((d=s.tieMatchUps)==null?void 0:d.map(({collectionId:A})=>A)),R=iB({to:b,from:E}),{changes:C,changesArePossible:M,cannotChangeReaon:_}=FJ({matchUp:s,check:R});if(R.equivalent)if(hk({matchUp:s,updateInProgressMatchUps:t}))s.tieFormat=us(r),y+=1;else return fe({result:{error:Y5},info:"matchUp is IN_PROGRESS or COMPLETE",stack:h});else if(M)P({tieFormat:r,matchUp:s,changes:C,uuids:l});else return fe({context:{collectionMap:b,matchUpMap:E},result:{error:Eh},info:_||"specified changes not possible",stack:h});g+=1,Qi({eventId:o==null?void 0:o.eventId,context:h,drawDefinition:i,tournamentId:f,matchUp:s})}else if(n){let E=(p=U({inheritedTieFormat:T??w,structure:n}))==null?void 0:p.modifiedMatchUpsCount;E&&(g+=E,m+=1,y+=1);let R=!n.tieFormat||cm({ancestor:n.tieFormat,descendant:r}).different;R&&(n.tieFormat=us(r),m+=1,y+=1),(E||R)&&i&&zn({structureIds:[n.structureId],eventId:o==null?void 0:o.eventId,drawDefinition:i})}else if(i)S({drawDefinition:i}),i.tieFormat=us(r),y+=1;else return{error:Ht};return{modifiedStructuresCount:m,modifiedMatchUpsCount:g,addedMatchUpsCount:v,modifiedCount:y,...pe,tieFormat:r};function S({drawDefinition:E}){var R;let C=E.structures||[],M=[];for(let _ of C){if(_.tieFormat)continue;let A=(R=U({inheritedTieFormat:w,structure:_}))==null?void 0:R.modifiedMatchUpsCount;if(A){m+=1,g+=A;let N=_.structureId;M.push(N)}}return zn({structureIds:M,eventId:o==null?void 0:o.eventId,drawDefinition:E}),M.length}function U({inheritedTieFormat:E,structure:R}){var C,M;let _=0,A=((C=Sn({matchUpFilters:{matchUpTypes:[Xn]},structure:R}))==null?void 0:C.matchUps)||[];for(let N of A){let k=hk({matchUp:N,updateInProgressMatchUps:t}),O=!1,$=Ol((M=N.tieMatchUps)==null?void 0:M.map(({collectionId:V})=>V)),F=iB({from:$,to:b});if(F.equivalent)N.tieFormat&&I(N)&&k&&(N.tieFormat=us(r),O=!0);else{let{changes:V,changesArePossible:j}=FJ({matchUp:N,check:F});if(j&&!N.tieFormat)P({changes:V,matchUp:N,tieFormat:r,uuids:l});else if(E)(!N.tieFormat||cm({ancestor:E,descendant:N.tieFormat}).different)&&(N.tieFormat=E,O=!0);else return fe({result:{error:kU},stack:h})}O&&(_+=1,Qi({tournamentId:e==null?void 0:e.tournamentId,drawDefinition:i,context:h,eventId:a,matchUp:N}))}return{modifiedMatchUpsCount:_}}function P({uuids:E,matchUp:R,tieFormat:C,changes:M}){R.tieFormat=us(C);let _=[],A=[];return M.forEach(N=>{if(N.countChange>0){let k=Math.max(0,...R.tieMatchUps.filter(F=>F.collectionId===N.collectionId).map(Bl("collectionPosition"))),O=C.collectionDefinitions.find(F=>F.collectionId===N.collectionId),$=WR({matchUpsLimit:N.countChange,collectionPositionOffset:k,collectionDefinition:O,matchUp:R,uuids:E});A.push(...$t($,!1,!0)),v+=A.length,R.tieMatchUps.push(...$)}else{let k=N.toBePlayedTieMatchUpIds.slice(0,Math.abs(N.countChange));console.log("remove",k.length),_.push(...k),R.tieMatchUps=R.tieMatchUps.filter(({matchUpId:O})=>!k.includes(O))}}),A.length&&Tg({matchUps:A,drawDefinition:i,tournamentId:f,eventId:a}),_.length&&Cm({matchUpIds:_,action:"updateTieFormat",drawDefinition:i,tournamentId:f,eventId:a}),{matchUpIdsRemoved:_,matchUpsAdded:A}}}function FJ({check:t,matchUp:e}){let i="",n=[];return{changesArePossible:t.matchUpsCountChanges.every(({collectionId:r,countChange:a})=>{let s=e.tieMatchUps.filter(l=>l.collectionId===r&&l.matchUpStatus===jr).map(Bl("matchUpId")),o=s.length+a>=0||a>0;return!o&&a<0&&(i="Insufficient TO_BE_PLAYED matchUps"),n.push({toBePlayedTieMatchUpIds:s,collectionId:r,countChange:a}),o}),changes:n,cannotChangeReaon:i}}function w2({appliedPolicies:t,drawDefinition:e,auditData:i}){var n;if(!((n=t==null?void 0:t.audit)!=null&&n[ID]))return;let{extension:r}=xi({name:ID,element:e}),a={value:Array.isArray(r==null?void 0:r.value)?r==null?void 0:r.value.concat(i):[i],name:ID};pn({element:e,extension:a})}function j9({updateInProgressMatchUps:t=!1,tournamentRecord:e,collectionOrder:i,collectionName:n,tieFormatName:r,drawDefinition:a,matchUpFormat:s,matchUpCount:o,collectionId:l,matchUpType:c,structureId:u,matchUpId:d,category:p,eventId:h,gender:f,event:m,collectionValueProfiles:g,collectionValue:v,matchUpValue:y,scoreValue:b,setValue:I}){let T="modifyCollectionDefinition";if(s&&!Ll({matchUpFormat:s}))return fe({result:{error:Ae},context:{matchUpFormat:s},stack:T});if(n&&typeof n!="string")return fe({result:{error:Ae},context:{collectionName:n},stack:T});if(f&&!Object.values(d6).includes(f))return fe({result:{error:Ae},context:{gender:f},stack:T});if(p&&typeof p!="object")return fe({result:{error:Ae},context:{category:p},stack:T});let w={collectionValueProfiles:g,collectionValue:v,matchUpValue:y,scoreValue:b,setValue:I};if(!Object.values(w).filter(Boolean).length&&!i&&!n&&!s&&!o&&!c)return fe({result:{error:si},stack:T});if(Object.values(w).filter(Boolean).length>1)return fe({info:"Only one value assignment allowed per collectionDefinition",result:{error:Ae},stack:T});let S=Ey({drawDefinition:a,structureId:u,matchUpId:d,eventId:h,event:m});if(S.error)return fe({result:S,stack:T});let{matchUp:U,structure:P,tieFormat:E}=S,R=us(E),C=E==null?void 0:E.collectionDefinitions.find(B=>B.collectionId===l),M=R==null?void 0:R.collectionDefinitions.find(B=>B.collectionId===l);if(!C)return fe({info:"source collectionDefinition",result:{error:Ya},context:{collectionId:l},stack:T});let _=v??y??b??I;if(g!=null&&g.length){let B=Yme({matchUpCount:o??(C==null?void 0:C.matchUpCount)??0,collectionValueProfiles:g});if(B.errors)return fe({result:{error:Ae},info:B.errors,stack:T})}else if(_&&!wi(_))return fe({result:{error:Ae},info:"value is not an integer",context:{value:_},stack:T});let A=(B,z)=>Ar(Object.keys(B),Object.keys(z)).length===Object.keys(B).length&&Ar(Object.values(B),Object.values(z)).length===Object.values(B).length,N=g&&(!C.collectionValueProfiles||!A(C.collectionValueProfiles,g)),k=wi(v)&&C.collectionValue!==v||wi(y)&&C.matchUpValue!==y||wi(b)&&C.scoreValue!==b||wi(I)&&C.setValue!==I||N,O=[];if(k&&(M.collectionValueProfiles=void 0,M.collectionValue=void 0,M.matchUpValue=void 0,M.scoreValue=void 0,M.setValue=void 0,Object.assign(M,w),O.push({collectionId:l,...Zt(w)})),(wi(b)||wi(I))&&M.collectionGroupNumber){let B=M.collectionGroupNumber;R.collectionDefinitions=R.collectionDefinitions.map(z=>{let{collectionGroupNumber:W,...Z}=z;return W===B?Z:z}),R.collectionGroups=R.collectionGroups.filter(({groupNumber:z})=>z!==B),O.push({collectionId:l,change:"collectionGroupNumber removed"})}let{aggregateValue:$,valueGoal:F}=jw(R),V=Zt({aggregateValue:$,valueGoal:F});if((V.aggregateValue!==(E==null?void 0:E.winCriteria.aggregateValue)||V.valueGoal!==(E==null?void 0:E.winCriteria.valueGoal))&&(R.winCriteria=V,O.push({collectionId:l,winCriteria:V})),wi(i)&&C.collectionOrder!==i&&(M.collectionOrder=i,O.push({collectionId:l,collectionOrder:i})),n&&C.collectionName!==n&&(M.collectionName=n,O.push({collectionId:l,collectionName:n})),s&&C.matchUpFormat!==s&&(M.matchUpFormat=s,O.push({collectionId:l,matchUpFormat:s})),wi(o)&&C.matchUpCount!==o&&(M.matchUpCount=o,O.push({collectionId:l,matchUpCount:o})),c&&C.matchUpType!==c)return fe({result:{error:AL},context:{matchUpType:c},stack:T});p&&C.category!==p&&(M.category=p,O.push({collectionId:l,category:p})),f&&C.gender!==f&&(M.gender=f,O.push({collectionId:l,gender:f}));let j=Zt(R);if(S=Go({tieFormat:j}),S.error)return fe({result:S,stack:T});if(!O.length)return fe({result:{...pe,modifications:O}});if((E==null?void 0:E.tieFormatName)!==r?(j.tieFormatName=r,O.push({tieFormatName:r})):O.length&&(delete j.tieFormatName,O.push("tieFormatName removed: modifications without new tieFormatName")),S=F9e({tieFormat:j,updateInProgressMatchUps:t,tournamentRecord:e,drawDefinition:a,structure:P,eventId:h,matchUp:U,event:m}),!S.error){let{appliedPolicies:B}=fn({tournamentRecord:e}),z=Zt({collectionDefinition:M,drawId:a==null?void 0:a.drawId,action:T,structureId:u,matchUpId:d,eventId:h});w2({appliedPolicies:B,drawDefinition:a,auditData:z})}return fe({result:{...S,modifications:O},stack:T})}function $9e({updateInProgressMatchUps:t,drawDefinition:e,structureId:i,structure:n,matchUpId:r,matchUp:a}){var s,o;let l=[];return r&&a?l=[a]:i&&n?l=((s=Sn({matchUpFilters:{matchUpTypes:[Xn]},structure:n}))==null?void 0:s.matchUps)??[]:e&&(l=((o=po({matchUpFilters:{matchUpTypes:[Xn]},drawDefinition:e}))==null?void 0:o.matchUps)??[]),{targetMatchUps:l.filter(c=>!c.winningSide&&c.matchUpStatus!==$r&&(t||c.matchUpStatus!==ad&&!ya(c)))}}function B9e({updateInProgressMatchUps:t,tournamentRecord:e,drawDefinition:i,targetMatchUps:n,tieFormat:r,event:a}){for(let s of n){let o=!!s.tieFormat;o&&(s.tieFormat=us(r));let l;if(t){let c=fn({tournamentRecord:e,drawDefinition:i,event:a}).appliedPolicies,u=Nm({matchUpId:s.matchUpId,exitWhenNoValues:!0,tournamentRecord:e,appliedPolicies:c,drawDefinition:i,event:a});if(u.error)return u;l=u.score}o&&!l&&Qi({tournamentId:e==null?void 0:e.tournamentId,context:"updateTargetTeamMatchUps",eventId:a==null?void 0:a.eventId,matchUp:s,drawDefinition:i})}return{...pe}}function cUe({updateInProgressMatchUps:t,originalValueGoal:e,tournamentRecord:i,wasAggregateValue:n,tieFormatName:r,drawDefinition:a,structureId:s,structure:o,tieFormat:l,matchUpId:c,matchUp:u,eventId:d,event:p}){let{aggregateValue:h,valueGoal:f}=jw(l);l.winCriteria=Zt({aggregateValue:h,valueGoal:f}),(e&&e!==f||h&&!n)&&(r?l.tieFormatName=r:delete l.tieFormatName);let{targetMatchUps:m}=$9e({updateInProgressMatchUps:t,drawDefinition:a,structureId:s,structure:o,matchUpId:c,matchUp:u});B9e({updateInProgressMatchUps:t,tournamentRecord:i,targetMatchUps:m,drawDefinition:a,tieFormat:l,event:p});let g=Zt(l),v=Go({tieFormat:g});if(v.error)return v;if(d&&p)p.tieFormat=g;else if(c&&u)u.tieFormat=l;else if(o)o.tieFormat=g;else if(a)a.tieFormat=g;else if(!u||!a)return{error:Ht};return zn({drawDefinition:a,eventId:p==null?void 0:p.eventId}),{...pe}}function uUe({updateInProgressMatchUps:t=!0,collectionGroupNumber:e,tournamentRecord:i,drawDefinition:n,tieFormatName:r,structureId:a,matchUpId:s,matchUp:o,eventId:l,event:c}){if(!e)return{error:si};if(isNaN(e))return{error:Ae};let u="removeCollectionGroup",d=o?void 0:Ey({drawDefinition:n,structureId:a,matchUpId:s,eventId:l,event:c});if(d!=null&&d.error)return fe({result:d,stack:u});let p=d==null?void 0:d.structure;o=o??(d==null?void 0:d.matchUp);let h=d==null?void 0:d.tieFormat,f=h==null?void 0:h.winCriteria.valueGoal,m=h==null?void 0:h.winCriteria.aggregateValue,g=us(h);if(d=Go({tieFormat:g}),d.error)return fe({result:d,stack:u});let v=[];if(g.collectionDefinitions=g.collectionDefinitions.map(y=>{let{collectionGroupNumber:b,...I}=y;return b!==e?y:(v.push(y.collectionId),I)}),g.collectionGroups=g.collectionGroups.filter(({groupNumber:y})=>y!==e),d=cUe({updateInProgressMatchUps:t,originalValueGoal:f,wasAggregateValue:m,tournamentRecord:i,drawDefinition:n,tieFormatName:r,structureId:a,structure:p,tieFormat:g,matchUpId:s,matchUp:o,eventId:l,event:c}),!d.error){let{appliedPolicies:y}=fn({tournamentRecord:i}),b=Zt({drawId:n==null?void 0:n.drawId,collectionGroupNumber:e,action:u,structureId:a,matchUpId:s,eventId:l});w2({appliedPolicies:y,drawDefinition:n,auditData:b})}return fe({result:{...d,modifiedCollectionIds:v},stack:u})}function ET({tieFormat:t,orderMap:e}){var i;let n=us(t);return n.collectionDefinitions.forEach(r=>{let a=e[r.collectionId];a&&(r.collectionOrder=a)}),(i=n.collectionDefinitions)==null||i.sort((r,a)=>iT(r.collectionOrder)-iT(a.collectionOrder)),n}function dUe({tournamentRecord:t,drawDefinition:e,structureId:i,matchUpId:n,orderMap:r,eventId:a,matchUp:s,event:o}){if(typeof r!="object"||!Object.values(r).every(l=>wi(l)))return fe({result:{error:Ae},context:{orderMap:r}});if(a&&o!=null&&o.tieFormat)$J({tournamentRecord:t,event:o,orderMap:r});else if(n){let l=e&&or({drawDefinition:e,matchUpId:n});if(l!=null&&l.error)return l;if(s=l.matchUp,!s)return{error:ll};s!=null&&s.tieFormat&&(s.tieFormat=ET({tieFormat:s.tieFormat,orderMap:r}),Qi({tournamentId:t==null?void 0:t.tournamentId,eventId:o==null?void 0:o.eventId,drawDefinition:e,matchUp:s}))}else if(i){let l=fi({drawDefinition:e,structureId:i});if(l.error)return l;let c=l.structure;if(c!=null&&c.tieFormat)c.tieFormat=ET({tieFormat:c.tieFormat,orderMap:r}),pUe({eventId:o==null?void 0:o.eventId,tournamentRecord:t,drawDefinition:e,structure:c,orderMap:r}),zn({drawDefinition:e,structureIds:[c.structureId]});else if(e.tieFormat)CG({structureIds:[i],tournamentRecord:t,drawDefinition:e,orderMap:r,event:o});else if(o!=null&&o.tieFormat)$J({structureIds:[i],tournamentRecord:t,orderMap:r,event:o});else return{error:Ya}}else if(e!=null&&e.tieFormat)CG({tournamentRecord:t,drawDefinition:e,orderMap:r,event:o});else return{error:Ya};return{...pe}}function $J({tournamentRecord:t,structureIds:e,orderMap:i,event:n}){let r=ET({tieFormat:n.tieFormat,orderMap:i});e!=null&&e.length||(n.tieFormat=r);for(let a of n.drawDefinitions??[])CG({tournamentRecord:t,drawDefinition:a,structureIds:e,orderMap:i,event:n})}function CG({tournamentRecord:t,drawDefinition:e,structureIds:i,orderMap:n,event:r}){let a=e.tieFormat??(r==null?void 0:r.tieFormat),s=ET({tieFormat:a,orderMap:n});i!=null&&i.length||(e.tieFormat=s);let o=[];for(let l of e.structures??[])i!=null&&i.length&&!i.includes(l.structureId)||((l.tieFormat||i!=null&&i.includes(l.structureId))&&(l.tieFormat=ET({tieFormat:l.tieFormat??e.tieFormat??(r==null?void 0:r.tieFormat),orderMap:n})),pUe({eventId:r==null?void 0:r.eventId,tournamentRecord:t,drawDefinition:e,structure:l,orderMap:n}),o.push(l.structureId));zn({drawDefinition:e,structureIds:o})}function pUe({tournamentRecord:t,drawDefinition:e,structure:i,orderMap:n,eventId:r}){var a;let s=(a=Sn({matchUpFilters:{matchUpTypes:[Xn]},structure:i}))==null?void 0:a.matchUps;for(let o of s)o.tieFormat&&(o.tieFormat=ET({tieFormat:o.tieFormat,orderMap:n}),Qi({tournamentId:t==null?void 0:t.tournamentId,drawDefinition:e,eventId:r,matchUp:o}))}function G9({updateInProgressMatchUps:t=!0,tieFormatComparison:e,tournamentRecord:i,drawDefinition:n,tieFormatName:r,collectionId:a,structureId:s,matchUpId:o,eventId:l,matchUp:c,event:u}){var d,p,h,f,m;let g="removeCollectionDefinition",v=c?void 0:Ey({drawDefinition:n,structureId:s,matchUpId:o,eventId:l,event:u});if(v!=null&&v.error)return fe({result:v,stack:g});let y=v==null?void 0:v.structure;c=c??(v==null?void 0:v.matchUp);let b=v==null?void 0:v.tieFormat,I=us(b);if(v=Go({tieFormat:I}),v.error)return fe({result:v,stack:g});let T=(d=I==null?void 0:I.collectionDefinitions)==null?void 0:d.find(N=>N.collectionId===a);if(!T)return fe({result:{error:Ya,collectionId:a}});I.collectionDefinitions=I.collectionDefinitions.filter(N=>N.collectionId!==a),T.collectionGroupNumber&&(I.collectionDefinitions=I.collectionDefinitions.map(N=>{let{collectionGroupNumber:k,...O}=N;return O}),I.collectionGroups=I.collectionGroups.filter(({groupNumber:N})=>N!==T.collectionGroupNumber));let{aggregateValue:w,valueGoal:S}=jw(I);I.winCriteria=Zt({aggregateValue:w,valueGoal:S});let U=b==null?void 0:b.winCriteria.valueGoal,P=b==null?void 0:b.winCriteria.aggregateValue;(U&&U!==S||w&&!P)&&(r?I.tieFormatName=r:delete I.tieFormatName);let E=[];o&&c?E=[c]:s&&y?E=((p=Sn({matchUpFilters:{matchUpTypes:[Xn]},structure:y}))==null?void 0:p.matchUps)??[]:n?E=((h=po({matchUpFilters:{matchUpTypes:[Xn]},drawDefinition:n}))==null?void 0:h.matchUps)??[]:u&&(E=((f=nf({matchUpFilters:{matchUpTypes:[Xn]},drawDefinition:n}))==null?void 0:f.matchUps)??[]);let R=(E||[]).filter(N=>{var k,O,$;let F=(O=(k=N.tieMatchUps)==null?void 0:k.filter(j=>j.collectionId===a))==null?void 0:O.some(ya),V=e&&N.tieFormat?($=cm({descendant:N.tieFormat,ancestor:I}))==null?void 0:$.different:!1;return t&&!F||!N.winningSide&&N.matchUpStatus!==$r&&(t||N.matchUpStatus!==ad&&!ya(N)&&!V)});if(!R.length)return{error:LU};let{appliedPolicies:C}=fn({tournamentRecord:i});if(o&&c&&t){let N=(m=c.tieMatchUps)==null?void 0:m.filter(k=>k.collectionId===a);for(let k of N??[]){let O=uM({matchUpId:k.matchUpId,tieMatchUpId:c==null?void 0:c.matchUpId,winningSide:void 0,removeScore:!0,tournamentRecord:i,appliedPolicies:C,drawDefinition:n,event:u});if(O.error||(O=or({drawDefinition:n,matchUpId:o}),O.error))return O;c=O==null?void 0:O.matchUp}}let M=[];for(let N of R){for(let k of(N==null?void 0:N.sides)??[])k.lineUp=(k.lineUp??[]).map(O=>({participantId:O.participantId,collectionAssignments:((O==null?void 0:O.collectionAssignments)??[]).filter($=>$.collectionId!==a)}));if(N.tieMatchUps=(N.tieMatchUps??[]).filter(k=>{let O=k.collectionId===a;return O&&M.push(k.matchUpId),!O}),N.tieFormat&&(N.tieFormat=us(I)),t){let k=Nm({matchUpId:N.matchUpId,exitWhenNoValues:!0,tournamentRecord:i,appliedPolicies:C,drawDefinition:n,event:u});if(k.error)return k}Qi({tournamentId:i==null?void 0:i.tournamentId,eventId:u==null?void 0:u.eventId,drawDefinition:n,context:g,matchUp:N})}M.length&&Cm({tournamentId:i==null?void 0:i.tournamentId,matchUpIds:M,eventId:u==null?void 0:u.eventId,drawDefinition:n});let _=Zt(I);if(v=Go({tieFormat:_}),v.error)return fe({result:v,stack:g});if(l&&u)u.tieFormat=_;else if(o&&c)c.tieFormat=_;else if(y)y.tieFormat=_;else if(n)n.tieFormat=_;else if(!c||!n)return{error:Ht};zn({drawDefinition:n,eventId:u==null?void 0:u.eventId});let A=Zt({drawId:n==null?void 0:n.drawId,action:g,collectionId:a,structureId:s,matchUpId:o,eventId:l});return w2({appliedPolicies:C,drawDefinition:n,auditData:A}),{tieFormat:_,deletedMatchUpIds:M,targetMatchUps:R,...pe}}function hUe({updateInProgressMatchUps:t=!0,tournamentRecord:e,groupDefinition:i,drawDefinition:n,collectionIds:r,tieFormatName:a,structureId:s,matchUpId:o,matchUp:l,eventId:c,event:u}){let d="addCollectionGroup";if(!Array.isArray(r))return fe({result:{error:si},stack:d});let p=l?void 0:Ey({drawDefinition:n,structureId:s,matchUpId:o,eventId:c,event:u});if(p!=null&&p.error)return fe({result:p,stack:d});let h=p==null?void 0:p.structure;l=l||(p==null?void 0:p.matchUp);let f=p==null?void 0:p.tieFormat,m=f==null?void 0:f.winCriteria.valueGoal,g=us(f);if(p=Go({tieFormat:g}),p.error)return fe({result:p,stack:d});for(let y of g.collectionDefinitions){let{collectionId:b,collectionGroupNumber:I}=y;if(I&&r.includes(b))return fe({info:"collectionIds cannot be part of other collectionGroups",result:{error:Ae},stack:d})}let v=(g.collectionGroups||[]).reduce((y,b)=>b.groupNumber>y?b.groupNumber:y,0)+1;return i.groupNumber=v,g.collectionDefinitions=g.collectionDefinitions.map(y=>r.includes(y.collectionId)?{...y,collectionGroupNumber:v}:y),g.collectionGroups=[...g.collecitonGroups||[],i],cUe({updateInProgressMatchUps:t,originalValueGoal:m,tournamentRecord:e,drawDefinition:n,tieFormatName:a,structureId:s,structure:h,tieFormat:g,matchUpId:o,matchUp:l,eventId:c,event:u})}function H9({updateInProgressMatchUps:t=!0,collectionDefinition:e,referenceCategory:i,tournamentRecord:n,policyDefinitions:r,enforceCategory:a,referenceGender:s,drawDefinition:o,tieFormatName:l,enforceGender:c,structureId:u,matchUpId:d,matchUp:p,eventId:h,uuids:f,event:m}){var g,v;let y="addCollectionDefinition",b=fn({tournamentRecord:n,drawDefinition:o,event:m}).appliedPolicies??{},I=(r==null?void 0:r[Ga])??(b==null?void 0:b[Ga]);a=a??((g=I==null?void 0:I.participants)==null?void 0:g.enforceCategory);let T=(c??((v=I==null?void 0:I.participants)==null?void 0:v.enforceGender))!==!1,w=!!((i??(m==null?void 0:m.category))&&a!==!1),S=!!((s??(m==null?void 0:m.gender))&&T),U=dR({referenceCategory:i??(m==null?void 0:m.category),collectionDefinition:e,referenceGender:s,checkCategory:w,checkGender:S,event:m});if(U.error)return fe({result:U,stack:y});let P=p!=null&&p.tieFormat?void 0:Ey({drawDefinition:o,structureId:u,matchUpId:d,eventId:h,event:m});if(P!=null&&P.error)return fe({result:{error:P.error},stack:y});let E=P==null?void 0:P.structure;p=p??(P==null?void 0:P.matchUp);let R=(p==null?void 0:p.tieFormat)??(P==null?void 0:P.tieFormat),C=us(R);if(P=Go({tieFormat:C}),P==null?void 0:P.error)return fe({result:{error:P.error},stack:y});if(!e.collectionId)e.collectionId=bn();else if(C.collectionDefinitions.map(({collectionId:j})=>j).includes(e.collectionId))return fe({context:{collectionId:e.collectionId},result:{error:Zge}});C.collectionDefinitions.push(e),C.collectionDefinitions.sort((j,B)=>(j.collectionOrder||0)-(B.collectionOrder||0)).forEach((j,B)=>j.collectionOrder=B+1);let{aggregateValue:M,valueGoal:_}=jw(C);C.winCriteria=Zt({aggregateValue:M,valueGoal:_});let A=R==null?void 0:R.winCriteria.valueGoal,N=R==null?void 0:R.winCriteria.aggregateValue;(A&&A!==_||M&&!N)&&(l?C.tieFormatName=l:delete C.tieFormatName);let k=[],O=[],$=[],F=Zt(C);if(P=Go({tieFormat:F}),P==null?void 0:P.error)return fe({result:{error:P.error},stack:y});if(h&&m){m.tieFormat=F;for(let j of m.drawDefinitions??[])if(!j.tieFormat)for(let B of j.structures??[]){if(B.tieFormat)continue;let z=nB({updateInProgressMatchUps:t,collectionDefinition:e,structure:B,uuids:f});O.push(...z.newMatchUps),$.push(...z.targetMatchUps),k.push(B.structureId)}XM({modifiedMatchUps:$,eventId:m==null?void 0:m.eventId,modifiedStructureIds:k,tournamentRecord:n,drawDefinition:o,addedMatchUps:O,stack:y})}else if(u&&E){E.tieFormat=F;let j=nB({updateInProgressMatchUps:t,collectionDefinition:e,structure:E,uuids:f});O.push(...j.newMatchUps),$=j.targetMatchUps,XM({modifiedMatchUps:$,eventId:m==null?void 0:m.eventId,modifiedStructureIds:k,tournamentRecord:n,drawDefinition:o,addedMatchUps:O,stack:y})}else if(d&&p){if(!hk({matchUp:p,updateInProgressMatchUps:t}))return fe({result:{error:Y5},stack:y});p.tieFormat=F;let j=WR({collectionDefinition:e,matchUp:p,uuids:f});Array.isArray(p.tieMatchUps)||(p.tieMatchUps=[]),p.tieMatchUps.push(...j),O.push(...j),XM({modifiedMatchUps:[p],eventId:m==null?void 0:m.eventId,modifiedStructureIds:k,tournamentRecord:n,drawDefinition:o,addedMatchUps:O,stack:y})}else if(o){o.tieFormat=F;for(let j of o.structures??[]){let B=nB({updateInProgressMatchUps:t,collectionDefinition:e,structure:j,uuids:f});k.push(j.structureId),O.push(...B.newMatchUps),$.push(...B.targetMatchUps)}XM({modifiedMatchUps:$,eventId:m==null?void 0:m.eventId,tournamentRecord:n,drawDefinition:o,addedMatchUps:O,stack:y})}else return{error:Ht};let V=Zt({drawId:o==null?void 0:o.drawId,collectionDefinition:e,action:y,structureId:u,matchUpId:d,eventId:h});return w2({appliedPolicies:b,drawDefinition:o,auditData:V}),{tieFormat:F,targetMatchUps:$,addedMatchUps:O,...pe}}function nB({updateInProgressMatchUps:t,collectionDefinition:e,structure:i,uuids:n}){var r;let a=[],s=((r=Sn({matchUpFilters:{matchUpTypes:[Xn]},structure:i}))==null?void 0:r.matchUps).filter(o=>hk({matchUp:o,updateInProgressMatchUps:t})&&!o.tieFormat);for(let o of s){let l=WR({collectionDefinition:e,matchUp:o,uuids:n});Array.isArray(o.tieMatchUps)||(o.tieMatchUps=[]),o.tieMatchUps.push(...l),a.push(...l)}return{newMatchUps:a,targetMatchUps:s}}function XM({modifiedStructureIds:t,tournamentRecord:e,modifiedMatchUps:i,drawDefinition:n,addedMatchUps:r,eventId:a,stack:s}){Tg({tournamentId:e==null?void 0:e.tournamentId,matchUps:r,drawDefinition:n,eventId:a}),i==null||i.forEach(o=>{Qi({tournamentId:e==null?void 0:e.tournamentId,drawDefinition:n,context:s,matchUp:o,eventId:a})}),zn({structureIds:t,drawDefinition:n,eventId:a})}function fUe({updateInProgressMatchUps:t=!1,tieFormatComparison:e,modifiedTieFormat:i,tournamentRecord:n,considerations:r,drawDefinition:a,structureId:s,matchUpId:o,eventId:l,uuids:c,event:u}){let d="modifyTieFormat";if(!Go({tieFormat:i}).valid)return fe({result:{error:Eh},info:"falied validation",stack:d});let p=Ey({drawDefinition:a,structureId:s,matchUpId:o,eventId:l,event:u});if(p.error)return fe({result:p,stack:d});let{matchUp:h,tieFormat:f}=p,m=us(f),g=cm({descendant:i,ancestor:m,considerations:r});if(g.invalid)return fe({context:{invalid:g.invalid},result:{error:Eh},stack:d});if(!(g!=null&&g.different))return fe({result:{...pe},info:"Nothing to do",stack:d});let v=m.collectionDefinitions.map(({collectionId:P})=>P),y=i.collectionDefinitions.map(({collectionId:P})=>P),b=v.filter(P=>!y.includes(P)),I=i.collectionDefinitions.filter(({collectionId:P})=>!v.includes(P)),T=I.map(Bl("collectionId")),w=[],S,U=i.tieFormatName;for(let P of i.collectionDefinitions){if(T.includes(P.collectionId))continue;let E=j9({updateInProgressMatchUps:t,...P,tournamentRecord:n,tieFormatName:U,drawDefinition:a,structureId:s,matchUpId:o,eventId:l,event:u});if(E.modifications&&w.push(...E.modifications),E.error)return fe({result:E,stack:d});E.tieFormat&&(S=E.tieFormat)}for(let P of I){let E=H9({updateInProgressMatchUps:t,collectionDefinition:P,tournamentRecord:n,drawDefinition:a,tieFormatName:U,structureId:s,matchUpId:o,matchUp:h,eventId:l,uuids:c,event:u});if(E.error)return fe({result:E,stack:d});E.tieFormat&&(S=E.tieFormat)}for(let P of b){let E=G9({updateInProgressMatchUps:t,tieFormatComparison:e,tournamentRecord:n,drawDefinition:a,tieFormatName:U,collectionId:P,structureId:s,matchUpId:o,eventId:l,matchUp:h,event:u});if(E.error)return fe({result:E,stack:d});E.tieFormat&&(S=E.tieFormat)}return(f==null?void 0:f.tieFormatName)!==U?(S.tieFormatName=U,w.push({tieFormatName:U})):(w.length||T.length||b.length)&&(delete S.tieFormatName,w.push("tieFormatName removed: modifications without new tieFormatName")),S.collectionDefinitions=S.collectionDefinitions.sort((P,E)=>iT(P.collectionOrder)-iT(E.collectionOrder)).map((P,E)=>({...P,collectionOrder:E+1})),{processedTieFormat:us(S),modifications:w,...pe}}function mUe({tournamentRecord:t}){if(!t)return{error:dt};let e=0;for(let i of t.events??[]){let n=i.tieFormats??[],r=u=>{if(!u.tieFormat)return;let d;for(let p of n)cm({descendant:u.tieFormat,ancestor:p}).different||(d=p.tieFormatId);if(d)u.tieFormatId=d,delete u.tieFormat;else{let p=$t(u.tieFormat,void 0,!0);p.tieFormatId||(p.tieFormatId=bn()),u.tieFormatId=p.tieFormatId,delete u.tieFormat,n.push(p),e+=1}},a=i.eventType;r({tieFormat:i.tieFormat,eventType:a});for(let u of i.drawDefinitions??[]){r({tieFormat:u.tieFormat,eventType:a});for(let d of u.structures??[])r({tieFormat:d.tieFormat,eventType:a})}let s=(u,d)=>{var p;let h=(p=l.matchUps)==null?void 0:p.find(f=>f.matchUpId===u);h&&(h.tieFormatId=d,delete h.tieFormat,Qi({tournamentId:t==null?void 0:t.tournamentId,eventId:i.eventId,matchUp:h}))},o=u=>{let d=$t(u.tieFormat,void 0,!0);d.tieFormatId||(d.tieFormatId=bn()),n.push(d),e+=1,s(u.matchUpId,d.tieFormatId)},l=nf({matchUpFilters:{matchUpTypes:[ac]},event:i}),c=l.matchUps??[];for(let u of c){let d;for(let p of n)u.tieFormat&&cm({descendant:u.tieFormat,ancestor:p}).different||(d=p.tieFormatId);d?s(u.matchUpId,d):o(u)}n.length&&(i.tieFormats=n)}return{...pe,addedCount:e}}var gUe={};Fi(gUe,{addDrawDefinitionExtension:()=>XL,addEventExtension:()=>Jg,addEventTimeItem:()=>$w,addExtension:()=>pn,addNotes:()=>DF,addOnlineResource:()=>TUe,addParticipantExtension:()=>wye,addParticipantTimeItem:()=>Q8,addTimeItem:()=>Zp,addTournamentExtension:()=>_6,addTournamentTimeItem:()=>XR,analyzeDraws:()=>JR,analyzeTournament:()=>k7,copyTournamentRecord:()=>yUe,createTournamentRecord:()=>y2,generate:()=>vUe,getAggregateTeamResults:()=>_7,getAllowedDrawTypes:()=>VF,getAllowedMatchUpFormats:()=>M7,getAppliedPolicies:()=>fn,getCompetitionDateRange:()=>GF,getCompetitionPenalties:()=>N7,getPolicyDefinitions:()=>Rm,getTournamentInfo:()=>Vw,getTournamentPenalties:()=>jF,getTournamentPersons:()=>A7,getTournamentPoints:()=>HF,getTournamentStructures:()=>k8,getTournamentTimeItem:()=>lF,mutate:()=>bUe,query:()=>I0e,removeDrawDefinitionExtension:()=>Sye,removeEventExtension:()=>JL,removeExtension:()=>uo,removeNotes:()=>K8,removeOnlineResource:()=>SUe,removeParticipantExtension:()=>Tye,removeTournamentExtension:()=>k6,setTournamentCategories:()=>EUe,setTournamentDates:()=>S2,setTournamentEndDate:()=>CUe,setTournamentName:()=>UUe,setTournamentNotes:()=>DUe,setTournamentStartDate:()=>PUe,setTournamentStatus:()=>wUe});var vUe={};Fi(vUe,{copyTournamentRecord:()=>yUe,createTournamentRecord:()=>y2});function yUe(t){var e,i;let n=ei(t,[{tournamentRecord:!0,startDate:!0,endDate:!1,tournamentName:!0}]);if(n.error)return n;let{startDate:r,endDate:a}=t.tournamentRecord,s=24*60*60*1e3,o=(r&&a?new Date(Mi(a)).getTime()-new Date(Mi(r)).getTime():0)/s,l=t.endDate||m6(t.startDate,o),c=f=>f==null?void 0:f.filter(({itemType:m})=>{var g;return(g=t.itemTypeList)==null?void 0:g.includes(m)}),u=f=>f==null?void 0:f.filter(({name:m})=>{var g;return(g=t.extensionList)==null?void 0:g.includes(m)}),d=f=>{let{timeItems:m,extensions:g,...v}=f;return $t({...v,timeItems:c(m),extensions:u(g)},!1,!0)},p=f=>{let{drawDefinitions:m,timeItems:g,extensions:v,startDate:y,endDate:b,...I}=f;return $t({extensions:u(v),timeItems:c(g),startDate:t.startDate,endDate:l,...I},!1,!0)},h={participants:t.copyParticipants?((e=t.tournamentRecord.participants)==null?void 0:e.map(d))??[]:[],parentOrganisation:$t({...t.tournamentRecord.parentOrganisation},!1,!0),venues:$t(t.tournamentRecord.venues??[],!1,!0),extensions:u(t.tournamentRecord.extensions),timeItems:c(t.tournamentRecord.timeItems),events:((i=t.tournamentRecord.events)==null?void 0:i.map(p))??[],weekdays:[...t.tournamentRecord.weekdays??[]],tournamentName:t.tournamentName,startDate:t.startDate,tournamentId:bn(),endDate:l};return{...pe,tournamentRecord:h}}var bUe={};Fi(bUe,{addDrawDefinitionExtension:()=>XL,addEventExtension:()=>Jg,addEventTimeItem:()=>$w,addExtension:()=>pn,addNotes:()=>DF,addOnlineResource:()=>TUe,addParticipantExtension:()=>wye,addParticipantTimeItem:()=>Q8,addTimeItem:()=>Zp,addTournamentExtension:()=>_6,addTournamentTimeItem:()=>XR,removeDrawDefinitionExtension:()=>Sye,removeEventExtension:()=>JL,removeExtension:()=>uo,removeNotes:()=>K8,removeOnlineResource:()=>SUe,removeParticipantExtension:()=>Tye,removeTournamentExtension:()=>k6,setTournamentCategories:()=>EUe,setTournamentDates:()=>S2,setTournamentEndDate:()=>CUe,setTournamentName:()=>UUe,setTournamentNotes:()=>DUe,setTournamentStartDate:()=>PUe,setTournamentStatus:()=>wUe});var V9e="ABANDONED",j9e="ACTIVE",G9e="CANCELLED",H9e="COMPLETED",z9e="IN_PROGRESS",IUe={ABANDONED:V9e,ACTIVE:j9e,CANCELLED:G9e,COMPLETED:H9e,IN_PROGRESS:z9e};function wUe({tournamentRecord:t,status:e}){return t?e&&!Object.keys(IUe).includes(e)?{error:Ae,info:"Unknown status"}:(t.tournamentStatus=e,{...pe}):{error:dt}}function SUe(t){var e,i,n;let r=ei(t,[{tournamentRecord:!0,onlineResource:!0}]);if(r.error)return r;let{tournamentRecord:a,onlineResource:s,organisationId:o,participantId:l,personId:c,courtId:u,venueId:d}=t;if(o){if(((e=a.parentOrganisation)==null?void 0:e.parentOrganisationId)!==o)return fe({result:{error:Ya}});U0({element:a.parentOrganisation,onlineResource:s})}else if(l||c){let p=(a.participants??[]).find(h=>{var f;return c&&((f=h.person)==null?void 0:f.personId)===c||h.participantId===l});if(!p)return fe(c?{result:{error:Ya}}:{result:{error:Or}});if(c){if(((i=p.person)==null?void 0:i.personId)!==c)return fe({result:{error:yw}});U0({element:p.person,onlineResource:s})}else U0({element:p,onlineResource:s})}else if(u){let p=(n=(a.venues??[]).filter(h=>!d||h.venueId===d).flatMap(h=>(h.courts??[]).filter(f=>f.courtId===u)))==null?void 0:n[0];if(!p)return fe({result:{error:OU}});U0({element:p,onlineResource:s})}else if(d){let p=(a.venues??[]).find(h=>h.venueId===d);if(!p)return fe({result:{error:Iw}});U0({element:p,onlineResource:s})}else U0({element:a,onlineResource:s}),Ti({payload:{parentOrganisation:a.parentOrganisation,onlineResources:a.onlineResources,tournamentId:a.tournamentId},topic:Xy});return{...pe}}function U0({element:t,onlineResource:e}){let i=(t.onlineResources??[]).filter(n=>!((n==null?void 0:n[lT])===e[lT]&&(n==null?void 0:n[cT])===e[cT]&&(n==null?void 0:n[uT])===e[uT]));t.onlineResources=i}function TUe(t){var e,i,n;let r=ei(t,[{tournamentRecord:!0,onlineResource:!0}]);if(r.error)return r;let{tournamentRecord:a,onlineResource:s,organisationId:o,participantId:l,personId:c,courtId:u,venueId:d}=t;if(o){if(((e=a.parentOrganisation)==null?void 0:e.parentOrganisationId)!==o)return fe({result:{error:Ya}});D0({element:a.parentOrganisation,onlineResource:s})}else if(l||c){let p=(a.participants??[]).find(h=>{var f;return c&&((f=h.person)==null?void 0:f.personId)===c||h.participantId===l});if(!p)return fe(c?{result:{error:Ya}}:{result:{error:Or}});if(c){if(((i=p.person)==null?void 0:i.personId)!==c)return fe({result:{error:yw}});D0({element:p.person,onlineResource:s})}else D0({element:p,onlineResource:s})}else if(u){let p=(n=(a.venues??[]).filter(h=>!d||h.venueId===d).flatMap(h=>(h.courts??[]).filter(f=>f.courtId===u)))==null?void 0:n[0];if(!p)return fe({result:{error:OU}});D0({element:p,onlineResource:s})}else if(d){let p=(a.venues??[]).find(h=>h.venueId===d);if(!p)return fe({result:{error:Iw}});D0({element:p,onlineResource:s})}else D0({element:a,onlineResource:s}),Ti({payload:{parentOrganisation:a.parentOrganisation,onlineResources:a.onlineResources,tournamentId:a.tournamentId},topic:Xy});return{...pe}}function D0({element:t,onlineResource:e}){let i=(t.onlineResources??[]).filter(n=>(n==null?void 0:n[lT])!==e[lT]&&(n==null?void 0:n[cT])!==e[cT]&&(n==null?void 0:n[uT])!==e[uT]);return i.push(e),t.onlineResources=i,{...pe}}function UUe({tournamentRecord:t,promotionalName:e,tournamentName:i,formalName:n}){if(!t)return{error:dt};let r=t.tournamentId,a={tournamentId:r};return i&&i!==t.tournamentName&&(t.tournamentName=i,a.tournamentName=i),e&&e!==t.promotionalName&&(t.promotionalName=e,a.promotionalName=e),n&&n!==t.formalName&&(t.formalName=n,a.formalName=n),t.promotionalName===t.tournamentName&&(delete t.promotionalName,a.promotionalName=""),t.formalName===t.tournamentName&&(delete t.formalName,a.formalName=""),Object.keys(a).length>1&&Ti({topic:Xy,payload:{parentOrganisation:t.parentOrganisation,tournamentId:r,...a}}),{...pe}}function DUe({tournamentRecord:t,notes:e}){if(!t)return{error:dt};let i=e?DF({element:t,notes:e}):K8({element:t});return i.error?i:(Ti({topic:Xy,payload:{parentOrganisation:t.parentOrganisation,tournamentId:t.tournamentId,notes:e??""}}),{...pe})}function EUe({tournamentRecord:t,categories:e}){return t?(e=(e||[]).filter(i=>i.categoryName&&i.type),t.tournamentCategories=e,Ti({topic:Xy,payload:{parentOrganisation:t.parentOrganisation,tournamentId:t.tournamentId,categories:e}}),{...pe}):{error:dt}}function q9e({tournamentRecord:t}){var e,i;if(!t)return{error:dt};let{startDate:n,endDate:r}=t,a=oT(n,r),s=[];for(let o of t.venues||[])(e=o==null?void 0:o.courts)!=null&&e.length&&s.push(...o.courts);for(let o of s){let{startTime:l,endTime:c}=(o.dateAvailability??[]).reduce((p,h)=>{let f=sn(p.startTime),m=sn(p.endTime);return h.startTime&&sn(h.startTime)<f&&(p.startTime=h.startTime),h.endTime&&sn(h.endTime)>m&&(p.endTime=h.endTime),p},{startTime:"08:00",endTime:"18:00"}),u=a.map(p=>{var h;return((h=o.dateAvailability)==null?void 0:h.find(f=>f.date===p))??{date:p,startTime:l,endTime:c}}),d=(i=o.dateAvailability)==null?void 0:i.find(p=>!p.date);d&&u.unshift(d),o.dateAvailability=u}return{...pe}}function S2(t){var e,i;let{tournamentRecord:n,startDate:r,endDate:a,weekdays:s}=t,o=(e=t.activeDates)==null?void 0:e.filter(Boolean),l=ei(t,[{tournamentRecord:!0},{[ps]:m=>_p.test(m),[cc]:Va,startDate:!1,endDate:!1},{[ps]:m=>m.filter(Boolean).every(g=>_p.test(g)),[cc]:Va,activeDates:!1},{[ps]:nSe,weekdays:!1}]);if(l.error)return l;if(a&&r&&new Date(a)<new Date(r))return{error:Ae};if(a&&r&&new Date(r)>new Date(a))return{error:Ae};if(o!=null&&o.length){let m=r||n.startDate,g=a||n.endDate,v=!m||o.every(b=>new Date(b)>=new Date(m)),y=!g||o.every(b=>new Date(b)<=new Date(g));if(!v||!y)return{error:Va}}let c;(r&&n.startDate&&new Date(r)>new Date(n.startDate)||a&&n.endDate&&new Date(a)<new Date(n.endDate))&&(c=!0);let u=oT(n.startDate,n.endDate);r&&(n.startDate=r),a&&(n.endDate=a);let d=oT(n.startDate,n.endDate),p=u.filter(m=>!d.includes(m)),h=d.filter(m=>!u.includes(m));for(let m of n.events??[])r&&m.startDate&&new Date(m.startDate)<new Date(r)&&(m.startDate=r),a&&m.startDate&&new Date(m.startDate)>new Date(a)&&(m.startDate=r??a),a&&m.endDate&&new Date(m.endDate)>new Date(a)&&(m.endDate=a),r&&m.endDate&&new Date(m.endDate)<new Date(r)&&(m.endDate=a??r);r&&n.endDate&&new Date(r)>new Date(n.endDate)&&(n.endDate=r),a&&n.startDate&&new Date(a)<new Date(n.startDate)&&(n.startDate=a),o&&(n.activeDates=o),s&&(n.weekdays=s);let f=c&&((i=W9e({tournamentRecord:n}))==null?void 0:i.unscheduledMatchUpIds);return q9e({tournamentRecord:n}),Ti({payload:Zt({parentOrganisation:n.parentOrganisation,tournamentId:n.tournamentId,activeDates:o,startDate:r,weekdays:s,endDate:a}),topic:Xy}),{...pe,unscheduledMatchUpIds:f,datesAdded:h,datesRemoved:p}}function PUe({tournamentRecord:t,startDate:e}){return e?S2({tournamentRecord:t,startDate:e}):{error:Va}}function CUe({tournamentRecord:t,endDate:e}){return e?S2({tournamentRecord:t,endDate:e}):{error:Va}}function W9e({tournamentRecord:t}){let e=Za({tournamentRecord:t}).matchUps??[],i=t.startDate&&new Date(t.startDate),n=t.endDate&&new Date(t.endDate),r=[],a=[];for(let s of e){let{schedule:o,matchUpId:l}=s;if(o&&o.scheduledDate){let c=new Date(o.scheduledDate);(i&&c<i||n&&c>n)&&(a.push(l),r.includes(o.scheduledDate)||r.push(o.scheduledDate))}}return r.length&&!g2({scheduledDates:r,tournamentRecord:t}).clearedScheduleCount?{error:Xme}:{unscheduledMatchUpIds:a}}var RUe={};Fi(RUe,{addCourt:()=>I2,addCourts:()=>F9,addVenue:()=>AR,deleteCourt:()=>FUe,deleteVenue:()=>Y9,deleteVenues:()=>_Ue,disableCourts:()=>kUe,disableVenues:()=>xUe,enableCourts:()=>OUe,enableVenues:()=>LUe,generate:()=>MUe,generateCourts:()=>p9,getCompetitionVenues:()=>iM,getCourts:()=>J7,getVenuesAndCourts:()=>Am,modifyCourt:()=>K9,modifyCourtAvailability:()=>q9,modifyVenue:()=>$Ue,mutate:()=>NUe,publicFindVenue:()=>h8,query:()=>L0e});var MUe={};Fi(MUe,{generateCourts:()=>p9});var NUe={};Fi(NUe,{addCourt:()=>I2,addCourts:()=>F9,addVenue:()=>AR,deleteCourt:()=>FUe,deleteVenue:()=>Y9,deleteVenues:()=>_Ue,disableCourts:()=>kUe,disableVenues:()=>xUe,enableCourts:()=>OUe,enableVenues:()=>LUe,modifyCourt:()=>K9,modifyCourtAvailability:()=>q9,modifyVenue:()=>$Ue});function z9(t){if(!(t!=null&&t.tournamentRecord)&&!Array.isArray(t==null?void 0:t.venueMatchUps))return{error:dt};if(!(t!=null&&t.courtId))return{error:vw};let{scheduleVisibilityFilters:e,tournamentRecord:i,matchUpFilters:n,venueMatchUps:r,courtId:a}=t,{schedulingProfile:s}=_m({tournamentRecord:i});if(Array.isArray(r))return{matchUps:l({matchUps:r,courtId:a})};let{matchUps:o}=Za({scheduleVisibilityFilters:e,tournamentRecord:i,matchUpFilters:n});return{matchUps:l({matchUps:o,courtId:a})};function l({matchUps:c,courtId:u}){let d=c.filter(p=>{var h,f,m;let g=(f=(h=p.schedule)==null?void 0:h.allocatedCourts)==null?void 0:f.map(({courtId:v})=>v);return((m=p.schedule)==null?void 0:m.courtId)===u||(g==null?void 0:g.includes(u))});return sk({matchUps:d,schedulingProfile:s})}}function Y9e({scheduleVisibilityFilters:t,tournamentRecord:e,matchUpFilters:i,venueId:n}){if(!e)return{error:dt};if(!n)return{error:Kg};let{schedulingProfile:r}=_m({tournamentRecord:e}),{matchUps:a}=Za({scheduleVisibilityFilters:t,tournamentRecord:e,matchUpFilters:i});return{matchUps:s({matchUps:a,venueId:n})};function s({matchUps:o,venueId:l}){let c=o.filter(u=>{var d,p,h;let f=(p=(d=u.schedule)==null?void 0:d.allocatedCourts)==null?void 0:p.map(({venueId:m})=>m);return((h=u.schedule)==null?void 0:h.venueId)===l||(f==null?void 0:f.includes(l))});return sk({matchUps:c,schedulingProfile:r})}}function q9({tournamentRecord:t,dateAvailability:e,disableNotice:i,venueMatchUps:n,courtId:r,force:a}){var s,o,l;if(!t)return{error:dt};if(!r)return{error:vw};let c=dTe({dateAvailability:e});if(c.error)return c;let{updatedDateAvailability:u,totalMergeCount:d}=K9e(e);e=u;let p=_w({tournamentRecord:t,courtId:r});if(p.error)return p;let{court:h,venue:f}=p,{matchUps:m}=z9({tournamentRecord:t,venueMatchUps:n,courtId:r});if(m!=null&&m.length){let g=(s=fn({tournamentRecord:t}))==null?void 0:s.appliedPolicies,v=a??((l=(o=g==null?void 0:g[Xg])==null?void 0:o.allowDeletionWithScoresPresent)==null?void 0:l.courts),y=[];y.length&&(v||console.log("throw error: scheduled court matchUps",y.length))}return h&&(h.dateAvailability=e,!i&&f&&Ti({payload:{venue:f,tournamentId:t.tournamentId},topic:Jy,key:f.venueId})),{...pe,totalMergeCount:d}}function K9e(t){let e=0,i=t.reduce((r,a)=>{let{date:s,startTime:o,endTime:l,bookings:c}=a;return r[s]||(r[s]=[]),r[s].push({startTime:o,endTime:l,bookings:c}),r},{}),n=[];return Object.keys(i).forEach(r=>{i[r].sort(h9e);let{mergedAvailability:a,mergeCount:s}=Z9e(i[r]);n.push(...a.map(o=>({date:r,...o}))),e+=s}),{updatedDateAvailability:n,totalMergeCount:e}}function Z9e(t){let e,i,n,r=t.length,a=0,s=[];for(;t.length&&r;){let l=t.shift(),{startTime:c,endTime:u,bookings:d}=l;if(r-=1,!e)e=c,n=d,i=u;else if(cR(Xr(i),Xr(c),!1)>0){let p={startTime:e,endTime:i};n!=null&&n.length&&(p.bookings=n),s.push(p),e=c,n=d,i=u}else d&&(n?n.push(d):n=d),i=u,a+=1}let o={startTime:e,endTime:i};return n!=null&&n.length&&(o.bookings=n),s.push(o),{mergedAvailability:s,mergeCount:a}}function W9({matchUpsCount:t=0}){let e=`Schedule would be deleted from ${t} ${t===1?"matchUp":"matchUps"}; use { force: true }`;return{error:tve,info:e}}function AUe({tournamentRecord:t,drawDefinition:e,matchUpId:i,drawId:n}){let r="removeCourtAssignment";if(!i)return{error:Zs};if(!e&&!n)return{error:jd};let a;if(!e){if(!t)return{error:dt};({drawDefinition:e}=zo({tournamentRecord:t,drawId:n}))}if(e)({matchUp:a}=or({drawDefinition:e,matchUpId:i}));else{if(!t)return{error:dt};let s=Za({tournamentRecord:t,inContext:!1}).matchUps??[];({matchUp:a}=LIe({matchUps:s,matchUpId:i}))}return a?(a.timeItems&&a.timeItems.find(s=>[Dg,Yh].includes(s.itemType))&&(a.timeItems=a.timeItems.filter(({itemType:s})=>![Dg,Yh].includes(s)),Qi({tournamentId:t==null?void 0:t.tournamentId,context:r,drawDefinition:e,matchUp:a})),{...pe}):{error:xs}}function Y9(t){var e,i,n;if(typeof(t==null?void 0:t.venueId)!="string")return{error:Kg};let{tournamentRecord:r,venueId:a,force:s}=t,o=t.tournamentRecords||r&&{[r.tournamentId]:r}||{};if(!Object.keys(o).length)return{error:dt};let l=Fd({tournamentRecords:o,contextFilters:{venueIds:[a]}}).matchUps??[],c=(e=fn({tournamentRecord:r}))==null?void 0:e.appliedPolicies,u=s??((n=(i=c==null?void 0:c[Xg])==null?void 0:i.allowDeletionWithScoresPresent)==null?void 0:n.venues);if(!l.length||u)for(let d of Object.values(o)){for(let h of l){let f=AUe({matchUpId:h.matchUpId,drawId:h.drawId,tournamentRecord:d});if(f.error)return f}let p;d.venues=(d.venues??[]).filter(h=>(h==null?void 0:h.venueId)!==a?!0:(p=!0,!1)),p&&Ti({payload:{venueId:a,tournamentId:d.tournamentId},topic:z6,key:a})}else return W9({matchUpsCount:l.length});return rM({tournamentRecords:o}),{...pe}}function _Ue({tournamentRecord:t,venueIds:e,force:i}){if(!t)return{error:dt};if(!Array.isArray(e))return{error:Ae};for(let n of t.venues||[]){let{venueId:r}=n;if(e.includes(r)){let{venueId:a}=n,s=Y9({tournamentRecord:t,venueId:a,force:i});if(s.error)return s}}return{...pe}}function kUe(t){let{courtIds:e,dates:i}=t,n=au(t),r=[{[Os]:!0,[KL]:!0}],a=ei(t,r);if(a.error)return a;for(let s of Object.values(n))X9e({tournamentRecord:s,courtIds:e,dates:i});return{...pe}}function X9e({tournamentRecord:t,courtIds:e,dates:i}){let n=Array.isArray(i)&&i.length?{dates:i}:!0,r=a=>pn({extension:{value:n,name:Pd},creationTime:!1,element:a});for(let a of t.venues||[])for(let s of a.courts||[])if(e!=null&&e.includes(s.courtId)){let o=r(s);if(o.error)return o}return{...pe}}function xUe(t){let{tournamentRecords:e,tournamentId:i,venueIds:n}=t,r=[{[Os]:!0,[ZL]:!0}],a=ei(t,r);if(a.error)return a;let s=Object.keys(e).filter(o=>!i||o===i);for(let o of s){let l=e[o];J9e({tournamentRecord:l,venueIds:n})}return{...pe}}function J9e({tournamentRecord:t,venueIds:e}){for(let i of t.venues||[])if(e!=null&&e.includes(i.venueId)){let n=pn({creationTime:!1,element:i,extension:{name:Pd,value:!0}});if(n.error)return n}return{...pe}}function OUe(t){let e=au(t),i=[{[Os]:!0}];!t.enableAll&&i.push({[KL]:!0});let n=ei(t,i);if(n.error)return n;let{enableAll:r,courtIds:a,dates:s}=t;for(let o of Object.values(e))Q9e({tournamentRecord:o,courtIds:a,enableAll:r,dates:s});return{...pe}}function Q9e({tournamentRecord:t,courtIds:e,enableAll:i,dates:n}){for(let r of t.venues||[])for(let a of r.courts||[])if(i||e!=null&&e.includes(a.courtId))if(Array.isArray(n)){let{extension:s}=xi({element:a,name:Pd});if(s){let o=s.value;Array.isArray(o.dates)&&(o.dates=o.dates.filter(l=>!n.includes(l))),pn({extension:{name:Pd,value:o},creationTime:!1,element:a})}}else uo({element:a,name:Pd});return{...pe}}function LUe(t){let e=au(t),i=[{[Os]:!0}];!t.enableAll&&i.push({[ZL]:!0});let n=ei(t,i);if(n.error)return n;let{venueIds:r,enableAll:a}=t;for(let s of Object.values(e))for(let o of s.venues||[])(a||r!=null&&r.includes(o.venueId))&&uo({element:o,name:Pd});return{...pe}}function FUe(t){let{courtId:e,disableNotice:i,force:n}=t,r=au(t),a=ei(t,[{[Os]:!0,[gye]:!0}]);if(a.error)return a;let s,o;for(let l of Object.values(r)){if(o=eYe({tournamentRecord:l,disableNotice:i,courtId:e,force:n}),o.error&&o.error!==OU)return o;o.success&&(s=!0)}return s?{...pe}:o}function eYe({tournamentRecord:t,disableNotice:e,courtId:i,force:n}){var r,a,s;let o=_w({tournamentRecord:t,courtId:i});if(o.error)return o;let l=o.venue,{matchUps:c}=z9({tournamentRecord:t,courtId:i}),u=(r=fn({tournamentRecord:t}))==null?void 0:r.appliedPolicies,d=n??((s=(a=u==null?void 0:u[Xg])==null?void 0:a.allowDeletionWithScoresPresent)==null?void 0:s.courts);if(!(c!=null&&c.length)||d){for(let p of c??[]){let h=AUe({matchUpId:p.matchUpId,drawId:p.drawId,tournamentRecord:t});if(h.error)return h}l&&(l.courts=(l.courts??[]).filter(p=>p.courtId!==i),e||Ti({payload:{venue:l,tournamentId:t.tournamentId},topic:Jy,key:l.venueId}))}else return W9({matchUpsCount:c.length});return{...pe}}function K9(t){let{disableNotice:e,modifications:i,courtId:n,force:r,venueMatchUps:a}=t,s=au(t);if(!Object.keys(s).length)return{error:Tr};let o,l;for(let c of Object.values(s)){let u=tYe({tournamentRecord:c,disableNotice:e,venueMatchUps:a,modifications:i,courtId:n,force:r});if(u!=null&&u.error)return u;o=!0}return o?{...pe}:l}function tYe({tournamentRecord:t,disableNotice:e,venueMatchUps:i,modifications:n,courtId:r,force:a}){if(!t)return{error:dt};if(!r)return{error:vw};if(!n||typeof n!="object")return{error:Pm};let s=_w({tournamentRecord:t,courtId:r});if(s.error)return s;let{venue:o,court:l}=s,c=Object.keys(p9e()).filter(p=>p!=="courtId");if(!Object.keys(n).filter(p=>c.includes(p)).length)return{error:NL};let u=c.filter(p=>!["dateAvailability"].includes(p)),d=Object.keys(n).filter(p=>u.includes(p));if(l&&d.forEach(p=>Object.assign(l,{[p]:n[p]})),n.dateAvailability){let p=q9({dateAvailability:n.dateAvailability,tournamentRecord:t,venueMatchUps:i,disableNotice:e,courtId:r,force:a});if(p.error)return p}return e||Ti({payload:{venue:o,tournamentId:t.tournamentId},topic:Jy,key:o==null?void 0:o.venueId}),{...pe,court:$t(l)}}var iYe=()=>({venueId:void 0,venueName:"",venueAbbreviation:"",onlineResources:[],venueType:void 0,addresses:[],contacts:[],courts:[],roles:[]}),nYe=iYe;function $Ue(t){let{modifications:e,venueId:i,force:n}=t,r=au(t);if(!Object.keys(r).length)return{error:Tr};if(typeof i!="string")return{error:Kg};let a,s;for(let o of Object.values(r)){let l=rYe({tournamentRecord:o,modifications:e,venueId:i,force:n});if(l.success&&(s=!0),l.error&&(a=l.error),l.error&&l.error!==Iw)return l}return rM({tournamentRecords:r}),s?{...pe}:{error:a}}function rYe({tournamentRecord:t,modifications:e,venueId:i,force:n}){var r,a,s,o,l,c,u,d;if(!t)return{error:dt};if(!e||typeof e!="object")return{error:Pm};if(!i)return{error:Kg};let p=(r=fn({tournamentRecord:t}))==null?void 0:r.appliedPolicies,h=n??((s=(a=p==null?void 0:p[Xg])==null?void 0:a.allowDeletionWithScoresPresent)==null?void 0:s.venues),{matchUps:f}=Y9e({tournamentRecord:t,venueId:i}),m=tf({tournamentRecord:t,venueId:i});if(m.error)return m;let g=m.venue,v=Object.keys(nYe()).filter(U=>U!=="venueId");if(!Object.keys(e).filter(U=>v.includes(U)).length)return{error:NL};let y=v.filter(U=>!["courts","onlineResources"].includes(U)),b=Object.keys(e).filter(U=>y.includes(U));g&&b.forEach(U=>Object.assign(g,{[U]:e[U]}));let I=((o=g==null?void 0:g.courts)==null?void 0:o.map(U=>U.courtId))??[],T=((l=e.courts)==null?void 0:l.map(U=>U.courtId))||[],w=T.length?I.filter(U=>!T.includes(U)):(e==null?void 0:e.courts)&&I,S=[];if(w!=null&&w.length){let U=(u=(c=g==null?void 0:g.courts)==null?void 0:c.filter(P=>w.includes(P.courtId)))==null?void 0:u.map(P=>{var E;let R=z9({courtId:P.courtId,tournamentRecord:t,venueMatchUps:f});for(let C of R.matchUps??[])S.push({matchUpId:C.matchUpId,drawId:C.drawId});return((E=R.matchUps)==null?void 0:E.length)??0}).reduce((P,E)=>P+E);if(g&&(!U||h))g.courts=(d=g.courts)==null?void 0:d.filter(P=>T.includes(P.courtId)),aP({schedule:{courtId:"",scheduledDate:""},matchUpDetails:S,removePriorValues:!0,tournamentRecord:t});else return W9({matchUpsCount:U})}if(e.courts)for(let U of e.courts){let{courtId:P}=U||{},E=K9({modifications:U,disableNotice:!0,tournamentRecord:t,venueMatchUps:f,courtId:P,force:n});if(E.error===OU&&(E=I2({disableNotice:!0,tournamentRecord:t,venueId:i,court:U})),E.error)return E}return rM({tournamentRecord:t}),g&&Ti({payload:{venue:g,tournamentId:t.tournamentId},topic:Jy,key:g==null?void 0:g.venueId}),{...pe,venue:$t(g)}}var Z9={};Fi(Z9,{JSON2CSV:()=>dYe,UUID:()=>bn,UUIDS:()=>wve,allNumeric:()=>Hme,attributeFilter:()=>DI,chunkArray:()=>Na,chunkByNth:()=>Mj,chunkSizeProfile:()=>Gme,constantToString:()=>ys,countValues:()=>wHe,createMap:()=>qme,dateTime:()=>Ive,definedAttributes:()=>Zt,dehydrateMatchUps:()=>oYe,extractAttributes:()=>Tbe,flattenJSON:()=>X9,generateDateRange:()=>oT,generateHashCode:()=>RHe,generateRange:()=>Mt,generateTimeCode:()=>yTe,groupValues:()=>Vme,hasAttributeValues:()=>CHe,instanceCount:()=>Ol,intersection:()=>Ar,isConvertableInteger:()=>wi,isNumeric:()=>Er,isOdd:()=>$me,isPowerOf2:()=>kd,makeDeepCopy:()=>$t,matchUpScheduleSort:()=>sYe,matchUpSort:()=>kw,nearestPowerOf2:()=>_5,nextPowerOf2:()=>MU,noNulls:()=>IHe,noNumeric:()=>zme,numericSort:()=>ra,occurrences:()=>THe,overlap:()=>vo,randomMember:()=>Cu,randomPop:()=>Ul,shuffleArray:()=>co,structureSort:()=>Ew,subSort:()=>UHe,undefinedToNull:()=>Nj,unique:()=>Pi,visualizeScheduledMatchUps:()=>aYe});function aYe({scheduledMatchUps:t,showGlobalLog:e}){Z3e();let i=t==null?void 0:t.reduce((r,{structureId:a})=>r.includes(a)?r:r.concat(a),[]),n=Array.isArray(i)&&{...i.map(r=>{let{structureName:a,matchUpType:s}=t.find(o=>o.structureId===r);return{[r]:`${a} ${s}`}})};i==null||i.forEach(r=>{var a;Jl({color:"blue",method:"draw",structure:n[r],keyColors:{structure:"magenta"}},!0);let s=t.filter(l=>l.structureId===r),o=((a=yo({matchUps:s}))==null?void 0:a.roundMatchUps)||[];Object.keys(o).forEach(l=>{Jl({roundNumber:l,keyColors:{roundNumber:"brightcyan"}},!0),o[l].forEach(({matchUpId:c,schedule:u})=>{let d=sr(u.scheduledTime);Jl({matchUpId:c,time:d,date:u.scheduledDate,venue:u.venueId,keyColors:{time:"brightcyan",date:"brightcyan",matchUpId:"yellow",venue:"magenta"}},!0)})})}),e&&K3e()}var{extractTime:BJ,timeStringMinutes:VJ}=Ive;function sYe(t,e){let i=t.schedule??{},n=e.schedule??{};if(i.scheduledDate&&!n.scheduledDate)return 1;if(n.scheduledDate&&!i.scheduledDate)return-1;if(i.scheduledDate&&n.scheduledDate){if(i.scheduledDate===n.scheduledDate){if(i.scheduledTime&&!n.scheduledTime)return 1;if(n.scheduledTime&&!i.scheduledTime)return-1;if(i.scheduledTime&&n.scheduledTime){let r=VJ(BJ(i.scheduledTime)),a=VJ(BJ(n.scheduledTime));return r-a}}return new Date(i.scheduledDate).getTime()-new Date(n.scheduledDate).getTime()}return 0}function oYe({tournamentRecord:t}){if(!t)return{error:dt};if(typeof t!="object"||!t.tournamentId)return{error:Ae};let{matchUps:e}=Za({tournamentRecord:t,inContext:!1});if(e!=null&&e.length){let i=lYe({tournamentRecord:t});uYe(e,i)}return{...pe}}function lYe({tournamentRecord:t}){let e={};for(let i of t.events||[]){i.matchUpFormat&&(e[i.eventId]=i.matchUpFormat);for(let n of i.drawDefinitions||[]){n.matchUpFormat&&(e[n.drawId]=n.matchUpFormat);for(let r of n.structures||[]){r.matchUpFormat&&(e[r.structureId]=r.matchUpFormat);for(let a of r.structures||[])a.matchUpFormat&&(e[a.structureId]=a.matchUpFormat)}}}return e}var cYe=["collectionId","collectionPosition","drawPositions","extensions","finishingPositionRange","finishingRound","isMock","matchUpId","matchUpStatus","matchUpStatusCodes","orderOfFinish","processCodes","roundNumber","tieFormat","tieMatchUps","roundPosition","score","sides","winnerMatchUpId","loserMatchUpId","matchUpDuration","winningSide"];function uYe(t,e={}){for(let i of t){let{structureId:n,drawId:r,eventId:a}=i,s=e[n]||e[r]||e[a],o=i.matchUpFormat===s?void 0:i.matchUpFormat;for(let l of Object.keys(i))cYe.includes(l)||delete i[l];i.sides&&i.drawPositions&&!i.tieMatchUps&&delete i.sides,o&&(i.matchUpFormat=o)}}function dYe(t,e){if(e&&typeof e!="object")return{error:Ae};let{columnTransform:i={}}=e||{},{includeTransformAccessors:n,includeHeaderRow:r=!0,returnTransformedJSON:a,removeEmptyColumns:s,onlyHeaderRow:o,columnAccessors:l=[],functionMap:c={},columnMap:u={},valuesMap:d={},context:p={},delimiter:h='"',columnJoiner:f=",",rowJoiner:m=`\r
`,keyJoiner:g="."}=e||{};if(!Array.isArray(t)||!Array.isArray(l)||typeof p!="object"||typeof u!="object"||typeof i!="object"||typeof c!="object"||typeof d!="object"||typeof f!="string"||typeof m!="string"||typeof g!="string"||typeof h!="string")return{error:Ae};i=Object.assign({},...Object.keys(i).reverse().map(_=>({[_]:Array.isArray(i[_])?i[_]:[typeof i[_]=="string"&&i[_]].filter(Boolean)})));let v=t.filter(Boolean).map(_=>X9(_,g)),y=Object.values(i).flat();n&&l.push(...y);let b=v.reduce((_,A)=>Object.keys(A).every(N=>!_.includes(N)&&_.push(N)||!0)&&_,[]).filter(_=>!(l!=null&&l.length)||l.includes(_)),I=Object.assign({},...Object.keys(i).reverse().map(_=>i[_].map(A=>({[A]:_})).flat()).flat()),T=(_,A)=>e!=null&&e.sortOrder?e.sortOrder.includes(_)&&e.sortOrder.includes(A)&&e.sortOrder.indexOf(_)-e.sortOrder.indexOf(A)||!e.sortOrder.includes(A)&&-1:0,w=b.reduce((_,A)=>{let N=I[A];return N?_.includes(N)||_.push(N):_.push(A),_},[]).sort(T);Object.keys(u).forEach(_=>!w.includes(_)&&w.unshift(_)),Object.keys(i).forEach(_=>!w.includes(_)&&w.unshift(_)),typeof p=="object"&&Object.keys(p).forEach(_=>!w.includes(_)&&w.unshift(_));let S=w.map(_=>u[_]||_);if(o)return[S];let U=_=>`${h}${_}${h}`,P=[],E=_=>Object.values(w.reduce((A,N,k)=>{var O;let $=i[N],F=($!=null&&$.length?_[$.find(B=>_[B])]:_[N])||(p==null?void 0:p[N])||"",V=((O=d[N])==null?void 0:O[F])||F,j=Sl(c[N])?c[N](V):V;return A[N]=U(j),j&&(P[k]=(P[k]||0)+1),A},{})),R=v.map(E),C=s&&[...P].map((_,A)=>!_&&A).filter(Er).reverse();if(C){let _=A=>A.filter((N,k)=>!C.includes(k));R=R.map(_),S=_(S)}let M=R.map(_=>_.join(f));return a?M.map(_=>{let A=_.split(f);return Object.assign({},...A.map((N,k)=>({[S[k]]:N})))}):r?[S.map(U).join(f),...M].join(m):M.join(m)}function X9(t,e=".",i=[]){return typeof t=="object"&&Object.keys(t).reduce((n,r)=>typeof t[r]!="object"?(n[i.concat(r).join(e)]=t[r],n):Object.assign(n,X9(t[r],e,i.concat(r))),{})}var{FACTORY:jJ}=Dye;function pYe({tournamentRecord:t,value:e}){let{extension:i}=xi({element:t,name:jJ}),n={name:jJ,value:{...i==null?void 0:i.value,...e}};pn({element:t,extension:n})}function BUe({timeStamp:t}){let e=Sw(),i=l6();return i&&Object.values(e).forEach(n=>{pYe({tournamentRecord:n,value:{version:bL(),timeStamp:t}})}),i}function VUe({engineType:t,methodName:e,elapsed:i,params:n,result:r}){var a,s;let o=oc();if(typeof o!="object")return;let l={method:e},c=(r==null?void 0:r.error)&&(o.errors===!0||Array.isArray(o.errors)&&o.errors.includes(e)),u=Array.isArray(o.params)&&((a=o.params)==null?void 0:a.includes(e)),d=o.params&&!Array.isArray(o.params)||u,p=Array.isArray(o.exclude)&&o.exclude.includes(e);!p&&![void 0,!1].includes(o.perf)&&!isNaN(o.perf)&&i>=o.perf&&(l.elapsed=i),!p&&(c||d)&&(l.params=n),!p&&(c||o.result&&!Array.isArray(o.result)&&(!Array.isArray(o.params)||u)||Array.isArray(o.result)&&(s=o.result)!=null&&s.includes(e))&&(l.result=r),Object.keys(l).length>1&&pve(l,t)}function J9({methodName:t,params:e,start:i}){let n={error:_L,methodName:t},r=i?Date.now()-i:0;return VUe({result:n,methodName:t,elapsed:r,params:e,engineType:"sync"}),n}function hYe(t,e){var i;if(e._middleware===!1)return e;if(e.tournamentId&&!t[e.tournamentId])return{error:dt};let n=e.drawId||((i=e.matchUp)==null?void 0:i.drawId);if(n){let{event:s,drawDefinition:o,tournamentId:l}=zo({tournamentRecords:t,drawId:n});o&&(e.drawDefinition=o),l&&(e.tournamentId=l),s&&(e.event=s)}if(e.eventId&&!e.event){let{event:s,tournamentId:o}=zo({eventId:e.eventId,tournamentRecords:t});if(!s)return{error:Wc};e.tournamentId=o,e.event=s}let r=e.tournamentId??ww();if(!r&&e)return e;let a=t[r];return r&&!a?{error:dt}:(a&&(e.tournamentRecord=a),e)}function Q9(t,e,i,n,r){delete t.success,delete t.error;let a=Date.now(),s=ww();i&&(i.activeTournamentId=s);let o=(i==null?void 0:i.tournamentRecord)||u6(s),l=typeof(i==null?void 0:i.tournamentRecord)=="object"&&{[i==null?void 0:i.tournamentRecord.tournamentId]:i.tournamentRecord}||Sw(),c=i?$t(i,void 0,!0):void 0,u=i?hYe(l,i):void 0;if(u!=null&&u.error)return u;let d=fYe({params:u,tournamentRecords:l,tournamentRecord:o,methodName:n,method:e}),p=Date.now()-a;return VUe({result:d,methodName:n,elapsed:p,params:c,engineType:r}),d}function fYe({tournamentRecords:t,tournamentRecord:e,params:i,methodName:n,method:r}){if(oc())return r({tournamentRecords:t,tournamentRecord:e,...i});try{return r({tournamentRecords:t,tournamentRecord:e,...i})}catch(a){return LL({engineName:"engine",methodName:n,params:i,err:a})}}function T2(t){let{mutationStatus:e,tournamentId:i,directives:n,timeStamp:r}=t||{},{topics:a}=ru();for(let s of[...a].sort(mYe)){let o=cve({topic:s});o!=null&&o.length&&jj({topic:s,notices:o})}e&&r&&a.includes(Kj)&&jj({notices:[{tournamentId:i,directives:n,timeStamp:r}],topic:Kj})}var GJ={[Q6]:5,[J6]:5,[e8]:5,[X6]:5,[Z6]:5,[Y6]:5,[Vye]:5,[jye]:5,[K6]:1,[nF]:1,[Ss]:5,[Jy]:5,[W6]:4,[H6]:4,[z6]:4,[q6]:4,[iF]:3,[B6]:2};function mYe(t,e){return(GJ[e]||0)-(GJ[t]||0)}function gYe({convertExtensions:t,removeExtensions:e}){let i=Sw();return{tournamentId:ww(),tournamentRecords:$t(i,t,!1,e)}}function vYe(t){let{convertExtensions:e=!1,removeExtensions:i=!1}=t??{},n=(t==null?void 0:t.tournamentId)??ww();if(typeof n!="string")return{};let r=u6(n);return{tournamentRecord:$t(r,e,!1,i)}}function yYe(){var t;let e=Sw(),{extension:i}=xi({name:yy,tournamentRecords:e,discover:!0}),n=((t=i==null?void 0:i.value)==null?void 0:t.tournamentIds)||[];return Object.keys(e).forEach(r=>{n.includes(r)||delete e[r]}),OL(e)}function HJ(t,e=!0){return typeof t!="object"||Array.isArray(t)?{error:Pm}:t!=null&&t.tournamentId?uve(e?$t(t):t):{error:Ae}}function sP(t,e=!0){if(typeof t!="object")return{error:Pm};if(OE(),Array.isArray(t)){if(t.filter(i=>i==null?void 0:i.tournamentId).length!==t.length)return{error:kj};t=Object.assign({},...t.map(i=>({[i.tournamentId]:i})))}else if(t!=null&&t.tournamentId)t={[t.tournamentId]:t},OE(t.tournamentId);else if(!Object.keys(t).every(i=>t[i].tournamentId===i))return{error:kj};return OL(e?$t(t):t)}function bYe(t,e,i,n,r,a){let s=hve(i,n,r,a);if(s.error)return s;let o=s.methods??[];return Object.keys(o).filter(l=>Sl(o[l])).forEach(l=>{t[l]=c=>{let u=()=>e(t,{[l]:o[l],...c});if(oc())return u();try{return u()}catch(d){LL({engineName:"engine",methodName:l,params:c,err:d})}}}),{...pe,...t}}function E0(t,e){return e!=null&&e.error?(t.error=e.error,t.success=!1):(t.error=void 0,t.success=!0),t}function jUe(t,e){t.importMethods=(i,n,r,a)=>bYe(t,e,i,n,r,a),t.getTournament=i=>vYe(i),t.getState=i=>gYe({convertExtensions:i==null?void 0:i.convertExtensions,removeExtensions:i==null?void 0:i.removeExtensions}),t.version=()=>bL(),t.reset=()=>(OL({}),E0(t)),t.devContext=i=>(kE(i),E0(t)),t.getDevContext=i=>oc(i),t.newTournamentRecord=(i={})=>{let n=y2(i),r=n.tournamentId;return n.error?n:(HJ(n),OE(r),{...pe,tournamentId:r})},t.setState=(i,n,r)=>{xE(n,r);let a=sP(i,n);return E0(t,a)},t.setTournamentId=i=>OE(i),t.getTournamentId=()=>ww(),t.setTournamentRecord=(i,n,r)=>{xE(n,r);let a=HJ(i,n);return E0(t,a)},t.removeTournamentRecord=i=>{let n=dve(i);return E0(t,n)},t.removeUnlinkedTournamentRecords=()=>{let i=yYe();return E0(t,i)}}function IYe(t,e,i){if(!Array.isArray(e))return{error:Ae,message:"directives must be an array"};let n=lve(),r=Date.now(),a=i&&$t(Sw(),!1,!0),s=[];for(let c of e){if(typeof c!="object")return{error:Ae,message:"directive must be an object"};if(c.params&&typeof c.params!="object")return{error:Ae,message:"params must be an object"};let{method:u,pipe:d}=c,p=c.params?{...c.params}:{};if(!n[u])return J9({methodName:u,start:r,params:p});if(d){let f=s[s.length-1],m=Object.keys(d);for(let g of m)f[g]&&(p[g]=f[g])}let h=Q9(t,n[u],p,u,"sync");if(h!=null&&h.error)return a&&sP(a),{...h,rolledBack:!!a};s.push({...h,methodName:u})}let o=Date.now(),l=BUe({timeStamp:o});return T2({directives:e,mutationStatus:l,timeStamp:o}),oR(),{success:s.every(c=>c.success),results:s}}function zJ(t,e){if(!tn(e))return{error:Ae,message:"args must be an object"};let i=Object.values(e).filter(Sl).length;if(i>1)return{message:"there must be only one arg with typeof function",error:Ae};let n=i?Object.keys(e).find(h=>Sl(e[h])):ur(e.method)&&e.method;if(!n)return{error:_L};let{[n]:r,...a}=e,s=e!=null&&e.params?{...e.params}:{...a},o=s.rollbackOnError&&$t(Sw(),!1,!0),l=r||t[n]||s6()[n];if(!l)return J9({methodName:n,params:s});let c=Q9(t,l,s,n,"sync")??{};c!=null&&c.error&&o&&sP(o);let u=Date.now(),d=BUe({timeStamp:u}),p=(c==null?void 0:c.success)&&(s==null?void 0:s.delayNotify)!==!0&&(s==null?void 0:s.doNotNotify)!==!0;return p&&T2({directives:[{method:l,params:s}],mutationStatus:d,timeStamp:u}),(p||!(c!=null&&c.success)||s!=null&&s.doNotNotify)&&oR(),c}var wYe=(()=>{let t={executionQueue:(e,i)=>IYe(t,e,i),execute:e=>zJ(t,e)};return jUe(t,zJ),t})(),eY=wYe;function qJ(t,e){if(!tn(e))return{error:Ae,message:"args must be an object"};let i=Object.values(e).filter(Sl).length;if(i>1)return{message:"there must be only one arg with typeof function",error:Ae};let n=i?Object.keys(e).find(l=>Sl(e[l])):ur(e.method)&&e.method;if(!n)return{error:_L};let{[n]:r,...a}=e,s=e!=null&&e.params?{...e.params}:{...a},o=r||t[n]||s6()[n];return o?Q9(t,o,s,n,"ask"):J9({methodName:n,params:s})}(()=>{let t={execute:e=>qJ(t,e)};return jUe(t,qJ),t})();var tI={},Qm;function WJ(t,e=!0){if(!t)return{error:si};if(typeof t!="object")return{error:Pm};if(t.matchUpId)Qm=t.matchUpId,tI[Qm]=e?$t(t):t;else if(Array.isArray(t))for(let i of t.reverse())i.matchUpId&&(tI[i.matchUpId]=e?$t(i):i,Qm||(Qm=i.matchUpId));else for(let i of Object.values(t))i.matchUpId&&(tI[i.matchUpId]=e?$t(i):i,Qm||(Qm=i.matchUpId));return e?$t(t):t}function SYe(){return tI[Qm]}function TYe(){return Object.values(tI)}function UYe(){Qm=void 0,tI={}}function DYe(t){return $t(tI[Qm],t==null?void 0:t.convertExtensions,!1,t==null?void 0:t.removeExtensions)}(()=>{let t={getState:r=>DYe(r),version:()=>bL(),reset:()=>(UYe(),{...pe}),drawId:void 0,error:void 0,success:!1,devContext:r=>(kE(r),t),setState:(r,a,s)=>{xE(a,s);let o=WJ(r);return e(o)}};function e(r){return r!=null&&r.error?(t.error=r.error,t.success=!1):(t.error=void 0,t.success=!0,t.drawId=r.drawId),t}return i([h7]),t;function i(r){r.forEach(a=>{Object.keys(a).forEach(s=>{t[s]=o=>{if(oc())return n({params:o,governor:a,methodName:s});try{return n({params:o,governor:a,methodName:s})}catch(l){LL({engineName:"matchUpEngine",methodName:s,params:o,err:l})}}})})}function n({params:r,governor:a,methodName:s}){t.error=void 0,t.success=!1;let o=(r==null?void 0:r.matchUp)||SYe(),l=(r==null?void 0:r.matchUps)||TYe(),c=(r==null?void 0:r.rollbackOnError)&&$t(o,!1,!0);r={...r,matchUpId:o==null?void 0:o.matchUpId,matchUps:l,matchUp:o};let u=a[s](r);if(u!=null&&u.error)return c&&WJ(c),{...u,rolledBack:!!c};let d=(u==null?void 0:u.success)&&(r==null?void 0:r.delayNotify)!==!0&&(r==null?void 0:r.doNotNotify)!==!0;return d&&T2(),(d||!(u!=null&&u.success)||r!=null&&r.doNotNotify)&&oR(),u}})();var rB=!1;(()=>{let t={version:()=>bL(),setDeepCopy:(n,r)=>(xE(n,r),t),devContext:n=>(kE(n),rB=!0,t)};return i([C9]),t;function e(n,r){let a=n({...r});return a!=null&&a.error||T2(),oR(),rB&&(kE(!1),rB=!1),a}function i(n){n.forEach(r=>{Object.keys(r).forEach(a=>{t[a]=s=>{if(oc()){let o=e(r[a],s);return!(o!=null&&o.error)&&s!=null&&s.setState&&o!=null&&o.tournamentRecord&&sP(o.tournamentRecord),o}else try{let o=e(r[a],s);return!(o!=null&&o.error)&&s!=null&&s.setState&&o!=null&&o.tournamentRecord&&sP(o.tournamentRecord),o}catch(o){let l;typeof o=="string"?l=o.toUpperCase():o instanceof Error&&(l=o.message),console.log("ERROR",{params:JSON.stringify(s),method:a,error:l})}}})})}})();eY.importMethods(xme,!0,1);var GUe=eY,EYe={getTournamentPoints:HF},PYe=EYe,CYe={calculateNewRatings:gwe,generateDynamicRatings:vwe},RYe=CYe,MYe={...PYe,...RYe};eY.importMethods(MYe);var NYe={[zE]:{roundsToSeparate:void 0,policyName:"Nationality Code",policyAttributes:[{key:"person.nationalityCode"},{key:"individualParticipants.person.nationalityCode"}]}},AYe={[rm]:{policyName:"positionActionsUnrestricted",enabledStructures:[],otherFlightEntries:!0,disableRoundRestrictions:!0,activePositionOverrides:[Xb,DD]}},_Ye={[rm]:{policyName:"positionActionsNoMovement",enabledStructures:[{stages:[],stageSequences:[],enabledActions:[Xb,JE,MI],disabledActions:[]}]}},kYe={[rm]:{policyName:"positionActionsDisabled",enabledStructures:!1}},xYe={[jU]:{policyName:"Participant Privacy Policy",participant:{contacts:!1,individualParticipants:{onlineResources:!1,participantName:!0,participantOtherName:!0,participantId:!0,participantRole:!0,participantStatus:!0,penalties:!1,rankings:!0,ratings:!0,representing:!0,participantRoleResponsibilities:!1,participantType:!0,person:{addresses:!1,biographicalInformation:!1,birthDate:!1,contacts:!1,nationalityCode:!0,nativeFamilyName:!1,nativeGivenName:!1,onlineResources:!1,otherNames:!0,parentOrganisationId:!1,passportFamilyName:!1,passportGivenName:!1,personId:!1,personOtherIds:!1,previousNames:!1,sex:!1,standardFamilyName:!0,standardGivenName:!0,status:!1,tennisId:!1,wheelchair:!0}},individualParticipantIds:!0,onlineResources:!1,participantName:!0,participantOtherName:!0,participantId:!0,participantRole:!0,participantStatus:!0,penalties:!1,rankings:!0,ratings:!0,representing:!0,participantRoleResponsibilities:!1,participantType:!0,person:{addresses:!1,biographicalInformation:!1,birthDate:!1,contacts:!1,nationalityCode:!0,nativeFamilyName:!1,nativeGivenName:!1,onlineResources:!1,otherNames:!0,parentOrganisationId:!1,passportFamilyName:!1,passportGivenName:!1,personId:!1,personOtherIds:!1,previousNames:!1,sex:!1,standardFamilyName:!0,standardGivenName:!0,status:!1,tennisId:!1,wheelchair:!0}}}},OYe={[Kc]:{processCodes:{incompleteAssignmentsOnDefault:["RANKING.IGNORE"]},defaultMatchUpFormat:Fu,allowDeletionWithScoresPresent:{drawDefinitions:!1,structures:!1},requireParticipantsForScoring:!1,requireAllPositionsAssigned:void 0,allowChangePropagation:!1,stage:{[Bt]:{stageSequence:{1:{requireAllPositionsAssigned:!0}}}},matchUpFormats:[],matchUpStatusCodes:{[ul]:[],[Kp]:[],[Ki]:[],[$l]:[],[ss]:[],[un]:[]}}},aB="Personal circumstance",LYe={[Kc]:{requireAllPositionsAssigned:!1,stage:{[Bt]:{stageSequence:{1:{requireAllPositionsAssigned:!0}}}},defaultMatchUpFormat:Fu,matchUpFormats:[{description:"Best of 3 tiebreak sets",matchUpFormat:Fu,categoryNames:[],categoryTypes:[]},{description:"Two tiebreak sets, 7-point match tiebreak at one set all",matchUpFormat:"SET3-S:6/TB7-F:TB7"},{description:"Two tiebreak sets, 10-point match tiebreak at one set all",matchUpFormat:"SET3-S:6/TB7-F:TB10"},{description:"One standard tiebreak set to 6, 7-point tiebreak at 6 games all",matchUpFormat:"SET1-S:6/TB7"},{description:"Best of 3 sets to 4",matchUpFormat:"SET3-S:4/TB7"},{description:"Two out of three short sets to 4 with 5-point tiebreak at 3 games all",matchUpFormat:"SET3-S:4/TB5@3"},{description:"One short set to 4, 7-point tiebreak at 4 games all",matchUpFormat:"SET1-S:4/TB7"},{description:"One short set to 4, 5-point tiebreak at 3 games all",matchUpFormat:"SET1-S:4/TB5@3"},{description:"Two short sets to 4, 10-point match tiebreak at one set all",matchUpFormat:"SET3-S:4/TB7-F:TB10"},{description:"Two short sets to 4, 7-point match tiebreak at one set all",matchUpFormat:"SET3-S:4/TB7-F:TB7"},{description:"One no advantage set to 5, tiebreak to 9 at 4-4",matchUpFormat:"SET1-S:5/TB9@4"},{description:"One set to 6 with deciding game at 5 games all",matchUpFormat:"SET1-S:6NOAD"},{description:"One short set to 4, deciding game is played at 3 games all",matchUpFormat:"SET1-S:4NOAD"},{description:"Two short sets to 4 with deciding game at 3-3, 7-point match tiebreak at one set all",matchUpFormat:"SET3-S:4NOAD-F:TB7"},{description:"8 game pro-set with 7 point tiebreak at 8 games all",matchUpFormat:"SET1-S:8/TB7"},{description:"8 game pro-set with 7 point tiebreak at 7 games all",matchUpFormat:"SET1-S:8/TB7@7"},{description:"Best of 3 10-point tiebreak games",matchUpFormat:"SET3-S:TB10"},{description:"One 10-point tiebreak game",matchUpFormat:"SET1-S:TB10"},{description:"Timed 20 minute game - game based",matchUpFormat:"SET1-S:T20"}],matchUpStatusCodes:{[ul]:[{matchUpStatusCodeDisplay:"Abandoned",label:"Abandoned match",matchUpStatusCode:"OA"}],[Kp]:[{matchUpStatusCodeDisplay:"Unplayed or Cancelled",label:"Cancelled match",matchUpStatusCode:"OC"}],[$l]:[{matchUpStatusCodeDisplay:"Incomplete",label:"Incomplete match",matchUpStatusCode:"OI"}],[Ki]:[{description:"Disqualification for cause or ineligibility",label:"Disqualification (ineligibility)",matchUpStatusCodeDisplay:"Def [dq]",matchUpStatusCode:"DQ"},{description:"Misconduct before or between matches",label:"Misconduct",matchUpStatusCodeDisplay:"Def [cond]",matchUpStatusCode:"DM"},{description:"Failure to start match because of adult discipline",label:"Fail. (adult discipline)",matchUpStatusCodeDisplay:"Def [ad]",matchUpStatusCode:"D5"},{description:"Refusal to start match for reason other than adult discipline, injury, illness, or personal circumstance. (After the Referee has conclusively confirmed that a player refuses to play a match, the Referee need not wait until the scheduled time of the match to records the result.)",label:"Refusal to start match",matchUpStatusCodeDisplay:"Def [refsl]",matchUpStatusCode:"D4"},{label:"Not showing up",matchUpStatusCodeDisplay:"Def [ns]",matchUpStatusCode:"D6"},{description:"Lateness for match including, but not limited to, intending to play but mistakenly arriving at the wrong time, location, or without proper equipment",label:"Lateness for match",matchUpStatusCodeDisplay:"Score + Def [late]",matchUpStatusCode:"D7"},{label:"Double default",matchUpStatusCodeDisplay:"Def/Def",matchUpStatusCode:"DD"},{description:"Refusal to continue playing a match for reason other than injury, illness, personal circumstance, or adult discipline",label:"Refusal to continue match",matchUpStatusCodeDisplay:"Def [refsl]",matchUpStatusCode:"D9"},{description:"Default for receiving an injection, IV, or supplemental oxygen",label:"Default (PEDs)",matchUpStatusCodeDisplay:"Def [med]",matchUpStatusCode:"DI"},{description:"Default under Point Penalty System",label:"Default (Point Penalty System)",matchUpStatusCodeDisplay:"Def [pps]",matchUpStatusCode:"DP"}],[un]:[{matchUpStatusCodeDisplay:"Wo [inj]",matchUpStatusCode:"W1",label:"Injury"},{matchUpStatusCodeDisplay:"Wo [ill]",matchUpStatusCode:"W2",label:"Illness"},{matchUpStatusCodeDisplay:"Wo [pc]",label:aB,matchUpStatusCode:"W3"},{matchUpStatusCodeDisplay:"Wo/Wo",matchUpStatusCode:"WOWO",label:"Double walkover"},{matchUpStatusCodeDisplay:"Wo [Tae]",label:"Tournament Administrative Error",matchUpStatusCode:"W4"},{matchUpStatusCodeDisplay:"Wo/Withdrawn",matchUpStatusCode:"W5",label:"Withdrawn"}],[ss]:[{matchUpStatusCodeDisplay:"Ret [inj]",matchUpStatusCode:"RJ",label:"Injury"},{matchUpStatusCodeDisplay:"Ret [ill]",matchUpStatusCode:"RI",label:"Illness"},{matchUpStatusCodeDisplay:"Ret [pc]",label:aB,matchUpStatusCode:"RC"},{description:"Retirement because of adult discipline",label:"Ret. (adult discipline)",matchUpStatusCodeDisplay:"Ret [ad]",matchUpStatusCode:"RD"},{description:"A player who retires from a match remains eligible for consolations, place playoffs, doubles and subsequent round robin matches",matchUpStatusCodeDisplay:"Ret [elg]",label:"Ret. (eligible)",matchUpStatusCode:"RU"}],[Wh]:[{matchUpStatusCodeDisplay:"Wd [inj]",matchUpStatusCode:"WD.INJ",label:"Injury"},{matchUpStatusCodeDisplay:"Wd [ill]",matchUpStatusCode:"WD.ILL",label:"Illness"},{matchUpStatusCodeDisplay:"Wd [pc]",label:aB,matchUpStatusCode:"WD.PC"},{matchUpStatusCodeDisplay:"Wd/Wd",matchUpStatusCode:"WD.WD",label:"Double withdrawal"},{label:"Tournament Administrative Error",matchUpStatusCodeDisplay:"Wd [Tae]",matchUpStatusCode:"WD.TAE"}]}}},FYe={[Tu]:{seedingProfile:{positioning:VL},validSeedPositions:{ignore:!0},duplicateSeedNumbers:!0,drawSizeProgression:!0,policyName:"ITF SEEDING",seedsCountThresholds:[{drawSize:4,minimumParticipantCount:3,seedsCount:2},{drawSize:16,minimumParticipantCount:12,seedsCount:4},{drawSize:32,minimumParticipantCount:24,seedsCount:8},{drawSize:64,minimumParticipantCount:48,seedsCount:16},{drawSize:128,minimumParticipantCount:97,seedsCount:32},{drawSize:256,minimumParticipantCount:192,seedsCount:64}]}},$Ye={POLICY_AVOIDANCE_COUNTRY:NYe,POLICY_POSITION_ACTIONS_DEFAULT:JIe,POLICY_POSITION_ACTIONS_DISABLED:kYe,POLICY_POSITION_ACTIONS_NO_MOVEMENT:_Ye,POLICY_POSITION_ACTIONS_UNRESTRICTED:AYe,POLICY_PRIVACY_DEFAULT:xYe,POLICY_ROUND_NAMING_DEFAULT:c8,POLICY_SCHEDULING_DEFAULT:x0e,POLICY_SCORING_DEFAULT:OYe,POLICY_SCORING_USTA:LYe,POLICY_SEEDING_ITF:FYe,POLICY_SEEDING_DEFAULT:v0e},BYe={ratingsParameters:Ea,matchUpFormats:qze,countryToFlag:Kye,tieFormats:Z0e,countries:ag,policies:$Ye,flagIOC:zqe},VYe={};Fi(VYe,{activeMatchUpStatuses:()=>$6,auditConstants:()=>j8e,completedMatchUpStatuses:()=>va,directingMatchUpStatuses:()=>xye,displayConstants:()=>y8e,drawDefinitionConstants:()=>dye,entryStatusConstants:()=>e3e,errorConditionConstants:()=>qHe,eventConstants:()=>Jze,extensionConstants:()=>Dye,flightConstants:()=>s7e,genderConstants:()=>d6,keyValueConstants:()=>H5e,matchUpActionConstants:()=>i5e,matchUpStatusConstants:()=>Fye,matchUpTypes:()=>gHe,nonDirectingMatchUpStatuses:()=>Oye,particicipantsRequiredMatchUpStatuses:()=>_ye,participantConstants:()=>Hqe,participantRoles:()=>S8,participantTypes:()=>wD,penaltyConstants:()=>aKe,policyConstants:()=>Pqe,positionActionConstants:()=>m4e,ratingConstants:()=>M4e,recoveryTimeRequiredMatchUpStatuses:()=>$qe,requestConstants:()=>Y7e,resourceContants:()=>$ze,resultConstants:()=>MHe,scaleConstants:()=>Tqe,scheduleConstants:()=>E3e,sortingConstants:()=>f7e,surfaceConstants:()=>dKe,tieFormatConstants:()=>Wze,timeItemConstants:()=>T3e,topicConstants:()=>Vqe,tournamentConstants:()=>IUe,upcomingMatchUpStatuses:()=>Lye,validMatchUpStatuses:()=>kye,venueConstants:()=>fKe,weekdayConstants:()=>iSe});var jYe="Coaching",GYe="Ball Abuse",HYe="Racket Abuse",zYe="Verbal Abuse",qYe="INELIGIBILITY",WYe="Physical Abuse",YYe="Unsportmanlike Conduct",KYe="Dress Code Violation",ZYe="Equipment Violation",XYe="Leaving the court",JYe="Failure to complete",QYe="No Show",eKe="Other",tKe="REFUSAL_TO_PLAY",iKe="PROHIBITED_SUBSTANCE",nKe="Puncuality",rKe="Failure to sign in",aKe={COACHING:jYe,BALL_ABUSE:GYe,RACKET_ABUSE:HYe,VERBAL_ABUSE:zYe,PHYSICAL_ABUSE:WYe,INELIGIBILITY:qYe,UNSPORTSMANLIKE_CONDUCT:YYe,PROHIBITED_SUBSTANCE:iKe,DRESS_CODE_VIOLATION:KYe,EQUIMENT_VIOLATION:ZYe,LEAVING_THE_COURT:XYe,REFUSAL_TO_PLAY:tKe,FAILURE_TO_COMPLETE:JYe,NO_SHOW:QYe,OTHER:eKe,PUNCTUALITY:nKe,FAILUIRE_TO_SIGN_IN:rKe},sKe="CLAY",oKe="HARD",lKe="GRASS",cKe="CARPET",uKe="ARTIFICIAL",dKe={CLAY:sKe,HARD:oKe,GRASS:lKe,CARPET:cKe,ARTIFICIAL:uKe},pKe="INDOOR",hKe="OUTDOOR",fKe={INDOOR:pKe,OUTDOOR:hKe};const mKe=Tn({WebkitBoxSizing:"border-box",marginInlineEnd:".3em",display:"inline-block",boxSizing:"border-box",position:"relative",borderRadius:2,variants:{variant:{doubles:{width:".75rem"},singles:{width:"1rem"}}}});function gKe({matchUp:t,individualParticipant:e,spacer:i}){var n,r,a;const s=((n=e==null?void 0:e.person)==null?void 0:n.iso2NationalityCode)||"",o=s?(r=BYe.countryToFlag(s))==null?void 0:r.slice(0,4):"",l=document.createElement("span"),c=(a=t==null?void 0:t.matchUpType)==null?void 0:a.toLowerCase();return i||(l.className=mKe({variant:c})),l.innerHTML=i?"":o,l}function sB({individualParticipant:t,composition:e,className:i,matchUp:n,spacer:r,side:a,type:s}){if(s==="scale")return fHe({individualParticipant:t,composition:e,className:i,matchUp:n,spacer:r});const o=(e==null?void 0:e.configuration)||{},l=document.createElement("div");return s==="flag"&&o.flags&&gKe({className:i,matchUp:n,individualParticipant:t,spacer:r})||s==="seeding"&&pHe({className:i,composition:e,matchUp:n,side:a})||l}const vKe="Qualifier",yKe="BYE",bKe="TBD";function YJ(t){var e,i,n,r;const{isWinningSide:a,side:s,sideNumber:o,individualParticipant:l,matchUp:c,composition:u}=t||{},d=a?"winner":void 0,p=t.eventHandlers||{},h=u==null?void 0:u.configuration,f={QUALIFIER:((e=h==null?void 0:h.placeHolders)==null?void 0:e.qualifier)||vKe,BYE:((i=h==null?void 0:h.placeHolders)==null?void 0:i.bye)||yKe,TBD:((n=h==null?void 0:h.placeHolders)==null?void 0:n.tbd)||bKe},m=l==null?void 0:l.participantName,g=S=>{Id(p==null?void 0:p.participantClick)&&(S.stopPropagation(),p.participantClick({individualParticipant:l,pointerEvent:S,matchUp:c,side:s}))},v=document.createElement("div");v.classList.add("tmx-i"),v.setAttribute("sideNumber",o),v.setAttribute("id",l==null?void 0:l.participantId),v.onclick=g;const y=document.createElement("div");y.className=qGe({variant:d});const b=(h==null?void 0:h.flags)&&sB({...t,type:"flag"});if(b)y.appendChild(b);else{const S=sB({type:"scale",...t});S&&y.appendChild(S)}const I=document.createElement("div");if(I.className=WGe({variant:d}),m){const S=document.createElement("span");if(a&&h!=null&&h.winnerColor)S.style.color=typeof h.winnerColor=="string"?h.winnerColor:"green";else if(h!=null&&h.genderColor){const U=(r=l==null?void 0:l.person)==null?void 0:r.sex,P=U==="MALE"&&"#2E86C1"||U==="FEMALE"&&"#AA336A"||"";S.style.color=typeof h.genderColor=="string"?h.genderColor:P}S.innerHTML=m,I.appendChild(S)}else{const S=document.createElement("abbr");S.className=zGe({variant:h.showAddress?"showAddress":""}),S.innerHTML=(s==null?void 0:s.bye)&&f.BYE||(s==null?void 0:s.qualifier)&&f.QUALIFIER||f.TBD,I.appendChild(S)}const T=sB({...t,className:dHe(),type:"seeding"});T&&I.appendChild(T),y.appendChild(I),v.appendChild(y);const w=uHe(t);return v.appendChild(w),{element:v}}const IKe=Tn({width:"auto",display:"inline-block",textTransform:"uppercase",fontFamily:"Sharp Sans, Arial, sans-serif",fontSize:"0.625rem",lineHeight:"1rem",marginInline:"0.25rem 0.25rem",paddingInline:"0.25rem 0.25rem",fontWeight:700,borderRadius:"4px",color:"#fff",textAlign:"center",whiteSpace:"nowrap",variants:{variant:{defaulted:{backgroundColor:"#df164c"},retired:{backgroundColor:"#df164c"},walkover:{backgroundColor:"black"},double_walkover:{backgroundColor:"black"}}}});function wKe({matchUpStatus:t}){const e=t==null?void 0:t.toLowerCase(),i=["WALKOVER","DOUBLE_WALKOVER"].includes(t)?"WO":(t==null?void 0:t.slice(0,3))||"",n=document.createElement("div");n.className=IKe({variant:e});const r=document.createElement("abbr");return r.setAttribute("title",t),r.style.textDecoration="none",r.style.borderBottom="none",r.innerHTML=i,n.appendChild(r),n}function SKe(t){return t instanceof Element||t}const TKe=Tn({marginInlineEnd:".5rem",backgroundColor:"pink",marginInlineStart:2,height:40,width:40});function UKe({teamLogo:t}){console.log({teamLogo:t});const e=document.createElement("div");return e.className=TKe(),e}const DKe=Tn({flexDirection:"column",position:"relative",display:"flex"}),EKe=Tn({alignItems:"stretch",display:"flex"}),PKe=Tn({marginInlineEnd:".25rem",color:"green"});function CKe({dim:t="20px"}={}){const e=PKe();return`
    <div style="line-height: 0;">
      <svg height="${t}" viewBox="0 0 18 24" width="${t}" xmlns="http://www.w3.org/2000/svg" class="${e}" style="fill: currentcolor;">
        <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"></path>
      </svg>
    </div>
  `}function tY({initialRoundNumber:t=1,eventHandlers:e,sideContainer:i,composition:n,participant:r,placeholder:a,sideNumber:s,matchUp:o}){var l,c,u;const{winningSide:d,matchUpType:p,isRoundRobin:h,matchUpStatus:f}=o||{},m=n==null?void 0:n.configuration;let g;const v=s?(l=o==null?void 0:o.sides)==null?void 0:l.find(_=>_.sideNumber===s):void 0;r||(r=v==null?void 0:v.participant,g=m!=null&&m.allDrawPositions||m!=null&&m.drawPositions&&v!=null&&v.drawPosition&&((o==null?void 0:o.roundNumber)===t||v!=null&&v.participantFed||h)?v==null?void 0:v.drawPosition:"");const y=p==="DOUBLES",b=y?(c=r==null?void 0:r.individualParticipants)==null?void 0:c[0]:r,I=y&&((u=r==null?void 0:r.individualParticipants)==null?void 0:u[1]),T=s===d||f==="BYE"&&r,w=(m==null?void 0:m.winnerChevron)&&T,S=m==null?void 0:m.teamLogo,U=["RETIRED","DOUBLE_WALKOVER","WALKOVER","DEFAULTED"].includes(f)&&!T,P=m==null?void 0:m.gameScoreOnly,E=document.createElement("div");if(E.className=i&&KGe({drawPosition:g,sideNumber:s}),E.classList.add("tmx-p"),E.setAttribute("id",r==null?void 0:r.participantId),S){const _=UKe({teamLogo:S});E.appendChild(_)}const R=document.createElement("div");R.className=YGe({variant:y?"doubles":"singles"});const C=document.createElement("div");C.className=ZGe({winnerChevron:w,isDoubles:y});const M=YJ({individualParticipant:b,eventHandlers:e,isWinningSide:T,composition:n,sideNumber:s,matchUp:o,side:v}).element;if(C.appendChild(M),I){const _=YJ({individualParticipant:I,eventHandlers:e,isWinningSide:T,composition:n,sideNumber:s,matchUp:o,side:v}).element;C.appendChild(_)}else y&&a&&SKe(a)&&C.appendChild(a);if(R.appendChild(C),E.appendChild(R),i){const _=document.createElement("div");if(T&&!P){const A=CKe();typeof A=="string"?_.innerHTML=A:_.appendChild(A)}else if(U){const A=wKe({matchUpStatus:f});_.appendChild(A)}E.appendChild(_)}return E}const RKe=Tn({borderBottom:"solid 1px black",marginInlineStart:"16px",marginInlineEnd:"16px",fontWeight:"bold",height:"1.5em"});function MKe({eventHandlers:t,roundMatchUps:e,roundProfile:i,roundNumber:n,context:r}){var a;const s=document.createElement("div");s.className=RKe(),s.classList.add("tmx-rh"),s.setAttribute("roundNumber",n);const o=Id(t==null?void 0:t.roundHeaderClick);o&&(s.onclick=d=>t.roundHeaderClick({roundNumber:n,roundProfile:i,roundMatchUps:e,context:r,pointerEvent:d}));const l=o?"⋮":"",c=(a=i==null?void 0:i[n])==null?void 0:a.roundName,u=c&&` <div style="display: flex; flex-direction: row; justify-content: space-between">
        <div>${c}</div>
        <div style="font-weight: bold">${l}</div>
      </div>
  `;return s.innerHTML=u||"",s}const HUe=Tn({flexDirection:"column",display:"flex"}),NKe=Tn({flexDirection:"row",display:"flex"}),zUe=Tn({justifyContent:"space-around",marginInlineStart:"16px",marginInlineEnd:"16px",flexDirection:"column",height:"100%",display:"flex",variants:{variant:{adHoc:{justifyContent:"flex-start"}}}}),AKe=Tn({borderTop:"solid 1px black",marginRight:"-1em",marginLeft:"-1em",paddingTop:".5em",marginTop:".2em",variants:{variant:{0:{marginTop:"1em",borderTop:"none",paddingTop:"0px"}},roundOrder:{first:{marginLeft:"0em"},last:{marginRight:"0em"}}}}),_Ke=Tn({fontWeight:"bold",color:"blue",height:"1em"}),KJ=Tn({width:"$score$setWidth",display:"inline-block",fontSize:9,variants:{variant:{set:{textAlign:"center"},points:{marginInlineEnd:3}}}}),kKe=Tn({transform:"translateY(-50%)",textTransform:"uppercase",backgroundColor:"#fff",position:"absolute",textAlign:"center",top:"calc(50%)",color:"#bbb",fontSize:0,right:4});function xKe(){return Tn({backgroundColor:"magenta",position:"absolute",opacity:"0.2",height:"100%",width:"100%",top:0})}const OKe=Tn({});function LKe({configuration:t}){const e={backgroundColor:"$matchUpBackgroundColor",WebkitTransition:"all 0.30s linear",boxShadow:"$matchUp$boxShadow",transition:"all 0.30s linear",border:"solid $border",marginBottom:"$space$1",marginTop:"$space$1",position:"relative",display:"grid",width:"100%",borderInlineStartWidth:"$borderWidths$borderInlineStart"};if(t!=null&&t.matchUpHover){const i=typeof t.matchUpHover=="string"?t.matchUpHover:"cyan";e["&:hover"]={backgroundColor:i}}else e["&:hover"]={borderColor:"$borderHover"};return Tn(e)}function FKe({variant:t}){return Tn({borderBottom:"solid 1px lightgray",backgroundColor:"$matchUp",position:"relative",width:"100%",height:"$lineHeights$centerInfo",variants:{variant:{1:{borderBottom:"solid 1px black"},2:{borderBottom:"solid 1px lightgray"}}}})({variant:t})}const $Ke=Tn({justifyContent:"center",alignContent:"center",flexDirection:"column",height:"100%",display:"flex"}),BKe=Tn({fontFamily:"Lato,Arial,Helvetica,sans-serif",WebkitFontSmooting:"antialiased",marginInlineStart:"calc(20%)",WebkitBoxOrient:"horizontal",WebKitBoxDirection:"normal",WebkitBoxPack:"center",boxSizing:"inherit",flexDirection:"row",display:"flex"}),ZJ=Tn({alignContent:"center",boxSizing:"inherit",fontFamily:"Lato",fontWeight:900,fontSize:9});function VKe({eventHandlers:t,entryStatus:e,sideNumber:i,className:n,matchUp:r}){const a=document.createElement("div");Id(t==null?void 0:t.centerInfoClick)&&(a.onclick=u=>t.centerInfoClick({matchUp:r,sideNumber:i,pointerEvent:u})),a.className=qy(FKe({variant:i}),n),a.classList.add("tmx-ci"),a.setAttribute("sideNumber",i);const s=document.createElement("div");s.className=$Ke();const o=document.createElement("div");o.className=BKe();const l=document.createElement("div");l.className=ZJ(),l.innerHTML=e?"Entry status:&nbsp;":"",o.appendChild(l);const c=document.createElement("div");return c.className=ZJ(),c.innerHTML=e||"",o.appendChild(c),s.appendChild(o),a.appendChild(s),{element:a}}const PD={scheduleInfo:1.8,centerInfo:1.5,gameScore:2};function jKe({composition:t,isDoubles:e,roundFactor:i=1}){const n=parseInt(window.getComputedStyle(document.body).getPropertyValue("font-size")),r=(t==null?void 0:t.configuration)||{},a=(r==null?void 0:r.connectorWidth)||16,s=r.centerInfo?PD.centerInfo*n:0,o=r.scheduleInfo?PD.scheduleInfo*n:0,l=(60+(r.showAddress?n:0))*(e?1.3:1)+s,c=l*i,u=(l+o)*i;return Tn({"&::before":{borderBlockStart:"$borderWidths$matchUp solid #999",left:-a,width:a,position:"absolute",borderRadius:2,top:-1},"&::after":{width:a,position:"absolute",borderRadius:2,left:"100%"},"&::after, &::before":{borderWidth:"$borderWidths$matchUp",borderColor:"$connector",display:"block",content:""},variants:{isFirstRound:{true:{"&::before":{height:0,width:0,borderWidth:0}}},link:{m1:{"&::after":{borderInlineEnd:"$borderWidths$matchUp solid $connector",borderTopStyle:"solid",height:c,top:-1}},m2:{"&::after":{bottom:"calc(100%)",borderInlineEnd:"$borderWidths$matchUp solid $connector",borderBottomStyle:"solid",height:u}},m0:{"&::after":{borderTopStyle:"solid",borderColor:"$connector",top:-1}},mr:{"&::before":{height:0,width:0,borderWidth:0},"&::after":{height:0,width:0,borderWidth:0}},noProgression:{true:{"&::after":{height:0,width:0,borderWidth:0}}}}}})}const qUe=t=>Tn({display:"flex",alignItems:"center",height:t,justifyContent:"flex-end",backgroundColor:"$matchUp",variants:{sideNumber:{1:{borderBottom:"1px solid $internalDividers"}},fontSize:{small:{fontSize:"smaller",paddingRight:"1em",color:"blue"}}}}),GKe=Tn({lineHeight:"0.75rem",fontSize:"0.625rem",left:"1.1rem",top:".4rem"}),WUe=Tn({lineHeight:"$lineHeights$gameScore",justifyContent:"center",width:"$score$setWidth",position:"relative",textAlign:"center",cursor:"pointer",fontWeight:500,fontSize:"$1",display:"flex",margin:0,variants:{variant:{winner:{color:"$winner!important",fontWeight:700},loser:{color:"$loser!important"}}}}),HKe=Tn({marginInlineEnd:"$space$gameMarginInlineEnd",justifyContent:"flex-end",alignItems:"center",display:"flex"});function zKe({value:t}={}){const e=document.createElement("input");return e.onclick=i=>i.target.select(),e.className=WUe(),e.value=t,e}function qKe({gameScoreOnly:t,scoreStripes:e,set:i,sideNumber:n}){const r=n===(i==null?void 0:i.winningSide)||i!=null&&i.winningSide?"loser":void 0,a=n===2?i.side2Score:i.side1Score,s=i.side2TiebreakScore||i.side1TiebreakScore,o=n===2?i.side2TiebreakScore:i.side1TiebreakScore,l=a===void 0&&o,c=l||a,u=e&&i.setNumber%2?"lightgray":"transparent",d=i.editing?i.editing===n:void 0;let p;if(d)p=zKe({value:c});else if(p=document.createElement("p"),p.className=WUe({variant:r}),p.classList.add("tmx-st"),p.setAttribute("setNumber",i.setNumber),p.style.backgroundColor=u,p.innerHTML=isNaN(c)?"":c,!t){const h=document.createElement("span");h.className=GKe(),h.innerHTML=s&&!l?o:"",p.appendChild(h)}return p}function WKe({participantHeight:t,eventHandlers:e,composition:i,sideNumber:n,matchUp:r}){var a,s,o,l;const c=(a=i==null?void 0:i.configuration)==null?void 0:a.winnerChevron,u=(s=i==null?void 0:i.configuration)==null?void 0:s.gameScoreOnly,d=((o=r==null?void 0:r.score)==null?void 0:o.sets)||[],p=(l=i==null?void 0:i.configuration)==null?void 0:l.scoreBox,h=n===2?t:t-1,f=qUe(h),m=y=>{Id(e==null?void 0:e.scoreClick)&&(y.stopPropagation(),e.scoreClick({pointerEvent:y,matchUp:r}))},g=document.createElement("div");g.className=f({sideNumber:!p&&n,fontSize:"5px"}),g.classList.add("sideScore"),g.classList.add("tmx-scr"),g.onclick=m;const v=document.createElement("div");v.className=HKe();for(const y of d||[]){const b=qKe({gameScoreOnly:u,scoreStripes:c,sideNumber:n,set:y});v.appendChild(b)}return g.appendChild(v),g}const YKe=Tn({height:"$lineHeights$scheduleInfo",borderBottom:"1px solid darkgray",justifyContent:"space-between",backgroundColor:"#F8F9F9",boxSizing:"border-box",paddingRight:"0.2rem",paddingLeft:"0.5rem",alignItems:"center",cursor:"pointer",color:"#7F8080",display:"flex",width:"100%"});var YUe={exports:{}};(function(t,e){(function(i,n){t.exports=n()})(XGe,function(){var i=1e3,n=6e4,r=36e5,a="millisecond",s="second",o="minute",l="hour",c="day",u="week",d="month",p="quarter",h="year",f="date",m="Invalid Date",g=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,v=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,y={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(_){var A=["th","st","nd","rd"],N=_%100;return"["+_+(A[(N-20)%10]||A[N]||A[0])+"]"}},b=function(_,A,N){var k=String(_);return!k||k.length>=A?_:""+Array(A+1-k.length).join(N)+_},I={s:b,z:function(_){var A=-_.utcOffset(),N=Math.abs(A),k=Math.floor(N/60),O=N%60;return(A<=0?"+":"-")+b(k,2,"0")+":"+b(O,2,"0")},m:function _(A,N){if(A.date()<N.date())return-_(N,A);var k=12*(N.year()-A.year())+(N.month()-A.month()),O=A.clone().add(k,d),$=N-O<0,F=A.clone().add(k+($?-1:1),d);return+(-(k+(N-O)/($?O-F:F-O))||0)},a:function(_){return _<0?Math.ceil(_)||0:Math.floor(_)},p:function(_){return{M:d,y:h,w:u,d:c,D:f,h:l,m:o,s,ms:a,Q:p}[_]||String(_||"").toLowerCase().replace(/s$/,"")},u:function(_){return _===void 0}},T="en",w={};w[T]=y;var S="$isDayjsObject",U=function(_){return _ instanceof C||!(!_||!_[S])},P=function _(A,N,k){var O;if(!A)return T;if(typeof A=="string"){var $=A.toLowerCase();w[$]&&(O=$),N&&(w[$]=N,O=$);var F=A.split("-");if(!O&&F.length>1)return _(F[0])}else{var V=A.name;w[V]=A,O=V}return!k&&O&&(T=O),O||!k&&T},E=function(_,A){if(U(_))return _.clone();var N=typeof A=="object"?A:{};return N.date=_,N.args=arguments,new C(N)},R=I;R.l=P,R.i=U,R.w=function(_,A){return E(_,{locale:A.$L,utc:A.$u,x:A.$x,$offset:A.$offset})};var C=function(){function _(N){this.$L=P(N.locale,null,!0),this.parse(N),this.$x=this.$x||N.x||{},this[S]=!0}var A=_.prototype;return A.parse=function(N){this.$d=function(k){var O=k.date,$=k.utc;if(O===null)return new Date(NaN);if(R.u(O))return new Date;if(O instanceof Date)return new Date(O);if(typeof O=="string"&&!/Z$/i.test(O)){var F=O.match(g);if(F){var V=F[2]-1||0,j=(F[7]||"0").substring(0,3);return $?new Date(Date.UTC(F[1],V,F[3]||1,F[4]||0,F[5]||0,F[6]||0,j)):new Date(F[1],V,F[3]||1,F[4]||0,F[5]||0,F[6]||0,j)}}return new Date(O)}(N),this.init()},A.init=function(){var N=this.$d;this.$y=N.getFullYear(),this.$M=N.getMonth(),this.$D=N.getDate(),this.$W=N.getDay(),this.$H=N.getHours(),this.$m=N.getMinutes(),this.$s=N.getSeconds(),this.$ms=N.getMilliseconds()},A.$utils=function(){return R},A.isValid=function(){return this.$d.toString()!==m},A.isSame=function(N,k){var O=E(N);return this.startOf(k)<=O&&O<=this.endOf(k)},A.isAfter=function(N,k){return E(N)<this.startOf(k)},A.isBefore=function(N,k){return this.endOf(k)<E(N)},A.$g=function(N,k,O){return R.u(N)?this[k]:this.set(O,N)},A.unix=function(){return Math.floor(this.valueOf()/1e3)},A.valueOf=function(){return this.$d.getTime()},A.startOf=function(N,k){var O=this,$=!!R.u(k)||k,F=R.p(N),V=function(J,se){var ie=R.w(O.$u?Date.UTC(O.$y,se,J):new Date(O.$y,se,J),O);return $?ie:ie.endOf(c)},j=function(J,se){return R.w(O.toDate()[J].apply(O.toDate("s"),($?[0,0,0,0]:[23,59,59,999]).slice(se)),O)},B=this.$W,z=this.$M,W=this.$D,Z="set"+(this.$u?"UTC":"");switch(F){case h:return $?V(1,0):V(31,11);case d:return $?V(1,z):V(0,z+1);case u:var K=this.$locale().weekStart||0,Q=(B<K?B+7:B)-K;return V($?W-Q:W+(6-Q),z);case c:case f:return j(Z+"Hours",0);case l:return j(Z+"Minutes",1);case o:return j(Z+"Seconds",2);case s:return j(Z+"Milliseconds",3);default:return this.clone()}},A.endOf=function(N){return this.startOf(N,!1)},A.$set=function(N,k){var O,$=R.p(N),F="set"+(this.$u?"UTC":""),V=(O={},O[c]=F+"Date",O[f]=F+"Date",O[d]=F+"Month",O[h]=F+"FullYear",O[l]=F+"Hours",O[o]=F+"Minutes",O[s]=F+"Seconds",O[a]=F+"Milliseconds",O)[$],j=$===c?this.$D+(k-this.$W):k;if($===d||$===h){var B=this.clone().set(f,1);B.$d[V](j),B.init(),this.$d=B.set(f,Math.min(this.$D,B.daysInMonth())).$d}else V&&this.$d[V](j);return this.init(),this},A.set=function(N,k){return this.clone().$set(N,k)},A.get=function(N){return this[R.p(N)]()},A.add=function(N,k){var O,$=this;N=Number(N);var F=R.p(k),V=function(z){var W=E($);return R.w(W.date(W.date()+Math.round(z*N)),$)};if(F===d)return this.set(d,this.$M+N);if(F===h)return this.set(h,this.$y+N);if(F===c)return V(1);if(F===u)return V(7);var j=(O={},O[o]=n,O[l]=r,O[s]=i,O)[F]||1,B=this.$d.getTime()+N*j;return R.w(B,this)},A.subtract=function(N,k){return this.add(-1*N,k)},A.format=function(N){var k=this,O=this.$locale();if(!this.isValid())return O.invalidDate||m;var $=N||"YYYY-MM-DDTHH:mm:ssZ",F=R.z(this),V=this.$H,j=this.$m,B=this.$M,z=O.weekdays,W=O.months,Z=O.meridiem,K=function(se,ie,ce,oe){return se&&(se[ie]||se(k,$))||ce[ie].slice(0,oe)},Q=function(se){return R.s(V%12||12,se,"0")},J=Z||function(se,ie,ce){var oe=se<12?"AM":"PM";return ce?oe.toLowerCase():oe};return $.replace(v,function(se,ie){return ie||function(ce){switch(ce){case"YY":return String(k.$y).slice(-2);case"YYYY":return R.s(k.$y,4,"0");case"M":return B+1;case"MM":return R.s(B+1,2,"0");case"MMM":return K(O.monthsShort,B,W,3);case"MMMM":return K(W,B);case"D":return k.$D;case"DD":return R.s(k.$D,2,"0");case"d":return String(k.$W);case"dd":return K(O.weekdaysMin,k.$W,z,2);case"ddd":return K(O.weekdaysShort,k.$W,z,3);case"dddd":return z[k.$W];case"H":return String(V);case"HH":return R.s(V,2,"0");case"h":return Q(1);case"hh":return Q(2);case"a":return J(V,j,!0);case"A":return J(V,j,!1);case"m":return String(j);case"mm":return R.s(j,2,"0");case"s":return String(k.$s);case"ss":return R.s(k.$s,2,"0");case"SSS":return R.s(k.$ms,3,"0");case"Z":return F}return null}(se)||F.replace(":","")})},A.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},A.diff=function(N,k,O){var $,F=this,V=R.p(k),j=E(N),B=(j.utcOffset()-this.utcOffset())*n,z=this-j,W=function(){return R.m(F,j)};switch(V){case h:$=W()/12;break;case d:$=W();break;case p:$=W()/3;break;case u:$=(z-B)/6048e5;break;case c:$=(z-B)/864e5;break;case l:$=z/r;break;case o:$=z/n;break;case s:$=z/i;break;default:$=z}return O?$:R.a($)},A.daysInMonth=function(){return this.endOf(d).$D},A.$locale=function(){return w[this.$L]},A.locale=function(N,k){if(!N)return this.$L;var O=this.clone(),$=P(N,k,!0);return $&&(O.$L=$),O},A.clone=function(){return R.w(this.$d,this)},A.toDate=function(){return new Date(this.valueOf())},A.toJSON=function(){return this.isValid()?this.toISOString():null},A.toISOString=function(){return this.$d.toISOString()},A.toString=function(){return this.$d.toUTCString()},_}(),M=C.prototype;return E.prototype=M,[["$ms",a],["$s",s],["$m",o],["$H",l],["$W",c],["$M",d],["$y",h],["$D",f]].forEach(function(_){M[_[1]]=function(A){return this.$g(A,_[0],_[1])}}),E.extend=function(_,A){return _.$i||(_(A,C,E),_.$i=!0),E},E.locale=P,E.isDayjs=U,E.unix=function(_){return E(1e3*_)},E.en=w[T],E.Ls=w,E.p={},E})})(YUe);var KKe=YUe.exports;const ZKe=_me(KKe);function XKe({matchUp:t,eventHandlers:e}){const{scheduledTime:i,scheduledDate:n,venueAbbreviation:r,courtName:a}=(t==null?void 0:t.schedule)||{},{dateTime:{extractDate:s,extractTime:o}}=Z9,l=o(i);let c=s(n),u="ddd D MMMM";l&&(u+=", hh:mm A",c+=`T${l}`);const d=n?ZKe(c).format(u):"Not scheduled",p=r&&(a==null?void 0:a.toString().startsWith(r))&&a||r&&a&&`${r} ${a}`||a||r||"",h=document.createElement("div");h.className=YKe(),h.classList.add("tmx-sch"),Id(e==null?void 0:e.scheduleClick)&&(h.onclick=y=>e.scheduleClick({matchUp:t,pointerEvent:y}));const f=document.createElement("div");f.innerHTML=d,h.append(f);const m=y=>{Id(e==null?void 0:e.venueClick)&&(y.stopPropagation(),e.venueClick({pointerEvent:y,matchUp:t}))},g=document.createElement("div");g.style="display: flex; flex-direction: row";const v=document.createElement("div");if(v.style.paddingRight=".2rem",v.onclick=m,v.innerHTML=p,g.append(v),h.append(g),h.onclick){const y=document.createElement("div");y.innerHTML="⋮",g.append(y)}return h}function XJ({initialRoundNumber:t=1,eventHandlers:e,composition:i,sideNumber:n,className:r,matchUp:a}){var s,o;const l=(i==null?void 0:i.configuration)||{},c=l==null?void 0:l.scheduleInfo,u=(s=a==null?void 0:a.score)==null?void 0:s.scoreStringSide1,d=((o=i==null?void 0:i.configuration)==null?void 0:o.scoreBox)&&u,p=(a==null?void 0:a.readyToScore)&&(e==null?void 0:e.scoreClick)&&!GUe.checkScoreHasValue({matchUp:a}),h=document.createElement("div");if(h.className=qy(DKe(),r),h.classList.add("tmx-sd"),h.setAttribute("sideNumber",n),c&&n===1){const g=XKe({matchUp:a,eventHandlers:e});h.appendChild(g)}const f=document.createElement("div");f.className=EKe();const m=tY({sideContainer:!0,initialRoundNumber:t,eventHandlers:e,composition:i,sideNumber:n,matchUp:a});if(f.appendChild(m),d){const g=document.createElement("div");g.style.border="1px solid lightgray",f.appendChild(g)}if(u){const g=WKe({eventHandlers:e,composition:i,sideNumber:n,matchUp:a});f.appendChild(g)}if(p){const g=qUe(),v=b=>{Id(e==null?void 0:e.scoreClick)&&(event.stopPropagation(),e.scoreClick({pointerEvent:b,matchUp:a}))},y=document.createElement("div");y.className=g({sideNumber:!d&&n,fontSize:"small"}),y.onclick=v,y.innerHTML="[Score]",f.appendChild(y)}return h.appendChild(f),h}function KUe(t){const{composition:e,initialRoundNumber:i=1,matchUp:n,moiety:r,selectedMatchUpId:a,searchActive:s}=t,{roundFactor:o,roundNumber:l,finishingRound:c,matchUpType:u,preFeedRound:d,stage:p}=n,h=t.isFinalRound||parseInt(c)===1,f=p==="QUALIFYING"&&h,m=h,g=parseInt(l)===i,v=u==="DOUBLES",y=(s||n.isRoundRobin||n.collectionId||t.isLucky||t.isAdHoc)&&"mr"||m&&"noProgression"||(f||d)&&"m0"||r&&"m1"||"m2",b=jKe({composition:e,isDoubles:v,roundFactor:o})({isFirstRound:g,link:y}),I=(e==null?void 0:e.configuration)||{},{resultsInfo:T,centerInfo:w}=I||{},S=t.eventHandlers||{},U=_=>{Id(S==null?void 0:S.matchUpClick)&&S.matchUpClick({pointerEvent:_,matchUp:n})},P=document.createElement("div");P.className=qy(e.theme,t==null?void 0:t.className,"matchup",OKe()),P.classList.add("tmx-m"),P.setAttribute("id",n==null?void 0:n.matchUpId),P.onclick=U;const E=document.createElement("div");E.className=LKe({configuration:I});const R=({sideNumber:_})=>{var A,N,k;const O=(k=(N=(A=n==null?void 0:n.sides.find($=>$.sideNumber===_))==null?void 0:A.participant)==null?void 0:N.entryStatus)==null?void 0:k.replace("_"," ");return VKe({eventHandlers:S,entryStatus:O,sideNumber:_,className:_===2&&b,matchUp:n})},C=XJ({initialRoundNumber:i,eventHandlers:S,sideNumber:1,composition:e,matchUp:n}),M=XJ({className:!w&&b,initialRoundNumber:i,eventHandlers:S,sideNumber:2,composition:e,matchUp:n});if(E.appendChild(C),w){const _=R({sideNumber:1}),A=R({sideNumber:2});E.appendChild(_.element),E.appendChild(A.element)}if(E.appendChild(M),T){const _=JKe({score:n.score});E.appendChild(_)}if(P.appendChild(E),a===n.matchUpId){const _=document.createElement("div");_.className=xKe(),P.appendChild(_)}return P}function JKe({score:t}){var e;const i=(e=t==null?void 0:t.sets)==null?void 0:e.filter(Boolean).sort((s,o)=>(s.setNumber||0)-(o.setNumber||0)),n=i==null?void 0:i[i.length-1],r=(n==null?void 0:n.side1PointsScore)||(n==null?void 0:n.side2PointsScore),a=document.createElement("div");if(a.className=kKe(),r){const s=document.createElement("div");s.className=KJ({variant:"points"}),s.innerHTML="PTS",a.appendChild(s)}for(const s of i||[]){const o=document.createElement("div");o.setAttribute("key",s.setNumber),o.className=KJ({variant:"set"}),o.innerHTML=s.setNumber,a.appendChild(o)}return a}function QKe({initialRoundNumber:t=1,selectedMatchUpId:e,eventHandlers:i,isFinalRound:n,isRoundRobin:r,searchActive:a,composition:s,roundFactor:o,roundNumber:l,roundProfile:c,minWidth:u,matchUps:d,context:p,isLucky:h}){const f=d.filter(E=>E.roundNumber===l).sort((E,R)=>(E.roundPosition||0)-(R.roundPosition||0)),m=f.every(({roundPosition:E,drawPositions:R})=>!E&&!R),g=(s==null?void 0:s.configuration)||{},v=document.createElement("div");if(v.className=HUe(),v.classList.add("tmx-rd"),v.setAttribute("roundNumber",l),g.roundHeader){const E=MKe({roundProfile:c,roundMatchUps:f,roundNumber:l,eventHandlers:i,context:p});v.appendChild(E)}const y=document.createElement("div");y.className=zUe({variant:m?"adHoc":void 0}),u&&(y.style.minWidth=u);let b,I,T;if(r){const E=C=>C.reduce((M,_)=>_+M,0);f.sort((C,M)=>{const _=E(C.drawPositions)-E(M.drawPositions),A=Math.min(...C.drawPositions??[])-Math.min(...M.drawPositions??[]);return _||A});const R=f.reduce((C,M)=>(C[M.structureId]=M.structureName,C),{});b=Object.values(R),I=Object.keys(R),T=Object.keys(Z9.instanceCount(f.map(({structureId:C})=>C))).length}else m&&f.sort((E,R)=>(E.roundOrder??0)-(R.roundOrder??0));const w=T&&f.length/T,S=Object.keys(c).map(E=>parseInt(E)),U=S.indexOf(l),P=U===0&&"first"||U===S.length-1&&"last";return f.forEach((E,R)=>{const C=w&&!(R%w),M=w&&Math.floor(R/w),_=w&&b[M];if(C){const k=document.createElement("div");k.className=AKe({variant:M,roundOrder:P}),y.appendChild(k);const O=document.createElement("div");if(O.className=_Ke(),Id(i==null?void 0:i.groupHeaderClick)){const{drawId:$,containerStructureId:F}=f[0];y.onclick=V=>i.groupHeaderClick({structureId:I[M],containerStructureId:F,pointerEvent:V,drawId:$})}l===t&&(O.innerHTML=_),y.appendChild(O)}const A=R%2===0;o?E.roundFactor=o:t>1&&(E.roundFactor=Math.pow(2,l-t));const N=KUe({initialRoundNumber:t,selectedMatchUpId:e,eventHandlers:i,isFinalRound:n,searchActive:a,composition:s,isAdHoc:m,isLucky:h,matchUp:E,moiety:A});y.appendChild(N)}),v.appendChild(y),v}function eZe({initialRoundNumber:t=1,selectedMatchUpId:e,eventHandlers:i,searchActive:n,composition:r,structureId:a,finalColumn:s,matchUps:o,minWidth:l,context:c}){var u;const{roundNumbers:d,roundProfile:p,hasOddMatchUpsCount:h,isNotEliminationStructure:f}=GUe.getRoundMatchUps({matchUps:o});a=a||(c==null?void 0:c.structureId)||((u=o==null?void 0:o[0])==null?void 0:u.structureId);const m=o.some(({isRoundRobin:b})=>b),g=h||f,v=document.createElement("div");v.className=NKe(),v.classList.add("tmx-str"),v.setAttribute("id",a);const y=Math.max(...d);for(const b of d){if(b<t)continue;const I=QKe({initialRoundNumber:t,selectedMatchUpId:e,eventHandlers:i,isFinalRound:b===y,isRoundRobin:m,searchActive:n,composition:r,roundNumber:b,roundProfile:p,matchUps:o,minWidth:l,context:c,isLucky:g});v.appendChild(I)}if(s){const b=document.createElement("div");b.className=HUe();const I=document.createElement("div");I.className=zUe(),I.appendChild(s),b.appendChild(I),v.appendChild(b)}return v}const JJ=Tn({backgroundColor:"$colors$backgroundColor",color:"$colors$color",overflowX:"auto",height:1e3});function tZe({content:t,theme:e}){const i=document.createElement("div");return i.className=e?qy(JJ(),e):JJ(),e&&i.classList.add(e),typeof t=="string"?i.innerHTML=t:i.appendChild(t),i}const{createTheme:Hw}=Ame({theme:{lineHeights:{scheduleInfo:`${PD.scheduleInfo}rem`,centerInfo:`${PD.centerInfo}rem`,gameScore:`${PD.gameScore}rem`},borderWidths:{matchUpInline:"1px 1px",matchUp:"1px"},space:{1:"10px",2:"0.375rem",gameMarginInlineEnd:"0.25rem"},fontSizes:{1:"0.875rem"},colors:{internalDividers:"lightgray",backgroundColor:"white",connector:"lightgray",border:"darkgray",color:"black"},participant:{textTransform:"capitalize",minHeight:"2rem",seed:"gray"},score:{setWidth:"1.3rem"}}}),QJ=Hw("australian-theme",{colors:{borderHover:"#0091d2",connector:"#999"}}),iZe=Hw("wimbledon-theme",{borderWidths:{borderInlineStart:"10px"},colors:{connector:"transparent",borderHover:"darkgrey",border:"#00703c",matchUp:"#fff"},participant:{textTransform:"uppercase"}}),nZe=Hw("french-theme",{colors:{winnerName:"#01503d!important",winner:"#01503d!important",borderHover:"#0091d2",border:"#F8F9F9"},matchUp:{boxShadow:"0 0 30px 0 hsla(0,0%,89%,9)"}}),rZe=Hw("usopen-theme",{colors:{matchUpBackgroundColor:"#F8F9F9",internalDividers:"darkgray",borderHover:"#0091d2",connector:"#999"}}),eQ=Hw("basic-theme",{colors:{internalDividers:"transparent",winner:"#50B649!important",loser:"#E61A1A!important",connector:"#999"},space:{gameMarginInlineEnd:"0.75rem"},participant:{seed:"transparent"},fontSizes:{1:"1.5rem"}}),aZe=Hw("dark-theme",{colors:{backgroundColor:"#333333",borderHover:"#0091d2",color:"white"},participant:{seed:"cyan"}}),sZe=Hw("itf-theme",{colors:{borderHover:"#0091d2",connector:"#999",matchUp:"#fff"},participant:{textTransform:"uppercase",seed:"gray"}}),fk={Australian:{configuration:{flags:!0},theme:QJ},Basic:{configuration:{gameScoreOnly:!0,teamLogo:!1,roundHeader:!0,placeHolders:{tbd:"-",bye:"Bye"}},theme:eQ},DrawPositions:{configuration:{gameScoreOnly:!0,drawPositions:!0,teamLogo:!1},theme:eQ},French:{configuration:{bracketedSeeds:!0,flags:!0},theme:nZe},Wimbledon:{configuration:{resultsInfo:!0,flags:!0},theme:iZe},"US Open":{configuration:{scoreBox:!0,flags:!0},theme:rZe},ITF:{configuration:{winnerChevron:!0,centerInfo:!0,flags:!0,roundHeader:!0},theme:sZe},National:{configuration:{bracketedSeeds:"square",allDrawPositions:!0,drawPositions:!0,scheduleInfo:!0,roundHeader:!0,showAddress:!0,scaleAttributes:{scaleColor:"red",scaleType:"RATING",scaleName:"WTN",accessor:"wtnRating"}},theme:QJ},Night:{configuration:{flags:!0},theme:aZe}};function AI(){A_.close()}function er(t){const{title:e,content:i,buttons:n,footer:r,onClose:a}=t,o={padding:!e&&!n?"":".5",maxWidth:500};return A_.open({title:e,content:i,footer:r,buttons:n,config:o,onClose:a})}async function oZe({callback:t}){var u;const e={providerId:""},n=(u=(await RE()).data)==null?void 0:u.providers,r=n.map(({value:d})=>({label:d.organisationName,value:d.organisationId})),a=n.map(({value:d})=>d.organisationName),s=()=>{var p;const d=(p=n.find(({value:h})=>h.organisationId===e.providerId))==null?void 0:p.value;d&&Ot(t)&&t(d)},o=d=>{const p=d.target.value,h=p===""||a.includes(p),f=document.getElementById("selectButton");f.disabled=!h,e.providerId=h?p:""},l=d=>{const p=document.getElementById("selectButton");e.providerId=d,p.disabled=!d};er({title:"Select provider",content:d=>{Sr(d,[{typeAhead:{list:r,callback:l},placeholder:"Type provider name",label:"Provider",field:"provider",width:"100%",onInput:o}])},buttons:[{label:"Cancel",intent:"none",close:!0},{onClick:s,intent:"is-primary",id:"selectButton",label:"Select",disabled:!0,close:!0}]})}var ZUe={exports:{}};(function(t,e){(function(i,n){t.exports=n()})(dp,function(){var i=function(G,q){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(X,ae){X.__proto__=ae}||function(X,ae){for(var ue in ae)Object.prototype.hasOwnProperty.call(ae,ue)&&(X[ue]=ae[ue])})(G,q)},n=function(){return(n=Object.assign||function(G){for(var q,X=1,ae=arguments.length;X<ae;X++)for(var ue in q=arguments[X])Object.prototype.hasOwnProperty.call(q,ue)&&(G[ue]=q[ue]);return G}).apply(this,arguments)};function r(G,q,X){for(var ae,ue=0,ve=q.length;ue<ve;ue++)!ae&&ue in q||((ae=ae||Array.prototype.slice.call(q,0,ue))[ue]=q[ue]);return G.concat(ae||Array.prototype.slice.call(q))}var a=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:dp,s=Object.keys,o=Array.isArray;function l(G,q){return typeof q!="object"||s(q).forEach(function(X){G[X]=q[X]}),G}typeof Promise>"u"||a.Promise||(a.Promise=Promise);var c=Object.getPrototypeOf,u={}.hasOwnProperty;function d(G,q){return u.call(G,q)}function p(G,q){typeof q=="function"&&(q=q(c(G))),(typeof Reflect>"u"?s:Reflect.ownKeys)(q).forEach(function(X){f(G,X,q[X])})}var h=Object.defineProperty;function f(G,q,X,ae){h(G,q,l(X&&d(X,"get")&&typeof X.get=="function"?{get:X.get,set:X.set,configurable:!0}:{value:X,configurable:!0,writable:!0},ae))}function m(G){return{from:function(q){return G.prototype=Object.create(q.prototype),f(G.prototype,"constructor",G),{extend:p.bind(null,G.prototype)}}}}var g=Object.getOwnPropertyDescriptor,v=[].slice;function y(G,q,X){return v.call(G,q,X)}function b(G,q){return q(G)}function I(G){if(!G)throw new Error("Assertion Failed")}function T(G){a.setImmediate?setImmediate(G):setTimeout(G,0)}function w(G,q){if(typeof q=="string"&&d(G,q))return G[q];if(!q)return G;if(typeof q!="string"){for(var X=[],ae=0,ue=q.length;ae<ue;++ae){var ve=w(G,q[ae]);X.push(ve)}return X}var Te=q.indexOf(".");if(Te!==-1){var Pe=G[q.substr(0,Te)];return Pe==null?void 0:w(Pe,q.substr(Te+1))}}function S(G,q,X){if(G&&q!==void 0&&!("isFrozen"in Object&&Object.isFrozen(G)))if(typeof q!="string"&&"length"in q){I(typeof X!="string"&&"length"in X);for(var ae=0,ue=q.length;ae<ue;++ae)S(G,q[ae],X[ae])}else{var ve,Te,Pe=q.indexOf(".");Pe!==-1?(ve=q.substr(0,Pe),(Te=q.substr(Pe+1))===""?X===void 0?o(G)&&!isNaN(parseInt(ve))?G.splice(ve,1):delete G[ve]:G[ve]=X:S(Pe=!(Pe=G[ve])||!d(G,ve)?G[ve]={}:Pe,Te,X)):X===void 0?o(G)&&!isNaN(parseInt(q))?G.splice(q,1):delete G[q]:G[q]=X}}function U(G){var q,X={};for(q in G)d(G,q)&&(X[q]=G[q]);return X}var P=[].concat;function E(G){return P.apply([],G)}var $s="BigUint64Array,BigInt64Array,Array,Boolean,String,Date,RegExp,Blob,File,FileList,FileSystemFileHandle,FileSystemDirectoryHandle,ArrayBuffer,DataView,Uint8ClampedArray,ImageBitmap,ImageData,Map,Set,CryptoKey".split(",").concat(E([8,16,32,64].map(function(G){return["Int","Uint","Float"].map(function(q){return q+G+"Array"})}))).filter(function(G){return a[G]}),R=new Set($s.map(function(G){return a[G]})),C=null;function M(G){return C=new WeakMap,G=function q(X){if(!X||typeof X!="object")return X;var ae=C.get(X);if(ae)return ae;if(o(X)){ae=[],C.set(X,ae);for(var ue=0,ve=X.length;ue<ve;++ue)ae.push(q(X[ue]))}else if(R.has(X.constructor))ae=X;else{var Te,Pe=c(X);for(Te in ae=Pe===Object.prototype?{}:Object.create(Pe),C.set(X,ae),X)d(X,Te)&&(ae[Te]=q(X[Te]))}return ae}(G),C=null,G}var _={}.toString;function A(G){return _.call(G).slice(8,-1)}var N=typeof Symbol<"u"?Symbol.iterator:"@@iterator",k=typeof N=="symbol"?function(G){var q;return G!=null&&(q=G[N])&&q.apply(G)}:function(){return null};function O(G,q){return q=G.indexOf(q),0<=q&&G.splice(q,1),0<=q}var $={};function F(G){var q,X,ae,ue;if(arguments.length===1){if(o(G))return G.slice();if(this===$&&typeof G=="string")return[G];if(ue=k(G)){for(X=[];!(ae=ue.next()).done;)X.push(ae.value);return X}if(G==null)return[G];if(typeof(q=G.length)!="number")return[G];for(X=new Array(q);q--;)X[q]=G[q];return X}for(q=arguments.length,X=new Array(q);q--;)X[q]=arguments[q];return X}var V=typeof Symbol<"u"?function(G){return G[Symbol.toStringTag]==="AsyncFunction"}:function(){return!1},lt=["Unknown","Constraint","Data","TransactionInactive","ReadOnly","Version","NotFound","InvalidState","InvalidAccess","Abort","Timeout","QuotaExceeded","Syntax","DataClone"],Hs=["Modify","Bulk","OpenFailed","VersionChange","Schema","Upgrade","InvalidTable","MissingAPI","NoSuchDatabase","InvalidArgument","SubTransaction","Unsupported","Internal","DatabaseClosed","PrematureCommit","ForeignAwait"].concat(lt),j={VersionChanged:"Database version changed by other database connection",DatabaseClosed:"Database has been closed",Abort:"Transaction aborted",TransactionInactive:"Transaction has already completed or failed",MissingAPI:"IndexedDB API missing. Please visit https://tinyurl.com/y2uuvskb"};function B(G,q){this.name=G,this.message=q}function z(G,q){return G+". Errors: "+Object.keys(q).map(function(X){return q[X].toString()}).filter(function(X,ae,ue){return ue.indexOf(X)===ae}).join(`
`)}function W(G,q,X,ae){this.failures=q,this.failedKeys=ae,this.successCount=X,this.message=z(G,q)}function Z(G,q){this.name="BulkError",this.failures=Object.keys(q).map(function(X){return q[X]}),this.failuresByPos=q,this.message=z(G,this.failures)}m(B).from(Error).extend({toString:function(){return this.name+": "+this.message}}),m(W).from(B),m(Z).from(B);var K=Hs.reduce(function(G,q){return G[q]=q+"Error",G},{}),Q=B,J=Hs.reduce(function(G,q){var X=q+"Error";function ae(ue,ve){this.name=X,ue?typeof ue=="string"?(this.message="".concat(ue).concat(ve?`
 `+ve:""),this.inner=ve||null):typeof ue=="object"&&(this.message="".concat(ue.name," ").concat(ue.message),this.inner=ue):(this.message=j[q]||X,this.inner=null)}return m(ae).from(Q),G[q]=ae,G},{});J.Syntax=SyntaxError,J.Type=TypeError,J.Range=RangeError;var se=lt.reduce(function(G,q){return G[q+"Error"]=J[q],G},{}),ie=Hs.reduce(function(G,q){return["Syntax","Type","Range"].indexOf(q)===-1&&(G[q+"Error"]=J[q]),G},{});function ce(){}function oe(G){return G}function te(G,q){return G==null||G===oe?q:function(X){return q(G(X))}}function le(G,q){return function(){G.apply(this,arguments),q.apply(this,arguments)}}function ne(G,q){return G===ce?q:function(){var X=G.apply(this,arguments);X!==void 0&&(arguments[0]=X);var ae=this.onsuccess,ue=this.onerror;this.onsuccess=null,this.onerror=null;var ve=q.apply(this,arguments);return ae&&(this.onsuccess=this.onsuccess?le(ae,this.onsuccess):ae),ue&&(this.onerror=this.onerror?le(ue,this.onerror):ue),ve!==void 0?ve:X}}function me(G,q){return G===ce?q:function(){G.apply(this,arguments);var X=this.onsuccess,ae=this.onerror;this.onsuccess=this.onerror=null,q.apply(this,arguments),X&&(this.onsuccess=this.onsuccess?le(X,this.onsuccess):X),ae&&(this.onerror=this.onerror?le(ae,this.onerror):ae)}}function be(G,q){return G===ce?q:function(X){var ae=G.apply(this,arguments);l(X,ae);var ue=this.onsuccess,ve=this.onerror;return this.onsuccess=null,this.onerror=null,X=q.apply(this,arguments),ue&&(this.onsuccess=this.onsuccess?le(ue,this.onsuccess):ue),ve&&(this.onerror=this.onerror?le(ve,this.onerror):ve),ae===void 0?X===void 0?void 0:X:l(ae,X)}}function Se(G,q){return G===ce?q:function(){return q.apply(this,arguments)!==!1&&G.apply(this,arguments)}}function we(G,q){return G===ce?q:function(){var X=G.apply(this,arguments);if(X&&typeof X.then=="function"){for(var ae=this,ue=arguments.length,ve=new Array(ue);ue--;)ve[ue]=arguments[ue];return X.then(function(){return q.apply(ae,ve)})}return q.apply(this,arguments)}}ie.ModifyError=W,ie.DexieError=B,ie.BulkError=Z;var ze=typeof location<"u"&&/^(http|https):\/\/(localhost|127\.0\.0\.1)/.test(location.href);function Qe(G){ze=G}var ke={},yt=100,$s=typeof Promise>"u"?[]:function(){var G=Promise.resolve();if(typeof crypto>"u"||!crypto.subtle)return[G,c(G),G];var q=crypto.subtle.digest("SHA-512",new Uint8Array([0]));return[q,c(q),G]}(),lt=$s[0],Hs=$s[1],$s=$s[2],Hs=Hs&&Hs.then,Ct=lt&&lt.constructor,Nt=!!$s,Ce=function(G,q){Je.push([G,q]),$e&&(queueMicrotask(ht),$e=!1)},Ge=!0,$e=!0,at=[],ct=[],Vt=oe,Me={id:"global",global:!0,ref:0,unhandleds:[],onunhandled:ce,pgp:!1,env:{},finalize:ce},De=Me,Je=[],St=0,bt=[];function Ie(G){if(typeof this!="object")throw new TypeError("Promises must be constructed via new");this._listeners=[],this._lib=!1;var q=this._PSD=De;if(typeof G!="function"){if(G!==ke)throw new TypeError("Not a function");return this._state=arguments[1],this._value=arguments[2],void(this._state===!1&&Ee(this,this._value))}this._state=null,this._value=null,++q.ref,function X(ae,ue){try{ue(function(ve){if(ae._state===null){if(ve===ae)throw new TypeError("A promise cannot be resolved with itself.");var Te=ae._lib&&ti();ve&&typeof ve.then=="function"?X(ae,function(Pe,Be){ve instanceof Ie?ve._then(Pe,Be):ve.then(Pe,Be)}):(ae._state=!0,ae._value=ve,Xe(ae)),Te&&Ke()}},Ee.bind(null,ae))}catch(ve){Ee(ae,ve)}}(this,G)}var Ue={get:function(){var G=De,q=Ui;function X(ae,ue){var ve=this,Te=!G.global&&(G!==De||q!==Ui),Pe=Te&&!lr(),Be=new Ie(function(Le,We){Et(ve,new Oe(uf(ae,G,Te,Pe),uf(ue,G,Te,Pe),Le,We,G))});return this._consoleTask&&(Be._consoleTask=this._consoleTask),Be}return X.prototype=ke,X},set:function(G){f(this,"then",G&&G.prototype===ke?Ue:{get:function(){return G},set:Ue.set})}};function Oe(G,q,X,ae,ue){this.onFulfilled=typeof G=="function"?G:null,this.onRejected=typeof q=="function"?q:null,this.resolve=X,this.reject=ae,this.psd=ue}function Ee(G,q){var X,ae;ct.push(q),G._state===null&&(X=G._lib&&ti(),q=Vt(q),G._state=!1,G._value=q,ae=G,at.some(function(ue){return ue._value===ae._value})||at.push(ae),Xe(G),X&&Ke())}function Xe(G){var q=G._listeners;G._listeners=[];for(var X=0,ae=q.length;X<ae;++X)Et(G,q[X]);var ue=G._PSD;--ue.ref||ue.finalize(),St===0&&(++St,Ce(function(){--St==0&&zt()},[]))}function Et(G,q){if(G._state!==null){var X=G._state?q.onFulfilled:q.onRejected;if(X===null)return(G._state?q.resolve:q.reject)(G._value);++q.psd.ref,++St,Ce(Fe,[X,G,q])}else G._listeners.push(q)}function Fe(G,q,X){try{var ae,ue=q._value;!q._state&&ct.length&&(ct=[]),ae=ze&&q._consoleTask?q._consoleTask.run(function(){return G(ue)}):G(ue),q._state||ct.indexOf(ue)!==-1||function(ve){for(var Te=at.length;Te;)if(at[--Te]._value===ve._value)return at.splice(Te,1)}(q),X.resolve(ae)}catch(ve){X.reject(ve)}finally{--St==0&&zt(),--X.psd.ref||X.psd.finalize()}}function ht(){Tc(Me,function(){ti()&&Ke()})}function ti(){var G=Ge;return $e=Ge=!1,G}function Ke(){var G,q,X;do for(;0<Je.length;)for(G=Je,Je=[],X=G.length,q=0;q<X;++q){var ae=G[q];ae[0].apply(null,ae[1])}while(0<Je.length);$e=Ge=!0}function zt(){var G=at;at=[],G.forEach(function(ae){ae._PSD.onunhandled.call(null,ae._value,ae)});for(var q=bt.slice(0),X=q.length;X;)q[--X]()}function mt(G){return new Ie(ke,!1,G)}function Tt(G,q){var X=De;return function(){var ae=ti(),ue=De;try{return hl(X,!0),G.apply(this,arguments)}catch(ve){q&&q(ve)}finally{hl(ue,!1),ae&&Ke()}}}p(Ie.prototype,{then:Ue,_then:function(G,q){Et(this,new Oe(null,null,G,q,De))},catch:function(G){if(arguments.length===1)return this.then(null,G);var q=G,X=arguments[1];return typeof q=="function"?this.then(null,function(ae){return(ae instanceof q?X:mt)(ae)}):this.then(null,function(ae){return(ae&&ae.name===q?X:mt)(ae)})},finally:function(G){return this.then(function(q){return Ie.resolve(G()).then(function(){return q})},function(q){return Ie.resolve(G()).then(function(){return mt(q)})})},timeout:function(G,q){var X=this;return G<1/0?new Ie(function(ae,ue){var ve=setTimeout(function(){return ue(new J.Timeout(q))},G);X.then(ae,ue).finally(clearTimeout.bind(null,ve))}):this}}),typeof Symbol<"u"&&Symbol.toStringTag&&f(Ie.prototype,Symbol.toStringTag,"Dexie.Promise"),Me.env=Xp(),p(Ie,{all:function(){var G=F.apply(null,arguments).map(Xa);return new Ie(function(q,X){G.length===0&&q([]);var ae=G.length;G.forEach(function(ue,ve){return Ie.resolve(ue).then(function(Te){G[ve]=Te,--ae||q(G)},X)})})},resolve:function(G){return G instanceof Ie?G:G&&typeof G.then=="function"?new Ie(function(q,X){G.then(q,X)}):new Ie(ke,!0,G)},reject:mt,race:function(){var G=F.apply(null,arguments).map(Xa);return new Ie(function(q,X){G.map(function(ae){return Ie.resolve(ae).then(q,X)})})},PSD:{get:function(){return De},set:function(G){return De=G}},totalEchoes:{get:function(){return Ui}},newPSD:nn,usePSD:Tc,scheduler:{get:function(){return Ce},set:function(G){Ce=G}},rejectionMapper:{get:function(){return Vt},set:function(G){Vt=G}},follow:function(G,q){return new Ie(function(X,ae){return nn(function(ue,ve){var Te=De;Te.unhandleds=[],Te.onunhandled=ve,Te.finalize=le(function(){var Pe,Be=this;Pe=function(){Be.unhandleds.length===0?ue():ve(Be.unhandleds[0])},bt.push(function Le(){Pe(),bt.splice(bt.indexOf(Le),1)}),++St,Ce(function(){--St==0&&zt()},[])},Te.finalize),G()},q,X,ae)})}}),Ct&&(Ct.allSettled&&f(Ie,"allSettled",function(){var G=F.apply(null,arguments).map(Xa);return new Ie(function(q){G.length===0&&q([]);var X=G.length,ae=new Array(X);G.forEach(function(ue,ve){return Ie.resolve(ue).then(function(Te){return ae[ve]={status:"fulfilled",value:Te}},function(Te){return ae[ve]={status:"rejected",reason:Te}}).then(function(){return--X||q(ae)})})})}),Ct.any&&typeof AggregateError<"u"&&f(Ie,"any",function(){var G=F.apply(null,arguments).map(Xa);return new Ie(function(q,X){G.length===0&&X(new AggregateError([]));var ae=G.length,ue=new Array(ae);G.forEach(function(ve,Te){return Ie.resolve(ve).then(function(Pe){return q(Pe)},function(Pe){ue[Te]=Pe,--ae||X(new AggregateError(ue))})})})}));var Ut={awaits:0,echoes:0,id:0},zi=0,gi=[],Dt=0,Ui=0,Cr=0;function nn(G,q,X,ae){var ue=De,ve=Object.create(ue);return ve.parent=ue,ve.ref=0,ve.global=!1,ve.id=++Cr,Me.env,ve.env=Nt?{Promise:Ie,PromiseProp:{value:Ie,configurable:!0,writable:!0},all:Ie.all,race:Ie.race,allSettled:Ie.allSettled,any:Ie.any,resolve:Ie.resolve,reject:Ie.reject}:{},q&&l(ve,q),++ue.ref,ve.finalize=function(){--this.parent.ref||this.parent.finalize()},ae=Tc(ve,G,X,ae),ve.ref===0&&ve.finalize(),ae}function tr(){return Ut.id||(Ut.id=++zi),++Ut.awaits,Ut.echoes+=yt,Ut.id}function lr(){return!!Ut.awaits&&(--Ut.awaits==0&&(Ut.id=0),Ut.echoes=Ut.awaits*yt,!0)}function Xa(G){return Ut.echoes&&G&&G.constructor===Ct?(tr(),G.then(function(q){return lr(),q},function(q){return lr(),An(q)})):G}function Gr(){var G=gi[gi.length-1];gi.pop(),hl(G,!1)}function hl(G,q){var X,ae=De;(q?!Ut.echoes||Dt++&&G===De:!Dt||--Dt&&G===De)||queueMicrotask(q?(function(ue){++Ui,Ut.echoes&&--Ut.echoes!=0||(Ut.echoes=Ut.awaits=Ut.id=0),gi.push(De),hl(ue,!0)}).bind(null,G):Gr),G!==De&&(De=G,ae===Me&&(Me.env=Xp()),Nt&&(X=Me.env.Promise,q=G.env,(ae.global||G.global)&&(Object.defineProperty(a,"Promise",q.PromiseProp),X.all=q.all,X.race=q.race,X.resolve=q.resolve,X.reject=q.reject,q.allSettled&&(X.allSettled=q.allSettled),q.any&&(X.any=q.any))))}function Xp(){var G=a.Promise;return Nt?{Promise:G,PromiseProp:Object.getOwnPropertyDescriptor(a,"Promise"),all:G.all,race:G.race,allSettled:G.allSettled,any:G.any,resolve:G.resolve,reject:G.reject}:{}}function Tc(G,q,X,ae,ue){var ve=De;try{return hl(G,!0),q(X,ae,ue)}finally{hl(ve,!1)}}function uf(G,q,X,ae){return typeof G!="function"?G:function(){var ue=De;X&&tr(),hl(q,!0);try{return G.apply(this,arguments)}finally{hl(ue,!1),ae&&queueMicrotask(lr)}}}function zd(G){Promise===Ct&&Ut.echoes===0?Dt===0?G():enqueueNativeMicroTask(G):setTimeout(G,0)}(""+Hs).indexOf("[native code]")===-1&&(tr=lr=ce);var An=Ie.reject,Uc="￿",Xs="Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.",pu="String expected.",hu=[],fl="__dbnames",Co="readonly",Dc="readwrite";function Js(G,q){return G?q?function(){return G.apply(this,arguments)&&q.apply(this,arguments)}:G:q}var Fs={type:3,lower:-1/0,lowerOpen:!1,upper:[[]],upperOpen:!1};function Ec(G){return typeof G!="string"||/\./.test(G)?function(q){return q}:function(q){return q[G]===void 0&&G in q&&delete(q=M(q))[G],q}}function df(){throw J.Type()}function nt(G,q){try{var X=Wt(G),ae=Wt(q);if(X!==ae)return X==="Array"?1:ae==="Array"?-1:X==="binary"?1:ae==="binary"?-1:X==="string"?1:ae==="string"?-1:X==="Date"?1:ae!=="Date"?NaN:-1;switch(X){case"number":case"Date":case"string":return q<G?1:G<q?-1:0;case"binary":return function(ue,ve){for(var Te=ue.length,Pe=ve.length,Be=Te<Pe?Te:Pe,Le=0;Le<Be;++Le)if(ue[Le]!==ve[Le])return ue[Le]<ve[Le]?-1:1;return Te===Pe?0:Te<Pe?-1:1}($i(G),$i(q));case"Array":return function(ue,ve){for(var Te=ue.length,Pe=ve.length,Be=Te<Pe?Te:Pe,Le=0;Le<Be;++Le){var We=nt(ue[Le],ve[Le]);if(We!==0)return We}return Te===Pe?0:Te<Pe?-1:1}(G,q)}}catch{}return NaN}function Wt(G){var q=typeof G;return q!="object"?q:ArrayBuffer.isView(G)?"binary":(G=A(G),G==="ArrayBuffer"?"binary":G)}function $i(G){return G instanceof Uint8Array?G:ArrayBuffer.isView(G)?new Uint8Array(G.buffer,G.byteOffset,G.byteLength):new Uint8Array(G)}var Ja=(on.prototype._trans=function(G,q,X){var ae=this._tx||De.trans,ue=this.name,ve=ze&&typeof console<"u"&&console.createTask&&console.createTask("Dexie: ".concat(G==="readonly"?"read":"write"," ").concat(this.name));function Te(Le,We,xe){if(!xe.schema[ue])throw new J.NotFound("Table "+ue+" not part of transaction");return q(xe.idbtrans,xe)}var Pe=ti();try{var Be=ae&&ae.db._novip===this.db._novip?ae===De.trans?ae._promise(G,Te,X):nn(function(){return ae._promise(G,Te,X)},{trans:ae,transless:De.transless||De}):function Le(We,xe,qe,Ve){if(We.idbdb&&(We._state.openComplete||De.letThrough||We._vip)){var He=We._createTransaction(xe,qe,We._dbSchema);try{He.create(),We._state.PR1398_maxLoop=3}catch(Ye){return Ye.name===K.InvalidState&&We.isOpen()&&0<--We._state.PR1398_maxLoop?(console.warn("Dexie: Need to reopen db"),We.close({disableAutoOpen:!1}),We.open().then(function(){return Le(We,xe,qe,Ve)})):An(Ye)}return He._promise(xe,function(Ye,je){return nn(function(){return De.trans=He,Ve(Ye,je,He)})}).then(function(Ye){if(xe==="readwrite")try{He.idbtrans.commit()}catch{}return xe==="readonly"?Ye:He._completion.then(function(){return Ye})})}if(We._state.openComplete)return An(new J.DatabaseClosed(We._state.dbOpenError));if(!We._state.isBeingOpened){if(!We._state.autoOpen)return An(new J.DatabaseClosed);We.open().catch(ce)}return We._state.dbReadyPromise.then(function(){return Le(We,xe,qe,Ve)})}(this.db,G,[this.name],Te);return ve&&(Be._consoleTask=ve,Be=Be.catch(function(Le){return console.trace(Le),An(Le)})),Be}finally{Pe&&Ke()}},on.prototype.get=function(G,q){var X=this;return G&&G.constructor===Object?this.where(G).first(q):G==null?An(new J.Type("Invalid argument to Table.get()")):this._trans("readonly",function(ae){return X.core.get({trans:ae,key:G}).then(function(ue){return X.hook.reading.fire(ue)})}).then(q)},on.prototype.where=function(G){if(typeof G=="string")return new this.db.WhereClause(this,G);if(o(G))return new this.db.WhereClause(this,"[".concat(G.join("+"),"]"));var q=s(G);if(q.length===1)return this.where(q[0]).equals(G[q[0]]);var X=this.schema.indexes.concat(this.schema.primKey).filter(function(Be){if(Be.compound&&q.every(function(We){return 0<=Be.keyPath.indexOf(We)})){for(var Le=0;Le<q.length;++Le)if(q.indexOf(Be.keyPath[Le])===-1)return!1;return!0}return!1}).sort(function(Be,Le){return Be.keyPath.length-Le.keyPath.length})[0];if(X&&this.db._maxKey!==Uc){var Te=X.keyPath.slice(0,q.length);return this.where(Te).equals(Te.map(function(Le){return G[Le]}))}!X&&ze&&console.warn("The query ".concat(JSON.stringify(G)," on ").concat(this.name," would benefit from a ")+"compound index [".concat(q.join("+"),"]"));var ae=this.schema.idxByName,ue=this.db._deps.indexedDB;function ve(Be,Le){return ue.cmp(Be,Le)===0}var Pe=q.reduce(function(qe,Le){var We=qe[0],xe=qe[1],qe=ae[Le],Ve=G[Le];return[We||qe,We||!qe?Js(xe,qe&&qe.multi?function(He){return He=w(He,Le),o(He)&&He.some(function(Ye){return ve(Ve,Ye)})}:function(He){return ve(Ve,w(He,Le))}):xe]},[null,null]),Te=Pe[0],Pe=Pe[1];return Te?this.where(Te.name).equals(G[Te.keyPath]).filter(Pe):X?this.filter(Pe):this.where(q).equals("")},on.prototype.filter=function(G){return this.toCollection().and(G)},on.prototype.count=function(G){return this.toCollection().count(G)},on.prototype.offset=function(G){return this.toCollection().offset(G)},on.prototype.limit=function(G){return this.toCollection().limit(G)},on.prototype.each=function(G){return this.toCollection().each(G)},on.prototype.toArray=function(G){return this.toCollection().toArray(G)},on.prototype.toCollection=function(){return new this.db.Collection(new this.db.WhereClause(this))},on.prototype.orderBy=function(G){return new this.db.Collection(new this.db.WhereClause(this,o(G)?"[".concat(G.join("+"),"]"):G))},on.prototype.reverse=function(){return this.toCollection().reverse()},on.prototype.mapToClass=function(G){var q,X=this.db,ae=this.name;function ue(){return q!==null&&q.apply(this,arguments)||this}(this.schema.mappedClass=G).prototype instanceof df&&(function(Be,Le){if(typeof Le!="function"&&Le!==null)throw new TypeError("Class extends value "+String(Le)+" is not a constructor or null");function We(){this.constructor=Be}i(Be,Le),Be.prototype=Le===null?Object.create(Le):(We.prototype=Le.prototype,new We)}(ue,q=G),Object.defineProperty(ue.prototype,"db",{get:function(){return X},enumerable:!1,configurable:!0}),ue.prototype.table=function(){return ae},G=ue);for(var ve=new Set,Te=G.prototype;Te;Te=c(Te))Object.getOwnPropertyNames(Te).forEach(function(Be){return ve.add(Be)});function Pe(Be){if(!Be)return Be;var Le,We=Object.create(G.prototype);for(Le in Be)if(!ve.has(Le))try{We[Le]=Be[Le]}catch{}return We}return this.schema.readHook&&this.hook.reading.unsubscribe(this.schema.readHook),this.schema.readHook=Pe,this.hook("reading",Pe),G},on.prototype.defineClass=function(){return this.mapToClass(function(G){l(this,G)})},on.prototype.add=function(G,q){var X=this,ae=this.schema.primKey,ue=ae.auto,ve=ae.keyPath,Te=G;return ve&&ue&&(Te=Ec(ve)(G)),this._trans("readwrite",function(Pe){return X.core.mutate({trans:Pe,type:"add",keys:q!=null?[q]:null,values:[Te]})}).then(function(Pe){return Pe.numFailures?Ie.reject(Pe.failures[0]):Pe.lastResult}).then(function(Pe){if(ve)try{S(G,ve,Pe)}catch{}return Pe})},on.prototype.update=function(G,q){return typeof G!="object"||o(G)?this.where(":id").equals(G).modify(q):(G=w(G,this.schema.primKey.keyPath),G===void 0?An(new J.InvalidArgument("Given object does not contain its primary key")):this.where(":id").equals(G).modify(q))},on.prototype.put=function(G,q){var X=this,ae=this.schema.primKey,ue=ae.auto,ve=ae.keyPath,Te=G;return ve&&ue&&(Te=Ec(ve)(G)),this._trans("readwrite",function(Pe){return X.core.mutate({trans:Pe,type:"put",values:[Te],keys:q!=null?[q]:null})}).then(function(Pe){return Pe.numFailures?Ie.reject(Pe.failures[0]):Pe.lastResult}).then(function(Pe){if(ve)try{S(G,ve,Pe)}catch{}return Pe})},on.prototype.delete=function(G){var q=this;return this._trans("readwrite",function(X){return q.core.mutate({trans:X,type:"delete",keys:[G]})}).then(function(X){return X.numFailures?Ie.reject(X.failures[0]):void 0})},on.prototype.clear=function(){var G=this;return this._trans("readwrite",function(q){return G.core.mutate({trans:q,type:"deleteRange",range:Fs})}).then(function(q){return q.numFailures?Ie.reject(q.failures[0]):void 0})},on.prototype.bulkGet=function(G){var q=this;return this._trans("readonly",function(X){return q.core.getMany({keys:G,trans:X}).then(function(ae){return ae.map(function(ue){return q.hook.reading.fire(ue)})})})},on.prototype.bulkAdd=function(G,q,X){var ae=this,ue=Array.isArray(q)?q:void 0,ve=(X=X||(ue?void 0:q))?X.allKeys:void 0;return this._trans("readwrite",function(Te){var Le=ae.schema.primKey,Pe=Le.auto,Le=Le.keyPath;if(Le&&ue)throw new J.InvalidArgument("bulkAdd(): keys argument invalid on tables with inbound keys");if(ue&&ue.length!==G.length)throw new J.InvalidArgument("Arguments objects and keys must have the same length");var Be=G.length,Le=Le&&Pe?G.map(Ec(Le)):G;return ae.core.mutate({trans:Te,type:"add",keys:ue,values:Le,wantResults:ve}).then(function(He){var xe=He.numFailures,qe=He.results,Ve=He.lastResult,He=He.failures;if(xe===0)return ve?qe:Ve;throw new Z("".concat(ae.name,".bulkAdd(): ").concat(xe," of ").concat(Be," operations failed"),He)})})},on.prototype.bulkPut=function(G,q,X){var ae=this,ue=Array.isArray(q)?q:void 0,ve=(X=X||(ue?void 0:q))?X.allKeys:void 0;return this._trans("readwrite",function(Te){var Le=ae.schema.primKey,Pe=Le.auto,Le=Le.keyPath;if(Le&&ue)throw new J.InvalidArgument("bulkPut(): keys argument invalid on tables with inbound keys");if(ue&&ue.length!==G.length)throw new J.InvalidArgument("Arguments objects and keys must have the same length");var Be=G.length,Le=Le&&Pe?G.map(Ec(Le)):G;return ae.core.mutate({trans:Te,type:"put",keys:ue,values:Le,wantResults:ve}).then(function(He){var xe=He.numFailures,qe=He.results,Ve=He.lastResult,He=He.failures;if(xe===0)return ve?qe:Ve;throw new Z("".concat(ae.name,".bulkPut(): ").concat(xe," of ").concat(Be," operations failed"),He)})})},on.prototype.bulkUpdate=function(G){var q=this,X=this.core,ae=G.map(function(Te){return Te.key}),ue=G.map(function(Te){return Te.changes}),ve=[];return this._trans("readwrite",function(Te){return X.getMany({trans:Te,keys:ae,cache:"clone"}).then(function(Pe){var Be=[],Le=[];G.forEach(function(xe,qe){var Ve=xe.key,He=xe.changes,Ye=Pe[qe];if(Ye){for(var je=0,tt=Object.keys(He);je<tt.length;je++){var it=tt[je],rt=He[it];if(it===q.schema.primKey.keyPath){if(nt(rt,Ve)!==0)throw new J.Constraint("Cannot update primary key in bulkUpdate()")}else S(Ye,it,rt)}ve.push(qe),Be.push(Ve),Le.push(Ye)}});var We=Be.length;return X.mutate({trans:Te,type:"put",keys:Be,values:Le,updates:{keys:ae,changeSpecs:ue}}).then(function(xe){var qe=xe.numFailures,Ve=xe.failures;if(qe===0)return We;for(var He=0,Ye=Object.keys(Ve);He<Ye.length;He++){var je,tt=Ye[He],it=ve[Number(tt)];it!=null&&(je=Ve[tt],delete Ve[tt],Ve[it]=je)}throw new Z("".concat(q.name,".bulkUpdate(): ").concat(qe," of ").concat(We," operations failed"),Ve)})})})},on.prototype.bulkDelete=function(G){var q=this,X=G.length;return this._trans("readwrite",function(ae){return q.core.mutate({trans:ae,type:"delete",keys:G})}).then(function(Te){var ue=Te.numFailures,ve=Te.lastResult,Te=Te.failures;if(ue===0)return ve;throw new Z("".concat(q.name,".bulkDelete(): ").concat(ue," of ").concat(X," operations failed"),Te)})},on);function on(){}function Yo(G){function q(Te,Pe){if(Pe){for(var Be=arguments.length,Le=new Array(Be-1);--Be;)Le[Be-1]=arguments[Be];return X[Te].subscribe.apply(null,Le),G}if(typeof Te=="string")return X[Te]}var X={};q.addEventType=ve;for(var ae=1,ue=arguments.length;ae<ue;++ae)ve(arguments[ae]);return q;function ve(Te,Pe,Be){if(typeof Te!="object"){var Le;Pe=Pe||Se;var We={subscribers:[],fire:Be=Be||ce,subscribe:function(xe){We.subscribers.indexOf(xe)===-1&&(We.subscribers.push(xe),We.fire=Pe(We.fire,xe))},unsubscribe:function(xe){We.subscribers=We.subscribers.filter(function(qe){return qe!==xe}),We.fire=We.subscribers.reduce(Pe,Be)}};return X[Te]=q[Te]=We}s(Le=Te).forEach(function(xe){var qe=Le[xe];if(o(qe))ve(xe,Le[xe][0],Le[xe][1]);else{if(qe!=="asap")throw new J.InvalidArgument("Invalid event config");var Ve=ve(xe,oe,function(){for(var He=arguments.length,Ye=new Array(He);He--;)Ye[He]=arguments[He];Ve.subscribers.forEach(function(je){T(function(){je.apply(null,Ye)})})})}})}}function ml(G,q){return m(q).from({prototype:G}),q}function qi(G,q){return!(G.filter||G.algorithm||G.or)&&(q?G.justLimit:!G.replayFilter)}function zr(G,q){G.filter=Js(G.filter,q)}function Jp(G,q,X){var ae=G.replayFilter;G.replayFilter=ae?function(){return Js(ae(),q())}:q,G.justLimit=X&&!ae}function ld(G,q){if(G.isPrimKey)return q.primaryKey;var X=q.getIndexByKeyPath(G.index);if(!X)throw new J.Schema("KeyPath "+G.index+" on object store "+q.name+" is not indexed");return X}function Ro(G,q,X){var ae=ld(G,q.schema);return q.openCursor({trans:X,values:!G.keysOnly,reverse:G.dir==="prev",unique:!!G.unique,query:{index:ae,range:G.range}})}function pf(G,q,X,ae){var ue=G.replayFilter?Js(G.filter,G.replayFilter()):G.filter;if(G.or){var ve={},Te=function(Pe,Be,Le){var We,xe;ue&&!ue(Be,Le,function(qe){return Be.stop(qe)},function(qe){return Be.fail(qe)})||((xe=""+(We=Be.primaryKey))=="[object ArrayBuffer]"&&(xe=""+new Uint8Array(We)),d(ve,xe)||(ve[xe]=!0,q(Pe,Be,Le)))};return Promise.all([G.or._iterate(Te,X),cd(Ro(G,ae,X),G.algorithm,Te,!G.keysOnly&&G.valueMapper)])}return cd(Ro(G,ae,X),Js(G.algorithm,ue),q,!G.keysOnly&&G.valueMapper)}function cd(G,q,X,ae){var ue=Tt(ae?function(ve,Te,Pe){return X(ae(ve),Te,Pe)}:X);return G.then(function(ve){if(ve)return ve.start(function(){var Te=function(){return ve.continue()};q&&!q(ve,function(Pe){return Te=Pe},function(Pe){ve.stop(Pe),Te=ce},function(Pe){ve.fail(Pe),Te=ce})||ue(ve.value,ve,function(Pe){return Te=Pe}),Te()})})}var $s=Symbol(),qr=(Ko.prototype.execute=function(G){if(this.add!==void 0){var q=this.add;if(o(q))return r(r([],o(G)?G:[],!0),q).sort();if(typeof q=="number")return(Number(G)||0)+q;if(typeof q=="bigint")try{return BigInt(G)+q}catch{return BigInt(0)+q}throw new TypeError("Invalid term ".concat(q))}if(this.remove!==void 0){var X=this.remove;if(o(X))return o(G)?G.filter(function(ae){return!X.includes(ae)}).sort():[];if(typeof X=="number")return Number(G)-X;if(typeof X=="bigint")try{return BigInt(G)-X}catch{return BigInt(0)-X}throw new TypeError("Invalid subtrahend ".concat(X))}return q=(q=this.replacePrefix)===null||q===void 0?void 0:q[0],q&&typeof G=="string"&&G.startsWith(q)?this.replacePrefix[1]+G.substring(q.length):G},Ko);function Ko(G){Object.assign(this,G)}var Mo=(ln.prototype._read=function(G,q){var X=this._ctx;return X.error?X.table._trans(null,An.bind(null,X.error)):X.table._trans("readonly",G).then(q)},ln.prototype._write=function(G){var q=this._ctx;return q.error?q.table._trans(null,An.bind(null,q.error)):q.table._trans("readwrite",G,"locked")},ln.prototype._addAlgorithm=function(G){var q=this._ctx;q.algorithm=Js(q.algorithm,G)},ln.prototype._iterate=function(G,q){return pf(this._ctx,G,q,this._ctx.table.core)},ln.prototype.clone=function(G){var q=Object.create(this.constructor.prototype),X=Object.create(this._ctx);return G&&l(X,G),q._ctx=X,q},ln.prototype.raw=function(){return this._ctx.valueMapper=null,this},ln.prototype.each=function(G){var q=this._ctx;return this._read(function(X){return pf(q,G,X,q.table.core)})},ln.prototype.count=function(G){var q=this;return this._read(function(X){var ae=q._ctx,ue=ae.table.core;if(qi(ae,!0))return ue.count({trans:X,query:{index:ld(ae,ue.schema),range:ae.range}}).then(function(Te){return Math.min(Te,ae.limit)});var ve=0;return pf(ae,function(){return++ve,!1},X,ue).then(function(){return ve})}).then(G)},ln.prototype.sortBy=function(G,q){var X=G.split(".").reverse(),ae=X[0],ue=X.length-1;function ve(Be,Le){return Le?ve(Be[X[Le]],Le-1):Be[ae]}var Te=this._ctx.dir==="next"?1:-1;function Pe(Be,Le){return Be=ve(Be,ue),Le=ve(Le,ue),Be<Le?-Te:Le<Be?Te:0}return this.toArray(function(Be){return Be.sort(Pe)}).then(q)},ln.prototype.toArray=function(G){var q=this;return this._read(function(X){var ae=q._ctx;if(ae.dir==="next"&&qi(ae,!0)&&0<ae.limit){var ue=ae.valueMapper,ve=ld(ae,ae.table.core.schema);return ae.table.core.query({trans:X,limit:ae.limit,values:!0,query:{index:ve,range:ae.range}}).then(function(Pe){return Pe=Pe.result,ue?Pe.map(ue):Pe})}var Te=[];return pf(ae,function(Pe){return Te.push(Pe)},X,ae.table.core).then(function(){return Te})},G)},ln.prototype.offset=function(G){var q=this._ctx;return G<=0||(q.offset+=G,qi(q)?Jp(q,function(){var X=G;return function(ae,ue){return X===0||(X===1?--X:ue(function(){ae.advance(X),X=0}),!1)}}):Jp(q,function(){var X=G;return function(){return--X<0}})),this},ln.prototype.limit=function(G){return this._ctx.limit=Math.min(this._ctx.limit,G),Jp(this._ctx,function(){var q=G;return function(X,ae,ue){return--q<=0&&ae(ue),0<=q}},!0),this},ln.prototype.until=function(G,q){return zr(this._ctx,function(X,ae,ue){return!G(X.value)||(ae(ue),q)}),this},ln.prototype.first=function(G){return this.limit(1).toArray(function(q){return q[0]}).then(G)},ln.prototype.last=function(G){return this.reverse().first(G)},ln.prototype.filter=function(G){var q;return zr(this._ctx,function(X){return G(X.value)}),(q=this._ctx).isMatch=Js(q.isMatch,G),this},ln.prototype.and=function(G){return this.filter(G)},ln.prototype.or=function(G){return new this.db.WhereClause(this._ctx.table,G,this)},ln.prototype.reverse=function(){return this._ctx.dir=this._ctx.dir==="prev"?"next":"prev",this._ondirectionchange&&this._ondirectionchange(this._ctx.dir),this},ln.prototype.desc=function(){return this.reverse()},ln.prototype.eachKey=function(G){var q=this._ctx;return q.keysOnly=!q.isMatch,this.each(function(X,ae){G(ae.key,ae)})},ln.prototype.eachUniqueKey=function(G){return this._ctx.unique="unique",this.eachKey(G)},ln.prototype.eachPrimaryKey=function(G){var q=this._ctx;return q.keysOnly=!q.isMatch,this.each(function(X,ae){G(ae.primaryKey,ae)})},ln.prototype.keys=function(G){var q=this._ctx;q.keysOnly=!q.isMatch;var X=[];return this.each(function(ae,ue){X.push(ue.key)}).then(function(){return X}).then(G)},ln.prototype.primaryKeys=function(G){var q=this._ctx;if(q.dir==="next"&&qi(q,!0)&&0<q.limit)return this._read(function(ae){var ue=ld(q,q.table.core.schema);return q.table.core.query({trans:ae,values:!1,limit:q.limit,query:{index:ue,range:q.range}})}).then(function(ae){return ae.result}).then(G);q.keysOnly=!q.isMatch;var X=[];return this.each(function(ae,ue){X.push(ue.primaryKey)}).then(function(){return X}).then(G)},ln.prototype.uniqueKeys=function(G){return this._ctx.unique="unique",this.keys(G)},ln.prototype.firstKey=function(G){return this.limit(1).keys(function(q){return q[0]}).then(G)},ln.prototype.lastKey=function(G){return this.reverse().firstKey(G)},ln.prototype.distinct=function(){var G=this._ctx,G=G.index&&G.table.schema.idxByName[G.index];if(!G||!G.multi)return this;var q={};return zr(this._ctx,function(ue){var ae=ue.primaryKey.toString(),ue=d(q,ae);return q[ae]=!0,!ue}),this},ln.prototype.modify=function(G){var q=this,X=this._ctx;return this._write(function(ae){var ue,ve,Te;Te=typeof G=="function"?G:(ue=s(G),ve=ue.length,function(je){for(var tt=!1,it=0;it<ve;++it){var rt=ue[it],vt=G[rt],kt=w(je,rt);vt instanceof qr?(S(je,rt,vt.execute(kt)),tt=!0):kt!==vt&&(S(je,rt,vt),tt=!0)}return tt});function Pe(je,rt){var it=rt.failures,rt=rt.numFailures;He+=je-rt;for(var vt=0,kt=s(it);vt<kt.length;vt++){var Xt=kt[vt];Ve.push(it[Xt])}}var Be=X.table.core,Le=Be.schema.primaryKey,We=Le.outbound,xe=Le.extractKey,qe=q.db._options.modifyChunkSize||200,Ve=[],He=0,Ye=[];return q.clone().primaryKeys().then(function(je){function tt(rt){var vt=Math.min(qe,je.length-rt);return Be.getMany({trans:ae,keys:je.slice(rt,rt+vt),cache:"immutable"}).then(function(kt){for(var Xt=[],jt=[],Yt=We?[]:null,qt=[],Lt=0;Lt<vt;++Lt){var en=kt[Lt],In={value:M(en),primKey:je[rt+Lt]};Te.call(In,In.value,In)!==!1&&(In.value==null?qt.push(je[rt+Lt]):We||nt(xe(en),xe(In.value))===0?(jt.push(In.value),We&&Yt.push(je[rt+Lt])):(qt.push(je[rt+Lt]),Xt.push(In.value)))}return Promise.resolve(0<Xt.length&&Be.mutate({trans:ae,type:"add",values:Xt}).then(function(Ln){for(var Fn in Ln.failures)qt.splice(parseInt(Fn),1);Pe(Xt.length,Ln)})).then(function(){return(0<jt.length||it&&typeof G=="object")&&Be.mutate({trans:ae,type:"put",keys:Yt,values:jt,criteria:it,changeSpec:typeof G!="function"&&G,isAdditionalChunk:0<rt}).then(function(Ln){return Pe(jt.length,Ln)})}).then(function(){return(0<qt.length||it&&G===gl)&&Be.mutate({trans:ae,type:"delete",keys:qt,criteria:it,isAdditionalChunk:0<rt}).then(function(Ln){return Pe(qt.length,Ln)})}).then(function(){return je.length>rt+vt&&tt(rt+qe)})})}var it=qi(X)&&X.limit===1/0&&(typeof G!="function"||G===gl)&&{index:X.index,range:X.range};return tt(0).then(function(){if(0<Ve.length)throw new W("Error modifying one or more objects",Ve,He,Ye);return je.length})})})},ln.prototype.delete=function(){var G=this._ctx,q=G.range;return qi(G)&&(G.isPrimKey||q.type===3)?this._write(function(X){var ae=G.table.core.schema.primaryKey,ue=q;return G.table.core.count({trans:X,query:{index:ae,range:ue}}).then(function(ve){return G.table.core.mutate({trans:X,type:"deleteRange",range:ue}).then(function(Te){var Pe=Te.failures;if(Te.lastResult,Te.results,Te=Te.numFailures,Te)throw new W("Could not delete some values",Object.keys(Pe).map(function(Be){return Pe[Be]}),ve-Te);return ve-Te})})}):this.modify(gl)},ln);function ln(){}var gl=function(G,q){return q.value=null};function Qp(G,q){return G<q?-1:G===q?0:1}function Gl(G,q){return q<G?-1:G===q?0:1}function Bs(G,q,X){return G=G instanceof Vs?new G.Collection(G):G,G._ctx.error=new(X||TypeError)(q),G}function Pc(G){return new G.Collection(G,function(){return Wd("")}).limit(0)}function qd(G,q,X,ae){var ue,ve,Te,Pe,Be,Le,We,xe=X.length;if(!X.every(function(He){return typeof He=="string"}))return Bs(G,pu);function qe(He){ue=He==="next"?function(je){return je.toUpperCase()}:function(je){return je.toLowerCase()},ve=He==="next"?function(je){return je.toLowerCase()}:function(je){return je.toUpperCase()},Te=He==="next"?Qp:Gl;var Ye=X.map(function(je){return{lower:ve(je),upper:ue(je)}}).sort(function(je,tt){return Te(je.lower,tt.lower)});Pe=Ye.map(function(je){return je.upper}),Be=Ye.map(function(je){return je.lower}),We=(Le=He)==="next"?"":ae}qe("next"),G=new G.Collection(G,function(){return Hl(Pe[0],Be[xe-1]+ae)}),G._ondirectionchange=function(He){qe(He)};var Ve=0;return G._addAlgorithm(function(He,Ye,je){var tt=He.key;if(typeof tt!="string")return!1;var it=ve(tt);if(q(it,Be,Ve))return!0;for(var rt=null,vt=Ve;vt<xe;++vt){var kt=function(Xt,jt,Yt,qt,Lt,en){for(var In=Math.min(Xt.length,qt.length),Ln=-1,Fn=0;Fn<In;++Fn){var zs=jt[Fn];if(zs!==qt[Fn])return Lt(Xt[Fn],Yt[Fn])<0?Xt.substr(0,Fn)+Yt[Fn]+Yt.substr(Fn+1):Lt(Xt[Fn],qt[Fn])<0?Xt.substr(0,Fn)+qt[Fn]+Yt.substr(Fn+1):0<=Ln?Xt.substr(0,Ln)+jt[Ln]+Yt.substr(Ln+1):null;Lt(Xt[Fn],zs)<0&&(Ln=Fn)}return In<qt.length&&en==="next"?Xt+Yt.substr(Xt.length):In<Xt.length&&en==="prev"?Xt.substr(0,Yt.length):Ln<0?null:Xt.substr(0,Ln)+qt[Ln]+Yt.substr(Ln+1)}(tt,it,Pe[vt],Be[vt],Te,Le);kt===null&&rt===null?Ve=vt+1:(rt===null||0<Te(rt,kt))&&(rt=kt)}return Ye(rt!==null?function(){He.continue(rt+We)}:je),!1}),G}function Hl(G,q,X,ae){return{type:2,lower:G,upper:q,lowerOpen:X,upperOpen:ae}}function Wd(G){return{type:1,lower:G,upper:G}}var Vs=(Object.defineProperty(ha.prototype,"Collection",{get:function(){return this._ctx.table.db.Collection},enumerable:!1,configurable:!0}),ha.prototype.between=function(G,q,X,ae){X=X!==!1,ae=ae===!0;try{return 0<this._cmp(G,q)||this._cmp(G,q)===0&&(X||ae)&&(!X||!ae)?Pc(this):new this.Collection(this,function(){return Hl(G,q,!X,!ae)})}catch{return Bs(this,Xs)}},ha.prototype.equals=function(G){return G==null?Bs(this,Xs):new this.Collection(this,function(){return Wd(G)})},ha.prototype.above=function(G){return G==null?Bs(this,Xs):new this.Collection(this,function(){return Hl(G,void 0,!0)})},ha.prototype.aboveOrEqual=function(G){return G==null?Bs(this,Xs):new this.Collection(this,function(){return Hl(G,void 0,!1)})},ha.prototype.below=function(G){return G==null?Bs(this,Xs):new this.Collection(this,function(){return Hl(void 0,G,!1,!0)})},ha.prototype.belowOrEqual=function(G){return G==null?Bs(this,Xs):new this.Collection(this,function(){return Hl(void 0,G)})},ha.prototype.startsWith=function(G){return typeof G!="string"?Bs(this,pu):this.between(G,G+Uc,!0,!0)},ha.prototype.startsWithIgnoreCase=function(G){return G===""?this.startsWith(G):qd(this,function(q,X){return q.indexOf(X[0])===0},[G],Uc)},ha.prototype.equalsIgnoreCase=function(G){return qd(this,function(q,X){return q===X[0]},[G],"")},ha.prototype.anyOfIgnoreCase=function(){var G=F.apply($,arguments);return G.length===0?Pc(this):qd(this,function(q,X){return X.indexOf(q)!==-1},G,"")},ha.prototype.startsWithAnyOfIgnoreCase=function(){var G=F.apply($,arguments);return G.length===0?Pc(this):qd(this,function(q,X){return X.some(function(ae){return q.indexOf(ae)===0})},G,Uc)},ha.prototype.anyOf=function(){var G=this,q=F.apply($,arguments),X=this._cmp;try{q.sort(X)}catch{return Bs(this,Xs)}if(q.length===0)return Pc(this);var ae=new this.Collection(this,function(){return Hl(q[0],q[q.length-1])});ae._ondirectionchange=function(ve){X=ve==="next"?G._ascending:G._descending,q.sort(X)};var ue=0;return ae._addAlgorithm(function(ve,Te,Pe){for(var Be=ve.key;0<X(Be,q[ue]);)if(++ue===q.length)return Te(Pe),!1;return X(Be,q[ue])===0||(Te(function(){ve.continue(q[ue])}),!1)}),ae},ha.prototype.notEqual=function(G){return this.inAnyRange([[-1/0,G],[G,this.db._maxKey]],{includeLowers:!1,includeUppers:!1})},ha.prototype.noneOf=function(){var G=F.apply($,arguments);if(G.length===0)return new this.Collection(this);try{G.sort(this._ascending)}catch{return Bs(this,Xs)}var q=G.reduce(function(X,ae){return X?X.concat([[X[X.length-1][1],ae]]):[[-1/0,ae]]},null);return q.push([G[G.length-1],this.db._maxKey]),this.inAnyRange(q,{includeLowers:!1,includeUppers:!1})},ha.prototype.inAnyRange=function(tt,q){var X=this,ae=this._cmp,ue=this._ascending,ve=this._descending,Te=this._min,Pe=this._max;if(tt.length===0)return Pc(this);if(!tt.every(function(it){return it[0]!==void 0&&it[1]!==void 0&&ue(it[0],it[1])<=0}))return Bs(this,"First argument to inAnyRange() must be an Array of two-value Arrays [lower,upper] where upper must not be lower than lower",J.InvalidArgument);var Be=!q||q.includeLowers!==!1,Le=q&&q.includeUppers===!0,We,xe=ue;function qe(it,rt){return xe(it[0],rt[0])}try{(We=tt.reduce(function(it,rt){for(var vt=0,kt=it.length;vt<kt;++vt){var Xt=it[vt];if(ae(rt[0],Xt[1])<0&&0<ae(rt[1],Xt[0])){Xt[0]=Te(Xt[0],rt[0]),Xt[1]=Pe(Xt[1],rt[1]);break}}return vt===kt&&it.push(rt),it},[])).sort(qe)}catch{return Bs(this,Xs)}var Ve=0,He=Le?function(it){return 0<ue(it,We[Ve][1])}:function(it){return 0<=ue(it,We[Ve][1])},Ye=Be?function(it){return 0<ve(it,We[Ve][0])}:function(it){return 0<=ve(it,We[Ve][0])},je=He,tt=new this.Collection(this,function(){return Hl(We[0][0],We[We.length-1][1],!Be,!Le)});return tt._ondirectionchange=function(it){xe=it==="next"?(je=He,ue):(je=Ye,ve),We.sort(qe)},tt._addAlgorithm(function(it,rt,vt){for(var kt,Xt=it.key;je(Xt);)if(++Ve===We.length)return rt(vt),!1;return!He(kt=Xt)&&!Ye(kt)||(X._cmp(Xt,We[Ve][1])===0||X._cmp(Xt,We[Ve][0])===0||rt(function(){xe===ue?it.continue(We[Ve][0]):it.continue(We[Ve][1])}),!1)}),tt},ha.prototype.startsWithAnyOf=function(){var G=F.apply($,arguments);return G.every(function(q){return typeof q=="string"})?G.length===0?Pc(this):this.inAnyRange(G.map(function(q){return[q,q+Uc]})):Bs(this,"startsWithAnyOf() only works with strings")},ha);function ha(){}function vl(G){return Tt(function(q){return Bi(q),G(q.target.error),!1})}function Bi(G){G.stopPropagation&&G.stopPropagation(),G.preventDefault&&G.preventDefault()}var Ds="storagemutated",cr="x-storagemutated-1",Cc=Yo(null,Ds),hf=(Qs.prototype._lock=function(){return I(!De.global),++this._reculock,this._reculock!==1||De.global||(De.lockOwnerFor=this),this},Qs.prototype._unlock=function(){if(I(!De.global),--this._reculock==0)for(De.global||(De.lockOwnerFor=null);0<this._blockedFuncs.length&&!this._locked();){var G=this._blockedFuncs.shift();try{Tc(G[1],G[0])}catch{}}return this},Qs.prototype._locked=function(){return this._reculock&&De.lockOwnerFor!==this},Qs.prototype.create=function(G){var q=this;if(!this.mode)return this;var X=this.db.idbdb,ae=this.db._state.dbOpenError;if(I(!this.idbtrans),!G&&!X)switch(ae&&ae.name){case"DatabaseClosedError":throw new J.DatabaseClosed(ae);case"MissingAPIError":throw new J.MissingAPI(ae.message,ae);default:throw new J.OpenFailed(ae)}if(!this.active)throw new J.TransactionInactive;return I(this._completion._state===null),(G=this.idbtrans=G||(this.db.core||X).transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability})).onerror=Tt(function(ue){Bi(ue),q._reject(G.error)}),G.onabort=Tt(function(ue){Bi(ue),q.active&&q._reject(new J.Abort(G.error)),q.active=!1,q.on("abort").fire(ue)}),G.oncomplete=Tt(function(){q.active=!1,q._resolve(),"mutatedParts"in G&&Cc.storagemutated.fire(G.mutatedParts)}),this},Qs.prototype._promise=function(G,q,X){var ae=this;if(G==="readwrite"&&this.mode!=="readwrite")return An(new J.ReadOnly("Transaction is readonly"));if(!this.active)return An(new J.TransactionInactive);if(this._locked())return new Ie(function(ve,Te){ae._blockedFuncs.push([function(){ae._promise(G,q,X).then(ve,Te)},De])});if(X)return nn(function(){var ve=new Ie(function(Te,Pe){ae._lock();var Be=q(Te,Pe,ae);Be&&Be.then&&Be.then(Te,Pe)});return ve.finally(function(){return ae._unlock()}),ve._lib=!0,ve});var ue=new Ie(function(ve,Te){var Pe=q(ve,Te,ae);Pe&&Pe.then&&Pe.then(ve,Te)});return ue._lib=!0,ue},Qs.prototype._root=function(){return this.parent?this.parent._root():this},Qs.prototype.waitFor=function(G){var q,X=this._root(),ae=Ie.resolve(G);X._waitingFor?X._waitingFor=X._waitingFor.then(function(){return ae}):(X._waitingFor=ae,X._waitingQueue=[],q=X.idbtrans.objectStore(X.storeNames[0]),function ve(){for(++X._spinCount;X._waitingQueue.length;)X._waitingQueue.shift()();X._waitingFor&&(q.get(-1/0).onsuccess=ve)}());var ue=X._waitingFor;return new Ie(function(ve,Te){ae.then(function(Pe){return X._waitingQueue.push(Tt(ve.bind(null,Pe)))},function(Pe){return X._waitingQueue.push(Tt(Te.bind(null,Pe)))}).finally(function(){X._waitingFor===ue&&(X._waitingFor=null)})})},Qs.prototype.abort=function(){this.active&&(this.active=!1,this.idbtrans&&this.idbtrans.abort(),this._reject(new J.Abort))},Qs.prototype.table=function(G){var q=this._memoizedTables||(this._memoizedTables={});if(d(q,G))return q[G];var X=this.schema[G];if(!X)throw new J.NotFound("Table "+G+" not part of transaction");return X=new this.db.Table(G,X,this),X.core=this.db.core.table(G),q[G]=X},Qs);function Qs(){}function Yd(G,q,X,ae,ue,ve,Te){return{name:G,keyPath:q,unique:X,multi:ae,auto:ue,compound:ve,src:(X&&!Te?"&":"")+(ae?"*":"")+(ue?"++":"")+js(q)}}function js(G){return typeof G=="string"?G:G?"["+[].join.call(G,"+")+"]":""}function Kd(G,q,X){return{name:G,primKey:q,indexes:X,mappedClass:null,idxByName:(ae=function(ue){return[ue.name,ue]},X.reduce(function(ue,ve,Te){return Te=ae(ve,Te),Te&&(ue[Te[0]]=Te[1]),ue},{}))};var ae}var yl=function(G){try{return G.only([[]]),yl=function(){return[[]]},[[]]}catch{return yl=function(){return Uc},Uc}};function _a(G){return G==null?function(){}:typeof G=="string"?(q=G).split(".").length===1?function(X){return X[q]}:function(X){return w(X,q)}:function(X){return w(X,G)};var q}function fu(G){return[].slice.call(G)}var ee=0;function ye(G){return G==null?":id":typeof G=="string"?G:"[".concat(G.join("+"),"]")}function _e(G,q,Be){function ae(je){if(je.type===3)return null;if(je.type===4)throw new Error("Cannot convert never type to IDBKeyRange");var Ve=je.lower,He=je.upper,Ye=je.lowerOpen,je=je.upperOpen;return Ve===void 0?He===void 0?null:q.upperBound(He,!!je):He===void 0?q.lowerBound(Ve,!!Ye):q.bound(Ve,He,!!Ye,!!je)}function ue(qe){var Ve,He=qe.name;return{name:He,schema:qe,mutate:function(Ye){var je=Ye.trans,tt=Ye.type,it=Ye.keys,rt=Ye.values,vt=Ye.range;return new Promise(function(kt,Xt){kt=Tt(kt);var jt=je.objectStore(He),Yt=jt.keyPath==null,qt=tt==="put"||tt==="add";if(!qt&&tt!=="delete"&&tt!=="deleteRange")throw new Error("Invalid operation type: "+tt);var Lt,en=(it||rt||{length:1}).length;if(it&&rt&&it.length!==rt.length)throw new Error("Given keys array must have same length as given values array.");if(en===0)return kt({numFailures:0,failures:{},results:[],lastResult:void 0});function In(eo){++zs,Bi(eo)}var Ln=[],Fn=[],zs=0;if(tt==="deleteRange"){if(vt.type===4)return kt({numFailures:zs,failures:Fn,results:[],lastResult:void 0});vt.type===3?Ln.push(Lt=jt.clear()):Ln.push(Lt=jt.delete(ae(vt)))}else{var Yt=qt?Yt?[rt,it]:[rt,null]:[it,null],_n=Yt[0],Ao=Yt[1];if(qt)for(var Es=0;Es<en;++Es)Ln.push(Lt=Ao&&Ao[Es]!==void 0?jt[tt](_n[Es],Ao[Es]):jt[tt](_n[Es])),Lt.onerror=In;else for(Es=0;Es<en;++Es)Ln.push(Lt=jt[tt](_n[Es])),Lt.onerror=In}function f0(eo){eo=eo.target.result,Ln.forEach(function(dd,m0){return dd.error!=null&&(Fn[m0]=dd.error)}),kt({numFailures:zs,failures:Fn,results:tt==="delete"?it:Ln.map(function(dd){return dd.result}),lastResult:eo})}Lt.onerror=function(eo){In(eo),f0(eo)},Lt.onsuccess=f0})},getMany:function(Ye){var je=Ye.trans,tt=Ye.keys;return new Promise(function(it,rt){it=Tt(it);for(var vt,kt=je.objectStore(He),Xt=tt.length,jt=new Array(Xt),Yt=0,qt=0,Lt=function(Ln){Ln=Ln.target,jt[Ln._pos]=Ln.result,++qt===Yt&&it(jt)},en=vl(rt),In=0;In<Xt;++In)tt[In]!=null&&((vt=kt.get(tt[In]))._pos=In,vt.onsuccess=Lt,vt.onerror=en,++Yt);Yt===0&&it(jt)})},get:function(Ye){var je=Ye.trans,tt=Ye.key;return new Promise(function(it,rt){it=Tt(it);var vt=je.objectStore(He).get(tt);vt.onsuccess=function(kt){return it(kt.target.result)},vt.onerror=vl(rt)})},query:(Ve=Le,function(Ye){return new Promise(function(je,tt){je=Tt(je);var it,rt,vt,Yt=Ye.trans,kt=Ye.values,Xt=Ye.limit,Lt=Ye.query,jt=Xt===1/0?void 0:Xt,qt=Lt.index,Lt=Lt.range,Yt=Yt.objectStore(He),qt=qt.isPrimaryKey?Yt:Yt.index(qt.name),Lt=ae(Lt);if(Xt===0)return je({result:[]});Ve?((jt=kt?qt.getAll(Lt,jt):qt.getAllKeys(Lt,jt)).onsuccess=function(en){return je({result:en.target.result})},jt.onerror=vl(tt)):(it=0,rt=!kt&&"openKeyCursor"in qt?qt.openKeyCursor(Lt):qt.openCursor(Lt),vt=[],rt.onsuccess=function(en){var In=rt.result;return In?(vt.push(kt?In.value:In.primaryKey),++it===Xt?je({result:vt}):void In.continue()):je({result:vt})},rt.onerror=vl(tt))})}),openCursor:function(Ye){var je=Ye.trans,tt=Ye.values,it=Ye.query,rt=Ye.reverse,vt=Ye.unique;return new Promise(function(kt,Xt){kt=Tt(kt);var qt=it.index,jt=it.range,Yt=je.objectStore(He),Yt=qt.isPrimaryKey?Yt:Yt.index(qt.name),qt=rt?vt?"prevunique":"prev":vt?"nextunique":"next",Lt=!tt&&"openKeyCursor"in Yt?Yt.openKeyCursor(ae(jt),qt):Yt.openCursor(ae(jt),qt);Lt.onerror=vl(Xt),Lt.onsuccess=Tt(function(en){var In,Ln,Fn,zs,_n=Lt.result;_n?(_n.___id=++ee,_n.done=!1,In=_n.continue.bind(_n),Ln=(Ln=_n.continuePrimaryKey)&&Ln.bind(_n),Fn=_n.advance.bind(_n),zs=function(){throw new Error("Cursor not stopped")},_n.trans=je,_n.stop=_n.continue=_n.continuePrimaryKey=_n.advance=function(){throw new Error("Cursor not started")},_n.fail=Tt(Xt),_n.next=function(){var Ao=this,Es=1;return this.start(function(){return Es--?Ao.continue():Ao.stop()}).then(function(){return Ao})},_n.start=function(Ao){function Es(){if(Lt.result)try{Ao()}catch(eo){_n.fail(eo)}else _n.done=!0,_n.start=function(){throw new Error("Cursor behind last entry")},_n.stop()}var f0=new Promise(function(eo,dd){eo=Tt(eo),Lt.onerror=vl(dd),_n.fail=dd,_n.stop=function(m0){_n.stop=_n.continue=_n.continuePrimaryKey=_n.advance=zs,eo(m0)}});return Lt.onsuccess=Tt(function(eo){Lt.onsuccess=Es,Es()}),_n.continue=In,_n.continuePrimaryKey=Ln,_n.advance=Fn,Es(),f0},kt(_n)):kt(null)},Xt)})},count:function(Ye){var je=Ye.query,tt=Ye.trans,it=je.index,rt=je.range;return new Promise(function(vt,kt){var Xt=tt.objectStore(He),jt=it.isPrimaryKey?Xt:Xt.index(it.name),Xt=ae(rt),jt=Xt?jt.count(Xt):jt.count();jt.onsuccess=Tt(function(Yt){return vt(Yt.target.result)}),jt.onerror=vl(kt)})}}}var ve,Te,Pe,We=(Te=Be,Pe=fu((ve=G).objectStoreNames),{schema:{name:ve.name,tables:Pe.map(function(qe){return Te.objectStore(qe)}).map(function(qe){var Ve=qe.keyPath,je=qe.autoIncrement,He=o(Ve),Ye={},je={name:qe.name,primaryKey:{name:null,isPrimaryKey:!0,outbound:Ve==null,compound:He,keyPath:Ve,autoIncrement:je,unique:!0,extractKey:_a(Ve)},indexes:fu(qe.indexNames).map(function(tt){return qe.index(tt)}).map(function(vt){var it=vt.name,rt=vt.unique,kt=vt.multiEntry,vt=vt.keyPath,kt={name:it,compound:o(vt),keyPath:vt,unique:rt,multiEntry:kt,extractKey:_a(vt)};return Ye[ye(vt)]=kt}),getIndexByKeyPath:function(tt){return Ye[ye(tt)]}};return Ye[":id"]=je.primaryKey,Ve!=null&&(Ye[ye(Ve)]=je.primaryKey),je})},hasGetAll:0<Pe.length&&"getAll"in Te.objectStore(Pe[0])&&!(typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604)}),Be=We.schema,Le=We.hasGetAll,We=Be.tables.map(ue),xe={};return We.forEach(function(qe){return xe[qe.name]=qe}),{stack:"dbcore",transaction:G.transaction.bind(G),table:function(qe){if(!xe[qe])throw new Error("Table '".concat(qe,"' not found"));return xe[qe]},MIN_KEY:-1/0,MAX_KEY:yl(q),schema:Be}}function ft(G,q,X,ae){var ue=X.IDBKeyRange;return X.indexedDB,{dbcore:(ae=_e(q,ue,ae),G.dbcore.reduce(function(ve,Te){return Te=Te.create,n(n({},ve),Te(ve))},ae))}}function Wi(G,ae){var X=ae.db,ae=ft(G._middlewares,X,G._deps,ae);G.core=ae.dbcore,G.tables.forEach(function(ue){var ve=ue.name;G.core.schema.tables.some(function(Te){return Te.name===ve})&&(ue.core=G.core.table(ve),G[ve]instanceof G.Table&&(G[ve].core=ue.core))})}function bi(G,q,X,ae){X.forEach(function(ue){var ve=ae[ue];q.forEach(function(Te){var Pe=function Be(Le,We){return g(Le,We)||(Le=c(Le))&&Be(Le,We)}(Te,ue);(!Pe||"value"in Pe&&Pe.value===void 0)&&(Te===G.Transaction.prototype||Te instanceof G.Transaction?f(Te,ue,{get:function(){return this.table(ue)},set:function(Be){h(this,ue,{value:Be,writable:!0,configurable:!0,enumerable:!0})}}):Te[ue]=new G.Table(ue,ve))})})}function Wn(G,q){q.forEach(function(X){for(var ae in X)X[ae]instanceof G.Table&&delete X[ae]})}function li(G,q){return G._cfg.version-q._cfg.version}function Qa(G,q,X,ae){var ue=G._dbSchema;X.objectStoreNames.contains("$meta")&&!ue.$meta&&(ue.$meta=Kd("$meta",mu("")[0],[]),G._storeNames.push("$meta"));var ve=G._createTransaction("readwrite",G._storeNames,ue);ve.create(X),ve._completion.catch(ae);var Te=ve._reject.bind(ve),Pe=De.transless||De;nn(function(){return De.trans=ve,De.transless=Pe,q!==0?(Wi(G,X),Le=q,((Be=ve).storeNames.includes("$meta")?Be.table("$meta").get("version").then(function(We){return We??Le}):Ie.resolve(Le)).then(function(We){return qe=We,Ve=ve,He=X,Ye=[],We=(xe=G)._versions,je=xe._dbSchema=ts(0,xe.idbdb,He),(We=We.filter(function(tt){return tt._cfg.version>=qe})).length!==0?(We.forEach(function(tt){Ye.push(function(){var it=je,rt=tt._cfg.dbschema;zl(xe,it,He),zl(xe,rt,He),je=xe._dbSchema=rt;var vt=wa(it,rt);vt.add.forEach(function(qt){Gs(He,qt[0],qt[1].primKey,qt[1].indexes)}),vt.change.forEach(function(qt){if(qt.recreate)throw new J.Upgrade("Not yet support for changing primary key");var Lt=He.objectStore(qt.name);qt.add.forEach(function(en){return ka(Lt,en)}),qt.change.forEach(function(en){Lt.deleteIndex(en.name),ka(Lt,en)}),qt.del.forEach(function(en){return Lt.deleteIndex(en)})});var kt=tt._cfg.contentUpgrade;if(kt&&tt._cfg.version>qe){Wi(xe,He),Ve._memoizedTables={};var Xt=U(rt);vt.del.forEach(function(qt){Xt[qt]=it[qt]}),Wn(xe,[xe.Transaction.prototype]),bi(xe,[xe.Transaction.prototype],s(Xt),Xt),Ve.schema=Xt;var jt,Yt=V(kt);return Yt&&tr(),vt=Ie.follow(function(){var qt;(jt=kt(Ve))&&Yt&&(qt=lr.bind(null,null),jt.then(qt,qt))}),jt&&typeof jt.then=="function"?Ie.resolve(jt):vt.then(function(){return jt})}}),Ye.push(function(it){var rt,vt,kt=tt._cfg.dbschema;rt=kt,vt=it,[].slice.call(vt.db.objectStoreNames).forEach(function(Xt){return rt[Xt]==null&&vt.db.deleteObjectStore(Xt)}),Wn(xe,[xe.Transaction.prototype]),bi(xe,[xe.Transaction.prototype],xe._storeNames,xe._dbSchema),Ve.schema=xe._dbSchema}),Ye.push(function(it){xe.idbdb.objectStoreNames.contains("$meta")&&(Math.ceil(xe.idbdb.version/10)===tt._cfg.version?(xe.idbdb.deleteObjectStore("$meta"),delete xe._dbSchema.$meta,xe._storeNames=xe._storeNames.filter(function(rt){return rt!=="$meta"})):it.objectStore("$meta").put(tt._cfg.version,"version"))})}),function tt(){return Ye.length?Ie.resolve(Ye.shift()(Ve.idbtrans)).then(tt):Ie.resolve()}().then(function(){es(je,He)})):Ie.resolve();var xe,qe,Ve,He,Ye,je}).catch(Te)):(s(ue).forEach(function(We){Gs(X,We,ue[We].primKey,ue[We].indexes)}),Wi(G,X),void Ie.follow(function(){return G.on.populate.fire(ve)}).catch(Te));var Be,Le})}function Un(G,q){es(G._dbSchema,q),q.db.version%10!=0||q.objectStoreNames.contains("$meta")||q.db.createObjectStore("$meta").add(Math.ceil(q.db.version/10-1),"version");var X=ts(0,G.idbdb,q);zl(G,G._dbSchema,q);for(var ae=0,ue=wa(X,G._dbSchema).change;ae<ue.length;ae++){var ve=function(Te){if(Te.change.length||Te.recreate)return console.warn("Unable to patch indexes of table ".concat(Te.name," because it has changes on the type of index or primary key.")),{value:void 0};var Pe=q.objectStore(Te.name);Te.add.forEach(function(Be){ze&&console.debug("Dexie upgrade patch: Creating missing index ".concat(Te.name,".").concat(Be.src)),ka(Pe,Be)})}(ue[ae]);if(typeof ve=="object")return ve.value}}function wa(G,q){var X,ae={del:[],add:[],change:[]};for(X in G)q[X]||ae.del.push(X);for(X in q){var ue=G[X],ve=q[X];if(ue){var Te={name:X,def:ve,recreate:!1,del:[],add:[],change:[]};if(""+(ue.primKey.keyPath||"")!=""+(ve.primKey.keyPath||"")||ue.primKey.auto!==ve.primKey.auto)Te.recreate=!0,ae.change.push(Te);else{var Pe=ue.idxByName,Be=ve.idxByName,Le=void 0;for(Le in Pe)Be[Le]||Te.del.push(Le);for(Le in Be){var We=Pe[Le],xe=Be[Le];We?We.src!==xe.src&&Te.change.push(xe):Te.add.push(xe)}(0<Te.del.length||0<Te.add.length||0<Te.change.length)&&ae.change.push(Te)}}else ae.add.push([X,ve])}return ae}function Gs(G,q,X,ae){var ue=G.db.createObjectStore(q,X.keyPath?{keyPath:X.keyPath,autoIncrement:X.auto}:{autoIncrement:X.auto});return ae.forEach(function(ve){return ka(ue,ve)}),ue}function es(G,q){s(G).forEach(function(X){q.db.objectStoreNames.contains(X)||(ze&&console.debug("Dexie: Creating missing table",X),Gs(q,X,G[X].primKey,G[X].indexes))})}function ka(G,q){G.createIndex(q.name,q.keyPath,{unique:q.unique,multiEntry:q.multi})}function ts(G,q,X){var ae={};return y(q.objectStoreNames,0).forEach(function(ue){for(var ve=X.objectStore(ue),Te=Yd(js(Le=ve.keyPath),Le||"",!0,!1,!!ve.autoIncrement,Le&&typeof Le!="string",!0),Pe=[],Be=0;Be<ve.indexNames.length;++Be){var We=ve.index(ve.indexNames[Be]),Le=We.keyPath,We=Yd(We.name,Le,!!We.unique,!!We.multiEntry,!1,Le&&typeof Le!="string",!1);Pe.push(We)}ae[ue]=Kd(ue,Te,Pe)}),ae}function zl(G,q,X){for(var ae=X.db.objectStoreNames,ue=0;ue<ae.length;++ue){var ve=ae[ue],Te=X.objectStore(ve);G._hasGetAll="getAll"in Te;for(var Pe=0;Pe<Te.indexNames.length;++Pe){var Be=Te.indexNames[Pe],Le=Te.index(Be).keyPath,We=typeof Le=="string"?Le:"["+y(Le).join("+")+"]";!q[ve]||(Le=q[ve].idxByName[We])&&(Le.name=Be,delete q[ve].idxByName[We],q[ve].idxByName[Be]=Le)}}typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&a.WorkerGlobalScope&&a instanceof a.WorkerGlobalScope&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604&&(G._hasGetAll=!1)}function mu(G){return G.split(",").map(function(q,X){var ae=(q=q.trim()).replace(/([&*]|\+\+)/g,""),ue=/^\[/.test(ae)?ae.match(/^\[(.*)\]$/)[1].split("+"):ae;return Yd(ae,ue||null,/\&/.test(q),/\*/.test(q),/\+\+/.test(q),o(ue),X===0)})}var eh=(th.prototype._parseStoresSpec=function(G,q){s(G).forEach(function(X){if(G[X]!==null){var ae=mu(G[X]),ue=ae.shift();if(ue.unique=!0,ue.multi)throw new J.Schema("Primary key cannot be multi-valued");ae.forEach(function(ve){if(ve.auto)throw new J.Schema("Only primary key can be marked as autoIncrement (++)");if(!ve.keyPath)throw new J.Schema("Index must have a name and cannot be an empty string")}),q[X]=Kd(X,ue,ae)}})},th.prototype.stores=function(X){var q=this.db;this._cfg.storesSource=this._cfg.storesSource?l(this._cfg.storesSource,X):X;var X=q._versions,ae={},ue={};return X.forEach(function(ve){l(ae,ve._cfg.storesSource),ue=ve._cfg.dbschema={},ve._parseStoresSpec(ae,ue)}),q._dbSchema=ue,Wn(q,[q._allTables,q,q.Transaction.prototype]),bi(q,[q._allTables,q,q.Transaction.prototype,this._cfg.tables],s(ue),ue),q._storeNames=s(ue),this},th.prototype.upgrade=function(G){return this._cfg.contentUpgrade=we(this._cfg.contentUpgrade||ce,G),this},th);function th(){}function ff(G,q){var X=G._dbNamesDB;return X||(X=G._dbNamesDB=new Xd(fl,{addons:[],indexedDB:G,IDBKeyRange:q})).version(1).stores({dbnames:"name"}),X.table("dbnames")}function No(G){return G&&typeof G.databases=="function"}function m1(G){return nn(function(){return De.letThrough=!0,G()})}function r0(G){return!("from"in G)}var is=function(G,q){if(!this){var X=new is;return G&&"d"in G&&l(X,G),X}l(this,arguments.length?{d:1,from:G,to:1<arguments.length?q:G}:{d:0})};function cv(G,q,X){var ae=nt(q,X);if(!isNaN(ae)){if(0<ae)throw RangeError();if(r0(G))return l(G,{from:q,to:X,d:1});var ue=G.l,ae=G.r;if(nt(X,G.from)<0)return ue?cv(ue,q,X):G.l={from:q,to:X,d:1,l:null,r:null},g1(G);if(0<nt(q,G.to))return ae?cv(ae,q,X):G.r={from:q,to:X,d:1,l:null,r:null},g1(G);nt(q,G.from)<0&&(G.from=q,G.l=null,G.d=ae?ae.d+1:1),0<nt(X,G.to)&&(G.to=X,G.r=null,G.d=G.l?G.l.d+1:1),X=!G.r,ue&&!G.l&&uv(G,ue),ae&&X&&uv(G,ae)}}function uv(G,q){r0(q)||function X(ae,Be){var ve=Be.from,Te=Be.to,Pe=Be.l,Be=Be.r;cv(ae,ve,Te),Pe&&X(ae,Pe),Be&&X(ae,Be)}(G,q)}function a0(G,q){var X=s0(q),ae=X.next();if(ae.done)return!1;for(var ue=ae.value,ve=s0(G),Te=ve.next(ue.from),Pe=Te.value;!ae.done&&!Te.done;){if(nt(Pe.from,ue.to)<=0&&0<=nt(Pe.to,ue.from))return!0;nt(ue.from,Pe.from)<0?ue=(ae=X.next(Pe.from)).value:Pe=(Te=ve.next(ue.from)).value}return!1}function s0(G){var q=r0(G)?null:{s:0,n:G};return{next:function(X){for(var ae=0<arguments.length;q;)switch(q.s){case 0:if(q.s=1,ae)for(;q.n.l&&nt(X,q.n.from)<0;)q={up:q,n:q.n.l,s:1};else for(;q.n.l;)q={up:q,n:q.n.l,s:1};case 1:if(q.s=2,!ae||nt(X,q.n.to)<=0)return{value:q.n,done:!1};case 2:if(q.n.r){q.s=3,q={up:q,n:q.n.r,s:0};continue}case 3:q=q.up}return{done:!0}}}}function g1(G){var q,X,ae=(((q=G.r)===null||q===void 0?void 0:q.d)||0)-(((X=G.l)===null||X===void 0?void 0:X.d)||0),ue=1<ae?"r":ae<-1?"l":"";ue&&(q=ue=="r"?"l":"r",X=n({},G),ae=G[ue],G.from=ae.from,G.to=ae.to,G[ue]=ae[ue],X[ue]=ae[q],(G[q]=X).d=v1(X)),G.d=v1(G)}function v1(X){var q=X.r,X=X.l;return(q?X?Math.max(q.d,X.d):q.d:X?X.d:0)+1}function o0(G,q){return s(q).forEach(function(X){G[X]?uv(G[X],q[X]):G[X]=function ae(ue){var ve,Te,Pe={};for(ve in ue)d(ue,ve)&&(Te=ue[ve],Pe[ve]=!Te||typeof Te!="object"||R.has(Te.constructor)?Te:ae(Te));return Pe}(q[X])}),G}function y1(G,q){return G.all||q.all||Object.keys(G).some(function(X){return q[X]&&a0(q[X],G[X])})}p(is.prototype,((Hs={add:function(G){return uv(this,G),this},addKey:function(G){return cv(this,G,G),this},addKeys:function(G){var q=this;return G.forEach(function(X){return cv(q,X,X)}),this},hasKey:function(G){var q=s0(this).next(G).value;return q&&nt(q.from,G)<=0&&0<=nt(q.to,G)}})[N]=function(){return s0(this)},Hs));var ih={},b1={},l0=!1;function db(G){o0(b1,G),l0||(l0=!0,setTimeout(function(){l0=!1,dv(b1,!(b1={}))},0))}function dv(G,q){q===void 0&&(q=!1);var X=new Set;if(G.all)for(var ae=0,ue=Object.values(ih);ae<ue.length;ae++)mf(Te=ue[ae],G,X,q);else for(var ve in G){var Te,Pe=/^idb\:\/\/(.*)\/(.*)\//.exec(ve);Pe&&(ve=Pe[1],Pe=Pe[2],(Te=ih["idb://".concat(ve,"/").concat(Pe)])&&mf(Te,G,X,q))}X.forEach(function(Be){return Be()})}function mf(G,q,X,ae){for(var ue=[],ve=0,Te=Object.entries(G.queries.query);ve<Te.length;ve++){for(var Pe=Te[ve],Be=Pe[0],Le=[],We=0,xe=Pe[1];We<xe.length;We++){var qe=xe[We];y1(q,qe.obsSet)?qe.subscribers.forEach(function(je){return X.add(je)}):ae&&Le.push(qe)}ae&&ue.push([Be,Le])}if(ae)for(var Ve=0,He=ue;Ve<He.length;Ve++){var Ye=He[Ve],Be=Ye[0],Le=Ye[1];G.queries.query[Be]=Le}}function s$(G){var q=G._state,X=G._deps.indexedDB;if(q.isBeingOpened||G.idbdb)return q.dbReadyPromise.then(function(){return q.dbOpenError?An(q.dbOpenError):G});q.isBeingOpened=!0,q.dbOpenError=null,q.openComplete=!1;var ae=q.openCanceller,ue=Math.round(10*G.verno),ve=!1;function Te(){if(q.openCanceller!==ae)throw new J.DatabaseClosed("db.open() was cancelled")}function Pe(){return new Ie(function(qe,Ve){if(Te(),!X)throw new J.MissingAPI;var He=G.name,Ye=q.autoSchema||!ue?X.open(He):X.open(He,ue);if(!Ye)throw new J.MissingAPI;Ye.onerror=vl(Ve),Ye.onblocked=Tt(G._fireOnBlocked),Ye.onupgradeneeded=Tt(function(je){var tt;We=Ye.transaction,q.autoSchema&&!G._options.allowEmptyDB?(Ye.onerror=Bi,We.abort(),Ye.result.close(),(tt=X.deleteDatabase(He)).onsuccess=tt.onerror=Tt(function(){Ve(new J.NoSuchDatabase("Database ".concat(He," doesnt exist")))})):(We.onerror=vl(Ve),je=je.oldVersion>Math.pow(2,62)?0:je.oldVersion,xe=je<1,G.idbdb=Ye.result,ve&&Un(G,We),Qa(G,je/10,We,Ve))},Ve),Ye.onsuccess=Tt(function(){We=null;var je,tt,it,rt,vt,kt=G.idbdb=Ye.result,Xt=y(kt.objectStoreNames);if(0<Xt.length)try{var jt=kt.transaction((rt=Xt).length===1?rt[0]:rt,"readonly");if(q.autoSchema)tt=kt,it=jt,(je=G).verno=tt.version/10,it=je._dbSchema=ts(0,tt,it),je._storeNames=y(tt.objectStoreNames,0),bi(je,[je._allTables],s(it),it);else if(zl(G,G._dbSchema,jt),((vt=wa(ts(0,(vt=G).idbdb,jt),vt._dbSchema)).add.length||vt.change.some(function(Yt){return Yt.add.length||Yt.change.length}))&&!ve)return console.warn("Dexie SchemaDiff: Schema was extended without increasing the number passed to db.version(). Dexie will add missing parts and increment native version number to workaround this."),kt.close(),ue=kt.version+1,ve=!0,qe(Pe());Wi(G,jt)}catch{}hu.push(G),kt.onversionchange=Tt(function(Yt){q.vcFired=!0,G.on("versionchange").fire(Yt)}),kt.onclose=Tt(function(Yt){G.on("close").fire(Yt)}),xe&&(vt=G._deps,jt=He,kt=vt.indexedDB,vt=vt.IDBKeyRange,No(kt)||jt===fl||ff(kt,vt).put({name:jt}).catch(ce)),qe()},Ve)}).catch(function(qe){switch(qe==null?void 0:qe.name){case"UnknownError":if(0<q.PR1398_maxLoop)return q.PR1398_maxLoop--,console.warn("Dexie: Workaround for Chrome UnknownError on open()"),Pe();break;case"VersionError":if(0<ue)return ue=0,Pe()}return Ie.reject(qe)})}var Be,Le=q.dbReadyResolve,We=null,xe=!1;return Ie.race([ae,(typeof navigator>"u"?Ie.resolve():!navigator.userAgentData&&/Safari\//.test(navigator.userAgent)&&!/Chrom(e|ium)\//.test(navigator.userAgent)&&indexedDB.databases?new Promise(function(qe){function Ve(){return indexedDB.databases().finally(qe)}Be=setInterval(Ve,100),Ve()}).finally(function(){return clearInterval(Be)}):Promise.resolve()).then(Pe)]).then(function(){return Te(),q.onReadyBeingFired=[],Ie.resolve(m1(function(){return G.on.ready.fire(G.vip)})).then(function qe(){if(0<q.onReadyBeingFired.length){var Ve=q.onReadyBeingFired.reduce(we,ce);return q.onReadyBeingFired=[],Ie.resolve(m1(function(){return Ve(G.vip)})).then(qe)}})}).finally(function(){q.openCanceller===ae&&(q.onReadyBeingFired=null,q.isBeingOpened=!1)}).catch(function(qe){q.dbOpenError=qe;try{We&&We.abort()}catch{}return ae===q.openCanceller&&G._close(),An(qe)}).finally(function(){q.openComplete=!0,Le()}).then(function(){var qe;return xe&&(qe={},G.tables.forEach(function(Ve){Ve.schema.indexes.forEach(function(He){He.name&&(qe["idb://".concat(G.name,"/").concat(Ve.name,"/").concat(He.name)]=new is(-1/0,[[[]]]))}),qe["idb://".concat(G.name,"/").concat(Ve.name,"/")]=qe["idb://".concat(G.name,"/").concat(Ve.name,"/:dels")]=new is(-1/0,[[[]]])}),Cc(Ds).fire(qe),dv(qe,!0)),G})}function Fm(G){function q(ve){return G.next(ve)}var X=ue(q),ae=ue(function(ve){return G.throw(ve)});function ue(ve){return function(Be){var Pe=ve(Be),Be=Pe.value;return Pe.done?Be:Be&&typeof Be.then=="function"?Be.then(X,ae):o(Be)?Promise.all(Be).then(X,ae):X(Be)}}return ue(q)()}function bl(G,q,X){for(var ae=o(G)?G.slice():[G],ue=0;ue<X;++ue)ae.push(q);return ae}var kM={stack:"dbcore",name:"VirtualIndexMiddleware",level:1,create:function(G){return n(n({},G),{table:function(q){var X=G.table(q),ae=X.schema,ue={},ve=[];function Te(xe,qe,Ve){var He=ye(xe),Ye=ue[He]=ue[He]||[],je=xe==null?0:typeof xe=="string"?1:xe.length,tt=0<qe,tt=n(n({},Ve),{name:tt?"".concat(He,"(virtual-from:").concat(Ve.name,")"):Ve.name,lowLevelIndex:Ve,isVirtual:tt,keyTail:qe,keyLength:je,extractKey:_a(xe),unique:!tt&&Ve.unique});return Ye.push(tt),tt.isPrimaryKey||ve.push(tt),1<je&&Te(je===2?xe[0]:xe.slice(0,je-1),qe+1,Ve),Ye.sort(function(it,rt){return it.keyTail-rt.keyTail}),tt}q=Te(ae.primaryKey.keyPath,0,ae.primaryKey),ue[":id"]=[q];for(var Pe=0,Be=ae.indexes;Pe<Be.length;Pe++){var Le=Be[Pe];Te(Le.keyPath,0,Le)}function We(xe){var qe,Ve=xe.query.index;return Ve.isVirtual?n(n({},xe),{query:{index:Ve.lowLevelIndex,range:(qe=xe.query.range,Ve=Ve.keyTail,{type:qe.type===1?2:qe.type,lower:bl(qe.lower,qe.lowerOpen?G.MAX_KEY:G.MIN_KEY,Ve),lowerOpen:!0,upper:bl(qe.upper,qe.upperOpen?G.MIN_KEY:G.MAX_KEY,Ve),upperOpen:!0})}}):xe}return n(n({},X),{schema:n(n({},ae),{primaryKey:q,indexes:ve,getIndexByKeyPath:function(xe){return(xe=ue[ye(xe)])&&xe[0]}}),count:function(xe){return X.count(We(xe))},query:function(xe){return X.query(We(xe))},openCursor:function(xe){var qe=xe.query.index,Ve=qe.keyTail,He=qe.isVirtual,Ye=qe.keyLength;return He?X.openCursor(We(xe)).then(function(tt){return tt&&je(tt)}):X.openCursor(xe);function je(tt){return Object.create(tt,{continue:{value:function(it){it!=null?tt.continue(bl(it,xe.reverse?G.MAX_KEY:G.MIN_KEY,Ve)):xe.unique?tt.continue(tt.key.slice(0,Ye).concat(xe.reverse?G.MIN_KEY:G.MAX_KEY,Ve)):tt.continue()}},continuePrimaryKey:{value:function(it,rt){tt.continuePrimaryKey(bl(it,G.MAX_KEY,Ve),rt)}},primaryKey:{get:function(){return tt.primaryKey}},key:{get:function(){var it=tt.key;return Ye===1?it[0]:it.slice(0,Ye)}},value:{get:function(){return tt.value}}})}}})}})}};function c0(G,q,X,ae){return X=X||{},ae=ae||"",s(G).forEach(function(ue){var ve,Te,Pe;d(q,ue)?(ve=G[ue],Te=q[ue],typeof ve=="object"&&typeof Te=="object"&&ve&&Te?(Pe=A(ve))!==A(Te)?X[ae+ue]=q[ue]:Pe==="Object"?c0(ve,Te,X,ae+ue+"."):ve!==Te&&(X[ae+ue]=q[ue]):ve!==Te&&(X[ae+ue]=q[ue])):X[ae+ue]=void 0}),s(q).forEach(function(ue){d(G,ue)||(X[ae+ue]=q[ue])}),X}function I1(G,q){return q.type==="delete"?q.keys:q.keys||q.values.map(G.extractKey)}var w1={stack:"dbcore",name:"HooksMiddleware",level:2,create:function(G){return n(n({},G),{table:function(q){var X=G.table(q),ae=X.schema.primaryKey;return n(n({},X),{mutate:function(ue){var ve=De.trans,Te=ve.table(q).hook,Pe=Te.deleting,Be=Te.creating,Le=Te.updating;switch(ue.type){case"add":if(Be.fire===ce)break;return ve._promise("readwrite",function(){return We(ue)},!0);case"put":if(Be.fire===ce&&Le.fire===ce)break;return ve._promise("readwrite",function(){return We(ue)},!0);case"delete":if(Pe.fire===ce)break;return ve._promise("readwrite",function(){return We(ue)},!0);case"deleteRange":if(Pe.fire===ce)break;return ve._promise("readwrite",function(){return function xe(qe,Ve,He){return X.query({trans:qe,values:!1,query:{index:ae,range:Ve},limit:He}).then(function(Ye){var je=Ye.result;return We({type:"delete",keys:je,trans:qe}).then(function(tt){return 0<tt.numFailures?Promise.reject(tt.failures[0]):je.length<He?{failures:[],numFailures:0,lastResult:void 0}:xe(qe,n(n({},Ve),{lower:je[je.length-1],lowerOpen:!0}),He)})})}(ue.trans,ue.range,1e4)},!0)}return X.mutate(ue);function We(xe){var qe,Ve,He,Ye=De.trans,je=xe.keys||I1(ae,xe);if(!je)throw new Error("Keys missing");return(xe=xe.type==="add"||xe.type==="put"?n(n({},xe),{keys:je}):n({},xe)).type!=="delete"&&(xe.values=r([],xe.values)),xe.keys&&(xe.keys=r([],xe.keys)),qe=X,He=je,((Ve=xe).type==="add"?Promise.resolve([]):qe.getMany({trans:Ve.trans,keys:He,cache:"immutable"})).then(function(tt){var it=je.map(function(rt,vt){var kt,Xt,jt,Yt=tt[vt],qt={onerror:null,onsuccess:null};return xe.type==="delete"?Pe.fire.call(qt,rt,Yt,Ye):xe.type==="add"||Yt===void 0?(kt=Be.fire.call(qt,rt,xe.values[vt],Ye),rt==null&&kt!=null&&(xe.keys[vt]=rt=kt,ae.outbound||S(xe.values[vt],ae.keyPath,rt))):(kt=c0(Yt,xe.values[vt]),(Xt=Le.fire.call(qt,kt,rt,Yt,Ye))&&(jt=xe.values[vt],Object.keys(Xt).forEach(function(Lt){d(jt,Lt)?jt[Lt]=Xt[Lt]:S(jt,Lt,Xt[Lt])}))),qt});return X.mutate(xe).then(function(rt){for(var vt=rt.failures,kt=rt.results,Xt=rt.numFailures,rt=rt.lastResult,jt=0;jt<je.length;++jt){var Yt=(kt||je)[jt],qt=it[jt];Yt==null?qt.onerror&&qt.onerror(vt[jt]):qt.onsuccess&&qt.onsuccess(xe.type==="put"&&tt[jt]?xe.values[jt]:Yt)}return{failures:vt,results:kt,numFailures:Xt,lastResult:rt}}).catch(function(rt){return it.forEach(function(vt){return vt.onerror&&vt.onerror(rt)}),Promise.reject(rt)})})}}})}})}};function u0(G,q,X){try{if(!q||q.keys.length<G.length)return null;for(var ae=[],ue=0,ve=0;ue<q.keys.length&&ve<G.length;++ue)nt(q.keys[ue],G[ve])===0&&(ae.push(X?M(q.values[ue]):q.values[ue]),++ve);return ae.length===G.length?ae:null}catch{return null}}var o$={stack:"dbcore",level:-1,create:function(G){return{table:function(q){var X=G.table(q);return n(n({},X),{getMany:function(ae){if(!ae.cache)return X.getMany(ae);var ue=u0(ae.keys,ae.trans._cache,ae.cache==="clone");return ue?Ie.resolve(ue):X.getMany(ae).then(function(ve){return ae.trans._cache={keys:ae.keys,values:ae.cache==="clone"?M(ve):ve},ve})},mutate:function(ae){return ae.type!=="add"&&(ae.trans._cache=null),X.mutate(ae)}})}}}};function xM(G,q){return G.trans.mode==="readonly"&&!!G.subscr&&!G.trans.explicit&&G.trans.db._options.cache!=="disabled"&&!q.schema.primaryKey.outbound}function S1(G,q){switch(G){case"query":return q.values&&!q.unique;case"get":case"getMany":case"count":case"openCursor":return!1}}var l$={stack:"dbcore",level:0,name:"Observability",create:function(G){var q=G.schema.name,X=new is(G.MIN_KEY,G.MAX_KEY);return n(n({},G),{transaction:function(ae,ue,ve){if(De.subscr&&ue!=="readonly")throw new J.ReadOnly("Readwrite transaction in liveQuery context. Querier source: ".concat(De.querier));return G.transaction(ae,ue,ve)},table:function(ae){var ue=G.table(ae),ve=ue.schema,Te=ve.primaryKey,xe=ve.indexes,Pe=Te.extractKey,Be=Te.outbound,Le=Te.autoIncrement&&xe.filter(function(Ve){return Ve.compound&&Ve.keyPath.includes(Te.keyPath)}),We=n(n({},ue),{mutate:function(Ve){function He(Lt){return Lt="idb://".concat(q,"/").concat(ae,"/").concat(Lt),rt[Lt]||(rt[Lt]=new is)}var Ye,je,tt,it=Ve.trans,rt=Ve.mutatedParts||(Ve.mutatedParts={}),vt=He(""),kt=He(":dels"),Xt=Ve.type,qt=Ve.type==="deleteRange"?[Ve.range]:Ve.type==="delete"?[Ve.keys]:Ve.values.length<50?[I1(Te,Ve).filter(function(Lt){return Lt}),Ve.values]:[],jt=qt[0],Yt=qt[1],qt=Ve.trans._cache;return o(jt)?(vt.addKeys(jt),(qt=Xt==="delete"||jt.length===Yt.length?u0(jt,qt):null)||kt.addKeys(jt),(qt||Yt)&&(Ye=He,je=qt,tt=Yt,ve.indexes.forEach(function(Lt){var en=Ye(Lt.name||"");function In(Fn){return Fn!=null?Lt.extractKey(Fn):null}function Ln(Fn){return Lt.multiEntry&&o(Fn)?Fn.forEach(function(zs){return en.addKey(zs)}):en.addKey(Fn)}(je||tt).forEach(function(Fn,Ao){var _n=je&&In(je[Ao]),Ao=tt&&In(tt[Ao]);nt(_n,Ao)!==0&&(_n!=null&&Ln(_n),Ao!=null&&Ln(Ao))})}))):jt?(Yt={from:jt.lower,to:jt.upper},kt.add(Yt),vt.add(Yt)):(vt.add(X),kt.add(X),ve.indexes.forEach(function(Lt){return He(Lt.name).add(X)})),ue.mutate(Ve).then(function(Lt){return!jt||Ve.type!=="add"&&Ve.type!=="put"||(vt.addKeys(Lt.results),Le&&Le.forEach(function(en){var In=Ve.values.map(function(Fn){return en.extractKey(Fn)}),Ln=en.keyPath.findIndex(function(Fn){return Fn===Te.keyPath});Lt.results.forEach(function(Fn){return In[Ln]=Fn}),He(en.name).addKeys(In)})),it.mutatedParts=o0(it.mutatedParts||{},rt),Lt})}}),xe=function(He){var Ye=He.query,He=Ye.index,Ye=Ye.range;return[He,new is((He=Ye.lower)!==null&&He!==void 0?He:G.MIN_KEY,(Ye=Ye.upper)!==null&&Ye!==void 0?Ye:G.MAX_KEY)]},qe={get:function(Ve){return[Te,new is(Ve.key)]},getMany:function(Ve){return[Te,new is().addKeys(Ve.keys)]},count:xe,query:xe,openCursor:xe};return s(qe).forEach(function(Ve){We[Ve]=function(He){var Ye=De.subscr,je=!!Ye,tt=xM(De,ue)&&S1(Ve,He)?He.obsSet={}:Ye;if(je){var it=function(Yt){return Yt="idb://".concat(q,"/").concat(ae,"/").concat(Yt),tt[Yt]||(tt[Yt]=new is)},rt=it(""),vt=it(":dels"),Ye=qe[Ve](He),je=Ye[0],Ye=Ye[1];if((Ve==="query"&&je.isPrimaryKey&&!He.values?vt:it(je.name||"")).add(Ye),!je.isPrimaryKey){if(Ve!=="count"){var kt=Ve==="query"&&Be&&He.values&&ue.query(n(n({},He),{values:!1}));return ue[Ve].apply(this,arguments).then(function(Yt){if(Ve==="query"){if(Be&&He.values)return kt.then(function(In){return In=In.result,rt.addKeys(In),Yt});var qt=He.values?Yt.result.map(Pe):Yt.result;(He.values?rt:vt).addKeys(qt)}else if(Ve==="openCursor"){var Lt=Yt,en=He.values;return Lt&&Object.create(Lt,{key:{get:function(){return vt.addKey(Lt.primaryKey),Lt.key}},primaryKey:{get:function(){var In=Lt.primaryKey;return vt.addKey(In),In}},value:{get:function(){return en&&rt.addKey(Lt.primaryKey),Lt.value}}})}return Yt})}vt.add(X)}}return ue[Ve].apply(this,arguments)}}),We}})}};function gu(G,q,X){if(X.numFailures===0)return q;if(q.type==="deleteRange")return null;var ae=q.keys?q.keys.length:"values"in q&&q.values?q.values.length:1;return X.numFailures===ae?null:(q=n({},q),o(q.keys)&&(q.keys=q.keys.filter(function(ue,ve){return!(ve in X.failures)})),"values"in q&&o(q.values)&&(q.values=q.values.filter(function(ue,ve){return!(ve in X.failures)})),q)}function gf(G,q){return X=G,((ae=q).lower===void 0||(ae.lowerOpen?0<nt(X,ae.lower):0<=nt(X,ae.lower)))&&(G=G,(q=q).upper===void 0||(q.upperOpen?nt(G,q.upper)<0:nt(G,q.upper)<=0));var X,ae}function OM(G,q,qe,ae,ue,ve){if(!qe||qe.length===0)return G;var Te=q.query.index,Pe=Te.multiEntry,Be=q.query.range,Le=ae.schema.primaryKey.extractKey,We=Te.extractKey,xe=(Te.lowLevelIndex||Te).extractKey,qe=qe.reduce(function(Ve,He){var Ye=Ve,je=[];if(He.type==="add"||He.type==="put")for(var tt=new is,it=He.values.length-1;0<=it;--it){var rt,vt=He.values[it],kt=Le(vt);tt.hasKey(kt)||(rt=We(vt),(Pe&&o(rt)?rt.some(function(qt){return gf(qt,Be)}):gf(rt,Be))&&(tt.addKey(kt),je.push(vt)))}switch(He.type){case"add":Ye=Ve.concat(q.values?je:je.map(function(Lt){return Le(Lt)}));break;case"put":var Xt=new is().addKeys(He.values.map(function(Lt){return Le(Lt)})),Ye=Ve.filter(function(Lt){return!Xt.hasKey(q.values?Le(Lt):Lt)}).concat(q.values?je:je.map(function(Lt){return Le(Lt)}));break;case"delete":var jt=new is().addKeys(He.keys);Ye=Ve.filter(function(Lt){return!jt.hasKey(q.values?Le(Lt):Lt)});break;case"deleteRange":var Yt=He.range;Ye=Ve.filter(function(Lt){return!gf(Le(Lt),Yt)})}return Ye},G);return qe===G?G:(qe.sort(function(Ve,He){return nt(xe(Ve),xe(He))||nt(Le(Ve),Le(He))}),q.limit&&q.limit<1/0&&(qe.length>q.limit?qe.length=q.limit:G.length===q.limit&&qe.length<q.limit&&(ue.dirty=!0)),ve?Object.freeze(qe):qe)}function Zd(G,q){return nt(G.lower,q.lower)===0&&nt(G.upper,q.upper)===0&&!!G.lowerOpen==!!q.lowerOpen&&!!G.upperOpen==!!q.upperOpen}function c$(G,q){return function(X,ae,ue,ve){if(X===void 0)return ae!==void 0?-1:0;if(ae===void 0)return 1;if((ae=nt(X,ae))===0){if(ue&&ve)return 0;if(ue)return 1;if(ve)return-1}return ae}(G.lower,q.lower,G.lowerOpen,q.lowerOpen)<=0&&0<=function(X,ae,ue,ve){if(X===void 0)return ae!==void 0?1:0;if(ae===void 0)return-1;if((ae=nt(X,ae))===0){if(ue&&ve)return 0;if(ue)return-1;if(ve)return 1}return ae}(G.upper,q.upper,G.upperOpen,q.upperOpen)}function pv(G,q,X,ae){G.subscribers.add(X),ae.addEventListener("abort",function(){var ue,ve;G.subscribers.delete(X),G.subscribers.size===0&&(ue=G,ve=q,setTimeout(function(){ue.subscribers.size===0&&O(ve,ue)},3e3))})}var u$={stack:"dbcore",level:0,name:"Cache",create:function(G){var q=G.schema.name;return n(n({},G),{transaction:function(X,ae,ue){var ve,Te,Pe=G.transaction(X,ae,ue);return ae==="readwrite"&&(Te=(ve=new AbortController).signal,ue=function(Be){return function(){if(ve.abort(),ae==="readwrite"){for(var Le=new Set,We=0,xe=X;We<xe.length;We++){var qe=xe[We],Ve=ih["idb://".concat(q,"/").concat(qe)];if(Ve){var He=G.table(qe),Ye=Ve.optimisticOps.filter(function(en){return en.trans===Pe});if(Pe._explicit&&Be&&Pe.mutatedParts)for(var je=0,tt=Object.values(Ve.queries.query);je<tt.length;je++)for(var it=0,rt=(Xt=tt[je]).slice();it<rt.length;it++)y1((jt=rt[it]).obsSet,Pe.mutatedParts)&&(O(Xt,jt),jt.subscribers.forEach(function(en){return Le.add(en)}));else if(0<Ye.length){Ve.optimisticOps=Ve.optimisticOps.filter(function(en){return en.trans!==Pe});for(var vt=0,kt=Object.values(Ve.queries.query);vt<kt.length;vt++)for(var Xt,jt,Yt,qt=0,Lt=(Xt=kt[vt]).slice();qt<Lt.length;qt++)(jt=Lt[qt]).res!=null&&Pe.mutatedParts&&(Be&&!jt.dirty?(Yt=Object.isFrozen(jt.res),Yt=OM(jt.res,jt.req,Ye,He,jt,Yt),jt.dirty?(O(Xt,jt),jt.subscribers.forEach(function(en){return Le.add(en)})):Yt!==jt.res&&(jt.res=Yt,jt.promise=Ie.resolve({result:Yt}))):(jt.dirty&&O(Xt,jt),jt.subscribers.forEach(function(en){return Le.add(en)})))}}}Le.forEach(function(en){return en()})}}},Pe.addEventListener("abort",ue(!1),{signal:Te}),Pe.addEventListener("error",ue(!1),{signal:Te}),Pe.addEventListener("complete",ue(!0),{signal:Te})),Pe},table:function(X){var ae=G.table(X),ue=ae.schema.primaryKey;return n(n({},ae),{mutate:function(ve){var Te=De.trans;if(ue.outbound||Te.db._options.cache==="disabled"||Te.explicit)return ae.mutate(ve);var Pe=ih["idb://".concat(q,"/").concat(X)];return Pe?(Te=ae.mutate(ve),ve.type!=="add"&&ve.type!=="put"||!(50<=ve.values.length||I1(ue,ve).some(function(Be){return Be==null}))?(Pe.optimisticOps.push(ve),ve.mutatedParts&&db(ve.mutatedParts),Te.then(function(Be){0<Be.numFailures&&(O(Pe.optimisticOps,ve),(Be=gu(0,ve,Be))&&Pe.optimisticOps.push(Be),ve.mutatedParts&&db(ve.mutatedParts))}),Te.catch(function(){O(Pe.optimisticOps,ve),ve.mutatedParts&&db(ve.mutatedParts)})):Te.then(function(Be){var Le=gu(0,n(n({},ve),{values:ve.values.map(function(Ve,xe){var qe,Ve=(qe=ue.keyPath)!==null&&qe!==void 0&&qe.includes(".")?M(Ve):n({},Ve);return S(Ve,ue.keyPath,Be.results[xe]),Ve})}),Be);Pe.optimisticOps.push(Le),queueMicrotask(function(){return ve.mutatedParts&&db(ve.mutatedParts)})}),Te):ae.mutate(ve)},query:function(ve){if(!xM(De,ae)||!S1("query",ve))return ae.query(ve);var Te=((Le=De.trans)===null||Le===void 0?void 0:Le.db._options.cache)==="immutable",xe=De,Pe=xe.requery,Be=xe.signal,Le=function(He,Ye,je,tt){var it=ih["idb://".concat(He,"/").concat(Ye)];if(!it)return[];if(!(Ye=it.queries[je]))return[null,!1,it,null];var rt=Ye[(tt.query?tt.query.index.name:null)||""];if(!rt)return[null,!1,it,null];switch(je){case"query":var vt=rt.find(function(kt){return kt.req.limit===tt.limit&&kt.req.values===tt.values&&Zd(kt.req.query.range,tt.query.range)});return vt?[vt,!0,it,rt]:[rt.find(function(kt){return("limit"in kt.req?kt.req.limit:1/0)>=tt.limit&&(!tt.values||kt.req.values)&&c$(kt.req.query.range,tt.query.range)}),!1,it,rt];case"count":return vt=rt.find(function(kt){return Zd(kt.req.query.range,tt.query.range)}),[vt,!!vt,it,rt]}}(q,X,"query",ve),We=Le[0],xe=Le[1],qe=Le[2],Ve=Le[3];return We&&xe?We.obsSet=ve.obsSet:(xe=ae.query(ve).then(function(He){var Ye=He.result;if(We&&(We.res=Ye),Te){for(var je=0,tt=Ye.length;je<tt;++je)Object.freeze(Ye[je]);Object.freeze(Ye)}else He.result=M(Ye);return He}).catch(function(He){return Ve&&We&&O(Ve,We),Promise.reject(He)}),We={obsSet:ve.obsSet,promise:xe,subscribers:new Set,type:"query",req:ve,dirty:!1},Ve?Ve.push(We):(Ve=[We],(qe=qe||(ih["idb://".concat(q,"/").concat(X)]={queries:{query:{},count:{}},objs:new Map,optimisticOps:[],unsignaledParts:{}})).queries.query[ve.query.index.name||""]=Ve)),pv(We,Ve,Pe,Be),We.promise.then(function(He){return{result:OM(He.result,ve,qe==null?void 0:qe.optimisticOps,ae,We,Te)}})}})}})}};function vf(G,q){return new Proxy(G,{get:function(X,ae,ue){return ae==="db"?q:Reflect.get(X,ae,ue)}})}var Xd=(Sa.prototype.version=function(G){if(isNaN(G)||G<.1)throw new J.Type("Given version is not a positive number");if(G=Math.round(10*G)/10,this.idbdb||this._state.isBeingOpened)throw new J.Schema("Cannot add version when database is open");this.verno=Math.max(this.verno,G);var q=this._versions,X=q.filter(function(ae){return ae._cfg.version===G})[0];return X||(X=new this.Version(G),q.push(X),q.sort(li),X.stores({}),this._state.autoSchema=!1,X)},Sa.prototype._whenReady=function(G){var q=this;return this.idbdb&&(this._state.openComplete||De.letThrough||this._vip)?G():new Ie(function(X,ae){if(q._state.openComplete)return ae(new J.DatabaseClosed(q._state.dbOpenError));if(!q._state.isBeingOpened){if(!q._state.autoOpen)return void ae(new J.DatabaseClosed);q.open().catch(ce)}q._state.dbReadyPromise.then(X,ae)}).then(G)},Sa.prototype.use=function(G){var q=G.stack,X=G.create,ae=G.level,ue=G.name;return ue&&this.unuse({stack:q,name:ue}),G=this._middlewares[q]||(this._middlewares[q]=[]),G.push({stack:q,create:X,level:ae??10,name:ue}),G.sort(function(ve,Te){return ve.level-Te.level}),this},Sa.prototype.unuse=function(G){var q=G.stack,X=G.name,ae=G.create;return q&&this._middlewares[q]&&(this._middlewares[q]=this._middlewares[q].filter(function(ue){return ae?ue.create!==ae:!!X&&ue.name!==X})),this},Sa.prototype.open=function(){var G=this;return Tc(Me,function(){return s$(G)})},Sa.prototype._close=function(){var G=this._state,q=hu.indexOf(this);if(0<=q&&hu.splice(q,1),this.idbdb){try{this.idbdb.close()}catch{}this.idbdb=null}G.isBeingOpened||(G.dbReadyPromise=new Ie(function(X){G.dbReadyResolve=X}),G.openCanceller=new Ie(function(X,ae){G.cancelOpen=ae}))},Sa.prototype.close=function(X){var q=(X===void 0?{disableAutoOpen:!0}:X).disableAutoOpen,X=this._state;q?(X.isBeingOpened&&X.cancelOpen(new J.DatabaseClosed),this._close(),X.autoOpen=!1,X.dbOpenError=new J.DatabaseClosed):(this._close(),X.autoOpen=this._options.autoOpen||X.isBeingOpened,X.openComplete=!1,X.dbOpenError=null)},Sa.prototype.delete=function(G){var q=this;G===void 0&&(G={disableAutoOpen:!0});var X=0<arguments.length&&typeof arguments[0]!="object",ae=this._state;return new Ie(function(ue,ve){function Te(){q.close(G);var Pe=q._deps.indexedDB.deleteDatabase(q.name);Pe.onsuccess=Tt(function(){var Be,Le,We;Be=q._deps,Le=q.name,We=Be.indexedDB,Be=Be.IDBKeyRange,No(We)||Le===fl||ff(We,Be).delete(Le).catch(ce),ue()}),Pe.onerror=vl(ve),Pe.onblocked=q._fireOnBlocked}if(X)throw new J.InvalidArgument("Invalid closeOptions argument to db.delete()");ae.isBeingOpened?ae.dbReadyPromise.then(Te):Te()})},Sa.prototype.backendDB=function(){return this.idbdb},Sa.prototype.isOpen=function(){return this.idbdb!==null},Sa.prototype.hasBeenClosed=function(){var G=this._state.dbOpenError;return G&&G.name==="DatabaseClosed"},Sa.prototype.hasFailed=function(){return this._state.dbOpenError!==null},Sa.prototype.dynamicallyOpened=function(){return this._state.autoSchema},Object.defineProperty(Sa.prototype,"tables",{get:function(){var G=this;return s(this._allTables).map(function(q){return G._allTables[q]})},enumerable:!1,configurable:!0}),Sa.prototype.transaction=function(){var G=(function(q,X,ae){var ue=arguments.length;if(ue<2)throw new J.InvalidArgument("Too few arguments");for(var ve=new Array(ue-1);--ue;)ve[ue-1]=arguments[ue];return ae=ve.pop(),[q,E(ve),ae]}).apply(this,arguments);return this._transaction.apply(this,G)},Sa.prototype._transaction=function(G,q,X){var ae=this,ue=De.trans;ue&&ue.db===this&&G.indexOf("!")===-1||(ue=null);var ve,Te,Pe=G.indexOf("?")!==-1;G=G.replace("!","").replace("?","");try{if(Te=q.map(function(Le){if(Le=Le instanceof ae.Table?Le.name:Le,typeof Le!="string")throw new TypeError("Invalid table argument to Dexie.transaction(). Only Table or String are allowed");return Le}),G=="r"||G===Co)ve=Co;else{if(G!="rw"&&G!=Dc)throw new J.InvalidArgument("Invalid transaction mode: "+G);ve=Dc}if(ue){if(ue.mode===Co&&ve===Dc){if(!Pe)throw new J.SubTransaction("Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY");ue=null}ue&&Te.forEach(function(Le){if(ue&&ue.storeNames.indexOf(Le)===-1){if(!Pe)throw new J.SubTransaction("Table "+Le+" not included in parent transaction.");ue=null}}),Pe&&ue&&!ue.active&&(ue=null)}}catch(Le){return ue?ue._promise(null,function(We,xe){xe(Le)}):An(Le)}var Be=(function Le(We,xe,qe,Ve,He){return Ie.resolve().then(function(){var Ye=De.transless||De,je=We._createTransaction(xe,qe,We._dbSchema,Ve);if(je.explicit=!0,Ye={trans:je,transless:Ye},Ve)je.idbtrans=Ve.idbtrans;else try{je.create(),je.idbtrans._explicit=!0,We._state.PR1398_maxLoop=3}catch(rt){return rt.name===K.InvalidState&&We.isOpen()&&0<--We._state.PR1398_maxLoop?(console.warn("Dexie: Need to reopen db"),We.close({disableAutoOpen:!1}),We.open().then(function(){return Le(We,xe,qe,null,He)})):An(rt)}var tt,it=V(He);return it&&tr(),Ye=Ie.follow(function(){var rt;(tt=He.call(je,je))&&(it?(rt=lr.bind(null,null),tt.then(rt,rt)):typeof tt.next=="function"&&typeof tt.throw=="function"&&(tt=Fm(tt)))},Ye),(tt&&typeof tt.then=="function"?Ie.resolve(tt).then(function(rt){return je.active?rt:An(new J.PrematureCommit("Transaction committed too early. See http://bit.ly/2kdckMn"))}):Ye.then(function(){return tt})).then(function(rt){return Ve&&je._resolve(),je._completion.then(function(){return rt})}).catch(function(rt){return je._reject(rt),An(rt)})})}).bind(null,this,ve,Te,ue,X);return ue?ue._promise(ve,Be,"lock"):De.trans?Tc(De.transless,function(){return ae._whenReady(Be)}):this._whenReady(Be)},Sa.prototype.table=function(G){if(!d(this._allTables,G))throw new J.InvalidTable("Table ".concat(G," does not exist"));return this._allTables[G]},Sa);function Sa(G,q){var X=this;this._middlewares={},this.verno=0;var ae=Sa.dependencies;this._options=q=n({addons:Sa.addons,autoOpen:!0,indexedDB:ae.indexedDB,IDBKeyRange:ae.IDBKeyRange,cache:"cloned"},q),this._deps={indexedDB:q.indexedDB,IDBKeyRange:q.IDBKeyRange},ae=q.addons,this._dbSchema={},this._versions=[],this._storeNames=[],this._allTables={},this.idbdb=null,this._novip=this;var ue,ve,Te,Pe,Be,Le={dbOpenError:null,isBeingOpened:!1,onReadyBeingFired:null,openComplete:!1,dbReadyResolve:ce,dbReadyPromise:null,cancelOpen:ce,openCanceller:null,autoSchema:!0,PR1398_maxLoop:3,autoOpen:q.autoOpen};Le.dbReadyPromise=new Ie(function(xe){Le.dbReadyResolve=xe}),Le.openCanceller=new Ie(function(xe,qe){Le.cancelOpen=qe}),this._state=Le,this.name=G,this.on=Yo(this,"populate","blocked","versionchange","close",{ready:[we,ce]}),this.on.ready.subscribe=b(this.on.ready.subscribe,function(xe){return function(qe,Ve){Sa.vip(function(){var He,Ye=X._state;Ye.openComplete?(Ye.dbOpenError||Ie.resolve().then(qe),Ve&&xe(qe)):Ye.onReadyBeingFired?(Ye.onReadyBeingFired.push(qe),Ve&&xe(qe)):(xe(qe),He=X,Ve||xe(function je(){He.on.ready.unsubscribe(qe),He.on.ready.unsubscribe(je)}))})}}),this.Collection=(ue=this,ml(Mo.prototype,function(tt,je){this.db=ue;var Ve=Fs,He=null;if(je)try{Ve=je()}catch(it){He=it}var Ye=tt._ctx,je=Ye.table,tt=je.hook.reading.fire;this._ctx={table:je,index:Ye.index,isPrimKey:!Ye.index||je.schema.primKey.keyPath&&Ye.index===je.schema.primKey.name,range:Ve,keysOnly:!1,dir:"next",unique:"",algorithm:null,filter:null,replayFilter:null,justLimit:!0,isMatch:null,offset:0,limit:1/0,error:He,or:Ye.or,valueMapper:tt!==oe?tt:null}})),this.Table=(ve=this,ml(Ja.prototype,function(xe,qe,Ve){this.db=ve,this._tx=Ve,this.name=xe,this.schema=qe,this.hook=ve._allTables[xe]?ve._allTables[xe].hook:Yo(null,{creating:[ne,ce],reading:[te,oe],updating:[be,ce],deleting:[me,ce]})})),this.Transaction=(Te=this,ml(hf.prototype,function(xe,qe,Ve,He,Ye){var je=this;this.db=Te,this.mode=xe,this.storeNames=qe,this.schema=Ve,this.chromeTransactionDurability=He,this.idbtrans=null,this.on=Yo(this,"complete","error","abort"),this.parent=Ye||null,this.active=!0,this._reculock=0,this._blockedFuncs=[],this._resolve=null,this._reject=null,this._waitingFor=null,this._waitingQueue=null,this._spinCount=0,this._completion=new Ie(function(tt,it){je._resolve=tt,je._reject=it}),this._completion.then(function(){je.active=!1,je.on.complete.fire()},function(tt){var it=je.active;return je.active=!1,je.on.error.fire(tt),je.parent?je.parent._reject(tt):it&&je.idbtrans&&je.idbtrans.abort(),An(tt)})})),this.Version=(Pe=this,ml(eh.prototype,function(xe){this.db=Pe,this._cfg={version:xe,storesSource:null,dbschema:{},tables:{},contentUpgrade:null}})),this.WhereClause=(Be=this,ml(Vs.prototype,function(xe,qe,Ve){if(this.db=Be,this._ctx={table:xe,index:qe===":id"?null:qe,or:Ve},this._cmp=this._ascending=nt,this._descending=function(He,Ye){return nt(Ye,He)},this._max=function(He,Ye){return 0<nt(He,Ye)?He:Ye},this._min=function(He,Ye){return nt(He,Ye)<0?He:Ye},this._IDBKeyRange=Be._deps.IDBKeyRange,!this._IDBKeyRange)throw new J.MissingAPI})),this.on("versionchange",function(xe){0<xe.newVersion?console.warn("Another connection wants to upgrade database '".concat(X.name,"'. Closing db now to resume the upgrade.")):console.warn("Another connection wants to delete database '".concat(X.name,"'. Closing db now to resume the delete request.")),X.close({disableAutoOpen:!1})}),this.on("blocked",function(xe){!xe.newVersion||xe.newVersion<xe.oldVersion?console.warn("Dexie.delete('".concat(X.name,"') was blocked")):console.warn("Upgrade '".concat(X.name,"' blocked by other connection holding version ").concat(xe.oldVersion/10))}),this._maxKey=yl(q.IDBKeyRange),this._createTransaction=function(xe,qe,Ve,He){return new X.Transaction(xe,qe,Ve,X._options.chromeTransactionDurability,He)},this._fireOnBlocked=function(xe){X.on("blocked").fire(xe),hu.filter(function(qe){return qe.name===X.name&&qe!==X&&!qe._state.vcFired}).map(function(qe){return qe.on("versionchange").fire(xe)})},this.use(o$),this.use(u$),this.use(l$),this.use(kM),this.use(w1);var We=new Proxy(this,{get:function(xe,qe,Ve){if(qe==="_vip")return!0;if(qe==="table")return function(Ye){return vf(X.table(Ye),We)};var He=Reflect.get(xe,qe,Ve);return He instanceof Ja?vf(He,We):qe==="tables"?He.map(function(Ye){return vf(Ye,We)}):qe==="_createTransaction"?function(){return vf(He.apply(this,arguments),We)}:He}});this.vip=We,ae.forEach(function(xe){return xe(X)})}var d0,Hs=typeof Symbol<"u"&&"observable"in Symbol?Symbol.observable:"@@observable",p0=(T1.prototype.subscribe=function(G,q,X){return this._subscribe(G&&typeof G!="function"?G:{next:G,error:q,complete:X})},T1.prototype[Hs]=function(){return this},T1);function T1(G){this._subscribe=G}try{d0={indexedDB:a.indexedDB||a.mozIndexedDB||a.webkitIndexedDB||a.msIndexedDB,IDBKeyRange:a.IDBKeyRange||a.webkitIDBKeyRange}}catch{d0={indexedDB:null,IDBKeyRange:null}}function h0(G){var q,X=!1,ae=new p0(function(ue){var ve=V(G),Te,Pe=!1,Be={},Le={},We={get closed(){return Pe},unsubscribe:function(){Pe||(Pe=!0,Te&&Te.abort(),xe&&Cc.storagemutated.unsubscribe(Ve))}};ue.start&&ue.start(We);var xe=!1,qe=function(){return zd(He)},Ve=function(Ye){o0(Be,Ye),y1(Le,Be)&&qe()},He=function(){var Ye,je,tt;!Pe&&d0.indexedDB&&(Be={},Ye={},Te&&Te.abort(),Te=new AbortController,tt=function(it){var rt=ti();try{ve&&tr();var vt=nn(G,it);return vt=ve?vt.finally(lr):vt}finally{rt&&Ke()}}(je={subscr:Ye,signal:Te.signal,requery:qe,querier:G,trans:null}),Promise.resolve(tt).then(function(it){X=!0,q=it,Pe||je.signal.aborted||(Be={},function(rt){for(var vt in rt)if(d(rt,vt))return;return 1}(Le=Ye)||xe||(Cc(Ds,Ve),xe=!0),zd(function(){return!Pe&&ue.next&&ue.next(it)}))},function(it){X=!1,["DatabaseClosedError","AbortError"].includes(it==null?void 0:it.name)||Pe||zd(function(){Pe||ue.error&&ue.error(it)})}))};return setTimeout(qe,0),We});return ae.hasValue=function(){return X},ae.getValue=function(){return q},ae}var $m=Xd;function ud(G){var q=Rc;try{Rc=!0,Cc.storagemutated.fire(G),dv(G,!0)}finally{Rc=q}}p($m,n(n({},ie),{delete:function(G){return new $m(G,{addons:[]}).delete()},exists:function(G){return new $m(G,{addons:[]}).open().then(function(q){return q.close(),!0}).catch("NoSuchDatabaseError",function(){return!1})},getDatabaseNames:function(G){try{return q=$m.dependencies,X=q.indexedDB,q=q.IDBKeyRange,(No(X)?Promise.resolve(X.databases()).then(function(ae){return ae.map(function(ue){return ue.name}).filter(function(ue){return ue!==fl})}):ff(X,q).toCollection().primaryKeys()).then(G)}catch{return An(new J.MissingAPI)}var q,X},defineClass:function(){return function(G){l(this,G)}},ignoreTransaction:function(G){return De.trans?Tc(De.transless,G):G()},vip:m1,async:function(G){return function(){try{var q=Fm(G.apply(this,arguments));return q&&typeof q.then=="function"?q:Ie.resolve(q)}catch(X){return An(X)}}},spawn:function(G,q,X){try{var ae=Fm(G.apply(X,q||[]));return ae&&typeof ae.then=="function"?ae:Ie.resolve(ae)}catch(ue){return An(ue)}},currentTransaction:{get:function(){return De.trans||null}},waitFor:function(G,q){return q=Ie.resolve(typeof G=="function"?$m.ignoreTransaction(G):G).timeout(q||6e4),De.trans?De.trans.waitFor(q):q},Promise:Ie,debug:{get:function(){return ze},set:function(G){Qe(G)}},derive:m,extend:l,props:p,override:b,Events:Yo,on:Cc,liveQuery:h0,extendObservabilitySet:o0,getByKeyPath:w,setByKeyPath:S,delByKeyPath:function(G,q){typeof q=="string"?S(G,q,void 0):"length"in q&&[].map.call(q,function(X){S(G,X,void 0)})},shallowClone:U,deepClone:M,getObjectDiff:c0,cmp:nt,asap:T,minKey:-1/0,addons:[],connections:hu,errnames:K,dependencies:d0,cache:ih,semVer:"4.0.8",version:"4.0.8".split(".").map(function(G){return parseInt(G)}).reduce(function(G,q,X){return G+q/Math.pow(10,2*X)})})),$m.maxKey=yl($m.dependencies.IDBKeyRange),typeof dispatchEvent<"u"&&typeof addEventListener<"u"&&(Cc(Ds,function(G){Rc||(G=new CustomEvent(cr,{detail:G}),Rc=!0,dispatchEvent(G),Rc=!1)}),addEventListener(cr,function(G){G=G.detail,Rc||ud(G)}));var hv,Rc=!1,LM=function(){};return typeof BroadcastChannel<"u"&&((LM=function(){(hv=new BroadcastChannel(cr)).onmessage=function(G){return G.data&&ud(G.data)}})(),typeof hv.unref=="function"&&hv.unref(),Cc(Ds,function(G){Rc||hv.postMessage(G)})),typeof addEventListener<"u"&&(addEventListener("pagehide",function(G){if(!Xd.disableBfCache&&G.persisted){ze&&console.debug("Dexie: handling persisted pagehide"),hv!=null&&hv.close();for(var q=0,X=hu;q<X.length;q++)X[q].close({disableAutoOpen:!1})}}),addEventListener("pageshow",function(G){!Xd.disableBfCache&&G.persisted&&(ze&&console.debug("Dexie: handling persisted pageshow"),LM(),ud({all:new is(-1/0,[[]])}))})),Ie.rejectionMapper=function(G,q){return!G||G instanceof B||G instanceof TypeError||G instanceof SyntaxError||!G.name||!se[G.name]?G:(q=new se[G.name](q||G.message,G),"stack"in G&&f(q,"stack",{get:function(){return this.inner.stack}}),q)},Qe(ze),n(Xd,Object.freeze({__proto__:null,Dexie:Xd,liveQuery:h0,Entity:df,cmp:nt,PropModSymbol:$s,PropModification:qr,replacePrefix:function(G,q){return new qr({replacePrefix:[G,q]})},add:function(G){return new qr({add:G})},remove:function(G){return new qr({remove:G})},default:Xd,RangeSet:is,mergeRanges:uv,rangesOverlap:a0}),{default:Xd}),Xd})})(ZUe);var lZe=ZUe.exports;const RG=eR(lZe),tQ=Symbol.for("Dexie"),mk=globalThis[tQ]||(globalThis[tQ]=RG);if(RG.semVer!==mk.semVer)throw new Error(`Two different versions of Dexie loaded in the same app: ${RG.semVer} and ${mk.semVer}`);const jc=function(){const t={};return t.initDB=()=>new Promise((e,i)=>{try{t.dex=new mk("TMX",{autoOpen:!0}),t.dex.version(2).stores({tournaments:"&tournamentId, tournamentName, startDate, endDate",providers:"&providerId, settings, calendar",idioms:"ioc"}),e()}catch(n){return i(n)}}),t.resetDB=e=>{t.dex.close(),mk.delete("TMX").then(e,()=>alert("Failed to Reset Database"))},t.findAll=e=>new Promise((i,n)=>{const r=t.dex[e];return r?r.toArray(i,n).catch(n):i([])}),t.findAllTournaments=()=>t.findAll("tournaments"),t.findAllProviders=()=>t.findAll("providers"),t.findAllIdioms=()=>t.findAll("idioms"),t.findWhere=(e,i,n)=>new Promise((r,a)=>t.dex[e].where(i).equals(n).toArray(r,a).catch(a)),t.deleteTournament=e=>new Promise((i,n)=>{t.dex.tournaments.where("tournamentId").equals(e).delete().then(i,n)}),t.deleteProvider=e=>t.dex.providers.where("providerId").equals(e).delete(),t.deleteAllTournamentAttr=e=>t.dex.tournaments.toCollection().modify(i=>delete i[e]).then(()=>console.log("done")),t.findUnique=(e,i,n)=>new Promise((r,a)=>{t.findWhere(e,i,n).then(s=>r(s!=null&&s.length?s[0]:void 0),a)}),t.findProvider=e=>t.findUnique("providers","providerId",e),t.findIdiom=e=>t.findUnique("idioms","ioc",e),t.findTournament=e=>t.findUnique("tournaments","tournamentId",e),t.findProviderTournaments=e=>t.findWhere("tournaments","providerId",e),t.addItem=(e,i)=>new Promise((n,r)=>t.dex[e].put(i).then(n,r).catch(a=>{alert("try again:",a),r(a)})),t.modifyOrAddUnique=(e,i,n,r)=>new Promise((a,s)=>{t.dex[e].where(i).equals(n).modify(o=>Object.assign(o,r)).then(o=>{if(o)return a("exists");t.addItem(e,r).then(a,s)},o=>{console.log({err:o}),s(o)})}),t.addIdiom=e=>t.modifyOrAddUnique("idioms","ioc",e.ioc,e),t.addTournament=e=>t.modifyOrAddUnique("tournaments","tournamentId",e.tournamentId,e),t.addProvider=e=>t.modifyOrAddUnique("providers","providerId",e.providerId,e),t.modify=(e,i,n,r,a)=>new Promise((s,o)=>{t.dex[e].where(i).equals(n).modify(l=>{Object.assign(a,{item:l}),r(a)}).then(s,l=>{console.log("error:",l),o()})}),t}(),iY="@VERSION@",Zi={socketIo:{tmx:"/tmx"},activeScale:"wtn",hotkeys:!1,scoring:!1,scales:{utr:{accessor:"utrRating",scaleType:"RATING",scaleColor:"blue",scaleName:"UTR",fallback:!0},wtn:{accessor:"wtnRating",scaleType:"RATING",scaleColor:"red",scaleName:"WTN",fallback:!0}},serverFirst:!0,version:iY,ioc:"gbr",locations:{geolocate:!0,geoposition:void 0,map:void 0,map_view:"satellite",map_provider:"leaflet"},leaflet:{map:{tileLayer:"http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",attribution:'&copy; <a href="http://openstreetmap.org">OpenStreetMap</a> Contributors',maxZoom:18},satellite:{tileLayer:"https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",attribution:"Tiles &copy; Esri"}},scoreboard:{matchFormats:{categories:{},singles:"SET3-S:6/TB7",doubles:"SET3-S:6/TB7-F:TB10"},options:{bestof:[1,3,5],setsto:[4,6,8,9],tiebreaksto:[5,7,12],supertiebreakto:[7,10,21]},settings:{singles:{max_sets:3,sets_to_win:2,games_for_set:6,tiebreak_to:7,tiebreaks_at:6,supertiebreak_to:10,final_set_tiebreak:!0,final_set_supertiebreak:!1},doubles:{max_sets:3,sets_to_win:2,games_for_set:6,tiebreak_to:7,tiebreaks_at:6,supertiebreak_to:10,final_set_tiebreak:!1,final_set_supertiebreak:!0}}},printing:{pageSize:"A4"},schedule:{teams:!0,clubs:!0,time24:!0,ioc_codes:!1,default_time:"9:00",scores_in_draw_order:!0,completed_matches_in_search:!1,max_matches_per_court:14,court_identifiers:!0},messages:[],device:{}};async function nY(t){var i,n;(i=Zi.log)!=null&&i.verbose&&console.log("%c localSave","color: yellow");const e=(t==null?void 0:t.tournamentRecord)??((n=ot.getTournament())==null?void 0:n.tournamentRecord);await jc.addTournament(e),Ot(t==null?void 0:t.callback)&&t.callback()}const rY=Ofe();function XUe(){localStorage.removeItem(rY)}function JUe(){return localStorage.getItem(rY)}function cZe(t){localStorage.setItem(rY,t)}function U2(t){var r,a,s,o,l,c,u,d;const e=((r=t.tournamentName)==null?void 0:r.toLowerCase())||"Error",i=(s=(a=t.onlineResources)==null?void 0:a.find(({name:p,resourceType:h})=>p==="tournamentImage"&&h==="URL"))==null?void 0:s.identifier,n=(c=(l=(o=t.timeItems)==null?void 0:o.find(({itemType:p})=>p==="TMX"))==null?void 0:l.itemValue)==null?void 0:c.offline;return{tournamentId:t.tournamentId,id:t.tournamentId,searchText:e,tournament:{startDate:(u=new Date(t.startDate).toISOString())==null?void 0:u.split("T")[0],endDate:(d=new Date(t.endDate).toISOString())==null?void 0:d.split("T")[0],tournamentName:t.tournamentName,tournamentImageURL:i,offline:n}}}const zw=t=>{let e;const i=Array.isArray(t)?t:[t];return n=>{if(e&&i.forEach(r=>r.removeFilter(e)),n){const r=n==null?void 0:n.toLowerCase();e=a=>{var s;return(s=a.searchText)==null?void 0:s.includes(r)},i.forEach(a=>a.addFilter(e))}else e=void 0}};function QUe({tournamentRecord:t,callback:e}){var n;const i=(n=Xc())==null?void 0:n.provider;i&&!t.parentOrganisation&&(t.parentOrganisation=i),nY({tournamentRecord:t,callback:e})}function uZe({callback:t,autoClose:e=!0}={}){const i=o=>{const l=o.name.split(".").reverse()[0];let c=new FileReader;c.onload=function(u){if(u.target.error){console.log("file error",u.target.error);return}let d=u.target.result;d.length&&(Ot(t)?t(d):console.log(d))},["csv","json"].includes(l)?c.readAsText(o):console.log("not loaded")},n=document.createElement("div");n.className="dzx-dropzone",n.id="tmxDropzone";const r=document.createElement("label");r.className="dzx-inputLabel",r.innerHTML="Drag and Drop files into this zone";const a=document.createElement("input");a.className="dzx-input",a.setAttribute("type","file"),a.setAttribute("accept","application/json"),r.appendChild(a),n.appendChild(r),er({buttons:[{label:"Cancel",intent:"none",close:!0},{label:"Done"}],title:"Import tournament records",content:n}),["drag","dragstart","dragend","dragover","dragenter","dragleave","drop"].forEach(o=>{n.addEventListener(o,function(l){l.preventDefault(),l.stopPropagation()})});const s="dropone-dragging";n.addEventListener("dragover",function(){this.classList.add(s)},!1),n.addEventListener("dragleave",function(){this.classList.remove(s)},!1),n.addEventListener("drop",function(o){const l=a.getAttribute("multiple");this.classList.remove(s);const c=o.dataTransfer.files,u=new DataTransfer;Array.prototype.forEach.call(c,p=>{if(u.items.add(p),!l)return!1});const d=u.files;Array.from(d).forEach(i),e&&AI()},!1)}function e1e({note:t,data:e}){try{return JSON.parse(e)}catch{console.log({message:"falied normal parse",note:t})}}function dZe(t){if(t){if(typeof t=="string")return t;try{return JSON.stringify(t)}catch{return""}}}function pZe({table:t}){const e=t.getData().map(i=>i.tournamentId);uZe({callback:i=>{const n=e1e({data:i});if(n){let r,a;n.tournamentId&&n.startDate?a=n:n.tuid&&n.start&&Jt({message:"TMX Classic file not converted"}),r=ot.setState(a),r.success?mM({tournamentRecord:a,tournamentIds:e,table:t}):console.log(r)}}})}function mM({tournamentRecord:t,tournamentIds:e,table:i,callback:n}){const r=U2(t);(e==null?void 0:e.includes(t.tournamentId))?i==null||i.updateOrAddData([r],!0):i==null||i.addData([r],!0),QUe({tournamentRecord:t}),Ot(n)&&n()}const It={matchUpsToBroadcast:[],tables:[],ee:null,drawer:null,modal:null,state:{authorized:!1,admin:!1},displayed:{selectedScheduleDate:null,draw_event:null},columns:{}};function hZe({table:t}){const e=t.getData().map(c=>c.tournamentId);let i;const r=[{control:"identifier",onInput:({inputs:c})=>{const d=c.identifier.value.length>10,p=document.getElementById("fetchButton");p&&(p.disabled=!d)}}],a=c=>i=Sr(c,[{iconLeft:"fa-solid fa-fingerprint",placeholder:"Identifier",label:"identifier",field:"identifier"}],r),s=()=>{Jt({onClose:()=>It.router.navigate("/tournaments"),message:"Tournament not found",intent:"is-warning",pauseOnHover:!0,action:"show"})},o=c=>{var h,f;const u=(h=c==null?void 0:c.data)==null?void 0:h.tournamentRecord,d=(f=c==null?void 0:c.data)==null?void 0:f.tournamentId,p=e.includes(d);p?console.log({exists:p}):mM({tournamentRecord:u,tournamentIds:e,table:t,callback:()=>{}})};er({title:"Fetch tournament details",content:a,buttons:[{label:"Cancel",intent:"none",close:!0},{label:"Fetch",id:"fetchButton",disabled:!0,intent:"is-primary",onClick:()=>{const c=i.identifier.value;Pje({identifier:c}).then(o,s)},close:!0}]})}function fZe({table:t}){const e=t.getData().map(o=>o.tournamentId);let i;const n=o=>i=Sr(o,[{iconLeft:"fa-solid fa-fingerprint",placeholder:"tournamentId",label:"Tournament Id",field:"tournamentId"}]),r=()=>{Jt({onClose:()=>It.router.navigate("/tournaments"),message:"Tournament not found",intent:"is-warning",pauseOnHover:!0,action:"show"})},a=o=>{var d;const l=i.tournamentId.value,c=(d=o.data.tournamentRecords)==null?void 0:d[l];mM({tournamentRecord:c,tournamentIds:e,table:t,callback:()=>{}})};er({title:"Load tournament",content:n,buttons:[{label:"Cancel",intent:"none",close:!0},{label:"Load",intent:"is-primary",onClick:()=>{const o=i.tournamentId.value;vL({tournamentId:o}).then(a,r)},close:!0}]})}function iQ(t){return _i.dateTime.dateValidation.test(t)}const Wr=(t,e)=>i=>(i==null?void 0:i.trim().length)>=t&&(!e||e&&(i==null?void 0:i.trim().length)<=e);function qw(t,e,i){if(!t)return;const n={};for(const r of e||[]){if(!(r!=null&&r.label)||r.hide)continue;const a=document.createElement("button");r.id&&(n[r.id]=a,a.id=r.id),a.style="margin-right: .5em;",a.className="button font-medium",r.intent&&a.classList.add(r.intent),a.innerHTML=r.label,r.disabled&&(a.disabled=!0),a.onclick=s=>{s.stopPropagation(),!s.target.disabled&&Ot(r.onClick)&&r.onClick(),Ot(i)&&i()},t.appendChild(a)}return{elements:n}}function Py(t,e){return Array.from(t.classList).indexOf(e)>=0?t:jl(t,e)}function jl(t,e){if(!t)return null;if(t.classList&&Array.from(t.classList).indexOf(e)>=0)return t;for(;t.parentNode;)if(t=t.parentNode,t.classList&&Array.from(t.classList).indexOf(e)>=0)return t;return null}function R1(t,e,i){const n=jl(t,e);return n==null?void 0:n.getAttribute(i)}function Cg(t,e){const i=[];function n(r){r.childNodes.forEach(a=>{a.childNodes.length>0&&n(a),a.classList&&Array.from(a.classList).indexOf(e)>=0&&i.push(a)})}return n(t),i}const mZe="addCourts",gZe="addFlight",vZe="addDrawDefinition",t1e="addAdHocMatchUps",yZe="addDrawEntries",bZe="addDrawDefinitionExtension",IZe="addDynamicRatings",wZe="addEvent",aY="addEventEntries",SZe="addEventEntryPairs",TZe="addEventExtension",i1e="addIndividualParticipantIds",MG="addMatchUpScheduleItems",UZe="addOnlineResource",gM="addParticipants",nQ="addParticipantTimeItem",n1e="addPlayoffStructures",DZe="addTournamentExtension",EZe="addTournamentTimeItem",PZe="addVenue",CZe="attachQualifyingStructure",RZe="attachPolicies",MZe="automatedPlayoffPositioning",sY="bulkScheduleMatchUps",r1e="deleteAdHocMatchUps",NZe="deleteFlightAndFlightDraw",AZe="deleteEvents",_Ze="deleteParticipants",kZe="deleteVenues",xZe="destroyPairEntries",a1e="modifyCourt",OZe="modifyEvent",s1e="modifyEntriesStatus",gk="modifyParticipant",oY="modifyParticipantsSignInStatus",LZe="modifyTieFormmat",FZe="modifyVenue",$Ze="proAutoSchedule",o1e="publishEvent",BZe="removeIndividualParticipantIds",VZe="removeStructure",l1e="renameStructures",jZe="resetDrawDefinition",c1e="resetMatchUpLinesUps",u1e="resetScorecard",GZe="setMatchUpFormat",lY="setMatchUpStatus",HZe="setParticipantScaleItems",zZe="setTournamentDates",qZe="setTournamentName",WZe="setTournamentNotes",YZe="unPublishEvent";function d1e({table:t,tournamentRecord:e}){const i={activeDates:((e==null?void 0:e.activeDates)||[]).join(","),tournamentName:(e==null?void 0:e.tournamentName)||"",startDate:(e==null?void 0:e.startDate)||"",endDate:(e==null?void 0:e.endDate)||""};let n;const r=[{error:"minimum of 5 characters",placeholder:"Tournament name",value:i.tournamentName,validator:Wr(5),label:"Tournament name",field:"tournamentName",focus:!0},{placeholder:"YYYY-MM-DD",value:i.startDate,label:"Start date",field:"startDate"},{placeholder:"YYYY-MM-DD",value:i.endDate,label:"End date",field:"endDate"},{visible:!i.activeDates.length,label:"Select active dates",field:"activeDateSelector",id:"activeDateSelector",checkbox:!0},{visible:!!i.activeDates.length,value:i.activeDates||[],placeholder:"[datesArray]",minDate:i.startDate,maxDate:i.endDate,label:"Active Dates",maxNumberOfDates:10,field:"activeDates",id:"activeDates",date:!0}],a=({tournamentName:g,startDate:v,endDate:y})=>Wr(5)(g)&&iQ(v)&&iQ(y),s=({inputs:g})=>{const v=g.activeDates.value,y=g.startDate.value,b=g.endDate.value,I=a({tournamentName:g.tournamentName.value,startDate:y,endDate:b});v&&(g.activeDates.value=v.split(",").filter(w=>!(y&&new Date(w)<new Date(y)||b&&new Date(w)>new Date(b))).filter(Boolean).join(",")),y&&g.activeDates.datepicker.setOptions({minDate:y}),b&&g.activeDates.datepicker.setOptions({maxDate:b});const T=document.getElementById("saveTournamentEdits");T&&(T.disabled=!I)},l=[{fields:["startDate","endDate"],dateRange:!0},{control:"tournamentName",onInput:s},{onFocusOut:s,control:"startDate"},{onFocusOut:s,control:"endDate"},{onChange:({inputs:g})=>{const v=g.activeDateSelector.checked,y=document.getElementById("activeDates"),b=Py(y,"field");b.style.display=v?"block":"none"},control:"activeDateSelector"}],c=g=>{var v,y;n=Sr(g,r,l),(y=(v=n.activeDates)==null?void 0:v.datepicker)==null||y.update()},u=()=>Wr(5)(n.drawName.value),d=()=>{var I,T,w;const g=(I=n.activeDates.value)==null?void 0:I.split(",").filter(Boolean),v=(T=n.tournamentName.value)==null?void 0:T.trim(),y=n.startDate.value,b=n.endDate.value;if(e){const S={...e,tournamentName:v,activeDates:g,startDate:y,endDate:b};ii({tournamentRecord:S,methods:[{method:zZe,params:{activeDates:g,startDate:y,endDate:b}},{method:qZe,params:{tournamentName:v}}],callback:E=>{E.success?t==null||t.updateData([U2(S)],!0):console.log({result:E})}})}else if(ot.newTournamentRecord({tournamentName:v,startDate:y,endDate:b}).success){const U=Xc(),P=(w=ot.getTournament())==null?void 0:w.tournamentRecord;if(U!=null&&U.providerId){const E=R=>{var M;const C=(M=R.data)==null?void 0:M.provider;if(P.parentOrganisation=C,C){const _=A=>console.log("sendTournament",A);mD({tournamentRecord:P}).then(()=>{},_)}rQ({tournamentRecord:P,table:t})};Mje({providerId:U.providerId}).then(E)}else rQ({tournamentRecord:P,table:t})}},p=e?"Save":"Add",h=[{label:"Cancel",intent:"none",close:!0},{disabled:!a(i),id:"saveTournamentEdits",label:p,intent:"is-primary",onClick:d,close:u}],f=(g,v)=>qw(g,h,v),m=e?"Edit tournament":"New tournament";It.drawer.open({title:m,content:c,footer:f,side:oi,width:"300px"})}function rQ({tournamentRecord:t,table:e}){mM({tournamentRecord:t,callback:()=>e==null?void 0:e.addData([U2(t)],!0)})}const oB="font-medium";function NG({target:t,button:e,stateChange:i}){var v;let n=0;const r=()=>(n+=1,`Item${n}`),a=document.createElement("div");e.class&&a.classList.add(e.class),a.classList.add("dropdown"),e.id&&(a.id=e.id),e.align===oi?(a.classList.add("is-right"),a.style="margin-left: 1em"):a.style="margin-right: 1em";const s=y=>y.classList.contains("is-active"),o=()=>{s(a)&&a.classList.remove("is-active")},l=y=>{if(s(y))y.classList.remove("is-active");else return y.classList.add("is-active"),!0};a.onmouseleave=o,a.onclick=()=>l(a);const c=document.createElement("div");c.classList.add("dropdown-trigger");const u=document.createElement("button");u.className="button font-medium",e.intent&&u.classList.add(e.intent),u.setAttribute("aria-haspopup","true");const d=document.createElement("span");Ot(e.onClick)&&(d.onclick=e.onClick),d.style="margin-right: 1em",d.innerHTML=e.label,u.appendChild(d);const p=document.createElement("span");Ot(e.onClick)&&(p.onclick=e.onClick),p.innerHTML=`
      <span class="icon is-small font-medium">
        <i class="fas fa-angle-down font-medium" aria-hidden="true"></i>
      </span>
  `,u.appendChild(p),c.appendChild(u),a.appendChild(c);const h=document.createElement("div");h.classList.add("dropdown-menu"),h.setAttribute("z-index","99998");const f=document.createElement("div");f.classList.add("dropdown-content");const m=()=>{const y=h.querySelectorAll(".dropdown-item");for(const b of Array.from(y))b.classList.remove("is-active")},g=y=>{const b=document.createElement("a");b.className=oB;const I=y.disabled?"0.4":"1";return b.style=`text-decoration: none; opacity: ${I};`,y.color&&(b.style.color=y.color),b.classList.add("dropdown-item"),y.isActive&&b.classList.add("is-active"),y.value&&(b.value=y.value),y.class&&b.classList.add(y.class),b.onclick=T=>{if(y.disabled)return;y.value&&(u.value=y.value,a.value=y.value),T.stopPropagation(),Ot(y.onClick)&&(Ot(i)&&i(),y.onClick(T)),y.close&&o();const w=s(b);m(),w?d.innerHTML=e.label:(e.selection&&l(b),e.modifyLabel&&y.modifyLabel!==!1&&(d.innerHTML=`${e.append?e.label+": ":""}${(y==null?void 0:y.label)||r()}`))},b.innerHTML=(y==null?void 0:y.label)||r(),b};for(const y of e.options||[])if(y.heading){const b=document.createElement("div");b.style="font-weight: bold",b.classList.add("dropdown-item"),b.classList.add(oB),b.innerHTML=y.heading,f.appendChild(b)}else if(y.divider){const b=document.createElement("hr");b.classList.add("dropdown-divider"),b.classList.add(oB),f.appendChild(b)}else y.hide||f.appendChild(g(y));return(v=e.options)!=null&&v.length&&(e.options[0].value&&(a.value=e.options[0].value),h.appendChild(f)),a.appendChild(h),t&&t.appendChild(a),a}class bc{constructor(e){this.table=e}reloadData(e,i,n){return this.table.dataLoader.load(e,void 0,void 0,void 0,i,n)}langText(){return this.table.modules.localize.getText(...arguments)}langBind(){return this.table.modules.localize.bind(...arguments)}langLocale(){return this.table.modules.localize.getLocale(...arguments)}commsConnections(){return this.table.modules.comms.getConnections(...arguments)}commsSend(){return this.table.modules.comms.send(...arguments)}layoutMode(){return this.table.modules.layout.getMode()}layoutRefresh(e){return this.table.modules.layout.layout(e)}subscribe(){return this.table.eventBus.subscribe(...arguments)}unsubscribe(){return this.table.eventBus.unsubscribe(...arguments)}subscribed(e){return this.table.eventBus.subscribed(e)}subscriptionChange(){return this.table.eventBus.subscriptionChange(...arguments)}dispatch(){return this.table.eventBus.dispatch(...arguments)}chain(){return this.table.eventBus.chain(...arguments)}confirm(){return this.table.eventBus.confirm(...arguments)}dispatchExternal(){return this.table.externalEvents.dispatch(...arguments)}subscribedExternal(e){return this.table.externalEvents.subscribed(e)}subscriptionChangeExternal(){return this.table.externalEvents.subscriptionChange(...arguments)}options(e){return this.table.options[e]}setOption(e,i){return typeof i<"u"&&(this.table.options[e]=i),this.table.options[e]}deprecationCheck(e,i,n){return this.table.deprecationAdvisor.check(e,i,n)}deprecationCheckMsg(e,i){return this.table.deprecationAdvisor.checkMsg(e,i)}deprecationMsg(e){return this.table.deprecationAdvisor.msg(e)}module(e){return this.table.module(e)}}class Ha{static elVisible(e){return!(e.offsetWidth<=0&&e.offsetHeight<=0)}static elOffset(e){var i=e.getBoundingClientRect();return{top:i.top+window.pageYOffset-document.documentElement.clientTop,left:i.left+window.pageXOffset-document.documentElement.clientLeft}}static retrieveNestedData(e,i,n){var r=e?i.split(e):[i],a=r.length,s;for(let o=0;o<a&&(n=n[r[o]],s=n,!!n);o++);return s}static deepClone(e,i,n=[]){var r={}.__proto__,a=[].__proto__;i||(i=Object.assign(Array.isArray(e)?[]:{},e));for(var s in e){let o=e[s],l,c;o!=null&&typeof o=="object"&&(o.__proto__===r||o.__proto__===a)&&(l=n.findIndex(u=>u.subject===o),l>-1?i[s]=n[l].copy:(c=Object.assign(Array.isArray(o)?[]:{},o),n.unshift({subject:o,copy:c}),i[s]=this.deepClone(o,c,n)))}return i}}let KZe=class p1e extends bc{constructor(e,i,n){super(e),this.element=i,this.container=this._lookupContainer(),this.parent=n,this.reversedX=!1,this.childPopup=null,this.blurable=!1,this.blurCallback=null,this.blurEventsBound=!1,this.renderedCallback=null,this.visible=!1,this.hideable=!0,this.element.classList.add("tabulator-popup-container"),this.blurEvent=this.hide.bind(this,!1),this.escEvent=this._escapeCheck.bind(this),this.destroyBinding=this.tableDestroyed.bind(this),this.destroyed=!1}tableDestroyed(){this.destroyed=!0,this.hide(!0)}_lookupContainer(){var e=this.table.options.popupContainer;return typeof e=="string"?(e=document.querySelector(e),e||console.warn("Menu Error - no container element found matching selector:",this.table.options.popupContainer,"(defaulting to document body)")):e===!0&&(e=this.table.element),e&&!this._checkContainerIsParent(e)&&(e=!1,console.warn("Menu Error - container element does not contain this table:",this.table.options.popupContainer,"(defaulting to document body)")),e||(e=document.body),e}_checkContainerIsParent(e,i=this.table.element){return e===i?!0:i.parentNode?this._checkContainerIsParent(e,i.parentNode):!1}renderCallback(e){this.renderedCallback=e}containerEventCoords(e){var i=!(e instanceof MouseEvent),n=i?e.touches[0].pageX:e.pageX,r=i?e.touches[0].pageY:e.pageY;if(this.container!==document.body){let a=Ha.elOffset(this.container);n-=a.left,r-=a.top}return{x:n,y:r}}elementPositionCoords(e,i="right"){var n=Ha.elOffset(e),r,a,s;switch(this.container!==document.body&&(r=Ha.elOffset(this.container),n.left-=r.left,n.top-=r.top),i){case"right":a=n.left+e.offsetWidth,s=n.top-1;break;case"bottom":a=n.left,s=n.top+e.offsetHeight;break;case"left":a=n.left,s=n.top-1;break;case"top":a=n.left,s=n.top;break;case"center":a=n.left+e.offsetWidth/2,s=n.top+e.offsetHeight/2;break}return{x:a,y:s,offset:n}}show(e,i){var n,r,a,s,o;return this.destroyed||this.table.destroyed?this:(e instanceof HTMLElement?(a=e,o=this.elementPositionCoords(e,i),s=o.offset,n=o.x,r=o.y):typeof e=="number"?(s={top:0,left:0},n=e,r=i):(o=this.containerEventCoords(e),n=o.x,r=o.y,this.reversedX=!1),this.element.style.top=r+"px",this.element.style.left=n+"px",this.container.appendChild(this.element),typeof this.renderedCallback=="function"&&this.renderedCallback(),this._fitToScreen(n,r,a,s,i),this.visible=!0,this.subscribe("table-destroy",this.destroyBinding),this.element.addEventListener("mousedown",l=>{l.stopPropagation()}),this)}_fitToScreen(e,i,n,r,a){var s=this.container===document.body?document.documentElement.scrollTop:this.container.scrollTop;(e+this.element.offsetWidth>=this.container.offsetWidth||this.reversedX)&&(this.element.style.left="",n?this.element.style.right=this.container.offsetWidth-r.left+"px":this.element.style.right=this.container.offsetWidth-e+"px",this.reversedX=!0);let o=Math.max(this.container.offsetHeight,s?this.container.scrollHeight:0);if(i+this.element.offsetHeight>o)if(n)switch(a){case"bottom":this.element.style.top=parseInt(this.element.style.top)-this.element.offsetHeight-n.offsetHeight-1+"px";break;default:this.element.style.top=parseInt(this.element.style.top)-this.element.offsetHeight+n.offsetHeight+1+"px"}else this.element.style.height=o+"px"}isVisible(){return this.visible}hideOnBlur(e){return this.blurable=!0,this.visible&&(setTimeout(()=>{this.visible&&(this.table.rowManager.element.addEventListener("scroll",this.blurEvent),this.subscribe("cell-editing",this.blurEvent),document.body.addEventListener("click",this.blurEvent),document.body.addEventListener("contextmenu",this.blurEvent),document.body.addEventListener("mousedown",this.blurEvent),window.addEventListener("resize",this.blurEvent),document.body.addEventListener("keydown",this.escEvent),this.blurEventsBound=!0)},100),this.blurCallback=e),this}_escapeCheck(e){e.keyCode==27&&this.hide()}blockHide(){this.hideable=!1}restoreHide(){this.hideable=!0}hide(e=!1){return this.visible&&this.hideable&&(this.blurable&&this.blurEventsBound&&(document.body.removeEventListener("keydown",this.escEvent),document.body.removeEventListener("click",this.blurEvent),document.body.removeEventListener("contextmenu",this.blurEvent),document.body.removeEventListener("mousedown",this.blurEvent),window.removeEventListener("resize",this.blurEvent),this.table.rowManager.element.removeEventListener("scroll",this.blurEvent),this.unsubscribe("cell-editing",this.blurEvent),this.blurEventsBound=!1),this.childPopup&&this.childPopup.hide(),this.parent&&(this.parent.childPopup=null),this.element.parentNode&&this.element.parentNode.removeChild(this.element),this.visible=!1,this.blurCallback&&!e&&this.blurCallback(),this.unsubscribe("table-destroy",this.destroyBinding)),this}child(e){return this.childPopup&&this.childPopup.hide(),this.childPopup=new p1e(this.table,e,this),this.childPopup}},qn=class extends bc{constructor(e,i){super(e),this._handler=null}initialize(){}registerTableOption(e,i){this.table.optionsList.register(e,i)}registerColumnOption(e,i){this.table.columnManager.optionsList.register(e,i)}registerTableFunction(e,i){typeof this.table[e]>"u"?this.table[e]=(...n)=>(this.table.initGuard(e),i(...n)):console.warn("Unable to bind table function, name already in use",e)}registerComponentFunction(e,i,n){return this.table.componentFunctionBinder.bind(e,i,n)}registerDataHandler(e,i){this.table.rowManager.registerDataPipelineHandler(e,i),this._handler=e}registerDisplayHandler(e,i){this.table.rowManager.registerDisplayPipelineHandler(e,i),this._handler=e}displayRows(e){var i=this.table.rowManager.displayRows.length-1,n;if(this._handler&&(n=this.table.rowManager.displayPipeline.findIndex(r=>r.handler===this._handler),n>-1&&(i=n)),e&&(i=i+e),this._handler)return i>-1?this.table.rowManager.getDisplayRows(i):this.activeRows()}activeRows(){return this.table.rowManager.activeRows}refreshData(e,i){i||(i=this._handler),i&&this.table.rowManager.refreshActiveData(i,!1,e)}footerAppend(e){return this.table.footerManager.append(e)}footerPrepend(e){return this.table.footerManager.prepend(e)}footerRemove(e){return this.table.footerManager.remove(e)}popup(e,i){return new KZe(this.table,e,i)}alert(e,i){return this.table.alertManager.alert(e,i)}clearAlert(){return this.table.alertManager.clear()}};var ZZe={rownum:function(t,e,i,n,r,a){return a.getPosition()}};const sS=class sS extends qn{constructor(e){super(e),this.allowedTypes=["","data","download","clipboard","print","htmlOutput"],this.registerColumnOption("accessor"),this.registerColumnOption("accessorParams"),this.registerColumnOption("accessorData"),this.registerColumnOption("accessorDataParams"),this.registerColumnOption("accessorDownload"),this.registerColumnOption("accessorDownloadParams"),this.registerColumnOption("accessorClipboard"),this.registerColumnOption("accessorClipboardParams"),this.registerColumnOption("accessorPrint"),this.registerColumnOption("accessorPrintParams"),this.registerColumnOption("accessorHtmlOutput"),this.registerColumnOption("accessorHtmlOutputParams")}initialize(){this.subscribe("column-layout",this.initializeColumn.bind(this)),this.subscribe("row-data-retrieve",this.transformRow.bind(this))}initializeColumn(e){var i=!1,n={};this.allowedTypes.forEach(r=>{var a="accessor"+(r.charAt(0).toUpperCase()+r.slice(1)),s;e.definition[a]&&(s=this.lookupAccessor(e.definition[a]),s&&(i=!0,n[a]={accessor:s,params:e.definition[a+"Params"]||{}}))}),i&&(e.modules.accessor=n)}lookupAccessor(e){var i=!1;switch(typeof e){case"string":sS.accessors[e]?i=sS.accessors[e]:console.warn("Accessor Error - No such accessor found, ignoring: ",e);break;case"function":i=e;break}return i}transformRow(e,i){var n="accessor"+(i.charAt(0).toUpperCase()+i.slice(1)),r=e.getComponent(),a=Ha.deepClone(e.data||{});return this.table.columnManager.traverse(function(s){var o,l,c,u;s.modules.accessor&&(l=s.modules.accessor[n]||s.modules.accessor.accessor||!1,l&&(o=s.getFieldValue(a),o!="undefined"&&(u=s.getComponent(),c=typeof l.params=="function"?l.params(o,a,i,u,r):l.params,s.setFieldValue(a,l.accessor(o,a,i,c,u,r)))))}),a}};et(sS,"moduleName","accessor"),et(sS,"accessors",ZZe);let AG=sS;var XZe={method:"GET"};function _G(t,e){var i=[];if(e=e||"",Array.isArray(t))t.forEach((r,a)=>{i=i.concat(_G(r,e?e+"["+a+"]":a))});else if(typeof t=="object")for(var n in t)i=i.concat(_G(t[n],e?e+"["+n+"]":n));else i.push({key:e,value:t});return i}function JZe(t){var e=_G(t),i=[];return e.forEach(function(n){i.push(encodeURIComponent(n.key)+"="+encodeURIComponent(n.value))}),i.join("&")}function h1e(t,e,i){return t&&i&&Object.keys(i).length&&(!e.method||e.method.toLowerCase()=="get")&&(e.method="get",t+=(t.includes("?")?"&":"?")+JZe(i)),t}function QZe(t,e,i){var n;return new Promise((r,a)=>{if(t=this.urlGenerator.call(this.table,t,e,i),e.method.toUpperCase()!="GET")if(n=typeof this.table.options.ajaxContentType=="object"?this.table.options.ajaxContentType:this.contentTypeFormatters[this.table.options.ajaxContentType],n){for(var s in n.headers)e.headers||(e.headers={}),typeof e.headers[s]>"u"&&(e.headers[s]=n.headers[s]);e.body=n.body.call(this,t,e,i)}else console.warn("Ajax Error - Invalid ajaxContentType value:",this.table.options.ajaxContentType);t?(typeof e.headers>"u"&&(e.headers={}),typeof e.headers.Accept>"u"&&(e.headers.Accept="application/json"),typeof e.headers["X-Requested-With"]>"u"&&(e.headers["X-Requested-With"]="XMLHttpRequest"),typeof e.mode>"u"&&(e.mode="cors"),e.mode=="cors"?(typeof e.headers.Origin>"u"&&(e.headers.Origin=window.location.origin),typeof e.credentials>"u"&&(e.credentials="same-origin")):typeof e.credentials>"u"&&(e.credentials="include"),fetch(t,e).then(o=>{o.ok?o.json().then(l=>{r(l)}).catch(l=>{a(l),console.warn("Ajax Load Error - Invalid JSON returned",l)}):(console.error("Ajax Load Error - Connection Error: "+o.status,o.statusText),a(o))}).catch(o=>{console.error("Ajax Load Error - Connection Error: ",o),a(o)})):(console.warn("Ajax Load Error - No URL Set"),r([]))})}function kG(t,e){var i=[];if(e=e||"",Array.isArray(t))t.forEach((r,a)=>{i=i.concat(kG(r,e?e+"["+a+"]":a))});else if(typeof t=="object")for(var n in t)i=i.concat(kG(t[n],e?e+"["+n+"]":n));else i.push({key:e,value:t});return i}var eXe={json:{headers:{"Content-Type":"application/json"},body:function(t,e,i){return JSON.stringify(i)}},form:{headers:{},body:function(t,e,i){var n=kG(i),r=new FormData;return n.forEach(function(a){r.append(a.key,a.value)}),r}}};const sh=class sh extends qn{constructor(e){super(e),this.config={},this.url="",this.urlGenerator=!1,this.params=!1,this.loaderPromise=!1,this.registerTableOption("ajaxURL",!1),this.registerTableOption("ajaxURLGenerator",!1),this.registerTableOption("ajaxParams",{}),this.registerTableOption("ajaxConfig","get"),this.registerTableOption("ajaxContentType","form"),this.registerTableOption("ajaxRequestFunc",!1),this.registerTableOption("ajaxRequesting",function(){}),this.registerTableOption("ajaxResponse",!1),this.contentTypeFormatters=sh.contentTypeFormatters}initialize(){this.loaderPromise=this.table.options.ajaxRequestFunc||sh.defaultLoaderPromise,this.urlGenerator=this.table.options.ajaxURLGenerator||sh.defaultURLGenerator,this.table.options.ajaxURL&&this.setUrl(this.table.options.ajaxURL),this.setDefaultConfig(this.table.options.ajaxConfig),this.registerTableFunction("getAjaxUrl",this.getUrl.bind(this)),this.subscribe("data-loading",this.requestDataCheck.bind(this)),this.subscribe("data-params",this.requestParams.bind(this)),this.subscribe("data-load",this.requestData.bind(this))}requestParams(e,i,n,r){var a=this.table.options.ajaxParams;return a&&(typeof a=="function"&&(a=a.call(this.table)),r=Object.assign(Object.assign({},a),r)),r}requestDataCheck(e,i,n,r){return!!(!e&&this.url||typeof e=="string")}requestData(e,i,n,r,a){var s;return!a&&this.requestDataCheck(e)?(e&&this.setUrl(e),s=this.generateConfig(n),this.sendRequest(this.url,i,s)):a}setDefaultConfig(e={}){this.config=Object.assign({},sh.defaultConfig),typeof e=="string"?this.config.method=e:Object.assign(this.config,e)}generateConfig(e={}){var i=Object.assign({},this.config);return typeof e=="string"?i.method=e:Object.assign(i,e),i}setUrl(e){this.url=e}getUrl(){return this.url}sendRequest(e,i,n){return this.table.options.ajaxRequesting.call(this.table,e,i)!==!1?this.loaderPromise(e,n,i).then(r=>(this.table.options.ajaxResponse&&(r=this.table.options.ajaxResponse.call(this.table,e,i,r)),r)):Promise.reject()}};et(sh,"moduleName","ajax"),et(sh,"defaultConfig",XZe),et(sh,"defaultURLGenerator",h1e),et(sh,"defaultLoaderPromise",QZe),et(sh,"contentTypeFormatters",eXe);let xG=sh;var tXe={replace:function(t){return this.table.setData(t)},update:function(t){return this.table.updateOrAddData(t)},insert:function(t){return this.table.addData(t)}},iXe={table:function(t){var e=[],i=!0,n=this.table.columnManager.columns,r=[],a=[];return t=t.split(`
`),t.forEach(function(s){e.push(s.split("	"))}),e.length&&!(e.length===1&&e[0].length<2)?(e[0].forEach(function(s){var o=n.find(function(l){return s&&l.definition.title&&s.trim()&&l.definition.title.trim()===s.trim()});o?r.push(o):i=!1}),i||(i=!0,r=[],e[0].forEach(function(s){var o=n.find(function(l){return s&&l.field&&s.trim()&&l.field.trim()===s.trim()});o?r.push(o):i=!1}),i||(r=this.table.columnManager.columnsByIndex)),i&&e.shift(),e.forEach(function(s){var o={};s.forEach(function(l,c){r[c]&&(o[r[c].field]=l)}),a.push(o)}),a):!1}},nXe={copyToClipboard:["ctrl + 67","meta + 67"]},rXe={copyToClipboard:function(t){this.table.modules.edit.currentCell||this.table.modExists("clipboard",!0)&&this.table.modules.clipboard.copy(!1,!0)}},aXe={keybindings:{bindings:nXe,actions:rXe}},dh;let sXe=(dh=class extends qn{constructor(e){super(e),this.mode=!0,this.pasteParser=function(){},this.pasteAction=function(){},this.customSelection=!1,this.rowRange=!1,this.blocked=!0,this.registerTableOption("clipboard",!1),this.registerTableOption("clipboardCopyStyled",!0),this.registerTableOption("clipboardCopyConfig",!1),this.registerTableOption("clipboardCopyFormatter",!1),this.registerTableOption("clipboardCopyRowRange","active"),this.registerTableOption("clipboardPasteParser","table"),this.registerTableOption("clipboardPasteAction","insert"),this.registerColumnOption("clipboard"),this.registerColumnOption("titleClipboard")}initialize(){this.mode=this.table.options.clipboard,this.rowRange=this.table.options.clipboardCopyRowRange,(this.mode===!0||this.mode==="copy")&&this.table.element.addEventListener("copy",e=>{var i,n,r;this.blocked||(e.preventDefault(),this.customSelection?(i=this.customSelection,this.table.options.clipboardCopyFormatter&&(i=this.table.options.clipboardCopyFormatter("plain",i))):(r=this.table.modules.export.generateExportList(this.table.options.clipboardCopyConfig,this.table.options.clipboardCopyStyled,this.rowRange,"clipboard"),n=this.table.modules.export.generateHTMLTable(r),i=n?this.generatePlainContent(r):"",this.table.options.clipboardCopyFormatter&&(i=this.table.options.clipboardCopyFormatter("plain",i),n=this.table.options.clipboardCopyFormatter("html",n))),window.clipboardData&&window.clipboardData.setData?window.clipboardData.setData("Text",i):e.clipboardData&&e.clipboardData.setData?(e.clipboardData.setData("text/plain",i),n&&e.clipboardData.setData("text/html",n)):e.originalEvent&&e.originalEvent.clipboardData.setData&&(e.originalEvent.clipboardData.setData("text/plain",i),n&&e.originalEvent.clipboardData.setData("text/html",n)),this.dispatchExternal("clipboardCopied",i,n),this.reset())}),(this.mode===!0||this.mode==="paste")&&this.table.element.addEventListener("paste",e=>{this.paste(e)}),this.setPasteParser(this.table.options.clipboardPasteParser),this.setPasteAction(this.table.options.clipboardPasteAction),this.registerTableFunction("copyToClipboard",this.copy.bind(this))}reset(){this.blocked=!0,this.customSelection=!1}generatePlainContent(e){var i=[];return e.forEach(n=>{var r=[];n.columns.forEach(a=>{var s="";if(a)if(n.type==="group"&&(a.value=a.component.getKey()),a.value===null)s="";else switch(typeof a.value){case"object":s=JSON.stringify(a.value);break;case"undefined":s="";break;default:s=a.value}r.push(s)}),i.push(r.join("	"))}),i.join(`
`)}copy(e,i){var n,r;this.blocked=!1,this.customSelection=!1,(this.mode===!0||this.mode==="copy")&&(this.rowRange=e||this.table.options.clipboardCopyRowRange,typeof window.getSelection<"u"&&typeof document.createRange<"u"?(e=document.createRange(),e.selectNodeContents(this.table.element),n=window.getSelection(),n.toString()&&i&&(this.customSelection=n.toString()),n.removeAllRanges(),n.addRange(e)):typeof document.selection<"u"&&typeof document.body.createTextRange<"u"&&(r=document.body.createTextRange(),r.moveToElementText(this.table.element),r.select()),document.execCommand("copy"),n&&n.removeAllRanges())}setPasteAction(e){switch(typeof e){case"string":this.pasteAction=dh.pasteActions[e],this.pasteAction||console.warn("Clipboard Error - No such paste action found:",e);break;case"function":this.pasteAction=e;break}}setPasteParser(e){switch(typeof e){case"string":this.pasteParser=dh.pasteParsers[e],this.pasteParser||console.warn("Clipboard Error - No such paste parser found:",e);break;case"function":this.pasteParser=e;break}}paste(e){var i,n,r;this.checkPasteOrigin(e)&&(i=this.getPasteData(e),n=this.pasteParser.call(this,i),n?(e.preventDefault(),this.table.modExists("mutator")&&(n=this.mutateData(n)),r=this.pasteAction.call(this,n),this.dispatchExternal("clipboardPasted",i,n,r)):this.dispatchExternal("clipboardPasteError",i))}mutateData(e){var i=[];return Array.isArray(e)?e.forEach(n=>{i.push(this.table.modules.mutator.transformRow(n,"clipboard"))}):i=e,i}checkPasteOrigin(e){var i=!0,n=this.confirm("clipboard-paste",[e]);return(n||!["DIV","SPAN"].includes(e.target.tagName))&&(i=!1),i}getPasteData(e){var i;return window.clipboardData&&window.clipboardData.getData?i=window.clipboardData.getData("Text"):e.clipboardData&&e.clipboardData.getData?i=e.clipboardData.getData("text/plain"):e.originalEvent&&e.originalEvent.clipboardData.getData&&(i=e.originalEvent.clipboardData.getData("text/plain")),i}},et(dh,"moduleName","clipboard"),et(dh,"moduleExtensions",aXe),et(dh,"pasteActions",tXe),et(dh,"pasteParsers",iXe),dh);class oXe{constructor(e){return this._row=e,new Proxy(this,{get:function(i,n,r){return typeof i[n]<"u"?i[n]:i._row.table.componentFunctionBinder.handle("row",i._row,n)}})}getData(e){return this._row.getData(e)}getElement(){return this._row.getElement()}getTable(){return this._row.table}getCells(){var e=[];return this._row.getCells().forEach(function(i){e.push(i.getComponent())}),e}getCell(e){var i=this._row.getCell(e);return i?i.getComponent():!1}_getSelf(){return this._row}}class f1e{constructor(e){return this._cell=e,new Proxy(this,{get:function(i,n,r){return typeof i[n]<"u"?i[n]:i._cell.table.componentFunctionBinder.handle("cell",i._cell,n)}})}getValue(){return this._cell.getValue()}getOldValue(){return this._cell.getOldValue()}getInitialValue(){return this._cell.initialValue}getElement(){return this._cell.getElement()}getRow(){return this._cell.row.getComponent()}getData(e){return this._cell.row.getData(e)}getType(){return"cell"}getField(){return this._cell.column.getField()}getColumn(){return this._cell.column.getComponent()}setValue(e,i){typeof i>"u"&&(i=!0),this._cell.setValue(e,i)}restoreOldValue(){this._cell.setValueActual(this._cell.getOldValue())}restoreInitialValue(){this._cell.setValueActual(this._cell.initialValue)}checkHeight(){this._cell.checkHeight()}getTable(){return this._cell.table}_getSelf(){return this._cell}}class vM extends bc{constructor(e,i){super(e.table),this.table=e.table,this.column=e,this.row=i,this.element=null,this.value=null,this.initialValue,this.oldValue=null,this.modules={},this.height=null,this.width=null,this.minWidth=null,this.component=null,this.loaded=!1,this.build()}build(){this.generateElement(),this.setWidth(),this._configureCell(),this.setValueActual(this.column.getFieldValue(this.row.data)),this.initialValue=this.value}generateElement(){this.element=document.createElement("div"),this.element.className="tabulator-cell",this.element.setAttribute("role","gridcell"),this.column.isRowHeader&&this.element.classList.add("tabulator-row-header")}_configureCell(){var e=this.element,i=this.column.getField(),n={top:"flex-start",bottom:"flex-end",middle:"center"},r={left:"flex-start",right:"flex-end",center:"center"};if(e.style.textAlign=this.column.hozAlign,this.column.vertAlign&&(e.style.display="inline-flex",e.style.alignItems=n[this.column.vertAlign]||"",this.column.hozAlign&&(e.style.justifyContent=r[this.column.hozAlign]||"")),i&&e.setAttribute("tabulator-field",i),this.column.definition.cssClass){var a=this.column.definition.cssClass.split(" ");a.forEach(s=>{e.classList.add(s)})}this.dispatch("cell-init",this),this.column.visible||this.hide()}_generateContents(){var e;switch(e=this.chain("cell-format",this,null,()=>this.element.innerHTML=this.value),typeof e){case"object":if(e instanceof Node){for(;this.element.firstChild;)this.element.removeChild(this.element.firstChild);this.element.appendChild(e)}else this.element.innerHTML="",e!=null&&console.warn("Format Error - Formatter has returned a type of object, the only valid formatter object return is an instance of Node, the formatter returned:",e);break;case"undefined":this.element.innerHTML="";break;default:this.element.innerHTML=e}}cellRendered(){this.dispatch("cell-rendered",this)}getElement(e){return this.loaded||(this.loaded=!0,e||this.layoutElement()),this.element}getValue(){return this.value}getOldValue(){return this.oldValue}setValue(e,i,n){var r=this.setValueProcessData(e,i,n);r&&(this.dispatch("cell-value-updated",this),this.cellRendered(),this.column.definition.cellEdited&&this.column.definition.cellEdited.call(this.table,this.getComponent()),this.dispatchExternal("cellEdited",this.getComponent()),this.subscribedExternal("dataChanged")&&this.dispatchExternal("dataChanged",this.table.rowManager.getData()))}setValueProcessData(e,i,n){var r=!1;return(this.value!==e||n)&&(r=!0,i&&(e=this.chain("cell-value-changing",[this,e],null,e))),this.setValueActual(e),r&&this.dispatch("cell-value-changed",this),r}setValueActual(e){this.oldValue=this.value,this.value=e,this.dispatch("cell-value-save-before",this),this.column.setFieldValue(this.row.data,e),this.dispatch("cell-value-save-after",this),this.loaded&&this.layoutElement()}layoutElement(){this._generateContents(),this.dispatch("cell-layout",this)}setWidth(){this.width=this.column.width,this.element.style.width=this.column.widthStyled}clearWidth(){this.width="",this.element.style.width=""}getWidth(){return this.width||this.element.offsetWidth}setMinWidth(){this.minWidth=this.column.minWidth,this.element.style.minWidth=this.column.minWidthStyled}setMaxWidth(){this.maxWidth=this.column.maxWidth,this.element.style.maxWidth=this.column.maxWidthStyled}checkHeight(){this.row.reinitializeHeight()}clearHeight(){this.element.style.height="",this.height=null,this.dispatch("cell-height",this,"")}setHeight(){this.height=this.row.height,this.element.style.height=this.row.heightStyled,this.dispatch("cell-height",this,this.row.heightStyled)}getHeight(){return this.height||this.element.offsetHeight}show(){this.element.style.display=this.column.vertAlign?"inline-flex":""}hide(){this.element.style.display="none"}delete(){this.dispatch("cell-delete",this),!this.table.rowManager.redrawBlock&&this.element.parentNode&&this.element.parentNode.removeChild(this.element),this.element=!1,this.column.deleteCell(this),this.row.deleteCell(this),this.calcs={}}getIndex(){return this.row.getCellIndex(this)}getComponent(){return this.component||(this.component=new f1e(this)),this.component}}class m1e{constructor(e){return this._column=e,this.type="ColumnComponent",new Proxy(this,{get:function(i,n,r){return typeof i[n]<"u"?i[n]:i._column.table.componentFunctionBinder.handle("column",i._column,n)}})}getElement(){return this._column.getElement()}getDefinition(){return this._column.getDefinition()}getField(){return this._column.getField()}getTitleDownload(){return this._column.getTitleDownload()}getCells(){var e=[];return this._column.cells.forEach(function(i){e.push(i.getComponent())}),e}isVisible(){return this._column.visible}show(){this._column.isGroup?this._column.columns.forEach(function(e){e.show()}):this._column.show()}hide(){this._column.isGroup?this._column.columns.forEach(function(e){e.hide()}):this._column.hide()}toggle(){this._column.visible?this.hide():this.show()}delete(){return this._column.delete()}getSubColumns(){var e=[];return this._column.columns.length&&this._column.columns.forEach(function(i){e.push(i.getComponent())}),e}getParentColumn(){return this._column.getParentComponent()}_getSelf(){return this._column}scrollTo(e,i){return this._column.table.columnManager.scrollToColumn(this._column,e,i)}getTable(){return this._column.table}move(e,i){var n=this._column.table.columnManager.findColumn(e);n?this._column.table.columnManager.moveColumn(this._column,n,i):console.warn("Move Error - No matching column found:",n)}getNextColumn(){var e=this._column.nextColumn();return e?e.getComponent():!1}getPrevColumn(){var e=this._column.prevColumn();return e?e.getComponent():!1}updateDefinition(e){return this._column.updateDefinition(e)}getWidth(){return this._column.getWidth()}setWidth(e){var i;return e===!0?i=this._column.reinitializeWidth(!0):i=this._column.setWidth(e),this._column.table.columnManager.rerenderColumns(!0),i}}var g1e={title:void 0,field:void 0,columns:void 0,visible:void 0,hozAlign:void 0,vertAlign:void 0,width:void 0,minWidth:40,maxWidth:void 0,maxInitialWidth:void 0,cssClass:void 0,variableHeight:void 0,headerVertical:void 0,headerHozAlign:void 0,headerWordWrap:!1,editableTitle:void 0};const Pb=class Pb extends bc{constructor(e,i,n){super(i.table),this.definition=e,this.parent=i,this.type="column",this.columns=[],this.cells=[],this.isGroup=!1,this.isRowHeader=n,this.element=this.createElement(),this.contentElement=!1,this.titleHolderElement=!1,this.titleElement=!1,this.groupElement=this.createGroupElement(),this.hozAlign="",this.vertAlign="",this.field="",this.fieldStructure="",this.getFieldValue="",this.setFieldValue="",this.titleDownload=null,this.titleFormatterRendered=!1,this.mapDefinitions(),this.setField(this.definition.field),this.modules={},this.width=null,this.widthStyled="",this.maxWidth=null,this.maxWidthStyled="",this.maxInitialWidth=null,this.minWidth=null,this.minWidthStyled="",this.widthFixed=!1,this.visible=!0,this.component=null,this.definition.columns?(this.isGroup=!0,this.definition.columns.forEach((r,a)=>{var s=new Pb(r,this);this.attachColumn(s)}),this.checkColumnVisibility()):i.registerColumnField(this),this._initialize()}createElement(){var e=document.createElement("div");switch(e.classList.add("tabulator-col"),e.setAttribute("role","columnheader"),e.setAttribute("aria-sort","none"),this.isRowHeader&&e.classList.add("tabulator-row-header"),this.table.options.columnHeaderVertAlign){case"middle":e.style.justifyContent="center";break;case"bottom":e.style.justifyContent="flex-end";break}return e}createGroupElement(){var e=document.createElement("div");return e.classList.add("tabulator-col-group-cols"),e}mapDefinitions(){var e=this.table.options.columnDefaults;if(e)for(let i in e)typeof this.definition[i]>"u"&&(this.definition[i]=e[i]);this.definition=this.table.columnManager.optionsList.generate(Pb.defaultOptionList,this.definition)}checkDefinition(){Object.keys(this.definition).forEach(e=>{Pb.defaultOptionList.indexOf(e)===-1&&console.warn("Invalid column definition option in '"+(this.field||this.definition.title)+"' column:",e)})}setField(e){this.field=e,this.fieldStructure=e?this.table.options.nestedFieldSeparator?e.split(this.table.options.nestedFieldSeparator):[e]:[],this.getFieldValue=this.fieldStructure.length>1?this._getNestedData:this._getFlatData,this.setFieldValue=this.fieldStructure.length>1?this._setNestedData:this._setFlatData}registerColumnPosition(e){this.parent.registerColumnPosition(e)}registerColumnField(e){this.parent.registerColumnField(e)}reRegisterPosition(){this.isGroup?this.columns.forEach(function(e){e.reRegisterPosition()}):this.registerColumnPosition(this)}_initialize(){for(var e=this.definition;this.element.firstChild;)this.element.removeChild(this.element.firstChild);e.headerVertical&&(this.element.classList.add("tabulator-col-vertical"),e.headerVertical==="flip"&&this.element.classList.add("tabulator-col-vertical-flip")),this.contentElement=this._buildColumnHeaderContent(),this.element.appendChild(this.contentElement),this.isGroup?this._buildGroupHeader():this._buildColumnHeader(),this.dispatch("column-init",this)}_buildColumnHeader(){var e=this.definition;if(this.dispatch("column-layout",this),typeof e.visible<"u"&&(e.visible?this.show(!0):this.hide(!0)),e.cssClass){var i=e.cssClass.split(" ");i.forEach(n=>{this.element.classList.add(n)})}e.field&&this.element.setAttribute("tabulator-field",e.field),this.setMinWidth(parseInt(e.minWidth)),e.maxInitialWidth&&(this.maxInitialWidth=parseInt(e.maxInitialWidth)),e.maxWidth&&this.setMaxWidth(parseInt(e.maxWidth)),this.reinitializeWidth(),this.hozAlign=this.definition.hozAlign,this.vertAlign=this.definition.vertAlign,this.titleElement.style.textAlign=this.definition.headerHozAlign}_buildColumnHeaderContent(){var e=document.createElement("div");return e.classList.add("tabulator-col-content"),this.titleHolderElement=document.createElement("div"),this.titleHolderElement.classList.add("tabulator-col-title-holder"),e.appendChild(this.titleHolderElement),this.titleElement=this._buildColumnHeaderTitle(),this.titleHolderElement.appendChild(this.titleElement),e}_buildColumnHeaderTitle(){var e=this.definition,i=document.createElement("div");if(i.classList.add("tabulator-col-title"),e.headerWordWrap&&i.classList.add("tabulator-col-title-wrap"),e.editableTitle){var n=document.createElement("input");n.classList.add("tabulator-title-editor"),n.addEventListener("click",r=>{r.stopPropagation(),n.focus()}),n.addEventListener("mousedown",r=>{r.stopPropagation()}),n.addEventListener("change",()=>{e.title=n.value,this.dispatchExternal("columnTitleChanged",this.getComponent())}),i.appendChild(n),e.field?this.langBind("columns|"+e.field,r=>{n.value=r||e.title||"&nbsp;"}):n.value=e.title||"&nbsp;"}else e.field?this.langBind("columns|"+e.field,r=>{this._formatColumnHeaderTitle(i,r||e.title||"&nbsp;")}):this._formatColumnHeaderTitle(i,e.title||"&nbsp;");return i}_formatColumnHeaderTitle(e,i){var n=this.chain("column-format",[this,i,e],null,()=>i);switch(typeof n){case"object":n instanceof Node?e.appendChild(n):(e.innerHTML="",console.warn("Format Error - Title formatter has returned a type of object, the only valid formatter object return is an instance of Node, the formatter returned:",n));break;case"undefined":e.innerHTML="";break;default:e.innerHTML=n}}_buildGroupHeader(){if(this.element.classList.add("tabulator-col-group"),this.element.setAttribute("role","columngroup"),this.element.setAttribute("aria-title",this.definition.title),this.definition.cssClass){var e=this.definition.cssClass.split(" ");e.forEach(i=>{this.element.classList.add(i)})}this.titleElement.style.textAlign=this.definition.headerHozAlign,this.element.appendChild(this.groupElement)}_getFlatData(e){return e[this.field]}_getNestedData(e){var i=e,n=this.fieldStructure,r=n.length,a;for(let s=0;s<r&&(i=i[n[s]],a=i,!!i);s++);return a}_setFlatData(e,i){this.field&&(e[this.field]=i)}_setNestedData(e,i){var n=e,r=this.fieldStructure,a=r.length;for(let s=0;s<a;s++)if(s==a-1)n[r[s]]=i;else{if(!n[r[s]])if(typeof i<"u")n[r[s]]={};else break;n=n[r[s]]}}attachColumn(e){this.groupElement?(this.columns.push(e),this.groupElement.appendChild(e.getElement()),e.columnRendered()):console.warn("Column Warning - Column being attached to another column instead of column group")}verticalAlign(e,i){var n=this.parent.isGroup?this.parent.getGroupElement().clientHeight:i||this.parent.getHeadersElement().clientHeight;this.element.style.height=n+"px",this.dispatch("column-height",this,this.element.style.height),this.isGroup&&(this.groupElement.style.minHeight=n-this.contentElement.offsetHeight+"px"),this.columns.forEach(function(r){r.verticalAlign(e)})}clearVerticalAlign(){this.element.style.paddingTop="",this.element.style.height="",this.element.style.minHeight="",this.groupElement.style.minHeight="",this.columns.forEach(function(e){e.clearVerticalAlign()}),this.dispatch("column-height",this,"")}getElement(){return this.element}getGroupElement(){return this.groupElement}getField(){return this.field}getTitleDownload(){return this.titleDownload}getFirstColumn(){return this.isGroup?this.columns.length?this.columns[0].getFirstColumn():!1:this}getLastColumn(){return this.isGroup?this.columns.length?this.columns[this.columns.length-1].getLastColumn():!1:this}getColumns(e){var i=[];return e?this.columns.forEach(n=>{i.push(n),i=i.concat(n.getColumns(!0))}):i=this.columns,i}getCells(){return this.cells}getTopColumn(){return this.parent.isGroup?this.parent.getTopColumn():this}getDefinition(e){var i=[];return this.isGroup&&e&&(this.columns.forEach(function(n){i.push(n.getDefinition(!0))}),this.definition.columns=i),this.definition}checkColumnVisibility(){var e=!1;this.columns.forEach(function(i){i.visible&&(e=!0)}),e?(this.show(),this.dispatchExternal("columnVisibilityChanged",this.getComponent(),!1)):this.hide()}show(e,i){this.visible||(this.visible=!0,this.element.style.display="",this.parent.isGroup&&this.parent.checkColumnVisibility(),this.cells.forEach(function(n){n.show()}),!this.isGroup&&this.width===null&&this.reinitializeWidth(),this.table.columnManager.verticalAlignHeaders(),this.dispatch("column-show",this,i),e||this.dispatchExternal("columnVisibilityChanged",this.getComponent(),!0),this.parent.isGroup&&this.parent.matchChildWidths(),this.silent||this.table.columnManager.rerenderColumns())}hide(e,i){this.visible&&(this.visible=!1,this.element.style.display="none",this.table.columnManager.verticalAlignHeaders(),this.parent.isGroup&&this.parent.checkColumnVisibility(),this.cells.forEach(function(n){n.hide()}),this.dispatch("column-hide",this,i),e||this.dispatchExternal("columnVisibilityChanged",this.getComponent(),!1),this.parent.isGroup&&this.parent.matchChildWidths(),this.silent||this.table.columnManager.rerenderColumns())}matchChildWidths(){var e=0;this.contentElement&&this.columns.length&&(this.columns.forEach(function(i){i.visible&&(e+=i.getWidth())}),this.contentElement.style.maxWidth=e-1+"px",this.table.initialized&&(this.element.style.width=e+"px"),this.parent.isGroup&&this.parent.matchChildWidths())}removeChild(e){var i=this.columns.indexOf(e);i>-1&&this.columns.splice(i,1),this.columns.length||this.delete()}setWidth(e){this.widthFixed=!0,this.setWidthActual(e)}setWidthActual(e){isNaN(e)&&(e=Math.floor(this.table.element.clientWidth/100*parseInt(e))),e=Math.max(this.minWidth,e),this.maxWidth&&(e=Math.min(this.maxWidth,e)),this.width=e,this.widthStyled=e?e+"px":"",this.element.style.width=this.widthStyled,this.isGroup||this.cells.forEach(function(i){i.setWidth()}),this.parent.isGroup&&this.parent.matchChildWidths(),this.dispatch("column-width",this),this.subscribedExternal("columnWidth")&&this.dispatchExternal("columnWidth",this.getComponent())}checkCellHeights(){var e=[];this.cells.forEach(function(i){i.row.heightInitialized&&(i.row.getElement().offsetParent!==null?(e.push(i.row),i.row.clearCellHeight()):i.row.heightInitialized=!1)}),e.forEach(function(i){i.calcHeight()}),e.forEach(function(i){i.setCellHeight()})}getWidth(){var e=0;return this.isGroup?this.columns.forEach(function(i){i.visible&&(e+=i.getWidth())}):e=this.width,e}getLeftOffset(){var e=this.element.offsetLeft;return this.parent.isGroup&&(e+=this.parent.getLeftOffset()),e}getHeight(){return Math.ceil(this.element.getBoundingClientRect().height)}setMinWidth(e){this.maxWidth&&e>this.maxWidth&&(e=this.maxWidth,console.warn("the minWidth ("+e+"px) for column '"+this.field+"' cannot be bigger that its maxWidth ("+this.maxWidthStyled+")")),this.minWidth=e,this.minWidthStyled=e?e+"px":"",this.element.style.minWidth=this.minWidthStyled,this.cells.forEach(function(i){i.setMinWidth()})}setMaxWidth(e){this.minWidth&&e<this.minWidth&&(e=this.minWidth,console.warn("the maxWidth ("+e+"px) for column '"+this.field+"' cannot be smaller that its minWidth ("+this.minWidthStyled+")")),this.maxWidth=e,this.maxWidthStyled=e?e+"px":"",this.element.style.maxWidth=this.maxWidthStyled,this.cells.forEach(function(i){i.setMaxWidth()})}delete(){return new Promise((e,i)=>{this.isGroup&&this.columns.forEach(function(r){r.delete()}),this.dispatch("column-delete",this);var n=this.cells.length;for(let r=0;r<n;r++)this.cells[0].delete();this.element.parentNode&&this.element.parentNode.removeChild(this.element),this.element=!1,this.contentElement=!1,this.titleElement=!1,this.groupElement=!1,this.parent.isGroup&&this.parent.removeChild(this),this.table.columnManager.deregisterColumn(this),this.table.columnManager.rerenderColumns(!0),this.dispatch("column-deleted",this),e()})}columnRendered(){this.titleFormatterRendered&&this.titleFormatterRendered(),this.dispatch("column-rendered",this)}generateCell(e){var i=new vM(this,e);return this.cells.push(i),i}nextColumn(){var e=this.table.columnManager.findColumnIndex(this);return e>-1?this._nextVisibleColumn(e+1):!1}_nextVisibleColumn(e){var i=this.table.columnManager.getColumnByIndex(e);return!i||i.visible?i:this._nextVisibleColumn(e+1)}prevColumn(){var e=this.table.columnManager.findColumnIndex(this);return e>-1?this._prevVisibleColumn(e-1):!1}_prevVisibleColumn(e){var i=this.table.columnManager.getColumnByIndex(e);return!i||i.visible?i:this._prevVisibleColumn(e-1)}reinitializeWidth(e){this.widthFixed=!1,typeof this.definition.width<"u"&&!e&&this.setWidth(this.definition.width),this.dispatch("column-width-fit-before",this),this.fitToData(e),this.dispatch("column-width-fit-after",this)}fitToData(e){if(!this.isGroup){this.widthFixed||(this.element.style.width="",this.cells.forEach(r=>{r.clearWidth()}));var i=this.element.offsetWidth;if((!this.width||!this.widthFixed)&&(this.cells.forEach(r=>{var a=r.getWidth();a>i&&(i=a)}),i)){var n=i+1;this.maxInitialWidth&&!e&&(n=Math.min(n,this.maxInitialWidth)),this.setWidthActual(n)}}}updateDefinition(e){var i;return this.isGroup||this.parent.isGroup?(console.error("Column Update Error - The updateDefinition function is only available on ungrouped columns"),Promise.reject("Column Update Error - The updateDefinition function is only available on columns, not column groups")):(i=Object.assign({},this.getDefinition()),i=Object.assign(i,e),this.table.columnManager.addColumn(i,!1,this).then(n=>(i.field==this.field&&(this.field=!1),this.delete().then(()=>n.getComponent()))))}deleteCell(e){var i=this.cells.indexOf(e);i>-1&&this.cells.splice(i,1)}getComponent(){return this.component||(this.component=new m1e(this)),this.component}getPosition(){return this.table.columnManager.getVisibleColumnsByIndex().indexOf(this)+1}getParentComponent(){return this.parent instanceof Pb?this.parent.getComponent():!1}};et(Pb,"defaultOptionList",g1e);let iI=Pb;class D2{constructor(e){return this._row=e,new Proxy(this,{get:function(i,n,r){return typeof i[n]<"u"?i[n]:i._row.table.componentFunctionBinder.handle("row",i._row,n)}})}getData(e){return this._row.getData(e)}getElement(){return this._row.getElement()}getCells(){var e=[];return this._row.getCells().forEach(function(i){e.push(i.getComponent())}),e}getCell(e){var i=this._row.getCell(e);return i?i.getComponent():!1}getIndex(){return this._row.getData("data")[this._row.table.options.index]}getPosition(){return this._row.getPosition()}watchPosition(e){return this._row.watchPosition(e)}delete(){return this._row.delete()}scrollTo(e,i){return this._row.table.rowManager.scrollToRow(this._row,e,i)}move(e,i){this._row.moveToRow(e,i)}update(e){return this._row.updateData(e)}normalizeHeight(){this._row.normalizeHeight(!0)}_getSelf(){return this._row}reformat(){return this._row.reinitialize()}getTable(){return this._row.table}getNextRow(){var e=this._row.nextRow();return e&&e.getComponent()}getPrevRow(){var e=this._row.prevRow();return e&&e.getComponent()}}class xc extends bc{constructor(e,i,n="row"){super(i.table),this.parent=i,this.data={},this.type=n,this.element=!1,this.modules={},this.cells=[],this.height=0,this.heightStyled="",this.manualHeight=!1,this.outerHeight=0,this.initialized=!1,this.heightInitialized=!1,this.position=0,this.positionWatchers=[],this.component=null,this.created=!1,this.setData(e)}create(){this.created||(this.created=!0,this.generateElement())}createElement(){var e=document.createElement("div");e.classList.add("tabulator-row"),e.setAttribute("role","row"),this.element=e}getElement(){return this.create(),this.element}detachElement(){this.element&&this.element.parentNode&&this.element.parentNode.removeChild(this.element)}generateElement(){this.createElement(),this.dispatch("row-init",this)}generateCells(){this.cells=this.table.columnManager.generateCells(this)}initialize(e,i){if(this.create(),!this.initialized||e){for(this.deleteCells();this.element.firstChild;)this.element.removeChild(this.element.firstChild);this.dispatch("row-layout-before",this),this.generateCells(),this.initialized=!0,this.table.columnManager.renderer.renderRowCells(this,i),e&&this.normalizeHeight(),this.dispatch("row-layout",this),this.table.options.rowFormatter&&this.table.options.rowFormatter(this.getComponent()),this.dispatch("row-layout-after",this)}else this.table.columnManager.renderer.rerenderRowCells(this,i)}rendered(){this.cells.forEach(e=>{e.cellRendered()})}reinitializeHeight(){this.heightInitialized=!1,this.element&&this.element.offsetParent!==null&&this.normalizeHeight(!0)}deinitialize(){this.initialized=!1}deinitializeHeight(){this.heightInitialized=!1}reinitialize(e){this.initialized=!1,this.heightInitialized=!1,this.manualHeight||(this.height=0,this.heightStyled=""),this.element&&this.element.offsetParent!==null&&this.initialize(!0),this.dispatch("row-relayout",this)}calcHeight(e){var i=0,n=0;this.table.options.rowHeight?this.height=this.table.options.rowHeight:(n=this.calcMinHeight(),i=this.calcMaxHeight(),e?this.height=Math.max(i,n):this.height=this.manualHeight?this.height:Math.max(i,n)),this.heightStyled=this.height?this.height+"px":"",this.outerHeight=this.element.offsetHeight}calcMinHeight(){return this.table.options.resizableRows?this.element.clientHeight:0}calcMaxHeight(){var e=0;return this.cells.forEach(function(i){var n=i.getHeight();n>e&&(e=n)}),e}setCellHeight(){this.cells.forEach(function(e){e.setHeight()}),this.heightInitialized=!0}clearCellHeight(){this.cells.forEach(function(e){e.clearHeight()})}normalizeHeight(e){e&&!this.table.options.rowHeight&&this.clearCellHeight(),this.calcHeight(e),this.setCellHeight()}setHeight(e,i){(this.height!=e||i)&&(this.manualHeight=!0,this.height=e,this.heightStyled=e?e+"px":"",this.setCellHeight(),this.outerHeight=this.element.offsetHeight,this.subscribedExternal("rowHeight")&&this.dispatchExternal("rowHeight",this.getComponent()))}getHeight(){return this.outerHeight}getWidth(){return this.element.offsetWidth}deleteCell(e){var i=this.cells.indexOf(e);i>-1&&this.cells.splice(i,1)}setData(e){this.data=this.chain("row-data-init-before",[this,e],void 0,e),this.dispatch("row-data-init-after",this)}updateData(e){var i=this.element&&Ha.elVisible(this.element),n={},r;return new Promise((a,s)=>{typeof e=="string"&&(e=JSON.parse(e)),this.dispatch("row-data-save-before",this),this.subscribed("row-data-changing")&&(n=Object.assign(n,this.data),n=Object.assign(n,e)),r=this.chain("row-data-changing",[this,n,e],null,e);for(let o in r)this.data[o]=r[o];this.dispatch("row-data-save-after",this);for(let o in e)this.table.columnManager.getColumnsByFieldRoot(o).forEach(c=>{let u=this.getCell(c.getField());if(u){let d=c.getFieldValue(r);u.getValue()!==d&&(u.setValueProcessData(d),i&&u.cellRendered())}});i?(this.normalizeHeight(!0),this.table.options.rowFormatter&&this.table.options.rowFormatter(this.getComponent())):(this.initialized=!1,this.height=0,this.heightStyled=""),this.dispatch("row-data-changed",this,i,e),this.dispatchExternal("rowUpdated",this.getComponent()),this.subscribedExternal("dataChanged")&&this.dispatchExternal("dataChanged",this.table.rowManager.getData()),a()})}getData(e){return e?this.chain("row-data-retrieve",[this,e],null,this.data):this.data}getCell(e){var i=!1;return e=this.table.columnManager.findColumn(e),!this.initialized&&this.cells.length===0&&this.generateCells(),i=this.cells.find(function(n){return n.column===e}),i}getCellIndex(e){return this.cells.findIndex(function(i){return i===e})}findCell(e){return this.cells.find(i=>i.element===e)}getCells(){return!this.initialized&&this.cells.length===0&&this.generateCells(),this.cells}nextRow(){var e=this.table.rowManager.nextDisplayRow(this,!0);return e||!1}prevRow(){var e=this.table.rowManager.prevDisplayRow(this,!0);return e||!1}moveToRow(e,i){var n=this.table.rowManager.findRow(e);n?(this.table.rowManager.moveRowActual(this,n,!i),this.table.rowManager.refreshActiveData("display",!1,!0)):console.warn("Move Error - No matching row found:",e)}delete(){return this.dispatch("row-delete",this),this.deleteActual(),Promise.resolve()}deleteActual(e){this.detachModules(),this.table.rowManager.deleteRow(this,e),this.deleteCells(),this.initialized=!1,this.heightInitialized=!1,this.element=!1,this.dispatch("row-deleted",this)}detachModules(){this.dispatch("row-deleting",this)}deleteCells(){var e=this.cells.length;for(let i=0;i<e;i++)this.cells[0].delete()}wipe(){if(this.detachModules(),this.deleteCells(),this.element){for(;this.element.firstChild;)this.element.removeChild(this.element.firstChild);this.element.parentNode&&this.element.parentNode.removeChild(this.element)}this.element=!1,this.modules={}}isDisplayed(){return this.table.rowManager.getDisplayRows().includes(this)}getPosition(){return this.isDisplayed()?this.position:!1}setPosition(e){e!=this.position&&(this.position=e,this.positionWatchers.forEach(i=>{i(this.position)}))}watchPosition(e){this.positionWatchers.push(e),e(this.position)}getGroup(){return this.modules.group||!1}getComponent(){return this.component||(this.component=new D2(this)),this.component}}var lXe={avg:function(t,e,i){var n=0,r=typeof i.precision<"u"?i.precision:2;return t.length&&(n=t.reduce(function(a,s){return Number(a)+Number(s)}),n=n/t.length,n=r!==!1?n.toFixed(r):n),parseFloat(n).toString()},max:function(t,e,i){var n=null,r=typeof i.precision<"u"?i.precision:!1;return t.forEach(function(a){a=Number(a),(a>n||n===null)&&(n=a)}),n!==null?r!==!1?n.toFixed(r):n:""},min:function(t,e,i){var n=null,r=typeof i.precision<"u"?i.precision:!1;return t.forEach(function(a){a=Number(a),(a<n||n===null)&&(n=a)}),n!==null?r!==!1?n.toFixed(r):n:""},sum:function(t,e,i){var n=0,r=typeof i.precision<"u"?i.precision:!1;return t.length&&t.forEach(function(a){a=Number(a),n+=isNaN(a)?0:Number(a)}),r!==!1?n.toFixed(r):n},concat:function(t,e,i){var n=0;return t.length&&(n=t.reduce(function(r,a){return String(r)+String(a)})),n},count:function(t,e,i){var n=0;return t.length&&t.forEach(function(r){r&&n++}),n},unique:function(t,e,i){var n=t.filter((r,a)=>(t||r===0)&&t.indexOf(r)===a);return n.length}};const Nv=class Nv extends qn{constructor(e){super(e),this.topCalcs=[],this.botCalcs=[],this.genColumn=!1,this.topElement=this.createElement(),this.botElement=this.createElement(),this.topRow=!1,this.botRow=!1,this.topInitialized=!1,this.botInitialized=!1,this.blocked=!1,this.recalcAfterBlock=!1,this.registerTableOption("columnCalcs",!0),this.registerColumnOption("topCalc"),this.registerColumnOption("topCalcParams"),this.registerColumnOption("topCalcFormatter"),this.registerColumnOption("topCalcFormatterParams"),this.registerColumnOption("bottomCalc"),this.registerColumnOption("bottomCalcParams"),this.registerColumnOption("bottomCalcFormatter"),this.registerColumnOption("bottomCalcFormatterParams")}createElement(){var e=document.createElement("div");return e.classList.add("tabulator-calcs-holder"),e}initialize(){this.genColumn=new iI({field:"value"},this),this.subscribe("cell-value-changed",this.cellValueChanged.bind(this)),this.subscribe("column-init",this.initializeColumnCheck.bind(this)),this.subscribe("row-deleted",this.rowsUpdated.bind(this)),this.subscribe("scroll-horizontal",this.scrollHorizontal.bind(this)),this.subscribe("row-added",this.rowsUpdated.bind(this)),this.subscribe("column-moved",this.recalcActiveRows.bind(this)),this.subscribe("column-add",this.recalcActiveRows.bind(this)),this.subscribe("data-refreshed",this.recalcActiveRowsRefresh.bind(this)),this.subscribe("table-redraw",this.tableRedraw.bind(this)),this.subscribe("rows-visible",this.visibleRows.bind(this)),this.subscribe("scrollbar-vertical",this.adjustForScrollbar.bind(this)),this.subscribe("redraw-blocked",this.blockRedraw.bind(this)),this.subscribe("redraw-restored",this.restoreRedraw.bind(this)),this.subscribe("table-redrawing",this.resizeHolderWidth.bind(this)),this.subscribe("column-resized",this.resizeHolderWidth.bind(this)),this.subscribe("column-show",this.resizeHolderWidth.bind(this)),this.subscribe("column-hide",this.resizeHolderWidth.bind(this)),this.registerTableFunction("getCalcResults",this.getResults.bind(this)),this.registerTableFunction("recalc",this.userRecalc.bind(this)),this.resizeHolderWidth()}resizeHolderWidth(){this.topElement.style.minWidth=this.table.columnManager.headersElement.offsetWidth+"px"}tableRedraw(e){this.recalc(this.table.rowManager.activeRows),e&&this.redraw()}blockRedraw(){this.blocked=!0,this.recalcAfterBlock=!1}restoreRedraw(){this.blocked=!1,this.recalcAfterBlock&&(this.recalcAfterBlock=!1,this.recalcActiveRowsRefresh())}userRecalc(){this.recalc(this.table.rowManager.activeRows)}blockCheck(){return this.blocked&&(this.recalcAfterBlock=!0),this.blocked}visibleRows(e,i){return this.topRow&&i.unshift(this.topRow),this.botRow&&i.push(this.botRow),i}rowsUpdated(e){this.table.options.groupBy?this.recalcRowGroup(e):this.recalcActiveRows()}recalcActiveRowsRefresh(){this.table.options.groupBy&&this.table.options.dataTreeStartExpanded&&this.table.options.dataTree?this.recalcAll():this.recalcActiveRows()}recalcActiveRows(){this.recalc(this.table.rowManager.activeRows)}cellValueChanged(e){(e.column.definition.topCalc||e.column.definition.bottomCalc)&&(this.table.options.groupBy?((this.table.options.columnCalcs=="table"||this.table.options.columnCalcs=="both")&&this.recalcActiveRows(),this.table.options.columnCalcs!="table"&&this.recalcRowGroup(e.row)):this.recalcActiveRows())}initializeColumnCheck(e){(e.definition.topCalc||e.definition.bottomCalc)&&this.initializeColumn(e)}initializeColumn(e){var i=e.definition,n={topCalcParams:i.topCalcParams||{},botCalcParams:i.bottomCalcParams||{}};if(i.topCalc){switch(typeof i.topCalc){case"string":Nv.calculations[i.topCalc]?n.topCalc=Nv.calculations[i.topCalc]:console.warn("Column Calc Error - No such calculation found, ignoring: ",i.topCalc);break;case"function":n.topCalc=i.topCalc;break}n.topCalc&&(e.modules.columnCalcs=n,this.topCalcs.push(e),this.table.options.columnCalcs!="group"&&this.initializeTopRow())}if(i.bottomCalc){switch(typeof i.bottomCalc){case"string":Nv.calculations[i.bottomCalc]?n.botCalc=Nv.calculations[i.bottomCalc]:console.warn("Column Calc Error - No such calculation found, ignoring: ",i.bottomCalc);break;case"function":n.botCalc=i.bottomCalc;break}n.botCalc&&(e.modules.columnCalcs=n,this.botCalcs.push(e),this.table.options.columnCalcs!="group"&&this.initializeBottomRow())}}registerColumnField(){}removeCalcs(){var e=!1;this.topInitialized&&(this.topInitialized=!1,this.topElement.parentNode.removeChild(this.topElement),e=!0),this.botInitialized&&(this.botInitialized=!1,this.footerRemove(this.botElement),e=!0),e&&this.table.rowManager.adjustTableSize()}reinitializeCalcs(){this.topCalcs.length&&this.initializeTopRow(),this.botCalcs.length&&this.initializeBottomRow()}initializeTopRow(){var e=document.createDocumentFragment();this.topInitialized||(e.appendChild(document.createElement("br")),e.appendChild(this.topElement),this.table.columnManager.getContentsElement().insertBefore(e,this.table.columnManager.headersElement.nextSibling),this.topInitialized=!0)}initializeBottomRow(){this.botInitialized||(this.footerPrepend(this.botElement),this.botInitialized=!0)}scrollHorizontal(e){this.botInitialized&&this.botRow&&(this.botElement.scrollLeft=e)}recalc(e){var i,n;if(!this.blockCheck()&&(this.topInitialized||this.botInitialized)){if(i=this.rowsToData(e),this.topInitialized){for(this.topRow&&this.topRow.deleteCells(),n=this.generateRow("top",i),this.topRow=n;this.topElement.firstChild;)this.topElement.removeChild(this.topElement.firstChild);this.topElement.appendChild(n.getElement()),n.initialize(!0)}if(this.botInitialized){for(this.botRow&&this.botRow.deleteCells(),n=this.generateRow("bottom",i),this.botRow=n;this.botElement.firstChild;)this.botElement.removeChild(this.botElement.firstChild);this.botElement.appendChild(n.getElement()),n.initialize(!0)}this.table.rowManager.adjustTableSize(),this.table.modExists("frozenColumns")&&this.table.modules.frozenColumns.layout()}}recalcRowGroup(e){this.recalcGroup(this.table.modules.groupRows.getRowGroup(e))}recalcAll(){if((this.topCalcs.length||this.botCalcs.length)&&(this.table.options.columnCalcs!=="group"&&this.recalcActiveRows(),this.table.options.groupBy&&this.table.options.columnCalcs!=="table")){var e=this.table.modules.groupRows.getChildGroups();e.forEach(i=>{this.recalcGroup(i)})}}recalcGroup(e){var i,n;this.blockCheck()||e&&e.calcs&&(e.calcs.bottom&&(i=this.rowsToData(e.rows),n=this.generateRowData("bottom",i),e.calcs.bottom.updateData(n),e.calcs.bottom.reinitialize()),e.calcs.top&&(i=this.rowsToData(e.rows),n=this.generateRowData("top",i),e.calcs.top.updateData(n),e.calcs.top.reinitialize()))}generateTopRow(e){return this.generateRow("top",this.rowsToData(e))}generateBottomRow(e){return this.generateRow("bottom",this.rowsToData(e))}rowsToData(e){var i=[],n=this.table.options.dataTree&&this.table.options.dataTreeChildColumnCalcs,r=this.table.modules.dataTree;return e.forEach(a=>{var s;i.push(a.getData()),n&&((s=a.modules.dataTree)!=null&&s.open)&&this.rowsToData(r.getFilteredTreeChildren(a)).forEach(o=>{i.push(a)})}),i}generateRow(e,i){var n=this.generateRowData(e,i),r;return this.table.modExists("mutator")&&this.table.modules.mutator.disable(),r=new xc(n,this,"calc"),this.table.modExists("mutator")&&this.table.modules.mutator.enable(),r.getElement().classList.add("tabulator-calcs","tabulator-calcs-"+e),r.component=!1,r.getComponent=()=>(r.component||(r.component=new oXe(r)),r.component),r.generateCells=()=>{var a=[];this.table.columnManager.columnsByIndex.forEach(s=>{this.genColumn.setField(s.getField()),this.genColumn.hozAlign=s.hozAlign,s.definition[e+"CalcFormatter"]&&this.table.modExists("format")?this.genColumn.modules.format={formatter:this.table.modules.format.getFormatter(s.definition[e+"CalcFormatter"]),params:s.definition[e+"CalcFormatterParams"]||{}}:this.genColumn.modules.format={formatter:this.table.modules.format.getFormatter("plaintext"),params:{}},this.genColumn.definition.cssClass=s.definition.cssClass;var o=new vM(this.genColumn,r);o.getElement(),o.column=s,o.setWidth(),s.cells.push(o),a.push(o),s.visible||o.hide()}),r.cells=a},r}generateRowData(e,i){var n={},r=e=="top"?this.topCalcs:this.botCalcs,a=e=="top"?"topCalc":"botCalc",s,o;return r.forEach(function(l){var c=[];l.modules.columnCalcs&&l.modules.columnCalcs[a]&&(i.forEach(function(u){c.push(l.getFieldValue(u))}),o=a+"Params",s=typeof l.modules.columnCalcs[o]=="function"?l.modules.columnCalcs[o](c,i):l.modules.columnCalcs[o],l.setFieldValue(n,l.modules.columnCalcs[a](c,i,s)))}),n}hasTopCalcs(){return!!this.topCalcs.length}hasBottomCalcs(){return!!this.botCalcs.length}redraw(){this.topRow&&this.topRow.normalizeHeight(!0),this.botRow&&this.botRow.normalizeHeight(!0)}getResults(){var e={},i;return this.table.options.groupBy&&this.table.modExists("groupRows")?(i=this.table.modules.groupRows.getGroups(!0),i.forEach(n=>{e[n.getKey()]=this.getGroupResults(n)})):e={top:this.topRow?this.topRow.getData():{},bottom:this.botRow?this.botRow.getData():{}},e}getGroupResults(e){var i=e._getSelf(),n=e.getSubGroups(),r={},a={};return n.forEach(s=>{r[s.getKey()]=this.getGroupResults(s)}),a={top:i.calcs.top?i.calcs.top.getData():{},bottom:i.calcs.bottom?i.calcs.bottom.getData():{},groups:r},a}adjustForScrollbar(e){this.botRow&&(this.table.rtl?this.botElement.style.paddingLeft=e+"px":this.botElement.style.paddingRight=e+"px")}};et(Nv,"moduleName","columnCalcs"),et(Nv,"calculations",lXe);let OG=Nv;class v1e extends qn{constructor(e){super(e),this.indent=10,this.field="",this.collapseEl=null,this.expandEl=null,this.branchEl=null,this.elementField=!1,this.startOpen=function(){},this.registerTableOption("dataTree",!1),this.registerTableOption("dataTreeFilter",!0),this.registerTableOption("dataTreeSort",!0),this.registerTableOption("dataTreeElementColumn",!1),this.registerTableOption("dataTreeBranchElement",!0),this.registerTableOption("dataTreeChildIndent",9),this.registerTableOption("dataTreeChildField","_children"),this.registerTableOption("dataTreeCollapseElement",!1),this.registerTableOption("dataTreeExpandElement",!1),this.registerTableOption("dataTreeStartExpanded",!1),this.registerTableOption("dataTreeChildColumnCalcs",!1),this.registerTableOption("dataTreeSelectPropagate",!1),this.registerComponentFunction("row","treeCollapse",this.collapseRow.bind(this)),this.registerComponentFunction("row","treeExpand",this.expandRow.bind(this)),this.registerComponentFunction("row","treeToggle",this.toggleRow.bind(this)),this.registerComponentFunction("row","getTreeParent",this.getTreeParent.bind(this)),this.registerComponentFunction("row","getTreeChildren",this.getRowChildren.bind(this)),this.registerComponentFunction("row","addTreeChild",this.addTreeChildRow.bind(this)),this.registerComponentFunction("row","isTreeExpanded",this.isRowExpanded.bind(this))}initialize(){if(this.table.options.dataTree){var e=null,i=this.table.options;switch(this.field=i.dataTreeChildField,this.indent=i.dataTreeChildIndent,this.options("movableRows")&&console.warn("The movableRows option is not available with dataTree enabled, moving of child rows could result in unpredictable behavior"),i.dataTreeBranchElement?i.dataTreeBranchElement===!0?(this.branchEl=document.createElement("div"),this.branchEl.classList.add("tabulator-data-tree-branch")):typeof i.dataTreeBranchElement=="string"?(e=document.createElement("div"),e.innerHTML=i.dataTreeBranchElement,this.branchEl=e.firstChild):this.branchEl=i.dataTreeBranchElement:(this.branchEl=document.createElement("div"),this.branchEl.classList.add("tabulator-data-tree-branch-empty")),i.dataTreeCollapseElement?typeof i.dataTreeCollapseElement=="string"?(e=document.createElement("div"),e.innerHTML=i.dataTreeCollapseElement,this.collapseEl=e.firstChild):this.collapseEl=i.dataTreeCollapseElement:(this.collapseEl=document.createElement("div"),this.collapseEl.classList.add("tabulator-data-tree-control"),this.collapseEl.tabIndex=0,this.collapseEl.innerHTML="<div class='tabulator-data-tree-control-collapse'></div>"),i.dataTreeExpandElement?typeof i.dataTreeExpandElement=="string"?(e=document.createElement("div"),e.innerHTML=i.dataTreeExpandElement,this.expandEl=e.firstChild):this.expandEl=i.dataTreeExpandElement:(this.expandEl=document.createElement("div"),this.expandEl.classList.add("tabulator-data-tree-control"),this.expandEl.tabIndex=0,this.expandEl.innerHTML="<div class='tabulator-data-tree-control-expand'></div>"),typeof i.dataTreeStartExpanded){case"boolean":this.startOpen=function(n,r){return i.dataTreeStartExpanded};break;case"function":this.startOpen=i.dataTreeStartExpanded;break;default:this.startOpen=function(n,r){return i.dataTreeStartExpanded[r]};break}this.subscribe("row-init",this.initializeRow.bind(this)),this.subscribe("row-layout-after",this.layoutRow.bind(this)),this.subscribe("row-deleted",this.rowDelete.bind(this),0),this.subscribe("row-data-changed",this.rowDataChanged.bind(this),10),this.subscribe("cell-value-updated",this.cellValueChanged.bind(this)),this.subscribe("edit-cancelled",this.cellValueChanged.bind(this)),this.subscribe("column-moving-rows",this.columnMoving.bind(this)),this.subscribe("table-built",this.initializeElementField.bind(this)),this.subscribe("table-redrawing",this.tableRedrawing.bind(this)),this.registerDisplayHandler(this.getRows.bind(this),30)}}tableRedrawing(e){var i;e&&(i=this.table.rowManager.getRows(),i.forEach(n=>{this.reinitializeRowChildren(n)}))}initializeElementField(){var e=this.table.columnManager.getFirstVisibleColumn();this.elementField=this.table.options.dataTreeElementColumn||(e?e.field:!1)}getRowChildren(e){return this.getTreeChildren(e,!0)}columnMoving(){var e=[];return this.table.rowManager.rows.forEach(i=>{e=e.concat(this.getTreeChildren(i,!1,!0))}),e}rowDataChanged(e,i,n){this.redrawNeeded(n)&&(this.initializeRow(e),i&&(this.layoutRow(e),this.refreshData(!0)))}cellValueChanged(e){var i=e.column.getField();i===this.elementField&&this.layoutRow(e.row)}initializeRow(e){var i=e.getData()[this.field],n=Array.isArray(i),r=n||!n&&typeof i=="object"&&i!==null;!r&&e.modules.dataTree&&e.modules.dataTree.branchEl&&e.modules.dataTree.branchEl.parentNode.removeChild(e.modules.dataTree.branchEl),!r&&e.modules.dataTree&&e.modules.dataTree.controlEl&&e.modules.dataTree.controlEl.parentNode.removeChild(e.modules.dataTree.controlEl),e.modules.dataTree={index:e.modules.dataTree?e.modules.dataTree.index:0,open:r?e.modules.dataTree?e.modules.dataTree.open:this.startOpen(e.getComponent(),0):!1,controlEl:e.modules.dataTree&&r?e.modules.dataTree.controlEl:!1,branchEl:e.modules.dataTree&&r?e.modules.dataTree.branchEl:!1,parent:e.modules.dataTree?e.modules.dataTree.parent:!1,children:r}}reinitializeRowChildren(e){var i=this.getTreeChildren(e,!1,!0);i.forEach(function(n){n.reinitialize(!0)})}layoutRow(e){var i=this.elementField?e.getCell(this.elementField):e.getCells()[0],n=i.getElement(),r=e.modules.dataTree;r.branchEl&&(r.branchEl.parentNode&&r.branchEl.parentNode.removeChild(r.branchEl),r.branchEl=!1),r.controlEl&&(r.controlEl.parentNode&&r.controlEl.parentNode.removeChild(r.controlEl),r.controlEl=!1),this.generateControlElement(e,n),e.getElement().classList.add("tabulator-tree-level-"+r.index),r.index&&(this.branchEl?(r.branchEl=this.branchEl.cloneNode(!0),n.insertBefore(r.branchEl,n.firstChild),this.table.rtl?r.branchEl.style.marginRight=(r.branchEl.offsetWidth+r.branchEl.style.marginLeft)*(r.index-1)+r.index*this.indent+"px":r.branchEl.style.marginLeft=(r.branchEl.offsetWidth+r.branchEl.style.marginRight)*(r.index-1)+r.index*this.indent+"px"):this.table.rtl?n.style.paddingRight=parseInt(window.getComputedStyle(n,null).getPropertyValue("padding-right"))+r.index*this.indent+"px":n.style.paddingLeft=parseInt(window.getComputedStyle(n,null).getPropertyValue("padding-left"))+r.index*this.indent+"px")}generateControlElement(e,i){var n=e.modules.dataTree,r=n.controlEl;i=i||e.getCells()[0].getElement(),n.children!==!1&&(n.open?(n.controlEl=this.collapseEl.cloneNode(!0),n.controlEl.addEventListener("click",a=>{a.stopPropagation(),this.collapseRow(e)})):(n.controlEl=this.expandEl.cloneNode(!0),n.controlEl.addEventListener("click",a=>{a.stopPropagation(),this.expandRow(e)})),n.controlEl.addEventListener("mousedown",a=>{a.stopPropagation()}),r&&r.parentNode===i?r.parentNode.replaceChild(n.controlEl,r):i.insertBefore(n.controlEl,i.firstChild))}getRows(e){var i=[];return e.forEach((n,r)=>{var a,s;i.push(n),n instanceof xc&&(n.create(),a=n.modules.dataTree,!a.index&&a.children!==!1&&(s=this.getChildren(n,!1,!0),s.forEach(o=>{o.create(),i.push(o)})))}),i}getChildren(e,i,n){var r=e.modules.dataTree,a=[],s=[];return r.children!==!1&&(r.open||i)&&(Array.isArray(r.children)||(r.children=this.generateChildren(e)),this.table.modExists("filter")&&this.table.options.dataTreeFilter?a=this.table.modules.filter.filter(r.children):a=r.children,this.table.modExists("sort")&&this.table.options.dataTreeSort&&this.table.modules.sort.sort(a,n),a.forEach(o=>{s.push(o);var l=this.getChildren(o,!1,!0);l.forEach(c=>{s.push(c)})})),s}generateChildren(e){var i=[],n=e.getData()[this.field];return Array.isArray(n)||(n=[n]),n.forEach(r=>{var a=new xc(r||{},this.table.rowManager);a.create(),a.modules.dataTree.index=e.modules.dataTree.index+1,a.modules.dataTree.parent=e,a.modules.dataTree.children&&(a.modules.dataTree.open=this.startOpen(a.getComponent(),a.modules.dataTree.index)),i.push(a)}),i}expandRow(e,i){var n=e.modules.dataTree;n.children!==!1&&(n.open=!0,e.reinitialize(),this.refreshData(!0),this.dispatchExternal("dataTreeRowExpanded",e.getComponent(),e.modules.dataTree.index))}collapseRow(e){var i=e.modules.dataTree;i.children!==!1&&(i.open=!1,e.reinitialize(),this.refreshData(!0),this.dispatchExternal("dataTreeRowCollapsed",e.getComponent(),e.modules.dataTree.index))}toggleRow(e){var i=e.modules.dataTree;i.children!==!1&&(i.open?this.collapseRow(e):this.expandRow(e))}isRowExpanded(e){return e.modules.dataTree.open}getTreeParent(e){return e.modules.dataTree.parent?e.modules.dataTree.parent.getComponent():!1}getTreeParentRoot(e){return e.modules.dataTree&&e.modules.dataTree.parent?this.getTreeParentRoot(e.modules.dataTree.parent):e}getFilteredTreeChildren(e){var i=e.modules.dataTree,n=[],r;return i.children&&(Array.isArray(i.children)||(i.children=this.generateChildren(e)),this.table.modExists("filter")&&this.table.options.dataTreeFilter?r=this.table.modules.filter.filter(i.children):r=i.children,r.forEach(a=>{a instanceof xc&&n.push(a)})),n}rowDelete(e){var i=e.modules.dataTree.parent,n;i&&(n=this.findChildIndex(e,i),n!==!1&&i.data[this.field].splice(n,1),i.data[this.field].length||delete i.data[this.field],this.initializeRow(i),this.layoutRow(i)),this.refreshData(!0)}addTreeChildRow(e,i,n,r){var a=!1;typeof i=="string"&&(i=JSON.parse(i)),Array.isArray(e.data[this.field])||(e.data[this.field]=[],e.modules.dataTree.open=this.startOpen(e.getComponent(),e.modules.dataTree.index)),typeof r<"u"&&(a=this.findChildIndex(r,e),a!==!1&&e.data[this.field].splice(n?a:a+1,0,i)),a===!1&&(n?e.data[this.field].unshift(i):e.data[this.field].push(i)),this.initializeRow(e),this.layoutRow(e),this.refreshData(!0)}findChildIndex(e,i){var n=!1;return typeof e=="object"?e instanceof xc?n=e.data:e instanceof D2?n=e._getSelf().data:typeof HTMLElement<"u"&&e instanceof HTMLElement?i.modules.dataTree&&(n=i.modules.dataTree.children.find(r=>r instanceof xc?r.element===e:!1),n&&(n=n.data)):e===null&&(n=!1):typeof e>"u"?n=!1:n=i.data[this.field].find(r=>r.data[this.table.options.index]==e),n&&(Array.isArray(i.data[this.field])&&(n=i.data[this.field].indexOf(n)),n==-1&&(n=!1)),n}getTreeChildren(e,i,n){var r=e.modules.dataTree,a=[];return r&&r.children&&(Array.isArray(r.children)||(r.children=this.generateChildren(e)),r.children.forEach(s=>{s instanceof xc&&(a.push(i?s.getComponent():s),n&&this.getTreeChildren(s,i,n).forEach(o=>{a.push(o)}))})),a}getChildField(){return this.field}redrawNeeded(e){return(this.field?typeof e[this.field]<"u":!1)||(this.elementField?typeof e[this.elementField]<"u":!1)}}et(v1e,"moduleName","dataTree");function cXe(t,e={},i){var n=e.delimiter?e.delimiter:",",r=[],a=[];t.forEach(s=>{var o=[];switch(s.type){case"group":console.warn("Download Warning - CSV downloader cannot process row groups");break;case"calc":console.warn("Download Warning - CSV downloader cannot process column calculations");break;case"header":s.columns.forEach((l,c)=>{l&&l.depth===1&&(a[c]=typeof l.value>"u"||l.value===null?"":'"'+String(l.value).split('"').join('""')+'"')});break;case"row":s.columns.forEach(l=>{if(l){switch(typeof l.value){case"object":l.value=l.value!==null?JSON.stringify(l.value):"";break;case"undefined":l.value="";break}o.push('"'+String(l.value).split('"').join('""')+'"')}}),r.push(o.join(n));break}}),a.length&&r.unshift(a.join(n)),r=r.join(`
`),e.bom&&(r="\uFEFF"+r),i(r,"text/csv")}function uXe(t,e,i){var n=[];t.forEach(r=>{var a={};switch(r.type){case"header":break;case"group":console.warn("Download Warning - JSON downloader cannot process row groups");break;case"calc":console.warn("Download Warning - JSON downloader cannot process column calculations");break;case"row":r.columns.forEach(s=>{s&&(a[s.component.getTitleDownload()||s.component.getField()]=s.value)}),n.push(a);break}}),n=JSON.stringify(n,null,"	"),i(n,"application/json")}function dXe(t,e={},i){var n=[],r=[],a={},s=e.rowGroupStyles||{fontStyle:"bold",fontSize:12,cellPadding:6,fillColor:220},o=e.rowCalcStyles||{fontStyle:"bold",fontSize:10,cellPadding:4,fillColor:232},l=e.jsPDF||{},c=e.title?e.title:"";l.orientation||(l.orientation=e.orientation||"landscape"),l.unit||(l.unit="pt"),t.forEach(p=>{switch(p.type){case"header":n.push(u(p));break;case"group":r.push(u(p,s));break;case"calc":r.push(u(p,o));break;case"row":r.push(u(p));break}});function u(p,h){var f=[];return p.columns.forEach(m=>{var g;if(m){switch(typeof m.value){case"object":m.value=m.value!==null?JSON.stringify(m.value):"";break;case"undefined":m.value="";break}g={content:m.value,colSpan:m.width,rowSpan:m.height},h&&(g.styles=h),f.push(g)}}),f}var d=new jspdf.jsPDF(l);e.autoTable&&(typeof e.autoTable=="function"?a=e.autoTable(d)||{}:a=e.autoTable),c&&(a.didDrawPage=function(p){d.text(c,40,30)}),a.head=n,a.body=r,d.autoTable(a),e.documentProcessing&&e.documentProcessing(d),i(d.output("arraybuffer"),"application/pdf")}function pXe(t,e,i){var n=this,r=e.sheetName||"Sheet1",a=XLSX.utils.book_new(),s=new bc(this),o="compress"in e?e.compress:!0,l=e.writeOptions||{bookType:"xlsx",bookSST:!0,compression:o},c;l.type="binary",a.SheetNames=[],a.Sheets={};function u(){var h=[],f=[],m={},g={s:{c:0,r:0},e:{c:t[0]?t[0].columns.reduce((v,y)=>v+(y&&y.width?y.width:1),0):0,r:t.length}};return t.forEach((v,y)=>{var b=[];v.columns.forEach(function(I,T){I?(b.push(!(I.value instanceof Date)&&typeof I.value=="object"?JSON.stringify(I.value):I.value),(I.width>1||I.height>-1)&&(I.height>1||I.width>1)&&f.push({s:{r:y,c:T},e:{r:y+I.height-1,c:T+I.width-1}})):b.push("")}),h.push(b)}),XLSX.utils.sheet_add_aoa(m,h),m["!ref"]=XLSX.utils.encode_range(g),f.length&&(m["!merges"]=f),m}if(e.sheetOnly){i(u());return}if(e.sheets)for(var d in e.sheets)e.sheets[d]===!0?(a.SheetNames.push(d),a.Sheets[d]=u()):(a.SheetNames.push(d),s.commsSend(e.sheets[d],"download","intercept",{type:"xlsx",options:{sheetOnly:!0},active:n.active,intercept:function(h){a.Sheets[d]=h}}));else a.SheetNames.push(r),a.Sheets[r]=u();e.documentProcessing&&(a=e.documentProcessing(a));function p(h){for(var f=new ArrayBuffer(h.length),m=new Uint8Array(f),g=0;g!=h.length;++g)m[g]=h.charCodeAt(g)&255;return f}c=XLSX.write(a,l),i(p(c),"application/octet-stream")}function hXe(t,e,i){this.modExists("export",!0)&&i(this.modules.export.generateHTMLTable(t),"text/html")}function fXe(t,e,i){const n=[];t.forEach(r=>{const a={};switch(r.type){case"header":break;case"group":console.warn("Download Warning - JSON downloader cannot process row groups");break;case"calc":console.warn("Download Warning - JSON downloader cannot process column calculations");break;case"row":r.columns.forEach(s=>{s&&(a[s.component.getTitleDownload()||s.component.getField()]=s.value)}),n.push(JSON.stringify(a));break}}),i(n.join(`
`),"application/x-ndjson")}var mXe={csv:cXe,json:uXe,jsonLines:fXe,pdf:dXe,xlsx:pXe,html:hXe};const oS=class oS extends qn{constructor(e){super(e),this.registerTableOption("downloadEncoder",function(i,n){return new Blob([i],{type:n})}),this.registerTableOption("downloadConfig",{}),this.registerTableOption("downloadRowRange","active"),this.registerColumnOption("download"),this.registerColumnOption("titleDownload")}initialize(){this.deprecatedOptionsCheck(),this.registerTableFunction("download",this.download.bind(this)),this.registerTableFunction("downloadToTab",this.downloadToTab.bind(this))}deprecatedOptionsCheck(){}downloadToTab(e,i,n,r){this.download(e,i,n,r,!0)}download(e,i,n,r,a){var s=!1;function o(c,u){a?a===!0?this.triggerDownload(c,u,e,i,!0):a(c):this.triggerDownload(c,u,e,i)}if(typeof e=="function"?s=e:oS.downloaders[e]?s=oS.downloaders[e]:console.warn("Download Error - No such download type found: ",e),s){var l=this.generateExportList(r);s.call(this.table,l,n||{},o.bind(this))}}generateExportList(e){var i=this.table.modules.export.generateExportList(this.table.options.downloadConfig,!1,e||this.table.options.downloadRowRange,"download"),n=this.table.options.groupHeaderDownload;return n&&!Array.isArray(n)&&(n=[n]),i.forEach(r=>{var a;r.type==="group"&&(a=r.columns[0],n&&n[r.indent]&&(a.value=n[r.indent](a.value,r.component._group.getRowCount(),r.component._group.getData(),r.component)))}),i}triggerDownload(e,i,n,r,a){var s=document.createElement("a"),o=this.table.options.downloadEncoder(e,i);o&&(a?window.open(window.URL.createObjectURL(o)):(r=r||"Tabulator."+(typeof n=="function"?"txt":n),navigator.msSaveOrOpenBlob?navigator.msSaveOrOpenBlob(o,r):(s.setAttribute("href",window.URL.createObjectURL(o)),s.setAttribute("download",r),s.style.display="none",document.body.appendChild(s),s.click(),document.body.removeChild(s))),this.dispatchExternal("downloadComplete"))}commsReceived(e,i,n){switch(i){case"intercept":this.download(n.type,"",n.options,n.active,n.intercept);break}}};et(oS,"moduleName","download"),et(oS,"downloaders",mXe);let LG=oS;function E2(t,e){var i=e.mask,n=typeof e.maskLetterChar<"u"?e.maskLetterChar:"A",r=typeof e.maskNumberChar<"u"?e.maskNumberChar:"9",a=typeof e.maskWildcardChar<"u"?e.maskWildcardChar:"*";function s(o){var l=i[o];typeof l<"u"&&l!==a&&l!==n&&l!==r&&(t.value=t.value+""+l,s(o+1))}t.addEventListener("keydown",o=>{var l=t.value.length,c=o.key;if(o.keyCode>46&&!o.ctrlKey&&!o.metaKey){if(l>=i.length)return o.preventDefault(),o.stopPropagation(),!1;switch(i[l]){case n:if(c.toUpperCase()==c.toLowerCase())return o.preventDefault(),o.stopPropagation(),!1;break;case r:if(isNaN(c))return o.preventDefault(),o.stopPropagation(),!1;break;case a:break;default:if(c!==i[l])return o.preventDefault(),o.stopPropagation(),!1}}}),t.addEventListener("keyup",o=>{o.keyCode>46&&e.maskAutoFill&&s(t.value.length)}),t.placeholder||(t.placeholder=i),e.maskAutoFill&&s(t.value.length)}function gXe(t,e,i,n,r){var a=t.getValue(),s=document.createElement("input");if(s.setAttribute("type",r.search?"search":"text"),s.style.padding="4px",s.style.width="100%",s.style.boxSizing="border-box",r.elementAttributes&&typeof r.elementAttributes=="object")for(let l in r.elementAttributes)l.charAt(0)=="+"?(l=l.slice(1),s.setAttribute(l,s.getAttribute(l)+r.elementAttributes["+"+l])):s.setAttribute(l,r.elementAttributes[l]);s.value=typeof a<"u"?a:"",e(function(){t.getType()==="cell"&&(s.focus({preventScroll:!0}),s.style.height="100%",r.selectContents&&s.select())});function o(l){(a===null||typeof a>"u")&&s.value!==""||s.value!==a?i(s.value)&&(a=s.value):n()}return s.addEventListener("change",o),s.addEventListener("blur",o),s.addEventListener("keydown",function(l){switch(l.keyCode){case 13:o();break;case 27:n();break;case 35:case 36:l.stopPropagation();break}}),r.mask&&E2(s,r),s}function vXe(t,e,i,n,r){var a=t.getValue(),s=r.verticalNavigation||"hybrid",o=String(a!==null&&typeof a<"u"?a:""),l=document.createElement("textarea"),c=0;if(l.style.display="block",l.style.padding="2px",l.style.height="100%",l.style.width="100%",l.style.boxSizing="border-box",l.style.whiteSpace="pre-wrap",l.style.resize="none",r.elementAttributes&&typeof r.elementAttributes=="object")for(let d in r.elementAttributes)d.charAt(0)=="+"?(d=d.slice(1),l.setAttribute(d,l.getAttribute(d)+r.elementAttributes["+"+d])):l.setAttribute(d,r.elementAttributes[d]);l.value=o,e(function(){t.getType()==="cell"&&(l.focus({preventScroll:!0}),l.style.height="100%",l.scrollHeight,l.style.height=l.scrollHeight+"px",t.getRow().normalizeHeight(),r.selectContents&&l.select())});function u(d){(a===null||typeof a>"u")&&l.value!==""||l.value!==a?(i(l.value)&&(a=l.value),setTimeout(function(){t.getRow().normalizeHeight()},300)):n()}return l.addEventListener("change",u),l.addEventListener("blur",u),l.addEventListener("keyup",function(){l.style.height="";var d=l.scrollHeight;l.style.height=d+"px",d!=c&&(c=d,t.getRow().normalizeHeight())}),l.addEventListener("keydown",function(d){switch(d.keyCode){case 13:d.shiftKey&&r.shiftEnterSubmit&&u();break;case 27:n();break;case 38:(s=="editor"||s=="hybrid"&&l.selectionStart)&&(d.stopImmediatePropagation(),d.stopPropagation());break;case 40:(s=="editor"||s=="hybrid"&&l.selectionStart!==l.value.length)&&(d.stopImmediatePropagation(),d.stopPropagation());break;case 35:case 36:d.stopPropagation();break}}),r.mask&&E2(l,r),l}function yXe(t,e,i,n,r){var a=t.getValue(),s=r.verticalNavigation||"editor",o=document.createElement("input");if(o.setAttribute("type","number"),typeof r.max<"u"&&o.setAttribute("max",r.max),typeof r.min<"u"&&o.setAttribute("min",r.min),typeof r.step<"u"&&o.setAttribute("step",r.step),o.style.padding="4px",o.style.width="100%",o.style.boxSizing="border-box",r.elementAttributes&&typeof r.elementAttributes=="object")for(let u in r.elementAttributes)u.charAt(0)=="+"?(u=u.slice(1),o.setAttribute(u,o.getAttribute(u)+r.elementAttributes["+"+u])):o.setAttribute(u,r.elementAttributes[u]);o.value=a;var l=function(u){c()};e(function(){t.getType()==="cell"&&(o.removeEventListener("blur",l),o.focus({preventScroll:!0}),o.style.height="100%",o.addEventListener("blur",l),r.selectContents&&o.select())});function c(){var u=o.value;!isNaN(u)&&u!==""&&(u=Number(u)),u!==a?i(u)&&(a=u):n()}return o.addEventListener("keydown",function(u){switch(u.keyCode){case 13:c();break;case 27:n();break;case 38:case 40:s=="editor"&&(u.stopImmediatePropagation(),u.stopPropagation());break;case 35:case 36:u.stopPropagation();break}}),r.mask&&E2(o,r),o}function bXe(t,e,i,n,r){var a=t.getValue(),s=document.createElement("input");if(s.setAttribute("type","range"),typeof r.max<"u"&&s.setAttribute("max",r.max),typeof r.min<"u"&&s.setAttribute("min",r.min),typeof r.step<"u"&&s.setAttribute("step",r.step),s.style.padding="4px",s.style.width="100%",s.style.boxSizing="border-box",r.elementAttributes&&typeof r.elementAttributes=="object")for(let l in r.elementAttributes)l.charAt(0)=="+"?(l=l.slice(1),s.setAttribute(l,s.getAttribute(l)+r.elementAttributes["+"+l])):s.setAttribute(l,r.elementAttributes[l]);s.value=a,e(function(){t.getType()==="cell"&&(s.focus({preventScroll:!0}),s.style.height="100%")});function o(){var l=s.value;!isNaN(l)&&l!==""&&(l=Number(l)),l!=a?i(l)&&(a=l):n()}return s.addEventListener("blur",function(l){o()}),s.addEventListener("keydown",function(l){switch(l.keyCode){case 13:o();break;case 27:n();break}}),s}function IXe(t,e,i,n,r){var a=r.format,s=r.verticalNavigation||"editor",o=a?window.DateTime||luxon.DateTime:null,l=t.getValue(),c=document.createElement("input");function u(p){var h;return o.isDateTime(p)?h=p:a==="iso"?h=o.fromISO(String(p)):h=o.fromFormat(String(p),a),h.toFormat("yyyy-MM-dd")}if(c.type="date",c.style.padding="4px",c.style.width="100%",c.style.boxSizing="border-box",r.max&&c.setAttribute("max",a?u(r.max):r.max),r.min&&c.setAttribute("min",a?u(r.min):r.min),r.elementAttributes&&typeof r.elementAttributes=="object")for(let p in r.elementAttributes)p.charAt(0)=="+"?(p=p.slice(1),c.setAttribute(p,c.getAttribute(p)+r.elementAttributes["+"+p])):c.setAttribute(p,r.elementAttributes[p]);l=typeof l<"u"?l:"",a&&(o?l=u(l):console.error("Editor Error - 'date' editor 'format' param is dependant on luxon.js")),c.value=l,e(function(){t.getType()==="cell"&&(c.focus({preventScroll:!0}),c.style.height="100%",r.selectContents&&c.select())});function d(){var p=c.value,h;if((l===null||typeof l>"u")&&p!==""||p!==l){if(p&&a)switch(h=o.fromFormat(String(p),"yyyy-MM-dd"),a){case!0:p=h;break;case"iso":p=h.toISO();break;default:p=h.toFormat(a)}i(p)&&(l=c.value)}else n()}return c.addEventListener("blur",function(p){(p.relatedTarget||p.rangeParent||p.explicitOriginalTarget!==c)&&d()}),c.addEventListener("keydown",function(p){switch(p.keyCode){case 13:d();break;case 27:n();break;case 35:case 36:p.stopPropagation();break;case 38:case 40:s=="editor"&&(p.stopImmediatePropagation(),p.stopPropagation());break}}),c}function wXe(t,e,i,n,r){var a=r.format,s=r.verticalNavigation||"editor",o=a?window.DateTime||luxon.DateTime:null,l,c=t.getValue(),u=document.createElement("input");if(u.type="time",u.style.padding="4px",u.style.width="100%",u.style.boxSizing="border-box",r.elementAttributes&&typeof r.elementAttributes=="object")for(let p in r.elementAttributes)p.charAt(0)=="+"?(p=p.slice(1),u.setAttribute(p,u.getAttribute(p)+r.elementAttributes["+"+p])):u.setAttribute(p,r.elementAttributes[p]);c=typeof c<"u"?c:"",a&&(o?(o.isDateTime(c)?l=c:a==="iso"?l=o.fromISO(String(c)):l=o.fromFormat(String(c),a),c=l.toFormat("HH:mm")):console.error("Editor Error - 'date' editor 'format' param is dependant on luxon.js")),u.value=c,e(function(){t.getType()=="cell"&&(u.focus({preventScroll:!0}),u.style.height="100%",r.selectContents&&u.select())});function d(){var p=u.value,h;if((c===null||typeof c>"u")&&p!==""||p!==c){if(p&&a)switch(h=o.fromFormat(String(p),"hh:mm"),a){case!0:p=h;break;case"iso":p=h.toISO();break;default:p=h.toFormat(a)}i(p)&&(c=u.value)}else n()}return u.addEventListener("blur",function(p){(p.relatedTarget||p.rangeParent||p.explicitOriginalTarget!==u)&&d()}),u.addEventListener("keydown",function(p){switch(p.keyCode){case 13:d();break;case 27:n();break;case 35:case 36:p.stopPropagation();break;case 38:case 40:s=="editor"&&(p.stopImmediatePropagation(),p.stopPropagation());break}}),u}function SXe(t,e,i,n,r){var a=r.format,s=r.verticalNavigation||"editor",o=a?window.DateTime||luxon.DateTime:null,l,c=t.getValue(),u=document.createElement("input");if(u.type="datetime-local",u.style.padding="4px",u.style.width="100%",u.style.boxSizing="border-box",r.elementAttributes&&typeof r.elementAttributes=="object")for(let p in r.elementAttributes)p.charAt(0)=="+"?(p=p.slice(1),u.setAttribute(p,u.getAttribute(p)+r.elementAttributes["+"+p])):u.setAttribute(p,r.elementAttributes[p]);c=typeof c<"u"?c:"",a&&(o?(o.isDateTime(c)?l=c:a==="iso"?l=o.fromISO(String(c)):l=o.fromFormat(String(c),a),c=l.toFormat("yyyy-MM-dd")+"T"+l.toFormat("HH:mm")):console.error("Editor Error - 'date' editor 'format' param is dependant on luxon.js")),u.value=c,e(function(){t.getType()==="cell"&&(u.focus({preventScroll:!0}),u.style.height="100%",r.selectContents&&u.select())});function d(){var p=u.value,h;if((c===null||typeof c>"u")&&p!==""||p!==c){if(p&&a)switch(h=o.fromISO(String(p)),a){case!0:p=h;break;case"iso":p=h.toISO();break;default:p=h.toFormat(a)}i(p)&&(c=u.value)}else n()}return u.addEventListener("blur",function(p){(p.relatedTarget||p.rangeParent||p.explicitOriginalTarget!==u)&&d()}),u.addEventListener("keydown",function(p){switch(p.keyCode){case 13:d();break;case 27:n();break;case 35:case 36:p.stopPropagation();break;case 38:case 40:s=="editor"&&(p.stopImmediatePropagation(),p.stopPropagation());break}}),u}let TXe=class{constructor(e,i,n,r,a,s){this.edit=e,this.table=e.table,this.cell=i,this.params=this._initializeParams(s),this.data=[],this.displayItems=[],this.currentItems=[],this.focusedItem=null,this.input=this._createInputElement(),this.listEl=this._createListElement(),this.initialValues=null,this.isFilter=i.getType()==="header",this.filterTimeout=null,this.filtered=!1,this.typing=!1,this.values=[],this.popup=null,this.listIteration=0,this.lastAction="",this.filterTerm="",this.blurable=!0,this.actions={success:r,cancel:a},this._deprecatedOptionsCheck(),this._initializeValue(),n(this._onRendered.bind(this))}_deprecatedOptionsCheck(){}_initializeValue(){var e=this.cell.getValue();typeof e>"u"&&typeof this.params.defaultValue<"u"&&(e=this.params.defaultValue),this.initialValues=this.params.multiselect?e:[e],this.isFilter&&(this.input.value=this.initialValues?this.initialValues.join(","):"",this.headerFilterInitialListGen())}_onRendered(){var e=this.cell.getElement();function i(n){n.stopPropagation()}this.isFilter||(this.input.style.height="100%",this.input.focus({preventScroll:!0})),e.addEventListener("click",i),setTimeout(()=>{e.removeEventListener("click",i)},1e3),this.input.addEventListener("mousedown",this._preventPopupBlur.bind(this))}_createListElement(){var e=document.createElement("div");return e.classList.add("tabulator-edit-list"),e.addEventListener("mousedown",this._preventBlur.bind(this)),e.addEventListener("keydown",this._inputKeyDown.bind(this)),e}_setListWidth(){var e=this.isFilter?this.input:this.cell.getElement();this.listEl.style.minWidth=e.offsetWidth+"px",this.params.maxWidth&&(this.params.maxWidth===!0?this.listEl.style.maxWidth=e.offsetWidth+"px":typeof this.params.maxWidth=="number"?this.listEl.style.maxWidth=this.params.maxWidth+"px":this.listEl.style.maxWidth=this.params.maxWidth)}_createInputElement(){var e=this.params.elementAttributes,i=document.createElement("input");if(i.setAttribute("type",this.params.clearable?"search":"text"),i.style.padding="4px",i.style.width="100%",i.style.boxSizing="border-box",this.params.autocomplete||(i.style.cursor="default",i.style.caretColor="transparent"),e&&typeof e=="object")for(let n in e)n.charAt(0)=="+"?(n=n.slice(1),i.setAttribute(n,i.getAttribute(n)+e["+"+n])):i.setAttribute(n,e[n]);return this.params.mask&&E2(i,this.params),this._bindInputEvents(i),i}_initializeParams(e){var i=["values","valuesURL","valuesLookup"],n;return e=Object.assign({},e),e.verticalNavigation=e.verticalNavigation||"editor",e.placeholderLoading=typeof e.placeholderLoading>"u"?"Searching ...":e.placeholderLoading,e.placeholderEmpty=typeof e.placeholderEmpty>"u"?"No Results Found":e.placeholderEmpty,e.filterDelay=typeof e.filterDelay>"u"?300:e.filterDelay,e.emptyValue=Object.keys(e).includes("emptyValue")?e.emptyValue:"",n=Object.keys(e).filter(r=>i.includes(r)).length,n?n>1&&console.warn("list editor config error - only one of the values, valuesURL, or valuesLookup options can be set on the same editor"):console.warn("list editor config error - either the values, valuesURL, or valuesLookup option must be set"),e.autocomplete?e.multiselect&&(e.multiselect=!1,console.warn("list editor config error - multiselect option is not available when autocomplete is enabled")):(e.freetext&&(e.freetext=!1,console.warn("list editor config error - freetext option is only available when autocomplete is enabled")),e.filterFunc&&(e.filterFunc=!1,console.warn("list editor config error - filterFunc option is only available when autocomplete is enabled")),e.filterRemote&&(e.filterRemote=!1,console.warn("list editor config error - filterRemote option is only available when autocomplete is enabled")),e.mask&&(e.mask=!1,console.warn("list editor config error - mask option is only available when autocomplete is enabled")),e.allowEmpty&&(e.allowEmpty=!1,console.warn("list editor config error - allowEmpty option is only available when autocomplete is enabled")),e.listOnEmpty&&(e.listOnEmpty=!1,console.warn("list editor config error - listOnEmpty option is only available when autocomplete is enabled"))),e.filterRemote&&!(typeof e.valuesLookup=="function"||e.valuesURL)&&(e.filterRemote=!1,console.warn("list editor config error - filterRemote option should only be used when values list is populated from a remote source")),e}_bindInputEvents(e){e.addEventListener("focus",this._inputFocus.bind(this)),e.addEventListener("click",this._inputClick.bind(this)),e.addEventListener("blur",this._inputBlur.bind(this)),e.addEventListener("keydown",this._inputKeyDown.bind(this)),e.addEventListener("search",this._inputSearch.bind(this)),this.params.autocomplete&&e.addEventListener("keyup",this._inputKeyUp.bind(this))}_inputFocus(e){this.rebuildOptionsList()}_filter(){this.params.filterRemote?(clearTimeout(this.filterTimeout),this.filterTimeout=setTimeout(()=>{this.rebuildOptionsList()},this.params.filterDelay)):this._filterList()}_inputClick(e){e.stopPropagation()}_inputBlur(e){this.blurable&&(this.popup?this.popup.hide():this._resolveValue(!0))}_inputSearch(){this._clearChoices()}_inputKeyDown(e){switch(e.keyCode){case 38:this._keyUp(e);break;case 40:this._keyDown(e);break;case 37:case 39:this._keySide(e);break;case 13:this._keyEnter();break;case 27:this._keyEsc();break;case 36:case 35:this._keyHomeEnd(e);break;case 9:this._keyTab(e);break;default:this._keySelectLetter(e)}}_inputKeyUp(e){switch(e.keyCode){case 38:case 37:case 39:case 40:case 13:case 27:break;default:this._keyAutoCompLetter(e)}}_preventPopupBlur(){this.popup&&this.popup.blockHide(),setTimeout(()=>{this.popup&&this.popup.restoreHide()},10)}_preventBlur(){this.blurable=!1,setTimeout(()=>{this.blurable=!0},10)}_keyTab(e){this.params.autocomplete&&this.lastAction==="typing"?this._resolveValue(!0):this.focusedItem&&this._chooseItem(this.focusedItem,!0)}_keyUp(e){var i=this.displayItems.indexOf(this.focusedItem);(this.params.verticalNavigation=="editor"||this.params.verticalNavigation=="hybrid"&&i)&&(e.stopImmediatePropagation(),e.stopPropagation(),e.preventDefault(),i>0&&this._focusItem(this.displayItems[i-1]))}_keyDown(e){var i=this.displayItems.indexOf(this.focusedItem);(this.params.verticalNavigation=="editor"||this.params.verticalNavigation=="hybrid"&&i<this.displayItems.length-1)&&(e.stopImmediatePropagation(),e.stopPropagation(),e.preventDefault(),i<this.displayItems.length-1&&(i==-1?this._focusItem(this.displayItems[0]):this._focusItem(this.displayItems[i+1])))}_keySide(e){this.params.autocomplete||(e.stopImmediatePropagation(),e.stopPropagation(),e.preventDefault())}_keyEnter(e){this.params.autocomplete&&this.lastAction==="typing"?this._resolveValue(!0):this.focusedItem&&this._chooseItem(this.focusedItem)}_keyEsc(e){this._cancel()}_keyHomeEnd(e){this.params.autocomplete&&e.stopImmediatePropagation()}_keySelectLetter(e){this.params.autocomplete||(e.preventDefault(),e.keyCode>=38&&e.keyCode<=90&&this._scrollToValue(e.keyCode))}_keyAutoCompLetter(e){this._filter(),this.lastAction="typing",this.typing=!0}_scrollToValue(e){clearTimeout(this.filterTimeout);var i=String.fromCharCode(e).toLowerCase();this.filterTerm+=i.toLowerCase();var n=this.displayItems.find(r=>typeof r.label<"u"&&r.label.toLowerCase().startsWith(this.filterTerm));n&&this._focusItem(n),this.filterTimeout=setTimeout(()=>{this.filterTerm=""},800)}_focusItem(e){this.lastAction="focus",this.focusedItem&&this.focusedItem.element&&this.focusedItem.element.classList.remove("focused"),this.focusedItem=e,e&&e.element&&(e.element.classList.add("focused"),e.element.scrollIntoView({behavior:"smooth",block:"nearest",inline:"start"}))}headerFilterInitialListGen(){this._generateOptions(!0)}rebuildOptionsList(){this._generateOptions().then(this._sortOptions.bind(this)).then(this._buildList.bind(this)).then(this._showList.bind(this)).catch(e=>{Number.isInteger(e)||console.error("List generation error",e)})}_filterList(){this._buildList(this._filterOptions()),this._showList()}_generateOptions(e){var i=[],n=++this.listIteration;return this.filtered=!1,this.params.values?i=this.params.values:this.params.valuesURL?i=this._ajaxRequest(this.params.valuesURL,this.input.value):typeof this.params.valuesLookup=="function"?i=this.params.valuesLookup(this.cell,this.input.value):this.params.valuesLookup&&(i=this._uniqueColumnValues(this.params.valuesLookupField)),i instanceof Promise?(e||this._addPlaceholder(this.params.placeholderLoading),i.then().then(r=>this.listIteration===n?this._parseList(r):Promise.reject(n))):Promise.resolve(this._parseList(i))}_addPlaceholder(e){var i=document.createElement("div");typeof e=="function"&&(e=e(this.cell.getComponent(),this.listEl)),e&&(this._clearList(),e instanceof HTMLElement?i=e:(i.classList.add("tabulator-edit-list-placeholder"),i.innerHTML=e),this.listEl.appendChild(i),this._showList())}_ajaxRequest(e,i){var n=this.params.filterRemote?{term:i}:{};return e=h1e(e,{},n),fetch(e).then(r=>r.ok?r.json().catch(a=>(console.warn("List Ajax Load Error - Invalid JSON returned",a),Promise.reject(a))):(console.error("List Ajax Load Error - Connection Error: "+r.status,r.statusText),Promise.reject(r))).catch(r=>(console.error("List Ajax Load Error - Connection Error: ",r),Promise.reject(r)))}_uniqueColumnValues(e){var i={},n=this.table.getData(this.params.valuesLookup),r;return e?r=this.table.columnManager.getColumnByField(e):r=this.cell.getColumn()._getSelf(),r?n.forEach(a=>{var s=r.getFieldValue(a);s!==null&&typeof s<"u"&&s!==""&&(i[s]=!0)}):(console.warn("unable to find matching column to create select lookup list:",e),i=[]),Object.keys(i)}_parseList(e){var i=[];return Array.isArray(e)||(e=Object.entries(e).map(([n,r])=>({label:r,value:n}))),e.forEach(n=>{typeof n!="object"&&(n={label:n,value:n}),this._parseListItem(n,i,0)}),!this.currentItems.length&&this.params.freetext&&(this.input.value=this.initialValues,this.typing=!0,this.lastAction="typing"),this.data=i,i}_parseListItem(e,i,n){var r={};e.options?r=this._parseListGroup(e,n+1):(r={label:e.label,value:e.value,itemParams:e.itemParams,elementAttributes:e.elementAttributes,element:!1,selected:!1,visible:!0,level:n,original:e},this.initialValues&&this.initialValues.indexOf(e.value)>-1&&this._chooseItem(r,!0)),i.push(r)}_parseListGroup(e,i){var n={label:e.label,group:!0,itemParams:e.itemParams,elementAttributes:e.elementAttributes,element:!1,visible:!0,level:i,options:[],original:e};return e.options.forEach(r=>{this._parseListItem(r,n.options,i)}),n}_sortOptions(e){var i;return this.params.sort&&(i=typeof this.params.sort=="function"?this.params.sort:this._defaultSortFunction.bind(this),this._sortGroup(i,e)),e}_sortGroup(e,i){i.sort((n,r)=>e(n.label,r.label,n.value,r.value,n.original,r.original)),i.forEach(n=>{n.group&&this._sortGroup(e,n.options)})}_defaultSortFunction(e,i){var n,r,a,s,o=0,l,c=/(\d+)|(\D+)/g,u=/\d/,d=0;if(this.params.sort==="desc"&&([e,i]=[i,e]),!e&&e!==0)d=!i&&i!==0?0:-1;else if(!i&&i!==0)d=1;else{if(isFinite(e)&&isFinite(i))return e-i;if(n=String(e).toLowerCase(),r=String(i).toLowerCase(),n===r)return 0;if(!(u.test(n)&&u.test(r)))return n>r?1:-1;for(n=n.match(c),r=r.match(c),l=n.length>r.length?r.length:n.length;o<l;)if(a=n[o],s=r[o++],a!==s)return isFinite(a)&&isFinite(s)?(a.charAt(0)==="0"&&(a="."+a),s.charAt(0)==="0"&&(s="."+s),a-s):a>s?1:-1;return n.length>r.length}return d}_filterOptions(){var e=this.params.filterFunc||this._defaultFilterFunc,i=this.input.value;return i?(this.filtered=!0,this.data.forEach(n=>{this._filterItem(e,i,n)})):this.filtered=!1,this.data}_filterItem(e,i,n){var r=!1;return n.group?(n.options.forEach(a=>{this._filterItem(e,i,a)&&(r=!0)}),n.visible=r):n.visible=e(i,n.label,n.value,n.original),n.visible}_defaultFilterFunc(e,i,n,r){return e=String(e).toLowerCase(),i!==null&&typeof i<"u"&&(String(i).toLowerCase().indexOf(e)>-1||String(n).toLowerCase().indexOf(e)>-1)}_clearList(){for(;this.listEl.firstChild;)this.listEl.removeChild(this.listEl.firstChild);this.displayItems=[]}_buildList(e){this._clearList(),e.forEach(i=>{this._buildItem(i)}),this.displayItems.length||this._addPlaceholder(this.params.placeholderEmpty)}_buildItem(e){var i=e.element,n;if(!this.filtered||e.visible){if(!i){if(i=document.createElement("div"),i.tabIndex=0,n=this.params.itemFormatter?this.params.itemFormatter(e.label,e.value,e.original,i):e.label,n instanceof HTMLElement?i.appendChild(n):i.innerHTML=n,e.group?i.classList.add("tabulator-edit-list-group"):i.classList.add("tabulator-edit-list-item"),i.classList.add("tabulator-edit-list-group-level-"+e.level),e.elementAttributes&&typeof e.elementAttributes=="object")for(let r in e.elementAttributes)r.charAt(0)=="+"?(r=r.slice(1),i.setAttribute(r,this.input.getAttribute(r)+e.elementAttributes["+"+r])):i.setAttribute(r,e.elementAttributes[r]);e.group?i.addEventListener("click",this._groupClick.bind(this,e)):i.addEventListener("click",this._itemClick.bind(this,e)),i.addEventListener("mousedown",this._preventBlur.bind(this)),e.element=i}this._styleItem(e),this.listEl.appendChild(i),e.group?e.options.forEach(r=>{this._buildItem(r)}):this.displayItems.push(e)}}_showList(){var e=this.popup&&this.popup.isVisible();if(this.input.parentNode){if(this.params.autocomplete&&this.input.value===""&&!this.params.listOnEmpty){this.popup&&this.popup.hide(!0);return}this._setListWidth(),this.popup||(this.popup=this.edit.popup(this.listEl)),this.popup.show(this.cell.getElement(),"bottom"),e||setTimeout(()=>{this.popup.hideOnBlur(this._resolveValue.bind(this,!0))},10)}}_styleItem(e){e&&e.element&&(e.selected?e.element.classList.add("active"):e.element.classList.remove("active"))}_itemClick(e,i){i.stopPropagation(),this._chooseItem(e)}_groupClick(e,i){i.stopPropagation()}_cancel(){this.popup.hide(!0),this.actions.cancel()}_clearChoices(){this.typing=!0,this.currentItems.forEach(e=>{e.selected=!1,this._styleItem(e)}),this.currentItems=[],this.focusedItem=null}_chooseItem(e,i){var n;this.typing=!1,this.params.multiselect?(n=this.currentItems.indexOf(e),n>-1?(this.currentItems.splice(n,1),e.selected=!1):(this.currentItems.push(e),e.selected=!0),this.input.value=this.currentItems.map(r=>r.label).join(","),this._styleItem(e)):(this.currentItems=[e],e.selected=!0,this.input.value=e.label,this._styleItem(e),i||this._resolveValue()),this._focusItem(e)}_resolveValue(e){var i,n;if(this.popup&&this.popup.hide(!0),this.params.multiselect)i=this.currentItems.map(r=>r.value);else if(e&&this.params.autocomplete&&this.typing)if(this.params.freetext||this.params.allowEmpty&&this.input.value==="")i=this.input.value;else{this.actions.cancel();return}else this.currentItems[0]?i=this.currentItems[0].value:(n=Array.isArray(this.initialValues)?this.initialValues[0]:this.initialValues,n===null||typeof n>"u"||n===""?i=n:i=this.params.emptyValue);i===""&&(i=this.params.emptyValue),this.actions.success(i),this.isFilter&&(this.initialValues=i&&!Array.isArray(i)?[i]:i,this.currentItems=[])}};function UXe(t,e,i,n,r){var a=new TXe(this,t,e,i,n,r);return a.input}function DXe(t,e,i,n,r){var a=this,s=t.getElement(),o=t.getValue(),l=s.getElementsByTagName("svg").length||5,c=s.getElementsByTagName("svg")[0]?s.getElementsByTagName("svg")[0].getAttribute("width"):14,u=[],d=document.createElement("div"),p=document.createElementNS("http://www.w3.org/2000/svg","svg");function h(v){u.forEach(function(y,b){b<v?(a.table.browser=="ie"?y.setAttribute("class","tabulator-star-active"):y.classList.replace("tabulator-star-inactive","tabulator-star-active"),y.innerHTML='<polygon fill="#488CE9" stroke="#014AAE" stroke-width="37.6152" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" points="259.216,29.942 330.27,173.919 489.16,197.007 374.185,309.08 401.33,467.31 259.216,392.612 117.104,467.31 144.25,309.08 29.274,197.007 188.165,173.919 "/>'):(a.table.browser=="ie"?y.setAttribute("class","tabulator-star-inactive"):y.classList.replace("tabulator-star-active","tabulator-star-inactive"),y.innerHTML='<polygon fill="#010155" stroke="#686868" stroke-width="37.6152" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" points="259.216,29.942 330.27,173.919 489.16,197.007 374.185,309.08 401.33,467.31 259.216,392.612 117.104,467.31 144.25,309.08 29.274,197.007 188.165,173.919 "/>')})}function f(v){var y=document.createElement("span"),b=p.cloneNode(!0);u.push(b),y.addEventListener("mouseenter",function(I){I.stopPropagation(),I.stopImmediatePropagation(),h(v)}),y.addEventListener("mousemove",function(I){I.stopPropagation(),I.stopImmediatePropagation()}),y.addEventListener("click",function(I){I.stopPropagation(),I.stopImmediatePropagation(),i(v),s.blur()}),y.appendChild(b),d.appendChild(y)}function m(v){o=v,h(v)}if(s.style.whiteSpace="nowrap",s.style.overflow="hidden",s.style.textOverflow="ellipsis",d.style.verticalAlign="middle",d.style.display="inline-block",d.style.padding="4px",p.setAttribute("width",c),p.setAttribute("height",c),p.setAttribute("viewBox","0 0 512 512"),p.setAttribute("xml:space","preserve"),p.style.padding="0 1px",r.elementAttributes&&typeof r.elementAttributes=="object")for(let v in r.elementAttributes)v.charAt(0)=="+"?(v=v.slice(1),d.setAttribute(v,d.getAttribute(v)+r.elementAttributes["+"+v])):d.setAttribute(v,r.elementAttributes[v]);for(var g=1;g<=l;g++)f(g);return o=Math.min(parseInt(o),l),h(o),d.addEventListener("mousemove",function(v){h(0)}),d.addEventListener("click",function(v){i(0)}),s.addEventListener("blur",function(v){n()}),s.addEventListener("keydown",function(v){switch(v.keyCode){case 39:m(o+1);break;case 37:m(o-1);break;case 13:i(o);break;case 27:n();break}}),d}function EXe(t,e,i,n,r){var a=t.getElement(),s=typeof r.max>"u"?a.getElementsByTagName("div")[0]&&a.getElementsByTagName("div")[0].getAttribute("max")||100:r.max,o=typeof r.min>"u"?a.getElementsByTagName("div")[0]&&a.getElementsByTagName("div")[0].getAttribute("min")||0:r.min,l=(s-o)/100,c=t.getValue()||0,u=document.createElement("div"),d=document.createElement("div"),p,h;function f(){var m=window.getComputedStyle(a,null),g=l*Math.round(d.offsetWidth/((a.clientWidth-parseInt(m.getPropertyValue("padding-left"))-parseInt(m.getPropertyValue("padding-right")))/100))+o;i(g),a.setAttribute("aria-valuenow",g),a.setAttribute("aria-label",c)}if(u.style.position="absolute",u.style.right="0",u.style.top="0",u.style.bottom="0",u.style.width="5px",u.classList.add("tabulator-progress-handle"),d.style.display="inline-block",d.style.position="relative",d.style.height="100%",d.style.backgroundColor="#488CE9",d.style.maxWidth="100%",d.style.minWidth="0%",r.elementAttributes&&typeof r.elementAttributes=="object")for(let m in r.elementAttributes)m.charAt(0)=="+"?(m=m.slice(1),d.setAttribute(m,d.getAttribute(m)+r.elementAttributes["+"+m])):d.setAttribute(m,r.elementAttributes[m]);return a.style.padding="4px 4px",c=Math.min(parseFloat(c),s),c=Math.max(parseFloat(c),o),c=Math.round((c-o)/l),d.style.width=c+"%",a.setAttribute("aria-valuemin",o),a.setAttribute("aria-valuemax",s),d.appendChild(u),u.addEventListener("mousedown",function(m){p=m.screenX,h=d.offsetWidth}),u.addEventListener("mouseover",function(){u.style.cursor="ew-resize"}),a.addEventListener("mousemove",function(m){p&&(d.style.width=h+m.screenX-p+"px")}),a.addEventListener("mouseup",function(m){p&&(m.stopPropagation(),m.stopImmediatePropagation(),p=!1,h=!1,f())}),a.addEventListener("keydown",function(m){switch(m.keyCode){case 39:m.preventDefault(),d.style.width=d.clientWidth+a.clientWidth/100+"px";break;case 37:m.preventDefault(),d.style.width=d.clientWidth-a.clientWidth/100+"px";break;case 9:case 13:f();break;case 27:n();break}}),a.addEventListener("blur",function(){n()}),d}function PXe(t,e,i,n,r){var a=t.getValue(),s=document.createElement("input"),o=r.tristate,l=typeof r.indeterminateValue>"u"?null:r.indeterminateValue,c=!1,u=Object.keys(r).includes("trueValue"),d=Object.keys(r).includes("falseValue");if(s.setAttribute("type","checkbox"),s.style.marginTop="5px",s.style.boxSizing="border-box",r.elementAttributes&&typeof r.elementAttributes=="object")for(let h in r.elementAttributes)h.charAt(0)=="+"?(h=h.slice(1),s.setAttribute(h,s.getAttribute(h)+r.elementAttributes["+"+h])):s.setAttribute(h,r.elementAttributes[h]);s.value=a,o&&(typeof a>"u"||a===l||a==="")&&(c=!0,s.indeterminate=!0),this.table.browser!="firefox"&&this.table.browser!="safari"&&e(function(){t.getType()==="cell"&&s.focus({preventScroll:!0})}),s.checked=u?a===r.trueValue:a===!0||a==="true"||a==="True"||a===1;function p(h){var f=s.checked;return u&&f?f=r.trueValue:d&&!f&&(f=r.falseValue),o?h?c?l:f:s.checked&&!c?(s.checked=!1,s.indeterminate=!0,c=!0,l):(c=!1,f):f}return s.addEventListener("change",function(h){i(p())}),s.addEventListener("blur",function(h){i(p(!0))}),s.addEventListener("keydown",function(h){h.keyCode==13&&i(p()),h.keyCode==27&&n()}),s}var CXe={input:gXe,textarea:vXe,number:yXe,range:bXe,date:IXe,time:wXe,datetime:SXe,list:UXe,star:DXe,progress:EXe,tickCross:PXe};const $D=class $D extends qn{constructor(e){super(e),this.currentCell=!1,this.mouseClick=!1,this.recursionBlock=!1,this.invalidEdit=!1,this.editedCells=[],this.convertEmptyValues=!1,this.editors=$D.editors,this.registerTableOption("editTriggerEvent","focus"),this.registerTableOption("editorEmptyValue"),this.registerTableOption("editorEmptyValueFunc",this.emptyValueCheck.bind(this)),this.registerColumnOption("editable"),this.registerColumnOption("editor"),this.registerColumnOption("editorParams"),this.registerColumnOption("editorEmptyValue"),this.registerColumnOption("editorEmptyValueFunc"),this.registerColumnOption("cellEditing"),this.registerColumnOption("cellEdited"),this.registerColumnOption("cellEditCancelled"),this.registerTableFunction("getEditedCells",this.getEditedCells.bind(this)),this.registerTableFunction("clearCellEdited",this.clearCellEdited.bind(this)),this.registerTableFunction("navigatePrev",this.navigatePrev.bind(this)),this.registerTableFunction("navigateNext",this.navigateNext.bind(this)),this.registerTableFunction("navigateLeft",this.navigateLeft.bind(this)),this.registerTableFunction("navigateRight",this.navigateRight.bind(this)),this.registerTableFunction("navigateUp",this.navigateUp.bind(this)),this.registerTableFunction("navigateDown",this.navigateDown.bind(this)),this.registerComponentFunction("cell","isEdited",this.cellIsEdited.bind(this)),this.registerComponentFunction("cell","clearEdited",this.clearEdited.bind(this)),this.registerComponentFunction("cell","edit",this.editCell.bind(this)),this.registerComponentFunction("cell","cancelEdit",this.cellCancelEdit.bind(this)),this.registerComponentFunction("cell","navigatePrev",this.navigatePrev.bind(this)),this.registerComponentFunction("cell","navigateNext",this.navigateNext.bind(this)),this.registerComponentFunction("cell","navigateLeft",this.navigateLeft.bind(this)),this.registerComponentFunction("cell","navigateRight",this.navigateRight.bind(this)),this.registerComponentFunction("cell","navigateUp",this.navigateUp.bind(this)),this.registerComponentFunction("cell","navigateDown",this.navigateDown.bind(this))}initialize(){this.subscribe("cell-init",this.bindEditor.bind(this)),this.subscribe("cell-delete",this.clearEdited.bind(this)),this.subscribe("cell-value-changed",this.updateCellClass.bind(this)),this.subscribe("column-layout",this.initializeColumnCheck.bind(this)),this.subscribe("column-delete",this.columnDeleteCheck.bind(this)),this.subscribe("row-deleting",this.rowDeleteCheck.bind(this)),this.subscribe("row-layout",this.rowEditableCheck.bind(this)),this.subscribe("data-refreshing",this.cancelEdit.bind(this)),this.subscribe("clipboard-paste",this.pasteBlocker.bind(this)),this.subscribe("keybinding-nav-prev",this.navigatePrev.bind(this,void 0)),this.subscribe("keybinding-nav-next",this.keybindingNavigateNext.bind(this)),this.subscribe("keybinding-nav-up",this.navigateUp.bind(this,void 0)),this.subscribe("keybinding-nav-down",this.navigateDown.bind(this,void 0)),Object.keys(this.table.options).includes("editorEmptyValue")&&(this.convertEmptyValues=!0)}pasteBlocker(e){if(this.currentCell)return!0}keybindingNavigateNext(e){var i=this.currentCell,n=this.options("tabEndNewRow");i&&(this.navigateNext(i,e)||n&&(i.getElement().firstChild.blur(),this.invalidEdit||(n===!0?n=this.table.addRow({}):typeof n=="function"?n=this.table.addRow(n(i.row.getComponent())):n=this.table.addRow(Object.assign({},n)),n.then(()=>{setTimeout(()=>{i.getComponent().navigateNext()})}))))}cellIsEdited(e){return!!e.modules.edit&&e.modules.edit.edited}cellCancelEdit(e){e===this.currentCell?this.table.modules.edit.cancelEdit():console.warn("Cancel Editor Error - This cell is not currently being edited ")}updateCellClass(e){this.allowEdit(e)?e.getElement().classList.add("tabulator-editable"):e.getElement().classList.remove("tabulator-editable")}clearCellEdited(e){e||(e=this.table.modules.edit.getEditedCells()),Array.isArray(e)||(e=[e]),e.forEach(i=>{this.table.modules.edit.clearEdited(i._getSelf())})}navigatePrev(e=this.currentCell,i){var n,r;if(e){if(i&&i.preventDefault(),n=this.navigateLeft(),n)return!0;if(r=this.table.rowManager.prevDisplayRow(e.row,!0),r&&(n=this.findPrevEditableCell(r,r.cells.length),n))return n.getComponent().edit(),!0}return!1}navigateNext(e=this.currentCell,i){var n,r;if(e){if(i&&i.preventDefault(),n=this.navigateRight(),n)return!0;if(r=this.table.rowManager.nextDisplayRow(e.row,!0),r&&(n=this.findNextEditableCell(r,-1),n))return n.getComponent().edit(),!0}return!1}navigateLeft(e=this.currentCell,i){var n,r;return e&&(i&&i.preventDefault(),n=e.getIndex(),r=this.findPrevEditableCell(e.row,n),r)?(r.getComponent().edit(),!0):!1}navigateRight(e=this.currentCell,i){var n,r;return e&&(i&&i.preventDefault(),n=e.getIndex(),r=this.findNextEditableCell(e.row,n),r)?(r.getComponent().edit(),!0):!1}navigateUp(e=this.currentCell,i){var n,r;return e&&(i&&i.preventDefault(),n=e.getIndex(),r=this.table.rowManager.prevDisplayRow(e.row,!0),r)?(r.cells[n].getComponent().edit(),!0):!1}navigateDown(e=this.currentCell,i){var n,r;return e&&(i&&i.preventDefault(),n=e.getIndex(),r=this.table.rowManager.nextDisplayRow(e.row,!0),r)?(r.cells[n].getComponent().edit(),!0):!1}findNextEditableCell(e,i){var n=!1;if(i<e.cells.length-1)for(var r=i+1;r<e.cells.length;r++){let a=e.cells[r];if(a.column.modules.edit&&Ha.elVisible(a.getElement())&&this.allowEdit(a)){n=a;break}}return n}findPrevEditableCell(e,i){var n=!1;if(i>0)for(var r=i-1;r>=0;r--){let a=e.cells[r];if(a.column.modules.edit&&Ha.elVisible(a.getElement())&&this.allowEdit(a)){n=a;break}}return n}initializeColumnCheck(e){typeof e.definition.editor<"u"&&this.initializeColumn(e)}columnDeleteCheck(e){this.currentCell&&this.currentCell.column===e&&this.cancelEdit()}rowDeleteCheck(e){this.currentCell&&this.currentCell.row===e&&this.cancelEdit()}rowEditableCheck(e){e.getCells().forEach(i=>{i.column.modules.edit&&typeof i.column.modules.edit.check=="function"&&this.updateCellClass(i)})}initializeColumn(e){var i=Object.keys(e.definition).includes("editorEmptyValue"),n={editor:!1,blocked:!1,check:e.definition.editable,params:e.definition.editorParams||{},convertEmptyValues:i,editorEmptyValue:e.definition.editorEmptyValue,editorEmptyValueFunc:e.definition.editorEmptyValueFunc};switch(typeof e.definition.editor){case"string":this.editors[e.definition.editor]?n.editor=this.editors[e.definition.editor]:console.warn("Editor Error - No such editor found: ",e.definition.editor);break;case"function":n.editor=e.definition.editor;break;case"boolean":e.definition.editor===!0&&(typeof e.definition.formatter!="function"?this.editors[e.definition.formatter]?n.editor=this.editors[e.definition.formatter]:n.editor=this.editors.input:console.warn("Editor Error - Cannot auto lookup editor for a custom formatter: ",e.definition.formatter));break}n.editor&&(e.modules.edit=n)}getCurrentCell(){return this.currentCell?this.currentCell.getComponent():!1}clearEditor(e){var i=this.currentCell,n;if(this.invalidEdit=!1,i){for(this.currentCell=!1,n=i.getElement(),this.dispatch("edit-editor-clear",i,e),n.classList.remove("tabulator-editing");n.firstChild;)n.removeChild(n.firstChild);i.row.getElement().classList.remove("tabulator-editing"),i.table.element.classList.remove("tabulator-editing")}}cancelEdit(){if(this.currentCell){var e=this.currentCell,i=this.currentCell.getComponent();this.clearEditor(!0),e.setValueActual(e.getValue()),e.cellRendered(),(e.column.definition.editor=="textarea"||e.column.definition.variableHeight)&&e.row.normalizeHeight(!0),e.column.definition.cellEditCancelled&&e.column.definition.cellEditCancelled.call(this.table,i),this.dispatch("edit-cancelled",e),this.dispatchExternal("cellEditCancelled",i)}}bindEditor(e){if(e.column.modules.edit){var i=this,n=e.getElement(!0);this.updateCellClass(e),n.setAttribute("tabindex",0),n.addEventListener("mousedown",function(r){r.button===2?r.preventDefault():i.mouseClick=!0}),this.options("editTriggerEvent")==="dblclick"&&n.addEventListener("dblclick",function(r){n.classList.contains("tabulator-editing")||(n.focus({preventScroll:!0}),i.edit(e,r,!1))}),(this.options("editTriggerEvent")==="focus"||this.options("editTriggerEvent")==="click")&&n.addEventListener("click",function(r){n.classList.contains("tabulator-editing")||(n.focus({preventScroll:!0}),i.edit(e,r,!1))}),this.options("editTriggerEvent")==="focus"&&n.addEventListener("focus",function(r){i.recursionBlock||i.edit(e,r,!1)})}}focusCellNoEvent(e,i){this.recursionBlock=!0,i&&this.table.browser==="ie"||e.getElement().focus({preventScroll:!0}),this.recursionBlock=!1}editCell(e,i){this.focusCellNoEvent(e),this.edit(e,!1,i)}focusScrollAdjust(e){if(this.table.rowManager.getRenderMode()=="virtual"){var i=this.table.rowManager.element.scrollTop,n=this.table.rowManager.element.clientHeight+this.table.rowManager.element.scrollTop,r=e.row.getElement();r.offsetTop<i?this.table.rowManager.element.scrollTop-=i-r.offsetTop:r.offsetTop+r.offsetHeight>n&&(this.table.rowManager.element.scrollTop+=r.offsetTop+r.offsetHeight-n);var a=this.table.rowManager.element.scrollLeft,s=this.table.rowManager.element.clientWidth+this.table.rowManager.element.scrollLeft,o=e.getElement();this.table.modExists("frozenColumns")&&(a+=parseInt(this.table.modules.frozenColumns.leftMargin||0),s-=parseInt(this.table.modules.frozenColumns.rightMargin||0)),this.table.options.renderHorizontal==="virtual"&&(a-=parseInt(this.table.columnManager.renderer.vDomPadLeft),s-=parseInt(this.table.columnManager.renderer.vDomPadLeft)),o.offsetLeft<a?this.table.rowManager.element.scrollLeft-=a-o.offsetLeft:o.offsetLeft+o.offsetWidth>s&&(this.table.rowManager.element.scrollLeft+=o.offsetLeft+o.offsetWidth-s)}}allowEdit(e){var i=!!e.column.modules.edit;if(e.column.modules.edit)switch(typeof e.column.modules.edit.check){case"function":e.row.initialized&&(i=e.column.modules.edit.check(e.getComponent()));break;case"string":i=!!e.row.data[e.column.modules.edit.check];break;case"boolean":i=e.column.modules.edit.check;break}return i}edit(e,i,n){var r=this,a=!0,s=function(){},o=e.getElement(),l=!1,c,u,d;if(this.currentCell){!this.invalidEdit&&this.currentCell!==e&&this.cancelEdit();return}function p(v){if(r.currentCell===e&&!l){var y=r.chain("edit-success",[e,v],!0,!0);return y===!0||r.table.options.validationMode==="highlight"?(l=!0,r.clearEditor(),e.modules.edit||(e.modules.edit={}),e.modules.edit.edited=!0,r.editedCells.indexOf(e)==-1&&r.editedCells.push(e),v=r.transformEmptyValues(v,e),e.setValue(v,!0),y===!0):(l=!0,r.invalidEdit=!0,r.focusCellNoEvent(e,!0),s(),setTimeout(()=>{l=!1},10),!1)}}function h(){r.currentCell===e&&!l&&r.cancelEdit()}function f(v){s=v}if(e.column.modules.edit.blocked)return this.mouseClick=!1,this.blur(o),!1;if(i&&i.stopPropagation(),a=this.allowEdit(e),a||n){if(r.cancelEdit(),r.currentCell=e,this.focusScrollAdjust(e),u=e.getComponent(),this.mouseClick&&(this.mouseClick=!1,e.column.definition.cellClick&&e.column.definition.cellClick.call(this.table,i,u)),e.column.definition.cellEditing&&e.column.definition.cellEditing.call(this.table,u),this.dispatch("cell-editing",e),this.dispatchExternal("cellEditing",u),d=typeof e.column.modules.edit.params=="function"?e.column.modules.edit.params(u):e.column.modules.edit.params,c=e.column.modules.edit.editor.call(r,u,f,p,h,d),this.currentCell&&c!==!1)if(c instanceof Node){for(o.classList.add("tabulator-editing"),e.row.getElement().classList.add("tabulator-editing"),e.table.element.classList.add("tabulator-editing");o.firstChild;)o.removeChild(o.firstChild);o.appendChild(c),s();for(var m=o.children,g=0;g<m.length;g++)m[g].addEventListener("click",function(v){v.stopPropagation()})}else return console.warn("Edit Error - Editor should return an instance of Node, the editor returned:",c),this.blur(o),!1;else return this.blur(o),!1;return!0}else return this.mouseClick=!1,this.blur(o),!1}emptyValueCheck(e){return e===""||e===null||typeof e>"u"}transformEmptyValues(e,i){var n=i.column.modules.edit,r=n.convertEmptyValues||this.convertEmptyValues,a;return r&&(a=n.editorEmptyValueFunc||this.options("editorEmptyValueFunc"),a&&a(e)&&(e=n.convertEmptyValues?n.editorEmptyValue:this.options("editorEmptyValue"))),e}blur(e){this.confirm("edit-blur",[e])||e.blur()}getEditedCells(){var e=[];return this.editedCells.forEach(i=>{e.push(i.getComponent())}),e}clearEdited(e){var i;e.modules.edit&&e.modules.edit.edited&&(e.modules.edit.edited=!1,this.dispatch("edit-edited-clear",e)),i=this.editedCells.indexOf(e),i>-1&&this.editedCells.splice(i,1)}};et($D,"moduleName","edit"),et($D,"editors",CXe);let FG=$D;class aQ{constructor(e,i,n,r){this.type=e,this.columns=i,this.component=n||!1,this.indent=r||0}}class lB{constructor(e,i,n,r,a){this.value=e,this.component=i||!1,this.width=n,this.height=r,this.depth=a}}var RXe={},MXe={visible:function(){return this.rowManager.getVisibleRows(!1,!0)},all:function(){return this.rowManager.rows},selected:function(){return this.modules.selectRow.selectedRows},active:function(){return this.options.pagination?this.rowManager.getDisplayRows(this.rowManager.displayRows.length-2):this.rowManager.getDisplayRows()}};const Av=class Av extends qn{constructor(e){super(e),this.config={},this.cloneTableStyle=!0,this.colVisProp="",this.colVisPropAttach="",this.registerTableOption("htmlOutputConfig",!1),this.registerColumnOption("htmlOutput"),this.registerColumnOption("titleHtmlOutput")}initialize(){this.registerTableFunction("getHtml",this.getHtml.bind(this))}generateExportList(e,i,n,r){var a,s,o,l;return this.cloneTableStyle=i,this.config=e||{},this.colVisProp=r,this.colVisPropAttach=this.colVisProp.charAt(0).toUpperCase()+this.colVisProp.slice(1),l=Av.columnLookups[n],l&&(o=l.call(this.table),o=o.filter(c=>this.columnVisCheck(c))),a=this.config.columnHeaders!==!1?this.headersToExportRows(this.generateColumnGroupHeaders(o)):[],o&&(o=o.map(c=>c.getComponent())),s=this.bodyToExportRows(this.rowLookup(n),o),a.concat(s)}generateTable(e,i,n,r){var a=this.generateExportList(e,i,n,r);return this.generateTableElement(a)}rowLookup(e){var i=[],n;return typeof e=="function"?e.call(this.table).forEach(r=>{r=this.table.rowManager.findRow(r),r&&i.push(r)}):(n=Av.rowLookups[e]||Av.rowLookups.active,i=n.call(this.table)),Object.assign([],i)}generateColumnGroupHeaders(e){var i=[];return e||(e=this.config.columnGroups!==!1?this.table.columnManager.columns:this.table.columnManager.columnsByIndex),e.forEach(n=>{var r=this.processColumnGroup(n);r&&i.push(r)}),i}processColumnGroup(e){var i=e.columns,n=0,r=e.definition["title"+this.colVisPropAttach]||e.definition.title,a={title:r,column:e,depth:1};if(i.length){if(a.subGroups=[],a.width=0,i.forEach(s=>{var o=this.processColumnGroup(s);o&&(a.width+=o.width,a.subGroups.push(o),o.depth>n&&(n=o.depth))}),a.depth+=n,!a.width)return!1}else if(this.columnVisCheck(e))a.width=1;else return!1;return a}columnVisCheck(e){var i=e.definition[this.colVisProp];return this.config.rowHeaders===!1&&e.isRowHeader?!1:(typeof i=="function"&&(i=i.call(this.table,e.getComponent())),i===!1||i===!0?i:e.visible&&e.field)}headersToExportRows(e){var i=[],n=0,r=[];function a(s,o){var l=n-o;if(typeof i[o]>"u"&&(i[o]=[]),s.height=s.subGroups?1:l-s.depth+1,i[o].push(s),s.height>1)for(let c=1;c<s.height;c++)typeof i[o+c]>"u"&&(i[o+c]=[]),i[o+c].push(!1);if(s.width>1)for(let c=1;c<s.width;c++)i[o].push(!1);s.subGroups&&s.subGroups.forEach(function(c){a(c,o+1)})}return e.forEach(function(s){s.depth>n&&(n=s.depth)}),e.forEach(function(s){a(s,0)}),i.forEach(s=>{var o=[];s.forEach(l=>{if(l){let c=typeof l.title>"u"?"":l.title;o.push(new lB(c,l.column.getComponent(),l.width,l.height,l.depth))}else o.push(null)}),r.push(new aQ("header",o))}),r}bodyToExportRows(e,i=[]){var n=[];return i.length===0&&this.table.columnManager.columnsByIndex.forEach(r=>{this.columnVisCheck(r)&&i.push(r.getComponent())}),this.config.columnCalcs!==!1&&this.table.modExists("columnCalcs")&&(this.table.modules.columnCalcs.topInitialized&&e.unshift(this.table.modules.columnCalcs.topRow),this.table.modules.columnCalcs.botInitialized&&e.push(this.table.modules.columnCalcs.botRow)),e=e.filter(r=>{switch(r.type){case"group":return this.config.rowGroups!==!1;case"calc":return this.config.columnCalcs!==!1;case"row":return!(this.table.options.dataTree&&this.config.dataTree===!1&&r.modules.dataTree.parent)}return!0}),e.forEach((r,a)=>{var s=r.getData(this.colVisProp),o=[],l=0;switch(r.type){case"group":l=r.level,o.push(new lB(r.key,r.getComponent(),i.length,1));break;case"calc":case"row":i.forEach(c=>{o.push(new lB(c._column.getFieldValue(s),c,1,1))}),this.table.options.dataTree&&this.config.dataTree!==!1&&(l=r.modules.dataTree.index);break}n.push(new aQ(r.type,o,r.getComponent(),l))}),n}generateTableElement(e){var i=document.createElement("table"),n=document.createElement("thead"),r=document.createElement("tbody"),a=this.lookupTableStyles(),s=this.table.options["rowFormatter"+this.colVisPropAttach],o={};return o.rowFormatter=s!==null?s:this.table.options.rowFormatter,this.table.options.dataTree&&this.config.dataTree!==!1&&this.table.modExists("columnCalcs")&&(o.treeElementField=this.table.modules.dataTree.elementField),o.groupHeader=this.table.options["groupHeader"+this.colVisPropAttach],o.groupHeader&&!Array.isArray(o.groupHeader)&&(o.groupHeader=[o.groupHeader]),i.classList.add("tabulator-print-table"),this.mapElementStyles(this.table.columnManager.getHeadersElement(),n,["border-top","border-left","border-right","border-bottom","background-color","color","font-weight","font-family","font-size"]),e.length>1e3&&console.warn("It may take a long time to render an HTML table with more than 1000 rows"),e.forEach((l,c)=>{let u;switch(l.type){case"header":n.appendChild(this.generateHeaderElement(l,o,a));break;case"group":r.appendChild(this.generateGroupElement(l,o,a));break;case"calc":r.appendChild(this.generateCalcElement(l,o,a));break;case"row":u=this.generateRowElement(l,o,a),this.mapElementStyles(c%2&&a.evenRow?a.evenRow:a.oddRow,u,["border-top","border-left","border-right","border-bottom","color","font-weight","font-family","font-size","background-color"]),r.appendChild(u);break}}),n.innerHTML&&i.appendChild(n),i.appendChild(r),this.mapElementStyles(this.table.element,i,["border-top","border-left","border-right","border-bottom"]),i}lookupTableStyles(){var e={};return this.cloneTableStyle&&window.getComputedStyle&&(e.oddRow=this.table.element.querySelector(".tabulator-row-odd:not(.tabulator-group):not(.tabulator-calcs)"),e.evenRow=this.table.element.querySelector(".tabulator-row-even:not(.tabulator-group):not(.tabulator-calcs)"),e.calcRow=this.table.element.querySelector(".tabulator-row.tabulator-calcs"),e.firstRow=this.table.element.querySelector(".tabulator-row:not(.tabulator-group):not(.tabulator-calcs)"),e.firstGroup=this.table.element.getElementsByClassName("tabulator-group")[0],e.firstRow&&(e.styleCells=e.firstRow.getElementsByClassName("tabulator-cell"),e.styleRowHeader=e.firstRow.getElementsByClassName("tabulator-row-header")[0],e.firstCell=e.styleCells[0],e.lastCell=e.styleCells[e.styleCells.length-1])),e}generateHeaderElement(e,i,n){var r=document.createElement("tr");return e.columns.forEach(a=>{if(a){var s=document.createElement("th"),o=a.component._column.definition.cssClass?a.component._column.definition.cssClass.split(" "):[];s.colSpan=a.width,s.rowSpan=a.height,s.innerHTML=a.value,this.cloneTableStyle&&(s.style.boxSizing="border-box"),o.forEach(function(l){s.classList.add(l)}),this.mapElementStyles(a.component.getElement(),s,["text-align","border-left","border-right","background-color","color","font-weight","font-family","font-size"]),this.mapElementStyles(a.component._column.contentElement,s,["padding-top","padding-left","padding-right","padding-bottom"]),a.component._column.visible?this.mapElementStyles(a.component.getElement(),s,["width"]):a.component._column.definition.width&&(s.style.width=a.component._column.definition.width+"px"),a.component._column.parent&&a.component._column.parent.isGroup?this.mapElementStyles(a.component._column.parent.groupElement,s,["border-top"]):this.mapElementStyles(a.component.getElement(),s,["border-top"]),a.component._column.isGroup?this.mapElementStyles(a.component.getElement(),s,["border-bottom"]):this.mapElementStyles(this.table.columnManager.getElement(),s,["border-bottom"]),r.appendChild(s)}}),r}generateGroupElement(e,i,n){var r=document.createElement("tr"),a=document.createElement("td"),s=e.columns[0];return r.classList.add("tabulator-print-table-row"),i.groupHeader&&i.groupHeader[e.indent]?s.value=i.groupHeader[e.indent](s.value,e.component._group.getRowCount(),e.component._group.getData(),e.component):i.groupHeader!==!1&&(s.value=e.component._group.generator(s.value,e.component._group.getRowCount(),e.component._group.getData(),e.component)),a.colSpan=s.width,a.innerHTML=s.value,r.classList.add("tabulator-print-table-group"),r.classList.add("tabulator-group-level-"+e.indent),s.component.isVisible()&&r.classList.add("tabulator-group-visible"),this.mapElementStyles(n.firstGroup,r,["border-top","border-left","border-right","border-bottom","color","font-weight","font-family","font-size","background-color"]),this.mapElementStyles(n.firstGroup,a,["padding-top","padding-left","padding-right","padding-bottom"]),r.appendChild(a),r}generateCalcElement(e,i,n){var r=this.generateRowElement(e,i,n);return r.classList.add("tabulator-print-table-calcs"),this.mapElementStyles(n.calcRow,r,["border-top","border-left","border-right","border-bottom","color","font-weight","font-family","font-size","background-color"]),r}generateRowElement(e,i,n){var r=document.createElement("tr");if(r.classList.add("tabulator-print-table-row"),e.columns.forEach((a,s)=>{if(a){var o=document.createElement("td"),l=a.component._column,c=this.table,u=c.columnManager.findColumnIndex(l),d=a.value,p,h,f={modules:{},getValue:function(){return d},getField:function(){return l.definition.field},getElement:function(){return o},getType:function(){return"cell"},getColumn:function(){return l.getComponent()},getData:function(){return e.component.getData()},getRow:function(){return e.component},getTable:function(){return c},getComponent:function(){return f},column:l},m=l.definition.cssClass?l.definition.cssClass.split(" "):[];if(m.forEach(function(g){o.classList.add(g)}),this.table.modExists("format")&&this.config.formatCells!==!1)d=this.table.modules.format.formatExportValue(f,this.colVisProp);else switch(typeof d){case"object":d=d!==null?JSON.stringify(d):"";break;case"undefined":d="";break}d instanceof Node?o.appendChild(d):o.innerHTML=d,h=["padding-top","padding-left","padding-right","padding-bottom","border-top","border-left","border-right","border-bottom","color","font-weight","font-family","font-size","text-align"],l.isRowHeader?(p=n.styleRowHeader,h.push("background-color")):p=n.styleCells&&n.styleCells[u]?n.styleCells[u]:n.firstCell,p&&(this.mapElementStyles(p,o,h),l.definition.align&&(o.style.textAlign=l.definition.align)),this.table.options.dataTree&&this.config.dataTree!==!1&&(i.treeElementField&&i.treeElementField==l.field||!i.treeElementField&&s==0)&&(e.component._row.modules.dataTree.controlEl&&o.insertBefore(e.component._row.modules.dataTree.controlEl.cloneNode(!0),o.firstChild),e.component._row.modules.dataTree.branchEl&&o.insertBefore(e.component._row.modules.dataTree.branchEl.cloneNode(!0),o.firstChild)),r.appendChild(o),f.modules.format&&f.modules.format.renderedCallback&&f.modules.format.renderedCallback()}}),i.rowFormatter&&e.type==="row"&&this.config.formatCells!==!1){let a=Object.assign(e.component);a.getElement=function(){return r},i.rowFormatter(e.component)}return r}generateHTMLTable(e){var i=document.createElement("div");return i.appendChild(this.generateTableElement(e)),i.innerHTML}getHtml(e,i,n,r){var a=this.generateExportList(n||this.table.options.htmlOutputConfig,i,e,r||"htmlOutput");return this.generateHTMLTable(a)}mapElementStyles(e,i,n){if(this.cloneTableStyle&&e&&i){var r={"background-color":"backgroundColor",color:"fontColor",width:"width","font-weight":"fontWeight","font-family":"fontFamily","font-size":"fontSize","text-align":"textAlign","border-top":"borderTop","border-left":"borderLeft","border-right":"borderRight","border-bottom":"borderBottom","padding-top":"paddingTop","padding-left":"paddingLeft","padding-right":"paddingRight","padding-bottom":"paddingBottom"};if(window.getComputedStyle){var a=window.getComputedStyle(e);n.forEach(function(s){i.style[r[s]]||(i.style[r[s]]=a.getPropertyValue(s))})}}}};et(Av,"moduleName","export"),et(Av,"columnLookups",RXe),et(Av,"rowLookups",MXe);let $G=Av;var NXe={"=":function(t,e,i,n){return e==t},"<":function(t,e,i,n){return e<t},"<=":function(t,e,i,n){return e<=t},">":function(t,e,i,n){return e>t},">=":function(t,e,i,n){return e>=t},"!=":function(t,e,i,n){return e!=t},regex:function(t,e,i,n){return typeof t=="string"&&(t=new RegExp(t)),t.test(e)},like:function(t,e,i,n){return t===null||typeof t>"u"?e===t:typeof e<"u"&&e!==null?String(e).toLowerCase().indexOf(t.toLowerCase())>-1:!1},keywords:function(t,e,i,n){var r=t.toLowerCase().split(typeof n.separator>"u"?" ":n.separator),a=String(e===null||typeof e>"u"?"":e).toLowerCase(),s=[];return r.forEach(o=>{a.includes(o)&&s.push(!0)}),n.matchAll?s.length===r.length:!!s.length},starts:function(t,e,i,n){return t===null||typeof t>"u"?e===t:typeof e<"u"&&e!==null?String(e).toLowerCase().startsWith(t.toLowerCase()):!1},ends:function(t,e,i,n){return t===null||typeof t>"u"?e===t:typeof e<"u"&&e!==null?String(e).toLowerCase().endsWith(t.toLowerCase()):!1},in:function(t,e,i,n){return Array.isArray(t)?t.length?t.indexOf(e)>-1:!0:(console.warn("Filter Error - filter value is not an array:",t),!1)}};const Zm=class Zm extends qn{constructor(e){super(e),this.filterList=[],this.headerFilters={},this.headerFilterColumns=[],this.prevHeaderFilterChangeCheck="",this.prevHeaderFilterChangeCheck="{}",this.changed=!1,this.tableInitialized=!1,this.registerTableOption("filterMode","local"),this.registerTableOption("initialFilter",!1),this.registerTableOption("initialHeaderFilter",!1),this.registerTableOption("headerFilterLiveFilterDelay",300),this.registerTableOption("placeholderHeaderFilter",!1),this.registerColumnOption("headerFilter"),this.registerColumnOption("headerFilterPlaceholder"),this.registerColumnOption("headerFilterParams"),this.registerColumnOption("headerFilterEmptyCheck"),this.registerColumnOption("headerFilterFunc"),this.registerColumnOption("headerFilterFuncParams"),this.registerColumnOption("headerFilterLiveFilter"),this.registerTableFunction("searchRows",this.searchRows.bind(this)),this.registerTableFunction("searchData",this.searchData.bind(this)),this.registerTableFunction("setFilter",this.userSetFilter.bind(this)),this.registerTableFunction("refreshFilter",this.userRefreshFilter.bind(this)),this.registerTableFunction("addFilter",this.userAddFilter.bind(this)),this.registerTableFunction("getFilters",this.getFilters.bind(this)),this.registerTableFunction("setHeaderFilterFocus",this.userSetHeaderFilterFocus.bind(this)),this.registerTableFunction("getHeaderFilterValue",this.userGetHeaderFilterValue.bind(this)),this.registerTableFunction("setHeaderFilterValue",this.userSetHeaderFilterValue.bind(this)),this.registerTableFunction("getHeaderFilters",this.getHeaderFilters.bind(this)),this.registerTableFunction("removeFilter",this.userRemoveFilter.bind(this)),this.registerTableFunction("clearFilter",this.userClearFilter.bind(this)),this.registerTableFunction("clearHeaderFilter",this.userClearHeaderFilter.bind(this)),this.registerComponentFunction("column","headerFilterFocus",this.setHeaderFilterFocus.bind(this)),this.registerComponentFunction("column","reloadHeaderFilter",this.reloadHeaderFilter.bind(this)),this.registerComponentFunction("column","getHeaderFilterValue",this.getHeaderFilterValue.bind(this)),this.registerComponentFunction("column","setHeaderFilterValue",this.setHeaderFilterValue.bind(this))}initialize(){this.subscribe("column-init",this.initializeColumnHeaderFilter.bind(this)),this.subscribe("column-width-fit-before",this.hideHeaderFilterElements.bind(this)),this.subscribe("column-width-fit-after",this.showHeaderFilterElements.bind(this)),this.subscribe("table-built",this.tableBuilt.bind(this)),this.subscribe("placeholder",this.generatePlaceholder.bind(this)),this.table.options.filterMode==="remote"&&this.subscribe("data-params",this.remoteFilterParams.bind(this)),this.registerDataHandler(this.filter.bind(this),10)}tableBuilt(){this.table.options.initialFilter&&this.setFilter(this.table.options.initialFilter),this.table.options.initialHeaderFilter&&this.table.options.initialHeaderFilter.forEach(e=>{var i=this.table.columnManager.findColumn(e.field);if(i)this.setHeaderFilterValue(i,e.value);else return console.warn("Column Filter Error - No matching column found:",e.field),!1}),this.tableInitialized=!0}remoteFilterParams(e,i,n,r){return r.filter=this.getFilters(!0,!0),r}generatePlaceholder(e){if(this.table.options.placeholderHeaderFilter&&Object.keys(this.headerFilters).length)return this.table.options.placeholderHeaderFilter}userSetFilter(e,i,n,r){this.setFilter(e,i,n,r),this.refreshFilter()}userRefreshFilter(){this.refreshFilter()}userAddFilter(e,i,n,r){this.addFilter(e,i,n,r),this.refreshFilter()}userSetHeaderFilterFocus(e){var i=this.table.columnManager.findColumn(e);if(i)this.setHeaderFilterFocus(i);else return console.warn("Column Filter Focus Error - No matching column found:",e),!1}userGetHeaderFilterValue(e){var i=this.table.columnManager.findColumn(e);if(i)return this.getHeaderFilterValue(i);console.warn("Column Filter Error - No matching column found:",e)}userSetHeaderFilterValue(e,i){var n=this.table.columnManager.findColumn(e);if(n)this.setHeaderFilterValue(n,i);else return console.warn("Column Filter Error - No matching column found:",e),!1}userRemoveFilter(e,i,n){this.removeFilter(e,i,n),this.refreshFilter()}userClearFilter(e){this.clearFilter(e),this.refreshFilter()}userClearHeaderFilter(){this.clearHeaderFilter(),this.refreshFilter()}searchRows(e,i,n){return this.search("rows",e,i,n)}searchData(e,i,n){return this.search("data",e,i,n)}initializeColumnHeaderFilter(e){var i=e.definition;i.headerFilter&&this.initializeColumn(e)}initializeColumn(e,i){var n=this,r=e.getField();function a(s){var o=e.modules.filter.tagType=="input"&&e.modules.filter.attrType=="text"||e.modules.filter.tagType=="textarea"?"partial":"match",l="",c="",u;if(typeof e.modules.filter.prevSuccess>"u"||e.modules.filter.prevSuccess!==s){if(e.modules.filter.prevSuccess=s,e.modules.filter.emptyFunc(s))delete n.headerFilters[r];else{switch(e.modules.filter.value=s,typeof e.definition.headerFilterFunc){case"string":Zm.filters[e.definition.headerFilterFunc]?(l=e.definition.headerFilterFunc,u=function(d){var p=e.definition.headerFilterFuncParams||{},h=e.getFieldValue(d);return p=typeof p=="function"?p(s,h,d):p,Zm.filters[e.definition.headerFilterFunc](s,h,d,p)}):console.warn("Header Filter Error - Matching filter function not found: ",e.definition.headerFilterFunc);break;case"function":u=function(d){var p=e.definition.headerFilterFuncParams||{},h=e.getFieldValue(d);return p=typeof p=="function"?p(s,h,d):p,e.definition.headerFilterFunc(s,h,d,p)},l=u;break}if(!u)switch(o){case"partial":u=function(d){var p=e.getFieldValue(d);return typeof p<"u"&&p!==null?String(p).toLowerCase().indexOf(String(s).toLowerCase())>-1:!1},l="like";break;default:u=function(d){return e.getFieldValue(d)==s},l="="}n.headerFilters[r]={value:s,func:u,type:l}}e.modules.filter.value=s,c=JSON.stringify(n.headerFilters),n.prevHeaderFilterChangeCheck!==c&&(n.prevHeaderFilterChangeCheck=c,n.trackChanges(),n.refreshFilter())}return!0}e.modules.filter={success:a,attrType:!1,tagType:!1,emptyFunc:!1},this.generateHeaderFilterElement(e)}generateHeaderFilterElement(e,i,n){var r=this,a=e.modules.filter.success,s=e.getField(),o,l,c,u,d,p,h,f;e.modules.filter.value=i;function m(){}function g(v){f=v}if(e.modules.filter.headerElement&&e.modules.filter.headerElement.parentNode&&e.contentElement.removeChild(e.modules.filter.headerElement.parentNode),s){switch(e.modules.filter.emptyFunc=e.definition.headerFilterEmptyCheck||function(v){return!v&&v!==0},o=document.createElement("div"),o.classList.add("tabulator-header-filter"),typeof e.definition.headerFilter){case"string":r.table.modules.edit.editors[e.definition.headerFilter]?(l=r.table.modules.edit.editors[e.definition.headerFilter],(e.definition.headerFilter==="tick"||e.definition.headerFilter==="tickCross")&&!e.definition.headerFilterEmptyCheck&&(e.modules.filter.emptyFunc=function(v){return v!==!0&&v!==!1})):console.warn("Filter Error - Cannot build header filter, No such editor found: ",e.definition.editor);break;case"function":l=e.definition.headerFilter;break;case"boolean":e.modules.edit&&e.modules.edit.editor?l=e.modules.edit.editor:e.definition.formatter&&r.table.modules.edit.editors[e.definition.formatter]?(l=r.table.modules.edit.editors[e.definition.formatter],(e.definition.formatter==="tick"||e.definition.formatter==="tickCross")&&!e.definition.headerFilterEmptyCheck&&(e.modules.filter.emptyFunc=function(v){return v!==!0&&v!==!1})):l=r.table.modules.edit.editors.input;break}if(l){if(u={getValue:function(){return typeof i<"u"?i:""},getField:function(){return e.definition.field},getElement:function(){return o},getColumn:function(){return e.getComponent()},getTable:()=>this.table,getType:()=>"header",getRow:function(){return{normalizeHeight:function(){}}}},h=e.definition.headerFilterParams||{},h=typeof h=="function"?h.call(r.table,u):h,c=l.call(this.table.modules.edit,u,g,a,m,h),!c){console.warn("Filter Error - Cannot add filter to "+s+" column, editor returned a value of false");return}if(!(c instanceof Node)){console.warn("Filter Error - Cannot add filter to "+s+" column, editor should return an instance of Node, the editor returned:",c);return}r.langBind("headerFilters|columns|"+e.definition.field,function(v){c.setAttribute("placeholder",typeof v<"u"&&v?v:e.definition.headerFilterPlaceholder||r.langText("headerFilters|default"))}),c.addEventListener("click",function(v){v.stopPropagation(),c.focus()}),c.addEventListener("focus",v=>{var y=this.table.columnManager.contentsElement.scrollLeft,b=this.table.rowManager.element.scrollLeft;y!==b&&(this.table.rowManager.scrollHorizontal(y),this.table.columnManager.scrollHorizontal(y))}),d=!1,p=function(v){d&&clearTimeout(d),d=setTimeout(function(){a(c.value)},r.table.options.headerFilterLiveFilterDelay)},e.modules.filter.headerElement=c,e.modules.filter.attrType=c.hasAttribute("type")?c.getAttribute("type").toLowerCase():"",e.modules.filter.tagType=c.tagName.toLowerCase(),e.definition.headerFilterLiveFilter!==!1&&(e.definition.headerFilter==="autocomplete"||e.definition.headerFilter==="tickCross"||(e.definition.editor==="autocomplete"||e.definition.editor==="tickCross")&&e.definition.headerFilter===!0||(c.addEventListener("keyup",p),c.addEventListener("search",p),e.modules.filter.attrType=="number"&&c.addEventListener("change",function(v){a(c.value)}),e.modules.filter.attrType=="text"&&this.table.browser!=="ie"&&c.setAttribute("type","search")),(e.modules.filter.tagType=="input"||e.modules.filter.tagType=="select"||e.modules.filter.tagType=="textarea")&&c.addEventListener("mousedown",function(v){v.stopPropagation()})),o.appendChild(c),e.contentElement.appendChild(o),n||r.headerFilterColumns.push(e),f&&f()}}else console.warn("Filter Error - Cannot add header filter, column has no field set:",e.definition.title)}hideHeaderFilterElements(){this.headerFilterColumns.forEach(function(e){e.modules.filter&&e.modules.filter.headerElement&&(e.modules.filter.headerElement.style.display="none")})}showHeaderFilterElements(){this.headerFilterColumns.forEach(function(e){e.modules.filter&&e.modules.filter.headerElement&&(e.modules.filter.headerElement.style.display="")})}setHeaderFilterFocus(e){e.modules.filter&&e.modules.filter.headerElement?e.modules.filter.headerElement.focus():console.warn("Column Filter Focus Error - No header filter set on column:",e.getField())}getHeaderFilterValue(e){if(e.modules.filter&&e.modules.filter.headerElement)return e.modules.filter.value;console.warn("Column Filter Error - No header filter set on column:",e.getField())}setHeaderFilterValue(e,i){e&&(e.modules.filter&&e.modules.filter.headerElement?(this.generateHeaderFilterElement(e,i,!0),e.modules.filter.success(i)):console.warn("Column Filter Error - No header filter set on column:",e.getField()))}reloadHeaderFilter(e){e&&(e.modules.filter&&e.modules.filter.headerElement?this.generateHeaderFilterElement(e,e.modules.filter.value,!0):console.warn("Column Filter Error - No header filter set on column:",e.getField()))}refreshFilter(){this.tableInitialized&&(this.table.options.filterMode==="remote"?this.reloadData(null,!1,!1):this.refreshData(!0))}trackChanges(){this.changed=!0,this.dispatch("filter-changed")}hasChanged(){var e=this.changed;return this.changed=!1,e}setFilter(e,i,n,r){this.filterList=[],Array.isArray(e)||(e=[{field:e,type:i,value:n,params:r}]),this.addFilter(e)}addFilter(e,i,n,r){var a=!1;Array.isArray(e)||(e=[{field:e,type:i,value:n,params:r}]),e.forEach(s=>{s=this.findFilter(s),s&&(this.filterList.push(s),a=!0)}),a&&this.trackChanges()}findFilter(e){var i;if(Array.isArray(e))return this.findSubFilters(e);var n=!1;return typeof e.field=="function"?n=function(r){return e.field(r,e.type||{})}:Zm.filters[e.type]?(i=this.table.columnManager.getColumnByField(e.field),i?n=function(r){return Zm.filters[e.type](e.value,i.getFieldValue(r),r,e.params||{})}:n=function(r){return Zm.filters[e.type](e.value,r[e.field],r,e.params||{})}):console.warn("Filter Error - No such filter type found, ignoring: ",e.type),e.func=n,e.func?e:!1}findSubFilters(e){var i=[];return e.forEach(n=>{n=this.findFilter(n),n&&i.push(n)}),i.length?i:!1}getFilters(e,i){var n=[];return e&&(n=this.getHeaderFilters()),i&&n.forEach(function(r){typeof r.type=="function"&&(r.type="function")}),n=n.concat(this.filtersToArray(this.filterList,i)),n}filtersToArray(e,i){var n=[];return e.forEach(r=>{var a;Array.isArray(r)?n.push(this.filtersToArray(r,i)):(a={field:r.field,type:r.type,value:r.value},i&&typeof a.type=="function"&&(a.type="function"),n.push(a))}),n}getHeaderFilters(){var e=[];for(var i in this.headerFilters)e.push({field:i,type:this.headerFilters[i].type,value:this.headerFilters[i].value});return e}removeFilter(e,i,n){Array.isArray(e)||(e=[{field:e,type:i,value:n}]),e.forEach(r=>{var a=-1;typeof r.field=="object"?a=this.filterList.findIndex(s=>r===s):a=this.filterList.findIndex(s=>r.field===s.field&&r.type===s.type&&r.value===s.value),a>-1?this.filterList.splice(a,1):console.warn("Filter Error - No matching filter type found, ignoring: ",r.type)}),this.trackChanges()}clearFilter(e){this.filterList=[],e&&this.clearHeaderFilter(),this.trackChanges()}clearHeaderFilter(){this.headerFilters={},this.prevHeaderFilterChangeCheck="{}",this.headerFilterColumns.forEach(e=>{typeof e.modules.filter.value<"u"&&delete e.modules.filter.value,e.modules.filter.prevSuccess=void 0,this.reloadHeaderFilter(e)}),this.trackChanges()}search(e,i,n,r){var a=[],s=[];return Array.isArray(i)||(i=[{field:i,type:n,value:r}]),i.forEach(o=>{o=this.findFilter(o),o&&s.push(o)}),this.table.rowManager.rows.forEach(o=>{var l=!0;s.forEach(c=>{this.filterRecurse(c,o.getData())||(l=!1)}),l&&a.push(e==="data"?o.getData("data"):o.getComponent())}),a}filter(e,i){var n=[],r=[];return this.subscribedExternal("dataFiltering")&&this.dispatchExternal("dataFiltering",this.getFilters(!0)),this.table.options.filterMode!=="remote"&&(this.filterList.length||Object.keys(this.headerFilters).length)?e.forEach(a=>{this.filterRow(a)&&n.push(a)}):n=e.slice(0),this.subscribedExternal("dataFiltered")&&(n.forEach(a=>{r.push(a.getComponent())}),this.dispatchExternal("dataFiltered",this.getFilters(!0),r)),n}filterRow(e,i){var n=!0,r=e.getData();this.filterList.forEach(s=>{this.filterRecurse(s,r)||(n=!1)});for(var a in this.headerFilters)this.headerFilters[a].func(r)||(n=!1);return n}filterRecurse(e,i){var n=!1;return Array.isArray(e)?e.forEach(r=>{this.filterRecurse(r,i)&&(n=!0)}):n=e.func(i),n}};et(Zm,"moduleName","filter"),et(Zm,"filters",NXe);let BG=Zm;function AXe(t,e,i){return this.emptyToSpace(this.sanitizeHTML(t.getValue()))}function _Xe(t,e,i){return t.getValue()}function kXe(t,e,i){return t.getElement().style.whiteSpace="pre-wrap",this.emptyToSpace(this.sanitizeHTML(t.getValue()))}function xXe(t,e,i){var n=parseFloat(t.getValue()),r="",a,s,o,l,c,u=e.decimal||".",d=e.thousand||",",p=e.negativeSign||"-",h=e.symbol||"",f=!!e.symbolAfter,m=typeof e.precision<"u"?e.precision:2;if(isNaN(n))return this.emptyToSpace(this.sanitizeHTML(t.getValue()));if(n<0&&(n=Math.abs(n),r=p),a=m!==!1?n.toFixed(m):n,a=String(a).split("."),s=a[0],o=a.length>1?u+a[1]:"",e.thousand!==!1)for(l=/(\d+)(\d{3})/;l.test(s);)s=s.replace(l,"$1"+d+"$2");return c=s+o,r===!0?(c="("+c+")",f?c+h:h+c):f?r+c+h:r+h+c}function OXe(t,e,i){var n=t.getValue(),r=e.urlPrefix||"",a=e.download,s=n,o=document.createElement("a"),l;function c(u,d){var p=u.shift(),h=d[p];return u.length&&typeof h=="object"?c(u,h):h}if(e.labelField&&(l=t.getData(),s=c(e.labelField.split(this.table.options.nestedFieldSeparator),l)),e.label)switch(typeof e.label){case"string":s=e.label;break;case"function":s=e.label(t);break}if(s){if(e.urlField&&(l=t.getData(),n=Ha.retrieveNestedData(this.table.options.nestedFieldSeparator,e.urlField,l)),e.url)switch(typeof e.url){case"string":n=e.url;break;case"function":n=e.url(t);break}return o.setAttribute("href",r+n),e.target&&o.setAttribute("target",e.target),e.download&&(typeof a=="function"?a=a(t):a=a===!0?"":a,o.setAttribute("download",a)),o.innerHTML=this.emptyToSpace(this.sanitizeHTML(s)),o}else return"&nbsp;"}function LXe(t,e,i){var n=document.createElement("img"),r=t.getValue();switch(e.urlPrefix&&(r=e.urlPrefix+t.getValue()),e.urlSuffix&&(r=r+e.urlSuffix),n.setAttribute("src",r),typeof e.height){case"number":n.style.height=e.height+"px";break;case"string":n.style.height=e.height;break}switch(typeof e.width){case"number":n.style.width=e.width+"px";break;case"string":n.style.width=e.width;break}return n.addEventListener("load",function(){t.getRow().normalizeHeight()}),n}function FXe(t,e,i){var n=t.getValue(),r=t.getElement(),a=e.allowEmpty,s=e.allowTruthy,o=Object.keys(e).includes("trueValue"),l=typeof e.tickElement<"u"?e.tickElement:'<svg enable-background="new 0 0 24 24" height="14" width="14" viewBox="0 0 24 24" xml:space="preserve" ><path fill="#2DC214" clip-rule="evenodd" d="M21.652,3.211c-0.293-0.295-0.77-0.295-1.061,0L9.41,14.34  c-0.293,0.297-0.771,0.297-1.062,0L3.449,9.351C3.304,9.203,3.114,9.13,2.923,9.129C2.73,9.128,2.534,9.201,2.387,9.351  l-2.165,1.946C0.078,11.445,0,11.63,0,11.823c0,0.194,0.078,0.397,0.223,0.544l4.94,5.184c0.292,0.296,0.771,0.776,1.062,1.07  l2.124,2.141c0.292,0.293,0.769,0.293,1.062,0l14.366-14.34c0.293-0.294,0.293-0.777,0-1.071L21.652,3.211z" fill-rule="evenodd"/></svg>',c=typeof e.crossElement<"u"?e.crossElement:'<svg enable-background="new 0 0 24 24" height="14" width="14"  viewBox="0 0 24 24" xml:space="preserve" ><path fill="#CE1515" d="M22.245,4.015c0.313,0.313,0.313,0.826,0,1.139l-6.276,6.27c-0.313,0.312-0.313,0.826,0,1.14l6.273,6.272  c0.313,0.313,0.313,0.826,0,1.14l-2.285,2.277c-0.314,0.312-0.828,0.312-1.142,0l-6.271-6.271c-0.313-0.313-0.828-0.313-1.141,0  l-6.276,6.267c-0.313,0.313-0.828,0.313-1.141,0l-2.282-2.28c-0.313-0.313-0.313-0.826,0-1.14l6.278-6.269  c0.313-0.312,0.313-0.826,0-1.14L1.709,5.147c-0.314-0.313-0.314-0.827,0-1.14l2.284-2.278C4.308,1.417,4.821,1.417,5.135,1.73  L11.405,8c0.314,0.314,0.828,0.314,1.141,0.001l6.276-6.267c0.312-0.312,0.826-0.312,1.141,0L22.245,4.015z"/></svg>';return o&&n===e.trueValue||!o&&(s&&n||n===!0||n==="true"||n==="True"||n===1||n==="1")?(r.setAttribute("aria-checked",!0),l||""):a&&(n==="null"||n===""||n===null||typeof n>"u")?(r.setAttribute("aria-checked","mixed"),""):(r.setAttribute("aria-checked",!1),c||"")}function $Xe(t,e,i){var n=window.DateTime||luxon.DateTime,r=e.inputFormat||"yyyy-MM-dd HH:mm:ss",a=e.outputFormat||"dd/MM/yyyy HH:mm:ss",s=typeof e.invalidPlaceholder<"u"?e.invalidPlaceholder:"",o=t.getValue();if(typeof n<"u"){var l;return n.isDateTime(o)?l=o:r==="iso"?l=n.fromISO(String(o)):l=n.fromFormat(String(o),r),l.isValid?(e.timezone&&(l=l.setZone(e.timezone)),l.toFormat(a)):s===!0||!o?o:typeof s=="function"?s(o):s}else console.error("Format Error - 'datetime' formatter is dependant on luxon.js")}function BXe(t,e,i){var n=window.DateTime||luxon.DateTime,r=e.inputFormat||"yyyy-MM-dd HH:mm:ss",a=typeof e.invalidPlaceholder<"u"?e.invalidPlaceholder:"",s=typeof e.suffix<"u"?e.suffix:!1,o=typeof e.unit<"u"?e.unit:"days",l=typeof e.humanize<"u"?e.humanize:!1,c=typeof e.date<"u"?e.date:n.now(),u=t.getValue();if(typeof n<"u"){var d;return n.isDateTime(u)?d=u:r==="iso"?d=n.fromISO(String(u)):d=n.fromFormat(String(u),r),d.isValid?l?d.diff(c,o).toHuman()+(s?" "+s:""):parseInt(d.diff(c,o)[o])+(s?" "+s:""):a===!0?u:typeof a=="function"?a(u):a}else console.error("Format Error - 'datetimediff' formatter is dependant on luxon.js")}function VXe(t,e,i){var n=t.getValue();return typeof e[n]>"u"?(console.warn("Missing display value for "+n),n):e[n]}function jXe(t,e,i){var n=t.getValue(),r=t.getElement(),a=e&&e.stars?e.stars:5,s=document.createElement("span"),o=document.createElementNS("http://www.w3.org/2000/svg","svg"),l='<polygon fill="#FFEA00" stroke="#C1AB60" stroke-width="37.6152" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" points="259.216,29.942 330.27,173.919 489.16,197.007 374.185,309.08 401.33,467.31 259.216,392.612 117.104,467.31 144.25,309.08 29.274,197.007 188.165,173.919 "/>',c='<polygon fill="#D2D2D2" stroke="#686868" stroke-width="37.6152" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" points="259.216,29.942 330.27,173.919 489.16,197.007 374.185,309.08 401.33,467.31 259.216,392.612 117.104,467.31 144.25,309.08 29.274,197.007 188.165,173.919 "/>';s.style.verticalAlign="middle",o.setAttribute("width","14"),o.setAttribute("height","14"),o.setAttribute("viewBox","0 0 512 512"),o.setAttribute("xml:space","preserve"),o.style.padding="0 1px",n=n&&!isNaN(n)?parseInt(n):0,n=Math.max(0,Math.min(n,a));for(var u=1;u<=a;u++){var d=o.cloneNode(!0);d.innerHTML=u<=n?l:c,s.appendChild(d)}return r.style.whiteSpace="nowrap",r.style.overflow="hidden",r.style.textOverflow="ellipsis",r.setAttribute("aria-label",n),s}function GXe(t,e,i){var n=this.sanitizeHTML(t.getValue())||0,r=document.createElement("span"),a=e&&e.max?e.max:100,s=e&&e.min?e.min:0,o=e&&typeof e.color<"u"?e.color:["red","orange","green"],l="#666666",c,u;if(!(isNaN(n)||typeof t.getValue()>"u")){switch(r.classList.add("tabulator-traffic-light"),u=parseFloat(n)<=a?parseFloat(n):a,u=parseFloat(u)>=s?parseFloat(u):s,c=(a-s)/100,u=Math.round((u-s)/c),typeof o){case"string":l=o;break;case"function":l=o(n);break;case"object":if(Array.isArray(o)){var d=100/o.length,p=Math.floor(u/d);p=Math.min(p,o.length-1),p=Math.max(p,0),l=o[p];break}}return r.style.backgroundColor=l,r}}function HXe(t,e={},i){var n=this.sanitizeHTML(t.getValue())||0,r=t.getElement(),a=e.max?e.max:100,s=e.min?e.min:0,o=e.legendAlign?e.legendAlign:"center",l,c,u,d,p;switch(c=parseFloat(n)<=a?parseFloat(n):a,c=parseFloat(c)>=s?parseFloat(c):s,l=(a-s)/100,c=Math.round((c-s)/l),typeof e.color){case"string":u=e.color;break;case"function":u=e.color(n);break;case"object":if(Array.isArray(e.color)){let g=100/e.color.length,v=Math.floor(c/g);v=Math.min(v,e.color.length-1),v=Math.max(v,0),u=e.color[v];break}default:u="#2DC214"}switch(typeof e.legend){case"string":d=e.legend;break;case"function":d=e.legend(n);break;case"boolean":d=n;break;default:d=!1}switch(typeof e.legendColor){case"string":p=e.legendColor;break;case"function":p=e.legendColor(n);break;case"object":if(Array.isArray(e.legendColor)){let g=100/e.legendColor.length,v=Math.floor(c/g);v=Math.min(v,e.legendColor.length-1),v=Math.max(v,0),p=e.legendColor[v]}break;default:p="#000"}r.style.minWidth="30px",r.style.position="relative",r.setAttribute("aria-label",c);var h=document.createElement("div");h.style.display="inline-block",h.style.width=c+"%",h.style.backgroundColor=u,h.style.height="100%",h.setAttribute("data-max",a),h.setAttribute("data-min",s);var f=document.createElement("div");if(f.style.position="relative",f.style.width="100%",f.style.height="100%",d){var m=document.createElement("div");m.style.position="absolute",m.style.top=0,m.style.left=0,m.style.textAlign=o,m.style.width="100%",m.style.color=p,m.innerHTML=d}return i(function(){if(!(t instanceof f1e)){var g=document.createElement("div");g.style.position="absolute",g.style.top="4px",g.style.bottom="4px",g.style.left="4px",g.style.right="4px",r.appendChild(g),r=g}r.appendChild(f),f.appendChild(h),d&&f.appendChild(m)}),""}function zXe(t,e,i){return t.getElement().style.backgroundColor=this.sanitizeHTML(t.getValue()),""}function qXe(t,e,i){return'<svg enable-background="new 0 0 24 24" height="14" width="14" viewBox="0 0 24 24" xml:space="preserve" ><path fill="#2DC214" clip-rule="evenodd" d="M21.652,3.211c-0.293-0.295-0.77-0.295-1.061,0L9.41,14.34  c-0.293,0.297-0.771,0.297-1.062,0L3.449,9.351C3.304,9.203,3.114,9.13,2.923,9.129C2.73,9.128,2.534,9.201,2.387,9.351  l-2.165,1.946C0.078,11.445,0,11.63,0,11.823c0,0.194,0.078,0.397,0.223,0.544l4.94,5.184c0.292,0.296,0.771,0.776,1.062,1.07  l2.124,2.141c0.292,0.293,0.769,0.293,1.062,0l14.366-14.34c0.293-0.294,0.293-0.777,0-1.071L21.652,3.211z" fill-rule="evenodd"/></svg>'}function WXe(t,e,i){return'<svg enable-background="new 0 0 24 24" height="14" width="14" viewBox="0 0 24 24" xml:space="preserve" ><path fill="#CE1515" d="M22.245,4.015c0.313,0.313,0.313,0.826,0,1.139l-6.276,6.27c-0.313,0.312-0.313,0.826,0,1.14l6.273,6.272  c0.313,0.313,0.313,0.826,0,1.14l-2.285,2.277c-0.314,0.312-0.828,0.312-1.142,0l-6.271-6.271c-0.313-0.313-0.828-0.313-1.141,0  l-6.276,6.267c-0.313,0.313-0.828,0.313-1.141,0l-2.282-2.28c-0.313-0.313-0.313-0.826,0-1.14l6.278-6.269  c0.313-0.312,0.313-0.826,0-1.14L1.709,5.147c-0.314-0.313-0.314-0.827,0-1.14l2.284-2.278C4.308,1.417,4.821,1.417,5.135,1.73  L11.405,8c0.314,0.314,0.828,0.314,1.141,0.001l6.276-6.267c0.312-0.312,0.826-0.312,1.141,0L22.245,4.015z"/></svg>'}function YXe(t,e,i){var n=t.getValue(),r=e.size||15,a=r+"px",s,o,l=e.hasOwnProperty("onValue")?e.onValue:!0,c=e.hasOwnProperty("offValue")?e.offValue:!1,u=e.onTruthy?n:n===l;return s=document.createElement("div"),s.classList.add("tabulator-toggle"),u?(s.classList.add("tabulator-toggle-on"),s.style.flexDirection="row-reverse",e.onColor&&(s.style.background=e.onColor)):e.offColor&&(s.style.background=e.offColor),s.style.width=2.5*r+"px",s.style.borderRadius=a,e.clickable&&s.addEventListener("click",d=>{t.setValue(u?c:l)}),o=document.createElement("div"),o.classList.add("tabulator-toggle-switch"),o.style.height=a,o.style.width=a,o.style.borderRadius=a,s.appendChild(o),s}function KXe(t,e,i){var n=document.createElement("span"),r=t.getRow(),a=t.getTable();return r.watchPosition(s=>{e.relativeToPage&&(s+=a.modules.page.getPageSize()*(a.modules.page.getPage()-1)),n.innerText=s}),n}function ZXe(t,e,i){return t.getElement().classList.add("tabulator-row-handle"),"<div class='tabulator-row-handle-box'><div class='tabulator-row-handle-bar'></div><div class='tabulator-row-handle-bar'></div><div class='tabulator-row-handle-bar'></div></div>"}var XXe={plaintext:AXe,html:_Xe,textarea:kXe,money:xXe,link:OXe,image:LXe,tickCross:FXe,datetime:$Xe,datetimediff:BXe,lookup:VXe,star:jXe,traffic:GXe,progress:HXe,color:zXe,buttonTick:qXe,buttonCross:WXe,toggle:YXe,rownum:KXe,handle:ZXe};const tp=class tp extends qn{constructor(e){super(e),this.registerColumnOption("formatter"),this.registerColumnOption("formatterParams"),this.registerColumnOption("formatterPrint"),this.registerColumnOption("formatterPrintParams"),this.registerColumnOption("formatterClipboard"),this.registerColumnOption("formatterClipboardParams"),this.registerColumnOption("formatterHtmlOutput"),this.registerColumnOption("formatterHtmlOutputParams"),this.registerColumnOption("titleFormatter"),this.registerColumnOption("titleFormatterParams")}initialize(){this.subscribe("cell-format",this.formatValue.bind(this)),this.subscribe("cell-rendered",this.cellRendered.bind(this)),this.subscribe("column-layout",this.initializeColumn.bind(this)),this.subscribe("column-format",this.formatHeader.bind(this))}initializeColumn(e){e.modules.format=this.lookupFormatter(e,""),typeof e.definition.formatterPrint<"u"&&(e.modules.format.print=this.lookupFormatter(e,"Print")),typeof e.definition.formatterClipboard<"u"&&(e.modules.format.clipboard=this.lookupFormatter(e,"Clipboard")),typeof e.definition.formatterHtmlOutput<"u"&&(e.modules.format.htmlOutput=this.lookupFormatter(e,"HtmlOutput"))}lookupFormatter(e,i){var n={params:e.definition["formatter"+i+"Params"]||{}},r=e.definition["formatter"+i];switch(typeof r){case"string":tp.formatters[r]?n.formatter=tp.formatters[r]:(console.warn("Formatter Error - No such formatter found: ",r),n.formatter=tp.formatters.plaintext);break;case"function":n.formatter=r;break;default:n.formatter=tp.formatters.plaintext;break}return n}cellRendered(e){e.modules.format&&e.modules.format.renderedCallback&&!e.modules.format.rendered&&(e.modules.format.renderedCallback(),e.modules.format.rendered=!0)}formatHeader(e,i,n){var r,a,s,o;return e.definition.titleFormatter?(r=this.getFormatter(e.definition.titleFormatter),s=l=>{e.titleFormatterRendered=l},o={getValue:function(){return i},getElement:function(){return n},getType:function(){return"header"},getColumn:function(){return e.getComponent()},getTable:()=>this.table},a=e.definition.titleFormatterParams||{},a=typeof a=="function"?a():a,r.call(this,o,a,s)):i}formatValue(e){var i=e.getComponent(),n=typeof e.column.modules.format.params=="function"?e.column.modules.format.params(i):e.column.modules.format.params;function r(a){e.modules.format||(e.modules.format={}),e.modules.format.renderedCallback=a,e.modules.format.rendered=!1}return e.column.modules.format.formatter.call(this,i,n,r)}formatExportValue(e,i){var n=e.column.modules.format[i],r;if(n){let a=function(s){e.modules.format||(e.modules.format={}),e.modules.format.renderedCallback=s,e.modules.format.rendered=!1};return r=typeof n.params=="function"?n.params(e.getComponent()):n.params,n.formatter.call(this,e.getComponent(),r,a)}else return this.formatValue(e)}sanitizeHTML(e){if(e){var i={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"};return String(e).replace(/[&<>"'`=/]/g,function(n){return i[n]})}else return e}emptyToSpace(e){return e===null||typeof e>"u"||e===""?"&nbsp;":e}getFormatter(e){switch(typeof e){case"string":tp.formatters[e]?e=tp.formatters[e]:(console.warn("Formatter Error - No such formatter found: ",e),e=tp.formatters.plaintext);break;case"function":break;default:e=tp.formatters.plaintext;break}return e}};et(tp,"moduleName","format"),et(tp,"formatters",XXe);let VG=tp;class y1e extends qn{constructor(e){super(e),this.leftColumns=[],this.rightColumns=[],this.initializationMode="left",this.active=!1,this.blocked=!0,this.registerColumnOption("frozen")}reset(){this.initializationMode="left",this.leftColumns=[],this.rightColumns=[],this.active=!1}initialize(){this.subscribe("cell-layout",this.layoutCell.bind(this)),this.subscribe("column-init",this.initializeColumn.bind(this)),this.subscribe("column-width",this.layout.bind(this)),this.subscribe("row-layout-after",this.layoutRow.bind(this)),this.subscribe("table-layout",this.layout.bind(this)),this.subscribe("columns-loading",this.reset.bind(this)),this.subscribe("column-add",this.reinitializeColumns.bind(this)),this.subscribe("column-deleted",this.reinitializeColumns.bind(this)),this.subscribe("column-hide",this.reinitializeColumns.bind(this)),this.subscribe("column-show",this.reinitializeColumns.bind(this)),this.subscribe("columns-loaded",this.reinitializeColumns.bind(this)),this.subscribe("table-redraw",this.layout.bind(this)),this.subscribe("layout-refreshing",this.blockLayout.bind(this)),this.subscribe("layout-refreshed",this.unblockLayout.bind(this)),this.subscribe("scrollbar-vertical",this.adjustForScrollbar.bind(this))}blockLayout(){this.blocked=!0}unblockLayout(){this.blocked=!1}layoutCell(e){this.layoutElement(e.element,e.column)}reinitializeColumns(){this.reset(),this.table.columnManager.columnsByIndex.forEach(e=>{this.initializeColumn(e)}),this.layout()}initializeColumn(e){var i={margin:0,edge:!1};e.isGroup||(this.frozenCheck(e)?(i.position=this.initializationMode,this.initializationMode=="left"?this.leftColumns.push(e):this.rightColumns.unshift(e),this.active=!0,e.modules.frozen=i):this.initializationMode="right")}frozenCheck(e){return e.parent.isGroup&&e.definition.frozen&&console.warn("Frozen Column Error - Parent column group must be frozen, not individual columns or sub column groups"),e.parent.isGroup?this.frozenCheck(e.parent):e.definition.frozen}layoutCalcRows(){this.table.modExists("columnCalcs")&&(this.table.modules.columnCalcs.topInitialized&&this.table.modules.columnCalcs.topRow&&this.layoutRow(this.table.modules.columnCalcs.topRow),this.table.modules.columnCalcs.botInitialized&&this.table.modules.columnCalcs.botRow&&this.layoutRow(this.table.modules.columnCalcs.botRow),this.table.modExists("groupRows")&&this.layoutGroupCalcs(this.table.modules.groupRows.getGroups()))}layoutGroupCalcs(e){e.forEach(i=>{i.calcs.top&&this.layoutRow(i.calcs.top),i.calcs.bottom&&this.layoutRow(i.calcs.bottom),i.groupList&&i.groupList.length&&this.layoutGroupCalcs(i.groupList)})}layoutColumnPosition(e){var i=[],n=0,r=0;this.leftColumns.forEach((a,s)=>{if(a.modules.frozen.marginValue=n,a.modules.frozen.margin=a.modules.frozen.marginValue+"px",a.visible&&(n+=a.getWidth()),s==this.leftColumns.length-1?a.modules.frozen.edge=!0:a.modules.frozen.edge=!1,a.parent.isGroup){var o=this.getColGroupParentElement(a);i.includes(o)||(this.layoutElement(o,a),i.push(o)),o.classList.toggle("tabulator-frozen-left",a.modules.frozen.edge&&a.modules.frozen.position==="left"),o.classList.toggle("tabulator-frozen-right",a.modules.frozen.edge&&a.modules.frozen.position==="right")}else this.layoutElement(a.getElement(),a);e&&a.cells.forEach(l=>{this.layoutElement(l.getElement(!0),a)})}),this.rightColumns.forEach((a,s)=>{a.modules.frozen.marginValue=r,a.modules.frozen.margin=a.modules.frozen.marginValue+"px",a.visible&&(r+=a.getWidth()),s==this.rightColumns.length-1?a.modules.frozen.edge=!0:a.modules.frozen.edge=!1,a.parent.isGroup?this.layoutElement(this.getColGroupParentElement(a),a):this.layoutElement(a.getElement(),a),e&&a.cells.forEach(o=>{this.layoutElement(o.getElement(!0),a)})})}getColGroupParentElement(e){return e.parent.isGroup?this.getColGroupParentElement(e.parent):e.getElement()}layout(){this.active&&!this.blocked&&(this.layoutColumnPosition(),this.reinitializeRows(),this.layoutCalcRows())}reinitializeRows(){var e=this.table.rowManager.getVisibleRows(!0),i=this.table.rowManager.getRows().filter(n=>!e.includes(n));i.forEach(n=>{n.deinitialize()}),e.forEach(n=>{n.type==="row"&&this.layoutRow(n)})}layoutRow(e){this.table.options.layout==="fitDataFill"&&this.rightColumns.length&&(this.table.rowManager.getTableElement().style.minWidth="calc(100% - "+this.rightMargin+")"),this.leftColumns.forEach(i=>{var n=e.getCell(i);n&&this.layoutElement(n.getElement(!0),i)}),this.rightColumns.forEach(i=>{var n=e.getCell(i);n&&this.layoutElement(n.getElement(!0),i)})}layoutElement(e,i){var n;i.modules.frozen&&e&&(e.style.position="sticky",this.table.rtl?n=i.modules.frozen.position==="left"?"right":"left":n=i.modules.frozen.position,e.style[n]=i.modules.frozen.margin,e.classList.add("tabulator-frozen"),e.classList.toggle("tabulator-frozen-left",i.modules.frozen.edge&&i.modules.frozen.position==="left"),e.classList.toggle("tabulator-frozen-right",i.modules.frozen.edge&&i.modules.frozen.position==="right"))}adjustForScrollbar(e){this.rightColumns.length&&(this.table.columnManager.getContentsElement().style.width="calc(100% - "+e+"px)")}getFrozenColumns(){return this.leftColumns.concat(this.rightColumns)}_calcSpace(e,i){var n=0;for(let r=0;r<i;r++)e[r].visible&&(n+=e[r].getWidth());return n}}et(y1e,"moduleName","frozenColumns");class b1e extends qn{constructor(e){super(e),this.topElement=document.createElement("div"),this.rows=[],this.registerComponentFunction("row","freeze",this.freezeRow.bind(this)),this.registerComponentFunction("row","unfreeze",this.unfreezeRow.bind(this)),this.registerComponentFunction("row","isFrozen",this.isRowFrozen.bind(this)),this.registerTableOption("frozenRowsField","id"),this.registerTableOption("frozenRows",!1)}initialize(){var e=document.createDocumentFragment();this.rows=[],this.topElement.classList.add("tabulator-frozen-rows-holder"),e.appendChild(document.createElement("br")),e.appendChild(this.topElement),this.table.columnManager.getContentsElement().insertBefore(e,this.table.columnManager.headersElement.nextSibling),this.subscribe("row-deleting",this.detachRow.bind(this)),this.subscribe("rows-visible",this.visibleRows.bind(this)),this.registerDisplayHandler(this.getRows.bind(this),10),this.table.options.frozenRows&&(this.subscribe("data-processed",this.initializeRows.bind(this)),this.subscribe("row-added",this.initializeRow.bind(this)),this.subscribe("table-redrawing",this.resizeHolderWidth.bind(this)),this.subscribe("column-resized",this.resizeHolderWidth.bind(this)),this.subscribe("column-show",this.resizeHolderWidth.bind(this)),this.subscribe("column-hide",this.resizeHolderWidth.bind(this))),this.resizeHolderWidth()}resizeHolderWidth(){this.topElement.style.minWidth=this.table.columnManager.headersElement.offsetWidth+"px"}initializeRows(){this.table.rowManager.getRows().forEach(e=>{this.initializeRow(e)})}initializeRow(e){var i=this.table.options.frozenRows,n=typeof i;n==="number"?e.getPosition()&&e.getPosition()+this.rows.length<=i&&this.freezeRow(e):n==="function"?i.call(this.table,e.getComponent())&&this.freezeRow(e):Array.isArray(i)&&i.includes(e.data[this.options("frozenRowsField")])&&this.freezeRow(e)}isRowFrozen(e){var i=this.rows.indexOf(e);return i>-1}isFrozen(){return!!this.rows.length}visibleRows(e,i){return this.rows.forEach(n=>{i.push(n)}),i}getRows(e){var i=e.slice(0);return this.rows.forEach(function(n){var r=i.indexOf(n);r>-1&&i.splice(r,1)}),i}freezeRow(e){e.modules.frozen?console.warn("Freeze Error - Row is already frozen"):(e.modules.frozen=!0,this.topElement.appendChild(e.getElement()),e.initialize(),e.normalizeHeight(),this.rows.push(e),this.refreshData(!1,"display"),this.table.rowManager.adjustTableSize(),this.styleRows())}unfreezeRow(e){e.modules.frozen?(e.modules.frozen=!1,this.detachRow(e),this.table.rowManager.adjustTableSize(),this.refreshData(!1,"display"),this.rows.length&&this.styleRows()):console.warn("Freeze Error - Row is already unfrozen")}detachRow(e){var i=this.rows.indexOf(e);if(i>-1){var n=e.getElement();n.parentNode&&n.parentNode.removeChild(n),this.rows.splice(i,1)}}styleRows(e){this.rows.forEach((i,n)=>{this.table.rowManager.styleRow(i,n)})}}et(b1e,"moduleName","frozenRows");class JXe{constructor(e){return this._group=e,this.type="GroupComponent",new Proxy(this,{get:function(i,n,r){return typeof i[n]<"u"?i[n]:i._group.groupManager.table.componentFunctionBinder.handle("group",i._group,n)}})}getKey(){return this._group.key}getField(){return this._group.field}getElement(){return this._group.element}getRows(){return this._group.getRows(!0)}getSubGroups(){return this._group.getSubGroups(!0)}getParentGroup(){return this._group.parent?this._group.parent.getComponent():!1}isVisible(){return this._group.visible}show(){this._group.show()}hide(){this._group.hide()}toggle(){this._group.toggleVisibility()}scrollTo(e,i){return this._group.groupManager.table.rowManager.scrollToRow(this._group,e,i)}_getSelf(){return this._group}getTable(){return this._group.groupManager.table}}class rS{constructor(e,i,n,r,a,s,o){this.groupManager=e,this.parent=i,this.key=r,this.level=n,this.field=a,this.hasSubGroups=n<e.groupIDLookups.length-1,this.addRow=this.hasSubGroups?this._addRowToGroup:this._addRow,this.type="group",this.old=o,this.rows=[],this.groups=[],this.groupList=[],this.generator=s,this.element=!1,this.elementContents=!1,this.height=0,this.outerHeight=0,this.initialized=!1,this.calcs={},this.initialized=!1,this.modules={},this.arrowElement=!1,this.visible=o?o.visible:typeof e.startOpen[n]<"u"?e.startOpen[n]:e.startOpen[0],this.component=null,this.createElements(),this.addBindings(),this.createValueGroups()}wipe(e){e||(this.groupList.length?this.groupList.forEach(function(i){i.wipe()}):this.rows.forEach(i=>{i.modules&&delete i.modules.group})),this.element=!1,this.arrowElement=!1,this.elementContents=!1}createElements(){var e=document.createElement("div");e.classList.add("tabulator-arrow"),this.element=document.createElement("div"),this.element.classList.add("tabulator-row"),this.element.classList.add("tabulator-group"),this.element.classList.add("tabulator-group-level-"+this.level),this.element.setAttribute("role","rowgroup"),this.arrowElement=document.createElement("div"),this.arrowElement.classList.add("tabulator-group-toggle"),this.arrowElement.appendChild(e),this.groupManager.table.options.movableRows!==!1&&this.groupManager.table.modExists("moveRow")&&this.groupManager.table.modules.moveRow.initializeGroupHeader(this)}createValueGroups(){var e=this.level+1;this.groupManager.allowedValues&&this.groupManager.allowedValues[e]&&this.groupManager.allowedValues[e].forEach(i=>{this._createGroup(i,e)})}addBindings(){var e;this.groupManager.table.options.groupToggleElement&&(e=this.groupManager.table.options.groupToggleElement=="arrow"?this.arrowElement:this.element,e.addEventListener("click",i=>{this.groupManager.table.options.groupToggleElement==="arrow"&&(i.stopPropagation(),i.stopImmediatePropagation()),setTimeout(()=>{this.toggleVisibility()})}))}_createGroup(e,i){var n=i+"_"+e,r=new rS(this.groupManager,this,i,e,this.groupManager.groupIDLookups[i].field,this.groupManager.headerGenerator[i]||this.groupManager.headerGenerator[0],this.old?this.old.groups[n]:!1);this.groups[n]=r,this.groupList.push(r)}_addRowToGroup(e){var i=this.level+1;if(this.hasSubGroups){var n=this.groupManager.groupIDLookups[i].func(e.getData()),r=i+"_"+n;this.groupManager.allowedValues&&this.groupManager.allowedValues[i]?this.groups[r]&&this.groups[r].addRow(e):(this.groups[r]||this._createGroup(n,i),this.groups[r].addRow(e))}}_addRow(e){this.rows.push(e),e.modules.group=this}insertRow(e,i,n){var r=this.conformRowData({});e.updateData(r);var a=this.rows.indexOf(i);a>-1?n?this.rows.splice(a+1,0,e):this.rows.splice(a,0,e):n?this.rows.push(e):this.rows.unshift(e),e.modules.group=this,this.groupManager.table.modExists("columnCalcs")&&this.groupManager.table.options.columnCalcs!="table"&&this.groupManager.table.modules.columnCalcs.recalcGroup(this),this.groupManager.updateGroupRows(!0)}scrollHeader(e){this.arrowElement&&(this.arrowElement.style.marginLeft=e,this.groupList.forEach(function(i){i.scrollHeader(e)}))}getRowIndex(e){}conformRowData(e){return this.field?e[this.field]=this.key:console.warn("Data Conforming Error - Cannot conform row data to match new group as groupBy is a function"),this.parent&&(e=this.parent.conformRowData(e)),e}removeRow(e){var i=this.rows.indexOf(e),n=e.getElement();i>-1&&this.rows.splice(i,1),!this.groupManager.table.options.groupValues&&!this.rows.length?(this.parent?this.parent.removeGroup(this):this.groupManager.removeGroup(this),this.groupManager.updateGroupRows(!0)):(n.parentNode&&n.parentNode.removeChild(n),this.groupManager.blockRedraw||(this.generateGroupHeaderContents(),this.groupManager.table.modExists("columnCalcs")&&this.groupManager.table.options.columnCalcs!="table"&&this.groupManager.table.modules.columnCalcs.recalcGroup(this)))}removeGroup(e){var i=e.level+"_"+e.key,n;this.groups[i]&&(delete this.groups[i],n=this.groupList.indexOf(e),n>-1&&this.groupList.splice(n,1),this.groupList.length||(this.parent?this.parent.removeGroup(this):this.groupManager.removeGroup(this)))}getHeadersAndRows(){var e=[];return e.push(this),this._visSet(),this.calcs.top&&(this.calcs.top.detachElement(),this.calcs.top.deleteCells()),this.calcs.bottom&&(this.calcs.bottom.detachElement(),this.calcs.bottom.deleteCells()),this.visible?this.groupList.length?this.groupList.forEach(function(i){e=e.concat(i.getHeadersAndRows())}):(this.groupManager.table.options.columnCalcs!="table"&&this.groupManager.table.modExists("columnCalcs")&&this.groupManager.table.modules.columnCalcs.hasTopCalcs()&&(this.calcs.top=this.groupManager.table.modules.columnCalcs.generateTopRow(this.rows),e.push(this.calcs.top)),e=e.concat(this.rows),this.groupManager.table.options.columnCalcs!="table"&&this.groupManager.table.modExists("columnCalcs")&&this.groupManager.table.modules.columnCalcs.hasBottomCalcs()&&(this.calcs.bottom=this.groupManager.table.modules.columnCalcs.generateBottomRow(this.rows),e.push(this.calcs.bottom))):!this.groupList.length&&this.groupManager.table.options.columnCalcs!="table"&&this.groupManager.table.modExists("columnCalcs")&&(this.groupManager.table.modules.columnCalcs.hasTopCalcs()&&this.groupManager.table.options.groupClosedShowCalcs&&(this.calcs.top=this.groupManager.table.modules.columnCalcs.generateTopRow(this.rows),e.push(this.calcs.top)),this.groupManager.table.modules.columnCalcs.hasBottomCalcs()&&this.groupManager.table.options.groupClosedShowCalcs&&(this.calcs.bottom=this.groupManager.table.modules.columnCalcs.generateBottomRow(this.rows),e.push(this.calcs.bottom))),e}getData(e,i){var n=[];return this._visSet(),(!e||e&&this.visible)&&this.rows.forEach(r=>{n.push(r.getData(i||"data"))}),n}getRowCount(){var e=0;return this.groupList.length?this.groupList.forEach(i=>{e+=i.getRowCount()}):e=this.rows.length,e}toggleVisibility(){this.visible?this.hide():this.show()}hide(){this.visible=!1,this.groupManager.table.rowManager.getRenderMode()=="basic"&&!this.groupManager.table.options.pagination?(this.element.classList.remove("tabulator-group-visible"),this.groupList.length?this.groupList.forEach(e=>{var i=e.getHeadersAndRows();i.forEach(n=>{n.detachElement()})}):this.rows.forEach(e=>{var i=e.getElement();i.parentNode.removeChild(i)}),this.groupManager.updateGroupRows(!0)):this.groupManager.updateGroupRows(!0),this.groupManager.table.externalEvents.dispatch("groupVisibilityChanged",this.getComponent(),!1)}show(){if(this.visible=!0,this.groupManager.table.rowManager.getRenderMode()=="basic"&&!this.groupManager.table.options.pagination){this.element.classList.add("tabulator-group-visible");var e=this.generateElement();this.groupList.length?this.groupList.forEach(i=>{var n=i.getHeadersAndRows();n.forEach(r=>{var a=r.getElement();e.parentNode.insertBefore(a,e.nextSibling),r.initialize(),e=a})}):this.rows.forEach(i=>{var n=i.getElement();e.parentNode.insertBefore(n,e.nextSibling),i.initialize(),e=n}),this.groupManager.updateGroupRows(!0)}else this.groupManager.updateGroupRows(!0);this.groupManager.table.externalEvents.dispatch("groupVisibilityChanged",this.getComponent(),!0)}_visSet(){var e=[];typeof this.visible=="function"&&(this.rows.forEach(function(i){e.push(i.getData())}),this.visible=this.visible(this.key,this.getRowCount(),e,this.getComponent()))}getRowGroup(e){var i=!1;return this.groupList.length?this.groupList.forEach(function(n){var r=n.getRowGroup(e);r&&(i=r)}):this.rows.find(function(n){return n===e})&&(i=this),i}getSubGroups(e){var i=[];return this.groupList.forEach(function(n){i.push(e?n.getComponent():n)}),i}getRows(e,i){var n=[];return i&&this.groupList.length?this.groupList.forEach(r=>{n=n.concat(r.getRows(e,i))}):this.rows.forEach(function(r){n.push(e?r.getComponent():r)}),n}generateGroupHeaderContents(){var e=[],i=this.getRows(!1,!0);for(i.forEach(function(n){e.push(n.getData())}),this.elementContents=this.generator(this.key,this.getRowCount(),e,this.getComponent());this.element.firstChild;)this.element.removeChild(this.element.firstChild);typeof this.elementContents=="string"?this.element.innerHTML=this.elementContents:this.element.appendChild(this.elementContents),this.element.insertBefore(this.arrowElement,this.element.firstChild)}getPath(e=[]){return e.unshift(this.key),this.parent&&this.parent.getPath(e),e}getElement(){return this.elementContents?this.element:this.generateElement()}generateElement(){this.addBindings=!1,this._visSet(),this.visible?this.element.classList.add("tabulator-group-visible"):this.element.classList.remove("tabulator-group-visible");for(var e=0;e<this.element.childNodes.length;++e)this.element.childNodes[e].parentNode.removeChild(this.element.childNodes[e]);return this.generateGroupHeaderContents(),this.element}detachElement(){this.element&&this.element.parentNode&&this.element.parentNode.removeChild(this.element)}normalizeHeight(){this.setHeight(this.element.clientHeight)}initialize(e){(!this.initialized||e)&&(this.normalizeHeight(),this.initialized=!0)}reinitialize(){this.initialized=!1,this.height=0,Ha.elVisible(this.element)&&this.initialize(!0)}setHeight(e){this.height!=e&&(this.height=e,this.outerHeight=this.element.offsetHeight)}getHeight(){return this.outerHeight}getGroup(){return this}reinitializeHeight(){}calcHeight(){}setCellHeight(){}clearCellHeight(){}deinitializeHeight(){}rendered(){}getComponent(){return this.component||(this.component=new JXe(this)),this.component}}class I1e extends qn{constructor(e){super(e),this.groupIDLookups=!1,this.startOpen=[function(){return!1}],this.headerGenerator=[function(){return""}],this.groupList=[],this.allowedValues=!1,this.groups={},this.displayHandler=this.getRows.bind(this),this.blockRedraw=!1,this.registerTableOption("groupBy",!1),this.registerTableOption("groupStartOpen",!0),this.registerTableOption("groupValues",!1),this.registerTableOption("groupUpdateOnCellEdit",!1),this.registerTableOption("groupHeader",!1),this.registerTableOption("groupHeaderPrint",null),this.registerTableOption("groupHeaderClipboard",null),this.registerTableOption("groupHeaderHtmlOutput",null),this.registerTableOption("groupHeaderDownload",null),this.registerTableOption("groupToggleElement","arrow"),this.registerTableOption("groupClosedShowCalcs",!1),this.registerTableFunction("setGroupBy",this.setGroupBy.bind(this)),this.registerTableFunction("setGroupValues",this.setGroupValues.bind(this)),this.registerTableFunction("setGroupStartOpen",this.setGroupStartOpen.bind(this)),this.registerTableFunction("setGroupHeader",this.setGroupHeader.bind(this)),this.registerTableFunction("getGroups",this.userGetGroups.bind(this)),this.registerTableFunction("getGroupedData",this.userGetGroupedData.bind(this)),this.registerComponentFunction("row","getGroup",this.rowGetGroup.bind(this))}initialize(){this.subscribe("table-destroy",this._blockRedrawing.bind(this)),this.subscribe("rows-wipe",this._blockRedrawing.bind(this)),this.subscribe("rows-wiped",this._restore_redrawing.bind(this)),this.table.options.groupBy&&(this.table.options.groupUpdateOnCellEdit&&(this.subscribe("cell-value-updated",this.cellUpdated.bind(this)),this.subscribe("row-data-changed",this.reassignRowToGroup.bind(this),0)),this.subscribe("table-built",this.configureGroupSetup.bind(this)),this.subscribe("row-deleting",this.rowDeleting.bind(this)),this.subscribe("row-deleted",this.rowsUpdated.bind(this)),this.subscribe("scroll-horizontal",this.scrollHeaders.bind(this)),this.subscribe("rows-wipe",this.wipe.bind(this)),this.subscribe("rows-added",this.rowsUpdated.bind(this)),this.subscribe("row-moving",this.rowMoving.bind(this)),this.subscribe("row-adding-index",this.rowAddingIndex.bind(this)),this.subscribe("rows-sample",this.rowSample.bind(this)),this.subscribe("render-virtual-fill",this.virtualRenderFill.bind(this)),this.registerDisplayHandler(this.displayHandler,20),this.initialized=!0)}_blockRedrawing(){this.blockRedraw=!0}_restore_redrawing(){this.blockRedraw=!1}configureGroupSetup(){if(this.table.options.groupBy){var e=this.table.options.groupBy,i=this.table.options.groupStartOpen,n=this.table.options.groupHeader;if(this.allowedValues=this.table.options.groupValues,Array.isArray(e)&&Array.isArray(n)&&e.length>n.length&&console.warn("Error creating group headers, groupHeader array is shorter than groupBy array"),this.headerGenerator=[function(){return""}],this.startOpen=[function(){return!1}],this.langBind("groups|item",(a,s)=>{this.headerGenerator[0]=(o,l,c)=>(typeof o>"u"?"":o)+"<span>("+l+" "+(l===1?a:s.groups.items)+")</span>"}),this.groupIDLookups=[],e)this.table.modExists("columnCalcs")&&this.table.options.columnCalcs!="table"&&this.table.options.columnCalcs!="both"&&this.table.modules.columnCalcs.removeCalcs();else if(this.table.modExists("columnCalcs")&&this.table.options.columnCalcs!="group"){var r=this.table.columnManager.getRealColumns();r.forEach(a=>{a.definition.topCalc&&this.table.modules.columnCalcs.initializeTopRow(),a.definition.bottomCalc&&this.table.modules.columnCalcs.initializeBottomRow()})}Array.isArray(e)||(e=[e]),e.forEach((a,s)=>{var o,l;typeof a=="function"?o=a:(l=this.table.columnManager.getColumnByField(a),l?o=function(c){return l.getFieldValue(c)}:o=function(c){return c[a]}),this.groupIDLookups.push({field:typeof a=="function"?!1:a,func:o,values:this.allowedValues?this.allowedValues[s]:!1})}),i&&(Array.isArray(i)||(i=[i]),i.forEach(a=>{}),this.startOpen=i),n&&(this.headerGenerator=Array.isArray(n)?n:[n])}else this.groupList=[],this.groups={}}rowSample(e,i){if(this.table.options.groupBy){var n=this.getGroups(!1)[0];i.push(n.getRows(!1)[0])}return i}virtualRenderFill(){var e=this.table.rowManager.tableElement,i=this.table.rowManager.getVisibleRows();if(this.table.options.groupBy)i=i.filter(n=>n.type!=="group"),e.style.minWidth=i.length?"":this.table.columnManager.getWidth()+"px";else return i}rowAddingIndex(e,i,n){if(this.table.options.groupBy){this.assignRowToGroup(e);var r=e.modules.group.rows;return r.length>1&&(!i||i&&r.indexOf(i)==-1?n?r[0]!==e&&(i=r[0],this.table.rowManager.moveRowInArray(e.modules.group.rows,e,i,!n)):r[r.length-1]!==e&&(i=r[r.length-1],this.table.rowManager.moveRowInArray(e.modules.group.rows,e,i,!n)):this.table.rowManager.moveRowInArray(e.modules.group.rows,e,i,!n)),i}}trackChanges(){this.dispatch("group-changed")}setGroupBy(e){this.table.options.groupBy=e,this.initialized||this.initialize(),this.configureGroupSetup(),!e&&this.table.modExists("columnCalcs")&&this.table.options.columnCalcs===!0&&this.table.modules.columnCalcs.reinitializeCalcs(),this.refreshData(),this.trackChanges()}setGroupValues(e){this.table.options.groupValues=e,this.configureGroupSetup(),this.refreshData(),this.trackChanges()}setGroupStartOpen(e){this.table.options.groupStartOpen=e,this.configureGroupSetup(),this.table.options.groupBy?(this.refreshData(),this.trackChanges()):console.warn("Grouping Update - cant refresh view, no groups have been set")}setGroupHeader(e){this.table.options.groupHeader=e,this.configureGroupSetup(),this.table.options.groupBy?(this.refreshData(),this.trackChanges()):console.warn("Grouping Update - cant refresh view, no groups have been set")}userGetGroups(e){return this.getGroups(!0)}userGetGroupedData(){return this.table.options.groupBy?this.getGroupedData():this.getData()}rowGetGroup(e){return e.modules.group?e.modules.group.getComponent():!1}rowMoving(e,i,n){if(this.table.options.groupBy){!n&&i instanceof rS&&(i=this.table.rowManager.prevDisplayRow(e)||i);var r=i instanceof rS?i:i.modules.group,a=e instanceof rS?e:e.modules.group;r===a?this.table.rowManager.moveRowInArray(r.rows,e,i,n):(a&&a.removeRow(e),r.insertRow(e,i,n))}}rowDeleting(e){this.table.options.groupBy&&e.modules.group&&e.modules.group.removeRow(e)}rowsUpdated(e){this.table.options.groupBy&&this.updateGroupRows(!0)}cellUpdated(e){this.table.options.groupBy&&this.reassignRowToGroup(e.row)}getRows(e){return this.table.options.groupBy&&this.groupIDLookups.length?(this.dispatchExternal("dataGrouping"),this.generateGroups(e),this.subscribedExternal("dataGrouped")&&this.dispatchExternal("dataGrouped",this.getGroups(!0)),this.updateGroupRows()):e.slice(0)}getGroups(e){var i=[];return this.groupList.forEach(function(n){i.push(e?n.getComponent():n)}),i}getChildGroups(e){var i=[];return e||(e=this),e.groupList.forEach(n=>{n.groupList.length?i=i.concat(this.getChildGroups(n)):i.push(n)}),i}wipe(){this.table.options.groupBy&&(this.groupList.forEach(function(e){e.wipe()}),this.groupList=[],this.groups={})}pullGroupListData(e){var i=[];return e.forEach(n=>{var r={};r.level=0,r.rowCount=0,r.headerContent="";var a=[];n.hasSubGroups?(a=this.pullGroupListData(n.groupList),r.level=n.level,r.rowCount=a.length-n.groupList.length,r.headerContent=n.generator(n.key,r.rowCount,n.rows,n),i.push(r),i=i.concat(a)):(r.level=n.level,r.headerContent=n.generator(n.key,n.rows.length,n.rows,n),r.rowCount=n.getRows().length,i.push(r),n.getRows().forEach(s=>{i.push(s.getData("data"))}))}),i}getGroupedData(){return this.pullGroupListData(this.groupList)}getRowGroup(e){var i=!1;return this.options("dataTree")&&(e=this.table.modules.dataTree.getTreeParentRoot(e)),this.groupList.forEach(n=>{var r=n.getRowGroup(e);r&&(i=r)}),i}countGroups(){return this.groupList.length}generateGroups(e){var i=this.groups;this.groups={},this.groupList=[],this.allowedValues&&this.allowedValues[0]?(this.allowedValues[0].forEach(n=>{this.createGroup(n,0,i)}),e.forEach(n=>{this.assignRowToExistingGroup(n,i)})):e.forEach(n=>{this.assignRowToGroup(n,i)}),Object.values(i).forEach(n=>{n.wipe(!0)})}createGroup(e,i,n){var r=i+"_"+e,a;n=n||[],a=new rS(this,!1,i,e,this.groupIDLookups[0].field,this.headerGenerator[0],n[r]),this.groups[r]=a,this.groupList.push(a)}assignRowToExistingGroup(e,i){var n=this.groupIDLookups[0].func(e.getData()),r="0_"+n;this.groups[r]&&this.groups[r].addRow(e)}assignRowToGroup(e,i){var n=this.groupIDLookups[0].func(e.getData()),r=!this.groups["0_"+n];return r&&this.createGroup(n,0,i),this.groups["0_"+n].addRow(e),!r}reassignRowToGroup(e){if(e.type==="row"){var i=e.modules.group,n=i.getPath(),r=this.getExpectedPath(e),a;a=n.length==r.length&&n.every((s,o)=>s===r[o]),a||(i.removeRow(e),this.assignRowToGroup(e,this.groups),this.refreshData(!0))}}getExpectedPath(e){var i=[],n=e.getData();return this.groupIDLookups.forEach(r=>{i.push(r.func(n))}),i}updateGroupRows(e){var i=[];return this.blockRedraw||(this.groupList.forEach(n=>{i=i.concat(n.getHeadersAndRows())}),e&&this.refreshData(!0)),i}scrollHeaders(e){this.table.options.groupBy&&(this.table.options.renderHorizontal==="virtual"&&(e-=this.table.columnManager.renderer.vDomPadLeft),e=e+"px",this.groupList.forEach(i=>{i.scrollHeader(e)}))}removeGroup(e){var i=e.level+"_"+e.key,n;this.groups[i]&&(delete this.groups[i],n=this.groupList.indexOf(e),n>-1&&this.groupList.splice(n,1))}checkBasicModeGroupHeaderWidth(){var e=this.table.rowManager.tableElement,i=!0;this.table.rowManager.getDisplayRows().forEach((n,r)=>{this.table.rowManager.styleRow(n,r),e.appendChild(n.getElement()),n.initialize(!0),n.type!=="group"&&(i=!1)}),i?e.style.minWidth=this.table.columnManager.getWidth()+"px":e.style.minWidth=""}}et(I1e,"moduleName","groupRows");var QXe={cellEdit:function(t){t.component.setValueProcessData(t.data.oldValue),t.component.cellRendered()},rowAdd:function(t){t.component.deleteActual(),this.table.rowManager.checkPlaceholder()},rowDelete:function(t){var e=this.table.rowManager.addRowActual(t.data.data,t.data.pos,t.data.index);this.table.options.groupBy&&this.table.modExists("groupRows")&&this.table.modules.groupRows.updateGroupRows(!0),this._rebindRow(t.component,e),this.table.rowManager.checkPlaceholder()},rowMove:function(t){var e=t.data.posFrom-t.data.posTo>0;this.table.rowManager.moveRowActual(t.component,this.table.rowManager.getRowFromPosition(t.data.posFrom),e),this.table.rowManager.regenerateRowPositions(),this.table.rowManager.reRenderInPosition()}},eJe={cellEdit:function(t){t.component.setValueProcessData(t.data.newValue),t.component.cellRendered()},rowAdd:function(t){var e=this.table.rowManager.addRowActual(t.data.data,t.data.pos,t.data.index);this.table.options.groupBy&&this.table.modExists("groupRows")&&this.table.modules.groupRows.updateGroupRows(!0),this._rebindRow(t.component,e),this.table.rowManager.checkPlaceholder()},rowDelete:function(t){t.component.deleteActual(),this.table.rowManager.checkPlaceholder()},rowMove:function(t){this.table.rowManager.moveRowActual(t.component,this.table.rowManager.getRowFromPosition(t.data.posTo),t.data.after),this.table.rowManager.regenerateRowPositions(),this.table.rowManager.reRenderInPosition()}},tJe={undo:["ctrl + 90","meta + 90"],redo:["ctrl + 89","meta + 89"]},iJe={undo:function(t){var e=!1;this.table.options.history&&this.table.modExists("history")&&this.table.modExists("edit")&&(e=this.table.modules.edit.currentCell,e||(t.preventDefault(),this.table.modules.history.undo()))},redo:function(t){var e=!1;this.table.options.history&&this.table.modExists("history")&&this.table.modExists("edit")&&(e=this.table.modules.edit.currentCell,e||(t.preventDefault(),this.table.modules.history.redo()))}},nJe={keybindings:{bindings:tJe,actions:iJe}},ph;let rJe=(ph=class extends qn{constructor(e){super(e),this.history=[],this.index=-1,this.registerTableOption("history",!1)}initialize(){this.table.options.history&&(this.subscribe("cell-value-updated",this.cellUpdated.bind(this)),this.subscribe("cell-delete",this.clearComponentHistory.bind(this)),this.subscribe("row-delete",this.rowDeleted.bind(this)),this.subscribe("rows-wipe",this.clear.bind(this)),this.subscribe("row-added",this.rowAdded.bind(this)),this.subscribe("row-move",this.rowMoved.bind(this))),this.registerTableFunction("undo",this.undo.bind(this)),this.registerTableFunction("redo",this.redo.bind(this)),this.registerTableFunction("getHistoryUndoSize",this.getHistoryUndoSize.bind(this)),this.registerTableFunction("getHistoryRedoSize",this.getHistoryRedoSize.bind(this)),this.registerTableFunction("clearHistory",this.clear.bind(this))}rowMoved(e,i,n){this.action("rowMove",e,{posFrom:e.getPosition(),posTo:i.getPosition(),to:i,after:n})}rowAdded(e,i,n,r){this.action("rowAdd",e,{data:i,pos:n,index:r})}rowDeleted(e){var i,n;this.table.options.groupBy?(n=e.getComponent().getGroup()._getSelf().rows,i=n.indexOf(e),i&&(i=n[i-1])):(i=e.table.rowManager.getRowIndex(e),i&&(i=e.table.rowManager.rows[i-1])),this.action("rowDelete",e,{data:e.getData(),pos:!i,index:i})}cellUpdated(e){this.action("cellEdit",e,{oldValue:e.oldValue,newValue:e.value})}clear(){this.history=[],this.index=-1}action(e,i,n){this.history=this.history.slice(0,this.index+1),this.history.push({type:e,component:i,data:n}),this.index++}getHistoryUndoSize(){return this.index+1}getHistoryRedoSize(){return this.history.length-(this.index+1)}clearComponentHistory(e){var i=this.history.findIndex(function(n){return n.component===e});i>-1&&(this.history.splice(i,1),i<=this.index&&this.index--,this.clearComponentHistory(e))}undo(){if(this.index>-1){let e=this.history[this.index];return ph.undoers[e.type].call(this,e),this.index--,this.dispatchExternal("historyUndo",e.type,e.component.getComponent(),e.data),!0}else return console.warn(this.options("history")?"History Undo Error - No more history to undo":"History module not enabled"),!1}redo(){if(this.history.length-1>this.index){this.index++;let e=this.history[this.index];return ph.redoers[e.type].call(this,e),this.dispatchExternal("historyRedo",e.type,e.component.getComponent(),e.data),!0}else return console.warn(this.options("history")?"History Redo Error - No more history to redo":"History module not enabled"),!1}_rebindRow(e,i){this.history.forEach(function(n){if(n.component instanceof xc)n.component===e&&(n.component=i);else if(n.component instanceof vM&&n.component.row===e){var r=n.component.column.getField();r&&(n.component=i.getCell(r))}})}},et(ph,"moduleName","history"),et(ph,"moduleExtensions",nJe),et(ph,"undoers",QXe),et(ph,"redoers",eJe),ph);class w1e extends qn{constructor(e){super(e),this.fieldIndex=[],this.hasIndex=!1}initialize(){this.tableElementCheck()}tableElementCheck(){this.table.originalElement&&this.table.originalElement.tagName==="TABLE"&&(this.table.originalElement.childNodes.length?this.parseTable():console.warn("Unable to parse data from empty table tag, Tabulator should be initialized on a div tag unless importing data from a table element."))}parseTable(){var e=this.table.originalElement,i=this.table.options,n=e.getElementsByTagName("th"),r=e.getElementsByTagName("tbody")[0],a=[];this.hasIndex=!1,this.dispatchExternal("htmlImporting"),r=r?r.getElementsByTagName("tr"):[],this._extractOptions(e,i),n.length?this._extractHeaders(n,r):this._generateBlankHeaders(n,r);for(var s=0;s<r.length;s++){var o=r[s],l=o.getElementsByTagName("td"),c={};this.hasIndex||(c[i.index]=s);for(var u=0;u<l.length;u++){var d=l[u];typeof this.fieldIndex[u]<"u"&&(c[this.fieldIndex[u]]=d.innerHTML)}a.push(c)}i.data=a,this.dispatchExternal("htmlImported")}_extractOptions(e,i,n){var r=e.attributes,a=Object.keys(n||i),s={};a.forEach(u=>{s[u.toLowerCase()]=u});for(var o in r){var l=r[o],c;l&&typeof l=="object"&&l.name&&l.name.indexOf("tabulator-")===0&&(c=l.name.replace("tabulator-",""),typeof s[c]<"u"&&(i[s[c]]=this._attribValue(l.value)))}}_attribValue(e){return e==="true"?!0:e==="false"?!1:e}_findCol(e){var i=this.table.options.columns.find(n=>n.title===e);return i||!1}_extractHeaders(e,i){for(var n=0;n<e.length;n++){var r=e[n],a=!1,s=this._findCol(r.textContent),o;s?a=!0:s={title:r.textContent.trim()},s.field||(s.field=r.textContent.trim().toLowerCase().replaceAll(" ","_")),o=r.getAttribute("width"),o&&!s.width&&(s.width=o),this._extractOptions(r,s,this.table.columnManager.optionsList.registeredDefaults),this.fieldIndex[n]=s.field,s.field==this.table.options.index&&(this.hasIndex=!0),a||this.table.options.columns.push(s)}}_generateBlankHeaders(e,i){for(var n=0;n<e.length;n++){var r=e[n],a={title:"",field:"col"+n};this.fieldIndex[n]=a.field;var s=r.getAttribute("width");s&&(a.width=s),this.table.options.columns.push(a)}}}et(w1e,"moduleName","htmlTableImport");function aJe(t){var e=[],i=0,n=0,r=!1;for(let a=0;a<t.length;a++){let s=t[a],o=t[a+1];if(e[i]||(e[i]=[]),e[i][n]||(e[i][n]=""),s=='"'&&r&&o=='"'){e[i][n]+=s,a++;continue}if(s=='"'){r=!r;continue}if(s==","&&!r){n++;continue}if(s=="\r"&&o==`
`&&!r){n=0,i++,a++;continue}if((s=="\r"||s==`
`)&&!r){n=0,i++;continue}e[i][n]+=s}return e}function sJe(t){try{return JSON.parse(t)}catch(e){return console.warn("JSON Import Error - File contents is invalid JSON",e),Promise.reject()}}function oJe(t){return t}function lJe(t,e){var i=XLSX.read(t),n=i.Sheets[i.SheetNames[0]];return XLSX.utils.sheet_to_json(n,{})}var cJe={csv:aJe,json:sJe,array:oJe,xlsx:lJe};const BD=class BD extends qn{constructor(e){super(e),this.registerTableOption("importFormat"),this.registerTableOption("importReader","text")}initialize(){this.registerTableFunction("import",this.importFromFile.bind(this)),this.table.options.importFormat&&(this.subscribe("data-loading",this.loadDataCheck.bind(this),10),this.subscribe("data-load",this.loadData.bind(this),10))}loadDataCheck(e){return this.table.options.importFormat&&(typeof e=="string"||Array.isArray(e)&&e.length&&Array.isArray(e))}loadData(e,i,n,r,a){return this.importData(this.lookupImporter(),e).then(this.structureData.bind(this)).catch(s=>(console.error("Import Error:",s||"Unable to import data"),Promise.reject(s)))}lookupImporter(e){var i;return e||(e=this.table.options.importFormat),typeof e=="string"?i=BD.importers[e]:i=e,i||console.error("Import Error - Importer not found:",e),i}importFromFile(e,i,n){var r=this.lookupImporter(e);if(r)return this.pickFile(i,n).then(this.importData.bind(this,r)).then(this.structureData.bind(this)).then(this.setData.bind(this)).catch(a=>(this.dispatch("import-error",a),this.dispatchExternal("importError",a),console.error("Import Error:",a||"Unable to import file"),Promise.reject(a)))}pickFile(e,i){return new Promise((n,r)=>{var a=document.createElement("input");a.type="file",a.accept=e,a.addEventListener("change",s=>{var o=a.files[0],l=new FileReader;switch(this.dispatch("import-importing",a.files),this.dispatchExternal("importImporting",a.files),i||this.table.options.importReader){case"buffer":l.readAsArrayBuffer(o);break;case"binary":l.readAsBinaryString(o);break;case"url":l.readAsDataURL(o);break;case"text":default:l.readAsText(o)}l.onload=c=>{n(l.result)},l.onerror=c=>{console.warn("File Load Error - Unable to read file"),r()}}),this.dispatch("import-choose"),this.dispatchExternal("importChoose"),a.click()})}importData(e,i){var n=e.call(this.table,i);return n instanceof Promise?n:n?Promise.resolve(n):Promise.reject()}structureData(e){var i=[];return Array.isArray(e)&&e.length&&Array.isArray(e[0])?(this.table.options.autoColumns?i=this.structureArrayToObject(e):i=this.structureArrayToColumns(e),i):e}structureArrayToObject(e){var i=e.shift(),n=e.map(r=>{var a={};return i.forEach((s,o)=>{a[s]=r[o]}),a});return n}structureArrayToColumns(e){var i=[],n=this.table.getColumns();return n[0]&&e[0][0]&&n[0].getDefinition().title===e[0][0]&&e.shift(),e.forEach(r=>{var a={};r.forEach((s,o)=>{var l=n[o];l&&(a[l.getField()]=s)}),i.push(a)}),i}setData(e){return this.dispatch("import-imported",e),this.dispatchExternal("importImported",e),this.table.setData(e)}};et(BD,"moduleName","import"),et(BD,"importers",cJe);let jG=BD;class S1e extends qn{constructor(e){super(e),this.eventMap={rowClick:"row-click",rowDblClick:"row-dblclick",rowContext:"row-contextmenu",rowMouseEnter:"row-mouseenter",rowMouseLeave:"row-mouseleave",rowMouseOver:"row-mouseover",rowMouseOut:"row-mouseout",rowMouseMove:"row-mousemove",rowMouseDown:"row-mousedown",rowMouseUp:"row-mouseup",rowTap:"row",rowDblTap:"row",rowTapHold:"row",cellClick:"cell-click",cellDblClick:"cell-dblclick",cellContext:"cell-contextmenu",cellMouseEnter:"cell-mouseenter",cellMouseLeave:"cell-mouseleave",cellMouseOver:"cell-mouseover",cellMouseOut:"cell-mouseout",cellMouseMove:"cell-mousemove",cellMouseDown:"cell-mousedown",cellMouseUp:"cell-mouseup",cellTap:"cell",cellDblTap:"cell",cellTapHold:"cell",headerClick:"column-click",headerDblClick:"column-dblclick",headerContext:"column-contextmenu",headerMouseEnter:"column-mouseenter",headerMouseLeave:"column-mouseleave",headerMouseOver:"column-mouseover",headerMouseOut:"column-mouseout",headerMouseMove:"column-mousemove",headerMouseDown:"column-mousedown",headerMouseUp:"column-mouseup",headerTap:"column",headerDblTap:"column",headerTapHold:"column",groupClick:"group-click",groupDblClick:"group-dblclick",groupContext:"group-contextmenu",groupMouseEnter:"group-mouseenter",groupMouseLeave:"group-mouseleave",groupMouseOver:"group-mouseover",groupMouseOut:"group-mouseout",groupMouseMove:"group-mousemove",groupMouseDown:"group-mousedown",groupMouseUp:"group-mouseup",groupTap:"group",groupDblTap:"group",groupTapHold:"group"},this.subscribers={},this.touchSubscribers={},this.columnSubscribers={},this.touchWatchers={row:{tap:null,tapDbl:null,tapHold:null},cell:{tap:null,tapDbl:null,tapHold:null},column:{tap:null,tapDbl:null,tapHold:null},group:{tap:null,tapDbl:null,tapHold:null}},this.registerColumnOption("headerClick"),this.registerColumnOption("headerDblClick"),this.registerColumnOption("headerContext"),this.registerColumnOption("headerMouseEnter"),this.registerColumnOption("headerMouseLeave"),this.registerColumnOption("headerMouseOver"),this.registerColumnOption("headerMouseOut"),this.registerColumnOption("headerMouseMove"),this.registerColumnOption("headerMouseDown"),this.registerColumnOption("headerMouseUp"),this.registerColumnOption("headerTap"),this.registerColumnOption("headerDblTap"),this.registerColumnOption("headerTapHold"),this.registerColumnOption("cellClick"),this.registerColumnOption("cellDblClick"),this.registerColumnOption("cellContext"),this.registerColumnOption("cellMouseEnter"),this.registerColumnOption("cellMouseLeave"),this.registerColumnOption("cellMouseOver"),this.registerColumnOption("cellMouseOut"),this.registerColumnOption("cellMouseMove"),this.registerColumnOption("cellMouseDown"),this.registerColumnOption("cellMouseUp"),this.registerColumnOption("cellTap"),this.registerColumnOption("cellDblTap"),this.registerColumnOption("cellTapHold")}initialize(){this.initializeExternalEvents(),this.subscribe("column-init",this.initializeColumn.bind(this)),this.subscribe("cell-dblclick",this.cellContentsSelectionFixer.bind(this)),this.subscribe("scroll-horizontal",this.clearTouchWatchers.bind(this)),this.subscribe("scroll-vertical",this.clearTouchWatchers.bind(this))}clearTouchWatchers(){var e=Object.values(this.touchWatchers);e.forEach(i=>{for(let n in i)i[n]=null})}cellContentsSelectionFixer(e,i){var n;if(!(this.table.modExists("edit")&&this.table.modules.edit.currentCell===i)){e.preventDefault();try{document.selection?(n=document.body.createTextRange(),n.moveToElementText(i.getElement()),n.select()):window.getSelection&&(n=document.createRange(),n.selectNode(i.getElement()),window.getSelection().removeAllRanges(),window.getSelection().addRange(n))}catch{}}}initializeExternalEvents(){for(let e in this.eventMap)this.subscriptionChangeExternal(e,this.subscriptionChanged.bind(this,e))}subscriptionChanged(e,i){i?this.subscribers[e]||(this.eventMap[e].includes("-")?(this.subscribers[e]=this.handle.bind(this,e),this.subscribe(this.eventMap[e],this.subscribers[e])):this.subscribeTouchEvents(e)):this.eventMap[e].includes("-")?this.subscribers[e]&&!this.columnSubscribers[e]&&!this.subscribedExternal(e)&&(this.unsubscribe(this.eventMap[e],this.subscribers[e]),delete this.subscribers[e]):this.unsubscribeTouchEvents(e)}subscribeTouchEvents(e){var i=this.eventMap[e];this.touchSubscribers[i+"-touchstart"]||(this.touchSubscribers[i+"-touchstart"]=this.handleTouch.bind(this,i,"start"),this.touchSubscribers[i+"-touchend"]=this.handleTouch.bind(this,i,"end"),this.subscribe(i+"-touchstart",this.touchSubscribers[i+"-touchstart"]),this.subscribe(i+"-touchend",this.touchSubscribers[i+"-touchend"])),this.subscribers[e]=!0}unsubscribeTouchEvents(e){var i=!0,n=this.eventMap[e];if(this.subscribers[e]&&!this.subscribedExternal(e)){delete this.subscribers[e];for(let r in this.eventMap)this.eventMap[r]===n&&this.subscribers[r]&&(i=!1);i&&(this.unsubscribe(n+"-touchstart",this.touchSubscribers[n+"-touchstart"]),this.unsubscribe(n+"-touchend",this.touchSubscribers[n+"-touchend"]),delete this.touchSubscribers[n+"-touchstart"],delete this.touchSubscribers[n+"-touchend"])}}initializeColumn(e){var i=e.definition;for(let n in this.eventMap)i[n]&&(this.subscriptionChanged(n,!0),this.columnSubscribers[n]||(this.columnSubscribers[n]=[]),this.columnSubscribers[n].push(e))}handle(e,i,n){this.dispatchEvent(e,i,n)}handleTouch(e,i,n,r){var a=this.touchWatchers[e];switch(e==="column"&&(e="header"),i){case"start":a.tap=!0,clearTimeout(a.tapHold),a.tapHold=setTimeout(()=>{clearTimeout(a.tapHold),a.tapHold=null,a.tap=null,clearTimeout(a.tapDbl),a.tapDbl=null,this.dispatchEvent(e+"TapHold",n,r)},1e3);break;case"end":a.tap&&(a.tap=null,this.dispatchEvent(e+"Tap",n,r)),a.tapDbl?(clearTimeout(a.tapDbl),a.tapDbl=null,this.dispatchEvent(e+"DblTap",n,r)):a.tapDbl=setTimeout(()=>{clearTimeout(a.tapDbl),a.tapDbl=null},300),clearTimeout(a.tapHold),a.tapHold=null;break}}dispatchEvent(e,i,n){var r=n.getComponent(),a;this.columnSubscribers[e]&&(n instanceof vM?a=n.column.definition[e]:n instanceof iI&&(a=n.definition[e]),a&&a(i,r)),this.dispatchExternal(e,i,r)}}et(S1e,"moduleName","interaction");var uJe={navPrev:"shift + 9",navNext:9,navUp:38,navDown:40,navLeft:37,navRight:39,scrollPageUp:33,scrollPageDown:34,scrollToStart:36,scrollToEnd:35},dJe={keyBlock:function(t){t.stopPropagation(),t.preventDefault()},scrollPageUp:function(t){var e=this.table.rowManager,i=e.scrollTop-e.element.clientHeight;t.preventDefault(),e.displayRowsCount&&(i>=0?e.element.scrollTop=i:e.scrollToRow(e.getDisplayRows()[0])),this.table.element.focus()},scrollPageDown:function(t){var e=this.table.rowManager,i=e.scrollTop+e.element.clientHeight,n=e.element.scrollHeight;t.preventDefault(),e.displayRowsCount&&(i<=n?e.element.scrollTop=i:e.scrollToRow(e.getDisplayRows()[e.displayRowsCount-1])),this.table.element.focus()},scrollToStart:function(t){var e=this.table.rowManager;t.preventDefault(),e.displayRowsCount&&e.scrollToRow(e.getDisplayRows()[0]),this.table.element.focus()},scrollToEnd:function(t){var e=this.table.rowManager;t.preventDefault(),e.displayRowsCount&&e.scrollToRow(e.getDisplayRows()[e.displayRowsCount-1]),this.table.element.focus()},navPrev:function(t){this.dispatch("keybinding-nav-prev",t)},navNext:function(t){this.dispatch("keybinding-nav-next",t)},navLeft:function(t){this.dispatch("keybinding-nav-left",t)},navRight:function(t){this.dispatch("keybinding-nav-right",t)},navUp:function(t){this.dispatch("keybinding-nav-up",t)},navDown:function(t){this.dispatch("keybinding-nav-down",t)}};const _v=class _v extends qn{constructor(e){super(e),this.watchKeys=null,this.pressedKeys=null,this.keyupBinding=!1,this.keydownBinding=!1,this.registerTableOption("keybindings",{}),this.registerTableOption("tabEndNewRow",!1)}initialize(){var e=this.table.options.keybindings,i={};this.watchKeys={},this.pressedKeys=[],e!==!1&&(Object.assign(i,_v.bindings),Object.assign(i,e),this.mapBindings(i),this.bindEvents()),this.subscribe("table-destroy",this.clearBindings.bind(this))}mapBindings(e){for(let i in e)_v.actions[i]?e[i]&&(typeof e[i]!="object"&&(e[i]=[e[i]]),e[i].forEach(n=>{var r=Array.isArray(n)?n:[n];r.forEach(a=>{this.mapBinding(i,a)})})):console.warn("Key Binding Error - no such action:",i)}mapBinding(e,i){var n={action:_v.actions[e],keys:[],ctrl:!1,shift:!1,meta:!1},r=i.toString().toLowerCase().split(" ").join("").split("+");r.forEach(a=>{switch(a){case"ctrl":n.ctrl=!0;break;case"shift":n.shift=!0;break;case"meta":n.meta=!0;break;default:a=isNaN(a)?a.toUpperCase().charCodeAt(0):parseInt(a),n.keys.push(a),this.watchKeys[a]||(this.watchKeys[a]=[]),this.watchKeys[a].push(n)}})}bindEvents(){var e=this;this.keyupBinding=function(i){var n=i.keyCode,r=e.watchKeys[n];r&&(e.pressedKeys.push(n),r.forEach(function(a){e.checkBinding(i,a)}))},this.keydownBinding=function(i){var n=i.keyCode,r=e.watchKeys[n];if(r){var a=e.pressedKeys.indexOf(n);a>-1&&e.pressedKeys.splice(a,1)}},this.table.element.addEventListener("keydown",this.keyupBinding),this.table.element.addEventListener("keyup",this.keydownBinding)}clearBindings(){this.keyupBinding&&this.table.element.removeEventListener("keydown",this.keyupBinding),this.keydownBinding&&this.table.element.removeEventListener("keyup",this.keydownBinding)}checkBinding(e,i){var n=!0;return e.ctrlKey==i.ctrl&&e.shiftKey==i.shift&&e.metaKey==i.meta?(i.keys.forEach(r=>{var a=this.pressedKeys.indexOf(r);a==-1&&(n=!1)}),n&&i.action.call(this,e),!0):!1}};et(_v,"moduleName","keybindings"),et(_v,"bindings",uJe),et(_v,"actions",dJe);let GG=_v;class T1e extends qn{constructor(e){super(e),this.menuContainer=null,this.nestedMenuBlock=!1,this.currentComponent=null,this.rootPopup=null,this.columnSubscribers={},this.registerTableOption("rowContextMenu",!1),this.registerTableOption("rowClickMenu",!1),this.registerTableOption("rowDblClickMenu",!1),this.registerTableOption("groupContextMenu",!1),this.registerTableOption("groupClickMenu",!1),this.registerTableOption("groupDblClickMenu",!1),this.registerColumnOption("headerContextMenu"),this.registerColumnOption("headerClickMenu"),this.registerColumnOption("headerDblClickMenu"),this.registerColumnOption("headerMenu"),this.registerColumnOption("headerMenuIcon"),this.registerColumnOption("contextMenu"),this.registerColumnOption("clickMenu"),this.registerColumnOption("dblClickMenu")}initialize(){this.deprecatedOptionsCheck(),this.initializeRowWatchers(),this.initializeGroupWatchers(),this.subscribe("column-init",this.initializeColumn.bind(this))}deprecatedOptionsCheck(){}initializeRowWatchers(){this.table.options.rowContextMenu&&(this.subscribe("row-contextmenu",this.loadMenuEvent.bind(this,this.table.options.rowContextMenu)),this.table.on("rowTapHold",this.loadMenuEvent.bind(this,this.table.options.rowContextMenu))),this.table.options.rowClickMenu&&this.subscribe("row-click",this.loadMenuEvent.bind(this,this.table.options.rowClickMenu)),this.table.options.rowDblClickMenu&&this.subscribe("row-dblclick",this.loadMenuEvent.bind(this,this.table.options.rowDblClickMenu))}initializeGroupWatchers(){this.table.options.groupContextMenu&&(this.subscribe("group-contextmenu",this.loadMenuEvent.bind(this,this.table.options.groupContextMenu)),this.table.on("groupTapHold",this.loadMenuEvent.bind(this,this.table.options.groupContextMenu))),this.table.options.groupClickMenu&&this.subscribe("group-click",this.loadMenuEvent.bind(this,this.table.options.groupClickMenu)),this.table.options.groupDblClickMenu&&this.subscribe("group-dblclick",this.loadMenuEvent.bind(this,this.table.options.groupDblClickMenu))}initializeColumn(e){var i=e.definition;i.headerContextMenu&&!this.columnSubscribers.headerContextMenu&&(this.columnSubscribers.headerContextMenu=this.loadMenuTableColumnEvent.bind(this,"headerContextMenu"),this.subscribe("column-contextmenu",this.columnSubscribers.headerContextMenu),this.table.on("headerTapHold",this.loadMenuTableColumnEvent.bind(this,"headerContextMenu"))),i.headerClickMenu&&!this.columnSubscribers.headerClickMenu&&(this.columnSubscribers.headerClickMenu=this.loadMenuTableColumnEvent.bind(this,"headerClickMenu"),this.subscribe("column-click",this.columnSubscribers.headerClickMenu)),i.headerDblClickMenu&&!this.columnSubscribers.headerDblClickMenu&&(this.columnSubscribers.headerDblClickMenu=this.loadMenuTableColumnEvent.bind(this,"headerDblClickMenu"),this.subscribe("column-dblclick",this.columnSubscribers.headerDblClickMenu)),i.headerMenu&&this.initializeColumnHeaderMenu(e),i.contextMenu&&!this.columnSubscribers.contextMenu&&(this.columnSubscribers.contextMenu=this.loadMenuTableCellEvent.bind(this,"contextMenu"),this.subscribe("cell-contextmenu",this.columnSubscribers.contextMenu),this.table.on("cellTapHold",this.loadMenuTableCellEvent.bind(this,"contextMenu"))),i.clickMenu&&!this.columnSubscribers.clickMenu&&(this.columnSubscribers.clickMenu=this.loadMenuTableCellEvent.bind(this,"clickMenu"),this.subscribe("cell-click",this.columnSubscribers.clickMenu)),i.dblClickMenu&&!this.columnSubscribers.dblClickMenu&&(this.columnSubscribers.dblClickMenu=this.loadMenuTableCellEvent.bind(this,"dblClickMenu"),this.subscribe("cell-dblclick",this.columnSubscribers.dblClickMenu))}initializeColumnHeaderMenu(e){var i=e.definition.headerMenuIcon,n;n=document.createElement("span"),n.classList.add("tabulator-header-popup-button"),i?(typeof i=="function"&&(i=i(e.getComponent())),i instanceof HTMLElement?n.appendChild(i):n.innerHTML=i):n.innerHTML="&vellip;",n.addEventListener("click",r=>{r.stopPropagation(),r.preventDefault(),this.loadMenuEvent(e.definition.headerMenu,r,e)}),e.titleElement.insertBefore(n,e.titleElement.firstChild)}loadMenuTableCellEvent(e,i,n){n._cell&&(n=n._cell),n.column.definition[e]&&this.loadMenuEvent(n.column.definition[e],i,n)}loadMenuTableColumnEvent(e,i,n){n._column&&(n=n._column),n.definition[e]&&this.loadMenuEvent(n.definition[e],i,n)}loadMenuEvent(e,i,n){n._group?n=n._group:n._row&&(n=n._row),e=typeof e=="function"?e.call(this.table,i,n.getComponent()):e,this.loadMenu(i,n,e)}loadMenu(e,i,n,r,a){var s=!(e instanceof MouseEvent),o=document.createElement("div"),l;if(o.classList.add("tabulator-menu"),s||e.preventDefault(),!(!n||!n.length)){if(r)l=a.child(o);else{if(this.nestedMenuBlock){if(this.rootPopup)return}else this.nestedMenuBlock=setTimeout(()=>{this.nestedMenuBlock=!1},100);this.rootPopup&&this.rootPopup.hide(),this.rootPopup=l=this.popup(o)}n.forEach(c=>{var u=document.createElement("div"),d=c.label,p=c.disabled;c.separator?u.classList.add("tabulator-menu-separator"):(u.classList.add("tabulator-menu-item"),typeof d=="function"&&(d=d.call(this.table,i.getComponent())),d instanceof Node?u.appendChild(d):u.innerHTML=d,typeof p=="function"&&(p=p.call(this.table,i.getComponent())),p?(u.classList.add("tabulator-menu-item-disabled"),u.addEventListener("click",h=>{h.stopPropagation()})):c.menu&&c.menu.length?u.addEventListener("click",h=>{h.stopPropagation(),this.loadMenu(h,i,c.menu,u,l)}):c.action&&u.addEventListener("click",h=>{c.action(h,i.getComponent())}),c.menu&&c.menu.length&&u.classList.add("tabulator-menu-item-submenu")),o.appendChild(u)}),o.addEventListener("click",c=>{this.rootPopup&&this.rootPopup.hide()}),l.show(r||e),l===this.rootPopup&&(this.rootPopup.hideOnBlur(()=>{this.rootPopup=null,this.currentComponent&&(this.dispatch("menu-closed",n,l),this.dispatchExternal("menuClosed",this.currentComponent.getComponent()),this.currentComponent=null)}),this.currentComponent=i,this.dispatch("menu-opened",n,l),this.dispatchExternal("menuOpened",i.getComponent()))}}}et(T1e,"moduleName","menu");class U1e extends qn{constructor(e){super(e),this.placeholderElement=this.createPlaceholderElement(),this.hoverElement=!1,this.checkTimeout=!1,this.checkPeriod=250,this.moving=!1,this.toCol=!1,this.toColAfter=!1,this.startX=0,this.autoScrollMargin=40,this.autoScrollStep=5,this.autoScrollTimeout=!1,this.touchMove=!1,this.moveHover=this.moveHover.bind(this),this.endMove=this.endMove.bind(this),this.registerTableOption("movableColumns",!1)}createPlaceholderElement(){var e=document.createElement("div");return e.classList.add("tabulator-col"),e.classList.add("tabulator-col-placeholder"),e}initialize(){this.table.options.movableColumns&&(this.subscribe("column-init",this.initializeColumn.bind(this)),this.subscribe("alert-show",this.abortMove.bind(this)))}abortMove(){clearTimeout(this.checkTimeout)}initializeColumn(e){var i=this,n={},r;!e.modules.frozen&&!e.isGroup&&!e.isRowHeader&&(r=e.getElement(),n.mousemove=(function(a){e.parent===i.moving.parent&&((i.touchMove?a.touches[0].pageX:a.pageX)-Ha.elOffset(r).left+i.table.columnManager.contentsElement.scrollLeft>e.getWidth()/2?(i.toCol!==e||!i.toColAfter)&&(r.parentNode.insertBefore(i.placeholderElement,r.nextSibling),i.moveColumn(e,!0)):(i.toCol!==e||i.toColAfter)&&(r.parentNode.insertBefore(i.placeholderElement,r),i.moveColumn(e,!1)))}).bind(i),r.addEventListener("mousedown",function(a){i.touchMove=!1,a.which===1&&(i.checkTimeout=setTimeout(function(){i.startMove(a,e)},i.checkPeriod))}),r.addEventListener("mouseup",function(a){a.which===1&&i.checkTimeout&&clearTimeout(i.checkTimeout)}),i.bindTouchEvents(e)),e.modules.moveColumn=n}bindTouchEvents(e){var i=e.getElement(),n=!1,r,a,s,o,l,c;i.addEventListener("touchstart",u=>{this.checkTimeout=setTimeout(()=>{this.touchMove=!0,r=e.nextColumn(),s=r?r.getWidth()/2:0,a=e.prevColumn(),o=a?a.getWidth()/2:0,l=0,c=0,n=!1,this.startMove(u,e)},this.checkPeriod)},{passive:!0}),i.addEventListener("touchmove",u=>{var d,p;this.moving&&(this.moveHover(u),n||(n=u.touches[0].pageX),d=u.touches[0].pageX-n,d>0?r&&d-l>s&&(p=r,p!==e&&(n=u.touches[0].pageX,p.getElement().parentNode.insertBefore(this.placeholderElement,p.getElement().nextSibling),this.moveColumn(p,!0))):a&&-d-c>o&&(p=a,p!==e&&(n=u.touches[0].pageX,p.getElement().parentNode.insertBefore(this.placeholderElement,p.getElement()),this.moveColumn(p,!1))),p&&(r=p.nextColumn(),l=s,s=r?r.getWidth()/2:0,a=p.prevColumn(),c=o,o=a?a.getWidth()/2:0))},{passive:!0}),i.addEventListener("touchend",u=>{this.checkTimeout&&clearTimeout(this.checkTimeout),this.moving&&this.endMove(u)})}startMove(e,i){var n=i.getElement(),r=this.table.columnManager.getContentsElement(),a=this.table.columnManager.getHeadersElement();this.table.modules.selectRange&&this.table.modules.selectRange.columnSelection&&this.table.modules.selectRange.mousedown&&this.table.modules.selectRange.selecting==="column"||(this.moving=i,this.startX=(this.touchMove?e.touches[0].pageX:e.pageX)-Ha.elOffset(n).left,this.table.element.classList.add("tabulator-block-select"),this.placeholderElement.style.width=i.getWidth()+"px",this.placeholderElement.style.height=i.getHeight()+"px",n.parentNode.insertBefore(this.placeholderElement,n),n.parentNode.removeChild(n),this.hoverElement=n.cloneNode(!0),this.hoverElement.classList.add("tabulator-moving"),r.appendChild(this.hoverElement),this.hoverElement.style.left="0",this.hoverElement.style.bottom=r.clientHeight-a.offsetHeight+"px",this.touchMove||(this._bindMouseMove(),document.body.addEventListener("mousemove",this.moveHover),document.body.addEventListener("mouseup",this.endMove)),this.moveHover(e),this.dispatch("column-moving",e,this.moving))}_bindMouseMove(){this.table.columnManager.columnsByIndex.forEach(function(e){e.modules.moveColumn.mousemove&&e.getElement().addEventListener("mousemove",e.modules.moveColumn.mousemove)})}_unbindMouseMove(){this.table.columnManager.columnsByIndex.forEach(function(e){e.modules.moveColumn.mousemove&&e.getElement().removeEventListener("mousemove",e.modules.moveColumn.mousemove)})}moveColumn(e,i){var n=this.moving.getCells();this.toCol=e,this.toColAfter=i,i?e.getCells().forEach(function(r,a){var s=r.getElement(!0);s.parentNode&&n[a]&&s.parentNode.insertBefore(n[a].getElement(),s.nextSibling)}):e.getCells().forEach(function(r,a){var s=r.getElement(!0);s.parentNode&&n[a]&&s.parentNode.insertBefore(n[a].getElement(),s)})}endMove(e){(e.which===1||this.touchMove)&&(this._unbindMouseMove(),this.placeholderElement.parentNode.insertBefore(this.moving.getElement(),this.placeholderElement.nextSibling),this.placeholderElement.parentNode.removeChild(this.placeholderElement),this.hoverElement.parentNode.removeChild(this.hoverElement),this.table.element.classList.remove("tabulator-block-select"),this.toCol&&this.table.columnManager.moveColumnActual(this.moving,this.toCol,this.toColAfter),this.moving=!1,this.toCol=!1,this.toColAfter=!1,this.touchMove||(document.body.removeEventListener("mousemove",this.moveHover),document.body.removeEventListener("mouseup",this.endMove)))}moveHover(e){var i=this.table.columnManager.getContentsElement(),n=i.scrollLeft,r=(this.touchMove?e.touches[0].pageX:e.pageX)-Ha.elOffset(i).left+n,a;this.hoverElement.style.left=r-this.startX+"px",r-n<this.autoScrollMargin&&(this.autoScrollTimeout||(this.autoScrollTimeout=setTimeout(()=>{a=Math.max(0,n-5),this.table.rowManager.getElement().scrollLeft=a,this.autoScrollTimeout=!1},1))),n+i.clientWidth-r<this.autoScrollMargin&&(this.autoScrollTimeout||(this.autoScrollTimeout=setTimeout(()=>{a=Math.min(i.clientWidth,n+5),this.table.rowManager.getElement().scrollLeft=a,this.autoScrollTimeout=!1},1)))}}et(U1e,"moduleName","moveColumn");var pJe={delete:function(t,e,i){t.delete()}},hJe={insert:function(t,e,i){return this.table.addRow(t.getData(),void 0,e),!0},add:function(t,e,i){return this.table.addRow(t.getData()),!0},update:function(t,e,i){return e?(e.update(t.getData()),!0):!1},replace:function(t,e,i){return e?(this.table.addRow(t.getData(),void 0,e),e.delete(),!0):!1}};const Cb=class Cb extends qn{constructor(e){super(e),this.placeholderElement=this.createPlaceholderElement(),this.hoverElement=!1,this.checkTimeout=!1,this.checkPeriod=150,this.moving=!1,this.toRow=!1,this.toRowAfter=!1,this.hasHandle=!1,this.startY=0,this.startX=0,this.moveHover=this.moveHover.bind(this),this.endMove=this.endMove.bind(this),this.tableRowDropEvent=!1,this.touchMove=!1,this.connection=!1,this.connectionSelectorsTables=!1,this.connectionSelectorsElements=!1,this.connectionElements=[],this.connections=[],this.connectedTable=!1,this.connectedRow=!1,this.registerTableOption("movableRows",!1),this.registerTableOption("movableRowsConnectedTables",!1),this.registerTableOption("movableRowsConnectedElements",!1),this.registerTableOption("movableRowsSender",!1),this.registerTableOption("movableRowsReceiver","insert"),this.registerColumnOption("rowHandle")}createPlaceholderElement(){var e=document.createElement("div");return e.classList.add("tabulator-row"),e.classList.add("tabulator-row-placeholder"),e}initialize(){this.table.options.movableRows&&(this.connectionSelectorsTables=this.table.options.movableRowsConnectedTables,this.connectionSelectorsElements=this.table.options.movableRowsConnectedElements,this.connection=this.connectionSelectorsTables||this.connectionSelectorsElements,this.subscribe("cell-init",this.initializeCell.bind(this)),this.subscribe("column-init",this.initializeColumn.bind(this)),this.subscribe("row-init",this.initializeRow.bind(this)))}initializeGroupHeader(e){var i=this,n={};n.mouseup=(function(r){i.tableRowDrop(r,e)}).bind(i),n.mousemove=(function(r){var a;r.pageY-Ha.elOffset(e.element).top+i.table.rowManager.element.scrollTop>e.getHeight()/2?(i.toRow!==e||!i.toRowAfter)&&(a=e.getElement(),a.parentNode.insertBefore(i.placeholderElement,a.nextSibling),i.moveRow(e,!0)):(i.toRow!==e||i.toRowAfter)&&(a=e.getElement(),a.previousSibling&&(a.parentNode.insertBefore(i.placeholderElement,a),i.moveRow(e,!1)))}).bind(i),e.modules.moveRow=n}initializeRow(e){var i=this,n={},r;n.mouseup=(function(a){i.tableRowDrop(a,e)}).bind(i),n.mousemove=(function(a){var s=e.getElement();a.pageY-Ha.elOffset(s).top+i.table.rowManager.element.scrollTop>e.getHeight()/2?(i.toRow!==e||!i.toRowAfter)&&(s.parentNode.insertBefore(i.placeholderElement,s.nextSibling),i.moveRow(e,!0)):(i.toRow!==e||i.toRowAfter)&&(s.parentNode.insertBefore(i.placeholderElement,s),i.moveRow(e,!1))}).bind(i),this.hasHandle||(r=e.getElement(),r.addEventListener("mousedown",function(a){a.which===1&&(i.checkTimeout=setTimeout(function(){i.startMove(a,e)},i.checkPeriod))}),r.addEventListener("mouseup",function(a){a.which===1&&i.checkTimeout&&clearTimeout(i.checkTimeout)}),this.bindTouchEvents(e,e.getElement())),e.modules.moveRow=n}initializeColumn(e){e.definition.rowHandle&&this.table.options.movableRows!==!1&&(this.hasHandle=!0)}initializeCell(e){if(e.column.definition.rowHandle&&this.table.options.movableRows!==!1){var i=this,n=e.getElement(!0);n.addEventListener("mousedown",function(r){r.which===1&&(i.checkTimeout=setTimeout(function(){i.startMove(r,e.row)},i.checkPeriod))}),n.addEventListener("mouseup",function(r){r.which===1&&i.checkTimeout&&clearTimeout(i.checkTimeout)}),this.bindTouchEvents(e.row,n)}}bindTouchEvents(e,i){var n=!1,r,a,s,o,l,c;i.addEventListener("touchstart",u=>{this.checkTimeout=setTimeout(()=>{this.touchMove=!0,r=e.nextRow(),s=r?r.getHeight()/2:0,a=e.prevRow(),o=a?a.getHeight()/2:0,l=0,c=0,n=!1,this.startMove(u,e)},this.checkPeriod)},{passive:!0}),this.moving,this.toRow,this.toRowAfter,i.addEventListener("touchmove",u=>{var d,p;this.moving&&(u.preventDefault(),this.moveHover(u),n||(n=u.touches[0].pageY),d=u.touches[0].pageY-n,d>0?r&&d-l>s&&(p=r,p!==e&&(n=u.touches[0].pageY,p.getElement().parentNode.insertBefore(this.placeholderElement,p.getElement().nextSibling),this.moveRow(p,!0))):a&&-d-c>o&&(p=a,p!==e&&(n=u.touches[0].pageY,p.getElement().parentNode.insertBefore(this.placeholderElement,p.getElement()),this.moveRow(p,!1))),p&&(r=p.nextRow(),l=s,s=r?r.getHeight()/2:0,a=p.prevRow(),c=o,o=a?a.getHeight()/2:0))}),i.addEventListener("touchend",u=>{this.checkTimeout&&clearTimeout(this.checkTimeout),this.moving&&(this.endMove(u),this.touchMove=!1)})}_bindMouseMove(){this.table.rowManager.getDisplayRows().forEach(e=>{(e.type==="row"||e.type==="group")&&e.modules.moveRow&&e.modules.moveRow.mousemove&&e.getElement().addEventListener("mousemove",e.modules.moveRow.mousemove)})}_unbindMouseMove(){this.table.rowManager.getDisplayRows().forEach(e=>{(e.type==="row"||e.type==="group")&&e.modules.moveRow&&e.modules.moveRow.mousemove&&e.getElement().removeEventListener("mousemove",e.modules.moveRow.mousemove)})}startMove(e,i){var n=i.getElement();this.setStartPosition(e,i),this.moving=i,this.table.element.classList.add("tabulator-block-select"),this.placeholderElement.style.width=i.getWidth()+"px",this.placeholderElement.style.height=i.getHeight()+"px",this.connection?(this.table.element.classList.add("tabulator-movingrow-sending"),this.connectToTables(i)):(n.parentNode.insertBefore(this.placeholderElement,n),n.parentNode.removeChild(n)),this.hoverElement=n.cloneNode(!0),this.hoverElement.classList.add("tabulator-moving"),this.connection?(document.body.appendChild(this.hoverElement),this.hoverElement.style.left="0",this.hoverElement.style.top="0",this.hoverElement.style.width=this.table.element.clientWidth+"px",this.hoverElement.style.whiteSpace="nowrap",this.hoverElement.style.overflow="hidden",this.hoverElement.style.pointerEvents="none"):(this.table.rowManager.getTableElement().appendChild(this.hoverElement),this.hoverElement.style.left="0",this.hoverElement.style.top="0",this._bindMouseMove()),document.body.addEventListener("mousemove",this.moveHover),document.body.addEventListener("mouseup",this.endMove),this.dispatchExternal("rowMoving",i.getComponent()),this.moveHover(e)}setStartPosition(e,i){var n=this.touchMove?e.touches[0].pageX:e.pageX,r=this.touchMove?e.touches[0].pageY:e.pageY,a,s;a=i.getElement(),this.connection?(s=a.getBoundingClientRect(),this.startX=s.left-n+window.pageXOffset,this.startY=s.top-r+window.pageYOffset):this.startY=r-a.getBoundingClientRect().top}endMove(e){(!e||e.which===1||this.touchMove)&&(this._unbindMouseMove(),this.connection||(this.placeholderElement.parentNode.insertBefore(this.moving.getElement(),this.placeholderElement.nextSibling),this.placeholderElement.parentNode.removeChild(this.placeholderElement)),this.hoverElement.parentNode.removeChild(this.hoverElement),this.table.element.classList.remove("tabulator-block-select"),this.toRow?this.table.rowManager.moveRow(this.moving,this.toRow,this.toRowAfter):this.dispatchExternal("rowMoveCancelled",this.moving.getComponent()),this.moving=!1,this.toRow=!1,this.toRowAfter=!1,document.body.removeEventListener("mousemove",this.moveHover),document.body.removeEventListener("mouseup",this.endMove),this.connection&&(this.table.element.classList.remove("tabulator-movingrow-sending"),this.disconnectFromTables()))}moveRow(e,i){this.toRow=e,this.toRowAfter=i}moveHover(e){this.connection?this.moveHoverConnections.call(this,e):this.moveHoverTable.call(this,e)}moveHoverTable(e){var i=this.table.rowManager.getElement(),n=i.scrollTop,r=(this.touchMove?e.touches[0].pageY:e.pageY)-i.getBoundingClientRect().top+n;this.hoverElement.style.top=Math.min(r-this.startY,this.table.rowManager.element.scrollHeight-this.hoverElement.offsetHeight)+"px"}moveHoverConnections(e){this.hoverElement.style.left=this.startX+(this.touchMove?e.touches[0].pageX:e.pageX)+"px",this.hoverElement.style.top=this.startY+(this.touchMove?e.touches[0].pageY:e.pageY)+"px"}elementRowDrop(e,i,n){this.dispatchExternal("movableRowsElementDrop",e,i,n?n.getComponent():!1)}connectToTables(e){var i;this.connectionSelectorsTables&&(i=this.commsConnections(this.connectionSelectorsTables),this.dispatchExternal("movableRowsSendingStart",i),this.commsSend(this.connectionSelectorsTables,"moveRow","connect",{row:e})),this.connectionSelectorsElements&&(this.connectionElements=[],Array.isArray(this.connectionSelectorsElements)||(this.connectionSelectorsElements=[this.connectionSelectorsElements]),this.connectionSelectorsElements.forEach(n=>{typeof n=="string"?this.connectionElements=this.connectionElements.concat(Array.prototype.slice.call(document.querySelectorAll(n))):this.connectionElements.push(n)}),this.connectionElements.forEach(n=>{var r=a=>{this.elementRowDrop(a,n,this.moving)};n.addEventListener("mouseup",r),n.tabulatorElementDropEvent=r,n.classList.add("tabulator-movingrow-receiving")}))}disconnectFromTables(){var e;this.connectionSelectorsTables&&(e=this.commsConnections(this.connectionSelectorsTables),this.dispatchExternal("movableRowsSendingStop",e),this.commsSend(this.connectionSelectorsTables,"moveRow","disconnect")),this.connectionElements.forEach(i=>{i.classList.remove("tabulator-movingrow-receiving"),i.removeEventListener("mouseup",i.tabulatorElementDropEvent),delete i.tabulatorElementDropEvent})}connect(e,i){return this.connectedTable?(console.warn("Move Row Error - Table cannot accept connection, already connected to table:",this.connectedTable),!1):(this.connectedTable=e,this.connectedRow=i,this.table.element.classList.add("tabulator-movingrow-receiving"),this.table.rowManager.getDisplayRows().forEach(n=>{n.type==="row"&&n.modules.moveRow&&n.modules.moveRow.mouseup&&n.getElement().addEventListener("mouseup",n.modules.moveRow.mouseup)}),this.tableRowDropEvent=this.tableRowDrop.bind(this),this.table.element.addEventListener("mouseup",this.tableRowDropEvent),this.dispatchExternal("movableRowsReceivingStart",i,e),!0)}disconnect(e){e===this.connectedTable?(this.connectedTable=!1,this.connectedRow=!1,this.table.element.classList.remove("tabulator-movingrow-receiving"),this.table.rowManager.getDisplayRows().forEach(i=>{i.type==="row"&&i.modules.moveRow&&i.modules.moveRow.mouseup&&i.getElement().removeEventListener("mouseup",i.modules.moveRow.mouseup)}),this.table.element.removeEventListener("mouseup",this.tableRowDropEvent),this.dispatchExternal("movableRowsReceivingStop",e)):console.warn("Move Row Error - trying to disconnect from non connected table")}dropComplete(e,i,n){var r=!1;if(n){switch(typeof this.table.options.movableRowsSender){case"string":r=Cb.senders[this.table.options.movableRowsSender];break;case"function":r=this.table.options.movableRowsSender;break}r?r.call(this,this.moving?this.moving.getComponent():void 0,i?i.getComponent():void 0,e):this.table.options.movableRowsSender&&console.warn("Mover Row Error - no matching sender found:",this.table.options.movableRowsSender),this.dispatchExternal("movableRowsSent",this.moving.getComponent(),i?i.getComponent():void 0,e)}else this.dispatchExternal("movableRowsSentFailed",this.moving.getComponent(),i?i.getComponent():void 0,e);this.endMove()}tableRowDrop(e,i){var n=!1,r=!1;switch(e.stopImmediatePropagation(),typeof this.table.options.movableRowsReceiver){case"string":n=Cb.receivers[this.table.options.movableRowsReceiver];break;case"function":n=this.table.options.movableRowsReceiver;break}n?r=n.call(this,this.connectedRow.getComponent(),i?i.getComponent():void 0,this.connectedTable):console.warn("Mover Row Error - no matching receiver found:",this.table.options.movableRowsReceiver),r?this.dispatchExternal("movableRowsReceived",this.connectedRow.getComponent(),i?i.getComponent():void 0,this.connectedTable):this.dispatchExternal("movableRowsReceivedFailed",this.connectedRow.getComponent(),i?i.getComponent():void 0,this.connectedTable),this.commsSend(this.connectedTable,"moveRow","dropcomplete",{row:i,success:r})}commsReceived(e,i,n){switch(i){case"connect":return this.connect(e,n.row);case"disconnect":return this.disconnect(e);case"dropcomplete":return this.dropComplete(e,n.row,n.success)}}};et(Cb,"moduleName","moveRow"),et(Cb,"senders",pJe),et(Cb,"receivers",hJe);let HG=Cb;var fJe={};const lS=class lS extends qn{constructor(e){super(e),this.allowedTypes=["","data","edit","clipboard"],this.enabled=!0,this.registerColumnOption("mutator"),this.registerColumnOption("mutatorParams"),this.registerColumnOption("mutatorData"),this.registerColumnOption("mutatorDataParams"),this.registerColumnOption("mutatorEdit"),this.registerColumnOption("mutatorEditParams"),this.registerColumnOption("mutatorClipboard"),this.registerColumnOption("mutatorClipboardParams"),this.registerColumnOption("mutateLink")}initialize(){this.subscribe("cell-value-changing",this.transformCell.bind(this)),this.subscribe("cell-value-changed",this.mutateLink.bind(this)),this.subscribe("column-layout",this.initializeColumn.bind(this)),this.subscribe("row-data-init-before",this.rowDataChanged.bind(this)),this.subscribe("row-data-changing",this.rowDataChanged.bind(this))}rowDataChanged(e,i,n){return this.transformRow(i,"data",n)}initializeColumn(e){var i=!1,n={};this.allowedTypes.forEach(r=>{var a="mutator"+(r.charAt(0).toUpperCase()+r.slice(1)),s;e.definition[a]&&(s=this.lookupMutator(e.definition[a]),s&&(i=!0,n[a]={mutator:s,params:e.definition[a+"Params"]||{}}))}),i&&(e.modules.mutate=n)}lookupMutator(e){var i=!1;switch(typeof e){case"string":lS.mutators[e]?i=lS.mutators[e]:console.warn("Mutator Error - No such mutator found, ignoring: ",e);break;case"function":i=e;break}return i}transformRow(e,i,n){var r="mutator"+(i.charAt(0).toUpperCase()+i.slice(1)),a;return this.enabled&&this.table.columnManager.traverse(s=>{var o,l,c;s.modules.mutate&&(o=s.modules.mutate[r]||s.modules.mutate.mutator||!1,o&&(a=s.getFieldValue(typeof n<"u"?n:e),(i=="data"&&!n||typeof a<"u")&&(c=s.getComponent(),l=typeof o.params=="function"?o.params(a,e,i,c):o.params,s.setFieldValue(e,o.mutator(a,e,i,l,c)))))}),e}transformCell(e,i){if(e.column.modules.mutate){var n=e.column.modules.mutate.mutatorEdit||e.column.modules.mutate.mutator||!1,r={};if(n)return r=Object.assign(r,e.row.getData()),e.column.setFieldValue(r,i),n.mutator(i,r,"edit",n.params,e.getComponent())}return i}mutateLink(e){var i=e.column.definition.mutateLink;i&&(Array.isArray(i)||(i=[i]),i.forEach(n=>{var r=e.row.getCell(n);r&&r.setValue(r.getValue(),!0,!0)}))}enable(){this.enabled=!0}disable(){this.enabled=!1}};et(lS,"moduleName","mutator"),et(lS,"mutators",fJe);let zG=lS;function mJe(t,e,i,n,r){var a=document.createElement("span"),s=document.createElement("span"),o=document.createElement("span"),l=document.createElement("span"),c=document.createElement("span"),u=document.createElement("span");return this.table.modules.localize.langBind("pagination|counter|showing",d=>{s.innerHTML=d}),this.table.modules.localize.langBind("pagination|counter|of",d=>{l.innerHTML=d}),this.table.modules.localize.langBind("pagination|counter|rows",d=>{u.innerHTML=d}),n?(o.innerHTML=" "+e+"-"+Math.min(e+t-1,n)+" ",c.innerHTML=" "+n+" ",a.appendChild(s),a.appendChild(o),a.appendChild(l),a.appendChild(c),a.appendChild(u)):(o.innerHTML=" 0 ",a.appendChild(s),a.appendChild(o),a.appendChild(u)),a}function gJe(t,e,i,n,r){var a=document.createElement("span"),s=document.createElement("span"),o=document.createElement("span"),l=document.createElement("span"),c=document.createElement("span"),u=document.createElement("span");return this.table.modules.localize.langBind("pagination|counter|showing",d=>{s.innerHTML=d}),o.innerHTML=" "+i+" ",this.table.modules.localize.langBind("pagination|counter|of",d=>{l.innerHTML=d}),c.innerHTML=" "+r+" ",this.table.modules.localize.langBind("pagination|counter|pages",d=>{u.innerHTML=d}),a.appendChild(s),a.appendChild(o),a.appendChild(l),a.appendChild(c),a.appendChild(u),a}var vJe={rows:mJe,pages:gJe};const VD=class VD extends qn{constructor(e){super(e),this.mode="local",this.progressiveLoad=!1,this.element=null,this.pageCounterElement=null,this.pageCounter=null,this.size=0,this.page=1,this.count=5,this.max=1,this.remoteRowCountEstimate=null,this.initialLoad=!0,this.dataChanging=!1,this.pageSizes=[],this.registerTableOption("pagination",!1),this.registerTableOption("paginationMode","local"),this.registerTableOption("paginationSize",!1),this.registerTableOption("paginationInitialPage",1),this.registerTableOption("paginationCounter",!1),this.registerTableOption("paginationCounterElement",!1),this.registerTableOption("paginationButtonCount",5),this.registerTableOption("paginationSizeSelector",!1),this.registerTableOption("paginationElement",!1),this.registerTableOption("paginationAddRow","page"),this.registerTableOption("progressiveLoad",!1),this.registerTableOption("progressiveLoadDelay",0),this.registerTableOption("progressiveLoadScrollMargin",0),this.registerTableFunction("setMaxPage",this.setMaxPage.bind(this)),this.registerTableFunction("setPage",this.setPage.bind(this)),this.registerTableFunction("setPageToRow",this.userSetPageToRow.bind(this)),this.registerTableFunction("setPageSize",this.userSetPageSize.bind(this)),this.registerTableFunction("getPageSize",this.getPageSize.bind(this)),this.registerTableFunction("previousPage",this.previousPage.bind(this)),this.registerTableFunction("nextPage",this.nextPage.bind(this)),this.registerTableFunction("getPage",this.getPage.bind(this)),this.registerTableFunction("getPageMax",this.getPageMax.bind(this)),this.registerComponentFunction("row","pageTo",this.setPageToRow.bind(this))}initialize(){this.table.options.pagination?(this.subscribe("row-deleted",this.rowsUpdated.bind(this)),this.subscribe("row-added",this.rowsUpdated.bind(this)),this.subscribe("data-processed",this.initialLoadComplete.bind(this)),this.subscribe("table-built",this.calculatePageSizes.bind(this)),this.subscribe("footer-redraw",this.footerRedraw.bind(this)),this.table.options.paginationAddRow=="page"&&this.subscribe("row-adding-position",this.rowAddingPosition.bind(this)),this.table.options.paginationMode==="remote"&&(this.subscribe("data-params",this.remotePageParams.bind(this)),this.subscribe("data-loaded",this._parseRemoteData.bind(this))),this.table.options.progressiveLoad&&console.error("Progressive Load Error - Pagination and progressive load cannot be used at the same time"),this.registerDisplayHandler(this.restOnRenderBefore.bind(this),40),this.registerDisplayHandler(this.getRows.bind(this),50),this.createElements(),this.initializePageCounter(),this.initializePaginator()):this.table.options.progressiveLoad&&(this.subscribe("data-params",this.remotePageParams.bind(this)),this.subscribe("data-loaded",this._parseRemoteData.bind(this)),this.subscribe("table-built",this.calculatePageSizes.bind(this)),this.subscribe("data-processed",this.initialLoadComplete.bind(this)),this.initializeProgressive(this.table.options.progressiveLoad),this.table.options.progressiveLoad==="scroll"&&this.subscribe("scroll-vertical",this.scrollVertical.bind(this)))}rowAddingPosition(e,i){var n=this.table.rowManager,r=n.getDisplayRows(),a;return i?r.length?a=r[0]:n.activeRows.length&&(a=n.activeRows[n.activeRows.length-1],i=!1):r.length&&(a=r[r.length-1],i=!(r.length<this.size)),{index:a,top:i}}calculatePageSizes(){var e,i;this.table.options.paginationSize?this.size=this.table.options.paginationSize:(e=document.createElement("div"),e.classList.add("tabulator-row"),e.style.visibility="hidden",i=document.createElement("div"),i.classList.add("tabulator-cell"),i.innerHTML="Page Row Test",e.appendChild(i),this.table.rowManager.getTableElement().appendChild(e),this.size=Math.floor(this.table.rowManager.getElement().clientHeight/e.offsetHeight),this.table.rowManager.getTableElement().removeChild(e)),this.dispatchExternal("pageSizeChanged",this.size),this.generatePageSizeSelectList()}initialLoadComplete(){this.initialLoad=!1}remotePageParams(e,i,n,r){return this.initialLoad||(this.progressiveLoad&&!n||!this.progressiveLoad&&!this.dataChanging)&&this.reset(!0),r.page=this.page,this.size&&(r.size=this.size),r}userSetPageToRow(e){return this.table.options.pagination&&(e=this.table.rowManager.findRow(e),e)?this.setPageToRow(e):Promise.reject()}userSetPageSize(e){return this.table.options.pagination?(this.setPageSize(e),this.setPage(1)):!1}scrollVertical(e,i){var n,r,a;!i&&!this.table.dataLoader.loading&&(n=this.table.rowManager.getElement(),r=n.scrollHeight-n.clientHeight-e,a=this.table.options.progressiveLoadScrollMargin||n.clientHeight*2,r<a&&this.nextPage().catch(()=>{}))}restOnRenderBefore(e,i){return i||this.mode==="local"&&this.reset(),e}rowsUpdated(){this.refreshData(!0,"all")}createElements(){var e;this.element=document.createElement("span"),this.element.classList.add("tabulator-paginator"),this.pagesElement=document.createElement("span"),this.pagesElement.classList.add("tabulator-pages"),e=document.createElement("button"),e.classList.add("tabulator-page"),e.setAttribute("type","button"),e.setAttribute("role","button"),e.setAttribute("aria-label",""),e.setAttribute("title",""),this.firstBut=e.cloneNode(!0),this.firstBut.setAttribute("data-page","first"),this.prevBut=e.cloneNode(!0),this.prevBut.setAttribute("data-page","prev"),this.nextBut=e.cloneNode(!0),this.nextBut.setAttribute("data-page","next"),this.lastBut=e.cloneNode(!0),this.lastBut.setAttribute("data-page","last"),this.table.options.paginationSizeSelector&&(this.pageSizeSelect=document.createElement("select"),this.pageSizeSelect.classList.add("tabulator-page-size"))}generatePageSizeSelectList(){var e=[];if(this.pageSizeSelect){if(Array.isArray(this.table.options.paginationSizeSelector))e=this.table.options.paginationSizeSelector,this.pageSizes=e,this.pageSizes.indexOf(this.size)==-1&&e.unshift(this.size);else if(this.pageSizes.indexOf(this.size)==-1){e=[];for(let i=1;i<5;i++)e.push(this.size*i);this.pageSizes=e}else e=this.pageSizes;for(;this.pageSizeSelect.firstChild;)this.pageSizeSelect.removeChild(this.pageSizeSelect.firstChild);e.forEach(i=>{var n=document.createElement("option");n.value=i,i===!0?this.langBind("pagination|all",function(r){n.innerHTML=r}):n.innerHTML=i,this.pageSizeSelect.appendChild(n)}),this.pageSizeSelect.value=this.size}}initializePageCounter(){var e=this.table.options.paginationCounter,i=null;e&&(typeof e=="function"?i=e:i=VD.pageCounters[e],i?(this.pageCounter=i,this.pageCounterElement=document.createElement("span"),this.pageCounterElement.classList.add("tabulator-page-counter")):console.warn("Pagination Error - No such page counter found: ",e))}initializePaginator(e){var i,n;e||(this.langBind("pagination|first",r=>{this.firstBut.innerHTML=r}),this.langBind("pagination|first_title",r=>{this.firstBut.setAttribute("aria-label",r),this.firstBut.setAttribute("title",r)}),this.langBind("pagination|prev",r=>{this.prevBut.innerHTML=r}),this.langBind("pagination|prev_title",r=>{this.prevBut.setAttribute("aria-label",r),this.prevBut.setAttribute("title",r)}),this.langBind("pagination|next",r=>{this.nextBut.innerHTML=r}),this.langBind("pagination|next_title",r=>{this.nextBut.setAttribute("aria-label",r),this.nextBut.setAttribute("title",r)}),this.langBind("pagination|last",r=>{this.lastBut.innerHTML=r}),this.langBind("pagination|last_title",r=>{this.lastBut.setAttribute("aria-label",r),this.lastBut.setAttribute("title",r)}),this.firstBut.addEventListener("click",()=>{this.setPage(1)}),this.prevBut.addEventListener("click",()=>{this.previousPage()}),this.nextBut.addEventListener("click",()=>{this.nextPage()}),this.lastBut.addEventListener("click",()=>{this.setPage(this.max)}),this.table.options.paginationElement&&(this.element=this.table.options.paginationElement),this.pageSizeSelect&&(i=document.createElement("label"),this.langBind("pagination|page_size",r=>{this.pageSizeSelect.setAttribute("aria-label",r),this.pageSizeSelect.setAttribute("title",r),i.innerHTML=r}),this.element.appendChild(i),this.element.appendChild(this.pageSizeSelect),this.pageSizeSelect.addEventListener("change",r=>{this.setPageSize(this.pageSizeSelect.value=="true"?!0:this.pageSizeSelect.value),this.setPage(1)})),this.element.appendChild(this.firstBut),this.element.appendChild(this.prevBut),this.element.appendChild(this.pagesElement),this.element.appendChild(this.nextBut),this.element.appendChild(this.lastBut),this.table.options.paginationElement||(this.table.options.paginationCounter&&(this.table.options.paginationCounterElement?this.table.options.paginationCounterElement instanceof HTMLElement?this.table.options.paginationCounterElement.appendChild(this.pageCounterElement):typeof this.table.options.paginationCounterElement=="string"&&(n=document.querySelector(this.table.options.paginationCounterElement),n?n.appendChild(this.pageCounterElement):console.warn("Pagination Error - Unable to find element matching paginationCounterElement selector:",this.table.options.paginationCounterElement)):this.footerAppend(this.pageCounterElement)),this.footerAppend(this.element)),this.page=this.table.options.paginationInitialPage,this.count=this.table.options.paginationButtonCount),this.mode=this.table.options.paginationMode}initializeProgressive(e){this.initializePaginator(!0),this.mode="progressive_"+e,this.progressiveLoad=!0}trackChanges(){this.dispatch("page-changed")}setMaxRows(e){e?this.max=this.size===!0?1:Math.ceil(e/this.size):this.max=1,this.page>this.max&&(this.page=this.max)}reset(e){this.initialLoad||(this.mode=="local"||e)&&(this.page=1,this.trackChanges())}setMaxPage(e){e=parseInt(e),this.max=e||1,this.page>this.max&&(this.page=this.max,this.trigger())}setPage(e){switch(e){case"first":return this.setPage(1);case"prev":return this.previousPage();case"next":return this.nextPage();case"last":return this.setPage(this.max)}return e=parseInt(e),e>0&&e<=this.max||this.mode!=="local"?(this.page=e,this.trackChanges(),this.trigger()):(console.warn("Pagination Error - Requested page is out of range of 1 - "+this.max+":",e),Promise.reject())}setPageToRow(e){var i=this.displayRows(-1),n=i.indexOf(e);if(n>-1){var r=this.size===!0?1:Math.ceil((n+1)/this.size);return this.setPage(r)}else return console.warn("Pagination Error - Requested row is not visible"),Promise.reject()}setPageSize(e){e!==!0&&(e=parseInt(e)),e>0&&(this.size=e,this.dispatchExternal("pageSizeChanged",e)),this.pageSizeSelect&&this.generatePageSizeSelectList(),this.trackChanges()}_setPageCounter(e,i,n){var r;if(this.pageCounter)switch(this.mode==="remote"&&(i=this.size,n=(this.page-1)*this.size+1,e=this.remoteRowCountEstimate),r=this.pageCounter.call(this,i,n,this.page,e,this.max),typeof r){case"object":if(r instanceof Node){for(;this.pageCounterElement.firstChild;)this.pageCounterElement.removeChild(this.pageCounterElement.firstChild);this.pageCounterElement.appendChild(r)}else this.pageCounterElement.innerHTML="",r!=null&&console.warn("Page Counter Error - Page Counter has returned a type of object, the only valid page counter object return is an instance of Node, the page counter returned:",r);break;case"undefined":this.pageCounterElement.innerHTML="";break;default:this.pageCounterElement.innerHTML=r}}_setPageButtons(){let e=Math.floor((this.count-1)/2),i=Math.ceil((this.count-1)/2),n=this.max-this.page+e+1<this.count?this.max-this.count+1:Math.max(this.page-e,1),r=this.page<=i?Math.min(this.count,this.max):Math.min(this.page+i,this.max);for(;this.pagesElement.firstChild;)this.pagesElement.removeChild(this.pagesElement.firstChild);this.page==1?(this.firstBut.disabled=!0,this.prevBut.disabled=!0):(this.firstBut.disabled=!1,this.prevBut.disabled=!1),this.page==this.max?(this.lastBut.disabled=!0,this.nextBut.disabled=!0):(this.lastBut.disabled=!1,this.nextBut.disabled=!1);for(let a=n;a<=r;a++)a>0&&a<=this.max&&this.pagesElement.appendChild(this._generatePageButton(a));this.footerRedraw()}_generatePageButton(e){var i=document.createElement("button");return i.classList.add("tabulator-page"),e==this.page&&i.classList.add("active"),i.setAttribute("type","button"),i.setAttribute("role","button"),this.langBind("pagination|page_title",n=>{i.setAttribute("aria-label",n+" "+e),i.setAttribute("title",n+" "+e)}),i.setAttribute("data-page",e),i.textContent=e,i.addEventListener("click",n=>{this.setPage(e)}),i}previousPage(){return this.page>1?(this.page--,this.trackChanges(),this.trigger()):(console.warn("Pagination Error - Previous page would be less than page 1:",0),Promise.reject())}nextPage(){return this.page<this.max?(this.page++,this.trackChanges(),this.trigger()):(this.progressiveLoad||console.warn("Pagination Error - Next page would be greater than maximum page of "+this.max+":",this.max+1),Promise.reject())}getPage(){return this.page}getPageMax(){return this.max}getPageSize(e){return this.size}getMode(){return this.mode}getRows(e){var i=0,n,r,a,s,o=e.filter(l=>l.type==="row");if(this.mode=="local"){n=[],this.setMaxRows(e.length),this.size===!0?(r=0,a=e.length):(r=this.size*(this.page-1),a=r+parseInt(this.size)),this._setPageButtons();for(let l=r;l<a;l++){let c=e[l];c&&(n.push(c),c.type==="row"&&(s||(s=c),i++))}return this._setPageCounter(o.length,i,s?o.indexOf(s)+1:0),n}else return this._setPageButtons(),this._setPageCounter(o.length),e.slice(0)}trigger(){var e;switch(this.mode){case"local":return e=this.table.rowManager.scrollLeft,this.refreshData(),this.table.rowManager.scrollHorizontal(e),this.dispatchExternal("pageLoaded",this.getPage()),Promise.resolve();case"remote":return this.dataChanging=!0,this.reloadData(null).finally(()=>{this.dataChanging=!1});case"progressive_load":case"progressive_scroll":return this.reloadData(null,!0);default:return console.warn("Pagination Error - no such pagination mode:",this.mode),Promise.reject()}}_parseRemoteData(e){var i;if(typeof e.last_page>"u"&&console.warn("Remote Pagination Error - Server response missing '"+(this.options("dataReceiveParams").last_page||"last_page")+"' property"),e.data)if(this.max=parseInt(e.last_page)||1,this.remoteRowCountEstimate=typeof e.last_row<"u"?e.last_row:e.last_page*this.size-(this.page==e.last_page?this.size-e.data.length:0),this.progressiveLoad){switch(this.mode){case"progressive_load":this.page==1?this.table.rowManager.setData(e.data,!1,this.page==1):this.table.rowManager.addRows(e.data),this.page<this.max&&setTimeout(()=>{this.nextPage()},this.table.options.progressiveLoadDelay);break;case"progressive_scroll":e=this.page===1?e.data:this.table.rowManager.getData().concat(e.data),this.table.rowManager.setData(e,this.page!==1,this.page==1),i=this.table.options.progressiveLoadScrollMargin||this.table.rowManager.element.clientHeight*2,this.table.rowManager.element.scrollHeight<=this.table.rowManager.element.clientHeight+i&&this.page<this.max&&setTimeout(()=>{this.nextPage()});break}return!1}else this.dispatchExternal("pageLoaded",this.getPage());else console.warn("Remote Pagination Error - Server response missing '"+(this.options("dataReceiveParams").data||"data")+"' property");return e.data}footerRedraw(){var e=this.table.footerManager.containerElement;Math.ceil(e.clientWidth)-e.scrollWidth<0?this.pagesElement.style.display="none":(this.pagesElement.style.display="",Math.ceil(e.clientWidth)-e.scrollWidth<0&&(this.pagesElement.style.display="none"))}};et(VD,"moduleName","page"),et(VD,"pageCounters",vJe);let qG=VD;var yJe={local:function(t,e){var i=localStorage.getItem(t+"-"+e);return i?JSON.parse(i):!1},cookie:function(t,e){var i=document.cookie,n=t+"-"+e,r=i.indexOf(n+"="),a,s;return r>-1&&(i=i.slice(r),a=i.indexOf(";"),a>-1&&(i=i.slice(0,a)),s=i.replace(n+"=","")),s?JSON.parse(s):!1}},bJe={local:function(t,e,i){localStorage.setItem(t+"-"+e,JSON.stringify(i))},cookie:function(t,e,i){var n=new Date;n.setDate(n.getDate()+1e4),document.cookie=t+"-"+e+"="+JSON.stringify(i)+"; expires="+n.toUTCString()}};const yu=class yu extends qn{constructor(e){super(e),this.mode="",this.id="",this.defWatcherBlock=!1,this.config={},this.readFunc=!1,this.writeFunc=!1,this.registerTableOption("persistence",!1),this.registerTableOption("persistenceID",""),this.registerTableOption("persistenceMode",!0),this.registerTableOption("persistenceReaderFunc",!1),this.registerTableOption("persistenceWriterFunc",!1)}localStorageTest(){var e="_tabulator_test";try{return window.localStorage.setItem(e,e),window.localStorage.removeItem(e),!0}catch{return!1}}initialize(){if(this.table.options.persistence){var e=this.table.options.persistenceMode,i=this.table.options.persistenceID,n;this.mode=e!==!0?e:this.localStorageTest()?"local":"cookie",this.table.options.persistenceReaderFunc?typeof this.table.options.persistenceReaderFunc=="function"?this.readFunc=this.table.options.persistenceReaderFunc:yu.readers[this.table.options.persistenceReaderFunc]?this.readFunc=yu.readers[this.table.options.persistenceReaderFunc]:console.warn("Persistence Read Error - invalid reader set",this.table.options.persistenceReaderFunc):yu.readers[this.mode]?this.readFunc=yu.readers[this.mode]:console.warn("Persistence Read Error - invalid reader set",this.mode),this.table.options.persistenceWriterFunc?typeof this.table.options.persistenceWriterFunc=="function"?this.writeFunc=this.table.options.persistenceWriterFunc:yu.writers[this.table.options.persistenceWriterFunc]?this.writeFunc=yu.writers[this.table.options.persistenceWriterFunc]:console.warn("Persistence Write Error - invalid reader set",this.table.options.persistenceWriterFunc):yu.writers[this.mode]?this.writeFunc=yu.writers[this.mode]:console.warn("Persistence Write Error - invalid writer set",this.mode),this.id="tabulator-"+(i||this.table.element.getAttribute("id")||""),this.config={sort:this.table.options.persistence===!0||this.table.options.persistence.sort,filter:this.table.options.persistence===!0||this.table.options.persistence.filter,headerFilter:this.table.options.persistence===!0||this.table.options.persistence.headerFilter,group:this.table.options.persistence===!0||this.table.options.persistence.group,page:this.table.options.persistence===!0||this.table.options.persistence.page,columns:this.table.options.persistence===!0?["title","width","visible"]:this.table.options.persistence.columns},this.config.page&&(n=this.retrieveData("page"),n&&(typeof n.paginationSize<"u"&&(this.config.page===!0||this.config.page.size)&&(this.table.options.paginationSize=n.paginationSize),typeof n.paginationInitialPage<"u"&&(this.config.page===!0||this.config.page.page)&&(this.table.options.paginationInitialPage=n.paginationInitialPage))),this.config.group&&(n=this.retrieveData("group"),n&&(typeof n.groupBy<"u"&&(this.config.group===!0||this.config.group.groupBy)&&(this.table.options.groupBy=n.groupBy),typeof n.groupStartOpen<"u"&&(this.config.group===!0||this.config.group.groupStartOpen)&&(this.table.options.groupStartOpen=n.groupStartOpen),typeof n.groupHeader<"u"&&(this.config.group===!0||this.config.group.groupHeader)&&(this.table.options.groupHeader=n.groupHeader))),this.config.columns&&(this.table.options.columns=this.load("columns",this.table.options.columns),this.subscribe("column-init",this.initializeColumn.bind(this)),this.subscribe("column-show",this.save.bind(this,"columns")),this.subscribe("column-hide",this.save.bind(this,"columns")),this.subscribe("column-moved",this.save.bind(this,"columns"))),this.subscribe("table-built",this.tableBuilt.bind(this),0),this.subscribe("table-redraw",this.tableRedraw.bind(this)),this.subscribe("filter-changed",this.eventSave.bind(this,"filter")),this.subscribe("filter-changed",this.eventSave.bind(this,"headerFilter")),this.subscribe("sort-changed",this.eventSave.bind(this,"sort")),this.subscribe("group-changed",this.eventSave.bind(this,"group")),this.subscribe("page-changed",this.eventSave.bind(this,"page")),this.subscribe("column-resized",this.eventSave.bind(this,"columns")),this.subscribe("column-width",this.eventSave.bind(this,"columns")),this.subscribe("layout-refreshed",this.eventSave.bind(this,"columns"))}this.registerTableFunction("getColumnLayout",this.getColumnLayout.bind(this)),this.registerTableFunction("setColumnLayout",this.setColumnLayout.bind(this))}eventSave(e){this.config[e]&&this.save(e)}tableBuilt(){var e,i,n;this.config.sort&&(e=this.load("sort"),e&&(this.table.options.initialSort=e)),this.config.filter&&(i=this.load("filter"),i&&(this.table.options.initialFilter=i)),this.config.headerFilter&&(n=this.load("headerFilter"),n&&(this.table.options.initialHeaderFilter=n))}tableRedraw(e){e&&this.config.columns&&this.save("columns")}getColumnLayout(){return this.parseColumns(this.table.columnManager.getColumns())}setColumnLayout(e){return this.table.columnManager.setColumns(this.mergeDefinition(this.table.options.columns,e,!0)),!0}initializeColumn(e){var i,n;this.config.columns&&(this.defWatcherBlock=!0,i=e.getDefinition(),n=this.config.columns===!0?Object.keys(i):this.config.columns,n.forEach(r=>{var a=Object.getOwnPropertyDescriptor(i,r),s=i[r];a&&Object.defineProperty(i,r,{set:o=>{s=o,this.defWatcherBlock||this.save("columns"),a.set&&a.set(o)},get:()=>(a.get&&a.get(),s)})}),this.defWatcherBlock=!1)}load(e,i){var n=this.retrieveData(e);return i&&(n=n?this.mergeDefinition(i,n):i),n}retrieveData(e){return this.readFunc?this.readFunc(this.id,e):!1}mergeDefinition(e,i,n){var r=[];return i=i||[],i.forEach((a,s)=>{var o=this._findColumn(e,a),l;o&&(n?l=Object.keys(a):this.config.columns===!0||this.config.columns==null?(l=Object.keys(o),l.push("width")):l=this.config.columns,l.forEach(c=>{c!=="columns"&&typeof a[c]<"u"&&(o[c]=a[c])}),o.columns&&(o.columns=this.mergeDefinition(o.columns,a.columns)),r.push(o))}),e.forEach((a,s)=>{var o=this._findColumn(i,a);o||(r.length>s?r.splice(s,0,a):r.push(a))}),r}_findColumn(e,i){var n=i.columns?"group":i.field?"field":"object";return e.find(function(r){switch(n){case"group":return r.title===i.title&&r.columns.length===i.columns.length;case"field":return r.field===i.field;case"object":return r===i}})}save(e){var i={};switch(e){case"columns":i=this.parseColumns(this.table.columnManager.getColumns());break;case"filter":i=this.table.modules.filter.getFilters();break;case"headerFilter":i=this.table.modules.filter.getHeaderFilters();break;case"sort":i=this.validateSorters(this.table.modules.sort.getSort());break;case"group":i=this.getGroupConfig();break;case"page":i=this.getPageConfig();break}this.writeFunc&&this.writeFunc(this.id,e,i)}validateSorters(e){return e.forEach(function(i){i.column=i.field,delete i.field}),e}getGroupConfig(){var e={};return this.config.group&&((this.config.group===!0||this.config.group.groupBy)&&(e.groupBy=this.table.options.groupBy),(this.config.group===!0||this.config.group.groupStartOpen)&&(e.groupStartOpen=this.table.options.groupStartOpen),(this.config.group===!0||this.config.group.groupHeader)&&(e.groupHeader=this.table.options.groupHeader)),e}getPageConfig(){var e={};return this.config.page&&((this.config.page===!0||this.config.page.size)&&(e.paginationSize=this.table.modules.page.getPageSize()),(this.config.page===!0||this.config.page.page)&&(e.paginationInitialPage=this.table.modules.page.getPage())),e}parseColumns(e){var i=[],n=["headerContextMenu","headerMenu","contextMenu","clickMenu"];return e.forEach(r=>{var a={},s=r.getDefinition(),o;r.isGroup?(a.title=s.title,a.columns=this.parseColumns(r.getColumns())):(a.field=r.getField(),this.config.columns===!0||this.config.columns==null?(o=Object.keys(s),o.push("width"),o.push("visible")):o=this.config.columns,o.forEach(l=>{switch(l){case"width":a.width=r.getWidth();break;case"visible":a.visible=r.visible;break;default:typeof s[l]!="function"&&n.indexOf(l)===-1&&(a[l]=s[l])}})),i.push(a)}),i}};et(yu,"moduleName","persistence"),et(yu,"moduleInitOrder",-10),et(yu,"readers",yJe),et(yu,"writers",bJe);let WG=yu;var mV;let IJe=(mV=class extends qn{constructor(e){super(e),this.columnSubscribers={},this.registerTableOption("rowContextPopup",!1),this.registerTableOption("rowClickPopup",!1),this.registerTableOption("rowDblClickPopup",!1),this.registerTableOption("groupContextPopup",!1),this.registerTableOption("groupClickPopup",!1),this.registerTableOption("groupDblClickPopup",!1),this.registerColumnOption("headerContextPopup"),this.registerColumnOption("headerClickPopup"),this.registerColumnOption("headerDblClickPopup"),this.registerColumnOption("headerPopup"),this.registerColumnOption("headerPopupIcon"),this.registerColumnOption("contextPopup"),this.registerColumnOption("clickPopup"),this.registerColumnOption("dblClickPopup"),this.registerComponentFunction("cell","popup",this._componentPopupCall.bind(this)),this.registerComponentFunction("column","popup",this._componentPopupCall.bind(this)),this.registerComponentFunction("row","popup",this._componentPopupCall.bind(this)),this.registerComponentFunction("group","popup",this._componentPopupCall.bind(this))}initialize(){this.initializeRowWatchers(),this.initializeGroupWatchers(),this.subscribe("column-init",this.initializeColumn.bind(this))}_componentPopupCall(e,i,n){this.loadPopupEvent(i,null,e,n)}initializeRowWatchers(){this.table.options.rowContextPopup&&(this.subscribe("row-contextmenu",this.loadPopupEvent.bind(this,this.table.options.rowContextPopup)),this.table.on("rowTapHold",this.loadPopupEvent.bind(this,this.table.options.rowContextPopup))),this.table.options.rowClickPopup&&this.subscribe("row-click",this.loadPopupEvent.bind(this,this.table.options.rowClickPopup)),this.table.options.rowDblClickPopup&&this.subscribe("row-dblclick",this.loadPopupEvent.bind(this,this.table.options.rowDblClickPopup))}initializeGroupWatchers(){this.table.options.groupContextPopup&&(this.subscribe("group-contextmenu",this.loadPopupEvent.bind(this,this.table.options.groupContextPopup)),this.table.on("groupTapHold",this.loadPopupEvent.bind(this,this.table.options.groupContextPopup))),this.table.options.groupClickPopup&&this.subscribe("group-click",this.loadPopupEvent.bind(this,this.table.options.groupClickPopup)),this.table.options.groupDblClickPopup&&this.subscribe("group-dblclick",this.loadPopupEvent.bind(this,this.table.options.groupDblClickPopup))}initializeColumn(e){var i=e.definition;i.headerContextPopup&&!this.columnSubscribers.headerContextPopup&&(this.columnSubscribers.headerContextPopup=this.loadPopupTableColumnEvent.bind(this,"headerContextPopup"),this.subscribe("column-contextmenu",this.columnSubscribers.headerContextPopup),this.table.on("headerTapHold",this.loadPopupTableColumnEvent.bind(this,"headerContextPopup"))),i.headerClickPopup&&!this.columnSubscribers.headerClickPopup&&(this.columnSubscribers.headerClickPopup=this.loadPopupTableColumnEvent.bind(this,"headerClickPopup"),this.subscribe("column-click",this.columnSubscribers.headerClickPopup)),i.headerDblClickPopup&&!this.columnSubscribers.headerDblClickPopup&&(this.columnSubscribers.headerDblClickPopup=this.loadPopupTableColumnEvent.bind(this,"headerDblClickPopup"),this.subscribe("column-dblclick",this.columnSubscribers.headerDblClickPopup)),i.headerPopup&&this.initializeColumnHeaderPopup(e),i.contextPopup&&!this.columnSubscribers.contextPopup&&(this.columnSubscribers.contextPopup=this.loadPopupTableCellEvent.bind(this,"contextPopup"),this.subscribe("cell-contextmenu",this.columnSubscribers.contextPopup),this.table.on("cellTapHold",this.loadPopupTableCellEvent.bind(this,"contextPopup"))),i.clickPopup&&!this.columnSubscribers.clickPopup&&(this.columnSubscribers.clickPopup=this.loadPopupTableCellEvent.bind(this,"clickPopup"),this.subscribe("cell-click",this.columnSubscribers.clickPopup)),i.dblClickPopup&&!this.columnSubscribers.dblClickPopup&&(this.columnSubscribers.dblClickPopup=this.loadPopupTableCellEvent.bind(this,"dblClickPopup"),this.subscribe("cell-click",this.columnSubscribers.dblClickPopup))}initializeColumnHeaderPopup(e){var i=e.definition.headerPopupIcon,n;n=document.createElement("span"),n.classList.add("tabulator-header-popup-button"),i?(typeof i=="function"&&(i=i(e.getComponent())),i instanceof HTMLElement?n.appendChild(i):n.innerHTML=i):n.innerHTML="&vellip;",n.addEventListener("click",r=>{r.stopPropagation(),r.preventDefault(),this.loadPopupEvent(e.definition.headerPopup,r,e)}),e.titleElement.insertBefore(n,e.titleElement.firstChild)}loadPopupTableCellEvent(e,i,n){n._cell&&(n=n._cell),n.column.definition[e]&&this.loadPopupEvent(n.column.definition[e],i,n)}loadPopupTableColumnEvent(e,i,n){n._column&&(n=n._column),n.definition[e]&&this.loadPopupEvent(n.definition[e],i,n)}loadPopupEvent(e,i,n,r){var a;function s(o){a=o}n._group?n=n._group:n._row&&(n=n._row),e=typeof e=="function"?e.call(this.table,i,n.getComponent(),s):e,this.loadPopup(i,n,e,a,r)}loadPopup(e,i,n,r,a){var s=!(e instanceof MouseEvent),o,l;n instanceof HTMLElement?o=n:(o=document.createElement("div"),o.innerHTML=n),o.classList.add("tabulator-popup"),o.addEventListener("click",c=>{c.stopPropagation()}),s||e.preventDefault(),l=this.popup(o),typeof r=="function"&&l.renderCallback(r),e?l.show(e):l.show(i.getElement(),a||"center"),l.hideOnBlur(()=>{this.dispatchExternal("popupClosed",i.getComponent())}),this.dispatchExternal("popupOpened",i.getComponent())}},et(mV,"moduleName","popup"),mV);class D1e extends qn{constructor(e){super(e),this.element=!1,this.manualBlock=!1,this.beforeprintEventHandler=null,this.afterprintEventHandler=null,this.registerTableOption("printAsHtml",!1),this.registerTableOption("printFormatter",!1),this.registerTableOption("printHeader",!1),this.registerTableOption("printFooter",!1),this.registerTableOption("printStyled",!0),this.registerTableOption("printRowRange","visible"),this.registerTableOption("printConfig",{}),this.registerColumnOption("print"),this.registerColumnOption("titlePrint")}initialize(){this.table.options.printAsHtml&&(this.beforeprintEventHandler=this.replaceTable.bind(this),this.afterprintEventHandler=this.cleanup.bind(this),window.addEventListener("beforeprint",this.beforeprintEventHandler),window.addEventListener("afterprint",this.afterprintEventHandler),this.subscribe("table-destroy",this.destroy.bind(this))),this.registerTableFunction("print",this.printFullscreen.bind(this))}destroy(){this.table.options.printAsHtml&&(window.removeEventListener("beforeprint",this.beforeprintEventHandler),window.removeEventListener("afterprint",this.afterprintEventHandler))}replaceTable(){this.manualBlock||(this.element=document.createElement("div"),this.element.classList.add("tabulator-print-table"),this.element.appendChild(this.table.modules.export.generateTable(this.table.options.printConfig,this.table.options.printStyled,this.table.options.printRowRange,"print")),this.table.element.style.display="none",this.table.element.parentNode.insertBefore(this.element,this.table.element))}cleanup(){document.body.classList.remove("tabulator-print-fullscreen-hide"),this.element&&this.element.parentNode&&(this.element.parentNode.removeChild(this.element),this.table.element.style.display="")}printFullscreen(e,i,n){var r=window.scrollX,a=window.scrollY,s=document.createElement("div"),o=document.createElement("div"),l=this.table.modules.export.generateTable(typeof n<"u"?n:this.table.options.printConfig,typeof i<"u"?i:this.table.options.printStyled,e||this.table.options.printRowRange,"print"),c,u;this.manualBlock=!0,this.element=document.createElement("div"),this.element.classList.add("tabulator-print-fullscreen"),this.table.options.printHeader&&(s.classList.add("tabulator-print-header"),c=typeof this.table.options.printHeader=="function"?this.table.options.printHeader.call(this.table):this.table.options.printHeader,typeof c=="string"?s.innerHTML=c:s.appendChild(c),this.element.appendChild(s)),this.element.appendChild(l),this.table.options.printFooter&&(o.classList.add("tabulator-print-footer"),u=typeof this.table.options.printFooter=="function"?this.table.options.printFooter.call(this.table):this.table.options.printFooter,typeof u=="string"?o.innerHTML=u:o.appendChild(u),this.element.appendChild(o)),document.body.classList.add("tabulator-print-fullscreen-hide"),document.body.appendChild(this.element),this.table.options.printFormatter&&this.table.options.printFormatter(this.element,l),window.print(),this.cleanup(),window.scrollTo(r,a),this.manualBlock=!1}}et(D1e,"moduleName","print");class E1e extends qn{constructor(e){super(e),this.data=!1,this.blocked=!1,this.origFuncs={},this.currentVersion=0,this.registerTableOption("reactiveData",!1)}initialize(){this.table.options.reactiveData&&(this.subscribe("cell-value-save-before",this.block.bind(this,"cellsave")),this.subscribe("cell-value-save-after",this.unblock.bind(this,"cellsave")),this.subscribe("row-data-save-before",this.block.bind(this,"rowsave")),this.subscribe("row-data-save-after",this.unblock.bind(this,"rowsave")),this.subscribe("row-data-init-after",this.watchRow.bind(this)),this.subscribe("data-processing",this.watchData.bind(this)),this.subscribe("table-destroy",this.unwatchData.bind(this)))}watchData(e){var i=this,n;this.currentVersion++,n=this.currentVersion,this.unwatchData(),this.data=e,this.origFuncs.push=e.push,Object.defineProperty(this.data,"push",{enumerable:!1,configurable:!0,value:function(){var r=Array.from(arguments),a;return!i.blocked&&n===i.currentVersion&&(i.block("data-push"),r.forEach(s=>{i.table.rowManager.addRowActual(s,!1)}),a=i.origFuncs.push.apply(e,arguments),i.unblock("data-push")),a}}),this.origFuncs.unshift=e.unshift,Object.defineProperty(this.data,"unshift",{enumerable:!1,configurable:!0,value:function(){var r=Array.from(arguments),a;return!i.blocked&&n===i.currentVersion&&(i.block("data-unshift"),r.forEach(s=>{i.table.rowManager.addRowActual(s,!0)}),a=i.origFuncs.unshift.apply(e,arguments),i.unblock("data-unshift")),a}}),this.origFuncs.shift=e.shift,Object.defineProperty(this.data,"shift",{enumerable:!1,configurable:!0,value:function(){var r,a;return!i.blocked&&n===i.currentVersion&&(i.block("data-shift"),i.data.length&&(r=i.table.rowManager.getRowFromDataObject(i.data[0]),r&&r.deleteActual()),a=i.origFuncs.shift.call(e),i.unblock("data-shift")),a}}),this.origFuncs.pop=e.pop,Object.defineProperty(this.data,"pop",{enumerable:!1,configurable:!0,value:function(){var r,a;return!i.blocked&&n===i.currentVersion&&(i.block("data-pop"),i.data.length&&(r=i.table.rowManager.getRowFromDataObject(i.data[i.data.length-1]),r&&r.deleteActual()),a=i.origFuncs.pop.call(e),i.unblock("data-pop")),a}}),this.origFuncs.splice=e.splice,Object.defineProperty(this.data,"splice",{enumerable:!1,configurable:!0,value:function(){var r=Array.from(arguments),a=r[0]<0?e.length+r[0]:r[0],s=r[1],o=r[2]?r.slice(2):!1,l,c;if(!i.blocked&&n===i.currentVersion){if(i.block("data-splice"),o&&(l=e[a]?i.table.rowManager.getRowFromDataObject(e[a]):!1,l?o.forEach(d=>{i.table.rowManager.addRowActual(d,!0,l,!0)}):(o=o.slice().reverse(),o.forEach(d=>{i.table.rowManager.addRowActual(d,!0,!1,!0)}))),s!==0){var u=e.slice(a,typeof r[1]>"u"?r[1]:a+s);u.forEach((d,p)=>{var h=i.table.rowManager.getRowFromDataObject(d);h&&h.deleteActual(p!==u.length-1)})}(o||s!==0)&&i.table.rowManager.reRenderInPosition(),c=i.origFuncs.splice.apply(e,arguments),i.unblock("data-splice")}return c}})}unwatchData(){if(this.data!==!1)for(var e in this.origFuncs)Object.defineProperty(this.data,e,{enumerable:!0,configurable:!0,writable:!0,value:this.origFuncs.key})}watchRow(e){var i=e.getData();for(var n in i)this.watchKey(e,i,n);this.table.options.dataTree&&this.watchTreeChildren(e)}watchTreeChildren(e){var i=this,n=e.getData()[this.table.options.dataTreeChildField],r={};n&&(r.push=n.push,Object.defineProperty(n,"push",{enumerable:!1,configurable:!0,value:()=>{if(!i.blocked){i.block("tree-push");var a=r.push.apply(n,arguments);this.rebuildTree(e),i.unblock("tree-push")}return a}}),r.unshift=n.unshift,Object.defineProperty(n,"unshift",{enumerable:!1,configurable:!0,value:()=>{if(!i.blocked){i.block("tree-unshift");var a=r.unshift.apply(n,arguments);this.rebuildTree(e),i.unblock("tree-unshift")}return a}}),r.shift=n.shift,Object.defineProperty(n,"shift",{enumerable:!1,configurable:!0,value:()=>{if(!i.blocked){i.block("tree-shift");var a=r.shift.call(n);this.rebuildTree(e),i.unblock("tree-shift")}return a}}),r.pop=n.pop,Object.defineProperty(n,"pop",{enumerable:!1,configurable:!0,value:()=>{if(!i.blocked){i.block("tree-pop");var a=r.pop.call(n);this.rebuildTree(e),i.unblock("tree-pop")}return a}}),r.splice=n.splice,Object.defineProperty(n,"splice",{enumerable:!1,configurable:!0,value:()=>{if(!i.blocked){i.block("tree-splice");var a=r.splice.apply(n,arguments);this.rebuildTree(e),i.unblock("tree-splice")}return a}}))}rebuildTree(e){this.table.modules.dataTree.initializeRow(e),this.table.modules.dataTree.layoutRow(e),this.table.rowManager.refreshActiveData("tree",!1,!0)}watchKey(e,i,n){var r=this,a=Object.getOwnPropertyDescriptor(i,n),s=i[n],o=this.currentVersion;Object.defineProperty(i,n,{set:l=>{if(s=l,!r.blocked&&o===r.currentVersion){r.block("key");var c={};c[n]=l,e.updateData(c),r.unblock("key")}a.set&&a.set(l)},get:()=>(a.get&&a.get(),s)})}unwatchRow(e){var i=e.getData();for(var n in i)Object.defineProperty(i,n,{value:i[n]})}block(e){this.blocked||(this.blocked=e)}unblock(e){this.blocked===e&&(this.blocked=!1)}}et(E1e,"moduleName","reactiveData");class P1e extends qn{constructor(e){super(e),this.startColumn=!1,this.startX=!1,this.startWidth=!1,this.latestX=!1,this.handle=null,this.initialNextColumn=null,this.nextColumn=null,this.initialized=!1,this.registerColumnOption("resizable",!0),this.registerTableOption("resizableColumnFit",!1),this.registerTableOption("resizableColumnGuide",!1)}initialize(){this.subscribe("column-rendered",this.layoutColumnHeader.bind(this))}initializeEventWatchers(){this.initialized||(this.subscribe("cell-rendered",this.layoutCellHandles.bind(this)),this.subscribe("cell-delete",this.deInitializeComponent.bind(this)),this.subscribe("cell-height",this.resizeHandle.bind(this)),this.subscribe("column-moved",this.columnLayoutUpdated.bind(this)),this.subscribe("column-hide",this.deInitializeColumn.bind(this)),this.subscribe("column-show",this.columnLayoutUpdated.bind(this)),this.subscribe("column-width",this.columnWidthUpdated.bind(this)),this.subscribe("column-delete",this.deInitializeComponent.bind(this)),this.subscribe("column-height",this.resizeHandle.bind(this)),this.initialized=!0)}layoutCellHandles(e){e.row.type==="row"&&(this.deInitializeComponent(e),this.initializeColumn("cell",e,e.column,e.element))}layoutColumnHeader(e){e.definition.resizable&&(this.initializeEventWatchers(),this.deInitializeComponent(e),this.initializeColumn("header",e,e,e.element))}columnLayoutUpdated(e){var i=e.prevColumn();this.reinitializeColumn(e),i&&this.reinitializeColumn(i)}columnWidthUpdated(e){e.modules.frozen&&(this.table.modules.frozenColumns.leftColumns.includes(e)?this.table.modules.frozenColumns.leftColumns.forEach(i=>{this.reinitializeColumn(i)}):this.table.modules.frozenColumns.rightColumns.includes(e)&&this.table.modules.frozenColumns.rightColumns.forEach(i=>{this.reinitializeColumn(i)}))}frozenColumnOffset(e){var i=!1;return e.modules.frozen&&(i=e.modules.frozen.marginValue,e.modules.frozen.position==="left"?i+=e.getWidth()-3:i&&(i-=3)),i!==!1?i+"px":!1}reinitializeColumn(e){var i=this.frozenColumnOffset(e);e.cells.forEach(n=>{n.modules.resize&&n.modules.resize.handleEl&&(i&&(n.modules.resize.handleEl.style[e.modules.frozen.position]=i,n.modules.resize.handleEl.style["z-index"]=11),n.element.after(n.modules.resize.handleEl))}),e.modules.resize&&e.modules.resize.handleEl&&(i&&(e.modules.resize.handleEl.style[e.modules.frozen.position]=i),e.element.after(e.modules.resize.handleEl))}initializeColumn(e,i,n,r){var a=this,s=!1,o=n.definition.resizable,l={},c=n.getLastColumn();if(e==="header"&&(s=n.definition.formatter=="textarea"||n.definition.variableHeight,l={variableHeight:s}),(o===!0||o==e)&&this._checkResizability(c)){var u=document.createElement("span");u.className="tabulator-col-resize-handle",u.addEventListener("click",function(p){p.stopPropagation()});var d=function(p){a.startColumn=n,a.initialNextColumn=a.nextColumn=c.nextColumn(),a._mouseDown(p,c,u)};u.addEventListener("mousedown",d),u.addEventListener("touchstart",d,{passive:!0}),u.addEventListener("dblclick",p=>{var h=c.getWidth();p.stopPropagation(),c.reinitializeWidth(!0),h!==c.getWidth()&&(a.dispatch("column-resized",c),a.dispatchExternal("columnResized",c.getComponent()))}),n.modules.frozen&&(u.style.position="sticky",u.style[n.modules.frozen.position]=this.frozenColumnOffset(n)),l.handleEl=u,r.parentNode&&n.visible&&r.after(u)}i.modules.resize=l}deInitializeColumn(e){this.deInitializeComponent(e),e.cells.forEach(i=>{this.deInitializeComponent(i)})}deInitializeComponent(e){var i;e.modules.resize&&(i=e.modules.resize.handleEl,i&&i.parentElement&&i.parentElement.removeChild(i))}resizeHandle(e,i){e.modules.resize&&e.modules.resize.handleEl&&(e.modules.resize.handleEl.style.height=i)}resize(e,i){var n=typeof e.clientX>"u"?e.touches[0].clientX:e.clientX,r=n-this.startX,a=n-this.latestX,s,o;if(this.latestX=n,this.table.rtl&&(r=-r,a=-a),s=i.width==i.minWidth||i.width==i.maxWidth,i.setWidth(this.startWidth+r),o=i.width==i.minWidth||i.width==i.maxWidth,a<0&&(this.nextColumn=this.initialNextColumn),this.table.options.resizableColumnFit&&this.nextColumn&&!(s&&o)){let l=this.nextColumn.getWidth();a>0&&l<=this.nextColumn.minWidth&&(this.nextColumn=this.nextColumn.nextColumn()),this.nextColumn&&this.nextColumn.setWidth(this.nextColumn.getWidth()-a)}this.table.columnManager.rerenderColumns(!0),!this.table.browserSlow&&i.modules.resize&&i.modules.resize.variableHeight&&i.checkCellHeights()}calcGuidePosition(e,i,n){var r=typeof e.clientX>"u"?e.touches[0].clientX:e.clientX,a=n.getBoundingClientRect().x-this.table.element.getBoundingClientRect().x,s=this.table.element.getBoundingClientRect().x,o=i.element.getBoundingClientRect().left-s,l=r-this.startX,c=Math.max(a+l,o+i.minWidth);return i.maxWidth&&(c=Math.min(c,o+i.maxWidth)),c}_checkResizability(e){return e.definition.resizable}_mouseDown(e,i,n){var r=this,a;this.dispatchExternal("columnResizing",i.getComponent()),r.table.options.resizableColumnGuide&&(a=document.createElement("span"),a.classList.add("tabulator-col-resize-guide"),r.table.element.appendChild(a),setTimeout(()=>{a.style.left=r.calcGuidePosition(e,i,n)+"px"})),r.table.element.classList.add("tabulator-block-select");function s(l){r.table.options.resizableColumnGuide?a.style.left=r.calcGuidePosition(l,i,n)+"px":r.resize(l,i)}function o(l){r.table.options.resizableColumnGuide&&(r.resize(l,i),a.remove()),r.startColumn.modules.edit&&(r.startColumn.modules.edit.blocked=!1),r.table.browserSlow&&i.modules.resize&&i.modules.resize.variableHeight&&i.checkCellHeights(),document.body.removeEventListener("mouseup",o),document.body.removeEventListener("mousemove",s),n.removeEventListener("touchmove",s),n.removeEventListener("touchend",o),r.table.element.classList.remove("tabulator-block-select"),r.startWidth!==i.getWidth()&&(r.table.columnManager.verticalAlignHeaders(),r.dispatch("column-resized",i),r.dispatchExternal("columnResized",i.getComponent()))}e.stopPropagation(),r.startColumn.modules.edit&&(r.startColumn.modules.edit.blocked=!0),r.startX=typeof e.clientX>"u"?e.touches[0].clientX:e.clientX,r.latestX=r.startX,r.startWidth=i.getWidth(),document.body.addEventListener("mousemove",s),document.body.addEventListener("mouseup",o),n.addEventListener("touchmove",s,{passive:!0}),n.addEventListener("touchend",o)}}et(P1e,"moduleName","resizeColumns");class C1e extends qn{constructor(e){super(e),this.startColumn=!1,this.startY=!1,this.startHeight=!1,this.handle=null,this.prevHandle=null,this.registerTableOption("resizableRows",!1),this.registerTableOption("resizableRowGuide",!1)}initialize(){this.table.options.resizableRows&&this.subscribe("row-layout-after",this.initializeRow.bind(this))}initializeRow(e){var i=this,n=e.getElement(),r=document.createElement("div");r.className="tabulator-row-resize-handle";var a=document.createElement("div");a.className="tabulator-row-resize-handle prev",r.addEventListener("click",function(l){l.stopPropagation()});var s=function(l){i.startRow=e,i._mouseDown(l,e,r)};r.addEventListener("mousedown",s),r.addEventListener("touchstart",s,{passive:!0}),a.addEventListener("click",function(l){l.stopPropagation()});var o=function(l){var c=i.table.rowManager.prevDisplayRow(e);c&&(i.startRow=c,i._mouseDown(l,c,a))};a.addEventListener("mousedown",o),a.addEventListener("touchstart",o,{passive:!0}),n.appendChild(r),n.appendChild(a)}resize(e,i){i.setHeight(this.startHeight+((typeof e.screenY>"u"?e.touches[0].screenY:e.screenY)-this.startY))}calcGuidePosition(e,i,n){var r=typeof e.screenY>"u"?e.touches[0].screenY:e.screenY,a=n.getBoundingClientRect().y-this.table.element.getBoundingClientRect().y,s=this.table.element.getBoundingClientRect().y,o=i.element.getBoundingClientRect().top-s,l=r-this.startY;return Math.max(a+l,o)}_mouseDown(e,i,n){var r=this,a;r.dispatchExternal("rowResizing",i.getComponent()),r.table.options.resizableRowGuide&&(a=document.createElement("span"),a.classList.add("tabulator-row-resize-guide"),r.table.element.appendChild(a),setTimeout(()=>{a.style.top=r.calcGuidePosition(e,i,n)+"px"})),r.table.element.classList.add("tabulator-block-select");function s(l){r.table.options.resizableRowGuide?a.style.top=r.calcGuidePosition(l,i,n)+"px":r.resize(l,i)}function o(l){r.table.options.resizableRowGuide&&(r.resize(l,i),a.remove()),document.body.removeEventListener("mouseup",s),document.body.removeEventListener("mousemove",s),n.removeEventListener("touchmove",s),n.removeEventListener("touchend",o),r.table.element.classList.remove("tabulator-block-select"),r.dispatchExternal("rowResized",i.getComponent())}e.stopPropagation(),r.startY=typeof e.screenY>"u"?e.touches[0].screenY:e.screenY,r.startHeight=i.getHeight(),document.body.addEventListener("mousemove",s),document.body.addEventListener("mouseup",o),n.addEventListener("touchmove",s,{passive:!0}),n.addEventListener("touchend",o)}}et(C1e,"moduleName","resizeRows");class R1e extends qn{constructor(e){super(e),this.binding=!1,this.visibilityObserver=!1,this.resizeObserver=!1,this.containerObserver=!1,this.tableHeight=0,this.tableWidth=0,this.containerHeight=0,this.containerWidth=0,this.autoResize=!1,this.visible=!1,this.initialized=!1,this.initialRedraw=!1,this.registerTableOption("autoResize",!0)}initialize(){if(this.table.options.autoResize){var e=this.table,i;this.tableHeight=e.element.clientHeight,this.tableWidth=e.element.clientWidth,e.element.parentNode&&(this.containerHeight=e.element.parentNode.clientHeight,this.containerWidth=e.element.parentNode.clientWidth),typeof IntersectionObserver<"u"&&typeof ResizeObserver<"u"&&e.rowManager.getRenderMode()==="virtual"?(this.initializeVisibilityObserver(),this.autoResize=!0,this.resizeObserver=new ResizeObserver(n=>{if(!e.browserMobile||e.browserMobile&&(!e.modules.edit||e.modules.edit&&!e.modules.edit.currentCell)){var r=Math.floor(n[0].contentRect.height),a=Math.floor(n[0].contentRect.width);(this.tableHeight!=r||this.tableWidth!=a)&&(this.tableHeight=r,this.tableWidth=a,e.element.parentNode&&(this.containerHeight=e.element.parentNode.clientHeight,this.containerWidth=e.element.parentNode.clientWidth),this.redrawTable())}}),this.resizeObserver.observe(e.element),i=window.getComputedStyle(e.element),this.table.element.parentNode&&!this.table.rowManager.fixedHeight&&(i.getPropertyValue("max-height")||i.getPropertyValue("min-height"))&&(this.containerObserver=new ResizeObserver(n=>{if(!e.browserMobile||e.browserMobile&&(!e.modules.edit||e.modules.edit&&!e.modules.edit.currentCell)){var r=Math.floor(n[0].contentRect.height),a=Math.floor(n[0].contentRect.width);(this.containerHeight!=r||this.containerWidth!=a)&&(this.containerHeight=r,this.containerWidth=a,this.tableHeight=e.element.clientHeight,this.tableWidth=e.element.clientWidth),this.redrawTable()}}),this.containerObserver.observe(this.table.element.parentNode)),this.subscribe("table-resize",this.tableResized.bind(this))):(this.binding=function(){(!e.browserMobile||e.browserMobile&&(!e.modules.edit||e.modules.edit&&!e.modules.edit.currentCell))&&(e.columnManager.rerenderColumns(!0),e.redraw())},window.addEventListener("resize",this.binding)),this.subscribe("table-destroy",this.clearBindings.bind(this))}}initializeVisibilityObserver(){this.visibilityObserver=new IntersectionObserver(e=>{this.visible=e[0].isIntersecting,this.initialized?this.visible&&(this.redrawTable(this.initialRedraw),this.initialRedraw=!1):(this.initialized=!0,this.initialRedraw=!this.visible)}),this.visibilityObserver.observe(this.table.element)}redrawTable(e){this.initialized&&this.visible&&(this.table.columnManager.rerenderColumns(!0),this.table.redraw(e))}tableResized(){this.table.rowManager.redraw()}clearBindings(){this.binding&&window.removeEventListener("resize",this.binding),this.resizeObserver&&this.resizeObserver.unobserve(this.table.element),this.visibilityObserver&&this.visibilityObserver.unobserve(this.table.element),this.containerObserver&&this.containerObserver.unobserve(this.table.element.parentNode)}}et(R1e,"moduleName","resizeTable");function wJe(t,e,i){var n=document.createElement("div"),r=t.getRow()._row.modules.responsiveLayout;n.classList.add("tabulator-responsive-collapse-toggle"),n.innerHTML=`<svg class='tabulator-responsive-collapse-toggle-open' viewbox="0 0 24 24">
  <line x1="7" y1="12" x2="17" y2="12" fill="none" stroke-width="3" stroke-linecap="round" />
  <line y1="7" x1="12" y2="17" x2="12" fill="none" stroke-width="3" stroke-linecap="round" />
</svg>

<svg class='tabulator-responsive-collapse-toggle-close' viewbox="0 0 24 24">
  <line x1="7" y1="12" x2="17" y2="12"  fill="none" stroke-width="3" stroke-linecap="round" />
</svg>`,t.getElement().classList.add("tabulator-row-handle");function a(s){var o=r.element;r.open=s,o&&(r.open?(n.classList.add("open"),o.style.display=""):(n.classList.remove("open"),o.style.display="none"))}return n.addEventListener("click",function(s){s.stopImmediatePropagation(),a(!r.open),t.getTable().rowManager.adjustTableSize()}),a(r.open),n}var SJe={format:{formatters:{responsiveCollapse:wJe}}};class YG extends qn{constructor(e){super(e),this.columns=[],this.hiddenColumns=[],this.mode="",this.index=0,this.collapseFormatter=[],this.collapseStartOpen=!0,this.collapseHandleColumn=!1,this.registerTableOption("responsiveLayout",!1),this.registerTableOption("responsiveLayoutCollapseStartOpen",!0),this.registerTableOption("responsiveLayoutCollapseUseFormatters",!0),this.registerTableOption("responsiveLayoutCollapseFormatter",!1),this.registerColumnOption("responsive")}initialize(){this.table.options.responsiveLayout&&(this.subscribe("column-layout",this.initializeColumn.bind(this)),this.subscribe("column-show",this.updateColumnVisibility.bind(this)),this.subscribe("column-hide",this.updateColumnVisibility.bind(this)),this.subscribe("columns-loaded",this.initializeResponsivity.bind(this)),this.subscribe("column-moved",this.initializeResponsivity.bind(this)),this.subscribe("column-add",this.initializeResponsivity.bind(this)),this.subscribe("column-delete",this.initializeResponsivity.bind(this)),this.subscribe("table-redrawing",this.tableRedraw.bind(this)),this.table.options.responsiveLayout==="collapse"&&(this.subscribe("row-data-changed",this.generateCollapsedRowContent.bind(this)),this.subscribe("row-init",this.initializeRow.bind(this)),this.subscribe("row-layout",this.layoutRow.bind(this))))}tableRedraw(e){["fitColumns","fitDataStretch"].indexOf(this.layoutMode())===-1&&(e||this.update())}initializeResponsivity(){var e=[];this.mode=this.table.options.responsiveLayout,this.collapseFormatter=this.table.options.responsiveLayoutCollapseFormatter||this.formatCollapsedData,this.collapseStartOpen=this.table.options.responsiveLayoutCollapseStartOpen,this.hiddenColumns=[],this.collapseFormatter&&(this.collapseFormatter=this.collapseFormatter.bind(this.table)),this.table.columnManager.columnsByIndex.forEach((i,n)=>{i.modules.responsive&&i.modules.responsive.order&&i.modules.responsive.visible&&(i.modules.responsive.index=n,e.push(i),!i.visible&&this.mode==="collapse"&&this.hiddenColumns.push(i))}),e=e.reverse(),e=e.sort((i,n)=>{var r=n.modules.responsive.order-i.modules.responsive.order;return r||n.modules.responsive.index-i.modules.responsive.index}),this.columns=e,this.mode==="collapse"&&this.generateCollapsedContent();for(let i of this.table.columnManager.columnsByIndex)if(i.definition.formatter=="responsiveCollapse"){this.collapseHandleColumn=i;break}this.collapseHandleColumn&&(this.hiddenColumns.length?this.collapseHandleColumn.show():this.collapseHandleColumn.hide())}initializeColumn(e){var i=e.getDefinition();e.modules.responsive={order:typeof i.responsive>"u"?1:i.responsive,visible:i.visible!==!1}}initializeRow(e){var i;e.type!=="calc"&&(i=document.createElement("div"),i.classList.add("tabulator-responsive-collapse"),e.modules.responsiveLayout={element:i,open:this.collapseStartOpen},this.collapseStartOpen||(i.style.display="none"))}layoutRow(e){var i=e.getElement();e.modules.responsiveLayout&&(i.appendChild(e.modules.responsiveLayout.element),this.generateCollapsedRowContent(e))}updateColumnVisibility(e,i){!i&&e.modules.responsive&&(e.modules.responsive.visible=e.visible,this.initializeResponsivity())}hideColumn(e){var i=this.hiddenColumns.length;e.hide(!1,!0),this.mode==="collapse"&&(this.hiddenColumns.unshift(e),this.generateCollapsedContent(),this.collapseHandleColumn&&!i&&this.collapseHandleColumn.show())}showColumn(e){var i;e.show(!1,!0),e.setWidth(e.getWidth()),this.mode==="collapse"&&(i=this.hiddenColumns.indexOf(e),i>-1&&this.hiddenColumns.splice(i,1),this.generateCollapsedContent(),this.collapseHandleColumn&&!this.hiddenColumns.length&&this.collapseHandleColumn.hide())}update(){for(var e=!0;e;){let i=this.table.modules.layout.getMode()=="fitColumns"?this.table.columnManager.getFlexBaseWidth():this.table.columnManager.getWidth(),n=(this.table.options.headerVisible?this.table.columnManager.element.clientWidth:this.table.element.clientWidth)-i;if(n<0){let r=this.columns[this.index];r?(this.hideColumn(r),this.index++):e=!1}else{let r=this.columns[this.index-1];r&&n>0&&n>=r.getWidth()?(this.showColumn(r),this.index--):e=!1}this.table.rowManager.activeRowsCount||this.table.rowManager.renderEmptyScroll()}}generateCollapsedContent(){var e=this.table.rowManager.getDisplayRows();e.forEach(i=>{this.generateCollapsedRowContent(i)})}generateCollapsedRowContent(e){var i,n;if(e.modules.responsiveLayout){for(i=e.modules.responsiveLayout.element;i.firstChild;)i.removeChild(i.firstChild);n=this.collapseFormatter(this.generateCollapsedRowData(e)),n&&i.appendChild(n),e.calcHeight(!0)}}generateCollapsedRowData(e){var i=e.getData(),n=[],r;return this.hiddenColumns.forEach(a=>{var s=a.getFieldValue(i);if(a.definition.title&&a.field)if(a.modules.format&&this.table.options.responsiveLayoutCollapseUseFormatters){let o=function(l){l()};r={value:!1,data:{},getValue:function(){return s},getData:function(){return i},getType:function(){return"cell"},getElement:function(){return document.createElement("div")},getRow:function(){return e.getComponent()},getColumn:function(){return a.getComponent()},getTable:()=>this.table},n.push({field:a.field,title:a.definition.title,value:a.modules.format.formatter.call(this.table.modules.format,r,a.modules.format.params,o)})}else n.push({field:a.field,title:a.definition.title,value:s})}),n}formatCollapsedData(e){var i=document.createElement("table");return e.forEach(n=>{var r=document.createElement("tr"),a=document.createElement("td"),s=document.createElement("td"),o,l=document.createElement("strong");a.appendChild(l),this.modules.localize.bind("columns|"+n.field,function(c){l.innerHTML=c||n.title}),n.value instanceof Node?(o=document.createElement("div"),o.appendChild(n.value),s.appendChild(o)):s.innerHTML=n.value,r.appendChild(a),r.appendChild(s),i.appendChild(r)}),Object.keys(e).length?i:""}}et(YG,"moduleName","responsiveLayout"),et(YG,"moduleExtensions",SJe);function TJe(t,e,i){var n=document.createElement("input"),r=!1;if(n.type="checkbox",n.setAttribute("aria-label","Select Row"),this.table.modExists("selectRow",!0))if(n.addEventListener("click",s=>{s.stopPropagation()}),typeof t.getRow=="function"){var a=t.getRow();a instanceof D2?(n.addEventListener("change",s=>{this.table.options.selectableRowsRangeMode==="click"&&r?r=!1:a.toggleSelect()}),this.table.options.selectableRowsRangeMode==="click"&&n.addEventListener("click",s=>{r=!0,this.table.modules.selectRow.handleComplexRowClick(a._row,s)}),n.checked=a.isSelected&&a.isSelected(),this.table.modules.selectRow.registerRowSelectCheckbox(a,n)):n=""}else n.addEventListener("change",s=>{this.table.modules.selectRow.selectedRows.length?this.table.deselectRow():this.table.selectRow(e.rowRange)}),this.table.modules.selectRow.registerHeaderSelectCheckbox(n);return n}var UJe={format:{formatters:{rowSelection:TJe}}};class KG extends qn{constructor(e){super(e),this.selecting=!1,this.lastClickedRow=!1,this.selectPrev=[],this.selectedRows=[],this.headerCheckboxElement=null,this.registerTableOption("selectableRows","highlight"),this.registerTableOption("selectableRowsRangeMode","drag"),this.registerTableOption("selectableRowsRollingSelection",!0),this.registerTableOption("selectableRowsPersistence",!0),this.registerTableOption("selectableRowsCheck",function(i,n){return!0}),this.registerTableFunction("selectRow",this.selectRows.bind(this)),this.registerTableFunction("deselectRow",this.deselectRows.bind(this)),this.registerTableFunction("toggleSelectRow",this.toggleRow.bind(this)),this.registerTableFunction("getSelectedRows",this.getSelectedRows.bind(this)),this.registerTableFunction("getSelectedData",this.getSelectedData.bind(this)),this.registerComponentFunction("row","select",this.selectRows.bind(this)),this.registerComponentFunction("row","deselect",this.deselectRows.bind(this)),this.registerComponentFunction("row","toggleSelect",this.toggleRow.bind(this)),this.registerComponentFunction("row","isSelected",this.isRowSelected.bind(this))}initialize(){this.deprecatedOptionsCheck(),this.table.options.selectableRows==="highlight"&&this.table.options.selectableRange&&(this.table.options.selectableRows=!1),this.table.options.selectableRows!==!1&&(this.subscribe("row-init",this.initializeRow.bind(this)),this.subscribe("row-deleting",this.rowDeleted.bind(this)),this.subscribe("rows-wipe",this.clearSelectionData.bind(this)),this.subscribe("rows-retrieve",this.rowRetrieve.bind(this)),this.table.options.selectableRows&&!this.table.options.selectableRowsPersistence&&this.subscribe("data-refreshing",this.deselectRows.bind(this)))}deprecatedOptionsCheck(){}rowRetrieve(e,i){return e==="selected"?this.selectedRows:i}rowDeleted(e){this._deselectRow(e,!0)}clearSelectionData(e){var i=this.selectedRows.length;this.selecting=!1,this.lastClickedRow=!1,this.selectPrev=[],this.selectedRows=[],i&&e!==!0&&this._rowSelectionChanged()}initializeRow(e){var i=this,n=i.checkRowSelectability(e),r=e.getElement(),a=function(){setTimeout(function(){i.selecting=!1},50),document.body.removeEventListener("mouseup",a)};e.modules.select={selected:!1},r.classList.toggle("tabulator-selectable",n),r.classList.toggle("tabulator-unselectable",!n),i.checkRowSelectability(e)&&i.table.options.selectableRows&&i.table.options.selectableRows!="highlight"&&(i.table.options.selectableRowsRangeMode==="click"?r.addEventListener("click",this.handleComplexRowClick.bind(this,e)):(r.addEventListener("click",function(s){(!i.table.modExists("edit")||!i.table.modules.edit.getCurrentCell())&&i.table._clearSelection(),i.selecting||i.toggleRow(e)}),r.addEventListener("mousedown",function(s){if(s.shiftKey)return i.table._clearSelection(),i.selecting=!0,i.selectPrev=[],document.body.addEventListener("mouseup",a),document.body.addEventListener("keyup",a),i.toggleRow(e),!1}),r.addEventListener("mouseenter",function(s){i.selecting&&(i.table._clearSelection(),i.toggleRow(e),i.selectPrev[1]==e&&i.toggleRow(i.selectPrev[0]))}),r.addEventListener("mouseout",function(s){i.selecting&&(i.table._clearSelection(),i.selectPrev.unshift(e))})))}handleComplexRowClick(e,i){if(i.shiftKey){this.table._clearSelection(),this.lastClickedRow=this.lastClickedRow||e;var n=this.table.rowManager.getDisplayRowIndex(this.lastClickedRow),r=this.table.rowManager.getDisplayRowIndex(e),a=n<=r?n:r,s=n>=r?n:r,o=this.table.rowManager.getDisplayRows().slice(0),l=o.splice(a,s-a+1);i.ctrlKey||i.metaKey?(l.forEach(c=>{c!==this.lastClickedRow&&(this.table.options.selectableRows!==!0&&!this.isRowSelected(e)?this.selectedRows.length<this.table.options.selectableRows&&this.toggleRow(c):this.toggleRow(c))}),this.lastClickedRow=e):(this.deselectRows(void 0,!0),this.table.options.selectableRows!==!0&&l.length>this.table.options.selectableRows&&(l=l.slice(0,this.table.options.selectableRows)),this.selectRows(l)),this.table._clearSelection()}else i.ctrlKey||i.metaKey?(this.toggleRow(e),this.lastClickedRow=e):(this.deselectRows(void 0,!0),this.selectRows(e),this.lastClickedRow=e)}checkRowSelectability(e){return e&&e.type==="row"?this.table.options.selectableRowsCheck.call(this.table,e.getComponent()):!1}toggleRow(e){this.checkRowSelectability(e)&&(e.modules.select&&e.modules.select.selected?this._deselectRow(e):this._selectRow(e))}selectRows(e){var i=[],n,r;switch(typeof e){case"undefined":n=this.table.rowManager.rows;break;case"number":n=this.table.rowManager.findRow(e);break;case"string":n=this.table.rowManager.findRow(e),n||(n=this.table.rowManager.getRows(e));break;default:n=e;break}Array.isArray(n)?n.length&&(n.forEach(a=>{r=this._selectRow(a,!0,!0),r&&i.push(r)}),this._rowSelectionChanged(!1,i)):n&&this._selectRow(n,!1,!0)}_selectRow(e,i,n){if(!isNaN(this.table.options.selectableRows)&&this.table.options.selectableRows!==!0&&!n&&this.selectedRows.length>=this.table.options.selectableRows)if(this.table.options.selectableRowsRollingSelection)this._deselectRow(this.selectedRows[0]);else return!1;var r=this.table.rowManager.findRow(e);if(r){if(this.selectedRows.indexOf(r)==-1)return r.getElement().classList.add("tabulator-selected"),r.modules.select||(r.modules.select={}),r.modules.select.selected=!0,r.modules.select.checkboxEl&&(r.modules.select.checkboxEl.checked=!0),this.selectedRows.push(r),this.table.options.dataTreeSelectPropagate&&this.childRowSelection(r,!0),this.dispatchExternal("rowSelected",r.getComponent()),this._rowSelectionChanged(i,r),r}else i||console.warn("Selection Error - No such row found, ignoring selection:"+e)}isRowSelected(e){return this.selectedRows.indexOf(e)!==-1}deselectRows(e,i){var n=[],r,a;switch(typeof e){case"undefined":r=Object.assign([],this.selectedRows);break;case"number":r=this.table.rowManager.findRow(e);break;case"string":r=this.table.rowManager.findRow(e),r||(r=this.table.rowManager.getRows(e));break;default:r=e;break}Array.isArray(r)?r.length&&(r.forEach(s=>{a=this._deselectRow(s,!0,!0),a&&n.push(a)}),this._rowSelectionChanged(i,[],n)):r&&this._deselectRow(r,i,!0)}_deselectRow(e,i){var n=this,r=n.table.rowManager.findRow(e),a,s;if(r){if(a=n.selectedRows.findIndex(function(o){return o==r}),a>-1)return s=r.getElement(),s&&s.classList.remove("tabulator-selected"),r.modules.select||(r.modules.select={}),r.modules.select.selected=!1,r.modules.select.checkboxEl&&(r.modules.select.checkboxEl.checked=!1),n.selectedRows.splice(a,1),this.table.options.dataTreeSelectPropagate&&this.childRowSelection(r,!1),this.dispatchExternal("rowDeselected",r.getComponent()),n._rowSelectionChanged(i,void 0,r),r}else i||console.warn("Deselection Error - No such row found, ignoring selection:"+e)}getSelectedData(){var e=[];return this.selectedRows.forEach(function(i){e.push(i.getData())}),e}getSelectedRows(){var e=[];return this.selectedRows.forEach(function(i){e.push(i.getComponent())}),e}_rowSelectionChanged(e,i=[],n=[]){this.headerCheckboxElement&&(this.selectedRows.length===0?(this.headerCheckboxElement.checked=!1,this.headerCheckboxElement.indeterminate=!1):this.table.rowManager.rows.length===this.selectedRows.length?(this.headerCheckboxElement.checked=!0,this.headerCheckboxElement.indeterminate=!1):(this.headerCheckboxElement.indeterminate=!0,this.headerCheckboxElement.checked=!1)),e||(Array.isArray(i)||(i=[i]),i=i.map(r=>r.getComponent()),Array.isArray(n)||(n=[n]),n=n.map(r=>r.getComponent()),this.dispatchExternal("rowSelectionChanged",this.getSelectedData(),this.getSelectedRows(),i,n))}registerRowSelectCheckbox(e,i){e._row.modules.select||(e._row.modules.select={}),e._row.modules.select.checkboxEl=i}registerHeaderSelectCheckbox(e){this.headerCheckboxElement=e}childRowSelection(e,i){var n=this.table.modules.dataTree.getChildren(e,!0,!0);if(i)for(let r of n)this._selectRow(r,!0);else for(let r of n)this._deselectRow(r,!0)}}et(KG,"moduleName","selectRow"),et(KG,"moduleExtensions",UJe);class DJe{constructor(e){return this._range=e,new Proxy(this,{get:function(i,n,r){return typeof i[n]<"u"?i[n]:i._range.table.componentFunctionBinder.handle("range",i._range,n)}})}getElement(){return this._range.element}getData(){return this._range.getData()}getCells(){return this._range.getCells(!0,!0)}getStructuredCells(){return this._range.getStructuredCells()}getRows(){return this._range.getRows().map(e=>e.getComponent())}getColumns(){return this._range.getColumns().map(e=>e.getComponent())}getBounds(){return this._range.getBounds()}getTopEdge(){return this._range.top}getBottomEdge(){return this._range.bottom}getLeftEdge(){return this._range.left}getRightEdge(){return this._range.right}setBounds(e,i){this._range.destroyedGuard("setBounds")&&this._range.setBounds(e&&e._cell,i&&i._cell)}setStartBound(e){this._range.destroyedGuard("setStartBound")&&(this._range.setEndBound(e&&e._cell),this._range.rangeManager.layoutElement())}setEndBound(e){this._range.destroyedGuard("setEndBound")&&(this._range.setEndBound(e&&e._cell),this._range.rangeManager.layoutElement())}clearValues(){this._range.destroyedGuard("clearValues")&&this._range.clearValues()}remove(){this._range.destroyedGuard("remove")&&this._range.destroy(!0)}}let EJe=class extends bc{constructor(e,i,n,r){super(e),this.rangeManager=i,this.element=null,this.initialized=!1,this.initializing={start:!1,end:!1},this.destroyed=!1,this.top=0,this.bottom=0,this.left=0,this.right=0,this.table=e,this.start={row:0,col:0},this.end={row:0,col:0},this.rangeManager.rowHeader&&(this.left=1,this.right=1,this.start.col=1,this.end.col=1),this.initElement(),setTimeout(()=>{this.initBounds(n,r)})}initElement(){this.element=document.createElement("div"),this.element.classList.add("tabulator-range")}initBounds(e,i){this._updateMinMax(),e&&this.setBounds(e,i||e)}setStart(e,i){(this.start.row!==e||this.start.col!==i)&&(this.start.row=e,this.start.col=i,this.initializing.start=!0,this._updateMinMax())}setEnd(e,i){(this.end.row!==e||this.end.col!==i)&&(this.end.row=e,this.end.col=i,this.initializing.end=!0,this._updateMinMax())}setBounds(e,i,n){e&&this.setStartBound(e),this.setEndBound(i||e),this.rangeManager.layoutElement(n)}setStartBound(e){var i,n;e.type==="column"?this.rangeManager.columnSelection&&this.setStart(0,e.getPosition()-1):(i=e.row.position-1,n=e.column.getPosition()-1,e.column===this.rangeManager.rowHeader?this.setStart(i,1):this.setStart(i,n))}setEndBound(e){var i=this._getTableRows().length,n,r,a;e.type==="column"?this.rangeManager.columnSelection&&(this.rangeManager.selecting==="column"?this.setEnd(i-1,e.getPosition()-1):this.rangeManager.selecting==="cell"&&this.setEnd(0,e.getPosition()-1)):(n=e.row.position-1,r=e.column.getPosition()-1,a=e.column===this.rangeManager.rowHeader,this.rangeManager.selecting==="row"?this.setEnd(n,this._getTableColumns().length-1):this.rangeManager.selecting!=="row"&&a?this.setEnd(n,0):this.rangeManager.selecting==="column"?this.setEnd(i-1,r):this.setEnd(n,r))}_updateMinMax(){this.top=Math.min(this.start.row,this.end.row),this.bottom=Math.max(this.start.row,this.end.row),this.left=Math.min(this.start.col,this.end.col),this.right=Math.max(this.start.col,this.end.col),this.initialized?this.dispatchExternal("rangeChanged",this.getComponent()):this.initializing.start&&this.initializing.end&&(this.initialized=!0,this.dispatchExternal("rangeAdded",this.getComponent()))}_getTableColumns(){return this.table.columnManager.getVisibleColumnsByIndex()}_getTableRows(){return this.table.rowManager.getDisplayRows().filter(e=>e.type==="row")}layout(){var e=this.table.rowManager.renderer.vDomTop,i=this.table.rowManager.renderer.vDomBottom,n=this.table.columnManager.renderer.leftCol,r=this.table.columnManager.renderer.rightCol,a,s,o,l,c,u,d,p,h,f;this.table.options.renderHorizontal==="virtual"&&this.rangeManager.rowHeader&&(r+=1),e==null&&(e=0),i==null&&(i=1/0),n==null&&(n=0),r==null&&(r=1/0),this.overlaps(n,e,r,i)&&(a=Math.max(this.top,e),s=Math.min(this.bottom,i),o=Math.max(this.left,n),l=Math.min(this.right,r),c=this.rangeManager.getCell(a,o),u=this.rangeManager.getCell(s,l),d=c.getElement(),p=u.getElement(),h=c.row.getElement(),f=u.row.getElement(),this.element.classList.add("tabulator-range-active"),this.table.rtl?(this.element.style.right=h.offsetWidth-d.offsetLeft-d.offsetWidth+"px",this.element.style.width=d.offsetLeft+d.offsetWidth-p.offsetLeft+"px"):(this.element.style.left=h.offsetLeft+d.offsetLeft+"px",this.element.style.width=p.offsetLeft+p.offsetWidth-d.offsetLeft+"px"),this.element.style.top=h.offsetTop+"px",this.element.style.height=f.offsetTop+f.offsetHeight-h.offsetTop+"px")}atTopLeft(e){return e.row.position-1===this.top&&e.column.getPosition()-1===this.left}atBottomRight(e){return e.row.position-1===this.bottom&&e.column.getPosition()-1===this.right}occupies(e){return this.occupiesRow(e.row)&&this.occupiesColumn(e.column)}occupiesRow(e){return this.top<=e.position-1&&e.position-1<=this.bottom}occupiesColumn(e){return this.left<=e.getPosition()-1&&e.getPosition()-1<=this.right}overlaps(e,i,n,r){return!(this.left>n||e>this.right||this.top>r||i>this.bottom)}getData(){var e=[],i=this.getRows(),n=this.getColumns();return i.forEach(r=>{var a=r.getData(),s={};n.forEach(o=>{s[o.field]=a[o.field]}),e.push(s)}),e}getCells(e,i){var n=[],r=this.getRows(),a=this.getColumns();return e?n=r.map(s=>{var o=[];return s.getCells().forEach(l=>{a.includes(l.column)&&o.push(i?l.getComponent():l)}),o}):r.forEach(s=>{s.getCells().forEach(o=>{a.includes(o.column)&&n.push(i?o.getComponent():o)})}),n}getStructuredCells(){return this.getCells(!0,!0)}getRows(){return this._getTableRows().slice(this.top,this.bottom+1)}getColumns(){return this._getTableColumns().slice(this.left,this.right+1)}clearValues(){var e=this.getCells(),i=this.table.options.selectableRangeClearCellsValue;this.table.blockRedraw(),e.forEach(n=>{n.setValue(i)}),this.table.restoreRedraw()}getBounds(e){var i=this.getCells(!1,e),n={start:null,end:null};return i.length?(n.start=i[0],n.end=i[i.length-1]):console.warn("No bounds defined on range"),n}getComponent(){return this.component||(this.component=new DJe(this)),this.component}destroy(e){this.destroyed=!0,this.element.remove(),e&&this.rangeManager.rangeRemoved(this),this.initialized&&this.dispatchExternal("rangeRemoved",this.getComponent())}destroyedGuard(e){return this.destroyed&&console.warn("You cannot call the "+e+" function on a destroyed range"),!this.destroyed}};var PJe={rangeJumpUp:["ctrl + 38","meta + 38"],rangeJumpDown:["ctrl + 40","meta + 40"],rangeJumpLeft:["ctrl + 37","meta + 37"],rangeJumpRight:["ctrl + 39","meta + 39"],rangeExpandUp:"shift + 38",rangeExpandDown:"shift + 40",rangeExpandLeft:"shift + 37",rangeExpandRight:"shift + 39",rangeExpandJumpUp:["ctrl + shift + 38","meta + shift + 38"],rangeExpandJumpDown:["ctrl + shift + 40","meta + shift + 40"],rangeExpandJumpLeft:["ctrl + shift + 37","meta + shift + 37"],rangeExpandJumpRight:["ctrl + shift + 39","meta + shift + 39"]},CJe={rangeJumpLeft:function(t){this.dispatch("keybinding-nav-range",t,"left",!0,!1)},rangeJumpRight:function(t){this.dispatch("keybinding-nav-range",t,"right",!0,!1)},rangeJumpUp:function(t){this.dispatch("keybinding-nav-range",t,"up",!0,!1)},rangeJumpDown:function(t){this.dispatch("keybinding-nav-range",t,"down",!0,!1)},rangeExpandLeft:function(t){this.dispatch("keybinding-nav-range",t,"left",!1,!0)},rangeExpandRight:function(t){this.dispatch("keybinding-nav-range",t,"right",!1,!0)},rangeExpandUp:function(t){this.dispatch("keybinding-nav-range",t,"up",!1,!0)},rangeExpandDown:function(t){this.dispatch("keybinding-nav-range",t,"down",!1,!0)},rangeExpandJumpLeft:function(t){this.dispatch("keybinding-nav-range",t,"left",!0,!0)},rangeExpandJumpRight:function(t){this.dispatch("keybinding-nav-range",t,"right",!0,!0)},rangeExpandJumpUp:function(t){this.dispatch("keybinding-nav-range",t,"up",!0,!0)},rangeExpandJumpDown:function(t){this.dispatch("keybinding-nav-range",t,"down",!0,!0)}},RJe={range:function(t){var e=[],i=this.table.modules.selectRange.activeRange,n=!1,r,a,s,o,l;return l=t.length,i&&(r=i.getBounds(),a=r.start,r.start===r.end&&(n=!0),a&&(e=this.table.rowManager.activeRows.slice(),s=e.indexOf(a.row),n?o=t.length:o=e.indexOf(r.end.row)-s+1,s>-1&&(this.table.blockRedraw(),e=e.slice(s,s+o),e.forEach((c,u)=>{c.updateData(t[u%l])}),this.table.restoreRedraw()))),e}},MJe={range:function(t){var e=[],i=[],n=this.table.modules.selectRange.activeRange,r=!1,a,s,o,l,c;return n&&(a=n.getBounds(),s=a.start,a.start===a.end&&(r=!0),s&&(t=t.split(`
`),t.forEach(function(u){e.push(u.split("	"))}),e.length&&(l=this.table.columnManager.getVisibleColumnsByIndex(),c=l.indexOf(s.column),c>-1)))?(r?o=e[0].length:o=l.indexOf(a.end.column)-c+1,l=l.slice(c,c+o),e.forEach(u=>{var d={},p=u.length;l.forEach(function(h,f){d[h.field]=u[f%p]}),i.push(d)}),i):!1}},NJe={range:function(){var t=this.modules.selectRange.selectedColumns();return this.columnManager.rowHeader&&t.unshift(this.columnManager.rowHeader),t}},AJe={range:function(){return this.modules.selectRange.selectedRows()}},_Je={keybindings:{bindings:PJe,actions:CJe},clipboard:{pasteActions:RJe,pasteParsers:MJe},export:{columnLookups:NJe,rowLookups:AJe}};class mA extends qn{constructor(e){super(e),this.selecting="cell",this.mousedown=!1,this.ranges=[],this.overlay=null,this.rowHeader=null,this.layoutChangeTimeout=null,this.columnSelection=!1,this.rowSelection=!1,this.maxRanges=0,this.activeRange=!1,this.blockKeydown=!1,this.keyDownEvent=this._handleKeyDown.bind(this),this.mouseUpEvent=this._handleMouseUp.bind(this),this.registerTableOption("selectableRange",!1),this.registerTableOption("selectableRangeColumns",!1),this.registerTableOption("selectableRangeRows",!1),this.registerTableOption("selectableRangeClearCells",!1),this.registerTableOption("selectableRangeClearCellsValue",void 0),this.registerTableFunction("getRangesData",this.getRangesData.bind(this)),this.registerTableFunction("getRanges",this.getRanges.bind(this)),this.registerTableFunction("addRange",this.addRangeFromComponent.bind(this)),this.registerComponentFunction("cell","getRanges",this.cellGetRanges.bind(this)),this.registerComponentFunction("row","getRanges",this.rowGetRanges.bind(this)),this.registerComponentFunction("column","getRanges",this.colGetRanges.bind(this))}initialize(){this.options("selectableRange")&&(this.options("selectableRows")?console.warn("SelectRange functionality cannot be used in conjunction with row selection"):(this.maxRanges=this.options("selectableRange"),this.initializeTable(),this.initializeWatchers()),this.options("columns").findIndex(e=>e.frozen)>0&&console.warn("Having frozen column in arbitrary position with selectRange option may result in unpredictable behavior."),this.options("columns").filter(e=>e.frozen)>1&&console.warn("Having multiple frozen columns with selectRange option may result in unpredictable behavior."))}initializeTable(){this.overlay=document.createElement("div"),this.overlay.classList.add("tabulator-range-overlay"),this.rangeContainer=document.createElement("div"),this.rangeContainer.classList.add("tabulator-range-container"),this.activeRangeCellElement=document.createElement("div"),this.activeRangeCellElement.classList.add("tabulator-range-cell-active"),this.overlay.appendChild(this.rangeContainer),this.overlay.appendChild(this.activeRangeCellElement),this.table.rowManager.element.addEventListener("keydown",this.keyDownEvent),this.resetRanges(),this.table.rowManager.element.appendChild(this.overlay),this.table.columnManager.element.setAttribute("tabindex",0),this.table.element.classList.add("tabulator-ranges")}initializeWatchers(){this.columnSelection=this.options("selectableRangeColumns"),this.rowSelection=this.options("selectableRangeRows"),this.subscribe("column-init",this.initializeColumn.bind(this)),this.subscribe("column-mousedown",this.handleColumnMouseDown.bind(this)),this.subscribe("column-mousemove",this.handleColumnMouseMove.bind(this)),this.subscribe("column-resized",this.handleColumnResized.bind(this)),this.subscribe("column-moving",this.handleColumnMoving.bind(this)),this.subscribe("column-moved",this.handleColumnMoved.bind(this)),this.subscribe("column-width",this.layoutChange.bind(this)),this.subscribe("column-height",this.layoutChange.bind(this)),this.subscribe("column-resized",this.layoutChange.bind(this)),this.subscribe("columns-loaded",this.updateHeaderColumn.bind(this)),this.subscribe("cell-height",this.layoutChange.bind(this)),this.subscribe("cell-rendered",this.renderCell.bind(this)),this.subscribe("cell-mousedown",this.handleCellMouseDown.bind(this)),this.subscribe("cell-mousemove",this.handleCellMouseMove.bind(this)),this.subscribe("cell-click",this.handleCellClick.bind(this)),this.subscribe("cell-editing",this.handleEditingCell.bind(this)),this.subscribe("page-changed",this.redraw.bind(this)),this.subscribe("scroll-vertical",this.layoutChange.bind(this)),this.subscribe("scroll-horizontal",this.layoutChange.bind(this)),this.subscribe("data-destroy",this.tableDestroyed.bind(this)),this.subscribe("data-processed",this.resetRanges.bind(this)),this.subscribe("table-layout",this.layoutElement.bind(this)),this.subscribe("table-redraw",this.redraw.bind(this)),this.subscribe("table-destroy",this.tableDestroyed.bind(this)),this.subscribe("edit-editor-clear",this.finishEditingCell.bind(this)),this.subscribe("edit-blur",this.restoreFocus.bind(this)),this.subscribe("keybinding-nav-prev",this.keyNavigate.bind(this,"left")),this.subscribe("keybinding-nav-next",this.keyNavigate.bind(this,"right")),this.subscribe("keybinding-nav-left",this.keyNavigate.bind(this,"left")),this.subscribe("keybinding-nav-right",this.keyNavigate.bind(this,"right")),this.subscribe("keybinding-nav-up",this.keyNavigate.bind(this,"up")),this.subscribe("keybinding-nav-down",this.keyNavigate.bind(this,"down")),this.subscribe("keybinding-nav-range",this.keyNavigateRange.bind(this))}initializeColumn(e){this.columnSelection&&e.definition.headerSort&&this.options("headerSortClickElement")!=="icon"&&console.warn("Using column headerSort with selectableRangeColumns option may result in unpredictable behavior. Consider using headerSortClickElement: 'icon'."),e.modules.edit}updateHeaderColumn(){var e;this.rowSelection&&(this.rowHeader=this.table.columnManager.getVisibleColumnsByIndex()[0],this.rowHeader&&(this.rowHeader.definition.cssClass=this.rowHeader.definition.cssClass+" tabulator-range-row-header",this.rowHeader.definition.headerSort&&console.warn("Using column headerSort with selectableRangeRows option may result in unpredictable behavior"),this.rowHeader.definition.editor&&console.warn("Using column editor with selectableRangeRows option may result in unpredictable behavior"))),this.table.modules.frozenColumns&&this.table.modules.frozenColumns.active&&(e=this.table.modules.frozenColumns.getFrozenColumns(),(e.length>1||e.length===1&&e[0]!==this.rowHeader)&&console.warn("Using frozen columns that are not the range header in combination with the selectRange option may result in unpredictable behavior"))}getRanges(){return this.ranges.map(e=>e.getComponent())}getRangesData(){return this.ranges.map(e=>e.getData())}addRangeFromComponent(e,i){return e=e?e._cell:null,i=i?i._cell:null,this.addRange(e,i)}cellGetRanges(e){var i=[];return e.column===this.rowHeader?i=this.ranges.filter(n=>n.occupiesRow(e.row)):i=this.ranges.filter(n=>n.occupies(e)),i.map(n=>n.getComponent())}rowGetRanges(e){var i=this.ranges.filter(n=>n.occupiesRow(e));return i.map(n=>n.getComponent())}colGetRanges(e){var i=this.ranges.filter(n=>n.occupiesColumn(e));return i.map(n=>n.getComponent())}_handleMouseUp(e){this.mousedown=!1,document.removeEventListener("mouseup",this.mouseUpEvent)}_handleKeyDown(e){if(!this.blockKeydown&&(!this.table.modules.edit||this.table.modules.edit&&!this.table.modules.edit.currentCell)){if(e.key==="Enter"){if(this.table.modules.edit&&this.table.modules.edit.currentCell)return;this.table.modules.edit.editCell(this.getActiveCell()),e.preventDefault()}(e.key==="Backspace"||e.key==="Delete")&&this.options("selectableRangeClearCells")&&this.activeRange&&this.activeRange.clearValues()}}initializeFocus(e){var i;this.restoreFocus();try{document.selection?(i=document.body.createTextRange(),i.moveToElementText(e.getElement()),i.select()):window.getSelection&&(i=document.createRange(),i.selectNode(e.getElement()),window.getSelection().removeAllRanges(),window.getSelection().addRange(i))}catch{}}restoreFocus(e){return this.table.rowManager.element.focus(),!0}handleColumnResized(e){var i;this.selecting!=="column"&&this.selecting!=="all"||(i=this.ranges.some(n=>n.occupiesColumn(e)),i&&this.ranges.forEach(n=>{var r=n.getColumns(!0);r.forEach(a=>{a!==e&&a.setWidth(e.width)})}))}handleColumnMoving(e,i){this.resetRanges().setBounds(i),this.overlay.style.visibility="hidden"}handleColumnMoved(e,i,n){this.activeRange.setBounds(e),this.layoutElement()}handleColumnMouseDown(e,i){e.button===2&&(this.selecting==="column"||this.selecting==="all")&&this.activeRange.occupiesColumn(i)||this.table.options.movableColumns&&this.selecting==="column"&&this.activeRange.occupiesColumn(i)||(this.mousedown=!0,document.addEventListener("mouseup",this.mouseUpEvent),this.newSelection(e,i))}handleColumnMouseMove(e,i){i===this.rowHeader||!this.mousedown||this.selecting==="all"||this.activeRange.setBounds(!1,i,!0)}renderCell(e){var i=e.getElement(),n=this.ranges.findIndex(r=>r.occupies(e));i.classList.toggle("tabulator-range-selected",n!==-1),i.classList.toggle("tabulator-range-only-cell-selected",this.ranges.length===1&&this.ranges[0].atTopLeft(e)&&this.ranges[0].atBottomRight(e)),i.dataset.range=n}handleCellMouseDown(e,i){e.button===2&&(this.activeRange.occupies(i)||(this.selecting==="row"||this.selecting==="all")&&this.activeRange.occupiesRow(i.row))||(this.mousedown=!0,document.addEventListener("mouseup",this.mouseUpEvent),this.newSelection(e,i))}handleCellMouseMove(e,i){!this.mousedown||this.selecting==="all"||this.activeRange.setBounds(!1,i,!0)}handleCellClick(e,i){this.initializeFocus(i)}handleEditingCell(e){this.activeRange&&this.activeRange.setBounds(e)}finishEditingCell(){this.blockKeydown=!0,this.table.rowManager.element.focus(),setTimeout(()=>{this.blockKeydown=!1},10)}keyNavigate(e,i){this.navigate(!1,!1,e),i.preventDefault()}keyNavigateRange(e,i,n,r){this.navigate(n,r,i),e.preventDefault()}navigate(e,i,n){var r=!1,a,s,o,l,c,u;if(this.table.modules.edit&&this.table.modules.edit.currentCell)return!1;if(this.ranges.length>1&&(this.ranges=this.ranges.filter(d=>d===this.activeRange?(d.setEnd(d.start.row,d.start.col),!0):(d.destroy(),!1))),a=this.activeRange,s=i?a.end:a.start,o=s.row,l=s.col,e)switch(n){case"left":l=this.findJumpCellLeft(a.start.row,s.col);break;case"right":l=this.findJumpCellRight(a.start.row,s.col);break;case"up":o=this.findJumpCellUp(s.row,a.start.col);break;case"down":o=this.findJumpCellDown(s.row,a.start.col);break}else{if(i&&(this.selecting==="row"&&(n==="left"||n==="right")||this.selecting==="column"&&(n==="up"||n==="down")))return;switch(n){case"left":l=Math.max(l-1,0);break;case"right":l=Math.min(l+1,this.getTableColumns().length-1);break;case"up":o=Math.max(o-1,0);break;case"down":o=Math.min(o+1,this.getTableRows().length-1);break}}if(this.rowHeader&&l===0&&(l=1),r=l!==s.col||o!==s.row,i||a.setStart(o,l),a.setEnd(o,l),i||(this.selecting="cell"),r)return c=this.getRowByRangePos(a.end.row),u=this.getColumnByRangePos(a.end.col),(n==="left"||n==="right")&&u.getElement().parentNode===null?u.getComponent().scrollTo(void 0,!1):(n==="up"||n==="down")&&c.getElement().parentNode===null?c.getComponent().scrollTo(void 0,!1):this.autoScroll(a,c.getElement(),u.getElement()),this.layoutElement(),!0}rangeRemoved(e){this.ranges=this.ranges.filter(i=>i!==e),this.activeRange===e&&(this.ranges.length?this.activeRange=this.ranges[this.ranges.length-1]:this.addRange()),this.layoutElement()}findJumpRow(e,i,n,r,a){return n&&(i=i.reverse()),this.findJumpItem(r,a,i,function(s){return s.getData()[e.getField()]})}findJumpCol(e,i,n,r,a){return n&&(i=i.reverse()),this.findJumpItem(r,a,i,function(s){return e.getData()[s.getField()]})}findJumpItem(e,i,n,r){var a;for(let s of n){let o=r(s);if(e){if(a=s,o)break}else if(i){if(a=s,o)break}else if(o)a=s;else break}return a}findJumpCellLeft(e,i){var n=this.getRowByRangePos(e),r=this.getTableColumns(),a=this.isEmpty(n.getData()[r[i].getField()]),s=r[i-1]?this.isEmpty(n.getData()[r[i-1].getField()]):!1,o=this.rowHeader?r.slice(1,i):r.slice(0,i),l=this.findJumpCol(n,o,!0,a,s);return l?l.getPosition()-1:i}findJumpCellRight(e,i){var n=this.getRowByRangePos(e),r=this.getTableColumns(),a=this.isEmpty(n.getData()[r[i].getField()]),s=r[i+1]?this.isEmpty(n.getData()[r[i+1].getField()]):!1,o=this.findJumpCol(n,r.slice(i+1,r.length),!1,a,s);return o?o.getPosition()-1:i}findJumpCellUp(e,i){var n=this.getColumnByRangePos(i),r=this.getTableRows(),a=this.isEmpty(r[e].getData()[n.getField()]),s=r[e-1]?this.isEmpty(r[e-1].getData()[n.getField()]):!1,o=this.findJumpRow(n,r.slice(0,e),!0,a,s);return o?o.position-1:e}findJumpCellDown(e,i){var n=this.getColumnByRangePos(i),r=this.getTableRows(),a=this.isEmpty(r[e].getData()[n.getField()]),s=r[e+1]?this.isEmpty(r[e+1].getData()[n.getField()]):!1,o=this.findJumpRow(n,r.slice(e+1,r.length),!1,a,s);return o?o.position-1:e}newSelection(e,i){var n;if(i.type==="column"){if(!this.columnSelection)return;if(i===this.rowHeader){n=this.resetRanges(),this.selecting="all";var r,a=this.getCell(-1,-1);this.rowHeader?r=this.getCell(0,1):r=this.getCell(0,0),n.setBounds(r,a);return}else this.selecting="column"}else i.column===this.rowHeader?this.selecting="row":this.selecting="cell";e.shiftKey?this.activeRange.setBounds(!1,i):e.ctrlKey?this.addRange().setBounds(i):this.resetRanges().setBounds(i)}autoScroll(e,i,n){var r=this.table.rowManager.element,a,s,o,l,c;typeof i>"u"&&(i=this.getRowByRangePos(e.end.row).getElement()),typeof n>"u"&&(n=this.getColumnByRangePos(e.end.col).getElement()),this.rowHeader&&(a=this.rowHeader.getElement()),s={left:n.offsetLeft,right:n.offsetLeft+n.offsetWidth,top:i.offsetTop,bottom:i.offsetTop+i.offsetHeight},o={left:r.scrollLeft,right:Math.ceil(r.scrollLeft+r.clientWidth),top:r.scrollTop,bottom:r.scrollTop+r.offsetHeight-this.table.rowManager.scrollbarWidth},a&&(o.left+=a.offsetWidth),l=o.left<s.left&&s.left<o.right&&o.left<s.right&&s.right<o.right,c=o.top<s.top&&s.top<o.bottom&&o.top<s.bottom&&s.bottom<o.bottom,l||(s.left<o.left?(r.scrollLeft=s.left,a&&(r.scrollLeft-=a.offsetWidth)):s.right>o.right&&(r.scrollLeft=s.right-r.clientWidth)),c||(s.top<o.top?r.scrollTop=s.top:s.bottom>o.bottom&&(r.scrollTop=s.bottom-r.clientHeight))}layoutChange(){this.overlay.style.visibility="hidden",clearTimeout(this.layoutChangeTimeout),this.layoutChangeTimeout=setTimeout(this.layoutRanges.bind(this),200)}redraw(e){e&&(this.selecting="cell",this.resetRanges(),this.layoutElement())}layoutElement(e){var i;e?i=this.table.rowManager.getVisibleRows(!0):i=this.table.rowManager.getRows(),i.forEach(n=>{n.type==="row"&&(this.layoutRow(n),n.cells.forEach(r=>this.renderCell(r)))}),this.getTableColumns().forEach(n=>{this.layoutColumn(n)}),this.layoutRanges()}layoutRow(e){var i=e.getElement(),n=!1,r=this.ranges.some(a=>a.occupiesRow(e));this.selecting==="row"?n=r:this.selecting==="all"&&(n=!0),i.classList.toggle("tabulator-range-selected",n),i.classList.toggle("tabulator-range-highlight",r)}layoutColumn(e){var i=e.getElement(),n=!1,r=this.ranges.some(a=>a.occupiesColumn(e));this.selecting==="column"?n=r:this.selecting==="all"&&(n=!0),i.classList.toggle("tabulator-range-selected",n),i.classList.toggle("tabulator-range-highlight",r)}layoutRanges(){var e,i,n;this.table.initialized&&(e=this.getActiveCell(),e&&(i=e.getElement(),n=e.row.getElement(),this.table.rtl?this.activeRangeCellElement.style.right=n.offsetWidth-i.offsetLeft-i.offsetWidth+"px":this.activeRangeCellElement.style.left=n.offsetLeft+i.offsetLeft+"px",this.activeRangeCellElement.style.top=n.offsetTop+"px",this.activeRangeCellElement.style.width=i.offsetWidth+"px",this.activeRangeCellElement.style.height=n.offsetHeight+"px",this.ranges.forEach(r=>r.layout()),this.overlay.style.visibility="visible"))}getCell(e,i){var n;return i<0&&(i=this.getTableColumns().length+i,i<0)?null:(e<0&&(e=this.getTableRows().length+e),n=this.table.rowManager.getRowFromPosition(e+1),n?n.getCells(!1,!0).filter(r=>r.column.visible)[i]:null)}getActiveCell(){return this.getCell(this.activeRange.start.row,this.activeRange.start.col)}getRowByRangePos(e){return this.getTableRows()[e]}getColumnByRangePos(e){return this.getTableColumns()[e]}getTableRows(){return this.table.rowManager.getDisplayRows().filter(e=>e.type==="row")}getTableColumns(){return this.table.columnManager.getVisibleColumnsByIndex()}addRange(e,i){var n;return this.maxRanges!==!0&&this.ranges.length>=this.maxRanges&&this.ranges.shift().destroy(),n=new EJe(this.table,this,e,i),this.activeRange=n,this.ranges.push(n),this.rangeContainer.appendChild(n.element),n}resetRanges(){var e,i,n;return this.ranges.forEach(r=>r.destroy()),this.ranges=[],e=this.addRange(),this.table.rowManager.activeRows.length&&(n=this.table.rowManager.activeRows[0].cells.filter(r=>r.column.visible),i=n[this.rowHeader?1:0],i&&(e.setBounds(i),this.initializeFocus(i))),e}tableDestroyed(){document.removeEventListener("mouseup",this.mouseUpEvent),this.table.rowManager.element.removeEventListener("keydown",this.keyDownEvent)}selectedRows(e){return e?this.activeRange.getRows().map(i=>i.getComponent()):this.activeRange.getRows()}selectedColumns(e){return e?this.activeRange.getColumns().map(i=>i.getComponent()):this.activeRange.getColumns()}isEmpty(e){return e==null||e===""}}et(mA,"moduleName","selectRange"),et(mA,"moduleInitOrder",1),et(mA,"moduleExtensions",_Je);function kJe(t,e,i,n,r,a,s){var o=s.alignEmptyValues,l=s.decimalSeparator,c=s.thousandSeparator,u=0;if(t=String(t),e=String(e),c&&(t=t.split(c).join(""),e=e.split(c).join("")),l&&(t=t.split(l).join("."),e=e.split(l).join(".")),t=parseFloat(t),e=parseFloat(e),isNaN(t))u=isNaN(e)?0:-1;else if(isNaN(e))u=1;else return t-e;return(o==="top"&&a==="desc"||o==="bottom"&&a==="asc")&&(u*=-1),u}function xJe(t,e,i,n,r,a,s){var o=s.alignEmptyValues,l=0,c;if(!t)l=e?-1:0;else if(!e)l=1;else{switch(typeof s.locale){case"boolean":s.locale&&(c=this.langLocale());break;case"string":c=s.locale;break}return String(t).toLowerCase().localeCompare(String(e).toLowerCase(),c)}return(o==="top"&&a==="desc"||o==="bottom"&&a==="asc")&&(l*=-1),l}function cY(t,e,i,n,r,a,s){var o=window.DateTime||luxon.DateTime,l=s.format||"dd/MM/yyyy HH:mm:ss",c=s.alignEmptyValues,u=0;if(typeof o<"u"){if(o.isDateTime(t)||(l==="iso"?t=o.fromISO(String(t)):t=o.fromFormat(String(t),l)),o.isDateTime(e)||(l==="iso"?e=o.fromISO(String(e)):e=o.fromFormat(String(e),l)),!t.isValid)u=e.isValid?-1:0;else if(!e.isValid)u=1;else return t-e;return(c==="top"&&a==="desc"||c==="bottom"&&a==="asc")&&(u*=-1),u}else console.error("Sort Error - 'datetime' sorter is dependant on luxon.js")}function OJe(t,e,i,n,r,a,s){return s.format||(s.format="dd/MM/yyyy"),cY.call(this,t,e,i,n,r,a,s)}function LJe(t,e,i,n,r,a,s){return s.format||(s.format="HH:mm"),cY.call(this,t,e,i,n,r,a,s)}function FJe(t,e,i,n,r,a,s){var o=t===!0||t==="true"||t==="True"||t===1?1:0,l=e===!0||e==="true"||e==="True"||e===1?1:0;return o-l}function $Je(t,e,i,n,r,a,s){var o=s.type||"length",l=s.alignEmptyValues,c=0;function u(d){var p;switch(o){case"length":p=d.length;break;case"sum":p=d.reduce(function(h,f){return h+f});break;case"max":p=Math.max.apply(null,d);break;case"min":p=Math.min.apply(null,d);break;case"avg":p=d.reduce(function(h,f){return h+f})/d.length;break}return p}if(!Array.isArray(t))c=Array.isArray(e)?-1:0;else if(!Array.isArray(e))c=1;else return u(e)-u(t);return(l==="top"&&a==="desc"||l==="bottom"&&a==="asc")&&(c*=-1),c}function BJe(t,e,i,n,r,a,s){var o=typeof t>"u"?0:1,l=typeof e>"u"?0:1;return o-l}function VJe(t,e,i,n,r,a,s){var o,l,c,u,d=0,p,h=/(\d+)|(\D+)/g,f=/\d/,m=s.alignEmptyValues,g=0;if(!t&&t!==0)g=!e&&e!==0?0:-1;else if(!e&&e!==0)g=1;else{if(isFinite(t)&&isFinite(e))return t-e;if(o=String(t).toLowerCase(),l=String(e).toLowerCase(),o===l)return 0;if(!(f.test(o)&&f.test(l)))return o>l?1:-1;for(o=o.match(h),l=l.match(h),p=o.length>l.length?l.length:o.length;d<p;)if(c=o[d],u=l[d++],c!==u)return isFinite(c)&&isFinite(u)?(c.charAt(0)==="0"&&(c="."+c),u.charAt(0)==="0"&&(u="."+u),c-u):c>u?1:-1;return o.length>l.length}return(m==="top"&&a==="desc"||m==="bottom"&&a==="asc")&&(g*=-1),g}var jJe={number:kJe,string:xJe,date:OJe,time:LJe,datetime:cY,boolean:FJe,array:$Je,exists:BJe,alphanum:VJe};const Rb=class Rb extends qn{constructor(e){super(e),this.sortList=[],this.changed=!1,this.registerTableOption("sortMode","local"),this.registerTableOption("initialSort",!1),this.registerTableOption("columnHeaderSortMulti",!0),this.registerTableOption("sortOrderReverse",!1),this.registerTableOption("headerSortElement","<div class='tabulator-arrow'></div>"),this.registerTableOption("headerSortClickElement","header"),this.registerColumnOption("sorter"),this.registerColumnOption("sorterParams"),this.registerColumnOption("headerSort",!0),this.registerColumnOption("headerSortStartingDir"),this.registerColumnOption("headerSortTristate")}initialize(){this.subscribe("column-layout",this.initializeColumn.bind(this)),this.subscribe("table-built",this.tableBuilt.bind(this)),this.registerDataHandler(this.sort.bind(this),20),this.registerTableFunction("setSort",this.userSetSort.bind(this)),this.registerTableFunction("getSorters",this.getSort.bind(this)),this.registerTableFunction("clearSort",this.clearSort.bind(this)),this.table.options.sortMode==="remote"&&this.subscribe("data-params",this.remoteSortParams.bind(this))}tableBuilt(){this.table.options.initialSort&&this.setSort(this.table.options.initialSort)}remoteSortParams(e,i,n,r){var a=this.getSort();return a.forEach(s=>{delete s.column}),r.sort=a,r}userSetSort(e,i){this.setSort(e,i),this.refreshSort()}clearSort(){this.clear(),this.refreshSort()}initializeColumn(e){var i=!1,n,r;switch(typeof e.definition.sorter){case"string":Rb.sorters[e.definition.sorter]?i=Rb.sorters[e.definition.sorter]:console.warn("Sort Error - No such sorter found: ",e.definition.sorter);break;case"function":i=e.definition.sorter;break}if(e.modules.sort={sorter:i,dir:"none",params:e.definition.sorterParams||{},startingDir:e.definition.headerSortStartingDir||"asc",tristate:e.definition.headerSortTristate},e.definition.headerSort!==!1){switch(n=e.getElement(),n.classList.add("tabulator-sortable"),r=document.createElement("div"),r.classList.add("tabulator-col-sorter"),this.table.options.headerSortClickElement){case"icon":r.classList.add("tabulator-col-sorter-element");break;case"header":n.classList.add("tabulator-col-sorter-element");break;default:n.classList.add("tabulator-col-sorter-element");break}switch(this.table.options.headerSortElement){case"function":break;case"object":r.appendChild(this.table.options.headerSortElement);break;default:r.innerHTML=this.table.options.headerSortElement}e.titleHolderElement.appendChild(r),e.modules.sort.element=r,this.setColumnHeaderSortIcon(e,"none"),this.table.options.headerSortClickElement==="icon"&&r.addEventListener("mousedown",a=>{a.stopPropagation()}),(this.table.options.headerSortClickElement==="icon"?r:n).addEventListener("click",a=>{var s="",o=[],l=!1;if(e.modules.sort){if(e.modules.sort.tristate)e.modules.sort.dir=="none"?s=e.modules.sort.startingDir:e.modules.sort.dir==e.modules.sort.startingDir?s=e.modules.sort.dir=="asc"?"desc":"asc":s="none";else switch(e.modules.sort.dir){case"asc":s="desc";break;case"desc":s="asc";break;default:s=e.modules.sort.startingDir}this.table.options.columnHeaderSortMulti&&(a.shiftKey||a.ctrlKey)?(o=this.getSort(),l=o.findIndex(c=>c.field===e.getField()),l>-1?(o[l].dir=s,l=o.splice(l,1)[0],s!="none"&&o.push(l)):s!="none"&&o.push({column:e,dir:s}),this.setSort(o)):s=="none"?this.clear():this.setSort(e,s),this.refreshSort()}})}}refreshSort(){this.table.options.sortMode==="remote"?this.reloadData(null,!1,!1):this.refreshData(!0)}hasChanged(){var e=this.changed;return this.changed=!1,e}getSort(){var e=this,i=[];return e.sortList.forEach(function(n){n.column&&i.push({column:n.column.getComponent(),field:n.column.getField(),dir:n.dir})}),i}setSort(e,i){var n=this,r=[];Array.isArray(e)||(e=[{column:e,dir:i}]),e.forEach(function(a){var s;s=n.table.columnManager.findColumn(a.column),s?(a.column=s,r.push(a),n.changed=!0):console.warn("Sort Warning - Sort field does not exist and is being ignored: ",a.column)}),n.sortList=r,this.dispatch("sort-changed")}clear(){this.setSort([])}findSorter(e){var i=this.table.rowManager.activeRows[0],n="string",r,a;if(i&&(i=i.getData(),r=e.getField(),r))switch(a=e.getFieldValue(i),typeof a){case"undefined":n="string";break;case"boolean":n="boolean";break;default:!isNaN(a)&&a!==""?n="number":a.match(/((^[0-9]+[a-z]+)|(^[a-z]+[0-9]+))+$/i)&&(n="alphanum");break}return Rb.sorters[n]}sort(e,i){var n=this,r=this.table.options.sortOrderReverse?n.sortList.slice().reverse():n.sortList,a=[],s=[];return this.subscribedExternal("dataSorting")&&this.dispatchExternal("dataSorting",n.getSort()),i||n.clearColumnHeaders(),this.table.options.sortMode!=="remote"?(r.forEach(function(o,l){var c;o.column&&(c=o.column.modules.sort,c&&(c.sorter||(c.sorter=n.findSorter(o.column)),o.params=typeof c.params=="function"?c.params(o.column.getComponent(),o.dir):c.params,a.push(o)),i||n.setColumnHeader(o.column,o.dir))}),a.length&&n._sortItems(e,a)):i||r.forEach(function(o,l){n.setColumnHeader(o.column,o.dir)}),this.subscribedExternal("dataSorted")&&(e.forEach(o=>{s.push(o.getComponent())}),this.dispatchExternal("dataSorted",n.getSort(),s)),e}clearColumnHeaders(){this.table.columnManager.getRealColumns().forEach(e=>{e.modules.sort&&(e.modules.sort.dir="none",e.getElement().setAttribute("aria-sort","none"),this.setColumnHeaderSortIcon(e,"none"))})}setColumnHeader(e,i){e.modules.sort.dir=i,e.getElement().setAttribute("aria-sort",i==="asc"?"ascending":"descending"),this.setColumnHeaderSortIcon(e,i)}setColumnHeaderSortIcon(e,i){var n=e.modules.sort.element,r;if(e.definition.headerSort&&typeof this.table.options.headerSortElement=="function"){for(;n.firstChild;)n.removeChild(n.firstChild);r=this.table.options.headerSortElement.call(this.table,e.getComponent(),i),typeof r=="object"?n.appendChild(r):n.innerHTML=r}}_sortItems(e,i){var n=i.length-1;e.sort((r,a)=>{for(var s,o=n;o>=0;o--){let l=i[o];if(s=this._sortRow(r,a,l.column,l.dir,l.params),s!==0)break}return s})}_sortRow(e,i,n,r,a){var s,o,l=r=="asc"?e:i,c=r=="asc"?i:e;return e=n.getFieldValue(l.getData()),i=n.getFieldValue(c.getData()),e=typeof e<"u"?e:"",i=typeof i<"u"?i:"",s=l.getComponent(),o=c.getComponent(),n.modules.sort.sorter.call(this,e,i,s,o,n.getComponent(),r,a)}};et(Rb,"moduleName","sort"),et(Rb,"sorters",jJe);let ZG=Rb;class GJe{constructor(e,i){this.columnCount=e,this.rowCount=i,this.columnString=[],this.columns=[],this.rows=[]}genColumns(e){var i=Math.max(this.columnCount,Math.max(...e.map(n=>n.length)));this.columnString=[],this.columns=[];for(let n=1;n<=i;n++)this.incrementChar(this.columnString.length-1),this.columns.push(this.columnString.join(""));return this.columns}genRows(e){var i=Math.max(this.rowCount,e.length);this.rows=[];for(let n=1;n<=i;n++)this.rows.push(n);return this.rows}incrementChar(e){let i=this.columnString[e];i?i!=="Z"?this.columnString[e]=String.fromCharCode(this.columnString[e].charCodeAt(0)+1):(this.columnString[e]="A",e?this.incrementChar(e-1):this.columnString.push("A")):this.columnString.push("A")}setRowCount(e){this.rowCount=e}setColumnCount(e){this.columnCount=e}}class M1e{constructor(e){return this._sheet=e,new Proxy(this,{get:function(i,n,r){return typeof i[n]<"u"?i[n]:i._sheet.table.componentFunctionBinder.handle("sheet",i._sheet,n)}})}getTitle(){return this._sheet.title}getKey(){return this._sheet.key}getDefinition(){return this._sheet.getDefinition()}getData(){return this._sheet.getData()}setData(e){return this._sheet.setData(e)}clear(){return this._sheet.clear()}remove(){return this._sheet.remove()}active(){return this._sheet.active()}setTitle(e){return this._sheet.setTitle(e)}setRows(e){return this._sheet.setRows(e)}setColumns(e){return this._sheet.setColumns(e)}}class sQ extends bc{constructor(e,i){super(e.table),this.spreadsheetManager=e,this.definition=i,this.title=this.definition.title||"",this.key=this.definition.key||this.definition.title,this.rowCount=this.definition.rows,this.columnCount=this.definition.columns,this.data=this.definition.data||[],this.element=null,this.isActive=!1,this.grid=new GJe(this.columnCount,this.rowCount),this.defaultColumnDefinition={width:100,headerHozAlign:"center",headerSort:!1},this.columnDefinition=Object.assign(this.defaultColumnDefinition,this.options("spreadsheetColumnDefinition")),this.columnDefs=[],this.rowDefs=[],this.columnFields=[],this.columns=[],this.rows=[],this.scrollTop=null,this.scrollLeft=null,this.initialize(),this.dispatchExternal("sheetAdded",this.getComponent())}initialize(){this.initializeElement(),this.initializeColumns(),this.initializeRows()}reinitialize(){this.initializeColumns(),this.initializeRows()}initializeElement(){this.element=document.createElement("div"),this.element.classList.add("tabulator-spreadsheet-tab"),this.element.innerText=this.title,this.element.addEventListener("click",()=>{this.spreadsheetManager.loadSheet(this)})}initializeColumns(){this.grid.setColumnCount(this.columnCount),this.columnFields=this.grid.genColumns(this.data),this.columnDefs=[],this.columnFields.forEach(e=>{var i=Object.assign({},this.columnDefinition);i.field=e,i.title=e,this.columnDefs.push(i)})}initializeRows(){var e;this.grid.setRowCount(this.rowCount),e=this.grid.genRows(this.data),this.rowDefs=[],e.forEach((i,n)=>{var r={_id:i},a=this.data[n];a&&a.forEach((s,o)=>{var l=this.columnFields[o];l&&(r[l]=s)}),this.rowDefs.push(r)})}unload(){this.isActive=!1,this.scrollTop=this.table.rowManager.scrollTop,this.scrollLeft=this.table.rowManager.scrollLeft,this.data=this.getData(!0),this.element.classList.remove("tabulator-spreadsheet-tab-active")}load(){var e=!this.isActive;this.isActive=!0,this.table.blockRedraw(),this.table.setData([]),this.table.setColumns(this.columnDefs),this.table.setData(this.rowDefs),this.table.restoreRedraw(),e&&this.scrollTop!==null&&(this.table.rowManager.element.scrollLeft=this.scrollLeft,this.table.rowManager.element.scrollTop=this.scrollTop),this.element.classList.add("tabulator-spreadsheet-tab-active"),this.dispatchExternal("sheetLoaded",this.getComponent())}getComponent(){return new M1e(this)}getDefinition(){return{title:this.title,key:this.key,rows:this.rowCount,columns:this.columnCount,data:this.getData()}}getData(e){var i=[],n,r,a;return this.rowDefs.forEach(s=>{var o=[];this.columnFields.forEach(l=>{o.push(s[l])}),i.push(o)}),!e&&!this.options("spreadsheetOutputFull")&&(n=i.map(s=>s.findLastIndex(o=>typeof o<"u")+1),r=Math.max(...n),a=n.findLastIndex(s=>s>0)+1,i=i.slice(0,a),i=i.map(s=>s.slice(0,r))),i}setData(e){this.data=e,this.reinitialize(),this.dispatchExternal("sheetUpdated",this.getComponent()),this.isActive&&this.load()}clear(){this.setData([])}setTitle(e){this.title=e,this.element.innerText=e,this.dispatchExternal("sheetUpdated",this.getComponent())}setRows(e){this.rowCount=e,this.initializeRows(),this.dispatchExternal("sheetUpdated",this.getComponent()),this.isActive&&this.load()}setColumns(e){this.columnCount=e,this.reinitialize(),this.dispatchExternal("sheetUpdated",this.getComponent()),this.isActive&&this.load()}remove(){this.spreadsheetManager.removeSheet(this)}destroy(){this.element.parentNode&&this.element.parentNode.removeChild(this.element),this.dispatchExternal("sheetRemoved",this.getComponent())}active(){this.spreadsheetManager.loadSheet(this)}}class N1e extends qn{constructor(e){super(e),this.sheets=[],this.element=null,this.registerTableOption("spreadsheet",!1),this.registerTableOption("spreadsheetRows",50),this.registerTableOption("spreadsheetColumns",50),this.registerTableOption("spreadsheetColumnDefinition",{}),this.registerTableOption("spreadsheetOutputFull",!1),this.registerTableOption("spreadsheetData",!1),this.registerTableOption("spreadsheetSheets",!1),this.registerTableOption("spreadsheetSheetTabs",!1),this.registerTableOption("spreadsheetSheetTabsElement",!1),this.registerTableFunction("setSheets",this.setSheets.bind(this)),this.registerTableFunction("addSheet",this.addSheet.bind(this)),this.registerTableFunction("getSheets",this.getSheets.bind(this)),this.registerTableFunction("getSheetDefinitions",this.getSheetDefinitions.bind(this)),this.registerTableFunction("setSheetData",this.setSheetData.bind(this)),this.registerTableFunction("getSheet",this.getSheet.bind(this)),this.registerTableFunction("getSheetData",this.getSheetData.bind(this)),this.registerTableFunction("clearSheet",this.clearSheet.bind(this)),this.registerTableFunction("removeSheet",this.removeSheetFunc.bind(this)),this.registerTableFunction("activeSheet",this.activeSheetFunc.bind(this))}initialize(){this.options("spreadsheet")&&(this.subscribe("table-initialized",this.tableInitialized.bind(this)),this.subscribe("data-loaded",this.loadRemoteData.bind(this)),this.table.options.index="_id",this.options("spreadsheetData")&&this.options("spreadsheetSheets")&&(console.warn("You cannot use spreadsheetData and spreadsheetSheets at the same time, ignoring spreadsheetData"),this.table.options.spreadsheetData=!1),this.compatibilityCheck(),this.options("spreadsheetSheetTabs")&&this.initializeTabset())}compatibilityCheck(){this.options("data")&&console.warn("Do not use the data option when working with spreadsheets, use either spreadsheetData or spreadsheetSheets to pass data into the table"),this.options("pagination")&&console.warn("The spreadsheet module is not compatible with the pagination module"),this.options("groupBy")&&console.warn("The spreadsheet module is not compatible with the row grouping module"),this.options("responsiveCollapse")&&console.warn("The spreadsheet module is not compatible with the responsive collapse module")}initializeTabset(){this.element=document.createElement("div"),this.element.classList.add("tabulator-spreadsheet-tabs");var e=this.options("spreadsheetSheetTabsElement");e&&!(e instanceof HTMLElement)&&(e=document.querySelector(e),e||console.warn("Unable to find element matching spreadsheetSheetTabsElement selector:",this.options("spreadsheetSheetTabsElement"))),e?e.appendChild(this.element):this.footerAppend(this.element)}tableInitialized(){this.sheets.length?this.loadSheet(this.sheets[0]):this.options("spreadsheetSheets")?this.loadSheets(this.options("spreadsheetSheets")):this.options("spreadsheetData")&&this.loadData(this.options("spreadsheetData"))}loadRemoteData(e,i,n){return console.log("data",e,i,n),Array.isArray(e)?(this.table.dataLoader.clearAlert(),this.dispatchExternal("dataLoaded",e),!e.length||Array.isArray(e[0])?this.loadData(e):this.loadSheets(e)):console.error(`Spreadsheet Loading Error - Unable to process remote data due to invalid data type 
Expecting: array 
Received: `,typeof e,`
Data:     `,e),!1}loadData(e){var i={data:e};this.loadSheet(this.newSheet(i))}destroySheets(){this.sheets.forEach(e=>{e.destroy()}),this.sheets=[],this.activeSheet=null}loadSheets(e){Array.isArray(e)||(e=[]),this.destroySheets(),e.forEach(i=>{this.newSheet(i)}),this.loadSheet(this.sheets[0])}loadSheet(e){this.activeSheet!==e&&(this.activeSheet&&this.activeSheet.unload(),this.activeSheet=e,e.load())}newSheet(e={}){var i;return e.rows||(e.rows=this.options("spreadsheetRows")),e.columns||(e.columns=this.options("spreadsheetColumns")),i=new sQ(this,e),this.sheets.push(i),this.element&&this.element.appendChild(i.element),i}removeSheet(e){var i=this.sheets.indexOf(e),n;this.sheets.length>1?i>-1&&(this.sheets.splice(i,1),e.destroy(),this.activeSheet===e&&(n=this.sheets[i-1]||this.sheets[0],n?this.loadSheet(n):this.activeSheet=null)):console.warn("Unable to remove sheet, at least one sheet must be active")}lookupSheet(e){return e?e instanceof sQ?e:e instanceof M1e?e._sheet:this.sheets.find(i=>i.key===e)||!1:this.activeSheet}setSheets(e){return this.loadSheets(e),this.getSheets()}addSheet(e){return this.newSheet(e).getComponent()}getSheetDefinitions(){return this.sheets.map(e=>e.getDefinition())}getSheets(){return this.sheets.map(e=>e.getComponent())}getSheet(e){var i=this.lookupSheet(e);return i?i.getComponent():!1}setSheetData(e,i){e&&!i&&(i=e,e=!1);var n=this.lookupSheet(e);return n?n.setData(i):!1}getSheetData(e){var i=this.lookupSheet(e);return i?i.getData():!1}clearSheet(e){var i=this.lookupSheet(e);return i?i.clear():!1}removeSheetFunc(e){var i=this.lookupSheet(e);i&&this.removeSheet(i)}activeSheetFunc(e){var i=this.lookupSheet(e);return i?this.loadSheet(i):!1}}et(N1e,"moduleName","spreadsheet");var gV;let HJe=(gV=class extends qn{constructor(e){super(e),this.tooltipSubscriber=null,this.headerSubscriber=null,this.timeout=null,this.popupInstance=null,this.registerTableOption("tooltipDelay",300),this.registerColumnOption("tooltip"),this.registerColumnOption("headerTooltip")}initialize(){this.deprecatedOptionsCheck(),this.subscribe("column-init",this.initializeColumn.bind(this))}deprecatedOptionsCheck(){}initializeColumn(e){e.definition.headerTooltip&&!this.headerSubscriber&&(this.headerSubscriber=!0,this.subscribe("column-mousemove",this.mousemoveCheck.bind(this,"headerTooltip")),this.subscribe("column-mouseout",this.mouseoutCheck.bind(this,"headerTooltip"))),e.definition.tooltip&&!this.tooltipSubscriber&&(this.tooltipSubscriber=!0,this.subscribe("cell-mousemove",this.mousemoveCheck.bind(this,"tooltip")),this.subscribe("cell-mouseout",this.mouseoutCheck.bind(this,"tooltip")))}mousemoveCheck(e,i,n){var r=e==="tooltip"?n.column.definition.tooltip:n.definition.headerTooltip;r&&(this.clearPopup(),this.timeout=setTimeout(this.loadTooltip.bind(this,i,n,r),this.table.options.tooltipDelay))}mouseoutCheck(e,i,n){this.popupInstance||this.clearPopup()}clearPopup(e,i,n){clearTimeout(this.timeout),this.timeout=null,this.popupInstance&&this.popupInstance.hide()}loadTooltip(e,i,n){var r,a,s;function o(l){a=l}typeof n=="function"&&(n=n(e,i.getComponent(),o)),n instanceof HTMLElement?r=n:(r=document.createElement("div"),n===!0&&(i instanceof vM?n=i.value:i.definition.field?this.langBind("columns|"+i.definition.field,l=>{r.innerHTML=n=l||i.definition.title}):n=i.definition.title),r.innerHTML=n),(n||n===0||n===!1)&&(r.classList.add("tabulator-tooltip"),r.addEventListener("mousemove",l=>l.preventDefault()),this.popupInstance=this.popup(r),typeof a=="function"&&this.popupInstance.renderCallback(a),s=this.popupInstance.containerEventCoords(e),this.popupInstance.show(s.x+15,s.y+15).hideOnBlur(()=>{this.dispatchExternal("TooltipClosed",i.getComponent()),this.popupInstance=null}),this.dispatchExternal("TooltipOpened",i.getComponent()))}},et(gV,"moduleName","tooltip"),gV);var zJe={integer:function(t,e,i){return e===""||e===null||typeof e>"u"?!0:(e=Number(e),!isNaN(e)&&isFinite(e)&&Math.floor(e)===e)},float:function(t,e,i){return e===""||e===null||typeof e>"u"?!0:(e=Number(e),!isNaN(e)&&isFinite(e)&&e%1!==0)},numeric:function(t,e,i){return e===""||e===null||typeof e>"u"?!0:!isNaN(e)},string:function(t,e,i){return e===""||e===null||typeof e>"u"?!0:isNaN(e)},alphanumeric:function(t,e,i){if(e===""||e===null||typeof e>"u")return!0;var n=new RegExp(/^[a-z0-9]+$/i);return n.test(e)},max:function(t,e,i){return e===""||e===null||typeof e>"u"?!0:parseFloat(e)<=i},min:function(t,e,i){return e===""||e===null||typeof e>"u"?!0:parseFloat(e)>=i},starts:function(t,e,i){return e===""||e===null||typeof e>"u"?!0:String(e).toLowerCase().startsWith(String(i).toLowerCase())},ends:function(t,e,i){return e===""||e===null||typeof e>"u"?!0:String(e).toLowerCase().endsWith(String(i).toLowerCase())},minLength:function(t,e,i){return e===""||e===null||typeof e>"u"?!0:String(e).length>=i},maxLength:function(t,e,i){return e===""||e===null||typeof e>"u"?!0:String(e).length<=i},in:function(t,e,i){return e===""||e===null||typeof e>"u"?!0:(typeof i=="string"&&(i=i.split("|")),i.indexOf(e)>-1)},regex:function(t,e,i){if(e===""||e===null||typeof e>"u")return!0;var n=new RegExp(i);return n.test(e)},unique:function(t,e,i){if(e===""||e===null||typeof e>"u")return!0;var n=!0,r=t.getData(),a=t.getColumn()._getSelf();return this.table.rowManager.rows.forEach(function(s){var o=s.getData();o!==r&&e==a.getFieldValue(o)&&(n=!1)}),n},required:function(t,e,i){return e!==""&&e!==null&&typeof e<"u"}};const jD=class jD extends qn{constructor(e){super(e),this.invalidCells=[],this.registerTableOption("validationMode","blocking"),this.registerColumnOption("validator"),this.registerTableFunction("getInvalidCells",this.getInvalidCells.bind(this)),this.registerTableFunction("clearCellValidation",this.userClearCellValidation.bind(this)),this.registerTableFunction("validate",this.userValidate.bind(this)),this.registerComponentFunction("cell","isValid",this.cellIsValid.bind(this)),this.registerComponentFunction("cell","clearValidation",this.clearValidation.bind(this)),this.registerComponentFunction("cell","validate",this.cellValidate.bind(this)),this.registerComponentFunction("column","validate",this.columnValidate.bind(this)),this.registerComponentFunction("row","validate",this.rowValidate.bind(this))}initialize(){this.subscribe("cell-delete",this.clearValidation.bind(this)),this.subscribe("column-layout",this.initializeColumnCheck.bind(this)),this.subscribe("edit-success",this.editValidate.bind(this)),this.subscribe("edit-editor-clear",this.editorClear.bind(this)),this.subscribe("edit-edited-clear",this.editedClear.bind(this))}editValidate(e,i,n){var r=this.table.options.validationMode!=="manual"?this.validate(e.column.modules.validate,e,i):!0;return r!==!0&&setTimeout(()=>{e.getElement().classList.add("tabulator-validation-fail"),this.dispatchExternal("validationFailed",e.getComponent(),i,r)}),r}editorClear(e,i){i&&e.column.modules.validate&&this.cellValidate(e),e.getElement().classList.remove("tabulator-validation-fail")}editedClear(e){e.modules.validate&&(e.modules.validate.invalid=!1)}cellIsValid(e){return e.modules.validate&&e.modules.validate.invalid||!0}cellValidate(e){return this.validate(e.column.modules.validate,e,e.getValue())}columnValidate(e){var i=[];return e.cells.forEach(n=>{this.cellValidate(n)!==!0&&i.push(n.getComponent())}),i.length?i:!0}rowValidate(e){var i=[];return e.cells.forEach(n=>{this.cellValidate(n)!==!0&&i.push(n.getComponent())}),i.length?i:!0}userClearCellValidation(e){e||(e=this.getInvalidCells()),Array.isArray(e)||(e=[e]),e.forEach(i=>{this.clearValidation(i._getSelf())})}userValidate(e){var i=[];return this.table.rowManager.rows.forEach(n=>{n=n.getComponent();var r=n.validate();r!==!0&&(i=i.concat(r))}),i.length?i:!0}initializeColumnCheck(e){typeof e.definition.validator<"u"&&this.initializeColumn(e)}initializeColumn(e){var i=this,n=[],r;e.definition.validator&&(Array.isArray(e.definition.validator)?e.definition.validator.forEach(a=>{r=i._extractValidator(a),r&&n.push(r)}):(r=this._extractValidator(e.definition.validator),r&&n.push(r)),e.modules.validate=n.length?n:!1)}_extractValidator(e){var i,n,r;switch(typeof e){case"string":return r=e.indexOf(":"),r>-1?(i=e.substring(0,r),n=e.substring(r+1)):i=e,this._buildValidator(i,n);case"function":return this._buildValidator(e);case"object":return this._buildValidator(e.type,e.parameters)}}_buildValidator(e,i){var n=typeof e=="function"?e:jD.validators[e];return n?{type:typeof e=="function"?"function":e,func:n,params:i}:(console.warn("Validator Setup Error - No matching validator found:",e),!1)}validate(e,i,n){var r=this,a=[],s=this.invalidCells.indexOf(i);return e&&e.forEach(o=>{o.func.call(r,i.getComponent(),n,o.params)||a.push({type:o.type,parameters:o.params})}),i.modules.validate||(i.modules.validate={}),a.length?(i.modules.validate.invalid=a,this.table.options.validationMode!=="manual"&&i.getElement().classList.add("tabulator-validation-fail"),s==-1&&this.invalidCells.push(i)):(i.modules.validate.invalid=!1,i.getElement().classList.remove("tabulator-validation-fail"),s>-1&&this.invalidCells.splice(s,1)),a.length?a:!0}getInvalidCells(){var e=[];return this.invalidCells.forEach(i=>{e.push(i.getComponent())}),e}clearValidation(e){var i;e.modules.validate&&e.modules.validate.invalid&&(e.getElement().classList.remove("tabulator-validation-fail"),e.modules.validate.invalid=!1,i=this.invalidCells.indexOf(e),i>-1&&this.invalidCells.splice(i,1))}};et(jD,"moduleName","validate"),et(jD,"validators",zJe);let XG=jD;var cB=Object.freeze({__proto__:null,AccessorModule:AG,AjaxModule:xG,ClipboardModule:sXe,ColumnCalcsModule:OG,DataTreeModule:v1e,DownloadModule:LG,EditModule:FG,ExportModule:$G,FilterModule:BG,FormatModule:VG,FrozenColumnsModule:y1e,FrozenRowsModule:b1e,GroupRowsModule:I1e,HistoryModule:rJe,HtmlTableImportModule:w1e,ImportModule:jG,InteractionModule:S1e,KeybindingsModule:GG,MenuModule:T1e,MoveColumnsModule:U1e,MoveRowsModule:HG,MutatorModule:zG,PageModule:qG,PersistenceModule:WG,PopupModule:IJe,PrintModule:D1e,ReactiveDataModule:E1e,ResizeColumnsModule:P1e,ResizeRowsModule:C1e,ResizeTableModule:R1e,ResponsiveLayoutModule:YG,SelectRangeModule:mA,SelectRowModule:KG,SortModule:ZG,SpreadsheetModule:N1e,TooltipModule:HJe,ValidateModule:XG}),qJe={debugEventsExternal:!1,debugEventsInternal:!1,debugInvalidOptions:!0,debugInvalidComponentFuncs:!0,debugInitialization:!0,debugDeprecation:!0,height:!1,minHeight:!1,maxHeight:!1,columnHeaderVertAlign:"top",popupContainer:!1,columns:[],columnDefaults:{},rowHeader:!1,data:!1,autoColumns:!1,autoColumnsDefinitions:!1,nestedFieldSeparator:".",footerElement:!1,index:"id",textDirection:"auto",addRowPos:"bottom",headerVisible:!0,renderVertical:"virtual",renderHorizontal:"basic",renderVerticalBuffer:0,scrollToRowPosition:"top",scrollToRowIfVisible:!0,scrollToColumnPosition:"left",scrollToColumnIfVisible:!0,rowFormatter:!1,rowFormatterPrint:null,rowFormatterClipboard:null,rowFormatterHtmlOutput:null,rowHeight:null,placeholder:!1,dataLoader:!0,dataLoaderLoading:!1,dataLoaderError:!1,dataLoaderErrorTimeout:3e3,dataSendParams:{},dataReceiveParams:{}};class A1e{constructor(e,i,n={}){this.table=e,this.msgType=i,this.registeredDefaults=Object.assign({},n)}register(e,i){this.registeredDefaults[e]=i}generate(e,i={}){var n=Object.assign({},this.registeredDefaults),r=this.table.options.debugInvalidOptions||i.debugInvalidOptions===!0;Object.assign(n,e);for(let a in i)n.hasOwnProperty(a)||(r&&console.warn("Invalid "+this.msgType+" option:",a),n[a]=i.key);for(let a in n)a in i?n[a]=i[a]:Array.isArray(n[a])?n[a]=Object.assign([],n[a]):typeof n[a]=="object"&&n[a]!==null?n[a]=Object.assign({},n[a]):typeof n[a]>"u"&&delete n[a];return n}}class P2 extends bc{constructor(e){super(e),this.elementVertical=e.rowManager.element,this.elementHorizontal=e.columnManager.element,this.tableElement=e.rowManager.tableElement,this.verticalFillMode="fit"}initialize(){}clearRows(){}clearColumns(){}reinitializeColumnWidths(e){}renderRows(){}renderColumns(){}rerenderRows(e){e&&e()}rerenderColumns(e,i){}renderRowCells(e){}rerenderRowCells(e,i){}scrollColumns(e,i){}scrollRows(e,i){}resize(){}scrollToRow(e){}scrollToRowNearestTop(e){}visibleRows(e){return[]}rows(){return this.table.rowManager.getDisplayRows()}styleRow(e,i){var n=e.getElement();i%2?(n.classList.add("tabulator-row-even"),n.classList.remove("tabulator-row-odd")):(n.classList.add("tabulator-row-odd"),n.classList.remove("tabulator-row-even"))}clear(){this.clearRows(),this.clearColumns()}render(){this.renderRows(),this.renderColumns()}rerender(e){this.rerenderRows(),this.rerenderColumns()}scrollToRowPosition(e,i,n){var r=this.rows().indexOf(e),a=e.getElement(),s=0;return new Promise((o,l)=>{if(r>-1){if(typeof n>"u"&&(n=this.table.options.scrollToRowIfVisible),!n&&Ha.elVisible(a)&&(s=Ha.elOffset(a).top-Ha.elOffset(this.elementVertical).top,s>0&&s<this.elementVertical.clientHeight-a.offsetHeight))return o(),!1;switch(typeof i>"u"&&(i=this.table.options.scrollToRowPosition),i==="nearest"&&(i=this.scrollToRowNearestTop(e)?"top":"bottom"),this.scrollToRow(e),i){case"middle":case"center":this.elementVertical.scrollHeight-this.elementVertical.scrollTop==this.elementVertical.clientHeight?this.elementVertical.scrollTop=this.elementVertical.scrollTop+(a.offsetTop-this.elementVertical.scrollTop)-(this.elementVertical.scrollHeight-a.offsetTop)/2:this.elementVertical.scrollTop=this.elementVertical.scrollTop-this.elementVertical.clientHeight/2;break;case"bottom":this.elementVertical.scrollHeight-this.elementVertical.scrollTop==this.elementVertical.clientHeight?this.elementVertical.scrollTop=this.elementVertical.scrollTop-(this.elementVertical.scrollHeight-a.offsetTop)+a.offsetHeight:this.elementVertical.scrollTop=this.elementVertical.scrollTop-this.elementVertical.clientHeight+a.offsetHeight;break;case"top":this.elementVertical.scrollTop=a.offsetTop;break}o()}else console.warn("Scroll Error - Row not visible"),l("Scroll Error - Row not visible")})}}class WJe extends P2{constructor(e){super(e)}renderRowCells(e,i){const n=document.createDocumentFragment();e.cells.forEach(r=>{n.appendChild(r.getElement())}),e.element.appendChild(n),i||e.cells.forEach(r=>{r.cellRendered()})}reinitializeColumnWidths(e){e.forEach(function(i){i.reinitializeWidth()})}}class YJe extends P2{constructor(e){super(e),this.leftCol=0,this.rightCol=0,this.scrollLeft=0,this.vDomScrollPosLeft=0,this.vDomScrollPosRight=0,this.vDomPadLeft=0,this.vDomPadRight=0,this.fitDataColAvg=0,this.windowBuffer=200,this.visibleRows=null,this.initialized=!1,this.isFitData=!1,this.columns=[]}initialize(){this.compatibilityCheck(),this.layoutCheck(),this.vertScrollListen()}compatibilityCheck(){this.options("layout")=="fitDataTable"&&console.warn("Horizontal Virtual DOM is not compatible with fitDataTable layout mode"),this.options("responsiveLayout")&&console.warn("Horizontal Virtual DOM is not compatible with responsive columns"),this.options("rtl")&&console.warn("Horizontal Virtual DOM is not currently compatible with RTL text direction")}layoutCheck(){this.isFitData=this.options("layout").startsWith("fitData")}vertScrollListen(){this.subscribe("scroll-vertical",this.clearVisRowCache.bind(this)),this.subscribe("data-refreshed",this.clearVisRowCache.bind(this))}clearVisRowCache(){this.visibleRows=null}renderColumns(e,i){this.dataChange()}scrollColumns(e,i){this.scrollLeft!=e&&(this.scrollLeft=e,this.scroll(e-(this.vDomScrollPosLeft+this.windowBuffer)))}calcWindowBuffer(){var e=this.elementVertical.clientWidth;this.table.columnManager.columnsByIndex.forEach(i=>{if(i.visible){var n=i.getWidth();n>e&&(e=n)}}),this.windowBuffer=e*2}rerenderColumns(e,i){var n={cols:this.columns,leftCol:this.leftCol,rightCol:this.rightCol},r=0;e&&!this.initialized||(this.clear(),this.calcWindowBuffer(),this.scrollLeft=this.elementVertical.scrollLeft,this.vDomScrollPosLeft=this.scrollLeft-this.windowBuffer,this.vDomScrollPosRight=this.scrollLeft+this.elementVertical.clientWidth+this.windowBuffer,this.table.columnManager.columnsByIndex.forEach(a=>{var s={},o;a.visible&&(a.modules.frozen||(o=a.getWidth(),s.leftPos=r,s.rightPos=r+o,s.width=o,this.isFitData&&(s.fitDataCheck=a.modules.vdomHoz?a.modules.vdomHoz.fitDataCheck:!0),r+o>this.vDomScrollPosLeft&&r<this.vDomScrollPosRight?(this.leftCol==-1&&(this.leftCol=this.columns.length,this.vDomPadLeft=r),this.rightCol=this.columns.length):this.leftCol!==-1&&(this.vDomPadRight+=o),this.columns.push(a),a.modules.vdomHoz=s,r+=o))}),this.tableElement.style.paddingLeft=this.vDomPadLeft+"px",this.tableElement.style.paddingRight=this.vDomPadRight+"px",this.initialized=!0,i||(!e||this.reinitChanged(n))&&this.reinitializeRows(),this.elementVertical.scrollLeft=this.scrollLeft)}renderRowCells(e){if(this.initialized)this.initializeRow(e);else{const i=document.createDocumentFragment();e.cells.forEach(n=>{i.appendChild(n.getElement())}),e.element.appendChild(i),e.cells.forEach(n=>{n.cellRendered()})}}rerenderRowCells(e,i){this.reinitializeRow(e,i)}reinitializeColumnWidths(e){for(let i=this.leftCol;i<=this.rightCol;i++)this.columns[i].reinitializeWidth()}deinitialize(){this.initialized=!1}clear(){this.columns=[],this.leftCol=-1,this.rightCol=0,this.vDomScrollPosLeft=0,this.vDomScrollPosRight=0,this.vDomPadLeft=0,this.vDomPadRight=0}dataChange(){var e=!1,i,n;if(this.isFitData){if(this.table.columnManager.columnsByIndex.forEach(r=>{!r.definition.width&&r.visible&&(e=!0)}),e&&this.table.rowManager.getDisplayRows().length&&(this.vDomScrollPosRight=this.scrollLeft+this.elementVertical.clientWidth+this.windowBuffer,i=this.chain("rows-sample",[1],[],()=>this.table.rowManager.getDisplayRows())[0],i)){n=i.getElement(),i.generateCells(),this.tableElement.appendChild(n);for(let r=0;r<i.cells.length;r++){let a=i.cells[r];n.appendChild(a.getElement()),a.column.reinitializeWidth()}n.parentNode.removeChild(n),this.rerenderColumns(!1,!0)}}else this.options("layout")==="fitColumns"&&(this.layoutRefresh(),this.rerenderColumns(!1,!0))}reinitChanged(e){var i=!0;return e.cols.length!==this.columns.length||e.leftCol!==this.leftCol||e.rightCol!==this.rightCol?!0:(e.cols.forEach((n,r)=>{n!==this.columns[r]&&(i=!1)}),!i)}reinitializeRows(){var e=this.getVisibleRows(),i=this.table.rowManager.getRows().filter(n=>!e.includes(n));e.forEach(n=>{this.reinitializeRow(n,!0)}),i.forEach(n=>{n.deinitialize()})}getVisibleRows(){return this.visibleRows||(this.visibleRows=this.table.rowManager.getVisibleRows()),this.visibleRows}scroll(e){this.vDomScrollPosLeft+=e,this.vDomScrollPosRight+=e,Math.abs(e)>this.windowBuffer/2?this.rerenderColumns():e>0?(this.addColRight(),this.removeColLeft()):(this.addColLeft(),this.removeColRight())}colPositionAdjust(e,i,n){for(let r=e;r<i;r++){let a=this.columns[r];a.modules.vdomHoz.leftPos+=n,a.modules.vdomHoz.rightPos+=n}}addColRight(){for(var e=!1,i=!0;i;){let n=this.columns[this.rightCol+1];n&&n.modules.vdomHoz.leftPos<=this.vDomScrollPosRight?(e=!0,this.getVisibleRows().forEach(r=>{if(r.type!=="group"){var a=r.getCell(n);r.getElement().insertBefore(a.getElement(),r.getCell(this.columns[this.rightCol]).getElement().nextSibling),a.cellRendered()}}),this.fitDataColActualWidthCheck(n),this.rightCol++,this.getVisibleRows().forEach(r=>{r.type!=="group"&&(r.modules.vdomHoz.rightCol=this.rightCol)}),this.rightCol>=this.columns.length-1?this.vDomPadRight=0:this.vDomPadRight-=n.getWidth()):i=!1}e&&(this.tableElement.style.paddingRight=this.vDomPadRight+"px")}addColLeft(){for(var e=!1,i=!0;i;){let n=this.columns[this.leftCol-1];if(n)if(n.modules.vdomHoz.rightPos>=this.vDomScrollPosLeft){e=!0,this.getVisibleRows().forEach(a=>{if(a.type!=="group"){var s=a.getCell(n);a.getElement().insertBefore(s.getElement(),a.getCell(this.columns[this.leftCol]).getElement()),s.cellRendered()}}),this.leftCol--,this.getVisibleRows().forEach(a=>{a.type!=="group"&&(a.modules.vdomHoz.leftCol=this.leftCol)}),this.leftCol<=0?this.vDomPadLeft=0:this.vDomPadLeft-=n.getWidth();let r=this.fitDataColActualWidthCheck(n);r&&(this.scrollLeft=this.elementVertical.scrollLeft=this.elementVertical.scrollLeft+r,this.vDomPadRight-=r)}else i=!1;else i=!1}e&&(this.tableElement.style.paddingLeft=this.vDomPadLeft+"px")}removeColRight(){for(var e=!1,i=!0;i;){let n=this.columns[this.rightCol];n&&n.modules.vdomHoz.leftPos>this.vDomScrollPosRight?(e=!0,this.getVisibleRows().forEach(r=>{if(r.type!=="group"){var a=r.getCell(n);try{r.getElement().removeChild(a.getElement())}catch(s){console.warn("Could not removeColRight",s.message)}}}),this.vDomPadRight+=n.getWidth(),this.rightCol--,this.getVisibleRows().forEach(r=>{r.type!=="group"&&(r.modules.vdomHoz.rightCol=this.rightCol)})):i=!1}e&&(this.tableElement.style.paddingRight=this.vDomPadRight+"px")}removeColLeft(){for(var e=!1,i=!0;i;){let n=this.columns[this.leftCol];n&&n.modules.vdomHoz.rightPos<this.vDomScrollPosLeft?(e=!0,this.getVisibleRows().forEach(r=>{if(r.type!=="group"){var a=r.getCell(n);try{r.getElement().removeChild(a.getElement())}catch(s){console.warn("Could not removeColLeft",s.message)}}}),this.vDomPadLeft+=n.getWidth(),this.leftCol++,this.getVisibleRows().forEach(r=>{r.type!=="group"&&(r.modules.vdomHoz.leftCol=this.leftCol)})):i=!1}e&&(this.tableElement.style.paddingLeft=this.vDomPadLeft+"px")}fitDataColActualWidthCheck(e){var i,n;return e.modules.vdomHoz.fitDataCheck&&(e.reinitializeWidth(),i=e.getWidth(),n=i-e.modules.vdomHoz.width,n&&(e.modules.vdomHoz.rightPos+=n,e.modules.vdomHoz.width=i,this.colPositionAdjust(this.columns.indexOf(e)+1,this.columns.length,n)),e.modules.vdomHoz.fitDataCheck=!1),n}initializeRow(e){if(e.type!=="group"){e.modules.vdomHoz={leftCol:this.leftCol,rightCol:this.rightCol},this.table.modules.frozenColumns&&this.table.modules.frozenColumns.leftColumns.forEach(i=>{this.appendCell(e,i)});for(let i=this.leftCol;i<=this.rightCol;i++)this.appendCell(e,this.columns[i]);this.table.modules.frozenColumns&&this.table.modules.frozenColumns.rightColumns.forEach(i=>{this.appendCell(e,i)})}}appendCell(e,i){if(i&&i.visible){let n=e.getCell(i);e.getElement().appendChild(n.getElement()),n.cellRendered()}}reinitializeRow(e,i){if(e.type!=="group"&&(i||!e.modules.vdomHoz||e.modules.vdomHoz.leftCol!==this.leftCol||e.modules.vdomHoz.rightCol!==this.rightCol)){for(var n=e.getElement();n.firstChild;)n.removeChild(n.firstChild);this.initializeRow(e)}}}class KJe extends bc{constructor(e){super(e),this.blockHozScrollEvent=!1,this.headersElement=null,this.contentsElement=null,this.rowHeader=null,this.element=null,this.columns=[],this.columnsByIndex=[],this.columnsByField={},this.scrollLeft=0,this.optionsList=new A1e(this.table,"column definition",g1e),this.redrawBlock=!1,this.redrawBlockUpdate=null,this.renderer=null}initialize(){this.initializeRenderer(),this.headersElement=this.createHeadersElement(),this.contentsElement=this.createHeaderContentsElement(),this.element=this.createHeaderElement(),this.contentsElement.insertBefore(this.headersElement,this.contentsElement.firstChild),this.element.insertBefore(this.contentsElement,this.element.firstChild),this.initializeScrollWheelWatcher(),this.subscribe("scroll-horizontal",this.scrollHorizontal.bind(this)),this.subscribe("scrollbar-vertical",this.padVerticalScrollbar.bind(this))}padVerticalScrollbar(e){this.table.rtl?this.headersElement.style.marginLeft=e+"px":this.headersElement.style.marginRight=e+"px"}initializeRenderer(){var e,i={virtual:YJe,basic:WJe};typeof this.table.options.renderHorizontal=="string"?e=i[this.table.options.renderHorizontal]:e=this.table.options.renderHorizontal,e?(this.renderer=new e(this.table,this.element,this.tableElement),this.renderer.initialize()):console.error("Unable to find matching renderer:",this.table.options.renderHorizontal)}createHeadersElement(){var e=document.createElement("div");return e.classList.add("tabulator-headers"),e.setAttribute("role","row"),e}createHeaderContentsElement(){var e=document.createElement("div");return e.classList.add("tabulator-header-contents"),e.setAttribute("role","rowgroup"),e}createHeaderElement(){var e=document.createElement("div");return e.classList.add("tabulator-header"),e.setAttribute("role","rowgroup"),this.table.options.headerVisible||e.classList.add("tabulator-header-hidden"),e}getElement(){return this.element}getContentsElement(){return this.contentsElement}getHeadersElement(){return this.headersElement}scrollHorizontal(e){this.contentsElement.scrollLeft=e,this.scrollLeft=e,this.renderer.scrollColumns(e)}initializeScrollWheelWatcher(){this.contentsElement.addEventListener("wheel",e=>{var i;e.deltaX&&(i=this.contentsElement.scrollLeft+e.deltaX,this.table.rowManager.scrollHorizontal(i),this.table.columnManager.scrollHorizontal(i))})}generateColumnsFromRowData(e){var i=[],n={},r=this.table.options.autoColumns==="full"?e:[e[0]],a=this.table.options.autoColumnsDefinitions;if(e&&e.length){if(r.forEach(s=>{Object.keys(s).forEach((o,l)=>{let c=s[o],u;n[o]?n[o]!==!0&&typeof c<"u"&&(n[o].sorter=this.calculateSorterFromValue(c),n[o]=!0):(u={field:o,title:o,sorter:this.calculateSorterFromValue(c)},i.splice(l,0,u),n[o]=typeof c>"u"?u:!0)})}),a)switch(typeof a){case"function":this.table.options.columns=a.call(this.table,i);break;case"object":Array.isArray(a)?i.forEach(s=>{var o=a.find(l=>l.field===s.field);o&&Object.assign(s,o)}):i.forEach(s=>{a[s.field]&&Object.assign(s,a[s.field])}),this.table.options.columns=i;break}else this.table.options.columns=i;this.setColumns(this.table.options.columns)}}calculateSorterFromValue(e){var i;switch(typeof e){case"undefined":i="string";break;case"boolean":i="boolean";break;case"number":i="number";break;case"object":Array.isArray(e)?i="array":i="string";break;default:!isNaN(e)&&e!==""?i="number":e.match(/((^[0-9]+[a-z]+)|(^[a-z]+[0-9]+))+$/i)?i="alphanum":i="string";break}return i}setColumns(e,i){for(;this.headersElement.firstChild;)this.headersElement.removeChild(this.headersElement.firstChild);this.columns=[],this.columnsByIndex=[],this.columnsByField={},this.dispatch("columns-loading"),this.dispatchExternal("columnsLoading"),this.table.options.rowHeader&&(this.rowHeader=new iI(this.table.options.rowHeader===!0?{}:this.table.options.rowHeader,this,!0),this.columns.push(this.rowHeader),this.headersElement.appendChild(this.rowHeader.getElement()),this.rowHeader.columnRendered()),e.forEach((n,r)=>{this._addColumn(n)}),this._reIndexColumns(),this.dispatch("columns-loaded"),this.subscribedExternal("columnsLoaded")&&this.dispatchExternal("columnsLoaded",this.getComponents()),this.rerenderColumns(!1,!0),this.redraw(!0)}_addColumn(e,i,n){var r=new iI(e,this),a=r.getElement(),s=n&&this.findColumnIndex(n);if(i&&this.rowHeader&&(!n||n===this.rowHeader)&&(i=!1,n=this.rowHeader,s=0),n&&s>-1){var o=n.getTopColumn(),l=this.columns.indexOf(o),c=o.getElement();i?(this.columns.splice(l,0,r),c.parentNode.insertBefore(a,c)):(this.columns.splice(l+1,0,r),c.parentNode.insertBefore(a,c.nextSibling))}else i?(this.columns.unshift(r),this.headersElement.insertBefore(r.getElement(),this.headersElement.firstChild)):(this.columns.push(r),this.headersElement.appendChild(r.getElement()));return r.columnRendered(),r}registerColumnField(e){e.definition.field&&(this.columnsByField[e.definition.field]=e)}registerColumnPosition(e){this.columnsByIndex.push(e)}_reIndexColumns(){this.columnsByIndex=[],this.columns.forEach(function(e){e.reRegisterPosition()})}verticalAlignHeaders(){var e=0;this.redrawBlock||(this.headersElement.style.height="",this.columns.forEach(i=>{i.clearVerticalAlign()}),this.columns.forEach(i=>{var n=i.getHeight();n>e&&(e=n)}),this.headersElement.style.height=e+"px",this.columns.forEach(i=>{i.verticalAlign(this.table.options.columnHeaderVertAlign,e)}),this.table.rowManager.adjustTableSize())}findColumn(e){var i;if(typeof e=="object"){if(e instanceof iI)return e;if(e instanceof m1e)return e._getSelf()||!1;if(typeof HTMLElement<"u"&&e instanceof HTMLElement)return i=[],this.columns.forEach(r=>{i.push(r),i=i.concat(r.getColumns(!0))}),i.find(r=>r.element===e)||!1}else return this.columnsByField[e]||!1;return!1}getColumnByField(e){return this.columnsByField[e]}getColumnsByFieldRoot(e){var i=[];return Object.keys(this.columnsByField).forEach(n=>{var r=this.table.options.nestedFieldSeparator?n.split(this.table.options.nestedFieldSeparator)[0]:n;r===e&&i.push(this.columnsByField[n])}),i}getColumnByIndex(e){return this.columnsByIndex[e]}getFirstVisibleColumn(){var e=this.columnsByIndex.findIndex(i=>i.visible);return e>-1?this.columnsByIndex[e]:!1}getVisibleColumnsByIndex(){return this.columnsByIndex.filter(e=>e.visible)}getColumns(){return this.columns}findColumnIndex(e){return this.columnsByIndex.findIndex(i=>e===i)}getRealColumns(){return this.columnsByIndex}traverse(e){this.columnsByIndex.forEach((i,n)=>{e(i,n)})}getDefinitions(e){var i=[];return this.columnsByIndex.forEach(n=>{(!e||e&&n.visible)&&i.push(n.getDefinition())}),i}getDefinitionTree(){var e=[];return this.columns.forEach(i=>{e.push(i.getDefinition(!0))}),e}getComponents(e){var i=[],n=e?this.columns:this.columnsByIndex;return n.forEach(r=>{i.push(r.getComponent())}),i}getWidth(){var e=0;return this.columnsByIndex.forEach(i=>{i.visible&&(e+=i.getWidth())}),e}moveColumn(e,i,n){i.element.parentNode.insertBefore(e.element,i.element),n&&i.element.parentNode.insertBefore(i.element,e.element),this.moveColumnActual(e,i,n),this.verticalAlignHeaders(),this.table.rowManager.reinitialize()}moveColumnActual(e,i,n){e.parent.isGroup?this._moveColumnInArray(e.parent.columns,e,i,n):this._moveColumnInArray(this.columns,e,i,n),this._moveColumnInArray(this.columnsByIndex,e,i,n,!0),this.rerenderColumns(!0),this.dispatch("column-moved",e,i,n),this.subscribedExternal("columnMoved")&&this.dispatchExternal("columnMoved",e.getComponent(),this.table.columnManager.getComponents())}_moveColumnInArray(e,i,n,r,a){var s=e.indexOf(i),o,l=[];s>-1&&(e.splice(s,1),o=e.indexOf(n),o>-1?r&&(o=o+1):o=s,e.splice(o,0,i),a&&(l=this.chain("column-moving-rows",[i,n,r],null,[])||[],l=l.concat(this.table.rowManager.rows),l.forEach(function(c){if(c.cells.length){var u=c.cells.splice(s,1)[0];c.cells.splice(o,0,u)}})))}scrollToColumn(e,i,n){var r=0,a=e.getLeftOffset(),s=0,o=e.getElement();return new Promise((l,c)=>{if(typeof i>"u"&&(i=this.table.options.scrollToColumnPosition),typeof n>"u"&&(n=this.table.options.scrollToColumnIfVisible),e.visible){switch(i){case"middle":case"center":s=-this.element.clientWidth/2;break;case"right":s=o.clientWidth-this.headersElement.clientWidth;break}if(!n&&a>0&&a+o.offsetWidth<this.element.clientWidth)return!1;r=a+s,r=Math.max(Math.min(r,this.table.rowManager.element.scrollWidth-this.table.rowManager.element.clientWidth),0),this.table.rowManager.scrollHorizontal(r),this.scrollHorizontal(r),l()}else console.warn("Scroll Error - Column not visible"),c("Scroll Error - Column not visible")})}generateCells(e){var i=[];return this.columnsByIndex.forEach(n=>{i.push(n.generateCell(e))}),i}getFlexBaseWidth(){var e=this.table.element.clientWidth,i=0;return this.table.rowManager.element.scrollHeight>this.table.rowManager.element.clientHeight&&(e-=this.table.rowManager.element.offsetWidth-this.table.rowManager.element.clientWidth),this.columnsByIndex.forEach(function(n){var r,a,s;n.visible&&(r=n.definition.width||0,a=parseInt(n.minWidth),typeof r=="string"?r.indexOf("%")>-1?s=e/100*parseInt(r):s=parseInt(r):s=r,i+=s>a?s:a)}),i}addColumn(e,i,n){return new Promise((r,a)=>{var s=this._addColumn(e,i,n);this._reIndexColumns(),this.dispatch("column-add",e,i,n),this.layoutMode()!="fitColumns"&&s.reinitializeWidth(),this.redraw(!0),this.table.rowManager.reinitialize(),this.rerenderColumns(),r(s)})}deregisterColumn(e){var i=e.getField(),n;i&&delete this.columnsByField[i],n=this.columnsByIndex.indexOf(e),n>-1&&this.columnsByIndex.splice(n,1),n=this.columns.indexOf(e),n>-1&&this.columns.splice(n,1),this.verticalAlignHeaders(),this.redraw()}rerenderColumns(e,i){this.redrawBlock?(e===!1||e===!0&&this.redrawBlockUpdate===null)&&(this.redrawBlockUpdate=e):this.renderer.rerenderColumns(e,i)}blockRedraw(){this.redrawBlock=!0,this.redrawBlockUpdate=null}restoreRedraw(){this.redrawBlock=!1,this.verticalAlignHeaders(),this.renderer.rerenderColumns(this.redrawBlockUpdate)}redraw(e){Ha.elVisible(this.element)&&this.verticalAlignHeaders(),e&&(this.table.rowManager.resetScroll(),this.table.rowManager.reinitialize()),this.confirm("table-redrawing",e)||this.layoutRefresh(e),this.dispatch("table-redraw",e),this.table.footerManager.redraw()}}class ZJe extends P2{constructor(e){super(e),this.verticalFillMode="fill",this.scrollTop=0,this.scrollLeft=0,this.scrollTop=0,this.scrollLeft=0}clearRows(){for(var e=this.tableElement;e.firstChild;)e.removeChild(e.firstChild);e.scrollTop=0,e.scrollLeft=0,e.style.minWidth="",e.style.minHeight="",e.style.display="",e.style.visibility=""}renderRows(){var e=this.tableElement,i=!0,n=document.createDocumentFragment(),r=this.rows();r.forEach((a,s)=>{this.styleRow(a,s),a.initialize(!1,!0),a.type!=="group"&&(i=!1),n.appendChild(a.getElement())}),e.appendChild(n),r.forEach(a=>{a.rendered(),a.heightInitialized||a.calcHeight(!0)}),r.forEach(a=>{a.heightInitialized||a.setCellHeight()}),i?e.style.minWidth=this.table.columnManager.getWidth()+"px":e.style.minWidth=""}rerenderRows(e){this.clearRows(),e&&e(),this.renderRows(),this.rows().length||this.table.rowManager.tableEmpty()}scrollToRowNearestTop(e){var i=Ha.elOffset(e.getElement()).top;return!(Math.abs(this.elementVertical.scrollTop-i)>Math.abs(this.elementVertical.scrollTop+this.elementVertical.clientHeight-i))}scrollToRow(e){var i=e.getElement();this.elementVertical.scrollTop=Ha.elOffset(i).top-Ha.elOffset(this.elementVertical).top+this.elementVertical.scrollTop}visibleRows(e){return this.rows()}}class XJe extends P2{constructor(e){super(e),this.verticalFillMode="fill",this.scrollTop=0,this.scrollLeft=0,this.vDomRowHeight=20,this.vDomTop=0,this.vDomBottom=0,this.vDomScrollPosTop=0,this.vDomScrollPosBottom=0,this.vDomTopPad=0,this.vDomBottomPad=0,this.vDomMaxRenderChain=90,this.vDomWindowBuffer=0,this.vDomWindowMinTotalRows=20,this.vDomWindowMinMarginRows=5,this.vDomTopNewRows=[],this.vDomBottomNewRows=[]}clearRows(){for(var e=this.tableElement;e.firstChild;)e.removeChild(e.firstChild);e.style.paddingTop="",e.style.paddingBottom="",e.style.minHeight="",e.style.display="",e.style.visibility="",this.elementVertical.scrollTop=0,this.elementVertical.scrollLeft=0,this.scrollTop=0,this.scrollLeft=0,this.vDomTop=0,this.vDomBottom=0,this.vDomTopPad=0,this.vDomBottomPad=0,this.vDomScrollPosTop=0,this.vDomScrollPosBottom=0}renderRows(){this._virtualRenderFill()}rerenderRows(e){for(var i=this.elementVertical.scrollTop,n=!1,r=!1,a=this.table.rowManager.scrollLeft,s=this.rows(),o=this.vDomTop;o<=this.vDomBottom;o++)if(s[o]){var l=i-s[o].getElement().offsetTop;if(r===!1||Math.abs(l)<r)r=l,n=o;else break}s.forEach(c=>{c.deinitializeHeight()}),e&&e(),this.rows().length?this._virtualRenderFill(n===!1?this.rows.length-1:n,!0,r||0):(this.clear(),this.table.rowManager.tableEmpty()),this.scrollColumns(a)}scrollColumns(e){this.table.rowManager.scrollHorizontal(e)}scrollRows(e,i){var n=e-this.vDomScrollPosTop,r=e-this.vDomScrollPosBottom,a=this.vDomWindowBuffer*2,s=this.rows();if(this.scrollTop=e,-n>a||r>a){var o=this.table.rowManager.scrollLeft;this._virtualRenderFill(Math.floor(this.elementVertical.scrollTop/this.elementVertical.scrollHeight*s.length)),this.scrollColumns(o)}else i?(n<0&&this._addTopRow(s,-n),r<0&&(this.vDomScrollHeight-this.scrollTop>this.vDomWindowBuffer?this._removeBottomRow(s,-r):this.vDomScrollPosBottom=this.scrollTop)):(r>=0&&this._addBottomRow(s,r),n>=0&&(this.scrollTop>this.vDomWindowBuffer?this._removeTopRow(s,n):this.vDomScrollPosTop=this.scrollTop))}resize(){this.vDomWindowBuffer=this.table.options.renderVerticalBuffer||this.elementVertical.clientHeight}scrollToRowNearestTop(e){var i=this.rows().indexOf(e);return!(Math.abs(this.vDomTop-i)>Math.abs(this.vDomBottom-i))}scrollToRow(e){var i=this.rows().indexOf(e);i>-1&&this._virtualRenderFill(i,!0)}visibleRows(e){var i=this.elementVertical.scrollTop,n=this.elementVertical.clientHeight+i,r=!1,a=0,s=0,o=this.rows();if(e)a=this.vDomTop,s=this.vDomBottom;else for(var l=this.vDomTop;l<=this.vDomBottom;l++)if(o[l])if(r)if(n-o[l].getElement().offsetTop>=0)s=l;else break;else if(i-o[l].getElement().offsetTop>=0)a=l;else if(r=!0,n-o[l].getElement().offsetTop>=0)s=l;else break;return o.slice(a,s+1)}_virtualRenderFill(e,i,n){var r=this.tableElement,a=this.elementVertical,s=0,o=0,l=0,c=0,u=0,d=0,p=this.rows(),h=p.length,f=0,m,g,v=[],y=0,b=0,I=this.table.rowManager.fixedHeight,T=this.elementVertical.clientHeight,w=this.table.options.rowHeight,S=!0;if(e=e||0,n=n||0,!e)this.clear();else{for(;r.firstChild;)r.removeChild(r.firstChild);c=(h-e+1)*this.vDomRowHeight,c<T&&(e-=Math.ceil((T-c)/this.vDomRowHeight),e<0&&(e=0)),s=Math.min(Math.max(Math.floor(this.vDomWindowBuffer/this.vDomRowHeight),this.vDomWindowMinMarginRows),e),e-=s}if(h&&Ha.elVisible(this.elementVertical)){for(this.vDomTop=e,this.vDomBottom=e-1,I||this.table.options.maxHeight?(w&&(b=T/w+this.vDomWindowBuffer/w),b=Math.max(this.vDomWindowMinTotalRows,Math.ceil(b))):b=h;(b==h||o<=T+this.vDomWindowBuffer||y<this.vDomWindowMinTotalRows)&&this.vDomBottom<h-1;){for(v=[],g=document.createDocumentFragment(),d=0;d<b&&this.vDomBottom<h-1;)f=this.vDomBottom+1,m=p[f],this.styleRow(m,f),m.initialize(!1,!0),!m.heightInitialized&&!this.table.options.rowHeight&&m.clearCellHeight(),g.appendChild(m.getElement()),v.push(m),this.vDomBottom++,d++;if(!v.length)break;r.appendChild(g),v.forEach(U=>{U.rendered(),U.heightInitialized||U.calcHeight(!0)}),v.forEach(U=>{U.heightInitialized||U.setCellHeight()}),v.forEach(U=>{l=U.getHeight(),y<s?u+=l:o+=l,l>this.vDomWindowBuffer&&(this.vDomWindowBuffer=l*2),y++}),S=this.table.rowManager.adjustTableSize(),T=this.elementVertical.clientHeight,S&&(I||this.table.options.maxHeight)&&(w=o/y,b=Math.max(this.vDomWindowMinTotalRows,Math.ceil(T/w+this.vDomWindowBuffer/w)))}e?(this.vDomTopPad=i?this.vDomRowHeight*this.vDomTop+n:this.scrollTop-u,this.vDomBottomPad=this.vDomBottom==h-1?0:Math.max(this.vDomScrollHeight-this.vDomTopPad-o-u,0)):(this.vDomTopPad=0,this.vDomRowHeight=Math.floor((o+u)/y),this.vDomBottomPad=this.vDomRowHeight*(h-this.vDomBottom-1),this.vDomScrollHeight=u+o+this.vDomBottomPad-T),r.style.paddingTop=this.vDomTopPad+"px",r.style.paddingBottom=this.vDomBottomPad+"px",i&&(this.scrollTop=this.vDomTopPad+u+n-(this.elementVertical.scrollWidth>this.elementVertical.clientWidth?this.elementVertical.offsetHeight-T:0)),this.scrollTop=Math.min(this.scrollTop,this.elementVertical.scrollHeight-T),this.elementVertical.scrollWidth>this.elementVertical.clientWidth&&i&&(this.scrollTop+=this.elementVertical.offsetHeight-T),this.vDomScrollPosTop=this.scrollTop,this.vDomScrollPosBottom=this.scrollTop,a.scrollTop=this.scrollTop,this.dispatch("render-virtual-fill")}}_addTopRow(e,i){for(var n=this.tableElement,r=[],a=0,s=this.vDomTop-1,o=0,l=!0;l;)if(this.vDomTop){let c=e[s],u,d;c&&o<this.vDomMaxRenderChain?(u=c.getHeight()||this.vDomRowHeight,d=c.initialized,i>=u?(this.styleRow(c,s),n.insertBefore(c.getElement(),n.firstChild),(!c.initialized||!c.heightInitialized)&&r.push(c),c.initialize(),d||(u=c.getElement().offsetHeight,u>this.vDomWindowBuffer&&(this.vDomWindowBuffer=u*2)),i-=u,a+=u,this.vDomTop--,s--,o++):l=!1):l=!1}else l=!1;for(let c of r)c.clearCellHeight();this._quickNormalizeRowHeight(r),a&&(this.vDomTopPad-=a,this.vDomTopPad<0&&(this.vDomTopPad=s*this.vDomRowHeight),s<1&&(this.vDomTopPad=0),n.style.paddingTop=this.vDomTopPad+"px",this.vDomScrollPosTop-=a)}_removeTopRow(e,i){for(var n=[],r=0,a=0,s=!0;s;){let o=e[this.vDomTop],l;o&&a<this.vDomMaxRenderChain?(l=o.getHeight()||this.vDomRowHeight,i>=l?(this.vDomTop++,i-=l,r+=l,n.push(o),a++):s=!1):s=!1}for(let o of n){let l=o.getElement();l.parentNode&&l.parentNode.removeChild(l)}r&&(this.vDomTopPad+=r,this.tableElement.style.paddingTop=this.vDomTopPad+"px",this.vDomScrollPosTop+=this.vDomTop?r:r+this.vDomWindowBuffer)}_addBottomRow(e,i){for(var n=this.tableElement,r=[],a=0,s=this.vDomBottom+1,o=0,l=!0;l;){let c=e[s],u,d;c&&o<this.vDomMaxRenderChain?(u=c.getHeight()||this.vDomRowHeight,d=c.initialized,i>=u?(this.styleRow(c,s),n.appendChild(c.getElement()),(!c.initialized||!c.heightInitialized)&&r.push(c),c.initialize(),d||(u=c.getElement().offsetHeight,u>this.vDomWindowBuffer&&(this.vDomWindowBuffer=u*2)),i-=u,a+=u,this.vDomBottom++,s++,o++):l=!1):l=!1}for(let c of r)c.clearCellHeight();this._quickNormalizeRowHeight(r),a&&(this.vDomBottomPad-=a,(this.vDomBottomPad<0||s==e.length-1)&&(this.vDomBottomPad=0),n.style.paddingBottom=this.vDomBottomPad+"px",this.vDomScrollPosBottom+=a)}_removeBottomRow(e,i){for(var n=[],r=0,a=0,s=!0;s;){let o=e[this.vDomBottom],l;o&&a<this.vDomMaxRenderChain?(l=o.getHeight()||this.vDomRowHeight,i>=l?(this.vDomBottom--,i-=l,r+=l,n.push(o),a++):s=!1):s=!1}for(let o of n){let l=o.getElement();l.parentNode&&l.parentNode.removeChild(l)}r&&(this.vDomBottomPad+=r,this.vDomBottomPad<0&&(this.vDomBottomPad=0),this.tableElement.style.paddingBottom=this.vDomBottomPad+"px",this.vDomScrollPosBottom-=r)}_quickNormalizeRowHeight(e){for(let i of e)i.calcHeight();for(let i of e)i.setCellHeight()}}class JJe extends bc{constructor(e){super(e),this.element=this.createHolderElement(),this.tableElement=this.createTableElement(),this.heightFixer=this.createTableElement(),this.placeholder=null,this.placeholderContents=null,this.firstRender=!1,this.renderMode="virtual",this.fixedHeight=!1,this.rows=[],this.activeRowsPipeline=[],this.activeRows=[],this.activeRowsCount=0,this.displayRows=[],this.displayRowsCount=0,this.scrollTop=0,this.scrollLeft=0,this.redrawBlock=!1,this.redrawBlockRestoreConfig=!1,this.redrawBlockRenderInPosition=!1,this.dataPipeline=[],this.displayPipeline=[],this.scrollbarWidth=0,this.renderer=null}createHolderElement(){var e=document.createElement("div");return e.classList.add("tabulator-tableholder"),e.setAttribute("tabindex",0),e}createTableElement(){var e=document.createElement("div");return e.classList.add("tabulator-table"),e.setAttribute("role","rowgroup"),e}initializePlaceholder(){var e=this.table.options.placeholder;if(typeof e=="function"&&(e=e.call(this.table)),e=this.chain("placeholder",[e],e,e)||e,e){let i=document.createElement("div");if(i.classList.add("tabulator-placeholder"),typeof e=="string"){let n=document.createElement("div");n.classList.add("tabulator-placeholder-contents"),n.innerHTML=e,i.appendChild(n),this.placeholderContents=n}else typeof HTMLElement<"u"&&e instanceof HTMLElement?(i.appendChild(e),this.placeholderContents=e):(console.warn("Invalid placeholder provided, must be string or HTML Element",e),this.el=null);this.placeholder=i}}getElement(){return this.element}getTableElement(){return this.tableElement}initialize(){this.initializePlaceholder(),this.initializeRenderer(),this.element.appendChild(this.tableElement),this.firstRender=!0,this.element.addEventListener("scroll",()=>{var e=this.element.scrollLeft,i=this.scrollLeft>e,n=this.element.scrollTop,r=this.scrollTop>n;this.scrollLeft!=e&&(this.scrollLeft=e,this.dispatch("scroll-horizontal",e,i),this.dispatchExternal("scrollHorizontal",e,i),this._positionPlaceholder()),this.scrollTop!=n&&(this.scrollTop=n,this.renderer.scrollRows(n,r),this.dispatch("scroll-vertical",n,r),this.dispatchExternal("scrollVertical",n,r))})}findRow(e){if(typeof e=="object"){if(e instanceof xc)return e;if(e instanceof D2)return e._getSelf()||!1;if(typeof HTMLElement<"u"&&e instanceof HTMLElement)return this.rows.find(n=>n.getElement()===e)||!1;if(e===null)return!1}else return typeof e>"u"?!1:this.rows.find(n=>n.data[this.table.options.index]==e)||!1;return!1}getRowFromDataObject(e){var i=this.rows.find(n=>n.data===e);return i||!1}getRowFromPosition(e){return this.getDisplayRows().find(i=>i.type==="row"&&i.getPosition()===e&&i.isDisplayed())}scrollToRow(e,i,n){return this.renderer.scrollToRowPosition(e,i,n)}setData(e,i,n){return new Promise((r,a)=>{i&&this.getDisplayRows().length?this.table.options.pagination?this._setDataActual(e,!0):this.reRenderInPosition(()=>{this._setDataActual(e)}):(this.table.options.autoColumns&&n&&this.table.initialized&&this.table.columnManager.generateColumnsFromRowData(e),this.resetScroll(),this._setDataActual(e)),r()})}_setDataActual(e,i){this.dispatchExternal("dataProcessing",e),this._wipeElements(),Array.isArray(e)?(this.dispatch("data-processing",e),e.forEach((n,r)=>{if(n&&typeof n=="object"){var a=new xc(n,this);this.rows.push(a)}else console.warn("Data Loading Warning - Invalid row data detected and ignored, expecting object but received:",n)}),this.refreshActiveData(!1,!1,i),this.dispatch("data-processed",e),this.dispatchExternal("dataProcessed",e)):console.error(`Data Loading Error - Unable to process data due to invalid data type 
Expecting: array 
Received: `,typeof e,`
Data:     `,e)}_wipeElements(){this.dispatch("rows-wipe"),this.destroy(),this.adjustTableSize(),this.dispatch("rows-wiped")}destroy(){this.rows.forEach(e=>{e.wipe()}),this.rows=[],this.activeRows=[],this.activeRowsPipeline=[],this.activeRowsCount=0,this.displayRows=[],this.displayRowsCount=0}deleteRow(e,i){var n=this.rows.indexOf(e),r=this.activeRows.indexOf(e);r>-1&&this.activeRows.splice(r,1),n>-1&&this.rows.splice(n,1),this.setActiveRows(this.activeRows),this.displayRowIterator(a=>{var s=a.indexOf(e);s>-1&&a.splice(s,1)}),i||this.reRenderInPosition(),this.regenerateRowPositions(),this.dispatchExternal("rowDeleted",e.getComponent()),this.displayRowsCount||this.tableEmpty(),this.subscribedExternal("dataChanged")&&this.dispatchExternal("dataChanged",this.getData())}addRow(e,i,n,r){var a=this.addRowActual(e,i,n,r);return a}addRows(e,i,n,r){var a=[];return new Promise((s,o)=>{i=this.findAddRowPos(i),Array.isArray(e)||(e=[e]),(typeof n>"u"&&i||typeof n<"u"&&!i)&&e.reverse(),e.forEach((l,c)=>{var u=this.addRow(l,i,n,!0);a.push(u),this.dispatch("row-added",u,l,i,n)}),this.refreshActiveData(r?"displayPipeline":!1,!1,!0),this.regenerateRowPositions(),this.displayRowsCount&&this._clearPlaceholder(),s(a)})}findAddRowPos(e){return typeof e>"u"&&(e=this.table.options.addRowPos),e==="pos"&&(e=!0),e==="bottom"&&(e=!1),e}addRowActual(e,i,n,r){var a=e instanceof xc?e:new xc(e||{},this),s=this.findAddRowPos(i),o=-1,l,c;return n||(c=this.chain("row-adding-position",[a,s],null,{index:n,top:s}),n=c.index,s=c.top),typeof n<"u"&&(n=this.findRow(n)),n=this.chain("row-adding-index",[a,n,s],null,n),n&&(o=this.rows.indexOf(n)),n&&o>-1?(l=this.activeRows.indexOf(n),this.displayRowIterator(function(u){var d=u.indexOf(n);d>-1&&u.splice(s?d:d+1,0,a)}),l>-1&&this.activeRows.splice(s?l:l+1,0,a),this.rows.splice(s?o:o+1,0,a)):s?(this.displayRowIterator(function(u){u.unshift(a)}),this.activeRows.unshift(a),this.rows.unshift(a)):(this.displayRowIterator(function(u){u.push(a)}),this.activeRows.push(a),this.rows.push(a)),this.setActiveRows(this.activeRows),this.dispatchExternal("rowAdded",a.getComponent()),this.subscribedExternal("dataChanged")&&this.dispatchExternal("dataChanged",this.table.rowManager.getData()),r||this.reRenderInPosition(),a}moveRow(e,i,n){this.dispatch("row-move",e,i,n),this.moveRowActual(e,i,n),this.regenerateRowPositions(),this.dispatch("row-moved",e,i,n),this.dispatchExternal("rowMoved",e.getComponent())}moveRowActual(e,i,n){this.moveRowInArray(this.rows,e,i,n),this.moveRowInArray(this.activeRows,e,i,n),this.displayRowIterator(r=>{this.moveRowInArray(r,e,i,n)}),this.dispatch("row-moving",e,i,n)}moveRowInArray(e,i,n,r){var a,s,o,l;if(i!==n&&(a=e.indexOf(i),a>-1&&(e.splice(a,1),s=e.indexOf(n),s>-1?r?e.splice(s+1,0,i):e.splice(s,0,i):e.splice(a,0,i)),e===this.getDisplayRows())){o=a<s?a:s,l=s>a?s:a+1;for(let c=o;c<=l;c++)e[c]&&this.styleRow(e[c],c)}}clearData(){this.setData([])}getRowIndex(e){return this.findRowIndex(e,this.rows)}getDisplayRowIndex(e){var i=this.getDisplayRows().indexOf(e);return i>-1?i:!1}nextDisplayRow(e,i){var n=this.getDisplayRowIndex(e),r=!1;return n!==!1&&n<this.displayRowsCount-1&&(r=this.getDisplayRows()[n+1]),r&&(!(r instanceof xc)||r.type!="row")?this.nextDisplayRow(r,i):r}prevDisplayRow(e,i){var n=this.getDisplayRowIndex(e),r=!1;return n&&(r=this.getDisplayRows()[n-1]),i&&r&&(!(r instanceof xc)||r.type!="row")?this.prevDisplayRow(r,i):r}findRowIndex(e,i){var n;return e=this.findRow(e),e&&(n=i.indexOf(e),n>-1)?n:!1}getData(e,i){var n=[],r=this.getRows(e);return r.forEach(function(a){a.type=="row"&&n.push(a.getData(i||"data"))}),n}getComponents(e){var i=[],n=this.getRows(e);return n.forEach(function(r){i.push(r.getComponent())}),i}getDataCount(e){var i=this.getRows(e);return i.length}scrollHorizontal(e){this.scrollLeft=e,this.element.scrollLeft=e,this.dispatch("scroll-horizontal",e)}registerDataPipelineHandler(e,i){typeof i<"u"?(this.dataPipeline.push({handler:e,priority:i}),this.dataPipeline.sort((n,r)=>n.priority-r.priority)):console.error("Data pipeline handlers must have a priority in order to be registered")}registerDisplayPipelineHandler(e,i){typeof i<"u"?(this.displayPipeline.push({handler:e,priority:i}),this.displayPipeline.sort((n,r)=>n.priority-r.priority)):console.error("Display pipeline handlers must have a priority in order to be registered")}refreshActiveData(e,i,n){var r=this.table,a="",s=0,o=["all","dataPipeline","display","displayPipeline","end"];if(!this.table.destroyed){if(typeof e=="function")if(s=this.dataPipeline.findIndex(l=>l.handler===e),s>-1)a="dataPipeline",i&&(s==this.dataPipeline.length-1?a="display":s++);else if(s=this.displayPipeline.findIndex(l=>l.handler===e),s>-1)a="displayPipeline",i&&(s==this.displayPipeline.length-1?a="end":s++);else{console.error("Unable to refresh data, invalid handler provided",e);return}else a=e||"all",s=0;if(this.redrawBlock){(!this.redrawBlockRestoreConfig||this.redrawBlockRestoreConfig&&(this.redrawBlockRestoreConfig.stage===a&&s<this.redrawBlockRestoreConfig.index||o.indexOf(a)<o.indexOf(this.redrawBlockRestoreConfig.stage)))&&(this.redrawBlockRestoreConfig={handler:e,skipStage:i,renderInPosition:n,stage:a,index:s});return}else Ha.elVisible(this.element)?n?this.reRenderInPosition(this.refreshPipelines.bind(this,e,a,s,n)):(this.refreshPipelines(e,a,s,n),e||this.table.columnManager.renderer.renderColumns(),this.renderTable(),r.options.layoutColumnsOnNewData&&this.table.columnManager.redraw(!0)):this.refreshPipelines(e,a,s,n),this.dispatch("data-refreshed")}}refreshPipelines(e,i,n,r){switch(this.dispatch("data-refreshing"),(!e||!this.activeRowsPipeline[0])&&(this.activeRowsPipeline[0]=this.rows.slice(0)),i){case"all":case"dataPipeline":for(let a=n;a<this.dataPipeline.length;a++){let s=this.dataPipeline[a].handler(this.activeRowsPipeline[a].slice(0));this.activeRowsPipeline[a+1]=s||this.activeRowsPipeline[a].slice(0)}this.setActiveRows(this.activeRowsPipeline[this.dataPipeline.length]);case"display":n=0,this.resetDisplayRows();case"displayPipeline":for(let a=n;a<this.displayPipeline.length;a++){let s=this.displayPipeline[a].handler((a?this.getDisplayRows(a-1):this.activeRows).slice(0),r);this.setDisplayRows(s||this.getDisplayRows(a-1).slice(0),a)}case"end":this.regenerateRowPositions()}this.getDisplayRows().length&&this._clearPlaceholder()}regenerateRowPositions(){var e=this.getDisplayRows(),i=1;e.forEach(n=>{n.type==="row"&&(n.setPosition(i),i++)})}setActiveRows(e){this.activeRows=this.activeRows=Object.assign([],e),this.activeRowsCount=this.activeRows.length}resetDisplayRows(){this.displayRows=[],this.displayRows.push(this.activeRows.slice(0)),this.displayRowsCount=this.displayRows[0].length}setDisplayRows(e,i){this.displayRows[i]=e,i==this.displayRows.length-1&&(this.displayRowsCount=this.displayRows[this.displayRows.length-1].length)}getDisplayRows(e){return typeof e>"u"?this.displayRows.length?this.displayRows[this.displayRows.length-1]:[]:this.displayRows[e]||[]}getVisibleRows(e,i){var n=Object.assign([],this.renderer.visibleRows(!i));return e&&(n=this.chain("rows-visible",[i],n,n)),n}displayRowIterator(e){this.activeRowsPipeline.forEach(e),this.displayRows.forEach(e),this.displayRowsCount=this.displayRows[this.displayRows.length-1].length}getRows(e){var i=[];switch(e){case"active":i=this.activeRows;break;case"display":i=this.table.rowManager.getDisplayRows();break;case"visible":i=this.getVisibleRows(!1,!0);break;default:i=this.chain("rows-retrieve",e,null,this.rows)||this.rows}return i}reRenderInPosition(e){this.redrawBlock?e?e():this.redrawBlockRenderInPosition=!0:(this.dispatchExternal("renderStarted"),this.renderer.rerenderRows(e),this.fixedHeight||this.adjustTableSize(),this.scrollBarCheck(),this.dispatchExternal("renderComplete"))}scrollBarCheck(){var e=0;this.element.scrollHeight>this.element.clientHeight&&(e=this.element.offsetWidth-this.element.clientWidth),e!==this.scrollbarWidth&&(this.scrollbarWidth=e,this.dispatch("scrollbar-vertical",e))}initializeRenderer(){var e,i={virtual:XJe,basic:ZJe};typeof this.table.options.renderVertical=="string"?e=i[this.table.options.renderVertical]:e=this.table.options.renderVertical,e?(this.renderMode=this.table.options.renderVertical,this.renderer=new e(this.table,this.element,this.tableElement),this.renderer.initialize(),(this.table.element.clientHeight||this.table.options.height)&&!(this.table.options.minHeight&&this.table.options.maxHeight)?this.fixedHeight=!0:this.fixedHeight=!1):console.error("Unable to find matching renderer:",this.table.options.renderVertical)}getRenderMode(){return this.renderMode}renderTable(){this.dispatchExternal("renderStarted"),this.element.scrollTop=0,this._clearTable(),this.displayRowsCount?(this.renderer.renderRows(),this.firstRender&&(this.firstRender=!1,this.fixedHeight||this.adjustTableSize(),this.layoutRefresh(!0))):this.renderEmptyScroll(),this.fixedHeight||this.adjustTableSize(),this.dispatch("table-layout"),this.displayRowsCount||this._showPlaceholder(),this.scrollBarCheck(),this.dispatchExternal("renderComplete")}renderEmptyScroll(){this.placeholder?this.tableElement.style.display="none":this.tableElement.style.minWidth=this.table.columnManager.getWidth()+"px"}_clearTable(){this._clearPlaceholder(),this.scrollTop=0,this.scrollLeft=0,this.renderer.clearRows()}tableEmpty(){this.renderEmptyScroll(),this._showPlaceholder()}checkPlaceholder(){this.displayRowsCount?this._clearPlaceholder():this.tableEmpty()}_showPlaceholder(){this.placeholder&&(this.placeholder&&this.placeholder.parentNode&&this.placeholder.parentNode.removeChild(this.placeholder),this.initializePlaceholder(),this.placeholder.setAttribute("tabulator-render-mode",this.renderMode),this.getElement().appendChild(this.placeholder),this._positionPlaceholder(),this.adjustTableSize())}_clearPlaceholder(){this.placeholder&&this.placeholder.parentNode&&this.placeholder.parentNode.removeChild(this.placeholder),this.tableElement.style.minWidth="",this.tableElement.style.display=""}_positionPlaceholder(){this.placeholder&&this.placeholder.parentNode&&(this.placeholder.style.width=this.table.columnManager.getWidth()+"px",this.placeholderContents.style.width=this.table.rowManager.element.clientWidth+"px",this.placeholderContents.style.marginLeft=this.scrollLeft+"px")}styleRow(e,i){var n=e.getElement();i%2?(n.classList.add("tabulator-row-even"),n.classList.remove("tabulator-row-odd")):(n.classList.add("tabulator-row-odd"),n.classList.remove("tabulator-row-even"))}normalizeHeight(){this.activeRows.forEach(function(e){e.normalizeHeight()})}adjustTableSize(){let e=this.element.clientHeight,i,n=!1;if(this.renderer.verticalFillMode==="fill"){let r=Math.floor(this.table.columnManager.getElement().getBoundingClientRect().height+(this.table.footerManager&&this.table.footerManager.active&&!this.table.footerManager.external?this.table.footerManager.getElement().getBoundingClientRect().height:0));if(this.fixedHeight){i=isNaN(this.table.options.minHeight)?this.table.options.minHeight:this.table.options.minHeight+"px";const a="calc(100% - "+r+"px)";this.element.style.minHeight=i||"calc(100% - "+r+"px)",this.element.style.height=a,this.element.style.maxHeight=a}else this.element.style.height="",this.element.style.height=this.table.element.clientHeight-r+"px",this.element.scrollTop=this.scrollTop;this.renderer.resize(),!this.fixedHeight&&e!=this.element.clientHeight&&(n=!0,this.subscribed("table-resize")?this.dispatch("table-resize"):this.redraw()),this.scrollBarCheck()}return this._positionPlaceholder(),n}reinitialize(){this.rows.forEach(function(e){e.reinitialize(!0)})}blockRedraw(){this.redrawBlock=!0,this.redrawBlockRestoreConfig=!1}restoreRedraw(){this.redrawBlock=!1,this.redrawBlockRestoreConfig?(this.refreshActiveData(this.redrawBlockRestoreConfig.handler,this.redrawBlockRestoreConfig.skipStage,this.redrawBlockRestoreConfig.renderInPosition),this.redrawBlockRestoreConfig=!1):this.redrawBlockRenderInPosition&&this.reRenderInPosition(),this.redrawBlockRenderInPosition=!1}redraw(e){this.adjustTableSize(),this.table.tableWidth=this.table.element.clientWidth,e?this.renderTable():(this.reRenderInPosition(),this.scrollHorizontal(this.scrollLeft))}resetScroll(){if(this.element.scrollLeft=0,this.element.scrollTop=0,this.table.browser==="ie"){var e=document.createEvent("Event");e.initEvent("scroll",!1,!0),this.element.dispatchEvent(e)}else this.element.dispatchEvent(new Event("scroll"))}}class QJe extends bc{constructor(e){super(e),this.active=!1,this.element=this.createElement(),this.containerElement=this.createContainerElement(),this.external=!1}initialize(){this.initializeElement()}createElement(){var e=document.createElement("div");return e.classList.add("tabulator-footer"),e}createContainerElement(){var e=document.createElement("div");return e.classList.add("tabulator-footer-contents"),this.element.appendChild(e),e}initializeElement(){if(this.table.options.footerElement)switch(typeof this.table.options.footerElement){case"string":this.table.options.footerElement[0]==="<"?this.containerElement.innerHTML=this.table.options.footerElement:(this.external=!0,this.containerElement=document.querySelector(this.table.options.footerElement));break;default:this.element=this.table.options.footerElement;break}}getElement(){return this.element}append(e){this.activate(),this.containerElement.appendChild(e),this.table.rowManager.adjustTableSize()}prepend(e){this.activate(),this.element.insertBefore(e,this.element.firstChild),this.table.rowManager.adjustTableSize()}remove(e){e.parentNode.removeChild(e),this.deactivate()}deactivate(e){(!this.element.firstChild||e)&&(this.external||this.element.parentNode.removeChild(this.element),this.active=!1)}activate(){this.active||(this.active=!0,this.external||(this.table.element.appendChild(this.getElement()),this.table.element.style.display=""))}redraw(){this.dispatch("footer-redraw")}}class eQe extends bc{constructor(e){super(e),this.el=null,this.abortClasses=["tabulator-headers","tabulator-table"],this.previousTargets={},this.listeners=["click","dblclick","contextmenu","mouseenter","mouseleave","mouseover","mouseout","mousemove","mouseup","mousedown","touchstart","touchend"],this.componentMap={"tabulator-cell":"cell","tabulator-row":"row","tabulator-group":"group","tabulator-col":"column"},this.pseudoTrackers={row:{subscriber:null,target:null},cell:{subscriber:null,target:null},group:{subscriber:null,target:null},column:{subscriber:null,target:null}},this.pseudoTracking=!1}initialize(){this.el=this.table.element,this.buildListenerMap(),this.bindSubscriptionWatchers()}buildListenerMap(){var e={};this.listeners.forEach(i=>{e[i]={handler:null,components:[]}}),this.listeners=e}bindPseudoEvents(){Object.keys(this.pseudoTrackers).forEach(e=>{this.pseudoTrackers[e].subscriber=this.pseudoMouseEnter.bind(this,e),this.subscribe(e+"-mouseover",this.pseudoTrackers[e].subscriber)}),this.pseudoTracking=!0}pseudoMouseEnter(e,i,n){this.pseudoTrackers[e].target!==n&&(this.pseudoTrackers[e].target&&this.dispatch(e+"-mouseleave",i,this.pseudoTrackers[e].target),this.pseudoMouseLeave(e,i),this.pseudoTrackers[e].target=n,this.dispatch(e+"-mouseenter",i,n))}pseudoMouseLeave(e,i){var n=Object.keys(this.pseudoTrackers),r={row:["cell"],cell:["row"]};n=n.filter(a=>{var s=r[e];return a!==e&&(!s||s&&!s.includes(a))}),n.forEach(a=>{var s=this.pseudoTrackers[a].target;this.pseudoTrackers[a].target&&(this.dispatch(a+"-mouseleave",i,s),this.pseudoTrackers[a].target=null)})}bindSubscriptionWatchers(){var e=Object.keys(this.listeners),i=Object.values(this.componentMap);for(let n of i)for(let r of e){let a=n+"-"+r;this.subscriptionChange(a,this.subscriptionChanged.bind(this,n,r))}this.subscribe("table-destroy",this.clearWatchers.bind(this))}subscriptionChanged(e,i,n){var r=this.listeners[i].components,a=r.indexOf(e),s=!1;n?a===-1&&(r.push(e),s=!0):this.subscribed(e+"-"+i)||a>-1&&(r.splice(a,1),s=!0),(i==="mouseenter"||i==="mouseleave")&&!this.pseudoTracking&&this.bindPseudoEvents(),s&&this.updateEventListeners()}updateEventListeners(){for(let e in this.listeners){let i=this.listeners[e];i.components.length?i.handler||(i.handler=this.track.bind(this,e),this.el.addEventListener(e,i.handler)):i.handler&&(this.el.removeEventListener(e,i.handler),i.handler=null)}}track(e,i){var n=i.composedPath&&i.composedPath()||i.path,r=this.findTargets(n);r=this.bindComponents(e,r),this.triggerEvents(e,i,r),this.pseudoTracking&&(e=="mouseover"||e=="mouseleave")&&!Object.keys(r).length&&this.pseudoMouseLeave("none",i)}findTargets(e){var i={};let n=Object.keys(this.componentMap);for(let r of e){let a=r.classList?[...r.classList]:[];if(a.filter(l=>this.abortClasses.includes(l)).length)break;let o=a.filter(l=>n.includes(l));for(let l of o)i[this.componentMap[l]]||(i[this.componentMap[l]]=r)}return i.group&&i.group===i.row&&delete i.row,i}bindComponents(e,i){var n=Object.keys(i).reverse(),r=this.listeners[e],a={},s={};for(let o of n){let l,c=i[o],u=this.previousTargets[o];if(u&&u.target===c)l=u.component;else switch(o){case"row":case"group":(r.components.includes("row")||r.components.includes("cell")||r.components.includes("group"))&&(l=this.table.rowManager.getVisibleRows(!0).find(p=>p.getElement()===c),i.row&&i.row.parentNode&&i.row.parentNode.closest(".tabulator-row")&&(i[o]=!1));break;case"column":r.components.includes("column")&&(l=this.table.columnManager.findColumn(c));break;case"cell":r.components.includes("cell")&&(a.row instanceof xc?l=a.row.findCell(c):i.row&&console.warn("Event Target Lookup Error - The row this cell is attached to cannot be found, has the table been reinitialized without being destroyed first?"));break}l&&(a[o]=l,s[o]={target:c,component:l})}return this.previousTargets=s,a}triggerEvents(e,i,n){var r=this.listeners[e];for(let a in n)n[a]&&r.components.includes(a)&&this.dispatch(a+"-"+e,i,n[a])}clearWatchers(){for(let e in this.listeners){let i=this.listeners[e];i.handler&&(this.el.removeEventListener(e,i.handler),i.handler=null)}}}class tQe{constructor(e){this.table=e,this.bindings={}}bind(e,i,n){this.bindings[e]||(this.bindings[e]={}),this.bindings[e][i]?console.warn("Unable to bind component handler, a matching function name is already bound",e,i,n):this.bindings[e][i]=n}handle(e,i,n){if(this.bindings[e]&&this.bindings[e][n]&&typeof this.bindings[e][n].bind=="function")return this.bindings[e][n].bind(null,i);n!=="then"&&typeof n=="string"&&!n.startsWith("_")&&this.table.options.debugInvalidComponentFuncs&&console.error("The "+e+" component does not have a "+n+" function, have you checked that you have the correct Tabulator module installed?")}}class iQe extends bc{constructor(e){super(e),this.requestOrder=0,this.loading=!1}initialize(){}load(e,i,n,r,a,s){var o=++this.requestOrder;if(this.table.destroyed)return Promise.resolve();if(this.dispatchExternal("dataLoading",e),e&&(e.indexOf("{")==0||e.indexOf("[")==0)&&(e=JSON.parse(e)),this.confirm("data-loading",[e,i,n,a])){this.loading=!0,a||this.alertLoader(),i=this.chain("data-params",[e,n,a],i||{},i||{}),i=this.mapParams(i,this.table.options.dataSendParams);var l=this.chain("data-load",[e,i,n,a],!1,Promise.resolve([]));return l.then(c=>{if(this.table.destroyed)console.warn("Data Load Response Blocked - Table has been destroyed");else{!Array.isArray(c)&&typeof c=="object"&&(c=this.mapParams(c,this.objectInvert(this.table.options.dataReceiveParams)));var u=this.chain("data-loaded",[c],null,c);o==this.requestOrder?(this.clearAlert(),u!==!1&&(this.dispatchExternal("dataLoaded",u),this.table.rowManager.setData(u,r,typeof s>"u"?!r:s))):console.warn("Data Load Response Blocked - An active data load request was blocked by an attempt to change table data while the request was being made")}}).catch(c=>{console.error("Data Load Error: ",c),this.dispatchExternal("dataLoadError",c),a||this.alertError(),setTimeout(()=>{this.clearAlert()},this.table.options.dataLoaderErrorTimeout)}).finally(()=>{this.loading=!1})}else return this.dispatchExternal("dataLoaded",e),e||(e=[]),this.table.rowManager.setData(e,r,typeof s>"u"?!r:s),Promise.resolve()}mapParams(e,i){var n={};for(let r in e)n[i.hasOwnProperty(r)?i[r]:r]=e[r];return n}objectInvert(e){var i={};for(let n in e)i[e[n]]=n;return i}blockActiveLoad(){this.requestOrder++}alertLoader(){var e=typeof this.table.options.dataLoader=="function"?this.table.options.dataLoader():this.table.options.dataLoader;e&&this.table.alertManager.alert(this.table.options.dataLoaderLoading||this.langText("data|loading"))}alertError(){this.table.alertManager.alert(this.table.options.dataLoaderError||this.langText("data|error"),"error")}clearAlert(){this.table.alertManager.clear()}}class nQe{constructor(e,i,n){this.table=e,this.events={},this.optionsList=i||{},this.subscriptionNotifiers={},this.dispatch=n?this._debugDispatch.bind(this):this._dispatch.bind(this),this.debug=n}subscriptionChange(e,i){this.subscriptionNotifiers[e]||(this.subscriptionNotifiers[e]=[]),this.subscriptionNotifiers[e].push(i),this.subscribed(e)&&this._notifySubscriptionChange(e,!0)}subscribe(e,i){this.events[e]||(this.events[e]=[]),this.events[e].push(i),this._notifySubscriptionChange(e,!0)}unsubscribe(e,i){var n;if(this.events[e])if(i)if(n=this.events[e].findIndex(r=>r===i),n>-1)this.events[e].splice(n,1);else{console.warn("Cannot remove event, no matching event found:",e,i);return}else delete this.events[e];else{console.warn("Cannot remove event, no events set on:",e);return}this._notifySubscriptionChange(e,!1)}subscribed(e){return this.events[e]&&this.events[e].length}_notifySubscriptionChange(e,i){var n=this.subscriptionNotifiers[e];n&&n.forEach(r=>{r(i)})}_dispatch(){var e=Array.from(arguments),i=e.shift(),n;return this.events[i]&&this.events[i].forEach((r,a)=>{let s=r.apply(this.table,e);a||(n=s)}),n}_debugDispatch(){var e=Array.from(arguments),i=e[0];return e[0]="ExternalEvent:"+e[0],(this.debug===!0||this.debug.includes(i))&&console.log(...e),this._dispatch(...arguments)}}class rQe{constructor(e){this.events={},this.subscriptionNotifiers={},this.dispatch=e?this._debugDispatch.bind(this):this._dispatch.bind(this),this.chain=e?this._debugChain.bind(this):this._chain.bind(this),this.confirm=e?this._debugConfirm.bind(this):this._confirm.bind(this),this.debug=e}subscriptionChange(e,i){this.subscriptionNotifiers[e]||(this.subscriptionNotifiers[e]=[]),this.subscriptionNotifiers[e].push(i),this.subscribed(e)&&this._notifySubscriptionChange(e,!0)}subscribe(e,i,n=1e4){this.events[e]||(this.events[e]=[]),this.events[e].push({callback:i,priority:n}),this.events[e].sort((r,a)=>r.priority-a.priority),this._notifySubscriptionChange(e,!0)}unsubscribe(e,i){var n;if(this.events[e]){if(i)if(n=this.events[e].findIndex(r=>r.callback===i),n>-1)this.events[e].splice(n,1);else{console.warn("Cannot remove event, no matching event found:",e,i);return}}else{console.warn("Cannot remove event, no events set on:",e);return}this._notifySubscriptionChange(e,!1)}subscribed(e){return this.events[e]&&this.events[e].length}_chain(e,i,n,r){var a=n;return Array.isArray(i)||(i=[i]),this.subscribed(e)?(this.events[e].forEach((s,o)=>{a=s.callback.apply(this,i.concat([a]))}),a):typeof r=="function"?r():r}_confirm(e,i){var n=!1;return Array.isArray(i)||(i=[i]),this.subscribed(e)&&this.events[e].forEach((r,a)=>{r.callback.apply(this,i)&&(n=!0)}),n}_notifySubscriptionChange(e,i){var n=this.subscriptionNotifiers[e];n&&n.forEach(r=>{r(i)})}_dispatch(){var e=Array.from(arguments),i=e.shift();this.events[i]&&this.events[i].forEach(n=>{n.callback.apply(this,e)})}_debugDispatch(){var e=Array.from(arguments),i=e[0];return e[0]="InternalEvent:"+i,(this.debug===!0||this.debug.includes(i))&&console.log(...e),this._dispatch(...arguments)}_debugChain(){var e=Array.from(arguments),i=e[0];return e[0]="InternalEvent:"+i,(this.debug===!0||this.debug.includes(i))&&console.log(...e),this._chain(...arguments)}_debugConfirm(){var e=Array.from(arguments),i=e[0];return e[0]="InternalEvent:"+i,(this.debug===!0||this.debug.includes(i))&&console.log(...e),this._confirm(...arguments)}}class aQe extends bc{constructor(e){super(e)}_warnUser(){this.options("debugDeprecation")&&console.warn(...arguments)}check(e,i,n){var r="";return typeof this.options(e)<"u"?(r="Deprecated Setup Option - Use of the %c"+e+"%c option is now deprecated",i?(r=r+", Please use the %c"+i+"%c option instead",this._warnUser(r,"font-weight: bold;","font-weight: normal;","font-weight: bold;","font-weight: normal;"),n&&(this.table.options[i]=this.table.options[e])):this._warnUser(r,"font-weight: bold;","font-weight: normal;"),!1):!0}checkMsg(e,i){return typeof this.options(e)<"u"?(this._warnUser("%cDeprecated Setup Option - Use of the %c"+e+" %c option is now deprecated, "+i,"font-weight: normal;","font-weight: bold;","font-weight: normal;"),!1):!0}msg(e){this._warnUser(e)}}function sQe(t,e){e&&this.table.columnManager.renderer.reinitializeColumnWidths(t),this.table.options.responsiveLayout&&this.table.modExists("responsiveLayout",!0)&&this.table.modules.responsiveLayout.update()}function oQ(t,e){t.forEach(function(i){i.reinitializeWidth()}),this.table.options.responsiveLayout&&this.table.modExists("responsiveLayout",!0)&&this.table.modules.responsiveLayout.update()}function oQe(t,e){var i=0,n=this.table.rowManager.element.clientWidth,r=0,a=!1;t.forEach((s,o)=>{s.widthFixed||s.reinitializeWidth(),(this.table.options.responsiveLayout?s.modules.responsive.visible:s.visible)&&(a=s),s.visible&&(i+=s.getWidth())}),a?(r=n-i+a.getWidth(),this.table.options.responsiveLayout&&this.table.modExists("responsiveLayout",!0)&&(a.setWidth(0),this.table.modules.responsiveLayout.update()),r>0?a.setWidth(r):a.reinitializeWidth()):this.table.options.responsiveLayout&&this.table.modExists("responsiveLayout",!0)&&this.table.modules.responsiveLayout.update()}function lQe(t,e){var i=this.table.rowManager.element.getBoundingClientRect().width,n=0,r=0,a=0,s=0,o=[],l=[],c=0,u=0,d=0;function p(f){var m;return typeof f=="string"?f.indexOf("%")>-1?m=i/100*parseInt(f):m=parseInt(f):m=f,m}function h(f,m,g,v){var y=[],b=0,I=0,T=0,w=a,S=0,U=0,P=[];function E(C){return g*(C.column.definition.widthGrow||1)}function R(C){return p(C.width)-g*(C.column.definition.widthShrink||0)}return f.forEach(function(C,M){var _=v?R(C):E(C);C.column.minWidth>=_?y.push(C):C.column.maxWidth&&C.column.maxWidth<_?(C.width=C.column.maxWidth,m-=C.column.maxWidth,w-=v?C.column.definition.widthShrink||1:C.column.definition.widthGrow||1,w&&(g=Math.floor(m/w))):(P.push(C),U+=v?C.column.definition.widthShrink||1:C.column.definition.widthGrow||1)}),y.length?(y.forEach(function(C){b+=v?C.width-C.column.minWidth:C.column.minWidth,C.width=C.column.minWidth}),I=m-b,T=U?Math.floor(I/U):I,S=h(P,I,T,v)):(S=U?m-Math.floor(m/U)*U:m,P.forEach(function(C){C.width=v?R(C):E(C)})),S}this.table.options.responsiveLayout&&this.table.modExists("responsiveLayout",!0)&&this.table.modules.responsiveLayout.update(),this.table.rowManager.element.scrollHeight>this.table.rowManager.element.clientHeight&&(i-=this.table.rowManager.element.offsetWidth-this.table.rowManager.element.clientWidth),t.forEach(function(f){var m,g,v;f.visible&&(m=f.definition.width,g=parseInt(f.minWidth),m?(v=p(m),n+=v>g?v:g,f.definition.widthShrink&&(l.push({column:f,width:v>g?v:g}),c+=f.definition.widthShrink)):(o.push({column:f,width:0}),a+=f.definition.widthGrow||1))}),r=i-n,s=Math.floor(r/a),d=h(o,r,s,!1),o.length&&d>0&&(o[o.length-1].width+=d),o.forEach(function(f){r-=f.width}),u=Math.abs(d)+r,u>0&&c&&(d=h(l,u,Math.floor(u/c),!0)),d&&l.length&&(l[l.length-1].width-=d),o.forEach(function(f){f.column.setWidth(f.width)}),l.forEach(function(f){f.column.setWidth(f.width)})}var cQe={fitData:sQe,fitDataFill:oQ,fitDataTable:oQ,fitDataStretch:oQe,fitColumns:lQe};const cS=class cS extends qn{constructor(e){super(e,"layout"),this.mode=null,this.registerTableOption("layout","fitData"),this.registerTableOption("layoutColumnsOnNewData",!1),this.registerColumnOption("widthGrow"),this.registerColumnOption("widthShrink")}initialize(){var e=this.table.options.layout;cS.modes[e]?this.mode=e:(console.warn("Layout Error - invalid mode set, defaulting to 'fitData' : "+e),this.mode="fitData"),this.table.element.setAttribute("tabulator-layout",this.mode),this.subscribe("column-init",this.initializeColumn.bind(this))}initializeColumn(e){e.definition.widthGrow&&(e.definition.widthGrow=Number(e.definition.widthGrow)),e.definition.widthShrink&&(e.definition.widthShrink=Number(e.definition.widthShrink))}getMode(){return this.mode}layout(e){this.dispatch("layout-refreshing"),cS.modes[this.mode].call(this,this.table.columnManager.columnsByIndex,e),this.dispatch("layout-refreshed")}};et(cS,"moduleName","layout"),et(cS,"modes",cQe);let JG=cS;var uQe={default:{groups:{item:"item",items:"items"},columns:{},data:{loading:"Loading",error:"Error"},pagination:{page_size:"Page Size",page_title:"Show Page",first:"First",first_title:"First Page",last:"Last",last_title:"Last Page",prev:"Prev",prev_title:"Prev Page",next:"Next",next_title:"Next Page",all:"All",counter:{showing:"Showing",of:"of",rows:"rows",pages:"pages"}},headerFilters:{default:"filter column...",columns:{}}}};const GD=class GD extends qn{constructor(e){super(e),this.locale="default",this.lang=!1,this.bindings={},this.langList={},this.registerTableOption("locale",!1),this.registerTableOption("langs",{})}initialize(){this.langList=Ha.deepClone(GD.langs),this.table.options.columnDefaults.headerFilterPlaceholder!==!1&&this.setHeaderFilterPlaceholder(this.table.options.columnDefaults.headerFilterPlaceholder);for(let e in this.table.options.langs)this.installLang(e,this.table.options.langs[e]);this.setLocale(this.table.options.locale),this.registerTableFunction("setLocale",this.setLocale.bind(this)),this.registerTableFunction("getLocale",this.getLocale.bind(this)),this.registerTableFunction("getLang",this.getLang.bind(this))}setHeaderFilterPlaceholder(e){this.langList.default.headerFilters.default=e}installLang(e,i){this.langList[e]?this._setLangProp(this.langList[e],i):this.langList[e]=i}_setLangProp(e,i){for(let n in i)e[n]&&typeof e[n]=="object"?this._setLangProp(e[n],i[n]):e[n]=i[n]}setLocale(e){e=e||"default";function i(n,r){for(var a in n)typeof n[a]=="object"?(r[a]||(r[a]={}),i(n[a],r[a])):r[a]=n[a]}if(e===!0&&navigator.language&&(e=navigator.language.toLowerCase()),e&&!this.langList[e]){let n=e.split("-")[0];this.langList[n]?(console.warn("Localization Error - Exact matching locale not found, using closest match: ",e,n),e=n):(console.warn("Localization Error - Matching locale not found, using default: ",e),e="default")}this.locale=e,this.lang=Ha.deepClone(this.langList.default||{}),e!="default"&&i(this.langList[e],this.lang),this.dispatchExternal("localized",this.locale,this.lang),this._executeBindings()}getLocale(e){return this.locale}getLang(e){return e?this.langList[e]:this.lang}getText(e,i){var n=i?e+"|"+i:e,r=n.split("|"),a=this._getLangElement(r,this.locale);return a||""}_getLangElement(e,i){var n=this.lang;return e.forEach(function(r){var a;n&&(a=n[r],typeof a<"u"?n=a:n=!1)}),n}bind(e,i){this.bindings[e]||(this.bindings[e]=[]),this.bindings[e].push(i),i(this.getText(e),this.lang)}_executeBindings(){for(let e in this.bindings)this.bindings[e].forEach(i=>{i(this.getText(e),this.lang)})}};et(GD,"moduleName","localize"),et(GD,"langs",uQe);let QG=GD;class _1e extends qn{constructor(e){super(e)}initialize(){this.registerTableFunction("tableComms",this.receive.bind(this))}getConnections(e){var i=[],n;return n=this.table.constructor.registry.lookupTable(e),n.forEach(r=>{this.table!==r&&i.push(r)}),i}send(e,i,n,r){var a=this.getConnections(e);a.forEach(s=>{s.tableComms(this.table.element,i,n,r)}),!a.length&&e&&console.warn("Table Connection Error - No tables matching selector found",e)}receive(e,i,n,r){if(this.table.modExists(i))return this.table.modules[i].commsReceived(e,n,r);console.warn("Inter-table Comms Error - no such module:",i)}}et(_1e,"moduleName","comms");var dQe=Object.freeze({__proto__:null,CommsModule:_1e,LayoutModule:JG,LocalizeModule:QG});const hd=class hd{static findTable(e){var i=hd.registry.lookupTable(e,!0);return Array.isArray(i)&&!i.length?!1:i}};et(hd,"registry",{tables:[],register(e){hd.registry.tables.push(e)},deregister(e){var i=hd.registry.tables.indexOf(e);i>-1&&hd.registry.tables.splice(i,1)},lookupTable(e,i){var n=[],r,a;if(typeof e=="string"){if(r=document.querySelectorAll(e),r.length)for(var s=0;s<r.length;s++)a=hd.registry.matchElement(r[s]),a&&n.push(a)}else typeof HTMLElement<"u"&&e instanceof HTMLElement||e instanceof hd?(a=hd.registry.matchElement(e),a&&n.push(a)):Array.isArray(e)?e.forEach(function(o){n=n.concat(hd.registry.lookupTable(o))}):i||console.warn("Table Connection Error - Invalid Selector",e);return n},matchElement(e){return hd.registry.tables.find(function(i){return e instanceof hd?i===e:i.element===e})}});let eH=hd;const ta=class ta extends eH{constructor(){super()}static initializeModuleBinder(e){ta.modulesRegistered||(ta.modulesRegistered=!0,ta._registerModules(dQe,!0),e&&ta._registerModules(e))}static _extendModule(e,i,n){if(ta.moduleBindings[e]){var r=ta.moduleBindings[e][i];if(r)if(typeof n=="object")for(let a in n)r[a]=n[a];else console.warn("Module Error - Invalid value type, it must be an object");else console.warn("Module Error - property does not exist:",i)}else console.warn("Module Error - module does not exist:",e)}static _registerModules(e,i){var n=Object.values(e);i&&n.forEach(r=>{r.prototype.moduleCore=!0}),ta._registerModule(n)}static _registerModule(e){Array.isArray(e)||(e=[e]),e.forEach(i=>{ta._registerModuleBinding(i),ta._registerModuleExtensions(i)})}static _registerModuleBinding(e){e.moduleName?ta.moduleBindings[e.moduleName]=e:console.error("Unable to bind module, no moduleName defined",e.moduleName)}static _registerModuleExtensions(e){var i=e.moduleExtensions;if(e.moduleExtensions)for(let n in i){let r=i[n];if(ta.moduleBindings[n])for(let a in r)ta._extendModule(n,a,r[a]);else{ta.moduleExtensions[n]||(ta.moduleExtensions[n]={});for(let a in r)ta.moduleExtensions[n][a]||(ta.moduleExtensions[n][a]={}),Object.assign(ta.moduleExtensions[n][a],r[a])}}ta._extendModuleFromQueue(e)}static _extendModuleFromQueue(e){var i=ta.moduleExtensions[e.moduleName];if(i)for(let n in i)ta._extendModule(e.moduleName,n,i[n])}_bindModules(){var e=[],i=[],n=[];this.modules={};for(var r in ta.moduleBindings){let a=ta.moduleBindings[r],s=new a(this);this.modules[r]=s,a.prototype.moduleCore?this.modulesCore.push(s):a.moduleInitOrder?a.moduleInitOrder<0?e.push(s):i.push(s):n.push(s)}e.sort((a,s)=>a.moduleInitOrder>s.moduleInitOrder?1:-1),i.sort((a,s)=>a.moduleInitOrder>s.moduleInitOrder?1:-1),this.modulesRegular=e.concat(n.concat(i))}};et(ta,"moduleBindings",{}),et(ta,"moduleExtensions",{}),et(ta,"modulesRegistered",!1),et(ta,"defaultModules",!1);let tH=ta;class pQe extends bc{constructor(e){super(e),this.element=this._createAlertElement(),this.msgElement=this._createMsgElement(),this.type=null,this.element.appendChild(this.msgElement)}_createAlertElement(){var e=document.createElement("div");return e.classList.add("tabulator-alert"),e}_createMsgElement(){var e=document.createElement("div");return e.classList.add("tabulator-alert-msg"),e.setAttribute("role","alert"),e}_typeClass(){return"tabulator-alert-state-"+this.type}alert(e,i="msg"){if(e){for(this.clear(),this.dispatch("alert-show",i),this.type=i;this.msgElement.firstChild;)this.msgElement.removeChild(this.msgElement.firstChild);this.msgElement.classList.add(this._typeClass()),typeof e=="function"&&(e=e()),e instanceof HTMLElement?this.msgElement.appendChild(e):this.msgElement.innerHTML=e,this.table.element.appendChild(this.element)}}clear(){this.dispatch("alert-hide",this.type),this.element.parentNode&&this.element.parentNode.removeChild(this.element),this.msgElement.classList.remove(this._typeClass())}}const Xm=class Xm extends tH{static extendModule(){Xm.initializeModuleBinder(),Xm._extendModule(...arguments)}static registerModule(){Xm.initializeModuleBinder(),Xm._registerModule(...arguments)}constructor(e,i,n){super(),Xm.initializeModuleBinder(n),this.options={},this.columnManager=null,this.rowManager=null,this.footerManager=null,this.alertManager=null,this.vdomHoz=null,this.externalEvents=null,this.eventBus=null,this.interactionMonitor=!1,this.browser="",this.browserSlow=!1,this.browserMobile=!1,this.rtl=!1,this.originalElement=null,this.componentFunctionBinder=new tQe(this),this.dataLoader=!1,this.modules={},this.modulesCore=[],this.modulesRegular=[],this.deprecationAdvisor=new aQe(this),this.optionsList=new A1e(this,"table constructor"),this.initialized=!1,this.destroyed=!1,this.initializeElement(e)&&(this.initializeCoreSystems(i),setTimeout(()=>{this._create()})),this.constructor.registry.register(this)}initializeElement(e){return typeof HTMLElement<"u"&&e instanceof HTMLElement?(this.element=e,!0):typeof e=="string"?(this.element=document.querySelector(e),this.element?!0:(console.error("Tabulator Creation Error - no element found matching selector: ",e),!1)):(console.error("Tabulator Creation Error - Invalid element provided:",e),!1)}initializeCoreSystems(e){this.columnManager=new KJe(this),this.rowManager=new JJe(this),this.footerManager=new QJe(this),this.dataLoader=new iQe(this),this.alertManager=new pQe(this),this._bindModules(),this.options=this.optionsList.generate(Xm.defaultOptions,e),this._clearObjectPointers(),this._mapDeprecatedFunctionality(),this.externalEvents=new nQe(this,this.options,this.options.debugEventsExternal),this.eventBus=new rQe(this.options.debugEventsInternal),this.interactionMonitor=new eQe(this),this.dataLoader.initialize(),this.footerManager.initialize()}_mapDeprecatedFunctionality(){}_clearSelection(){this.element.classList.add("tabulator-block-select"),window.getSelection?window.getSelection().empty?window.getSelection().empty():window.getSelection().removeAllRanges&&window.getSelection().removeAllRanges():document.selection&&document.selection.empty(),this.element.classList.remove("tabulator-block-select")}_create(){this.externalEvents.dispatch("tableBuilding"),this.eventBus.dispatch("table-building"),this._rtlCheck(),this._buildElement(),this._initializeTable(),this.initialized=!0,this._loadInitialData().finally(()=>{this.eventBus.dispatch("table-initialized"),this.externalEvents.dispatch("tableBuilt")})}_rtlCheck(){var e=window.getComputedStyle(this.element);switch(this.options.textDirection){case"auto":if(e.direction!=="rtl")break;case"rtl":this.element.classList.add("tabulator-rtl"),this.rtl=!0;break;case"ltr":this.element.classList.add("tabulator-ltr");default:this.rtl=!1}}_clearObjectPointers(){this.options.columns=this.options.columns.slice(0),Array.isArray(this.options.data)&&!this.options.reactiveData&&(this.options.data=this.options.data.slice(0))}_buildElement(){var e=this.element,i=this.options,n;if(e.tagName==="TABLE"){this.originalElement=this.element,n=document.createElement("div");var r=e.attributes;for(var a in r)typeof r[a]=="object"&&n.setAttribute(r[a].name,r[a].value);e.parentNode.replaceChild(n,e),this.element=e=n}for(e.classList.add("tabulator"),e.setAttribute("role","grid");e.firstChild;)e.removeChild(e.firstChild);i.height&&(i.height=isNaN(i.height)?i.height:i.height+"px",e.style.height=i.height),i.minHeight!==!1&&(i.minHeight=isNaN(i.minHeight)?i.minHeight:i.minHeight+"px",e.style.minHeight=i.minHeight),i.maxHeight!==!1&&(i.maxHeight=isNaN(i.maxHeight)?i.maxHeight:i.maxHeight+"px",e.style.maxHeight=i.maxHeight)}_initializeTable(){var e=this.element,i=this.options;this.interactionMonitor.initialize(),this.columnManager.initialize(),this.rowManager.initialize(),this._detectBrowser(),this.modulesCore.forEach(n=>{n.initialize()}),e.appendChild(this.columnManager.getElement()),e.appendChild(this.rowManager.getElement()),i.footerElement&&this.footerManager.activate(),i.autoColumns&&i.data&&this.columnManager.generateColumnsFromRowData(this.options.data),this.modulesRegular.forEach(n=>{n.initialize()}),this.columnManager.setColumns(i.columns),this.eventBus.dispatch("table-built")}_loadInitialData(){return this.dataLoader.load(this.options.data).finally(()=>{this.columnManager.verticalAlignHeaders()})}destroy(){var e=this.element;for(this.destroyed=!0,this.constructor.registry.deregister(this),this.eventBus.dispatch("table-destroy"),this.rowManager.destroy();e.firstChild;)e.removeChild(e.firstChild);e.classList.remove("tabulator"),this.externalEvents.dispatch("tableDestroyed")}_detectBrowser(){var e=navigator.userAgent||navigator.vendor||window.opera;e.indexOf("Trident")>-1?(this.browser="ie",this.browserSlow=!0):e.indexOf("Edge")>-1?(this.browser="edge",this.browserSlow=!0):e.indexOf("Firefox")>-1?(this.browser="firefox",this.browserSlow=!1):e.indexOf("Mac OS")>-1?(this.browser="safari",this.browserSlow=!1):(this.browser="other",this.browserSlow=!1),this.browserMobile=/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw-(n|u)|c55\/|capi|ccwa|cdm-|cell|chtm|cldc|cmd-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc-s|devi|dica|dmob|do(c|p)o|ds(12|-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(-|_)|g1 u|g560|gene|gf-5|g-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd-(m|p|t)|hei-|hi(pt|ta)|hp( i|ip)|hs-c|ht(c(-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i-(20|go|ma)|i230|iac( |-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|-[a-w])|libw|lynx|m1-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|-([1-8]|c))|phil|pire|pl(ay|uc)|pn-2|po(ck|rt|se)|prox|psio|pt-g|qa-a|qc(07|12|21|32|60|-[2-7]|i-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h-|oo|p-)|sdk\/|se(c(-|0|1)|47|mc|nd|ri)|sgh-|shar|sie(-|m)|sk-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h-|v-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl-|tdg-|tel(i|m)|tim-|t-mo|to(pl|sh)|ts(70|m-|m3|m5)|tx-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas-|your|zeto|zte-/i.test(e.slice(0,4))}initGuard(e,i){var n,r;return this.options.debugInitialization&&!this.initialized&&(e||(n=new Error().stack.split(`
`),r=n[0]=="Error"?n[2]:n[1],r[0]==" "?e=r.trim().split(" ")[1].split(".")[1]:e=r.trim().split("@")[0]),console.warn("Table Not Initialized - Calling the "+e+" function before the table is initialized may result in inconsistent behavior, Please wait for the `tableBuilt` event before calling this function."+(i?" "+i:""))),this.initialized}blockRedraw(){this.initGuard(),this.eventBus.dispatch("redraw-blocking"),this.rowManager.blockRedraw(),this.columnManager.blockRedraw(),this.eventBus.dispatch("redraw-blocked")}restoreRedraw(){this.initGuard(),this.eventBus.dispatch("redraw-restoring"),this.rowManager.restoreRedraw(),this.columnManager.restoreRedraw(),this.eventBus.dispatch("redraw-restored")}setData(e,i,n){return this.initGuard(!1,"To set initial data please use the 'data' property in the table constructor."),this.dataLoader.load(e,i,n,!1)}clearData(){this.initGuard(),this.dataLoader.blockActiveLoad(),this.rowManager.clearData()}getData(e){return this.rowManager.getData(e)}getDataCount(e){return this.rowManager.getDataCount(e)}replaceData(e,i,n){return this.initGuard(),this.dataLoader.load(e,i,n,!0,!0)}updateData(e){var i=0;return this.initGuard(),new Promise((n,r)=>{this.dataLoader.blockActiveLoad(),typeof e=="string"&&(e=JSON.parse(e)),e&&e.length>0?e.forEach(a=>{var s=this.rowManager.findRow(a[this.options.index]);s?(i++,s.updateData(a).then(()=>{i--,i||n()}).catch(o=>{r("Update Error - Unable to update row",a,o)})):r("Update Error - Unable to find row",a)}):(console.warn("Update Error - No data provided"),r("Update Error - No data provided"))})}addData(e,i,n){return this.initGuard(),new Promise((r,a)=>{this.dataLoader.blockActiveLoad(),typeof e=="string"&&(e=JSON.parse(e)),e?this.rowManager.addRows(e,i,n).then(s=>{var o=[];s.forEach(function(l){o.push(l.getComponent())}),r(o)}):(console.warn("Update Error - No data provided"),a("Update Error - No data provided"))})}updateOrAddData(e){var i=[],n=0;return this.initGuard(),new Promise((r,a)=>{this.dataLoader.blockActiveLoad(),typeof e=="string"&&(e=JSON.parse(e)),e&&e.length>0?e.forEach(s=>{var o=this.rowManager.findRow(s[this.options.index]);n++,o?o.updateData(s).then(()=>{n--,i.push(o.getComponent()),n||r(i)}):this.rowManager.addRows(s).then(l=>{n--,i.push(l[0].getComponent()),n||r(i)})}):(console.warn("Update Error - No data provided"),a("Update Error - No data provided"))})}getRow(e){var i=this.rowManager.findRow(e);return i?i.getComponent():(console.warn("Find Error - No matching row found:",e),!1)}getRowFromPosition(e){var i=this.rowManager.getRowFromPosition(e);return i?i.getComponent():(console.warn("Find Error - No matching row found:",e),!1)}deleteRow(e){var i=[];this.initGuard(),Array.isArray(e)||(e=[e]);for(let n of e){let r=this.rowManager.findRow(n,!0);if(r)i.push(r);else return console.error("Delete Error - No matching row found:",n),Promise.reject("Delete Error - No matching row found")}return i.sort((n,r)=>this.rowManager.rows.indexOf(n)>this.rowManager.rows.indexOf(r)?1:-1),i.forEach(n=>{n.delete()}),this.rowManager.reRenderInPosition(),Promise.resolve()}addRow(e,i,n){return this.initGuard(),typeof e=="string"&&(e=JSON.parse(e)),this.rowManager.addRows(e,i,n,!0).then(r=>r[0].getComponent())}updateOrAddRow(e,i){var n=this.rowManager.findRow(e);return this.initGuard(),typeof i=="string"&&(i=JSON.parse(i)),n?n.updateData(i).then(()=>n.getComponent()):this.rowManager.addRows(i).then(r=>r[0].getComponent())}updateRow(e,i){var n=this.rowManager.findRow(e);return this.initGuard(),typeof i=="string"&&(i=JSON.parse(i)),n?n.updateData(i).then(()=>Promise.resolve(n.getComponent())):(console.warn("Update Error - No matching row found:",e),Promise.reject("Update Error - No matching row found"))}scrollToRow(e,i,n){var r=this.rowManager.findRow(e);return r?this.rowManager.scrollToRow(r,i,n):(console.warn("Scroll Error - No matching row found:",e),Promise.reject("Scroll Error - No matching row found"))}moveRow(e,i,n){var r=this.rowManager.findRow(e);this.initGuard(),r?r.moveToRow(i,n):console.warn("Move Error - No matching row found:",e)}getRows(e){return this.rowManager.getComponents(e)}getRowPosition(e){var i=this.rowManager.findRow(e);return i?i.getPosition():(console.warn("Position Error - No matching row found:",e),!1)}setColumns(e){this.initGuard(!1,"To set initial columns please use the 'columns' property in the table constructor"),this.columnManager.setColumns(e)}getColumns(e){return this.columnManager.getComponents(e)}getColumn(e){var i=this.columnManager.findColumn(e);return i?i.getComponent():(console.warn("Find Error - No matching column found:",e),!1)}getColumnDefinitions(){return this.columnManager.getDefinitionTree()}showColumn(e){var i=this.columnManager.findColumn(e);if(this.initGuard(),i)i.show();else return console.warn("Column Show Error - No matching column found:",e),!1}hideColumn(e){var i=this.columnManager.findColumn(e);if(this.initGuard(),i)i.hide();else return console.warn("Column Hide Error - No matching column found:",e),!1}toggleColumn(e){var i=this.columnManager.findColumn(e);if(this.initGuard(),i)i.visible?i.hide():i.show();else return console.warn("Column Visibility Toggle Error - No matching column found:",e),!1}addColumn(e,i,n){var r=this.columnManager.findColumn(n);return this.initGuard(),this.columnManager.addColumn(e,i,r).then(a=>a.getComponent())}deleteColumn(e){var i=this.columnManager.findColumn(e);return this.initGuard(),i?i.delete():(console.warn("Column Delete Error - No matching column found:",e),Promise.reject())}updateColumnDefinition(e,i){var n=this.columnManager.findColumn(e);return this.initGuard(),n?n.updateDefinition(i):(console.warn("Column Update Error - No matching column found:",e),Promise.reject())}moveColumn(e,i,n){var r=this.columnManager.findColumn(e),a=this.columnManager.findColumn(i);this.initGuard(),r?a?this.columnManager.moveColumn(r,a,n):console.warn("Move Error - No matching column found:",a):console.warn("Move Error - No matching column found:",e)}scrollToColumn(e,i,n){return new Promise((r,a)=>{var s=this.columnManager.findColumn(e);return s?this.columnManager.scrollToColumn(s,i,n):(console.warn("Scroll Error - No matching column found:",e),Promise.reject("Scroll Error - No matching column found"))})}redraw(e){this.initGuard(),this.columnManager.redraw(e),this.rowManager.redraw(e)}setHeight(e){this.options.height=isNaN(e)?e:e+"px",this.element.style.height=this.options.height,this.rowManager.initializeRenderer(),this.rowManager.redraw(!0)}on(e,i){this.externalEvents.subscribe(e,i)}off(e,i){this.externalEvents.unsubscribe(e,i)}dispatchEvent(){var e=Array.from(arguments);e.shift(),this.externalEvents.dispatch(...arguments)}alert(e,i){this.initGuard(),this.alertManager.alert(e,i)}clearAlert(){this.initGuard(),this.alertManager.clear()}modExists(e,i){return this.modules[e]?!0:(i&&console.error("Tabulator Module Not Installed: "+e),!1)}module(e){var i=this.modules[e];return i||console.error("Tabulator module not installed: "+e),i}};et(Xm,"defaultOptions",qJe);let iH=Xm;var M1=iH;class hQe extends M1{static extendModule(){M1.initializeModuleBinder(cB),M1._extendModule(...arguments)}static registerModule(){M1.initializeModuleBinder(cB),M1._registerModule(...arguments)}constructor(e,i,n){super(e,i,cB)}}var As=hQe;const{MALE:fQe,FEMALE:mQe}=jp;function gQe(t){var s;const e=t.getValue(),i=t.getRow().getData(),n=i.sex||((s=i.person)==null?void 0:s.sex),r=(n==null?void 0:n.toUpperCase())===fQe&&"#2E86C1"||(n==null?void 0:n.toUpperCase())===mQe&&"#AA336A"||"",a=document.createElement("div");return a.style.color=r,a.innerHTML=e,a}function vQe(t){return[{visible:t.some(i=>i.drawPosition),field:"drawPosition",title:"Position",headerSort:!1,responsive:!1,editor:!1,maxWidth:100},{formatter:gQe,field:"participantName",title:"Participant",responsive:!1,minWidth:200,widthGrow:2}]}function k1e(t){let{data:e=[]}=t;const{selectedParticipantIds:i,selectionLimit:n=1,targetAttribute:r,placeholder:a,onSelected:s,anchorId:o}=t;e.some(p=>p.participant)&&(e=e.map(({participant:p,...h})=>({...h,participantName:"BYE",...p}))),e.forEach(p=>{var h;return p.searchText=(h=p.participantName)==null?void 0:h.toLowerCase()});const c=vQe(e),u=document.getElementById(o),d=new As(u,{placeholder:a||"No options",selectableRows:n,index:r,layout:"fitColumns",reactiveData:!0,maxHeight:350,columns:c,data:e});return It.tables||(It.tables={}),It.tables.selectionTable=d,d.on("tableBuilt",()=>{i!=null&&i.length&&d.selectRow(i)}),d.on("rowSelectionChanged",(p,h)=>{const f=h==null?void 0:h.map(m=>m.getData());Ot(s)&&s(f)}),{table:d}}function uY(t){const{title:e,placeholder:i,options:n,selectionLimit:r}=t,a="selectionControl",s="selectionTable",o=[{label:"Cancel",intent:"is-none",close:!0}],l=()=>{const m=It.tables.selectionTable;m==null||m.destroy(),delete It.tables.selectionTable},c=`
    <div style='min-height: 420px'>
      <div id='${a}'></div>
      <div id='${s}'></div>
    </div>
  `;er({title:e,content:c,buttons:o,onClose:l});const u=m=>{var g;(g=m==null?void 0:m[0])!=null&&g.onClick&&(m[0].onClick(),AI())},{table:d}=k1e({targetAttribute:"participantid",selectionLimit:r,data:n,placeholder:i,onSelected:u,anchorId:s}),p=zw(d),h=[{onKeyDown:m=>m.keyCode===8&&m.target.value.length===1&&p(""),onChange:m=>p(m.target.value),onKeyUp:m=>p(m.target.value),clearSearch:()=>p(""),placeholder:"Search",location:pi,search:!0}],f=document.getElementById(a);Io({table:d,target:f,items:h})}var ju="top",Bp="bottom",Vp="right",Gu="left",dY="auto",yM=[ju,Bp,Vp,Gu],PT="start",oP="end",yQe="clippingParents",x1e="viewport",N1="popper",bQe="reference",lQ=yM.reduce(function(t,e){return t.concat([e+"-"+PT,e+"-"+oP])},[]),O1e=[].concat(yM,[dY]).reduce(function(t,e){return t.concat([e,e+"-"+PT,e+"-"+oP])},[]),IQe="beforeRead",wQe="read",SQe="afterRead",TQe="beforeMain",UQe="main",DQe="afterMain",EQe="beforeWrite",PQe="write",CQe="afterWrite",RQe=[IQe,wQe,SQe,TQe,UQe,DQe,EQe,PQe,CQe];function um(t){return t?(t.nodeName||"").toLowerCase():null}function $d(t){if(t==null)return window;if(t.toString()!=="[object Window]"){var e=t.ownerDocument;return e&&e.defaultView||window}return t}function _I(t){var e=$d(t).Element;return t instanceof e||t instanceof Element}function Sp(t){var e=$d(t).HTMLElement;return t instanceof e||t instanceof HTMLElement}function pY(t){if(typeof ShadowRoot>"u")return!1;var e=$d(t).ShadowRoot;return t instanceof e||t instanceof ShadowRoot}function MQe(t){var e=t.state;Object.keys(e.elements).forEach(function(i){var n=e.styles[i]||{},r=e.attributes[i]||{},a=e.elements[i];!Sp(a)||!um(a)||(Object.assign(a.style,n),Object.keys(r).forEach(function(s){var o=r[s];o===!1?a.removeAttribute(s):a.setAttribute(s,o===!0?"":o)}))})}function NQe(t){var e=t.state,i={popper:{position:e.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};return Object.assign(e.elements.popper.style,i.popper),e.styles=i,e.elements.arrow&&Object.assign(e.elements.arrow.style,i.arrow),function(){Object.keys(e.elements).forEach(function(n){var r=e.elements[n],a=e.attributes[n]||{},s=Object.keys(e.styles.hasOwnProperty(n)?e.styles[n]:i[n]),o=s.reduce(function(l,c){return l[c]="",l},{});!Sp(r)||!um(r)||(Object.assign(r.style,o),Object.keys(a).forEach(function(l){r.removeAttribute(l)}))})}}const L1e={name:"applyStyles",enabled:!0,phase:"write",fn:MQe,effect:NQe,requires:["computeStyles"]};function Of(t){return t.split("-")[0]}var nI=Math.max,vk=Math.min,CT=Math.round;function nH(){var t=navigator.userAgentData;return t!=null&&t.brands&&Array.isArray(t.brands)?t.brands.map(function(e){return e.brand+"/"+e.version}).join(" "):navigator.userAgent}function F1e(){return!/^((?!chrome|android).)*safari/i.test(nH())}function RT(t,e,i){e===void 0&&(e=!1),i===void 0&&(i=!1);var n=t.getBoundingClientRect(),r=1,a=1;e&&Sp(t)&&(r=t.offsetWidth>0&&CT(n.width)/t.offsetWidth||1,a=t.offsetHeight>0&&CT(n.height)/t.offsetHeight||1);var s=_I(t)?$d(t):window,o=s.visualViewport,l=!F1e()&&i,c=(n.left+(l&&o?o.offsetLeft:0))/r,u=(n.top+(l&&o?o.offsetTop:0))/a,d=n.width/r,p=n.height/a;return{width:d,height:p,top:u,right:c+d,bottom:u+p,left:c,x:c,y:u}}function hY(t){var e=RT(t),i=t.offsetWidth,n=t.offsetHeight;return Math.abs(e.width-i)<=1&&(i=e.width),Math.abs(e.height-n)<=1&&(n=e.height),{x:t.offsetLeft,y:t.offsetTop,width:i,height:n}}function $1e(t,e){var i=e.getRootNode&&e.getRootNode();if(t.contains(e))return!0;if(i&&pY(i)){var n=e;do{if(n&&t.isSameNode(n))return!0;n=n.parentNode||n.host}while(n)}return!1}function Rg(t){return $d(t).getComputedStyle(t)}function AQe(t){return["table","td","th"].indexOf(um(t))>=0}function lb(t){return((_I(t)?t.ownerDocument:t.document)||window.document).documentElement}function C2(t){return um(t)==="html"?t:t.assignedSlot||t.parentNode||(pY(t)?t.host:null)||lb(t)}function cQ(t){return!Sp(t)||Rg(t).position==="fixed"?null:t.offsetParent}function _Qe(t){var e=/firefox/i.test(nH()),i=/Trident/i.test(nH());if(i&&Sp(t)){var n=Rg(t);if(n.position==="fixed")return null}var r=C2(t);for(pY(r)&&(r=r.host);Sp(r)&&["html","body"].indexOf(um(r))<0;){var a=Rg(r);if(a.transform!=="none"||a.perspective!=="none"||a.contain==="paint"||["transform","perspective"].indexOf(a.willChange)!==-1||e&&a.willChange==="filter"||e&&a.filter&&a.filter!=="none")return r;r=r.parentNode}return null}function bM(t){for(var e=$d(t),i=cQ(t);i&&AQe(i)&&Rg(i).position==="static";)i=cQ(i);return i&&(um(i)==="html"||um(i)==="body"&&Rg(i).position==="static")?e:i||_Qe(t)||e}function fY(t){return["top","bottom"].indexOf(t)>=0?"x":"y"}function CD(t,e,i){return nI(t,vk(e,i))}function kQe(t,e,i){var n=CD(t,e,i);return n>i?i:n}function B1e(){return{top:0,right:0,bottom:0,left:0}}function V1e(t){return Object.assign({},B1e(),t)}function j1e(t,e){return e.reduce(function(i,n){return i[n]=t,i},{})}var xQe=function(e,i){return e=typeof e=="function"?e(Object.assign({},i.rects,{placement:i.placement})):e,V1e(typeof e!="number"?e:j1e(e,yM))};function OQe(t){var e,i=t.state,n=t.name,r=t.options,a=i.elements.arrow,s=i.modifiersData.popperOffsets,o=Of(i.placement),l=fY(o),c=[Gu,Vp].indexOf(o)>=0,u=c?"height":"width";if(!(!a||!s)){var d=xQe(r.padding,i),p=hY(a),h=l==="y"?ju:Gu,f=l==="y"?Bp:Vp,m=i.rects.reference[u]+i.rects.reference[l]-s[l]-i.rects.popper[u],g=s[l]-i.rects.reference[l],v=bM(a),y=v?l==="y"?v.clientHeight||0:v.clientWidth||0:0,b=m/2-g/2,I=d[h],T=y-p[u]-d[f],w=y/2-p[u]/2+b,S=CD(I,w,T),U=l;i.modifiersData[n]=(e={},e[U]=S,e.centerOffset=S-w,e)}}function LQe(t){var e=t.state,i=t.options,n=i.element,r=n===void 0?"[data-popper-arrow]":n;r!=null&&(typeof r=="string"&&(r=e.elements.popper.querySelector(r),!r)||$1e(e.elements.popper,r)&&(e.elements.arrow=r))}const FQe={name:"arrow",enabled:!0,phase:"main",fn:OQe,effect:LQe,requires:["popperOffsets"],requiresIfExists:["preventOverflow"]};function MT(t){return t.split("-")[1]}var $Qe={top:"auto",right:"auto",bottom:"auto",left:"auto"};function BQe(t,e){var i=t.x,n=t.y,r=e.devicePixelRatio||1;return{x:CT(i*r)/r||0,y:CT(n*r)/r||0}}function uQ(t){var e,i=t.popper,n=t.popperRect,r=t.placement,a=t.variation,s=t.offsets,o=t.position,l=t.gpuAcceleration,c=t.adaptive,u=t.roundOffsets,d=t.isFixed,p=s.x,h=p===void 0?0:p,f=s.y,m=f===void 0?0:f,g=typeof u=="function"?u({x:h,y:m}):{x:h,y:m};h=g.x,m=g.y;var v=s.hasOwnProperty("x"),y=s.hasOwnProperty("y"),b=Gu,I=ju,T=window;if(c){var w=bM(i),S="clientHeight",U="clientWidth";if(w===$d(i)&&(w=lb(i),Rg(w).position!=="static"&&o==="absolute"&&(S="scrollHeight",U="scrollWidth")),w=w,r===ju||(r===Gu||r===Vp)&&a===oP){I=Bp;var P=d&&w===T&&T.visualViewport?T.visualViewport.height:w[S];m-=P-n.height,m*=l?1:-1}if(r===Gu||(r===ju||r===Bp)&&a===oP){b=Vp;var E=d&&w===T&&T.visualViewport?T.visualViewport.width:w[U];h-=E-n.width,h*=l?1:-1}}var R=Object.assign({position:o},c&&$Qe),C=u===!0?BQe({x:h,y:m},$d(i)):{x:h,y:m};if(h=C.x,m=C.y,l){var M;return Object.assign({},R,(M={},M[I]=y?"0":"",M[b]=v?"0":"",M.transform=(T.devicePixelRatio||1)<=1?"translate("+h+"px, "+m+"px)":"translate3d("+h+"px, "+m+"px, 0)",M))}return Object.assign({},R,(e={},e[I]=y?m+"px":"",e[b]=v?h+"px":"",e.transform="",e))}function VQe(t){var e=t.state,i=t.options,n=i.gpuAcceleration,r=n===void 0?!0:n,a=i.adaptive,s=a===void 0?!0:a,o=i.roundOffsets,l=o===void 0?!0:o,c={placement:Of(e.placement),variation:MT(e.placement),popper:e.elements.popper,popperRect:e.rects.popper,gpuAcceleration:r,isFixed:e.options.strategy==="fixed"};e.modifiersData.popperOffsets!=null&&(e.styles.popper=Object.assign({},e.styles.popper,uQ(Object.assign({},c,{offsets:e.modifiersData.popperOffsets,position:e.options.strategy,adaptive:s,roundOffsets:l})))),e.modifiersData.arrow!=null&&(e.styles.arrow=Object.assign({},e.styles.arrow,uQ(Object.assign({},c,{offsets:e.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:l})))),e.attributes.popper=Object.assign({},e.attributes.popper,{"data-popper-placement":e.placement})}const jQe={name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:VQe,data:{}};var JM={passive:!0};function GQe(t){var e=t.state,i=t.instance,n=t.options,r=n.scroll,a=r===void 0?!0:r,s=n.resize,o=s===void 0?!0:s,l=$d(e.elements.popper),c=[].concat(e.scrollParents.reference,e.scrollParents.popper);return a&&c.forEach(function(u){u.addEventListener("scroll",i.update,JM)}),o&&l.addEventListener("resize",i.update,JM),function(){a&&c.forEach(function(u){u.removeEventListener("scroll",i.update,JM)}),o&&l.removeEventListener("resize",i.update,JM)}}const HQe={name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect:GQe,data:{}};var zQe={left:"right",right:"left",bottom:"top",top:"bottom"};function gA(t){return t.replace(/left|right|bottom|top/g,function(e){return zQe[e]})}var qQe={start:"end",end:"start"};function dQ(t){return t.replace(/start|end/g,function(e){return qQe[e]})}function mY(t){var e=$d(t),i=e.pageXOffset,n=e.pageYOffset;return{scrollLeft:i,scrollTop:n}}function gY(t){return RT(lb(t)).left+mY(t).scrollLeft}function WQe(t,e){var i=$d(t),n=lb(t),r=i.visualViewport,a=n.clientWidth,s=n.clientHeight,o=0,l=0;if(r){a=r.width,s=r.height;var c=F1e();(c||!c&&e==="fixed")&&(o=r.offsetLeft,l=r.offsetTop)}return{width:a,height:s,x:o+gY(t),y:l}}function YQe(t){var e,i=lb(t),n=mY(t),r=(e=t.ownerDocument)==null?void 0:e.body,a=nI(i.scrollWidth,i.clientWidth,r?r.scrollWidth:0,r?r.clientWidth:0),s=nI(i.scrollHeight,i.clientHeight,r?r.scrollHeight:0,r?r.clientHeight:0),o=-n.scrollLeft+gY(t),l=-n.scrollTop;return Rg(r||i).direction==="rtl"&&(o+=nI(i.clientWidth,r?r.clientWidth:0)-a),{width:a,height:s,x:o,y:l}}function vY(t){var e=Rg(t),i=e.overflow,n=e.overflowX,r=e.overflowY;return/auto|scroll|overlay|hidden/.test(i+r+n)}function G1e(t){return["html","body","#document"].indexOf(um(t))>=0?t.ownerDocument.body:Sp(t)&&vY(t)?t:G1e(C2(t))}function RD(t,e){var i;e===void 0&&(e=[]);var n=G1e(t),r=n===((i=t.ownerDocument)==null?void 0:i.body),a=$d(n),s=r?[a].concat(a.visualViewport||[],vY(n)?n:[]):n,o=e.concat(s);return r?o:o.concat(RD(C2(s)))}function rH(t){return Object.assign({},t,{left:t.x,top:t.y,right:t.x+t.width,bottom:t.y+t.height})}function KQe(t,e){var i=RT(t,!1,e==="fixed");return i.top=i.top+t.clientTop,i.left=i.left+t.clientLeft,i.bottom=i.top+t.clientHeight,i.right=i.left+t.clientWidth,i.width=t.clientWidth,i.height=t.clientHeight,i.x=i.left,i.y=i.top,i}function pQ(t,e,i){return e===x1e?rH(WQe(t,i)):_I(e)?KQe(e,i):rH(YQe(lb(t)))}function ZQe(t){var e=RD(C2(t)),i=["absolute","fixed"].indexOf(Rg(t).position)>=0,n=i&&Sp(t)?bM(t):t;return _I(n)?e.filter(function(r){return _I(r)&&$1e(r,n)&&um(r)!=="body"}):[]}function XQe(t,e,i,n){var r=e==="clippingParents"?ZQe(t):[].concat(e),a=[].concat(r,[i]),s=a[0],o=a.reduce(function(l,c){var u=pQ(t,c,n);return l.top=nI(u.top,l.top),l.right=vk(u.right,l.right),l.bottom=vk(u.bottom,l.bottom),l.left=nI(u.left,l.left),l},pQ(t,s,n));return o.width=o.right-o.left,o.height=o.bottom-o.top,o.x=o.left,o.y=o.top,o}function H1e(t){var e=t.reference,i=t.element,n=t.placement,r=n?Of(n):null,a=n?MT(n):null,s=e.x+e.width/2-i.width/2,o=e.y+e.height/2-i.height/2,l;switch(r){case ju:l={x:s,y:e.y-i.height};break;case Bp:l={x:s,y:e.y+e.height};break;case Vp:l={x:e.x+e.width,y:o};break;case Gu:l={x:e.x-i.width,y:o};break;default:l={x:e.x,y:e.y}}var c=r?fY(r):null;if(c!=null){var u=c==="y"?"height":"width";switch(a){case PT:l[c]=l[c]-(e[u]/2-i[u]/2);break;case oP:l[c]=l[c]+(e[u]/2-i[u]/2);break}}return l}function lP(t,e){e===void 0&&(e={});var i=e,n=i.placement,r=n===void 0?t.placement:n,a=i.strategy,s=a===void 0?t.strategy:a,o=i.boundary,l=o===void 0?yQe:o,c=i.rootBoundary,u=c===void 0?x1e:c,d=i.elementContext,p=d===void 0?N1:d,h=i.altBoundary,f=h===void 0?!1:h,m=i.padding,g=m===void 0?0:m,v=V1e(typeof g!="number"?g:j1e(g,yM)),y=p===N1?bQe:N1,b=t.rects.popper,I=t.elements[f?y:p],T=XQe(_I(I)?I:I.contextElement||lb(t.elements.popper),l,u,s),w=RT(t.elements.reference),S=H1e({reference:w,element:b,strategy:"absolute",placement:r}),U=rH(Object.assign({},b,S)),P=p===N1?U:w,E={top:T.top-P.top+v.top,bottom:P.bottom-T.bottom+v.bottom,left:T.left-P.left+v.left,right:P.right-T.right+v.right},R=t.modifiersData.offset;if(p===N1&&R){var C=R[r];Object.keys(E).forEach(function(M){var _=[Vp,Bp].indexOf(M)>=0?1:-1,A=[ju,Bp].indexOf(M)>=0?"y":"x";E[M]+=C[A]*_})}return E}function JQe(t,e){e===void 0&&(e={});var i=e,n=i.placement,r=i.boundary,a=i.rootBoundary,s=i.padding,o=i.flipVariations,l=i.allowedAutoPlacements,c=l===void 0?O1e:l,u=MT(n),d=u?o?lQ:lQ.filter(function(f){return MT(f)===u}):yM,p=d.filter(function(f){return c.indexOf(f)>=0});p.length===0&&(p=d);var h=p.reduce(function(f,m){return f[m]=lP(t,{placement:m,boundary:r,rootBoundary:a,padding:s})[Of(m)],f},{});return Object.keys(h).sort(function(f,m){return h[f]-h[m]})}function QQe(t){if(Of(t)===dY)return[];var e=gA(t);return[dQ(t),e,dQ(e)]}function eet(t){var e=t.state,i=t.options,n=t.name;if(!e.modifiersData[n]._skip){for(var r=i.mainAxis,a=r===void 0?!0:r,s=i.altAxis,o=s===void 0?!0:s,l=i.fallbackPlacements,c=i.padding,u=i.boundary,d=i.rootBoundary,p=i.altBoundary,h=i.flipVariations,f=h===void 0?!0:h,m=i.allowedAutoPlacements,g=e.options.placement,v=Of(g),y=v===g,b=l||(y||!f?[gA(g)]:QQe(g)),I=[g].concat(b).reduce(function(z,W){return z.concat(Of(W)===dY?JQe(e,{placement:W,boundary:u,rootBoundary:d,padding:c,flipVariations:f,allowedAutoPlacements:m}):W)},[]),T=e.rects.reference,w=e.rects.popper,S=new Map,U=!0,P=I[0],E=0;E<I.length;E++){var R=I[E],C=Of(R),M=MT(R)===PT,_=[ju,Bp].indexOf(C)>=0,A=_?"width":"height",N=lP(e,{placement:R,boundary:u,rootBoundary:d,altBoundary:p,padding:c}),k=_?M?Vp:Gu:M?Bp:ju;T[A]>w[A]&&(k=gA(k));var O=gA(k),$=[];if(a&&$.push(N[C]<=0),o&&$.push(N[k]<=0,N[O]<=0),$.every(function(z){return z})){P=R,U=!1;break}S.set(R,$)}if(U)for(var F=f?3:1,V=function(W){var Z=I.find(function(K){var Q=S.get(K);if(Q)return Q.slice(0,W).every(function(J){return J})});if(Z)return P=Z,"break"},j=F;j>0;j--){var B=V(j);if(B==="break")break}e.placement!==P&&(e.modifiersData[n]._skip=!0,e.placement=P,e.reset=!0)}}const tet={name:"flip",enabled:!0,phase:"main",fn:eet,requiresIfExists:["offset"],data:{_skip:!1}};function hQ(t,e,i){return i===void 0&&(i={x:0,y:0}),{top:t.top-e.height-i.y,right:t.right-e.width+i.x,bottom:t.bottom-e.height+i.y,left:t.left-e.width-i.x}}function fQ(t){return[ju,Vp,Bp,Gu].some(function(e){return t[e]>=0})}function iet(t){var e=t.state,i=t.name,n=e.rects.reference,r=e.rects.popper,a=e.modifiersData.preventOverflow,s=lP(e,{elementContext:"reference"}),o=lP(e,{altBoundary:!0}),l=hQ(s,n),c=hQ(o,r,a),u=fQ(l),d=fQ(c);e.modifiersData[i]={referenceClippingOffsets:l,popperEscapeOffsets:c,isReferenceHidden:u,hasPopperEscaped:d},e.attributes.popper=Object.assign({},e.attributes.popper,{"data-popper-reference-hidden":u,"data-popper-escaped":d})}const net={name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"],fn:iet};function ret(t,e,i){var n=Of(t),r=[Gu,ju].indexOf(n)>=0?-1:1,a=typeof i=="function"?i(Object.assign({},e,{placement:t})):i,s=a[0],o=a[1];return s=s||0,o=(o||0)*r,[Gu,Vp].indexOf(n)>=0?{x:o,y:s}:{x:s,y:o}}function aet(t){var e=t.state,i=t.options,n=t.name,r=i.offset,a=r===void 0?[0,0]:r,s=O1e.reduce(function(u,d){return u[d]=ret(d,e.rects,a),u},{}),o=s[e.placement],l=o.x,c=o.y;e.modifiersData.popperOffsets!=null&&(e.modifiersData.popperOffsets.x+=l,e.modifiersData.popperOffsets.y+=c),e.modifiersData[n]=s}const set={name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:aet};function oet(t){var e=t.state,i=t.name;e.modifiersData[i]=H1e({reference:e.rects.reference,element:e.rects.popper,strategy:"absolute",placement:e.placement})}const cet={name:"popperOffsets",enabled:!0,phase:"read",fn:oet,data:{}};function uet(t){return t==="x"?"y":"x"}function det(t){var e=t.state,i=t.options,n=t.name,r=i.mainAxis,a=r===void 0?!0:r,s=i.altAxis,o=s===void 0?!1:s,l=i.boundary,c=i.rootBoundary,u=i.altBoundary,d=i.padding,p=i.tether,h=p===void 0?!0:p,f=i.tetherOffset,m=f===void 0?0:f,g=lP(e,{boundary:l,rootBoundary:c,padding:d,altBoundary:u}),v=Of(e.placement),y=MT(e.placement),b=!y,I=fY(v),T=uet(I),w=e.modifiersData.popperOffsets,S=e.rects.reference,U=e.rects.popper,P=typeof m=="function"?m(Object.assign({},e.rects,{placement:e.placement})):m,E=typeof P=="number"?{mainAxis:P,altAxis:P}:Object.assign({mainAxis:0,altAxis:0},P),R=e.modifiersData.offset?e.modifiersData.offset[e.placement]:null,C={x:0,y:0};if(w){if(a){var M,_=I==="y"?ju:Gu,A=I==="y"?Bp:Vp,N=I==="y"?"height":"width",k=w[I],O=k+g[_],$=k-g[A],F=h?-U[N]/2:0,V=y===PT?S[N]:U[N],j=y===PT?-U[N]:-S[N],B=e.elements.arrow,z=h&&B?hY(B):{width:0,height:0},W=e.modifiersData["arrow#persistent"]?e.modifiersData["arrow#persistent"].padding:B1e(),Z=W[_],K=W[A],Q=CD(0,S[N],z[N]),J=b?S[N]/2-F-Q-Z-E.mainAxis:V-Q-Z-E.mainAxis,se=b?-S[N]/2+F+Q+K+E.mainAxis:j+Q+K+E.mainAxis,ie=e.elements.arrow&&bM(e.elements.arrow),ce=ie?I==="y"?ie.clientTop||0:ie.clientLeft||0:0,oe=(M=R==null?void 0:R[I])!=null?M:0,te=k+J-oe-ce,le=k+se-oe,ne=CD(h?vk(O,te):O,k,h?nI($,le):$);w[I]=ne,C[I]=ne-k}if(o){var me,be=I==="x"?ju:Gu,Se=I==="x"?Bp:Vp,we=w[T],ze=T==="y"?"height":"width",Qe=we+g[be],ke=we-g[Se],yt=[ju,Gu].indexOf(v)!==-1,lt=(me=R==null?void 0:R[T])!=null?me:0,Ct=yt?Qe:we-S[ze]-U[ze]-lt+E.altAxis,Nt=yt?we+S[ze]+U[ze]-lt-E.altAxis:ke,Ce=h&&yt?kQe(Ct,we,Nt):CD(h?Ct:Qe,we,h?Nt:ke);w[T]=Ce,C[T]=Ce-we}e.modifiersData[n]=C}}const pet={name:"preventOverflow",enabled:!0,phase:"main",fn:det,requiresIfExists:["offset"]};function het(t){return{scrollLeft:t.scrollLeft,scrollTop:t.scrollTop}}function fet(t){return t===$d(t)||!Sp(t)?mY(t):het(t)}function met(t){var e=t.getBoundingClientRect(),i=CT(e.width)/t.offsetWidth||1,n=CT(e.height)/t.offsetHeight||1;return i!==1||n!==1}function get(t,e,i){i===void 0&&(i=!1);var n=Sp(e),r=Sp(e)&&met(e),a=lb(e),s=RT(t,r,i),o={scrollLeft:0,scrollTop:0},l={x:0,y:0};return(n||!n&&!i)&&((um(e)!=="body"||vY(a))&&(o=fet(e)),Sp(e)?(l=RT(e,!0),l.x+=e.clientLeft,l.y+=e.clientTop):a&&(l.x=gY(a))),{x:s.left+o.scrollLeft-l.x,y:s.top+o.scrollTop-l.y,width:s.width,height:s.height}}function vet(t){var e=new Map,i=new Set,n=[];t.forEach(function(a){e.set(a.name,a)});function r(a){i.add(a.name);var s=[].concat(a.requires||[],a.requiresIfExists||[]);s.forEach(function(o){if(!i.has(o)){var l=e.get(o);l&&r(l)}}),n.push(a)}return t.forEach(function(a){i.has(a.name)||r(a)}),n}function yet(t){var e=vet(t);return RQe.reduce(function(i,n){return i.concat(e.filter(function(r){return r.phase===n}))},[])}function bet(t){var e;return function(){return e||(e=new Promise(function(i){Promise.resolve().then(function(){e=void 0,i(t())})})),e}}function Iet(t){var e=t.reduce(function(i,n){var r=i[n.name];return i[n.name]=r?Object.assign({},r,n,{options:Object.assign({},r.options,n.options),data:Object.assign({},r.data,n.data)}):n,i},{});return Object.keys(e).map(function(i){return e[i]})}var mQ={placement:"bottom",modifiers:[],strategy:"absolute"};function gQ(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];return!e.some(function(n){return!(n&&typeof n.getBoundingClientRect=="function")})}function wet(t){t===void 0&&(t={});var e=t,i=e.defaultModifiers,n=i===void 0?[]:i,r=e.defaultOptions,a=r===void 0?mQ:r;return function(o,l,c){c===void 0&&(c=a);var u={placement:"bottom",orderedModifiers:[],options:Object.assign({},mQ,a),modifiersData:{},elements:{reference:o,popper:l},attributes:{},styles:{}},d=[],p=!1,h={state:u,setOptions:function(v){var y=typeof v=="function"?v(u.options):v;m(),u.options=Object.assign({},a,u.options,y),u.scrollParents={reference:_I(o)?RD(o):o.contextElement?RD(o.contextElement):[],popper:RD(l)};var b=yet(Iet([].concat(n,u.options.modifiers)));return u.orderedModifiers=b.filter(function(I){return I.enabled}),f(),h.update()},forceUpdate:function(){if(!p){var v=u.elements,y=v.reference,b=v.popper;if(gQ(y,b)){u.rects={reference:get(y,bM(b),u.options.strategy==="fixed"),popper:hY(b)},u.reset=!1,u.placement=u.options.placement,u.orderedModifiers.forEach(function(E){return u.modifiersData[E.name]=Object.assign({},E.data)});for(var I=0;I<u.orderedModifiers.length;I++){if(u.reset===!0){u.reset=!1,I=-1;continue}var T=u.orderedModifiers[I],w=T.fn,S=T.options,U=S===void 0?{}:S,P=T.name;typeof w=="function"&&(u=w({state:u,options:U,name:P,instance:h})||u)}}}},update:bet(function(){return new Promise(function(g){h.forceUpdate(),g(u)})}),destroy:function(){m(),p=!0}};if(!gQ(o,l))return h;h.setOptions(c).then(function(g){!p&&c.onFirstUpdate&&c.onFirstUpdate(g)});function f(){u.orderedModifiers.forEach(function(g){var v=g.name,y=g.options,b=y===void 0?{}:y,I=g.effect;if(typeof I=="function"){var T=I({state:u,name:v,instance:h,options:b}),w=function(){};d.push(T||w)}})}function m(){d.forEach(function(g){return g()}),d=[]}return h}}var Tet=[HQe,cet,jQe,L1e,set,tet,pet,FQe,net],Uet=wet({defaultModifiers:Tet}),Det="tippy-box",z1e="tippy-content",Eet="tippy-backdrop",q1e="tippy-arrow",W1e="tippy-svg-arrow",Tb={passive:!0,capture:!0},Y1e=function(){return document.body};function uB(t,e,i){if(Array.isArray(t)){var n=t[e];return n??(Array.isArray(i)?i[e]:i)}return t}function yY(t,e){var i={}.toString.call(t);return i.indexOf("[object")===0&&i.indexOf(e+"]")>-1}function K1e(t,e){return typeof t=="function"?t.apply(void 0,e):t}function vQ(t,e){if(e===0)return t;var i;return function(n){clearTimeout(i),i=setTimeout(function(){t(n)},e)}}function Pet(t){return t.split(/\s+/).filter(Boolean)}function V0(t){return[].concat(t)}function yQ(t,e){t.indexOf(e)===-1&&t.push(e)}function Cet(t){return t.filter(function(e,i){return t.indexOf(e)===i})}function Ret(t){return t.split("-")[0]}function yk(t){return[].slice.call(t)}function bQ(t){return Object.keys(t).reduce(function(e,i){return t[i]!==void 0&&(e[i]=t[i]),e},{})}function MD(){return document.createElement("div")}function R2(t){return["Element","Fragment"].some(function(e){return yY(t,e)})}function Met(t){return yY(t,"NodeList")}function Net(t){return yY(t,"MouseEvent")}function Aet(t){return!!(t&&t._tippy&&t._tippy.reference===t)}function _et(t){return R2(t)?[t]:Met(t)?yk(t):Array.isArray(t)?t:yk(document.querySelectorAll(t))}function dB(t,e){t.forEach(function(i){i&&(i.style.transitionDuration=e+"ms")})}function IQ(t,e){t.forEach(function(i){i&&i.setAttribute("data-state",e)})}function ket(t){var e,i=V0(t),n=i[0];return n!=null&&(e=n.ownerDocument)!=null&&e.body?n.ownerDocument:document}function xet(t,e){var i=e.clientX,n=e.clientY;return t.every(function(r){var a=r.popperRect,s=r.popperState,o=r.props,l=o.interactiveBorder,c=Ret(s.placement),u=s.modifiersData.offset;if(!u)return!0;var d=c==="bottom"?u.top.y:0,p=c==="top"?u.bottom.y:0,h=c==="right"?u.left.x:0,f=c==="left"?u.right.x:0,m=a.top-n+d>l,g=n-a.bottom-p>l,v=a.left-i+h>l,y=i-a.right-f>l;return m||g||v||y})}function pB(t,e,i){var n=e+"EventListener";["transitionend","webkitTransitionEnd"].forEach(function(r){t[n](r,i)})}function wQ(t,e){for(var i=e;i;){var n;if(t.contains(i))return!0;i=i.getRootNode==null||(n=i.getRootNode())==null?void 0:n.host}return!1}var wf={isTouch:!1},SQ=0;function Oet(){wf.isTouch||(wf.isTouch=!0,window.performance&&document.addEventListener("mousemove",Z1e))}function Z1e(){var t=performance.now();t-SQ<20&&(wf.isTouch=!1,document.removeEventListener("mousemove",Z1e)),SQ=t}function Let(){var t=document.activeElement;if(Aet(t)){var e=t._tippy;t.blur&&!e.state.isVisible&&t.blur()}}function Fet(){document.addEventListener("touchstart",Oet,Tb),window.addEventListener("blur",Let)}var $et=typeof window<"u"&&typeof document<"u",Bet=$et?!!window.msCrypto:!1,Vet={animateFill:!1,followCursor:!1,inlinePositioning:!1,sticky:!1},jet={allowHTML:!1,animation:"fade",arrow:!0,content:"",inertia:!1,maxWidth:350,role:"tooltip",theme:"",zIndex:9999},yh=Object.assign({appendTo:Y1e,aria:{content:"auto",expanded:"auto"},delay:0,duration:[300,250],getReferenceClientRect:null,hideOnClick:!0,ignoreAttributes:!1,interactive:!1,interactiveBorder:2,interactiveDebounce:0,moveTransition:"",offset:[0,10],onAfterUpdate:function(){},onBeforeUpdate:function(){},onCreate:function(){},onDestroy:function(){},onHidden:function(){},onHide:function(){},onMount:function(){},onShow:function(){},onShown:function(){},onTrigger:function(){},onUntrigger:function(){},onClickOutside:function(){},placement:"top",plugins:[],popperOptions:{},render:null,showOnCreate:!1,touch:!0,trigger:"mouseenter focus",triggerTarget:null},Vet,jet),Get=Object.keys(yh),Het=function(e){var i=Object.keys(e);i.forEach(function(n){yh[n]=e[n]})};function X1e(t){var e=t.plugins||[],i=e.reduce(function(n,r){var a=r.name,s=r.defaultValue;if(a){var o;n[a]=t[a]!==void 0?t[a]:(o=yh[a])!=null?o:s}return n},{});return Object.assign({},t,i)}function zet(t,e){var i=e?Object.keys(X1e(Object.assign({},yh,{plugins:e}))):Get,n=i.reduce(function(r,a){var s=(t.getAttribute("data-tippy-"+a)||"").trim();if(!s)return r;if(a==="content")r[a]=s;else try{r[a]=JSON.parse(s)}catch{r[a]=s}return r},{});return n}function TQ(t,e){var i=Object.assign({},e,{content:K1e(e.content,[t])},e.ignoreAttributes?{}:zet(t,e.plugins));return i.aria=Object.assign({},yh.aria,i.aria),i.aria={expanded:i.aria.expanded==="auto"?e.interactive:i.aria.expanded,content:i.aria.content==="auto"?e.interactive?null:"describedby":i.aria.content},i}var qet=function(){return"innerHTML"};function aH(t,e){t[qet()]=e}function UQ(t){var e=MD();return t===!0?e.className=q1e:(e.className=W1e,R2(t)?e.appendChild(t):aH(e,t)),e}function DQ(t,e){R2(e.content)?(aH(t,""),t.appendChild(e.content)):typeof e.content!="function"&&(e.allowHTML?aH(t,e.content):t.textContent=e.content)}function sH(t){var e=t.firstElementChild,i=yk(e.children);return{box:e,content:i.find(function(n){return n.classList.contains(z1e)}),arrow:i.find(function(n){return n.classList.contains(q1e)||n.classList.contains(W1e)}),backdrop:i.find(function(n){return n.classList.contains(Eet)})}}function J1e(t){var e=MD(),i=MD();i.className=Det,i.setAttribute("data-state","hidden"),i.setAttribute("tabindex","-1");var n=MD();n.className=z1e,n.setAttribute("data-state","hidden"),DQ(n,t.props),e.appendChild(i),i.appendChild(n),r(t.props,t.props);function r(a,s){var o=sH(e),l=o.box,c=o.content,u=o.arrow;s.theme?l.setAttribute("data-theme",s.theme):l.removeAttribute("data-theme"),typeof s.animation=="string"?l.setAttribute("data-animation",s.animation):l.removeAttribute("data-animation"),s.inertia?l.setAttribute("data-inertia",""):l.removeAttribute("data-inertia"),l.style.maxWidth=typeof s.maxWidth=="number"?s.maxWidth+"px":s.maxWidth,s.role?l.setAttribute("role",s.role):l.removeAttribute("role"),(a.content!==s.content||a.allowHTML!==s.allowHTML)&&DQ(c,t.props),s.arrow?u?a.arrow!==s.arrow&&(l.removeChild(u),l.appendChild(UQ(s.arrow))):l.appendChild(UQ(s.arrow)):u&&l.removeChild(u)}return{popper:e,onUpdate:r}}J1e.$$tippy=!0;var Wet=1,QM=[],hB=[];function Yet(t,e){var i=TQ(t,Object.assign({},yh,X1e(bQ(e)))),n,r,a,s=!1,o=!1,l=!1,c=!1,u,d,p,h=[],f=vQ(te,i.interactiveDebounce),m,g=Wet++,v=null,y=Cet(i.plugins),b={isEnabled:!0,isVisible:!1,isDestroyed:!1,isMounted:!1,isShown:!1},I={id:g,reference:t,popper:MD(),popperInstance:v,props:i,state:b,plugins:y,clearDelayTimeouts:Ct,setProps:Nt,setContent:Ce,show:Ge,hide:$e,hideWithInteractivity:at,enable:yt,disable:lt,unmount:ct,destroy:Vt};if(!i.render)return I;var T=i.render(I),w=T.popper,S=T.onUpdate;w.setAttribute("data-tippy-root",""),w.id="tippy-"+I.id,I.popper=w,t._tippy=I,w._tippy=I;var U=y.map(function(Me){return Me.fn(I)}),P=t.hasAttribute("aria-expanded");return ie(),F(),k(),O("onCreate",[I]),i.showOnCreate&&Qe(),w.addEventListener("mouseenter",function(){I.props.interactive&&I.state.isVisible&&I.clearDelayTimeouts()}),w.addEventListener("mouseleave",function(){I.props.interactive&&I.props.trigger.indexOf("mouseenter")>=0&&_().addEventListener("mousemove",f)}),I;function E(){var Me=I.props.touch;return Array.isArray(Me)?Me:[Me,0]}function R(){return E()[0]==="hold"}function C(){var Me;return!!((Me=I.props.render)!=null&&Me.$$tippy)}function M(){return m||t}function _(){var Me=M().parentNode;return Me?ket(Me):document}function A(){return sH(w)}function N(Me){return I.state.isMounted&&!I.state.isVisible||wf.isTouch||u&&u.type==="focus"?0:uB(I.props.delay,Me?0:1,yh.delay)}function k(Me){Me===void 0&&(Me=!1),w.style.pointerEvents=I.props.interactive&&!Me?"":"none",w.style.zIndex=""+I.props.zIndex}function O(Me,De,Je){if(Je===void 0&&(Je=!0),U.forEach(function(bt){bt[Me]&&bt[Me].apply(bt,De)}),Je){var St;(St=I.props)[Me].apply(St,De)}}function $(){var Me=I.props.aria;if(Me.content){var De="aria-"+Me.content,Je=w.id,St=V0(I.props.triggerTarget||t);St.forEach(function(bt){var Ie=bt.getAttribute(De);if(I.state.isVisible)bt.setAttribute(De,Ie?Ie+" "+Je:Je);else{var Ue=Ie&&Ie.replace(Je,"").trim();Ue?bt.setAttribute(De,Ue):bt.removeAttribute(De)}})}}function F(){if(!(P||!I.props.aria.expanded)){var Me=V0(I.props.triggerTarget||t);Me.forEach(function(De){I.props.interactive?De.setAttribute("aria-expanded",I.state.isVisible&&De===M()?"true":"false"):De.removeAttribute("aria-expanded")})}}function V(){_().removeEventListener("mousemove",f),QM=QM.filter(function(Me){return Me!==f})}function j(Me){if(!(wf.isTouch&&(l||Me.type==="mousedown"))){var De=Me.composedPath&&Me.composedPath()[0]||Me.target;if(!(I.props.interactive&&wQ(w,De))){if(V0(I.props.triggerTarget||t).some(function(Je){return wQ(Je,De)})){if(wf.isTouch||I.state.isVisible&&I.props.trigger.indexOf("click")>=0)return}else O("onClickOutside",[I,Me]);I.props.hideOnClick===!0&&(I.clearDelayTimeouts(),I.hide(),o=!0,setTimeout(function(){o=!1}),I.state.isMounted||Z())}}}function B(){l=!0}function z(){l=!1}function W(){var Me=_();Me.addEventListener("mousedown",j,!0),Me.addEventListener("touchend",j,Tb),Me.addEventListener("touchstart",z,Tb),Me.addEventListener("touchmove",B,Tb)}function Z(){var Me=_();Me.removeEventListener("mousedown",j,!0),Me.removeEventListener("touchend",j,Tb),Me.removeEventListener("touchstart",z,Tb),Me.removeEventListener("touchmove",B,Tb)}function K(Me,De){J(Me,function(){!I.state.isVisible&&w.parentNode&&w.parentNode.contains(w)&&De()})}function Q(Me,De){J(Me,De)}function J(Me,De){var Je=A().box;function St(bt){bt.target===Je&&(pB(Je,"remove",St),De())}if(Me===0)return De();pB(Je,"remove",d),pB(Je,"add",St),d=St}function se(Me,De,Je){Je===void 0&&(Je=!1);var St=V0(I.props.triggerTarget||t);St.forEach(function(bt){bt.addEventListener(Me,De,Je),h.push({node:bt,eventType:Me,handler:De,options:Je})})}function ie(){R()&&(se("touchstart",oe,{passive:!0}),se("touchend",le,{passive:!0})),Pet(I.props.trigger).forEach(function(Me){if(Me!=="manual")switch(se(Me,oe),Me){case"mouseenter":se("mouseleave",le);break;case"focus":se(Bet?"focusout":"blur",ne);break;case"focusin":se("focusout",ne);break}})}function ce(){h.forEach(function(Me){var De=Me.node,Je=Me.eventType,St=Me.handler,bt=Me.options;De.removeEventListener(Je,St,bt)}),h=[]}function oe(Me){var De,Je=!1;if(!(!I.state.isEnabled||me(Me)||o)){var St=((De=u)==null?void 0:De.type)==="focus";u=Me,m=Me.currentTarget,F(),!I.state.isVisible&&Net(Me)&&QM.forEach(function(bt){return bt(Me)}),Me.type==="click"&&(I.props.trigger.indexOf("mouseenter")<0||s)&&I.props.hideOnClick!==!1&&I.state.isVisible?Je=!0:Qe(Me),Me.type==="click"&&(s=!Je),Je&&!St&&ke(Me)}}function te(Me){var De=Me.target,Je=M().contains(De)||w.contains(De);if(!(Me.type==="mousemove"&&Je)){var St=ze().concat(w).map(function(bt){var Ie,Ue=bt._tippy,Oe=(Ie=Ue.popperInstance)==null?void 0:Ie.state;return Oe?{popperRect:bt.getBoundingClientRect(),popperState:Oe,props:i}:null}).filter(Boolean);xet(St,Me)&&(V(),ke(Me))}}function le(Me){var De=me(Me)||I.props.trigger.indexOf("click")>=0&&s;if(!De){if(I.props.interactive){I.hideWithInteractivity(Me);return}ke(Me)}}function ne(Me){I.props.trigger.indexOf("focusin")<0&&Me.target!==M()||I.props.interactive&&Me.relatedTarget&&w.contains(Me.relatedTarget)||ke(Me)}function me(Me){return wf.isTouch?R()!==Me.type.indexOf("touch")>=0:!1}function be(){Se();var Me=I.props,De=Me.popperOptions,Je=Me.placement,St=Me.offset,bt=Me.getReferenceClientRect,Ie=Me.moveTransition,Ue=C()?sH(w).arrow:null,Oe=bt?{getBoundingClientRect:bt,contextElement:bt.contextElement||M()}:t,Ee={name:"$$tippy",enabled:!0,phase:"beforeWrite",requires:["computeStyles"],fn:function(Fe){var ht=Fe.state;if(C()){var ti=A(),Ke=ti.box;["placement","reference-hidden","escaped"].forEach(function(zt){zt==="placement"?Ke.setAttribute("data-placement",ht.placement):ht.attributes.popper["data-popper-"+zt]?Ke.setAttribute("data-"+zt,""):Ke.removeAttribute("data-"+zt)}),ht.attributes.popper={}}}},Xe=[{name:"offset",options:{offset:St}},{name:"preventOverflow",options:{padding:{top:2,bottom:2,left:5,right:5}}},{name:"flip",options:{padding:5}},{name:"computeStyles",options:{adaptive:!Ie}},Ee];C()&&Ue&&Xe.push({name:"arrow",options:{element:Ue,padding:3}}),Xe.push.apply(Xe,(De==null?void 0:De.modifiers)||[]),I.popperInstance=Uet(Oe,w,Object.assign({},De,{placement:Je,onFirstUpdate:p,modifiers:Xe}))}function Se(){I.popperInstance&&(I.popperInstance.destroy(),I.popperInstance=null)}function we(){var Me=I.props.appendTo,De,Je=M();I.props.interactive&&Me===Y1e||Me==="parent"?De=Je.parentNode:De=K1e(Me,[Je]),De.contains(w)||De.appendChild(w),I.state.isMounted=!0,be()}function ze(){return yk(w.querySelectorAll("[data-tippy-root]"))}function Qe(Me){I.clearDelayTimeouts(),Me&&O("onTrigger",[I,Me]),W();var De=N(!0),Je=E(),St=Je[0],bt=Je[1];wf.isTouch&&St==="hold"&&bt&&(De=bt),De?n=setTimeout(function(){I.show()},De):I.show()}function ke(Me){if(I.clearDelayTimeouts(),O("onUntrigger",[I,Me]),!I.state.isVisible){Z();return}if(!(I.props.trigger.indexOf("mouseenter")>=0&&I.props.trigger.indexOf("click")>=0&&["mouseleave","mousemove"].indexOf(Me.type)>=0&&s)){var De=N(!1);De?r=setTimeout(function(){I.state.isVisible&&I.hide()},De):a=requestAnimationFrame(function(){I.hide()})}}function yt(){I.state.isEnabled=!0}function lt(){I.hide(),I.state.isEnabled=!1}function Ct(){clearTimeout(n),clearTimeout(r),cancelAnimationFrame(a)}function Nt(Me){if(!I.state.isDestroyed){O("onBeforeUpdate",[I,Me]),ce();var De=I.props,Je=TQ(t,Object.assign({},De,bQ(Me),{ignoreAttributes:!0}));I.props=Je,ie(),De.interactiveDebounce!==Je.interactiveDebounce&&(V(),f=vQ(te,Je.interactiveDebounce)),De.triggerTarget&&!Je.triggerTarget?V0(De.triggerTarget).forEach(function(St){St.removeAttribute("aria-expanded")}):Je.triggerTarget&&t.removeAttribute("aria-expanded"),F(),k(),S&&S(De,Je),I.popperInstance&&(be(),ze().forEach(function(St){requestAnimationFrame(St._tippy.popperInstance.forceUpdate)})),O("onAfterUpdate",[I,Me])}}function Ce(Me){I.setProps({content:Me})}function Ge(){var Me=I.state.isVisible,De=I.state.isDestroyed,Je=!I.state.isEnabled,St=wf.isTouch&&!I.props.touch,bt=uB(I.props.duration,0,yh.duration);if(!(Me||De||Je||St)&&!M().hasAttribute("disabled")&&(O("onShow",[I],!1),I.props.onShow(I)!==!1)){if(I.state.isVisible=!0,C()&&(w.style.visibility="visible"),k(),W(),I.state.isMounted||(w.style.transition="none"),C()){var Ie=A(),Ue=Ie.box,Oe=Ie.content;dB([Ue,Oe],0)}p=function(){var Xe;if(!(!I.state.isVisible||c)){if(c=!0,w.offsetHeight,w.style.transition=I.props.moveTransition,C()&&I.props.animation){var Et=A(),Fe=Et.box,ht=Et.content;dB([Fe,ht],bt),IQ([Fe,ht],"visible")}$(),F(),yQ(hB,I),(Xe=I.popperInstance)==null||Xe.forceUpdate(),O("onMount",[I]),I.props.animation&&C()&&Q(bt,function(){I.state.isShown=!0,O("onShown",[I])})}},we()}}function $e(){var Me=!I.state.isVisible,De=I.state.isDestroyed,Je=!I.state.isEnabled,St=uB(I.props.duration,1,yh.duration);if(!(Me||De||Je)&&(O("onHide",[I],!1),I.props.onHide(I)!==!1)){if(I.state.isVisible=!1,I.state.isShown=!1,c=!1,s=!1,C()&&(w.style.visibility="hidden"),V(),Z(),k(!0),C()){var bt=A(),Ie=bt.box,Ue=bt.content;I.props.animation&&(dB([Ie,Ue],St),IQ([Ie,Ue],"hidden"))}$(),F(),I.props.animation?C()&&K(St,I.unmount):I.unmount()}}function at(Me){_().addEventListener("mousemove",f),yQ(QM,f),f(Me)}function ct(){I.state.isVisible&&I.hide(),I.state.isMounted&&(Se(),ze().forEach(function(Me){Me._tippy.unmount()}),w.parentNode&&w.parentNode.removeChild(w),hB=hB.filter(function(Me){return Me!==I}),I.state.isMounted=!1,O("onHidden",[I]))}function Vt(){I.state.isDestroyed||(I.clearDelayTimeouts(),I.unmount(),ce(),delete t._tippy,I.state.isDestroyed=!0,O("onDestroy",[I]))}}function Mg(t,e){e===void 0&&(e={});var i=yh.plugins.concat(e.plugins||[]);Fet();var n=Object.assign({},e,{plugins:i}),r=_et(t),a=r.reduce(function(s,o){var l=o&&Yet(o,n);return l&&s.push(l),s},[]);return R2(t)?a[0]:a}Mg.defaultProps=yh;Mg.setDefaultProps=Het;Mg.currentInput=wf;Object.assign({},L1e,{effect:function(e){var i=e.state,n={popper:{position:i.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};Object.assign(i.elements.popper.style,n.popper),i.styles=n,i.elements.arrow&&Object.assign(i.elements.arrow.style,n.arrow)}});Mg.setDefaultProps({render:J1e});function EQ(t){var i;const e=document.createElement("button");return e.className="button font-medium",t.disabled&&(e.disabled=!0),t.class&&e.classList.add(t.class),t.id&&(e.id=t.id),t.location===oi?e.style="margin-left: 1em":e.style="margin-right: 1em",t.intent&&e.classList.add(t.intent),(i=t.toolTip)!=null&&i.content&&Mg(e,t.toolTip),e.innerHTML=t.label,t.visible===!1&&(e.style.display=xt),e}const bY=({target:t})=>(e=[])=>{t.style.backgroundColor=e!=null&&e.length?"lightgray":XS;const i=(n,r,a)=>{const s=t.getElementsByClassName(`options_${n}`)[0];s&&(s.style.display=e!=null&&e.length?r:a)};i(fa,HM,xt),i(pi,xt,HM),i(mi,xt,HM),i(oi,xt,HM)};function Io(t){var v;const{table:e,targetClassName:i,items:n=[],onSelection:r}=t;let{target:a}=t;const s=!!a;if(a=a||i&&((v=document.getElementsByClassName(i))==null?void 0:v[0]),!a)return;let o=0,l=0;const c={},u={};let d;if(s){Ys(a);const y=Ket();Object.assign(c,y.elements),a.appendChild(y.anchor)}const p=Object.assign({},...[fa,pi,mi,oi,b_].map(y=>{var I;const b=(I=a.getElementsByClassName(`options_${y}`))==null?void 0:I[0];return Ys(b),{[y]:b}}).filter(Boolean)),h=bY({table:e,target:a}),f=(y,b)=>{Ot(b.onClick)&&(y.stopPropagation(),!b.disabled&&b.onClick(y,e),b.stateChange&&h())},m={onClick:()=>{},location:oi};for(const y of n){const b={...m};Up(y)&&Object.assign(b,y);const I=p[b.location];if(!I){console.log(b.location,p);continue}if(b.location===fa&&(o+=1),b.location===b_){if(Ot(b.headerClick)){const T=a.getElementsByClassName("panelHeader")[0];T&&(T.onclick=b.headerClick)}l+=1}if(!b.hide&&(b.input||b.placeholder||b.search)){const T=document.createElement("p");T.style="margin-right: 1em",T.className=`control ${b.search?"has-icons-left has-icons-right":""}`;const w=document.createElement("input");if(b.focus&&(d=w),w.className="input font-medium",w.setAttribute("type","text"),w.setAttribute("autocomplete","off"),w.setAttribute("placeholder",y.placeholder||XS),b.id&&(u[b.id]=w),b.id&&w.setAttribute("id",b.id),b.onKeyDown&&w.addEventListener("keydown",S=>b.onKeyDown(S,b)),b.onChange&&w.addEventListener("change",S=>b.onChange(S,b)),b.onKeyUp&&w.addEventListener("keyup",S=>{b.clearSearch&&S.key==="Escape"&&(S.stopPropagation(),w.value="",b.clearSearch()),b.onKeyUp(S,b)}),b.class&&w.classList.add(b.class),b.visible===!1&&(T.style.display=xt),b.value&&(w.value=b.value),T.appendChild(w),b.search){const S=document.createElement("span");if(S.className="icon is-small is-left font-medium",S.innerHTML='<i class="fa-solid fa-magnifying-glass"></i>',T.appendChild(S),Ot(b.clearSearch)){const U=document.createElement("span");U.className="icon is-small is-right font-medium",U.innerHTML='<i class="fa-solid fa-circle-xmark" style="color: #dddada; pointer-events: all; cursor: pointer"></i>',U.onclick=P=>{P.stopPropagation(),w.value="",b.clearSearch()},T.appendChild(U)}}if(y.validator){const S=document.createElement("p");S.className="help font-medium",T.appendChild(S),w.addEventListener("input",U=>Mme(y,U,w,S,y.validator))}b.id&&(c[b.id]=T,T.id=b.id),I==null||I.appendChild(T);continue}if(!b.hide&&b.text){const T=document.createElement("div");T.className="font-medium",b.id&&(c[b.id]=T,T.id=b.id),T.innerHTML=b.text,T.onclick=w=>f(w,b),I==null||I.appendChild(T);continue}if(!(!b.id&&(!(b!=null&&b.label)||b.hide))){if(b.options){const T=NG({target:I,button:b,stateChange:h});b.visible===!1&&(T.style.display=xt),b.id&&(c[b.id]=T)}else if(Up(b.selection)){const{selection:{options:T,actions:w},actionPlacement:S,threshold:U=8,...P}=b;if((T==null?void 0:T.length)<U){T.length&&(S===KZ?T.unshift({divider:!0}):T.push({divider:!0})),w.forEach(C=>{const{label:M,..._}=C,A={..._,label:`<p style="font-weight: bold">${M}</p>`};S===KZ?T.unshift(A):T.push(A)});const E={...P,options:T},R=NG({target:I,button:E,stateChange:h});E.visible===!1&&(R.style.display=xt),E.id&&(c[b.id]=R)}else{const E=EQ(b);E.onclick=R=>{R.stopPropagation(),uY({title:"Select team",options:T})},b.id&&(c[b.id]=E),I==null||I.appendChild(E)}}else if(b.tabs){const T=document.createElement("div");T.className="tabs is-toggle is-toggle-rounded";const w=document.createElement("ul");T.appendChild(w),b.tabs.forEach(S=>{const U=document.createElement("li");S.active&&U.classList.add("is-active");const P=document.createElement("a");U.appendChild(P),P.onclick=R=>{w.querySelectorAll("li").forEach(C=>C.classList.remove("is-active")),U.classList.add("is-active"),Ot(S.onClick)&&S.onClick(R,b)};const E=document.createElement("span");E.innerHTML=S.label,P.appendChild(E),w.appendChild(U)}),b.id&&(c[b.id]=T),I.appendChild(T)}else{const T=EQ(b);T.onclick=w=>f(w,b),b.id&&(c[b.id]=T),I==null||I.appendChild(T)}(!(b!=null&&b.label||b.tabs)||b.hide)&&c[b.id]&&(c[b.id].style.display=xt)}}const g=a.getElementsByClassName("panelHeader")[0];return g&&(g.style.display=l?XS:xt),e==null||e.on("rowSelectionChanged",(y,b)=>{Ot(r)&&r(b),o&&h(b)}),h(),d&&setTimeout(()=>d.focus(),200),{elements:c,inputs:u}}function Ket(){const t=document.createElement("div");t.className="panel_container flexcol flexcenter";const e=document.createElement("div");e.className="panelHeader options_header",e.style.display=xt,t.appendChild(e);const i=document.createElement("div");i.className=Rfe;const n={optionsOverlay:document.createElement("div"),optionsLeft:document.createElement("div"),optionsCenter:document.createElement("div"),optionsRight:document.createElement("div")};n.optionsOverlay.className="options_overlay",n.optionsCenter.className="options_center",n.optionsRight.className="options_right",n.optionsLeft.className="options_left";for(const r of Object.values(n))i.appendChild(r);return t.appendChild(i),{elements:n,anchor:t,header:e}}const{FIRST_MATCH_LOSER_CONSOLATION:Zet,COMPASS:Xet,ROUND_ROBIN:Jet}=Qr,{MALE:Qet,FEMALE:ett}=Uo.genderConstants,{DOUBLES:PQ}=Uo.eventConstants,{WTN:eN}=Uo.ratingConstants;function ttt(t){const e=t.getData().map(n=>n.tournamentId),i=itt();for(const n of i)mM({tournamentRecord:n,tournamentIds:e,table:t});return{...qC}}function itt(){const e=[{venueName:"Super Fast Courts",venueAbbreviation:"SFC",startTime:"08:00",endTime:"20:00",courtsCount:8}];return[{tournamentAttributes:{tournamentId:"tournament-id-1"},participantsProfile:{scaledParticipantsCount:200,idPrefix:"p"},tournamentName:"CourtHive Challenge",drawProfiles:[{category:{categoryName:"U18"},eventName:"U18 Boys Doubles",eventId:"event-id-1",drawId:"draw-id-1",eventType:PQ,gender:Qet,seedsCount:4,drawSize:16},{drawType:Zet,category:{categoryName:"U16"},eventName:"U16 Girls Singles",eventId:"event-id-2",drawId:"draw-id-2",gender:ett,seedsCount:8,drawSize:32},{category:{ratingType:eN,ratingMin:18,ratingMax:24.99},eventName:"WTN 18-25 SINGLES",scaledParticipantsCount:32,eventId:"event-id-3",drawId:"draw-id-3",seedsCount:8,drawSize:32},{category:{ratingType:eN,ratingMin:18,ratingMax:24.99},eventName:"WTN 18-25 DOUBLES",scaledParticipantsCount:32,eventId:"event-id-4",drawId:"draw-id-4",eventType:PQ,seedsCount:8,drawSize:32}],venueProfiles:e},{tournamentAttributes:{tournamentId:"tournament-id-02"},participantsProfile:{idPrefix:"p"},tournamentName:"Level Based Play",drawProfiles:[{eventName:"WTN 14-19 SINGLES",category:{ratingType:eN,ratingMin:14,ratingMax:19.99},scaledParticipantsCount:32,eventId:"event-id-1",drawId:"draw-id-1",drawType:Xet,seedsCount:8,drawSize:32},{eventName:"WTN 20-26 SINGLES",category:{ratingType:eN,ratingMin:20,ratingMax:25.99},scaledParticipantsCount:16,drawType:Jet,eventId:"event-id-2",drawId:"draw-id-2",seedsCount:4,drawSize:16}],venueProfiles:e}].map(n=>zC.generateTournamentRecord(n).tournamentRecord)}function ntt(t){var l,c;const e=Xc(),i=(l=e==null?void 0:e.roles)==null?void 0:l.includes(cL),n=(c=e==null?void 0:e.services)==null?void 0:c.includes("tournamentProfile"),r=[{label:"Create new tournament",onClick:()=>d1e({table:t})},{label:"Import tournament",onClick:()=>pZe({table:t})},n&&{label:"Fetch tournament",onClick:()=>hZe({table:t})},i&&{label:"Load by ID",onClick:()=>fZe({table:t})},{divider:!0},{divider:!0},{label:"Example tournaments",onClick:()=>ttt(t),close:!0}].filter(Boolean),a=zw(t),s=[{label:"Actions",options:r,align:oi},{onKeyDown:u=>u.keyCode===8&&u.target.value.length===1&&a(""),onChange:u=>a(u.target.value),onKeyUp:u=>a(u.target.value),clearSearch:()=>a(""),placeholder:"Search tournaments",id:"tournamentSearch",location:pi,search:!0}],o=document.getElementById(Cfe);Io({target:o,items:s})}const rtt=t=>e=>{const i=document.createElement("table"),n=e.getValue();i.style.width="400px";const r="4em",a=document.createElement("tr");if(n.offline){const c=e.getRow().getElement();c.style.backgroundColor="lightyellow"}const s=n.tournamentImageURL?`<img src='${n.tournamentImageURL}' style='width: ${r}' alt=''>`:"";let o=(t?"":`<td style='min-width: ${r};'>${s}</td>`)+`<td><div style='margin-left: 1em'><strong style='font-size: 1.5em'>${n.tournamentName}</strong></div><div style='margin-left: 1em'>${n.startDate} / ${n.endDate}</div></td>`;a.innerHTML=o,i.appendChild(a);const l=document.createElement("span");return l.appendChild(i),l};function att({providerId:t,tournamentId:e}){const i=()=>It.router.navigate(`/tournaments/${e}`),n=r=>{r&&(r.calendar=r.calendar.filter(a=>a.tournamentId!==e),jc.addProvider(r).then(i))};jc.findProvider(t).then(n)}function stt(t,e,i){if(!t)return;const n=document.createElement("aside");n.classList.add("menu");const r={},a=d=>p=>{p.stopPropagation(),d.onClick()};let s=0;const o=()=>(s+=1,s),l=d=>(d==null?void 0:d.heading)||(d==null?void 0:d.text)||(d==null?void 0:d.label)||`Item ${o()}`,c=d=>{const p=document.createElement("li");if(p.className="font-medium",d.style&&(p.style=d.style),d.onClick){const h=d.fontSize||"1em";if(d.divider){const f=document.createElement("hr");f.classList.add("dropdown-divider"),p.appendChild(f)}else{const f=document.createElement("a"),m=d.disabled?"0.4":"1";f.style=`text-decoration: none; opacity: ${m}; font-size: ${h}`,d.class&&f.classList.add(d.class),d.color&&(f.style.color=d.color),d.heading&&(f.style.fontWeight="bold"),d.disabled||(f.onclick=a(d)),f.innerHTML=l(d),p.appendChild(f)}}else p.innerHTML=l(d),d.disabled||(p.onclick=d.onClick);return p};let u;for(const d of e||[])if(!d.hide){if(d.items){if(d.text){const h=document.createElement("p");h.className="menu-label font-medium",h.innerHTML=d.text,n.appendChild(h)}const p=document.createElement("ul");p.className="menu-list";for(const h of d.items)h.hide||p.appendChild(c(h));n.appendChild(p)}else if(d.type==="input"){const{field:p,inputElement:h}=yD(d);d.focus&&(u=h),r[d.field]=h,n.appendChild(p)}else if(d.type==="divider"){const p=document.createElement("hr");p.classList.add("dropdown-divider"),n.appendChild(p)}}return t.appendChild(n),{focusElement:u}}let Sf;function wd(t){Sf&&(Sf==null||Sf.destroy(!0),Sf=void 0),t!=null&&t.remove&&t.remove()}function Ic(t){var d;const{title:e,options:i,menuItems:n=[],coords:r,callback:a,config:s}=t;let{target:o,items:l}=t;if(!(i!=null&&i.length)&&!(l!=null&&l.length)&&!n)return;wd();const c=document.createElement("div"),u=()=>{l=(l==null?void 0:l.filter(f=>!f.hide&&!f.disabled).map(f=>({...f,onClick:()=>{wd(c),Ot(f.onClick)&&f.onClick()}})))||(i==null?void 0:i.filter(f=>!f.hide&&!f.disabled).map(f=>({text:typeof f=="object"?f.option:f,style:f.style,onClick:()=>{f.subMenu?Sf.setContent("IMPLEMENT SUB MENU"):Ot(f.onClick)?(wd(c),f.onClick()):Ot(a)&&(wd(c),a(typeof f=="object"?{...f,coords:r}:f))}})));const p=[{text:e,items:l},...n],{focusElement:h}=stt(c,p);return h&&h.focus(),c};return o=o||((d=r==null?void 0:r.evt)==null?void 0:d.target),o&&(Sf=Mg(o,{content:u,theme:"light-border",trigger:"click",...s}),Sf.show(),Sf.setProps({interactive:!0})),Sf}const ott=t=>e=>{const i=document.createElement("span");i.style.width="100%";const n=e.getValue(),r=()=>{var f;const l=e.getRow(),c=((f=Xc())==null?void 0:f.providerId)||l.getData().providerId,u=()=>{l.delete(),c&&att({tournamentId:n,providerId:c})},d=()=>jc.deleteTournament(n).then(u,m=>console.log(m)),p=Xc();(p==null?void 0:p.provider)||(It==null?void 0:It.provider)?_je({providerId:c,tournamentId:n}).then(d,m=>console.log(m)):d()},a=()=>{const u=`<div style='font-size: 2em'>${e.getTable().getData().find(p=>p.tournamentId===n).tournament.tournamentName} will be deleted!</div>`,d=[{onClick:r,intent:"is-danger",label:"Delete",close:!0},{label:"Cancel"}];er({title:Cs.tr("actions.delete_tournament"),buttons:d,content:u})},s=()=>ltt({table:e.getTable(),tournamentId:n,replaceTableData:t}),o=document.createElement("span");return o.innerHTML="<i class='fa fa-ellipsis-vertical'></i>",i.onclick=l=>{l.stopPropagation(),Ic({target:o,items:[{text:"Delete",onClick:a},{text:"Edit",onClick:s}],config:{placement:Ap}})},i.appendChild(o),i};function ltt({tournamentId:t,replaceTableData:e,table:i}){const n=Xc(),r=n==null?void 0:n.provider,a=()=>{Jt({message:"Tournament not found",onClose:()=>{It.router.navigate("/tournaments")},intent:"is-warning",pauseOnHover:!0})},s=l=>{l?d1e({table:i,tournamentRecord:l,replaceTableData:e}):a()},o=l=>{var u,d;const c=(d=(u=l==null?void 0:l.data)==null?void 0:u.tournamentRecords)==null?void 0:d[t];s(c)};r?vL({tournamentId:t}).then(o,l=>console.log(l)):jc.findTournament(t).then(s,l=>console.log(l))}function ctt(t){const e=/Mobile/.test(navigator.userAgent),i=(n,r)=>{const a=r.getRow().getData().tournamentId;if(a){ot.reset();const s=`/${Ps}/${a}`;It.router.navigate(s)}};return[{formatter:rtt(e),cellClick:i,field:"tournament",headerSort:!1,resizable:!0,minWidth:250,widthGrow:3},{formatter:()=>'<div class="button font-medium">Open</div>',cellClick:i,vertAlign:"middle",visible:!e,title:"Open",width:90},{formatter:ott(t),field:"tournamentId",vertAlign:"middle",headerSort:!1,hozAlign:oi,width:10}]}function km({anchorId:t}){const e=As.findTable(`#${t}`)[0];e&&e.destroy()}function M2(){var t;if(It.tables)for(const e of Object.keys(It.tables))(t=It.tables[e])==null||t.destroy(),delete It.tables[e];for(;(It.collectionTables||[]).length;)It.collectionTables.pop().destroy()}function Q1e(){const t=u=>console.log("db Error",{error:u}),e=document.getElementById("dnav");e.style.backgroundColor="";let i;const n=ctt(),r=u=>{km({anchorId:vj});const d=document.getElementById(vj);i=new As(d,{height:window.innerHeight*.85,placeholder:"No tournaments",layout:"fitColumns",index:"tournamentId",headerVisible:!1,reactiveData:!0,data:u,columns:n}),i.on("tableBuilt",()=>ntt(i)),i.on("scrollVertical",wd)},a=u=>{u.sort((d,p)=>new Date(p.startDate||p.start)-new Date(d.startDate||d.start)),r(u.map(U2))},s=({tournaments:u,provider:d})=>{const p=u.sort((h,f)=>new Date(f.tournament.startDate)-new Date(h.tournament.startDate)).map(h=>{var g,v,y,b;const f=(v=(g=h.tournament.timeItemValues)==null?void 0:g.TMX)==null?void 0:v.offline;h.tournament.offline=f;const m=(b=(y=h.tournament.onlineResources)==null?void 0:y.find(({name:I,resourceType:T})=>I==="tournamentImage"&&T==="URL"))==null?void 0:b.identifier;return m&&(h.tournament.tournamentImageURL=m),{...h,provider:d}});r(p)},o=Xc(),l=(o==null?void 0:o.provider)||(It==null?void 0:It.provider),c=()=>jc.findAllTournaments().then(a,t);if(l!=null&&l.organisationAbbreviation){const u=d=>{var p;(p=d==null?void 0:d.data)!=null&&p.calendar?s(d.data.calendar):c()};Nje({providerAbbr:l.organisationAbbreviation}).then(u)}else c();return{table:i}}const eDe="leaveTournament",utt="providerCalendar",dtt="processDirective",ptt="tmxDirective",htt="tmxMessage";function tDe(t){const e=e1e({data:t}),{directive:i,content:n}=e||{};i&&(i===utt&&n.calendar&&Jt({action:{onClick:()=>ftt({providerId:n.providerId,calendar:n.calendar}),text:"Load"},message:"Calendar Received",duration:!1}),i.subKey&&It.ee.emit("sendKey",i.subKey))}function ftt({providerId:t,calendar:e}){const i=()=>Q1e();t&&e&&jc.addProvider({providerId:t,calendar:e}).then(i)}const dm=Object.create(null);dm.open="0";dm.close="1";dm.ping="2";dm.pong="3";dm.message="4";dm.upgrade="5";dm.noop="6";const vA=Object.create(null);Object.keys(dm).forEach(t=>{vA[dm[t]]=t});const oH={type:"error",data:"parser error"},iDe=typeof Blob=="function"||typeof Blob<"u"&&Object.prototype.toString.call(Blob)==="[object BlobConstructor]",nDe=typeof ArrayBuffer=="function",rDe=t=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(t):t&&t.buffer instanceof ArrayBuffer,IY=({type:t,data:e},i,n)=>iDe&&e instanceof Blob?i?n(e):CQ(e,n):nDe&&(e instanceof ArrayBuffer||rDe(e))?i?n(e):CQ(new Blob([e]),n):n(dm[t]+(e||"")),CQ=(t,e)=>{const i=new FileReader;return i.onload=function(){const n=i.result.split(",")[1];e("b"+(n||""))},i.readAsDataURL(t)};function RQ(t){return t instanceof Uint8Array?t:t instanceof ArrayBuffer?new Uint8Array(t):new Uint8Array(t.buffer,t.byteOffset,t.byteLength)}let fB;function mtt(t,e){if(iDe&&t.data instanceof Blob)return t.data.arrayBuffer().then(RQ).then(e);if(nDe&&(t.data instanceof ArrayBuffer||rDe(t.data)))return e(RQ(t.data));IY(t,!1,i=>{fB||(fB=new TextEncoder),e(fB.encode(i))})}const MQ="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Y1=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(let t=0;t<MQ.length;t++)Y1[MQ.charCodeAt(t)]=t;const gtt=t=>{let e=t.length*.75,i=t.length,n,r=0,a,s,o,l;t[t.length-1]==="="&&(e--,t[t.length-2]==="="&&e--);const c=new ArrayBuffer(e),u=new Uint8Array(c);for(n=0;n<i;n+=4)a=Y1[t.charCodeAt(n)],s=Y1[t.charCodeAt(n+1)],o=Y1[t.charCodeAt(n+2)],l=Y1[t.charCodeAt(n+3)],u[r++]=a<<2|s>>4,u[r++]=(s&15)<<4|o>>2,u[r++]=(o&3)<<6|l&63;return c},vtt=typeof ArrayBuffer=="function",wY=(t,e)=>{if(typeof t!="string")return{type:"message",data:aDe(t,e)};const i=t.charAt(0);return i==="b"?{type:"message",data:ytt(t.substring(1),e)}:vA[i]?t.length>1?{type:vA[i],data:t.substring(1)}:{type:vA[i]}:oH},ytt=(t,e)=>{if(vtt){const i=gtt(t);return aDe(i,e)}else return{base64:!0,data:t}},aDe=(t,e)=>{switch(e){case"blob":return t instanceof Blob?t:new Blob([t]);case"arraybuffer":default:return t instanceof ArrayBuffer?t:t.buffer}},sDe="",btt=(t,e)=>{const i=t.length,n=new Array(i);let r=0;t.forEach((a,s)=>{IY(a,!1,o=>{n[s]=o,++r===i&&e(n.join(sDe))})})},Itt=(t,e)=>{const i=t.split(sDe),n=[];for(let r=0;r<i.length;r++){const a=wY(i[r],e);if(n.push(a),a.type==="error")break}return n};function wtt(){return new TransformStream({transform(t,e){mtt(t,i=>{const n=i.length;let r;if(n<126)r=new Uint8Array(1),new DataView(r.buffer).setUint8(0,n);else if(n<65536){r=new Uint8Array(3);const a=new DataView(r.buffer);a.setUint8(0,126),a.setUint16(1,n)}else{r=new Uint8Array(9);const a=new DataView(r.buffer);a.setUint8(0,127),a.setBigUint64(1,BigInt(n))}t.data&&typeof t.data!="string"&&(r[0]|=128),e.enqueue(r),e.enqueue(i)})}})}let mB;function tN(t){return t.reduce((e,i)=>e+i.length,0)}function iN(t,e){if(t[0].length===e)return t.shift();const i=new Uint8Array(e);let n=0;for(let r=0;r<e;r++)i[r]=t[0][n++],n===t[0].length&&(t.shift(),n=0);return t.length&&n<t[0].length&&(t[0]=t[0].slice(n)),i}function Stt(t,e){mB||(mB=new TextDecoder);const i=[];let n=0,r=-1,a=!1;return new TransformStream({transform(s,o){for(i.push(s);;){if(n===0){if(tN(i)<1)break;const l=iN(i,1);a=(l[0]&128)===128,r=l[0]&127,r<126?n=3:r===126?n=1:n=2}else if(n===1){if(tN(i)<2)break;const l=iN(i,2);r=new DataView(l.buffer,l.byteOffset,l.length).getUint16(0),n=3}else if(n===2){if(tN(i)<8)break;const l=iN(i,8),c=new DataView(l.buffer,l.byteOffset,l.length),u=c.getUint32(0);if(u>Math.pow(2,21)-1){o.enqueue(oH);break}r=u*Math.pow(2,32)+c.getUint32(4),n=3}else{if(tN(i)<r)break;const l=iN(i,r);o.enqueue(wY(a?l:mB.decode(l),e)),n=0}if(r===0||r>t){o.enqueue(oH);break}}}})}const oDe=4;function ro(t){if(t)return Ttt(t)}function Ttt(t){for(var e in ro.prototype)t[e]=ro.prototype[e];return t}ro.prototype.on=ro.prototype.addEventListener=function(t,e){return this._callbacks=this._callbacks||{},(this._callbacks["$"+t]=this._callbacks["$"+t]||[]).push(e),this};ro.prototype.once=function(t,e){function i(){this.off(t,i),e.apply(this,arguments)}return i.fn=e,this.on(t,i),this};ro.prototype.off=ro.prototype.removeListener=ro.prototype.removeAllListeners=ro.prototype.removeEventListener=function(t,e){if(this._callbacks=this._callbacks||{},arguments.length==0)return this._callbacks={},this;var i=this._callbacks["$"+t];if(!i)return this;if(arguments.length==1)return delete this._callbacks["$"+t],this;for(var n,r=0;r<i.length;r++)if(n=i[r],n===e||n.fn===e){i.splice(r,1);break}return i.length===0&&delete this._callbacks["$"+t],this};ro.prototype.emit=function(t){this._callbacks=this._callbacks||{};for(var e=new Array(arguments.length-1),i=this._callbacks["$"+t],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(i){i=i.slice(0);for(var n=0,r=i.length;n<r;++n)i[n].apply(this,e)}return this};ro.prototype.emitReserved=ro.prototype.emit;ro.prototype.listeners=function(t){return this._callbacks=this._callbacks||{},this._callbacks["$"+t]||[]};ro.prototype.hasListeners=function(t){return!!this.listeners(t).length};const ap=typeof self<"u"?self:typeof window<"u"?window:Function("return this")();function lDe(t,...e){return e.reduce((i,n)=>(t.hasOwnProperty(n)&&(i[n]=t[n]),i),{})}const Utt=ap.setTimeout,Dtt=ap.clearTimeout;function N2(t,e){e.useNativeTimers?(t.setTimeoutFn=Utt.bind(ap),t.clearTimeoutFn=Dtt.bind(ap)):(t.setTimeoutFn=ap.setTimeout.bind(ap),t.clearTimeoutFn=ap.clearTimeout.bind(ap))}const Ett=1.33;function Ptt(t){return typeof t=="string"?Ctt(t):Math.ceil((t.byteLength||t.size)*Ett)}function Ctt(t){let e=0,i=0;for(let n=0,r=t.length;n<r;n++)e=t.charCodeAt(n),e<128?i+=1:e<2048?i+=2:e<55296||e>=57344?i+=3:(n++,i+=4);return i}function Rtt(t){let e="";for(let i in t)t.hasOwnProperty(i)&&(e.length&&(e+="&"),e+=encodeURIComponent(i)+"="+encodeURIComponent(t[i]));return e}function Mtt(t){let e={},i=t.split("&");for(let n=0,r=i.length;n<r;n++){let a=i[n].split("=");e[decodeURIComponent(a[0])]=decodeURIComponent(a[1])}return e}class Ntt extends Error{constructor(e,i,n){super(e),this.description=i,this.context=n,this.type="TransportError"}}class SY extends ro{constructor(e){super(),this.writable=!1,N2(this,e),this.opts=e,this.query=e.query,this.socket=e.socket}onError(e,i,n){return super.emitReserved("error",new Ntt(e,i,n)),this}open(){return this.readyState="opening",this.doOpen(),this}close(){return(this.readyState==="opening"||this.readyState==="open")&&(this.doClose(),this.onClose()),this}send(e){this.readyState==="open"&&this.write(e)}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(e){const i=wY(e,this.socket.binaryType);this.onPacket(i)}onPacket(e){super.emitReserved("packet",e)}onClose(e){this.readyState="closed",super.emitReserved("close",e)}pause(e){}createUri(e,i={}){return e+"://"+this._hostname()+this._port()+this.opts.path+this._query(i)}_hostname(){const e=this.opts.hostname;return e.indexOf(":")===-1?e:"["+e+"]"}_port(){return this.opts.port&&(this.opts.secure&&+(this.opts.port!==443)||!this.opts.secure&&Number(this.opts.port)!==80)?":"+this.opts.port:""}_query(e){const i=Rtt(e);return i.length?"?"+i:""}}const cDe="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),lH=64,Att={};let NQ=0,nN=0,AQ;function _Q(t){let e="";do e=cDe[t%lH]+e,t=Math.floor(t/lH);while(t>0);return e}function uDe(){const t=_Q(+new Date);return t!==AQ?(NQ=0,AQ=t):t+"."+_Q(NQ++)}for(;nN<lH;nN++)Att[cDe[nN]]=nN;let dDe=!1;try{dDe=typeof XMLHttpRequest<"u"&&"withCredentials"in new XMLHttpRequest}catch{}const _tt=dDe;function pDe(t){const e=t.xdomain;try{if(typeof XMLHttpRequest<"u"&&(!e||_tt))return new XMLHttpRequest}catch{}if(!e)try{return new ap[["Active"].concat("Object").join("X")]("Microsoft.XMLHTTP")}catch{}}function ktt(){}const xtt=function(){return new pDe({xdomain:!1}).responseType!=null}();class Ott extends SY{constructor(e){if(super(e),this.polling=!1,typeof location<"u"){const n=location.protocol==="https:";let r=location.port;r||(r=n?"443":"80"),this.xd=typeof location<"u"&&e.hostname!==location.hostname||r!==e.port}const i=e&&e.forceBase64;this.supportsBinary=xtt&&!i,this.opts.withCredentials&&(this.cookieJar=void 0)}get name(){return"polling"}doOpen(){this.poll()}pause(e){this.readyState="pausing";const i=()=>{this.readyState="paused",e()};if(this.polling||!this.writable){let n=0;this.polling&&(n++,this.once("pollComplete",function(){--n||i()})),this.writable||(n++,this.once("drain",function(){--n||i()}))}else i()}poll(){this.polling=!0,this.doPoll(),this.emitReserved("poll")}onData(e){const i=n=>{if(this.readyState==="opening"&&n.type==="open"&&this.onOpen(),n.type==="close")return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(n)};Itt(e,this.socket.binaryType).forEach(i),this.readyState!=="closed"&&(this.polling=!1,this.emitReserved("pollComplete"),this.readyState==="open"&&this.poll())}doClose(){const e=()=>{this.write([{type:"close"}])};this.readyState==="open"?e():this.once("open",e)}write(e){this.writable=!1,btt(e,i=>{this.doWrite(i,()=>{this.writable=!0,this.emitReserved("drain")})})}uri(){const e=this.opts.secure?"https":"http",i=this.query||{};return this.opts.timestampRequests!==!1&&(i[this.opts.timestampParam]=uDe()),!this.supportsBinary&&!i.sid&&(i.b64=1),this.createUri(e,i)}request(e={}){return Object.assign(e,{xd:this.xd,cookieJar:this.cookieJar},this.opts),new yS(this.uri(),e)}doWrite(e,i){const n=this.request({method:"POST",data:e});n.on("success",i),n.on("error",(r,a)=>{this.onError("xhr post error",r,a)})}doPoll(){const e=this.request();e.on("data",this.onData.bind(this)),e.on("error",(i,n)=>{this.onError("xhr poll error",i,n)}),this.pollXhr=e}}let yS=class yA extends ro{constructor(e,i){super(),N2(this,i),this.opts=i,this.method=i.method||"GET",this.uri=e,this.data=i.data!==void 0?i.data:null,this.create()}create(){var e;const i=lDe(this.opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");i.xdomain=!!this.opts.xd;const n=this.xhr=new pDe(i);try{n.open(this.method,this.uri,!0);try{if(this.opts.extraHeaders){n.setDisableHeaderCheck&&n.setDisableHeaderCheck(!0);for(let r in this.opts.extraHeaders)this.opts.extraHeaders.hasOwnProperty(r)&&n.setRequestHeader(r,this.opts.extraHeaders[r])}}catch{}if(this.method==="POST")try{n.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch{}try{n.setRequestHeader("Accept","*/*")}catch{}(e=this.opts.cookieJar)===null||e===void 0||e.addCookies(n),"withCredentials"in n&&(n.withCredentials=this.opts.withCredentials),this.opts.requestTimeout&&(n.timeout=this.opts.requestTimeout),n.onreadystatechange=()=>{var r;n.readyState===3&&((r=this.opts.cookieJar)===null||r===void 0||r.parseCookies(n)),n.readyState===4&&(n.status===200||n.status===1223?this.onLoad():this.setTimeoutFn(()=>{this.onError(typeof n.status=="number"?n.status:0)},0))},n.send(this.data)}catch(r){this.setTimeoutFn(()=>{this.onError(r)},0);return}typeof document<"u"&&(this.index=yA.requestsCount++,yA.requests[this.index]=this)}onError(e){this.emitReserved("error",e,this.xhr),this.cleanup(!0)}cleanup(e){if(!(typeof this.xhr>"u"||this.xhr===null)){if(this.xhr.onreadystatechange=ktt,e)try{this.xhr.abort()}catch{}typeof document<"u"&&delete yA.requests[this.index],this.xhr=null}}onLoad(){const e=this.xhr.responseText;e!==null&&(this.emitReserved("data",e),this.emitReserved("success"),this.cleanup())}abort(){this.cleanup()}};yS.requestsCount=0;yS.requests={};if(typeof document<"u"){if(typeof attachEvent=="function")attachEvent("onunload",kQ);else if(typeof addEventListener=="function"){const t="onpagehide"in ap?"pagehide":"unload";addEventListener(t,kQ,!1)}}function kQ(){for(let t in yS.requests)yS.requests.hasOwnProperty(t)&&yS.requests[t].abort()}const TY=typeof Promise=="function"&&typeof Promise.resolve=="function"?e=>Promise.resolve().then(e):(e,i)=>i(e,0),rN=ap.WebSocket||ap.MozWebSocket,xQ=!0,Ltt="arraybuffer",OQ=typeof navigator<"u"&&typeof navigator.product=="string"&&navigator.product.toLowerCase()==="reactnative";class Ftt extends SY{constructor(e){super(e),this.supportsBinary=!e.forceBase64}get name(){return"websocket"}doOpen(){if(!this.check())return;const e=this.uri(),i=this.opts.protocols,n=OQ?{}:lDe(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(n.headers=this.opts.extraHeaders);try{this.ws=xQ&&!OQ?i?new rN(e,i):new rN(e):new rN(e,i,n)}catch(r){return this.emitReserved("error",r)}this.ws.binaryType=this.socket.binaryType,this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=e=>this.onClose({description:"websocket connection closed",context:e}),this.ws.onmessage=e=>this.onData(e.data),this.ws.onerror=e=>this.onError("websocket error",e)}write(e){this.writable=!1;for(let i=0;i<e.length;i++){const n=e[i],r=i===e.length-1;IY(n,this.supportsBinary,a=>{const s={};try{xQ&&this.ws.send(a)}catch{}r&&TY(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){typeof this.ws<"u"&&(this.ws.close(),this.ws=null)}uri(){const e=this.opts.secure?"wss":"ws",i=this.query||{};return this.opts.timestampRequests&&(i[this.opts.timestampParam]=uDe()),this.supportsBinary||(i.b64=1),this.createUri(e,i)}check(){return!!rN}}class $tt extends SY{get name(){return"webtransport"}doOpen(){typeof WebTransport=="function"&&(this.transport=new WebTransport(this.createUri("https"),this.opts.transportOptions[this.name]),this.transport.closed.then(()=>{this.onClose()}).catch(e=>{this.onError("webtransport error",e)}),this.transport.ready.then(()=>{this.transport.createBidirectionalStream().then(e=>{const i=Stt(Number.MAX_SAFE_INTEGER,this.socket.binaryType),n=e.readable.pipeThrough(i).getReader(),r=wtt();r.readable.pipeTo(e.writable),this.writer=r.writable.getWriter();const a=()=>{n.read().then(({done:o,value:l})=>{o||(this.onPacket(l),a())}).catch(o=>{})};a();const s={type:"open"};this.query.sid&&(s.data=`{"sid":"${this.query.sid}"}`),this.writer.write(s).then(()=>this.onOpen())})}))}write(e){this.writable=!1;for(let i=0;i<e.length;i++){const n=e[i],r=i===e.length-1;this.writer.write(n).then(()=>{r&&TY(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){var e;(e=this.transport)===null||e===void 0||e.close()}}const Btt={websocket:Ftt,webtransport:$tt,polling:Ott},Vtt=/^(?:(?![^:@\/?#]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,jtt=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function cH(t){if(t.length>2e3)throw"URI too long";const e=t,i=t.indexOf("["),n=t.indexOf("]");i!=-1&&n!=-1&&(t=t.substring(0,i)+t.substring(i,n).replace(/:/g,";")+t.substring(n,t.length));let r=Vtt.exec(t||""),a={},s=14;for(;s--;)a[jtt[s]]=r[s]||"";return i!=-1&&n!=-1&&(a.source=e,a.host=a.host.substring(1,a.host.length-1).replace(/;/g,":"),a.authority=a.authority.replace("[","").replace("]","").replace(/;/g,":"),a.ipv6uri=!0),a.pathNames=Gtt(a,a.path),a.queryKey=Htt(a,a.query),a}function Gtt(t,e){const i=/\/{2,9}/g,n=e.replace(i,"/").split("/");return(e.slice(0,1)=="/"||e.length===0)&&n.splice(0,1),e.slice(-1)=="/"&&n.splice(n.length-1,1),n}function Htt(t,e){const i={};return e.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(n,r,a){r&&(i[r]=a)}),i}let hDe=class j0 extends ro{constructor(e,i={}){super(),this.binaryType=Ltt,this.writeBuffer=[],e&&typeof e=="object"&&(i=e,e=null),e?(e=cH(e),i.hostname=e.host,i.secure=e.protocol==="https"||e.protocol==="wss",i.port=e.port,e.query&&(i.query=e.query)):i.host&&(i.hostname=cH(i.host).host),N2(this,i),this.secure=i.secure!=null?i.secure:typeof location<"u"&&location.protocol==="https:",i.hostname&&!i.port&&(i.port=this.secure?"443":"80"),this.hostname=i.hostname||(typeof location<"u"?location.hostname:"localhost"),this.port=i.port||(typeof location<"u"&&location.port?location.port:this.secure?"443":"80"),this.transports=i.transports||["polling","websocket","webtransport"],this.writeBuffer=[],this.prevBufferLen=0,this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,addTrailingSlash:!0,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!1},i),this.opts.path=this.opts.path.replace(/\/$/,"")+(this.opts.addTrailingSlash?"/":""),typeof this.opts.query=="string"&&(this.opts.query=Mtt(this.opts.query)),this.id=null,this.upgrades=null,this.pingInterval=null,this.pingTimeout=null,this.pingTimeoutTimer=null,typeof addEventListener=="function"&&(this.opts.closeOnBeforeunload&&(this.beforeunloadEventListener=()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},addEventListener("beforeunload",this.beforeunloadEventListener,!1)),this.hostname!=="localhost"&&(this.offlineEventListener=()=>{this.onClose("transport close",{description:"network connection lost"})},addEventListener("offline",this.offlineEventListener,!1))),this.open()}createTransport(e){const i=Object.assign({},this.opts.query);i.EIO=oDe,i.transport=e,this.id&&(i.sid=this.id);const n=Object.assign({},this.opts,{query:i,socket:this,hostname:this.hostname,secure:this.secure,port:this.port},this.opts.transportOptions[e]);return new Btt[e](n)}open(){let e;if(this.opts.rememberUpgrade&&j0.priorWebsocketSuccess&&this.transports.indexOf("websocket")!==-1)e="websocket";else if(this.transports.length===0){this.setTimeoutFn(()=>{this.emitReserved("error","No transports available")},0);return}else e=this.transports[0];this.readyState="opening";try{e=this.createTransport(e)}catch{this.transports.shift(),this.open();return}e.open(),this.setTransport(e)}setTransport(e){this.transport&&this.transport.removeAllListeners(),this.transport=e,e.on("drain",this.onDrain.bind(this)).on("packet",this.onPacket.bind(this)).on("error",this.onError.bind(this)).on("close",i=>this.onClose("transport close",i))}probe(e){let i=this.createTransport(e),n=!1;j0.priorWebsocketSuccess=!1;const r=()=>{n||(i.send([{type:"ping",data:"probe"}]),i.once("packet",d=>{if(!n)if(d.type==="pong"&&d.data==="probe"){if(this.upgrading=!0,this.emitReserved("upgrading",i),!i)return;j0.priorWebsocketSuccess=i.name==="websocket",this.transport.pause(()=>{n||this.readyState!=="closed"&&(u(),this.setTransport(i),i.send([{type:"upgrade"}]),this.emitReserved("upgrade",i),i=null,this.upgrading=!1,this.flush())})}else{const p=new Error("probe error");p.transport=i.name,this.emitReserved("upgradeError",p)}}))};function a(){n||(n=!0,u(),i.close(),i=null)}const s=d=>{const p=new Error("probe error: "+d);p.transport=i.name,a(),this.emitReserved("upgradeError",p)};function o(){s("transport closed")}function l(){s("socket closed")}function c(d){i&&d.name!==i.name&&a()}const u=()=>{i.removeListener("open",r),i.removeListener("error",s),i.removeListener("close",o),this.off("close",l),this.off("upgrading",c)};i.once("open",r),i.once("error",s),i.once("close",o),this.once("close",l),this.once("upgrading",c),this.upgrades.indexOf("webtransport")!==-1&&e!=="webtransport"?this.setTimeoutFn(()=>{n||i.open()},200):i.open()}onOpen(){if(this.readyState="open",j0.priorWebsocketSuccess=this.transport.name==="websocket",this.emitReserved("open"),this.flush(),this.readyState==="open"&&this.opts.upgrade){let e=0;const i=this.upgrades.length;for(;e<i;e++)this.probe(this.upgrades[e])}}onPacket(e){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")switch(this.emitReserved("packet",e),this.emitReserved("heartbeat"),this.resetPingTimeout(),e.type){case"open":this.onHandshake(JSON.parse(e.data));break;case"ping":this.sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong");break;case"error":const i=new Error("server error");i.code=e.data,this.onError(i);break;case"message":this.emitReserved("data",e.data),this.emitReserved("message",e.data);break}}onHandshake(e){this.emitReserved("handshake",e),this.id=e.sid,this.transport.query.sid=e.sid,this.upgrades=this.filterUpgrades(e.upgrades),this.pingInterval=e.pingInterval,this.pingTimeout=e.pingTimeout,this.maxPayload=e.maxPayload,this.onOpen(),this.readyState!=="closed"&&this.resetPingTimeout()}resetPingTimeout(){this.clearTimeoutFn(this.pingTimeoutTimer),this.pingTimeoutTimer=this.setTimeoutFn(()=>{this.onClose("ping timeout")},this.pingInterval+this.pingTimeout),this.opts.autoUnref&&this.pingTimeoutTimer.unref()}onDrain(){this.writeBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,this.writeBuffer.length===0?this.emitReserved("drain"):this.flush()}flush(){if(this.readyState!=="closed"&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){const e=this.getWritablePackets();this.transport.send(e),this.prevBufferLen=e.length,this.emitReserved("flush")}}getWritablePackets(){if(!(this.maxPayload&&this.transport.name==="polling"&&this.writeBuffer.length>1))return this.writeBuffer;let i=1;for(let n=0;n<this.writeBuffer.length;n++){const r=this.writeBuffer[n].data;if(r&&(i+=Ptt(r)),n>0&&i>this.maxPayload)return this.writeBuffer.slice(0,n);i+=2}return this.writeBuffer}write(e,i,n){return this.sendPacket("message",e,i,n),this}send(e,i,n){return this.sendPacket("message",e,i,n),this}sendPacket(e,i,n,r){if(typeof i=="function"&&(r=i,i=void 0),typeof n=="function"&&(r=n,n=null),this.readyState==="closing"||this.readyState==="closed")return;n=n||{},n.compress=n.compress!==!1;const a={type:e,data:i,options:n};this.emitReserved("packetCreate",a),this.writeBuffer.push(a),r&&this.once("flush",r),this.flush()}close(){const e=()=>{this.onClose("forced close"),this.transport.close()},i=()=>{this.off("upgrade",i),this.off("upgradeError",i),e()},n=()=>{this.once("upgrade",i),this.once("upgradeError",i)};return(this.readyState==="opening"||this.readyState==="open")&&(this.readyState="closing",this.writeBuffer.length?this.once("drain",()=>{this.upgrading?n():e()}):this.upgrading?n():e()),this}onError(e){j0.priorWebsocketSuccess=!1,this.emitReserved("error",e),this.onClose("transport error",e)}onClose(e,i){(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")&&(this.clearTimeoutFn(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),typeof removeEventListener=="function"&&(removeEventListener("beforeunload",this.beforeunloadEventListener,!1),removeEventListener("offline",this.offlineEventListener,!1)),this.readyState="closed",this.id=null,this.emitReserved("close",e,i),this.writeBuffer=[],this.prevBufferLen=0)}filterUpgrades(e){const i=[];let n=0;const r=e.length;for(;n<r;n++)~this.transports.indexOf(e[n])&&i.push(e[n]);return i}};hDe.protocol=oDe;function ztt(t,e="",i){let n=t;i=i||typeof location<"u"&&location,t==null&&(t=i.protocol+"//"+i.host),typeof t=="string"&&(t.charAt(0)==="/"&&(t.charAt(1)==="/"?t=i.protocol+t:t=i.host+t),/^(https?|wss?):\/\//.test(t)||(typeof i<"u"?t=i.protocol+"//"+t:t="https://"+t),n=cH(t)),n.port||(/^(http|ws)$/.test(n.protocol)?n.port="80":/^(http|ws)s$/.test(n.protocol)&&(n.port="443")),n.path=n.path||"/";const a=n.host.indexOf(":")!==-1?"["+n.host+"]":n.host;return n.id=n.protocol+"://"+a+":"+n.port+e,n.href=n.protocol+"://"+a+(i&&i.port===n.port?"":":"+n.port),n}const qtt=typeof ArrayBuffer=="function",Wtt=t=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(t):t.buffer instanceof ArrayBuffer,fDe=Object.prototype.toString,Ytt=typeof Blob=="function"||typeof Blob<"u"&&fDe.call(Blob)==="[object BlobConstructor]",Ktt=typeof File=="function"||typeof File<"u"&&fDe.call(File)==="[object FileConstructor]";function UY(t){return qtt&&(t instanceof ArrayBuffer||Wtt(t))||Ytt&&t instanceof Blob||Ktt&&t instanceof File}function bA(t,e){if(!t||typeof t!="object")return!1;if(Array.isArray(t)){for(let i=0,n=t.length;i<n;i++)if(bA(t[i]))return!0;return!1}if(UY(t))return!0;if(t.toJSON&&typeof t.toJSON=="function"&&arguments.length===1)return bA(t.toJSON(),!0);for(const i in t)if(Object.prototype.hasOwnProperty.call(t,i)&&bA(t[i]))return!0;return!1}function Ztt(t){const e=[],i=t.data,n=t;return n.data=uH(i,e),n.attachments=e.length,{packet:n,buffers:e}}function uH(t,e){if(!t)return t;if(UY(t)){const i={_placeholder:!0,num:e.length};return e.push(t),i}else if(Array.isArray(t)){const i=new Array(t.length);for(let n=0;n<t.length;n++)i[n]=uH(t[n],e);return i}else if(typeof t=="object"&&!(t instanceof Date)){const i={};for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&(i[n]=uH(t[n],e));return i}return t}function Xtt(t,e){return t.data=dH(t.data,e),delete t.attachments,t}function dH(t,e){if(!t)return t;if(t&&t._placeholder===!0){if(typeof t.num=="number"&&t.num>=0&&t.num<e.length)return e[t.num];throw new Error("illegal attachments")}else if(Array.isArray(t))for(let i=0;i<t.length;i++)t[i]=dH(t[i],e);else if(typeof t=="object")for(const i in t)Object.prototype.hasOwnProperty.call(t,i)&&(t[i]=dH(t[i],e));return t}const Jtt=["connect","connect_error","disconnect","disconnecting","newListener","removeListener"],Qtt=5;var mr;(function(t){t[t.CONNECT=0]="CONNECT",t[t.DISCONNECT=1]="DISCONNECT",t[t.EVENT=2]="EVENT",t[t.ACK=3]="ACK",t[t.CONNECT_ERROR=4]="CONNECT_ERROR",t[t.BINARY_EVENT=5]="BINARY_EVENT",t[t.BINARY_ACK=6]="BINARY_ACK"})(mr||(mr={}));class eit{constructor(e){this.replacer=e}encode(e){return(e.type===mr.EVENT||e.type===mr.ACK)&&bA(e)?this.encodeAsBinary({type:e.type===mr.EVENT?mr.BINARY_EVENT:mr.BINARY_ACK,nsp:e.nsp,data:e.data,id:e.id}):[this.encodeAsString(e)]}encodeAsString(e){let i=""+e.type;return(e.type===mr.BINARY_EVENT||e.type===mr.BINARY_ACK)&&(i+=e.attachments+"-"),e.nsp&&e.nsp!=="/"&&(i+=e.nsp+","),e.id!=null&&(i+=e.id),e.data!=null&&(i+=JSON.stringify(e.data,this.replacer)),i}encodeAsBinary(e){const i=Ztt(e),n=this.encodeAsString(i.packet),r=i.buffers;return r.unshift(n),r}}function LQ(t){return Object.prototype.toString.call(t)==="[object Object]"}class DY extends ro{constructor(e){super(),this.reviver=e}add(e){let i;if(typeof e=="string"){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");i=this.decodeString(e);const n=i.type===mr.BINARY_EVENT;n||i.type===mr.BINARY_ACK?(i.type=n?mr.EVENT:mr.ACK,this.reconstructor=new tit(i),i.attachments===0&&super.emitReserved("decoded",i)):super.emitReserved("decoded",i)}else if(UY(e)||e.base64)if(this.reconstructor)i=this.reconstructor.takeBinaryData(e),i&&(this.reconstructor=null,super.emitReserved("decoded",i));else throw new Error("got binary data when not reconstructing a packet");else throw new Error("Unknown type: "+e)}decodeString(e){let i=0;const n={type:Number(e.charAt(0))};if(mr[n.type]===void 0)throw new Error("unknown packet type "+n.type);if(n.type===mr.BINARY_EVENT||n.type===mr.BINARY_ACK){const a=i+1;for(;e.charAt(++i)!=="-"&&i!=e.length;);const s=e.substring(a,i);if(s!=Number(s)||e.charAt(i)!=="-")throw new Error("Illegal attachments");n.attachments=Number(s)}if(e.charAt(i+1)==="/"){const a=i+1;for(;++i&&!(e.charAt(i)===","||i===e.length););n.nsp=e.substring(a,i)}else n.nsp="/";const r=e.charAt(i+1);if(r!==""&&Number(r)==r){const a=i+1;for(;++i;){const s=e.charAt(i);if(s==null||Number(s)!=s){--i;break}if(i===e.length)break}n.id=Number(e.substring(a,i+1))}if(e.charAt(++i)){const a=this.tryParse(e.substr(i));if(DY.isPayloadValid(n.type,a))n.data=a;else throw new Error("invalid payload")}return n}tryParse(e){try{return JSON.parse(e,this.reviver)}catch{return!1}}static isPayloadValid(e,i){switch(e){case mr.CONNECT:return LQ(i);case mr.DISCONNECT:return i===void 0;case mr.CONNECT_ERROR:return typeof i=="string"||LQ(i);case mr.EVENT:case mr.BINARY_EVENT:return Array.isArray(i)&&(typeof i[0]=="number"||typeof i[0]=="string"&&Jtt.indexOf(i[0])===-1);case mr.ACK:case mr.BINARY_ACK:return Array.isArray(i)}}destroy(){this.reconstructor&&(this.reconstructor.finishedReconstruction(),this.reconstructor=null)}}class tit{constructor(e){this.packet=e,this.buffers=[],this.reconPack=e}takeBinaryData(e){if(this.buffers.push(e),this.buffers.length===this.reconPack.attachments){const i=Xtt(this.reconPack,this.buffers);return this.finishedReconstruction(),i}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}const iit=Object.freeze(Object.defineProperty({__proto__:null,Decoder:DY,Encoder:eit,get PacketType(){return mr},protocol:Qtt},Symbol.toStringTag,{value:"Module"}));function ch(t,e,i){return t.on(e,i),function(){t.off(e,i)}}const nit=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class mDe extends ro{constructor(e,i,n){super(),this.connected=!1,this.recovered=!1,this.receiveBuffer=[],this.sendBuffer=[],this._queue=[],this._queueSeq=0,this.ids=0,this.acks={},this.flags={},this.io=e,this.nsp=i,n&&n.auth&&(this.auth=n.auth),this._opts=Object.assign({},n),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;const e=this.io;this.subs=[ch(e,"open",this.onopen.bind(this)),ch(e,"packet",this.onpacket.bind(this)),ch(e,"error",this.onerror.bind(this)),ch(e,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected?this:(this.subEvents(),this.io._reconnecting||this.io.open(),this.io._readyState==="open"&&this.onopen(),this)}open(){return this.connect()}send(...e){return e.unshift("message"),this.emit.apply(this,e),this}emit(e,...i){if(nit.hasOwnProperty(e))throw new Error('"'+e.toString()+'" is a reserved event name');if(i.unshift(e),this._opts.retries&&!this.flags.fromQueue&&!this.flags.volatile)return this._addToQueue(i),this;const n={type:mr.EVENT,data:i};if(n.options={},n.options.compress=this.flags.compress!==!1,typeof i[i.length-1]=="function"){const s=this.ids++,o=i.pop();this._registerAckCallback(s,o),n.id=s}const r=this.io.engine&&this.io.engine.transport&&this.io.engine.transport.writable;return this.flags.volatile&&(!r||!this.connected)||(this.connected?(this.notifyOutgoingListeners(n),this.packet(n)):this.sendBuffer.push(n)),this.flags={},this}_registerAckCallback(e,i){var n;const r=(n=this.flags.timeout)!==null&&n!==void 0?n:this._opts.ackTimeout;if(r===void 0){this.acks[e]=i;return}const a=this.io.setTimeoutFn(()=>{delete this.acks[e];for(let o=0;o<this.sendBuffer.length;o++)this.sendBuffer[o].id===e&&this.sendBuffer.splice(o,1);i.call(this,new Error("operation has timed out"))},r),s=(...o)=>{this.io.clearTimeoutFn(a),i.apply(this,o)};s.withError=!0,this.acks[e]=s}emitWithAck(e,...i){return new Promise((n,r)=>{const a=(s,o)=>s?r(s):n(o);a.withError=!0,i.push(a),this.emit(e,...i)})}_addToQueue(e){let i;typeof e[e.length-1]=="function"&&(i=e.pop());const n={id:this._queueSeq++,tryCount:0,pending:!1,args:e,flags:Object.assign({fromQueue:!0},this.flags)};e.push((r,...a)=>n!==this._queue[0]?void 0:(r!==null?n.tryCount>this._opts.retries&&(this._queue.shift(),i&&i(r)):(this._queue.shift(),i&&i(null,...a)),n.pending=!1,this._drainQueue())),this._queue.push(n),this._drainQueue()}_drainQueue(e=!1){if(!this.connected||this._queue.length===0)return;const i=this._queue[0];i.pending&&!e||(i.pending=!0,i.tryCount++,this.flags=i.flags,this.emit.apply(this,i.args))}packet(e){e.nsp=this.nsp,this.io._packet(e)}onopen(){typeof this.auth=="function"?this.auth(e=>{this._sendConnectPacket(e)}):this._sendConnectPacket(this.auth)}_sendConnectPacket(e){this.packet({type:mr.CONNECT,data:this._pid?Object.assign({pid:this._pid,offset:this._lastOffset},e):e})}onerror(e){this.connected||this.emitReserved("connect_error",e)}onclose(e,i){this.connected=!1,delete this.id,this.emitReserved("disconnect",e,i),this._clearAcks()}_clearAcks(){Object.keys(this.acks).forEach(e=>{if(!this.sendBuffer.some(n=>String(n.id)===e)){const n=this.acks[e];delete this.acks[e],n.withError&&n.call(this,new Error("socket has been disconnected"))}})}onpacket(e){if(e.nsp===this.nsp)switch(e.type){case mr.CONNECT:e.data&&e.data.sid?this.onconnect(e.data.sid,e.data.pid):this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case mr.EVENT:case mr.BINARY_EVENT:this.onevent(e);break;case mr.ACK:case mr.BINARY_ACK:this.onack(e);break;case mr.DISCONNECT:this.ondisconnect();break;case mr.CONNECT_ERROR:this.destroy();const n=new Error(e.data.message);n.data=e.data.data,this.emitReserved("connect_error",n);break}}onevent(e){const i=e.data||[];e.id!=null&&i.push(this.ack(e.id)),this.connected?this.emitEvent(i):this.receiveBuffer.push(Object.freeze(i))}emitEvent(e){if(this._anyListeners&&this._anyListeners.length){const i=this._anyListeners.slice();for(const n of i)n.apply(this,e)}super.emit.apply(this,e),this._pid&&e.length&&typeof e[e.length-1]=="string"&&(this._lastOffset=e[e.length-1])}ack(e){const i=this;let n=!1;return function(...r){n||(n=!0,i.packet({type:mr.ACK,id:e,data:r}))}}onack(e){const i=this.acks[e.id];typeof i=="function"&&(delete this.acks[e.id],i.withError&&e.data.unshift(null),i.apply(this,e.data))}onconnect(e,i){this.id=e,this.recovered=i&&this._pid===i,this._pid=i,this.connected=!0,this.emitBuffered(),this.emitReserved("connect"),this._drainQueue(!0)}emitBuffered(){this.receiveBuffer.forEach(e=>this.emitEvent(e)),this.receiveBuffer=[],this.sendBuffer.forEach(e=>{this.notifyOutgoingListeners(e),this.packet(e)}),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach(e=>e()),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&this.packet({type:mr.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(e){return this.flags.compress=e,this}get volatile(){return this.flags.volatile=!0,this}timeout(e){return this.flags.timeout=e,this}onAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(e),this}prependAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(e),this}offAny(e){if(!this._anyListeners)return this;if(e){const i=this._anyListeners;for(let n=0;n<i.length;n++)if(e===i[n])return i.splice(n,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(e),this}prependAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(e),this}offAnyOutgoing(e){if(!this._anyOutgoingListeners)return this;if(e){const i=this._anyOutgoingListeners;for(let n=0;n<i.length;n++)if(e===i[n])return i.splice(n,1),this}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(e){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){const i=this._anyOutgoingListeners.slice();for(const n of i)n.apply(this,e.data)}}}function c1(t){t=t||{},this.ms=t.min||100,this.max=t.max||1e4,this.factor=t.factor||2,this.jitter=t.jitter>0&&t.jitter<=1?t.jitter:0,this.attempts=0}c1.prototype.duration=function(){var t=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var e=Math.random(),i=Math.floor(e*this.jitter*t);t=Math.floor(e*10)&1?t+i:t-i}return Math.min(t,this.max)|0};c1.prototype.reset=function(){this.attempts=0};c1.prototype.setMin=function(t){this.ms=t};c1.prototype.setMax=function(t){this.max=t};c1.prototype.setJitter=function(t){this.jitter=t};class pH extends ro{constructor(e,i){var n;super(),this.nsps={},this.subs=[],e&&typeof e=="object"&&(i=e,e=void 0),i=i||{},i.path=i.path||"/socket.io",this.opts=i,N2(this,i),this.reconnection(i.reconnection!==!1),this.reconnectionAttempts(i.reconnectionAttempts||1/0),this.reconnectionDelay(i.reconnectionDelay||1e3),this.reconnectionDelayMax(i.reconnectionDelayMax||5e3),this.randomizationFactor((n=i.randomizationFactor)!==null&&n!==void 0?n:.5),this.backoff=new c1({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(i.timeout==null?2e4:i.timeout),this._readyState="closed",this.uri=e;const r=i.parser||iit;this.encoder=new r.Encoder,this.decoder=new r.Decoder,this._autoConnect=i.autoConnect!==!1,this._autoConnect&&this.open()}reconnection(e){return arguments.length?(this._reconnection=!!e,this):this._reconnection}reconnectionAttempts(e){return e===void 0?this._reconnectionAttempts:(this._reconnectionAttempts=e,this)}reconnectionDelay(e){var i;return e===void 0?this._reconnectionDelay:(this._reconnectionDelay=e,(i=this.backoff)===null||i===void 0||i.setMin(e),this)}randomizationFactor(e){var i;return e===void 0?this._randomizationFactor:(this._randomizationFactor=e,(i=this.backoff)===null||i===void 0||i.setJitter(e),this)}reconnectionDelayMax(e){var i;return e===void 0?this._reconnectionDelayMax:(this._reconnectionDelayMax=e,(i=this.backoff)===null||i===void 0||i.setMax(e),this)}timeout(e){return arguments.length?(this._timeout=e,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&this.backoff.attempts===0&&this.reconnect()}open(e){if(~this._readyState.indexOf("open"))return this;this.engine=new hDe(this.uri,this.opts);const i=this.engine,n=this;this._readyState="opening",this.skipReconnect=!1;const r=ch(i,"open",function(){n.onopen(),e&&e()}),a=o=>{this.cleanup(),this._readyState="closed",this.emitReserved("error",o),e?e(o):this.maybeReconnectOnOpen()},s=ch(i,"error",a);if(this._timeout!==!1){const o=this._timeout,l=this.setTimeoutFn(()=>{r(),a(new Error("timeout")),i.close()},o);this.opts.autoUnref&&l.unref(),this.subs.push(()=>{this.clearTimeoutFn(l)})}return this.subs.push(r),this.subs.push(s),this}connect(e){return this.open(e)}onopen(){this.cleanup(),this._readyState="open",this.emitReserved("open");const e=this.engine;this.subs.push(ch(e,"ping",this.onping.bind(this)),ch(e,"data",this.ondata.bind(this)),ch(e,"error",this.onerror.bind(this)),ch(e,"close",this.onclose.bind(this)),ch(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(e){try{this.decoder.add(e)}catch(i){this.onclose("parse error",i)}}ondecoded(e){TY(()=>{this.emitReserved("packet",e)},this.setTimeoutFn)}onerror(e){this.emitReserved("error",e)}socket(e,i){let n=this.nsps[e];return n?this._autoConnect&&!n.active&&n.connect():(n=new mDe(this,e,i),this.nsps[e]=n),n}_destroy(e){const i=Object.keys(this.nsps);for(const n of i)if(this.nsps[n].active)return;this._close()}_packet(e){const i=this.encoder.encode(e);for(let n=0;n<i.length;n++)this.engine.write(i[n],e.options)}cleanup(){this.subs.forEach(e=>e()),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close"),this.engine&&this.engine.close()}disconnect(){return this._close()}onclose(e,i){this.cleanup(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",e,i),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;const e=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{const i=this.backoff.duration();this._reconnecting=!0;const n=this.setTimeoutFn(()=>{e.skipReconnect||(this.emitReserved("reconnect_attempt",e.backoff.attempts),!e.skipReconnect&&e.open(r=>{r?(e._reconnecting=!1,e.reconnect(),this.emitReserved("reconnect_error",r)):e.onreconnect()}))},i);this.opts.autoUnref&&n.unref(),this.subs.push(()=>{this.clearTimeoutFn(n)})}}onreconnect(){const e=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",e)}}const A1={};function IA(t,e){typeof t=="object"&&(e=t,t=void 0),e=e||{};const i=ztt(t,e.path||"/socket.io"),n=i.source,r=i.id,a=i.path,s=A1[r]&&a in A1[r].nsps,o=e.forceNew||e["force new connection"]||e.multiplex===!1||s;let l;return o?l=new pH(n,e):(A1[r]||(A1[r]=new pH(n,e)),l=A1[r]),i.query&&!e.query&&(e.query=i.queryKey),l.socket(i.path,e)}Object.assign(IA,{Manager:pH,Socket:mDe,io:IA,connect:IA});function rit(){const t=JUe();return t?{authorization:`Bearer ${t}`}:void 0}const no={timestampOffset:0,socket:void 0},Cv={},hH=[];function ait(t){console.log("tmxMessage:",{data:t})}function gDe(t){const e={transportOptions:{polling:{extraHeaders:rit()}},"force new connection":!0,reconnectionDelay:1e3,reconnectionAttempts:"Infinity",timeout:2e4};if(no.socket)console.log("socket exists");else{const n=`${Zi.socketPath||"https://courthive.net"}/tmx`;no.socket=IA.connect(n,e),no.socket.on("ack",lit),no.socket.on(htt,ait),no.socket.on(ptt,tDe),no.socket.on("connect",()=>sit(t)),no.socket.on("disconnect",()=>console.log("disconnect")),no.socket.on("timestamp",r=>no.timestampOffset=new Date().getTime()-r.timestamp),no.socket.on("connect_error",r=>{console.log("connection error:",{data:r}),Jt({message:"Connection error",intent:"is-danger"}),A2()})}}function A2(){no!=null&&no.socket&&no.socket.disconnect(),setTimeout(()=>delete no.socket,1e3)}function EY({data:t,ackCallback:e}){const i=Xc(),{email:n}=i||{},r=t.type??"tmx",a=()=>{if(e&&Ot(e)){const o=_i.UUID();t.payload&&Object.assign(t.payload,{ackId:o}),oit({ackId:o,callback:e})}const s=no.timestampOffset?new Date().getTime()+no.timestampOffset:new Date().getTime();Object.assign(t.payload||t,{factoryVersion:qT(),tmxVersion:iY,timestamp:s,userId:n}),vDe(r,t)};if(no.socket)a();else try{gDe(a)}catch{hH.push({header:r,data:t,ackCallback:e})}}function vDe(t,e){no.socket.connected?no.socket.emit(t,e):console.log("socket not connected")}function sit(t){for(console.log("** connected"),EY({data:{type:"timestamp"}});hH.length;){const e=hH.pop();vDe(e.header,e.data)}Ot(t)&&t()}function oit({ackId:t,uuid:e,callback:i}){t&&(Cv[t]=i),e&&(Cv[e]=i)}function lit(t){t.ackId&&Cv[t.ackId]&&(Cv[t.ackId](t),delete Cv[t.ackId]),t.uuid&&Cv[t.uuid]&&(Cv[t.uuid](t),delete Cv[t.uuid])}var yDe={exports:{}};(function(t,e){(function(i,n){t.exports=n()})(dp,function(){var i=1e3,n=6e4,r=36e5,a="millisecond",s="second",o="minute",l="hour",c="day",u="week",d="month",p="quarter",h="year",f="date",m="Invalid Date",g=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,v=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,y={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(_){var A=["th","st","nd","rd"],N=_%100;return"["+_+(A[(N-20)%10]||A[N]||A[0])+"]"}},b=function(_,A,N){var k=String(_);return!k||k.length>=A?_:""+Array(A+1-k.length).join(N)+_},I={s:b,z:function(_){var A=-_.utcOffset(),N=Math.abs(A),k=Math.floor(N/60),O=N%60;return(A<=0?"+":"-")+b(k,2,"0")+":"+b(O,2,"0")},m:function _(A,N){if(A.date()<N.date())return-_(N,A);var k=12*(N.year()-A.year())+(N.month()-A.month()),O=A.clone().add(k,d),$=N-O<0,F=A.clone().add(k+($?-1:1),d);return+(-(k+(N-O)/($?O-F:F-O))||0)},a:function(_){return _<0?Math.ceil(_)||0:Math.floor(_)},p:function(_){return{M:d,y:h,w:u,d:c,D:f,h:l,m:o,s,ms:a,Q:p}[_]||String(_||"").toLowerCase().replace(/s$/,"")},u:function(_){return _===void 0}},T="en",w={};w[T]=y;var S="$isDayjsObject",U=function(_){return _ instanceof C||!(!_||!_[S])},P=function _(A,N,k){var O;if(!A)return T;if(typeof A=="string"){var $=A.toLowerCase();w[$]&&(O=$),N&&(w[$]=N,O=$);var F=A.split("-");if(!O&&F.length>1)return _(F[0])}else{var V=A.name;w[V]=A,O=V}return!k&&O&&(T=O),O||!k&&T},E=function(_,A){if(U(_))return _.clone();var N=typeof A=="object"?A:{};return N.date=_,N.args=arguments,new C(N)},R=I;R.l=P,R.i=U,R.w=function(_,A){return E(_,{locale:A.$L,utc:A.$u,x:A.$x,$offset:A.$offset})};var C=function(){function _(N){this.$L=P(N.locale,null,!0),this.parse(N),this.$x=this.$x||N.x||{},this[S]=!0}var A=_.prototype;return A.parse=function(N){this.$d=function(k){var O=k.date,$=k.utc;if(O===null)return new Date(NaN);if(R.u(O))return new Date;if(O instanceof Date)return new Date(O);if(typeof O=="string"&&!/Z$/i.test(O)){var F=O.match(g);if(F){var V=F[2]-1||0,j=(F[7]||"0").substring(0,3);return $?new Date(Date.UTC(F[1],V,F[3]||1,F[4]||0,F[5]||0,F[6]||0,j)):new Date(F[1],V,F[3]||1,F[4]||0,F[5]||0,F[6]||0,j)}}return new Date(O)}(N),this.init()},A.init=function(){var N=this.$d;this.$y=N.getFullYear(),this.$M=N.getMonth(),this.$D=N.getDate(),this.$W=N.getDay(),this.$H=N.getHours(),this.$m=N.getMinutes(),this.$s=N.getSeconds(),this.$ms=N.getMilliseconds()},A.$utils=function(){return R},A.isValid=function(){return this.$d.toString()!==m},A.isSame=function(N,k){var O=E(N);return this.startOf(k)<=O&&O<=this.endOf(k)},A.isAfter=function(N,k){return E(N)<this.startOf(k)},A.isBefore=function(N,k){return this.endOf(k)<E(N)},A.$g=function(N,k,O){return R.u(N)?this[k]:this.set(O,N)},A.unix=function(){return Math.floor(this.valueOf()/1e3)},A.valueOf=function(){return this.$d.getTime()},A.startOf=function(N,k){var O=this,$=!!R.u(k)||k,F=R.p(N),V=function(J,se){var ie=R.w(O.$u?Date.UTC(O.$y,se,J):new Date(O.$y,se,J),O);return $?ie:ie.endOf(c)},j=function(J,se){return R.w(O.toDate()[J].apply(O.toDate("s"),($?[0,0,0,0]:[23,59,59,999]).slice(se)),O)},B=this.$W,z=this.$M,W=this.$D,Z="set"+(this.$u?"UTC":"");switch(F){case h:return $?V(1,0):V(31,11);case d:return $?V(1,z):V(0,z+1);case u:var K=this.$locale().weekStart||0,Q=(B<K?B+7:B)-K;return V($?W-Q:W+(6-Q),z);case c:case f:return j(Z+"Hours",0);case l:return j(Z+"Minutes",1);case o:return j(Z+"Seconds",2);case s:return j(Z+"Milliseconds",3);default:return this.clone()}},A.endOf=function(N){return this.startOf(N,!1)},A.$set=function(N,k){var O,$=R.p(N),F="set"+(this.$u?"UTC":""),V=(O={},O[c]=F+"Date",O[f]=F+"Date",O[d]=F+"Month",O[h]=F+"FullYear",O[l]=F+"Hours",O[o]=F+"Minutes",O[s]=F+"Seconds",O[a]=F+"Milliseconds",O)[$],j=$===c?this.$D+(k-this.$W):k;if($===d||$===h){var B=this.clone().set(f,1);B.$d[V](j),B.init(),this.$d=B.set(f,Math.min(this.$D,B.daysInMonth())).$d}else V&&this.$d[V](j);return this.init(),this},A.set=function(N,k){return this.clone().$set(N,k)},A.get=function(N){return this[R.p(N)]()},A.add=function(N,k){var O,$=this;N=Number(N);var F=R.p(k),V=function(z){var W=E($);return R.w(W.date(W.date()+Math.round(z*N)),$)};if(F===d)return this.set(d,this.$M+N);if(F===h)return this.set(h,this.$y+N);if(F===c)return V(1);if(F===u)return V(7);var j=(O={},O[o]=n,O[l]=r,O[s]=i,O)[F]||1,B=this.$d.getTime()+N*j;return R.w(B,this)},A.subtract=function(N,k){return this.add(-1*N,k)},A.format=function(N){var k=this,O=this.$locale();if(!this.isValid())return O.invalidDate||m;var $=N||"YYYY-MM-DDTHH:mm:ssZ",F=R.z(this),V=this.$H,j=this.$m,B=this.$M,z=O.weekdays,W=O.months,Z=O.meridiem,K=function(se,ie,ce,oe){return se&&(se[ie]||se(k,$))||ce[ie].slice(0,oe)},Q=function(se){return R.s(V%12||12,se,"0")},J=Z||function(se,ie,ce){var oe=se<12?"AM":"PM";return ce?oe.toLowerCase():oe};return $.replace(v,function(se,ie){return ie||function(ce){switch(ce){case"YY":return String(k.$y).slice(-2);case"YYYY":return R.s(k.$y,4,"0");case"M":return B+1;case"MM":return R.s(B+1,2,"0");case"MMM":return K(O.monthsShort,B,W,3);case"MMMM":return K(W,B);case"D":return k.$D;case"DD":return R.s(k.$D,2,"0");case"d":return String(k.$W);case"dd":return K(O.weekdaysMin,k.$W,z,2);case"ddd":return K(O.weekdaysShort,k.$W,z,3);case"dddd":return z[k.$W];case"H":return String(V);case"HH":return R.s(V,2,"0");case"h":return Q(1);case"hh":return Q(2);case"a":return J(V,j,!0);case"A":return J(V,j,!1);case"m":return String(j);case"mm":return R.s(j,2,"0");case"s":return String(k.$s);case"ss":return R.s(k.$s,2,"0");case"SSS":return R.s(k.$ms,3,"0");case"Z":return F}return null}(se)||F.replace(":","")})},A.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},A.diff=function(N,k,O){var $,F=this,V=R.p(k),j=E(N),B=(j.utcOffset()-this.utcOffset())*n,z=this-j,W=function(){return R.m(F,j)};switch(V){case h:$=W()/12;break;case d:$=W();break;case p:$=W()/3;break;case u:$=(z-B)/6048e5;break;case c:$=(z-B)/864e5;break;case l:$=z/r;break;case o:$=z/n;break;case s:$=z/i;break;default:$=z}return O?$:R.a($)},A.daysInMonth=function(){return this.endOf(d).$D},A.$locale=function(){return w[this.$L]},A.locale=function(N,k){if(!N)return this.$L;var O=this.clone(),$=P(N,k,!0);return $&&(O.$L=$),O},A.clone=function(){return R.w(this.$d,this)},A.toDate=function(){return new Date(this.valueOf())},A.toJSON=function(){return this.isValid()?this.toISOString():null},A.toISOString=function(){return this.$d.toISOString()},A.toString=function(){return this.$d.toUTCString()},_}(),M=C.prototype;return E.prototype=M,[["$ms",a],["$s",s],["$m",o],["$H",l],["$W",c],["$M",d],["$y",h],["$D",f]].forEach(function(_){M[_[1]]=function(A){return this.$g(A,_[0],_[1])}}),E.extend=function(_,A){return _.$i||(_(A,C,E),_.$i=!0),E},E.locale=P,E.isDayjs=U,E.unix=function(_){return E(1e3*_)},E.en=w[T],E.Ls=w,E.p={},E})})(yDe);var cit=yDe.exports;const PY=eR(cit);async function ii(t){var b,I,T,w;const{tournamentRecord:e,methods:i,engine:n=DBe,callback:r}=t,a=Xc(),s=S=>{if(e&&fj[n].reset(),Ot(r))return r(S);S.error&&Jt({message:S.error.message??"Error",intent:"is-danger"})};if(!Array.isArray(i))return s();const o=fj[n];if(!o)return s();e&&o.setState(e);const l=S=>{var U;return(U=S==null?void 0:S.parentOrganisation)==null?void 0:U.organisationId},c=((b=o.getState())==null?void 0:b.tournamentRecords)??{},u=S=>{var U,P,E;return(E=(P=(U=S.timeItems)==null?void 0:U.find(({itemType:R})=>R==="TMX"))==null?void 0:P.itemValue)==null?void 0:E.offline},d=(I=Object.values(c))==null?void 0:I.map(u).filter(Boolean);if(d.length>1&&!d.every(S=>!S.email||S.email===d[0].email))return Jt({message:"Not all linked tournaments are offline",intent:"is-danger"});const h=d.length,f=(T=Object.values(c))==null?void 0:T.map(S=>S.tournamentId),m=_i.unique((w=Object.values(c))==null?void 0:w.map(l)).filter(Boolean);if(m.length>1)return Jt({message:"Multiple providers",intent:"is-danger"});const g=new Date().getTime(),v=Object.values(c).every(S=>{const U=PY(S.endDate).endOf("day").valueOf();return U&&U>=g}),y=S=>dit({offline:h,methods:i,factoryEngine:o,tournamentIds:f,completion:s,saveLocal:S});return v?m.length&&!h?bDe({state:a,providerIds:m,mutate:y}):y(!0):uit({state:a,providerIds:m,mutate:y})}function uit({state:t,providerIds:e,mutate:i}){return Jt({action:{onClick:()=>e!=null&&e.length?bDe({state:t,providerIds:e,mutate:i}):i(),text:"Modify?"},message:"Not in date range",intent:"is-danger",pauseOnHover:!0,duration:8e3})}function bDe({state:t,providerIds:e,mutate:i}){var o,l,c,u;if(!t)return It.provider=void 0,n$(!1),Jt({message:"Not logged in",intent:"is-warning"});const n=!!((o=t==null?void 0:t.providerIds)!=null&&o.includes(e[0])||((l=t==null?void 0:t.provider)==null?void 0:l.organisationId)===e[0]),r=(c=t==null?void 0:t.roles)==null?void 0:c.includes(cL),a=((u=It.provider)==null?void 0:u.organisationId)===e[0];return!n&&!r?Jt({message:"Not authorized",intent:"is-danger"}):!n&&r&&!a?Jt({action:{onClick:()=>(It.provider={organisationId:e[0]},i(!1)),text:"Impersonate?"},message:"Super Admin",intent:"is-danger"}):i(!n&&!(r&&a))}function FQ({factoryEngine:t,methods:e}){var n;(n=Zi.log)!=null&&n.verbose&&console.log("%c executing locally","color: lightgreen");const i=_i.makeDeepCopy(e);return t.executionQueue(i,!0)||{}}async function gB(t){(t||Zi.saveLocal)&&await nY()}async function dit({offline:t,methods:e,completion:i,factoryEngine:n,tournamentIds:r,saveLocal:a}){var c,u,d,p,h;const s=(u=(c=n.getTournament().tournamentRecord)==null?void 0:c.parentOrganisation)==null?void 0:u.organisationId;if((d=window.dev)!=null&&d.params)for(const f of e)window.dev.params[f.method]&&(f.params={...f.params,...window.dev.params[f.method]});(p=window==null?void 0:window.dev)!=null&&p.getContext().internal&&console.log({methods:e});const o=!Zi.serverFirst||!s;let l;if(o||t){if(l=FQ({factoryEngine:n,methods:e}),l.error)return i(l);if(!s||t)return await gB(!0),i(l)}if(s&&(l!=null&&l.success||Zi.serverFirst)){const f=async m=>{var v;const g=((v=m==null?void 0:m.error)==null?void 0:v.code)==="ERR_MISSING_TOURNAMENT";if(Zi.serverFirst&&(m!=null&&m.success||g))return l=FQ({factoryEngine:n,methods:e}),l.error||await gB(a||g),i(l)};(h=Zi.log)!=null&&h.verbose&&console.log("%c invoking remote","color: lightblue"),EY({data:{type:"executionQueue",payload:{methods:e,tournamentIds:r,rollbackOnError:!0}},ackCallback:f}),o&&await gB(a)}if(o)return i(l)}function IDe(t,e){let i=document.createElement("a");i.style.display="none",i.setAttribute("href",e),i.setAttribute("download",t);let n=document.body.appendChild(i);n.click(),n.remove()}function wDe(t,e){let i="data:text/json;charset=utf-8,"+encodeURIComponent(dZe(e));IDe(t,i)}function pit(t,e){let i="data:text/plain;charset=utf-8,"+encodeURIComponent(e);IDe(t,i)}function SDe(){var l;const t=c=>c.toString()[1]?c:"0"+c,e=c=>{if(!c)return"";const u=new Date(c);return[t(u.getMonth()+1),t(u.getDate()),u.getFullYear()].join("/")},{tournamentInfo:i}=ot.getTournamentInfo(),{completedMatchUps:n}=ot.tournamentMatchUps({context:{tournamentSanctionBody:(l=i.parentOrganisation)==null?void 0:l.organisationName,tournamentStartDate:e(i.startDate),tournamentEndDate:e(i.endDate),tournamentEventSource:"CourtHive",tournamentEventCategory:"Junior",tournamentEventType:"Tournament",...i,idType:yI}}),r=n.map(c=>{const{winningSide:u,sides:d,score:p}=c,h=d.find(({sideNumber:g})=>g===u),f=d.find(({sideNumber:g})=>g!==u);return{winnerScore:p[`scoreStringSide${u}`],...c,winners:h,losers:f}}),a=c=>c==null?void 0:c.slice(0,1),s={columnAccessors:[""],columnTransform:{Date:["tournamentEndDate"],"Winner 1 Name":["winners.participant.individualParticipants.0.participantName","winners.participant.participantName"],"Winner 1 Third Party ID":["winners.participant.individualParticipants.0.participantId","winners.participant.participantId"],"Winner 1 UTR ID":["winners.participant.individualParticipants.0.person.personOtherIds.0.idValue"],"Winner 1 Gender":["winners.participant.individualParticipants.0.person.sex","winners.participant.person.sex"],"Winner 1 DOB":["winners.participant.individualParticipants.0.person.birthDate","winners.participant.person.birthDate"],"Winner 1 City":["winners.participant.individualParticipants.0.addresses.0.city","winners.participant.addresses.0.city"],"Winner 1 State":["winners.participant.individualParticipants.0.addresses.0.state","winners.participant.addresses.0.state"],"Winner 1 Country":["winners.participant.individualParticipants.0.addresses.0.nationalityCode","winners.participant.addresses.0nationalityCode"],"Winner 1 College":["winners.participant.individualParticipants.0.college"],"Winner 2 Name":["winner.participant.individualParticipants.1.participantName"],"Winner 2 Third Party ID":["winners.participant.individualParticipants.1.participantId"],"Winner 2 UTR ID":["winners.participant.individualParticipants.1.person.personOtherIds.0.idValue"],"Winner 2 Gender":["winners.participant.individualParticipants.1.person.sex"],"Winner 2 DOB":["winners.participant.individualParticipants.1.person.birthDate"],"Winner 2 City":["winners.participant.individualParticipants.1.addresses.0.city"],"Winner 2 State":["winners.participant.individualParticipants.1.addresses.0.state"],"Winner 2 Country":["winners.participant.individualParticipants.1.addresses.0.nationalityCode"],"Winner 2 College":["winners.participant.individualParticipants.1.college"],"Loser 1 Name":["losers.participant.individualParticipants.0.participantName","losers.participant.participantName"],"Loser 1 Third Party ID":["losers.participant.individualParticipants.0.participantId","losers.participant.participantId"],"Loser 1 UTR ID":["losers.participant.individualParticipants.1.person.personOtherIds.0.idValue"],"Loser 1 Gender":["losers.participant.individualParticipants.0.person.sex","winners.participant.person.sex"],"Loser 1 DOB":["losers.participant.individualParticipants.0.person.birthDate","losers.participant.person.birthDate"],"Loser 1 City":["losers.participant.individualParticipants.0.addresses.0.city","losers.participant.addresses.0.city"],"Loser 1 State":["losers.participant.individualParticipants.0.addresses.0.state","losers.participant.addresses.0.state"],"Loser 1 Country":["losers.participant.individualParticipants.0.addresses.0.nationalityCode","losers.participant.addresses.0nationalityCode"],"Loser 1 College":["losers.participant.individualParticipants.0.college"],"Loser 2 Name":["losers.participant.individualParticipants.1.participantName"],"Loser 2 Third Party ID":["losers.participant.individualParticipants.1.participantId"],"Loser 2 UTR ID":["losers.participant.individualParticipants.1.person.personOtherIds.1.idValue"],"Loser 2 Gender":["losers.participant.individualParticipants.1.person.sex"],"Loser 2 DOB":["losers.participant.individualParticipants.1.person.birthDate"],"Loser 2 City":["losers.participant.individualParticipants.1.addresses.0.city"],"Loser 2 State":["losers.participant.individualParticipants.1.addresses.0.state"],"Loser 2 Country":["losers.participant.individualParticipants.1.addresses.0.nationalityCode"],"Loser 2 College":["losers.participant.individualParticipants.1.college"],Score:["winnerScore"],"Id Type":["idType"],"Draw Name":[vI],"Draw Gender":["gender"],"Draw Team Type":["eventType"],"Draw Bracket Type":[""],"Draw Bracket Value":[""],"Draw Type":[vh],"Tournament Name":["tournamentName"],"Tournament URL":[""],"Tournament Start Date":["tournamentStartDate"],"Tournament End Date":["tournamentEndDate"],"Tournament City":[""],"Tournament State":[""],"Tournament Country":[""],"Tournament Country Code":[""],"Tournament Host":[""],"Tournament Location Type":[""],"Tournament Surface":[""],"Tournament Event Type":["tournamentEventType"],"Tournament Event Category":["tournamentEventCategory"],"Tournament Import Source":["tournamentEventSource"],"Tournament Sanction Body":["tournamentSanctionBody"],"Match ID":["matchUpId"],"Tournament Event Grade":[""]},functionMap:{"Winner 1 Gender":a,"Winner 2 Gender":a,"Loser 1 Gender":a,"Loser 2 Gender":a}},o=_i.JSON2CSV(r,s);pit(`UTR-${i.tournamentId}.csv`,o)}function hit(){Jt({intent:"is-success",message:"Success"})}function fit(t){Jt({intent:"is-danger",message:(t==null?void 0:t.message)??"Failure"})}function mit(){var p,h,f,m,g;const t=ot.getTournament().tournamentRecord,e=(f=(h=(p=t==null?void 0:t.timeItems)==null?void 0:p.find(({itemType:v})=>v==="TMX"))==null?void 0:h.itemValue)==null?void 0:f.offline,i=t==null?void 0:t.parentOrganisation,n=i==null?void 0:i.organisationId,r=Xc(),a=(m=r==null?void 0:r.permissions)==null?void 0:m.includes("deleteTournament"),s=(g=r==null?void 0:r.roles)==null?void 0:g.includes(gfe);let o;const l=()=>{if(o.action.value==="upload"&&o.replace.checked){const v=ot.getTournament().tournamentRecord;return Jt({action:{onClick:()=>mD({tournamentRecord:v}).then(hit,fit),text:"Send??"},message:"Upload tournament",intent:"is-danger"})}if(o.action.value==="claim"&&(r!=null&&r.provider)){const v=ot.getTournament().tournamentRecord;if(!v.parentOrganisation){v.parentOrganisation=r.provider,ot.setState(v);const y=()=>{jc.deleteTournament(v.tournamentId),It.router.navigate(`/tournament/${v.tournamentId}/detail`),Jt({message:"Tournament claimed",intent:"is-info"})},b=I=>{Jt({message:I.message||"Not claimed",intent:"is-danger"})};mD({tournamentRecord:v}).then(y,b)}}o.action.value==="goOffline"&&(r!=null&&r.provider)&&vB({postMutation:y=>{if(y!=null&&y.success){nY();const b=document.getElementById("dnav");b.style.backgroundColor="lightyellow",Jt({message:"Offline",intent:"is-info"})}},state:r,offline:!0}),o.action.value==="goOnline"&&(r!=null&&r.provider)&&vB({postMutation:y=>{if(y!=null&&y.success){const b=()=>{jc.deleteTournament(t.tournamentId);const w=document.getElementById("dnav");w.style.backgroundColor="",Jt({message:"Online",intent:"is-info"})},I=w=>{console.log({err:w}),vB({state:r,offline:!0})},T=ot.getTournament().tournamentRecord;mD({tournamentRecord:T}).then(b,I)}},state:r,offline:!1}),o.action.value==="utrExport"&&SDe(),o.action.value==="todsExport"&&(t?wDe(`${t.tournamentId}.tods.json`,t):Jt({message:"Error"}))},c=[{control:"replace",onChange:({e:v})=>{const y=document.getElementById("go");y.disabled=!v.target.checked}},{control:"action",onChange:({e:v})=>{const y=document.getElementById("replace"),b=jl(y,"field");b.style.display=v.target.value==="upload"?"block":"none";const I=document.getElementById("go");I.disabled=o.action.value==="upload"}}],u=[{label:"-- select action --",close:!0},n&&{label:"Upload tournament",value:"upload",close:!0},t&&{label:"Delete tournament",disabled:!a,value:"delete",close:!0},t&&!n&&(r==null?void 0:r.provider)&&{label:"Claim tournament",value:"claim",close:!0},n&&!e&&{label:"Go offline - standalone mode",value:"goOffline",close:!0},n&&e&&{label:"Go online - exit standalone mode",value:"goOnline",close:!0},t&&s&&{label:"Export UTR matches",value:"utrExport"},t&&s&&{label:"Export TODS file",value:"todsExport"}].filter(Boolean);if(u.length<2)return Jt({message:"No actions available"});er({title:"Tournament actions",content:v=>o=Sr(v,[{label:"Action",field:"action",options:u},{label:"Replace tournament on server",field:"replace",visible:!1,checkbox:!0,id:"replace"}],c),buttons:[{label:"Cancel",intent:"none",close:!0},{label:"Go",id:"go",intent:"is-danger",disabled:!0,onClick:l,close:!0}]})}function vB({postMutation:t,state:e,offline:i}){var a;const n={...(((a=ot.getTournamentTimeItem({itemType:"TMX"}))==null?void 0:a.timeItem)??{}).itemValue};i?n.offline={email:e.email}:delete n.offline,ii({methods:[{method:EZe,params:{removePriorValues:!0,timeItem:{itemType:"TMX",itemValue:n}}}],callback:t})}function TDe(){const t=!window.location.host.startsWith("localhost");!window.location.host.endsWith("github.io")&&t&&window.dev&&(delete window.dev,console.log("%c dev cancelled","color: cyan"))}function git(){const{tournamentRecord:t}=ot.getTournament();if(!t)return;const i=[{label:"Cancel",intent:"none"},{label:yI,intent:"is-warning",onClick:SDe,close:!0},{label:"TODS",intent:"is-primary",onClick:()=>{t?wDe(`${t.tournamentId}.tods.json`,t):Jt({message:"Error"})},close:!0}],n=`${Cs.tr("phrases.export")}: ${Cs.tr("trn")}`;er({title:n,content:t.tournamentName,buttons:i})}function vit(t){t.getElement().style.border="1px solid black";const e=t.getValue(),i=document.createElement("div");return i.innerHTML=e||"",i}function u1(t){const{e,table:i,classNames:n=[],className:r,visible:a,columns:s}=t,o=jl(e.target,"options_right"),l=a?"":xt,c=a?xt:"";for(const u of o.children){const d=r?Array.from(u.classList).includes(r):Array.from(u.classList).some(p=>n.includes(p));u.style.display=d?l:c}for(const u of s)i.updateColumnDefinition(u,{formatter:a?vit:void 0,editable:a})}function yit(t,e){u1({columns:["ratings.wtn.wtnRating","ratings.utr.utrRating"],className:"saveRatings",visible:!0,table:e,e:t}),e.showColumn("ratings.utr.utrRating"),e.showColumn("ratings.wtn.wtnRating"),e.redraw(!0)}const bit=(t,e)=>{var i,n;return(n=(i=t.groups)==null?void 0:i.find(r=>{var a;return(a=r.participantRoleResponsibilities)==null?void 0:a.includes(e)}))==null?void 0:n.participantName},Iit=t=>bit(t,"CLUB"),UDe=(t,e)=>(t.events||[]).map(({eventId:i})=>e==null?void 0:e[i]),DDe=t=>{var e;return((e=Jf.countries.find(i=>i.ioc===t||i.iso===t))==null?void 0:e.label)||""},wit=/[\p{Lu}]/u,Sit=/[\p{Ll}]/u,$Q=/^[\p{Lu}](?![\p{Lu}])/gu,EDe=/([\p{Alpha}\p{N}_]|$)/u,CY=/[_.\- ]+/,Tit=new RegExp("^"+CY.source),BQ=new RegExp(CY.source+EDe.source,"gu"),VQ=new RegExp("\\d+"+EDe.source,"gu"),Uit=(t,e,i,n)=>{let r=!1,a=!1,s=!1,o=!1;for(let l=0;l<t.length;l++){const c=t[l];o=l>2?t[l-3]==="-":!0,r&&wit.test(c)?(t=t.slice(0,l)+"-"+t.slice(l),r=!1,s=a,a=!0,l++):a&&s&&Sit.test(c)&&(!o||n)?(t=t.slice(0,l-1)+"-"+t.slice(l-1),s=a,a=!1,r=!0):(r=e(c)===c&&i(c)!==c,s=a,a=i(c)===c&&e(c)!==c)}return t},Dit=(t,e)=>($Q.lastIndex=0,t.replaceAll($Q,i=>e(i))),Eit=(t,e)=>(BQ.lastIndex=0,VQ.lastIndex=0,t.replaceAll(VQ,(i,n,r)=>["_","-"].includes(t.charAt(r+i.length))?i:e(i)).replaceAll(BQ,(i,n)=>e(n)));function Pit(t,e){if(!(typeof t=="string"||Array.isArray(t)))throw new TypeError("Expected the input to be `string | string[]`");if(e={pascalCase:!1,preserveConsecutiveUppercase:!1,...e},Array.isArray(t)?t=t.map(a=>a.trim()).filter(a=>a.length).join("-"):t=t.trim(),t.length===0)return"";const i=e.locale===!1?a=>a.toLowerCase():a=>a.toLocaleLowerCase(e.locale),n=e.locale===!1?a=>a.toUpperCase():a=>a.toLocaleUpperCase(e.locale);return t.length===1?CY.test(t)?"":e.pascalCase?n(t):i(t):(t!==i(t)&&(t=Uit(t,i,n,e.preserveConsecutiveUppercase)),t=t.replace(Tit,""),t=e.preserveConsecutiveUppercase?Dit(t,i):i(t),e.pascalCase&&(t=n(t.charAt(0))+t.slice(1)),Eit(t,n))}const{WTN:Cit,UTR:Rit}=Uo.ratingConstants,{SINGLES:jQ}=Uo.eventConstants,Mit=(t,e)=>{var h,f,m,g,v,y,b,I,T;const{participantId:i,participantName:n,participantType:r,person:a}=t,{standardFamilyName:s,standardGivenName:o}=a||{},l=(f=(h=t.person)==null?void 0:h.addresses)==null?void 0:f[0],c=l!=null&&l.city&&(l!=null&&l.state)?`${l.city}, ${l.state}`:void 0,u=(v=(g=(m=t.ratings)==null?void 0:m[jQ])==null?void 0:g.find(w=>w.scaleName===Rit))==null?void 0:v.scaleValue,p={wtn:(I=(b=(y=t.ratings)==null?void 0:y[jQ])==null?void 0:b.find(w=>w.scaleName===Cit))==null?void 0:I.scaleValue,utr:u};return{searchText:`${n} ${o} ${s}`.toLowerCase(),sex:Pit(t.person.sex||"",{pascalCase:!0}),eventIds:t.events.map(({eventId:w})=>w),ioc:DDe((T=t.person)==null?void 0:T.nationalityCode),events:UDe(t,e),penalties:t.penalties||[],tennisId:t.person.tennisId,signedIn:t.signedIn,lastName:s,firstName:o,club:Iit(t),teams:t.teams,participantName:n,participantType:r,participantId:i,participant:t,cityState:c,ratings:p}},rf=t=>(e,i)=>{const n=e.getDefinition();return t.includes(n.field)?"":i==="asc"&&"<div><i class='fas fa-sort-up'></div>"||i==="desc"&&"<div><i class=' fas fa-sort-down'></div>"||"<div><i class='fas fa-sort'></div>"},{MALE:Nit,FEMALE:Ait}=jp,{PAIR:_it}=Ls,Ww=t=>(e,i,n)=>{var d;const r=e.getColumn().getDefinition(),a=r.field==="side1"&&1||r.field==="side2"&&2,s=document.createElement("div"),o=e.getRow().getData(),l=o.winningSide,c=e.getValue(),u=o.participant||(c==null?void 0:c.participant)||o.person&&o;if(u){const p=Zi.scales[Zi.activeScale],h=m=>tY({eventHandlers:{participantClick:g=>Ot(t)&&t({...g,event:g.pointerEvent,cell:e})},composition:{configuration:{participantDetail:"TEAM",genderColor:!0,winnerColor:!0,scaleAttributes:p,flag:!1}},matchUp:o.matchUp,participant:m,placeholder:i,sideNumber:a}),f=m=>{var v;const g=document.createElement("div");return g.className="flexrow flexjustifystart",(v=m.individualParticipants)==null||v.forEach((y,b)=>{if(g.appendChild(h(y)),!b){const I=document.createElement("span");I.style.width="1em",I.innerHTML="&nbsp;",g.appendChild(I)}}),g};return n==="sideBySide"&&u.participantType===_it?f(u):h(u)}if(l){const p=r.field===o.winningSide;s.style.color=p?"green":"red"}else{const p=(c==null?void 0:c.sex)||((d=o==null?void 0:o.person)==null?void 0:d.sex),h=p===Nit&&"#2E86C1"||p===Ait&&"#AA336A"||"";s.style.color=h}return s.innerHTML=(Up(c)?c.participantName:c)||"",s};function kit(t){const e=t.getValue();return(e==null?void 0:e.length)||0}function NT(t,e){var r,a,s,o;const i=(t==null?void 0:t.person)||((r=t==null?void 0:t.participant)==null?void 0:r.person),n=(e==null?void 0:e.person)||((a=e==null?void 0:e.participant)==null?void 0:a.person);return i||n?i!=null&&i.standardFamilyName&&!(n!=null&&n.standardFamilyName)||n!=null&&n.standardFamilyName&&!(i!=null&&i.standardFamilyName)||!(i!=null&&i.standardFamilyName)&&!(n!=null&&n.standardFamilyName)?1:(s=i.standardFamilyName)==null?void 0:s.localeCompare(n==null?void 0:n.standardFamilyName):t.participantName&&!e.participantName||e.participantName&&!t.participantName||!(t!=null&&t.participantName)&&!(e!=null&&e.participantName)?1:(o=t==null?void 0:t.participantName)==null?void 0:o.localeCompare(e==null?void 0:e.participantName)}async function PDe({participantIds:t,participantId:e,callback:i}){(e||t)&&ii({methods:[{params:{participantIds:t||[e]},method:_Ze}],callback:a=>{a.success?Ot(i)&&i(a):console.log({result:a})}})}const{COMPETITOR:xit,OFFICIAL:GQ}=zg,{INDIVIDUAL:Oit}=Ls;function CDe({participant:t,view:e,callback:i}){var m,g,v,y;const n=Jf.countries.map(b=>({label:Jf.countryToFlag(b.iso||"")+" "+b.label,value:b.ioc})),r={nationalityCode:(m=t==null?void 0:t.person)==null?void 0:m.nationalityCode,firstName:(g=t==null?void 0:t.person)==null?void 0:g.standardGivenName,lastName:(v=t==null?void 0:t.person)==null?void 0:v.standardFamilyName,sex:(y=t==null?void 0:t.person)==null?void 0:y.sex};let a;const s=b=>r.nationalityCode=b,o=({firstName:b,lastName:I})=>Wr(2)(b||"")&&Wr(2)(I||""),l=({inputs:b})=>{const I=o({firstName:b.firstName.value,lastName:b.lastName.value}),T=document.getElementById("saveParticipant");T&&(T.disabled=!I)},c=[{onInput:l,control:"firstName"},{onInput:l,control:"lastName"}],u=b=>{a=Sr(b,[{error:"Please enter a name of at least 3 characters",value:r.firstName||"",validator:Wr(2),placeholder:"Given name",label:"First name",field:"firstName",focus:!0},{error:"Please enter a name of at least 3 characters",value:r.lastName||"",validator:Wr(2),placeholder:"Family name",label:"Last name",field:"lastName"},{value:void 0,label:"Sex",field:"sex",options:[{label:"Unknown",value:void 0,selected:!r.sex},{label:"Male",value:"MALE",selected:r.sex==="MALE"},{label:"Female",value:"FEMALE",selected:r.sex==="FEMALE"}]},{placeholder:"Birthday",value:r.birthDate||"",label:"Date of birth",field:"birthday",date:!0},{typeAhead:{list:n,callback:s},placeholder:"Country of origin",value:r.nationalityCode||"",field:"nationalityCode",label:"Country"}],c)},d=(b,I)=>qw(b,[{label:"Cancel",close:!0},{disabled:!o(r),onClick:h,id:"saveParticipant",intent:"is-info",label:"Save",close:!0}],I),p=t?"Edit":"New";It.drawer.open({title:`<b style='larger'>${p} participant</b>`,callback:()=>{},width:"300px",side:oi,content:u,footer:d});function h(){if(!(t!=null&&t.participantId))f();else{const b={nationalityCode:a.nationalityCode.value,standardFamilyName:a.lastName.value,standardGivenName:a.firstName.value,birthdate:a.birthday.value,sex:a.sex.value},I=[{params:{participant:{participantId:t.participantId,person:b}},method:gk}];ii({methods:I,callback:w=>{w.success?Ot(i)&&i():console.log(w)}})}}function f(){const b=a.firstName.value,I=a.lastName.value,T=a.sex.value,w={participantRole:e===GQ?GQ:xit,participantType:Oit,participantId:_i.UUID(),person:{nationalityCode:r.nationalityCode,standardGivenName:b,standardFamilyName:I,sex:T}};ii({methods:[{params:{participants:[w]},method:gM}],callback:P=>{P.success&&Ot(i)&&i(),!P.success&&console.log(P)}})}return{...qC}}function Lit({participantId:t,callback:e}){var n;const i=(n=ot.getParticipants({participantFilters:{participantIds:[t]},inContext:!1}).participants)==null?void 0:n[0];if(i)return CDe({participant:i,callback:e})}const wA=t=>(e,i)=>{const n=Array.from(document.querySelectorAll(".tippy-content"));if(n.length){n.forEach(u=>u.remove());return}const r=e.target.getElementsByClassName("fa-ellipsis-vertical")[0],a=i.getRow(),s=a.getData(),{participantId:o,participantType:l}=s;Ic({items:[{hide:l!=="INDIVIDUAL",text:"<i class='fas fa-address-card'></i> Participant profile",onClick:()=>{var u;return console.log("Participant profile",(u=i.getData())==null?void 0:u.participant)}},{hide:l!=="INDIVIDUAL",text:"<i class='fas fa-user'></i> Edit Participant",onClick:()=>{Lit({participantId:o,callback:t})}},{text:"<div style='color: red'><i class='fas fa-check-square'></i> Delete participant</div>",onClick:()=>{PDe({participantId:o,callback:d=>{if(d.success)a.delete();else{const p=i.getTable();p.alert(d.error.message||"Cannot Remove Participant"),setTimeout(()=>p.clearAlert(),2500)}}})}}],target:r||e.target,config:{placement:Ap}})},{SINGLES:Fit}=pl,RDe=t=>e=>{const i=e.getColumn().getDefinition(),n=document.createElement("div");n.className="tags";const r=e.getValue(),a=e.getRow().getData(),{participantId:s}=a,o=(l,c)=>{var u;return(u=l==null?void 0:l.eventName)==null?void 0:u.localeCompare(c==null?void 0:c.eventName)};return r.sort(o).forEach(l=>{const c=MDe({def:i,participantId:s,event:l,eventClick:t});n.appendChild(c)}),n};function MDe({matchUpId:t,participantId:e,event:i,eventClick:n}){var a,s;const r=document.createElement("span");return Ot(n)&&(r.onclick=()=>n({eventId:i.eventId,participantId:e,matchUpId:t})),r.className="tag event-pill",(a=i.gender)!=null&&a.toLowerCase().includes("female")?r.classList.add("is-danger"):(s=i.gender)!=null&&s.toLowerCase().includes("male")?r.classList.add("is-link"):r.classList.add("is-primary"),i.eventType===Fit&&r.classList.add("is-light"),r.innerHTML=i.eventName,r}const $it=t=>e=>{const i=e.getColumn().getDefinition(),n=e.getRow().getData(),{matchUpId:r}=n,a=document.createElement("div");a.className="tags";const s=MDe({def:i,matchUpId:r,event:n,eventClick:t});return a.append(s),a},NDe=t=>e=>{const i=e.getColumn().getDefinition(),n=document.createElement("div");n.className="tags";const r=e.getValue(),a=(s,o)=>{var l;return(l=s==null?void 0:s.participantName)==null?void 0:l.localeCompare(o==null?void 0:o.participantName)};return r.sort(a).forEach(s=>{const o=Bit({def:i,team:s,teamClick:t});n.appendChild(o)}),n};function Bit({matchUpId:t,team:e,teamClick:i}){const n=document.createElement("span"),{participantId:r,participantName:a}=e;return Ot(i)&&(n.onclick=()=>i({participantId:r,matchUpId:t})),n.className="tag event-pill",n.innerHTML=a,n}const fH=({maxValue:t,decimals:e,field:i})=>(n,r,a)=>{const s=e?/[^0-9.]/g:/[^0-9]/g,o=document.createElement("input");o.style.backgroundColor="lightyellow",o.style.boxSizing="border-box",o.style.textAlign="center",o.style.padding="3px",o.style.height="100%",o.style.width="100%",o.value=n.getValue()||"",r(()=>{o.focus(),o.select()});function l(){let c=o.value;e&&(c=parseFloat(c).toFixed(2)),a(isNaN(c)?void 0:c)}return o.addEventListener("keydown",c=>{c.key==="Tab"&&(c.preventDefault(),c.stopPropagation())}),o.addEventListener("keyup",c=>{const u=c.target.value.replace(s,"")||"";if(c.target.value=u>t?"":u,c.key==="Tab"&&c.shiftKey&&i){const p=jl(c.target,"tabulator-row").previousSibling,h=p&&Cg(p,"tabulator-editable");if(h)for(n of h)n.getAttribute("tabulator-field")===i&&n.focus()}else if((c.key==="Enter"||c.key==="Tab")&&i){const p=jl(c.target,"tabulator-row").nextSibling,h=p&&Cg(p,"tabulator-editable");if(h)for(n of h)n.getAttribute("tabulator-field")===i&&n.focus()}}),o.addEventListener("blur",l),o},HQ=t=>It.columns[t]!==!1;function Jr({eventId:t,drawId:e,structureId:i,renderDraw:n,participantId:r,matchUpId:a,view:s}){var d,p,h,f;const o=(p=(d=ot.getTournament())==null?void 0:d.tournamentRecord)==null?void 0:p.tournamentId,l=t&&ot.getEvent({eventId:t,drawId:e}).event,c=((h=l==null?void 0:l.drawDefinitions)==null?void 0:h.length)===1&&l.drawDefinitions[0];r&&c&&(e=c.drawId,n=!0),a&&(e=(f=l.drawDefinitions.find(({drawId:m})=>ot.allDrawMatchUps({drawId:m,inContext:!1}).matchUps.find(v=>v.matchUpId===a)))==null?void 0:f.drawId,n=!!e);let u=`/${Ps}/${o}/${wb}/${t}`;n&&e?(u+=`/${z1}/${e}`,i&&(u+=`/${mj}/${i}`),[yj,QS,JS].includes(s)&&(u+=`/${gj}/${s}`)):e&&(u+=`/${vfe}/${e}`),It.router.navigate(u)}const av=()=>"<i class='fa fa-ellipsis-vertical'></i>",{SIGNED_IN:Vit,SIGNED_OUT:jit}=Ls;function Git(t,e){const i=e.getRow().getData().participantId,n=!e.getValue();ii({methods:[{params:{signInState:n?Vit:jit,participantIds:[i]},method:oY}],callback:o=>{o.success&&e.setValue(n)}})}const Hit=({field:t})=>(e,i,n)=>{const r=document.createElement("input");r.style.backgroundColor="lightyellow",r.style.boxSizing="border-box",r.style.textAlign="center",r.style.padding="3px",r.style.height="100%",r.style.width="100%",r.value=e.getValue()||"",i(()=>{r.focus(),r.select()});function a(){const s=r.value;n(s)}return r.addEventListener("keydown",s=>{s.key==="Tab"&&(s.preventDefault(),s.stopPropagation())}),r.addEventListener("keyup",s=>{if(s.key==="Tab"&&s.shiftKey&&t){const l=jl(s.target,"tabulator-row").previousSibling,c=l&&Cg(l,"tabulator-editable");if(c)for(e of c)e.getAttribute("tabulator-field")===t&&e.focus()}else if((s.key==="Enter"||s.key==="Tab")&&t){const l=jl(s.target,"tabulator-row").nextSibling,c=l&&Cg(l,"tabulator-editable");if(c)for(e of c)e.getAttribute("tabulator-field")===t&&e.focus()}}),r.addEventListener("blur",a),r},yB="fa-check-square",xm=t=>(e,i)=>{const n=i.getTable(),r=n.getColumns(),a=[];for(const s of r){const o=s.getDefinition();if(o.title){const l=document.createElement("i");l.classList.add("fas"),l.classList.add(s.isVisible()?yB:"fa-square");const c=document.createElement("span"),u=document.createElement("span"),d=(t==null?void 0:t[o.field])||o.displayTitle||o.title;u.textContent=" "+d,c.appendChild(l),c.appendChild(u),a.push({label:c,action:function(p){p.stopPropagation(),s.toggle(),It.columns[s.getField()]=s.isVisible(),n.redraw(),s.isVisible()?(l.classList.remove("fa-square"),l.classList.add(yB)):(l.classList.remove(yB),l.classList.add("fa-square"))}})}}return a},{WTN:zit,UTR:qit}=Uo.ratingConstants,{FEMALE:Wit,MALE:Yit}=jp,zQ="ratings.utr.utrRating",qQ="ratings.wtn.wtnRating";function Kit({data:t,replaceTableData:e}){const i=t.some(s=>s.cityState),n=t.some(s=>s.tennisId),r=t.some(s=>{var o;return(o=s.ratings)==null?void 0:o.utr}),a=t.some(s=>{var o;return(o=s.ratings)==null?void 0:o.wtn});return[{cellClick:(s,o)=>o.getRow().toggleSelect(),titleFormatter:"rowSelection",formatter:"rowSelection",headerSort:!1,responsive:!1,hozAlign:pi,width:5},{headerMenu:xm({signedIn:"Sign In Status",sex:"Gender"}),formatter:"rownum",headerSort:!1,hozAlign:pi,width:55},{formatter:Ww(({event:s,cell:o,...l})=>wA(s)),cellClick:wA,sorter:NT,field:"participant",responsive:!1,resizable:!1,minWidth:200,widthGrow:2,title:"Name"},{editor:Hit({field:"tennisId"}),visible:n,field:"tennisId",editable:!1,title:"WTID",width:120},{headerFilter:"input",title:"First Name",field:"firstName",visible:!1,width:150},{headerFilter:"input",title:"Last Name",field:"lastName",visible:!1,width:150},{title:'<i class="fa-solid fa-venus-mars" />',field:"sex",hozAlign:pi,editor:"list",width:80,editorParams:{itemFormatter:(s,o)=>o,values:{Male:Yit,Female:Wit,"":"Unknown"}}},{title:"Country",field:"ioc",width:130,visible:!1,headerFilter:"input"},{title:"<div class='fa-solid fa-check' style='color: green' />",cellClick:Git,formatter:"tickCross",resizable:!1,field:"signedIn",hozAlign:pi,tooltip:!1,width:40},{sorter:(s,o)=>(s.length||0)-((o==null?void 0:o.length)||0),formatter:kit,title:"Penalties",field:"penalties",hozAlign:pi,visible:!1,width:130},{headerFilter:"input",title:"Club",field:"club",hozAlign:pi,minWidth:70,editor:!1,visible:!1},{sorter:(s,o)=>{var l,c,u;return(u=(l=s==null?void 0:s[0])==null?void 0:l.eventName)==null?void 0:u.localeCompare((c=o==null?void 0:o[0])==null?void 0:c.eventName)},formatter:RDe(Jr),visible:HQ("events"),title:"Events",field:"events",hozAlign:pi,minWidth:200,editor:!1,widthGrow:2},{sorter:(s,o)=>{var l,c,u;return(u=(l=s==null?void 0:s[0])==null?void 0:l.participantName)==null?void 0:u.localeCompare((c=o==null?void 0:o[0])==null?void 0:c.participantName)},formatter:NDe(()=>console.log("boo")),visible:HQ("teams"),title:"Teams",field:"teams",hozAlign:pi,minWidth:200,editor:!1,widthGrow:2},{visible:!!i,title:"City/State",field:"cityState",minWidth:110},{editor:fH({maxValue:40,decimals:!0,field:qQ}),sorterParams:{alignEmptyValues:"bottom"},responsive:!0,resizable:!1,sorter:"number",field:qQ,editable:!1,visible:!!a,title:zit,width:70},{editor:fH({maxValue:16,decimals:!0,field:zQ}),sorterParams:{alignEmptyValues:"bottom"},responsive:!0,resizable:!1,sorter:"number",field:zQ,editable:!1,visible:!!r,title:qit,width:70},{cellClick:wA(e),formatter:av,responsive:!1,headerSort:!1,hozAlign:oi,maxWidth:40}]}const{INDIVIDUAL:Zit,GROUP:Xit,TEAM:Jit}=Ls,{OFFICIAL:WQ,COMPETITOR:Qit}=zg;function ent({view:t}={}){let e,i,n,r,a,s;const o={participantRoles:[t===WQ?WQ:Qit]},l=()=>{({participants:n=[],derivedEventInfo:r}=ot.getParticipants({withSignInStatus:!0,withScaleValues:!0,participantFilters:o,withEvents:!0,withISO2:!0}));const m=n.filter(({participantType:g})=>g===Zit);return i=n.filter(({participantType:g})=>g===Xit),a=n.filter(({participantType:g})=>g===Jit),(m==null?void 0:m.map(g=>Mit(g,r)))||[]},c=()=>{const f=l(),m=f==null?void 0:f.some(I=>I.cityState),g=f==null?void 0:f.some(I=>I.tennisId),v=f==null?void 0:f.some(I=>{var T;return(T=I.ratings)==null?void 0:T.utr}),y=f==null?void 0:f.some(I=>{var T;return(T=I.ratings)==null?void 0:T.wtn});m&&(e==null||e.showColumn("cityState")),g&&(e==null||e.showColumn("tennisId")),v&&(e==null||e.showColumn("ratings.utr.utrRating")),y&&(e==null||e.showColumn("ratings.wtn.wtnRating")),setTimeout(()=>e.replaceData(f),s?0:1e3)},u=l(),d=Kit({data:u,replaceTableData:c}),p=(f,m)=>(_i.isNumeric(f)&&f||0)+(_i.isNumeric(m)&&m||0);return(f=>{var y;km({anchorId:f_});const m=document.getElementById(f_),g=(y=jl(m,"section"))==null?void 0:y.querySelector(".tabHeader");e=new As(m,{headerSortElement:rf(["sex","signedIn","events","teams","ratings.wtn.wtnRating","ratings.utr.utrRating","cityState","tennisId"]),height:window.innerHeight*.86,placeholder:"No participants",index:"participantId",layout:"fitColumns",reactiveData:!0,columns:d,data:f});const v=b=>`Participants (${b.length})`;e.on("dataChanged",b=>g&&(g.innerHTML=v(b))),e.on("dataFiltered",(b,I)=>{g&&(g.innerHTML=v(I));const T=[],w=[];for(const R of I){const C=R.getData(),{wtn:M,utr:_}=C.ratings;_i.isNumeric(_==null?void 0:_.utrRating)&&w.push(parseFloat(_.utrRating)),_i.isNumeric(M==null?void 0:M.wtnRating)&&T.push(parseFloat(M.wtnRating))}const S=w.reduce(p,0),U=T.reduce(p,0),P=(w.length?S/w.length:0).toFixed(2),E=(T.length?U/T.length:0).toFixed(2);Zi.averages&&console.log(`UTR ${P}x̄`),Zi.averages&&console.log(`WTN ${E}x̄`)}),e.on("scrollVertical",wd),e.on("tableBuilt",()=>s=!0)})(u),{table:e,replaceTableData:c,teamParticipants:a,groupParticipants:i}}function tnt(t,e){u1({className:"saveTennisId",columns:["tennisId"],visible:!0,table:e,e:t}),e.showColumn("tennisId"),e.redraw(!0)}function int(t,e){u1({columns:["ratings.wtn.wtnRating","ratings.utr.utrRating"],classNames:["saveRatings","saveTennisId"],visible:!1,table:e,e:t}),e.showColumn("ratings.utr.utrRating"),e.showColumn("ratings.wtn.wtnRating"),e.redraw(!0),ot.getParticipants({withScaleValues:!0});const n=e.getData().flatMap(a=>{var f,m,g;const s=(f=a.ratings)==null?void 0:f.wtn,o=s==null?void 0:s.wtnRating,l=s!=null&&s.confidence||o?50:0;let c=l?{...s,wtnRating:o,confidence:l}:"";const u={method:nQ,params:{participantId:a.participantId,removePriorValues:!0,timeItem:{itemType:"SCALE.RATING.SINGLES.WTN",itemValue:c}}},d=(g=(m=a.ratings)==null?void 0:m.utr)==null?void 0:g.utrRating,p=d?50:0;c=p?{utrRating:d,confidence:p}:"";const h={method:nQ,params:{participantId:a.participantId,removePriorValues:!0,timeItem:{itemType:"SCALE.RATING.SINGLES.UTR",itemValue:c}}};return[u,h]});ii({methods:n,callback:a=>{a.success||console.log(a)}})}const{COMPETITOR:nnt,OTHER:rnt}=zg,{TEAM:YQ}=Ls;function ADe({individualParticipantIds:t,participantType:e=YQ,title:i="Edit team",participant:n,refresh:r,table:a}){const s="participantName",o={[s]:n==null?void 0:n[s]};let l;const c=()=>{},u=f=>{l=Sr(f,[{error:"Please enter a name of at least 3 characters",placeholder:"Participant name",value:o[s]||"",validator:Wr(3),field:s,onChange:c,label:"Name"}])},d=(f,m)=>qw(f,[{label:"Cancel",onClick:()=>a==null?void 0:a.deselectRow(),close:!0},{label:"Save",onClick:p,close:!0,intent:"is-info"}],m);It.drawer.open({title:`<b style='larger'>${i}</b>`,callback:()=>{},width:"300px",side:oi,content:u,footer:d});function p(){a==null||a.deselectRow(),n!=null&&n.participantId?console.log("update existing"):h()}function h(){var y;const f=e===YQ?nnt:rnt,m={individualParticipantIds:t||(n==null?void 0:n.individualParticipantIds)||[],participantName:(y=l[s])==null?void 0:y.value,participantRole:f,participantType:e};ii({methods:[{params:{participants:[m]},method:gM}],callback:b=>{b.success?Ot(r)&&r():console.log({result:b})}})}return{...qC}}const{TEAM:bB}=Ls;function KQ({participants:t,table:e,replaceTableData:i,participantType:n=bB}){const r=({team:o})=>{const c=e.getSelectedData().map(({participantId:p})=>p);e.deselectRow();const u=[{method:i1e,params:{groupingParticipantId:o.participantId,individualParticipantIds:c}}];ii({methods:u,callback:p=>{p.success&&i()}})},a=()=>{const o=n===bB?"New team":"New Group",c=e.getSelectedData().map(({participantId:u})=>u);ADe({refresh:i,individualParticipantIds:c,participantType:n,table:e,title:o})},s=n===bB?"Create new team":"Create new group";return{options:t.map(o=>({onClick:()=>r({team:o}),label:o.participantName,participant:o,close:!0})),actions:[{onClick:()=>a(),close:!0,label:s}]}}const ant=t=>e=>{if(e.key==="Enter"){const n=t.getSelectedData().map(({participantId:o})=>o),s=t.getData("active").map(({participantId:o})=>o).filter(o=>!n.includes(o));s.length===1&&(t.selectRow(s),e.target.value="",t.clearFilter())}};function snt(t,e){u1({classNames:["saveTennisId","saveRatings"],columns:["tennisId"],visible:!1,table:e,e:t}),e.showColumn("tennisId"),e.redraw(!0);const i=ot.getParticipants().participantMap,r=e.getData().map(a=>{const{tennisId:s,participantId:o}=a;if(s!==i[o].participant.person.tennisId)return{params:{participant:{participantId:o,person:{tennisId:s}}},method:gk}}).filter(Boolean);r.length&&ii({methods:r,callback:s=>{s.success||console.log(s)}})}function _De(t){let e;const i=l=>{var c,u;return e===xt?!((c=l==null?void 0:l.eventIds)!=null&&c.length):(u=l==null?void 0:l.eventIds)==null?void 0:u.includes(e)},n=l=>{t.removeFilter(i),e=l,l&&t.addFilter(i)},r=ot.getEvents().events||[],a={label:`<span style='font-weight: bold'>${gg}</span>`,onClick:()=>n(),close:!0},s={label:`<span style='font-weight: bold'>${wBe}</span>`,onClick:()=>n(xt),close:!0};return{eventOptions:[a,s,{divider:!0}].concat(r.map(l=>({onClick:()=>n(l.eventId),label:l.eventName,close:!0}))),events:r}}const{WTN:ont,UTR:lnt}=Uo.ratingConstants,{FEMALE:cnt,MALE:unt,MIXED:dnt,ANY:pnt}=jp;function hnt({callback:t}){let e;er({title:"Generate mock players",content:a=>e=Sr(a,[{options:[{label:"Any",value:pnt,close:!0},{label:"Female",value:cnt,close:!0},{label:"Male",value:unt,close:!0}],label:"Participant gender",field:"gender",value:32},{options:[{label:"8",value:8,close:!0},{label:"16",value:16,close:!0},{label:"32",value:32,close:!0},{label:"64",value:64,close:!0},{label:"128",value:128,close:!0},{label:"256",value:256,close:!0}],label:"Participant count",field:"participantsCount",value:32},{text:"Generate Ratings",header:!0},{label:"WTN",field:"wtnRating",id:"wtnRating",checkbox:!0},{label:"UTR",field:"utrRating",id:"utrRating",checkbox:!0}]),buttons:[{label:"Cancel",intent:"none",close:!0},{label:"Generate",intent:"is-info",close:!0,onClick:()=>{const a=e.participantsCount.value,s=e.wtnRating.checked,o=e.utrRating.checked,l=e.gender.value,c=l===dnt?void 0:l,u=[s&&{ratingType:ont,ratingMin:14,ratingMax:19.99},o&&{ratingType:lnt,ratingMin:8,ratingMax:10}].filter(Boolean),{participants:d}=zC.generateParticipants({participantsCount:parseInt(a),scaleAllParticipants:!0,categories:u,sex:c});ii({methods:[{method:gM,params:{participants:d}}],callback:t})}}]})}function fnt({callback:t}){let e=r=>{let a=r==null?void 0:r.players;a!=null&&a.length?mnt(a):a&&!a.length&&It.modal.inform({message:"Sheet Empty: No Player Rows"}),Ot(t)&&t()};const{extension:i}=ot.findExtension({discover:!0,name:jv.REGISTRATION});(i==null?void 0:i.value)||hnt({callback:e})}function mnt(t){console.log({registeredPlayers:t})}function gnt({table:t,teamParticipants:e}){let i;const n=o=>o.teams.some(l=>(l==null?void 0:l.participantId)===i),r=o=>{t.removeFilter(n),i=o,o&&t.addFilter(n)};return{teamOptions:[{label:`<span style='font-weight: bold'>${SBe}</span>`,onClick:()=>r(),close:!0},{divider:!0}].concat(e.sort((o,l)=>{var c;return(c=o==null?void 0:o.participantName)==null?void 0:c.localeCompare(l==null?void 0:l.participantName)}).map(o=>({onClick:()=>r(o.participantId),label:o.participantName,close:!0})))}}function kDe(t){const i=t.getSelectedData().filter(r=>{var a;return!((a=r.events)!=null&&a.length)}).map(({participantId:r})=>r),n=()=>{PDe({participantIds:i,callback:a=>{a.success&&t.deleteRow(i)&&t.deselectRow()}})};er({content:`Delete ${i.length} participants?`,onClose:()=>t.deselectRow(),title:"Delete participants",buttons:[{label:"Cancel",intent:xt,close:!0},{label:"Delete",id:"deleteDraw",intent:"is-danger",close:!0,onClick:n}]})}const{FEMALE:ZQ,MALE:XQ,ANY:JQ}=jp;function vnt(t){let e;const i=l=>{var c,u;return((u=(c=l.participant)==null?void 0:c.person)==null?void 0:u.sex)===e},n=l=>{t.removeFilter(i),e=l,l&&t.addFilter(i)},r=[XQ,ZQ],a={[XQ]:"Male",[ZQ]:"Female",[JQ]:IBe};return{sexOptions:[{label:`<span style='font-weight: bold'>${a[JQ]}</span>`,onClick:()=>n(),close:!0},{divider:!0}].concat(r.map(l=>({onClick:()=>n(l),label:a[l],close:!0}))),genders:a}}const{SIGNED_IN:ynt}=Ls;function bnt(t){const e=t.getSelectedData(),i=e.map(({participantId:a})=>a);ii({methods:[{params:{signInState:ynt,participantIds:i},method:oY}],callback:a=>{a.success&&(e.forEach(s=>s.signedIn=!0),t.updateData(e),t.deselectRow())}})}const{INDIVIDUAL:Int,SIGNED_OUT:wnt}=Ls;function Snt(t){const i=ot.getParticipants({participantFilters:{participantTypes:[Int]},withSignInStatus:!0,withEvents:!0}).participants.filter(a=>a.signedIn&&!a.events.length).map(a=>a.participantId);ii({methods:[{params:{signInState:wnt,participantIds:i},method:oY}],callback:a=>{a.success&&t()}})}function Tnt(t){let e=0;if(t.length===0)return e;for(let i=0;i<t.length;i++){let n=t.charCodeAt(i);e=(e<<5)-e+n,e=e&e}return e}const jm={participantName:["full name","name"],participantId:["id","participantid"],person:{standardFamilyName:["last","last name","last_name"],standardGivenName:["first","First Name","first_name"],nationalityCode:["ioc","country","nationality"],address:{city:["city"],state:["state"]},birthDate:["*birth"],sex:["gender","sex"]}};function Unt({data:t,sheetId:e,callback:i}){var c;const r=ot.getParticipants().participants.map(({participantId:u})=>u),a=Jf.countries.map(u=>[u.ioc,u.iso]).flat().filter(Boolean),s=[],o=u=>u.map(d=>[d.toLowerCase(),d.toLowerCase().split(" ").join("")]).flat(),l=u=>(d=[])=>{const p=Object.keys(u),h=o(d),f=h.reduce((g,v)=>u[v]||g,void 0),m=!f&&p.filter(g=>h.find(v=>v.startsWith("*")&&g.toLowerCase().includes(v.slice(1))));return f||u[m]};for(const u of t||[]){const d=Object.assign({},...Object.keys(u).map(E=>({[E.toLowerCase()]:u[E]}))),p=l(d),h={participantType:"INDIVIDUAL",participantRole:"COMPETITOR",person:{}};h.participantName=p(jm.participantName);const f=p(["tennis id","tennisid"]);f&&(h.person.tennisId=f);const m=p(jm.person.standardFamilyName),g=p(jm.person.standardGivenName);if(m&&g)h.person.standardFamilyName=m,h.person.standardGivenName=g,h.participantName=`${g} ${m}`;else continue;const v=p(jm.person.address.state),y=p(jm.person.address.city);(y||v)&&(h.person.addresses=[{city:y,state:v}]);const b=p(jm.person.nationalityCode);b&&a.includes(b.toUpperCase())&&(h.person.nationalityCode=b);const I=p(jm.person.birthDate);if(_i.dateTime.dateValidation.test(I)){const E=_i.dateTime.extractDate(I);E&&(h.person.birthDate=E)}const T=p(jm.person.sex);if(T){const E=T.toUpperCase();["MALE","FEMALE"].includes(E)?h.person.sex=E:["F","W","G"].includes(T[0])?h.person.sex="FEMALE":["M","B"].includes(T[0])&&(h.person.sex="MALE")}const w=p(["utr profile"]);if(w){h.onlineResources||(h.onlineResources=[]);const E=(c=w.split("profiles/"))==null?void 0:c.reverse()[0];E&&(h.person.personOtherIds||(h.person.personOtherIds=[]),h.person.personOtherIds.push({uniqueOrganisationName:"UTR",personId:E}),w.startsWith("http")&&h.onlineResources.push({resourceSubType:"PROFILE",identifier:w,name:"UTR Profile",resource:"URL"}))}const S=p(["utr"]);if(S){h.timeItems||(h.timeItems=[]);const E={itemType:"SCALE.RATING.SINGLES.UTR",itemValue:{utrRating:S}};h.timeItems.push(E)}const U=p(["wtn"]);if(U){h.timeItems||(h.timeItems=[]);const E={itemType:"SCALE.RATING.SINGLES.WTN",itemValue:{wtnRating:U}};h.timeItems.push(E)}h.participantId=p(jm.participantId)||`XXX-${Tnt(h.participantName)}`,r.includes(h.participantId)||s.push(_i.definedAttributes(h))}s.length?ii({methods:[{method:gM,params:{participants:s}},{method:DZe,params:{extension:{name:ffe,value:e}}}],callback:p=>{p.success?(Jt({message:`Added ${p.results[0].addedCount} participant(s)`,intent:"is-success"}),Ot(i)&&i()):console.log(p)}}):Jt({message:"No new participants found",intent:"is-primary"}),Ot(i)&&i()}const xDe=t=>![null,void 0].includes(t),ODe=({c:t})=>t.map(e=>xDe(e==null?void 0:e.v)?e:{});function QQ({header:t,rows:e,useFormat:i=!1}){const n=c=>xRe(c)&&/Date\((\d+),(\d+),(\d+)\)/.test(c),r=c=>c.f||c.v,a=c=>i||n(c.v)?r(c):c.v,s=(c,u,d)=>({...c,[t[d]]:a(u)}),o=(c,u,d)=>xDe(u.v)?s(c,u,d):c,l=c=>c.reduce((u,d,p)=>o(u,d,p),{});return e.map(ODe).map(l)}function Dnt(t){try{const e=t.split("setResponse(")[1].split(");")[0],i=JSON.parse(e),{cols:n,rows:r}=i.table??{},a=n.map(({label:s})=>s.split(" ")[0]);if(a.filter(Boolean).length)return QQ({header:a,rows:r});{const[s,...o]=r,l=ODe(s).map(c=>c.v);return console.log({header:l}),QQ({header:l,rows:o})}}catch{return[]}}async function Ent({sheetId:t}){const e=`https://docs.google.com/spreadsheets/d/${t}/gviz/tq?`;try{const i=await window.fetch(e);return i!=null&&i.ok?i.text():void 0}catch{return}}async function Pnt({sheetId:t}){const e=await Ent({sheetId:t});return e?Dnt(e):[]}function Cnt({callback:t}){const{extension:e}=ot.findExtension({discover:!0,name:ffe}),i=e==null?void 0:e.value;let n;er({title:"Import participants",buttons:[{label:"Cancel",intent:"is-nothing"},{label:"Submit",intent:"is-primary",onClick:()=>{const o=n.url.value;if(o){const l=o.split("/"),c=l.reduce((h,f)=>!h||f.length>h.length?f:h,void 0),u=!i||i&&c!==i,d=i||l.indexOf("docs.google.com")>0&&l.indexOf("spreadsheets")>0,p=u?c:i;if(d)d?Pnt({sheetId:p}).then(h=>Unt({data:h,sheetId:p,callback:t})):Jt({message:"URL unchanged",intent:"is-info"});else{const h=Cs.tr("phrases.invalidsheeturl");Jt({message:h,intent:"is-danger"}),n.url.value=""}}},close:!0}],content:o=>{n=Sr(o,[{text:"Pull participants from a Google Sheet which has a shared link"},{placeholder:"URL of Google Sheet",value:i,label:"Sheet URL",field:"url"}])}})}const{ALTERNATE:Rnt,WILDCARD:Mnt,DIRECT_ACCEPTANCE:eee,UNGROUPED:Nnt}=nd,{MAIN:tee,QUALIFYING:Ant}=Qr,{INDIVIDUAL:_nt}=Ls,{TEAM:iee,DOUBLES:knt}=pl;function xnt({callback:t,eventName:e,eventType:i,participantType:n,participantIds:r}={}){const a=[iee,knt].includes(i)&&n===_nt;if(!(r!=null&&r.length)){Jt({message:"Nothing to do",intent:"is-info"});return}const o=[{label:"Main",value:tee,selected:!0},{label:"Qualifying",value:Ant}].map(({label:p,value:h,selected:f})=>({selected:f,label:p,value:h})),l=[{hide:a,label:"Direct Acceptance",value:eee,selected:!0},{hide:a,label:"Alternate",value:Rnt},{hide:a,label:"Wildcard",value:Mnt},{hide:n===iee,label:"Ungrouped",value:Nnt,selected:a}];let c;er({title:"Add to event",content:p=>c=Sr(p,[{text:`Add ${r.length} participant to ${e}`},{options:o,label:"Event stage",field:"entryStage",value:tee},{options:l,value:eee,label:"Entry status",field:"entryStatus"}]),buttons:[{label:"Cancel",intent:xt,close:!0},{label:"Add",intent:"is-info",close:!0,onClick:()=>{const p=c.entryStatus.value,h=c.entryStage.value;Ot(t)&&t({entryStatus:p,entryStage:h})}}]})}function LDe({event:t,participantType:e,table:i,callback:n}){const r=i.getSelectedData(),{eventId:a,eventName:s,eventType:o}=t,l=r.filter(u=>!u.events.map(d=>d.eventId).includes(a)).map(({participantId:u})=>u);xnt({callback:({entryStatus:u,entryStage:d}={})=>{i.deselectRow(),ii({methods:[{params:{eventId:a,participantIds:l,entryStatus:u,entryStage:d},method:aY}],callback:f=>{f.success?Ot(n)&&n():(console.log({result:f}),f.misMatchedGender&&Jt({intent:"is-danger",message:"Invalid gender"}))}})},eventName:s,participantType:e,eventType:o,participantIds:l})}const{ALTERNATE:Ont,DIRECT_ACCEPTANCE:Lnt,UNGROUPED:Fnt,STRUCTURE_SELECTED_STATUSES:$nt}=nd,{ANY:fb,FEMALE:P0,MALE:C0,MIXED:mb}=jp,{DOUBLES:mv,SINGLES:R0,TEAM:gv}=pl,{INDIVIDUAL:aN,PAIR:nee}=Ls,{MAIN:Bnt}=Qr;function _2({table:t,event:e,participants:i,callback:n}={}){var w,S,U,P,E;const r=((w=ot.getEvents().events)==null?void 0:w.length)||0,a=((S=ot.getTournamentInfo())==null?void 0:S.tournamentInfo)||{},s={eventName:(e==null?void 0:e.eventName)||`Event ${r+1}`,startDate:(e==null?void 0:e.startDate)??a.startDate,endDate:(e==null?void 0:e.endDate)??a.endDate,ageCategoryCode:(U=e==null?void 0:e.category)==null?void 0:U.ageCategoryCode,eventType:(e==null?void 0:e.eventType)||R0,gender:(e==null?void 0:e.gender)||fb},o=(P=e==null?void 0:e.entries)==null?void 0:P.filter(({entryStatus:R})=>[...$nt,Ont].includes(R)).map(({participantId:R})=>R),l=o?ot.getParticipants({participantFilters:{participantIds:o},withIndividualParticipants:!0}).participants:[];let c,u;const d=i==null?void 0:i[0].participantType;if(i!=null&&i.length){s.eventType=d===aN&&R0||d===nee&&mv||gv,d===aN&&(c=[R0,mv,gv]),d===nee&&(c=[mv]),d===gv&&(c=[gv]);const R=d===aN&&_i.unique(i.map(C=>{var M,_;return(_=(M=C.participant)==null?void 0:M.person)==null?void 0:_.sex}));u=[fb],R.length===1?(R[0]===P0&&u.push(P0),R[0]===C0&&u.push(C0),s.gender=R[0]):R.length>1&&u.push(mb)}const p=[],h=l.reduce((R,C)=>{var _,A;const M=(_=C.person)!=null&&_.sex?[C.person.sex]:((A=C.individualParticpants)==null?void 0:A.map(N=>{var k;return(k=N.person)==null?void 0:k.sex}))||[];return p.push(M),R.includes(C.participantType)?R:R.concat(C.participantType)},[]),f=[];for(const R of[...l,...(i||[]).map(C=>C.participant)].filter(C=>C)){const C=(E=R.timeItems)==null?void 0:E.filter(({itemType:M})=>M==null?void 0:M.startsWith(`SCALE.RANKING.${s.eventType}`)).map(({itemType:M})=>M==null?void 0:M.split(".").pop());f.push(C)}const m=_i.unique(...f);if(m.length===1&&(s.ageCategoryCode=m[0]),p.length){u=[fb],e.gender&&!e.gender===fb&&u.push(e.gender),e.eventType===mv&&!u.includes(mb)&&u.push(mb);const R=_i.unique(...p);R.length===1&&!u.includes(R[0])&&u.push(...R)}else e&&(u=[fb,C0,mb,P0]);const g=()=>{},v=[{fields:["startDate","endDate"],minDate:a.startDate,maxDate:a.endDate,dateRange:!0}],y=R=>Sr(R,[{error:"minimum of 5 characters",validator:Wr(5),placeholder:"Event name",value:s.eventName,onChange:g,selectOnFocus:!0,label:"Event name",field:"eventName",focus:!0},{disabled:h.length,value:s.eventType,field:"eventType",label:"Format",options:[{hide:c&&!c.includes(R0),selected:s.eventType===R0,label:"Singles",value:R0},{hide:c&&!c.includes(mv),selected:s.eventType===mv,label:"Doubles",value:mv},{hide:c&&!c.includes(gv),selected:s.eventType===gv,label:"Team",value:gv}],onChange:g},{value:s.gender,label:"Gender",field:"gender",options:[{hide:u&&!u.includes(C0),selected:s.gender===C0,label:"Male",value:C0},{hide:u&&!u.includes(P0),selected:s.gender===P0,label:"Female",value:P0},{selected:s.gender===fb,label:"Any",value:fb},{hide:u&&!u.includes(mb),selected:s.gender===mb,label:"Mixed",value:mb}],onChange:g},{value:s.ageCategoryCode,field:"ageCategoryCode",label:"Category",options:[{selected:["",void 0].includes(s.ageCategoryCode),label:"------------",value:""},{selected:s.ageCategoryCode==="U10",label:"10 and Under",value:"U10"},{selected:s.ageCategoryCode==="U12",label:"12 and Under",value:"U12"},{selected:s.ageCategoryCode==="U14",label:"14 and Under",value:"U14"},{selected:s.ageCategoryCode==="U16",label:"16 and Under",value:"U16"},{selected:s.ageCategoryCode==="U18",label:"18 and Under",value:"U18"},{label:"Custom",value:"custom",disabled:!0}],onChange:g},{value:(e==null?void 0:e.startDate)??a.startDate,placeholder:"YYYY-MM-DD",label:"Start date",field:"startDate"},{value:(e==null?void 0:e.endDate)??a.endDate,placeholder:"YYYY-MM-DD",label:"End date",field:"endDate"},{hide:e||i,divider:!0}],v),b=()=>{const R=It.drawer.attributes.content.ageCategoryCode.value,C=It.drawer.attributes.content.eventName.value,M=It.drawer.attributes.content.eventType.value,_=It.drawer.attributes.content.startDate.value,A=It.drawer.attributes.content.endDate.value,N=It.drawer.attributes.content.gender.value,k={eventName:C,eventType:M,gender:N,startDate:_,endDate:A};R&&R!=="custom"&&(k.category={...e==null?void 0:e.category,ageCategoryCode:R});const O=$=>{var F,V,j;if(t==null||t.deselectRow(),$.success){const B=(V=(F=$.results)==null?void 0:F[0])==null?void 0:V.event;Ot(n)&&n({...$,event:B,eventUpdates:k})}else $.error&&(Jt({intent:"is-warning",message:((j=$.error)==null?void 0:j.message)||"Error"}),Ot(n)&&n())};if(e){const $=e.eventId;ii({methods:[{method:OZe,params:{eventId:$,eventUpdates:k}}],callback:O})}else{const $=R&&R!=="custom"?{ageCategoryCode:R}:void 0,F=_i.UUID(),V=[{params:{event:{category:$,eventId:F,eventName:C,eventType:M,gender:N,startDate:_,endDate:A}},method:wZe}];if(i!=null&&i.length){const j=i.map(({participantId:W})=>W),B=d===aN&&[mv,gv].includes(M)?Fnt:Lnt,z={params:{eventId:F,participantIds:j,entryStatus:B,entryStage:Bnt},method:aY};V.push(z)}ii({methods:V,callback:O})}},I=(R,C)=>qw(R,[{label:"Cancel",onClick:()=>t==null?void 0:t.deselectRow(),close:!0},{label:"Save",onClick:b,close:!0,intent:"is-info"}],C),T=e!=null&&e.eventId?"Edit event":"Add event";It.drawer.open({title:`<b style='larger'>${T}</b>`,onClose:()=>t==null?void 0:t.deselectRow(),width:"300px",side:oi,content:y,footer:I})}const bk=(t,e)=>{const i=t.getSelectedData(),n=t.getData("active").map(s=>s.participantId),r=i.filter(s=>n.includes(s.participantId));_2({table:t,callback:s=>{var o,l;if(t.deselectRow(),s!=null&&s.success){const c=(l=(o=s==null?void 0:s.results[0])==null?void 0:o.event)==null?void 0:l.eventId;Ot(e)?e({eventId:c}):c&&Jr({eventId:c})}else Ot(e)&&e()},participants:r})},{INDIVIDUAL:ree,TEAM:aee,GROUP:see}=Ls,{OFFICIAL:oee}=zg,FDe=t=>[{label:"Individuals",value:ree,isActive:t===ree,close:!0},{label:"Officials",value:oee,isActive:t===oee,close:!0},{label:"Groups",value:see,isActive:t===see,close:!0},{label:"Teams",value:aee,isActive:t===aee,close:!0}].map(e=>({...e,onClick:()=>{if(e.value!==t){const n=`/tournament/${ot.getTournament().tournamentRecord.tournamentId}/${Qf}/${e.value}`;It.router.navigate(n)}}})),{INDIVIDUAL:Vnt,GROUP:jnt}=Ls,{OFFICIAL:Gnt}=zg,{ANY:Hnt}=jp,IB="is-primary";function znt({view:t}){var P,E,R;const{table:e,replaceTableData:i,teamParticipants:n,groupParticipants:r}=ent({view:t}),a=zw(e),{eventOptions:s,events:o}=_De(e),{sexOptions:l,genders:c}=vnt(e),{teamOptions:u}=gnt({table:e,teamParticipants:n}),d=()=>Cnt({callback:i}),p=()=>{fnt({callback:()=>{i(),e==null||e.redraw(!0)},showNotice:!0})},h=t===Gnt?"Officials":"Individuals",{extension:f}=ot.findExtension({discover:!0,name:jv.REGISTRATION}),m=f==null?void 0:f.value,g=Xc(),v=((P=g==null?void 0:g.roles)==null?void 0:P.includes("superadmin"))||((E=g==null?void 0:g.permissions)==null?void 0:E.includes("editTennisId")),y=[{onClick:()=>Snt(i),label:"Sign out players not approved for events",close:!0},{onClick:C=>yit(C,e),label:"Edit ratings",close:!0},{onClick:C=>tnt(C,e),hide:!v,label:"Edit WTID",close:!0},{divider:!0},{heading:"Add participants"},{hide:m,label:"Generate mock participants",onClick:p,close:!0},{label:"Import from Google sheet",onClick:d,close:!0},{onClick:()=>CDe({callback:i,view:t}),label:"New participant",close:!0}],b=o.map(C=>({onClick:()=>LDe({event:C,participantType:Vnt,table:e,callback:i}),label:C.eventName,close:!0})).concat([{divider:!0},{label:'<p style="font-weight: bold">Create new event</p>',onClick:()=>bk(e,i),close:!0}]),I=KQ({participants:r,participantType:jnt,replaceTableData:i,table:e}),T=KQ({participants:n,table:e,replaceTableData:i}),w=ant(e),S=[{onKeyDown:C=>{C.keyCode===8&&C.target.value.length===1&&a(""),w(C)},onChange:C=>a(C.target.value),onKeyUp:C=>a(C.target.value),clearSearch:()=>a(""),placeholder:"Search participants",location:fa,search:!0},{options:b,label:"Add to event",hide:!o.length,intent:"is-none",location:fa},{onClick:()=>bk(e,i),label:"Create event",hide:o.length,intent:"is-info",location:fa},{selection:T,label:"Add to team",intent:"is-none",location:fa},{selection:I,label:"Add to group",intent:"is-none",location:fa},{onClick:()=>bnt(e),intent:IB,location:fa,label:"Sign in"},{onClick:()=>kDe(e),label:"Delete selected",intent:"is-danger",stateChange:!0,location:fa},{onKeyDown:C=>{C.keyCode===8&&C.target.value.length===1&&a(""),w(C)},onChange:C=>a(C.target.value),onKeyUp:C=>a(C.target.value),clearSearch:()=>a(""),placeholder:"Search participants",location:pi,search:!0},{hide:(o||[]).length<1,options:s,label:gg,modifyLabel:!0,selection:!0,location:pi},{label:(R=u[0])==null?void 0:R.label,options:u,modifyLabel:!0,selection:!0,location:pi},{options:l,label:c[Hnt],modifyLabel:!0,selection:!0,location:pi},{options:FDe(t),label:h,intent:"is-info",modifyLabel:!0,location:oi,selection:!0,align:oi},{options:y,label:"Actions",selection:!1,location:oi,align:oi},{onClick:C=>snt(C,e),class:"saveTennisId",intent:IB,label:"Save WTID",location:oi,visible:!1},{onClick:C=>int(C,e),label:"Save ratings",intent:IB,class:"saveRatings",location:oi,visible:!1}],U=document.getElementById(o5);Io({table:e,target:U,items:S})}const qnt=t=>{const e=document.createElement("ul");return t.forEach(i=>{let n=document.createElement("li");if(i.field==="sex")n.innerHTML="<strong>Gender:&nbsp;</strong>"+i.value;else if(Up(i.value)){if(i.value){let r=document.createElement("div");r.innerHTML=`<strong>${i.title}:&nbsp;</strong>`,n.appendChild(r),n.appendChild(i.value)}}else n.innerHTML="<strong>"+i.title+"</strong>:&nbsp;"+i.value;e.appendChild(n)}),Object.keys(t).length?e:""};function Wnt(t,e){const{individualParticipantIds:i,individualParticipants:n,participantName:r,participantType:a,participantId:s,representing:o}=t,l=(i==null?void 0:i.length)||0;return{events:UDe(t,e),eventIds:t.events.map(({eventId:c})=>c),searchText:r.toLowerCase(),representing:DDe(o),individualParticipants:n,participantName:r,participantType:a,participantId:s,membersCount:l}}function Ynt({table:t,team:e}){const n=t.getSelectedData().map(({participantId:s})=>s);t.deselectRow();const r=[{method:BZe,params:{groupingParticipantId:e.participantId,individualParticipantIds:n,suppressErrors:!0}}];ii({methods:r,callback:s=>{s.success&&t.deleteRow(n)}})}const{ALTERNATE_PARTICIPANT:Knt,ASSIGN_PARTICIPANT:Znt,LUCKY_PARTICIPANT:Xnt,QUALIFYING_PARTICIPANT:Jnt,SWAP_PARTICIPANTS:Qnt}=cw,ert={[Knt]:{selections:"availableAlternates",targetAttribute:"participantId",param:"alternateParticipantId",title:"Assign alternate"},[Znt]:{selections:"participantsAvailable",targetAttribute:"participantId",title:"Select participant"},[Xnt]:{selections:"availableLuckyLosers",targetAttribute:"participantId",param:"luckyLoserParticipantId",title:"Assign lucky loser"},[Jnt]:{selections:"qualifyingParticipants",targetAttribute:"participantId",param:"qualifyingParticipantId",title:"Assign qualifier"},[Qnt]:{selections:["availableAssignments","swappableParticipants"],targetAttribute:"drawPosition",title:"Swap draw positions",param:"drawPositions"},selectParticipants:{selections:"participantsAvailable",targetAttribute:"participantId",title:"Select participants"}};function IM(t){const{selectedParticipantIds:e,selectionLimit:i,activeOnEnter:n,selectOnEnter:r,onSelection:a,update:s,action:o}=t,l=ert[o.type];if(!(l!=null&&l.targetAttribute))return;const c=t.title||l.title||"Select participant";let u,d;const p=()=>{var M,_;const E=l.targetAttribute,R=l.param||l.targetAttribute,C=Array.isArray(u)?(M=u[0])==null?void 0:M[E]:u==null?void 0:u[E];if(o.type==="SWAP"){if(C)o.payload.drawPositions.push(C),a({[R]:o.payload.drawPositions});else if((u==null?void 0:u.length)===1){const A=(_=u==null?void 0:u[0])==null?void 0:_.participantId;o.payload.participantIds.push(A),a({participantIds:o.payload.participantIds})}}else C&&a({[R]:C,selected:u})},h="selectionControl",f="selectionTable",m=[{label:"Cancel",intent:"is-none",close:!0},{hide:i===1,label:"Select",intent:"is-info",onClick:p,close:!0}],g=()=>{const E=It.tables.selectionTable;E==null||E.destroy(),delete It.tables.selectionTable},v=`
    <div style='min-height: 420px'>
      <div id='${h}'></div>
      <div id='${f}'></div>
    </div>
  `;s?s({title:c,content:v,buttons:m,onClose:g}):er({title:c,content:v,buttons:m,onClose:g});const y=E=>{u=E,i&&(u==null?void 0:u.length)===i&&(AI(),p())},b=Array.isArray(l.selections)?o[l.selections.find(E=>o[E])]:o[l.selections],{table:I}=k1e({selectedParticipantIds:e,targetAttribute:l.targetAttribute,selectionLimit:i,onSelected:y,anchorId:f,data:b}),T=zw(I),w=()=>{const E=I.getData("active");if(E.length===1){if(r)u=E[0],AI(),p();else if(n){const R=(u==null?void 0:u.map(M=>M.participantId))||[],C=E[0].participantId;R.includes(C)||(Array.isArray(u)?u.push(E[0]):u=E,I.selectRow([C]),d.participantSearch.value="")}}},U=[{onKeyDown:E=>{E.keyCode===8&&E.target.value.length===1&&T(""),E.key==="Enter"&&w()},onChange:E=>T(E.target.value),onKeyUp:E=>T(E.target.value),clearSearch:()=>T(""),placeholder:"Search entries",id:"participantSearch",location:pi,search:!0,focus:!0}],P=document.getElementById(h);d=Io({table:I,target:P,items:U}).inputs}const{ASSIGN_PARTICIPANT:trt}=cw,wB=_i.extractAttributes,irt=t=>{const e=document.createElement("div"),i=document.createElement("div");i.className="tableControl",i.style.marginBottom="1em",e.appendChild(i);const n="1px solid #333",r=document.createElement("div");r.style.backgroundColor="white",r.style.border=n,r.style.width="99%",e.className=dL,e.style.display=xt,e.style.boxSizing="border-box",e.style.paddingLeft="10px",e.style.borderTop=n,e.style.borderBotom=n,e.appendChild(r),t.getElement().appendChild(e);const a=t.getData(),s=d=>{const p={};return d==null?void 0:d.map(h=>{var m;const f=((m=h.person)==null?void 0:m.sex)||"OTHER";return p[f]||(p[f]=0),p[f]+=1,{...h,order:p[f]}})},o=s(a.individualParticipants),l=new As(r,{placeholder:"No individual participants",index:"participantId",layout:"fitColumns",movableRows:!0,maxHeight:400,data:o,columns:[{cellClick:(d,p)=>p.getRow().toggleSelect(),titleFormatter:"rowSelection",formatter:"rowSelection",headerSort:!1,responsive:!1,hozAlign:pi,width:5},{title:"Order",headerSort:!1,field:"order",width:70},{title:"Name",field:"participantName",formatter:Ww()},{title:"Gender",field:"person.sex",width:100}]});l.on("scrollVertical",wd),l.on("rowMoved",d=>{const p=d.getTable(),f=p.getData().map((v,y)=>({...v,order:y+1})).map(({participantId:v})=>v),m=[{params:{participant:{participantId:a.participantId,individualParticipantIds:f}},method:gk}];ii({methods:m,callback:v=>{if(v.success){const y=p.getRows(),b=y.map(T=>T.getData()),I=s(b);y.forEach((T,w)=>T.update(I[w]))}}})}),Io({table:l,target:i,items:[{onClick:()=>Ynt({table:l,team:a}),label:"Delete selected",intent:"is-danger",stateChange:!0,location:fa},{onClick:()=>{var g;const d=v=>{if(v.participantId){const y=v.selected,b=(v.selected?v.selected.map(wB("participantId")):[v.participantId]).filter(Boolean),I=(a.individualParticipants??[]).map(wB("participantId")).concat(b);if(b!=null&&b.length){const T=[{method:i1e,params:{groupingParticipantId:a.participantId,individualParticipantIds:b}},{params:{participant:{participantId:a.participantId,individualParticipantIds:I}},method:gk}];ii({methods:T,callback:S=>{S.success&&(a.individualParticipants=(a.individualParticipants??[]).concat(y),a.membersCount=a.individualParticipants.length,t.update(a),t.getTable().redraw(!0))}})}}},p=((g=a.individualParticipants)==null?void 0:g.map(wB("participantId")))||[],{participants:h}=ot.getParticipants({participantFilters:{participantTypes:["INDIVIDUAL"]},withISO2:!0}),f=h.filter(({participantId:v})=>!p.includes(v));IM({title:"Select players to add",activeOnEnter:!0,selectionLimit:99,onSelection:d,action:{type:trt,participantsAvailable:f}})},label:"Add players",intent:"is-primary",location:oi}]})},RY="&#9660;",$De=" &#9654;",Rf="&#8964;",BDe=` <span class='tabulator-responsive-collapse-toggle-close toggleCaret'> ${RY} </span>`,VDe=`<span class='tabulator-responsive-collapse-toggle-open toggleCaret'> ${$De} </span>`,jDe=dL;function rI(t,e){const i=e.getRow(),n=i._row.element.getElementsByClassName(jDe)[0];if(n){const r=n.style.display!==xt;n.style.display=r?xt:"";const s=i.getCells().find(o=>o.getColumn().getDefinition().field===Afe)._cell.element;return s&&(s.innerHTML=r?VDe:BDe),{open:!r}}}function MY(t){const i=t.getRow()._row.element.getElementsByClassName(jDe)[0];return(i==null?void 0:i.style.display)!==xt?VDe:BDe}const{GROUP:nrt}=Ls;function rrt({view:t,replaceTableData:e}){const i=(n,r)=>{rI(n,r).open};return[{cellClick:(n,r)=>r.getRow().toggleSelect(),titleFormatter:"rowSelection",formatter:"rowSelection",responsive:!1,headerSort:!1,hozAlign:pi,width:5},{formatter:"responsiveCollapse",width:50,minWidth:50,hozAlign:mi,resizable:!1,headerSort:!1},{headerMenu:xm({matchUpsCount:"Total MatchUps",membersCount:"Individuals",winLoss:"Win/Loss"}),formatter:"rownum",headerSort:!1,hozAlign:pi,width:55},{cellClick:(n,r)=>i(n,r),field:"participantName",title:"Name",minWidth:200,widthGrow:1},{sorter:(n,r)=>{var a,s,o;return(o=(a=n==null?void 0:n[0])==null?void 0:a.eventName)==null?void 0:o.localeCompare((s=r==null?void 0:r[0])==null?void 0:s.eventName)},formatter:RDe(Jr),visible:t!==nrt,hozAlign:pi,field:"events",title:"Events",minWidth:300,editor:!1,widthGrow:2},{title:'<div class="event_icon opponents_header" />',headerTooltip:"Individuals",headerHozAlign:mi,field:"membersCount",hozAlign:mi,headerSort:!0,visible:!0,width:50},{title:'<div class="event_icon matches_header" />',headerTooltip:"Total MatchUps",headerHozAlign:mi,field:"matchUpsCount",hozAlign:mi,headerSort:!0,visible:!0,width:50},{title:'<div class="event_icon winloss_header" />',headerTooltip:"Win/Loss",headerHozAlign:mi,field:"winLoss",hozAlign:mi,headerSort:!0,visible:!0,width:50},{field:"representing",title:"Representing",visible:!1,minWidth:200},{cellClick:i,formatter:MY,responsive:!1,headerSort:!1,hozAlign:oi,field:Afe,width:20},{cellClick:wA(e),formatter:av,responsive:!1,headerSort:!1,hozAlign:oi,width:20}]}const{TEAM:SB}=Ls;function art({view:t}={}){let e,i,n,r;const a=()=>({participants:i,derivedEventInfo:n}=ot.getParticipants({participantFilters:{participantTypes:[t||SB]},withIndividualParticipants:!0,withScaleValues:!0,withEvents:!0,withISO2:!0}),i.map(u=>Wnt(u,n))),s=()=>{setTimeout(()=>e.replaceData(a()),r?0:1e3)},o=rrt({view:t});return(c=>{var p;km({anchorId:v_});const u=document.getElementById(v_),d=(p=jl(u,"section"))==null?void 0:p.querySelector(".tabHeader");e=new As(u,{headerSortElement:rf(["events","membersCount","matchUpsCount","winLoss"]),responsiveLayoutCollapseFormatter:qnt,responsiveLayoutCollapseStartOpen:!1,minHeight:window.innerHeight*.81,height:window.innerHeight*.86,placeholder:"No team participants",rowFormatter:irt,responsiveLayout:"collapse",index:"participantId",layout:"fitColumns",reactiveData:!0,data:c,columns:o}),e.on("dataChanged",h=>{const f=t===SB?"Teams":"Groups";d&&(d.innerHTML=`${f} (${h.length})`)}),e.on("dataFiltered",(h,f)=>{const m=t===SB?"Teams":"Groups";d&&(d.innerHTML=`${m} (${f.length})`)}),e.on("scrollVertical",wd),e.on("tableBuilt",()=>r=!0)})(a()),{table:e,replaceTableData:s}}const srt={country:{personAttribute:"nationalityCode"},city:{accessor:"person.addresses.city"}};function ort({callback:t}={}){const e=[{label:Cs.tr("cnt"),value:"country"},{label:"City",value:"city"}],i="-";er({title:"Create Team",content:a=>Sr(a,[{options:[{label:"Select attribute",value:i},...e],label:"Attribute",field:"selection",value:""}]),buttons:[{label:"Cancel",intent:"none",close:!0},{label:"Create",intent:"is-primary",onClick:({content:a})=>{const s=a==null?void 0:a.selection.value;if(!s||s===i)return;const o=srt[s],l=ot.createTeamsFromParticipantAttributes({...o,addParticipants:!1});if(l.newParticipants){const c=[{params:{participants:l.newParticipants},method:gM}];ii({methods:c,callback:t})}},close:!0}],onClose:()=>{}})}const{TEAM:lee}=Ls;function lrt({view:t}){const{table:e,replaceTableData:i}=art({view:t}),n=zw(e),{eventOptions:r,events:a}=_De(e),s=[{label:"New team",onClick:()=>ADe({title:"New team",refresh:i})},{label:"Generate teams",onClick:()=>ort({callback:i})}],l=[{label:'<p style="font-weight: bold">Create new event</p>',onClick:()=>bk(e,i),close:!0},{divider:!0}].concat(a.filter(({eventType:p})=>p===lee).map(p=>({onClick:()=>LDe({event:p,participantType:lee,table:e,callback:i}),label:p.eventName,close:!0}))),c=t==="GROUP"?"Groups":"Teams",u=[{onKeyDown:p=>p.keyCode===8&&p.target.value.length===1&&n(""),onChange:p=>n(p.target.value),onKeyUp:p=>n(p.target.value),clearSearch:()=>n(""),placeholder:"Search teams",location:fa,search:!0},{options:l,label:"Add to event",hide:!a.length,intent:"is-none",location:fa},{onClick:()=>bk(e,i),label:"Create event",hide:a.length,intent:"is-info",location:fa},{onClick:()=>kDe(e),label:"Delete selected",intent:"is-danger",stateChange:!0,location:fa},{onKeyDown:p=>p.keyCode===8&&p.target.value.length===1&&n(""),onChange:p=>n(p.target.value),onKeyUp:p=>n(p.target.value),clearSearch:()=>n(""),placeholder:"Search teams",location:pi,search:!0},{hide:r.length<2,options:r,modifyLabel:!0,label:gg,location:pi,selection:!0},{options:FDe(t),label:c,modifyLabel:!0,intent:"is-info",location:oi,selection:!0,align:oi},{options:s,label:"Actions",selection:!1,location:oi,align:oi}],d=document.getElementById(h5);Io({table:e,target:d,items:u})}const{INDIVIDUAL:crt,TEAM:urt,GROUP:drt}=Ls;function prt({participantView:t=crt}={}){const e=t.toUpperCase(),i=[urt,drt].includes(e),n=document.getElementById("individuals"),r=document.getElementById("participantGroupings");i?(n.style.display=xt,r.style.display=""):(r.style.display=xt,n.style.display=""),i?lrt({view:e}):znt({view:e})}var GDe=function(t){return String.prototype.normalize?t.normalize("NFKD").replace(/[\u0300-\u036F]/g,""):t};const{TEAM:hrt}=pl,d1=t=>{var A,N,k,O,$;const{potentialParticipants:e,matchUpType:i,matchUpId:n,eventName:r,roundName:a,schedule:s,eventId:o,drawId:l,gender:c,sides:u,...d}=t,{scheduledDate:p,scheduledTime:h,courtName:f}=s||{},m=F=>{var V;return((V=F.person)==null?void 0:V.standardFamilyName)||F.participantName},g=(e==null?void 0:e.map(F=>({participantName:F.map(m).filter(Boolean).join(" or ")})))||[],v=((A=u==null?void 0:u[0])==null?void 0:A.participant)||g.shift(),y=((N=u==null?void 0:u[1])==null?void 0:N.participant)||g.shift(),b={participantName:v==null?void 0:v.participantName,sex:(k=v==null?void 0:v.person)==null?void 0:k.sex,participant:v},I={participantName:y==null?void 0:y.participantName,sex:(O=y==null?void 0:y.person)==null?void 0:O.sex,participant:y},T=u.flatMap(({participant:F})=>{var V;return(V=F==null?void 0:F.individualParticipantIds)!=null&&V.length?F.individualParticipantIds:F==null?void 0:F.participantId}).filter(Boolean),w=d.winningSide===1&&"side1"||d.winningSide===2&&"side2"||void 0,S=!!d.winningSide,U=!!(d.winningSide||d.readyToScore),P=($=d.score)==null?void 0:$.scoreStringSide1,E=u.flatMap(F=>{var j,B,z;const V=(j=F.participant)==null?void 0:j.person;return V?[V.standardGivenName,V.standardFamilyName]:(z=(B=F.participant)==null?void 0:B.individualParticipants)==null?void 0:z.map(({person:W})=>[W.standardGivenName,W.standardFamilyName])}).filter(Boolean).join(" ").toLowerCase(),R=GDe([E,v==null?void 0:v.participantName,y==null?void 0:y.participantName].filter(Boolean).join(" ")).toLowerCase(),C=t.collectionId?hrt:i,M=t.competitiveness?{competitiveness:t.competitiveness}:t.competitiveProfile,_={score:P,matchUpStatus:t.matchUpStatus,readyToScore:U,complete:S,winningSide:w};return{matchUpStatus:t.matchUpStatus,individualParticipantIds:T,flight:t.drawName,competitiveProfile:M,scheduledDate:p,readyToScore:U,scheduledTime:h,matchUpType:i,scoreDetail:_,winningSide:w,searchText:R,courtName:f,eventName:r,eventType:C,matchUpId:n,roundName:a,complete:S,eventId:o,matchUp:t,gender:c,drawId:l,side1:b,side2:I,score:P}};function HDe(t,e){const i=t.target.id;t.dataTransfer.setData("itemid",i),e&&(t.dataTransfer.setData("itemtype",EBe),t.dataTransfer.setDragImage(It.dragMatch,10,10)),t.dataTransfer.effectAllowed="move"}const{MALE:frt,FEMALE:mrt}=jp;function grt(t){function e(a){const s=document.createElement("div"),o=a.getValue(),l=Up(o)&&(o==null?void 0:o.sex)===frt&&"#2E86C1"||(o==null?void 0:o.sex)===mrt&&"#AA336A"||"";return s.style.color=l,s.innerHTML=(Up(o)?o.participantName:o)||"",s}function i(a){const s=document.createElement("div");return s.innerHTML=a.getValue(),s}function n(a){const s=a.getElement();return s.classList.add("tag"),s.classList.add("is-info"),s.classList.add("is-light"),(t==null?void 0:t.length)||0}const r=(a,s)=>{var o;return a.participantName&&!s.participantName||s.participantName&&!a.participantName||!(a!=null&&a.participantName)&&!(s!=null&&s.participantName)?1:(o=a==null?void 0:a.participantName)==null?void 0:o.localeCompare(s==null?void 0:s.participantName)};return[{titleFormatter:n,formatter:"rownum",headerSort:!1,hozAlign:mi,frozen:!0,width:55},{formatter:i,field:"eventName",resizable:!1,title:"Event",visible:!0,minWidth:250},{title:"Flight",field:"flight"},{formatter:i,field:"roundName",resizable:!1,title:"Round",minWidth:90},{formatter:e,sorter:r,responsive:!1,resizable:!1,title:"Side 1",minWidth:120,field:"side1"},{formatter:e,sorter:r,responsive:!1,resizable:!1,title:"Side 2",minWidth:120,field:"side2"},{field:"matchUp.matchUpFormat",title:"Scoring Format",formatter:i,responsive:!1,resizable:!1,minWidth:100}]}const cee=Object.keys(Ife);function vrt(t,e){return cee.indexOf(t.issue)-cee.indexOf(e.issue)}function Ik(t){var s;const e=t.getData(),i=e.flatMap(o=>Object.values(o).filter(Up)).filter(o=>o.matchUpId),{courtIssues:n,rowIssues:r}=Xf.proConflicts({matchUps:i});n&&((s=Object.keys(n))!=null&&s.length),e!=null&&e.length&&t.updateData(e);const a=t.getColumns()[0].getCells();r!=null&&r.length&&r.forEach((o,l)=>{const c=l+1,u=a.find(d=>d.getData().rowNumber===c);if(u){u.getElement().classList.forEach(p=>{p.startsWith("matchup")&&u.getElement().classList.remove(p)});const d=u.getData();if(o.length){const p=o.sort(vrt);d.issues=p;const h=Ife[p[0].issue];u.getElement().classList.add(h)}else u.getElement().style.backgroundColor="white",d.issues=[]}else console.log("control cell not found",{rowNumber:c})})}function yrt(t,e){var m;t.preventDefault();const i=t.dataTransfer.getData("itemid"),n=As.findTable("#tournamentSchedule")[0],a=n.getData().flatMap(g=>Object.values(g).filter(v=>v.matchUpId)).find(g=>g.matchUpId===i)||{};if(!((m=a==null?void 0:a.schedule)!=null&&m.courtId))return;let s;const o=n.getData().find(g=>(s=Object.keys(g).find(v=>{if(Up(g[v]))return g[v].matchUpId===i}),s)),{courtId:l,courtOrder:c,venueId:u}=a.schedule;o[s]={schedule:{courtOrder:c,courtId:l,venueId:u}},n.updateData([o]),delete a.schedule.scheduledDate,delete a.schedule.scheduledTime,delete a.schedule.courtOrder,delete a.schedule.courtId,delete a.schedule.venueId;const d={scheduledTime:"",scheduledDate:"",courtOrder:"",venueId:"",courtId:""},p=[{method:MG,params:{tournamentId:a.tournamentId,matchUpId:a.matchUpId,schedule:d,drawId:a.drawId,removePriorValues:!0}}];ii({methods:p,engine:Z4,callback:g=>!g.success&&console.log({result:g})}),a.schedule=d;const f=d1(a);e.addRow(f,!0),Ik(n)}const{SINGLES:brt,DOUBLES:Irt}=pl;function wrt({scheduledDate:t}={}){let e=t,i,n,r;function a(d){const p=d.getElement(),f=d.getData().matchUp.matchUpId;p.id=f,p.addEventListener("dragstart",m=>HDe(m,!0)),p.draggable=!0}function s({scheduledDate:d}){var m;const p=((m=Xf.allCompetitionMatchUps({matchUpFilters:{matchUpStatuses:Uo.upcomingMatchUpStatuses,matchUpTypes:[brt,Irt]},nextMatchUps:!0}).matchUps)==null?void 0:m.filter(g=>{var v,y;return!((v=g.schedule)!=null&&v.courtId)&&!((y=g.sides)!=null&&y.some(({bye:b})=>b))}))||[],h=d||e;return i=p.filter(g=>{var v;return!((v=g.schedule)!=null&&v.scheduledDate)||g.schedule.scheduledDate===h}),{rowMatchUps:i.map(d1)}}function o({scheduledDate:d}={}){return setTimeout(()=>{const{rowMatchUps:h=[]}=s({scheduledDate:d});r&&r.replaceData(h)},n?0:1e3),{unscheduledMatchUps:i}}const l=grt(i);km({anchorId:Gb});const c=document.getElementById(Gb),{rowMatchUps:u=[]}=s({scheduledDate:e});return r=new As(c,{headerSortElement:rf(["flight"]),placeholder:"No unscheduled matches",rowFormatter:a,layout:"fitDataStretch",index:"matchUpId",data:u,height:250,columns:l}),r.on("tableBuilt",()=>{n=!0;const d=c.getElementsByClassName("tabulator-tableholder")[0];d.addEventListener("drop",p=>yrt(p,r)),d.ondragover=p=>p.preventDefault(),d.draggable=!0}),r.on("dataChanged",d=>{const p=r.getColumns()[0]._getSelf().titleElement;p.innerHTML=`${d.length}`}),r.on("dataFiltered",(d,p)=>{const h=r.getColumns()[0]._getSelf().titleElement;h.innerHTML=`${p.length}`}),r.on("rowClick",(d,p)=>{const h=p.getData();console.log({matchUp:h})}),{table:r,replaceTableData:o,unscheduledMatchUps:i}}function NY(t,e){return t?_i.dateTime.convertTime(t,e):""}function Srt(t){const e=NY(t,!0).split(":");return+e[0]*60*60+ +e[1]*60+(+e[2]||0)}function uee(t){return t.toString()[1]?t:"0"+t}function Trt(t,e){let i=Math.floor(t/3600),n=Math.floor((t-i*(60*60))/60);return e&&(n=0,i+=1,i>23&&(i=0)),`${uee(i)}:${uee(n)}`}function Urt(t){const{matchUp:e}=t??{};let i;const n=()=>{console.log({matchUp:e,inputs:i}),Ot(t.callback)&&console.log("Callback")},r=Zi.scales[Zi.activeScale],a=({matchUp:y,sideNumber:b})=>{var T;const I=(T=y==null?void 0:y.sides.find(w=>w.sideNumber===b))==null?void 0:T.participant;return tY({composition:{configuration:{participantDetail:"TEAM",genderColor:!0,winnerColor:!0,scaleAttributes:r,flag:!1}},placeholder:"TBD",participant:I,sideNumber:b,matchUp:y})},s=a({matchUp:e,sideNumber:1}),o=a({matchUp:e,sideNumber:2}),l="space-between",c="flex-end",u=document.createElement("div");u.style.flexDirection="column",u.style.display="flex",u.style.padding="1em",u.style.width="100%";const d=(y,b)=>{const I=document.createElement("div");return I.style.justifyContent=l,I.style.marginBottom=y,I.style.flexDirection="row",I.style.display="flex",I.appendChild(b),I},p=d("0.5em",s),h=d("0em",o),f=(y,b)=>{const I=document.createElement("input");return I.style.marginLeft="0.5em",I.className="input",I.style.width="2em",I.id=`i${y}-${b}`,I},m=(y,b)=>{const I=document.createElement("div");I.style.marginBottom=y,I.style.justifyContent=c,I.style.flexDirection="row",I.style.display="flex";const T=f(b,1),w=f(b,2);return I.appendChild(T),I.appendChild(w),I},g=m("0.5em",1);p.appendChild(g);const v=m("0em",2);h.appendChild(v),u.appendChild(p),u.appendChild(h),er({title:"Score entry",content:u,buttons:[{label:"Cancel",intent:"none",close:!0},{onClick:n,intent:"is-primary",id:"submitScore",disabled:!1,label:"Submit",close:!0}]})}const Drt=""+new URL("completed-DD-jSIm6.png",import.meta.url).href;function zDe(t){return Object.assign({},...Object.keys(t).map(e=>({[e]:{id:t[e],element:document.getElementById(t[e])}})))}const Ert=function(){let t={};t.display=({muid:l,teams:c})=>{let u={scoreboard:"sbId"},{ids:d,html:p}=e({muid:l,teams:c});return er({content:p,config:{maxWidth:450}}),Object.assign(d,u),zDe(d)};function e({muid:l,teams:c,round_name:u,match:d}){let p={root:"sb-root",actions:"sb-actions",favorite:"sb-favorite",scoring:"sb-scoring",delegate:"sb-delegate",docs:"sb-docs",clear:"sb-clear",cancel:"sb-cancel",accept:"sb-accept",p1action:"sb-p1action",p2action:"sb-p2action",p1scores:"sb-p1scores",p2scores:"sb-p2score",round_name:"sb-round-name",p1scores_e:"sb-p1scores-e",p2scores_e:"sb-p2scores-e",p1selector:"sb-p1selector",p2selector:"sb-p2selector",p1tiebreak:"sb-p1tiebreak",p2tiebreak:"sb-p2tiebreak",details:"sb-details"},h=i();Object.assign(p,h.ids);let f=`
         <div id="${p.root}" class="scoreboard noselect muid ${p.root}" muid='${l}'>
            <div class='scorebox'>
               <div class='info'>
                  <span class="info-text">
                     <span class="round_name" id='${p.round_name}'>${u||""}</span>
                  </span>
                  <div id='${p.favorite}' class='fav favoriteMatch' style='display: none'></div>
                  <div id='${p.scoring}' class='options' style='display: none'>-</div>
               </div>
               <div class='sbox'>
                  <div class='sbcol flexgrow'> 
                     <div class="opponent opponent0">
                        <div class="opponent-name">
                           <div class="name-detail">
                              ${s({team:c[0],index:0})}
                              ${s({team:c[0],index:1})}
                           </div>
                        </div>
                     </div>
               
                     <div class="opponent opponent1">
                        <div class="opponent-name">
                           <div class="name-detail">
                              ${s({team:c[1],index:0})}
                              ${s({team:c[1],index:1})}
                           </div>
                        </div>
                     </div>
                  </div>

                  <div class='sbcol'> 
                     <div class="opponent opponent0">
                        <div id="${p.p1scores}" class="opponent-scores"></div>
                        <div id="${p.p1selector}" class="score-selector"></div>
                        <div class="score-selector tbinput"> <input id="${p.p1tiebreak}"> </div>
                        <div id="${p.p1scores_e}" class="opponent-scores"></div>
                     </div>
               
                     <div class="opponent opponent1">
                        <div id="${p.p2scores}" class="opponent-scores"></div>
                        <div id="${p.p2selector}" class="score-selector"></div>
                        <div class="score-selector tbinput"> <input id="${p.p2tiebreak}"> </div>
                        <div id="${p.p2scores_e}" class="opponent-scores"></div>
                     </div>
                  </div>

                  <div class='sbcol'>
                     <div class="opponent opponent0">
                        <div id="${p.p1action}" class="score-action"></div>
                     </div>
                     <div class="opponent opponent1">
                        <div id="${p.p2action}" class="score-action"></div>
                     </div>
                  </div>

                  <div class='sbcol'>
                     <div class="opponent opponent0">&nbsp;</div>
                     <div class="opponent opponent1">&nbsp;</div>
                  </div>

               </div>
               <div class="info">
                  <span class="info-text"> <span id="${p.details}" class="court">${r(d)}</span> </span>
                  <div id='${p.delegate}' class='options' style='display: none'>&#x25B7;</div>
               </div>
            </div>

            ${h.html}

            <div id='${p.actions}' class="scoreboard-action">
               <div class="edit flexcol">
                  <div class="frame">
                     <div class="scoreboard-actions">
                        <button id='${p.cancel}' class='btn dismiss'>${Cs.tr("actions.cancel")}</button>
                        <button id='${p.clear}' class='btn dismiss'>${Cs.tr("clr")}</button>
                        <button id='${p.accept}' class='btn accept'>${Cs.tr("apt")}</button>
                     </div>
                  </div>
               </div>
            </div>

         </div>
      `;return{ids:p,html:f}}function i(){let l={edit_scoring:"sbcfg-edit",bestof:"sbcfg-bestof",setsto:"sbcfg-setsto",tiebreaksat:"sbcfg-tiebreasat",tiebreaksto:"sbcfg-tiebreaksto",finalset:"sbcfg-finalset",supertiebreakto:"sbcfg-supertbto",stb2:"sbcfg-stb2"},c=`
            <div id='${l.edit_scoring}' class="scoreboard-config scoreboard-action">
               <div class="edit configure sb_flexrow">
                  <div class='flexcol' style='width: 25%'>
                     <div style='text-align: right'>${Cs.tr("scoring_format.bestof")}</div>
                     <div style='text-align: right'>${Cs.tr("scoring_format.tbat")}</div>
                     <div style='text-align: right'>${Cs.tr("scoring_format.finalset")}</div>
                  </div>
                  <div class='flexcol' style='width: 25%'>
                     <div id="${l.bestof}" class="score-selector"></div>
                     <div id="${l.tiebreaksat}" class="score-selector"></div>
                     <div id="${l.finalset}" class="score-selector"></div>
                  </div>
                  <div class='flexcol' style='width: 25%'>
                     <div style='text-align: right'>${Cs.tr("scoring_format.setsto")}</div>
                     <div style='text-align: right'>${Cs.tr("scoring_format.tbto")}</div>
                     <div id='${l.stb2}' style='text-align: right'>${Cs.tr("scoring_format.superto")}</div>
                  </div>
                  <div class='flexcol' style='width: 25%'>
                     <div id="${l.setsto}" class="score-selector"></div>
                     <div id="${l.tiebreaksto}" class="score-selector"></div>
                     <div id="${l.supertiebreakto}" class="score-selector"></div>
                  </div>
               </div>
            </div>
      `;return{ids:l,html:c}}const n=(l,c)=>{let u=parseInt(l,10),d=Math.floor(u/3600),p=Math.floor((u-d*3600)/60),h=u-d*3600-p*60,f=!c||(c==null?void 0:c.display_seconds),m=!c||(c==null?void 0:c.pad_hours);return d<10&&m&&(d="0"+d),p<10&&(p="0"+p),h<10&&(h="0"+h),f?d+":"+p+":"+h:d+":"+p};function r(l){if(!l)return"";if(l.status)return l.status;if(!l.schedule)return"";let c=a(l.schedule);if(c)return`Duration ${c}`;let u=`${l.schedule.time_prefix||""}${l.schedule.time||""}`,d=`${l.schedule.court||""}${u?" / "+u:""}`;return l.winner_index===void 0?d:""}function a(l){if(!l.start||!l.end)return"";let c=o(l.end)-o(l.start);return n(c,{pad_hours:!1,display_seconds:!1})}function s({team:l,index:c=0}){var p,h;if(c===1)return"";const u=(p=l.person)==null?void 0:p.nationalityCode;return`
         <div class="team_player">
            <span class="pad">${u?(h=Jf.countryToFlag(u))==null?void 0:h.slice(0,4):""}</span>
            <span class="pad">${l.participantName}</span>
            <span class="pad"></span>
         </div>
      `}function o(l){let c=l.split(":");return c[0]*60*60+c[1]*60}return t}();function qDe(t,e){if(!t||!e)return;let i=Object.keys(t),n=Object.keys(e);for(let r of i)if(n.indexOf(r)>=0){let a=e[r],s=t[r];typeof a=="object"&&typeof s!="function"&&a.constructor!==Array?qDe(t[r],e[r]):e[r]=t[r]}}function WDe(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}function Prt(t){return t.length===1&&(t=Crt(t)),{left:function(e,i,n,r){for(n==null&&(n=0),r==null&&(r=e.length);n<r;){var a=n+r>>>1;t(e[a],i)<0?n=a+1:r=a}return n},right:function(e,i,n,r){for(n==null&&(n=0),r==null&&(r=e.length);n<r;){var a=n+r>>>1;t(e[a],i)>0?r=a:n=a+1}return n}}}function Crt(t){return function(e,i){return WDe(t(e),i)}}Prt(WDe);var Rrt={value:function(){}};function YDe(){for(var t=0,e=arguments.length,i={},n;t<e;++t){if(!(n=arguments[t]+"")||n in i||/[\s.]/.test(n))throw new Error("illegal type: "+n);i[n]=[]}return new SA(i)}function SA(t){this._=t}function Mrt(t,e){return t.trim().split(/^|\s+/).map(function(i){var n="",r=i.indexOf(".");if(r>=0&&(n=i.slice(r+1),i=i.slice(0,r)),i&&!e.hasOwnProperty(i))throw new Error("unknown type: "+i);return{type:i,name:n}})}SA.prototype=YDe.prototype={constructor:SA,on:function(t,e){var i=this._,n=Mrt(t+"",i),r,a=-1,s=n.length;if(arguments.length<2){for(;++a<s;)if((r=(t=n[a]).type)&&(r=Nrt(i[r],t.name)))return r;return}if(e!=null&&typeof e!="function")throw new Error("invalid callback: "+e);for(;++a<s;)if(r=(t=n[a]).type)i[r]=dee(i[r],t.name,e);else if(e==null)for(r in i)i[r]=dee(i[r],t.name,null);return this},copy:function(){var t={},e=this._;for(var i in e)t[i]=e[i].slice();return new SA(t)},call:function(t,e){if((r=arguments.length-2)>0)for(var i=new Array(r),n=0,r,a;n<r;++n)i[n]=arguments[n+2];if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(a=this._[t],n=0,r=a.length;n<r;++n)a[n].value.apply(e,i)},apply:function(t,e,i){if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(var n=this._[t],r=0,a=n.length;r<a;++r)n[r].value.apply(e,i)}};function Nrt(t,e){for(var i=0,n=t.length,r;i<n;++i)if((r=t[i]).name===e)return r.value}function dee(t,e,i){for(var n=0,r=t.length;n<r;++n)if(t[n].name===e){t[n]=Rrt,t=t.slice(0,n).concat(t.slice(n+1));break}return i!=null&&t.push({name:e,value:i}),t}var mH="http://www.w3.org/1999/xhtml";const pee={svg:"http://www.w3.org/2000/svg",xhtml:mH,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function k2(t){var e=t+="",i=e.indexOf(":");return i>=0&&(e=t.slice(0,i))!=="xmlns"&&(t=t.slice(i+1)),pee.hasOwnProperty(e)?{space:pee[e],local:t}:t}function Art(t){return function(){var e=this.ownerDocument,i=this.namespaceURI;return i===mH&&e.documentElement.namespaceURI===mH?e.createElement(t):e.createElementNS(i,t)}}function _rt(t){return function(){return this.ownerDocument.createElementNS(t.space,t.local)}}function KDe(t){var e=k2(t);return(e.local?_rt:Art)(e)}function krt(){}function AY(t){return t==null?krt:function(){return this.querySelector(t)}}function xrt(t){typeof t!="function"&&(t=AY(t));for(var e=this._groups,i=e.length,n=new Array(i),r=0;r<i;++r)for(var a=e[r],s=a.length,o=n[r]=new Array(s),l,c,u=0;u<s;++u)(l=a[u])&&(c=t.call(l,l.__data__,u,a))&&("__data__"in l&&(c.__data__=l.__data__),o[u]=c);return new Bd(n,this._parents)}function Ort(){return[]}function ZDe(t){return t==null?Ort:function(){return this.querySelectorAll(t)}}function Lrt(t){typeof t!="function"&&(t=ZDe(t));for(var e=this._groups,i=e.length,n=[],r=[],a=0;a<i;++a)for(var s=e[a],o=s.length,l,c=0;c<o;++c)(l=s[c])&&(n.push(t.call(l,l.__data__,c,s)),r.push(l));return new Bd(n,r)}function XDe(t){return function(){return this.matches(t)}}function Frt(t){typeof t!="function"&&(t=XDe(t));for(var e=this._groups,i=e.length,n=new Array(i),r=0;r<i;++r)for(var a=e[r],s=a.length,o=n[r]=[],l,c=0;c<s;++c)(l=a[c])&&t.call(l,l.__data__,c,a)&&o.push(l);return new Bd(n,this._parents)}function JDe(t){return new Array(t.length)}function $rt(){return new Bd(this._enter||this._groups.map(JDe),this._parents)}function wk(t,e){this.ownerDocument=t.ownerDocument,this.namespaceURI=t.namespaceURI,this._next=null,this._parent=t,this.__data__=e}wk.prototype={constructor:wk,appendChild:function(t){return this._parent.insertBefore(t,this._next)},insertBefore:function(t,e){return this._parent.insertBefore(t,e)},querySelector:function(t){return this._parent.querySelector(t)},querySelectorAll:function(t){return this._parent.querySelectorAll(t)}};function Brt(t){return function(){return t}}var hee="$";function Vrt(t,e,i,n,r,a){for(var s=0,o,l=e.length,c=a.length;s<c;++s)(o=e[s])?(o.__data__=a[s],n[s]=o):i[s]=new wk(t,a[s]);for(;s<l;++s)(o=e[s])&&(r[s]=o)}function jrt(t,e,i,n,r,a,s){var o,l,c={},u=e.length,d=a.length,p=new Array(u),h;for(o=0;o<u;++o)(l=e[o])&&(p[o]=h=hee+s.call(l,l.__data__,o,e),h in c?r[o]=l:c[h]=l);for(o=0;o<d;++o)h=hee+s.call(t,a[o],o,a),(l=c[h])?(n[o]=l,l.__data__=a[o],c[h]=null):i[o]=new wk(t,a[o]);for(o=0;o<u;++o)(l=e[o])&&c[p[o]]===l&&(r[o]=l)}function Grt(t,e){if(!t)return h=new Array(this.size()),c=-1,this.each(function(w){h[++c]=w}),h;var i=e?jrt:Vrt,n=this._parents,r=this._groups;typeof t!="function"&&(t=Brt(t));for(var a=r.length,s=new Array(a),o=new Array(a),l=new Array(a),c=0;c<a;++c){var u=n[c],d=r[c],p=d.length,h=t.call(u,u&&u.__data__,c,n),f=h.length,m=o[c]=new Array(f),g=s[c]=new Array(f),v=l[c]=new Array(p);i(u,d,m,g,v,h,e);for(var y=0,b=0,I,T;y<f;++y)if(I=m[y]){for(y>=b&&(b=y+1);!(T=g[b])&&++b<f;);I._next=T||null}}return s=new Bd(s,n),s._enter=o,s._exit=l,s}function Hrt(){return new Bd(this._exit||this._groups.map(JDe),this._parents)}function zrt(t,e,i){var n=this.enter(),r=this,a=this.exit();return n=typeof t=="function"?t(n):n.append(t+""),e!=null&&(r=e(r)),i==null?a.remove():i(a),n&&r?n.merge(r).order():r}function qrt(t){for(var e=this._groups,i=t._groups,n=e.length,r=i.length,a=Math.min(n,r),s=new Array(n),o=0;o<a;++o)for(var l=e[o],c=i[o],u=l.length,d=s[o]=new Array(u),p,h=0;h<u;++h)(p=l[h]||c[h])&&(d[h]=p);for(;o<n;++o)s[o]=e[o];return new Bd(s,this._parents)}function Wrt(){for(var t=this._groups,e=-1,i=t.length;++e<i;)for(var n=t[e],r=n.length-1,a=n[r],s;--r>=0;)(s=n[r])&&(a&&s.compareDocumentPosition(a)^4&&a.parentNode.insertBefore(s,a),a=s);return this}function Yrt(t){t||(t=Krt);function e(d,p){return d&&p?t(d.__data__,p.__data__):!d-!p}for(var i=this._groups,n=i.length,r=new Array(n),a=0;a<n;++a){for(var s=i[a],o=s.length,l=r[a]=new Array(o),c,u=0;u<o;++u)(c=s[u])&&(l[u]=c);l.sort(e)}return new Bd(r,this._parents).order()}function Krt(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}function Zrt(){var t=arguments[0];return arguments[0]=this,t.apply(null,arguments),this}function Xrt(){var t=new Array(this.size()),e=-1;return this.each(function(){t[++e]=this}),t}function Jrt(){for(var t=this._groups,e=0,i=t.length;e<i;++e)for(var n=t[e],r=0,a=n.length;r<a;++r){var s=n[r];if(s)return s}return null}function Qrt(){var t=0;return this.each(function(){++t}),t}function eat(){return!this.node()}function tat(t){for(var e=this._groups,i=0,n=e.length;i<n;++i)for(var r=e[i],a=0,s=r.length,o;a<s;++a)(o=r[a])&&t.call(o,o.__data__,a,r);return this}function iat(t){return function(){this.removeAttribute(t)}}function nat(t){return function(){this.removeAttributeNS(t.space,t.local)}}function rat(t,e){return function(){this.setAttribute(t,e)}}function aat(t,e){return function(){this.setAttributeNS(t.space,t.local,e)}}function sat(t,e){return function(){var i=e.apply(this,arguments);i==null?this.removeAttribute(t):this.setAttribute(t,i)}}function oat(t,e){return function(){var i=e.apply(this,arguments);i==null?this.removeAttributeNS(t.space,t.local):this.setAttributeNS(t.space,t.local,i)}}function lat(t,e){var i=k2(t);if(arguments.length<2){var n=this.node();return i.local?n.getAttributeNS(i.space,i.local):n.getAttribute(i)}return this.each((e==null?i.local?nat:iat:typeof e=="function"?i.local?oat:sat:i.local?aat:rat)(i,e))}function QDe(t){return t.ownerDocument&&t.ownerDocument.defaultView||t.document&&t||t.defaultView}function cat(t){return function(){this.style.removeProperty(t)}}function uat(t,e,i){return function(){this.style.setProperty(t,e,i)}}function dat(t,e,i){return function(){var n=e.apply(this,arguments);n==null?this.style.removeProperty(t):this.style.setProperty(t,n,i)}}function pat(t,e,i){return arguments.length>1?this.each((e==null?cat:typeof e=="function"?dat:uat)(t,e,i??"")):AT(this.node(),t)}function AT(t,e){return t.style.getPropertyValue(e)||QDe(t).getComputedStyle(t,null).getPropertyValue(e)}function hat(t){return function(){delete this[t]}}function fat(t,e){return function(){this[t]=e}}function mat(t,e){return function(){var i=e.apply(this,arguments);i==null?delete this[t]:this[t]=i}}function gat(t,e){return arguments.length>1?this.each((e==null?hat:typeof e=="function"?mat:fat)(t,e)):this.node()[t]}function eEe(t){return t.trim().split(/^|\s+/)}function _Y(t){return t.classList||new tEe(t)}function tEe(t){this._node=t,this._names=eEe(t.getAttribute("class")||"")}tEe.prototype={add:function(t){var e=this._names.indexOf(t);e<0&&(this._names.push(t),this._node.setAttribute("class",this._names.join(" ")))},remove:function(t){var e=this._names.indexOf(t);e>=0&&(this._names.splice(e,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(t){return this._names.indexOf(t)>=0}};function iEe(t,e){for(var i=_Y(t),n=-1,r=e.length;++n<r;)i.add(e[n])}function nEe(t,e){for(var i=_Y(t),n=-1,r=e.length;++n<r;)i.remove(e[n])}function vat(t){return function(){iEe(this,t)}}function yat(t){return function(){nEe(this,t)}}function bat(t,e){return function(){(e.apply(this,arguments)?iEe:nEe)(this,t)}}function Iat(t,e){var i=eEe(t+"");if(arguments.length<2){for(var n=_Y(this.node()),r=-1,a=i.length;++r<a;)if(!n.contains(i[r]))return!1;return!0}return this.each((typeof e=="function"?bat:e?vat:yat)(i,e))}function wat(){this.textContent=""}function Sat(t){return function(){this.textContent=t}}function Tat(t){return function(){var e=t.apply(this,arguments);this.textContent=e??""}}function Uat(t){return arguments.length?this.each(t==null?wat:(typeof t=="function"?Tat:Sat)(t)):this.node().textContent}function Dat(){this.innerHTML=""}function Eat(t){return function(){this.innerHTML=t}}function Pat(t){return function(){var e=t.apply(this,arguments);this.innerHTML=e??""}}function Cat(t){return arguments.length?this.each(t==null?Dat:(typeof t=="function"?Pat:Eat)(t)):this.node().innerHTML}function Rat(){this.nextSibling&&this.parentNode.appendChild(this)}function Mat(){return this.each(Rat)}function Nat(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function Aat(){return this.each(Nat)}function _at(t){var e=typeof t=="function"?t:KDe(t);return this.select(function(){return this.appendChild(e.apply(this,arguments))})}function kat(){return null}function xat(t,e){var i=typeof t=="function"?t:KDe(t),n=e==null?kat:typeof e=="function"?e:AY(e);return this.select(function(){return this.insertBefore(i.apply(this,arguments),n.apply(this,arguments)||null)})}function Oat(){var t=this.parentNode;t&&t.removeChild(this)}function Lat(){return this.each(Oat)}function Fat(){var t=this.cloneNode(!1),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function $at(){var t=this.cloneNode(!0),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function Bat(t){return this.select(t?$at:Fat)}function Vat(t){return arguments.length?this.property("__data__",t):this.node().__data__}var rEe={};if(typeof document<"u"){var jat=document.documentElement;"onmouseenter"in jat||(rEe={mouseenter:"mouseover",mouseleave:"mouseout"})}function Gat(t,e,i){return t=aEe(t,e,i),function(n){var r=n.relatedTarget;(!r||r!==this&&!(r.compareDocumentPosition(this)&8))&&t.call(this,n)}}function aEe(t,e,i){return function(n){try{t.call(this,this.__data__,e,i)}finally{}}}function Hat(t){return t.trim().split(/^|\s+/).map(function(e){var i="",n=e.indexOf(".");return n>=0&&(i=e.slice(n+1),e=e.slice(0,n)),{type:e,name:i}})}function zat(t){return function(){var e=this.__on;if(e){for(var i=0,n=-1,r=e.length,a;i<r;++i)a=e[i],(!t.type||a.type===t.type)&&a.name===t.name?this.removeEventListener(a.type,a.listener,a.capture):e[++n]=a;++n?e.length=n:delete this.__on}}}function qat(t,e,i){var n=rEe.hasOwnProperty(t.type)?Gat:aEe;return function(r,a,s){var o=this.__on,l,c=n(e,a,s);if(o){for(var u=0,d=o.length;u<d;++u)if((l=o[u]).type===t.type&&l.name===t.name){this.removeEventListener(l.type,l.listener,l.capture),this.addEventListener(l.type,l.listener=c,l.capture=i),l.value=e;return}}this.addEventListener(t.type,c,i),l={type:t.type,name:t.name,value:e,listener:c,capture:i},o?o.push(l):this.__on=[l]}}function Wat(t,e,i){var n=Hat(t+""),r,a=n.length,s;if(arguments.length<2){var o=this.node().__on;if(o){for(var l=0,c=o.length,u;l<c;++l)for(r=0,u=o[l];r<a;++r)if((s=n[r]).type===u.type&&s.name===u.name)return u.value}return}for(o=e?qat:zat,i==null&&(i=!1),r=0;r<a;++r)this.each(o(n[r],e,i));return this}function sEe(t,e,i){var n=QDe(t),r=n.CustomEvent;typeof r=="function"?r=new r(e,i):(r=n.document.createEvent("Event"),i?(r.initEvent(e,i.bubbles,i.cancelable),r.detail=i.detail):r.initEvent(e,!1,!1)),t.dispatchEvent(r)}function Yat(t,e){return function(){return sEe(this,t,e)}}function Kat(t,e){return function(){return sEe(this,t,e.apply(this,arguments))}}function Zat(t,e){return this.each((typeof e=="function"?Kat:Yat)(t,e))}var oEe=[null];function Bd(t,e){this._groups=t,this._parents=e}function wM(){return new Bd([[document.documentElement]],oEe)}Bd.prototype=wM.prototype={constructor:Bd,select:xrt,selectAll:Lrt,filter:Frt,data:Grt,enter:$rt,exit:Hrt,join:zrt,merge:qrt,order:Wrt,sort:Yrt,call:Zrt,nodes:Xrt,node:Jrt,size:Qrt,empty:eat,each:tat,attr:lat,style:pat,property:gat,classed:Iat,text:Uat,html:Cat,raise:Mat,lower:Aat,append:_at,insert:xat,remove:Lat,clone:Bat,datum:Vat,on:Wat,dispatch:Zat};function Xat(t){return typeof t=="string"?new Bd([[document.querySelector(t)]],[document.documentElement]):new Bd([[t]],oEe)}function kY(t,e,i){t.prototype=e.prototype=i,i.constructor=t}function lEe(t,e){var i=Object.create(t.prototype);for(var n in e)i[n]=e[n];return i}function SM(){}var cP=.7,Sk=1/cP,bS="\\s*([+-]?\\d+)\\s*",uP="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)\\s*",Lf="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)%\\s*",Jat=/^#([0-9a-f]{3,8})$/,Qat=new RegExp("^rgb\\("+[bS,bS,bS]+"\\)$"),est=new RegExp("^rgb\\("+[Lf,Lf,Lf]+"\\)$"),tst=new RegExp("^rgba\\("+[bS,bS,bS,uP]+"\\)$"),ist=new RegExp("^rgba\\("+[Lf,Lf,Lf,uP]+"\\)$"),nst=new RegExp("^hsl\\("+[uP,Lf,Lf]+"\\)$"),rst=new RegExp("^hsla\\("+[uP,Lf,Lf,uP]+"\\)$"),fee={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};kY(SM,dP,{copy:function(t){return Object.assign(new this.constructor,this,t)},displayable:function(){return this.rgb().displayable()},hex:mee,formatHex:mee,formatHsl:ast,formatRgb:gee,toString:gee});function mee(){return this.rgb().formatHex()}function ast(){return cEe(this).formatHsl()}function gee(){return this.rgb().formatRgb()}function dP(t){var e,i;return t=(t+"").trim().toLowerCase(),(e=Jat.exec(t))?(i=e[1].length,e=parseInt(e[1],16),i===6?vee(e):i===3?new Sd(e>>8&15|e>>4&240,e>>4&15|e&240,(e&15)<<4|e&15,1):i===8?sN(e>>24&255,e>>16&255,e>>8&255,(e&255)/255):i===4?sN(e>>12&15|e>>8&240,e>>8&15|e>>4&240,e>>4&15|e&240,((e&15)<<4|e&15)/255):null):(e=Qat.exec(t))?new Sd(e[1],e[2],e[3],1):(e=est.exec(t))?new Sd(e[1]*255/100,e[2]*255/100,e[3]*255/100,1):(e=tst.exec(t))?sN(e[1],e[2],e[3],e[4]):(e=ist.exec(t))?sN(e[1]*255/100,e[2]*255/100,e[3]*255/100,e[4]):(e=nst.exec(t))?Iee(e[1],e[2]/100,e[3]/100,1):(e=rst.exec(t))?Iee(e[1],e[2]/100,e[3]/100,e[4]):fee.hasOwnProperty(t)?vee(fee[t]):t==="transparent"?new Sd(NaN,NaN,NaN,0):null}function vee(t){return new Sd(t>>16&255,t>>8&255,t&255,1)}function sN(t,e,i,n){return n<=0&&(t=e=i=NaN),new Sd(t,e,i,n)}function sst(t){return t instanceof SM||(t=dP(t)),t?(t=t.rgb(),new Sd(t.r,t.g,t.b,t.opacity)):new Sd}function gH(t,e,i,n){return arguments.length===1?sst(t):new Sd(t,e,i,n??1)}function Sd(t,e,i,n){this.r=+t,this.g=+e,this.b=+i,this.opacity=+n}kY(Sd,gH,lEe(SM,{brighter:function(t){return t=t==null?Sk:Math.pow(Sk,t),new Sd(this.r*t,this.g*t,this.b*t,this.opacity)},darker:function(t){return t=t==null?cP:Math.pow(cP,t),new Sd(this.r*t,this.g*t,this.b*t,this.opacity)},rgb:function(){return this},displayable:function(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:yee,formatHex:yee,formatRgb:bee,toString:bee}));function yee(){return"#"+TB(this.r)+TB(this.g)+TB(this.b)}function bee(){var t=this.opacity;return t=isNaN(t)?1:Math.max(0,Math.min(1,t)),(t===1?"rgb(":"rgba(")+Math.max(0,Math.min(255,Math.round(this.r)||0))+", "+Math.max(0,Math.min(255,Math.round(this.g)||0))+", "+Math.max(0,Math.min(255,Math.round(this.b)||0))+(t===1?")":", "+t+")")}function TB(t){return t=Math.max(0,Math.min(255,Math.round(t)||0)),(t<16?"0":"")+t.toString(16)}function Iee(t,e,i,n){return n<=0?t=e=i=NaN:i<=0||i>=1?t=e=NaN:e<=0&&(t=NaN),new Tf(t,e,i,n)}function cEe(t){if(t instanceof Tf)return new Tf(t.h,t.s,t.l,t.opacity);if(t instanceof SM||(t=dP(t)),!t)return new Tf;if(t instanceof Tf)return t;t=t.rgb();var e=t.r/255,i=t.g/255,n=t.b/255,r=Math.min(e,i,n),a=Math.max(e,i,n),s=NaN,o=a-r,l=(a+r)/2;return o?(e===a?s=(i-n)/o+(i<n)*6:i===a?s=(n-e)/o+2:s=(e-i)/o+4,o/=l<.5?a+r:2-a-r,s*=60):o=l>0&&l<1?0:s,new Tf(s,o,l,t.opacity)}function ost(t,e,i,n){return arguments.length===1?cEe(t):new Tf(t,e,i,n??1)}function Tf(t,e,i,n){this.h=+t,this.s=+e,this.l=+i,this.opacity=+n}kY(Tf,ost,lEe(SM,{brighter:function(t){return t=t==null?Sk:Math.pow(Sk,t),new Tf(this.h,this.s,this.l*t,this.opacity)},darker:function(t){return t=t==null?cP:Math.pow(cP,t),new Tf(this.h,this.s,this.l*t,this.opacity)},rgb:function(){var t=this.h%360+(this.h<0)*360,e=isNaN(t)||isNaN(this.s)?0:this.s,i=this.l,n=i+(i<.5?i:1-i)*e,r=2*i-n;return new Sd(UB(t>=240?t-240:t+120,r,n),UB(t,r,n),UB(t<120?t+240:t-120,r,n),this.opacity)},displayable:function(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl:function(){var t=this.opacity;return t=isNaN(t)?1:Math.max(0,Math.min(1,t)),(t===1?"hsl(":"hsla(")+(this.h||0)+", "+(this.s||0)*100+"%, "+(this.l||0)*100+"%"+(t===1?")":", "+t+")")}}));function UB(t,e,i){return(t<60?e+(i-e)*t/60:t<180?i:t<240?e+(i-e)*(240-t)/60:e)*255}function uEe(t){return function(){return t}}function lst(t,e){return function(i){return t+i*e}}function cst(t,e,i){return t=Math.pow(t,i),e=Math.pow(e,i)-t,i=1/i,function(n){return Math.pow(t+n*e,i)}}function ust(t){return(t=+t)==1?dEe:function(e,i){return i-e?cst(e,i,t):uEe(isNaN(e)?i:e)}}function dEe(t,e){var i=e-t;return i?lst(t,i):uEe(isNaN(t)?e:t)}const wee=function t(e){var i=ust(e);function n(r,a){var s=i((r=gH(r)).r,(a=gH(a)).r),o=i(r.g,a.g),l=i(r.b,a.b),c=dEe(r.opacity,a.opacity);return function(u){return r.r=s(u),r.g=o(u),r.b=l(u),r.opacity=c(u),r+""}}return n.gamma=t,n}(1);function Rv(t,e){return t=+t,e=+e,function(i){return t*(1-i)+e*i}}var vH=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,DB=new RegExp(vH.source,"g");function dst(t){return function(){return t}}function pst(t){return function(e){return t(e)+""}}function hst(t,e){var i=vH.lastIndex=DB.lastIndex=0,n,r,a,s=-1,o=[],l=[];for(t=t+"",e=e+"";(n=vH.exec(t))&&(r=DB.exec(e));)(a=r.index)>i&&(a=e.slice(i,a),o[s]?o[s]+=a:o[++s]=a),(n=n[0])===(r=r[0])?o[s]?o[s]+=r:o[++s]=r:(o[++s]=null,l.push({i:s,x:Rv(n,r)})),i=DB.lastIndex;return i<e.length&&(a=e.slice(i),o[s]?o[s]+=a:o[++s]=a),o.length<2?l[0]?pst(l[0].x):dst(e):(e=l.length,function(c){for(var u=0,d;u<e;++u)o[(d=l[u]).i]=d.x(c);return o.join("")})}var See=180/Math.PI,yH={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function pEe(t,e,i,n,r,a){var s,o,l;return(s=Math.sqrt(t*t+e*e))&&(t/=s,e/=s),(l=t*i+e*n)&&(i-=t*l,n-=e*l),(o=Math.sqrt(i*i+n*n))&&(i/=o,n/=o,l/=o),t*n<e*i&&(t=-t,e=-e,l=-l,s=-s),{translateX:r,translateY:a,rotate:Math.atan2(e,t)*See,skewX:Math.atan(l)*See,scaleX:s,scaleY:o}}var _1,EB,Tee,oN;function fst(t){return t==="none"?yH:(_1||(_1=document.createElement("DIV"),EB=document.documentElement,Tee=document.defaultView),_1.style.transform=t,t=Tee.getComputedStyle(EB.appendChild(_1),null).getPropertyValue("transform"),EB.removeChild(_1),t=t.slice(7,-1).split(","),pEe(+t[0],+t[1],+t[2],+t[3],+t[4],+t[5]))}function mst(t){return t==null||(oN||(oN=document.createElementNS("http://www.w3.org/2000/svg","g")),oN.setAttribute("transform",t),!(t=oN.transform.baseVal.consolidate()))?yH:(t=t.matrix,pEe(t.a,t.b,t.c,t.d,t.e,t.f))}function hEe(t,e,i,n){function r(c){return c.length?c.pop()+" ":""}function a(c,u,d,p,h,f){if(c!==d||u!==p){var m=h.push("translate(",null,e,null,i);f.push({i:m-4,x:Rv(c,d)},{i:m-2,x:Rv(u,p)})}else(d||p)&&h.push("translate("+d+e+p+i)}function s(c,u,d,p){c!==u?(c-u>180?u+=360:u-c>180&&(c+=360),p.push({i:d.push(r(d)+"rotate(",null,n)-2,x:Rv(c,u)})):u&&d.push(r(d)+"rotate("+u+n)}function o(c,u,d,p){c!==u?p.push({i:d.push(r(d)+"skewX(",null,n)-2,x:Rv(c,u)}):u&&d.push(r(d)+"skewX("+u+n)}function l(c,u,d,p,h,f){if(c!==d||u!==p){var m=h.push(r(h)+"scale(",null,",",null,")");f.push({i:m-4,x:Rv(c,d)},{i:m-2,x:Rv(u,p)})}else(d!==1||p!==1)&&h.push(r(h)+"scale("+d+","+p+")")}return function(c,u){var d=[],p=[];return c=t(c),u=t(u),a(c.translateX,c.translateY,u.translateX,u.translateY,d,p),s(c.rotate,u.rotate,d,p),o(c.skewX,u.skewX,d,p),l(c.scaleX,c.scaleY,u.scaleX,u.scaleY,d,p),c=u=null,function(h){for(var f=-1,m=p.length,g;++f<m;)d[(g=p[f]).i]=g.x(h);return d.join("")}}}var gst=hEe(fst,"px, ","px)","deg)"),vst=hEe(mst,", ",")",")"),_T=0,K1=0,k1=0,fEe=1e3,Tk,Z1,Uk=0,kI=0,x2=0,pP=typeof performance=="object"&&performance.now?performance:Date,mEe=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(t){setTimeout(t,17)};function O2(){return kI||(mEe(yst),kI=pP.now()+x2)}function yst(){kI=0}function Dk(){this._call=this._time=this._next=null}Dk.prototype=gEe.prototype={constructor:Dk,restart:function(t,e,i){if(typeof t!="function")throw new TypeError("callback is not a function");i=(i==null?O2():+i)+(e==null?0:+e),!this._next&&Z1!==this&&(Z1?Z1._next=this:Tk=this,Z1=this),this._call=t,this._time=i,bH()},stop:function(){this._call&&(this._call=null,this._time=1/0,bH())}};function gEe(t,e,i){var n=new Dk;return n.restart(t,e,i),n}function bst(){O2(),++_T;for(var t=Tk,e;t;)(e=kI-t._time)>=0&&t._call.call(null,e),t=t._next;--_T}function Uee(){kI=(Uk=pP.now())+x2,_T=K1=0;try{bst()}finally{_T=0,wst(),kI=0}}function Ist(){var t=pP.now(),e=t-Uk;e>fEe&&(x2-=e,Uk=t)}function wst(){for(var t,e=Tk,i,n=1/0;e;)e._call?(n>e._time&&(n=e._time),t=e,e=e._next):(i=e._next,e._next=null,e=t?t._next=i:Tk=i);Z1=t,bH(n)}function bH(t){if(!_T){K1&&(K1=clearTimeout(K1));var e=t-kI;e>24?(t<1/0&&(K1=setTimeout(Uee,t-pP.now()-x2)),k1&&(k1=clearInterval(k1))):(k1||(Uk=pP.now(),k1=setInterval(Ist,fEe)),_T=1,mEe(Uee))}}function Dee(t,e,i){var n=new Dk;return e=e==null?0:+e,n.restart(function(r){n.stop(),t(r+e)},e,i),n}var Sst=YDe("start","end","cancel","interrupt"),Tst=[],vEe=0,Eee=1,IH=2,TA=3,Pee=4,wH=5,UA=6;function L2(t,e,i,n,r,a){var s=t.__transition;if(!s)t.__transition={};else if(i in s)return;Ust(t,i,{name:e,index:n,group:r,on:Sst,tween:Tst,time:a.time,delay:a.delay,duration:a.duration,ease:a.ease,timer:null,state:vEe})}function xY(t,e){var i=af(t,e);if(i.state>vEe)throw new Error("too late; already scheduled");return i}function sv(t,e){var i=af(t,e);if(i.state>TA)throw new Error("too late; already running");return i}function af(t,e){var i=t.__transition;if(!i||!(i=i[e]))throw new Error("transition not found");return i}function Ust(t,e,i){var n=t.__transition,r;n[e]=i,i.timer=gEe(a,0,i.time);function a(c){i.state=Eee,i.timer.restart(s,i.delay,i.time),i.delay<=c&&s(c-i.delay)}function s(c){var u,d,p,h;if(i.state!==Eee)return l();for(u in n)if(h=n[u],h.name===i.name){if(h.state===TA)return Dee(s);h.state===Pee?(h.state=UA,h.timer.stop(),h.on.call("interrupt",t,t.__data__,h.index,h.group),delete n[u]):+u<e&&(h.state=UA,h.timer.stop(),h.on.call("cancel",t,t.__data__,h.index,h.group),delete n[u])}if(Dee(function(){i.state===TA&&(i.state=Pee,i.timer.restart(o,i.delay,i.time),o(c))}),i.state=IH,i.on.call("start",t,t.__data__,i.index,i.group),i.state===IH){for(i.state=TA,r=new Array(p=i.tween.length),u=0,d=-1;u<p;++u)(h=i.tween[u].value.call(t,t.__data__,i.index,i.group))&&(r[++d]=h);r.length=d+1}}function o(c){for(var u=c<i.duration?i.ease.call(null,c/i.duration):(i.timer.restart(l),i.state=wH,1),d=-1,p=r.length;++d<p;)r[d].call(t,u);i.state===wH&&(i.on.call("end",t,t.__data__,i.index,i.group),l())}function l(){i.state=UA,i.timer.stop(),delete n[e];for(var c in n)return;delete t.__transition}}function Dst(t,e){var i=t.__transition,n,r,a=!0,s;if(i){e=e==null?null:e+"";for(s in i){if((n=i[s]).name!==e){a=!1;continue}r=n.state>IH&&n.state<wH,n.state=UA,n.timer.stop(),n.on.call(r?"interrupt":"cancel",t,t.__data__,n.index,n.group),delete i[s]}a&&delete t.__transition}}function Est(t){return this.each(function(){Dst(this,t)})}function Pst(t,e){var i,n;return function(){var r=sv(this,t),a=r.tween;if(a!==i){n=i=a;for(var s=0,o=n.length;s<o;++s)if(n[s].name===e){n=n.slice(),n.splice(s,1);break}}r.tween=n}}function Cst(t,e,i){var n,r;if(typeof i!="function")throw new Error;return function(){var a=sv(this,t),s=a.tween;if(s!==n){r=(n=s).slice();for(var o={name:e,value:i},l=0,c=r.length;l<c;++l)if(r[l].name===e){r[l]=o;break}l===c&&r.push(o)}a.tween=r}}function Rst(t,e){var i=this._id;if(t+="",arguments.length<2){for(var n=af(this.node(),i).tween,r=0,a=n.length,s;r<a;++r)if((s=n[r]).name===t)return s.value;return null}return this.each((e==null?Pst:Cst)(i,t,e))}function OY(t,e,i){var n=t._id;return t.each(function(){var r=sv(this,n);(r.value||(r.value={}))[e]=i.apply(this,arguments)}),function(r){return af(r,n).value[e]}}function yEe(t,e){var i;return(typeof e=="number"?Rv:e instanceof dP?wee:(i=dP(e))?(e=i,wee):hst)(t,e)}function Mst(t){return function(){this.removeAttribute(t)}}function Nst(t){return function(){this.removeAttributeNS(t.space,t.local)}}function Ast(t,e,i){var n,r=i+"",a;return function(){var s=this.getAttribute(t);return s===r?null:s===n?a:a=e(n=s,i)}}function _st(t,e,i){var n,r=i+"",a;return function(){var s=this.getAttributeNS(t.space,t.local);return s===r?null:s===n?a:a=e(n=s,i)}}function kst(t,e,i){var n,r,a;return function(){var s,o=i(this),l;return o==null?void this.removeAttribute(t):(s=this.getAttribute(t),l=o+"",s===l?null:s===n&&l===r?a:(r=l,a=e(n=s,o)))}}function xst(t,e,i){var n,r,a;return function(){var s,o=i(this),l;return o==null?void this.removeAttributeNS(t.space,t.local):(s=this.getAttributeNS(t.space,t.local),l=o+"",s===l?null:s===n&&l===r?a:(r=l,a=e(n=s,o)))}}function Ost(t,e){var i=k2(t),n=i==="transform"?vst:yEe;return this.attrTween(t,typeof e=="function"?(i.local?xst:kst)(i,n,OY(this,"attr."+t,e)):e==null?(i.local?Nst:Mst)(i):(i.local?_st:Ast)(i,n,e))}function Lst(t,e){return function(i){this.setAttribute(t,e.call(this,i))}}function Fst(t,e){return function(i){this.setAttributeNS(t.space,t.local,e.call(this,i))}}function $st(t,e){var i,n;function r(){var a=e.apply(this,arguments);return a!==n&&(i=(n=a)&&Fst(t,a)),i}return r._value=e,r}function Bst(t,e){var i,n;function r(){var a=e.apply(this,arguments);return a!==n&&(i=(n=a)&&Lst(t,a)),i}return r._value=e,r}function Vst(t,e){var i="attr."+t;if(arguments.length<2)return(i=this.tween(i))&&i._value;if(e==null)return this.tween(i,null);if(typeof e!="function")throw new Error;var n=k2(t);return this.tween(i,(n.local?$st:Bst)(n,e))}function jst(t,e){return function(){xY(this,t).delay=+e.apply(this,arguments)}}function Gst(t,e){return e=+e,function(){xY(this,t).delay=e}}function Hst(t){var e=this._id;return arguments.length?this.each((typeof t=="function"?jst:Gst)(e,t)):af(this.node(),e).delay}function zst(t,e){return function(){sv(this,t).duration=+e.apply(this,arguments)}}function qst(t,e){return e=+e,function(){sv(this,t).duration=e}}function Wst(t){var e=this._id;return arguments.length?this.each((typeof t=="function"?zst:qst)(e,t)):af(this.node(),e).duration}function Yst(t,e){if(typeof e!="function")throw new Error;return function(){sv(this,t).ease=e}}function Kst(t){var e=this._id;return arguments.length?this.each(Yst(e,t)):af(this.node(),e).ease}function Zst(t){typeof t!="function"&&(t=XDe(t));for(var e=this._groups,i=e.length,n=new Array(i),r=0;r<i;++r)for(var a=e[r],s=a.length,o=n[r]=[],l,c=0;c<s;++c)(l=a[c])&&t.call(l,l.__data__,c,a)&&o.push(l);return new Ng(n,this._parents,this._name,this._id)}function Xst(t){if(t._id!==this._id)throw new Error;for(var e=this._groups,i=t._groups,n=e.length,r=i.length,a=Math.min(n,r),s=new Array(n),o=0;o<a;++o)for(var l=e[o],c=i[o],u=l.length,d=s[o]=new Array(u),p,h=0;h<u;++h)(p=l[h]||c[h])&&(d[h]=p);for(;o<n;++o)s[o]=e[o];return new Ng(s,this._parents,this._name,this._id)}function Jst(t){return(t+"").trim().split(/^|\s+/).every(function(e){var i=e.indexOf(".");return i>=0&&(e=e.slice(0,i)),!e||e==="start"})}function Qst(t,e,i){var n,r,a=Jst(e)?xY:sv;return function(){var s=a(this,t),o=s.on;o!==n&&(r=(n=o).copy()).on(e,i),s.on=r}}function eot(t,e){var i=this._id;return arguments.length<2?af(this.node(),i).on.on(t):this.each(Qst(i,t,e))}function tot(t){return function(){var e=this.parentNode;for(var i in this.__transition)if(+i!==t)return;e&&e.removeChild(this)}}function iot(){return this.on("end.remove",tot(this._id))}function not(t){var e=this._name,i=this._id;typeof t!="function"&&(t=AY(t));for(var n=this._groups,r=n.length,a=new Array(r),s=0;s<r;++s)for(var o=n[s],l=o.length,c=a[s]=new Array(l),u,d,p=0;p<l;++p)(u=o[p])&&(d=t.call(u,u.__data__,p,o))&&("__data__"in u&&(d.__data__=u.__data__),c[p]=d,L2(c[p],e,i,p,c,af(u,i)));return new Ng(a,this._parents,e,i)}function rot(t){var e=this._name,i=this._id;typeof t!="function"&&(t=ZDe(t));for(var n=this._groups,r=n.length,a=[],s=[],o=0;o<r;++o)for(var l=n[o],c=l.length,u,d=0;d<c;++d)if(u=l[d]){for(var p=t.call(u,u.__data__,d,l),h,f=af(u,i),m=0,g=p.length;m<g;++m)(h=p[m])&&L2(h,e,i,m,p,f);a.push(p),s.push(u)}return new Ng(a,s,e,i)}var aot=wM.prototype.constructor;function sot(){return new aot(this._groups,this._parents)}function oot(t,e){var i,n,r;return function(){var a=AT(this,t),s=(this.style.removeProperty(t),AT(this,t));return a===s?null:a===i&&s===n?r:r=e(i=a,n=s)}}function bEe(t){return function(){this.style.removeProperty(t)}}function lot(t,e,i){var n,r=i+"",a;return function(){var s=AT(this,t);return s===r?null:s===n?a:a=e(n=s,i)}}function cot(t,e,i){var n,r,a;return function(){var s=AT(this,t),o=i(this),l=o+"";return o==null&&(l=o=(this.style.removeProperty(t),AT(this,t))),s===l?null:s===n&&l===r?a:(r=l,a=e(n=s,o))}}function uot(t,e){var i,n,r,a="style."+e,s="end."+a,o;return function(){var l=sv(this,t),c=l.on,u=l.value[a]==null?o||(o=bEe(e)):void 0;(c!==i||r!==u)&&(n=(i=c).copy()).on(s,r=u),l.on=n}}function dot(t,e,i){var n=(t+="")=="transform"?gst:yEe;return e==null?this.styleTween(t,oot(t,n)).on("end.style."+t,bEe(t)):typeof e=="function"?this.styleTween(t,cot(t,n,OY(this,"style."+t,e))).each(uot(this._id,t)):this.styleTween(t,lot(t,n,e),i).on("end.style."+t,null)}function pot(t,e,i){return function(n){this.style.setProperty(t,e.call(this,n),i)}}function hot(t,e,i){var n,r;function a(){var s=e.apply(this,arguments);return s!==r&&(n=(r=s)&&pot(t,s,i)),n}return a._value=e,a}function fot(t,e,i){var n="style."+(t+="");if(arguments.length<2)return(n=this.tween(n))&&n._value;if(e==null)return this.tween(n,null);if(typeof e!="function")throw new Error;return this.tween(n,hot(t,e,i??""))}function mot(t){return function(){this.textContent=t}}function got(t){return function(){var e=t(this);this.textContent=e??""}}function vot(t){return this.tween("text",typeof t=="function"?got(OY(this,"text",t)):mot(t==null?"":t+""))}function yot(t){return function(e){this.textContent=t.call(this,e)}}function bot(t){var e,i;function n(){var r=t.apply(this,arguments);return r!==i&&(e=(i=r)&&yot(r)),e}return n._value=t,n}function Iot(t){var e="text";if(arguments.length<1)return(e=this.tween(e))&&e._value;if(t==null)return this.tween(e,null);if(typeof t!="function")throw new Error;return this.tween(e,bot(t))}function wot(){for(var t=this._name,e=this._id,i=IEe(),n=this._groups,r=n.length,a=0;a<r;++a)for(var s=n[a],o=s.length,l,c=0;c<o;++c)if(l=s[c]){var u=af(l,e);L2(l,t,i,c,s,{time:u.time+u.delay+u.duration,delay:0,duration:u.duration,ease:u.ease})}return new Ng(n,this._parents,t,i)}function Sot(){var t,e,i=this,n=i._id,r=i.size();return new Promise(function(a,s){var o={value:s},l={value:function(){--r===0&&a()}};i.each(function(){var c=sv(this,n),u=c.on;u!==t&&(e=(t=u).copy(),e._.cancel.push(o),e._.interrupt.push(o),e._.end.push(l)),c.on=e})})}var Tot=0;function Ng(t,e,i,n){this._groups=t,this._parents=e,this._name=i,this._id=n}function IEe(){return++Tot}var M0=wM.prototype;Ng.prototype={constructor:Ng,select:not,selectAll:rot,filter:Zst,merge:Xst,selection:sot,transition:wot,call:M0.call,nodes:M0.nodes,node:M0.node,size:M0.size,empty:M0.empty,each:M0.each,on:eot,attr:Ost,attrTween:Vst,style:dot,styleTween:fot,text:vot,textTween:Iot,remove:iot,tween:Rst,delay:Hst,duration:Wst,ease:Kst,end:Sot};function Uot(t){return((t*=2)<=1?t*t*t:(t-=2)*t*t+2)/2}var SH={time:null,delay:0,duration:250,ease:Uot};function Dot(t,e){for(var i;!(i=t.__transition)||!(i=i[e]);)if(!(t=t.parentNode))return SH.time=O2(),SH;return i}function Eot(t){var e,i;t instanceof Ng?(e=t._id,t=t._name):(e=IEe(),(i=SH).time=O2(),t=t==null?null:t+"");for(var n=this._groups,r=n.length,a=0;a<r;++a)for(var s=n[a],o=s.length,l,c=0;c<o;++c)(l=s[c])&&L2(l,t,e,c,s,i||Dot(l,e));return new Ng(n,this._parents,t,e)}wM.prototype.interrupt=Est;wM.prototype.transition=Eot;var ep="$";function Ek(){}Ek.prototype=wEe.prototype={constructor:Ek,has:function(t){return ep+t in this},get:function(t){return this[ep+t]},set:function(t,e){return this[ep+t]=e,this},remove:function(t){var e=ep+t;return e in this&&delete this[e]},clear:function(){for(var t in this)t[0]===ep&&delete this[t]},keys:function(){var t=[];for(var e in this)e[0]===ep&&t.push(e.slice(1));return t},values:function(){var t=[];for(var e in this)e[0]===ep&&t.push(this[e]);return t},entries:function(){var t=[];for(var e in this)e[0]===ep&&t.push({key:e.slice(1),value:this[e]});return t},size:function(){var t=0;for(var e in this)e[0]===ep&&++t;return t},empty:function(){for(var t in this)if(t[0]===ep)return!1;return!0},each:function(t){for(var e in this)e[0]===ep&&t(this[e],e.slice(1),this)}};function wEe(t,e){var i=new Ek;if(t instanceof Ek)t.each(function(o,l){i.set(l,o)});else if(Array.isArray(t)){var n=-1,r=t.length,a;if(e==null)for(;++n<r;)i.set(n,t[n]);else for(;++n<r;)i.set(e(a=t[n],n,t),a)}else if(t)for(var s in t)i.set(s,t[s]);return i}function Cee(){}var gb=wEe.prototype;Cee.prototype={constructor:Cee,has:gb.has,add:function(t){return t+="",this[ep+t]=t,this},remove:gb.remove,clear:gb.clear,values:gb.keys,size:gb.size,empty:gb.empty,each:gb.each};function p1(){return Math.random()}(function t(e){function i(n,r){return n=n==null?0:+n,r=r==null?1:+r,arguments.length===1?(r=n,n=0):r-=n,function(){return e()*r+n}}return i.source=t,i})(p1);const Pot=function t(e){function i(n,r){var a,s;return n=n==null?0:+n,r=r==null?1:+r,function(){var o;if(a!=null)o=a,a=null;else do a=e()*2-1,o=e()*2-1,s=a*a+o*o;while(!s||s>1);return n+r*o*Math.sqrt(-2*Math.log(s)/s)}}return i.source=t,i}(p1);(function t(e){function i(){var n=Pot.source(e).apply(this,arguments);return function(){return Math.exp(n())}}return i.source=t,i})(p1);const Cot=function t(e){function i(n){return function(){for(var r=0,a=0;a<n;++a)r+=e();return r}}return i.source=t,i}(p1);(function t(e){function i(n){var r=Cot.source(e)(n);return function(){return r()/n}}return i.source=t,i})(p1);(function t(e){function i(n){return function(){return-Math.log(1-e())/n}}return i.source=t,i})(p1);function Pk(){this._=null}function F2(t){t.U=t.C=t.L=t.R=t.P=t.N=null}Pk.prototype={constructor:Pk,insert:function(t,e){var i,n,r;if(t){if(e.P=t,e.N=t.N,t.N&&(t.N.P=e),t.N=e,t.R){for(t=t.R;t.L;)t=t.L;t.L=e}else t.R=e;i=t}else this._?(t=Ree(this._),e.P=null,e.N=t,t.P=t.L=e,i=t):(e.P=e.N=null,this._=e,i=null);for(e.L=e.R=null,e.U=i,e.C=!0,t=e;i&&i.C;)n=i.U,i===n.L?(r=n.R,r&&r.C?(i.C=r.C=!1,n.C=!0,t=n):(t===i.R&&(x1(this,i),t=i,i=t.U),i.C=!1,n.C=!0,O1(this,n))):(r=n.L,r&&r.C?(i.C=r.C=!1,n.C=!0,t=n):(t===i.L&&(O1(this,i),t=i,i=t.U),i.C=!1,n.C=!0,x1(this,n))),i=t.U;this._.C=!1},remove:function(t){t.N&&(t.N.P=t.P),t.P&&(t.P.N=t.N),t.N=t.P=null;var e=t.U,i,n=t.L,r=t.R,a,s;if(n?r?a=Ree(r):a=n:a=r,e?e.L===t?e.L=a:e.R=a:this._=a,n&&r?(s=a.C,a.C=t.C,a.L=n,n.U=a,a!==r?(e=a.U,a.U=t.U,t=a.R,e.L=t,a.R=r,r.U=a):(a.U=e,e=a,t=a.R)):(s=t.C,t=a),t&&(t.U=e),!s){if(t&&t.C){t.C=!1;return}do{if(t===this._)break;if(t===e.L){if(i=e.R,i.C&&(i.C=!1,e.C=!0,x1(this,e),i=e.R),i.L&&i.L.C||i.R&&i.R.C){(!i.R||!i.R.C)&&(i.L.C=!1,i.C=!0,O1(this,i),i=e.R),i.C=e.C,e.C=i.R.C=!1,x1(this,e),t=this._;break}}else if(i=e.L,i.C&&(i.C=!1,e.C=!0,O1(this,e),i=e.L),i.L&&i.L.C||i.R&&i.R.C){(!i.L||!i.L.C)&&(i.R.C=!1,i.C=!0,x1(this,i),i=e.L),i.C=e.C,e.C=i.L.C=!1,O1(this,e),t=this._;break}i.C=!0,t=e,e=e.U}while(!t.C);t&&(t.C=!1)}}};function x1(t,e){var i=e,n=e.R,r=i.U;r?r.L===i?r.L=n:r.R=n:t._=n,n.U=r,i.U=n,i.R=n.L,i.R&&(i.R.U=i),n.L=i}function O1(t,e){var i=e,n=e.L,r=i.U;r?r.L===i?r.L=n:r.R=n:t._=n,n.U=r,i.U=n,i.L=n.R,i.L&&(i.L.U=i),n.R=i}function Ree(t){for(;t.L;)t=t.L;return t}function X1(t,e,i,n){var r=[null,null],a=ql.push(r)-1;return r.left=t,r.right=e,i&&Ck(r,t,e,i),n&&Ck(r,e,t,n),bd[t.index].halfedges.push(a),bd[e.index].halfedges.push(a),r}function L1(t,e,i){var n=[e,i];return n.left=t,n}function Ck(t,e,i,n){!t[0]&&!t[1]?(t[0]=n,t.left=e,t.right=i):t.left===i?t[1]=n:t[0]=n}function Rot(t,e,i,n,r){var a=t[0],s=t[1],o=a[0],l=a[1],c=s[0],u=s[1],d=0,p=1,h=c-o,f=u-l,m;if(m=e-o,!(!h&&m>0)){if(m/=h,h<0){if(m<d)return;m<p&&(p=m)}else if(h>0){if(m>p)return;m>d&&(d=m)}if(m=n-o,!(!h&&m<0)){if(m/=h,h<0){if(m>p)return;m>d&&(d=m)}else if(h>0){if(m<d)return;m<p&&(p=m)}if(m=i-l,!(!f&&m>0)){if(m/=f,f<0){if(m<d)return;m<p&&(p=m)}else if(f>0){if(m>p)return;m>d&&(d=m)}if(m=r-l,!(!f&&m<0)){if(m/=f,f<0){if(m>p)return;m>d&&(d=m)}else if(f>0){if(m<d)return;m<p&&(p=m)}return!(d>0)&&!(p<1)||(d>0&&(t[0]=[o+d*h,l+d*f]),p<1&&(t[1]=[o+p*h,l+p*f])),!0}}}}}function Mot(t,e,i,n,r){var a=t[1];if(a)return!0;var s=t[0],o=t.left,l=t.right,c=o[0],u=o[1],d=l[0],p=l[1],h=(c+d)/2,f=(u+p)/2,m,g;if(p===u){if(h<e||h>=n)return;if(c>d){if(!s)s=[h,i];else if(s[1]>=r)return;a=[h,r]}else{if(!s)s=[h,r];else if(s[1]<i)return;a=[h,i]}}else if(m=(c-d)/(p-u),g=f-m*h,m<-1||m>1)if(c>d){if(!s)s=[(i-g)/m,i];else if(s[1]>=r)return;a=[(r-g)/m,r]}else{if(!s)s=[(r-g)/m,r];else if(s[1]<i)return;a=[(i-g)/m,i]}else if(u<p){if(!s)s=[e,m*e+g];else if(s[0]>=n)return;a=[n,m*n+g]}else{if(!s)s=[n,m*n+g];else if(s[0]<e)return;a=[e,m*e+g]}return t[0]=s,t[1]=a,!0}function Not(t,e,i,n){for(var r=ql.length,a;r--;)(!Mot(a=ql[r],t,e,i,n)||!Rot(a,t,e,i,n)||!(Math.abs(a[0][0]-a[1][0])>ns||Math.abs(a[0][1]-a[1][1])>ns))&&delete ql[r]}function Aot(t){return bd[t.index]={site:t,halfedges:[]}}function _ot(t,e){var i=t.site,n=e.left,r=e.right;return i===r&&(r=n,n=i),r?Math.atan2(r[1]-n[1],r[0]-n[0]):(i===n?(n=e[1],r=e[0]):(n=e[0],r=e[1]),Math.atan2(n[0]-r[0],r[1]-n[1]))}function SEe(t,e){return e[+(e.left!==t.site)]}function kot(t,e){return e[+(e.left===t.site)]}function xot(){for(var t=0,e=bd.length,i,n,r,a;t<e;++t)if((i=bd[t])&&(a=(n=i.halfedges).length)){var s=new Array(a),o=new Array(a);for(r=0;r<a;++r)s[r]=r,o[r]=_ot(i,ql[n[r]]);for(s.sort(function(l,c){return o[c]-o[l]}),r=0;r<a;++r)o[r]=n[s[r]];for(r=0;r<a;++r)n[r]=o[r]}}function Oot(t,e,i,n){var r=bd.length,a,s,o,l,c,u,d,p,h,f,m,g,v=!0;for(a=0;a<r;++a)if(s=bd[a]){for(o=s.site,c=s.halfedges,l=c.length;l--;)ql[c[l]]||c.splice(l,1);for(l=0,u=c.length;l<u;)f=kot(s,ql[c[l]]),m=f[0],g=f[1],d=SEe(s,ql[c[++l%u]]),p=d[0],h=d[1],(Math.abs(m-p)>ns||Math.abs(g-h)>ns)&&(c.splice(l,0,ql.push(L1(o,f,Math.abs(m-t)<ns&&n-g>ns?[t,Math.abs(p-t)<ns?h:n]:Math.abs(g-n)<ns&&i-m>ns?[Math.abs(h-n)<ns?p:i,n]:Math.abs(m-i)<ns&&g-e>ns?[i,Math.abs(p-i)<ns?h:e]:Math.abs(g-e)<ns&&m-t>ns?[Math.abs(h-e)<ns?p:t,e]:null))-1),++u);u&&(v=!1)}if(v){var y,b,I,T=1/0;for(a=0,v=null;a<r;++a)(s=bd[a])&&(o=s.site,y=o[0]-t,b=o[1]-e,I=y*y+b*b,I<T&&(T=I,v=s));if(v){var w=[t,e],S=[t,n],U=[i,n],P=[i,e];v.halfedges.push(ql.push(L1(o=v.site,w,S))-1,ql.push(L1(o,S,U))-1,ql.push(L1(o,U,P))-1,ql.push(L1(o,P,w))-1)}}for(a=0;a<r;++a)(s=bd[a])&&(s.halfedges.length||delete bd[a])}var TEe=[],LY;function Lot(){F2(this),this.x=this.y=this.arc=this.site=this.cy=null}function aS(t){var e=t.P,i=t.N;if(!(!e||!i)){var n=e.site,r=t.site,a=i.site;if(n!==a){var s=r[0],o=r[1],l=n[0]-s,c=n[1]-o,u=a[0]-s,d=a[1]-o,p=2*(l*d-c*u);if(!(p>=-jot)){var h=l*l+c*c,f=u*u+d*d,m=(d*h-c*f)/p,g=(l*f-u*h)/p,v=TEe.pop()||new Lot;v.arc=t,v.site=r,v.x=m+s,v.y=(v.cy=g+o)+Math.sqrt(m*m+g*g),t.circle=v;for(var y=null,b=hP._;b;)if(v.y<b.y||v.y===b.y&&v.x<=b.x)if(b.L)b=b.L;else{y=b.P;break}else if(b.R)b=b.R;else{y=b;break}hP.insert(y,v),y||(LY=v)}}}}function IS(t){var e=t.circle;e&&(e.P||(LY=e.N),hP.remove(e),TEe.push(e),F2(e),t.circle=null)}var UEe=[];function Fot(){F2(this),this.edge=this.site=this.circle=null}function Mee(t){var e=UEe.pop()||new Fot;return e.site=t,e}function PB(t){IS(t),wS.remove(t),UEe.push(t),F2(t)}function $ot(t){var e=t.circle,i=e.x,n=e.cy,r=[i,n],a=t.P,s=t.N,o=[t];PB(t);for(var l=a;l.circle&&Math.abs(i-l.circle.x)<ns&&Math.abs(n-l.circle.cy)<ns;)a=l.P,o.unshift(l),PB(l),l=a;o.unshift(l),IS(l);for(var c=s;c.circle&&Math.abs(i-c.circle.x)<ns&&Math.abs(n-c.circle.cy)<ns;)s=c.N,o.push(c),PB(c),c=s;o.push(c),IS(c);var u=o.length,d;for(d=1;d<u;++d)c=o[d],l=o[d-1],Ck(c.edge,l.site,c.site,r);l=o[0],c=o[u-1],c.edge=X1(l.site,c.site,null,r),aS(l),aS(c)}function Bot(t){for(var e=t[0],i=t[1],n,r,a,s,o=wS._;o;)if(a=DEe(o,i)-e,a>ns)o=o.L;else if(s=e-Vot(o,i),s>ns){if(!o.R){n=o;break}o=o.R}else{a>-ns?(n=o.P,r=o):s>-ns?(n=o,r=o.N):n=r=o;break}Aot(t);var l=Mee(t);if(wS.insert(n,l),!(!n&&!r)){if(n===r){IS(n),r=Mee(n.site),wS.insert(l,r),l.edge=r.edge=X1(n.site,l.site),aS(n),aS(r);return}if(!r){l.edge=X1(n.site,l.site);return}IS(n),IS(r);var c=n.site,u=c[0],d=c[1],p=t[0]-u,h=t[1]-d,f=r.site,m=f[0]-u,g=f[1]-d,v=2*(p*g-h*m),y=p*p+h*h,b=m*m+g*g,I=[(g*y-h*b)/v+u,(p*b-m*y)/v+d];Ck(r.edge,c,f,I),l.edge=X1(c,t,null,I),r.edge=X1(t,f,null,I),aS(n),aS(r)}}function DEe(t,e){var i=t.site,n=i[0],r=i[1],a=r-e;if(!a)return n;var s=t.P;if(!s)return-1/0;i=s.site;var o=i[0],l=i[1],c=l-e;if(!c)return o;var u=o-n,d=1/a-1/c,p=u/c;return d?(-p+Math.sqrt(p*p-2*d*(u*u/(-2*c)-l+c/2+r-a/2)))/d+n:(n+o)/2}function Vot(t,e){var i=t.N;if(i)return DEe(i,e);var n=t.site;return n[1]===e?n[0]:1/0}var ns=1e-6,jot=1e-12,wS,bd,hP,ql;function Got(t,e,i){return(t[0]-i[0])*(e[1]-t[1])-(t[0]-e[0])*(i[1]-t[1])}function Hot(t,e){return e[1]-t[1]||e[0]-t[0]}function Nee(t,e){var i=t.sort(Hot).pop(),n,r,a;for(ql=[],bd=new Array(t.length),wS=new Pk,hP=new Pk;;)if(a=LY,i&&(!a||i[1]<a.y||i[1]===a.y&&i[0]<a.x))(i[0]!==n||i[1]!==r)&&(Bot(i),n=i[0],r=i[1]),i=t.pop();else if(a)$ot(a.arc);else break;if(xot(),e){var s=+e[0][0],o=+e[0][1],l=+e[1][0],c=+e[1][1];Not(s,o,l,c),Oot(s,o,l,c)}this.edges=ql,this.cells=bd,wS=hP=ql=bd=null}Nee.prototype={constructor:Nee,polygons:function(){var t=this.edges;return this.cells.map(function(e){var i=e.halfedges.map(function(n){return SEe(e,t[n])});return i.data=e.site.data,i})},triangles:function(){var t=[],e=this.edges;return this.cells.forEach(function(i,n){if(o=(a=i.halfedges).length)for(var r=i.site,a,s=-1,o,l,c=e[a[o-1]],u=c.left===r?c.right:c.left;++s<o;)l=u,c=e[a[s]],u=c.left===r?c.right:c.left,l&&u&&n<l.index&&n<u.index&&Got(r,l,u)<0&&t.push([r.data,l.data,u.data])}),t},links:function(){return this.edges.filter(function(t){return t.right}).map(function(t){return{source:t.left.data,target:t.right.data}})},find:function(t,e,i){for(var n=this,r,a=n._found||0,s=n.cells.length,o;!(o=n.cells[a]);)if(++a>=s)return null;var l=t-o.site[0],c=e-o.site[1],u=l*l+c*c;do o=n.cells[r=a],a=null,o.halfedges.forEach(function(d){var p=n.edges[d],h=p.left;if(!((h===o.site||!h)&&!(h=p.right))){var f=t-h[0],m=e-h[1],g=f*f+m*m;g<u&&(u=g,a=h.index)}});while(a!==null);return n._found=r,i==null||u<=i*i?o.site:null}};function J1(t,e,i){this.k=t,this.x=e,this.y=i}J1.prototype={constructor:J1,scale:function(t){return t===1?this:new J1(this.k*t,this.x,this.y)},translate:function(t,e){return t===0&e===0?this:new J1(this.k,this.x+this.k*t,this.y+this.k*e)},apply:function(t){return[t[0]*this.k+this.x,t[1]*this.k+this.y]},applyX:function(t){return t*this.k+this.x},applyY:function(t){return t*this.k+this.y},invert:function(t){return[(t[0]-this.x)/this.k,(t[1]-this.y)/this.k]},invertX:function(t){return(t-this.x)/this.k},invertY:function(t){return(t-this.y)/this.k},rescaleX:function(t){return t.copy().domain(t.range().map(this.invertX,this).map(t.invert,t))},rescaleY:function(t){return t.copy().domain(t.range().map(this.invertY,this).map(t.invert,t))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};J1.prototype;const zot=function(){let t={};t.jsonTODS=i=>{let n={bestOf:e(i.max_sets)};if(i.max_sets&&parseInt(i.max_sets)===1&&i.final_set_supertiebreak)n.setFormat={tiebreakSet:{tiebreakTo:i.supertiebreak_to}};else{const r=e(i.games_for_set),a=e(i.tiereaks_at),s=a>r?r:a;n.setFormat={setTo:r,tiebreakAt:s,tiebreakFormat:{tiebreakTo:e(i.tiebreak_to)}},i.final_set_supertiebreak&&(n.finalSetFormat={tiebreakSet:{tiebreakTo:i.supertiebreak_to}})}return n};function e(i){return!isNaN(Number(i))&&Number(i)}return t}(),EEe=function(){let t={};function e(s,o){let l=parseInt(s);return isNaN(l)?o:l}function i({source:s={},objects:o=[]}){let l=Object.assign({},s);return o&&!Array.isArray(o)&&(o=[o]),o=o.filter(c=>c),o.forEach(c=>{if(typeof c!="object")return;Object.keys(c).forEach(d=>l[d]=l[d]!==void 0?l[d]:c[d])}),l}t.setsToWin=s=>s&&Math.ceil(s/2)||1,t.tiebreakTo=(s,o)=>{var u,d,p,h;let l=(d=(u=s==null?void 0:s.setFormat)==null?void 0:u.tiebreakFormat)==null?void 0:d.tiebreakTo,c=(h=(p=s==null?void 0:s.finalSetFormat)==null?void 0:p.tiebreakFormat)==null?void 0:h.tiebreakTo;return o?c:l},t.matchFormat=n;function n(s){return(s||"SET3-S:6/TB7").slice(3)}t.getExistingScores=({match:s})=>{if(s!=null&&s.score)return r({string_score:s.score,winner_index:s.winner_index,matchFormat:s.matchFormat})},t.generateMatchFormat=({cfg_obj:s})=>{let o=s.bestof.ddlb.getValue(),l=e(o),c=EEe.setsToWin(l),u={max_sets:l,sets_to_win:c,games_for_set:e(s.setsto.ddlb.getValue()),tiebreaks_at:e(s.tiebreaksat.ddlb.getValue())||"",tiebreak_to:e(s.tiebreaksto.ddlb.getValue()),supertiebreak_to:e(s.supertiebreakto.ddlb.getValue()),final_set_supertiebreak:s.finalset.ddlb.getValue()!=="N"};return{matchFormat:Zf.stringify(zot.jsonTODS(u)),score_format:u}},t.getScoringFormat=({e:s,match:o})=>{var u,d;let l=(o==null?void 0:o.format)||((s==null?void 0:s.format)==="D"?"doubles":"singles"),c=[o==null?void 0:o.score_format,(u=o==null?void 0:o.match)==null?void 0:u.score_format,(d=s.scoring_format)==null?void 0:d[l],s.score_format];return i({objects:c})},t.defaultMatchFormat=({format:s,category:o,env:l})=>{let c=l.scoreboard.matchFormats,u={S:"singles",D:"doubles"};return Object.keys(u).indexOf(s)>=0&&(s=u[s]),s&&o&&c.categories[o]&&c.categories[o][s]?c.categories[o][s]:s&&c[s]?c[s]:c.singles},t.convertStringScore=r;function r({string_score:s,winner_index:o,split:l=" ",matchFormat:c}){if(!s)return[];s=o?a(s):s;let u=null,d=/(\d+)/,p=/(\d+)\((\d+)\)/,h=Zf.parse(c),f=s.split(l).filter(m=>m).map(m=>{if(m.indexOf("/")>0){let y=m.split("/").map(b=>d.exec(b)?{games:+d.exec(b)[1]}:void 0).filter(b=>b);if(y.length===2)return y}let g=null,v=m.split("-").map(y=>{let b;return p.test(y)?(g=+p.exec(y)[2],b={games:+p.exec(y)[1]}):d.test(y)?b={games:+d.exec(y)[1]}:u=y,b||void 0});if(v=v.filter(y=>y),g!==null){let y=Math.min(...v.map(b=>b.games));v.forEach(b=>{+b.games==+y?b.tiebreak=g:b.spacer=g})}return v});if(f=f.filter(m=>m&&m.length===2),f.forEach(m=>{var y;let g=h&&(h.finalSetFormat||h.setFormat),v=(y=g==null?void 0:g.tiebreakSet)==null?void 0:y.tiebreakTo;(m[0].games>=v||m[1].games>=v)&&(m[0].supertiebreak=m[0].games,m[1].supertiebreak=m[1].games,delete m[0].games,delete m[1].games)}),o!==void 0&&(f.winner_index=o),u){if(u==="Cancelled"&&(f.cancelled=!0),u==="Abandoned"&&(f.abandoned=!0),u==="INC."&&(f.incomplete=!0),u==="INT."&&(f.interrupted=!0),u==="LIVE"&&(f.live=!0),u==="TIME"&&(f.time=!0),u==="DEF."&&(f.default=!0),u==="W.O."&&(f.walkover=!0),!f.length)return f;o!==void 0&&(f[f.length-1][1-o].outcome=u,f[f.length-1].outcome=u,f.outome=u)}return f}t.reverseScore=a;function a(s,o=" "){let l=null;if(s){let d=s.split(o).map(c).join(o);return l?`${l} ${d}`:d}function c(d){let p=d.indexOf("/")>0?"/":"-",h=d.split(p).map(u).reverse().filter(y=>y),f=h.map(y=>y.games),m=h.map(y=>y.tiebreak).filter(y=>y),g=m.length===1?`(${m[0]})`:"";return`${m.length<2?f.join(p):f.map((y,b)=>`${y}(${m[b]})`).join(p)}${g}`}function u(d){let p=/(\d+)/,h=/(\d+)\((\d+)\)/;if(h.test(d))return{games:h.exec(d)[1],tiebreak:h.exec(d)[2]};if(p.test(d))return{games:p.exec(d)[1]};l=d}}return t}(),io=function(){let t={};function e(l,c){let u=1;if(Array.from(l.classList).indexOf(c)>=0)return{elem:l,depth:u};for(;l.parentNode;){if(l=l.parentNode,l.classList&&Array.from(l.classList).indexOf(c)>=0)return{elem:l,depth:u};u+=1}return{elem:null,depth:0}}const i="span:first-of-type";t.DropDown=n;function n({element:l,onChange:c,css_class:u,id:d,locked:p,max:h,maxFx:f,value_attribute:m=!0,background:g}){var v,y,b,I,T;!l&&d&&(l=document.getElementById(d)),this.id=d,this.val="",this.max=h,this.maxFx=f,this.el=l,this.locked=p,this.background=g||"",this.bordercolor="",this.labelcolor="#000",this.class=u,this.value_attribute=m,this.list=(v=this.el)==null?void 0:v.querySelector(".dd_state"),this.options=(y=this.el)==null?void 0:y.querySelector(".options"),this.label=(b=this.el)==null?void 0:b.querySelector("div:first-of-type"),this.opts=((I=this.list)==null?void 0:I.querySelectorAll("li"))||[],this.selection=((T=this.list)==null?void 0:T.querySelector(i))||void 0,typeof c=="function"&&(this.onChange=c),this.initEvents()}function r(l){l.el&&(l.el.ddclick||(l.el.ddclick=!0,l.el.addEventListener("click",c=>{if(l.locked)return;let{elem:u,depth:d}=e(c.target,"dd_state"),{elem:p,depth:h}=e(c.target,"dd_option"),f=u&&Array.from(u.classList).indexOf("active")>=0;if(l.max&&!p&&l.opts&&l.opts.length>l.max&&l.maxFx&&typeof l.maxFx=="function"){l.maxFx(l.options);return}t.closeAllDropDowns(l.class),u&&(!h||d<h)&&u.classList[f?"remove":"add"]("active"),c.stopPropagation()})))}function a(l){Array.from(l.opts).forEach(c=>{c.addEventListener("click",()=>{l.list.classList.remove("active");let u=c.querySelector(i),d=u.getAttribute("value");l.selection.innerHTML=u.innerHTML;let p=l.val!=d;l.val=d,p&&l.onChange&&(l.onChange(d),l.selectionBackground(),l.labelColor())})})}function s(l,c){return`<li class='dd_option' title='${l.title||""}'><span value="${l.value}" style="${c||""}">${l.key}</span></li>`}n.prototype={initEvents(){let l=this;r(l),a(l)},getLabel(){return this.selection.innerHTML},getValue(){return this.val},setId(l){this.id=l},getId(){return this.id},lock(){this.locked=!0},unlock(){this.locked=!1},setOptions(l,c=""){if(!Array.isArray(l)||!l.length||!this.list)return;let u=this.list.querySelector("ul");if(u)return this.max&&l&&l.length>this.max&&t.closeAllDropDowns(this.class),u.innerHTML=l.map(d=>s(d,c)).join(""),this.options=l,this.opts=this.list.querySelectorAll("li"),a(this),this},getOptions(){return Array.from(this.opts).map(l=>{let c=l.querySelector(i);return{key:c.innerHTML,value:c.getAttribute("value")}})},setLabel(l,c,u,d){this.selection&&(this.selection.innerHTML=l,this.selectionBackground(c),this.labelColor(u),this.borderColor(d))},setValue(l,c,u,d){let p=Array.from(this.opts).filter(f=>f.querySelector(i).getAttribute("value")==l),h=p.length?p[0].querySelector("span").innerHTML:l;this.val=l,this.selection&&(this.selection.innerHTML=h,this.selectionBackground(c),this.labelColor(u),this.borderColor(d))},selectionBackground(l){this.selection&&(l&&(this.background=l),this.background?(this.selection.classList.remove("novalue"),this.selection.classList.remove("hasvalue"),this.selection.style.background=this.background):this.locked?(this.value_attribute&&this.selection.classList.add("hasvalue"),this.selection.classList.remove("novalue")):this.val?(this.selection.style.background="",this.value_attribute&&this.selection.classList.add("hasvalue"),this.selection.classList.remove("novalue")):(this.selection.style.background="",this.selection.classList.add("novalue"),this.selection.classList.remove("hasvalue")))},labelColor(l){l&&(this.labelcolor=l),this.label.style.color=this.labelcolor},borderColor(l){l&&(this.bordercolor=l),this.bordercolor&&this.options&&this.options.style&&(this.options.style.border=`1px solid ${this.bordercolor}`)}};let o=(l,c=[],u,d=!0,p,h)=>{let f=u!==void 0&&c[u]?c[u].key:"",m=d?"style='border: 1px solid #000;'":"",g=c.map(v=>s(v,p)).join("");return`
         <div class='dd-label'>${l}</div>
         <div class='options' ${m}>
            <ul>
               <li class='dd_state'>
                  <span class='active'>${f}</span>
                  <div>
                     <ul class='${h?"floatleft":""}'>
                     ${g}
                     </ul>
                  </div>
               </li>
            </ul>
         </div>`};return t.attachDropDown=({element:l,id:c,label:u="",options:d,selected:p=0,css_class:h,border:f,style:m,floatleft:g,display:v="flex"})=>{!c&&!l||(l=l||document.getElementById(c),l&&(l.style.display=v,l.classList.add(h||"dd"),l.innerHTML=o(u,d,p,f,m,g)))},t.closeAllDropDowns=()=>{let l=document.querySelectorAll("li.dd_state.active");Array.from(l).forEach(c=>{c.classList.remove("active")})},document.addEventListener("click",()=>t.closeAllDropDowns()),t}(),Aee=(t,e)=>{let i=parseInt(t);return isNaN(i)?e:i},_ee=1500;function kee({elem:t,type:e,duration:i=800,height:n=80,visible:r}){let a=Xat(t);s();function s(){let o=a.select("."+e),l=o.style("display"),c=l==="none"?"flex":"none";r===!0&&l==="none"||r===void 0&&c==="flex"?(o.style("height","0px"),o.style("display",c).transition().duration(i).style("height",`${n}px`)):(r===!1&&l==="flex"||r===void 0&&c==="none")&&o.transition().duration(i).style("height","0px").transition().duration(0).style("display","none")}}const qot=function(){let t={numericFx:void 0,enterFx:void 0};document.addEventListener("keyup",r=>{if(r.key&&r.key==="Enter"&&t.enterFx&&typeof t.enterFx=="function"&&t.enterFx(),r.key&&t.numericFx&&typeof t.numericFx=="function"){let a=["0","1","2","3","4","5","6","7","8","9"].indexOf(r.key),s=[")","!","@","#","$","%","^","&","*",")"].indexOf(r.key);a>=0?t.numericFx(a):s>=0&&t.numericFx(s,1)}});let e={},i={auto_score:!0},n={bestof:[1,3,5],setsto:[4,6,8],tiebreaksto:[5,7,12],supertiebreakto:[7,10,21]};return t.options=r=>{if(!r)return n;qDe(r,n)},t.setMatchScore=({auto_score:r=!0,existing_scores:a,matchFormat:s,round_name:o,callback:l,grouped:c,match:u,teams:d,muid:p,lock:h})=>{var Vt,Me,De,Je,St,bt;i.auto_score=r;let f={...i},m=Zf.parse(s||"SET3-S:6/TB7");if(!m)return;let g=(Vt=m==null?void 0:m.setFormat)==null?void 0:Vt.tiebreakAt,v=(Me=m==null?void 0:m.setFormat)==null?void 0:Me.setTo,y=m.bestOf,b=EEe.setsToWin(y),I=m.finalSetFormat||m.setFormat,T=(De=I==null?void 0:I.tiebreakSet)==null?void 0:De.tiebreakTo,w=(St=(Je=m==null?void 0:m.setFormat)==null?void 0:Je.tiebreakFormat)==null?void 0:St.tiebreakTo,S=(bt=m==null?void 0:m.finalSetFormat)==null?void 0:bt.tiebreakSet,U,P,E,R,C,M=Ert.display({muid:p,teams:d});M.details.element.style.display="none",o&&(M.round_name.element.innerHTML=o),M.details.element.innerHTML=Wot(u),M.scoring.element.style.display=h?"none":"inline",M.favorite.element.style.display=h?"inline":"none",p&&(e[p]=Ie=>{h||(R.length-Ie>1&&(R=R.slice(0,R.length-1),Ie=R.length-1,we()),Nt({selected_set:Ie}),_(!0),O(),M.scoring.element.style.display="inline",M.edit_scoring.element.style.display="inline")});let _=Ie=>{let Ue=Ie&&!h;C=Ue,kee({elem:M.actions.element,type:"edit",height:50,visible:Ue}),M.scoring.element.style.display=C||h?"none":"inline",M.edit_scoring.element.style.display=C?"none":"inline"};ct({sobj:M,changeFx:F}),W(),B(),Z(),k();const A=document.querySelectorAll(".setClick");for(const Ie of A){let Ue=Py(Ie,"set_number");if(Ue){let Oe=Ue.getAttribute("setnum"),Ee=Py(Ie,"muid").getAttribute("muid");Ie.addEventListener("click",()=>{e[Ee]&&typeof e[Ee]=="function"&&e[Ee](Oe)})}}function N(Ie){return Ie.map(Ue=>[{tiebreak:Ue.side1Score?Ue.side1TiebreakScore:void 0,supertiebreak:Ue.side1TiebreakScore,spacer:Ue.side1score,games:Ue.side1Score},{tiebreak:Ue.side2score?Ue.side2TiebreakScore:void 0,supertiebreak:Ue.side2TiebreakScore,spacer:Ue.side2score,games:Ue.side2Score}])}function k(){if(R=a?N(a):[],C=!1,E=!1,t.enterFx=()=>{C&&j()},O(),z(),U=Qe(!c)!==void 0?R.length:Math.max(0,R.length-1),a&&(Object.keys(a).length||a.length||a.walkover||a.default)){let Ue=R.length?R[R.length-1]:void 0;if(R.interrupted)M.p1action.ddlb.setValue(" "),M.p2action.ddlb.setValue("interrupted"),M.p1action.ddlb.lock(),M.p2action.ddlb.lock(),_(!0),Ue&&ie(Ue[0].games,Ue[1].games)&&(U+=1);else if(R.abandoned)M.p1action.ddlb.setValue(" "),M.p2action.ddlb.setValue("abandoned"),M.p1action.ddlb.lock(),M.p2action.ddlb.lock(),_(!0);else if(R.cancelled)M.p1action.ddlb.setValue(" "),M.p2action.ddlb.setValue("cancelled"),M.p1action.ddlb.lock(),M.p2action.ddlb.lock(),_(!0);else if(R.incomplete)M.p1action.ddlb.setValue(" "),M.p2action.ddlb.setValue("incomplete"),M.p1action.ddlb.lock(),M.p2action.ddlb.lock(),_(!0),Ue&&ie(Ue[0].games,Ue[1].games)&&(U+=1);else if(R.live)M.p1action.ddlb.setValue(" "),M.p2action.ddlb.setValue("live"),M.p1action.ddlb.lock(),M.p2action.ddlb.lock(),_(!0),Ue&&ie(Ue[0].games,Ue[1].games)&&(U+=1),f.auto_score=!1;else if(R.retired){let Oe=a.winner_index!==void 0?1-a.winner_index:void 0;M.p1action.ddlb.setValue(Oe===0?"retired":"winner"),M.p2action.ddlb.setValue(Oe===1?"retired":"winner"),M.p1action.ddlb.lock(),M.p2action.ddlb.lock(),_(!1),$(1-Oe)}else if(R.time){let Oe=a.winner_index!==void 0?1-a.winner_index:void 0;M.p1action.ddlb.setValue(Oe===0?"time":"winner"),M.p2action.ddlb.setValue(Oe===1?"time":"winner"),M.p1action.ddlb.lock(),M.p2action.ddlb.lock(),_(!1),$(1-Oe)}else if(R.default){let Oe=a.winner_index!==void 0?1-a.winner_index:void 0;M.p1action.ddlb.setValue(Oe===0?"defaulted":"winner"),M.p2action.ddlb.setValue(Oe===1?"defaulted":"winner"),M.p1action.ddlb.lock(),M.p2action.ddlb.lock(),_(!1),$(1-Oe)}else if(R.walkover){let Oe=a.winner_index!==void 0?1-a.winner_index:void 0;M.p1action.ddlb.setValue(Oe===0?"walkover":"winner"),M.p2action.ddlb.setValue(Oe===1?"walkover":"winner"),M.p1action.ddlb.lock(),M.p2action.ddlb.lock(),_(!0),$(1-Oe)}else _(!1)}else M.p1action.ddlb.setValue(" "),M.p2action.ddlb.setValue(" ");(R.time||R.retired||R.default||R.walkover)&&(U=void 0),Nt({selected_set:U,actions:!c})}function O(){Array.from(M.root.element.querySelectorAll(".victor")).forEach(Ue=>Ue.classList.remove("victor")),h||we()}function $(Ie){Array.from(M.root.element.querySelectorAll(`.opponent${Ie}`)).forEach(Ee=>Ee.classList.add("victor")),Array.from(M.root.element.querySelectorAll(`.opponent${Ie} .hasvalue`)).forEach(Ee=>Ee.classList.add("victor"))}function F(){O(),U=0,R=[],$e(),Ge(),z(),t.enterFx=void 0,M.p2action.ddlb.setValue(" "),M.p1action.ddlb.setValue(" "),f.auto_score=i.auto_score,Nt({selected_set:U})}function V(Ie){let Ue={bestOf:y,setFormat:{setTo:v,tiebreakAt:g,tiebreakFormat:{tiebreakTo:w}}};S&&(Ue.finalSetFormat={tiebreakSet:{tiebreakTo:T}});const Oe=Zf.stringify(Ue);if(Ie){const Ee=R.map((Xe,Et)=>_i.definedAttributes({side1TiebreakScore:Xe[0].supertiebreak,side2TiebreakScore:Xe[1].supertiebreak,side1score:Xe[0].games,side2score:Xe[1].games,setNumber:Et+1}));Ie.sets=Ee,Ie.set_scores=R,Ie.matchUpFormat=Oe}Ie&&typeof l=="function"&&l(Ie),t.numericFx=void 0,t.enterFx=void 0,document.body.style.overflow=null,AI()}function j(){t.numericFx=void 0,t.enterFx=void 0,Qe(),V(Ce())}function B(){M.cancel.element.addEventListener("click",()=>V(),!1),M.accept.element.addEventListener("click",j,!1),M.clear.element.addEventListener("click",F,!1),M.scoring.element.addEventListener("click",Ie,!1);function Ie(){let Oe=M.scoring.element.innerHTML==="-";Oe||(M.edit_scoring.element.style.overflow="hidden"),M.scoring.element.innerHTML=Oe?"&#x25A2;":"-",Ue(M.edit_scoring.element,Oe)}function Ue(Oe,Ee){let Xe=800;kee({elem:Oe,type:"edit",height:100,visible:Ee,duration:Xe}),Ee&&setTimeout(function(){Oe.style.overflow="visible"},Xe)}}function z(){let Ie=[{key:"-",value:""}],Ue=v===g?v+2:v+1;_i.generateRange(0,Ue).forEach(Fe=>Ie.push({key:Fe,value:Fe}));let Oe=Fe=>oe(0,Fe),Ee=Fe=>oe(1,Fe);io.attachDropDown({id:M.p1selector.id,options:Ie,border:!1}),io.attachDropDown({id:M.p2selector.id,options:Ie,border:!1}),M.p1selector.ddlb=new io.DropDown({element:M.p1selector.element,onChange:Oe,id:M.p1selector.id,value_attribute:!1}),M.p2selector.ddlb=new io.DropDown({element:M.p2selector.element,onChange:Ee,id:M.p2selector.id,value_attribute:!1}),h&&(M.p1selector.ddlb.lock(),M.p2selector.ddlb.lock()),M.p1selector.ddlb.selectionBackground(),M.p2selector.ddlb.selectionBackground();let Xe;t.numericFx=(Fe,ht=0)=>{Xe=new Date().getTime(),M.p1tiebreak.element.style.display==="none"&&Fe<Ue?(ht?M.p1selector.ddlb.setValue(Fe):M.p2selector.ddlb.setValue(Fe),oe(1-ht,Fe)):setTimeout(function(){Et()},_ee)};function Et(){if(new Date().getTime()-Xe>_ee){let ht=+M.p1tiebreak.element.value,ti=+M.p2tiebreak.element.value;(ht!=""||ti!="")&&(P?J(ht,ti):Q(ht,ti))}}}function W(){let Ie=[{key:" ",value:""},{key:"-",value:" "},{key:"RET.",value:"retired"},{key:"TIME",value:"time"},{key:"W.O.",value:"walkover"},{key:"DEF.",value:"defaulted"},{key:"INT.",value:"interrupted"},{key:"INC.",value:"incomplete"},{key:"CCL",value:"cancelled"},{key:"ABD",value:"abandoned"},{key:"LIVE",value:"live"},{key:`<div class='link'><img src='${Drt}' class='completed_icon'></div>`,value:"winner"}],Ue=Ee=>at(0,Ee),Oe=Ee=>at(1,Ee);io.attachDropDown({id:M.p1action.id,options:Ie,border:!1,floatleft:!0}),io.attachDropDown({id:M.p2action.id,options:Ie,border:!1,floatleft:!0}),M.p1action.ddlb=new io.DropDown({element:M.p1action.element,onChange:Ue,id:M.p1action.id}),M.p2action.ddlb=new io.DropDown({element:M.p2action.element,onChange:Oe,id:M.p2action.id}),h&&(M.p1action.ddlb.lock(),M.p2action.ddlb.lock()),M.p1action.ddlb.selectionBackground(),M.p2action.ddlb.selectionBackground()}function Z(){let Ie=Oe=>K(Oe,0),Ue=Oe=>K(Oe,1);M.p1tiebreak.element.addEventListener("keyup",Ie,!1),M.p2tiebreak.element.addEventListener("keyup",Ue,!1)}function K(Ie,Ue,Oe){let Ee=+M.p1tiebreak.element.value,Xe=+M.p2tiebreak.element.value;(Ie.which===13||Oe)&&(Ee!=""||Xe!="")&&(P?J(Ee,Xe):Q(Ee,Xe));let Et=M[Ue?"p2tiebreak":"p1tiebreak"].element.value.match(/-?\d+\.?\d*/),Fe=Et&&!isNaN(Et[0])?parseInt(Et[0].toString().slice(-2)):void 0,ht=P?T:w,ti=Fe===void 0||Fe==""||Fe+2<ht?ht:Fe+2;M[Ue?"p2tiebreak":"p1tiebreak"].element.value=Fe!==void 0?Fe:"",f.auto_score&&!me()&&(M[Ue?"p1tiebreak":"p2tiebreak"].element.value=ti)}function Q(Ie,Ue,Oe){let Ee=R.length,Xe=Ee>U?Ee-1:U-1;R!=null&&R[Xe]&&(R[Xe][0][Ie<Ue?"tiebreak":"spacer"]=Ie<Ue?Ie:Ue,R[Xe][1][Ue<Ie?"tiebreak":"spacer"]=Ue<Ie?Ue:Ie,se())}function J(Ie,Ue,Oe){if(Ie<T&&Ue<T)return;let Ee=[{supertiebreak:Ie},{supertiebreak:Ue}],Xe=R.length;Xe&&R[Xe-1][0].supertiebreak!==void 0?R[Xe-1]=Ee:R.push(Ee),se()}function se(){$e(),Qe()!==void 0&&_(!0),Nt({selected_set:U})}function ie(Ie,Ue){let Oe=Math.abs(Ie-Ue);return!g&&(+Ie===v||+Ue===v)?!0:Oe>=2&&(+Ie>=v||+Ue>=v)}function ce(Ie,Ue){return g?+Ie===g+1&&+Ue===g||+Ie===g&&+Ue===g+1:!1}function oe(Ie,Ue){if(Ue===""){M.p1selector.ddlb.setValue(""),M.p2selector.ddlb.setValue(""),R[U]=[{games:0},{games:0}];return}be()&&we();let Oe=!1;$e(),le()&&(U=R.length-1,M.p1action.ddlb.setValue(" "),M.p2action.ddlb.setValue(" "),Ge());let Ee=M.p1selector.ddlb.getValue(),Xe=M.p2selector.ddlb.getValue();f.auto_score?Ie===0&&Xe===""?(Xe=Fe(Ue),M.p2selector.ddlb.setValue(Xe)):Ie===1&&Ee===""?(Ee=Fe(Ue),M.p1selector.ddlb.setValue(Ee)):g?(+Ee===g+1&&+Xe===g+1&&Et(g),+Ee===g+1&&+Xe<g-1&&Et(g),+Xe===g+1&&+Ee<g-1&&Et(g)):+Ee===v&&+Xe===v&&Et(v-1):Ie===0&&!Xe?(Xe=0,M.p2selector.ddlb.setValue(Xe)):Ie===1&&!Ee&&(Ee=0,M.p1selector.ddlb.setValue(Ee)),R[U]=[{games:Aee(Ee)||0},{games:Aee(Xe)||0}],!ie(Ee,Xe)&&!ce(Ee,Xe)?(R=R.slice(0,U+1),Nt({selected_set:U})):(ce(Ee,Xe)&&(Oe=!0),Qe(),te(Ee,Xe,Oe));function Et(ht){Ie?(Ee=ht,M.p1selector.ddlb.setValue(Ee)):(Xe=ht,M.p2selector.ddlb.setValue(Xe))}function Fe(ht){return ht===""?"":g?((+ht===g||+ht===g+1)&&(Oe=!0),+ht===g-1||+ht===g?parseInt(g||0)+1:+ht<g?v:g):+ht===v?v-1:(+ht===v-1,v)}}function te(Ie,Ue,Oe){Oe&&!h&&(M.p1tiebreak.element.style.display="inline",M.p2tiebreak.element.style.display="inline",M[Ie>Ue?"p1tiebreak":"p2tiebreak"].element.disabled=!0,M[Ie>Ue?"p2tiebreak":"p1tiebreak"].element.disabled=!1,M[Ie>Ue?"p2tiebreak":"p1tiebreak"].element.focus(),_(!1));let Ee=Ie!==""&&Ue!=="",Xe=Qe()===void 0&&me()===void 0;Ee&&Xe&&U+1<y&&(U+=1),Nt({selected_set:U,tiebreak:Oe})}function le(){let Ie=M.p1action.ddlb.getValue(),Ue=M.p2action.ddlb.getValue();return Ie==="winner"||Ue==="winner"}function ne(){let Ie=M.p1action.ddlb.getValue(),Ue=M.p2action.ddlb.getValue();if(["cancelled","incomplete","abandoned"].indexOf(Ie)>=0||["cancelled","incomplete","abandoned"].indexOf(Ue)>=0)return!1}function me(){let Ie=M.p1action.ddlb.getValue(),Ue=M.p2action.ddlb.getValue();if(["time","retired","defaulted","walkover"].indexOf(Ie)>=0)return 0;if(["time","retired","defaulted","walkover"].indexOf(Ue)>=0)return 1}function be(){let Ie=M.p1action.ddlb.getValue(),Ue=M.p2action.ddlb.getValue();return["interrupted"].indexOf(Ie)>=0||["interrupted"].indexOf(Ue)>=0}function Se(){let Ie=M.p1action.ddlb.getValue(),Ue=M.p2action.ddlb.getValue();return["live"].indexOf(Ie)>=0||["live"].indexOf(Ue)>=0}function we(){Se()||(M.p1action.ddlb.setValue(" "),M.p2action.ddlb.setValue(" ")),M.p1action.ddlb.unlock(),M.p2action.ddlb.unlock()}function ze(){return R.length?R.map(Ue=>{let Oe=isNaN(Ue[0].games)?Ue[0].games:+Ue[0].games,Ee=isNaN(Ue[1].games)?Ue[1].games:+Ue[1].games;if(Oe!==void 0&&Ee!==void 0&&Oe!==""&&Ee!==""){if(ce(Oe,Ee)&&Ue[0].tiebreak===void 0&&Ue[1].tiebreak===void 0)return[0,0];const Xe=+Oe===v&&+Oe==+Ee+1,Et=+Ee===v&&+Ee==+Oe+1;if(g)if(!g||v===g){if(Xe)return[0,0];if(+Ee===v&&+Ee==+Oe+1)return[0,0]}else{if(Xe)return[1,0];if(Et)return[0,1]}else{if(+Oe===v&&+Oe==+Ee+1)return[1,0];if(+Ee===v&&+Ee==+Oe+1)return[0,1]}if(Oe>Ee&&Oe>=v)return[1,0];if(Ee>Oe&&Ee>=v)return[0,1]}else if(Ue[0].supertiebreak!==void 0&&Ue[1].supertiebreak!==void 0){if(Ue[0].supertiebreak>Ue[1].supertiebreak+1&&Ue[0].supertiebreak>=T)return[1,0];if(Ue[1].supertiebreak>Ue[0].supertiebreak+1&&Ue[1].supertiebreak>=T)return[0,1]}return[0,0]}).reduce((Ue,Oe)=>[Ue[0]+Oe[0],Ue[1]+Oe[1]]):[0,0]}function Qe(Ie=!0){if(!R.length)return;let Ue=ze();if(+Ue[0]==+Ue[1]&&!Se()&&!be()&&!ne()&&me()===void 0)return;let Oe=Math.max(...Ue),Ee=Math.max(b,Math.floor(R.length/2)+1);if(Oe<Ee)return;const Xe=Ue[0]>=Ee&&1||(Ue[1]>=Ee?2:void 0);if(Xe===void 0&&!Se()&&!be()&&!ne()&&me()===void 0){_(!1);return}return M.p1tiebreak.element.style.display!=="inline"&&Ie&&_(!0),M[Xe===1?"p1action":"p2action"].ddlb.setValue("winner"),M[Xe===2?"p1action":"p2action"].ddlb.setValue(""),M[Xe===2?"p1action":"p2action"].ddlb.lock(),$(Xe-1),U=R.length,Xe-1}function ke(Ie){let Ue=R.length;return+Ie===R.length-1&&Ue&&R[Ue-1][0].supertiebreak!==void 0?R[Ue-1]:!1}function yt(Ie,Ue){return S?Qe(Ue)!==void 0&&ke(Ie)?!0:lt(Ie):!1}function lt(Ie){let Ue=ze();if(+Ue[0]==+Ue[1]&&+Ue[0]+1===b&&+Ie==+R.length)return!0}function Ct(Ie,Ue,Oe){return Ue||E||Ie===void 0?!1:R.length===0?!0:!((Qe(Oe)!==void 0||me()!==void 0)&&(Ie===void 0||+Ie===R.length))}function Nt({selected_set:Ie,tiebreak:Ue,actions:Oe}){P=yt(Ie,Oe);let Ee=Ct(Ie,Ue||P,Oe);if(!Ee&&!P&&(Ie=R.length),U=Math.min(y-1,+Ie),Ee&&$e(),P&&!h){let Ke=lt(Ie);M.p1tiebreak.element.style.display="inline",M.p2tiebreak.element.style.display="inline",M.p1tiebreak.element.disabled=!1,M.p2tiebreak.element.disabled=!1,Ke||(M.p1action.ddlb.setValue(" "),M.p2action.ddlb.setValue(" "),_(!1));let zt=ke(Ie);zt&&(M.p1tiebreak.element.value=zt[0].supertiebreak,M.p2tiebreak.element.value=zt[1].supertiebreak)}let Xe=R[Ie],Et=h?R:R.slice(0,+Ie),Fe=R.slice(+Ie+1);h&&!R.length&&(Et=[[{games:0},{games:0}]]);let ht=Et.map((Ke,zt)=>lN({setnum:zt,score:Ke[0]})).join(""),ti=Et.map((Ke,zt)=>lN({setnum:zt,score:Ke[1]})).join("");M.p1scores.element.innerHTML=ht,M.p2scores.element.innerHTML=ti,M.p1selector.ddlb.setValue(Xe?Xe[0].games+"":""),M.p2selector.ddlb.setValue(Xe?Xe[1].games+"":""),M.p1selector.element.style.display=Ee&&!E&&!h?"flex":"none",M.p2selector.element.style.display=Ee&&!E&&!h?"flex":"none",ht=Fe.map((Ke,zt)=>lN({setnum:+Ie+1+zt,score:Ke[0]})).join(""),ti=Fe.map((Ke,zt)=>lN({setnum:+Ie+1+zt,score:Ke[1]})).join(""),M.p1scores_e.element.innerHTML=ht,M.p2scores_e.element.innerHTML=ti}function Ce(){const Ie=M.p1action.ddlb.getValue(),Ue=M.p2action.ddlb.getValue(),Oe=Ie==="winner"&&1||Ue==="winner"&&2||void 0;let Ee=[1,2].includes(Oe),Xe=R.map(Fe=>{if(Fe[0].supertiebreak)return`[${Fe[0].supertiebreak}-${Fe[1].supertiebreak}]`;let ht=Fe[0].tiebreak,ti=Fe[1].tiebreak,Ke=ht!==void 0||ti!==void 0?`(${[ht,ti].filter(zt=>zt>=0).join("-")})`:"";return`${Fe[0].games}-${Fe[1].games}${Ke}`}).join(" "),Et;return[1,2].includes(Oe)&&(Et="COMPLETED"),(Ie==="retired"||Ue==="retired")&&(Et="RETIRED"),(Ie==="time"||Ue==="time")&&(Xe+=" TIME"),(Ie==="walkover"||Ue==="walkover")&&(Et="WALKOVER",Ee=!0),(Ie==="defaulted"||Ue==="defaulted")&&(Et="DEFAULTED",Ee=!0),(Ie==="abandoned"||Ue==="abandoned")&&(Et="ABANDONED",Ee=!0,Xe=""),(Ie==="interrupted"||Ue==="interrupted")&&(Et="SUSPENDED",Ee=!1),(Ie==="live"||Ue==="live")&&(Et="IN_PROGRESS",Ee=!1),(Ie==="cancelled"||Ue==="cancelled")&&(Et="CANCELLED",Ee=!1),(Ie==="incomplete"||Ue==="incomplete")&&(Et="ABANDONED",Ee=!1),{matchUpStatus:Et,winningSide:Oe,complete:Ee,score:Xe}}function Ge(){E=!1,M.p1selector.ddlb.unlock(),M.p2selector.ddlb.unlock(),M.p1action.ddlb.unlock(),M.p2action.ddlb.unlock()}function $e(){M.p1tiebreak.element.value="",M.p2tiebreak.element.value="",M.p1tiebreak.element.style.display="none",M.p2tiebreak.element.style.display="none"}function at(Ie,Ue){let Oe=M.p1action.ddlb.getValue(),Ee=M.p2action.ddlb.getValue(),Xe=Qe(),Et=Ie?Oe:Ee;if(f.auto_score=i.auto_score,Ue===""){Xe!==void 0&&(R=[],U=0,M[Ie?"p2action":"p1action"].ddlb.setValue(" ")),M[Ie?"p1action":"p2action"].ddlb.setValue(" "),Ge();let Fe=R.length;if(Fe){let ht=R[Fe-1];!ce(ht[0].games,ht[1].games)&&!ie(ht[0].games,ht[1].games)&&(U=Fe-1)}Nt({selected_set:U})}else["interrupted","cancelled","incomplete","abandoned"].indexOf(Ue)>=0?(M[Ie?"p1action":"p2action"].ddlb.setValue(" "),Nt({selected_set:U}),_(!0)):Ue==="live"?(f.auto_score=!1,M[Ie?"p1action":"p2action"].ddlb.setValue(" "),Nt({selected_set:U}),_(!0)):Ue==="winner"&&Et==="winner"?(Xe===void 0&&M[Ie?"p1action":"p2action"].ddlb.setValue("retired"),Nt({selected_set:U}),_(!0)):["time","retired","walkover","defaulted"].indexOf(Ue)>=0?(_(!0),Xe!==void 0?(M[Xe?"p2action":"p1action"].ddlb.setValue("winner"),M[Xe?"p1action":"p2action"].ddlb.setValue(" "),M[Xe?"p2action":"p1action"].ddlb.unlock(),M[Xe?"p1action":"p2action"].ddlb.lock()):(M.p1tiebreak.element.disabled=!1,M.p2tiebreak.element.disabled=!1,M[Ie?"p1action":"p2action"].ddlb.setValue("winner"),M[Ie?"p1action":"p2action"].ddlb.unlock(),M[Ie?"p2action":"p1action"].ddlb.lock(),(Ue==="time"||Ue==="retired"||Ue==="defaulted")&&(Xe!==void 0&&M[Ie?"p2action":"p1action"].ddlb.setValue(" "),U=R.length),(Ue==="time"||Ue==="retired")&&!R.length&&M[Ie?"p2action":"p1action"].ddlb.setValue("walkover"),Ue==="walkover"&&(R=[],U=0),Nt({selected_set:U}))):Ue==="winner"&&(Xe===void 0?M[Ie?"p1action":"p2action"].ddlb.setValue(R.length?"retired":"walkover"):M[Ie?"p1action":"p2action"].ddlb.setValue(" "),M[Ie?"p1action":"p2action"].ddlb.lock(),E=!0,M.p1selector.ddlb.lock(),M.p2selector.ddlb.lock(),Nt({selected_set:U}))}function ct({sobj:Ie,changeFx:Ue}){io.attachDropDown({id:Ie.bestof.id,options:Xe(n.bestof)}),Ie.bestof.ddlb=new io.DropDown({element:Ie.bestof.element,id:Ie.bestof.id,onChange:Et}),Ie.bestof.ddlb.setValue(y,"white"),io.attachDropDown({id:Ie.setsto.id,options:Xe(n.setsto)}),Ie.setsto.ddlb=new io.DropDown({element:Ie.setsto.element,id:Ie.setsto.id,onChange:ti}),Ie.setsto.ddlb.setValue(v,"white");let Oe=v,Ee=ht(Oe);io.attachDropDown({id:Ie.tiebreaksat.id,options:Ee}),Ie.tiebreaksat.ddlb=new io.DropDown({element:Ie.tiebreaksat.element,id:Ie.tiebreaksat.id,onChange:Ke}),Ie.tiebreaksat.ddlb.setValue(g&&g<Oe?g:Oe,"white"),Ie.tiebreaksat.ddlb.setValue(g||"","white"),io.attachDropDown({id:Ie.tiebreaksto.id,options:Xe(n.tiebreaksto)}),Ie.tiebreaksto.ddlb=new io.DropDown({element:Ie.tiebreaksto.element,id:Ie.tiebreaksto.id,onChange:zt}),Ie.tiebreaksto.ddlb.setValue(w,"white"),io.attachDropDown({id:Ie.finalset.id,options:[{key:Cs.tr("scoring.normal"),value:"N"},{key:Cs.tr("scoring.supertiebreak"),value:"S"}]}),Ie.finalset.ddlb=new io.DropDown({element:Ie.finalset.element,id:Ie.finalset.id,onChange:mt}),Ie.finalset.ddlb.selectionBackground(),Ie.finalset.ddlb.setValue(S?"S":"N","white"),io.attachDropDown({id:Ie.supertiebreakto.id,options:Xe(n.supertiebreakto)}),Ie.supertiebreakto.ddlb=new io.DropDown({element:Ie.supertiebreakto.element,id:Ie.supertiebreakto.id,onChange:Tt}),Ie.supertiebreakto.ddlb.selectionBackground(),Ie.supertiebreakto.ddlb.setValue(T||10,"white"),Fe(S);function Xe(Ut){return!Ut||!Array.isArray(Ut)?{}:Ut.map(zi=>({key:zi,value:zi}))}function Et(Ut){y=parseInt(Ut),b=Math.ceil(Ut/2),S=!1,Ie.finalset.ddlb.setValue("N","white"),Fe(S),typeof Ue=="function"&&Ue()}function Fe(Ut){Ie.stb2.element.style.opacity=Ut?1:0,Ie.supertiebreakto.element.style.opacity=Ut?1:0}function ht(Ut){return[{key:Cs.tr("none"),value:""},{key:`${Ut-1}-${Ut-1}`,value:Ut-1},{key:`${Ut}-${Ut}`,value:Ut}]}function ti(Ut){v=parseInt(Ut),g=parseInt(Ut);let zi=ht(Ut);Ie.tiebreaksat.ddlb.setOptions(zi),Ie.tiebreaksat.ddlb.setValue(Ut,"white"),typeof Ue=="function"&&Ue()}function Ke(Ut){g=parseInt(Ut),typeof Ue=="function"&&Ue()}function zt(Ut){w=parseInt(Ut),typeof Ue=="function"&&Ue()}function mt(Ut){T=Ie.supertiebreakto.ddlb.getValue()||10,S=Ut==="S"?{tiebreakTo:T}:!1,Fe(S),typeof Ue=="function"&&Ue()}function Tt(Ut){T=parseInt(Ut),typeof Ue=="function"&&Ue()}}},t}();function lN({setnum:t,score:e={games:0}}){let i=e.tiebreak!==void 0&&e.tiebreak||e.spacer!==void 0&&e.spacer||"",n=e.supertiebreak!==void 0?e.supertiebreak:e.games;return`
      <div class="set score set_number setClick" setnum="${t!==void 0?t:""}">
         <div class="setscore setClick">${n}</div>
         <div class="tbscore" ${e.spacer!==void 0?'style="opacity: 0"':""}>${i}</div>
      </div>
   `}function Wot(t){if(!t)return"";if(t.status)return t.status;if(!t.schedule)return"";let e=Kot(t.schedule);if(e)return`Duration ${e}`;let i=`${t.schedule.time_prefix||""}${t.schedule.time||""}`,n=`${t.schedule.court||""}${i?" / "+i:""}`;return t.winner_index===void 0?n:""}const Yot=(t,e)=>{let i=parseInt(t,10),n=Math.floor(i/3600),r=Math.floor((i-n*3600)/60),a=i-n*3600-r*60,s=!e||(e==null?void 0:e.display_seconds),o=!e||(e==null?void 0:e.pad_hours);return n<10&&o&&(n="0"+n),r<10&&(r="0"+r),a<10&&(a="0"+a),s?n+":"+r+":"+a:n+":"+r};function Kot(t){if(!t.start||!t.end)return"";let e=xee(t.end)-xee(t.start);return Yot(e,{pad_hours:!1,display_seconds:!1})}function xee(t){let e=t.split(":");return e[0]*60*60+e[1]*60}function TM(t){var l;const{matchUpId:e,callback:i}=t,n={withScaleValues:!0},r=t.matchUp??ot.findMatchUp({participantsProfile:n,matchUpId:e}).matchUp,a=c=>{const{matchUpStatus:u,matchUpFormat:d,winningSide:p,score:h}=c,m=h&&ot.parseScoreString({scoreString:h})||[],g=[{method:lY,params:{allowChangePropagation:!0,drawId:r.drawId,outcome:{score:{sets:m},matchUpFormat:d,matchUpStatus:u,winningSide:p},matchUpId:e}}];ii({methods:g,callback:y=>{AI(),Ot(i)&&i({...y,outcome:c})}})},s=r.sides.map(c=>c.participant),o=((l=r.score)==null?void 0:l.sets)||[];Zi.scoring?Urt({matchUp:r,callback:a}):qot.setMatchScore({round_name:r.roundName||"",matchFormat:r.matchUpFormat,callback:a,muid:r.matchUpId,existing_scores:o,teams:s})}function Oee(t,e,i,n){return new(i||(i=Promise))(function(r,a){function s(c){try{l(n.next(c))}catch(u){a(u)}}function o(c){try{l(n.throw(c))}catch(u){a(u)}}function l(c){var u;c.done?r(c.value):(u=c.value,u instanceof i?u:new i(function(d){d(u)})).then(s,o)}l((n=n.apply(t,[])).next())})}const Lee=(t,e)=>{const{touches:i}=t,{clientX:n,clientY:r}=t;if(!e)return;const{left:a,top:s}=e.getBoundingClientRect();let o={x:0,y:0};if(i===void 0)o={x:n-a,y:r-s};else if(i!==void 0&&i.length>0&&Object.keys(i).length>0){const{clientX:l,clientY:c}=i[0];o={x:l-a,y:c-s}}return Object.keys(o).length!==0||o.constructor!==Object?o:void 0},$n=(t,e)=>!!t&&t.classList.contains(e),Qd=(t,e,i)=>{if(!t)return;const n=new CustomEvent(e,{detail:i});t.dispatchEvent(n)},CB=(t,e,i)=>((n,r)=>Math.round(n/r)*r)(t,e*i),cN=(t,e)=>Array.from({length:Number(e)-Number(t)+1},(i,n)=>Number(t)+n),RB=(t,e)=>Array.from({length:Number(e)-Number(t)+1},(i,n)=>Number(e)-n).reverse(),uN=t=>{t&&typeof t=="function"&&t()},MB=(t="")=>{const e=t.replace(/(AM|PM|am|pm)/,n=>` ${n}`),i=new Date(`September 20, 2000 ${e}`);return`${i.getHours().toString().padStart(2,"0")}:${i.getMinutes().toString().padStart(2,"0")}`},pd=(t,e,i,n)=>{if(!t)return{hour:"12",minutes:"00",type:e==="24h"?void 0:"PM"};const{value:r}=t;if(i){if(typeof i=="boolean"&&i){const[d,p]=new Date().toLocaleTimeString().split(":");if(/[a-z]/i.test(p)&&e==="12h"){const[h,f]=p.split(" ");return{hour:Number(d)<=9?`0${Number(d)}`:d,minutes:h,type:f}}return{hour:Number(d)<=9?`0${Number(d)}`:d,minutes:p,type:void 0}}{const{time:d,locales:p,preventClockType:h}=i;let f=d;if(d||(f=new Date),h&&n){const[v,y]=new Date(f).toLocaleTimeString().split(":");if(/[a-z]/i.test(y)){const[b,I]=y.split(" ");return{hour:v,minutes:b,type:I}}return{hour:Number(v)<=9?`0${Number(v)}`:v,minutes:y,type:void 0}}const[m,g]=new Date(f).toLocaleTimeString(p,{timeStyle:"short"}).split(":");if(/[a-z]/i.test(g)&&e==="12h"){const[v,y]=g.split(" ");return{hour:Number(m)<=9?`0${Number(m)}`:m,minutes:v,type:y}}if(e==="12h"){const[v,y]=new Date(`1970-01-01T${m}:${g}Z`).toLocaleTimeString("en-US",{timeZone:"UTC",hour12:!0,hour:"numeric",minute:"numeric"}).split(":"),[b,I]=y.split(" ");return{hour:Number(v)<=9?`0${Number(v)}`:m,minutes:b,type:I}}return{hour:Number(m)<=9?`0${Number(m)}`:m,minutes:g,type:void 0}}}if(r===""||!r)return{hour:"12",minutes:"00",type:e==="24h"?void 0:"PM"};const[a,s]=r.split(" "),[o,l]=a.split(":");if(/[a-z]/i.test(a))return{error:"The input contains invalid letters or whitespace."};if(r.includes(" ")){if(!s)return{error:`The input contains invalid letters or whitespace.
        Problem is with input length (max 5), currentLength: ${r.length}.`,currentLength:r.length};if(r.length>8||s!=="AM"&&s!=="PM")return{error:`The input contains invalid letters or whitespace.
        Problem is with input length (max 8), currentLength: ${r.length} or invalid type (PM or AM), currentType: ${s}.`,currentLength:r.length,currentType:s}}let c=Number(l);const u=Number(o);return c<10?c=`0${c}`:c===0&&(c="00"),e==="12h"?u>12||c>59||c<0||u===0||s!=="AM"&&s!=="PM"?{error:`The input contains invalid letters or numbers. Problem is with hour which should be less than 13 and higher or equal 0, currentHour: ${u}. Minutes should be less than 60 and higher or equal 0, currentMinutes: ${Number(c)} or invalid type (PM or AM), currentType: ${s}.`,currentHour:u,currentMin:c,currentType:s}:{hour:u<10?`0${u}`:u.toString(),minutes:c.toString(),type:s}:u<0||u>23||c>59?{error:`The input contains invalid numbers. Problem is with hour which should be less than 24 and higher or equal 0, currentHour: ${u}. Minutes should be less than 60 and higher or equal 0, currentMinutes: ${Number(c)}`,currentHour:u,currentMin:c}:{hour:u<10?`0${u}`:u.toString(),minutes:c.toString()}},Mv=(t,e,i)=>{const n=Number(t);return e==="hour"?i!=="24h"?n>0&&n<=12:n>=0&&n<=23:e==="minutes"?n>=0&&n<=59:void 0},dN=(t,e,i,n)=>{if(t){if(Array.isArray(t)&&t.length>0)return!t.map(r=>Mv(r,e,i)).some(r=>r===!1);if(typeof t=="string"||typeof t=="number"){const r=Mv(t,e,i),a=n==null?void 0:n.map(Number).includes(Number(t));return!(!r||a)}}};function $2(t,e){e===void 0&&(e={});var i=e.insertAt;if(t&&typeof document<"u"){var n=document.head||document.getElementsByTagName("head")[0],r=document.createElement("style");r.type="text/css",i==="top"&&n.firstChild?n.insertBefore(r,n.firstChild):n.appendChild(r),r.styleSheet?r.styleSheet.cssText=t:r.appendChild(document.createTextNode(t))}}$2(`:export {
  cranepurple800: #5c1349;
  cranepurple900: #4e0d3a;
  cranepurple700: #71135c;
  cranered400: #f7363e;
  white: #fff;
  purple: #6200ee;
  opacity: opacity 0.15s linear;
}

.timepicker-ui * {
  box-sizing: border-box !important;
}
.timepicker-ui-modal {
  font-family: "Roboto", sans-serif;
  position: fixed;
  opacity: 0;
  top: 0;
  bottom: 0;
  left: 0;
  right: 0;
  background-color: rgba(156, 155, 155, 0.6);
  z-index: 5000;
  pointer-events: none;
}
.timepicker-ui-modal.show {
  pointer-events: auto;
}
.timepicker-ui-modal.removed {
  top: auto;
  bottom: auto;
  left: auto;
  right: auto;
  background-color: transparent;
}
.timepicker-ui-measure {
  position: absolute;
  top: -9999px;
  width: 3.125rem;
  height: 3.125rem;
  overflow: scroll;
}
.timepicker-ui-wrapper, .timepicker-ui-wrapper.mobile {
  position: fixed;
  z-index: 5001;
  width: 328px;
  height: 500px;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  background-color: #fff;
  border-radius: 4px;
  box-shadow: 0px 3px 5px -1px rgba(0, 0, 0, 0.2), 0px 5px 8px 0px rgba(0, 0, 0, 0.14), 0px 1px 14px 0px rgba(0, 0, 0, 0.12);
  display: flex;
  flex-direction: column;
  outline: none;
}
@media screen and (min-width: 320px) and (max-width: 825px) and (orientation: landscape) {
  .timepicker-ui-wrapper:not(.timepicker-ui-wrapper + .mobile) {
    flex-direction: row;
    height: 360px;
    width: 584px;
  }
}
@media screen and (max-width: 330px) and (orientation: portrait) {
  .timepicker-ui-wrapper:not(.timepicker-ui-wrapper + .mobile) {
    width: 315px;
  }
}
.timepicker-ui-wrapper.mobile {
  height: 218px;
}
@media screen and (max-width: 330px) {
  .timepicker-ui-wrapper.mobile {
    width: 315px;
  }
}
.timepicker-ui-header, .timepicker-ui-header.mobile {
  padding-top: 52px;
  padding-bottom: 36px;
  padding-right: 24px;
  padding-left: 24px;
  height: 104px;
  display: flex;
  flex-direction: row;
  justify-content: center;
  align-items: center;
  position: relative;
  height: 100%;
}
.timepicker-ui-header.mobile {
  padding-bottom: 0;
  padding-top: 35px;
}
@media screen and (min-width: 320px) and (max-width: 825px) and (orientation: landscape) {
  .timepicker-ui-header:not(.timepicker-ui-header + .mobile) {
    height: auto;
    flex-direction: column;
  }
}
.timepicker-ui-select-time, .timepicker-ui-select-time.mobile {
  text-transform: uppercase;
  position: absolute;
  top: 16px;
  left: 24px;
  font-size: 12px;
  color: #a9a9a9;
}
.timepicker-ui-body {
  height: 256px;
  width: 256px;
  margin: 0 auto;
  position: relative;
  border-radius: 100%;
}
@media screen and (min-width: 320px) and (max-width: 825px) and (orientation: landscape) {
  .timepicker-ui-body {
    padding-right: 0;
    padding-left: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    margin-top: 23px;
  }
}
@media screen and (min-width: 320px) and (max-width: 825px) and (orientation: landscape) {
  .timepicker-ui-wrapper-landspace {
    display: flex;
    flex-direction: column;
    width: 100%;
  }
}
.timepicker-ui-footer, .timepicker-ui-footer-mobile {
  height: 76px;
  display: flex;
  justify-content: space-between;
  margin-bottom: 4px;
}
@media screen and (min-width: 320px) and (max-width: 825px) and (orientation: landscape) {
  .timepicker-ui-footer:not(.timepicker-ui-footer + .mobile) {
    justify-content: flex-end;
  }
}
.timepicker-ui-footer.mobile {
  align-items: flex-start;
}
.timepicker-ui-clock-face {
  background-color: #e0e0e0;
  height: 100%;
  width: 100%;
  border-radius: 100%;
  position: relative;
}
@media screen and (min-width: 320px) and (max-width: 825px) and (orientation: landscape) {
  .timepicker-ui-clock-face {
    height: 256px;
    width: 256px;
    top: 15px;
  }
}
.timepicker-ui-dot {
  position: absolute;
  top: 50%;
  left: 50%;
  user-select: none;
  touch-action: none;
  transform: translate(-50%, -50%);
  background-color: #6200ee;
  height: 8px;
  width: 8px;
  border-radius: 100%;
}
.timepicker-ui-tips-wrapper {
  height: 100%;
  width: 100%;
}
.timepicker-ui-tips-wrapper-24h {
  position: absolute;
  height: 160px;
  width: 160px;
  z-index: 0;
  transform: translate(-50%, -50%);
  left: 50%;
  top: 50%;
  border-radius: 50%;
}
.timepicker-ui-tips-wrapper-24h-disabled {
  pointer-events: none;
  touch-action: none;
  user-select: none;
}
.timepicker-ui-hour-time-12, .timepicker-ui-minutes-time, .timepicker-ui-hour-time-24 {
  position: absolute;
  width: 32px;
  height: 32px;
  text-align: center;
  cursor: pointer;
  font-size: 17.6px;
  display: flex;
  justify-content: center;
  align-items: center;
  touch-action: none;
  user-select: none;
}
.timepicker-ui-hour-time-12 span, .timepicker-ui-minutes-time span, .timepicker-ui-hour-time-24 span {
  touch-action: none;
  user-select: none;
}
.timepicker-ui-hour-time-12 {
  display: block;
  display: flex;
  justify-content: center;
  align-items: center;
}
.timepicker-ui-wrapper-time, .timepicker-ui-wrapper-time.mobile {
  display: flex;
  margin-right: 10px;
  height: 100%;
  justify-content: center;
  align-items: center;
}
@media screen and (min-width: 320px) and (max-width: 825px) and (orientation: landscape) {
  .timepicker-ui-wrapper-time:not(.timepicker-ui-wrapper-time + .mobile) {
    margin-right: 0;
    height: auto;
  }
}
.timepicker-ui-wrapper-time-24h {
  margin-right: 0px;
}
.timepicker-ui-wrapper-time.mobile {
  position: relative;
}
.timepicker-ui-hour, .timepicker-ui-minutes, .timepicker-ui-hour.mobile, .timepicker-ui-minutes.mobile {
  display: flex;
  justify-content: center;
  align-items: center;
  font-size: 51.2px;
  background-color: #e4e4e4;
  border-radius: 7px;
  cursor: pointer;
  transition: all 0.3s ease;
  outline: none;
  border: 2px solid transparent;
  padding: 10px;
  width: 96px;
  text-align: center;
}
.timepicker-ui-hour:focus-visible, .timepicker-ui-minutes:focus-visible, .timepicker-ui-hour.mobile:focus-visible, .timepicker-ui-minutes.mobile:focus-visible {
  outline: auto;
}
.timepicker-ui-hour:hover, .timepicker-ui-hour.active, .timepicker-ui-minutes:hover, .timepicker-ui-minutes.active, .timepicker-ui-hour.mobile:hover, .timepicker-ui-hour.mobile.active, .timepicker-ui-minutes.mobile:hover, .timepicker-ui-minutes.mobile.active {
  color: #6200ee;
  background-color: #ece0fd;
}
.timepicker-ui-hour::-webkit-outer-spin-button, .timepicker-ui-hour::-webkit-inner-spin-button, .timepicker-ui-minutes::-webkit-outer-spin-button, .timepicker-ui-minutes::-webkit-inner-spin-button, .timepicker-ui-hour.mobile::-webkit-outer-spin-button, .timepicker-ui-hour.mobile::-webkit-inner-spin-button, .timepicker-ui-minutes.mobile::-webkit-outer-spin-button, .timepicker-ui-minutes.mobile::-webkit-inner-spin-button {
  -webkit-appearance: none !important;
  margin: 0 !important;
}
.timepicker-ui-hour[type=number], .timepicker-ui-minutes[type=number], .timepicker-ui-hour.mobile[type=number], .timepicker-ui-minutes.mobile[type=number] {
  -moz-appearance: textfield !important;
}
.timepicker-ui-hour, .timepicker-ui-minutes {
  outline: none;
  border: 2px solid transparent;
}
.timepicker-ui-hour[contenteditable=true]:focus, .timepicker-ui-hour[contenteditable=true]:active, .timepicker-ui-minutes[contenteditable=true]:focus, .timepicker-ui-minutes[contenteditable=true]:active {
  border: 2px solid #6200ee;
  outline-color: #6200ee;
  user-select: all;
}
.timepicker-ui-hour.mobile, .timepicker-ui-minutes.mobile {
  height: 70px;
  outline: none;
  border: 2px solid transparent;
}
.timepicker-ui-hour.mobile[contenteditable=true]:focus, .timepicker-ui-hour.mobile[contenteditable=true]:active, .timepicker-ui-minutes.mobile[contenteditable=true]:focus, .timepicker-ui-minutes.mobile[contenteditable=true]:active {
  border: 2px solid #6200ee;
  outline-color: #6200ee;
  user-select: all;
}
.timepicker-ui-dots, .timepicker-ui-dots.mobile {
  padding-left: 5px;
  padding-right: 5px;
  display: flex;
  justify-content: center;
  align-items: center;
  font-size: 57.6px;
  user-select: none;
  touch-action: none;
}
.timepicker-ui-wrapper-type-time, .timepicker-ui-wrapper-type-time.mobile {
  display: flex;
  flex-direction: column;
  height: 80px;
  justify-content: center;
  align-items: center;
  font-size: 16px;
  font-weight: 500;
  color: #787878;
}
@media screen and (min-width: 320px) and (max-width: 825px) and (orientation: landscape) {
  .timepicker-ui-wrapper-type-time {
    flex-direction: row;
    width: 100%;
  }
}
.timepicker-ui-wrapper-type-time.mobile {
  height: 70px;
}
.timepicker-ui-am, .timepicker-ui-pm, .timepicker-ui-am.mobile, .timepicker-ui-pm.mobile {
  display: flex;
  justify-content: center;
  align-items: center;
  border: 2px solid #d6d6d6;
  transition: all 0.3s ease;
  cursor: pointer;
  width: 100%;
  height: 100%;
}
.timepicker-ui-am:hover, .timepicker-ui-am.active, .timepicker-ui-pm:hover, .timepicker-ui-pm.active, .timepicker-ui-am.mobile:hover, .timepicker-ui-am.mobile.active, .timepicker-ui-pm.mobile:hover, .timepicker-ui-pm.mobile.active {
  color: #6200ee;
  background-color: #ece0fd;
}
.timepicker-ui-am.active, .timepicker-ui-pm.active, .timepicker-ui-am.mobile.active, .timepicker-ui-pm.mobile.active {
  pointer-events: none;
}
@media screen and (min-width: 320px) and (max-width: 825px) and (orientation: landscape) {
  .timepicker-ui-am:not(.timepicker-ui-am + .mobile), .timepicker-ui-pm:not(.timepicker-ui-pm + .mobile) {
    width: 50%;
    height: 44px;
  }
}
.timepicker-ui-am, .timepicker-ui-am.mobile {
  border-top-left-radius: 7px;
  border-top-right-radius: 7px;
  border-bottom-width: 0.3752px;
}
.timepicker-ui-am.mobile {
  border-bottom-left-radius: 0;
}
@media screen and (min-width: 320px) and (max-width: 825px) and (orientation: landscape) {
  .timepicker-ui-am:not(.timepicker-ui-am + .mobile) {
    border-top-left-radius: 7px;
    border-bottom-left-radius: 7px;
    border-top-right-radius: 0;
    border-top-width: 1.5008px;
    border-right-width: 0.3752px;
  }
}
.timepicker-ui-pm, .timepicker-ui-pm.mobile {
  border-bottom-left-radius: 7px;
  border-bottom-right-radius: 7px;
  border-top-width: 0.3752px;
  width: 54px;
}
.timepicker-ui-pm.mobile {
  border-top-right-radius: 0;
}
@media screen and (min-width: 320px) and (max-width: 825px) and (orientation: landscape) {
  .timepicker-ui-pm:not(.timepicker-ui-pm + .mobile) {
    border-bottom-right-radius: 7px;
    border-top-right-radius: 7px;
    border-bottom-left-radius: 0;
    border-bottom-width: 1.5008px;
    border-left-width: 0.3752px;
    width: 50%;
    height: 44px;
  }
}
.timepicker-ui-cancel-btn, .timepicker-ui-ok-btn, .timepicker-ui-cancel-btn.mobile, .timepicker-ui-ok.btn-mobile {
  color: #6200ee;
  text-transform: uppercase;
  border-radius: 7px;
  background-color: transparent;
  text-align: center;
  font-size: 15.2px;
  padding-top: 9px;
  padding-bottom: 9px;
  font-weight: 500;
  transition: all 0.3s ease;
  cursor: pointer;
}
.timepicker-ui-cancel-btn:hover, .timepicker-ui-ok-btn:hover, .timepicker-ui-cancel-btn.mobile:hover, .timepicker-ui-ok.btn-mobile:hover {
  background-color: #d6d6d6;
}
.timepicker-ui-cancel-btn, .timepicker-ui-cancel-btn.mobile {
  width: 72px;
  margin-right: 4px;
}
.timepicker-ui-ok-btn, .timepicker-ui-ok-btn.mobile {
  width: 64px;
  margin-left: 4px;
}
.timepicker-ui-wrapper-btn, .timepicker-ui-keyboard-icon, .timepicker-ui-wrapper-btn-mobile, .timepicker-ui-keyboard-icon-mobile {
  display: flex;
  justify-content: center;
  align-items: center;
}
.timepicker-ui-keyboard-icon-wrapper, .timepicker-ui-keyboard-icon-wrapper.mobile {
  width: 44px;
  height: 44px;
  position: relative;
  bottom: -26px;
  left: 12px;
  transition: all 0.3s ease;
}
.timepicker-ui-keyboard-icon-wrapper:hover .timepicker-ui-keyboard-icon, .timepicker-ui-keyboard-icon-wrapper:hover .timepicker-ui-keyboard-icon.mobile, .timepicker-ui-keyboard-icon-wrapper.mobile:hover .timepicker-ui-keyboard-icon, .timepicker-ui-keyboard-icon-wrapper.mobile:hover .timepicker-ui-keyboard-icon.mobile {
  background-color: #d6d6d6;
  border-radius: 7px;
}
.timepicker-ui-keyboard-icon-wrapper.mobile {
  bottom: -5px;
}
.timepicker-ui-keyboard-icon, .timepicker-ui-keyboard-icon.mobile {
  padding: 12px;
  cursor: pointer;
  transition: all 0.3s ease;
  color: #4e545a;
  height: 44px;
  width: 44px;
}
.timepicker-ui-keyboard-icon:hover, .timepicker-ui-keyboard-icon.mobile:hover {
  color: #6200ee;
}
@media screen and (min-width: 320px) and (max-width: 825px) and (orientation: landscape) {
  .timepicker-ui-keyboard-icon-wrapper, .timepicker-ui-keyboard-icon-wrapper.mobile {
    position: absolute;
    bottom: 8px;
  }
}
.timepicker-ui-wrapper-btn, .timepicker-ui-wrapper-btn.mobile {
  margin-right: 8px;
  position: relative;
  bottom: -14px;
}
.timepicker-ui-hour-text, .timepicker-ui-minute-text, .timepicker-ui-hour-text.mobile, .timepicker-ui-minute-text.mobile {
  position: absolute;
  bottom: 6px;
  font-size: 12.8px;
  color: #a9a9a9;
  left: 0;
}
.timepicker-ui-minute-text, .timepicker-ui-minute-text.mobile {
  left: 120px;
}
.timepicker-ui-clock-hand {
  position: absolute;
  background-color: #6200ee;
  bottom: 50%;
  height: 40%;
  left: calc(50% - 1px);
  transform-origin: center bottom 0;
  width: 2px;
}
.timepicker-ui-clock-hand-24h {
  height: 23%;
}
.timepicker-ui-circle-hand {
  position: absolute;
  transform: translate(-48%, -50%);
  width: 4px;
  height: 4px;
  border-radius: 100%;
  transition: all 0.2s ease;
  height: 46px;
  width: 46px;
  box-sizing: border-box !important;
  background-color: #6200ee;
}
.timepicker-ui-circle-hand.small-circle {
  height: 36px;
  width: 36px;
  box-sizing: border-box !important;
}
.timepicker-ui-circle-hand-24h {
  transform: translate(-50%, -50%);
  height: 32px;
  width: 32px;
  top: 4px;
  left: 1px;
}
.timepicker-ui-value-tips, .timepicker-ui-value-tips-24h {
  width: 100%;
  height: 100%;
  display: flex;
  justify-content: center;
  align-items: center;
  transition: 0.3s ease color;
  border-radius: 50%;
  outline: none;
}
.timepicker-ui-value-tips:focus, .timepicker-ui-value-tips-24h:focus {
  background: rgba(143, 143, 143, 0.315);
  box-shadow: 0px 3px 5px -1px rgba(0, 0, 0, 0.2), 0px 5px 8px 0px rgba(0, 0, 0, 0.14), 0px 1px 14px 0px rgba(0, 0, 0, 0.12);
}
.timepicker-ui-value-tips.active, .timepicker-ui-value-tips-24h.active {
  color: #fff;
  transition: none;
}
.timepicker-ui-clock-animation {
  animation: clockanimation 350ms linear;
}
.timepicker-ui-open-element.disabled {
  pointer-events: none;
  touch-action: none;
  user-select: none;
}
.timepicker-ui-tips-animation {
  transition: transform 400ms cubic-bezier(0.4, 0, 0.2, 1) 0ms, height 400ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;
}
.timepicker-ui-tips-disabled {
  color: rgba(156, 155, 155, 0.6);
  pointer-events: none;
}

.opacity {
  transition: opacity 0.15s linear;
}
.opacity.show {
  opacity: 1;
}

.invalid-value {
  border-color: #d50000 !important;
  color: #d50000 !important;
}
.invalid-value:hover, .invalid-value:focus, .invalid-value:active {
  border-color: #d50000 !important;
  color: #d50000 !important;
}

@keyframes clockanimation {
  0% {
    opacity: 0;
    transform: scale(0.8);
  }
  to {
    opacity: 1;
    transform: scale(1);
  }
}
.timepicker-ui-invalid-format {
  border: 2px solid red;
  color: red;
}

.timepicker-ui-invalid-text {
  color: red;
}`);$2(`:export {
  cranepurple800: #5c1349;
  cranepurple900: #4e0d3a;
  cranepurple700: #71135c;
  cranered400: #f7363e;
  white: #fff;
  purple: #6200ee;
  opacity: opacity 0.15s linear;
}

.timepicker-ui-wrapper.crane-straight, .timepicker-ui-wrapper.mobile.crane-straight {
  border-radius: 0;
  background-color: #4e0d3a;
  color: #fff;
}
.timepicker-ui-wrapper.crane-straight.radius, .timepicker-ui-wrapper.mobile.crane-straight.radius {
  border-radius: 1.25rem;
}
.timepicker-ui-select-time.crane-straight, .timepicker-ui-select-time.mobile.crane-straight {
  color: #e5e5e5;
}
.timepicker-ui-clock-face.crane-straight, .timepicker-ui-clock-face.mobile.crane-straight {
  background-color: #71135c;
}
.timepicker-ui-dot.crane-straight, .timepicker-ui-dot.mobile.crane-straight {
  background-color: #f7363e;
}
.timepicker-ui-hour.crane-straight, .timepicker-ui-minutes.crane-straight, .timepicker-ui-hour.mobile.crane-straight, .timepicker-ui-minutes.mobile.crane-straight {
  background-color: #71135c;
  border-radius: 0;
  color: #fff;
}
.timepicker-ui-hour.crane-straight.radius, .timepicker-ui-minutes.crane-straight.radius, .timepicker-ui-hour.mobile.crane-straight.radius, .timepicker-ui-minutes.mobile.crane-straight.radius {
  border-radius: 1.25rem;
}
.timepicker-ui-hour.crane-straight:hover, .timepicker-ui-hour.crane-straight.active, .timepicker-ui-minutes.crane-straight:hover, .timepicker-ui-minutes.crane-straight.active, .timepicker-ui-hour.mobile.crane-straight:hover, .timepicker-ui-hour.mobile.crane-straight.active, .timepicker-ui-minutes.mobile.crane-straight:hover, .timepicker-ui-minutes.mobile.crane-straight.active {
  background-color: #f7363e;
}
.timepicker-ui-hour.mobile.crane-straight[contenteditable=true]:focus, .timepicker-ui-hour.mobile.crane-straight[contenteditable=true]:active, .timepicker-ui-minutes.mobile.crane-straight[contenteditable=true]:focus, .timepicker-ui-minutes.mobile.crane-straight[contenteditable=true]:active {
  border-color: #fff;
  outline-color: #fff;
}
.timepicker-ui-dots.crane-straight, .timepicker-ui-dots.mobile.crane-straight {
  color: #fff;
}
.timepicker-ui-wrapper-type-time.crane-straight, .timepicker-ui-wrapper-type-time.mobile.crane-straight {
  color: #fff;
}
.timepicker-ui-am.crane-straight, .timepicker-ui-pm.crane-straight, .timepicker-ui-am.mobile.crane-straight, .timepicker-ui-pm.mobile.crane-straight {
  border: 0.125rem solid transparent;
  border-radius: 0;
  background-color: #71135c;
}
.timepicker-ui-am:hover.crane-straight, .timepicker-ui-am.active.crane-straight, .timepicker-ui-pm:hover.crane-straight, .timepicker-ui-pm.active.crane-straight, .timepicker-ui-am.mobile:hover.crane-straight, .timepicker-ui-am.mobile.active.crane-straight, .timepicker-ui-pm.mobile:hover.crane-straight, .timepicker-ui-pm.mobile.active.crane-straight {
  color: #fff;
  background-color: #f7363e;
}
.timepicker-ui-am.crane-straight.radius {
  border-top-left-radius: 1.25rem;
  border-top-right-radius: 1.25rem;
}
.timepicker-ui-pm.crane-straight.radius {
  border-bottom-left-radius: 1.25rem;
  border-bottom-right-radius: 1.25rem;
}
@media screen and (min-width: 320px) and (max-width: 826px) and (orientation: landscape) {
  .timepicker-ui-am:not(.timepicker-ui-am + .mobile).crane-straight.radius {
    border-bottom-left-radius: 1.25rem;
    border-top-right-radius: 0;
    border-bottom-right-radius: 0;
  }
}
@media screen and (min-width: 320px) and (max-width: 826px) and (orientation: landscape) {
  .timepicker-ui-pm:not(.timepicker-ui-pm + .mobile).crane-straight.radius {
    border-bottom-right-radius: 1.25rem;
    border-top-right-radius: 1.25rem;
    border-bottom-left-radius: 0;
    border-top-left-radius: 0;
  }
}
@media screen and (min-width: 320px) and (max-width: 767px) and (orientation: landscape) {
  .timepicker-ui-am.mobile.crane-straight.radius {
    border-bottom-left-radius: 0rem;
    border-bottom-right-radius: 0rem;
  }
}
@media screen and (min-width: 320px) and (max-width: 767px) and (orientation: landscape) {
  .timepicker-ui-pm.mobile.crane-straight.radius {
    border-top-left-radius: 0rem;
    border-top-right-radius: 0rem;
  }
}
.timepicker-ui-cancel-btn.crane-straight, .timepicker-ui-ok-btn.crane-straight, .timepicker-ui-cancel-btn.mobile.crane-straight, .timepicker-ui-ok-btn.mobile.crane-straight {
  color: #fff;
  border-radius: 0rem;
}
.timepicker-ui-cancel-btn.crane-straight.radius, .timepicker-ui-ok-btn.crane-straight.radius, .timepicker-ui-cancel-btn.mobile.crane-straight.radius, .timepicker-ui-ok-btn.mobile.crane-straight.radius {
  border-radius: 0.8125rem;
}
.timepicker-ui-cancel-btn:hover.crane-straight, .timepicker-ui-ok-btn:hover.crane-straight, .timepicker-ui-cancel-btn.mobile:hover.crane-straight, .timepicker-ui-ok-btn.mobile:hover.crane-straight {
  background-color: #f7363e;
}
.timepicker-ui-keyboard-icon-wrapper.crane-straight, .timepicker-ui-keyboard-icon-wrapper.mobile.crane-straight {
  color: #fff;
}
.timepicker-ui-keyboard-icon-wrapper.crane-straight.radius, .timepicker-ui-keyboard-icon-wrapper.mobile.crane-straight.radius {
  border-radius: 1.25rem;
}
.timepicker-ui-keyboard-icon-wrapper.crane-straight:hover .timepicker-ui-keyboard-icon, .timepicker-ui-keyboard-icon-wrapper.crane-straight:hover .timepicker-ui-keyboard-icon.mobile, .timepicker-ui-keyboard-icon-wrapper.mobile.crane-straight:hover .timepicker-ui-keyboard-icon, .timepicker-ui-keyboard-icon-wrapper.mobile.crane-straight:hover .timepicker-ui-keyboard-icon.mobile {
  background-color: #f7363e;
  color: #fff;
  border-radius: 0;
}
.timepicker-ui-keyboard-icon-wrapper.crane-straight.radius:hover .timepicker-ui-keyboard-icon, .timepicker-ui-keyboard-icon-wrapper.crane-straight.radius:hover .timepicker-ui-keyboard-icon.mobile, .timepicker-ui-keyboard-icon-wrapper.mobile.crane-straight.radius:hover .timepicker-ui-keyboard-icon, .timepicker-ui-keyboard-icon-wrapper.mobile.crane-straight.radius:hover .timepicker-ui-keyboard-icon.mobile {
  border-radius: 0.875rem;
}
.timepicker-ui-keyboard-icon.crane-straight:hover, .timepicker-ui-keyboard-icon.mobile.crane-straight:hover {
  color: #fff;
}
.timepicker-ui-keyboard-icon.crane-straight:hover.radius, .timepicker-ui-keyboard-icon.mobile.crane-straight:hover.radius {
  border-radius: 1.25rem;
}
.timepicker-ui-clock-hand.crane-straight {
  background-color: #f7363e;
}
.timepicker-ui-circle-hand.crane-straight {
  border-color: #f7363e;
  background-color: #f7363e;
}
.timepicker-ui-value-tips.crane-straight {
  color: #fff;
}`);$2(`:export {
  cranepurple800: #5c1349;
  cranepurple900: #4e0d3a;
  cranepurple700: #71135c;
  cranered400: #f7363e;
  white: #fff;
  purple: #6200ee;
  opacity: opacity 0.15s linear;
}

.timepicker-ui-hour-time-12.m3, .timepicker-ui-hour-time-24.m3 {
  color: #1a1c18;
}
.timepicker-ui-wrapper.m3 {
  border-radius: 35px;
  background-color: #e5eadc;
  box-shadow: unset;
}
.timepicker-ui-hour.active.m3, .timepicker-ui-minutes.active.m3 {
  background-color: #b8f397;
  color: #042100;
}
.timepicker-ui-minutes.m3, .timepicker-ui-hour.m3 {
  background-color: #dfe4d6;
}
.timepicker-ui-minutes:hover.m3, .timepicker-ui-hour:hover.m3 {
  color: #386a20;
}
.timepicker-ui-clock-face.m3 {
  background-color: #dfe4d6;
}
.timepicker-ui-clock-hand.m3, .timepicker-ui-dot.m3, .timepicker-ui-circle-hand.m3 {
  background-color: #386a20 !important;
}
.timepicker-ui-cancel-btn.m3, .timepicker-ui-ok-btn.m3 {
  color: #386a20;
}
.timepicker-ui-cancel-btn:hover.m3, .timepicker-ui-ok-btn:hover.m3 {
  background-color: #dfe4d6;
}
.timepicker-ui-wrapper-type-time.m3 {
  color: #6b7165;
}
.timepicker-ui-am.m3, .timepicker-ui-am.m3, .timepicker-ui-pm.m3, .timepicker-ui-pm.m3 {
  border-color: #74796e;
  border-width: 1px;
}
.timepicker-ui-am.m3, .timepicker-ui-am.m3 {
  border-bottom-width: 0px;
}
.timepicker-ui-am:hover.m3, .timepicker-ui-am.active.m3, .timepicker-ui-pm:hover.m3, .timepicker-ui-pm.active.m3 {
  background-color: #bbebeb;
  color: #002021;
}
.timepicker-ui-hour.mobile:hover.m3, .timepicker-ui-minutes.mobile:hover.m3 {
  background-color: #dfe4d6;
}`);var Q1=`:export {
  cranepurple800: #5c1349;
  cranepurple900: #4e0d3a;
  cranepurple700: #71135c;
  cranered400: #f7363e;
  white: #fff;
  purple: #6200ee;
  opacity: opacity 0.15s linear;
}`;$2(Q1);const Zot={amLabel:"AM",animation:!0,appendModalSelector:"",backdrop:!0,cancelLabel:"CANCEL",editable:!1,enableScrollbar:!1,enableSwitchIcon:!1,mobileTimeLabel:"Enter Time",focusInputAfterCloseModal:!1,hourMobileLabel:"Hour",iconTemplate:'<i class="material-icons timepicker-ui-keyboard-icon">keyboard</i>',iconTemplateMobile:'<i class="material-icons timepicker-ui-keyboard-icon">schedule</i>',incrementHours:1,incrementMinutes:1,minuteMobileLabel:"Minute",mobile:!1,okLabel:"OK",pmLabel:"PM",timeLabel:"Select Time",switchToMinutesAfterSelectHour:!1,theme:"basic",clockType:"12h",disabledTime:void 0,currentTime:void 0,focusTrap:!0,delayHandler:300},NB="mousedown mouseup mousemove mouseleave mouseover touchstart touchmove touchend",Fee=["00","13","14","15","16","17","18","19","20","21","22","23"],N0=["12","1","2","3","4","5","6","7","8","9","10","11"],vb=["00","05","10","15","20","25","30","35","40","45","50","55"];class Gm{constructor(e){this.clean=()=>{var i,n;const r=(i=this.tipsWrapper)===null||i===void 0?void 0:i.querySelectorAll("span.timepicker-ui-hour-time-12"),a=(n=this.tipsWrapper)===null||n===void 0?void 0:n.querySelectorAll("span.timepicker-ui-minutes-time");this._removeClasses(r),this._removeClasses(a)},this.create=()=>{var i;if(!(this.clockFace&&this.array&&this.classToAdd&&this.tipsWrapper))return;const n=(this.clockFace.offsetWidth-32)/2,r=(this.clockFace.offsetHeight-32)/2,a=n-9;this.tipsWrapper.innerHTML="",(i=this.array)===null||i===void 0||i.forEach((s,o)=>{var l,c,u,d,p,h;const f=o*(360/this.array.length)*(Math.PI/180),m=document.createElement("span"),g=document.createElement("span");g.innerHTML=s,this.disabledTime&&(Array.isArray(this.disabledTime)&&(!((l=this.disabledTime)===null||l===void 0)&&l.includes(s))&&(g.classList.add("timepicker-ui-tips-disabled"),m.classList.add("timepicker-ui-tips-disabled")),this.hour===this.disabledTime.removedStartedHour&&(!((u=(c=this.disabledTime)===null||c===void 0?void 0:c.startMinutes)===null||u===void 0)&&u.includes(s))&&(g.classList.add("timepicker-ui-tips-disabled"),m.classList.add("timepicker-ui-tips-disabled"),g.tabIndex=-1),this.hour===this.disabledTime.removedEndHour&&(!((p=(d=this.disabledTime)===null||d===void 0?void 0:d.endMinutes)===null||p===void 0)&&p.includes(s))&&(g.classList.add("timepicker-ui-tips-disabled"),m.classList.add("timepicker-ui-tips-disabled"),g.tabIndex=-1)),this.clockType==="24h"?(g.classList.add("timepicker-ui-value-tips-24h"),$n(g,"timepicker-ui-tips-disabled")||(g.tabIndex=0)):(g.classList.add("timepicker-ui-value-tips"),$n(g,"timepicker-ui-tips-disabled")||(g.tabIndex=0)),m.classList.add(this.classToAdd),this.theme==="crane-straight"&&(m.classList.add("crane-straight"),g.classList.add("crane-straight")),this.theme==="m3"&&(m.classList.add("m3"),g.classList.add("m3")),m.style.left=n+Math.sin(f)*a-m.offsetWidth+"px",m.style.bottom=r+Math.cos(f)*a-m.offsetHeight+"px",m.appendChild(g),(h=this.tipsWrapper)===null||h===void 0||h.appendChild(m)})},this.updateDisable=i=>{var n,r;const a=(n=this.tipsWrapper)===null||n===void 0?void 0:n.querySelectorAll("span.timepicker-ui-hour-time-12"),s=(r=this.tipsWrapper)===null||r===void 0?void 0:r.querySelectorAll("span.timepicker-ui-minutes-time");if(this._removeClasses(a),this._removeClasses(s),i!=null&&i.hoursToUpdate&&a&&this._addClassesWithIncludes(a,i.hoursToUpdate),(i==null?void 0:i.minutesToUpdate)&&s){const{actualHour:o,removedEndHour:l,removedStartedHour:c,startMinutes:u,endMinutes:d}=i.minutesToUpdate;l===o&&d.length>0?this._addClassesWithIncludes(s,d):Number(o)>Number(c)&&Number(o)<Number(l)&&this._addClasses(s),c===o&&u.length>0?this._addClassesWithIncludes(s,u):Number(o)>Number(c)&&Number(o)<Number(l)&&this._addClasses(s)}if(i){const{amHours:o,pmHours:l,activeMode:c,startMinutes:u,endMinutes:d,removedAmHour:p,removedPmHour:h,actualHour:f}=i.minutesToUpdate;if(!o||!l)return;a&&(o&&c==="AM"&&this._addClassesWithIncludes(a,o),l&&c==="PM"&&this._addClassesWithIncludes(a,l)),s&&u&&d&&(c==="AM"&&(d[0]==="00"&&d.length===1&&u.length===0&&Number(f)>=Number(o[0])&&this._addClasses(s),u.length===0&&d.length>1&&Number(f)>=Number(p)&&this._addClasses(s),u.length>0&&d.length>1&&d[0]==="00"&&(Number(p)===Number(f)?this._addClassesWithIncludes(s,u):Number(f)>Number(p)&&this._addClasses(s)),d[0]==="00"&&d.length===1&&u.length>0&&(Number(p)===Number(f)?this._addClassesWithIncludes(s,u):Number(f)>Number(p)&&this._addClasses(s))),c==="PM"&&(f<Number(h)&&this._addClasses(s),f===h&&this._addClassesWithIncludes(s,d),d.length>0&&Number(f)===h-1&&this._addClassesWithIncludes(s,d)))}},this._removeClasses=i=>{i==null||i.forEach(({classList:n,children:r})=>{n.remove("timepicker-ui-tips-disabled"),r[0].classList.remove("timepicker-ui-tips-disabled"),r[0].tabIndex=0})},this._addClasses=i=>{i==null||i.forEach(({classList:n,children:r})=>{n.add("timepicker-ui-tips-disabled"),r[0].classList.add("timepicker-ui-tips-disabled"),r[0].tabIndex=-1})},this._addClassesWithIncludes=(i,n)=>{i==null||i.forEach(({classList:r,children:a,textContent:s})=>{n!=null&&n.includes(s)&&(r.add("timepicker-ui-tips-disabled"),a[0].classList.add("timepicker-ui-tips-disabled"),a[0].tabIndex=-1)})},this.array=e==null?void 0:e.array,this.classToAdd=e==null?void 0:e.classToAdd,this.clockFace=e==null?void 0:e.clockFace,this.tipsWrapper=e==null?void 0:e.tipsWrapper,this.theme=e==null?void 0:e.theme,this.clockType=e==null?void 0:e.clockType,this.disabledTime=e==null?void 0:e.disabledTime,this.hour=e==null?void 0:e.hour}}const $ee=(t,e)=>{let i;return(...n)=>{clearTimeout(i),i=setTimeout(()=>{t(...n)},e)}};class Xot{constructor(e,i){var n,r,a;this.create=()=>{this._updateInputValueWithCurrentTimeOnStart(),this._checkDisabledValuesOnStart(),this._setTimepickerClassToElement(),this._setInputClassToInputElement(),this._setDataOpenToInputIfDosentExistInWrapper(),this._setClassTopOpenElement(),this._handleOpenOnEnterFocus(),this._handleOpenOnClick(),this._getDisableTime()},this.open=s=>{this.create(),this._eventsBundle(),uN(s)},this.close=()=>$ee((...s)=>{var o;if(s.length>2||!this.modalElement)return;const[l]=s.filter(u=>typeof u=="boolean"),[c]=s.filter(u=>typeof u=="function");l&&(this._handleOkButton(),(o=this.okButton)===null||o===void 0||o.click()),this._isTouchMouseMove=!1,NB.split(" ").map(u=>document.removeEventListener(u,this._mutliEventsMoveHandler,!1)),document.removeEventListener("mousedown",this._eventsClickMobileHandler),document.removeEventListener("touchstart",this._eventsClickMobileHandler),document.removeEventListener("keypress",this._handleEscClick),this.wrapper.removeEventListener("keydown",this._focusTrapHandler),this._options.enableSwitchIcon&&(this.keyboardClockIcon.removeEventListener("touchstart",this._handlerViewChange()),this.keyboardClockIcon.removeEventListener("mousedown",this._handlerViewChange())),this._removeAnimationToClose(),this.openElement.forEach(u=>u==null?void 0:u.classList.remove("disabled")),setTimeout(()=>{document.body.style.overflowY="",document.body.style.paddingRight=""},400),this.openElement.forEach(u=>u==null?void 0:u.classList.remove("disabled")),setTimeout(()=>{var u;this._options.focusInputAfterCloseModal&&((u=this.input)===null||u===void 0||u.focus()),this.modalElement!==null&&(this.modalElement.remove(),this._isModalRemove=!0)},300),uN(c)},this._options.delayHandler||300),this.destroy=s=>{NB.split(" ").map(o=>document.removeEventListener(o,this._mutliEventsMoveHandler,!1)),document.removeEventListener("mousedown",this._eventsClickMobileHandler),document.removeEventListener("touchstart",this._eventsClickMobileHandler),this._options.enableSwitchIcon&&this.keyboardClockIcon&&(this.keyboardClockIcon.removeEventListener("touchstart",this._handlerViewChange()),this.keyboardClockIcon.removeEventListener("mousedown",this._handlerViewChange())),this._cloned=this._element.cloneNode(!0),this._element.after(this._cloned),this._element.remove(),this._element=null,this._element===null&&uN(s),this._element=this._cloned},this.update=(s,o)=>{this._options=Object.assign(Object.assign({},this._options),s.options),this._checkMobileOption(),s.create&&this.create(),uN(o)},this._preventClockTypeByCurrentTime=()=>{var s,o,l,c,u;if(typeof((s=this._options)===null||s===void 0?void 0:s.currentTime)!="boolean"&&(!((l=(o=this._options)===null||o===void 0?void 0:o.currentTime)===null||l===void 0)&&l.preventClockType)||typeof((c=this._options)===null||c===void 0?void 0:c.currentTime)=="boolean"&&(!((u=this._options)===null||u===void 0)&&u.currentTime)){const{currentTime:d,clockType:p}=this._options,{type:h}=pd(this.input,p,d,!0);this._options.clockType=h?"12h":"24h"}},this._updateInputValueWithCurrentTimeOnStart=()=>{var s,o,l,c,u;if(typeof((s=this._options)===null||s===void 0?void 0:s.currentTime)!="boolean"&&(!((l=(o=this._options)===null||o===void 0?void 0:o.currentTime)===null||l===void 0)&&l.updateInput)||typeof((c=this._options)===null||c===void 0?void 0:c.currentTime)=="boolean"&&(!((u=this._options)===null||u===void 0)&&u.currentTime)){const{hour:d,minutes:p,type:h}=pd(this.input,this._options.clockType,this._options.currentTime);this.input.value=h?`${d}:${p} ${h}`:`${d}:${p}`}},this._setTheme=()=>{var s,o;const l=(s=this.modalElement)===null||s===void 0?void 0:s.querySelectorAll("div"),c=[...(o=this.modalElement)===null||o===void 0?void 0:o.querySelectorAll("input"),...l],{theme:u}=this._options;u==="crane-straight"?c.forEach(d=>d.classList.add("crane-straight")):u==="crane-radius"?c.forEach(d=>d.classList.add("crane-straight","radius")):u==="m3"&&c.forEach(d=>d.classList.add("m3"))},this._setInputClassToInputElement=()=>{var s;$n(this.input,"timepicker-ui-input")||(s=this.input)===null||s===void 0||s.classList.add("timepicker-ui-input")},this._setDataOpenToInputIfDosentExistInWrapper=()=>{var s;this.openElementData===null&&((s=this.input)===null||s===void 0||s.setAttribute("data-open","timepicker-ui-input"))},this._setClassTopOpenElement=()=>{this.openElement.forEach(s=>s==null?void 0:s.classList.add("timepicker-ui-open-element"))},this._removeBackdrop=()=>{var s;this._options.backdrop||((s=this.modalElement)===null||s===void 0||s.classList.add("removed"),this.openElement.forEach(o=>o==null?void 0:o.classList.add("disabled")))},this._setNormalizeClass=()=>{var s,o;const l=(s=this.modalElement)===null||s===void 0?void 0:s.querySelectorAll("div");(o=this.modalElement)===null||o===void 0||o.classList.add("timepicker-ui-normalize"),l==null||l.forEach(c=>c.classList.add("timepicker-ui-normalize"))},this._setFlexEndToFooterIfNoKeyboardIcon=()=>{!this._options.enableSwitchIcon&&this.footer&&(this.footer.style.justifyContent="flex-end")},this._eventsBundle=()=>{var s,o,l,c,u,d,p,h,f,m,g,v,y;if(this._isModalRemove){if(this._handleEscClick(),this._setErrorHandler(),this._removeErrorHandler(),this.openElement.forEach(b=>b==null?void 0:b.classList.add("disabled")),(s=this.input)===null||s===void 0||s.blur(),this._setScrollbarOrNot(),this._setModalTemplate(),this._setNormalizeClass(),this._removeBackdrop(),this._setBgColorToCirleWithHourTips(),this._setOnStartCSSClassesIfClockType24h(),this._setClassActiveToHourOnOpen(),this.clockFace!==null){const b=new Gm({array:N0,classToAdd:"timepicker-ui-hour-time-12",clockFace:this.clockFace,tipsWrapper:this.tipsWrapper,theme:this._options.theme,disabledTime:!((l=(o=this._disabledTime)===null||o===void 0?void 0:o.value)===null||l===void 0)&&l.isInterval?(c=this._disabledTime)===null||c===void 0?void 0:c.value.rangeArrHour:(d=(u=this._disabledTime)===null||u===void 0?void 0:u.value)===null||d===void 0?void 0:d.hours,clockType:"12h",hour:this.hour.value});b.create(),this._options.clockType==="24h"?new Gm({array:Fee,classToAdd:"timepicker-ui-hour-time-24",clockFace:this.tipsWrapperFor24h,tipsWrapper:this.tipsWrapperFor24h,theme:this._options.theme,clockType:"24h",disabledTime:!((h=(p=this._disabledTime)===null||p===void 0?void 0:p.value)===null||h===void 0)&&h.isInterval?(f=this._disabledTime)===null||f===void 0?void 0:f.value.rangeArrHour:(g=(m=this._disabledTime)===null||m===void 0?void 0:m.value)===null||g===void 0?void 0:g.hours,hour:this.hour.value}).create():(((v=this._disabledTime)===null||v===void 0?void 0:v.value.startType)===((y=this._disabledTime)===null||y===void 0?void 0:y.value.endType)?setTimeout(()=>{var I,T,w,S,U,P,E,R;((I=this._disabledTime)===null||I===void 0?void 0:I.value.startType)===((T=this.activeTypeMode)===null||T===void 0?void 0:T.textContent)&&b.updateDisable({hoursToUpdate:(S=(w=this._disabledTime)===null||w===void 0?void 0:w.value)===null||S===void 0?void 0:S.rangeArrHour,minutesToUpdate:{endMinutes:(U=this._disabledTime)===null||U===void 0?void 0:U.value.endMinutes,removedEndHour:(P=this._disabledTime)===null||P===void 0?void 0:P.value.removedEndHour,removedStartedHour:(E=this._disabledTime)===null||E===void 0?void 0:E.value.removedStartedHour,actualHour:this.hour.value,startMinutes:(R=this._disabledTime)===null||R===void 0?void 0:R.value.startMinutes}})},300):setTimeout(()=>{var I,T,w;b.updateDisable({minutesToUpdate:{actualHour:this.hour.value,pmHours:(I=this._disabledTime)===null||I===void 0?void 0:I.value.pmHours,amHours:(T=this._disabledTime)===null||T===void 0?void 0:T.value.amHours,activeMode:(w=this.activeTypeMode)===null||w===void 0?void 0:w.textContent}})},300),b.updateDisable())}this._setFlexEndToFooterIfNoKeyboardIcon(),setTimeout(()=>{this._setTheme()},0),this._setAnimationToOpen(),this._getInputValueOnOpenAndSet(),this._toggleClassActiveToValueTips(this.hour.value),this._isMobileView||(this._setTransformToCircleWithSwitchesHour(this.hour.value),this._handleAnimationClock()),this._handleMinutesEvents(),this._handleHourEvents(),this._options.clockType!=="24h"&&(this._handleAmClick(),this._handlePmClick()),this.clockFace&&this._handleMoveHand(),this._handleCancelButton(),this._handleOkButton(),this.modalElement&&(this._setShowClassToBackdrop(),this._handleBackdropClick()),this._handleIconChangeView(),this._handleClickOnHourMobile(),this._options.focusTrap&&this._focusTrapHandler()}},this._handleOpenOnClick=()=>{this.openElement.forEach(s=>this._clickTouchEvents.forEach(o=>s==null?void 0:s.addEventListener(o,()=>this._eventsBundle())))},this._getInputValueOnOpenAndSet=()=>{var s,o;const l=pd(this.input,this._options.clockType,this._options.currentTime);if(l===void 0)return this.hour.value="12",this.minutes.value="00",Qd(this._element,"show",{hour:this.hour.value,minutes:this.minutes.value,type:(s=this.activeTypeMode)===null||s===void 0?void 0:s.dataset.type,degreesHours:this._degreesHours,degreesMinutes:this._degreesMinutes}),void(this._options.clockType!=="24h"&&this.AM.classList.add("active"));let[c,u,d]=this.input.value.split(":").join(" ").split(" ");this.input.value.length===0&&(c=l.hour,u=l.minutes,d=l.type),this.hour.value=c,this.minutes.value=u;const p=document.querySelector(`[data-type='${d}']`);this._options.clockType!=="24h"&&p&&p.classList.add("active"),Qd(this._element,"show",Object.assign(Object.assign({},l),{type:(o=this.activeTypeMode)===null||o===void 0?void 0:o.dataset.type,degreesHours:this._degreesHours,degreesMinutes:this._degreesMinutes}))},this._handleCancelButton=()=>{this._clickTouchEvents.forEach(s=>{this.cancelButton.addEventListener(s,()=>{var o;const l=pd(this.input,this._options.clockType);Qd(this._element,"cancel",Object.assign(Object.assign({},l),{hourNotAccepted:this.hour.value,minutesNotAccepted:this.minutes.value,type:(o=this.activeTypeMode)===null||o===void 0?void 0:o.dataset.type,degreesHours:this._degreesHours,degreesMinutes:this._degreesMinutes})),this.close()()})})},this._handleOkButton=()=>{this._clickTouchEvents.forEach(s=>{var o;(o=this.okButton)===null||o===void 0||o.addEventListener(s,()=>{var l,c,u;const{clockType:d,disabledTime:p}=this._options,h=Mv(this.hour.value,"hour",d),f=Mv(this.minutes.value,"minutes",d);let m;const g=dN(this.hour.value,"hour",d,p==null?void 0:p.hours),v=dN(this.minutes.value,"minutes",d,p==null?void 0:p.minutes);if(p!=null&&p.interval&&(m=((y,b,I,T)=>{const w=I?MB(`${y}:${b} ${I}`.trim()):`${y}:${b}`.trim();let S,U;if(I){const[P,E]=T.trim().split("-").map(R=>R.trim());S=MB(P),U=MB(E)}else{const[P,E]=T.trim().split("-"),R=C=>C.trim().split(":").map(M=>Number(M)<=9?`0${Number(M)}`:M).join(":");S=R(P),U=R(E)}return w<S||w>U})(this.hour.value,this.minutes.value,(l=this.activeTypeMode)===null||l===void 0?void 0:l.textContent,p.interval)),m===!1||h===!1||f===!1||g===!1||v===!1)return m!==!1&&f&&v||this.minutes.classList.add("invalid-value"),void(m!==!1&&h&&g||this.hour.classList.add("invalid-value"));this.input.value=`${this.hour.value}:${this.minutes.value} ${this._options.clockType==="24h"?"":(c=this.activeTypeMode)===null||c===void 0?void 0:c.dataset.type}`.trimEnd(),Qd(this._element,"accept",{hour:this.hour.value,minutes:this.minutes.value,type:(u=this.activeTypeMode)===null||u===void 0?void 0:u.dataset.type,degreesHours:this._degreesHours,degreesMinutes:this._degreesMinutes}),this.close()()})})},this._setShowClassToBackdrop=()=>{this._options.backdrop&&setTimeout(()=>{this.modalElement.classList.add("show")},300)},this._handleBackdropClick=()=>{var s;(s=this.modalElement)===null||s===void 0||s.addEventListener("click",o=>{var l;const c=o.target;if(!$n(c,"timepicker-ui-modal"))return;const u=pd(this.input,this._options.clockType);Qd(this._element,"cancel",Object.assign(Object.assign({},u),{hourNotAccepted:this.hour.value,minutesNotAccepted:this.minutes.value,type:(l=this.activeTypeMode)===null||l===void 0?void 0:l.dataset.type,degreesHours:this._degreesHours,degreesMinutes:this._degreesMinutes})),this.close()()})},this._setBgColorToCirleWithHourTips=()=>{if(!this._options)return;const{mobile:s,theme:o}=this._options;s||this.circle===null||(this.circle.style.backgroundColor=o==="crane-straight"||o==="crane-radius"?Q1.cranered400:Q1.purple)},this._setBgColorToCircleWithMinutesTips=()=>{const{theme:s}=this._options;this.minutes.value&&vb.includes(this.minutes.value)&&(this.circle.style.backgroundColor=s==="crane-straight"||s==="crane-radius"?Q1.cranered400:Q1.purple,this.circle.classList.remove("small-circle"))},this._removeBgColorToCirleWithMinutesTips=()=>{this.minutes.value&&vb.includes(this.minutes.value)||(this.circle.style.backgroundColor="",this.circle.classList.add("small-circle"))},this._setTimepickerClassToElement=()=>{var s;(s=this._element)===null||s===void 0||s.classList.add("timepicker-ui")},this._setClassActiveToHourOnOpen=()=>{var s;this._options.mobile||this._isMobileView||(s=this.hour)===null||s===void 0||s.classList.add("active")},this._setMinutesToClock=s=>{var o,l,c,u,d;this.clockFace!==null&&this._setTransformToCircleWithSwitchesMinutes(s),this._removeBgColorToCirleWithMinutesTips();const p=!((l=(o=this._disabledTime)===null||o===void 0?void 0:o.value)===null||l===void 0)&&l.minutes?(u=(c=this._disabledTime)===null||c===void 0?void 0:c.value)===null||u===void 0?void 0:u.minutes:(d=this._disabledTime)===null||d===void 0?void 0:d.value,h=new Gm({array:vb,classToAdd:"timepicker-ui-minutes-time",clockFace:this.clockFace,tipsWrapper:this.tipsWrapper,theme:this._options.theme,disabledTime:p,hour:this.hour.value,clockType:this._options.clockType});h.create(),this._options.clockType==="12h"&&h.updateDisable(),this._toggleClassActiveToValueTips(s),this._options.clockType==="24h"&&(this.tipsWrapperFor24h.innerHTML="")},this._setHoursToClock=s=>{var o,l,c,u,d;if(this.clockFace!==null){this._setTransformToCircleWithSwitchesHour(s),this._setBgColorToCirleWithHourTips();const p=!((l=(o=this._disabledTime)===null||o===void 0?void 0:o.value)===null||l===void 0)&&l.isInterval?(c=this._disabledTime)===null||c===void 0?void 0:c.value.rangeArrHour:(d=(u=this._disabledTime)===null||u===void 0?void 0:u.value)===null||d===void 0?void 0:d.hours,h=new Gm({array:N0,classToAdd:"timepicker-ui-hour-time-12",clockFace:this.clockFace,tipsWrapper:this.tipsWrapper,theme:this._options.theme,disabledTime:p,clockType:"12h",hour:this.hour.value});h.create(),this._options.clockType==="24h"?new Gm({array:Fee,classToAdd:"timepicker-ui-hour-time-24",clockFace:this.tipsWrapperFor24h,tipsWrapper:this.tipsWrapperFor24h,theme:this._options.theme,clockType:"24h",disabledTime:p,hour:this.hour.value}).create():h.updateDisable(),this._toggleClassActiveToValueTips(s)}},this._setTransformToCircleWithSwitchesHour=s=>{const o=Number(s);let l=o>12?30*o-360:30*o;l===360&&(l=0),l>360||(this.clockHand.style.transform=`rotateZ(${l}deg)`)},this._setTransformToCircleWithSwitchesMinutes=s=>{const o=6*Number(s);o>360||(this.clockHand.style.transform=`rotateZ(${o}deg)`)},this._handleAmClick=()=>{this._clickTouchEvents.forEach(s=>{this.AM.addEventListener(s,o=>{var l,c,u,d;if(o.target.classList.add("active"),this.PM.classList.remove("active"),this._options.clockType==="12h"&&((l=this._options.disabledTime)===null||l===void 0?void 0:l.interval)){const p=new Gm({clockFace:this.clockFace,tipsWrapper:this.tipsWrapper,array:$n(this.hour,"active")?N0:vb});((c=this._disabledTime)===null||c===void 0?void 0:c.value.startType)===((u=this._disabledTime)===null||u===void 0?void 0:u.value.endType)?setTimeout(()=>{var h,f,m,g;((h=this._disabledTime)===null||h===void 0?void 0:h.value.startType)===((f=this.activeTypeMode)===null||f===void 0?void 0:f.textContent)?p.updateDisable(Object.assign({hoursToUpdate:(g=(m=this._disabledTime)===null||m===void 0?void 0:m.value)===null||g===void 0?void 0:g.rangeArrHour},this._getDestructuringObj())):p.clean()},300):setTimeout(()=>{p.updateDisable(Object.assign({},this._getDestructuringObj(!0)))},300),p.updateDisable()}Qd(this._element,"selectamtypemode",{hour:this.hour.value,minutes:this.minutes.value,type:(d=this.activeTypeMode)===null||d===void 0?void 0:d.dataset.type,degreesHours:this._degreesHours,degreesMinutes:this._degreesMinutes})})})},this._handlePmClick=()=>{this._clickTouchEvents.forEach(s=>{this.PM.addEventListener(s,o=>{var l,c,u,d;if(o.target.classList.add("active"),this.AM.classList.remove("active"),this._options.clockType==="12h"&&((l=this._options.disabledTime)===null||l===void 0?void 0:l.interval)){const p=new Gm({clockFace:this.clockFace,tipsWrapper:this.tipsWrapper,array:$n(this.hour,"active")?N0:vb});((c=this._disabledTime)===null||c===void 0?void 0:c.value.startType)===((u=this._disabledTime)===null||u===void 0?void 0:u.value.endType)?setTimeout(()=>{var h,f,m,g;((h=this._disabledTime)===null||h===void 0?void 0:h.value.startType)===((f=this.activeTypeMode)===null||f===void 0?void 0:f.textContent)?p.updateDisable(Object.assign({hoursToUpdate:(g=(m=this._disabledTime)===null||m===void 0?void 0:m.value)===null||g===void 0?void 0:g.rangeArrHour},this._getDestructuringObj())):p.clean()},300):setTimeout(()=>{p.updateDisable(Object.assign({},this._getDestructuringObj(!0)))},300)}Qd(this._element,"selectpmtypemode",{hour:this.hour.value,minutes:this.minutes.value,type:(d=this.activeTypeMode)===null||d===void 0?void 0:d.dataset.type,degreesHours:this._degreesHours,degreesMinutes:this._degreesMinutes})})})},this._handleAnimationClock=()=>{this._options.animation&&setTimeout(()=>{var s;(s=this.clockFace)===null||s===void 0||s.classList.add("timepicker-ui-clock-animation"),setTimeout(()=>{var o;(o=this.clockFace)===null||o===void 0||o.classList.remove("timepicker-ui-clock-animation")},600)},150)},this._handleAnimationSwitchTipsMode=()=>{this.clockHand.classList.add("timepicker-ui-tips-animation"),setTimeout(()=>{var s;(s=this.clockHand)===null||s===void 0||s.classList.remove("timepicker-ui-tips-animation")},401)},this._handleClasses24h=(s,o)=>{var l;const c=s.target;this.hourTips&&this._options.clockType==="24h"&&(Number(c.textContent)>12||Number(c.textContent)===0?this._setCircleClockClasses24h():this._removeCircleClockClasses24h(),this._options.mobile||(l=this.tipsWrapperFor24h)===null||l===void 0||l.classList.remove("timepicker-ui-tips-wrapper-24h-disabled")),c&&o&&(o.value=c.value.replace(/\D+/g,""),o.click())},this._handleHourEvents=()=>{var s,o;this._inputEvents.forEach(l=>{var c;(c=this.hour)===null||c===void 0||c.addEventListener(l,u=>{var d,p,h,f,m;const g=u.target;if(this.clockFace!==null&&this._handleAnimationSwitchTipsMode(),this._options.clockType==="24h"&&(Number(g.value)>12||Number(g.value)===0?this._setCircleClockClasses24h():this._removeCircleClockClasses24h(),this._options.mobile||(d=this.tipsWrapperFor24h)===null||d===void 0||d.classList.remove("timepicker-ui-tips-wrapper-24h-disabled")),this._setHoursToClock(g.value),g.classList.add("active"),this.minutes.classList.remove("active"),this._options.clockType==="12h"&&((p=this._options.disabledTime)===null||p===void 0?void 0:p.interval)){const v=new Gm({clockFace:this.clockFace,tipsWrapper:this.tipsWrapper,array:$n(this.hour,"active")?N0:vb});((h=this._disabledTime)===null||h===void 0?void 0:h.value.startType)===((f=this._disabledTime)===null||f===void 0?void 0:f.value.endType)?setTimeout(()=>{var y,b,I,T;((y=this._disabledTime)===null||y===void 0?void 0:y.value.startType)===((b=this.activeTypeMode)===null||b===void 0?void 0:b.textContent)?v.updateDisable(Object.assign({hoursToUpdate:(T=(I=this._disabledTime)===null||I===void 0?void 0:I.value)===null||T===void 0?void 0:T.rangeArrHour},this._getDestructuringObj())):v.clean()},300):setTimeout(()=>{v.updateDisable(Object.assign({},this._getDestructuringObj(!0)))},300)}Qd(this._element,"selecthourmode",{hour:this.hour.value,minutes:this.minutes.value,type:(m=this.activeTypeMode)===null||m===void 0?void 0:m.dataset.type,degreesHours:this._degreesHours,degreesMinutes:this._degreesMinutes}),this.clockFace!==null&&this.circle.classList.remove("small-circle")})}),(s=this.hour)===null||s===void 0||s.addEventListener("blur",l=>this._handleClasses24h(l,this.hour)),(o=this.hour)===null||o===void 0||o.addEventListener("focus",l=>this._handleClasses24h(l,this.hour))},this._handleMinutesEvents=()=>{var s,o;this._inputEvents.forEach(l=>{this.minutes.addEventListener(l,c=>{var u,d,p,h,f,m;const g=c.target;if(this.clockFace!==null&&(this._handleAnimationSwitchTipsMode(),this._setMinutesToClock(g.value)),this._options.clockType==="24h"&&(this._removeCircleClockClasses24h(),this._options.mobile||(u=this.tipsWrapperFor24h)===null||u===void 0||u.classList.add("timepicker-ui-tips-wrapper-24h-disabled")),g.classList.add("active"),(d=this.hour)===null||d===void 0||d.classList.remove("active"),this._options.clockType==="12h"&&((p=this._options.disabledTime)===null||p===void 0?void 0:p.interval)){const v=new Gm({clockFace:this.clockFace,tipsWrapper:this.tipsWrapper,array:$n(this.hour,"active")?N0:vb});((h=this._disabledTime)===null||h===void 0?void 0:h.value.startType)===((f=this._disabledTime)===null||f===void 0?void 0:f.value.endType)?setTimeout(()=>{var y,b,I;((y=this._disabledTime)===null||y===void 0?void 0:y.value.startType)===((b=this.activeTypeMode)===null||b===void 0?void 0:b.textContent)?v.updateDisable(Object.assign({hoursToUpdate:(I=this._disabledTime)===null||I===void 0?void 0:I.value.rangeArrHour},this._getDestructuringObj())):v.clean()},300):setTimeout(()=>{v.updateDisable(Object.assign({},this._getDestructuringObj(!0)))},300)}Qd(this._element,"selectminutemode",{hour:this.hour.value,minutes:this.minutes.value,type:(m=this.activeTypeMode)===null||m===void 0?void 0:m.dataset.type,degreesHours:this._degreesHours,degreesMinutes:this._degreesMinutes})})}),(s=this.minutes)===null||s===void 0||s.addEventListener("blur",l=>this._handleClasses24h(l,this.minutes)),(o=this.minutes)===null||o===void 0||o.addEventListener("focus",l=>this._handleClasses24h(l,this.minutes))},this._handleEventToMoveHand=s=>{var o,l,c,u,d,p,h,f,m,g,v,y,b,I,T,w,S,U,P,E,R,C,M,_,A,N,k,O,$,F,V,j,B,z,W,Z,K,Q,J,se,ie,ce,oe,te,le,ne,me,be,Se,we,ze,Qe,ke,yt,lt,Ct,Nt,Ce,Ge,$e,at,ct;const{target:Vt,type:Me,touches:De}=s,Je=Vt,{incrementMinutes:St,incrementHours:bt,switchToMinutesAfterSelectHour:Ie}=this._options;if(!Lee(s,this.clockFace))return;const Ue=Lee(s,this.clockFace),Oe=this.clockFace.offsetWidth/2,Ee=Ue&&Math.atan2(Ue.y-Oe,Ue.x-Oe);if(Me==="mouseup"||Me==="touchend")return this._isTouchMouseMove=!1,void(Ie&&($n(Je,"timepicker-ui-value-tips")||$n(Je,"timepicker-ui-value-tips-24h")||$n(Je,"timepicker-ui-tips-wrapper"))&&this.minutes.click());if(Me!=="mousedown"&&Me!=="mousemove"&&Me!=="touchmove"&&Me!=="touchstart"||Me!=="mousedown"&&Me!=="touchstart"&&Me!=="touchmove"||(($n(Je,"timepicker-ui-clock-face")||$n(Je,"timepicker-ui-circle-hand")||$n(Je,"timepicker-ui-hour-time-12")||$n(Je,"timepicker-ui-minutes-time")||$n(Je,"timepicker-ui-clock-hand")||$n(Je,"timepicker-ui-value-tips")||$n(Je,"timepicker-ui-value-tips-24h")||$n(Je,"timepicker-ui-tips-wrapper")||$n(Je,"timepicker-ui-tips-wrapper-24h"))&&!$n(Je,"timepicker-ui-tips-disabled")?(s.preventDefault(),this._isTouchMouseMove=!0):this._isTouchMouseMove=!1),!this._isTouchMouseMove)return;if(this.minutesTips!==null){this.minutes.classList.add("active");let Fe,ht=Ee&&CB(Math.trunc(180*Ee/Math.PI)+90,St,6);if(ht===void 0)return;if(ht<0?(Fe=Math.round(360+ht/6)%60,ht=360+6*Math.round(ht/6)):(Fe=Math.round(ht/6)%60,ht=6*Math.round(ht/6)),(o=this._disabledTime)===null||o===void 0?void 0:o.value.isInterval){if(((d=this._disabledTime)===null||d===void 0?void 0:d.value.endType)===((p=this._disabledTime)===null||p===void 0?void 0:p.value.startType)){if(!((m=(f=(h=this._disabledTime)===null||h===void 0?void 0:h.value)===null||f===void 0?void 0:f.endMinutes)===null||m===void 0)&&m.includes(Fe<=9?`0${Fe}`:`${Fe}`)&&this.hour.value===((v=(g=this._disabledTime)===null||g===void 0?void 0:g.value)===null||v===void 0?void 0:v.removedEndHour)&&((y=this._disabledTime)===null||y===void 0?void 0:y.value.endType)===((b=this.activeTypeMode)===null||b===void 0?void 0:b.textContent)||!((w=(T=(I=this._disabledTime)===null||I===void 0?void 0:I.value)===null||T===void 0?void 0:T.startMinutes)===null||w===void 0)&&w.includes(Fe<=9?`0${Fe}`:`${Fe}`)&&this.hour.value===((U=(S=this._disabledTime)===null||S===void 0?void 0:S.value)===null||U===void 0?void 0:U.removedStartedHour)&&((P=this._disabledTime)===null||P===void 0?void 0:P.value.startType)===((E=this.activeTypeMode)===null||E===void 0?void 0:E.textContent))return}else if(((R=this.activeTypeMode)===null||R===void 0?void 0:R.textContent)===((C=this._disabledTime)===null||C===void 0?void 0:C.value.endType)&&(!((A=(_=(M=this._disabledTime)===null||M===void 0?void 0:M.value)===null||_===void 0?void 0:_.endMinutes)===null||A===void 0)&&A.includes(Fe<=9?`0${Fe}`:`${Fe}`)&&((N=this._disabledTime)===null||N===void 0?void 0:N.value.removedPmHour)===this.hour.value||!((k=this._disabledTime)===null||k===void 0)&&k.value.pmHours.map(Number).includes(Number(this.hour.value)))||((O=this.activeTypeMode)===null||O===void 0?void 0:O.textContent)===(($=this._disabledTime)===null||$===void 0?void 0:$.value.startType)&&(!((j=(V=(F=this._disabledTime)===null||F===void 0?void 0:F.value)===null||V===void 0?void 0:V.startMinutes)===null||j===void 0)&&j.includes(Fe<=9?`0${Fe}`:`${Fe}`)&&((B=this._disabledTime)===null||B===void 0?void 0:B.value.removedAmHour)===this.hour.value||!((z=this._disabledTime)===null||z===void 0)&&z.value.amHours.map(Number).includes(Number(this.hour.value))))return}else if(!((u=(c=(l=this._disabledTime)===null||l===void 0?void 0:l.value)===null||c===void 0?void 0:c.minutes)===null||u===void 0)&&u.includes(Fe<=9?`0${Fe}`:`${Fe}`))return;this.minutes.value=Fe>=10?`${Fe}`:`0${Fe}`,this.clockHand.style.transform=`rotateZ(${ht}deg)`,this._degreesMinutes=ht,this._toggleClassActiveToValueTips(this.minutes.value),this._removeBgColorToCirleWithMinutesTips(),this._setBgColorToCircleWithMinutesTips(),Qd(this._element,"update",Object.assign(Object.assign({},pd(this.input,this._options.clockType)),{degreesHours:this._degreesHours,degreesMinutes:this._degreesMinutes,eventType:Me,type:(W=this.activeTypeMode)===null||W===void 0?void 0:W.dataset.type}))}const Xe=De?De[0]:void 0,Et=De&&Xe?document.elementFromPoint(Xe.clientX,Xe.clientY):null;if(this.hourTips!==null){if((Z=this.hour)===null||Z===void 0||Z.classList.add("active"),!$n(Et||Je,"timepicker-ui-value-tips-24h")&&!$n(Et||Je,"timepicker-ui-tips-disabled")&&($n(Et||Je,"timepicker-ui-value-tips")||$n(Et||Je,"timepicker-ui-tips-wrapper"))){let Fe,ht=Ee&&CB(Math.trunc(180*Ee/Math.PI)+90,bt,30);if(this._degreesHours=ht,ht===void 0)return;ht<0?(Fe=Math.round(360+ht/30)%12,ht=360+ht):(Fe=Math.round(ht/30)%12,(Fe===0||Fe>12)&&(Fe=12));const ti=!((K=this._disabledTime)===null||K===void 0)&&K.value.isInterval?"rangeArrHour":"hours";if(((Q=this._disabledTime)===null||Q===void 0?void 0:Q.value.endType)===((se=(J=this._disabledTime)===null||J===void 0?void 0:J.value)===null||se===void 0?void 0:se.startType)){if(typeof((ce=(ie=this._disabledTime)===null||ie===void 0?void 0:ie.value)===null||ce===void 0?void 0:ce.endType)=="string"){if(((te=(oe=this._disabledTime)===null||oe===void 0?void 0:oe.value)===null||te===void 0?void 0:te.endType)===((le=this.activeTypeMode)===null||le===void 0?void 0:le.textContent)&&((me=(ne=this._disabledTime)===null||ne===void 0?void 0:ne.value)===null||me===void 0?void 0:me.startType)===((be=this.activeTypeMode)===null||be===void 0?void 0:be.textContent)&&(!((we=(Se=this._disabledTime)===null||Se===void 0?void 0:Se.value[ti])===null||we===void 0)&&we.includes(Fe.toString())))return}else if(!((Qe=(ze=this._disabledTime)===null||ze===void 0?void 0:ze.value[ti])===null||Qe===void 0)&&Qe.includes(Fe.toString()))return}else if(((ke=this._disabledTime)===null||ke===void 0?void 0:ke.value.startType)===((yt=this.activeTypeMode)===null||yt===void 0?void 0:yt.textContent)&&(!((lt=this._disabledTime)===null||lt===void 0)&&lt.value.amHours.includes(Fe.toString()))||((Ct=this._disabledTime)===null||Ct===void 0?void 0:Ct.value.endType)===((Nt=this.activeTypeMode)===null||Nt===void 0?void 0:Nt.textContent)&&(!((Ce=this._disabledTime)===null||Ce===void 0)&&Ce.value.pmHours.includes(Fe.toString())))return;this.clockHand.style.transform=`rotateZ(${ht}deg)`,this.hour.value=Fe>9?`${Fe}`:`0${Fe}`,this._removeCircleClockClasses24h(),this._toggleClassActiveToValueTips(Fe)}if(($n(Et||Je,"timepicker-ui-value-tips-24h")||$n(Et||Je,"timepicker-ui-tips-wrapper-24h"))&&!$n(Et||Je,"timepicker-ui-tips-disabled")){let Fe,ht=Ee&&CB(Math.trunc(180*Ee/Math.PI)+90,bt,30);if(this._degreesHours=ht,ht===void 0)return;ht<0?(Fe=Math.round(360+ht/30)%24,ht=360+ht):(Fe=Math.round(ht/30)+12,Fe===12&&(Fe="00"));const ti=!((Ge=this._disabledTime)===null||Ge===void 0)&&Ge.value.isInterval?"rangeArrHour":"hours";if(!((at=($e=this._disabledTime)===null||$e===void 0?void 0:$e.value[ti])===null||at===void 0)&&at.includes(Fe.toString()))return;this._setCircleClockClasses24h(),this.clockHand.style.transform=`rotateZ(${ht}deg)`,this.hour.value=`${Fe}`,this._toggleClassActiveToValueTips(Fe)}Qd(this._element,"update",Object.assign(Object.assign({},pd(this.input,this._options.clockType)),{degreesHours:this._degreesHours,degreesMinutes:this._degreesMinutes,eventType:Me,type:(ct=this.activeTypeMode)===null||ct===void 0?void 0:ct.dataset.type}))}},this._toggleClassActiveToValueTips=s=>{const o=this.allValueTips.find(l=>Number(l.innerText)===Number(s));this.allValueTips.map(l=>l.classList.remove("active")),o!==void 0&&o.classList.add("active")},this._handleMoveHand=()=>{this._options.mobile||this._isMobileView||NB.split(" ").forEach(s=>{s==="touchstart"||s==="touchmove"||s==="touchend"?document.addEventListener(s,this._mutliEventsMoveHandler,{passive:!1}):document.addEventListener(s,this._mutliEventsMoveHandler,!1)})},this._setModalTemplate=()=>{if(!this._options)return;const{appendModalSelector:s}=this._options;if(s!==""&&s){const o=document==null?void 0:document.querySelector(s);o==null||o.insertAdjacentHTML("beforeend",this.modalTemplate)}else document.body.insertAdjacentHTML("afterend",this.modalTemplate)},this._setScrollbarOrNot=()=>{this._options.enableScrollbar?setTimeout(()=>{document.body.style.overflowY="",document.body.style.paddingRight=""},400):(document.body.style.paddingRight=`${(()=>{const s=document.createElement("div");s.className="timepicker-ui-measure",document.body.appendChild(s);const o=s.getBoundingClientRect().width-s.clientWidth;return document.body.removeChild(s),o})()}px`,document.body.style.overflowY="hidden")},this._setAnimationToOpen=()=>{var s,o;(s=this.modalElement)===null||s===void 0||s.classList.add("opacity"),this._options.animation?setTimeout(()=>{var l;(l=this.modalElement)===null||l===void 0||l.classList.add("show")},150):(o=this.modalElement)===null||o===void 0||o.classList.add("show")},this._removeAnimationToClose=()=>{var s;this.modalElement&&(this._options.animation?setTimeout(()=>{var o;(o=this.modalElement)===null||o===void 0||o.classList.remove("show")},150):(s=this.modalElement)===null||s===void 0||s.classList.remove("show"))},this._handlerViewChange=()=>$ee(()=>{var s,o,l,c;const{clockType:u}=this._options;if($n(this.modalElement,"mobile")){const d=Mv(this.hour.value,"hour",u),p=Mv(this.minutes.value,"minutes",u);if(d===!1||p===!1)return p||this.minutes.classList.add("invalid-value"),void(d||(o=this.hour)===null||o===void 0||o.classList.add("invalid-value"));d===!0&&p===!0&&(p&&this.minutes.classList.remove("invalid-value"),d&&((l=this.hour)===null||l===void 0||l.classList.remove("invalid-value"))),this.close()(),this._isMobileView=!1,this._options.mobile=!1;const h=this.hour.value,f=this.minutes.value,m=(c=this.activeTypeMode)===null||c===void 0?void 0:c.dataset.type;setTimeout(()=>{this.destroy(),this.update({options:{mobile:!1}}),setTimeout(()=>{if(this.open(),this.hour.value=h,this.minutes.value=f,this._options.clockType==="12h"){const g=m==="PM"?"AM":"PM";this[m==="PM"?"PM":"AM"].classList.add("active"),this[g].classList.remove("active")}this._setTransformToCircleWithSwitchesHour(this.hour.value),this._toggleClassActiveToValueTips(this.hour.value),Number(this.hour.value)>12||Number(this.hour.value)===0?this._setCircleClockClasses24h():this._removeCircleClockClasses24h()},300)},300)}else{this.close()(),this._isMobileView=!0,this._options.mobile=!0;const d=this.hour.value,p=this.minutes.value,h=(s=this.activeTypeMode)===null||s===void 0?void 0:s.dataset.type;setTimeout(()=>{this.destroy(),this.update({options:{mobile:!0}}),setTimeout(()=>{if(this.open(),this.hour.value=d,this.minutes.value=p,this._options.clockType==="12h"){const f=h==="PM"?"AM":"PM";this[h==="PM"?"PM":"AM"].classList.add("active"),this[f].classList.remove("active")}},300)},300)}},this._options.delayHandler||300),this._handleIconChangeView=()=>Oee(this,void 0,void 0,function*(){this._options.enableSwitchIcon&&(/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)?this.keyboardClockIcon.addEventListener("touchstart",this._handlerViewChange()):this.keyboardClockIcon.addEventListener("click",this._handlerViewChange()))}),this._handlerClickHourMinutes=s=>Oee(this,void 0,void 0,function*(){var o,l;if(!this.modalElement)return;const{clockType:c,editable:u}=this._options,d=s.target,p=Mv(this.hour.value,"hour",c),h=Mv(this.minutes.value,"minutes",c);u&&($n(d,"timepicker-ui-hour")||$n(d,"timepicker-ui-minutes")?p!==!1&&h!==!1||(h||this.minutes.classList.add("invalid-value"),p||(l=this.hour)===null||l===void 0||l.classList.add("invalid-value")):p===!0&&h===!0&&(h&&this.minutes.classList.remove("invalid-value"),p&&((o=this.hour)===null||o===void 0||o.classList.remove("invalid-value"))))}),this._handleClickOnHourMobile=()=>{document.addEventListener("mousedown",this._eventsClickMobileHandler),document.addEventListener("touchstart",this._eventsClickMobileHandler)},this._handleKeyPress=s=>{s.key==="Escape"&&this.modalElement&&this.close()()},this._handleEscClick=()=>{document.addEventListener("keydown",this._handleKeyPress)},this._focusTrapHandler=()=>{setTimeout(()=>{var s,o;const l=(s=this.wrapper)===null||s===void 0?void 0:s.querySelectorAll('div[tabindex="0"]:not([disabled])'),c=(o=this.wrapper)===null||o===void 0?void 0:o.querySelectorAll('input[tabindex="0"]:not([disabled])');if(!l||l.length<=0||c.length<=0)return;const u=[...c,...l],d=u[0],p=u[u.length-1];this.wrapper.focus(),this.wrapper.addEventListener("keydown",({key:h,shiftKey:f,target:m})=>{const g=m;if(h==="Tab"&&(f?document.activeElement===d&&p.focus():document.activeElement===p&&d.focus()),h==="Enter"&&($n(g,"timepicker-ui-minutes")&&this.minutes.click(),$n(g,"timepicker-ui-hour")&&this.hour.click(),$n(g,"timepicker-ui-cancel-btn")&&this.cancelButton.click(),$n(g,"timepicker-ui-ok-btn")&&this.okButton.click(),$n(g,"timepicker-ui-keyboard-icon-wrapper")&&this.keyboardClockIcon.click(),$n(g,"timepicker-ui-am")&&this.AM.click(),$n(g,"timepicker-ui-pm")&&this.PM.click(),$n(g,"timepicker-ui-value-tips")||$n(g,"timepicker-ui-value-tips-24h"))){const{left:v,top:y,x:b,y:I,width:T,height:w}=g.getBoundingClientRect(),S=document.elementFromPoint(b,I);(()=>{var P;const E=new MouseEvent("mousedown",{clientX:v+T/2,clientY:y+w/2,cancelable:!0,bubbles:!0});$n(S,"timepicker-ui-value-tips-24h")?S==null||S.dispatchEvent(E):(P=S==null?void 0:S.childNodes[0])===null||P===void 0||P.dispatchEvent(E),this._isTouchMouseMove=!1})()}setTimeout(()=>{this.wrapper.addEventListener("mousedown",()=>document.activeElement.blur())},100)})},301)},this._handleOpenOnEnterFocus=()=>{this.input.addEventListener("keydown",({target:s,key:o})=>{s.disabled||o==="Enter"&&this.open()})},this._element=e,this._cloned=null,this._options=((s,o)=>Object.assign(Object.assign({},o),s))(Object.assign(Object.assign({},i),(s=>{if(!s)return;const o=JSON.parse(JSON.stringify(s)),l=Object.keys(o);return Object.values(o).reduce((c,u,d)=>(Number(u)?c[l[d]]=Number(u):c[l[d]]=u==="true"||u==="false"?JSON.parse(u):u,c),{})})((n=this._element)===null||n===void 0?void 0:n.dataset)),Zot),this._isTouchMouseMove=!1,this._degreesHours=30*Number(pd((r=this._element)===null||r===void 0?void 0:r.querySelector("input"),this._options.clockType).hour),this._degreesMinutes=6*Number(pd((a=this._element)===null||a===void 0?void 0:a.querySelector("input"),this._options.clockType).minutes),this._isMobileView=!1,this._mutliEventsMove=s=>this._handleEventToMoveHand(s),this._mutliEventsMoveHandler=this._mutliEventsMove.bind(this),this._eventsClickMobile=s=>this._handlerClickHourMinutes(s),this._eventsClickMobileHandler=this._eventsClickMobile.bind(this),this._checkMobileOption(),this._clickTouchEvents=["click","mousedown","touchstart"],this._inputEvents=["change",...this._clickTouchEvents],this._disabledTime=null,this._preventClockTypeByCurrentTime(),this._isModalRemove=!0}get modalTemplate(){return this._options.mobile&&this._isMobileView?(e=>{const{mobileTimeLabel:i,amLabel:n,pmLabel:r,cancelLabel:a,okLabel:s,iconTemplateMobile:o,minuteMobileLabel:l,hourMobileLabel:c,enableSwitchIcon:u,animation:d,clockType:p}=e;return`
  <div class="timepicker-ui-modal normalize mobile" role="dialog" style='transition:${d?"opacity 0.15s linear":"none"}'>
    <div class="timepicker-ui-wrapper mobile" tabindex="0">
      <div class="timepicker-ui-header mobile">
        <div class="timepicker-ui-select-time mobile">${i}</div>
        <div class="timepicker-ui-wrapper-time mobile">
          <input class="timepicker-ui-hour mobile" tabindex="0" type="number" min="0" max="${p==="12h"?"12":"23"}" />
          <div class="timepicker-ui-hour-text mobile">${c}</div>
          <div class="timepicker-ui-dots mobile">:</div>  
          <div class="timepicker-ui-minute-text mobile">${l}</div>
          <input class="timepicker-ui-minutes mobile" tabindex="0" type="number" min="0" max="59" /> 
        </div>
  ${p!=="24h"?`<div class="timepicker-ui-wrapper-type-time mobile">
          <div class="timepicker-ui-type-mode timepicker-ui-am mobile" data-type="AM" tabindex="0">${n}</div>    
          <div class="timepicker-ui-type-mode timepicker-ui-pm mobile" data-type="PM" tabindex="0">${r}</div>    
        </div>`:""}
      </div>
      <div class="timepicker-ui-footer mobile" data-view="mobile">
      ${u?`
      <div class="timepicker-ui-keyboard-icon-wrapper mobile" role="button" aria-pressed="false" data-view="desktop" tabindex="0">
      ${o}
      </div>`:""}
      <div class="timepicker-ui-wrapper-btn mobile">
        <div class="timepicker-ui-cancel-btn mobile" role="button" aria-pressed="false" tabindex="0">${a}</div>
        <div class="timepicker-ui-ok-btn mobile" role="button" aria-pressed="false" tabindex="0">${s}</div>
      </div>
      </div>
    </div>  
  </div>`})(this._options):(e=>{const{iconTemplate:i,timeLabel:n,amLabel:r,pmLabel:a,cancelLabel:s,okLabel:o,enableSwitchIcon:l,animation:c,clockType:u,editable:d}=e;return`
  <div class="timepicker-ui-modal normalize" role="dialog" style='transition:${c?"opacity 0.15s linear":"none"}'>
    <div class="timepicker-ui-wrapper" tabindex="0">
      <div class="timepicker-ui-header">
        <div class="timepicker-ui-select-time">${n}</div>
        <div class="timepicker-ui-wrapper-time ${u==="24h"?"timepicker-ui-wrapper-time-24h":""}">
          <input ${d?"":"readonly"} class="timepicker-ui-hour" tabindex="0" type="number" min="0" max="${u==="12h"?"12":"23"}" />
          <div class="timepicker-ui-dots">:</div>    
          <input ${d?"":"readonly"} class="timepicker-ui-minutes" tabindex="0" type="number" min="0" max="59" /> 
        </div>
      ${u!=="24h"?`
      <div class="timepicker-ui-wrapper-type-time">
        <div class="timepicker-ui-type-mode timepicker-ui-am" tabindex="0" role="button" data-type="AM">${r}</div>    
        <div class="timepicker-ui-type-mode timepicker-ui-pm" tabindex="0" role="button" data-type="PM">${a}</div>    
      </div>
      `:""}
      </div>
      <div class="timepicker-ui-wrapper-landspace">
        <div class="timepicker-ui-body">
          <div class="timepicker-ui-clock-face">
            <div class="timepicker-ui-dot"></div>
            <div class="timepicker-ui-clock-hand">
              <div class="timepicker-ui-circle-hand"></div>
            </div>
            <div class="timepicker-ui-tips-wrapper"></div>
            ${u==="24h"?'<div class="timepicker-ui-tips-wrapper-24h"></div>':""}
          </div>
        </div>
        <div class="timepicker-ui-footer">
        ${l?`
      <div class="timepicker-ui-keyboard-icon-wrapper" tabindex="0" role="button" aria-pressed="false" data-view="desktop">
        ${i}
      </div>`:""}
        <div class="timepicker-ui-wrapper-btn" >
          <div class="timepicker-ui-cancel-btn" tabindex="0" role="button" aria-pressed="false">${s}</div>
          <div class="timepicker-ui-ok-btn" tabindex="0" role="button" aria-pressed="false">${o}</div>
        </div>
        </div>
      </div>
    </div>  
  </div>`})(this._options)}get modalElement(){return document.querySelector(".timepicker-ui-modal")}get clockFace(){return document.querySelector(".timepicker-ui-clock-face")}get input(){var e;return(e=this._element)===null||e===void 0?void 0:e.querySelector("input")}get clockHand(){return document.querySelector(".timepicker-ui-clock-hand")}get circle(){return document.querySelector(".timepicker-ui-circle-hand")}get tipsWrapper(){return document.querySelector(".timepicker-ui-tips-wrapper")}get tipsWrapperFor24h(){return document.querySelector(".timepicker-ui-tips-wrapper-24h")}get minutes(){return document.querySelector(".timepicker-ui-minutes")}get hour(){return document.querySelector(".timepicker-ui-hour")}get AM(){return document.querySelector(".timepicker-ui-am")}get PM(){return document.querySelector(".timepicker-ui-pm")}get minutesTips(){return document.querySelector(".timepicker-ui-minutes-time")}get hourTips(){return document.querySelector(".timepicker-ui-hour-time-12")}get allValueTips(){return[...document.querySelectorAll(".timepicker-ui-value-tips"),...document.querySelectorAll(".timepicker-ui-value-tips-24h")]}get openElementData(){var e;const i=(e=this._element)===null||e===void 0?void 0:e.querySelectorAll("[data-open]");if((i==null?void 0:i.length)>0){const n=[];return i.forEach(({dataset:r})=>{var a;return n.push((a=r.open)!==null&&a!==void 0?a:"")}),[...new Set(n)]}return null}get openElement(){var e,i;return this.openElementData===null?((e=this.input)===null||e===void 0||e.setAttribute("data-open","timepicker-ui-input"),[this.input]):(i=this.openElementData.map(n=>{var r;return(r=this._element)===null||r===void 0?void 0:r.querySelectorAll(`[data-open='${n}']`)})[0])!==null&&i!==void 0?i:""}get cancelButton(){return document.querySelector(".timepicker-ui-cancel-btn")}get okButton(){return document.querySelector(".timepicker-ui-ok-btn")}get activeTypeMode(){return document.querySelector(".timepicker-ui-type-mode.active")}get keyboardClockIcon(){return document.querySelector(".timepicker-ui-keyboard-icon-wrapper")}get footer(){return document.querySelector(".timepicker-ui-footer")}get wrapper(){return document.querySelector(".timepicker-ui-wrapper")}_checkDisabledValuesOnStart(){if(!this._options.disabledTime||this._options.disabledTime.interval)return;const{disabledTime:{hours:e,minutes:i},clockType:n}=this._options,r=!e||dN(e,"hour",n),a=!i||dN(i,"minutes",n);if(!r||!a)throw new Error("You set wrong hours or minutes in disabled option")}_checkMobileOption(){this._isMobileView=!!this._options.mobile,this._options.mobile&&(this._options.editable=!0)}_getDisableTime(){this._disabledTime=(e=>{if(!e)return;const{disabledTime:i,clockType:n}=e;if(!i||Object.keys(i).length<=0||i.constructor.name!=="Object")return;const{hours:r,interval:a,minutes:s}=i;if(a){delete i.hours,delete i.minutes;const[o,l]=a.toString().split("-"),{hour:c,minutes:u,type:d}=pd({value:o.trimEnd()},n),{hour:p,minutes:h,type:f}=pd({value:l.trimEnd().trimStart()},n);let m=cN(c,p).map(b=>b==="00"||Number(b)===0?`0${Number(b)}`:`${Number(b)}`);const g=[],v=Number(u),y=Number(h);if(f===d)return v>0&&y<=0?(g.push(m[0],m[m.length-1]),m=m.slice(1,-1)):y<59&&y>0&&v<=0?(g.push(void 0,m[m.length-1]),m=m.slice(0,-1)):y>0&&v>0?(g.push(m[0],m[m.length-1]),m=m.slice(1,-1)):y===0&&v===0&&(g.push(void 0,m[m.length-1]),m.pop()),{value:{removedStartedHour:Number(g[0])<=9?`0${g[0]}`:g[0],removedEndHour:Number(g[1])<=9?`0${g[1]}`:g[1],rangeArrHour:m,isInterval:!0,startMinutes:cN(u,59).map(b=>Number(b)<=9?`0${b}`:`${b}`),endMinutes:RB(0,h).map(b=>Number(b)<=9?`0${b}`:`${b}`),endType:f,startType:d}};{const b=cN(c,12).map(String),I=RB(1,p).map(String),T=[],w=[];return v>0&&y<=0?(T.push(I[I.length-1]),w.push(b[0]),I.splice(-1,1),b.splice(0,1)):y<59&&y>0&&v<=0?(w.push(b[0]),T.push(I[I.length-1]),I.splice(-1,1)):y>0&&v>0?(T.push(I[I.length-1]),w.push(b[0]),I.splice(-1,1),b.splice(0,1)):y===0&&v===0&&(T.push(I[I.length-1]),w.push(b[0]),I.pop()),{value:{isInterval:!0,endType:f,startType:d,pmHours:I,amHours:b,startMinutes:Number(u)===0?[]:cN(u,59).map(S=>Number(S)<=9?`0${S}`:`${S}`),endMinutes:RB(0,h).map(S=>Number(S)<=9?`0${S}`:`${S}`),removedAmHour:Number(w[0])<=9?`0${w[0]}`:w[0],removedPmHour:Number(T[0])<=9?`0${T[0]}`:T[0]}}}}return r==null||r.forEach(o=>{if(n==="12h"&&Number(o)>12)throw new Error("The disabled hours value has to be less than 13");if(n==="24h"&&Number(o)>23)throw new Error("The disabled hours value has to be less than 24")}),s==null||s.forEach(o=>{if(Number(o)>59)throw new Error("The disabled minutes value has to be less than 60")}),{value:{hours:r==null?void 0:r.map(o=>o==="00"||Number(o)===0?`0${Number(o)}`:`${Number(o)}`),minutes:s==null?void 0:s.map(o=>Number(o)<=9?`0${o}`:`${o}`)}}})(this._options)}_removeCircleClockClasses24h(){var e,i;(e=this.circle)===null||e===void 0||e.classList.remove("timepicker-ui-circle-hand-24h"),(i=this.clockHand)===null||i===void 0||i.classList.remove("timepicker-ui-clock-hand-24h")}_setCircleClockClasses24h(){var e,i;this.circle&&((e=this.circle)===null||e===void 0||e.classList.add("timepicker-ui-circle-hand-24h")),this.clockHand&&((i=this.clockHand)===null||i===void 0||i.classList.add("timepicker-ui-clock-hand-24h"))}_setErrorHandler(){var e,i,n,r;const{error:a,currentHour:s,currentMin:o,currentType:l,currentLength:c}=pd(this.input,this._options.clockType);if(a){const u=document.createElement("div");throw(e=this.input)===null||e===void 0||e.classList.add("timepicker-ui-invalid-format"),u.classList.add("timepicker-ui-invalid-text"),u.innerHTML="<b>Invalid Time Format</b>",!((i=this.input)===null||i===void 0)&&i.parentElement&&((n=this.input)===null||n===void 0?void 0:n.parentElement.querySelector(".timepicker-ui-invalid-text"))===null&&((r=this.input)===null||r===void 0||r.after(u)),Qd(this._element,"geterror",{error:a,currentHour:s,currentMin:o,currentType:l,currentLength:c}),new Error(`Invalid Time Format: ${a}`)}}_removeErrorHandler(){var e,i;(e=this.input)===null||e===void 0||e.classList.remove("timepicker-ui-invalid-format");const n=(i=this._element)===null||i===void 0?void 0:i.querySelector(".timepicker-ui-invalid-text");n&&n.remove()}_setOnStartCSSClassesIfClockType24h(){if(this._options.clockType==="24h"){let{hour:e}=pd(this.input,this._options.clockType,this._options.currentTime);this.input.value.length>0&&(e=this.input.value.split(":")[0]),(Number(e)>12||Number(e)===0)&&this._setCircleClockClasses24h()}}_getDestructuringObj(e){var i;const{endMinutes:n,removedEndHour:r,removedStartedHour:a,startMinutes:s,pmHours:o,amHours:l,removedAmHour:c,removedPmHour:u}=this._disabledTime.value;return e?{minutesToUpdate:{actualHour:this.hour.value,pmHours:o,amHours:l,activeMode:(i=this.activeTypeMode)===null||i===void 0?void 0:i.textContent,startMinutes:s,endMinutes:n,removedAmHour:c,removedPmHour:u}}:{minutesToUpdate:{endMinutes:n,removedEndHour:r,removedStartedHour:a,actualHour:this.hour.value,startMinutes:s}}}}function PEe({time:t,options:e,callback:i}={}){const n=document.getElementById("timepicker"),r=document.getElementById("timevalue");r.value=Jot(t);const a=new Xot(document.getElementById("timepicker"),{switchToMinutesAfterSelectHour:!0,clockType:"12h",...e});a.create(),a.open(),n.addEventListener("accept",()=>{const s=r.value;Ot(i)&&i({time:s}),a.destroy()})}function Jot(t,e){var n;let i=Qot(t||((n=e==null?void 0:e.schedule)==null?void 0:n.default_time));return i.ampm?t:(i.hours>12?(i.hours-=12,i.ampm="PM"):i.hours==="12"?i.ampm="PM":(i.hours==="00"&&(i.hours="12"),i.ampm="AM"),`${i.hours||"12"}:${i.minutes||"00"} ${i.ampm}`)}function Qot(t){t=t||"00:00";let e={},i={};return{0:e.time,1:e.ampm}=t&&t.split(" ")||"",{0:i.hours,1:i.minutes}=e.time&&e.time.split(":")||"",i.ampm=e.ampm,i}const{AFTER_REST:Bee,FOLLOWED_BY:Vee,NEXT_AVAILABLE:jee,NOT_BEFORE:Gee,TO_BE_ANNOUNCED:Hee}=qx;function CEe({e:t,cell:e,callback:i,matchUpId:n}={}){var g;const r=e.getRow().getData(),a=v=>{const y=Object.values(r).filter(w=>w==null?void 0:w.matchUpId),I=[{params:{matchUpIds:n?[n]:y.map(({matchUpId:w})=>w),schedule:v,removePriorValues:!0},method:sY}];ii({methods:I,callback:w=>{w.success&&Ot(i)&&i(v)}})},s=v=>TM({matchUp:v,matchUpId:n,callback:i}),o=()=>a({scheduledTime:"",timeModifiers:[]}),l=({time:v})=>{const b=_i.dateTime.convertTime(v,!0);a({scheduledTime:b})},c=()=>{const y=e.getTable().getData();let b;const I=y.flatMap((U,P)=>{if(!b&&!(U.rowId===r.rowId&&(b=P+1,P)))return Object.values(U).flatMap(E=>{var R;return(R=E==null?void 0:E.schedule)==null?void 0:R.scheduledTime})}).filter(Boolean).map(Srt),T=Math.max(...I,0),w=b>1,S=T&&Trt(T,w)||"8:00 AM";PEe({time:S,callback:l})},u=v=>a({timeModifiers:[v]}),d=n?"Set match time":"Set match times",p=Object.values(e.getData()).find(v=>(v==null?void 0:v.matchUpId)===n),h=(p==null?void 0:p.readyToScore)||(p==null?void 0:p.winningSide)||((g=p==null?void 0:p.score)==null?void 0:g.sets),f=[{option:d,onClick:c},h&&{option:"Enter score",onClick:()=>s(p)},{option:U1[Vee],onClick:()=>u(Vee)},{option:U1[jee],onClick:()=>u(jee)},{option:U1[Gee],onClick:()=>u(Gee)},{option:U1[Bee],onClick:()=>u(Bee)},{option:U1[Hee],onClick:()=>u(Hee)},{option:"Clear time settings",onClick:o}].filter(Boolean),m=t.target;Ic({options:f,target:m,config:{placement:oi}})}function elt({column:t,courtInfo:e}){const i=e.courtId;er({title:"Rename Court",content:a=>Sr(a,[{value:e.courtName,label:"Court Name",field:"courtName"}]),buttons:[{label:"Cancel",intent:"none",close:!0},{label:"Rename",intent:"is-primary",onClick:({content:a})=>{const s=a==null?void 0:a.courtName.value;s.length&&s!==e.courtName&&ii({methods:[{method:a1e,params:{courtId:i,modifications:{courtName:s}}}],callback:c=>{c.success?t.updateDefinition({title:s}):console.log({result:c})}})},close:!0}]})}function tlt(t,e,i){const r=[{option:`${Cs.tr("remove")} court identifiers`,onClick:s},{option:Cs.tr("rename"),onClick:()=>elt({column:e,courtInfo:i})}],a=t.target;Ic({options:r,target:a});function s(){console.log("toggle court identifiers",{column:e})}}async function ilt(t,e){t.preventDefault();const i=t.dataTransfer.getData("itemid"),n=[],r=e.getTable(),a=r.getData(),s=e.getRow().getData();let o=r.getData().flatMap(R=>Object.values(R).filter(C=>C.matchUpId)),l=o.find(R=>R.matchUpId===i);l||(l=As.findTable(`#${Gb}`)[0].getData().map(M=>M.matchUp).find(M=>M.matchUpId===i)||{});const c=It.displayed.selectedScheduleDate,{courtOrder:u,courtId:d,venueId:p}=l.schedule||{},h=t.currentTarget,f=h.id;if(i===f)return;const m=l.schedule,g=f&&o.find(R=>R.matchUpId===f),v=h.getAttribute("venueId"),y=h.getAttribute("courtId"),b=h.getAttribute("courtOrder"),I=Object.keys(s).find(R=>{var N;if(!Up(s[R]))return;const C=((N=s[R])==null?void 0:N.schedule)||{},{courtOrder:M,courtId:_,venueId:A}=C;return(M==null?void 0:M.toString())===b.toString()&&A===v&&_===y});let T;const w=a.find(R=>(T=Object.keys(R).find(C=>{var k;if(!Up(R[C]))return;const M=((k=R[C])==null?void 0:k.schedule)||{},{courtOrder:_,courtId:A,venueId:N}=M;return _===u&&N===p&&A===d}),T)),S=()=>{ii({methods:n,engine:Z4,callback:C=>{!C.success&&console.log({result:C}),Ik(r)}})},U=({scheduledTime:R="",timeModifiers:C=[]}={})=>{const M={courtOrder:b,scheduledDate:c,venueId:v,courtId:y,scheduledTime:R,timeModifiers:C};n.push({method:MG,params:{tournamentId:l==null?void 0:l.tournamentId,matchUpId:l==null?void 0:l.matchUpId,schedule:M,drawId:l==null?void 0:l.drawId,removePriorValues:!0}}),l.schedule=M},P={scheduledDate:m==null?void 0:m.scheduledDate,scheduledTime:m==null?void 0:m.scheduledTime,timeModifiers:m==null?void 0:m.timeModifiers,courtOrder:u,venueId:p,courtId:d},E=()=>{n.push({method:MG,params:{tournamentId:g==null?void 0:g.tournamentId,matchUpId:g==null?void 0:g.matchUpId,schedule:P,drawId:g==null?void 0:g.drawId,removePriorValues:!0}}),g?g.schedule=P:console.log("missing targetMatchUp")};if(f==="")w?(U(),w[T]={schedule:{courtOrder:u,venueId:p,courtId:d}},w.rowId==s.rowId?(w[I]=l,r.updateData([w])):(s[I]=l,r.updateData([w,s]))):(As.findTable(`#${Gb}`)[0].deleteRow(i),U(),s[I]=l,r.updateData([s]));else if(!w&&g){const R=As.findTable(`#${Gb}`)[0];R.deleteRow(i),U(),s[I]=l,r.updateData([s]),R.addRow(d1(g),!0),E()}else{const R=g==null?void 0:g.schedule;U({scheduledTime:R==null?void 0:R.scheduledTime,timeModifiers:R==null?void 0:R.timeModifiers}),E(),w.rowId==s.rowId?(w[T]=g,w[I]=l,r.updateData([w])):(w[T]=g,s[I]=l,r.updateData([w,s]))}S()}const{SCHEDULE_STATE:nlt,SCHEDULE_ERROR:rlt,SCHEDULE_WARNING:alt,SCHEDULE_CONFLICT:slt}=Uo.scheduleConstants;function REe(t){var M;const e=document.createElement("span");if(!t.getColumn().getDefinition().field)return e.className="schedule-cell",e;const n=t.getValue(),{potentialParticipants:r,eventName:a="",roundName:s="",schedule:o={},matchUpStatus:l,winningSide:c,matchUpId:u,sides:d}=n||{},{courtOrder:p="",scheduledTime:h="",courtId:f="",timeModifiers:m,venueId:g=""}=o;if(e.setAttribute("courtOrder",p),e.setAttribute("courtId",f),e.setAttribute("venueId",g),e.className="schedule-cell dragdrop",e.ondragover=_=>_.preventDefault(),u)if(e.draggable=!0,e.id=u,c)e.classList.add("matchup-complete");else{const _=o[nlt];l==="IN_PROGRESS"?e.classList.add("matchup-inprogress"):_===slt?e.classList.add("matchup-conflict"):_===bfe?e.classList.add("matchup-issue"):_===alt?e.classList.add("matchup-warning"):_===rlt&&e.classList.add("matchup-error")}if(e.addEventListener("drop",_=>ilt(_,t)),e.addEventListener("dragstart",HDe),!u)return e;const v=`${a} ${s}`,y=_=>{var A,N;return((N=(A=_.person)==null?void 0:A.standardFamilyName)==null?void 0:N.toUpperCase())||_.participantName},b=r==null?void 0:r.map(_=>_==null?void 0:_.map(A=>`<span class='potential nowrap'>${y(A)}</span>`).join('<span style="font-weight: bold">&nbsp;or&nbsp;</span>')),I=_=>{var N,k;const A=(k=(N=d==null?void 0:d.find(O=>_===O.sideNumber))==null?void 0:N.participant)==null?void 0:k.participantName;if(A)return c===_?`<span style='font-weight: bold'>${A}</span>`:A},T=I(1)||(b==null?void 0:b.shift())||"Unkown",w=I(2)||(b==null?void 0:b.shift())||"Unknown";e.id=u;const S=document.createElement("div");S.className="header flexrow",S.innerHTML=((m==null?void 0:m[0])&&NBe[m[0]]+"&nbsp;"||"")+NY(h),e.appendChild(S);const U=document.createElement("div");U.className="catround",U.innerHTML=v,e.appendChild(U);const P=document.createElement("div");P.className="scheduled_teams";const E=document.createElement("div");E.className="scheduled_team",E.style="font-size: 1em",E.innerHTML=T,P.appendChild(E);const R=document.createElement("div");R.className="divider",R.innerHTML="vs.",P.appendChild(R);const C=document.createElement("div");if(C.className="scheduled_team",C.style="font-size: 1em",C.innerHTML=w,P.appendChild(C),c){const _=document.createElement("div");_.innerHTML=((M=n.score)==null?void 0:M.scoreStringSide1)||"",P.appendChild(_)}return e.appendChild(P),e}function olt({values:t,valueChange:e,isValid:i}){const n=(s,o)=>l=>l.length>=s&&(!o||o&&l.length<=o),r=s=>!isNaN(s),a=s=>e(s);return[{error:"Please enter a name of at least 5 characters",placeholder:"Venue name",value:t.venueName||"",validator:n(5),label:"Venue name",field:"venueName",focus:!0,onChange:a},{error:"Please enter an abbreviation of 2-6 characters",value:t.venueAbbreviation||"",validator:n(2,6),field:"venueAbbreviation",label:"Abbreviation",onChange:a},{error:"Must be a whole number",value:t.courtsCount||"",validator:r,label:"Number of courts",field:"courtsCount",onChange:a}]}function llt(t){return{venueAbbreviation:t==null?void 0:t.venueAbbreviation.value,courtsCount:t==null?void 0:t.courtsCount.value,venueName:t==null?void 0:t.venueName.value}}const clt=t=>{const e=llt(It.drawer.attributes.content),{venueName:i,venueAbbreviation:n,courtsCount:r}=e,a=_i.UUID();if(!i||!n||!r){Jt({message:"Invalid values",intent:"is-danger"});return}const s=[{params:{venue:{venueName:i,venueAbbreviation:n,venueId:a},returnDetails:!0},method:PZe},{params:{courtsCount:parseInt(r),venueId:a,venueAbbreviationRoot:!0},method:mZe}];ii({methods:s,callback:l=>{if(l!=null&&l.success&&Ot(t)){const{venue:c}=ot.findVenue({venueId:a});c&&t({...l,venue:c})}}})};function MEe(t){const e=()=>{},i=o=>o&&!isNaN(o),n=({inputs:o})=>{const l=!!(Wr(2,6)(o.venueAbbreviation.value)&&i(o.courtsCount.value)&&Wr(5)(o.venueName.value)),c=document.getElementById("addVenueButton");c&&(c.disabled=!l)},r=[{control:"venueAbbreviation",onInput:n},{control:"courtsCount",onInput:n},{control:"venueName",onInput:n}],a=o=>Sr(o,olt({values:{},valueChange:e}),r),s=(o,l)=>qw(o,[{label:"Cancel",close:!0},{onClick:()=>clt(t),id:"addVenueButton",intent:"is-info",disabled:!0,label:"Add",close:!0}],l);It.drawer.open({title:"<b style='larger'>Add venue</b>",width:"300px",side:oi,content:a,footer:s})}function ult({courtsData:t,count:e}){const i=r=>{r.stopPropagation(),r.preventDefault(),MEe(NEe)},n=r=>{if(!r)return t!=null&&t.length?"<p style='font-weight: normal; color: lightblue'>Add venue</p>":"<button class='button is-danger'>Add venue</button>"};return e>0?_i.generateRange(0,e).map(r=>({headerClick:a=>r===0&&i(a),title:n(r),headerHozAlign:mi,formatter:REe,headerSort:!1,resizable:!1,minWidth:150})):[]}function dlt({notice:t,notes:e,callback:i}){let n;er({title:"Order of play",buttons:[{label:"Cancel",intent:"is-nothing"},{label:"Save",intent:"is-info",onClick:()=>{const o=n.notice.value,l=n.notes.value;typeof i=="function"&&i({notice:o,notes:l})},close:!0}],content:o=>{n=Sr(o,[{placeholder:"appears on PDF Header",value:t,label:"Schedule notice",field:"notice"},{placeholder:"appears on PDF Footer",value:e,label:"Umpire notes",field:"notes"}])}})}const{NOT_BEFORE:zee}=qx;function plt(t,e){var r;const i=e.getRow().getData(),n=Object.values(i).filter(a=>a==null?void 0:a.matchUpId);(r=i.issues)!=null&&r.length&&console.log({issues:i.issues}),n.length&&CEe({e:t,cell:e,rowData:i,callback:s=>{if(Up(s)){const o=e.getTable(),l=o.getData().find(c=>c.rowId===i.rowId);Object.values(l).forEach(c=>{var u;c.matchUpId&&(s.scheduledTime&&(c.schedule.scheduledTime=NY(s.scheduledTime),((u=c.schedule.timeModifiers)==null?void 0:u[0])!==zee&&(c.schedule.timeModifiers=[])),s.timeModifiers&&(c.schedule.scheduledTime&&s.timeModifiers[0]!==zee&&(c.schedule.scheduledTime=""),c.schedule.timeModifiers=s.timeModifiers))}),o.updateData([l])}}})}function hlt(){function t(n){const r=n.getElement();return r.classList.add("tag"),r.classList.add("is-info"),r.classList.add("is-light"),'<i class="fa-regular fa-note-sticky"></i>'}function e(n){n.getElement().style.backgroundColor="white";const r=document.createElement("span"),a=n.getRow().getData();return r.innerHTML=a.rowNumber,r}return{titleFormatter:t,formatter:e,headerClick:()=>{dlt({notes:"",notice:"",callback:n});function n(r){console.log({result:r})}},cellClick:plt,headerSort:!1,resizable:!1,hozAlign:mi,frozen:!0,width:55}}function flt({courtsData:t,courtPrefix:e}){const i=(l,c)=>{const u=c.getColumn().getDefinition().field,{drawId:d,matchUpId:p}=c.getData()[u];CEe({e:l,cell:c,matchUpId:p,callback:()=>{var v,y;const f=(y=(v=ot.allTournamentMatchUps({matchUpFilters:{drawIds:[d],matchUpIds:[p]},nextMatchUps:!0}))==null?void 0:v.matchUps)==null?void 0:y[0],m=c.getRow().getData();m[u]=f,c.getTable().updateData([m])}})},n=PBe-(t==null?void 0:t.length)||0,r=n<=0?1:n,a=ult({courtsData:t,count:r}),s=hlt(),o=(l,c)=>({headerClick:(u,d)=>tlt(u,d,l),cellClick:i,field:`${e}${c}`,title:l.courtName,headerHozAlign:mi,formatter:REe,headerSort:!1,resizable:!1,hozAlign:mi,minWidth:150});return[s].concat(t==null?void 0:t.map(o),a)}function mlt({scheduledDate:t}={}){let e,i,n,r=[];const a=({scheduledDate:d})=>{const p={localPerspective:!0,scheduledDate:d},h=Xf.competitionScheduleMatchUps({courtCompletedMatchUps:!0,withCourtGridRows:!0,minCourtGridRows:10,nextMatchUps:!0,matchUpFilters:p}),{dateMatchUps:f=[],completedMatchUps:m=[],courtsData:g,courtPrefix:v="C|",rows:y,groupInfo:b}=h,I=f.concat(...m),T=flt({courtsData:g,courtPrefix:v});return y==null||y.forEach((w,S)=>{w.rowId=`rowId-${S+1}`,w.rowNumber=S+1}),{rows:y,columns:T,matchUps:I,courtsCount:(g==null?void 0:g.length)??0,courtsData:g,groupInfo:b}},s=({scheduledDate:d}={})=>{setTimeout(()=>{const{rows:h,matchUps:f,columns:m,courtsData:g}=a({scheduledDate:d}),v=g==null?void 0:g.map(b=>b.courtId);_i.intersection(r,v).length===(v==null?void 0:v.length)||(i.setColumns(m),r=v),n=!0,i==null||i.replaceData(h),i.matchUps=f},e?0:1e3)};km({anchorId:g_});const o=document.getElementById(g_),{rows:l=[],columns:c=[],courtsCount:u}=a({scheduledDate:t});return r=c.map(d=>d==null?void 0:d.courtId).filter(Boolean),i=new As(o,{height:window.innerHeight*.84,renderHorizontal:"virtual",placeholder:"No courts",index:"rowId",data:l,columns:c}),i.on("scrollVertical",wd),i.on("tableBuilt",()=>{Ik(i),e=!0}),i.on("dataProcessed",()=>{n&&(n=!1,Ik(i))}),{table:i,replaceTableData:s,courtsCount:u}}function glt({updateUnscheduledTable:t,updateScheduleTable:e,scheduledDate:i,table:n}){const a=[{params:{matchUps:n.getData("active").map(o=>o.matchUp),scheduledDate:i},method:$Ze}];ii({methods:a,callback:o=>{o.success&&(t(),e({scheduledDate:i}))},engine:Z4})}function vlt({scheduledDate:t,target:e,roundNameFilter:i,eventIdFilter:n,callback:r}){const a=Xf.competitionScheduleMatchUps({courtCompletedMatchUps:!0}),{dateMatchUps:s=[],completedMatchUps:o=[]}=a,c=s.concat(...o).filter(({schedule:m})=>m.scheduledDate||m.scheduledTime||m.courtId),u=c.filter(({schedule:m})=>m.scheduledDate===t);let d=[{disabled:!u.length,option:"Clear scheduled matches",onClick:f},{disabled:!u.length,option:"Clear all matches",onClick:h},{disabled:!c.length,option:"Clear all days",onClick:p}];d.filter(m=>!m.disabled).length&&Ic({target:e,options:d,config:{placement:Ap}});function p(){f({all:!0})}function h(){f({completed:!0})}function f({all:m,completed:g}={}){let v=c.filter(({schedule:w})=>w.scheduledDate===t).filter(({roundName:w})=>!i||i===w).filter(({eventId:w})=>!n||n===w);g||(v=v==null?void 0:v.filter(({matchUpStatus:w,winningSide:S})=>w!=="COMPLETED"&&!S));const b=(m?c:v).map(w=>w.matchUpId);ii({methods:[{method:sY,params:{schedule:{courtId:"",scheduledDate:"",courtOrder:"",scheduledTime:"",venueId:""},removePriorValues:!0,matchUpIds:b}}],callback:w=>{w.success&&Ot(r)&&r()}})}}function ylt({updateUnscheduledTable:t,updateScheduleTable:e,toggleUnscheduled:i,flightNameFilter:n,roundNameFilter:r,controlAnchor:a,eventIdFilter:s,scheduledDate:o,matchUps:l=[],table:c}){const u=N=>{o=N},d=N=>N.eventId===s,p=N=>{c.removeFilter(d),s=N,N&&c.addFilter(d)},h=ot.getEvents().events||[],m=[{label:gg,onClick:()=>p(),close:!0}].concat(h.map(N=>({onClick:()=>p(N.eventId),label:N.eventName,close:!0}))),g=N=>N.roundName===r,v=_i.unique(l.map(N=>N.roundName)),y=N=>{c.removeFilter(g),r=N,N&&c.addFilter(g)},I=[{label:YZ,onClick:()=>y(),close:!0}].concat(v.map(N=>({onClick:()=>y(N),label:N,close:!0}))),T=N=>N.flight===n,w=_i.unique(l.map(N=>N.drawName)),S=N=>{c.removeFilter(T),n=N,N&&c.addFilter(T)},P=[{label:SE,onClick:()=>S(),close:!0}].concat(w.map(N=>({onClick:()=>S(N),label:N,close:!0}))),E=()=>{t()&&e({scheduledDate:o}),console.log("clear filters ?")},R=N=>{const k=jl(N.target,"dropdown");vlt({target:k||(N==null?void 0:N.target),callback:E,roundNameFilter:r,eventIdFilter:s,scheduledDate:o,eventFilter:d,roundFilter:g})},C=zw(c),_=[{onClick:()=>glt({scheduledDate:o,table:c,updateScheduleTable:e,updateUnscheduledTable:t}),label:"Auto schedule",intent:"is-primary",id:"autoSchedule",close:!0},{label:"Clear schedule",onClick:R,intent:"is-warning",id:"clearSchedule",close:!0}],A=[{onKeyDown:N=>N.keyCode===8&&N.target.value.length===1&&C(""),onChange:N=>C(N.target.value),onKeyUp:N=>C(N.target.value),clearSearch:()=>C(""),placeholder:"Search participants",location:pi,search:!0},{hide:m.length<2,options:m,id:"eventOptions",label:gg,modifyLabel:!0,location:pi,selection:!0},{hide:I.length<2,options:I,id:"roundOptions",label:YZ,modifyLabel:!0,location:pi,selection:!0},{hide:P.length<2,options:P,id:"flightOptions",label:SE,modifyLabel:!0,location:pi,selection:!0},{options:_,label:"Actions",selection:!1,location:oi,align:oi},{onClick:i,id:"doneScheduling",intent:"is-info",label:"Done"}];return Io({target:a,items:A}).elements,{updateScheduledDate:u}}function blt({toggleUnscheduled:t,schedulingActive:e,controlAnchor:i,scheduledDate:n,courtsCount:r}={}){if(!i)return;let a;const s=h=>PY(h).format("dddd MMM D"),{startDate:o,endDate:l}=Xf.getCompetitionDateRange(),u=_i.generateDateRange(o,l).map(h=>({onClick:()=>{const f=Xf.getTournamentInfo().tournamentInfo.tournamentId;It.router.navigate(`/tournament/${f}/schedule/${h}`)},isActive:h===n,label:s(h),value:h,close:!0})),d=()=>{},p=[{clearSearch:()=>d(),placeholder:"Search participants",id:"searchParticipants",visible:!!r,location:pi,search:!0},{options:[{label:"Team ",onClick:()=>console.log("team clicked"),close:!0}],label:"Highlight team",visible:!!r,id:"highlightTeam",location:pi,align:pi},{visible:!!r&&!e,onClick:t,label:"Schedule matches",id:"scheduleMatchUps",intent:"is-primary",location:oi},{label:s(n||o),value:n||o,id:CBe,options:u,modifyLabel:!0,intent:"is-info",location:oi,align:oi}];return a=Io({target:i,items:p}).elements,{elements:a}}function NEe(t){var I;let e;const{startDate:i,endDate:n}=Xf.getCompetitionDateRange(),r=new Date,a=_i.dateTime.formatDate(r),s=r>=new Date(i)&&r<=new Date(n),o=r>new Date(n)?n:i;if(!t.scheduledDate){const T=s?a:o,w=(I=Xf.getTournamentInfo().tournamentInfo)==null?void 0:I.tournamentId;It.router.navigate(`/tournament/${w}/schedule/${T}`)}const l=t.scheduledDate||(s?a:o);It.displayed.selectedScheduleDate=l;const c=document.getElementById(Pfe),u=document.getElementById(l5),d=document.getElementById(c5);u.style.paddingBottom="1em",d.style.paddingBottom="1em";let p=It.state.schedulingActive;c.style.display=p?"":xt;const{replaceTableData:h,table:f,unscheduledMatchUps:m}=wrt({scheduledDate:l}),g=()=>{p=!p,It.state.schedulingActive=p,c.style.display=p?"":xt,e!=null&&e.scheduleMatchUps&&(e.scheduleMatchUps.style.display=p?xt:"")},{replaceTableData:v,table:y,courtsCount:b}=mlt({scheduledDate:l});ylt({controlAnchor:u,matchUps:m,table:f,updateUnscheduledTable:h,updateScheduleTable:v,toggleUnscheduled:g,scheduledDate:l}),e=blt({table:y,unscheduledMatchUps:m,updateScheduleTable:v,toggleUnscheduled:g,schedulingActive:p,controlAnchor:d,scheduledDate:l,courtsCount:b}).elements}const{SUBSTITUTION:qee,PENALTY:Wee,REMOVE_PARTICIPANT:Yee,REPLACE_PARTICIPANT:Kee}=W3,{POLICY_TYPE_MATCHUP_ACTIONS:Ilt}=ky,{ASSIGN_PARTICIPANT:TH}=cw,{TEAM:wlt,DOUBLES:AEe}=pl,Slt=_i.extractAttributes;function fP(t,e,i,n){var v;if(!e)return;const r=Array.from(document.querySelectorAll(".tippy-content"));if(r.length){r.forEach(y=>y.remove());return}const s=e.getRow().getData(),o=e.getColumn().getDefinition(),l=s.matchUpType===AEe,c=s.eventType===wlt,{matchUpId:u,drawId:d}=s,p=o.field==="side1"&&1||o.field==="side2"&&2,{validActions:h}=ot.matchUpActions({matchUpId:u,drawId:d,sideNumber:p,policyDefinitions:{[Ilt]:{substituteAfterCompleted:!0,substituteWithoutScore:!0}}}),f=(v=n==null?void 0:n.individualParticipant)==null?void 0:v.participantId,m={[TH]:{params:{data:s,sideNumber:p,callback:i,isTeam:c,isDoubles:l},text:"Assign participant",method:AB},[Wee]:{onClick:()=>console.log({data:s}),text:"Assess penalty"},[Yee]:{params:{data:s,sideNumber:p,callback:i,isTeam:c,isDoubles:l,clickedParticipantId:f},text:"Remove participant",method:Tlt},[Kee]:{params:{data:s,sideNumber:p,callback:i,isTeam:c,isDoubles:l,clickedParticipantId:f},text:"Replace participant",method:AB},[qee]:{params:{data:s,sideNumber:p,callback:i,isTeam:c,isDoubles:l,clickedParticipantId:f},method:AB,text:"Substitution"}},g=h.filter(({type:y})=>[TH,Wee,Yee,Kee,qee].includes(y)).map(y=>{const b=m[y.type];return{onClick:()=>{Ot(b.method)?b.method({...b.params,action:y}):Ot(b.onClick)&&b.onClick()},text:b.text}});g.length===1?g[0].onClick():g.length>0&&(t!=null&&t.target)&&Ic({items:g,target:t.target,config:{placement:Ap}})}function Tlt(t){const{action:e,callback:i,clickedParticipantId:n}=t;e.payload.participantId=n;const r=[{method:e.method,params:e.payload}];ii({methods:r,callback:s=>Ot(i)&&i(s)})}function AB(t){var m;const{sideNumber:e,callback:i,isTeam:n,isDoubles:r,data:a}=t,s=t.action.availableParticipants,o=a.matchUp.matchUpType,l=a.matchUp.sides.find(g=>e===g.sideNumber),c=(m=l==null?void 0:l.participant)==null?void 0:m.individualParticipantIds,u=t.clickedParticipantId;IM({selectedParticipantIds:c,selectOnEnter:!0,selectionLimit:o===AEe&&!u?2:1,onSelection:g=>{if(g.participantId||g.selected){const v=[];(Array.isArray(g.selected)?g.selected.map(Slt("participantId")):[g.participantId]).filter(Boolean).forEach(I=>{v.push({params:{...t.action.payload,substituteParticipantId:I,newParticipantId:I,existingParticipantId:u,participantId:I},method:t.action.method})}),ii({methods:v,callback:I=>{Ot(i)&&i(I)}})}},action:{type:TH,participantsAvailable:s},title:n&&r?"Doubles: Select participants":void 0})}function _Ee(t,e){return t.pctSpread&&!e.pctSpread?-1:e.pctSpread&&!t.pctSpread?1:!t.pctSpread&&!e.pctSpread?0:e.pctSpread-t.pctSpread}function kEe(t){var s;const e=t.getRow().getData();if(!((s=e.competitiveProfile)!=null&&s.competitiveness))return"";const{competitiveProfile:i,score:n}=e,r=document.createElement("span"),a={COMPETITIVE:"green",DECISIVE:"magenta",ROUTINE:"blue"};if(n){const{competitiveness:o}=i;r.style.color=a[o],r.style.fontSize="smaller",r.innerHTML=o}return r}function FY(t){const e=t.getRow().getData();if(!e.readyToScore)return;const i=e.matchUp.matchUpStatus==="WALKOVER",n=document.createElement("span");return n.classList.add("scoreCell"),e.score?(n.style="font-size: smaller",n.innerHTML=e.score):i?n.innerHTML="WO":(n.style="color: blue; font-size: smaller",n.innerHTML="Enter score"),n}function Zee(t){const e=document.createElement("div");return e.style="font-weight: bold",e.innerHTML=t.getValue(),e}function xEe(t){const{matchUpId:e,schedule:i,callback:n}=t;ii({methods:[{params:{matchUpIds:[e],schedule:i,removePriorValues:!0},method:sY}],callback:s=>{s.success&&Ot(n)&&n()}})}function $Y({pointerEvent:t,cell:e,matchUp:i,callback:n}){var p,h,f,m;const r=Array.from(document.querySelectorAll(".tippy-content"));if(r.length){r.forEach(g=>g.remove());return}const a=!(i!=null&&i.roundPosition)&&!(i!=null&&i.drawPositions),s=e&&t.target.getElementsByClassName("fa-ellipsis-vertical")[0],o=(e==null?void 0:e.getRow().getData())||i,l=()=>{Ot(n)&&n(o)},c=((p=i==null?void 0:i.schedule)==null?void 0:p.scheduledTime)||((h=i==null?void 0:i.schedule)==null?void 0:h.scheduledDate)||((f=i==null?void 0:i.schedule)==null?void 0:f.venueId)||((m=i==null?void 0:i.schedule)==null?void 0:m.courtId),d=[{onClick:()=>{const g={scheduledDate:"",scheduledTime:"",courtId:"",venueId:""},v=()=>{if(!e){n({refresh:!0});return}e.getRow().update({...o,...g,courtName:"",venueName:""})};xEe({matchUpId:i.matchUpId,schedule:g,callback:v})},text:"Clear schedule",hide:!c},{onClick:l,text:"Schedule"},{onClick:l,text:"Start time"},{onClick:l,text:"End time"},{onClick:l,text:"Set referee"}];a&&d.push({onClick:()=>Ult({...i,callback:l}),text:"Delete match",color:"red"}),Ic({items:d,target:s||t.target,config:{placement:Ap}})}function Ult({drawId:t,structureId:e,matchUpId:i,callback:n}){ii({methods:[{method:r1e,params:{matchUpIds:[i],removeIncomplete:!0,removeCompleted:!0,structureId:e,drawId:t}}],callback:s=>{s.success?Ot(n)&&n():console.log({postMutationError:s.error})}})}const Xee=t=>e=>{const i=document.createElement("div");return i.className="has-text-warning-dark",i.innerHTML="Select participant",(e.getValue().participantName&&Ww(t)(e,i))??i},pN=t=>({cell:e,event:i,...n})=>{fP(i,e,a=>{if(a.success){const s=e.getRow(),{drawId:o,matchUpId:l}=t,c=ot.findMatchUp({drawId:o,matchUpId:l}).matchUp,u=s.getData().matchUp.collectionId,p=c.tieMatchUps.filter(f=>f.collectionId===u).map(f=>d1({...f,dualMatchUp:t})),h=e.getTable();h.updateData(p),h.redraw(!0)}},n)};function Dlt(t,e){const i=e.getRow(),n=i.getData(),{matchUpId:r,readyToScore:a}=n;a&&TM({matchUpId:r,callback:o=>{var l;if(o.success){const{matchUpStatus:c,sets:u,matchUpFormat:d,score:p,winningSide:h}=o.outcome;Object.assign(n,{matchUpStatus:c,sets:u,matchUpFormat:d,score:p}),n.winningSide=h&&`side${h}`,i.update(n),e.getTable().redraw(!0);const m=(l=o.results.find(({methodName:g})=>g===lY))==null?void 0:l.tieMatchUpResult;Flt(m)}else console.log({result:o})}})}function Elt({matchUp:t}){var r,a,s,o,l,c;const e=((s=(a=(r=t.sides)==null?void 0:r.find(u=>u.sideNumber===1))==null?void 0:a.participant)==null?void 0:s.participantName)||"Side 1",i=((c=(l=(o=t.sides)==null?void 0:o.find(u=>u.sideNumber===2))==null?void 0:l.participant)==null?void 0:c.participantName)||"Side 2",n=(u,d)=>{var p;return(p=u==null?void 0:u.participantName)==null?void 0:p.localeCompare(d==null?void 0:d.participantName)};return[{formatter:Xee(pN(t)),cellClick:(u,d)=>pN(t)({event:u,cell:d}),sorter:n,title:e,responsive:!1,minWidth:100,field:"side1",widthGrow:2},{formatter:Xee(pN(t)),cellClick:(u,d)=>pN(t)({event:u,cell:d}),sorter:n,title:i,responsive:!1,minWidth:100,field:"side2",widthGrow:2},{formatter:FY,cellClick:Dlt,responsive:!1,title:"Score",field:"score",width:140},{field:"matchUpStatus",title:"Status",width:150}]}function Plt({matchUp:t,tableElement:e,collectionMatchUps:i}){const n=i.map(s=>d1({...s,dualMatchUp:t})),r=Elt({matchUp:t});return{table:new As(e,{responsiveLayoutCollapseStartOpen:!1,responsiveLayout:"collapse",placeholder:"No matches",reactiveData:!0,layout:"fitColumns",index:"matchUpId",columns:r,data:n})}}function OEe({side1:t,side2:e,side1Score:i,side2Score:n}){const r=document.createElement("div");r.className="overlay-content-overview";const a=document.createElement("div");a.className="overlay-content-body";const s=Clt({side1Score:i,side2Score:n});return a.appendChild(t),a.appendChild(s),a.appendChild(e),r.appendChild(a),r}function Rk({participantName:t,justify:e="start"}){const i=document.createElement("div");i.className=`matchup-side justify-${e}`;const n=document.createElement("div");return n.className="side-name",n.innerHTML=t,i.appendChild(n),i}function Clt({side1Score:t,side2Score:e}){const i=document.createElement("div");i.className="score-box";const n=document.createElement("div");n.className="score-flex";const r=document.createElement("div");return r.className="score-vs",r.innerHTML="vs",n.appendChild(t),n.appendChild(r),n.appendChild(e),i.appendChild(n),i}function Mk({winningSide:t,sets:e,sideNumber:i,id:n}){var l;const r=`side${i}Score`,a=((l=e==null?void 0:e[0])==null?void 0:l[r])||0,s=document.createElement("span");return n&&(s.id=n),s.className="side-score",i===1?s.style.paddingLeft="1rem":s.style.paddingRight="1rem",i===t&&s.classList.add("has-text-success"),s.innerHTML=a,s}let LEe;function FEe({title:t,content:e,footer:i}={}){if(!e||!i)return;const n=document.getElementById(DE);n&&Ys(n);const r=document.createElement("div");r.className="overlay noselect",r.id=DE;const a=document.createElement("div");a.className="overlay-center-align",r.appendChild(a);const s=document.createElement("div");if(s.className="overlay-root",a.appendChild(s),t){const u=Mlt({title:t});s.appendChild(u)}const o=document.createElement("div");o.className="overlay-content",typeof e=="string"?o.innerHTML=e:e&&o.appendChild(e),s.appendChild(o);const l=document.createElement("div");l.className="overlay-footer",typeof i=="string"?l.innerHTML=i:i&&l.appendChild(i),s.appendChild(l),document.body.appendChild(r),LEe=window.scrollY||document.documentElement.scrollTop;const c=document.getElementById("root");c.style.display=xt}function Rlt({content:t}){var i,n;const e=(n=(i=document.getElementById(DE))==null?void 0:i.getElementsByClassName("overlay-content"))==null?void 0:n[0];e&&(Ys(e),typeof t=="string"?e.innerHTML=t:t&&e.appendChild(t))}function Mlt({title:t}){const e=document.createElement("h2");return e.className="overlay-header",e.innerHTML=`
    <div class="overlay-header-content">
      <h1 class="overlay-title">${t}</h1> 
    </div>
  `,e}function $Ee(){const t=document.getElementById("root");t.style.display="inline",window.scrollTo({top:LEe});let e=document.getElementById(DE);Ys(e);let i=0;for(;i<5&&e;)e.remove(),i+=1,e=document.getElementById(DE)}const BEe=[{key:"custom",name:"Custom",desc:""},{key:"standard",name:"Standard Advantage",format:"SET3-S:6/TB7",desc:"Best of 3 Sets to 6 with Advantage"},{key:"atpd",name:"Standard Doubles",format:"SET3-S:6/TB7-F:TB10",desc:"Best of 3 Sets to 6, no Ad",desc2:"Final Set Tiebreak to 10"},{key:"standard1",name:"One Standard Set",format:"SET1-S:6/TB7",desc:"1 Set to 6 Games, Tiebreak to 7"},{key:"wimbledon2018",name:"Wimbledon 2018",format:"SET5-S:6/TB7-F:6",desc:"Best of 5 tiebreak sets, final set no tiebreak"},{key:"wimbledon2019",name:"Wimbledon 2019",format:"SET5-S:6/TB7-F:6/TB7@12",desc:"Best of 5 tiebreak sets, final set tiebreak at 12"},{key:"Aus2019",name:"Australian Open 2019",format:"SET5-S:6/TB7-F:6/TB10",desc:"Best of 5 tiebreak sets, final set tiebreak at 12"},{key:"short",name:"Short Sets TB7@4",format:"SET3-S:4/TB7",desc:"Best of 3 Sets to 4, tiebreak to 7 at 4-4"},{key:"short1",name:"Fast 4",format:"SET3-S:4/TB5@3",desc:"Best of 3 Sets to 4, tiebreak to 5 at 3-3"},{key:"short2",name:"One Short Set TB7",format:"SET1-S:4/TB7",desc:"One Set to 4, tiebreak to 7 at 4-4"},{key:"short3",name:"One Short Set TB5",format:"SET1-S:4/TB5@3",desc:"One Set to 4, tiebreak to 5 at 3-3"},{key:"short4",name:"Short Sets w/ 3rd TB10",format:"SET3-S:4/TB7-F:TB10",desc:"Best of 3 Sets to 4 Games, tiebreak to 10",desc2:"3rd Set Tiebreak to 7"},{key:"short5",name:"Short Sets w/ 3rd TB7",format:"SET3-S:4/TB7-F:TB7",desc:"Best of 3 Sets to 4 Games, tiebreak to 7",desc2:"3rd Set Tiebreak to 7"},{key:"pro",name:"Pro Set",format:"SET1-S:8/TB7",desc:"One Set to 8 with Advantage, tiebreak at 8-8"},{key:"cps",name:"College Pro Set",format:"SET1-S:8/TB7@7"},{key:"tbsets1",name:"Best of 3 TB7",format:"SET3-S:TB7",desc:"Two tiebreak sets",desc2:"7-point match tiebreak at one set all"},{key:"tbsets2",name:"Best of 3 TB10",format:"SET3-S:TB10",desc:"Best of 3 tiebreaks to 10"},{key:"tbsets3",name:"One Tiebreak to 10",format:"SET1-S:TB10",desc:"One Match Tiebreak to 10 with Advantage"},{key:"tbsets4",name:"Two TB7 w/ 3rd TB10",format:"SET3-S:TB7-F:TB10",desc:"Two 7 point tiebreak sets",desc2:"10 point tiebreak at one set all"},{key:"timed10",name:"Timed 10 minute game - game based",format:"SET1-S:T10"}];let yb,xa;const DA="Timed set",eD="Tiebreak",UH="No-Ad",wu="Set",ND="Ad",_o={setFormat:{descriptor:"Best of",bestOf:3,advantage:ND,what:wu,setTo:6,tiebreakAt:6,tiebreakTo:7,winBy:2,minutes:10},finalSetFormat:{descriptor:"Final set",advantage:ND,what:wu,setTo:6,tiebreakAt:6,tiebreakTo:7,winBy:2,minutes:10}};function Jee(t){var a;const e=t?"finalSetFormat":"setFormat",i=_o[e].what,n={setTo:_o[e].setTo};return i===wu&&_o[e].advantage===UH&&(n.NoAD=!0),i===wu&&((a=document.getElementById(t?"finalSetTiebreak":"setTiebreak"))==null?void 0:a.checked)&&(n.tiebreakAt=_o[e].tiebreakAt,n.tiebreakFormat={tiebreakTo:_o[e].tiebreakTo},i===wu&&_o[e].winBy===1&&(n.tiebreakFormat.NoAD=!0)),i===DA&&(n.minutes=_o[e].minutes,n.timed=!0),i===eD&&(n.tiebreakSet={tiebreakTo:_o[e].tiebreakTo},_o[e].winBy===1&&(n.tiebreakSet.NoAD=!0)),n}function VEe(){var s;const t=Jee();xa={bestOf:_o.setFormat.bestOf,setFormat:t},((s=document.getElementById("finalSetOption"))==null?void 0:s.checked)&&(xa.finalSetFormat=Jee(1));const i=Jk.scoreGovernor.stringifyMatchUpFormat(xa),n=!!BEe.find(o=>o.format===i),r=document.getElementById("matchUpFormatSelector"),a=r==null?void 0:r.querySelectorAll("option");return Array.from(a).forEach(o=>{o.selected=!n&&o.value==="Custom"||o.value===i}),i}function tD(t){const e=t||VEe(),i=document.getElementById("matchUpFormatString");i.innerHTML=e}const bb=(t,e)=>e&&t.finalSetFormat||t.setFormat,G0=[{getValue:t=>t.bestOf>1?"Best of":"Exactly",options:["Best of","Exactly"],id:"descriptor",value:"Best of",finalSet:!1},{getValue:t=>t.bestOf,finalSet:!1,id:"bestOf",options:[1,3,5],onChange:"pluralize",value:3},{getValue:(t,e)=>{const i=bb(t,e),n=i!=null&&i.NoAD?UH:ND;return i!=null&&i.timed||i!=null&&i.tiebreakSet?void 0:n},options:[ND,UH],defaultValue:ND,id:"advantage",whats:[wu]},{getValue:(t,e)=>{const i=bb(t,e);return i||console.log({pmf:t}),i!=null&&i.timed?DA:i!=null&&i.tiebreakSet?eD:wu},options:[wu,eD,DA],finalSetLabel:`${wu}${Rf}`,onChange:"changeWhat",pluralize:!0,id:"what"},{getValue:(t,e)=>bb(t,e).setTo,options:[1,2,3,4,5,6,7,8,9],onChange:"changeCount",defaultValue:6,whats:[wu],prefix:"to ",id:"setTo"},{getValue:(t,e)=>{var n,r;const i=bb(t,e);return((n=i.tiebreakFormat)==null?void 0:n.tiebreakTo)||((r=i.tiebreakSet)==null?void 0:r.tiebreakTo)},options:[5,7,9,10,12],whats:[wu,eD],id:"tiebreakTo",defaultValue:7,prefix:"TB to ",tbSet:!0,value:7,tb:!0},{getValue:(t,e)=>bb(t,e).tiebreakAt,options:t=>{const e=_o[t?"finalSetFormat":"setFormat"].setTo;return e>1?[e-1,e]:[]},id:"tiebreakAt",defaultValue:6,whats:[wu],prefix:"@",value:6,tb:!0},{getValue:(t,e)=>{var n;const i=bb(t,e);if(i.tiebreakFormat)return(n=i.tiebreakFormat)!=null&&n.NoAD?1:2},whats:[wu,eD],prefix:"Win by ",options:[1,2],defaultValue:2,tbSet:!0,id:"winBy",tb:!0},{getValue:(t,e)=>{const i=bb(t,e);return i.timed&&i.minutes||void 0},options:[10,15,20,25,30,45,60,90],whats:[DA],suffix:" Minutes",defaultValue:10,id:"minutes",timed:!0}],Qee={changeWhat:(t,e,i)=>{const n=i===wu,r=e?"finalSetTiebreakToggle":"setTiebreakToggle",a=document.getElementById(r);a.style.display=n?"":xt,G0.forEach(s=>{if(s.whats){const{prefix:o="",suffix:l="",pluralize:c}=s,u=s.whats.includes(i),d=e?`${s.id}-${e}`:s.id,p=document.getElementById(d);if(p.style.display===xt&&u){const h=xa.bestOf,f=!e&&c&&h>1?"s":"",m=s.defaultValue;p.innerHTML=`${o}${m}${f}${l}${Rf}`}p.style.display=u?"":xt}})},changeCount:(t,e,i)=>{const n=e?`tiebreakAt-${e}`:"tiebreakAt";_o[e?"finalSetFormat":"setFormat"].tiebreakAt=i;const r=document.getElementById(n);r.innerHTML=`@${i}${Rf}`},pluralize:(t,e,i)=>{const n=_o[e?"finalSetFormat":"setFormat"].what,r=e?`what-${e}`:"what",a=document.getElementById(r),s=i>1?"s":"";a.innerHTML=`${n}${s}${Rf}`}};function BY({existingMatchUpFormat:t="SET3-S:6/TB7",callback:e}={}){var T;yb=t,xa=Zf.parse(yb);const i=()=>{const w=VEe();Ot(e)&&e(w)};let n,r,a,s,o;const l=[{onClick:()=>e(),label:"Cancel",intent:"none",close:!0},{label:"Select",intent:"is-info",close:!0,onClick:i}],c="switch is-rounded is-danger",u=document.createElement("div"),d=document.createElement("div");d.id="matchUpFormatString",d.innerHTML=yb,d.style.fontSize="1.5em",d.style.color="blue",d.style.marginBottom="1em",u.appendChild(d);const p=document.createElement("div");p.style.marginBlockEnd="1em";const h={id:"matchUpFormatSelector",options:BEe.map(w=>({selected:w.format===yb,value:w.format,label:w.name}))},{field:f,inputElement:m}=yD(h);m.onchange=w=>{yb=w.target.value,tD(yb),xa=Zf.parse(yb),_o.setFormat=xa.setFormat,_o.setFormat.bestOf=xa.bestOf,xa.finalSetFormat&&(_o.finalSetFormat=xa.finalSetFormat);const S=xa.finalSetFormat;n.style.display=S?"":xt,r.style.display=S?"":xt,a.checked=S,o.checked=!!(S!=null&&S.tiebreakFormat),s.checked=xa.setFormat.tiebreakFormat,G0.forEach(U=>{if(U.getValue){const P=U.getValue(xa),E=document.getElementById(U.id);if(E&&P){const{prefix:R="",suffix:C="",pluralize:M}=U,_=xa.bestOf,A=M&&_>1?"s":"";E.innerHTML=`${R}${P}${A}${C}${Rf}`,E.style.display=""}else E&&(E.style.display=xt);if(S){const R=U.getValue(xa,!0),C=document.getElementById(`${U.id}-1`);if(C&&R){const{prefix:M="",suffix:_="",pluralize:A}=U,N=xa.bestOf,k=A&&N>1?"s":"";C.innerHTML=`${M}${R}${k}${_}${Rf}`,C.style.display=""}else C&&(C.style.display=xt)}}})},p.appendChild(f),u.appendChild(p);const g=document.createElement("div");G0.map(w=>{const S=w.getValue(xa);return ete({...w,value:S})}).forEach(w=>g.appendChild(w)),g.id="setFormat",u.appendChild(g);const v=document.createElement("div");v.className="field",v.style.fontSize="1em",s=document.createElement("input"),s.className=c,s.name="setTiebreak",s.id="setTiebreak",s.type="checkbox",s.checked=xa.tiebreakFormat,s.onchange=w=>{const S=w.target.checked;G0.filter(({tb:U})=>U).forEach(U=>{const P=document.getElementById(U.id);if(P.style.display===xt&&S){const{prefix:E="",suffix:R="",pluralize:C,defaultValue:M}=U,_=xa.bestOf,A=C&&_>1?"s":"";P.innerHTML=`${E}${M}${A}${R}${Rf}`}P.style.display=S?"":xt}),tD()},v.appendChild(s);const y=document.createElement("label");y.setAttribute("for","setTiebreak"),y.id="setTiebreakToggle",y.innerHTML="Tiebreak",y.style.marginRight="1em",v.appendChild(y),a=document.createElement("input"),a.className="switch is-rounded is-info",a.type="checkbox",a.name="finalSetOption",a.checked=!!xa.finalSetFormat,a.id="finalSetOption",a.onchange=w=>{const S=w.target.checked;n.style.display=S?"":xt,r.style.display=S?"":xt,tD()},v.appendChild(a);const b=document.createElement("label");b.setAttribute("for","finalSetOption"),b.innerHTML="Final set",v.appendChild(b),u.appendChild(v),n=document.createElement("div"),n.style.display=xa.finalSetFormat?"":xt,n.id="finalSetFormat",[{label:"<div style='font-weight: bold'>Final set</div>",options:[]}].concat(G0.map(w=>{const S=w.getValue(xa,!0);return{...w,value:S}})).filter(w=>w.finalSet!==!1).map(w=>ete({...w,index:1})).forEach(w=>n.appendChild(w)),u.appendChild(n),r=document.createElement("div"),r.style.display=xa.finalSetFormat?"":xt,r.className="field",r.style.fontSize="1em",o=document.createElement("input"),o.className=c,o.name="finalSetTiebreak",o.id="finalSetTiebreak",o.type="checkbox",o.checked=(T=xa.finalSetFormat)==null?void 0:T.tiebreakFormat,r.onchange=w=>{const S=w.target.checked;G0.filter(({tb:U})=>U).forEach(U=>{const P=document.getElementById(`${U.id}-1`);if(P.style.display===xt&&S){const{prefix:E="",suffix:R="",pluralize:C,defaultValue:M}=U,_=xa.bestOf,A=C&&_>1?"s":"";P.innerHTML=`${E}${M}${A}${R}${Rf}`}P.style.display=S?"":xt}),tD()},r.appendChild(o);const I=document.createElement("label");I.setAttribute("for","finalSetTiebreak"),I.id="finalSetTiebreakToggle",I.innerHTML="Tiebreak",I.style.marginRight="1em",r.appendChild(I),u.appendChild(r),er({title:"Score format",content:u,buttons:l})}function Nlt({index:t,finalSetLabel:e,label:i,prefix:n="",suffix:r="",value:a,pluralize:s}){const o=!t&&s&&_o.setFormat.bestOf>1?"s":"";return i||t&&e||`${n}${a}${o}${r}${Rf}`}function ete(t){const{id:e,initiallyHidden:i,index:n,value:r}=t,a=document.createElement("button");return a.className="mfcButton",a.id=n?`${e}-${n}`:e,a.innerHTML=Nlt(t),a.onclick=s=>Alt({e:s,button:a,...t}),a.style.display=r||t.label?"":xt,i&&(a.style.display=xt),a}function Alt(t){const{e,id:i,button:n,pluralize:r,options:a,onChange:s,index:o,prefix:l="",suffix:c=""}=t,u=_o.setFormat.bestOf,d=!o&&r&&u>1?"s":"",h=(Ot(a)?a(o):a).map(f=>({text:`${f}${d}`,onClick:()=>{n.innerHTML=`${l}${f}${d}${c}${Rf}`,s&&Ot(Qee[s])&&Qee[s](e,o,f),_o[o?"finalSetFormat":"setFormat"][i]=f,tD()}}));Ic({items:h,target:e.target,config:{arrow:!1,offset:[0,0]}})}function _lt(){return[{rowHandle:!0,formatter:"handle",width:30,minWidth:30},{cellClick:(e,i)=>i.getRow().toggleSelect(),titleFormatter:"rowSelection",formatter:"rowSelection",responsive:!1,hozAlign:pi,width:5},{formatter:"responsiveCollapse",responsive:!1,resizable:!1,hozAlign:mi,width:50},{editorParams:{selectContents:!0},field:"collectionName",minWidth:200,title:"Name",editor:!0},{field:"matchUpCount",editor:"number",title:"#",width:70,editorParams:{elementAttributes:{maxlength:2},selectContents:!0,mask:"99",step:1,max:20,min:0}},{field:"matchUpType",editor:"list",title:"Type",width:100,editorParams:{values:["Singles","Doubles"]}},{title:"Gender",field:"gender",editor:"list",width:100,editorParams:{values:["Male","Female","Any"]}},{cellClick:(e,i)=>{const n=i.getRow(),r=n.getData();BY({callback:s=>{s&&(Object.assign(r,{matchUpFormat:s}),n.update(r),i.getTable().redraw(!0))},existingMatchUpFormat:r.matchUpFormat})},title:"Score format",field:y5,minWidth:150},{title:"Award type",field:"awardType",editor:"list",width:150,editorParams:{values:[f5,m5,v5,g5]}},{field:"awardValue",editor:"number",title:"Value",width:70,editorParams:{elementAttributes:{maxlength:2},selectContents:!0,mask:"99",step:1,max:99,min:0}}]}function tte(t){return(t==null?void 0:t[0].toUpperCase())+(t==null?void 0:t.substring(1).toLowerCase())||""}function klt({tableElement:t,tieFormat:e}){var a;const i=(((a=e==null?void 0:e.collectionDefinitions)==null?void 0:a.sort((s,o)=>s.collectionOrder-o.collectionOrder))||[]).map(s=>{const{collectionValue:o,matchUpValue:l,scoreValue:c,setValue:u,matchUpType:d,gender:p}=s,h=_i.isConvertableInteger(o)&&f5||_i.isConvertableInteger(c)&&g5||_i.isConvertableInteger(u)&&v5||m5,f=o??c??u??l;return{...s,matchUpType:tte(d),gender:tte(p),awardValue:f,awardType:h}}),n=_lt();return{table:new As(t,{responsiveLayoutCollapseStartOpen:!1,columnDefaults:{headerSort:!1},placeholder:"No collections",responsiveLayout:"collapse",index:"collectionId",reactiveData:!0,layout:"fitColumns",movableRows:!0,minHeight:200,columns:n,data:i})}}function jEe(t){var r,a,s;const e=(r=t==null?void 0:t.winCriteria)==null?void 0:r.valueGoal,i=(a=t==null?void 0:t.collectionDefinitions)!=null&&a.length?((s=t==null?void 0:t.winCriteria)==null?void 0:s.aggregateValue)&&"Aggregate value":"none";return`<div style="font-weight: bold">Win criteria: <span class="has-text-success">${e||i}</span></div>`}function GEe({title:t,tieFormat:e,onClose:i}){const{content:n,inputs:r,elements:a,table:s}=xlt({tieFormat:e}),o=u=>{const d=r.tieFormatName.value,p=u.map(f=>_i.definedAttributes({collectionValue:f.awardType===f5?f.awardValue:void 0,matchUpValue:f.awardType===m5?f.awardValue:void 0,scoreValue:f.awardType===g5?f.awardValue:void 0,setValue:f.awardType===v5?f.awardValue:void 0,matchUpType:f.matchUpType.toUpperCase(),collectionName:f.collectionName,matchUpFormat:f.matchUpFormat,gender:f.gender.toUpperCase(),collectionId:f.collectionId,matchUpCount:f.matchUpCount})),h=ot.calculateWinCriteria({collectionDefinitions:p});return{collectionDefinitions:p,tieFormatName:d,winCriteria:h}};s.on("dataChanged",()=>{const u=o(s.getData());a.winCriteria.innerHTML=jEe(u)});const c=Llt({table:s,onClose:u=>{var p;const d=o(u);Ot(i)&&i(((p=d==null?void 0:d.collectionDefinitions)==null?void 0:p.length)&&d)}});return FEe({title:t,content:n,footer:c})}function xlt({tieFormat:t}){const e=document.createElement("div");e.className="overlay-content-container",e.style.backgroundColor="white";const i=document.createElement("div"),{table:n}=klt({tieFormat:t,tableElement:i}),r=Olt();e.appendChild(r);const a=document.createElement("div");e.appendChild(a),e.appendChild(i);const s=()=>{const u=n==null?void 0:n.getSelectedData().map(({collectionId:d})=>d);n==null||n.deleteRow(u)},o=[{value:(t==null?void 0:t.tieFormatName)||"Custom scorecard",error:"minimum of 5 characters",placeholder:"Scorecard name",validator:Wr(5),field:"tieFormatName",id:"tieFormatName",location:pi},{text:jEe(t),id:"winCriteria",location:pi},{onClick:s,label:"Delete selected",intent:"is-danger",stateChange:!0,location:fa},{onClick:()=>{const d={collectionName:`Collection ${n.getData().length+1}`,collectionId:_i.UUID(),awardType:"Match value",matchUpFormat:"SET3-S:6/TB7",matchUpType:"Singles",matchUpCount:1,gender:"Any",awardValue:1};n.addRow(d)},label:"Add collection",intent:"is-info",location:oi}],{elements:l,inputs:c}=Io({table:n,target:a,items:o});return{content:e,table:n,elements:l,inputs:c}}function Olt(t){const e=document.createElement("div");e.className="overlay-content-overview";const i=document.createElement("div");return i.className="overlay-content-body",e.appendChild(i),e}function Llt({table:t,onClose:e}){const i=()=>{t.destroy(),$Ee()},n=document.createElement("button");n.className="button is-warning is-light",n.onclick=i,n.innerHTML="Cancel";const r=document.createElement("button");r.className="button is-info button-spacer",r.onclick=s=>{s.preventDefault(),s.stopPropagation();const o=t.getData();i(),Ot(e)&&e(o)},r.innerHTML="Done";const a=document.createElement("div");return a.className="overlay-footer-wrap",a.appendChild(n),a.appendChild(r),a}function HEe({matchUpId:t,structureId:e,eventId:i,drawId:n,callback:r}){const{tieFormat:a}=ot.getTieFormat({structureId:e,matchUpId:t,eventId:i,drawId:n});GEe({title:"Edit scorecard",tieFormat:a,onClose:o=>{var l,c;if(o){(l=o.collectionDefinitions)==null||l.forEach((f,m)=>f.collectionOrder=m+1);const u={collectionName:!0,collectionOrder:!0};if(!((c=CC.compareTieFormats({descendant:o,ancestor:a,considerations:u}))==null?void 0:c.different)){Jt({intent:"is-info",message:"No changes"});return}ii({methods:[{method:LZe,params:{modifiedTieFormat:o,considerations:u,structureId:e,matchUpId:t,drawId:n}}],callback:f=>{var m;return f.success?(Jt({intent:"is-success",message:"Scorecard updated"}),Ot(r)&&r()):Jt({intent:"is-danger",message:((m=f.error)==null?void 0:m.message)||"Error"})}})}}})}const hN="has-text-success",zEe="tieSide1",qEe="tieSide2";function B2({title:t,drawId:e,matchUpId:i,onClose:n}){var l;const r=ot.findMatchUp({drawId:e,matchUpId:i,participantsProfile:{withISO2:!0}}),a=r.matchUp;if(!a||r.error||!t||!Array.isArray((l=a==null?void 0:a.tieFormat)==null?void 0:l.collectionDefinitions))return;const s=V2({matchUp:a}),o=$lt({title:t,drawId:e,matchUpId:i,onClose:n});return FEe({title:t,content:s,footer:o})}function V2({matchUp:t}){var d;const e=document.createElement("div");e.className="overlay-content-container";const i=Rk({participantName:ite({matchUp:t,sideNumber:1}),justify:"end"}),n=Rk({participantName:ite({matchUp:t,sideNumber:2}),justify:"start"}),{winningSide:r,score:a}=t,s=(a==null?void 0:a.sets)||[],o=Mk({winningSide:r,sets:s,sideNumber:1,id:zEe}),l=Mk({winningSide:r,sets:s,sideNumber:2,id:qEe}),c=OEe({side1:i,side2:n,side1Score:o,side2Score:l});e.appendChild(c),It.collectionTables||(It.collectionTables=[]);const u=((d=t.tieFormat.collectionDefinitions)==null?void 0:d.sort((p,h)=>p.collectionOrder-h.collectionOrder))||[];for(const p of u){const h=t.tieMatchUps.filter(y=>y.collectionId===p.collectionId),f=document.createElement("div");f.className="collection";const m=document.createElement("div");m.className="title is-4",m.innerHTML=p.collectionName,f.appendChild(m);const g=document.createElement("div");f.appendChild(g);const{table:v}=Plt({matchUp:t,tableElement:g,collectionMatchUps:h});It.collectionTables.push(v),e.appendChild(f)}return e}function Flt(t){var r,a;const e=(a=(r=t==null?void 0:t.score)==null?void 0:r.sets)==null?void 0:a[0];if(!e)return;const i=document.getElementById(zEe),n=document.getElementById(qEe);i.classList.remove(hN),n.classList.remove(hN),i.innerHTML=e.side1Score,n.innerHTML=e.side2Score,t.winningSide===1&&i.classList.add(hN),t.winningSide===2&&n.classList.add(hN)}function ite({matchUp:t,sideNumber:e}){var i,n;return(n=(i=t.sides.find(r=>r.sideNumber===e))==null?void 0:i.participant)==null?void 0:n.participantName}function $lt({title:t,drawId:e,matchUpId:i,onClose:n}){const r=document.createElement("button");r.className="button is-warning is-light",r.onclick=()=>{HEe({matchUpId:i,drawId:e,callback:()=>B2({title:t,drawId:e,matchUpId:i,onClose:()=>console.log("closed")})})},r.innerHTML="Edit scorecard";const a=u=>{var d;if(u.success){const p=(d=ot.findMatchUp({drawId:e,matchUpId:i}))==null?void 0:d.matchUp,h=V2({matchUp:p});Rlt({content:h})}},s=document.createElement("button");s.className="button is-warning is-light button-spacer",s.innerHTML="Remove players",s.onclick=()=>{ii({methods:[{params:{drawId:e,matchUpId:i,inheritance:!1},method:c1e}],callback:a})};const o=document.createElement("button");o.className="button is-info is-light button-spacer",o.innerHTML="Clear results",o.onclick=()=>{ii({methods:[{params:{drawId:e,matchUpId:i},method:u1e}],callback:a})};const l=document.createElement("button");l.className="button is-info button-spacer",l.onclick=u=>{for(u.preventDefault(),u.stopPropagation();It.collectionTables.length;)It.collectionTables.pop().destroy();$Ee(),Ot(n)&&n()},l.innerHTML="Done";const c=document.createElement("div");return c.className="overlay-footer-wrap",c.appendChild(r),c.appendChild(s),c.appendChild(o),c.appendChild(l),c}const{TEAM:Blt}=Ls,Vlt=(t,e)=>(i,n)=>{var u;const r=n.getRow().getData(),{matchUpId:a,readyToScore:s,matchUpType:o,drawId:l,eventName:c}=r.matchUp;if(o===Blt)B2({title:c,matchUpId:a,drawId:l,onClose:()=>t()});else if(s||(u=r.matchUp.score)!=null&&u.scoreStringSide1)if(Zi.hotkeys&&!Zi.device.isMobile){e({e:i,cell:n,replaceTableData:t});const d=document.querySelectorAll(".activeScoreCell");for(const p of Array.from(d))p.classList.remove("activeScoreCell");i.target.classList.contains("tabulator-cell")?i.target.firstChild.classList.add("activeScoreCell"):i.target.classList.add("activeScoreCell")}else TM({matchUp:r.matchUp,matchUpId:a,callback:t})};function WEe(t,e){if(!t.score&&!e.score){if(t.readyToScore&&!e.readyToScore)return-1;if(e.readyToScore&&!t.readyToScore)return 1}return t.score&&!e.score?-1:e.score&&!t.score?1:0}const nte={fn:t=>({name:"dynamicContent",default:!0,onShow(){typeof t.props.dynContent=="function"&&t.setContent(t.props.dynContent(t.reference))}})},Nb={"o-route":PU,"p-route":Qf,"e-route":hh,"m-route":X4,"s-route":dy,"v-route":J4},rte={"o-route":"Overview","p-route":"Participants","e-route":"Events","m-route":"MatchUps","s-route":"Schedule","v-route":"Venues"};function jlt(){var s,o,l,c;const t=`
  <div class="side-bar collapse">
    <ul class="features-list">
      <span class="features-item-text">Overview</span>
      <span class="features-item-text">Participants</span>
      <span class="features-item-text">Events</span>
      <span class="features-item-text">Matches</span>
      <span class="features-item-text">Schedule</span>
      <span class="features-item-text">Venues</span>
    </ul>
  </div>
`,e=document.getElementById("navText");e.innerHTML=t;const i=Object.keys(Nb),n=(c=(l=(o=(s=It.router)==null?void 0:s.current)==null?void 0:o[0])==null?void 0:l.data)==null?void 0:c.selectedTab,r=u=>document.querySelector(".side-bar").classList.contains("collapse")?u:"",a=document.getElementById("o-route");Mg(a,{dynContent:()=>!Zi.device.isMobile&&r(rte["o-route"]),onShow:u=>!!u.props.content,plugins:[nte],placement:Ap,arrow:!1}),i.forEach(u=>{const d=document.getElementById(u);Mg(d,{dynContent:()=>!Zi.device.isMobile&&r(rte[u]),onShow:p=>!!p.props.content,plugins:[nte],placement:Ap,arrow:!1}),(n===Nb[u]||!n&&Nb[u]===Qf)&&(d.style.color="blue"),d.onclick=()=>{var f,m;document.querySelectorAll(".nav-icon").forEach(g=>g.style.color=""),d.style.color="blue";const p=(m=(f=ot.getTournament())==null?void 0:f.tournamentRecord)==null?void 0:m.tournamentId,h=`/${Ps}/${p}/${Nb[u]}`;It.router.navigate(h)}})}function VY(t){document.querySelectorAll(".nav-icon").forEach(i=>i.style.color=""),Object.keys(Nb).forEach(i=>{const n=document.getElementById(i);(t===Nb[i]||!t&&Nb[i]===Qf)&&(n.style.color="blue")})}function Glt({data:t,replaceTableData:e,setFocusData:i}){const n=(c,u)=>{var m,g;const p=u.getRow().getData(),{courtName:h,scheduledDate:f}=p;if(h&&f){const v=(g=(m=ot.getTournament())==null?void 0:m.tournamentRecord)==null?void 0:g.tournamentId,y=`/${Ps}/${v}/${dy}/${f}`;It.router.navigate(y),VY(dy)}},r=(c,u)=>{const d=u.getValue();PEe({time:d,callback:({time:h})=>{const m=_i.dateTime.convertTime(h,!0),g=u.getRow(),v=g.getData(),{matchUpId:y}=v;m!==d&&xEe({matchUpId:y,schedule:{scheduledTime:m},callback:()=>{console.log("callback"),g.update({...v,scheduledTime:m})}})}})},a=()=>e(),s=t.some(c=>c.courtName),o=(c,u)=>fP(c,u,a),l=c=>{const u=document.createElement("div");u.className="has-text-warning-dark",u.innerHTML="Select participant";const d=({event:h,...f})=>{fP(h,c,a,f)};return c.getValue().participantName&&Ww(d)(c,u)};return[{cellClick:(c,u)=>u.getRow().toggleSelect(),titleFormatter:"rowSelection",formatter:"rowSelection",headerSort:!1,responsive:!1,hozAlign:pi,width:5},{headerMenu:xm({duration:"Duration",complete:"Complete"}),formatter:"rownum",headerSort:!1,hozAlign:pi,width:55},{formatter:$it(Jr),field:"eventId",title:"Event",visible:!0,minWidth:200,widthGrow:1},{title:"Flight",visible:!1,minWidth:150,field:"flight",widthGrow:1},{field:"matchUpType",titleFormatter:Zee,title:"Type",minWidth:90},{field:"roundName",title:"Round",titleFormatter:Zee,minWidth:90},{cellClick:n,field:"scheduledDate",title:"Date",width:110},{cellClick:n,visible:!!s,field:"courtName",title:"Court",width:100},{cellClick:r,field:"scheduledTime",visible:!0,title:"Time",width:70},{formatter:l,cellClick:o,sorter:NT,responsive:!1,title:"Side 1",minWidth:180,field:"side1",widthGrow:1},{formatter:l,cellClick:o,sorter:NT,responsive:!1,title:"Side 2",minWidth:180,field:"side2",widthGrow:1},{cellClick:Vlt(e,i),formatter:FY,sorter:WEe,field:"scoreDetail",responsive:!1,title:"Score",width:140},{sorter:_Ee,formatter:kEe,field:"competitiveProfile",responsive:!1,title:"Profile",visible:!1,width:140},{title:"<div class='fa-solid fa-check' style='color: green' />",formatter:"tickCross",field:"complete",hozAlign:pi,tooltip:!1,width:40},{field:"matchUp.matchUpStatus",title:"Status",width:150},{title:"<div class='fa-solid fa-clock' style='color: blue' />",headerSort:!1,field:"duration",visible:!1,width:70},{cellClick:(c,u)=>$Y({pointerEvent:c,cell:u,...u.getData()}),formatter:av,responsive:!1,headerSort:!1,hozAlign:oi,widthGrow:0,width:50}]}const _B=typeof navigator<"u"?navigator.userAgent.toLowerCase().indexOf("firefox")>0:!1;function kB(t,e,i,n){t.addEventListener?t.addEventListener(e,i,n):t.attachEvent&&t.attachEvent("on".concat(e),i)}function F1(t,e,i,n){t.removeEventListener?t.removeEventListener(e,i,n):t.detachEvent&&t.detachEvent("on".concat(e),i)}function YEe(t,e){const i=e.slice(0,e.length-1);for(let n=0;n<i.length;n++)i[n]=t[i[n].toLowerCase()];return i}function KEe(t){typeof t!="string"&&(t=""),t=t.replace(/\s/g,"");const e=t.split(",");let i=e.lastIndexOf("");for(;i>=0;)e[i-1]+=",",e.splice(i,1),i=e.lastIndexOf("");return e}function Hlt(t,e){const i=t.length>=e.length?t:e,n=t.length>=e.length?e:t;let r=!0;for(let a=0;a<i.length;a++)n.indexOf(i[a])===-1&&(r=!1);return r}const mP={backspace:8,"⌫":8,tab:9,clear:12,enter:13,"↩":13,return:13,esc:27,escape:27,space:32,left:37,up:38,right:39,down:40,del:46,delete:46,ins:45,insert:45,home:36,end:35,pageup:33,pagedown:34,capslock:20,num_0:96,num_1:97,num_2:98,num_3:99,num_4:100,num_5:101,num_6:102,num_7:103,num_8:104,num_9:105,num_multiply:106,num_add:107,num_enter:108,num_subtract:109,num_decimal:110,num_divide:111,"⇪":20,",":188,".":190,"/":191,"`":192,"-":_B?173:189,"=":_B?61:187,";":_B?59:186,"'":222,"[":219,"]":221,"\\":220},pm={"⇧":16,shift:16,"⌥":18,alt:18,option:18,"⌃":17,ctrl:17,control:17,"⌘":91,cmd:91,command:91},DH={16:"shiftKey",18:"altKey",17:"ctrlKey",91:"metaKey",shiftKey:16,ctrlKey:17,altKey:18,metaKey:91},Il={16:!1,18:!1,17:!1,91:!1},hs={};for(let t=1;t<20;t++)mP["f".concat(t)]=111+t;let Ua=[],AD=null,ZEe="all";const Km=new Map,UM=t=>mP[t.toLowerCase()]||pm[t.toLowerCase()]||t.toUpperCase().charCodeAt(0),zlt=t=>Object.keys(mP).find(e=>mP[e]===t),qlt=t=>Object.keys(pm).find(e=>pm[e]===t);function XEe(t){ZEe=t||"all"}function gP(){return ZEe||"all"}function Wlt(){return Ua.slice(0)}function Ylt(){return Ua.map(t=>zlt(t)||qlt(t)||String.fromCharCode(t))}function Klt(){const t=[];return Object.keys(hs).forEach(e=>{hs[e].forEach(i=>{let{key:n,scope:r,mods:a,shortcut:s}=i;t.push({scope:r,shortcut:s,mods:a,keys:n.split("+").map(o=>UM(o))})})}),t}function Zlt(t){const e=t.target||t.srcElement,{tagName:i}=e;let n=!0;const r=i==="INPUT"&&!["checkbox","radio","range","button","file","reset","submit","color"].includes(e.type);return(e.isContentEditable||(r||i==="TEXTAREA"||i==="SELECT")&&!e.readOnly)&&(n=!1),n}function Xlt(t){return typeof t=="string"&&(t=UM(t)),Ua.indexOf(t)!==-1}function Jlt(t,e){let i,n;t||(t=gP());for(const r in hs)if(Object.prototype.hasOwnProperty.call(hs,r))for(i=hs[r],n=0;n<i.length;)i[n].scope===t?i.splice(n,1).forEach(s=>{let{element:o}=s;return jY(o)}):n++;gP()===t&&XEe(e||"all")}function Qlt(t){let e=t.keyCode||t.which||t.charCode;const i=Ua.indexOf(e);if(i>=0&&Ua.splice(i,1),t.key&&t.key.toLowerCase()==="meta"&&Ua.splice(0,Ua.length),(e===93||e===224)&&(e=91),e in Il){Il[e]=!1;for(const n in pm)pm[n]===e&&(Mf[n]=!1)}}function JEe(t){if(typeof t>"u")Object.keys(hs).forEach(r=>{Array.isArray(hs[r])&&hs[r].forEach(a=>fN(a)),delete hs[r]}),jY(null);else if(Array.isArray(t))t.forEach(r=>{r.key&&fN(r)});else if(typeof t=="object")t.key&&fN(t);else if(typeof t=="string"){for(var e=arguments.length,i=new Array(e>1?e-1:0),n=1;n<e;n++)i[n-1]=arguments[n];let[r,a]=i;typeof r=="function"&&(a=r,r=""),fN({key:t,scope:r,method:a,splitKey:"+"})}}const fN=t=>{let{key:e,scope:i,method:n,splitKey:r="+"}=t;KEe(e).forEach(s=>{const o=s.split(r),l=o.length,c=o[l-1],u=c==="*"?"*":UM(c);if(!hs[u])return;i||(i=gP());const d=l>1?YEe(pm,o):[],p=[];hs[u]=hs[u].filter(h=>{const m=(n?h.method===n:!0)&&h.scope===i&&Hlt(h.mods,d);return m&&p.push(h.element),!m}),p.forEach(h=>jY(h))})};function ate(t,e,i,n){if(e.element!==n)return;let r;if(e.scope===i||e.scope==="all"){r=e.mods.length>0;for(const a in Il)Object.prototype.hasOwnProperty.call(Il,a)&&(!Il[a]&&e.mods.indexOf(+a)>-1||Il[a]&&e.mods.indexOf(+a)===-1)&&(r=!1);(e.mods.length===0&&!Il[16]&&!Il[18]&&!Il[17]&&!Il[91]||r||e.shortcut==="*")&&(e.keys=[],e.keys=e.keys.concat(Ua),e.method(t,e)===!1&&(t.preventDefault?t.preventDefault():t.returnValue=!1,t.stopPropagation&&t.stopPropagation(),t.cancelBubble&&(t.cancelBubble=!0)))}}function ste(t,e){const i=hs["*"];let n=t.keyCode||t.which||t.charCode;if(!Mf.filter.call(this,t))return;if((n===93||n===224)&&(n=91),Ua.indexOf(n)===-1&&n!==229&&Ua.push(n),["ctrlKey","altKey","shiftKey","metaKey"].forEach(o=>{const l=DH[o];t[o]&&Ua.indexOf(l)===-1?Ua.push(l):!t[o]&&Ua.indexOf(l)>-1?Ua.splice(Ua.indexOf(l),1):o==="metaKey"&&t[o]&&Ua.length===3&&(t.ctrlKey||t.shiftKey||t.altKey||(Ua=Ua.slice(Ua.indexOf(l))))}),n in Il){Il[n]=!0;for(const o in pm)pm[o]===n&&(Mf[o]=!0);if(!i)return}for(const o in Il)Object.prototype.hasOwnProperty.call(Il,o)&&(Il[o]=t[DH[o]]);t.getModifierState&&!(t.altKey&&!t.ctrlKey)&&t.getModifierState("AltGraph")&&(Ua.indexOf(17)===-1&&Ua.push(17),Ua.indexOf(18)===-1&&Ua.push(18),Il[17]=!0,Il[18]=!0);const r=gP();if(i)for(let o=0;o<i.length;o++)i[o].scope===r&&(t.type==="keydown"&&i[o].keydown||t.type==="keyup"&&i[o].keyup)&&ate(t,i[o],r,e);if(!(n in hs))return;const a=hs[n],s=a.length;for(let o=0;o<s;o++)if((t.type==="keydown"&&a[o].keydown||t.type==="keyup"&&a[o].keyup)&&a[o].key){const l=a[o],{splitKey:c}=l,u=l.key.split(c),d=[];for(let p=0;p<u.length;p++)d.push(UM(u[p]));d.sort().join("")===Ua.sort().join("")&&ate(t,l,r,e)}}function Mf(t,e,i){Ua=[];const n=KEe(t);let r=[],a="all",s=document,o=0,l=!1,c=!0,u="+",d=!1,p=!1;for(i===void 0&&typeof e=="function"&&(i=e),Object.prototype.toString.call(e)==="[object Object]"&&(e.scope&&(a=e.scope),e.element&&(s=e.element),e.keyup&&(l=e.keyup),e.keydown!==void 0&&(c=e.keydown),e.capture!==void 0&&(d=e.capture),typeof e.splitKey=="string"&&(u=e.splitKey),e.single===!0&&(p=!0)),typeof e=="string"&&(a=e),p&&JEe(t,a);o<n.length;o++)t=n[o].split(u),r=[],t.length>1&&(r=YEe(pm,t)),t=t[t.length-1],t=t==="*"?"*":UM(t),t in hs||(hs[t]=[]),hs[t].push({keyup:l,keydown:c,scope:a,mods:r,shortcut:n[o],method:i,key:n[o],splitKey:u,element:s});if(typeof s<"u"&&window){if(!Km.has(s)){const h=function(){let m=arguments.length>0&&arguments[0]!==void 0?arguments[0]:window.event;return ste(m,s)},f=function(){let m=arguments.length>0&&arguments[0]!==void 0?arguments[0]:window.event;ste(m,s),Qlt(m)};Km.set(s,{keydownListener:h,keyupListenr:f,capture:d}),kB(s,"keydown",h,d),kB(s,"keyup",f,d)}if(!AD){const h=()=>{Ua=[]};AD={listener:h,capture:d},kB(window,"focus",h,d)}}}function ect(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"all";Object.keys(hs).forEach(i=>{hs[i].filter(r=>r.scope===e&&r.shortcut===t).forEach(r=>{r&&r.method&&r.method()})})}function jY(t){const e=Object.values(hs).flat();if(e.findIndex(n=>{let{element:r}=n;return r===t})<0){const{keydownListener:n,keyupListenr:r,capture:a}=Km.get(t)||{};n&&r&&(F1(t,"keyup",r,a),F1(t,"keydown",n,a),Km.delete(t))}if((e.length<=0||Km.size<=0)&&(Object.keys(Km).forEach(r=>{const{keydownListener:a,keyupListenr:s,capture:o}=Km.get(r)||{};a&&s&&(F1(r,"keyup",s,o),F1(r,"keydown",a,o),Km.delete(r))}),Km.clear(),Object.keys(hs).forEach(r=>delete hs[r]),AD)){const{listener:r,capture:a}=AD;F1(window,"focus",r,a),AD=null}}const xB={getPressedKeyString:Ylt,setScope:XEe,getScope:gP,deleteScope:Jlt,getPressedKeyCodes:Wlt,getAllKeyCodes:Klt,isPressed:Xlt,filter:Zlt,trigger:ect,unbind:JEe,keyMap:mP,modifier:pm,modifierMap:DH};for(const t in xB)Object.prototype.hasOwnProperty.call(xB,t)&&(Mf[t]=xB[t]);if(typeof window<"u"){const t=window.hotkeys;Mf.noConflict=e=>(e&&window.hotkeys===Mf&&(window.hotkeys=t),Mf),window.hotkeys=Mf}const{HOTKEYS:tct,SIDE1KEYS:ict,MODIFIERS:nct}=nW;function rct(){let t,e;const i=n=>{e=void 0,t=n};return Mf(tct+",esc",(n,r)=>{var a;if(t){const s=t.cell.getElement(),o=(a=s.classList)!=null&&a.contains("tabulator-cell")?s.firstChild:s;n.preventDefault();const l=t.cell.getRow().getData();e||(e=l.matchUp);const c=Mf.shift,u=c?r.key.split(r.splitKey)[1]:r.key;u==="esc"&&(t.replaceTableData(),t=void 0);const d=ict.some(p=>p===u)&&(c?2:1)||void 0;if(d||nct.includes(u)){const{matchUpFormat:p,matchUpStatus:h,score:f,sets:m,winningSide:g}=e,{matchUpStatus:v,scoreString:y,winningSide:b,sets:I,updated:T}=Hv.keyValueScore({scoreString:f==null?void 0:f.scoreStringSide1,shiftFirst:!0,sets:m||[],matchUpStatus:h,matchUpFormat:p,winningSide:g,lowSide:d,value:u});T&&(e={matchUpId:l.matchUp.matchUpId,drawId:l.matchUp.drawId,score:{scoreStringSide1:y},matchUpStatus:v,winningSide:b,sets:I,matchUpFormat:p,updated:T},o.innerText=y||"Enter score")}}if(t&&r.key==="enter"){const s=Hv.generateScoreString({sets:e.sets,reversed:!0}),o=Hv.generateScoreString({sets:e.sets}),l={matchUpStatus:e.matchUpStatus,winningSide:e.winningSide,score:{sets:e.sets,scoreStringSide1:o,scoreStringSide2:s}};act({callback:t.replaceTableData,matchUpId:e.matchUpId,drawId:e.drawId,outcome:l}),t=void 0}}),{setFocusData:i}}function act({outcome:t,callback:e,matchUpId:i,drawId:n}){const{matchUpStatus:r,winningSide:a,score:s}=t;ii({methods:[{method:lY,params:{outcome:{matchUpStatus:r,winningSide:a,score:s},matchUpId:i,drawId:n}}],callback:c=>{Ot(e)&&e({...c,outcome:t})}})}function sct(){let t;const{setFocusData:e}=rct(),i=()=>(ot.allTournamentMatchUps({participantsProfile:{withISO2:!0,withScaleValues:!0},contextProfile:{withCompetitiveness:!0}}).matchUps||[]).filter(({matchUpStatus:l})=>l!=="BYE").map(d1),n=()=>{t.replaceData(i())},r=i(),a=Glt({data:r,replaceTableData:n,setFocusData:e});return(o=>{var u;km({anchorId:m_});const l=document.getElementById(m_),c=(u=jl(l,"section"))==null?void 0:u.querySelector(".tabHeader");t=new As(l,{headerSortElement:rf(["complete","duration","score","scheduledTime"]),height:window.innerHeight*.85,placeholder:"No matches",layout:"fitColumns",reactiveData:!0,index:"matchUpId",columns:a,data:o}),t.on("dataFiltered",(d,p)=>{var y,b;const h=p.map(I=>I.getData().matchUp);c&&(c.innerHTML=`Matches (${h.length})`);const f=document.getElementById("wtnPredictiveAccuracy"),m=ot.getPredictiveAccuracy({valueAccessor:"wtnRating",scaleName:"WTN",zoneMargin:2.5,matchUps:h});(y=m==null?void 0:m.accuracy)!=null&&y.percent?(f.style.display="",f.innerHTML=`WTN ${m.accuracy.percent}%`):f.style.display=xt;const g=document.getElementById("utrPredictiveAccuracy"),v=ot.getPredictiveAccuracy({valueAccessor:"utrRating",singlesForDoubles:!0,scaleName:"UTR",zoneMargin:1,matchUps:h});(b=v==null?void 0:v.accuracy)!=null&&b.percent?(g.style.display="",g.innerHTML=`UTR ${v.accuracy.percent}%`):g.style.display=xt})})(r),{table:t,data:r,replaceTableData:n}}function Nk(t){Zi.activeScale=t}const{TEAM_EVENT:ote,SINGLES:lte,DOUBLES:cte}=pl,{TEAM:oct}=Ls;function lct(){const t=new Map,e={elements:{},options:{}},{data:i,table:n,replaceTableData:r}=sct(),a=ot.getEvents().events||[],s=document.getElementById(e5);s.style.display=xt,e.options.flight=pct({matchUpFilters:t,events:a,table:n});const o=hct({matchUpFilters:t,components:e,events:a,table:n}),l=uct({table:n,matchUpFilters:t,statsPanel:s}),c=cct({table:n,matchUpFilters:t,data:i}),u=dct({matchUpFilters:t,table:n}),d=m=>{var g;return(g=m.searchText)==null?void 0:g.includes(t.get("searchText"))},p=m=>{m||n==null||n.removeFilter(d),t.set("searchText",m),m&&(n==null||n.addFilter(d))},h=[{onClick:()=>n==null?void 0:n.deselectRow(),label:"Schedule",stateChange:!0,location:fa},{onKeyDown:m=>m.keyCode===8&&m.target.value.length===1&&p(""),onKeyUp:m=>p(m.target.value),clearSearch:()=>{n==null||n.removeFilter(d),t.set("searchText",""),n==null||n.removeFilter()},placeholder:"Search matches",location:pi,search:!0},{hide:o.length<4,options:o,id:"eventOptions",label:gg,modifyLabel:!0,selection:!0,location:pi},{options:e.options.flight.flightOptions,hide:!t.get("eventIdFilter")||e.options.flight.flightOptions.length<3,label:SE,id:"flightOptions",modifyLabel:!0,selection:!0,location:pi},{hide:l.length<3,options:l,modifyLabel:!0,label:pfe,location:pi,selection:!0},{options:u,label:dfe,modifyLabel:!0,selection:!0,location:pi},{hide:c.length<4,options:c,modifyLabel:!0,label:hfe,selection:!0,location:pi},{onClick:()=>{Nk(PE),r()},id:"wtnPredictiveAccuracy",intent:"is-danger",location:oi,text:"WTN %",hide:!0},{onClick:()=>{Nk(yI),r()},id:"utrPredictiveAccuracy",intent:"is-info",location:oi,text:"UTR %",hide:!0}],f=document.getElementById(u5);e.elements=Io({table:n,target:f,items:h}).elements}function cct({table:t,matchUpFilters:e,data:i}){const n=o=>o.matchUpType===e.get("matchUpTypeFilter"),r=o=>{t==null||t.removeFilter(n),e.set("matchUpTypeFilter",o),o&&(t==null||t.addFilter(n))},a={label:`<span style='font-weight: bold'>${hfe}</span>`,onClick:()=>r(),close:!0},s=i.reduce((o,l)=>(o.includes(l.matchUpType)||o.push(l.matchUpType),o),[]);return[a,{divider:!0},s.includes(lte)&&{label:"Singles",close:!0,onClick:()=>r(lte)},s.includes(cte)&&{label:"Doubles",close:!0,onClick:()=>r(cte)},s.includes(ote)&&{label:"Team",close:!0,onClick:()=>r(ote)}].filter(Boolean)}function uct({table:t,matchUpFilters:e,statsPanel:i}){const n=ot.getParticipants({participantFilters:{participantTypes:[oct]}}).participants||[],r=Object.assign({},...n.map(l=>({[l.participantId]:l.individualParticipantIds}))),a=l=>l.individualParticipantIds.some(c=>{var u;return(u=r[e.get("teamIdFilter")])==null?void 0:u.includes(c)}),s=l=>{if(e.get("teamIdFilter")&&(t==null||t.removeFilter(a)),e.set("teamIdFilter",l),l){t==null||t.addFilter(a);const{teamStats:c}=ot.getParticipantStats({teamParticipantId:l});if(c!=null&&c.participantName){i.style.display="";const u=Rk({participantName:c.participantName,justify:"end"}),d=Rk({participantName:"Opponents",justify:"start"}),p=[{side1Score:c.matchUps[0],side2Score:c.matchUps[1]}],h=Mk({sets:p,sideNumber:1}),f=Mk({sets:p,sideNumber:2});Ys(i),i.appendChild(OEe({side1:u,side2:d,side1Score:h,side2Score:f}))}}else i.style.display=xt};return[{label:`<span style='font-weight: bold'>${pfe}</span>`,onClick:()=>s(),close:!0},{divider:!0}].concat(n.sort((l,c)=>{var u;return(u=l==null?void 0:l.participantName)==null?void 0:u.localeCompare(c==null?void 0:c.participantName)}).map(l=>({onClick:()=>s(l.participantId),label:l.participantName,close:!0})))}function dct({matchUpFilters:t,table:e}){const i=a=>{const s=t.get("matchUpStatusFilter");if(s==="readyToScore")return a.scoreDetail.readyToScore&&!a.scoreDetail.score&&!a.scoreDetail.winningSide;if(s==="complete")return a.scoreDetail.winningSide||["DOUBLE_WALKOVER","DOUBLE_DEFAULT","CANCELLED","ABANDONED"].includes(a.scoreDetail.matchUpStatus)},n=a=>{e==null||e.removeFilter(i),t.set("matchUpStatusFilter",a),a&&(e==null||e.addFilter(i))};return[{label:`<span style='font-weight: bold'>${dfe}</span>`,onClick:()=>n(),close:!0},{divider:!0},{label:"Ready to score",close:!0,onClick:()=>n("readyToScore")},{label:"Complete",close:!0,onClick:()=>n("complete")}]}function pct({matchUpFilters:t,events:e,table:i}){const n=l=>l.drawId===t.get("drawIdFilter"),r=l=>{i==null||i.removeFilter(n),t.set("drawIdFilter",l),l&&(i==null||i.addFilter(n))},a={label:`<span style='font-weight: bold'>${SE}</span>`,onClick:()=>r(),close:!0},s=l=>{var c;return(c=l.drawDefinitions)==null?void 0:c.map(({drawId:u,drawName:d})=>({onClick:()=>r(u),label:d,close:!0}))},o=[a,{divider:!0}].concat(e.flatMap(s)).filter(Boolean);return{flightFilter:n,flightOptions:o,allFlights:a,mapFlightOptions:s}}function hct({matchUpFilters:t,table:e,events:i,components:n}){const r=o=>o.eventId===t.get("eventIdFilter"),a=o=>{if(e==null||e.removeFilter(r),t.set("eventIdFilter",o),e==null||e.removeFilter(n.options.flight.flightFilter),t.set("drawIdFilter",void 0),o){e==null||e.addFilter(r),n.options.flight.flightOptions=[n.options.flight.allFlights,{divider:!0}].concat(n.options.flight.mapFlightOptions(i.find(u=>o===u.eventId))).filter(Boolean);const l={options:n.options.flight.flightOptions,label:SE,id:"flightOptions",modifyLabel:!0,selection:!0,location:pi},c=NG({button:l});n.elements.flightOptions.replaceWith(c),n.elements.flightOptions=c,n.elements.flightOptions.style.display=n.options.flight.flightOptions.length<3?xt:""}else n.elements.flightOptions.style.display=xt};return[{label:`<span style='font-weight: bold'>${gg}</span>`,onClick:()=>a(),close:!0},{divider:!0}].concat(i.map(o=>({onClick:()=>a(o.eventId),label:o.eventName,close:!0})))}function fct(){var r,a;const t=ot.getTournamentInfo().tournamentInfo;if((a=(r=t==null?void 0:t.timeItemValues)==null?void 0:r.TMX)==null?void 0:a.offline){const s=document.getElementById("dnav");s.style.backgroundColor="lightyellow"}const i=document.getElementById("provider");i&&(i.onclick=()=>It.router.navigate("/tournaments"));const n=document.getElementById("pageTitle");n&&(t!=null&&t.tournamentName)?(Ys(n),n.innerHTML=`<div class='tmx-title'>${t==null?void 0:t.tournamentName}</div>`):It.router.navigate("/tournaments")}function QEe(t){var s;const{venueName:e,venueAbbreviation:i,addresses:n,venueId:r,courts:a}=t;return{hasLocation:(s=n==null?void 0:n[0])==null?void 0:s.longitude,courtsCount:(a==null?void 0:a.length)||0,scheduledMatchUpsCount:0,address:n==null?void 0:n[0],availableTime:"",venueAbbreviation:i,venueName:e,venueId:r,courts:a,venue:t}}function mct(){function t(i){return i.getValue()?'<i class="fa-solid fa-check" style="color: green"></i>':'<i class="fa-solid fa-xmark"></i>'}const e=()=>console.log("Court actions");return[{cellClick:(i,n)=>n.getRow().toggleSelect(),titleFormatter:"rowSelection",formatter:"rowSelection",headerSort:!1,responsive:!1,hozAlign:pi,width:5},{headerMenu:xm({floodlit:"Lights"}),formatter:"rownum",headerSort:!1,hozAlign:mi,width:55},{title:"Court Name",field:"courtName",editor:!0},{title:"Scheduled Time",field:"scheduledTime"},{title:"Unscheduled Time",field:"unscheduledTime"},{title:"In/Out",field:"indoorOutdoor"},{title:"Surface",field:"surfaceType"},{title:'<i class="fa-regular fa-lightbulb"></i>',formatter:t,headerTooltip:"Lights",field:"floodlit",width:50},{cellClick:e,formatter:av,responsive:!1,headerSort:!1,hozAlign:oi,width:50}]}function gct(t){const e=document.createElement("div"),i=document.createElement("div");i.className="tableControl",i.style.marginBottom="1em";const n=[{label:"Delete selected",intent:"is-danger",stateChange:!0,location:fa},{label:"Add courts",location:oi,align:oi}];e.appendChild(i);const r="1px solid #333",a=document.createElement("div");a.style.backgroundColor="white",a.style.border=r,a.style.width="99%",e.className=dL,e.style.display=xt,e.style.boxSizing="border-box",e.style.paddingLeft="10px",e.style.borderTop=r,e.style.borderBotom=r,e.appendChild(a),t.getElement().appendChild(e);const s=mct(),o=new As(a,{headerSortElement:rf(["courtName","scheduledTime","unscheduledTime","floodlit","surfaceType","indoorOutdoor"]),data:t.getData().courts,placeholder:"No courts",layout:"fitColumns",index:"courtId",maxHeight:400,columns:s});Io({table:o,target:i,items:n}),o.on("scrollVertical",wd),o.on("cellEdited",l=>{const c=l.getRow().getData(),u=l.getValue();if(u.length){const d=h=>{h.success?console.log("success",{result:h}):console.log({result:h})},p=[{method:a1e,params:{courtId:c.courtId,modifications:{courtName:u}}}];ii({methods:p,callback:d})}else console.log("INVALID VALUE")})}const GY=/[-+]?([1-8]?\d(\.\d+)?|90(\.0+)?)\s*,\s*[-+]?(180(\.0+)?|((1[0-7]\d)|([1-9]?\d))(\.\d+)?)$/;function vct(t){let e=t.split("/");if(e[2]==="www.openstreetmap.org"){let i=e.slice(4).join(",");return GY.test(i)?{latitude:e[4],longitude:e[5]}:{}}return{}}function yct(t){const i=t.split("/").reduce((s,o)=>o&&o[0]==="@"?o:s,void 0),n=i==null?void 0:i.split(","),r=n==null?void 0:n[0].slice(1),a=n==null?void 0:n[1];return{latitude:r,longitude:a}}function bct(t){let e=t.split(",");return GY.test(t)?{latitude:e[0],longitude:e[1]}:{}}function Ict(t){let e=t.split("=");if(e.length>1){let i=e[1].split(","),n=[i[0],i[1]].join(",");return GY.test(n)?{latitude:i[0],longitude:i[1]}:{}}return{}}var EH={exports:{}};/* @preserve
 * Leaflet 1.9.4, a JS library for interactive maps. https://leafletjs.com
 * (c) 2010-2023 Vladimir Agafonkin, (c) 2010-2011 CloudMade
 */(function(t,e){(function(i,n){n(e)})(dp,function(i){var n="1.9.4";function r(D){var x,H,Y,re;for(H=1,Y=arguments.length;H<Y;H++){re=arguments[H];for(x in re)D[x]=re[x]}return D}var a=Object.create||function(){function D(){}return function(x){return D.prototype=x,new D}}();function s(D,x){var H=Array.prototype.slice;if(D.bind)return D.bind.apply(D,H.call(arguments,1));var Y=H.call(arguments,2);return function(){return D.apply(x,Y.length?Y.concat(H.call(arguments)):arguments)}}var o=0;function l(D){return"_leaflet_id"in D||(D._leaflet_id=++o),D._leaflet_id}function c(D,x,H){var Y,re,ge,Ne;return Ne=function(){Y=!1,re&&(ge.apply(H,re),re=!1)},ge=function(){Y?re=arguments:(D.apply(H,arguments),setTimeout(Ne,x),Y=!0)},ge}function u(D,x,H){var Y=x[1],re=x[0],ge=Y-re;return D===Y&&H?D:((D-re)%ge+ge)%ge+re}function d(){return!1}function p(D,x){if(x===!1)return D;var H=Math.pow(10,x===void 0?6:x);return Math.round(D*H)/H}function h(D){return D.trim?D.trim():D.replace(/^\s+|\s+$/g,"")}function f(D){return h(D).split(/\s+/)}function m(D,x){Object.prototype.hasOwnProperty.call(D,"options")||(D.options=D.options?a(D.options):{});for(var H in x)D.options[H]=x[H];return D.options}function g(D,x,H){var Y=[];for(var re in D)Y.push(encodeURIComponent(H?re.toUpperCase():re)+"="+encodeURIComponent(D[re]));return(!x||x.indexOf("?")===-1?"?":"&")+Y.join("&")}var v=/\{ *([\w_ -]+) *\}/g;function y(D,x){return D.replace(v,function(H,Y){var re=x[Y];if(re===void 0)throw new Error("No value provided for variable "+H);return typeof re=="function"&&(re=re(x)),re})}var b=Array.isArray||function(D){return Object.prototype.toString.call(D)==="[object Array]"};function I(D,x){for(var H=0;H<D.length;H++)if(D[H]===x)return H;return-1}var T="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=";function w(D){return window["webkit"+D]||window["moz"+D]||window["ms"+D]}var S=0;function U(D){var x=+new Date,H=Math.max(0,16-(x-S));return S=x+H,window.setTimeout(D,H)}var P=window.requestAnimationFrame||w("RequestAnimationFrame")||U,E=window.cancelAnimationFrame||w("CancelAnimationFrame")||w("CancelRequestAnimationFrame")||function(D){window.clearTimeout(D)};function R(D,x,H){if(H&&P===U)D.call(x);else return P.call(window,s(D,x))}function C(D){D&&E.call(window,D)}var M={__proto__:null,extend:r,create:a,bind:s,get lastId(){return o},stamp:l,throttle:c,wrapNum:u,falseFn:d,formatNum:p,trim:h,splitWords:f,setOptions:m,getParamString:g,template:y,isArray:b,indexOf:I,emptyImageUrl:T,requestFn:P,cancelFn:E,requestAnimFrame:R,cancelAnimFrame:C};function _(){}_.extend=function(D){var x=function(){m(this),this.initialize&&this.initialize.apply(this,arguments),this.callInitHooks()},H=x.__super__=this.prototype,Y=a(H);Y.constructor=x,x.prototype=Y;for(var re in this)Object.prototype.hasOwnProperty.call(this,re)&&re!=="prototype"&&re!=="__super__"&&(x[re]=this[re]);return D.statics&&r(x,D.statics),D.includes&&(A(D.includes),r.apply(null,[Y].concat(D.includes))),r(Y,D),delete Y.statics,delete Y.includes,Y.options&&(Y.options=H.options?a(H.options):{},r(Y.options,D.options)),Y._initHooks=[],Y.callInitHooks=function(){if(!this._initHooksCalled){H.callInitHooks&&H.callInitHooks.call(this),this._initHooksCalled=!0;for(var ge=0,Ne=Y._initHooks.length;ge<Ne;ge++)Y._initHooks[ge].call(this)}},x},_.include=function(D){var x=this.prototype.options;return r(this.prototype,D),D.options&&(this.prototype.options=x,this.mergeOptions(D.options)),this},_.mergeOptions=function(D){return r(this.prototype.options,D),this},_.addInitHook=function(D){var x=Array.prototype.slice.call(arguments,1),H=typeof D=="function"?D:function(){this[D].apply(this,x)};return this.prototype._initHooks=this.prototype._initHooks||[],this.prototype._initHooks.push(H),this};function A(D){if(!(typeof L>"u"||!L||!L.Mixin)){D=b(D)?D:[D];for(var x=0;x<D.length;x++)D[x]===L.Mixin.Events&&console.warn("Deprecated include of L.Mixin.Events: this property will be removed in future releases, please inherit from L.Evented instead.",new Error().stack)}}var N={on:function(D,x,H){if(typeof D=="object")for(var Y in D)this._on(Y,D[Y],x);else{D=f(D);for(var re=0,ge=D.length;re<ge;re++)this._on(D[re],x,H)}return this},off:function(D,x,H){if(!arguments.length)delete this._events;else if(typeof D=="object")for(var Y in D)this._off(Y,D[Y],x);else{D=f(D);for(var re=arguments.length===1,ge=0,Ne=D.length;ge<Ne;ge++)re?this._off(D[ge]):this._off(D[ge],x,H)}return this},_on:function(D,x,H,Y){if(typeof x!="function"){console.warn("wrong listener type: "+typeof x);return}if(this._listens(D,x,H)===!1){H===this&&(H=void 0);var re={fn:x,ctx:H};Y&&(re.once=!0),this._events=this._events||{},this._events[D]=this._events[D]||[],this._events[D].push(re)}},_off:function(D,x,H){var Y,re,ge;if(this._events&&(Y=this._events[D],!!Y)){if(arguments.length===1){if(this._firingCount)for(re=0,ge=Y.length;re<ge;re++)Y[re].fn=d;delete this._events[D];return}if(typeof x!="function"){console.warn("wrong listener type: "+typeof x);return}var Ne=this._listens(D,x,H);if(Ne!==!1){var Ze=Y[Ne];this._firingCount&&(Ze.fn=d,this._events[D]=Y=Y.slice()),Y.splice(Ne,1)}}},fire:function(D,x,H){if(!this.listens(D,H))return this;var Y=r({},x,{type:D,target:this,sourceTarget:x&&x.sourceTarget||this});if(this._events){var re=this._events[D];if(re){this._firingCount=this._firingCount+1||1;for(var ge=0,Ne=re.length;ge<Ne;ge++){var Ze=re[ge],st=Ze.fn;Ze.once&&this.off(D,st,Ze.ctx),st.call(Ze.ctx||this,Y)}this._firingCount--}}return H&&this._propagateEvent(Y),this},listens:function(D,x,H,Y){typeof D!="string"&&console.warn('"string" type argument expected');var re=x;typeof x!="function"&&(Y=!!x,re=void 0,H=void 0);var ge=this._events&&this._events[D];if(ge&&ge.length&&this._listens(D,re,H)!==!1)return!0;if(Y){for(var Ne in this._eventParents)if(this._eventParents[Ne].listens(D,x,H,Y))return!0}return!1},_listens:function(D,x,H){if(!this._events)return!1;var Y=this._events[D]||[];if(!x)return!!Y.length;H===this&&(H=void 0);for(var re=0,ge=Y.length;re<ge;re++)if(Y[re].fn===x&&Y[re].ctx===H)return re;return!1},once:function(D,x,H){if(typeof D=="object")for(var Y in D)this._on(Y,D[Y],x,!0);else{D=f(D);for(var re=0,ge=D.length;re<ge;re++)this._on(D[re],x,H,!0)}return this},addEventParent:function(D){return this._eventParents=this._eventParents||{},this._eventParents[l(D)]=D,this},removeEventParent:function(D){return this._eventParents&&delete this._eventParents[l(D)],this},_propagateEvent:function(D){for(var x in this._eventParents)this._eventParents[x].fire(D.type,r({layer:D.target,propagatedFrom:D.target},D),!0)}};N.addEventListener=N.on,N.removeEventListener=N.clearAllEventListeners=N.off,N.addOneTimeEventListener=N.once,N.fireEvent=N.fire,N.hasEventListeners=N.listens;var k=_.extend(N);function O(D,x,H){this.x=H?Math.round(D):D,this.y=H?Math.round(x):x}var $=Math.trunc||function(D){return D>0?Math.floor(D):Math.ceil(D)};O.prototype={clone:function(){return new O(this.x,this.y)},add:function(D){return this.clone()._add(F(D))},_add:function(D){return this.x+=D.x,this.y+=D.y,this},subtract:function(D){return this.clone()._subtract(F(D))},_subtract:function(D){return this.x-=D.x,this.y-=D.y,this},divideBy:function(D){return this.clone()._divideBy(D)},_divideBy:function(D){return this.x/=D,this.y/=D,this},multiplyBy:function(D){return this.clone()._multiplyBy(D)},_multiplyBy:function(D){return this.x*=D,this.y*=D,this},scaleBy:function(D){return new O(this.x*D.x,this.y*D.y)},unscaleBy:function(D){return new O(this.x/D.x,this.y/D.y)},round:function(){return this.clone()._round()},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},floor:function(){return this.clone()._floor()},_floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.clone()._ceil()},_ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},trunc:function(){return this.clone()._trunc()},_trunc:function(){return this.x=$(this.x),this.y=$(this.y),this},distanceTo:function(D){D=F(D);var x=D.x-this.x,H=D.y-this.y;return Math.sqrt(x*x+H*H)},equals:function(D){return D=F(D),D.x===this.x&&D.y===this.y},contains:function(D){return D=F(D),Math.abs(D.x)<=Math.abs(this.x)&&Math.abs(D.y)<=Math.abs(this.y)},toString:function(){return"Point("+p(this.x)+", "+p(this.y)+")"}};function F(D,x,H){return D instanceof O?D:b(D)?new O(D[0],D[1]):D==null?D:typeof D=="object"&&"x"in D&&"y"in D?new O(D.x,D.y):new O(D,x,H)}function V(D,x){if(D)for(var H=x?[D,x]:D,Y=0,re=H.length;Y<re;Y++)this.extend(H[Y])}V.prototype={extend:function(D){var x,H;if(!D)return this;if(D instanceof O||typeof D[0]=="number"||"x"in D)x=H=F(D);else if(D=j(D),x=D.min,H=D.max,!x||!H)return this;return!this.min&&!this.max?(this.min=x.clone(),this.max=H.clone()):(this.min.x=Math.min(x.x,this.min.x),this.max.x=Math.max(H.x,this.max.x),this.min.y=Math.min(x.y,this.min.y),this.max.y=Math.max(H.y,this.max.y)),this},getCenter:function(D){return F((this.min.x+this.max.x)/2,(this.min.y+this.max.y)/2,D)},getBottomLeft:function(){return F(this.min.x,this.max.y)},getTopRight:function(){return F(this.max.x,this.min.y)},getTopLeft:function(){return this.min},getBottomRight:function(){return this.max},getSize:function(){return this.max.subtract(this.min)},contains:function(D){var x,H;return typeof D[0]=="number"||D instanceof O?D=F(D):D=j(D),D instanceof V?(x=D.min,H=D.max):x=H=D,x.x>=this.min.x&&H.x<=this.max.x&&x.y>=this.min.y&&H.y<=this.max.y},intersects:function(D){D=j(D);var x=this.min,H=this.max,Y=D.min,re=D.max,ge=re.x>=x.x&&Y.x<=H.x,Ne=re.y>=x.y&&Y.y<=H.y;return ge&&Ne},overlaps:function(D){D=j(D);var x=this.min,H=this.max,Y=D.min,re=D.max,ge=re.x>x.x&&Y.x<H.x,Ne=re.y>x.y&&Y.y<H.y;return ge&&Ne},isValid:function(){return!!(this.min&&this.max)},pad:function(D){var x=this.min,H=this.max,Y=Math.abs(x.x-H.x)*D,re=Math.abs(x.y-H.y)*D;return j(F(x.x-Y,x.y-re),F(H.x+Y,H.y+re))},equals:function(D){return D?(D=j(D),this.min.equals(D.getTopLeft())&&this.max.equals(D.getBottomRight())):!1}};function j(D,x){return!D||D instanceof V?D:new V(D,x)}function B(D,x){if(D)for(var H=x?[D,x]:D,Y=0,re=H.length;Y<re;Y++)this.extend(H[Y])}B.prototype={extend:function(D){var x=this._southWest,H=this._northEast,Y,re;if(D instanceof W)Y=D,re=D;else if(D instanceof B){if(Y=D._southWest,re=D._northEast,!Y||!re)return this}else return D?this.extend(Z(D)||z(D)):this;return!x&&!H?(this._southWest=new W(Y.lat,Y.lng),this._northEast=new W(re.lat,re.lng)):(x.lat=Math.min(Y.lat,x.lat),x.lng=Math.min(Y.lng,x.lng),H.lat=Math.max(re.lat,H.lat),H.lng=Math.max(re.lng,H.lng)),this},pad:function(D){var x=this._southWest,H=this._northEast,Y=Math.abs(x.lat-H.lat)*D,re=Math.abs(x.lng-H.lng)*D;return new B(new W(x.lat-Y,x.lng-re),new W(H.lat+Y,H.lng+re))},getCenter:function(){return new W((this._southWest.lat+this._northEast.lat)/2,(this._southWest.lng+this._northEast.lng)/2)},getSouthWest:function(){return this._southWest},getNorthEast:function(){return this._northEast},getNorthWest:function(){return new W(this.getNorth(),this.getWest())},getSouthEast:function(){return new W(this.getSouth(),this.getEast())},getWest:function(){return this._southWest.lng},getSouth:function(){return this._southWest.lat},getEast:function(){return this._northEast.lng},getNorth:function(){return this._northEast.lat},contains:function(D){typeof D[0]=="number"||D instanceof W||"lat"in D?D=Z(D):D=z(D);var x=this._southWest,H=this._northEast,Y,re;return D instanceof B?(Y=D.getSouthWest(),re=D.getNorthEast()):Y=re=D,Y.lat>=x.lat&&re.lat<=H.lat&&Y.lng>=x.lng&&re.lng<=H.lng},intersects:function(D){D=z(D);var x=this._southWest,H=this._northEast,Y=D.getSouthWest(),re=D.getNorthEast(),ge=re.lat>=x.lat&&Y.lat<=H.lat,Ne=re.lng>=x.lng&&Y.lng<=H.lng;return ge&&Ne},overlaps:function(D){D=z(D);var x=this._southWest,H=this._northEast,Y=D.getSouthWest(),re=D.getNorthEast(),ge=re.lat>x.lat&&Y.lat<H.lat,Ne=re.lng>x.lng&&Y.lng<H.lng;return ge&&Ne},toBBoxString:function(){return[this.getWest(),this.getSouth(),this.getEast(),this.getNorth()].join(",")},equals:function(D,x){return D?(D=z(D),this._southWest.equals(D.getSouthWest(),x)&&this._northEast.equals(D.getNorthEast(),x)):!1},isValid:function(){return!!(this._southWest&&this._northEast)}};function z(D,x){return D instanceof B?D:new B(D,x)}function W(D,x,H){if(isNaN(D)||isNaN(x))throw new Error("Invalid LatLng object: ("+D+", "+x+")");this.lat=+D,this.lng=+x,H!==void 0&&(this.alt=+H)}W.prototype={equals:function(D,x){if(!D)return!1;D=Z(D);var H=Math.max(Math.abs(this.lat-D.lat),Math.abs(this.lng-D.lng));return H<=(x===void 0?1e-9:x)},toString:function(D){return"LatLng("+p(this.lat,D)+", "+p(this.lng,D)+")"},distanceTo:function(D){return Q.distance(this,Z(D))},wrap:function(){return Q.wrapLatLng(this)},toBounds:function(D){var x=180*D/40075017,H=x/Math.cos(Math.PI/180*this.lat);return z([this.lat-x,this.lng-H],[this.lat+x,this.lng+H])},clone:function(){return new W(this.lat,this.lng,this.alt)}};function Z(D,x,H){return D instanceof W?D:b(D)&&typeof D[0]!="object"?D.length===3?new W(D[0],D[1],D[2]):D.length===2?new W(D[0],D[1]):null:D==null?D:typeof D=="object"&&"lat"in D?new W(D.lat,"lng"in D?D.lng:D.lon,D.alt):x===void 0?null:new W(D,x,H)}var K={latLngToPoint:function(D,x){var H=this.projection.project(D),Y=this.scale(x);return this.transformation._transform(H,Y)},pointToLatLng:function(D,x){var H=this.scale(x),Y=this.transformation.untransform(D,H);return this.projection.unproject(Y)},project:function(D){return this.projection.project(D)},unproject:function(D){return this.projection.unproject(D)},scale:function(D){return 256*Math.pow(2,D)},zoom:function(D){return Math.log(D/256)/Math.LN2},getProjectedBounds:function(D){if(this.infinite)return null;var x=this.projection.bounds,H=this.scale(D),Y=this.transformation.transform(x.min,H),re=this.transformation.transform(x.max,H);return new V(Y,re)},infinite:!1,wrapLatLng:function(D){var x=this.wrapLng?u(D.lng,this.wrapLng,!0):D.lng,H=this.wrapLat?u(D.lat,this.wrapLat,!0):D.lat,Y=D.alt;return new W(H,x,Y)},wrapLatLngBounds:function(D){var x=D.getCenter(),H=this.wrapLatLng(x),Y=x.lat-H.lat,re=x.lng-H.lng;if(Y===0&&re===0)return D;var ge=D.getSouthWest(),Ne=D.getNorthEast(),Ze=new W(ge.lat-Y,ge.lng-re),st=new W(Ne.lat-Y,Ne.lng-re);return new B(Ze,st)}},Q=r({},K,{wrapLng:[-180,180],R:6371e3,distance:function(D,x){var H=Math.PI/180,Y=D.lat*H,re=x.lat*H,ge=Math.sin((x.lat-D.lat)*H/2),Ne=Math.sin((x.lng-D.lng)*H/2),Ze=ge*ge+Math.cos(Y)*Math.cos(re)*Ne*Ne,st=2*Math.atan2(Math.sqrt(Ze),Math.sqrt(1-Ze));return this.R*st}}),J=6378137,se={R:J,MAX_LATITUDE:85.0511287798,project:function(D){var x=Math.PI/180,H=this.MAX_LATITUDE,Y=Math.max(Math.min(H,D.lat),-H),re=Math.sin(Y*x);return new O(this.R*D.lng*x,this.R*Math.log((1+re)/(1-re))/2)},unproject:function(D){var x=180/Math.PI;return new W((2*Math.atan(Math.exp(D.y/this.R))-Math.PI/2)*x,D.x*x/this.R)},bounds:function(){var D=J*Math.PI;return new V([-D,-D],[D,D])}()};function ie(D,x,H,Y){if(b(D)){this._a=D[0],this._b=D[1],this._c=D[2],this._d=D[3];return}this._a=D,this._b=x,this._c=H,this._d=Y}ie.prototype={transform:function(D,x){return this._transform(D.clone(),x)},_transform:function(D,x){return x=x||1,D.x=x*(this._a*D.x+this._b),D.y=x*(this._c*D.y+this._d),D},untransform:function(D,x){return x=x||1,new O((D.x/x-this._b)/this._a,(D.y/x-this._d)/this._c)}};function ce(D,x,H,Y){return new ie(D,x,H,Y)}var oe=r({},Q,{code:"EPSG:3857",projection:se,transformation:function(){var D=.5/(Math.PI*se.R);return ce(D,.5,-D,.5)}()}),te=r({},oe,{code:"EPSG:900913"});function le(D){return document.createElementNS("http://www.w3.org/2000/svg",D)}function ne(D,x){var H="",Y,re,ge,Ne,Ze,st;for(Y=0,ge=D.length;Y<ge;Y++){for(Ze=D[Y],re=0,Ne=Ze.length;re<Ne;re++)st=Ze[re],H+=(re?"L":"M")+st.x+" "+st.y;H+=x?Dt.svg?"z":"x":""}return H||"M0 0"}var me=document.documentElement.style,be="ActiveXObject"in window,Se=be&&!document.addEventListener,we="msLaunchUri"in navigator&&!("documentMode"in document),ze=gi("webkit"),Qe=gi("android"),ke=gi("android 2")||gi("android 3"),yt=parseInt(/WebKit\/([0-9]+)|$/.exec(navigator.userAgent)[1],10),lt=Qe&&gi("Google")&&yt<537&&!("AudioNode"in window),Ct=!!window.opera,Nt=!we&&gi("chrome"),Ce=gi("gecko")&&!ze&&!Ct&&!be,Ge=!Nt&&gi("safari"),$e=gi("phantom"),at="OTransition"in me,ct=navigator.platform.indexOf("Win")===0,Vt=be&&"transition"in me,Me="WebKitCSSMatrix"in window&&"m11"in new window.WebKitCSSMatrix&&!ke,De="MozPerspective"in me,Je=!window.L_DISABLE_3D&&(Vt||Me||De)&&!at&&!$e,St=typeof orientation<"u"||gi("mobile"),bt=St&&ze,Ie=St&&Me,Ue=!window.PointerEvent&&window.MSPointerEvent,Oe=!!(window.PointerEvent||Ue),Ee="ontouchstart"in window||!!window.TouchEvent,Xe=!window.L_NO_TOUCH&&(Ee||Oe),Et=St&&Ct,Fe=St&&Ce,ht=(window.devicePixelRatio||window.screen.deviceXDPI/window.screen.logicalXDPI)>1,ti=function(){var D=!1;try{var x=Object.defineProperty({},"passive",{get:function(){D=!0}});window.addEventListener("testPassiveEventSupport",d,x),window.removeEventListener("testPassiveEventSupport",d,x)}catch{}return D}(),Ke=function(){return!!document.createElement("canvas").getContext}(),zt=!!(document.createElementNS&&le("svg").createSVGRect),mt=!!zt&&function(){var D=document.createElement("div");return D.innerHTML="<svg/>",(D.firstChild&&D.firstChild.namespaceURI)==="http://www.w3.org/2000/svg"}(),Tt=!zt&&function(){try{var D=document.createElement("div");D.innerHTML='<v:shape adj="1"/>';var x=D.firstChild;return x.style.behavior="url(#default#VML)",x&&typeof x.adj=="object"}catch{return!1}}(),Ut=navigator.platform.indexOf("Mac")===0,zi=navigator.platform.indexOf("Linux")===0;function gi(D){return navigator.userAgent.toLowerCase().indexOf(D)>=0}var Dt={ie:be,ielt9:Se,edge:we,webkit:ze,android:Qe,android23:ke,androidStock:lt,opera:Ct,chrome:Nt,gecko:Ce,safari:Ge,phantom:$e,opera12:at,win:ct,ie3d:Vt,webkit3d:Me,gecko3d:De,any3d:Je,mobile:St,mobileWebkit:bt,mobileWebkit3d:Ie,msPointer:Ue,pointer:Oe,touch:Xe,touchNative:Ee,mobileOpera:Et,mobileGecko:Fe,retina:ht,passiveEvents:ti,canvas:Ke,svg:zt,vml:Tt,inlineSvg:mt,mac:Ut,linux:zi},Ui=Dt.msPointer?"MSPointerDown":"pointerdown",Cr=Dt.msPointer?"MSPointerMove":"pointermove",nn=Dt.msPointer?"MSPointerUp":"pointerup",tr=Dt.msPointer?"MSPointerCancel":"pointercancel",lr={touchstart:Ui,touchmove:Cr,touchend:nn,touchcancel:tr},Xa={touchstart:pu,touchmove:Xs,touchend:Xs,touchcancel:Xs},Gr={},hl=!1;function Xp(D,x,H){return x==="touchstart"&&Uc(),Xa[x]?(H=Xa[x].bind(this,H),D.addEventListener(lr[x],H,!1),H):(console.warn("wrong event specified:",x),d)}function Tc(D,x,H){if(!lr[x]){console.warn("wrong event specified:",x);return}D.removeEventListener(lr[x],H,!1)}function uf(D){Gr[D.pointerId]=D}function zd(D){Gr[D.pointerId]&&(Gr[D.pointerId]=D)}function An(D){delete Gr[D.pointerId]}function Uc(){hl||(document.addEventListener(Ui,uf,!0),document.addEventListener(Cr,zd,!0),document.addEventListener(nn,An,!0),document.addEventListener(tr,An,!0),hl=!0)}function Xs(D,x){if(x.pointerType!==(x.MSPOINTER_TYPE_MOUSE||"mouse")){x.touches=[];for(var H in Gr)x.touches.push(Gr[H]);x.changedTouches=[x],D(x)}}function pu(D,x){x.MSPOINTER_TYPE_TOUCH&&x.pointerType===x.MSPOINTER_TYPE_TOUCH&&_a(x),Xs(D,x)}function hu(D){var x={},H,Y;for(Y in D)H=D[Y],x[Y]=H&&H.bind?H.bind(D):H;return D=x,x.type="dblclick",x.detail=2,x.isTrusted=!1,x._simulated=!0,x}var fl=200;function Co(D,x){D.addEventListener("dblclick",x);var H=0,Y;function re(ge){if(ge.detail!==1){Y=ge.detail;return}if(!(ge.pointerType==="mouse"||ge.sourceCapabilities&&!ge.sourceCapabilities.firesTouchEvents)){var Ne=ee(ge);if(!(Ne.some(function(st){return st instanceof HTMLLabelElement&&st.attributes.for})&&!Ne.some(function(st){return st instanceof HTMLInputElement||st instanceof HTMLSelectElement}))){var Ze=Date.now();Ze-H<=fl?(Y++,Y===2&&x(hu(ge))):Y=1,H=Ze}}}return D.addEventListener("click",re),{dblclick:x,simDblclick:re}}function Dc(D,x){D.removeEventListener("dblclick",x.dblclick),D.removeEventListener("click",x.simDblclick)}var Js=cd(["transform","webkitTransform","OTransform","MozTransform","msTransform"]),Fs=cd(["webkitTransition","transition","OTransition","MozTransition","msTransition"]),Ec=Fs==="webkitTransition"||Fs==="OTransition"?Fs+"End":"transitionend";function df(D){return typeof D=="string"?document.getElementById(D):D}function nt(D,x){var H=D.style[x]||D.currentStyle&&D.currentStyle[x];if((!H||H==="auto")&&document.defaultView){var Y=document.defaultView.getComputedStyle(D,null);H=Y?Y[x]:null}return H==="auto"?null:H}function Wt(D,x,H){var Y=document.createElement(D);return Y.className=x||"",H&&H.appendChild(Y),Y}function $i(D){var x=D.parentNode;x&&x.removeChild(D)}function Ja(D){for(;D.firstChild;)D.removeChild(D.firstChild)}function on(D){var x=D.parentNode;x&&x.lastChild!==D&&x.appendChild(D)}function Yo(D){var x=D.parentNode;x&&x.firstChild!==D&&x.insertBefore(D,x.firstChild)}function ml(D,x){if(D.classList!==void 0)return D.classList.contains(x);var H=ld(D);return H.length>0&&new RegExp("(^|\\s)"+x+"(\\s|$)").test(H)}function qi(D,x){if(D.classList!==void 0)for(var H=f(x),Y=0,re=H.length;Y<re;Y++)D.classList.add(H[Y]);else if(!ml(D,x)){var ge=ld(D);Jp(D,(ge?ge+" ":"")+x)}}function zr(D,x){D.classList!==void 0?D.classList.remove(x):Jp(D,h((" "+ld(D)+" ").replace(" "+x+" "," ")))}function Jp(D,x){D.className.baseVal===void 0?D.className=x:D.className.baseVal=x}function ld(D){return D.correspondingElement&&(D=D.correspondingElement),D.className.baseVal===void 0?D.className:D.className.baseVal}function Ro(D,x){"opacity"in D.style?D.style.opacity=x:"filter"in D.style&&pf(D,x)}function pf(D,x){var H=!1,Y="DXImageTransform.Microsoft.Alpha";try{H=D.filters.item(Y)}catch{if(x===1)return}x=Math.round(x*100),H?(H.Enabled=x!==100,H.Opacity=x):D.style.filter+=" progid:"+Y+"(opacity="+x+")"}function cd(D){for(var x=document.documentElement.style,H=0;H<D.length;H++)if(D[H]in x)return D[H];return!1}function $s(D,x,H){var Y=x||new O(0,0);D.style[Js]=(Dt.ie3d?"translate("+Y.x+"px,"+Y.y+"px)":"translate3d("+Y.x+"px,"+Y.y+"px,0)")+(H?" scale("+H+")":"")}function qr(D,x){D._leaflet_pos=x,Dt.any3d?$s(D,x):(D.style.left=x.x+"px",D.style.top=x.y+"px")}function Ko(D){return D._leaflet_pos||new O(0,0)}var Mo,ln,gl;if("onselectstart"in document)Mo=function(){Bi(window,"selectstart",_a)},ln=function(){cr(window,"selectstart",_a)};else{var Qp=cd(["userSelect","WebkitUserSelect","OUserSelect","MozUserSelect","msUserSelect"]);Mo=function(){if(Qp){var D=document.documentElement.style;gl=D[Qp],D[Qp]="none"}},ln=function(){Qp&&(document.documentElement.style[Qp]=gl,gl=void 0)}}function Gl(){Bi(window,"dragstart",_a)}function Bs(){cr(window,"dragstart",_a)}var Pc,qd;function Hl(D){for(;D.tabIndex===-1;)D=D.parentNode;D.style&&(Wd(),Pc=D,qd=D.style.outlineStyle,D.style.outlineStyle="none",Bi(window,"keydown",Wd))}function Wd(){Pc&&(Pc.style.outlineStyle=qd,Pc=void 0,qd=void 0,cr(window,"keydown",Wd))}function Vs(D){do D=D.parentNode;while((!D.offsetWidth||!D.offsetHeight)&&D!==document.body);return D}function ha(D){var x=D.getBoundingClientRect();return{x:x.width/D.offsetWidth||1,y:x.height/D.offsetHeight||1,boundingClientRect:x}}var vl={__proto__:null,TRANSFORM:Js,TRANSITION:Fs,TRANSITION_END:Ec,get:df,getStyle:nt,create:Wt,remove:$i,empty:Ja,toFront:on,toBack:Yo,hasClass:ml,addClass:qi,removeClass:zr,setClass:Jp,getClass:ld,setOpacity:Ro,testProp:cd,setTransform:$s,setPosition:qr,getPosition:Ko,get disableTextSelection(){return Mo},get enableTextSelection(){return ln},disableImageDrag:Gl,enableImageDrag:Bs,preventOutline:Hl,restoreOutline:Wd,getSizedParentNode:Vs,getScale:ha};function Bi(D,x,H,Y){if(x&&typeof x=="object")for(var re in x)Qs(D,re,x[re],H);else{x=f(x);for(var ge=0,Ne=x.length;ge<Ne;ge++)Qs(D,x[ge],H,Y)}return this}var Ds="_leaflet_events";function cr(D,x,H,Y){if(arguments.length===1)Cc(D),delete D[Ds];else if(x&&typeof x=="object")for(var re in x)Yd(D,re,x[re],H);else if(x=f(x),arguments.length===2)Cc(D,function(Ze){return I(x,Ze)!==-1});else for(var ge=0,Ne=x.length;ge<Ne;ge++)Yd(D,x[ge],H,Y);return this}function Cc(D,x){for(var H in D[Ds]){var Y=H.split(/\d/)[0];(!x||x(Y))&&Yd(D,Y,null,null,H)}}var hf={mouseenter:"mouseover",mouseleave:"mouseout",wheel:!("onwheel"in window)&&"mousewheel"};function Qs(D,x,H,Y){var re=x+l(H)+(Y?"_"+l(Y):"");if(D[Ds]&&D[Ds][re])return this;var ge=function(Ze){return H.call(Y||D,Ze||window.event)},Ne=ge;!Dt.touchNative&&Dt.pointer&&x.indexOf("touch")===0?ge=Xp(D,x,ge):Dt.touch&&x==="dblclick"?ge=Co(D,ge):"addEventListener"in D?x==="touchstart"||x==="touchmove"||x==="wheel"||x==="mousewheel"?D.addEventListener(hf[x]||x,ge,Dt.passiveEvents?{passive:!1}:!1):x==="mouseenter"||x==="mouseleave"?(ge=function(Ze){Ze=Ze||window.event,Wi(D,Ze)&&Ne(Ze)},D.addEventListener(hf[x],ge,!1)):D.addEventListener(x,Ne,!1):D.attachEvent("on"+x,ge),D[Ds]=D[Ds]||{},D[Ds][re]=ge}function Yd(D,x,H,Y,re){re=re||x+l(H)+(Y?"_"+l(Y):"");var ge=D[Ds]&&D[Ds][re];if(!ge)return this;!Dt.touchNative&&Dt.pointer&&x.indexOf("touch")===0?Tc(D,x,ge):Dt.touch&&x==="dblclick"?Dc(D,ge):"removeEventListener"in D?D.removeEventListener(hf[x]||x,ge,!1):D.detachEvent("on"+x,ge),D[Ds][re]=null}function js(D){return D.stopPropagation?D.stopPropagation():D.originalEvent?D.originalEvent._stopped=!0:D.cancelBubble=!0,this}function Kd(D){return Qs(D,"wheel",js),this}function yl(D){return Bi(D,"mousedown touchstart dblclick contextmenu",js),D._leaflet_disable_click=!0,this}function _a(D){return D.preventDefault?D.preventDefault():D.returnValue=!1,this}function fu(D){return _a(D),js(D),this}function ee(D){if(D.composedPath)return D.composedPath();for(var x=[],H=D.target;H;)x.push(H),H=H.parentNode;return x}function ye(D,x){if(!x)return new O(D.clientX,D.clientY);var H=ha(x),Y=H.boundingClientRect;return new O((D.clientX-Y.left)/H.x-x.clientLeft,(D.clientY-Y.top)/H.y-x.clientTop)}var _e=Dt.linux&&Dt.chrome?window.devicePixelRatio:Dt.mac?window.devicePixelRatio*3:window.devicePixelRatio>0?2*window.devicePixelRatio:1;function ft(D){return Dt.edge?D.wheelDeltaY/2:D.deltaY&&D.deltaMode===0?-D.deltaY/_e:D.deltaY&&D.deltaMode===1?-D.deltaY*20:D.deltaY&&D.deltaMode===2?-D.deltaY*60:D.deltaX||D.deltaZ?0:D.wheelDelta?(D.wheelDeltaY||D.wheelDelta)/2:D.detail&&Math.abs(D.detail)<32765?-D.detail*20:D.detail?D.detail/-32765*60:0}function Wi(D,x){var H=x.relatedTarget;if(!H)return!0;try{for(;H&&H!==D;)H=H.parentNode}catch{return!1}return H!==D}var bi={__proto__:null,on:Bi,off:cr,stopPropagation:js,disableScrollPropagation:Kd,disableClickPropagation:yl,preventDefault:_a,stop:fu,getPropagationPath:ee,getMousePosition:ye,getWheelDelta:ft,isExternalTarget:Wi,addListener:Bi,removeListener:cr},Wn=k.extend({run:function(D,x,H,Y){this.stop(),this._el=D,this._inProgress=!0,this._duration=H||.25,this._easeOutPower=1/Math.max(Y||.5,.2),this._startPos=Ko(D),this._offset=x.subtract(this._startPos),this._startTime=+new Date,this.fire("start"),this._animate()},stop:function(){this._inProgress&&(this._step(!0),this._complete())},_animate:function(){this._animId=R(this._animate,this),this._step()},_step:function(D){var x=+new Date-this._startTime,H=this._duration*1e3;x<H?this._runFrame(this._easeOut(x/H),D):(this._runFrame(1),this._complete())},_runFrame:function(D,x){var H=this._startPos.add(this._offset.multiplyBy(D));x&&H._round(),qr(this._el,H),this.fire("step")},_complete:function(){C(this._animId),this._inProgress=!1,this.fire("end")},_easeOut:function(D){return 1-Math.pow(1-D,this._easeOutPower)}}),li=k.extend({options:{crs:oe,center:void 0,zoom:void 0,minZoom:void 0,maxZoom:void 0,layers:[],maxBounds:void 0,renderer:void 0,zoomAnimation:!0,zoomAnimationThreshold:4,fadeAnimation:!0,markerZoomAnimation:!0,transform3DLimit:8388608,zoomSnap:1,zoomDelta:1,trackResize:!0},initialize:function(D,x){x=m(this,x),this._handlers=[],this._layers={},this._zoomBoundLayers={},this._sizeChanged=!0,this._initContainer(D),this._initLayout(),this._onResize=s(this._onResize,this),this._initEvents(),x.maxBounds&&this.setMaxBounds(x.maxBounds),x.zoom!==void 0&&(this._zoom=this._limitZoom(x.zoom)),x.center&&x.zoom!==void 0&&this.setView(Z(x.center),x.zoom,{reset:!0}),this.callInitHooks(),this._zoomAnimated=Fs&&Dt.any3d&&!Dt.mobileOpera&&this.options.zoomAnimation,this._zoomAnimated&&(this._createAnimProxy(),Bi(this._proxy,Ec,this._catchTransitionEnd,this)),this._addLayers(this.options.layers)},setView:function(D,x,H){if(x=x===void 0?this._zoom:this._limitZoom(x),D=this._limitCenter(Z(D),x,this.options.maxBounds),H=H||{},this._stop(),this._loaded&&!H.reset&&H!==!0){H.animate!==void 0&&(H.zoom=r({animate:H.animate},H.zoom),H.pan=r({animate:H.animate,duration:H.duration},H.pan));var Y=this._zoom!==x?this._tryAnimatedZoom&&this._tryAnimatedZoom(D,x,H.zoom):this._tryAnimatedPan(D,H.pan);if(Y)return clearTimeout(this._sizeTimer),this}return this._resetView(D,x,H.pan&&H.pan.noMoveStart),this},setZoom:function(D,x){return this._loaded?this.setView(this.getCenter(),D,{zoom:x}):(this._zoom=D,this)},zoomIn:function(D,x){return D=D||(Dt.any3d?this.options.zoomDelta:1),this.setZoom(this._zoom+D,x)},zoomOut:function(D,x){return D=D||(Dt.any3d?this.options.zoomDelta:1),this.setZoom(this._zoom-D,x)},setZoomAround:function(D,x,H){var Y=this.getZoomScale(x),re=this.getSize().divideBy(2),ge=D instanceof O?D:this.latLngToContainerPoint(D),Ne=ge.subtract(re).multiplyBy(1-1/Y),Ze=this.containerPointToLatLng(re.add(Ne));return this.setView(Ze,x,{zoom:H})},_getBoundsCenterZoom:function(D,x){x=x||{},D=D.getBounds?D.getBounds():z(D);var H=F(x.paddingTopLeft||x.padding||[0,0]),Y=F(x.paddingBottomRight||x.padding||[0,0]),re=this.getBoundsZoom(D,!1,H.add(Y));if(re=typeof x.maxZoom=="number"?Math.min(x.maxZoom,re):re,re===1/0)return{center:D.getCenter(),zoom:re};var ge=Y.subtract(H).divideBy(2),Ne=this.project(D.getSouthWest(),re),Ze=this.project(D.getNorthEast(),re),st=this.unproject(Ne.add(Ze).divideBy(2).add(ge),re);return{center:st,zoom:re}},fitBounds:function(D,x){if(D=z(D),!D.isValid())throw new Error("Bounds are not valid.");var H=this._getBoundsCenterZoom(D,x);return this.setView(H.center,H.zoom,x)},fitWorld:function(D){return this.fitBounds([[-90,-180],[90,180]],D)},panTo:function(D,x){return this.setView(D,this._zoom,{pan:x})},panBy:function(D,x){if(D=F(D).round(),x=x||{},!D.x&&!D.y)return this.fire("moveend");if(x.animate!==!0&&!this.getSize().contains(D))return this._resetView(this.unproject(this.project(this.getCenter()).add(D)),this.getZoom()),this;if(this._panAnim||(this._panAnim=new Wn,this._panAnim.on({step:this._onPanTransitionStep,end:this._onPanTransitionEnd},this)),x.noMoveStart||this.fire("movestart"),x.animate!==!1){qi(this._mapPane,"leaflet-pan-anim");var H=this._getMapPanePos().subtract(D).round();this._panAnim.run(this._mapPane,H,x.duration||.25,x.easeLinearity)}else this._rawPanBy(D),this.fire("move").fire("moveend");return this},flyTo:function(D,x,H){if(H=H||{},H.animate===!1||!Dt.any3d)return this.setView(D,x,H);this._stop();var Y=this.project(this.getCenter()),re=this.project(D),ge=this.getSize(),Ne=this._zoom;D=Z(D),x=x===void 0?Ne:x;var Ze=Math.max(ge.x,ge.y),st=Ze*this.getZoomScale(Ne,x),Pt=re.distanceTo(Y)||1,ci=1.42,rn=ci*ci;function ir(to){var FM=to?-1:1,RRe=to?st:Ze,MRe=st*st-Ze*Ze+FM*rn*rn*Pt*Pt,NRe=2*RRe*rn*Pt,d$=MRe/NRe,xK=Math.sqrt(d$*d$+1)-d$,ARe=xK<1e-9?-18:Math.log(xK);return ARe}function Mc(to){return(Math.exp(to)-Math.exp(-to))/2}function Zo(to){return(Math.exp(to)+Math.exp(-to))/2}function Jd(to){return Mc(to)/Zo(to)}var vu=ir(0);function g0(to){return Ze*(Zo(vu)/Zo(vu+ci*to))}function DRe(to){return Ze*(Zo(vu)*Jd(vu+ci*to)-Mc(vu))/rn}function ERe(to){return 1-Math.pow(1-to,1.5)}var PRe=Date.now(),_K=(ir(1)-vu)/ci,CRe=H.duration?1e3*H.duration:1e3*_K*.8;function kK(){var to=(Date.now()-PRe)/CRe,FM=ERe(to)*_K;to<=1?(this._flyToFrame=R(kK,this),this._move(this.unproject(Y.add(re.subtract(Y).multiplyBy(DRe(FM)/Pt)),Ne),this.getScaleZoom(Ze/g0(FM),Ne),{flyTo:!0})):this._move(D,x)._moveEnd(!0)}return this._moveStart(!0,H.noMoveStart),kK.call(this),this},flyToBounds:function(D,x){var H=this._getBoundsCenterZoom(D,x);return this.flyTo(H.center,H.zoom,x)},setMaxBounds:function(D){return D=z(D),this.listens("moveend",this._panInsideMaxBounds)&&this.off("moveend",this._panInsideMaxBounds),D.isValid()?(this.options.maxBounds=D,this._loaded&&this._panInsideMaxBounds(),this.on("moveend",this._panInsideMaxBounds)):(this.options.maxBounds=null,this)},setMinZoom:function(D){var x=this.options.minZoom;return this.options.minZoom=D,this._loaded&&x!==D&&(this.fire("zoomlevelschange"),this.getZoom()<this.options.minZoom)?this.setZoom(D):this},setMaxZoom:function(D){var x=this.options.maxZoom;return this.options.maxZoom=D,this._loaded&&x!==D&&(this.fire("zoomlevelschange"),this.getZoom()>this.options.maxZoom)?this.setZoom(D):this},panInsideBounds:function(D,x){this._enforcingBounds=!0;var H=this.getCenter(),Y=this._limitCenter(H,this._zoom,z(D));return H.equals(Y)||this.panTo(Y,x),this._enforcingBounds=!1,this},panInside:function(D,x){x=x||{};var H=F(x.paddingTopLeft||x.padding||[0,0]),Y=F(x.paddingBottomRight||x.padding||[0,0]),re=this.project(this.getCenter()),ge=this.project(D),Ne=this.getPixelBounds(),Ze=j([Ne.min.add(H),Ne.max.subtract(Y)]),st=Ze.getSize();if(!Ze.contains(ge)){this._enforcingBounds=!0;var Pt=ge.subtract(Ze.getCenter()),ci=Ze.extend(ge).getSize().subtract(st);re.x+=Pt.x<0?-ci.x:ci.x,re.y+=Pt.y<0?-ci.y:ci.y,this.panTo(this.unproject(re),x),this._enforcingBounds=!1}return this},invalidateSize:function(D){if(!this._loaded)return this;D=r({animate:!1,pan:!0},D===!0?{animate:!0}:D);var x=this.getSize();this._sizeChanged=!0,this._lastCenter=null;var H=this.getSize(),Y=x.divideBy(2).round(),re=H.divideBy(2).round(),ge=Y.subtract(re);return!ge.x&&!ge.y?this:(D.animate&&D.pan?this.panBy(ge):(D.pan&&this._rawPanBy(ge),this.fire("move"),D.debounceMoveend?(clearTimeout(this._sizeTimer),this._sizeTimer=setTimeout(s(this.fire,this,"moveend"),200)):this.fire("moveend")),this.fire("resize",{oldSize:x,newSize:H}))},stop:function(){return this.setZoom(this._limitZoom(this._zoom)),this.options.zoomSnap||this.fire("viewreset"),this._stop()},locate:function(D){if(D=this._locateOptions=r({timeout:1e4,watch:!1},D),!("geolocation"in navigator))return this._handleGeolocationError({code:0,message:"Geolocation not supported."}),this;var x=s(this._handleGeolocationResponse,this),H=s(this._handleGeolocationError,this);return D.watch?this._locationWatchId=navigator.geolocation.watchPosition(x,H,D):navigator.geolocation.getCurrentPosition(x,H,D),this},stopLocate:function(){return navigator.geolocation&&navigator.geolocation.clearWatch&&navigator.geolocation.clearWatch(this._locationWatchId),this._locateOptions&&(this._locateOptions.setView=!1),this},_handleGeolocationError:function(D){if(this._container._leaflet_id){var x=D.code,H=D.message||(x===1?"permission denied":x===2?"position unavailable":"timeout");this._locateOptions.setView&&!this._loaded&&this.fitWorld(),this.fire("locationerror",{code:x,message:"Geolocation error: "+H+"."})}},_handleGeolocationResponse:function(D){if(this._container._leaflet_id){var x=D.coords.latitude,H=D.coords.longitude,Y=new W(x,H),re=Y.toBounds(D.coords.accuracy*2),ge=this._locateOptions;if(ge.setView){var Ne=this.getBoundsZoom(re);this.setView(Y,ge.maxZoom?Math.min(Ne,ge.maxZoom):Ne)}var Ze={latlng:Y,bounds:re,timestamp:D.timestamp};for(var st in D.coords)typeof D.coords[st]=="number"&&(Ze[st]=D.coords[st]);this.fire("locationfound",Ze)}},addHandler:function(D,x){if(!x)return this;var H=this[D]=new x(this);return this._handlers.push(H),this.options[D]&&H.enable(),this},remove:function(){if(this._initEvents(!0),this.options.maxBounds&&this.off("moveend",this._panInsideMaxBounds),this._containerId!==this._container._leaflet_id)throw new Error("Map container is being reused by another instance");try{delete this._container._leaflet_id,delete this._containerId}catch{this._container._leaflet_id=void 0,this._containerId=void 0}this._locationWatchId!==void 0&&this.stopLocate(),this._stop(),$i(this._mapPane),this._clearControlPos&&this._clearControlPos(),this._resizeRequest&&(C(this._resizeRequest),this._resizeRequest=null),this._clearHandlers(),this._loaded&&this.fire("unload");var D;for(D in this._layers)this._layers[D].remove();for(D in this._panes)$i(this._panes[D]);return this._layers=[],this._panes=[],delete this._mapPane,delete this._renderer,this},createPane:function(D,x){var H="leaflet-pane"+(D?" leaflet-"+D.replace("Pane","")+"-pane":""),Y=Wt("div",H,x||this._mapPane);return D&&(this._panes[D]=Y),Y},getCenter:function(){return this._checkIfLoaded(),this._lastCenter&&!this._moved()?this._lastCenter.clone():this.layerPointToLatLng(this._getCenterLayerPoint())},getZoom:function(){return this._zoom},getBounds:function(){var D=this.getPixelBounds(),x=this.unproject(D.getBottomLeft()),H=this.unproject(D.getTopRight());return new B(x,H)},getMinZoom:function(){return this.options.minZoom===void 0?this._layersMinZoom||0:this.options.minZoom},getMaxZoom:function(){return this.options.maxZoom===void 0?this._layersMaxZoom===void 0?1/0:this._layersMaxZoom:this.options.maxZoom},getBoundsZoom:function(D,x,H){D=z(D),H=F(H||[0,0]);var Y=this.getZoom()||0,re=this.getMinZoom(),ge=this.getMaxZoom(),Ne=D.getNorthWest(),Ze=D.getSouthEast(),st=this.getSize().subtract(H),Pt=j(this.project(Ze,Y),this.project(Ne,Y)).getSize(),ci=Dt.any3d?this.options.zoomSnap:1,rn=st.x/Pt.x,ir=st.y/Pt.y,Mc=x?Math.max(rn,ir):Math.min(rn,ir);return Y=this.getScaleZoom(Mc,Y),ci&&(Y=Math.round(Y/(ci/100))*(ci/100),Y=x?Math.ceil(Y/ci)*ci:Math.floor(Y/ci)*ci),Math.max(re,Math.min(ge,Y))},getSize:function(){return(!this._size||this._sizeChanged)&&(this._size=new O(this._container.clientWidth||0,this._container.clientHeight||0),this._sizeChanged=!1),this._size.clone()},getPixelBounds:function(D,x){var H=this._getTopLeftPoint(D,x);return new V(H,H.add(this.getSize()))},getPixelOrigin:function(){return this._checkIfLoaded(),this._pixelOrigin},getPixelWorldBounds:function(D){return this.options.crs.getProjectedBounds(D===void 0?this.getZoom():D)},getPane:function(D){return typeof D=="string"?this._panes[D]:D},getPanes:function(){return this._panes},getContainer:function(){return this._container},getZoomScale:function(D,x){var H=this.options.crs;return x=x===void 0?this._zoom:x,H.scale(D)/H.scale(x)},getScaleZoom:function(D,x){var H=this.options.crs;x=x===void 0?this._zoom:x;var Y=H.zoom(D*H.scale(x));return isNaN(Y)?1/0:Y},project:function(D,x){return x=x===void 0?this._zoom:x,this.options.crs.latLngToPoint(Z(D),x)},unproject:function(D,x){return x=x===void 0?this._zoom:x,this.options.crs.pointToLatLng(F(D),x)},layerPointToLatLng:function(D){var x=F(D).add(this.getPixelOrigin());return this.unproject(x)},latLngToLayerPoint:function(D){var x=this.project(Z(D))._round();return x._subtract(this.getPixelOrigin())},wrapLatLng:function(D){return this.options.crs.wrapLatLng(Z(D))},wrapLatLngBounds:function(D){return this.options.crs.wrapLatLngBounds(z(D))},distance:function(D,x){return this.options.crs.distance(Z(D),Z(x))},containerPointToLayerPoint:function(D){return F(D).subtract(this._getMapPanePos())},layerPointToContainerPoint:function(D){return F(D).add(this._getMapPanePos())},containerPointToLatLng:function(D){var x=this.containerPointToLayerPoint(F(D));return this.layerPointToLatLng(x)},latLngToContainerPoint:function(D){return this.layerPointToContainerPoint(this.latLngToLayerPoint(Z(D)))},mouseEventToContainerPoint:function(D){return ye(D,this._container)},mouseEventToLayerPoint:function(D){return this.containerPointToLayerPoint(this.mouseEventToContainerPoint(D))},mouseEventToLatLng:function(D){return this.layerPointToLatLng(this.mouseEventToLayerPoint(D))},_initContainer:function(D){var x=this._container=df(D);if(x){if(x._leaflet_id)throw new Error("Map container is already initialized.")}else throw new Error("Map container not found.");Bi(x,"scroll",this._onScroll,this),this._containerId=l(x)},_initLayout:function(){var D=this._container;this._fadeAnimated=this.options.fadeAnimation&&Dt.any3d,qi(D,"leaflet-container"+(Dt.touch?" leaflet-touch":"")+(Dt.retina?" leaflet-retina":"")+(Dt.ielt9?" leaflet-oldie":"")+(Dt.safari?" leaflet-safari":"")+(this._fadeAnimated?" leaflet-fade-anim":""));var x=nt(D,"position");x!=="absolute"&&x!=="relative"&&x!=="fixed"&&x!=="sticky"&&(D.style.position="relative"),this._initPanes(),this._initControlPos&&this._initControlPos()},_initPanes:function(){var D=this._panes={};this._paneRenderers={},this._mapPane=this.createPane("mapPane",this._container),qr(this._mapPane,new O(0,0)),this.createPane("tilePane"),this.createPane("overlayPane"),this.createPane("shadowPane"),this.createPane("markerPane"),this.createPane("tooltipPane"),this.createPane("popupPane"),this.options.markerZoomAnimation||(qi(D.markerPane,"leaflet-zoom-hide"),qi(D.shadowPane,"leaflet-zoom-hide"))},_resetView:function(D,x,H){qr(this._mapPane,new O(0,0));var Y=!this._loaded;this._loaded=!0,x=this._limitZoom(x),this.fire("viewprereset");var re=this._zoom!==x;this._moveStart(re,H)._move(D,x)._moveEnd(re),this.fire("viewreset"),Y&&this.fire("load")},_moveStart:function(D,x){return D&&this.fire("zoomstart"),x||this.fire("movestart"),this},_move:function(D,x,H,Y){x===void 0&&(x=this._zoom);var re=this._zoom!==x;return this._zoom=x,this._lastCenter=D,this._pixelOrigin=this._getNewPixelOrigin(D),Y?H&&H.pinch&&this.fire("zoom",H):((re||H&&H.pinch)&&this.fire("zoom",H),this.fire("move",H)),this},_moveEnd:function(D){return D&&this.fire("zoomend"),this.fire("moveend")},_stop:function(){return C(this._flyToFrame),this._panAnim&&this._panAnim.stop(),this},_rawPanBy:function(D){qr(this._mapPane,this._getMapPanePos().subtract(D))},_getZoomSpan:function(){return this.getMaxZoom()-this.getMinZoom()},_panInsideMaxBounds:function(){this._enforcingBounds||this.panInsideBounds(this.options.maxBounds)},_checkIfLoaded:function(){if(!this._loaded)throw new Error("Set map center and zoom first.")},_initEvents:function(D){this._targets={},this._targets[l(this._container)]=this;var x=D?cr:Bi;x(this._container,"click dblclick mousedown mouseup mouseover mouseout mousemove contextmenu keypress keydown keyup",this._handleDOMEvent,this),this.options.trackResize&&x(window,"resize",this._onResize,this),Dt.any3d&&this.options.transform3DLimit&&(D?this.off:this.on).call(this,"moveend",this._onMoveEnd)},_onResize:function(){C(this._resizeRequest),this._resizeRequest=R(function(){this.invalidateSize({debounceMoveend:!0})},this)},_onScroll:function(){this._container.scrollTop=0,this._container.scrollLeft=0},_onMoveEnd:function(){var D=this._getMapPanePos();Math.max(Math.abs(D.x),Math.abs(D.y))>=this.options.transform3DLimit&&this._resetView(this.getCenter(),this.getZoom())},_findEventTargets:function(D,x){for(var H=[],Y,re=x==="mouseout"||x==="mouseover",ge=D.target||D.srcElement,Ne=!1;ge;){if(Y=this._targets[l(ge)],Y&&(x==="click"||x==="preclick")&&this._draggableMoved(Y)){Ne=!0;break}if(Y&&Y.listens(x,!0)&&(re&&!Wi(ge,D)||(H.push(Y),re))||ge===this._container)break;ge=ge.parentNode}return!H.length&&!Ne&&!re&&this.listens(x,!0)&&(H=[this]),H},_isClickDisabled:function(D){for(;D&&D!==this._container;){if(D._leaflet_disable_click)return!0;D=D.parentNode}},_handleDOMEvent:function(D){var x=D.target||D.srcElement;if(!(!this._loaded||x._leaflet_disable_events||D.type==="click"&&this._isClickDisabled(x))){var H=D.type;H==="mousedown"&&Hl(x),this._fireDOMEvent(D,H)}},_mouseEvents:["click","dblclick","mouseover","mouseout","contextmenu"],_fireDOMEvent:function(D,x,H){if(D.type==="click"){var Y=r({},D);Y.type="preclick",this._fireDOMEvent(Y,Y.type,H)}var re=this._findEventTargets(D,x);if(H){for(var ge=[],Ne=0;Ne<H.length;Ne++)H[Ne].listens(x,!0)&&ge.push(H[Ne]);re=ge.concat(re)}if(re.length){x==="contextmenu"&&_a(D);var Ze=re[0],st={originalEvent:D};if(D.type!=="keypress"&&D.type!=="keydown"&&D.type!=="keyup"){var Pt=Ze.getLatLng&&(!Ze._radius||Ze._radius<=10);st.containerPoint=Pt?this.latLngToContainerPoint(Ze.getLatLng()):this.mouseEventToContainerPoint(D),st.layerPoint=this.containerPointToLayerPoint(st.containerPoint),st.latlng=Pt?Ze.getLatLng():this.layerPointToLatLng(st.layerPoint)}for(Ne=0;Ne<re.length;Ne++)if(re[Ne].fire(x,st,!0),st.originalEvent._stopped||re[Ne].options.bubblingMouseEvents===!1&&I(this._mouseEvents,x)!==-1)return}},_draggableMoved:function(D){return D=D.dragging&&D.dragging.enabled()?D:this,D.dragging&&D.dragging.moved()||this.boxZoom&&this.boxZoom.moved()},_clearHandlers:function(){for(var D=0,x=this._handlers.length;D<x;D++)this._handlers[D].disable()},whenReady:function(D,x){return this._loaded?D.call(x||this,{target:this}):this.on("load",D,x),this},_getMapPanePos:function(){return Ko(this._mapPane)||new O(0,0)},_moved:function(){var D=this._getMapPanePos();return D&&!D.equals([0,0])},_getTopLeftPoint:function(D,x){var H=D&&x!==void 0?this._getNewPixelOrigin(D,x):this.getPixelOrigin();return H.subtract(this._getMapPanePos())},_getNewPixelOrigin:function(D,x){var H=this.getSize()._divideBy(2);return this.project(D,x)._subtract(H)._add(this._getMapPanePos())._round()},_latLngToNewLayerPoint:function(D,x,H){var Y=this._getNewPixelOrigin(H,x);return this.project(D,x)._subtract(Y)},_latLngBoundsToNewLayerBounds:function(D,x,H){var Y=this._getNewPixelOrigin(H,x);return j([this.project(D.getSouthWest(),x)._subtract(Y),this.project(D.getNorthWest(),x)._subtract(Y),this.project(D.getSouthEast(),x)._subtract(Y),this.project(D.getNorthEast(),x)._subtract(Y)])},_getCenterLayerPoint:function(){return this.containerPointToLayerPoint(this.getSize()._divideBy(2))},_getCenterOffset:function(D){return this.latLngToLayerPoint(D).subtract(this._getCenterLayerPoint())},_limitCenter:function(D,x,H){if(!H)return D;var Y=this.project(D,x),re=this.getSize().divideBy(2),ge=new V(Y.subtract(re),Y.add(re)),Ne=this._getBoundsOffset(ge,H,x);return Math.abs(Ne.x)<=1&&Math.abs(Ne.y)<=1?D:this.unproject(Y.add(Ne),x)},_limitOffset:function(D,x){if(!x)return D;var H=this.getPixelBounds(),Y=new V(H.min.add(D),H.max.add(D));return D.add(this._getBoundsOffset(Y,x))},_getBoundsOffset:function(D,x,H){var Y=j(this.project(x.getNorthEast(),H),this.project(x.getSouthWest(),H)),re=Y.min.subtract(D.min),ge=Y.max.subtract(D.max),Ne=this._rebound(re.x,-ge.x),Ze=this._rebound(re.y,-ge.y);return new O(Ne,Ze)},_rebound:function(D,x){return D+x>0?Math.round(D-x)/2:Math.max(0,Math.ceil(D))-Math.max(0,Math.floor(x))},_limitZoom:function(D){var x=this.getMinZoom(),H=this.getMaxZoom(),Y=Dt.any3d?this.options.zoomSnap:1;return Y&&(D=Math.round(D/Y)*Y),Math.max(x,Math.min(H,D))},_onPanTransitionStep:function(){this.fire("move")},_onPanTransitionEnd:function(){zr(this._mapPane,"leaflet-pan-anim"),this.fire("moveend")},_tryAnimatedPan:function(D,x){var H=this._getCenterOffset(D)._trunc();return(x&&x.animate)!==!0&&!this.getSize().contains(H)?!1:(this.panBy(H,x),!0)},_createAnimProxy:function(){var D=this._proxy=Wt("div","leaflet-proxy leaflet-zoom-animated");this._panes.mapPane.appendChild(D),this.on("zoomanim",function(x){var H=Js,Y=this._proxy.style[H];$s(this._proxy,this.project(x.center,x.zoom),this.getZoomScale(x.zoom,1)),Y===this._proxy.style[H]&&this._animatingZoom&&this._onZoomTransitionEnd()},this),this.on("load moveend",this._animMoveEnd,this),this._on("unload",this._destroyAnimProxy,this)},_destroyAnimProxy:function(){$i(this._proxy),this.off("load moveend",this._animMoveEnd,this),delete this._proxy},_animMoveEnd:function(){var D=this.getCenter(),x=this.getZoom();$s(this._proxy,this.project(D,x),this.getZoomScale(x,1))},_catchTransitionEnd:function(D){this._animatingZoom&&D.propertyName.indexOf("transform")>=0&&this._onZoomTransitionEnd()},_nothingToAnimate:function(){return!this._container.getElementsByClassName("leaflet-zoom-animated").length},_tryAnimatedZoom:function(D,x,H){if(this._animatingZoom)return!0;if(H=H||{},!this._zoomAnimated||H.animate===!1||this._nothingToAnimate()||Math.abs(x-this._zoom)>this.options.zoomAnimationThreshold)return!1;var Y=this.getZoomScale(x),re=this._getCenterOffset(D)._divideBy(1-1/Y);return H.animate!==!0&&!this.getSize().contains(re)?!1:(R(function(){this._moveStart(!0,H.noMoveStart||!1)._animateZoom(D,x,!0)},this),!0)},_animateZoom:function(D,x,H,Y){this._mapPane&&(H&&(this._animatingZoom=!0,this._animateToCenter=D,this._animateToZoom=x,qi(this._mapPane,"leaflet-zoom-anim")),this.fire("zoomanim",{center:D,zoom:x,noUpdate:Y}),this._tempFireZoomEvent||(this._tempFireZoomEvent=this._zoom!==this._animateToZoom),this._move(this._animateToCenter,this._animateToZoom,void 0,!0),setTimeout(s(this._onZoomTransitionEnd,this),250))},_onZoomTransitionEnd:function(){this._animatingZoom&&(this._mapPane&&zr(this._mapPane,"leaflet-zoom-anim"),this._animatingZoom=!1,this._move(this._animateToCenter,this._animateToZoom,void 0,!0),this._tempFireZoomEvent&&this.fire("zoom"),delete this._tempFireZoomEvent,this.fire("move"),this._moveEnd(!0))}});function Qa(D,x){return new li(D,x)}var Un=_.extend({options:{position:"topright"},initialize:function(D){m(this,D)},getPosition:function(){return this.options.position},setPosition:function(D){var x=this._map;return x&&x.removeControl(this),this.options.position=D,x&&x.addControl(this),this},getContainer:function(){return this._container},addTo:function(D){this.remove(),this._map=D;var x=this._container=this.onAdd(D),H=this.getPosition(),Y=D._controlCorners[H];return qi(x,"leaflet-control"),H.indexOf("bottom")!==-1?Y.insertBefore(x,Y.firstChild):Y.appendChild(x),this._map.on("unload",this.remove,this),this},remove:function(){return this._map?($i(this._container),this.onRemove&&this.onRemove(this._map),this._map.off("unload",this.remove,this),this._map=null,this):this},_refocusOnMap:function(D){this._map&&D&&D.screenX>0&&D.screenY>0&&this._map.getContainer().focus()}}),wa=function(D){return new Un(D)};li.include({addControl:function(D){return D.addTo(this),this},removeControl:function(D){return D.remove(),this},_initControlPos:function(){var D=this._controlCorners={},x="leaflet-",H=this._controlContainer=Wt("div",x+"control-container",this._container);function Y(re,ge){var Ne=x+re+" "+x+ge;D[re+ge]=Wt("div",Ne,H)}Y("top","left"),Y("top","right"),Y("bottom","left"),Y("bottom","right")},_clearControlPos:function(){for(var D in this._controlCorners)$i(this._controlCorners[D]);$i(this._controlContainer),delete this._controlCorners,delete this._controlContainer}});var Gs=Un.extend({options:{collapsed:!0,position:"topright",autoZIndex:!0,hideSingleBase:!1,sortLayers:!1,sortFunction:function(D,x,H,Y){return H<Y?-1:Y<H?1:0}},initialize:function(D,x,H){m(this,H),this._layerControlInputs=[],this._layers=[],this._lastZIndex=0,this._handlingClick=!1,this._preventClick=!1;for(var Y in D)this._addLayer(D[Y],Y);for(Y in x)this._addLayer(x[Y],Y,!0)},onAdd:function(D){this._initLayout(),this._update(),this._map=D,D.on("zoomend",this._checkDisabledLayers,this);for(var x=0;x<this._layers.length;x++)this._layers[x].layer.on("add remove",this._onLayerChange,this);return this._container},addTo:function(D){return Un.prototype.addTo.call(this,D),this._expandIfNotCollapsed()},onRemove:function(){this._map.off("zoomend",this._checkDisabledLayers,this);for(var D=0;D<this._layers.length;D++)this._layers[D].layer.off("add remove",this._onLayerChange,this)},addBaseLayer:function(D,x){return this._addLayer(D,x),this._map?this._update():this},addOverlay:function(D,x){return this._addLayer(D,x,!0),this._map?this._update():this},removeLayer:function(D){D.off("add remove",this._onLayerChange,this);var x=this._getLayer(l(D));return x&&this._layers.splice(this._layers.indexOf(x),1),this._map?this._update():this},expand:function(){qi(this._container,"leaflet-control-layers-expanded"),this._section.style.height=null;var D=this._map.getSize().y-(this._container.offsetTop+50);return D<this._section.clientHeight?(qi(this._section,"leaflet-control-layers-scrollbar"),this._section.style.height=D+"px"):zr(this._section,"leaflet-control-layers-scrollbar"),this._checkDisabledLayers(),this},collapse:function(){return zr(this._container,"leaflet-control-layers-expanded"),this},_initLayout:function(){var D="leaflet-control-layers",x=this._container=Wt("div",D),H=this.options.collapsed;x.setAttribute("aria-haspopup",!0),yl(x),Kd(x);var Y=this._section=Wt("section",D+"-list");H&&(this._map.on("click",this.collapse,this),Bi(x,{mouseenter:this._expandSafely,mouseleave:this.collapse},this));var re=this._layersLink=Wt("a",D+"-toggle",x);re.href="#",re.title="Layers",re.setAttribute("role","button"),Bi(re,{keydown:function(ge){ge.keyCode===13&&this._expandSafely()},click:function(ge){_a(ge),this._expandSafely()}},this),H||this.expand(),this._baseLayersList=Wt("div",D+"-base",Y),this._separator=Wt("div",D+"-separator",Y),this._overlaysList=Wt("div",D+"-overlays",Y),x.appendChild(Y)},_getLayer:function(D){for(var x=0;x<this._layers.length;x++)if(this._layers[x]&&l(this._layers[x].layer)===D)return this._layers[x]},_addLayer:function(D,x,H){this._map&&D.on("add remove",this._onLayerChange,this),this._layers.push({layer:D,name:x,overlay:H}),this.options.sortLayers&&this._layers.sort(s(function(Y,re){return this.options.sortFunction(Y.layer,re.layer,Y.name,re.name)},this)),this.options.autoZIndex&&D.setZIndex&&(this._lastZIndex++,D.setZIndex(this._lastZIndex)),this._expandIfNotCollapsed()},_update:function(){if(!this._container)return this;Ja(this._baseLayersList),Ja(this._overlaysList),this._layerControlInputs=[];var D,x,H,Y,re=0;for(H=0;H<this._layers.length;H++)Y=this._layers[H],this._addItem(Y),x=x||Y.overlay,D=D||!Y.overlay,re+=Y.overlay?0:1;return this.options.hideSingleBase&&(D=D&&re>1,this._baseLayersList.style.display=D?"":"none"),this._separator.style.display=x&&D?"":"none",this},_onLayerChange:function(D){this._handlingClick||this._update();var x=this._getLayer(l(D.target)),H=x.overlay?D.type==="add"?"overlayadd":"overlayremove":D.type==="add"?"baselayerchange":null;H&&this._map.fire(H,x)},_createRadioElement:function(D,x){var H='<input type="radio" class="leaflet-control-layers-selector" name="'+D+'"'+(x?' checked="checked"':"")+"/>",Y=document.createElement("div");return Y.innerHTML=H,Y.firstChild},_addItem:function(D){var x=document.createElement("label"),H=this._map.hasLayer(D.layer),Y;D.overlay?(Y=document.createElement("input"),Y.type="checkbox",Y.className="leaflet-control-layers-selector",Y.defaultChecked=H):Y=this._createRadioElement("leaflet-base-layers_"+l(this),H),this._layerControlInputs.push(Y),Y.layerId=l(D.layer),Bi(Y,"click",this._onInputClick,this);var re=document.createElement("span");re.innerHTML=" "+D.name;var ge=document.createElement("span");x.appendChild(ge),ge.appendChild(Y),ge.appendChild(re);var Ne=D.overlay?this._overlaysList:this._baseLayersList;return Ne.appendChild(x),this._checkDisabledLayers(),x},_onInputClick:function(){if(!this._preventClick){var D=this._layerControlInputs,x,H,Y=[],re=[];this._handlingClick=!0;for(var ge=D.length-1;ge>=0;ge--)x=D[ge],H=this._getLayer(x.layerId).layer,x.checked?Y.push(H):x.checked||re.push(H);for(ge=0;ge<re.length;ge++)this._map.hasLayer(re[ge])&&this._map.removeLayer(re[ge]);for(ge=0;ge<Y.length;ge++)this._map.hasLayer(Y[ge])||this._map.addLayer(Y[ge]);this._handlingClick=!1,this._refocusOnMap()}},_checkDisabledLayers:function(){for(var D=this._layerControlInputs,x,H,Y=this._map.getZoom(),re=D.length-1;re>=0;re--)x=D[re],H=this._getLayer(x.layerId).layer,x.disabled=H.options.minZoom!==void 0&&Y<H.options.minZoom||H.options.maxZoom!==void 0&&Y>H.options.maxZoom},_expandIfNotCollapsed:function(){return this._map&&!this.options.collapsed&&this.expand(),this},_expandSafely:function(){var D=this._section;this._preventClick=!0,Bi(D,"click",_a),this.expand();var x=this;setTimeout(function(){cr(D,"click",_a),x._preventClick=!1})}}),es=function(D,x,H){return new Gs(D,x,H)},ka=Un.extend({options:{position:"topleft",zoomInText:'<span aria-hidden="true">+</span>',zoomInTitle:"Zoom in",zoomOutText:'<span aria-hidden="true">&#x2212;</span>',zoomOutTitle:"Zoom out"},onAdd:function(D){var x="leaflet-control-zoom",H=Wt("div",x+" leaflet-bar"),Y=this.options;return this._zoomInButton=this._createButton(Y.zoomInText,Y.zoomInTitle,x+"-in",H,this._zoomIn),this._zoomOutButton=this._createButton(Y.zoomOutText,Y.zoomOutTitle,x+"-out",H,this._zoomOut),this._updateDisabled(),D.on("zoomend zoomlevelschange",this._updateDisabled,this),H},onRemove:function(D){D.off("zoomend zoomlevelschange",this._updateDisabled,this)},disable:function(){return this._disabled=!0,this._updateDisabled(),this},enable:function(){return this._disabled=!1,this._updateDisabled(),this},_zoomIn:function(D){!this._disabled&&this._map._zoom<this._map.getMaxZoom()&&this._map.zoomIn(this._map.options.zoomDelta*(D.shiftKey?3:1))},_zoomOut:function(D){!this._disabled&&this._map._zoom>this._map.getMinZoom()&&this._map.zoomOut(this._map.options.zoomDelta*(D.shiftKey?3:1))},_createButton:function(D,x,H,Y,re){var ge=Wt("a",H,Y);return ge.innerHTML=D,ge.href="#",ge.title=x,ge.setAttribute("role","button"),ge.setAttribute("aria-label",x),yl(ge),Bi(ge,"click",fu),Bi(ge,"click",re,this),Bi(ge,"click",this._refocusOnMap,this),ge},_updateDisabled:function(){var D=this._map,x="leaflet-disabled";zr(this._zoomInButton,x),zr(this._zoomOutButton,x),this._zoomInButton.setAttribute("aria-disabled","false"),this._zoomOutButton.setAttribute("aria-disabled","false"),(this._disabled||D._zoom===D.getMinZoom())&&(qi(this._zoomOutButton,x),this._zoomOutButton.setAttribute("aria-disabled","true")),(this._disabled||D._zoom===D.getMaxZoom())&&(qi(this._zoomInButton,x),this._zoomInButton.setAttribute("aria-disabled","true"))}});li.mergeOptions({zoomControl:!0}),li.addInitHook(function(){this.options.zoomControl&&(this.zoomControl=new ka,this.addControl(this.zoomControl))});var ts=function(D){return new ka(D)},zl=Un.extend({options:{position:"bottomleft",maxWidth:100,metric:!0,imperial:!0},onAdd:function(D){var x="leaflet-control-scale",H=Wt("div",x),Y=this.options;return this._addScales(Y,x+"-line",H),D.on(Y.updateWhenIdle?"moveend":"move",this._update,this),D.whenReady(this._update,this),H},onRemove:function(D){D.off(this.options.updateWhenIdle?"moveend":"move",this._update,this)},_addScales:function(D,x,H){D.metric&&(this._mScale=Wt("div",x,H)),D.imperial&&(this._iScale=Wt("div",x,H))},_update:function(){var D=this._map,x=D.getSize().y/2,H=D.distance(D.containerPointToLatLng([0,x]),D.containerPointToLatLng([this.options.maxWidth,x]));this._updateScales(H)},_updateScales:function(D){this.options.metric&&D&&this._updateMetric(D),this.options.imperial&&D&&this._updateImperial(D)},_updateMetric:function(D){var x=this._getRoundNum(D),H=x<1e3?x+" m":x/1e3+" km";this._updateScale(this._mScale,H,x/D)},_updateImperial:function(D){var x=D*3.2808399,H,Y,re;x>5280?(H=x/5280,Y=this._getRoundNum(H),this._updateScale(this._iScale,Y+" mi",Y/H)):(re=this._getRoundNum(x),this._updateScale(this._iScale,re+" ft",re/x))},_updateScale:function(D,x,H){D.style.width=Math.round(this.options.maxWidth*H)+"px",D.innerHTML=x},_getRoundNum:function(D){var x=Math.pow(10,(Math.floor(D)+"").length-1),H=D/x;return H=H>=10?10:H>=5?5:H>=3?3:H>=2?2:1,x*H}}),mu=function(D){return new zl(D)},eh='<svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="12" height="8" viewBox="0 0 12 8" class="leaflet-attribution-flag"><path fill="#4C7BE1" d="M0 0h12v4H0z"/><path fill="#FFD500" d="M0 4h12v3H0z"/><path fill="#E0BC00" d="M0 7h12v1H0z"/></svg>',th=Un.extend({options:{position:"bottomright",prefix:'<a href="https://leafletjs.com" title="A JavaScript library for interactive maps">'+(Dt.inlineSvg?eh+" ":"")+"Leaflet</a>"},initialize:function(D){m(this,D),this._attributions={}},onAdd:function(D){D.attributionControl=this,this._container=Wt("div","leaflet-control-attribution"),yl(this._container);for(var x in D._layers)D._layers[x].getAttribution&&this.addAttribution(D._layers[x].getAttribution());return this._update(),D.on("layeradd",this._addAttribution,this),this._container},onRemove:function(D){D.off("layeradd",this._addAttribution,this)},_addAttribution:function(D){D.layer.getAttribution&&(this.addAttribution(D.layer.getAttribution()),D.layer.once("remove",function(){this.removeAttribution(D.layer.getAttribution())},this))},setPrefix:function(D){return this.options.prefix=D,this._update(),this},addAttribution:function(D){return D?(this._attributions[D]||(this._attributions[D]=0),this._attributions[D]++,this._update(),this):this},removeAttribution:function(D){return D?(this._attributions[D]&&(this._attributions[D]--,this._update()),this):this},_update:function(){if(this._map){var D=[];for(var x in this._attributions)this._attributions[x]&&D.push(x);var H=[];this.options.prefix&&H.push(this.options.prefix),D.length&&H.push(D.join(", ")),this._container.innerHTML=H.join(' <span aria-hidden="true">|</span> ')}}});li.mergeOptions({attributionControl:!0}),li.addInitHook(function(){this.options.attributionControl&&new th().addTo(this)});var ff=function(D){return new th(D)};Un.Layers=Gs,Un.Zoom=ka,Un.Scale=zl,Un.Attribution=th,wa.layers=es,wa.zoom=ts,wa.scale=mu,wa.attribution=ff;var No=_.extend({initialize:function(D){this._map=D},enable:function(){return this._enabled?this:(this._enabled=!0,this.addHooks(),this)},disable:function(){return this._enabled?(this._enabled=!1,this.removeHooks(),this):this},enabled:function(){return!!this._enabled}});No.addTo=function(D,x){return D.addHandler(x,this),this};var m1={Events:N},r0=Dt.touch?"touchstart mousedown":"mousedown",is=k.extend({options:{clickTolerance:3},initialize:function(D,x,H,Y){m(this,Y),this._element=D,this._dragStartTarget=x||D,this._preventOutline=H},enable:function(){this._enabled||(Bi(this._dragStartTarget,r0,this._onDown,this),this._enabled=!0)},disable:function(){this._enabled&&(is._dragging===this&&this.finishDrag(!0),cr(this._dragStartTarget,r0,this._onDown,this),this._enabled=!1,this._moved=!1)},_onDown:function(D){if(this._enabled&&(this._moved=!1,!ml(this._element,"leaflet-zoom-anim"))){if(D.touches&&D.touches.length!==1){is._dragging===this&&this.finishDrag();return}if(!(is._dragging||D.shiftKey||D.which!==1&&D.button!==1&&!D.touches)&&(is._dragging=this,this._preventOutline&&Hl(this._element),Gl(),Mo(),!this._moving)){this.fire("down");var x=D.touches?D.touches[0]:D,H=Vs(this._element);this._startPoint=new O(x.clientX,x.clientY),this._startPos=Ko(this._element),this._parentScale=ha(H);var Y=D.type==="mousedown";Bi(document,Y?"mousemove":"touchmove",this._onMove,this),Bi(document,Y?"mouseup":"touchend touchcancel",this._onUp,this)}}},_onMove:function(D){if(this._enabled){if(D.touches&&D.touches.length>1){this._moved=!0;return}var x=D.touches&&D.touches.length===1?D.touches[0]:D,H=new O(x.clientX,x.clientY)._subtract(this._startPoint);!H.x&&!H.y||Math.abs(H.x)+Math.abs(H.y)<this.options.clickTolerance||(H.x/=this._parentScale.x,H.y/=this._parentScale.y,_a(D),this._moved||(this.fire("dragstart"),this._moved=!0,qi(document.body,"leaflet-dragging"),this._lastTarget=D.target||D.srcElement,window.SVGElementInstance&&this._lastTarget instanceof window.SVGElementInstance&&(this._lastTarget=this._lastTarget.correspondingUseElement),qi(this._lastTarget,"leaflet-drag-target")),this._newPos=this._startPos.add(H),this._moving=!0,this._lastEvent=D,this._updatePosition())}},_updatePosition:function(){var D={originalEvent:this._lastEvent};this.fire("predrag",D),qr(this._element,this._newPos),this.fire("drag",D)},_onUp:function(){this._enabled&&this.finishDrag()},finishDrag:function(D){zr(document.body,"leaflet-dragging"),this._lastTarget&&(zr(this._lastTarget,"leaflet-drag-target"),this._lastTarget=null),cr(document,"mousemove touchmove",this._onMove,this),cr(document,"mouseup touchend touchcancel",this._onUp,this),Bs(),ln();var x=this._moved&&this._moving;this._moving=!1,is._dragging=!1,x&&this.fire("dragend",{noInertia:D,distance:this._newPos.distanceTo(this._startPos)})}});function cv(D,x,H){var Y,re=[1,4,2,8],ge,Ne,Ze,st,Pt,ci,rn,ir;for(ge=0,ci=D.length;ge<ci;ge++)D[ge]._code=mf(D[ge],x);for(Ze=0;Ze<4;Ze++){for(rn=re[Ze],Y=[],ge=0,ci=D.length,Ne=ci-1;ge<ci;Ne=ge++)st=D[ge],Pt=D[Ne],st._code&rn?Pt._code&rn||(ir=dv(Pt,st,rn,x,H),ir._code=mf(ir,x),Y.push(ir)):(Pt._code&rn&&(ir=dv(Pt,st,rn,x,H),ir._code=mf(ir,x),Y.push(ir)),Y.push(st));D=Y}return D}function uv(D,x){var H,Y,re,ge,Ne,Ze,st,Pt,ci;if(!D||D.length===0)throw new Error("latlngs not passed");bl(D)||(console.warn("latlngs are not flat! Only the first ring will be used"),D=D[0]);var rn=Z([0,0]),ir=z(D),Mc=ir.getNorthWest().distanceTo(ir.getSouthWest())*ir.getNorthEast().distanceTo(ir.getNorthWest());Mc<1700&&(rn=a0(D));var Zo=D.length,Jd=[];for(H=0;H<Zo;H++){var vu=Z(D[H]);Jd.push(x.project(Z([vu.lat-rn.lat,vu.lng-rn.lng])))}for(Ze=st=Pt=0,H=0,Y=Zo-1;H<Zo;Y=H++)re=Jd[H],ge=Jd[Y],Ne=re.y*ge.x-ge.y*re.x,st+=(re.x+ge.x)*Ne,Pt+=(re.y+ge.y)*Ne,Ze+=Ne*3;Ze===0?ci=Jd[0]:ci=[st/Ze,Pt/Ze];var g0=x.unproject(F(ci));return Z([g0.lat+rn.lat,g0.lng+rn.lng])}function a0(D){for(var x=0,H=0,Y=0,re=0;re<D.length;re++){var ge=Z(D[re]);x+=ge.lat,H+=ge.lng,Y++}return Z([x/Y,H/Y])}var s0={__proto__:null,clipPolygon:cv,polygonCenter:uv,centroid:a0};function g1(D,x){if(!x||!D.length)return D.slice();var H=x*x;return D=b1(D,H),D=y1(D,H),D}function v1(D,x,H){return Math.sqrt(Fm(D,x,H,!0))}function o0(D,x,H){return Fm(D,x,H)}function y1(D,x){var H=D.length,Y=typeof Uint8Array<"u"?Uint8Array:Array,re=new Y(H);re[0]=re[H-1]=1,ih(D,re,x,0,H-1);var ge,Ne=[];for(ge=0;ge<H;ge++)re[ge]&&Ne.push(D[ge]);return Ne}function ih(D,x,H,Y,re){var ge=0,Ne,Ze,st;for(Ze=Y+1;Ze<=re-1;Ze++)st=Fm(D[Ze],D[Y],D[re],!0),st>ge&&(Ne=Ze,ge=st);ge>H&&(x[Ne]=1,ih(D,x,H,Y,Ne),ih(D,x,H,Ne,re))}function b1(D,x){for(var H=[D[0]],Y=1,re=0,ge=D.length;Y<ge;Y++)s$(D[Y],D[re])>x&&(H.push(D[Y]),re=Y);return re<ge-1&&H.push(D[ge-1]),H}var l0;function db(D,x,H,Y,re){var ge=Y?l0:mf(D,H),Ne=mf(x,H),Ze,st,Pt;for(l0=Ne;;){if(!(ge|Ne))return[D,x];if(ge&Ne)return!1;Ze=ge||Ne,st=dv(D,x,Ze,H,re),Pt=mf(st,H),Ze===ge?(D=st,ge=Pt):(x=st,Ne=Pt)}}function dv(D,x,H,Y,re){var ge=x.x-D.x,Ne=x.y-D.y,Ze=Y.min,st=Y.max,Pt,ci;return H&8?(Pt=D.x+ge*(st.y-D.y)/Ne,ci=st.y):H&4?(Pt=D.x+ge*(Ze.y-D.y)/Ne,ci=Ze.y):H&2?(Pt=st.x,ci=D.y+Ne*(st.x-D.x)/ge):H&1&&(Pt=Ze.x,ci=D.y+Ne*(Ze.x-D.x)/ge),new O(Pt,ci,re)}function mf(D,x){var H=0;return D.x<x.min.x?H|=1:D.x>x.max.x&&(H|=2),D.y<x.min.y?H|=4:D.y>x.max.y&&(H|=8),H}function s$(D,x){var H=x.x-D.x,Y=x.y-D.y;return H*H+Y*Y}function Fm(D,x,H,Y){var re=x.x,ge=x.y,Ne=H.x-re,Ze=H.y-ge,st=Ne*Ne+Ze*Ze,Pt;return st>0&&(Pt=((D.x-re)*Ne+(D.y-ge)*Ze)/st,Pt>1?(re=H.x,ge=H.y):Pt>0&&(re+=Ne*Pt,ge+=Ze*Pt)),Ne=D.x-re,Ze=D.y-ge,Y?Ne*Ne+Ze*Ze:new O(re,ge)}function bl(D){return!b(D[0])||typeof D[0][0]!="object"&&typeof D[0][0]<"u"}function kM(D){return console.warn("Deprecated use of _flat, please use L.LineUtil.isFlat instead."),bl(D)}function c0(D,x){var H,Y,re,ge,Ne,Ze,st,Pt;if(!D||D.length===0)throw new Error("latlngs not passed");bl(D)||(console.warn("latlngs are not flat! Only the first ring will be used"),D=D[0]);var ci=Z([0,0]),rn=z(D),ir=rn.getNorthWest().distanceTo(rn.getSouthWest())*rn.getNorthEast().distanceTo(rn.getNorthWest());ir<1700&&(ci=a0(D));var Mc=D.length,Zo=[];for(H=0;H<Mc;H++){var Jd=Z(D[H]);Zo.push(x.project(Z([Jd.lat-ci.lat,Jd.lng-ci.lng])))}for(H=0,Y=0;H<Mc-1;H++)Y+=Zo[H].distanceTo(Zo[H+1])/2;if(Y===0)Pt=Zo[0];else for(H=0,ge=0;H<Mc-1;H++)if(Ne=Zo[H],Ze=Zo[H+1],re=Ne.distanceTo(Ze),ge+=re,ge>Y){st=(ge-Y)/re,Pt=[Ze.x-st*(Ze.x-Ne.x),Ze.y-st*(Ze.y-Ne.y)];break}var vu=x.unproject(F(Pt));return Z([vu.lat+ci.lat,vu.lng+ci.lng])}var I1={__proto__:null,simplify:g1,pointToSegmentDistance:v1,closestPointOnSegment:o0,clipSegment:db,_getEdgeIntersection:dv,_getBitCode:mf,_sqClosestPointOnSegment:Fm,isFlat:bl,_flat:kM,polylineCenter:c0},w1={project:function(D){return new O(D.lng,D.lat)},unproject:function(D){return new W(D.y,D.x)},bounds:new V([-180,-90],[180,90])},u0={R:6378137,R_MINOR:6356752314245179e-9,bounds:new V([-2003750834279e-5,-1549657073972e-5],[2003750834279e-5,1876465623138e-5]),project:function(D){var x=Math.PI/180,H=this.R,Y=D.lat*x,re=this.R_MINOR/H,ge=Math.sqrt(1-re*re),Ne=ge*Math.sin(Y),Ze=Math.tan(Math.PI/4-Y/2)/Math.pow((1-Ne)/(1+Ne),ge/2);return Y=-H*Math.log(Math.max(Ze,1e-10)),new O(D.lng*x*H,Y)},unproject:function(D){for(var x=180/Math.PI,H=this.R,Y=this.R_MINOR/H,re=Math.sqrt(1-Y*Y),ge=Math.exp(-D.y/H),Ne=Math.PI/2-2*Math.atan(ge),Ze=0,st=.1,Pt;Ze<15&&Math.abs(st)>1e-7;Ze++)Pt=re*Math.sin(Ne),Pt=Math.pow((1-Pt)/(1+Pt),re/2),st=Math.PI/2-2*Math.atan(ge*Pt)-Ne,Ne+=st;return new W(Ne*x,D.x*x/H)}},o$={__proto__:null,LonLat:w1,Mercator:u0,SphericalMercator:se},xM=r({},Q,{code:"EPSG:3395",projection:u0,transformation:function(){var D=.5/(Math.PI*u0.R);return ce(D,.5,-D,.5)}()}),S1=r({},Q,{code:"EPSG:4326",projection:w1,transformation:ce(1/180,1,-1/180,.5)}),l$=r({},K,{projection:w1,transformation:ce(1,0,-1,0),scale:function(D){return Math.pow(2,D)},zoom:function(D){return Math.log(D)/Math.LN2},distance:function(D,x){var H=x.lng-D.lng,Y=x.lat-D.lat;return Math.sqrt(H*H+Y*Y)},infinite:!0});K.Earth=Q,K.EPSG3395=xM,K.EPSG3857=oe,K.EPSG900913=te,K.EPSG4326=S1,K.Simple=l$;var gu=k.extend({options:{pane:"overlayPane",attribution:null,bubblingMouseEvents:!0},addTo:function(D){return D.addLayer(this),this},remove:function(){return this.removeFrom(this._map||this._mapToAdd)},removeFrom:function(D){return D&&D.removeLayer(this),this},getPane:function(D){return this._map.getPane(D?this.options[D]||D:this.options.pane)},addInteractiveTarget:function(D){return this._map._targets[l(D)]=this,this},removeInteractiveTarget:function(D){return delete this._map._targets[l(D)],this},getAttribution:function(){return this.options.attribution},_layerAdd:function(D){var x=D.target;if(x.hasLayer(this)){if(this._map=x,this._zoomAnimated=x._zoomAnimated,this.getEvents){var H=this.getEvents();x.on(H,this),this.once("remove",function(){x.off(H,this)},this)}this.onAdd(x),this.fire("add"),x.fire("layeradd",{layer:this})}}});li.include({addLayer:function(D){if(!D._layerAdd)throw new Error("The provided object is not a Layer.");var x=l(D);return this._layers[x]?this:(this._layers[x]=D,D._mapToAdd=this,D.beforeAdd&&D.beforeAdd(this),this.whenReady(D._layerAdd,D),this)},removeLayer:function(D){var x=l(D);return this._layers[x]?(this._loaded&&D.onRemove(this),delete this._layers[x],this._loaded&&(this.fire("layerremove",{layer:D}),D.fire("remove")),D._map=D._mapToAdd=null,this):this},hasLayer:function(D){return l(D)in this._layers},eachLayer:function(D,x){for(var H in this._layers)D.call(x,this._layers[H]);return this},_addLayers:function(D){D=D?b(D)?D:[D]:[];for(var x=0,H=D.length;x<H;x++)this.addLayer(D[x])},_addZoomLimit:function(D){(!isNaN(D.options.maxZoom)||!isNaN(D.options.minZoom))&&(this._zoomBoundLayers[l(D)]=D,this._updateZoomLevels())},_removeZoomLimit:function(D){var x=l(D);this._zoomBoundLayers[x]&&(delete this._zoomBoundLayers[x],this._updateZoomLevels())},_updateZoomLevels:function(){var D=1/0,x=-1/0,H=this._getZoomSpan();for(var Y in this._zoomBoundLayers){var re=this._zoomBoundLayers[Y].options;D=re.minZoom===void 0?D:Math.min(D,re.minZoom),x=re.maxZoom===void 0?x:Math.max(x,re.maxZoom)}this._layersMaxZoom=x===-1/0?void 0:x,this._layersMinZoom=D===1/0?void 0:D,H!==this._getZoomSpan()&&this.fire("zoomlevelschange"),this.options.maxZoom===void 0&&this._layersMaxZoom&&this.getZoom()>this._layersMaxZoom&&this.setZoom(this._layersMaxZoom),this.options.minZoom===void 0&&this._layersMinZoom&&this.getZoom()<this._layersMinZoom&&this.setZoom(this._layersMinZoom)}});var gf=gu.extend({initialize:function(D,x){m(this,x),this._layers={};var H,Y;if(D)for(H=0,Y=D.length;H<Y;H++)this.addLayer(D[H])},addLayer:function(D){var x=this.getLayerId(D);return this._layers[x]=D,this._map&&this._map.addLayer(D),this},removeLayer:function(D){var x=D in this._layers?D:this.getLayerId(D);return this._map&&this._layers[x]&&this._map.removeLayer(this._layers[x]),delete this._layers[x],this},hasLayer:function(D){var x=typeof D=="number"?D:this.getLayerId(D);return x in this._layers},clearLayers:function(){return this.eachLayer(this.removeLayer,this)},invoke:function(D){var x=Array.prototype.slice.call(arguments,1),H,Y;for(H in this._layers)Y=this._layers[H],Y[D]&&Y[D].apply(Y,x);return this},onAdd:function(D){this.eachLayer(D.addLayer,D)},onRemove:function(D){this.eachLayer(D.removeLayer,D)},eachLayer:function(D,x){for(var H in this._layers)D.call(x,this._layers[H]);return this},getLayer:function(D){return this._layers[D]},getLayers:function(){var D=[];return this.eachLayer(D.push,D),D},setZIndex:function(D){return this.invoke("setZIndex",D)},getLayerId:function(D){return l(D)}}),OM=function(D,x){return new gf(D,x)},Zd=gf.extend({addLayer:function(D){return this.hasLayer(D)?this:(D.addEventParent(this),gf.prototype.addLayer.call(this,D),this.fire("layeradd",{layer:D}))},removeLayer:function(D){return this.hasLayer(D)?(D in this._layers&&(D=this._layers[D]),D.removeEventParent(this),gf.prototype.removeLayer.call(this,D),this.fire("layerremove",{layer:D})):this},setStyle:function(D){return this.invoke("setStyle",D)},bringToFront:function(){return this.invoke("bringToFront")},bringToBack:function(){return this.invoke("bringToBack")},getBounds:function(){var D=new B;for(var x in this._layers){var H=this._layers[x];D.extend(H.getBounds?H.getBounds():H.getLatLng())}return D}}),c$=function(D,x){return new Zd(D,x)},pv=_.extend({options:{popupAnchor:[0,0],tooltipAnchor:[0,0],crossOrigin:!1},initialize:function(D){m(this,D)},createIcon:function(D){return this._createIcon("icon",D)},createShadow:function(D){return this._createIcon("shadow",D)},_createIcon:function(D,x){var H=this._getIconUrl(D);if(!H){if(D==="icon")throw new Error("iconUrl not set in Icon options (see the docs).");return null}var Y=this._createImg(H,x&&x.tagName==="IMG"?x:null);return this._setIconStyles(Y,D),(this.options.crossOrigin||this.options.crossOrigin==="")&&(Y.crossOrigin=this.options.crossOrigin===!0?"":this.options.crossOrigin),Y},_setIconStyles:function(D,x){var H=this.options,Y=H[x+"Size"];typeof Y=="number"&&(Y=[Y,Y]);var re=F(Y),ge=F(x==="shadow"&&H.shadowAnchor||H.iconAnchor||re&&re.divideBy(2,!0));D.className="leaflet-marker-"+x+" "+(H.className||""),ge&&(D.style.marginLeft=-ge.x+"px",D.style.marginTop=-ge.y+"px"),re&&(D.style.width=re.x+"px",D.style.height=re.y+"px")},_createImg:function(D,x){return x=x||document.createElement("img"),x.src=D,x},_getIconUrl:function(D){return Dt.retina&&this.options[D+"RetinaUrl"]||this.options[D+"Url"]}});function u$(D){return new pv(D)}var vf=pv.extend({options:{iconUrl:"marker-icon.png",iconRetinaUrl:"marker-icon-2x.png",shadowUrl:"marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],tooltipAnchor:[16,-28],shadowSize:[41,41]},_getIconUrl:function(D){return typeof vf.imagePath!="string"&&(vf.imagePath=this._detectIconPath()),(this.options.imagePath||vf.imagePath)+pv.prototype._getIconUrl.call(this,D)},_stripUrl:function(D){var x=function(H,Y,re){var ge=Y.exec(H);return ge&&ge[re]};return D=x(D,/^url\((['"])?(.+)\1\)$/,2),D&&x(D,/^(.*)marker-icon\.png$/,1)},_detectIconPath:function(){var D=Wt("div","leaflet-default-icon-path",document.body),x=nt(D,"background-image")||nt(D,"backgroundImage");if(document.body.removeChild(D),x=this._stripUrl(x),x)return x;var H=document.querySelector('link[href$="leaflet.css"]');return H?H.href.substring(0,H.href.length-11-1):""}}),Xd=No.extend({initialize:function(D){this._marker=D},addHooks:function(){var D=this._marker._icon;this._draggable||(this._draggable=new is(D,D,!0)),this._draggable.on({dragstart:this._onDragStart,predrag:this._onPreDrag,drag:this._onDrag,dragend:this._onDragEnd},this).enable(),qi(D,"leaflet-marker-draggable")},removeHooks:function(){this._draggable.off({dragstart:this._onDragStart,predrag:this._onPreDrag,drag:this._onDrag,dragend:this._onDragEnd},this).disable(),this._marker._icon&&zr(this._marker._icon,"leaflet-marker-draggable")},moved:function(){return this._draggable&&this._draggable._moved},_adjustPan:function(D){var x=this._marker,H=x._map,Y=this._marker.options.autoPanSpeed,re=this._marker.options.autoPanPadding,ge=Ko(x._icon),Ne=H.getPixelBounds(),Ze=H.getPixelOrigin(),st=j(Ne.min._subtract(Ze).add(re),Ne.max._subtract(Ze).subtract(re));if(!st.contains(ge)){var Pt=F((Math.max(st.max.x,ge.x)-st.max.x)/(Ne.max.x-st.max.x)-(Math.min(st.min.x,ge.x)-st.min.x)/(Ne.min.x-st.min.x),(Math.max(st.max.y,ge.y)-st.max.y)/(Ne.max.y-st.max.y)-(Math.min(st.min.y,ge.y)-st.min.y)/(Ne.min.y-st.min.y)).multiplyBy(Y);H.panBy(Pt,{animate:!1}),this._draggable._newPos._add(Pt),this._draggable._startPos._add(Pt),qr(x._icon,this._draggable._newPos),this._onDrag(D),this._panRequest=R(this._adjustPan.bind(this,D))}},_onDragStart:function(){this._oldLatLng=this._marker.getLatLng(),this._marker.closePopup&&this._marker.closePopup(),this._marker.fire("movestart").fire("dragstart")},_onPreDrag:function(D){this._marker.options.autoPan&&(C(this._panRequest),this._panRequest=R(this._adjustPan.bind(this,D)))},_onDrag:function(D){var x=this._marker,H=x._shadow,Y=Ko(x._icon),re=x._map.layerPointToLatLng(Y);H&&qr(H,Y),x._latlng=re,D.latlng=re,D.oldLatLng=this._oldLatLng,x.fire("move",D).fire("drag",D)},_onDragEnd:function(D){C(this._panRequest),delete this._oldLatLng,this._marker.fire("moveend").fire("dragend",D)}}),Sa=gu.extend({options:{icon:new vf,interactive:!0,keyboard:!0,title:"",alt:"Marker",zIndexOffset:0,opacity:1,riseOnHover:!1,riseOffset:250,pane:"markerPane",shadowPane:"shadowPane",bubblingMouseEvents:!1,autoPanOnFocus:!0,draggable:!1,autoPan:!1,autoPanPadding:[50,50],autoPanSpeed:10},initialize:function(D,x){m(this,x),this._latlng=Z(D)},onAdd:function(D){this._zoomAnimated=this._zoomAnimated&&D.options.markerZoomAnimation,this._zoomAnimated&&D.on("zoomanim",this._animateZoom,this),this._initIcon(),this.update()},onRemove:function(D){this.dragging&&this.dragging.enabled()&&(this.options.draggable=!0,this.dragging.removeHooks()),delete this.dragging,this._zoomAnimated&&D.off("zoomanim",this._animateZoom,this),this._removeIcon(),this._removeShadow()},getEvents:function(){return{zoom:this.update,viewreset:this.update}},getLatLng:function(){return this._latlng},setLatLng:function(D){var x=this._latlng;return this._latlng=Z(D),this.update(),this.fire("move",{oldLatLng:x,latlng:this._latlng})},setZIndexOffset:function(D){return this.options.zIndexOffset=D,this.update()},getIcon:function(){return this.options.icon},setIcon:function(D){return this.options.icon=D,this._map&&(this._initIcon(),this.update()),this._popup&&this.bindPopup(this._popup,this._popup.options),this},getElement:function(){return this._icon},update:function(){if(this._icon&&this._map){var D=this._map.latLngToLayerPoint(this._latlng).round();this._setPos(D)}return this},_initIcon:function(){var D=this.options,x="leaflet-zoom-"+(this._zoomAnimated?"animated":"hide"),H=D.icon.createIcon(this._icon),Y=!1;H!==this._icon&&(this._icon&&this._removeIcon(),Y=!0,D.title&&(H.title=D.title),H.tagName==="IMG"&&(H.alt=D.alt||"")),qi(H,x),D.keyboard&&(H.tabIndex="0",H.setAttribute("role","button")),this._icon=H,D.riseOnHover&&this.on({mouseover:this._bringToFront,mouseout:this._resetZIndex}),this.options.autoPanOnFocus&&Bi(H,"focus",this._panOnFocus,this);var re=D.icon.createShadow(this._shadow),ge=!1;re!==this._shadow&&(this._removeShadow(),ge=!0),re&&(qi(re,x),re.alt=""),this._shadow=re,D.opacity<1&&this._updateOpacity(),Y&&this.getPane().appendChild(this._icon),this._initInteraction(),re&&ge&&this.getPane(D.shadowPane).appendChild(this._shadow)},_removeIcon:function(){this.options.riseOnHover&&this.off({mouseover:this._bringToFront,mouseout:this._resetZIndex}),this.options.autoPanOnFocus&&cr(this._icon,"focus",this._panOnFocus,this),$i(this._icon),this.removeInteractiveTarget(this._icon),this._icon=null},_removeShadow:function(){this._shadow&&$i(this._shadow),this._shadow=null},_setPos:function(D){this._icon&&qr(this._icon,D),this._shadow&&qr(this._shadow,D),this._zIndex=D.y+this.options.zIndexOffset,this._resetZIndex()},_updateZIndex:function(D){this._icon&&(this._icon.style.zIndex=this._zIndex+D)},_animateZoom:function(D){var x=this._map._latLngToNewLayerPoint(this._latlng,D.zoom,D.center).round();this._setPos(x)},_initInteraction:function(){if(this.options.interactive&&(qi(this._icon,"leaflet-interactive"),this.addInteractiveTarget(this._icon),Xd)){var D=this.options.draggable;this.dragging&&(D=this.dragging.enabled(),this.dragging.disable()),this.dragging=new Xd(this),D&&this.dragging.enable()}},setOpacity:function(D){return this.options.opacity=D,this._map&&this._updateOpacity(),this},_updateOpacity:function(){var D=this.options.opacity;this._icon&&Ro(this._icon,D),this._shadow&&Ro(this._shadow,D)},_bringToFront:function(){this._updateZIndex(this.options.riseOffset)},_resetZIndex:function(){this._updateZIndex(0)},_panOnFocus:function(){var D=this._map;if(D){var x=this.options.icon.options,H=x.iconSize?F(x.iconSize):F(0,0),Y=x.iconAnchor?F(x.iconAnchor):F(0,0);D.panInside(this._latlng,{paddingTopLeft:Y,paddingBottomRight:H.subtract(Y)})}},_getPopupAnchor:function(){return this.options.icon.options.popupAnchor},_getTooltipAnchor:function(){return this.options.icon.options.tooltipAnchor}});function d0(D,x){return new Sa(D,x)}var Hs=gu.extend({options:{stroke:!0,color:"#3388ff",weight:3,opacity:1,lineCap:"round",lineJoin:"round",dashArray:null,dashOffset:null,fill:!1,fillColor:null,fillOpacity:.2,fillRule:"evenodd",interactive:!0,bubblingMouseEvents:!0},beforeAdd:function(D){this._renderer=D.getRenderer(this)},onAdd:function(){this._renderer._initPath(this),this._reset(),this._renderer._addPath(this)},onRemove:function(){this._renderer._removePath(this)},redraw:function(){return this._map&&this._renderer._updatePath(this),this},setStyle:function(D){return m(this,D),this._renderer&&(this._renderer._updateStyle(this),this.options.stroke&&D&&Object.prototype.hasOwnProperty.call(D,"weight")&&this._updateBounds()),this},bringToFront:function(){return this._renderer&&this._renderer._bringToFront(this),this},bringToBack:function(){return this._renderer&&this._renderer._bringToBack(this),this},getElement:function(){return this._path},_reset:function(){this._project(),this._update()},_clickTolerance:function(){return(this.options.stroke?this.options.weight/2:0)+(this._renderer.options.tolerance||0)}}),p0=Hs.extend({options:{fill:!0,radius:10},initialize:function(D,x){m(this,x),this._latlng=Z(D),this._radius=this.options.radius},setLatLng:function(D){var x=this._latlng;return this._latlng=Z(D),this.redraw(),this.fire("move",{oldLatLng:x,latlng:this._latlng})},getLatLng:function(){return this._latlng},setRadius:function(D){return this.options.radius=this._radius=D,this.redraw()},getRadius:function(){return this._radius},setStyle:function(D){var x=D&&D.radius||this._radius;return Hs.prototype.setStyle.call(this,D),this.setRadius(x),this},_project:function(){this._point=this._map.latLngToLayerPoint(this._latlng),this._updateBounds()},_updateBounds:function(){var D=this._radius,x=this._radiusY||D,H=this._clickTolerance(),Y=[D+H,x+H];this._pxBounds=new V(this._point.subtract(Y),this._point.add(Y))},_update:function(){this._map&&this._updatePath()},_updatePath:function(){this._renderer._updateCircle(this)},_empty:function(){return this._radius&&!this._renderer._bounds.intersects(this._pxBounds)},_containsPoint:function(D){return D.distanceTo(this._point)<=this._radius+this._clickTolerance()}});function T1(D,x){return new p0(D,x)}var h0=p0.extend({initialize:function(D,x,H){if(typeof x=="number"&&(x=r({},H,{radius:x})),m(this,x),this._latlng=Z(D),isNaN(this.options.radius))throw new Error("Circle radius cannot be NaN");this._mRadius=this.options.radius},setRadius:function(D){return this._mRadius=D,this.redraw()},getRadius:function(){return this._mRadius},getBounds:function(){var D=[this._radius,this._radiusY||this._radius];return new B(this._map.layerPointToLatLng(this._point.subtract(D)),this._map.layerPointToLatLng(this._point.add(D)))},setStyle:Hs.prototype.setStyle,_project:function(){var D=this._latlng.lng,x=this._latlng.lat,H=this._map,Y=H.options.crs;if(Y.distance===Q.distance){var re=Math.PI/180,ge=this._mRadius/Q.R/re,Ne=H.project([x+ge,D]),Ze=H.project([x-ge,D]),st=Ne.add(Ze).divideBy(2),Pt=H.unproject(st).lat,ci=Math.acos((Math.cos(ge*re)-Math.sin(x*re)*Math.sin(Pt*re))/(Math.cos(x*re)*Math.cos(Pt*re)))/re;(isNaN(ci)||ci===0)&&(ci=ge/Math.cos(Math.PI/180*x)),this._point=st.subtract(H.getPixelOrigin()),this._radius=isNaN(ci)?0:st.x-H.project([Pt,D-ci]).x,this._radiusY=st.y-Ne.y}else{var rn=Y.unproject(Y.project(this._latlng).subtract([this._mRadius,0]));this._point=H.latLngToLayerPoint(this._latlng),this._radius=this._point.x-H.latLngToLayerPoint(rn).x}this._updateBounds()}});function $m(D,x,H){return new h0(D,x,H)}var ud=Hs.extend({options:{smoothFactor:1,noClip:!1},initialize:function(D,x){m(this,x),this._setLatLngs(D)},getLatLngs:function(){return this._latlngs},setLatLngs:function(D){return this._setLatLngs(D),this.redraw()},isEmpty:function(){return!this._latlngs.length},closestLayerPoint:function(D){for(var x=1/0,H=null,Y=Fm,re,ge,Ne=0,Ze=this._parts.length;Ne<Ze;Ne++)for(var st=this._parts[Ne],Pt=1,ci=st.length;Pt<ci;Pt++){re=st[Pt-1],ge=st[Pt];var rn=Y(D,re,ge,!0);rn<x&&(x=rn,H=Y(D,re,ge))}return H&&(H.distance=Math.sqrt(x)),H},getCenter:function(){if(!this._map)throw new Error("Must add layer to map before using getCenter()");return c0(this._defaultShape(),this._map.options.crs)},getBounds:function(){return this._bounds},addLatLng:function(D,x){return x=x||this._defaultShape(),D=Z(D),x.push(D),this._bounds.extend(D),this.redraw()},_setLatLngs:function(D){this._bounds=new B,this._latlngs=this._convertLatLngs(D)},_defaultShape:function(){return bl(this._latlngs)?this._latlngs:this._latlngs[0]},_convertLatLngs:function(D){for(var x=[],H=bl(D),Y=0,re=D.length;Y<re;Y++)H?(x[Y]=Z(D[Y]),this._bounds.extend(x[Y])):x[Y]=this._convertLatLngs(D[Y]);return x},_project:function(){var D=new V;this._rings=[],this._projectLatlngs(this._latlngs,this._rings,D),this._bounds.isValid()&&D.isValid()&&(this._rawPxBounds=D,this._updateBounds())},_updateBounds:function(){var D=this._clickTolerance(),x=new O(D,D);this._rawPxBounds&&(this._pxBounds=new V([this._rawPxBounds.min.subtract(x),this._rawPxBounds.max.add(x)]))},_projectLatlngs:function(D,x,H){var Y=D[0]instanceof W,re=D.length,ge,Ne;if(Y){for(Ne=[],ge=0;ge<re;ge++)Ne[ge]=this._map.latLngToLayerPoint(D[ge]),H.extend(Ne[ge]);x.push(Ne)}else for(ge=0;ge<re;ge++)this._projectLatlngs(D[ge],x,H)},_clipPoints:function(){var D=this._renderer._bounds;if(this._parts=[],!(!this._pxBounds||!this._pxBounds.intersects(D))){if(this.options.noClip){this._parts=this._rings;return}var x=this._parts,H,Y,re,ge,Ne,Ze,st;for(H=0,re=0,ge=this._rings.length;H<ge;H++)for(st=this._rings[H],Y=0,Ne=st.length;Y<Ne-1;Y++)Ze=db(st[Y],st[Y+1],D,Y,!0),Ze&&(x[re]=x[re]||[],x[re].push(Ze[0]),(Ze[1]!==st[Y+1]||Y===Ne-2)&&(x[re].push(Ze[1]),re++))}},_simplifyPoints:function(){for(var D=this._parts,x=this.options.smoothFactor,H=0,Y=D.length;H<Y;H++)D[H]=g1(D[H],x)},_update:function(){this._map&&(this._clipPoints(),this._simplifyPoints(),this._updatePath())},_updatePath:function(){this._renderer._updatePoly(this)},_containsPoint:function(D,x){var H,Y,re,ge,Ne,Ze,st=this._clickTolerance();if(!this._pxBounds||!this._pxBounds.contains(D))return!1;for(H=0,ge=this._parts.length;H<ge;H++)for(Ze=this._parts[H],Y=0,Ne=Ze.length,re=Ne-1;Y<Ne;re=Y++)if(!(!x&&Y===0)&&v1(D,Ze[re],Ze[Y])<=st)return!0;return!1}});function hv(D,x){return new ud(D,x)}ud._flat=kM;var Rc=ud.extend({options:{fill:!0},isEmpty:function(){return!this._latlngs.length||!this._latlngs[0].length},getCenter:function(){if(!this._map)throw new Error("Must add layer to map before using getCenter()");return uv(this._defaultShape(),this._map.options.crs)},_convertLatLngs:function(D){var x=ud.prototype._convertLatLngs.call(this,D),H=x.length;return H>=2&&x[0]instanceof W&&x[0].equals(x[H-1])&&x.pop(),x},_setLatLngs:function(D){ud.prototype._setLatLngs.call(this,D),bl(this._latlngs)&&(this._latlngs=[this._latlngs])},_defaultShape:function(){return bl(this._latlngs[0])?this._latlngs[0]:this._latlngs[0][0]},_clipPoints:function(){var D=this._renderer._bounds,x=this.options.weight,H=new O(x,x);if(D=new V(D.min.subtract(H),D.max.add(H)),this._parts=[],!(!this._pxBounds||!this._pxBounds.intersects(D))){if(this.options.noClip){this._parts=this._rings;return}for(var Y=0,re=this._rings.length,ge;Y<re;Y++)ge=cv(this._rings[Y],D,!0),ge.length&&this._parts.push(ge)}},_updatePath:function(){this._renderer._updatePoly(this,!0)},_containsPoint:function(D){var x=!1,H,Y,re,ge,Ne,Ze,st,Pt;if(!this._pxBounds||!this._pxBounds.contains(D))return!1;for(ge=0,st=this._parts.length;ge<st;ge++)for(H=this._parts[ge],Ne=0,Pt=H.length,Ze=Pt-1;Ne<Pt;Ze=Ne++)Y=H[Ne],re=H[Ze],Y.y>D.y!=re.y>D.y&&D.x<(re.x-Y.x)*(D.y-Y.y)/(re.y-Y.y)+Y.x&&(x=!x);return x||ud.prototype._containsPoint.call(this,D,!0)}});function LM(D,x){return new Rc(D,x)}var G=Zd.extend({initialize:function(D,x){m(this,x),this._layers={},D&&this.addData(D)},addData:function(D){var x=b(D)?D:D.features,H,Y,re;if(x){for(H=0,Y=x.length;H<Y;H++)re=x[H],(re.geometries||re.geometry||re.features||re.coordinates)&&this.addData(re);return this}var ge=this.options;if(ge.filter&&!ge.filter(D))return this;var Ne=q(D,ge);return Ne?(Ne.feature=Be(D),Ne.defaultOptions=Ne.options,this.resetStyle(Ne),ge.onEachFeature&&ge.onEachFeature(D,Ne),this.addLayer(Ne)):this},resetStyle:function(D){return D===void 0?this.eachLayer(this.resetStyle,this):(D.options=r({},D.defaultOptions),this._setLayerStyle(D,this.options.style),this)},setStyle:function(D){return this.eachLayer(function(x){this._setLayerStyle(x,D)},this)},_setLayerStyle:function(D,x){D.setStyle&&(typeof x=="function"&&(x=x(D.feature)),D.setStyle(x))}});function q(D,x){var H=D.type==="Feature"?D.geometry:D,Y=H?H.coordinates:null,re=[],ge=x&&x.pointToLayer,Ne=x&&x.coordsToLatLng||ae,Ze,st,Pt,ci;if(!Y&&!H)return null;switch(H.type){case"Point":return Ze=Ne(Y),X(ge,D,Ze,x);case"MultiPoint":for(Pt=0,ci=Y.length;Pt<ci;Pt++)Ze=Ne(Y[Pt]),re.push(X(ge,D,Ze,x));return new Zd(re);case"LineString":case"MultiLineString":return st=ue(Y,H.type==="LineString"?0:1,Ne),new ud(st,x);case"Polygon":case"MultiPolygon":return st=ue(Y,H.type==="Polygon"?1:2,Ne),new Rc(st,x);case"GeometryCollection":for(Pt=0,ci=H.geometries.length;Pt<ci;Pt++){var rn=q({geometry:H.geometries[Pt],type:"Feature",properties:D.properties},x);rn&&re.push(rn)}return new Zd(re);case"FeatureCollection":for(Pt=0,ci=H.features.length;Pt<ci;Pt++){var ir=q(H.features[Pt],x);ir&&re.push(ir)}return new Zd(re);default:throw new Error("Invalid GeoJSON object.")}}function X(D,x,H,Y){return D?D(x,H):new Sa(H,Y&&Y.markersInheritOptions&&Y)}function ae(D){return new W(D[1],D[0],D[2])}function ue(D,x,H){for(var Y=[],re=0,ge=D.length,Ne;re<ge;re++)Ne=x?ue(D[re],x-1,H):(H||ae)(D[re]),Y.push(Ne);return Y}function ve(D,x){return D=Z(D),D.alt!==void 0?[p(D.lng,x),p(D.lat,x),p(D.alt,x)]:[p(D.lng,x),p(D.lat,x)]}function Te(D,x,H,Y){for(var re=[],ge=0,Ne=D.length;ge<Ne;ge++)re.push(x?Te(D[ge],bl(D[ge])?0:x-1,H,Y):ve(D[ge],Y));return!x&&H&&re.length>0&&re.push(re[0].slice()),re}function Pe(D,x){return D.feature?r({},D.feature,{geometry:x}):Be(x)}function Be(D){return D.type==="Feature"||D.type==="FeatureCollection"?D:{type:"Feature",properties:{},geometry:D}}var Le={toGeoJSON:function(D){return Pe(this,{type:"Point",coordinates:ve(this.getLatLng(),D)})}};Sa.include(Le),h0.include(Le),p0.include(Le),ud.include({toGeoJSON:function(D){var x=!bl(this._latlngs),H=Te(this._latlngs,x?1:0,!1,D);return Pe(this,{type:(x?"Multi":"")+"LineString",coordinates:H})}}),Rc.include({toGeoJSON:function(D){var x=!bl(this._latlngs),H=x&&!bl(this._latlngs[0]),Y=Te(this._latlngs,H?2:x?1:0,!0,D);return x||(Y=[Y]),Pe(this,{type:(H?"Multi":"")+"Polygon",coordinates:Y})}}),gf.include({toMultiPoint:function(D){var x=[];return this.eachLayer(function(H){x.push(H.toGeoJSON(D).geometry.coordinates)}),Pe(this,{type:"MultiPoint",coordinates:x})},toGeoJSON:function(D){var x=this.feature&&this.feature.geometry&&this.feature.geometry.type;if(x==="MultiPoint")return this.toMultiPoint(D);var H=x==="GeometryCollection",Y=[];return this.eachLayer(function(re){if(re.toGeoJSON){var ge=re.toGeoJSON(D);if(H)Y.push(ge.geometry);else{var Ne=Be(ge);Ne.type==="FeatureCollection"?Y.push.apply(Y,Ne.features):Y.push(Ne)}}}),H?Pe(this,{geometries:Y,type:"GeometryCollection"}):{type:"FeatureCollection",features:Y}}});function We(D,x){return new G(D,x)}var xe=We,qe=gu.extend({options:{opacity:1,alt:"",interactive:!1,crossOrigin:!1,errorOverlayUrl:"",zIndex:1,className:""},initialize:function(D,x,H){this._url=D,this._bounds=z(x),m(this,H)},onAdd:function(){this._image||(this._initImage(),this.options.opacity<1&&this._updateOpacity()),this.options.interactive&&(qi(this._image,"leaflet-interactive"),this.addInteractiveTarget(this._image)),this.getPane().appendChild(this._image),this._reset()},onRemove:function(){$i(this._image),this.options.interactive&&this.removeInteractiveTarget(this._image)},setOpacity:function(D){return this.options.opacity=D,this._image&&this._updateOpacity(),this},setStyle:function(D){return D.opacity&&this.setOpacity(D.opacity),this},bringToFront:function(){return this._map&&on(this._image),this},bringToBack:function(){return this._map&&Yo(this._image),this},setUrl:function(D){return this._url=D,this._image&&(this._image.src=D),this},setBounds:function(D){return this._bounds=z(D),this._map&&this._reset(),this},getEvents:function(){var D={zoom:this._reset,viewreset:this._reset};return this._zoomAnimated&&(D.zoomanim=this._animateZoom),D},setZIndex:function(D){return this.options.zIndex=D,this._updateZIndex(),this},getBounds:function(){return this._bounds},getElement:function(){return this._image},_initImage:function(){var D=this._url.tagName==="IMG",x=this._image=D?this._url:Wt("img");if(qi(x,"leaflet-image-layer"),this._zoomAnimated&&qi(x,"leaflet-zoom-animated"),this.options.className&&qi(x,this.options.className),x.onselectstart=d,x.onmousemove=d,x.onload=s(this.fire,this,"load"),x.onerror=s(this._overlayOnError,this,"error"),(this.options.crossOrigin||this.options.crossOrigin==="")&&(x.crossOrigin=this.options.crossOrigin===!0?"":this.options.crossOrigin),this.options.zIndex&&this._updateZIndex(),D){this._url=x.src;return}x.src=this._url,x.alt=this.options.alt},_animateZoom:function(D){var x=this._map.getZoomScale(D.zoom),H=this._map._latLngBoundsToNewLayerBounds(this._bounds,D.zoom,D.center).min;$s(this._image,H,x)},_reset:function(){var D=this._image,x=new V(this._map.latLngToLayerPoint(this._bounds.getNorthWest()),this._map.latLngToLayerPoint(this._bounds.getSouthEast())),H=x.getSize();qr(D,x.min),D.style.width=H.x+"px",D.style.height=H.y+"px"},_updateOpacity:function(){Ro(this._image,this.options.opacity)},_updateZIndex:function(){this._image&&this.options.zIndex!==void 0&&this.options.zIndex!==null&&(this._image.style.zIndex=this.options.zIndex)},_overlayOnError:function(){this.fire("error");var D=this.options.errorOverlayUrl;D&&this._url!==D&&(this._url=D,this._image.src=D)},getCenter:function(){return this._bounds.getCenter()}}),Ve=function(D,x,H){return new qe(D,x,H)},He=qe.extend({options:{autoplay:!0,loop:!0,keepAspectRatio:!0,muted:!1,playsInline:!0},_initImage:function(){var D=this._url.tagName==="VIDEO",x=this._image=D?this._url:Wt("video");if(qi(x,"leaflet-image-layer"),this._zoomAnimated&&qi(x,"leaflet-zoom-animated"),this.options.className&&qi(x,this.options.className),x.onselectstart=d,x.onmousemove=d,x.onloadeddata=s(this.fire,this,"load"),D){for(var H=x.getElementsByTagName("source"),Y=[],re=0;re<H.length;re++)Y.push(H[re].src);this._url=H.length>0?Y:[x.src];return}b(this._url)||(this._url=[this._url]),!this.options.keepAspectRatio&&Object.prototype.hasOwnProperty.call(x.style,"objectFit")&&(x.style.objectFit="fill"),x.autoplay=!!this.options.autoplay,x.loop=!!this.options.loop,x.muted=!!this.options.muted,x.playsInline=!!this.options.playsInline;for(var ge=0;ge<this._url.length;ge++){var Ne=Wt("source");Ne.src=this._url[ge],x.appendChild(Ne)}}});function Ye(D,x,H){return new He(D,x,H)}var je=qe.extend({_initImage:function(){var D=this._image=this._url;qi(D,"leaflet-image-layer"),this._zoomAnimated&&qi(D,"leaflet-zoom-animated"),this.options.className&&qi(D,this.options.className),D.onselectstart=d,D.onmousemove=d}});function tt(D,x,H){return new je(D,x,H)}var it=gu.extend({options:{interactive:!1,offset:[0,0],className:"",pane:void 0,content:""},initialize:function(D,x){D&&(D instanceof W||b(D))?(this._latlng=Z(D),m(this,x)):(m(this,D),this._source=x),this.options.content&&(this._content=this.options.content)},openOn:function(D){return D=arguments.length?D:this._source._map,D.hasLayer(this)||D.addLayer(this),this},close:function(){return this._map&&this._map.removeLayer(this),this},toggle:function(D){return this._map?this.close():(arguments.length?this._source=D:D=this._source,this._prepareOpen(),this.openOn(D._map)),this},onAdd:function(D){this._zoomAnimated=D._zoomAnimated,this._container||this._initLayout(),D._fadeAnimated&&Ro(this._container,0),clearTimeout(this._removeTimeout),this.getPane().appendChild(this._container),this.update(),D._fadeAnimated&&Ro(this._container,1),this.bringToFront(),this.options.interactive&&(qi(this._container,"leaflet-interactive"),this.addInteractiveTarget(this._container))},onRemove:function(D){D._fadeAnimated?(Ro(this._container,0),this._removeTimeout=setTimeout(s($i,void 0,this._container),200)):$i(this._container),this.options.interactive&&(zr(this._container,"leaflet-interactive"),this.removeInteractiveTarget(this._container))},getLatLng:function(){return this._latlng},setLatLng:function(D){return this._latlng=Z(D),this._map&&(this._updatePosition(),this._adjustPan()),this},getContent:function(){return this._content},setContent:function(D){return this._content=D,this.update(),this},getElement:function(){return this._container},update:function(){this._map&&(this._container.style.visibility="hidden",this._updateContent(),this._updateLayout(),this._updatePosition(),this._container.style.visibility="",this._adjustPan())},getEvents:function(){var D={zoom:this._updatePosition,viewreset:this._updatePosition};return this._zoomAnimated&&(D.zoomanim=this._animateZoom),D},isOpen:function(){return!!this._map&&this._map.hasLayer(this)},bringToFront:function(){return this._map&&on(this._container),this},bringToBack:function(){return this._map&&Yo(this._container),this},_prepareOpen:function(D){var x=this._source;if(!x._map)return!1;if(x instanceof Zd){x=null;var H=this._source._layers;for(var Y in H)if(H[Y]._map){x=H[Y];break}if(!x)return!1;this._source=x}if(!D)if(x.getCenter)D=x.getCenter();else if(x.getLatLng)D=x.getLatLng();else if(x.getBounds)D=x.getBounds().getCenter();else throw new Error("Unable to get source layer LatLng.");return this.setLatLng(D),this._map&&this.update(),!0},_updateContent:function(){if(this._content){var D=this._contentNode,x=typeof this._content=="function"?this._content(this._source||this):this._content;if(typeof x=="string")D.innerHTML=x;else{for(;D.hasChildNodes();)D.removeChild(D.firstChild);D.appendChild(x)}this.fire("contentupdate")}},_updatePosition:function(){if(this._map){var D=this._map.latLngToLayerPoint(this._latlng),x=F(this.options.offset),H=this._getAnchor();this._zoomAnimated?qr(this._container,D.add(H)):x=x.add(D).add(H);var Y=this._containerBottom=-x.y,re=this._containerLeft=-Math.round(this._containerWidth/2)+x.x;this._container.style.bottom=Y+"px",this._container.style.left=re+"px"}},_getAnchor:function(){return[0,0]}});li.include({_initOverlay:function(D,x,H,Y){var re=x;return re instanceof D||(re=new D(Y).setContent(x)),H&&re.setLatLng(H),re}}),gu.include({_initOverlay:function(D,x,H,Y){var re=H;return re instanceof D?(m(re,Y),re._source=this):(re=x&&!Y?x:new D(Y,this),re.setContent(H)),re}});var rt=it.extend({options:{pane:"popupPane",offset:[0,7],maxWidth:300,minWidth:50,maxHeight:null,autoPan:!0,autoPanPaddingTopLeft:null,autoPanPaddingBottomRight:null,autoPanPadding:[5,5],keepInView:!1,closeButton:!0,autoClose:!0,closeOnEscapeKey:!0,className:""},openOn:function(D){return D=arguments.length?D:this._source._map,!D.hasLayer(this)&&D._popup&&D._popup.options.autoClose&&D.removeLayer(D._popup),D._popup=this,it.prototype.openOn.call(this,D)},onAdd:function(D){it.prototype.onAdd.call(this,D),D.fire("popupopen",{popup:this}),this._source&&(this._source.fire("popupopen",{popup:this},!0),this._source instanceof Hs||this._source.on("preclick",js))},onRemove:function(D){it.prototype.onRemove.call(this,D),D.fire("popupclose",{popup:this}),this._source&&(this._source.fire("popupclose",{popup:this},!0),this._source instanceof Hs||this._source.off("preclick",js))},getEvents:function(){var D=it.prototype.getEvents.call(this);return(this.options.closeOnClick!==void 0?this.options.closeOnClick:this._map.options.closePopupOnClick)&&(D.preclick=this.close),this.options.keepInView&&(D.moveend=this._adjustPan),D},_initLayout:function(){var D="leaflet-popup",x=this._container=Wt("div",D+" "+(this.options.className||"")+" leaflet-zoom-animated"),H=this._wrapper=Wt("div",D+"-content-wrapper",x);if(this._contentNode=Wt("div",D+"-content",H),yl(x),Kd(this._contentNode),Bi(x,"contextmenu",js),this._tipContainer=Wt("div",D+"-tip-container",x),this._tip=Wt("div",D+"-tip",this._tipContainer),this.options.closeButton){var Y=this._closeButton=Wt("a",D+"-close-button",x);Y.setAttribute("role","button"),Y.setAttribute("aria-label","Close popup"),Y.href="#close",Y.innerHTML='<span aria-hidden="true">&#215;</span>',Bi(Y,"click",function(re){_a(re),this.close()},this)}},_updateLayout:function(){var D=this._contentNode,x=D.style;x.width="",x.whiteSpace="nowrap";var H=D.offsetWidth;H=Math.min(H,this.options.maxWidth),H=Math.max(H,this.options.minWidth),x.width=H+1+"px",x.whiteSpace="",x.height="";var Y=D.offsetHeight,re=this.options.maxHeight,ge="leaflet-popup-scrolled";re&&Y>re?(x.height=re+"px",qi(D,ge)):zr(D,ge),this._containerWidth=this._container.offsetWidth},_animateZoom:function(D){var x=this._map._latLngToNewLayerPoint(this._latlng,D.zoom,D.center),H=this._getAnchor();qr(this._container,x.add(H))},_adjustPan:function(){if(this.options.autoPan){if(this._map._panAnim&&this._map._panAnim.stop(),this._autopanning){this._autopanning=!1;return}var D=this._map,x=parseInt(nt(this._container,"marginBottom"),10)||0,H=this._container.offsetHeight+x,Y=this._containerWidth,re=new O(this._containerLeft,-H-this._containerBottom);re._add(Ko(this._container));var ge=D.layerPointToContainerPoint(re),Ne=F(this.options.autoPanPadding),Ze=F(this.options.autoPanPaddingTopLeft||Ne),st=F(this.options.autoPanPaddingBottomRight||Ne),Pt=D.getSize(),ci=0,rn=0;ge.x+Y+st.x>Pt.x&&(ci=ge.x+Y-Pt.x+st.x),ge.x-ci-Ze.x<0&&(ci=ge.x-Ze.x),ge.y+H+st.y>Pt.y&&(rn=ge.y+H-Pt.y+st.y),ge.y-rn-Ze.y<0&&(rn=ge.y-Ze.y),(ci||rn)&&(this.options.keepInView&&(this._autopanning=!0),D.fire("autopanstart").panBy([ci,rn]))}},_getAnchor:function(){return F(this._source&&this._source._getPopupAnchor?this._source._getPopupAnchor():[0,0])}}),vt=function(D,x){return new rt(D,x)};li.mergeOptions({closePopupOnClick:!0}),li.include({openPopup:function(D,x,H){return this._initOverlay(rt,D,x,H).openOn(this),this},closePopup:function(D){return D=arguments.length?D:this._popup,D&&D.close(),this}}),gu.include({bindPopup:function(D,x){return this._popup=this._initOverlay(rt,this._popup,D,x),this._popupHandlersAdded||(this.on({click:this._openPopup,keypress:this._onKeyPress,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!0),this},unbindPopup:function(){return this._popup&&(this.off({click:this._openPopup,keypress:this._onKeyPress,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!1,this._popup=null),this},openPopup:function(D){return this._popup&&(this instanceof Zd||(this._popup._source=this),this._popup._prepareOpen(D||this._latlng)&&this._popup.openOn(this._map)),this},closePopup:function(){return this._popup&&this._popup.close(),this},togglePopup:function(){return this._popup&&this._popup.toggle(this),this},isPopupOpen:function(){return this._popup?this._popup.isOpen():!1},setPopupContent:function(D){return this._popup&&this._popup.setContent(D),this},getPopup:function(){return this._popup},_openPopup:function(D){if(!(!this._popup||!this._map)){fu(D);var x=D.layer||D.target;if(this._popup._source===x&&!(x instanceof Hs)){this._map.hasLayer(this._popup)?this.closePopup():this.openPopup(D.latlng);return}this._popup._source=x,this.openPopup(D.latlng)}},_movePopup:function(D){this._popup.setLatLng(D.latlng)},_onKeyPress:function(D){D.originalEvent.keyCode===13&&this._openPopup(D)}});var kt=it.extend({options:{pane:"tooltipPane",offset:[0,0],direction:"auto",permanent:!1,sticky:!1,opacity:.9},onAdd:function(D){it.prototype.onAdd.call(this,D),this.setOpacity(this.options.opacity),D.fire("tooltipopen",{tooltip:this}),this._source&&(this.addEventParent(this._source),this._source.fire("tooltipopen",{tooltip:this},!0))},onRemove:function(D){it.prototype.onRemove.call(this,D),D.fire("tooltipclose",{tooltip:this}),this._source&&(this.removeEventParent(this._source),this._source.fire("tooltipclose",{tooltip:this},!0))},getEvents:function(){var D=it.prototype.getEvents.call(this);return this.options.permanent||(D.preclick=this.close),D},_initLayout:function(){var D="leaflet-tooltip",x=D+" "+(this.options.className||"")+" leaflet-zoom-"+(this._zoomAnimated?"animated":"hide");this._contentNode=this._container=Wt("div",x),this._container.setAttribute("role","tooltip"),this._container.setAttribute("id","leaflet-tooltip-"+l(this))},_updateLayout:function(){},_adjustPan:function(){},_setPosition:function(D){var x,H,Y=this._map,re=this._container,ge=Y.latLngToContainerPoint(Y.getCenter()),Ne=Y.layerPointToContainerPoint(D),Ze=this.options.direction,st=re.offsetWidth,Pt=re.offsetHeight,ci=F(this.options.offset),rn=this._getAnchor();Ze==="top"?(x=st/2,H=Pt):Ze==="bottom"?(x=st/2,H=0):Ze==="center"?(x=st/2,H=Pt/2):Ze==="right"?(x=0,H=Pt/2):Ze==="left"?(x=st,H=Pt/2):Ne.x<ge.x?(Ze="right",x=0,H=Pt/2):(Ze="left",x=st+(ci.x+rn.x)*2,H=Pt/2),D=D.subtract(F(x,H,!0)).add(ci).add(rn),zr(re,"leaflet-tooltip-right"),zr(re,"leaflet-tooltip-left"),zr(re,"leaflet-tooltip-top"),zr(re,"leaflet-tooltip-bottom"),qi(re,"leaflet-tooltip-"+Ze),qr(re,D)},_updatePosition:function(){var D=this._map.latLngToLayerPoint(this._latlng);this._setPosition(D)},setOpacity:function(D){this.options.opacity=D,this._container&&Ro(this._container,D)},_animateZoom:function(D){var x=this._map._latLngToNewLayerPoint(this._latlng,D.zoom,D.center);this._setPosition(x)},_getAnchor:function(){return F(this._source&&this._source._getTooltipAnchor&&!this.options.sticky?this._source._getTooltipAnchor():[0,0])}}),Xt=function(D,x){return new kt(D,x)};li.include({openTooltip:function(D,x,H){return this._initOverlay(kt,D,x,H).openOn(this),this},closeTooltip:function(D){return D.close(),this}}),gu.include({bindTooltip:function(D,x){return this._tooltip&&this.isTooltipOpen()&&this.unbindTooltip(),this._tooltip=this._initOverlay(kt,this._tooltip,D,x),this._initTooltipInteractions(),this._tooltip.options.permanent&&this._map&&this._map.hasLayer(this)&&this.openTooltip(),this},unbindTooltip:function(){return this._tooltip&&(this._initTooltipInteractions(!0),this.closeTooltip(),this._tooltip=null),this},_initTooltipInteractions:function(D){if(!(!D&&this._tooltipHandlersAdded)){var x=D?"off":"on",H={remove:this.closeTooltip,move:this._moveTooltip};this._tooltip.options.permanent?H.add=this._openTooltip:(H.mouseover=this._openTooltip,H.mouseout=this.closeTooltip,H.click=this._openTooltip,this._map?this._addFocusListeners():H.add=this._addFocusListeners),this._tooltip.options.sticky&&(H.mousemove=this._moveTooltip),this[x](H),this._tooltipHandlersAdded=!D}},openTooltip:function(D){return this._tooltip&&(this instanceof Zd||(this._tooltip._source=this),this._tooltip._prepareOpen(D)&&(this._tooltip.openOn(this._map),this.getElement?this._setAriaDescribedByOnLayer(this):this.eachLayer&&this.eachLayer(this._setAriaDescribedByOnLayer,this))),this},closeTooltip:function(){if(this._tooltip)return this._tooltip.close()},toggleTooltip:function(){return this._tooltip&&this._tooltip.toggle(this),this},isTooltipOpen:function(){return this._tooltip.isOpen()},setTooltipContent:function(D){return this._tooltip&&this._tooltip.setContent(D),this},getTooltip:function(){return this._tooltip},_addFocusListeners:function(){this.getElement?this._addFocusListenersOnLayer(this):this.eachLayer&&this.eachLayer(this._addFocusListenersOnLayer,this)},_addFocusListenersOnLayer:function(D){var x=typeof D.getElement=="function"&&D.getElement();x&&(Bi(x,"focus",function(){this._tooltip._source=D,this.openTooltip()},this),Bi(x,"blur",this.closeTooltip,this))},_setAriaDescribedByOnLayer:function(D){var x=typeof D.getElement=="function"&&D.getElement();x&&x.setAttribute("aria-describedby",this._tooltip._container.id)},_openTooltip:function(D){if(!(!this._tooltip||!this._map)){if(this._map.dragging&&this._map.dragging.moving()&&!this._openOnceFlag){this._openOnceFlag=!0;var x=this;this._map.once("moveend",function(){x._openOnceFlag=!1,x._openTooltip(D)});return}this._tooltip._source=D.layer||D.target,this.openTooltip(this._tooltip.options.sticky?D.latlng:void 0)}},_moveTooltip:function(D){var x=D.latlng,H,Y;this._tooltip.options.sticky&&D.originalEvent&&(H=this._map.mouseEventToContainerPoint(D.originalEvent),Y=this._map.containerPointToLayerPoint(H),x=this._map.layerPointToLatLng(Y)),this._tooltip.setLatLng(x)}});var jt=pv.extend({options:{iconSize:[12,12],html:!1,bgPos:null,className:"leaflet-div-icon"},createIcon:function(D){var x=D&&D.tagName==="DIV"?D:document.createElement("div"),H=this.options;if(H.html instanceof Element?(Ja(x),x.appendChild(H.html)):x.innerHTML=H.html!==!1?H.html:"",H.bgPos){var Y=F(H.bgPos);x.style.backgroundPosition=-Y.x+"px "+-Y.y+"px"}return this._setIconStyles(x,"icon"),x},createShadow:function(){return null}});function Yt(D){return new jt(D)}pv.Default=vf;var qt=gu.extend({options:{tileSize:256,opacity:1,updateWhenIdle:Dt.mobile,updateWhenZooming:!0,updateInterval:200,zIndex:1,bounds:null,minZoom:0,maxZoom:void 0,maxNativeZoom:void 0,minNativeZoom:void 0,noWrap:!1,pane:"tilePane",className:"",keepBuffer:2},initialize:function(D){m(this,D)},onAdd:function(){this._initContainer(),this._levels={},this._tiles={},this._resetView()},beforeAdd:function(D){D._addZoomLimit(this)},onRemove:function(D){this._removeAllTiles(),$i(this._container),D._removeZoomLimit(this),this._container=null,this._tileZoom=void 0},bringToFront:function(){return this._map&&(on(this._container),this._setAutoZIndex(Math.max)),this},bringToBack:function(){return this._map&&(Yo(this._container),this._setAutoZIndex(Math.min)),this},getContainer:function(){return this._container},setOpacity:function(D){return this.options.opacity=D,this._updateOpacity(),this},setZIndex:function(D){return this.options.zIndex=D,this._updateZIndex(),this},isLoading:function(){return this._loading},redraw:function(){if(this._map){this._removeAllTiles();var D=this._clampZoom(this._map.getZoom());D!==this._tileZoom&&(this._tileZoom=D,this._updateLevels()),this._update()}return this},getEvents:function(){var D={viewprereset:this._invalidateAll,viewreset:this._resetView,zoom:this._resetView,moveend:this._onMoveEnd};return this.options.updateWhenIdle||(this._onMove||(this._onMove=c(this._onMoveEnd,this.options.updateInterval,this)),D.move=this._onMove),this._zoomAnimated&&(D.zoomanim=this._animateZoom),D},createTile:function(){return document.createElement("div")},getTileSize:function(){var D=this.options.tileSize;return D instanceof O?D:new O(D,D)},_updateZIndex:function(){this._container&&this.options.zIndex!==void 0&&this.options.zIndex!==null&&(this._container.style.zIndex=this.options.zIndex)},_setAutoZIndex:function(D){for(var x=this.getPane().children,H=-D(-1/0,1/0),Y=0,re=x.length,ge;Y<re;Y++)ge=x[Y].style.zIndex,x[Y]!==this._container&&ge&&(H=D(H,+ge));isFinite(H)&&(this.options.zIndex=H+D(-1,1),this._updateZIndex())},_updateOpacity:function(){if(this._map&&!Dt.ielt9){Ro(this._container,this.options.opacity);var D=+new Date,x=!1,H=!1;for(var Y in this._tiles){var re=this._tiles[Y];if(!(!re.current||!re.loaded)){var ge=Math.min(1,(D-re.loaded)/200);Ro(re.el,ge),ge<1?x=!0:(re.active?H=!0:this._onOpaqueTile(re),re.active=!0)}}H&&!this._noPrune&&this._pruneTiles(),x&&(C(this._fadeFrame),this._fadeFrame=R(this._updateOpacity,this))}},_onOpaqueTile:d,_initContainer:function(){this._container||(this._container=Wt("div","leaflet-layer "+(this.options.className||"")),this._updateZIndex(),this.options.opacity<1&&this._updateOpacity(),this.getPane().appendChild(this._container))},_updateLevels:function(){var D=this._tileZoom,x=this.options.maxZoom;if(D!==void 0){for(var H in this._levels)H=Number(H),this._levels[H].el.children.length||H===D?(this._levels[H].el.style.zIndex=x-Math.abs(D-H),this._onUpdateLevel(H)):($i(this._levels[H].el),this._removeTilesAtZoom(H),this._onRemoveLevel(H),delete this._levels[H]);var Y=this._levels[D],re=this._map;return Y||(Y=this._levels[D]={},Y.el=Wt("div","leaflet-tile-container leaflet-zoom-animated",this._container),Y.el.style.zIndex=x,Y.origin=re.project(re.unproject(re.getPixelOrigin()),D).round(),Y.zoom=D,this._setZoomTransform(Y,re.getCenter(),re.getZoom()),d(Y.el.offsetWidth),this._onCreateLevel(Y)),this._level=Y,Y}},_onUpdateLevel:d,_onRemoveLevel:d,_onCreateLevel:d,_pruneTiles:function(){if(this._map){var D,x,H=this._map.getZoom();if(H>this.options.maxZoom||H<this.options.minZoom){this._removeAllTiles();return}for(D in this._tiles)x=this._tiles[D],x.retain=x.current;for(D in this._tiles)if(x=this._tiles[D],x.current&&!x.active){var Y=x.coords;this._retainParent(Y.x,Y.y,Y.z,Y.z-5)||this._retainChildren(Y.x,Y.y,Y.z,Y.z+2)}for(D in this._tiles)this._tiles[D].retain||this._removeTile(D)}},_removeTilesAtZoom:function(D){for(var x in this._tiles)this._tiles[x].coords.z===D&&this._removeTile(x)},_removeAllTiles:function(){for(var D in this._tiles)this._removeTile(D)},_invalidateAll:function(){for(var D in this._levels)$i(this._levels[D].el),this._onRemoveLevel(Number(D)),delete this._levels[D];this._removeAllTiles(),this._tileZoom=void 0},_retainParent:function(D,x,H,Y){var re=Math.floor(D/2),ge=Math.floor(x/2),Ne=H-1,Ze=new O(+re,+ge);Ze.z=+Ne;var st=this._tileCoordsToKey(Ze),Pt=this._tiles[st];return Pt&&Pt.active?(Pt.retain=!0,!0):(Pt&&Pt.loaded&&(Pt.retain=!0),Ne>Y?this._retainParent(re,ge,Ne,Y):!1)},_retainChildren:function(D,x,H,Y){for(var re=2*D;re<2*D+2;re++)for(var ge=2*x;ge<2*x+2;ge++){var Ne=new O(re,ge);Ne.z=H+1;var Ze=this._tileCoordsToKey(Ne),st=this._tiles[Ze];if(st&&st.active){st.retain=!0;continue}else st&&st.loaded&&(st.retain=!0);H+1<Y&&this._retainChildren(re,ge,H+1,Y)}},_resetView:function(D){var x=D&&(D.pinch||D.flyTo);this._setView(this._map.getCenter(),this._map.getZoom(),x,x)},_animateZoom:function(D){this._setView(D.center,D.zoom,!0,D.noUpdate)},_clampZoom:function(D){var x=this.options;return x.minNativeZoom!==void 0&&D<x.minNativeZoom?x.minNativeZoom:x.maxNativeZoom!==void 0&&x.maxNativeZoom<D?x.maxNativeZoom:D},_setView:function(D,x,H,Y){var re=Math.round(x);this.options.maxZoom!==void 0&&re>this.options.maxZoom||this.options.minZoom!==void 0&&re<this.options.minZoom?re=void 0:re=this._clampZoom(re);var ge=this.options.updateWhenZooming&&re!==this._tileZoom;(!Y||ge)&&(this._tileZoom=re,this._abortLoading&&this._abortLoading(),this._updateLevels(),this._resetGrid(),re!==void 0&&this._update(D),H||this._pruneTiles(),this._noPrune=!!H),this._setZoomTransforms(D,x)},_setZoomTransforms:function(D,x){for(var H in this._levels)this._setZoomTransform(this._levels[H],D,x)},_setZoomTransform:function(D,x,H){var Y=this._map.getZoomScale(H,D.zoom),re=D.origin.multiplyBy(Y).subtract(this._map._getNewPixelOrigin(x,H)).round();Dt.any3d?$s(D.el,re,Y):qr(D.el,re)},_resetGrid:function(){var D=this._map,x=D.options.crs,H=this._tileSize=this.getTileSize(),Y=this._tileZoom,re=this._map.getPixelWorldBounds(this._tileZoom);re&&(this._globalTileRange=this._pxBoundsToTileRange(re)),this._wrapX=x.wrapLng&&!this.options.noWrap&&[Math.floor(D.project([0,x.wrapLng[0]],Y).x/H.x),Math.ceil(D.project([0,x.wrapLng[1]],Y).x/H.y)],this._wrapY=x.wrapLat&&!this.options.noWrap&&[Math.floor(D.project([x.wrapLat[0],0],Y).y/H.x),Math.ceil(D.project([x.wrapLat[1],0],Y).y/H.y)]},_onMoveEnd:function(){!this._map||this._map._animatingZoom||this._update()},_getTiledPixelBounds:function(D){var x=this._map,H=x._animatingZoom?Math.max(x._animateToZoom,x.getZoom()):x.getZoom(),Y=x.getZoomScale(H,this._tileZoom),re=x.project(D,this._tileZoom).floor(),ge=x.getSize().divideBy(Y*2);return new V(re.subtract(ge),re.add(ge))},_update:function(D){var x=this._map;if(x){var H=this._clampZoom(x.getZoom());if(D===void 0&&(D=x.getCenter()),this._tileZoom!==void 0){var Y=this._getTiledPixelBounds(D),re=this._pxBoundsToTileRange(Y),ge=re.getCenter(),Ne=[],Ze=this.options.keepBuffer,st=new V(re.getBottomLeft().subtract([Ze,-Ze]),re.getTopRight().add([Ze,-Ze]));if(!(isFinite(re.min.x)&&isFinite(re.min.y)&&isFinite(re.max.x)&&isFinite(re.max.y)))throw new Error("Attempted to load an infinite number of tiles");for(var Pt in this._tiles){var ci=this._tiles[Pt].coords;(ci.z!==this._tileZoom||!st.contains(new O(ci.x,ci.y)))&&(this._tiles[Pt].current=!1)}if(Math.abs(H-this._tileZoom)>1){this._setView(D,H);return}for(var rn=re.min.y;rn<=re.max.y;rn++)for(var ir=re.min.x;ir<=re.max.x;ir++){var Mc=new O(ir,rn);if(Mc.z=this._tileZoom,!!this._isValidTile(Mc)){var Zo=this._tiles[this._tileCoordsToKey(Mc)];Zo?Zo.current=!0:Ne.push(Mc)}}if(Ne.sort(function(vu,g0){return vu.distanceTo(ge)-g0.distanceTo(ge)}),Ne.length!==0){this._loading||(this._loading=!0,this.fire("loading"));var Jd=document.createDocumentFragment();for(ir=0;ir<Ne.length;ir++)this._addTile(Ne[ir],Jd);this._level.el.appendChild(Jd)}}}},_isValidTile:function(D){var x=this._map.options.crs;if(!x.infinite){var H=this._globalTileRange;if(!x.wrapLng&&(D.x<H.min.x||D.x>H.max.x)||!x.wrapLat&&(D.y<H.min.y||D.y>H.max.y))return!1}if(!this.options.bounds)return!0;var Y=this._tileCoordsToBounds(D);return z(this.options.bounds).overlaps(Y)},_keyToBounds:function(D){return this._tileCoordsToBounds(this._keyToTileCoords(D))},_tileCoordsToNwSe:function(D){var x=this._map,H=this.getTileSize(),Y=D.scaleBy(H),re=Y.add(H),ge=x.unproject(Y,D.z),Ne=x.unproject(re,D.z);return[ge,Ne]},_tileCoordsToBounds:function(D){var x=this._tileCoordsToNwSe(D),H=new B(x[0],x[1]);return this.options.noWrap||(H=this._map.wrapLatLngBounds(H)),H},_tileCoordsToKey:function(D){return D.x+":"+D.y+":"+D.z},_keyToTileCoords:function(D){var x=D.split(":"),H=new O(+x[0],+x[1]);return H.z=+x[2],H},_removeTile:function(D){var x=this._tiles[D];x&&($i(x.el),delete this._tiles[D],this.fire("tileunload",{tile:x.el,coords:this._keyToTileCoords(D)}))},_initTile:function(D){qi(D,"leaflet-tile");var x=this.getTileSize();D.style.width=x.x+"px",D.style.height=x.y+"px",D.onselectstart=d,D.onmousemove=d,Dt.ielt9&&this.options.opacity<1&&Ro(D,this.options.opacity)},_addTile:function(D,x){var H=this._getTilePos(D),Y=this._tileCoordsToKey(D),re=this.createTile(this._wrapCoords(D),s(this._tileReady,this,D));this._initTile(re),this.createTile.length<2&&R(s(this._tileReady,this,D,null,re)),qr(re,H),this._tiles[Y]={el:re,coords:D,current:!0},x.appendChild(re),this.fire("tileloadstart",{tile:re,coords:D})},_tileReady:function(D,x,H){x&&this.fire("tileerror",{error:x,tile:H,coords:D});var Y=this._tileCoordsToKey(D);H=this._tiles[Y],H&&(H.loaded=+new Date,this._map._fadeAnimated?(Ro(H.el,0),C(this._fadeFrame),this._fadeFrame=R(this._updateOpacity,this)):(H.active=!0,this._pruneTiles()),x||(qi(H.el,"leaflet-tile-loaded"),this.fire("tileload",{tile:H.el,coords:D})),this._noTilesToLoad()&&(this._loading=!1,this.fire("load"),Dt.ielt9||!this._map._fadeAnimated?R(this._pruneTiles,this):setTimeout(s(this._pruneTiles,this),250)))},_getTilePos:function(D){return D.scaleBy(this.getTileSize()).subtract(this._level.origin)},_wrapCoords:function(D){var x=new O(this._wrapX?u(D.x,this._wrapX):D.x,this._wrapY?u(D.y,this._wrapY):D.y);return x.z=D.z,x},_pxBoundsToTileRange:function(D){var x=this.getTileSize();return new V(D.min.unscaleBy(x).floor(),D.max.unscaleBy(x).ceil().subtract([1,1]))},_noTilesToLoad:function(){for(var D in this._tiles)if(!this._tiles[D].loaded)return!1;return!0}});function Lt(D){return new qt(D)}var en=qt.extend({options:{minZoom:0,maxZoom:18,subdomains:"abc",errorTileUrl:"",zoomOffset:0,tms:!1,zoomReverse:!1,detectRetina:!1,crossOrigin:!1,referrerPolicy:!1},initialize:function(D,x){this._url=D,x=m(this,x),x.detectRetina&&Dt.retina&&x.maxZoom>0?(x.tileSize=Math.floor(x.tileSize/2),x.zoomReverse?(x.zoomOffset--,x.minZoom=Math.min(x.maxZoom,x.minZoom+1)):(x.zoomOffset++,x.maxZoom=Math.max(x.minZoom,x.maxZoom-1)),x.minZoom=Math.max(0,x.minZoom)):x.zoomReverse?x.minZoom=Math.min(x.maxZoom,x.minZoom):x.maxZoom=Math.max(x.minZoom,x.maxZoom),typeof x.subdomains=="string"&&(x.subdomains=x.subdomains.split("")),this.on("tileunload",this._onTileRemove)},setUrl:function(D,x){return this._url===D&&x===void 0&&(x=!0),this._url=D,x||this.redraw(),this},createTile:function(D,x){var H=document.createElement("img");return Bi(H,"load",s(this._tileOnLoad,this,x,H)),Bi(H,"error",s(this._tileOnError,this,x,H)),(this.options.crossOrigin||this.options.crossOrigin==="")&&(H.crossOrigin=this.options.crossOrigin===!0?"":this.options.crossOrigin),typeof this.options.referrerPolicy=="string"&&(H.referrerPolicy=this.options.referrerPolicy),H.alt="",H.src=this.getTileUrl(D),H},getTileUrl:function(D){var x={r:Dt.retina?"@2x":"",s:this._getSubdomain(D),x:D.x,y:D.y,z:this._getZoomForUrl()};if(this._map&&!this._map.options.crs.infinite){var H=this._globalTileRange.max.y-D.y;this.options.tms&&(x.y=H),x["-y"]=H}return y(this._url,r(x,this.options))},_tileOnLoad:function(D,x){Dt.ielt9?setTimeout(s(D,this,null,x),0):D(null,x)},_tileOnError:function(D,x,H){var Y=this.options.errorTileUrl;Y&&x.getAttribute("src")!==Y&&(x.src=Y),D(H,x)},_onTileRemove:function(D){D.tile.onload=null},_getZoomForUrl:function(){var D=this._tileZoom,x=this.options.maxZoom,H=this.options.zoomReverse,Y=this.options.zoomOffset;return H&&(D=x-D),D+Y},_getSubdomain:function(D){var x=Math.abs(D.x+D.y)%this.options.subdomains.length;return this.options.subdomains[x]},_abortLoading:function(){var D,x;for(D in this._tiles)if(this._tiles[D].coords.z!==this._tileZoom&&(x=this._tiles[D].el,x.onload=d,x.onerror=d,!x.complete)){x.src=T;var H=this._tiles[D].coords;$i(x),delete this._tiles[D],this.fire("tileabort",{tile:x,coords:H})}},_removeTile:function(D){var x=this._tiles[D];if(x)return x.el.setAttribute("src",T),qt.prototype._removeTile.call(this,D)},_tileReady:function(D,x,H){if(!(!this._map||H&&H.getAttribute("src")===T))return qt.prototype._tileReady.call(this,D,x,H)}});function In(D,x){return new en(D,x)}var Ln=en.extend({defaultWmsParams:{service:"WMS",request:"GetMap",layers:"",styles:"",format:"image/jpeg",transparent:!1,version:"1.1.1"},options:{crs:null,uppercase:!1},initialize:function(D,x){this._url=D;var H=r({},this.defaultWmsParams);for(var Y in x)Y in this.options||(H[Y]=x[Y]);x=m(this,x);var re=x.detectRetina&&Dt.retina?2:1,ge=this.getTileSize();H.width=ge.x*re,H.height=ge.y*re,this.wmsParams=H},onAdd:function(D){this._crs=this.options.crs||D.options.crs,this._wmsVersion=parseFloat(this.wmsParams.version);var x=this._wmsVersion>=1.3?"crs":"srs";this.wmsParams[x]=this._crs.code,en.prototype.onAdd.call(this,D)},getTileUrl:function(D){var x=this._tileCoordsToNwSe(D),H=this._crs,Y=j(H.project(x[0]),H.project(x[1])),re=Y.min,ge=Y.max,Ne=(this._wmsVersion>=1.3&&this._crs===S1?[re.y,re.x,ge.y,ge.x]:[re.x,re.y,ge.x,ge.y]).join(","),Ze=en.prototype.getTileUrl.call(this,D);return Ze+g(this.wmsParams,Ze,this.options.uppercase)+(this.options.uppercase?"&BBOX=":"&bbox=")+Ne},setParams:function(D,x){return r(this.wmsParams,D),x||this.redraw(),this}});function Fn(D,x){return new Ln(D,x)}en.WMS=Ln,In.wms=Fn;var zs=gu.extend({options:{padding:.1},initialize:function(D){m(this,D),l(this),this._layers=this._layers||{}},onAdd:function(){this._container||(this._initContainer(),qi(this._container,"leaflet-zoom-animated")),this.getPane().appendChild(this._container),this._update(),this.on("update",this._updatePaths,this)},onRemove:function(){this.off("update",this._updatePaths,this),this._destroyContainer()},getEvents:function(){var D={viewreset:this._reset,zoom:this._onZoom,moveend:this._update,zoomend:this._onZoomEnd};return this._zoomAnimated&&(D.zoomanim=this._onAnimZoom),D},_onAnimZoom:function(D){this._updateTransform(D.center,D.zoom)},_onZoom:function(){this._updateTransform(this._map.getCenter(),this._map.getZoom())},_updateTransform:function(D,x){var H=this._map.getZoomScale(x,this._zoom),Y=this._map.getSize().multiplyBy(.5+this.options.padding),re=this._map.project(this._center,x),ge=Y.multiplyBy(-H).add(re).subtract(this._map._getNewPixelOrigin(D,x));Dt.any3d?$s(this._container,ge,H):qr(this._container,ge)},_reset:function(){this._update(),this._updateTransform(this._center,this._zoom);for(var D in this._layers)this._layers[D]._reset()},_onZoomEnd:function(){for(var D in this._layers)this._layers[D]._project()},_updatePaths:function(){for(var D in this._layers)this._layers[D]._update()},_update:function(){var D=this.options.padding,x=this._map.getSize(),H=this._map.containerPointToLayerPoint(x.multiplyBy(-D)).round();this._bounds=new V(H,H.add(x.multiplyBy(1+D*2)).round()),this._center=this._map.getCenter(),this._zoom=this._map.getZoom()}}),_n=zs.extend({options:{tolerance:0},getEvents:function(){var D=zs.prototype.getEvents.call(this);return D.viewprereset=this._onViewPreReset,D},_onViewPreReset:function(){this._postponeUpdatePaths=!0},onAdd:function(){zs.prototype.onAdd.call(this),this._draw()},_initContainer:function(){var D=this._container=document.createElement("canvas");Bi(D,"mousemove",this._onMouseMove,this),Bi(D,"click dblclick mousedown mouseup contextmenu",this._onClick,this),Bi(D,"mouseout",this._handleMouseOut,this),D._leaflet_disable_events=!0,this._ctx=D.getContext("2d")},_destroyContainer:function(){C(this._redrawRequest),delete this._ctx,$i(this._container),cr(this._container),delete this._container},_updatePaths:function(){if(!this._postponeUpdatePaths){var D;this._redrawBounds=null;for(var x in this._layers)D=this._layers[x],D._update();this._redraw()}},_update:function(){if(!(this._map._animatingZoom&&this._bounds)){zs.prototype._update.call(this);var D=this._bounds,x=this._container,H=D.getSize(),Y=Dt.retina?2:1;qr(x,D.min),x.width=Y*H.x,x.height=Y*H.y,x.style.width=H.x+"px",x.style.height=H.y+"px",Dt.retina&&this._ctx.scale(2,2),this._ctx.translate(-D.min.x,-D.min.y),this.fire("update")}},_reset:function(){zs.prototype._reset.call(this),this._postponeUpdatePaths&&(this._postponeUpdatePaths=!1,this._updatePaths())},_initPath:function(D){this._updateDashArray(D),this._layers[l(D)]=D;var x=D._order={layer:D,prev:this._drawLast,next:null};this._drawLast&&(this._drawLast.next=x),this._drawLast=x,this._drawFirst=this._drawFirst||this._drawLast},_addPath:function(D){this._requestRedraw(D)},_removePath:function(D){var x=D._order,H=x.next,Y=x.prev;H?H.prev=Y:this._drawLast=Y,Y?Y.next=H:this._drawFirst=H,delete D._order,delete this._layers[l(D)],this._requestRedraw(D)},_updatePath:function(D){this._extendRedrawBounds(D),D._project(),D._update(),this._requestRedraw(D)},_updateStyle:function(D){this._updateDashArray(D),this._requestRedraw(D)},_updateDashArray:function(D){if(typeof D.options.dashArray=="string"){var x=D.options.dashArray.split(/[, ]+/),H=[],Y,re;for(re=0;re<x.length;re++){if(Y=Number(x[re]),isNaN(Y))return;H.push(Y)}D.options._dashArray=H}else D.options._dashArray=D.options.dashArray},_requestRedraw:function(D){this._map&&(this._extendRedrawBounds(D),this._redrawRequest=this._redrawRequest||R(this._redraw,this))},_extendRedrawBounds:function(D){if(D._pxBounds){var x=(D.options.weight||0)+1;this._redrawBounds=this._redrawBounds||new V,this._redrawBounds.extend(D._pxBounds.min.subtract([x,x])),this._redrawBounds.extend(D._pxBounds.max.add([x,x]))}},_redraw:function(){this._redrawRequest=null,this._redrawBounds&&(this._redrawBounds.min._floor(),this._redrawBounds.max._ceil()),this._clear(),this._draw(),this._redrawBounds=null},_clear:function(){var D=this._redrawBounds;if(D){var x=D.getSize();this._ctx.clearRect(D.min.x,D.min.y,x.x,x.y)}else this._ctx.save(),this._ctx.setTransform(1,0,0,1,0,0),this._ctx.clearRect(0,0,this._container.width,this._container.height),this._ctx.restore()},_draw:function(){var D,x=this._redrawBounds;if(this._ctx.save(),x){var H=x.getSize();this._ctx.beginPath(),this._ctx.rect(x.min.x,x.min.y,H.x,H.y),this._ctx.clip()}this._drawing=!0;for(var Y=this._drawFirst;Y;Y=Y.next)D=Y.layer,(!x||D._pxBounds&&D._pxBounds.intersects(x))&&D._updatePath();this._drawing=!1,this._ctx.restore()},_updatePoly:function(D,x){if(this._drawing){var H,Y,re,ge,Ne=D._parts,Ze=Ne.length,st=this._ctx;if(Ze){for(st.beginPath(),H=0;H<Ze;H++){for(Y=0,re=Ne[H].length;Y<re;Y++)ge=Ne[H][Y],st[Y?"lineTo":"moveTo"](ge.x,ge.y);x&&st.closePath()}this._fillStroke(st,D)}}},_updateCircle:function(D){if(!(!this._drawing||D._empty())){var x=D._point,H=this._ctx,Y=Math.max(Math.round(D._radius),1),re=(Math.max(Math.round(D._radiusY),1)||Y)/Y;re!==1&&(H.save(),H.scale(1,re)),H.beginPath(),H.arc(x.x,x.y/re,Y,0,Math.PI*2,!1),re!==1&&H.restore(),this._fillStroke(H,D)}},_fillStroke:function(D,x){var H=x.options;H.fill&&(D.globalAlpha=H.fillOpacity,D.fillStyle=H.fillColor||H.color,D.fill(H.fillRule||"evenodd")),H.stroke&&H.weight!==0&&(D.setLineDash&&D.setLineDash(x.options&&x.options._dashArray||[]),D.globalAlpha=H.opacity,D.lineWidth=H.weight,D.strokeStyle=H.color,D.lineCap=H.lineCap,D.lineJoin=H.lineJoin,D.stroke())},_onClick:function(D){for(var x=this._map.mouseEventToLayerPoint(D),H,Y,re=this._drawFirst;re;re=re.next)H=re.layer,H.options.interactive&&H._containsPoint(x)&&(!(D.type==="click"||D.type==="preclick")||!this._map._draggableMoved(H))&&(Y=H);this._fireEvent(Y?[Y]:!1,D)},_onMouseMove:function(D){if(!(!this._map||this._map.dragging.moving()||this._map._animatingZoom)){var x=this._map.mouseEventToLayerPoint(D);this._handleMouseHover(D,x)}},_handleMouseOut:function(D){var x=this._hoveredLayer;x&&(zr(this._container,"leaflet-interactive"),this._fireEvent([x],D,"mouseout"),this._hoveredLayer=null,this._mouseHoverThrottled=!1)},_handleMouseHover:function(D,x){if(!this._mouseHoverThrottled){for(var H,Y,re=this._drawFirst;re;re=re.next)H=re.layer,H.options.interactive&&H._containsPoint(x)&&(Y=H);Y!==this._hoveredLayer&&(this._handleMouseOut(D),Y&&(qi(this._container,"leaflet-interactive"),this._fireEvent([Y],D,"mouseover"),this._hoveredLayer=Y)),this._fireEvent(this._hoveredLayer?[this._hoveredLayer]:!1,D),this._mouseHoverThrottled=!0,setTimeout(s(function(){this._mouseHoverThrottled=!1},this),32)}},_fireEvent:function(D,x,H){this._map._fireDOMEvent(x,H||x.type,D)},_bringToFront:function(D){var x=D._order;if(x){var H=x.next,Y=x.prev;if(H)H.prev=Y;else return;Y?Y.next=H:H&&(this._drawFirst=H),x.prev=this._drawLast,this._drawLast.next=x,x.next=null,this._drawLast=x,this._requestRedraw(D)}},_bringToBack:function(D){var x=D._order;if(x){var H=x.next,Y=x.prev;if(Y)Y.next=H;else return;H?H.prev=Y:Y&&(this._drawLast=Y),x.prev=null,x.next=this._drawFirst,this._drawFirst.prev=x,this._drawFirst=x,this._requestRedraw(D)}}});function Ao(D){return Dt.canvas?new _n(D):null}var Es=function(){try{return document.namespaces.add("lvml","urn:schemas-microsoft-com:vml"),function(D){return document.createElement("<lvml:"+D+' class="lvml">')}}catch{}return function(D){return document.createElement("<"+D+' xmlns="urn:schemas-microsoft.com:vml" class="lvml">')}}(),f0={_initContainer:function(){this._container=Wt("div","leaflet-vml-container")},_update:function(){this._map._animatingZoom||(zs.prototype._update.call(this),this.fire("update"))},_initPath:function(D){var x=D._container=Es("shape");qi(x,"leaflet-vml-shape "+(this.options.className||"")),x.coordsize="1 1",D._path=Es("path"),x.appendChild(D._path),this._updateStyle(D),this._layers[l(D)]=D},_addPath:function(D){var x=D._container;this._container.appendChild(x),D.options.interactive&&D.addInteractiveTarget(x)},_removePath:function(D){var x=D._container;$i(x),D.removeInteractiveTarget(x),delete this._layers[l(D)]},_updateStyle:function(D){var x=D._stroke,H=D._fill,Y=D.options,re=D._container;re.stroked=!!Y.stroke,re.filled=!!Y.fill,Y.stroke?(x||(x=D._stroke=Es("stroke")),re.appendChild(x),x.weight=Y.weight+"px",x.color=Y.color,x.opacity=Y.opacity,Y.dashArray?x.dashStyle=b(Y.dashArray)?Y.dashArray.join(" "):Y.dashArray.replace(/( *, *)/g," "):x.dashStyle="",x.endcap=Y.lineCap.replace("butt","flat"),x.joinstyle=Y.lineJoin):x&&(re.removeChild(x),D._stroke=null),Y.fill?(H||(H=D._fill=Es("fill")),re.appendChild(H),H.color=Y.fillColor||Y.color,H.opacity=Y.fillOpacity):H&&(re.removeChild(H),D._fill=null)},_updateCircle:function(D){var x=D._point.round(),H=Math.round(D._radius),Y=Math.round(D._radiusY||H);this._setPath(D,D._empty()?"M0 0":"AL "+x.x+","+x.y+" "+H+","+Y+" 0,"+65535*360)},_setPath:function(D,x){D._path.v=x},_bringToFront:function(D){on(D._container)},_bringToBack:function(D){Yo(D._container)}},eo=Dt.vml?Es:le,dd=zs.extend({_initContainer:function(){this._container=eo("svg"),this._container.setAttribute("pointer-events","none"),this._rootGroup=eo("g"),this._container.appendChild(this._rootGroup)},_destroyContainer:function(){$i(this._container),cr(this._container),delete this._container,delete this._rootGroup,delete this._svgSize},_update:function(){if(!(this._map._animatingZoom&&this._bounds)){zs.prototype._update.call(this);var D=this._bounds,x=D.getSize(),H=this._container;(!this._svgSize||!this._svgSize.equals(x))&&(this._svgSize=x,H.setAttribute("width",x.x),H.setAttribute("height",x.y)),qr(H,D.min),H.setAttribute("viewBox",[D.min.x,D.min.y,x.x,x.y].join(" ")),this.fire("update")}},_initPath:function(D){var x=D._path=eo("path");D.options.className&&qi(x,D.options.className),D.options.interactive&&qi(x,"leaflet-interactive"),this._updateStyle(D),this._layers[l(D)]=D},_addPath:function(D){this._rootGroup||this._initContainer(),this._rootGroup.appendChild(D._path),D.addInteractiveTarget(D._path)},_removePath:function(D){$i(D._path),D.removeInteractiveTarget(D._path),delete this._layers[l(D)]},_updatePath:function(D){D._project(),D._update()},_updateStyle:function(D){var x=D._path,H=D.options;x&&(H.stroke?(x.setAttribute("stroke",H.color),x.setAttribute("stroke-opacity",H.opacity),x.setAttribute("stroke-width",H.weight),x.setAttribute("stroke-linecap",H.lineCap),x.setAttribute("stroke-linejoin",H.lineJoin),H.dashArray?x.setAttribute("stroke-dasharray",H.dashArray):x.removeAttribute("stroke-dasharray"),H.dashOffset?x.setAttribute("stroke-dashoffset",H.dashOffset):x.removeAttribute("stroke-dashoffset")):x.setAttribute("stroke","none"),H.fill?(x.setAttribute("fill",H.fillColor||H.color),x.setAttribute("fill-opacity",H.fillOpacity),x.setAttribute("fill-rule",H.fillRule||"evenodd")):x.setAttribute("fill","none"))},_updatePoly:function(D,x){this._setPath(D,ne(D._parts,x))},_updateCircle:function(D){var x=D._point,H=Math.max(Math.round(D._radius),1),Y=Math.max(Math.round(D._radiusY),1)||H,re="a"+H+","+Y+" 0 1,0 ",ge=D._empty()?"M0 0":"M"+(x.x-H)+","+x.y+re+H*2+",0 "+re+-H*2+",0 ";this._setPath(D,ge)},_setPath:function(D,x){D._path.setAttribute("d",x)},_bringToFront:function(D){on(D._path)},_bringToBack:function(D){Yo(D._path)}});Dt.vml&&dd.include(f0);function m0(D){return Dt.svg||Dt.vml?new dd(D):null}li.include({getRenderer:function(D){var x=D.options.renderer||this._getPaneRenderer(D.options.pane)||this.options.renderer||this._renderer;return x||(x=this._renderer=this._createRenderer()),this.hasLayer(x)||this.addLayer(x),x},_getPaneRenderer:function(D){if(D==="overlayPane"||D===void 0)return!1;var x=this._paneRenderers[D];return x===void 0&&(x=this._createRenderer({pane:D}),this._paneRenderers[D]=x),x},_createRenderer:function(D){return this.options.preferCanvas&&Ao(D)||m0(D)}});var DK=Rc.extend({initialize:function(D,x){Rc.prototype.initialize.call(this,this._boundsToLatLngs(D),x)},setBounds:function(D){return this.setLatLngs(this._boundsToLatLngs(D))},_boundsToLatLngs:function(D){return D=z(D),[D.getSouthWest(),D.getNorthWest(),D.getNorthEast(),D.getSouthEast()]}});function SRe(D,x){return new DK(D,x)}dd.create=eo,dd.pointsToPath=ne,G.geometryToLayer=q,G.coordsToLatLng=ae,G.coordsToLatLngs=ue,G.latLngToCoords=ve,G.latLngsToCoords=Te,G.getFeature=Pe,G.asFeature=Be,li.mergeOptions({boxZoom:!0});var EK=No.extend({initialize:function(D){this._map=D,this._container=D._container,this._pane=D._panes.overlayPane,this._resetStateTimeout=0,D.on("unload",this._destroy,this)},addHooks:function(){Bi(this._container,"mousedown",this._onMouseDown,this)},removeHooks:function(){cr(this._container,"mousedown",this._onMouseDown,this)},moved:function(){return this._moved},_destroy:function(){$i(this._pane),delete this._pane},_resetState:function(){this._resetStateTimeout=0,this._moved=!1},_clearDeferredResetState:function(){this._resetStateTimeout!==0&&(clearTimeout(this._resetStateTimeout),this._resetStateTimeout=0)},_onMouseDown:function(D){if(!D.shiftKey||D.which!==1&&D.button!==1)return!1;this._clearDeferredResetState(),this._resetState(),Mo(),Gl(),this._startPoint=this._map.mouseEventToContainerPoint(D),Bi(document,{contextmenu:fu,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseMove:function(D){this._moved||(this._moved=!0,this._box=Wt("div","leaflet-zoom-box",this._container),qi(this._container,"leaflet-crosshair"),this._map.fire("boxzoomstart")),this._point=this._map.mouseEventToContainerPoint(D);var x=new V(this._point,this._startPoint),H=x.getSize();qr(this._box,x.min),this._box.style.width=H.x+"px",this._box.style.height=H.y+"px"},_finish:function(){this._moved&&($i(this._box),zr(this._container,"leaflet-crosshair")),ln(),Bs(),cr(document,{contextmenu:fu,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseUp:function(D){if(!(D.which!==1&&D.button!==1)&&(this._finish(),!!this._moved)){this._clearDeferredResetState(),this._resetStateTimeout=setTimeout(s(this._resetState,this),0);var x=new B(this._map.containerPointToLatLng(this._startPoint),this._map.containerPointToLatLng(this._point));this._map.fitBounds(x).fire("boxzoomend",{boxZoomBounds:x})}},_onKeyDown:function(D){D.keyCode===27&&(this._finish(),this._clearDeferredResetState(),this._resetState())}});li.addInitHook("addHandler","boxZoom",EK),li.mergeOptions({doubleClickZoom:!0});var PK=No.extend({addHooks:function(){this._map.on("dblclick",this._onDoubleClick,this)},removeHooks:function(){this._map.off("dblclick",this._onDoubleClick,this)},_onDoubleClick:function(D){var x=this._map,H=x.getZoom(),Y=x.options.zoomDelta,re=D.originalEvent.shiftKey?H-Y:H+Y;x.options.doubleClickZoom==="center"?x.setZoom(re):x.setZoomAround(D.containerPoint,re)}});li.addInitHook("addHandler","doubleClickZoom",PK),li.mergeOptions({dragging:!0,inertia:!0,inertiaDeceleration:3400,inertiaMaxSpeed:1/0,easeLinearity:.2,worldCopyJump:!1,maxBoundsViscosity:0});var CK=No.extend({addHooks:function(){if(!this._draggable){var D=this._map;this._draggable=new is(D._mapPane,D._container),this._draggable.on({dragstart:this._onDragStart,drag:this._onDrag,dragend:this._onDragEnd},this),this._draggable.on("predrag",this._onPreDragLimit,this),D.options.worldCopyJump&&(this._draggable.on("predrag",this._onPreDragWrap,this),D.on("zoomend",this._onZoomEnd,this),D.whenReady(this._onZoomEnd,this))}qi(this._map._container,"leaflet-grab leaflet-touch-drag"),this._draggable.enable(),this._positions=[],this._times=[]},removeHooks:function(){zr(this._map._container,"leaflet-grab"),zr(this._map._container,"leaflet-touch-drag"),this._draggable.disable()},moved:function(){return this._draggable&&this._draggable._moved},moving:function(){return this._draggable&&this._draggable._moving},_onDragStart:function(){var D=this._map;if(D._stop(),this._map.options.maxBounds&&this._map.options.maxBoundsViscosity){var x=z(this._map.options.maxBounds);this._offsetLimit=j(this._map.latLngToContainerPoint(x.getNorthWest()).multiplyBy(-1),this._map.latLngToContainerPoint(x.getSouthEast()).multiplyBy(-1).add(this._map.getSize())),this._viscosity=Math.min(1,Math.max(0,this._map.options.maxBoundsViscosity))}else this._offsetLimit=null;D.fire("movestart").fire("dragstart"),D.options.inertia&&(this._positions=[],this._times=[])},_onDrag:function(D){if(this._map.options.inertia){var x=this._lastTime=+new Date,H=this._lastPos=this._draggable._absPos||this._draggable._newPos;this._positions.push(H),this._times.push(x),this._prunePositions(x)}this._map.fire("move",D).fire("drag",D)},_prunePositions:function(D){for(;this._positions.length>1&&D-this._times[0]>50;)this._positions.shift(),this._times.shift()},_onZoomEnd:function(){var D=this._map.getSize().divideBy(2),x=this._map.latLngToLayerPoint([0,0]);this._initialWorldOffset=x.subtract(D).x,this._worldWidth=this._map.getPixelWorldBounds().getSize().x},_viscousLimit:function(D,x){return D-(D-x)*this._viscosity},_onPreDragLimit:function(){if(!(!this._viscosity||!this._offsetLimit)){var D=this._draggable._newPos.subtract(this._draggable._startPos),x=this._offsetLimit;D.x<x.min.x&&(D.x=this._viscousLimit(D.x,x.min.x)),D.y<x.min.y&&(D.y=this._viscousLimit(D.y,x.min.y)),D.x>x.max.x&&(D.x=this._viscousLimit(D.x,x.max.x)),D.y>x.max.y&&(D.y=this._viscousLimit(D.y,x.max.y)),this._draggable._newPos=this._draggable._startPos.add(D)}},_onPreDragWrap:function(){var D=this._worldWidth,x=Math.round(D/2),H=this._initialWorldOffset,Y=this._draggable._newPos.x,re=(Y-x+H)%D+x-H,ge=(Y+x+H)%D-x-H,Ne=Math.abs(re+H)<Math.abs(ge+H)?re:ge;this._draggable._absPos=this._draggable._newPos.clone(),this._draggable._newPos.x=Ne},_onDragEnd:function(D){var x=this._map,H=x.options,Y=!H.inertia||D.noInertia||this._times.length<2;if(x.fire("dragend",D),Y)x.fire("moveend");else{this._prunePositions(+new Date);var re=this._lastPos.subtract(this._positions[0]),ge=(this._lastTime-this._times[0])/1e3,Ne=H.easeLinearity,Ze=re.multiplyBy(Ne/ge),st=Ze.distanceTo([0,0]),Pt=Math.min(H.inertiaMaxSpeed,st),ci=Ze.multiplyBy(Pt/st),rn=Pt/(H.inertiaDeceleration*Ne),ir=ci.multiplyBy(-rn/2).round();!ir.x&&!ir.y?x.fire("moveend"):(ir=x._limitOffset(ir,x.options.maxBounds),R(function(){x.panBy(ir,{duration:rn,easeLinearity:Ne,noMoveStart:!0,animate:!0})}))}}});li.addInitHook("addHandler","dragging",CK),li.mergeOptions({keyboard:!0,keyboardPanDelta:80});var RK=No.extend({keyCodes:{left:[37],right:[39],down:[40],up:[38],zoomIn:[187,107,61,171],zoomOut:[189,109,54,173]},initialize:function(D){this._map=D,this._setPanDelta(D.options.keyboardPanDelta),this._setZoomDelta(D.options.zoomDelta)},addHooks:function(){var D=this._map._container;D.tabIndex<=0&&(D.tabIndex="0"),Bi(D,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.on({focus:this._addHooks,blur:this._removeHooks},this)},removeHooks:function(){this._removeHooks(),cr(this._map._container,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.off({focus:this._addHooks,blur:this._removeHooks},this)},_onMouseDown:function(){if(!this._focused){var D=document.body,x=document.documentElement,H=D.scrollTop||x.scrollTop,Y=D.scrollLeft||x.scrollLeft;this._map._container.focus(),window.scrollTo(Y,H)}},_onFocus:function(){this._focused=!0,this._map.fire("focus")},_onBlur:function(){this._focused=!1,this._map.fire("blur")},_setPanDelta:function(D){var x=this._panKeys={},H=this.keyCodes,Y,re;for(Y=0,re=H.left.length;Y<re;Y++)x[H.left[Y]]=[-1*D,0];for(Y=0,re=H.right.length;Y<re;Y++)x[H.right[Y]]=[D,0];for(Y=0,re=H.down.length;Y<re;Y++)x[H.down[Y]]=[0,D];for(Y=0,re=H.up.length;Y<re;Y++)x[H.up[Y]]=[0,-1*D]},_setZoomDelta:function(D){var x=this._zoomKeys={},H=this.keyCodes,Y,re;for(Y=0,re=H.zoomIn.length;Y<re;Y++)x[H.zoomIn[Y]]=D;for(Y=0,re=H.zoomOut.length;Y<re;Y++)x[H.zoomOut[Y]]=-D},_addHooks:function(){Bi(document,"keydown",this._onKeyDown,this)},_removeHooks:function(){cr(document,"keydown",this._onKeyDown,this)},_onKeyDown:function(D){if(!(D.altKey||D.ctrlKey||D.metaKey)){var x=D.keyCode,H=this._map,Y;if(x in this._panKeys){if(!H._panAnim||!H._panAnim._inProgress)if(Y=this._panKeys[x],D.shiftKey&&(Y=F(Y).multiplyBy(3)),H.options.maxBounds&&(Y=H._limitOffset(F(Y),H.options.maxBounds)),H.options.worldCopyJump){var re=H.wrapLatLng(H.unproject(H.project(H.getCenter()).add(Y)));H.panTo(re)}else H.panBy(Y)}else if(x in this._zoomKeys)H.setZoom(H.getZoom()+(D.shiftKey?3:1)*this._zoomKeys[x]);else if(x===27&&H._popup&&H._popup.options.closeOnEscapeKey)H.closePopup();else return;fu(D)}}});li.addInitHook("addHandler","keyboard",RK),li.mergeOptions({scrollWheelZoom:!0,wheelDebounceTime:40,wheelPxPerZoomLevel:60});var MK=No.extend({addHooks:function(){Bi(this._map._container,"wheel",this._onWheelScroll,this),this._delta=0},removeHooks:function(){cr(this._map._container,"wheel",this._onWheelScroll,this)},_onWheelScroll:function(D){var x=ft(D),H=this._map.options.wheelDebounceTime;this._delta+=x,this._lastMousePos=this._map.mouseEventToContainerPoint(D),this._startTime||(this._startTime=+new Date);var Y=Math.max(H-(+new Date-this._startTime),0);clearTimeout(this._timer),this._timer=setTimeout(s(this._performZoom,this),Y),fu(D)},_performZoom:function(){var D=this._map,x=D.getZoom(),H=this._map.options.zoomSnap||0;D._stop();var Y=this._delta/(this._map.options.wheelPxPerZoomLevel*4),re=4*Math.log(2/(1+Math.exp(-Math.abs(Y))))/Math.LN2,ge=H?Math.ceil(re/H)*H:re,Ne=D._limitZoom(x+(this._delta>0?ge:-ge))-x;this._delta=0,this._startTime=null,Ne&&(D.options.scrollWheelZoom==="center"?D.setZoom(x+Ne):D.setZoomAround(this._lastMousePos,x+Ne))}});li.addInitHook("addHandler","scrollWheelZoom",MK);var TRe=600;li.mergeOptions({tapHold:Dt.touchNative&&Dt.safari&&Dt.mobile,tapTolerance:15});var NK=No.extend({addHooks:function(){Bi(this._map._container,"touchstart",this._onDown,this)},removeHooks:function(){cr(this._map._container,"touchstart",this._onDown,this)},_onDown:function(D){if(clearTimeout(this._holdTimeout),D.touches.length===1){var x=D.touches[0];this._startPos=this._newPos=new O(x.clientX,x.clientY),this._holdTimeout=setTimeout(s(function(){this._cancel(),this._isTapValid()&&(Bi(document,"touchend",_a),Bi(document,"touchend touchcancel",this._cancelClickPrevent),this._simulateEvent("contextmenu",x))},this),TRe),Bi(document,"touchend touchcancel contextmenu",this._cancel,this),Bi(document,"touchmove",this._onMove,this)}},_cancelClickPrevent:function D(){cr(document,"touchend",_a),cr(document,"touchend touchcancel",D)},_cancel:function(){clearTimeout(this._holdTimeout),cr(document,"touchend touchcancel contextmenu",this._cancel,this),cr(document,"touchmove",this._onMove,this)},_onMove:function(D){var x=D.touches[0];this._newPos=new O(x.clientX,x.clientY)},_isTapValid:function(){return this._newPos.distanceTo(this._startPos)<=this._map.options.tapTolerance},_simulateEvent:function(D,x){var H=new MouseEvent(D,{bubbles:!0,cancelable:!0,view:window,screenX:x.screenX,screenY:x.screenY,clientX:x.clientX,clientY:x.clientY});H._simulated=!0,x.target.dispatchEvent(H)}});li.addInitHook("addHandler","tapHold",NK),li.mergeOptions({touchZoom:Dt.touch,bounceAtZoomLimits:!0});var AK=No.extend({addHooks:function(){qi(this._map._container,"leaflet-touch-zoom"),Bi(this._map._container,"touchstart",this._onTouchStart,this)},removeHooks:function(){zr(this._map._container,"leaflet-touch-zoom"),cr(this._map._container,"touchstart",this._onTouchStart,this)},_onTouchStart:function(D){var x=this._map;if(!(!D.touches||D.touches.length!==2||x._animatingZoom||this._zooming)){var H=x.mouseEventToContainerPoint(D.touches[0]),Y=x.mouseEventToContainerPoint(D.touches[1]);this._centerPoint=x.getSize()._divideBy(2),this._startLatLng=x.containerPointToLatLng(this._centerPoint),x.options.touchZoom!=="center"&&(this._pinchStartLatLng=x.containerPointToLatLng(H.add(Y)._divideBy(2))),this._startDist=H.distanceTo(Y),this._startZoom=x.getZoom(),this._moved=!1,this._zooming=!0,x._stop(),Bi(document,"touchmove",this._onTouchMove,this),Bi(document,"touchend touchcancel",this._onTouchEnd,this),_a(D)}},_onTouchMove:function(D){if(!(!D.touches||D.touches.length!==2||!this._zooming)){var x=this._map,H=x.mouseEventToContainerPoint(D.touches[0]),Y=x.mouseEventToContainerPoint(D.touches[1]),re=H.distanceTo(Y)/this._startDist;if(this._zoom=x.getScaleZoom(re,this._startZoom),!x.options.bounceAtZoomLimits&&(this._zoom<x.getMinZoom()&&re<1||this._zoom>x.getMaxZoom()&&re>1)&&(this._zoom=x._limitZoom(this._zoom)),x.options.touchZoom==="center"){if(this._center=this._startLatLng,re===1)return}else{var ge=H._add(Y)._divideBy(2)._subtract(this._centerPoint);if(re===1&&ge.x===0&&ge.y===0)return;this._center=x.unproject(x.project(this._pinchStartLatLng,this._zoom).subtract(ge),this._zoom)}this._moved||(x._moveStart(!0,!1),this._moved=!0),C(this._animRequest);var Ne=s(x._move,x,this._center,this._zoom,{pinch:!0,round:!1},void 0);this._animRequest=R(Ne,this,!0),_a(D)}},_onTouchEnd:function(){if(!this._moved||!this._zooming){this._zooming=!1;return}this._zooming=!1,C(this._animRequest),cr(document,"touchmove",this._onTouchMove,this),cr(document,"touchend touchcancel",this._onTouchEnd,this),this._map.options.zoomAnimation?this._map._animateZoom(this._center,this._map._limitZoom(this._zoom),!0,this._map.options.zoomSnap):this._map._resetView(this._center,this._map._limitZoom(this._zoom))}});li.addInitHook("addHandler","touchZoom",AK),li.BoxZoom=EK,li.DoubleClickZoom=PK,li.Drag=CK,li.Keyboard=RK,li.ScrollWheelZoom=MK,li.TapHold=NK,li.TouchZoom=AK,i.Bounds=V,i.Browser=Dt,i.CRS=K,i.Canvas=_n,i.Circle=h0,i.CircleMarker=p0,i.Class=_,i.Control=Un,i.DivIcon=jt,i.DivOverlay=it,i.DomEvent=bi,i.DomUtil=vl,i.Draggable=is,i.Evented=k,i.FeatureGroup=Zd,i.GeoJSON=G,i.GridLayer=qt,i.Handler=No,i.Icon=pv,i.ImageOverlay=qe,i.LatLng=W,i.LatLngBounds=B,i.Layer=gu,i.LayerGroup=gf,i.LineUtil=I1,i.Map=li,i.Marker=Sa,i.Mixin=m1,i.Path=Hs,i.Point=O,i.PolyUtil=s0,i.Polygon=Rc,i.Polyline=ud,i.Popup=rt,i.PosAnimation=Wn,i.Projection=o$,i.Rectangle=DK,i.Renderer=zs,i.SVG=dd,i.SVGOverlay=je,i.TileLayer=en,i.Tooltip=kt,i.Transformation=ie,i.Util=M,i.VideoOverlay=He,i.bind=s,i.bounds=j,i.canvas=Ao,i.circle=$m,i.circleMarker=T1,i.control=wa,i.divIcon=Yt,i.extend=r,i.featureGroup=c$,i.geoJSON=We,i.geoJson=xe,i.gridLayer=Lt,i.icon=u$,i.imageOverlay=Ve,i.latLng=Z,i.latLngBounds=z,i.layerGroup=OM,i.map=Qa,i.marker=d0,i.point=F,i.polygon=LM,i.polyline=hv,i.popup=vt,i.rectangle=SRe,i.setOptions=m,i.stamp=l,i.svg=m0,i.svgOverlay=tt,i.tileLayer=In,i.tooltip=Xt,i.transformation=ce,i.version=n,i.videoOverlay=Ye;var URe=window.L;i.noConflict=function(){return window.L=URe,this},window.L=i})})(EH,EH.exports);var EA=EH.exports;function wct(){try{return navigator||window.navigator}catch{return}}function Sct({coords:t,callback:e}){let i=16;(!(t!=null&&t.latitude)||!(t!=null&&t.longitude))&&(t={latitude:0,longitude:0},i=2);let n={map:"latLongMap",link:"latLonglink"},a=`
         <div style='min-height: 150px'>
         <h2 class='tmx-title'>Enter map URL</h2>
         <div class='flexcenter'>${Cs.tr("phrases.addgooglemap")}</div>
         <div class='flexcenter flexcol'>
            <input id='${n.link}' value='' style='text-align: center; width: 25em; margin: 1em;'>
            <div class='flexrow' style='margin-top: 1em; margin-bottom: 1em;'>
            </div>
         </div>
         <div class='location_detail_body' style='min-width: 350px; min-height: 350px;'>
            <div id='${n.map}' class='location_map' style='width: 100%; height: 100%; min-width: 350px; min-height: 350px;'>
         </div>
      `;const l=[{label:"Cancel",intent:"none",close:!0},{onClick:m,intent:"is-warning",label:"Clear"},{onClick:()=>{!t.latitude||!t.longitude?c():m(t)},intent:"is-primary",label:"View",close:!1},{onClick:()=>{(!t.latitude||!t.longitude)&&c(),Ot(e)&&e(t)},intent:"is-info",label:"Submit",close:!0}],c=()=>{const g=d.link.element.value,v=yct(g)||bct(g)||vct(g)||Ict(g);v.latitude?m(v):g&&v.latitude===void 0&&Jt({message:"Invalid URL"})},u=g=>{g.which===13&&c()};er({content:a,buttons:l});const d=zDe(n);let{map:p,marker:h}=Tct({successElement:d.map.element,mapElementId:d.map.id,coords:t,zoom:i});d.link.element.value="",d.link.element.focus(),d.link.element.addEventListener("keyup",u),p&&(p.on("click",g=>f({latitude:g.latlng.lat,longitude:g.latlng.lng})),p.on("contextmenu",g=>console.log("Coordinates: "+g.latlng.toString())));function f({latitude:g,longitude:v}){t={latitude:g,longitude:v};let y=new EA.LatLng(g,v);h.setLatLng(y)}function m({latitude:g=0,longitude:v=0}={}){if(g&&v)return t={latitude:+g,longitude:+v},p.setView([+g,+v],16),!0;t={latitude:0,longitude:0},p.fitWorld()}}function Tct({successElement:t,mapElementId:e,coords:i,zoom:n}){let r=wct();if(!(r!=null&&r.onLine))return{};if(n=n===void 0?16:n,i.latitude!==void 0&&i.longitude!==void 0)return t&&(t.style.display="inline"),a(i.latitude,i.longitude,n);return{};function a(s,o,l){if(isNaN(s)||isNaN(o))return{};let c=Zi.locations.map_view||"map",u=EA.tileLayer(Zi.leaflet[c].tileLayer,{attribution:Zi.leaflet[c].attribution,maxZoom:Zi.leaflet[c].maxZoom??16}),d=EA.map(e).fitWorld().addLayer(u);(s||o)&&d.setView([+s,+o],l);let p=EA.marker([+s,+o]).addTo(d);return setTimeout(function(){d.invalidateSize()},300),{map:d,marker:p}}}function Uct(t,e){const i=e.getRow().getData(),{latitude:n,longitude:r}=(i==null?void 0:i.address)||{};Sct({coords:{latitude:n,longitude:r},callback:(s={})=>{i.address||(i.address={});const o=i.venue;o.addresses||(o.addresses=[]),o.addresses.length?Object.assign(o.addresses[0],{latitude:s.latitude,longitude:s.longitude}):o.addresses.push({latitude:s.latitude,longitude:s.longitude});const l=u=>{var d,p;if((p=(d=u.results)==null?void 0:d[0])!=null&&p.success){const h=e.getTable();i.address.latitude=s.latitude,i.address.longitude=s.longitude,i.hasLocation=s.latitude&&s.longitude,h.updateData([i])}},c=[{method:FZe,params:{venueId:i.venueId,modifications:{addresses:o.addresses}}}];ii({methods:c,callback:l})}})}function Dct(){const t=()=>console.log("Venue actions"),e=i=>i.getValue()?'<i class="fa-sharp fa-solid fa-location-dot" style="color: blue"></i>':"?";return[{cellClick:(i,n)=>n.getRow().toggleSelect(),titleFormatter:"rowSelection",formatter:"rowSelection",headerSort:!1,responsive:!1,hozAlign:pi,width:5},{headerMenu:xm({scheduledMatchUpsCount:"Scheduled matches",availableTime:"Time Available",courtsCount:"Number of courts",hasLocation:"Location"}),formatter:"rownum",headerSort:!1,hozAlign:mi,width:55},{cellClick:rI,field:"venueAbbreviation",title:"Abbr",visible:!0,width:120},{cellClick:rI,field:"venueName",title:"Venue",visible:!0,minWidth:200,widthGrow:3},{title:'<div class="event_icon surface_header"></div>',headerTooltip:"Number of courts",headerHozAlign:mi,field:"courtsCount",hozAlign:mi,headerSort:!0,visible:!0,width:50},{title:"Scheduled",headerTooltip:"Scheduled matches",field:"scheduledMatchUpsCount",headerHozAlign:mi,headerSort:!0,hozAlign:mi,visible:!0,minWidth:120},{title:"Time",headerHozAlign:mi,field:"availableTime",headerSort:!0,hozAlign:mi,visible:!0,minWidth:120},{title:'<i class="fa-sharp fa-solid fa-location-dot"></i>',formatter:e,headerTooltip:"Location",headerHozAlign:mi,cellClick:Uct,field:"hasLocation",headerSort:!1,hozAlign:mi,visible:!0,width:50},{cellClick:rI,formatter:MY,responsive:!1,headerSort:!1,hozAlign:oi,field:"isOpen",width:20},{cellClick:t,formatter:av,responsive:!1,headerSort:!1,hozAlign:oi,width:50}]}function Ect({table:t}={}){const e=()=>{const{venues:r}=Xf.getVenuesAndCourts();return{rows:r.map(QEe)}},i=()=>{const{rows:r}=e();t==null||t.replaceData(r)},n=Dct();if(t)i();else{km({anchorId:y_});const r=document.getElementById(y_),{rows:a}=e();t=new As(r,{headerSortElement:rf(["scheduledMatchUpsCount","venueAbbreviation","availableTime","courtsCount","venueName"]),minHeight:window.innerHeight*.81,rowFormatter:gct,placeholder:"No venues",layout:"fitColumns",reactiveData:!0,index:"venueId",columns:n,data:a}),t.on("scrollVertical",wd),t.on("cellEdited",s=>{const o=s.getColumn().getDefinition(),l=s.getRow().getData(),c=s.getValue();console.log({cell:s,row:l,value:c,def:o})})}return{table:t,replaceTableData:i}}function Pct({table:t,updateVenueRow:e,controlAnchor:i}={}){return i?Io({table:t,target:i,items:[{onClick:()=>{const a=t.getSelectedData().map(({venueId:l})=>l);ii({methods:[{method:kZe,params:{venueIds:a,force:!0}}],callback:l=>l.success&&t.deleteRow(a)})},label:"Delete selected",intent:"is-danger",stateChange:!0,location:fa},{label:"Add venue",onClick:()=>MEe(e),location:oi,id:"addVenue",intent:"none"}]}).elements:void 0}function Cct(){const t=document.getElementById(d5),{table:e}=Ect();Pct({table:e,controlAnchor:t,updateVenueRow:({venue:n})=>{e.updateOrAddData([QEe(n)])}})}const{POLICY_TYPE_AVOIDANCE:ute}=ky;function ePe({eventId:t,drawId:e}){var i,n,r;return(r=(n=(i=ot.getPolicyDefinitions({policyTypes:[ute],eventId:t,drawId:e}))==null?void 0:i.policyDefinitions)==null?void 0:n[ute])==null?void 0:r.policyAttributes}const PH={city:[{key:"person.addresses.city"},{key:"individualParticipants.person.addresses.city"}],state:[{key:"person.addresses.state"},{key:"individualParticipants.person.addresses.state"}],postal:[{key:"person.addresses.postalCode",significantCharacters:5},{key:"individualParticipants.person.addresses.postalCode",significantCharacters:5}],iso:[{key:"person.addresses.country"},{key:"individualParticipants.person.addresses.country"}],groups:[{directive:"groupParticipants"}],pairs:[{directive:"pairParticipants"}],teams:[{directive:"teamParticipants"}]};function Rct({event:t}){const e=ePe({eventId:t.eventId}),i=(e==null?void 0:e.map(r=>Object.keys(PH).find(a=>PH[a].some(o=>o.directive&&o.directive===r.directive||o.key&&o.key===r.key))).filter(Boolean))??[];return{items:[{text:"Select rules"},{checked:i.includes("pairs"),label:"Doubles pairs",id:"avoidancePairs",checkbox:!0,field:"pairs"},{checked:i.includes("groups"),id:"avoidanceGroups",checkbox:!0,label:"Groups",field:"groups"},{checked:i.includes("teams"),id:"avoidanceTeams",checkbox:!0,label:"Teams",field:"teams"},{checked:i.includes("iso"),id:"avoidanceCountry",label:"Country",checkbox:!0,field:"iso"},{checked:i==null?void 0:i.includes("city"),id:"avoidancedCity",checkbox:!0,label:"City",field:"city"},{checked:i.includes("state"),id:"avoidancedState",checkbox:!0,label:"State",field:"state"},{checked:i.includes("zip"),id:"avoidancedPostal",label:"Postal code",checkbox:!0,field:"zip"},{label:"Postal code digits",visible:!1,field:"zip"}]}}function tPe({eventId:t}){const e=ot.getEvent({eventId:t}).event;if(!e)return;const{items:i}=Rct({event:e});let n;const r=!0,a=u=>n=Sr(u,i),o=[{label:"Cancel",intent:xt,close:!0},{label:"Save",id:"setAvoidances",intent:"is-info",onClick:()=>{const d=Object.keys(n).filter(f=>n[f].checked).flatMap(f=>PH[f]).filter(Boolean);ii({methods:[{method:RZe,params:{policyDefinitions:{avoidance:{policyAttributes:d}},allowReplacement:!0,eventId:t}}],callback:f=>{if(f.success){const m="is-success",g=document.getElementById("editAvoidances");g&&(d.length?g.classList.add(m):g.classList.remove(m))}else Jt({message:"Error",intent:"is-danger"})}})},close:r}],l="Set avoidances",c=(u,d)=>qw(u,o,d);It.drawer.open({title:l,content:a,footer:c,side:oi,width:"300px"})}const{WTN:Mct,UTR:Nct}=Uo.ratingConstants,{TEAM:Act}=Uo.eventConstants,{QUALIFYING:dte}=Qr;function j2({entry:t,derivedDrawInfo:e,participants:i,participant:n,eventType:r,categoryName:a,eventId:s}){var y,b,I,T,w,S,U,P,E,R,C,M,_,A,N;n=n||(i==null?void 0:i.find(k=>k.participantId===t.participantId));const o=((y=n==null?void 0:n.draws)==null?void 0:y.filter(k=>k.eventId===s).map(k=>({...k,drawName:e[k.drawId].drawName})))??[],l=(I=(b=n==null?void 0:n.person)==null?void 0:b.addresses)==null?void 0:I[0],c=l?`${l.city}, ${l.state}`:void 0,u=r===Act?"AVERAGE":r,d=(S=(w=(T=n==null?void 0:n.ratings)==null?void 0:T[u])==null?void 0:w.find(k=>k.scaleName===Mct))==null?void 0:S.scaleValue,p=(E=(P=(U=n==null?void 0:n.ratings)==null?void 0:U[u])==null?void 0:P.find(k=>k.scaleName===Nct))==null?void 0:E.scaleValue,h={wtn:d,utr:p},f=(M=(C=(R=n==null?void 0:n.rankings)==null?void 0:R[r])==null?void 0:C.find(k=>k.scaleName===a))==null?void 0:M.scaleValue,m=t.entryStage===dte?`${s}${dte}`:s,g=(N=(A=(_=n==null?void 0:n.seedings)==null?void 0:_[r])==null?void 0:A.find(k=>k.scaleName===m))==null?void 0:N.scaleValue,v=_fe[t.entryStatus];return{searchText:n==null?void 0:n.participantName.toLowerCase(),participant:n,seedNumber:g,cityState:c,...t,ranking:f,ratings:h,flights:o,status:v}}function uh(t){return _i.isConvertableInteger(t)&&parseInt(t)>=0}const iPe=(t,e)=>i=>uh(i)&&i>=t&&i<=e,{ORGANISER_ACCEPTANCE:_ct,DIRECT_ACCEPTANCE:kct,SPECIAL_EXEMPT:xct,JUNIOR_EXEMPT:Oct,WILDCARD:Lct}=nd,{MAIN:Fct}=Qr,Ak=(t=Fct)=>[`${t}.${kct}`,`${t}.${_ct}`,`${t}.${xct}`,`${t}.${Oct}`,`${t}.${Lct}`],{MAIN:pte}=Qr;function CH(t,e=pte){return t.entries.filter(({entryStage:i=pte,entryStatus:n})=>Ak(e).includes(`${i}.${n}`)).length}const{FEED_IN:$ct,LUCKY_DRAW:Bct,MAIN:Vct,QUALIFYING:jct,ROUND_ROBIN:hte,ROUND_ROBIN_WITH_PLAYOFF:mN}=Qr;function Gct({event:t,isQualifying:e,maxQualifiers:i}){const n=e?jct:Vct,r=({fields:p,inputs:h})=>{var T;const f=h[Ev].value||0,m=uh(f)?parseInt(f):0,g=CH(t,n),v=h.qualifiersCount.value||0,y=uh(v)?parseInt(v):0,b=i||e&&m<g||m<g+y;b&&(h[_c].value=Q4);const I=(T=Cg(p[_c],"help"))==null?void 0:T[0];I.style.display=b?"":xt;for(const w of h[_c].options)w.label===_c&&(w.disabled=b)},a=({drawType:p,fields:h,inputs:f})=>{const m=i?f[Ev].value:CH(t,n),g=f.qualifiersCount.value||1,v=uh(g)&&parseInt(g)||i?1:0,y=e&&!i?m:parseInt(m)+v,b=(i||[Bct,$ct,hte,mN].includes(p))&&y||_i.nextPowerOf2(y);return f[Ev].value=b,r({fields:h,inputs:f}),b},s=({fields:p,inputs:h})=>{let f=parseInt(h[Ev].value);const m=h.qualifiersCount.value;uh(m)&&parseInt(m)<1&&(h.qualifiersCount.value=i?1:0);const g=document.getElementById("generateDraw");let v=h.qualifiersCount.value;if(g.disabled=!1,i&&uh(v)&&parseInt(v)>i)h.qualifiersCount.value=i;else if(!i){const y=h[vh].value;f=a({drawType:y,fields:p,inputs:h})}v=h.qualifiersCount.value,g&&(!uh(v)||f<=parseInt(v))&&(g.disabled=!0)},o=({e:p,fields:h,inputs:f})=>{const m=f[pD].value,g=p.target.value;i||a({drawType:g,fields:h,inputs:f}),r({fields:h,inputs:f}),h[F0].style.display=g===mN&&m===hD?"":xt,h[pD].style.display=g===mN?"":xt;const v=[hte,mN].includes(g);h[Ef].style.display=v?"":xt},l=({fields:p,inputs:h})=>{const f=document.getElementById("generateDraw"),m=h[Ev].value||0,g=iPe(2,128)(m);f.disabled=!g;const v=uh(m)?parseInt(m):0,{validGroupSizes:y}=ot.getValidGroupSizes({drawSize:v,groupSizeLimit:8}),b=y.map(w=>({label:w,value:w})),I=h[Ef],T=y.includes(v)?4:y[0];Ys(I),R5(I,{options:b,value:T}),r({fields:p,inputs:h})},c=({e:p,fields:h})=>{const f=p.target.value;h[F0].style.display=f===hD?"":xt,h[T_].style.display=f===hD?"":xt},u=({inputs:p})=>{const h=parseInt(p[Ef].value),f=p[F0].options,m=Array.from(f).map(v=>parseInt(v.value)),g=Math.max(...m);g>h?_i.generateRange(h+1,g+1).reverse().forEach(v=>{p[F0].remove(v-2)}):g<h&&_i.generateRange(g+1,h+1).forEach(v=>p[F0].add(new Option(v,v)))},d=({inputs:p,name:h})=>{const f=p[h].value,m=document.getElementById("generateDraw"),g=Wr(4)(f);m.disabled=!g};return[{onInput:({inputs:p})=>d({inputs:p,name:vI}),control:vI},{onInput:({inputs:p})=>d({inputs:p,name:EE}),control:EE},{onChange:u,control:Ef},{onChange:o,control:vh},{onChange:c,control:pD},{onInput:l,control:Ev},{onInput:s,control:S_}]}const{AD_HOC:Hct,COMPASS:zct,CURTIS:qct,DOUBLE_ELIMINATION:Wct,FEED_IN_CHAMPIONSHIP:Yct,FEED_IN:Kct,FIRST_MATCH_LOSER_CONSOLATION:Zct,FIRST_ROUND_LOSER_CONSOLATION:Xct,LUCKY_DRAW:Jct,OLYMPIC:Qct,PLAY_OFF:eut,ROUND_ROBIN:tut,ROUND_ROBIN_WITH_PLAYOFF:iut,SINGLE_ELIMINATION:nut}=Qr;function nPe({isPlayoff:t,isQualifying:e}={}){return[{label:"Ad-hoc",value:Hct,hide:e},{label:"Compass",value:zct,hide:e},{label:"Curtis consolation",value:qct,hide:e},{label:"Double elimination",value:Wct,hide:t||e},{label:"Elimination: fed consolation",value:Yct,hide:e},{label:"First match loser consolation",value:Zct,hide:e},{label:"First round loser consolation",value:Xct,hide:e},{label:"Lucky",value:Jct,hide:t||e},{label:"Olympic",value:Qct,hide:e},{label:"Playoff",value:eut,hide:e},{label:"Round robin w/ playoff",value:iut,hide:t||e},{label:"Round robin",value:tut},{label:"Single elimination",value:nut},{label:"Staggered Entry",value:Kct,hide:t||e}]}const{POLICY_TYPE_SCORING:rut}=ky,{MAIN:aut}=Qr,sut={[rut]:{requireAllPositionsAssigned:!1,stage:{[aut]:{stageSequence:{1:{requireAllPositionsAssigned:!0}}}},defaultMatchUpFormat:"SET3-S:6/TB7",matchUpFormats:[{categoryNames:[],categoryTypes:[],description:"Best of 3 sets with 7-point tiebreak at 6-6",matchUpFormat:"SET3-S:6/TB7"},{description:"Two tiebreak sets, 7-point match tiebreak at one set all",matchUpFormat:"SET3-S:6/TB7-F:TB7"},{description:"Two tiebreak sets, 10-point match tiebreak at one set all",matchUpFormat:"SET3-S:6/TB7-F:TB10"},{description:"One set set to 6, 7-point tiebreak at 6-6",matchUpFormat:"SET1-S:6/TB7"},{description:"Best of 3 sets to 4",matchUpFormat:"SET3-S:4/TB7"},{description:"Two out of three sets to 4 with 5-point tiebreak at 3-3",matchUpFormat:"SET3-S:4/TB5@3"},{description:"One set to 4, 7-point tiebreak at 4-4",matchUpFormat:"SET1-S:4/TB7"},{description:"One set to 4, 5-point tiebreak at 3-3",matchUpFormat:"SET1-S:4/TB5@3"},{description:"Two sets to 4, 10-point match tiebreak at one set all",matchUpFormat:"SET3-S:4/TB7-F:TB10"},{description:"Two sets to 4, 7-point match tiebreak at one set all",matchUpFormat:"SET3-S:4/TB7-F:TB7"},{description:"One set to 5, tiebreak to 9 at 4-4",matchUpFormat:"SET1-S:5/TB9@4"},{description:"One set to 6 with deciding game at 5-5",matchUpFormat:"SET1-S:6NOAD"},{description:"One set to 4, deciding game is played at 3-3",matchUpFormat:"SET1-S:4NOAD"},{description:"8 game pro-set with 7 point tiebreak at 8-8",matchUpFormat:"SET1-S:8/TB7"},{description:"8 game pro-set with 7 point tiebreak at 7-7",matchUpFormat:"SET1-S:8/TB7@7"},{description:"Best of 3 10-point tiebreak games",matchUpFormat:"SET3-S:TB10"},{description:"Timed 20 minute game - game based",matchUpFormat:"SET1-S:T20G"},{description:"Timed 20 minute game - point based",matchUpFormat:"SET1-S:T20P"},{description:"Aggregate Points - Four 10 minute quarters",matchUpFormat:"SET4-S:T10P"}]}},{ROUND_ROBIN:out,ROUND_ROBIN_WITH_PLAYOFF:fte,SINGLE_ELIMINATION:lut,QUALIFYING:cut,MAIN:mte}=Qr,{DOMINANT_DUO:uut,COLLEGE_DEFAULT:dut,LAVER_CUP:put}=Uo.tieFormatConstants,{POLICY_TYPE_SCORING:hut}=ky,{TEAM:gte}=pl,{ENTRY_PROFILE:fut}=Uo.extensionConstants;function mut({event:t,drawId:e,isQualifying:i,structureId:n}){var w,S,U,P,E,R;const r=i?cut:mte,a=((w=t.drawDefinitions)==null?void 0:w.length)||0;let s=lut;const o=e&&((S=t.drawDefinitions)==null?void 0:S.find(C=>C.drawId===e)),l=n&&((U=ot.getPositionAssignments({drawId:e,structureId:n}))==null?void 0:U.positionAssignments),c=(E=(P=ot.findExtension({element:o,name:fut}))==null?void 0:P.extension)==null?void 0:E.value,u=n?1:0,d=!n&&((R=c==null?void 0:c[mte])==null?void 0:R.qualifiersCount)||u,p="Qualifying",h=(l==null?void 0:l.length)||_i.nextPowerOf2(CH(t,r)),f=[{label:"Custom",value:w_}].concat(sut[hut].matchUpFormats.map(({matchUpFormat:C,description:M})=>({selected:C==="SET3-S:6/TB7",value:C,label:M}))),m=[{label:"Dominant Duo",value:uut,selected:!0},{label:"College Default",value:dut},{label:"Laver Cup",value:put},{label:"Custom",value:w_}],{validGroupSizes:g}=ot.getValidGroupSizes({drawSize:32,groupSizeLimit:8}),v=g.map(C=>({label:C,value:C})),y=[{label:"Group winners",value:ABe},{label:"Group positions",value:kfe},{label:"Top finishers",value:hD}],b=[{label:"2",value:2},{label:"3",value:3},{label:"4",value:4}],I=[{label:_c,value:_c,selected:!n,disabled:!!n},{label:Q4,value:!1,selected:n}];return{items:[{error:"minimum of 4 characters",placeholder:"Display name of the structure",validator:Wr(4),label:"Structure name",value:p,field:EE,selectOnFocus:!0,hide:!i},{error:"minimum of 4 characters",placeholder:"Display name of the draw",value:`Draw ${a+1}`,validator:Wr(4),selectOnFocus:!0,hide:i,label:"Draw name",field:vI,focus:!0},{options:nPe({isQualifying:i}),label:"Draw Type",field:vh,value:s},{error:"Must be in range 2-128",validator:iPe(2,128),selectOnFocus:!0,label:"Draw size",value:h,field:Ev},{visible:[out,fte].includes(s),options:v,label:"Group size",field:Ef,value:4},{visible:[fte].includes(s),options:y,label:"Playoff Type",field:pD},{label:"Advance per group",options:b,field:F0,visible:!1},{label:"2nd playoff from remaining",field:T_,id:T_,checkbox:!0,visible:!1},{help:{text:"Automation disabled",visible:!1},options:I,label:"Creation",field:_c,value:""},{hide:t.eventType===gte,options:f,field:y5,label:"Score format",value:""},{hide:t.eventType!==gte,options:m,field:"tieFormatName",label:"Scorecard",value:""},{disabled:i&&!n,validator:uh,field:S_,value:d,selectOnFocus:!0,label:"Qualifiers"}],structurePositionAssignments:l}}function vte({eventId:t,drawOptions:e,callback:i}){var s,o;const n=Zi.scales[(s=Zi.activeScale)==null?void 0:s.toLowerCase()],r={scaleAccessor:n==null?void 0:n.accessor,scaleName:n==null?void 0:n.scaleName},a=ot.generateDrawDefinition({...e,...r,ignoreStageSpace:!0});if(a.success){const l=a.drawDefinition;ii({methods:[{method:vZe,params:{eventId:t,drawDefinition:l,allowReplacement:!0}}],callback:d=>Ot(i)&&i({drawDefinition:l,...d})})}else a.error&&Jt({message:((o=a.error)==null?void 0:o.message)||"Error",intent:"is-warning",pauseOnHover:!0})}const{POLICY_TYPE_SEEDING:gut}=ky,{SEPARATE:vut}=Qr,{SEEDING:yut}=rU,rPe={[gut]:{validSeedPositions:{ignore:!0},duplicateSeedNumbers:!0,drawSizeProgression:!0,seedingProfile:vut,policyName:yut,seedsCountThresholds:[{drawSize:4,minimumParticipantCount:3,seedsCount:2},{drawSize:16,minimumParticipantCount:12,seedsCount:4},{drawSize:32,minimumParticipantCount:24,seedsCount:8},{drawSize:64,minimumParticipantCount:48,seedsCount:16},{drawSize:128,minimumParticipantCount:96,seedsCount:32},{drawSize:256,minimumParticipantCount:192,seedsCount:64}]}},{AD_HOC:but,FEED_IN:Iut,LUCKY_DRAW:wut,MAIN:Sut,QUALIFYING:Tut,ROUND_ROBIN:yte,ROUND_ROBIN_WITH_PLAYOFF:bte}=Qr,{TIME_TENNIS_PRO_CIRCUIT:Uut}=Uo.tieFormatConstants,{DIRECT_ENTRY_STATUSES:Ite}=nd,{POLICY_TYPE_ROUND_NAMING:Dut}=ky;function wte({drawName:t,matchUpFormat:e,isQualifying:i,structureId:n,callback:r,inputs:a,drawId:s,event:o}){var R,C,M,_,A,N,k,O,$;const l=a[vh].options[a[vh].selectedIndex].getAttribute("value");e=e||((R=a[y5])==null?void 0:R.value);const c=(C=a[EE])==null?void 0:C.value,u=(M=a.tieFormatName)==null?void 0:M.value,d=(_=a[vI])==null?void 0:_.value,p=a[Ev].value||0,h=parseInt(a[Ef].value),f=_i.isConvertableInteger(p)&&parseInt(p),m=[wut,Iut,yte,bte].includes(l)&&f||_i.nextPowerOf2(f),g=o.entries.filter(({entryStage:F,entryStatus:V})=>F===Tut&&Ite.includes(V)),v=i&&g.length?g:o.entries.filter(({entryStage:F,entryStatus:V})=>(!F||F===Sut)&&Ite.includes(V)),y=m<v.length?!1:a[_c].value===_c,b=o.eventId,I={drawEntries:v,automated:y,eventId:b,drawId:s},T=parseInt(((A=a.advancePerGroup)==null?void 0:A.value)||0),w=(N=a[T_])==null?void 0:N.checked,S=(k=a[pD])==null?void 0:k.value;let U;if(l===bte){const F=[];if(S===hD){const V=[_i.generateRange(1,T+1)];if(w){const j=_i.generateRange(T+1,h+1);j.length&&V.push(j)}V.forEach((j,B)=>{F.push({structureName:`Playoff ${B+1}`,finishingPositions:j})})}else S===kfe&&_i.generateRange(1,h+1).forEach(V=>{F.push({structureName:`Playoff ${V}`,finishingPositions:[V]})});U={groupSize:h},F.length&&(U.playoffGroups=F)}else l===yte?U={groupSize:h}:l===but&&Object.assign(I,{roundsCount:1});const P=(O=ot.getSeedsCount({participantsCount:v==null?void 0:v.length,policyDefinitions:rPe,drawSizeProgression:!0}))==null?void 0:O.seedsCount,E=uh(a[S_].value)&&parseInt(($=a[S_])==null?void 0:$.value)||0;if(n){const F=ot.generateQualifyingStructure({qualifyingPositions:E,targetStructureId:n,structureOptions:U,matchUpFormat:e,structureName:c,automated:y,drawSize:m,drawType:l,drawId:s});if(F.success){const V=[{method:CZe,params:{structure:F.structure,link:F.link,eventId:b,drawId:s}}];ii({methods:V,callback:B=>{var z;return Ot(r)&&r({...F,...(z=B.results)==null?void 0:z[0]})}})}return}if(i?(I.drawName=t,I.qualifyingProfiles=[{structureProfiles:[{qualifyingPositions:E,structureOptions:U,matchUpFormat:e,structureName:c,seedsCount:P,drawSize:m,drawType:l}]}]):(E&&(I.qualifiersCount=E,I.qualifyingPlaceholder=!0),Object.assign(I,{seedingScaleName:b,structureOptions:U,matchUpFormat:e,seedsCount:P,drawName:d,drawSize:m,drawType:l})),f)if(u===w_)GEe({title:"Custom scorecard",onClose:V=>{V&&(I.tieFormat=V,vte({drawOptions:I,eventId:b,callback:r}))}});else{if(I.tieFormatName=u,u===Uut){const F={[Dut]:{namingConventions:{round:"Day"},affixes:{roundNumber:"D"},policyName:"TTPro 4 Day"}};I.policyDefinitions={...F}}vte({drawOptions:I,eventId:b,callback:r})}else Jt({message:"Invalid draw size",intent:"is-warning",pauseOnHover:!0})}function kT({eventId:t,callback:e,drawId:i,drawName:n,structureId:r,isQualifying:a}){const s=ot.getEvent({eventId:t}).event;if(!s)return;const{items:o,structurePositionAssignments:l}=mut({event:s,drawId:i,isQualifying:a,structureId:r}),c=Gct({maxQualifiers:l==null?void 0:l.length,isQualifying:a,event:s});let u;const d=v=>{u=Sr(v,o,c)},p=()=>a?Wr(4)(u[EE].value):Wr(4)(u[vI].value),f=[{label:"Cancel",intent:xt,close:!0},{label:"Generate",id:"generateDraw",intent:"is-primary",onClick:()=>{var v;p()?((v=u.matchUpFormat)==null?void 0:v.value)===w_?BY({callback:b=>{b&&wte({event:s,inputs:u,callback:e,structureId:r,matchUpFormat:b,drawId:i,drawName:n,isQualifying:a})}}):wte({event:s,inputs:u,callback:e,structureId:r,drawId:i,drawName:n,isQualifying:a}):Jt({message:"Missing Draw name",intent:"is-danger"})},close:p}],m="Configure draw",g=(v,y)=>qw(v,f,y);It.drawer.open({title:m,content:d,footer:g,side:oi,width:"300px"})}const OB={high:[80,100],medium:[60,80],low:[40,60]},{ratingsParameters:Eut}=Jf,Ste=t=>(e,i)=>{const n=Eut[t];if(!n)return 0;const{accessor:r,ascending:a}=n,s=!a,o=Tte(e),l=Tte(i);if(o<l)return 1;if(l<o)return-1;const c=(e==null?void 0:e[r])||0,u=(i==null?void 0:i[r])||0;return s?c-u:u-c};function Tte(t){const e=_k(t.confidence??100);return e==="high"&&100||e==="medium"&&80||e==="low"&&60||0}function _k(t){return parseInt(t)>=OB.high[0]?"high":parseInt(t)>=OB.medium[0]?"medium":parseInt(t)>=OB.low[0]?"low":"unrated"}const{ratingsParameters:Put}=Jf,Ute=t=>e=>{const i=Put[t],{accessor:n}=i,r=e.getValue(),a=(r==null?void 0:r.confidence)??100,s=r==null?void 0:r[n],o=_k(a),l=document.createElement("span"),c={medium:"darkgreen",low:"lightblue",high:"blue"};return l.style.color=c[o],l.innerHTML=s??"",l},{SINGLES:Cut}=pl,Rut=t=>e=>{const i=e.getColumn().getDefinition(),n=document.createElement("div");n.className="tags";const r=l=>t({...l,renderDraw:!0}),a=e.getValue(),s=e.getRow().getData(),{participantId:o}=s;return a==null||a.forEach(l=>{const c=Mut({def:i,participantId:o,flight:l,flightClick:r});n.appendChild(c)}),n};function Mut({flight:t,flightClick:e}){var n,r;const i=document.createElement("span");return Ot(e)&&(i.onclick=()=>e(t)),i.className="tag event-pill",(n=t.gender)!=null&&n.toLowerCase().includes("female")?i.classList.add("is-danger"):(r=t.gender)!=null&&r.toLowerCase().includes("male")?i.classList.add("is-link"):i.classList.add("is-primary"),t.eventType===Cut&&i.classList.add("is-light"),i.innerHTML=t.drawName,i}const{MAIN:Nut,QUALIFYING:LB}=Qr,{DIRECT_ACCEPTANCE:Dte}=nd;function aPe({participantIds:t,group:e,eventId:i,drawId:n,callback:r}){ii({methods:[{method:s1e,params:{autoEntryPositions:!0,participantIds:t,entryStatus:e===fd&&Dte||e===LB&&Dte||e,entryStage:e===LB?LB:Nut,eventId:i,drawId:n}}],callback:r})}const{ALTERNATE:Ete,DIRECT_ACCEPTANCE:Pte,WITHDRAWN:Cte,UNGROUPED:Aut}=nd,{QUALIFYING:Rte}=Qr,_ut=(t,e,i)=>(n,r)=>{const{participant:a}=r.getRow().getData(),s=c=>()=>{const u=p=>{var h;if(p.success){const f=r.getRow(),m=c===fd?Pte:c;(h=It.tables[m])==null||h.addRow(f.getData()),f.delete()}else console.log({result:p})},d=[a.participantId];aPe({participantIds:d,callback:u,eventId:e,drawId:i,group:c})},o=()=>{const c=ot.destroyPairEntry({participantIds:[a.participantId],autoEntryPositions:!0,eventId:e,drawId:i});console.log({result:c})};let l=[{onClick:s(Pte),option:"Move to accepted",action:fd},{onClick:s(Rte),option:"Move to qualifying",action:Rte},{onClick:s(Ete),option:"Move to alternates",action:Ete},{onClick:o,option:"Unpair players",action:Aut},{onClick:s(Cte),option:"Withdraw participant",action:Cte}].filter(c=>t.includes(c.action));if(l.length){const c=n.target;Ic({options:l,target:c,config:{placement:Ap}})}},{WTN:FB,UTR:$B}=Uo.ratingConstants;function kut({entries:t,exclude:e=[],eventId:i,drawId:n,actions:r=[],drawCreated:a}={}){const s=t.find(p=>{var h,f;return(f=(h=p.participant)==null?void 0:h.teams)==null?void 0:f.length}),o=t.find(p=>{var h;return(h=p.ratings)==null?void 0:h.utr}),l=t.find(p=>{var h;return(h=p.ratings)==null?void 0:h.wtn}),c=t.find(p=>p.cityState),u=t.find(p=>p.seedNumber),d=t.find(p=>p.ranking);return[{cellClick:(p,h)=>h.getRow().toggleSelect(),titleFormatter:"rowSelection",formatter:"rowSelection",visible:!a,headerSort:!1,responsive:!1,hozAlign:pi,width:5},{headerMenu:xm(),formatter:"rownum",headerSort:!1,hozAlign:pi,width:55},{formatter:"responsiveCollapse",responsive:!1,headerSort:!1,hozAlign:mi,resizable:!1,width:50},{formatter:p=>Ww()(p,void 0,"sideBySide"),field:"participant",responsive:!1,resizable:!1,minWidth:200,widthGrow:1,title:"Name"},{sorterParams:{alignEmptyValues:"bottom"},visible:!!d,resizable:!1,sorter:"number",field:"ranking",title:"Rank",width:70},{formatter:Ute(FB),sorter:Ste(FB),visible:!!l,field:"ratings.wtn",resizable:!1,title:FB,width:70},{formatter:Ute($B),sorter:Ste($B),visible:!!o,field:"ratings.utr",resizable:!1,title:$B,width:70},{sorter:(p,h)=>{var f,m,g;return(g=(f=p==null?void 0:p[0])==null?void 0:f.participantName)==null?void 0:g.localeCompare((m=h==null?void 0:h[0])==null?void 0:m.participantName)},formatter:NDe(()=>console.log("boo")),field:"participant.teams",visible:!!s,title:"Teams",responsive:!1,resizable:!1,minWidth:100},{visible:!!c,title:"City/State",field:"cityState",responsive:!1,resizable:!1,minWidth:100},{editor:fH({maxValue:(t==null?void 0:t.length)||0,field:"seedNumber"}),sorterParams:{alignEmptyValues:"bottom"},visible:!!u,field:"seedNumber",hozAlign:mi,resizable:!1,sorter:"number",editable:!1,title:"Seed",maxWidth:70},{formatter:Rut(Jr),title:"Flights",responsive:!0,field:"flights",minWidth:100,widthGrow:1},{responsive:!1,resizable:!1,title:"Status",field:"status",maxWidth:80},{cellClick:_ut(r,i,n),formatter:av,responsive:!1,headerSort:!1,hozAlign:oi,maxWidth:40}].filter(({field:p})=>Array.isArray(e)&&!(e!=null&&e.includes(p)))}function sPe(){const t=ot.getTournament().tournamentRecord.tournamentId,e=`/${Ps}/${t}/${hh}`;It.router.navigate(e)}function oPe(t,e){u1({classNames:["saveSeeding","cancelManualSeeding"],columns:["seedNumber"],visible:!1,table:e,e:t})}const{SEEDING:xut}=rU;function lPe({scaleItemsWithParticipantIds:t,scaleBasis:e,eventId:i,callback:n}){ii({methods:[{method:HZe,params:{scaleItemsWithParticipantIds:t,removePriorValues:!0,context:{scaleAttributes:{scaleType:xut},scaleBasis:{scaleType:e},eventId:i}}}],callback:s=>{s.success&&Ot(n)&&n()}})}const{QUALIFYING:Mte}=Qr,{SEEDING:Out,MANUAL:Lut}=rU;function cPe({event:t,rows:e,callback:i}){const{eventId:n,eventType:r}=t,a=e.map(({entryStage:s,participantId:o,seedNumber:l})=>{const c=s===Mte?`${n}${Mte}`:n;return{participantId:o,scaleItems:[{scaleValue:l,scaleType:Out,scaleName:c,eventType:r}]}});lPe({scaleItemsWithParticipantIds:a,scaleBasis:Lut,eventId:n,callback:i})}function uPe({table:t}){const e=t.getRows();let i;for(const n of e){const r=n.getData();i=r.entryStage,r.seedNumber=void 0,n.update(r)}return i}function Fut({event:t,table:e}){uPe({table:e});const i=e.getData();cPe({event:t,rows:i})}const{DIRECT_ACCEPTANCE:$ut}=nd,{QUALIFYING:Nte}=Qr,Ate=t=>e=>{const i=t==null?void 0:t.eventId;return{class:"cancelManualSeeding",intent:"is-warning",location:oi,label:"Cancel",visible:!1,onClick:r=>{var f,m;oPe(r,e);const a=uPe({table:e}),s=(f=ot.getEvent({eventId:i}))==null?void 0:f.event,l=((m=s.entries)==null?void 0:m.filter(g=>g.entryStage===a&&g.entryStatus===$ut)).map(({participantId:g})=>g),{participants:c}=ot.getParticipants({participantFilters:{participantIds:l},withScaleValues:!0}),u=a===Nte?`${i}${Nte}`:i,d=c.map(g=>{var y,b,I;const v=(I=(b=(y=g==null?void 0:g.seedings)==null?void 0:y[s.eventType])==null?void 0:b.find(T=>T.scaleName===u))==null?void 0:I.scaleValue;if(v)return{participantId:g.participantId,seedNumber:v}}).filter(Boolean),p=Object.assign({},...d.map(g=>({[g.participantId]:g}))),h=e.getRows();for(const g of h){const v=g.getData(),y=v.participantId;p[y]&&(v.seedNumber=p[y].seedNumber,g.update(v))}}}};function But(t,e){u1({classNames:["saveSeeding","cancelManualSeeding"],columns:["seedNumber"],visible:!0,table:e,e:t}),e.showColumn("seedNumber"),e.redraw(!0)}const{QUALIFYING:gN,MAIN:Vut}=Qr,{SEEDING:jut,RATING:Gut}=rU,{ratingsParameters:_te}=Jf;function Hut({event:t,group:e,table:i,field:n}){const{eventId:r,eventType:a}=t,{seedsCount:s,stageEntries:o}=ot.getEntriesAndSeedsCount({stage:e===gN?gN:Vut,policyDefinitions:rPe,eventId:r}),[l,c]=n.split("."),u=c?!_te[c.toUpperCase()].ascending:!1,d=_te[c.toUpperCase()].accessor,p=U=>{var P;return((P=U.ratings)==null?void 0:P[c])||{confidence:0,[d]:1/0}},h=U=>{var P;return((P=p(U))==null?void 0:P[d])||0},f=(U,P)=>(l==="ratings"&&u?h(U)-h(P):h(P)-h(U))||U-P,m=i.getData(),g={high:[],medium:[],low:[]};let v=0;for(const U of m){const P=p(U);P[d]&&(v+=1);const E=P.confidence??100;_k(E)==="high"?g.high.push(U):_k(E)==="medium"?g.medium.push(U):g.low.push(U)}const b=(Ot(f)&&[].concat(g.high.toSorted(f),g.medium.toSorted(f),g.low.toSorted(f))).slice(0,Math.min(v,s)),I=e===gN?`${r}${gN}`:r,T={scaleType:jut,scaleName:I,eventType:a},{scaleItemsWithParticipantIds:w}=ot.generateSeedingScaleItems({scaleAttributes:T,scaledEntries:b,stageEntries:o,seedsCount:s,scaleName:I});lPe({scaleItemsWithParticipantIds:w,scaleBasis:Gut,eventId:r,callback:()=>{const U=Object.assign({},...b.map((E,R)=>({[E.participantId]:R+1}))),P=i.getRows();i.showColumn("seedNumber"),i.redraw(!0);for(const E of P){const R=E.getData(),C=U[R.participantId];R.seedNumber=C,E.update(R)}}})}const kte=(t,e)=>i=>{const n={ranking:"Seed by ranking","ratings.wtn":"Seed by WTN","ratings.utr":"Seed by UTR"},r=i.getColumns().map(s=>s.getDefinition()).filter(s=>["ratings.wtn","ratings.utr"].includes(s.field)),a=[{label:"Manual seeding",onClick:s=>But(s,i),close:!0},{label:"Clear seeding",onClick:()=>Fut({event:t,table:i}),close:!0}].concat(...r.map(s=>({onClick:()=>Hut({event:t,group:e,table:i,field:s.field}),label:n[s.field],value:s.field,close:!0})));return{class:"seedingOptions",label:"Seeding",selection:!1,location:oi,align:oi,options:a}},zut=(t,e,i,n)=>{const a=t.getSelectedData().filter(u=>{var d;return!((d=u.events)!=null&&d.length)}).map(({participantId:u})=>u),[s,o]=e.split(".");ii({methods:[{method:s1e,params:{ignoreAssignment:!0,participantIds:a,entryStatus:o,entryStage:s,eventId:i,drawId:n}}],callback:u=>{if(t.deselectRow(),u.success){const d=t.getRows();for(const p of d){const h=p.getData();a.includes(h.participantId)&&(h.status=_fe[o],p.update(h))}}else console.log(u.error)}})},qut=(t,e,i)=>n=>{const r=t.map(a=>({onClick:()=>zut(n,a,e,i),label:a,value:a,close:!0}));return{location:fa,label:"Change status",options:r}},Wut=(t,e=0)=>{const i=`${t} <span class='${wfe}'>${e}</span>`;return{location:b_,text:i}},H0=({target:t,table:e,close:i})=>{var r,a,s;if(!t)return;const n=jl(t,Ub);if(n){const o=(r=n.getElementsByClassName("toggle"))==null?void 0:r[0],l=(a=n.getElementsByClassName(Rfe))==null?void 0:a[0],c=(s=n.getElementsByClassName(Mfe))==null?void 0:s[0];if(o){const u=i||o.innerHTML.charCodeAt(0)===9660;l.style.display=u?xt:XS,c.style.display=u?xt:XS,o.parentNode.innerHTML=`<span class='toggle' style='color: white'>${u?$De:RY}</span>`,u||e.redraw(!0)}}},Yut=t=>{const e=i=>H0({target:i.target,table:t});return{headerClick:e,text:`<span class='toggle' style='color: white'>${RY}</span>`,location:b_,onClick:e}},$1=({heading:t,count:e})=>[Wut(t,e),i=>Yut(i)],Kut=(t,e,i)=>(n,r="Search participants")=>{let a,s;const o=l=>{var u;const c=Py(n.element,"tableClass");if(c){const d=(u=Cg(c,"controlBar"))==null?void 0:u[0];if(d){const p=Cg(d,"search");Array.from(p).forEach(h=>h.value=l)}}a=n.getSelectedData().map(d=>d[e]),n.removeFilter(s),s=d=>{var p;return((p=d.searchText)==null?void 0:p.includes(l==null?void 0:l.toLowerCase()))||(a==null?void 0:a.length)&&a.includes(d[e])},l&&n.addFilter(s)};return{onKeyDown:l=>{l.keyCode===8&&l.target.value.length===1&&o(""),(l.key==="Enter"||l.keyCode===13)&&Ot(i)&&i(n)&&o("")},onChange:l=>o(l.target.value),onKeyUp:l=>o(l.target.value),location:t||pi,class:"search",search:!0,placeholder:r}},xte=t=>e=>({label:"Save seeding",class:"saveSeeding",intent:"is-info",location:oi,visible:!1,onClick:n=>{oPe(n,e);const r=e.getData();cPe({event:t,rows:r})}}),{UNGROUPED:Ote}=nd,{DOUBLES:Zut}=pl,Xut=(t,e)=>i=>{const n=r=>{const a=r.getSelectedData(),s=a.filter(c=>{var u;return!((u=c.events)!=null&&u.length)}).map(({participantId:c})=>c);ii({methods:[{method:xZe,params:{removeGroupParticipant:!0,participantIds:s,eventId:t,drawId:e}}],callback:c=>{var u,d;if(c!=null&&c.error)r.deselectRow(),Jt({message:((d=c.error[0])==null?void 0:d.message)??"Error destroying pair",intent:"is-danger"});else{r.deleteRow(s);const h=(u=Py(r.element,"tableClass").getElementsByClassName("controlBar"))==null?void 0:u[0];h&&setTimeout(()=>bY({table:r,target:h})(),100);const f=a.flatMap(({participant:v})=>v==null?void 0:v.individualParticipantIds),{participants:m}=ot.getParticipants({participantFilters:{participantIds:f}}),g=m.map(v=>j2({entry:{participantId:v.participantId,entryStatus:Ote},eventType:Zut,participant:v}));It.tables[Ote].updateOrAddData(g)}}})};return{onClick:()=>n(i),label:"Destroy pairs",intent:"is-danger",location:fa}},Jut=(t,e)=>{const n=t.getSelectedData().map(({participantId:o})=>o),r=e.entries.filter(({participantId:o})=>n.includes(o)),a=[{method:gZe,params:{eventId:e.eventId,drawName:"Flight",drawEntries:r}}];ii({methods:a,callback:o=>{o.success?t.deselectRow():console.log(o.error)}})},Qut=(t,e)=>i=>({onClick:()=>Jut(i,t),label:"Add flight",location:fa,hide:e}),edt=(t,e,i,n)=>{const a=t.getSelectedData().filter(o=>{var l;return!((l=o.events)!=null&&l.length)}).map(({participantId:o})=>o);aPe({participantIds:a,group:e,eventId:i,drawId:n,callback:o=>{if(o!=null&&o.success){const c=t.getData().filter(({participantId:u})=>a.includes(u));It.tables[e].updateOrAddData(c),t.deleteRow(a)}else t.deselectRow(),Jt({message:o.error.message??"Error moving participants",intent:"is-danger"})}})},vN=(t,e,i)=>n=>{const r=t.map(a=>({onClick:()=>edt(n,a,e,i),stateChange:!0,label:a,value:a,close:!0}));return{label:"Move participants",location:fa,options:r}},{ASSIGN_PARTICIPANT:tdt}=cw,BB=(t,e)=>i=>({label:"Add entries",class:"addEntries",location:oi,onClick:()=>{const{entries:r=[],eventId:a,eventType:s}=t,o=(r||[]).map(({participantId:p})=>p),l=t.eventType==="TEAM"&&"TEAM"||t.eventType==="DOUBLES"&&"PAIR"||"INDIVIDUAL",c=ot.getParticipants({inContext:!0,participantFilters:{participantTypes:[l]},withISO2:!0}).participants.filter(p=>!o.includes(p.participantId));IM({title:"Select participants to add",activeOnEnter:!0,selectionLimit:99,onSelection:({selected:p})=>{if(!(p!=null&&p.length))return;const h=p.map(({participantId:y})=>y),f=e===WC?"QUALIFYING":"MAIN",m="DIRECT_ACCEPTANCE";ii({methods:[{params:{eventId:a,participantIds:h,entryStatus:m,entryStage:f},method:aY}],callback:y=>{if(y.success){const{participants:b,derivedDrawInfo:I}=ot.getParticipants({participantFilters:{participantIds:h},withIndividualParticipants:!0,withScaleValues:!0,withDraws:!0}),T=h.map(w=>j2({entry:{participantId:w,entryStage:f,entryStatus:m},derivedDrawInfo:I,participants:b,eventType:s,eventId:a}));i.addRow(T)}}})},action:{type:tdt,participantsAvailable:c}})}}),{ALTERNATE:VB,UNGROUPED:idt}=nd,{MAIN:ndt}=Qr,{DOUBLES:Lte}=pl,rdt=(t,e=!0)=>{const{eventId:i,eventType:n,gender:r}=t,a=(l,c)=>{const u=c.getSelectedData().map(m=>m.participantId);if(u.length!==2)return;const p=[_i.UUID()],h=[{method:SZe,params:{participantIdPairs:[u],allowDuplicateParticipantIdPairs:!0,entryStatus:VB,entryStage:ndt,eventId:i,uuids:p}}];ii({methods:h,callback:m=>{var g,v,y;if(m.success){c.deleteRow(u),c.clearFilter();const b=Py(c.element,"tableClass");if(b){const w=(g=Cg(b,"controlBar"))==null?void 0:g[0];if(w){const S=Cg(w,"search");Array.from(S).forEach(U=>U.value="")}}const I=m.results[0].newParticipantIds,{participants:[T]}=ot.getParticipants({participantFilters:{participantIds:I},withIndividualParticipants:!0,withISO2:!0});if(T){const w=j2({entry:{participantId:T.participantId,entryStatus:VB},eventType:Lte,participant:T});It.tables[VB].updateOrAddData([w]);const U=(v=Py(l.target,"tableClass").getElementsByClassName("controlBar"))==null?void 0:v[0];U&&setTimeout(()=>bY({table:c,target:U})(),100)}else console.log("participant not found",{participantIds:I,methods:h,result:m})}else((y=m.error)==null?void 0:y.code)==="ERR_INVALID_PARTICIPANT_IDS"?(Jt({intent:"is-danger",message:r==="MIXED"?"Genders must be mixed":"Invalid pairing"}),c.deselectRow()):console.log({methods:h,result:m})}})};return{createPairButton:{hide:n!==Lte,label:"Create pair",onClick:a,intent:"is-info",location:fa,id:"create-pair",visible:!1},createPairFromSelected:l=>{const c=(l==null?void 0:l.length)===2;if(c&&e){const u=It.tables[idt];a({target:u.element},u)}else{const u=document.getElementById("create-pair");u&&(u.style.display=c?"":xt)}}}},{DIRECT_ACCEPTANCE:adt}=nd,{MAIN:sdt}=Qr,odt=(t,e,i)=>{const r=t.getSelectedData().filter(o=>{var l;return!((l=o.events)!=null&&l.length)}).map(({participantId:o})=>o);ii({methods:[{method:yZe,params:{entryStatus:adt,ignoreStageSpace:!0,entryStage:sdt,participantIds:r,eventId:e,drawId:i}}],callback:o=>{o.success?t.deselectRow():console.log(o.error)}})},ldt=(t,e)=>i=>{var r;const n=(t.drawDefinitions||[]).filter(Boolean).map(({drawName:a,drawId:s})=>({onClick:()=>odt(i,t.eventId,s),stateChange:!0,label:a,value:s,close:!0}));return{hide:!((r=t.drawDefinitions)!=null&&r.length)||e,label:"Add to draw",location:fa,options:n}},{DIRECT_ACCEPTANCE:cdt,ALTERNATE:yf,UNGROUPED:Fte,WITHDRAWN:bf}=nd,{MAIN:A0,QUALIFYING:vv}=Qr,{SINGLES:udt,DOUBLES:$te}=pl;function ddt({drawDefinition:t,event:e,entryData:i,hasFlights:n}){const r=v=>i.filter(({entryStage:y=A0,entryStatus:b})=>v.includes(`${y}.${b}`)),a=!!t,s=t==null?void 0:t.drawId,o=e==null?void 0:e.eventId,l={[fd]:[yf,bf],[vv]:[fd,yf,bf],[yf]:[fd,vv,bf],[bf]:[yf]},{createPairFromSelected:c}=rdt(e),u=n?[]:["flights"],d=v=>{const y=v.getData("active"),b=y.map(({participantId:I})=>I);if(y.length===1)return v.selectRow(b),!0;y.length===2&&v.selectRow(b)},p=r(Ak(A0)),h=r([`${vv}.${cdt}`]),f=r([`${A0}.${yf}`]),m=r([`${A0}.${Fte}`]),g=r([`${A0}.${bf}`]);return[{placeholder:"No accepted participants",items:[vN(l[fd],o,s),qut(Ak(A0),o,s),ldt(e,s),Qut(e,s),...$1({heading:"Accepted",count:p.length}),!a&&kte(e,fd),Ate(e),xte(e),!a&&BB(e,fd)],actions:l[fd],anchorId:i5,entries:p,group:fd,excludeColumns:u,drawCreated:a,togglePanel:H0},{placeholder:"No qualifying participants",items:[...$1({heading:"Qualifying",count:h.length}),vN(l[vv],o,s),!a&&kte(e,vv),Ate(e),xte(e),!a&&BB(e,vv)],actions:[fd,yf,bf],anchorId:r5,entries:h,group:vv,excludeColumns:u,drawCreated:a,togglePanel:H0},{items:[...$1({heading:"Alternates",count:f.length}),vN(l[yf],o,s),(e==null?void 0:e.eventType)===$te&&Xut(o,s),!a&&BB(e,yf)],actions:[fd,vv,bf],excludeColumns:["seedNumber","flights"],placeholder:"No alternates",anchorId:n5,entries:f,group:yf,drawCreated:a,togglePanel:H0},{hide:!!([udt].includes(e==null?void 0:e.eventType)||a),items:[...$1({heading:"Ungrouped",count:m.length}),Kut(pi,"participantId",d)],placeholder:"No ungrouped participants",excludeColumns:["seedNumber","flights"],onSelection:(e==null?void 0:e.eventType)===$te&&c,anchorId:a5,entries:m,actions:[bf],group:Fte,drawCreated:a,togglePanel:H0},{items:[...$1({heading:"Withdrawn",count:g.length}),!a&&vN(l[bf],o,s)],placeholder:"No withdrawn participants",excludeColumns:["seedNumber","flights"],anchorId:s5,entries:g,actions:[yf],hide:a,group:bf,collapsed:!0,drawCreated:a,togglePanel:H0}]}function Bte({eventId:t,drawId:e,headerElement:i}){var l,c,u,d,p;(!t||t==="undefined")&&It.router.navigate("/");let n;const r=h=>{n&&Object.values(It.tables).forEach(m=>m.removeFilter(n));const f=h==null?void 0:h.toLowerCase();n=m=>{var g;return(g=m.searchText)==null?void 0:g.includes(f)},h?Object.values(It.tables).forEach(m=>m.addFilter(n)):n=void 0},a=()=>{var T,w,S;const{event:h,drawDefinition:f}=ot.getEvent({eventId:t,drawId:e});if(i&&(i.innerHTML=h==null?void 0:h.eventName),!h)return{error:"EVENT_NOT_FOUND"};const{participants:m,derivedDrawInfo:g}=ot.getParticipants({participantFilters:{eventIds:[t]},withIndividualParticipants:!0,withScaleValues:!0,withDraws:!0,withISO2:!0})??{},v=((T=h==null?void 0:h.drawDefinitions)==null?void 0:T.length)>1,y=((w=h.category)==null?void 0:w.categoryName)??((S=h.category)==null?void 0:S.ageCategoryCode),b=((f==null?void 0:f.entries)||(h==null?void 0:h.entries)||[]).map(U=>j2({eventType:h.eventType,derivedDrawInfo:g,categoryName:y,participants:m,eventId:t,entry:U})),{events:I}=ot.getEvents();return{tableData:ddt({event:h,drawDefinition:f,participants:m,entryData:b,hasFlights:v}),events:I,event:h}},s=h=>{for(const f of h){const{entries:m,group:g,anchorId:v,placeholder:y,excludeColumns:b,actions:I,drawCreated:T}=f,w=document.getElementById(v);if(w){w.style.display=f.hide?xt:XS,Ys(w);const S=document.createElement("div");S.className=`${MBe} flexcol flexcenter`,w.appendChild(S);const U=document.createElement("div");U.className=`${Mfe} flexcol flexcenter`,w.appendChild(U);const P=new As(U,{headerSortElement:rf(["ratings.utr","ratings.wtn","seedNumber","ranking","cityState","status","flights"]),columns:kut({actions:I,exclude:b,entries:m,eventId:t,drawId:e,drawCreated:T}),responsiveLayout:"collapse",index:"participantId",layout:"fitColumns",reactiveData:!0,height:"400px",data:m,placeholder:y});It.tables[g]=P;const E=jl(w,Ub);P.on("tableBuilt",()=>{var C;const R=(C=f.items)==null?void 0:C.map(M=>Ot(M)?M(P):M);Io({target:S,table:P,items:R,onSelection:f.onSelection}),!m.length&&f.togglePanel&&f.togglePanel({target:E,table:P,close:!0})}),P.on("dataChanged",()=>{var A,N;const M=(N=((A=Py(P.element,"tableClass").getElementsByClassName("controlBar"))==null?void 0:A[0]).getElementsByClassName(wfe))==null?void 0:N[0],_=P.getData().length;f.togglePanel&&!_&&f.togglePanel({target:E,table:P,close:!0}),M&&(M.innerHTML=_||0)})}}},o=a();if(!o.error){const h="All entries",f=document.getElementById(YC),m={label:h,onClick:()=>Jr({eventId:t}),close:!0},g=(o.event.drawDefinitions||[]).map(E=>({onClick:()=>Jr({eventId:t,drawId:E.drawId}),label:E==null?void 0:E.drawName,close:!0})).concat([{divider:!0},m]),v={label:gg,onClick:sPe,close:!0},y=o.events.map(E=>({onClick:()=>Jr({eventId:E.eventId}),label:E.eventName,close:!0})).concat([{divider:!0},v]),b=E=>{var R;E.success&&Jr({eventId:t,drawId:(R=E.drawDefinition)==null?void 0:R.drawId,renderDraw:!0})},I={label:"<div style='font-weight: bold'>Add draw</div>",onClick:()=>kT({eventId:t,callback:b})},T=(l=o.event.drawDefinitions)==null?void 0:l.map(E=>({onClick:()=>Jr({eventId:t,drawId:E==null?void 0:E.drawId,renderDraw:!0}),label:E==null?void 0:E.drawName,close:!0})).concat([{divider:!0},I]),w=(d=(u=(c=o.event)==null?void 0:c.drawDefinitions)==null?void 0:u.find(E=>(E==null?void 0:E.drawId)===e))==null?void 0:d.drawName,S=({eventId:E})=>{console.log("generateFlights",{eventId:E})},U=(p=ePe({eventId:t}))!=null&&p.length?"is-success":xt,P=[{onKeyDown:E=>E.keyCode===8&&E.target.value.length===1&&r(""),onChange:E=>r(E.target.value),onKeyUp:E=>r(E.target.value),clearSearch:()=>r(""),placeholder:"Search entries",location:pi,search:!0},{label:o.event.eventName,options:y.length>1&&y,location:pi},{label:w||h,options:g,location:pi},{onClick:()=>Jr({eventId:t,drawId:e,renderDraw:!0}),label:"View draw",intent:"is-info",location:oi,hide:!e},{onClick:()=>tPe({eventId:t}),intent:U,id:"editAvoidances",label:"Avoidances",location:oi},{onClick:()=>S({eventId:t,callback:()=>{}}),label:"Flights",location:oi,hide:e,intent:xt},{options:(T==null?void 0:T.length)>2&&T,hide:((T==null?void 0:T.length)||0)<3||e,intent:"is-info",location:oi,label:"Draws",align:oi},{onClick:()=>kT({eventId:t,callback:b}),hide:(T==null?void 0:T.length)>2||e,intent:"is-info",label:"Add draw",location:oi}];Io({target:f,items:P}),s(o.tableData)}}function pdt({drawId:t,callback:e}){var c,u;const i=(u=(c=ot.getEvent({drawId:t}))==null?void 0:c.drawDefinition)==null?void 0:u.structures;if(!(i!=null&&i.length))return;const n=i.map(({structureName:d,structureId:p})=>({text:`${d}:`,fieldPair:{error:"minimum 4 characters",validator:Wr(4),placeholder:d,field:p,id:p}}));let r;const a=()=>{const d=i.map(({structureId:f})=>{var m;return((m=r[f])==null?void 0:m.value)&&{structureId:f,structureName:r[f].value.trim()}}).filter(Boolean);ii({methods:[{params:{drawId:t,structureDetails:d},method:l1e}],callback:f=>{f.success&&(Jt({message:"Structure renamed",intent:"is-success"}),Ot(e)&&e())}})},s=()=>{const d=i.map(({structureId:m})=>{var g;return(g=r[m])==null?void 0:g.value}).filter(Boolean),p=d.every(Wr(4)),h=document.getElementById("renameStructures"),f=d.length&&p;h&&(h.disabled=!f)},o=i.map(({structureId:d})=>({control:d,onInput:s}));er({title:"Edit structure names",content:d=>r=Sr(d,n,o),buttons:[{label:"Cancel",intent:xt,close:!0},{label:"Rename",id:"renameStructures",disabled:!0,intent:"is-info",close:!0,onClick:a}]})}function hdt({drawId:t,structure:e,callback:i}){const r=Object.values(e.roundMatchUps).flat().reduce((d,p)=>{const{structureName:h,structureId:f}=p;return d[f]||(d[f]={structureName:h,structureId:f}),d},{}),a=Object.values(r).map(({structureName:d,structureId:p})=>({text:`${d}:`,fieldPair:{error:"minimum 4 characters",validator:Wr(4),placeholder:d,field:p,id:p}}));let s;const o=()=>{const d=Object.values(r).map(({structureId:f})=>{var m;return((m=s[f])==null?void 0:m.value)&&{structureId:f,structureName:s[f].value.trim()}}).filter(Boolean);ii({methods:[{params:{drawId:t,structureDetails:d},method:l1e}],callback:f=>{f.success&&(Jt({message:"Groups renamed",intent:"is-success"}),Ot(i)&&i())}})},l=()=>{const d=Object.values(r).map(({structureId:m})=>{var g;return(g=s[m])==null?void 0:g.value}).filter(Boolean),p=d.every(Wr(4)),h=document.getElementById("renameGroups"),f=d.length&&p;h&&(h.disabled=!f)},c=Object.values(r).map(({structureId:d})=>({control:d,onInput:l}));er({title:"Edit group names",content:d=>s=Sr(d,a,c),buttons:[{label:"Cancel",intent:xt,close:!0},{label:"Rename",id:"renameGroups",disabled:!0,intent:"is-info",close:!0,onClick:o}]})}const{ROUND_ROBIN:Vte,SINGLE_ELIMINATION:fdt}=Qr;function mdt({callback:t,drawId:e,structureId:i,playoffFinishingPositionRanges:n}){const r=S=>`finishingPosition-${S}`,a=n.map(({finishingPosition:S,finishingPositionRange:U})=>({field:r(S),id:r(S),label:S,checkbox:!0,fieldPair:{text:`Creates playoff for positions ${U}`,width:"400px"}}));if(!a||a.length<1){Jt({message:"No playoff positions available",intent:"is-danger"});return}const s={value:I_,label:"Playoff name",field:"structureName",id:"structureName"},o=nPe({isPlayoff:!0}),l={value:fdt,options:o,label:"Draw type",field:vh,id:vh},{validGroupSizes:c}=ot.getValidGroupSizes({drawSize:4,groupSizeLimit:8}),d={options:c.map(S=>({label:S,value:S})),label:"Group size",field:Ef,visible:!1,value:4},p="Positions to be played off:",h={text:`${p} None`,id:"selectedPlayoffRange"},m=[s,l,d,h,{text:"Select group finishing positions. Selections must be sequential"}].concat(a);let g;const v=()=>{const U=n.filter(({finishingPosition:_})=>{var A;return(A=g[r(_)])==null?void 0:A.checked}).map(({finishingPosition:_})=>_),P=g.structureName.value,E=g[vh].value,R={finishingPositions:U,structureName:P,drawType:E};if(E===Vte){const _=parseInt(g[Ef].value);R.structureOptions={groupSize:_}}ii({methods:[{params:{drawId:e,structureId:i,playoffGroups:[R],playoffStructureNameBase:I_},method:n1e}],callback:_=>{var A;_.success?(Jt({message:"Structure added",intent:"is-success"}),Ot(t)&&t()):(console.log({result:_}),Jt({message:((A=_.error)==null?void 0:A.message)||"Error",intent:"is-danger"}))}})},y=S=>`${Math.min(...S)}-${Math.max(...S)}`,b=()=>{const S=n.filter(({finishingPosition:$})=>{var F;return(F=g[r($)])==null?void 0:F.checked}).map(({finishingPositions:$})=>$).flat(),U=n.map(({finishingPosition:$})=>g[r($)].checked),P=n.map(({finishingPosition:$})=>g[r($)].checked&&$).filter(Boolean),E=P.map(($,F)=>(P[F+1]||$)-$).every($=>$<2),R=U.filter(Boolean).length,C=document.getElementById("addStructure"),M=R&&E;C&&(C.disabled=!M);const _=document.getElementById("selectedPlayoffRange");if(_){const $=M?y(S):"None";_.innerHTML=`${p} ${$}`}const{validGroupSizes:A}=ot.getValidGroupSizes({drawSize:(S==null?void 0:S.length)||4,groupSizeLimit:8}),N=A.map($=>({label:$,value:$})),k=g[Ef],O=A.includes(4)?4:A[0];Ys(k),R5(k,{options:N,value:O})},I=({e:S,fields:U})=>{const P=S.target.value,E=[Vte].includes(P);U[Ef].style.display=E?"":xt},T=n.map(({finishingPosition:S})=>({control:r(S),onChange:b})).concat([{onChange:I,control:vh}]);er({title:"Add playoff structure",content:S=>g=Sr(S,m,T),buttons:[{label:"Cancel",intent:xt,close:!0},{label:"Add",id:"addStructure",intent:"is-info",disabled:!0,close:!0,onClick:v}]})}function gdt({drawId:t,structureId:e,callback:i}){var f,m;const n=ot.getAvailablePlayoffProfiles({drawId:t,structureId:e}),r=g=>g.finishingPositions.reduce((v,y)=>(v||0)+(y||0));if(!n.playoffRoundsRanges&&((f=n.finishingPositionsAvailable)!=null&&f.length))return mdt({...n,drawId:t,structureId:e,callback:i});const a=(m=n.playoffRoundsRanges)==null?void 0:m.sort((g,v)=>r(g)-r(v)).map(({finishingPositionRange:g})=>({label:g,field:g,id:g,checkbox:!0,fieldPair:{field:`${g}-name`,placeholder:`${I_} ${g}`,id:`${g}-name`,width:"350px"}}));if(!a||a.length<1){Jt({message:"No playoff positions available",intent:"is-danger"});return}const s=g=>{a.forEach(({label:v,fieldPair:y})=>{const b=document.getElementById(y.id);b&&(b.placeholder=`${g} ${v}`)})},l=[{onChange:g=>s(g.target.value),onKeyDown:g=>g.key==="Tab"&&s(g.target.value),value:I_,label:"Name base",field:"nameBase",id:"nameBase"}].concat(a);let c;const u=()=>{const g=n.playoffRoundsRanges.filter(w=>{var S;return(S=c[w.finishingPositionRange])==null?void 0:S.checked}),v=c.nameBase.value,y={},b=g.map(({roundNumber:w,finishingPositionRange:S})=>{var P;const U=(P=c[`${S}-name`])==null?void 0:P.value;return U&&(y[`0-${w}`]={name:U}),{[w]:1}});ii({methods:[{params:{drawId:t,structureId:e,playoffAttributes:y,roundProfiles:b,playoffStructureNameBase:v},method:n1e}],callback:w=>{var S;w.success?(Jt({message:"Structure(s) added",intent:"is-success"}),Ot(i)&&i()):Jt({message:((S=w.error)==null?void 0:S.message)||"Error",intent:"is-danger"})}})},d=()=>{const g=n.playoffRoundsRanges.filter(y=>{var b;return(b=c[y.finishingPositionRange])==null?void 0:b.checked}),v=document.getElementById("addStructure");v&&(v.disabled=!g.length)},p=n.playoffRoundsRanges.map(({finishingPositionRange:g})=>({control:g,onChange:d}));er({title:"Add playoff structures",content:g=>c=Sr(g,l,p),buttons:[{label:"Cancel",intent:xt,close:!0},{label:"Add",id:"addStructure",disabled:!0,intent:"is-info",close:!0,onClick:u}]})}const{FINISHING_POSITIONS:vdt,CONTAINER:ydt}=Qr;function bdt({drawData:t,eventId:e,structureId:i,updateControlBar:n}){var u,d,p;const r=t.drawId,a=(d=(u=ot.getAvailablePlayoffProfiles({drawId:r,structureId:i}))==null?void 0:u.playoffRounds)==null?void 0:d.length,s=(p=ot.isValidForQualifying({drawId:r,structureId:i}))==null?void 0:p.valid,o=()=>{kT({callback:h=>{if(h.success){const f=h.structure.structureId;Jr({eventId:e,drawId:r,structureId:f,renderDraw:!0})}},drawName:"Qualifying",isQualifying:!0,structureId:i,eventId:e,drawId:r})},l=t.structures.find(h=>h.structureId===i),c=(l==null?void 0:l.structureType)===ydt;return t.structures.sort((h,f)=>_i.structureSort(h,f,{mode:vdt})).map(h=>({onClick:()=>{Jr({eventId:e,drawId:r,structureId:h.structureId,renderDraw:!0})},label:h.structureName,close:!0})).concat([{divider:!0},{onClick:()=>pdt({drawId:r,callback:()=>n(!0)}),label:"Edit structure names",modifyLabel:!1,close:!0},{onClick:()=>hdt({drawId:r,structure:l,callback:h=>console.log(h)}),label:"Edit group names",hide:!c,modifyLabel:!1,close:!0},{onClick:()=>o(),hide:!s,label:"Add qualifying",modifyLabel:!1,close:!0},{onClick:()=>gdt({drawId:r,structureId:i,callback:()=>n(!0)}),hide:!a,label:"Add playoffs",modifyLabel:!1,close:!0}])}const xT=(t,e)=>i=>(i||"").trim().split(" ").length>=t&&!e;function G2(t){var h;const{eventData:e,drawIds:i,callback:n}=t,r=t.eventId??e.eventInfo.eventId,a=i.length===1&&((h=e==null?void 0:e.drawsData)==null?void 0:h.find(f=>i.includes(f.drawId)).drawName),s=a?`Delete ${a}`:"Delete flights";let o;const l=()=>{const f={auditReason:o.drawDeletionReason.value},m=i.map(v=>({params:{eventId:r,drawId:v,auditData:f,force:!0},method:NZe}));ii({methods:m,callback:v=>n?n(v):Jr({eventId:r})})},c=[{text:"Please provide a reason for draw deletion."},{placeholder:"Explanation",field:"drawDeletionReason",validator:xT(5),error:"Five word minimum",autocomplete:"on",focus:!0},{text:"This action cannot be undone!"}],d=[{control:"drawDeletionReason",onInput:({inputs:f})=>{const m=f.drawDeletionReason.value,g=xT(5)(m),v=document.getElementById("deleteDraw");v&&(v.disabled=!g)}}];er({title:s,content:f=>o=Sr(f,c,d),buttons:[{label:"Cancel",intent:xt,close:!0},{label:"Delete",id:"deleteDraw",disabled:!0,intent:"is-danger",close:!0,onClick:l}]})}function Idt({eventData:t,drawIds:e}){var d;const i=t.eventInfo.eventId,n=e.length===1&&((d=t==null?void 0:t.drawsData)==null?void 0:d.find(p=>e.includes(p.drawId)).drawName),r=n?`Delete ${n}`:"Delete flights";let a;const s=()=>{const p={auditReason:a.drawDeletionReason.value},h=e.map(m=>({params:{eventId:i,drawId:m,auditData:p},method:jZe}));ii({methods:h,callback:m=>m.success&&Jr({eventId:i,drawId:e[0]})})},o=[{text:"Please provide a reason for resetting draws."},{placeholder:"Explanation",field:"drawDeletionReason",validator:xT(5),error:"Five word minimum",autocomplete:"on",focus:!0},{text:"This action cannot be undone!"}],c=[{control:"drawDeletionReason",onInput:({inputs:p})=>{const h=p.drawDeletionReason.value,f=xT(5)(h),m=document.getElementById("deleteDraw");m&&(m.disabled=!f)}}];er({title:r,content:p=>a=Sr(p,o,c),buttons:[{label:"Cancel",intent:xt,close:!0},{label:"Delete",id:"deleteDraw",disabled:!0,intent:"is-danger",close:!0,onClick:s}]})}function wdt({structureId:t,drawId:e}){const i=ot.getMatchUpFormat({drawId:e,structureId:t}).matchUpFormat;BY({callback:r=>{r&&(r===i?Jt({message:"No changes",intent:"is-warning"}):ii({methods:[{params:{matchUpFormat:r,structureId:t,drawId:e},method:GZe}],callback:o=>o.success&&Jt({message:"Scoring changed"})}))},existingMatchUpFormat:i})}function Sdt({drawId:t,eventId:e,structureId:i}){const n=[{params:{drawId:t,structureId:i,force:!0},method:VZe}],r=l=>{var c;l.success?Jr({eventId:e,drawId:t,renderDraw:!0}):Jt({message:((c=l.error)==null?void 0:c.message)||"Error",intent:"is-danger "})};er({title:"Remove structure",buttons:[{intent:"is-danger",onClick:()=>ii({methods:n,callback:r}),label:"Remove",close:!0},{label:"Cancel"}],content:"<div style='font-size: 2em'>Structure will be removed!</div>"})}const{TEAM:jte}=pl;function Tdt({structureName:t,dualMatchUp:e,structureId:i,eventData:n,drawData:r,drawId:a}){var d,p;const s=(d=r.structures)==null?void 0:d.find(h=>h.stage===WC),o=(p=r.structures)==null?void 0:p.find(h=>h.structureId===i),l=n.eventInfo.eventId,c=()=>{var v;const h=e.matchUpId,f=(v=ot.findMatchUp({drawId:a,matchUpId:h}))==null?void 0:v.matchUp,m=V2({matchUp:f}),g=document.getElementById(Vh);Ys(g),g.appendChild(m)},u=[{hide:n.eventInfo.eventType!==jte,onClick:()=>HEe({matchUpId:e.matchUpId,structureId:i,eventId:l,drawId:a,callback:c}),label:"Edit scorecard",close:!0},{hide:n.eventInfo.eventType===jte,onClick:()=>wdt({structureId:i,eventId:l,drawId:a}),label:`Edit ${t} scoring`,close:!0},{hide:(o==null?void 0:o.stage)==="MAIN"&&o.stageSequence===1&&!s,onClick:()=>Sdt({drawId:a,eventId:l,structureId:i}),label:"Remove structure",close:!0},{onClick:()=>G2({eventData:n,drawIds:[a]}),label:"Delete draw"},{onClick:()=>Idt({eventData:n,drawIds:[a]}),label:"Reset draw"}];if(e){const h=e.matchUpId;u.push({divider:!0});const f=b=>b.success&&c(),g={label:"Remove players",onClick:()=>{var T;((T=ot.findMatchUp({matchUpId:h,drawId:a}).matchUp.tieMatchUps)==null?void 0:T.some(ot.checkScoreHasValue))?Jt({message:"Cannot remove when scores are present",intent:"is-warning",pauseOnHover:!0}):ii({methods:[{params:{drawId:a,matchUpId:h,inheritance:!1},method:c1e}],callback:f})},close:!0};u.push(g);const y={label:"Clear results",onClick:()=>{ii({methods:[{params:{drawId:a,matchUpId:h},method:u1e}],callback:f})},close:!0};u.push(y)}return u}function Udt({eventData:t}){const e=t.drawsData.map(({drawId:o,drawName:l})=>({label:l,checkbox:!0,field:o,id:o}));let i;const n=()=>{const o=t.drawsData.filter(({drawId:l})=>{var c;return(c=i[l])==null?void 0:c.checked}).map(({drawId:l})=>l);setTimeout(()=>G2({eventData:t,drawIds:o}),200)},r=()=>{const o=t.drawsData.filter(({drawId:c})=>{var u;return(u=i[c])==null?void 0:u.checked}).length,l=document.getElementById("deleteSelected");l&&(l.disabled=!o)},a=t.drawsData.map(({drawId:o})=>({onChange:r,control:o}));er({title:"Delete flights",content:o=>i=Sr(o,e,a),buttons:[{label:"Cancel",intent:xt,close:!0},{label:"Delete",id:"deleteSelected",intent:"is-danger",disabled:!0,close:!0,onClick:n}]})}function Ddt({eventData:t,drawId:e}){const i=()=>{const s=o=>{var l,c;if(o.drawDefinition){const u=(c=(l=o.drawDefinition.structures)==null?void 0:l[0])==null?void 0:c.structureId,d=t.eventInfo.eventId,p=o.drawDefinition.drawId;Jr({eventId:d,drawId:p,structureId:u,renderDraw:!0})}};kT({eventId:t.eventInfo.eventId,callback:s})},n=()=>Udt({eventData:t}),r=t.drawsData.length>1&&{onClick:n,label:"Delete flights",modifyLabel:!1,close:!0},a=t.drawsData.length&&{onClick:()=>Jr({eventId:t.eventInfo.eventId,drawId:e}),label:"View entries",modifyLabel:!1,close:!0};return t.drawsData.map(s=>({onClick:()=>{var u,d;const o=(d=(u=s.structures)==null?void 0:u[0])==null?void 0:d.structureId,l=t.eventInfo.eventId,c=s.drawId;Jr({eventId:l,drawId:c,structureId:o,renderDraw:!0})},label:s.drawName,close:!0})).concat([{divider:!0},a,r,{label:"Add flight",modifyLabel:!1,onClick:i}]).filter(Boolean)}function Edt(){return{eventOptions:(ot.getEvents().events??[]).map(i=>({onClick:()=>{var r,a,s,o;const n=ot.getEventData({eventId:i.eventId});if(!((a=(r=n==null?void 0:n.eventData)==null?void 0:r.drawsData)!=null&&a.length))Jr({eventId:i.eventId});else{const l=(o=(s=n.eventData.drawsData)==null?void 0:s[0])==null?void 0:o.drawId;Jr({eventId:n.eventData.eventInfo.eventId,drawId:l,renderDraw:!0})}},label:i.eventName,close:!0})).concat([{divider:!0},{label:`<div style='font-weight: bold'>${gg}</div>`,onClick:sPe,close:!0}])}}const{TEAM:Pdt}=pl;function dPe({updateParticipantFilter:t,updateControlBar:e,structureId:i,eventData:n,matchUps:r,eventId:a,drawId:s}){var f,m,g;const{eventOptions:o}=Edt(),l=Ddt({eventData:n,drawId:s}),c=(f=n==null?void 0:n.drawsData)==null?void 0:f.find(v=>v.drawId===s),u=(g=(m=c==null?void 0:c.structures)==null?void 0:m.find(v=>v.structureId===i))==null?void 0:g.structureName,d=(r==null?void 0:r.length)===1&&n.eventInfo.eventType===Pdt,p=bdt({updateControlBar:e,structureId:i,drawData:c,eventId:a}),h=Tdt({dualMatchUp:d&&r[0],structureName:u,structureId:i,eventData:n,drawData:c,drawId:s});return[{onKeyDown:v=>v.keyCode===8&&v.target.value.length===1&&t(""),onChange:v=>t(v.target.value),onKeyUp:v=>t(v.target.value),clearSearch:()=>t(""),placeholder:"Participant name",location:pi,search:!0},{options:o.length>1?o:void 0,label:n.eventInfo.eventName,modifyLabel:!0,location:pi},{options:l.length>1?l:void 0,label:c.drawName,modifyLabel:!0,location:pi},{options:p.length>1?p:void 0,label:u,modifyLabel:!0,location:pi},{options:h,intent:"is-info",label:"Actions",location:oi,align:oi}]}function HY({eventId:t,drawId:e,structureId:i,updateDisplay:n}){var m,g;const r=ot.getEventData({eventId:t}).eventData,a=(m=r==null?void 0:r.drawsData)==null?void 0:m.find(v=>v.drawId===e),s=(a==null?void 0:a.structures)||[];i=i||((g=s==null?void 0:s[0])==null?void 0:g.structureId);const o=s.find(v=>v.structureId===i),{roundMatchUps:l}=_i.makeDeepCopy(o||{}),c=Object.values(l||{}).flat();let u;const d=v=>{var y;return(y=v.searchText)==null?void 0:y.includes(u)},h=dPe({updateControlBar:HY,updateParticipantFilter:v=>{v||Object.values(It.tables).filter(Boolean).forEach(y=>y.clearFilter()),u=v==null?void 0:v.toLowerCase(),v&&Object.values(It.tables).filter(Boolean).forEach(y=>y.addFilter(d)),typeof n=="function"&&n({participantFilter:u})},structureId:i,eventData:r,drawData:a,matchUps:c,eventId:t,drawId:e}),f=document.getElementById(YC);Io({target:f,items:h})}function Cdt(t){for(const e of Array.from(document.querySelectorAll(".tmx-tm")).filter(i=>i.innerHTML===t.innerHTML))e.style.fontWeight="bold",e.style.color="#ed0c76"}function Rdt(t){for(const e of Array.from(document.querySelectorAll(".tmx-tm")).filter(i=>i.innerHTML===t.innerHTML))e.style.fontWeight="",e.style.color=""}function pPe({drawId:t,roundNumber:e,structure:i,structureId:n,callback:r}={}){n=n||(i==null?void 0:i.structureId);const a=ot.allDrawMatchUps({matchUpFilters:{structureIds:[n]},drawId:t}).matchUps||[],s=a.reduce((f,m)=>{const g=m.roundNumber;return g&&!f.includes(g)&&f.push(g),f},[]);if(e=e||s.length&&s[s.length-1],!e)return;let o;const c=[{label:"Cancel",intent:"none",close:!0},{label:"Delete",intent:"is-danger",close:!0,onClick:()=>{const f=a.filter(v=>{if(v.roundNumber===e)return v.winningSide&&o.completed.checked||v.sides.some(({participantId:y})=>y)&&!v.winningSide&&o.unscored.checked?!0:v.sides.every(({participantId:y})=>!y)&&o.empties.checked}).map(({matchUpId:v})=>v),m=[{params:{removeCompleted:o.completed.checked,removeIncomplete:o.unscored.checked,removeUnassigned:o.empties.checked,structureId:n,matchUpIds:f,drawId:t},method:r1e}],g=v=>{v.success?Ot(r)&&r({refresh:!0}):console.log({postMutationError:v.error})};f.length&&ii({methods:m,callback:g})}}],p=[{text:"Round number",fieldPair:{options:s.map(f=>({label:f,value:f})),field:"roundNumber",value:e,id:"roundNumber"}},{spacer:!0},{label:"Remove empty (TBD) matches",intent:"is-success",checkbox:!0,field:"empties",checked:!0,id:"empties"},{label:"Remove incomplete/unscored matches",intent:"is-danger",field:"unscored",checkbox:!0,id:"unscored"},{label:"Remove completed matches",intent:"is-danger",field:"completed",id:"completed",checkbox:!0,color:"red"}];er({title:"Delete matches",content:f=>o=Sr(f,p),buttons:c})}function hPe({drawId:t,structure:e,structureId:i,roundNumber:n,callback:r}={}){i=i||(e==null?void 0:e.structureId);const a=ot.allDrawMatchUps({matchUpFilters:{structureIds:[i]},drawId:t}).matchUps||[],s=a.reduce((v,y)=>{const b=y.roundNumber;return b&&!v.includes(b)&&v.push(b),v},[]),o=Math.max(...s,1);a.length?s.push(o+1):s.length||s.push(1);let l;const u=[{label:"Cancel",intent:"none",close:!0},{label:"Add",intent:"is-success",close:!0,onClick:()=>{var w;const v=parseInt(l.roundNumber.value),y=l.matchUpsCount.value==="Auto"?void 0:parseInt(l.matchUpsCount.value),b=ot.generateAdHocMatchUps({roundNumber:v,matchUpsCount:y,structureId:i,drawId:t});if(!((w=b.matchUps)!=null&&w.length))return;const I=[{method:t1e,params:{matchUps:b.matchUps,structureId:i,drawId:t}}];ii({methods:I,callback:S=>{S.success?Ot(r)&&r({refresh:!0}):console.log(S.error)}})}}],p={text:"Round number:",fieldPair:{options:s.map(v=>({label:v,value:v})),field:"roundNumber",value:n,id:"roundNumber"}},f={text:"Number to add:",fieldPair:{options:["Auto",1,5,10].map(v=>({label:v,value:v})),field:"matchUpsCount",id:"matchUpsCount",value:"Auto"}},m=[p,{spacer:!0},f];er({title:"Add matches",content:v=>l=Sr(v,m),buttons:u})}const{ASSIGN_PARTICIPANT:Mdt}=cw;function zY({drawId:t,structure:e,structureId:i,callback:n}={}){i=i||(e==null?void 0:e.structureId);let r,a;const s=ot.allDrawMatchUps({matchUpFilters:{structureIds:[i]},drawId:t}).matchUps||[],o=s.reduce((v,y)=>{const b=y.roundNumber;return b&&!v.includes(b)&&v.push(b),v},[]),l=o[o.length-1],c=Math.max(...o,1);s.length&&o.push(c+1);const u=({matchUps:v,roundResults:y})=>{const b=[{params:{structureId:i,matchUps:v,drawId:t},method:t1e}];if(y!=null&&y.length)for(const T of y){const w=T==null?void 0:T.modifiedScaleValues;b.push({params:{modifiedScaleValues:w,replacePriorValues:!0},method:IZe})}ii({methods:b,callback:T=>{T.success?Ot(n)&&n({refresh:!0}):console.log(T.error)}})},d=v=>{var w;const y=a.wtn.checked&&"wtn"||a.utr.checked&&"utr"||"",{accessor:b,scaleName:I}=Zi.scales[y]??{};Nk(y);const T=ot.drawMatic({updateParticipantRatings:!0,dynamicRatings:!0,refreshRatings:!0,participantIds:v,scaleAccessor:b,scaleName:I,drawId:t});(w=T.matchUps)!=null&&w.length&&u(T)},p=({participantIds:v})=>{const y=ot.getParticipants({participantFilters:{participantIds:v}}).participants,b=l?s.filter(({roundNumber:S,sides:U})=>S===l&&(U==null?void 0:U.some(({participantId:P})=>P))).map(({sides:S})=>S.map(({participantId:U})=>U)).flat():[],I=b.length?b:v;IM({title:"Confirm player selection",selectedParticipantIds:I,activeOnEnter:!0,selectionLimit:99,onSelection:S=>{var P;const U=(P=S.selected)==null?void 0:P.map(({participantId:E})=>E);d(U)},action:{type:Mdt,participantsAvailable:y},update:r})},f=[{label:"Cancel",intent:"none",close:!0},{label:"Add round",intent:"is-success",close:!1,onClick:()=>{var v;if(a[_c].value===_c){const{drawDefinition:y}=ot.getEvent({drawId:t}),b=y.entries.filter(({entryStatus:I,entryStage:T})=>!["WITHDRAWN","UNGROUPED"].includes(I)&&(!T||T===e.stage)).map(({participantId:I})=>I);p({participantIds:b})}else{AI();const y=ot.generateAdHocMatchUps({newRound:!0,structureId:i,drawId:t});if(!((v=y.matchUps)!=null&&v.length))return;u(y)}}}],m=[{field:_c,value:_c,options:[{label:_c,value:_c,selected:!0},{label:Q4,value:!1}]},{options:[{text:"WTN",field:"wtn",checked:Zi.activeScale===PE},{text:"UTR",field:"utr",checked:Zi.activeScale===yI},{text:"None",field:"none",checked:!Zi.activeScale}],onClick:v=>console.log({x:v}),label:"Level of play",field:"levelOfPlay",id:"levelOfPlay",radio:!0}];r=er({title:"Add round",content:v=>a=Sr(v,m),structure:e,buttons:f}).update}const fPe="Delete matches",mPe="Add matches",gPe="Add round";function Ndt({structure:t,drawId:e,callback:i}){if(!ot.isAdHoc({structure:t}))return{};const n=()=>i({refresh:!0});return{label:"Round actions",options:[{onClick:()=>hPe({drawId:e,structure:t,callback:n}),label:mPe,color:"blue"},{onClick:()=>zY({drawId:e,structure:t,newRound:!0,callback:n}),label:gPe,color:"blue"},{label:fPe,color:"red",onClick:()=>pPe({drawId:e,structure:t,callback:n})}],selection:!1,location:oi,align:oi}}const{CONTAINER:Adt}=Qr;function _dt({callback:t,structure:e,existingView:i}){const n=o=>i!==o&&t({refresh:!0,view:o}),r=(e==null?void 0:e.structureType)===Adt,a=ot.isAdHoc({structure:e}),s=[];return s.push({active:!i||i===yj,onClick:()=>n(yj),label:a?"Columns":"Draw",close:!0}),s.push({active:i===QS,onClick:()=>n(QS),label:"Table",close:!0}),(a||r)&&s.push({active:i===JS,onClick:()=>n(JS),label:"Stats",close:!0}),{tabs:s}}const{MAIN:kdt,QUALIFYING:xdt,VOLUNTARY_CONSOLATION:Odt}=Qr;function qY({updateDisplay:t,callback:e,structure:i,drawId:n,existingView:r}){var h;const a=document.getElementById(t5),{sourceStructuresComplete:s,hasDrawFeedProfile:o}=i??{},l=!((i==null?void 0:i.stage)===kdt&&(i==null?void 0:i.stageSequence)===1)&&(i==null?void 0:i.stage)!==xdt&&o,c=ot.isAdHoc({structure:i}),u=[];if(l){const f=()=>{const g={params:{structureId:i.sourceStructureIds[0],drawId:n},method:MZe};ii({methods:[g],callback:y=>{y.success&&typeof t=="function"&&t()}})},m=(h=i.positionAssignments)==null?void 0:h.filter(({participantId:g})=>g).length;u.push({intent:s?"is-primary":xt,disabled:s!==!0,visible:!m,onClick:f,label:"Auto position",location:oi})}const d=({refresh:f,view:m})=>typeof e=="function"&&e({refresh:f,view:m});if(c){const f=Ndt({structure:i,drawId:n,callback:e});u.push(f)}(i==null?void 0:i.stage)===Odt&&console.log("voluntary controlBar with [View participants]");const p=_dt({structure:i,existingView:r,drawId:n,callback:d}).tabs;u.push({onClick:()=>d({refresh:!0,view:"participants"}),id:"roundDisplayTabs",location:pi,tabs:p}),u.length&&Io({target:a,items:u})}function H2(){[t5,Tfe,Ufe].forEach(t=>{const e=document.getElementById(t);e&&Ys(e)})}const Ldt=t=>t.reduce((e,i)=>e+parseFloat(i),0),Gte=t=>parseFloat((Ldt(t)/t.length).toFixed(2));function Hte({participantResult:t,drawPosition:e,participantId:i,participantMap:n}={}){var d,p;const r=`${(t==null?void 0:t.pointsWon)||0}/${(t==null?void 0:t.pointsLost)||0}`,a=`${(t==null?void 0:t.gamesWon)||0}/${(t==null?void 0:t.gamesLost)||0}`,s=`${(t==null?void 0:t.setsWon)||0}/${(t==null?void 0:t.setsLost)||0}`,o=(t==null?void 0:t.groupOrder)||(t==null?void 0:t.provisionalOrder),l=(d=t==null?void 0:t.pressureScores)!=null&&d.length?Gte(t.pressureScores):0,c=(p=t==null?void 0:t.ratingVariation)!=null&&p.length?Gte(t.ratingVariation):0,u=n[i];return{participantName:u.participantName,groupName:u.groupName,...t,averageVariation:c,averagePressure:l,participantId:i,pointsResult:r,drawPosition:e,participant:u,gamesResult:a,setsResult:s,order:o}}function RH(t,e){return!t&&!e||t&&!e?-1:e&&!t?1:t-e}function _0(t){const e=t.getValue();return e&&`${(parseFloat(e)*100).toFixed(0)}%`}function zte(t,e){return!t&&!e||t&&!e?-1:e&&!t?1:e-t}function Fdt(){return[{headerMenu:xm({}),field:"drawPosition",headerSort:!1,hozAlign:pi,width:55},{formatter:"responsiveCollapse",hozAlign:mi,responsive:!1,headerSort:!1,resizable:!1,width:50},{formatter:Ww(({event:t,cell:e,...i})=>console.log("cell clicked",{event:t,cell:e,undefined:void 0,params:i})),sorter:NT,field:"participantName",responsive:!1,resizable:!1,maxWidth:400,minWidth:200,widthGrow:2,title:"Name"},{headerHozAlign:mi,headerWordWrap:!0,title:"Match W/L",hozAlign:mi,maxWidth:80,field:"result"},{formatter:_0,headerHozAlign:mi,headerWordWrap:!0,field:"matchUpsPct",title:"Match Win%",hozAlign:mi,maxWidth:80},{headerHozAlign:mi,headerWordWrap:!0,field:"setsResult",title:"Sets W/L",hozAlign:mi,maxWidth:80},{formatter:_0,headerHozAlign:mi,headerWordWrap:!0,title:"Set Win%",hozAlign:mi,field:"setsPct",maxWidth:80},{headerHozAlign:mi,headerWordWrap:!0,field:"gamesResult",title:"Games W/L",hozAlign:mi,maxWidth:80},{formatter:_0,headerHozAlign:mi,headerWordWrap:!0,title:"Game Win%",hozAlign:mi,field:"gamesPct",maxWidth:80},{headerHozAlign:mi,headerWordWrap:!0,field:"pointsResult",title:"Points W/L",hozAlign:mi,maxWidth:80},{formatter:_0,headerHozAlign:mi,headerWordWrap:!0,title:"Points Win%",field:"pointsPct",hozAlign:mi,maxWidth:80},{formatter:_0,field:"averageVariation",headerHozAlign:mi,sorter:zte,hozAlign:mi,maxWidth:70,title:"RV"},{formatter:_0,field:"averagePressure",headerHozAlign:mi,sorter:zte,hozAlign:mi,maxWidth:70,title:"PS"},{headerHozAlign:mi,field:"pressureOrder",sorter:RH,title:"PS#",hozAlign:mi,maxWidth:80},{headerHozAlign:mi,sorter:RH,hozAlign:mi,title:"Order",field:"order",maxWidth:80},{field:"groupName",visible:!1,title:"Group"}]}async function vPe({eventId:t,drawId:e,structureId:i}){let n,r,a,s;const o=y=>(y??[]).reduce((b,I)=>(b[I.participantId]=I,b),{}),l={},c=()=>{var w,S;const{participants:y,eventData:b}=ot.getEventData({participantsProfile:{withScaleValues:!0},allParticipantResults:!0,pressureRating:!0,refreshResults:!0,eventId:t}),I=(w=b==null?void 0:b.drawsData)==null?void 0:w.find(U=>U.drawId===e);return r=(S=I==null?void 0:I.structures)==null?void 0:S.find(U=>U.structureId===i),s||(s=o(y)),(r!=null&&r.roundMatchUps?Object.values(r.roundMatchUps).flat():[]).forEach(({sides:U,structureName:P,structureId:E})=>{l[E]=P,U.forEach(R=>{R.participantId&&(s[R.participantId].groupName=P)})}),((r==null?void 0:r.participantResults)??[]).filter(U=>{var E;const P=s[U.participantId];return!a||((E=P==null?void 0:P.participantName)==null?void 0:E.toLowerCase().includes(a==null?void 0:a.toLowerCase()))})},u=c(),d=()=>u==null?void 0:u.map(y=>Hte({...y,participantMap:s})).sort((y,b)=>RH(y.order,b.order)),p=()=>{var y;return(y=c())==null?void 0:y.map(b=>Hte({...b,participantMap:s}))},h=y=>{(y==null?void 0:y.participantFilter)!==void 0&&(a=y.participantFilter),n.replaceData(p())},f=d(),m=Fdt();return(y=>{km({anchorId:Vh});const b=document.getElementById(Vh),I=Object.values(l).length>1?["groupName"]:void 0;n=new As(b,{headerSortElement:rf(["averageVariation","averagePressure","participantName","pressureOrder","pointsResult","gamesResult","matchUpsPct","setsResult","pointsPct","gamesPct","setsPct","result","order"]),responsiveLayoutCollapseStartOpen:!1,height:window.innerHeight*.85,groupHeader:[T=>T],placeholder:"No participants",responsiveLayout:"collapse",layout:"fitColumns",reactiveData:!0,index:"matchUpId",groupBy:I,columns:m,data:y})})(f),qY({structure:r,drawId:e,existingView:JS,callback:({refresh:y,view:b}={})=>{H2(),b?Jr({eventId:t,drawId:e,structureId:i,renderDraw:!0,view:b}):vP({eventId:t,drawId:e,structureId:i,redraw:y,roundsView:b})}}),HY({eventId:t,drawId:e,structureId:i,updateDisplay:h}),{table:n,replaceTableData:h}}const qte=function(){let t,e={elapsed:1e5,held:void 0,touched:void 0,holdTime:800,holdAction:void 0,holdActions:{}};const i={};let n={};const r=(d,p)=>d.filter(h=>p.indexOf(h)!==-1).filter((h,f,m)=>m.indexOf(h)===f);e.reset=()=>(n={},e),e.register=(d,p,h,f)=>(typeof h=="function"&&(n[p]||(n[p]={},i[p]=[]),n[p][d]={fx:h,delay:f},i[p]=Object.keys(n[p])),e),e.deRegister=(d,p)=>(n[p]&&(delete n[p][d],i[p]=Object.keys(n[p])),e),e.call=(d,p,...h)=>{var f,m;return(m=(f=n==null?void 0:n[p])==null?void 0:f[d])==null?void 0:m.fx(...h)},e.trigger=(d,p,h,f)=>n[p][d].fx(h,f,p),e.list=()=>console.log(n);const a="ontouchstart"in document.documentElement?"touchstart":"click";document.addEventListener(a,d=>o({evt:d,evnt:"tap"})),document.addEventListener("change",d=>o({evt:d,evnt:"change"})),document.addEventListener("click",d=>o({evt:d,evnt:"click"})),document.addEventListener("mouseover",d=>o({evt:d,evnt:"mouseover",stopPropagation:!1})),document.addEventListener("mouseout",d=>o({evt:d,evnt:"mouseout",stopPropagation:!1})),document.addEventListener("keyup",d=>o({evt:d,evnt:"keyup",stopPropagation:!1}));let s=0;function o({evt:d,evnt:p,stopPropagation:h=!0}){h&&d.stopPropagation();const f={x:d.clientX,y:d.clientY,pageX:d.pageX,pageY:d.pageY};let m=Array.from(d.target.classList),g=m.length&&i[p]?r(m,i[p]):[];if(g.length){let v=new Date().getTime();e.elapsed=v-s,s=v,g.forEach(y=>{l({cls:y,evt:d,evnt:p,mouse:f})})}}function l({cls:d,evt:p,evnt:h,mouse:f}){let m=p.target;n[h][d].fx(m,f,h,p)}document.addEventListener("touchstart",d=>{e.touched=d.target,e.coords=[d.touches[0].clientX,d.touches[0].clientY],e.touched&&(t=setTimeout(function(){u()},e.holdTime))},!1),document.addEventListener("touchend",function(){c()},!1),document.addEventListener("touchmove",function(d){e.touched!==d.target&&c()},!1);function c(){clearTimeout(t)}function u(){typeof e.holdAction=="function"&&(e.held=e.touched,e.holdAction(e.held,e.coords))}return function(){let d=!1,p,h="";function f(){clearTimeout(p),d=!0,h!=="can-touch"&&(h="can-touch",document.documentElement.classList.add(h)),p=setTimeout(function(){d=!1},500)}function m(){!d&&h==="can-touch"&&(d=!1,h="",document.documentElement.classList.remove("can-touch"))}document.addEventListener("touchstart",f,!1),document.addEventListener("mouseover",m,!1)}(),e}();function $dt({structure:t,drawId:e,callback:i}){const n=document.createElement("div");n.className="flexcol flexcenter",n.style.width="100%",n.style.height="300px";const r=document.createElement("button");r.onclick=s=>{s.stopPropagation(),s.preventDefault(),zY({newRound:!0,structure:t,callback:i,drawId:e})},r.className="button is-info",r.innerHTML="Generate round",n.appendChild(r);const a=document.getElementById(Vh);a&&a.appendChild(n)}function Bdt({drawData:t,eventId:e,drawId:i}){const n=document.createElement("div");n.className="flexcol flexcenter",n.style.width="100%",n.style.height="300px";const r=document.createElement("button");r.onclick=s=>{s.stopPropagation(),s.preventDefault();const o=t.drawName;kT({callback:l=>{var u,d,p;const c=(p=(d=(u=l.drawDefinition)==null?void 0:u.structures)==null?void 0:d.find(({stage:h})=>h===WC))==null?void 0:p.structureId;Jr({eventId:e,drawId:i,structureId:c,renderDraw:!0})},isQualifying:!0,drawName:o,eventId:e,drawId:i})},r.className="button is-info",r.innerHTML="Generate qualifying",n.appendChild(r);const a=document.getElementById(Vh);a&&a.appendChild(n)}const Wte={ALTERNATE:"Assign alternate",ASSIGN:"Assign participant",BYE:"Assign BYE",REMOVE_PARTICIPANT:"Remove assignment",REMOVE:"Remove assignment",QUALIFIER:"Assign qualifier",LUCKY:"Assign Lucky Loser",SEED_VALUE:"Assign seed",SWAP:"Swap draw positions",WITHDRAW:"Withdraw participant"};function Vdt({pointerEvent:t,actions:e,callback:i}){const n=t.target,r=s=>{["WITHDRAW","BYE","REMOVE","REMOVE_PARTICIPANT"].includes(s.type)&&jdt({action:s,callback:i}),["ASSIGN","ALTERNATE","SWAP","QUALIFIER","LUCKY"].includes(s.type)&&Gdt({action:s,callback:i}),["SEED_VALUE"].includes(s.type)&&Hdt({target:n,action:s,callback:i})},a=e==null?void 0:e.filter(({type:s})=>Wte[s]).map(s=>({option:Wte[s.type]||s.type,onClick:()=>r(s)}));a!=null&&a.length&&Ic({options:a,target:n,config:{arrow:!1,offset:[0,0]}})}function jdt({action:t,callback:e}){const i=r=>r.success?e():console.log({result:r}),n=[{method:t.method,params:t.payload}];ii({methods:n,callback:i})}function Gdt({action:t,callback:e}){IM({action:t,onSelection:n=>{const r=s=>s.success?e():console.log({result:s}),a=[{params:{...t.payload,...n},method:t.method}];ii({methods:a,callback:r})},selectOnEnter:!0})}function Hdt({target:t,action:e,callback:i}){let n;function r(s){if((s==null?void 0:s.key)==="Enter"){const o=s.target.value;if(_i.isConvertableInteger(o)){const l=u=>u.success?i():console.log({result:u}),c=[{params:{...e.payload,seedValue:o},method:e.method}];ii({methods:c,callback:l})}n.destroy()}}n=Ic({menuItems:[{label:"Assign seed number ",validator:uh,placeholder:"Seed number",field:"seedNumber",id:"seedNumber",type:"input",focus:!0,onKeyDown:r}],target:t,config:{arrow:!1,offset:[0,0]}})}function zdt(t){var a,s,o,l;const{structureId:e,drawId:i}=(t==null?void 0:t.context)??t,n=(l=(o=(s=(a=t.eventData)==null?void 0:a.drawsData)==null?void 0:s.find(c=>c.drawId===i))==null?void 0:o.structures)==null?void 0:l.find(c=>c.structureId===e),r=[];if(ot.isAdHoc({structure:n})){const c=[{onClick:()=>hPe({...t}),text:mPe,color:"blue"},{onClick:()=>zY({...t,structure:n,roundNumber:void 0,newRound:!0}),text:gPe,color:"blue"},{onClick:()=>pPe({...t}),text:fPe,color:"red"}];r.push(...c)}t!=null&&t.pointerEvent&&r.length&&Ic({items:r,target:t.pointerEvent.target,config:{placement:Ap}})}const{TEAM:qdt}=Ls;function Wdt({callback:t,drawId:e,eventData:i}){var d;const n=(d=i==null?void 0:i.drawsData)==null?void 0:d.flatMap(({structures:p})=>p.flatMap(h=>{var f;return[(f=h.structures)==null?void 0:f.flatMap(m=>Object.values(m.roundMatchUps||{}).flat()),...Object.values(h.roundMatchUps||{}).flat()]}).filter(Boolean)),r=_i.createMap(n,"matchUpId"),a=p=>{const h=R1(p.pointerEvent.target,"tmx-m","id");return r[h]},s=p=>parseInt(R1(p.pointerEvent.target,"tmx-sd","sideNumber")),o=p=>R1(p.pointerEvent.target,"tmx-str","id"),l=p=>parseInt(R1(p.pointerEvent.target,"tmx-rd","roundNumber")),c=p=>{var v;const h=a(p),f=s(p),m=p.side||((v=h.sides)==null?void 0:v.find(y=>y.sideNumber===f)),{validActions:g}=h.drawId&&ot.positionActions({sideNumber:f||(m==null?void 0:m.sideNumber),structureId:h==null?void 0:h.structureId,drawPosition:m==null?void 0:m.drawPosition,matchUpId:h==null?void 0:h.matchUpId,drawId:h==null?void 0:h.drawId,policyDefinitions:{positionActions:{},...Jf.policies.POLICY_POSITION_ACTIONS_UNRESTRICTED}})||{};Vdt({...p,actions:g,callback:t})},u=p=>{var v;const h=s(p),f=a(p),{validActions:m}=ot.matchUpActions({matchUpId:f.matchUpId,drawId:f.drawId,sideNumber:h})||{},g=m==null?void 0:m.find(({type:y})=>y==="SCORE");if(g)if(f.matchUpType===qdt){const y=()=>t(),b=(v=i==null?void 0:i.eventInfo)==null?void 0:v.eventName,{matchUpId:I,drawId:T}=f;B2({title:b,drawId:T,matchUpId:I,onClose:y})}else TM({matchUpId:g.payload.matchUpId,callback:t})};return{centerInfoClick:()=>console.log("centerInfo click"),roundHeaderClick:p=>{const h=l(p),f=o(p);return zdt({pointerEvent:p.pointerEvent,roundNumber:h,structureId:f,eventData:i,callback:t,drawId:e})},scheduleClick:p=>{if(p!=null&&p.pointerEvent){p.pointerEvent.stopPropagation();const h=R1(p.pointerEvent.target,"tmx-m","id"),f=r[h];$Y({pointerEvent:p.pointerEvent,matchUp:f,callback:t})}},venueClick:p=>{var f,m,g,v;const h=a(p);if(p!=null&&p.pointerEvent&&((f=h==null?void 0:h.schedule)!=null&&f.venueId)){const y=h.schedule.venueId,b=(v=(g=(m=ot.findVenue({venueId:y}))==null?void 0:m.venue)==null?void 0:g.addresses)==null?void 0:v[0],{latitude:I,longitude:T}=b||{};if(!I||!T)return;const w=`https://www.google.com/maps/@?api=1&map_action=map&center=${I}%2C${T}&zoom=18&basemap=satellite`,S=`https://bing.com/maps/default.aspx?cp=${I}~${T}&lvl=17&style=h`,U=E=>{const R=E&&I&&T&&(E==="google"&&w||S);R&&window.open(R,"_blank")};Ic({items:[{heading:"Venue Location"},{divider:"divider"},{onClick:()=>U("google"),hide:!I||!T,text:"Open in Google Maps"},{onClick:()=>U("bing"),hide:!I||!T,text:"Open in Bing Maps"}],target:p.pointerEvent.target,config:{placement:Ap}})}},participantClick:c,matchUpClick:u,scoreClick:u}}var Yte=11;function Ydt(t,e){var i=e.attributes,n,r,a,s,o;if(!(e.nodeType===Yte||t.nodeType===Yte)){for(var l=i.length-1;l>=0;l--)n=i[l],r=n.name,a=n.namespaceURI,s=n.value,a?(r=n.localName||r,o=t.getAttributeNS(a,r),o!==s&&(n.prefix==="xmlns"&&(r=n.name),t.setAttributeNS(a,r,s))):(o=t.getAttribute(r),o!==s&&t.setAttribute(r,s));for(var c=t.attributes,u=c.length-1;u>=0;u--)n=c[u],r=n.name,a=n.namespaceURI,a?(r=n.localName||r,e.hasAttributeNS(a,r)||t.removeAttributeNS(a,r)):e.hasAttribute(r)||t.removeAttribute(r)}}var yN,Kdt="http://www.w3.org/1999/xhtml",Hu=typeof document>"u"?void 0:document,Zdt=!!Hu&&"content"in Hu.createElement("template"),Xdt=!!Hu&&Hu.createRange&&"createContextualFragment"in Hu.createRange();function Jdt(t){var e=Hu.createElement("template");return e.innerHTML=t,e.content.childNodes[0]}function Qdt(t){yN||(yN=Hu.createRange(),yN.selectNode(Hu.body));var e=yN.createContextualFragment(t);return e.childNodes[0]}function ept(t){var e=Hu.createElement("body");return e.innerHTML=t,e.childNodes[0]}function tpt(t){return t=t.trim(),Zdt?Jdt(t):Xdt?Qdt(t):ept(t)}function bN(t,e){var i=t.nodeName,n=e.nodeName,r,a;return i===n?!0:(r=i.charCodeAt(0),a=n.charCodeAt(0),r<=90&&a>=97?i===n.toUpperCase():a<=90&&r>=97?n===i.toUpperCase():!1)}function ipt(t,e){return!e||e===Kdt?Hu.createElement(t):Hu.createElementNS(e,t)}function npt(t,e){for(var i=t.firstChild;i;){var n=i.nextSibling;e.appendChild(i),i=n}return e}function jB(t,e,i){t[i]!==e[i]&&(t[i]=e[i],t[i]?t.setAttribute(i,""):t.removeAttribute(i))}var Kte={OPTION:function(t,e){var i=t.parentNode;if(i){var n=i.nodeName.toUpperCase();n==="OPTGROUP"&&(i=i.parentNode,n=i&&i.nodeName.toUpperCase()),n==="SELECT"&&!i.hasAttribute("multiple")&&(t.hasAttribute("selected")&&!e.selected&&(t.setAttribute("selected","selected"),t.removeAttribute("selected")),i.selectedIndex=-1)}jB(t,e,"selected")},INPUT:function(t,e){jB(t,e,"checked"),jB(t,e,"disabled"),t.value!==e.value&&(t.value=e.value),e.hasAttribute("value")||t.removeAttribute("value")},TEXTAREA:function(t,e){var i=e.value;t.value!==i&&(t.value=i);var n=t.firstChild;if(n){var r=n.nodeValue;if(r==i||!i&&r==t.placeholder)return;n.nodeValue=i}},SELECT:function(t,e){if(!e.hasAttribute("multiple")){for(var i=-1,n=0,r=t.firstChild,a,s;r;)if(s=r.nodeName&&r.nodeName.toUpperCase(),s==="OPTGROUP")a=r,r=a.firstChild;else{if(s==="OPTION"){if(r.hasAttribute("selected")){i=n;break}n++}r=r.nextSibling,!r&&a&&(r=a.nextSibling,a=null)}t.selectedIndex=i}}},B1=1,Zte=11,Xte=3,Jte=8;function yv(){}function rpt(t){if(t)return t.getAttribute&&t.getAttribute("id")||t.id}function apt(t){return function(i,n,r){if(r||(r={}),typeof n=="string")if(i.nodeName==="#document"||i.nodeName==="HTML"||i.nodeName==="BODY"){var a=n;n=Hu.createElement("html"),n.innerHTML=a}else n=tpt(n);else n.nodeType===Zte&&(n=n.firstElementChild);var s=r.getNodeKey||rpt,o=r.onBeforeNodeAdded||yv,l=r.onNodeAdded||yv,c=r.onBeforeElUpdated||yv,u=r.onElUpdated||yv,d=r.onBeforeNodeDiscarded||yv,p=r.onNodeDiscarded||yv,h=r.onBeforeElChildrenUpdated||yv,f=r.skipFromChildren||yv,m=r.addChild||function(k,O){return k.appendChild(O)},g=r.childrenOnly===!0,v=Object.create(null),y=[];function b(k){y.push(k)}function I(k,O){if(k.nodeType===B1)for(var $=k.firstChild;$;){var F=void 0;O&&(F=s($))?b(F):(p($),$.firstChild&&I($,O)),$=$.nextSibling}}function T(k,O,$){d(k)!==!1&&(O&&O.removeChild(k),p(k),I(k,$))}function w(k){if(k.nodeType===B1||k.nodeType===Zte)for(var O=k.firstChild;O;){var $=s(O);$&&(v[$]=O),w(O),O=O.nextSibling}}w(i);function S(k){l(k);for(var O=k.firstChild;O;){var $=O.nextSibling,F=s(O);if(F){var V=v[F];V&&bN(O,V)?(O.parentNode.replaceChild(V,O),P(V,O)):S(O)}else S(O);O=$}}function U(k,O,$){for(;O;){var F=O.nextSibling;($=s(O))?b($):T(O,k,!0),O=F}}function P(k,O,$){var F=s(O);if(F&&delete v[F],!$){var V=c(k,O);if(V===!1||(V instanceof HTMLElement&&(k=V,w(k)),t(k,O),u(k),h(k,O)===!1))return}k.nodeName!=="TEXTAREA"?E(k,O):Kte.TEXTAREA(k,O)}function E(k,O){var $=f(k,O),F=O.firstChild,V=k.firstChild,j,B,z,W,Z;e:for(;F;){for(W=F.nextSibling,j=s(F);!$&&V;){if(z=V.nextSibling,F.isSameNode&&F.isSameNode(V)){F=W,V=z;continue e}B=s(V);var K=V.nodeType,Q=void 0;if(K===F.nodeType&&(K===B1?(j?j!==B&&((Z=v[j])?z===Z?Q=!1:(k.insertBefore(Z,V),B?b(B):T(V,k,!0),V=Z,B=s(V)):Q=!1):B&&(Q=!1),Q=Q!==!1&&bN(V,F),Q&&P(V,F)):(K===Xte||K==Jte)&&(Q=!0,V.nodeValue!==F.nodeValue&&(V.nodeValue=F.nodeValue))),Q){F=W,V=z;continue e}B?b(B):T(V,k,!0),V=z}if(j&&(Z=v[j])&&bN(Z,F))$||m(k,Z),P(Z,F);else{var J=o(F);J!==!1&&(J&&(F=J),F.actualize&&(F=F.actualize(k.ownerDocument||Hu)),m(k,F),S(F))}F=W,V=z}U(k,V,B);var se=Kte[k.nodeName];se&&se(k,O)}var R=i,C=R.nodeType,M=n.nodeType;if(!g){if(C===B1)M===B1?bN(i,n)||(p(i),R=npt(i,ipt(n.nodeName,n.namespaceURI))):R=n;else if(C===Xte||C===Jte){if(M===C)return R.nodeValue!==n.nodeValue&&(R.nodeValue=n.nodeValue),R;R=n}}if(R===n)p(i);else{if(n.isSameNode&&n.isSameNode(R))return;if(P(R,n,g),y)for(var _=0,A=y.length;_<A;_++){var N=v[y[_]];N&&T(N,N.parentNode,!1)}}return!g&&R!==i&&i.parentNode&&(R.actualize&&(R=R.actualize(i.ownerDocument||Hu)),i.parentNode.replaceChild(R,i)),R}}var spt=apt(Ydt);const{DOUBLES:opt,TEAM:Qte}=pl;function vP({eventId:t,drawId:e,structureId:i,roundsView:n,redraw:r}){var M,_,A,N;const a=ot.getEvents().events;if(!(a!=null&&a.length))return;let s;qte.register("tmx-tm","mouseover",Cdt),qte.register("tmx-tm","mouseout",Rdt);let o,l,c,u,d,p,h,f,m;const g=()=>{var k,O,$,F;u=(k=ot.getEventData({participantsProfile:{convertExtensions:!0,withScaleValues:!0,withGroupings:!0,withISO2:!0,withIOC:!0},includePositionAssignments:!0,eventId:t}))==null?void 0:k.eventData,d=(O=u==null?void 0:u.eventInfo)==null?void 0:O.eventType,h=($=u==null?void 0:u.drawsData)==null?void 0:$.find(V=>V.drawId===e),c=(h==null?void 0:h.structures)||[],i=i||((F=c==null?void 0:c[0])==null?void 0:F.structureId),p=c.find(V=>V.structureId===i),s=ot.isAdHoc({structure:p}),{roundMatchUps:l,stage:m}=_i.makeDeepCopy(p||{}),f=Object.values(l||{}).flat(),s&&f.sort(_i.matchUpScheduleSort)};M2(),g();const v=k=>{const{refresh:O,view:$}=k??{},F=O||o;H2(),$?Jr({eventId:t,drawId:e,structureId:i,renderDraw:!0,view:$}):vP({eventId:t,drawId:e,structureId:i,redraw:F,roundsView:$})},y=(f==null?void 0:f.length)===1&&((M=u==null?void 0:u.eventInfo)==null?void 0:M.eventType)===Qte,b=Wdt({eventData:u,callback:v,drawId:e}),I=(p==null?void 0:p.display)||(h==null?void 0:h.display)||((_=u==null?void 0:u.eventInfo)==null?void 0:_.display)||{},T=I==null?void 0:I.compositionName,w=I==null?void 0:I.configuration,S=fk[T]||Zi.composition||fk[d===opt&&"National"||d===Qte&&"Basic"||"National"];S.configuration.flags=!1,Object.assign(S.configuration,w),S.configuration.scaleAttributes&&(S.configuration.scaleAttributes=Zi.scales[Zi.activeScale]),Zi.composition||(S.configuration.genderColor=!0,S.configuration.showAddress=void 0,S.configuration.allDrawPositions=!0,S.configuration.drawPositions=!0),S.configuration.roundHeader=!0;const U=document.getElementById(Vh);r&&Ys(U);const P=()=>{var O,$;if(y)return;for(const F of Object.keys((p==null?void 0:p.roundMatchUps)??{}))p.roundMatchUps[F]=(O=l==null?void 0:l[F])==null?void 0:O.filter(({sides:V})=>(V==null?void 0:V.some(({participant:B})=>B==null?void 0:B.participantName.toLowerCase().includes(o)))||!o);const k=Object.values(p.roundMatchUps||{}).flat();if(f.length)if(n===QS)yPe({matchUps:k,eventData:u});else if(n===JS)vPe({eventId:t,drawId:e,structureId:i});else{const F=tZe({content:eZe({context:{drawId:e,structureId:i},searchActive:o,matchUps:k,eventHandlers:b,composition:S}),theme:S.theme}),V=B=>{var z;return(z=B==null?void 0:B.classList)!=null&&z.contains("tmx-p")?B:jl(B,"tmx-p")},j=U.firstChild;j?spt(j,F,{addChild:function(B,z){var W,Z,K,Q,J,se,ie;if(z.classList){const ce=B.firstChild,oe=z.getAttribute("id"),te=![null,"undefined",void 0].includes(oe),le=(Z=(W=B.firstChild)==null?void 0:W.getAttribute)==null?void 0:Z.call(W,"id"),ne=![null,"undefined",void 0].includes(le);try{if(!te&&!ne){Zi.renderLog&&console.log("condition 0");const me=(K=V(ce))==null?void 0:K.nextSibling;me!=null&&me.getAttribute("id")&&((Q=V(ce))!=null&&Q.getAttribute("id"))&&me.parentElement.removeChild(me)}else te&&ne&&oe&&le&&oe!==le?(Zi.renderLog&&console.log("condition 1"),B.removeChild(B.firstChild)):(J=z.classList)!=null&&J.contains("tmx-p")&&!ne?(Zi.renderLog&&console.log("condition 2"),B.removeChild(B.firstChild)):(ie=(se=B.firstChild)==null?void 0:se.classList)!=null&&ie.contains("tmx-p")&&B.firstChild.getAttribute("id")!=="undefined"&&z.getAttribute("id")==="undefined"?(Zi.renderLog&&console.log("condition 3"),B.removeChild(B.firstChild)):!te&&ne?Zi.renderLog&&console.log("condition 4"):console.log({incomingId:te,existingId:ne,incomingIdValue:oe,existingIdValue:le})}catch(me){console.log({err:me})}}B.appendChild(z)}}):U.appendChild(F)}else if(m===WC)Bdt({drawData:h,drawId:e,eventId:t});else if(s)$dt({structure:p,drawId:e,callback:v});else{const F=($=c==null?void 0:c[0])==null?void 0:$.structureId;return vP({eventId:t,drawId:e,structureId:F,redraw:!0})}};qY({updateDisplay:()=>{g(),P()},drawId:e,structure:p,existingView:n,callback:v});const R=document.getElementById(YC),C=k=>{k&&g();const O=V=>{var j;return(j=V.searchText)==null?void 0:j.includes(o)},F=dPe({updateParticipantFilter:V=>{V||Object.values(It.tables).filter(Boolean).forEach(j=>j.clearFilter()),o=V==null?void 0:V.toLowerCase(),V&&Object.values(It.tables).filter(Boolean).forEach(j=>j.addFilter(O)),Ys(U),P()},updateControlBar:C,structureId:i,eventData:u,drawData:h,matchUps:f,eventId:t,drawId:e});Io({target:R,items:F})};if(!h){console.log("no draw data",{eventData:u,drawData:h});return}if(i=i||((N=(A=h.structures)==null?void 0:A[0])==null?void 0:N.structureId),!i){console.log("structure not found");return}if(y){const k=V2({matchUp:f[0],participantFilter:o});k&&U.appendChild(k)}else P();C()}function lpt(t,e,i,n){const r=e>1?"items":"item";return t+`<span style='color:blue; margin-left:10px;'>(${e} ${r})</span>`}const{TEAM:cpt}=Ls,upt=t=>(e,i)=>{const r=i.getRow().getData(),{matchUpId:a,readyToScore:s,matchUpType:o,drawId:l,eventName:c}=r.matchUp;if(o===cpt)B2({title:c,matchUpId:a,drawId:l,onClose:()=>t()});else if(s||Hv.checkScoreHasValue(r.matchUp)){const u=()=>{t()};TM({matchUp:r.matchUp,matchUpId:a,callback:u})}};function dpt({data:t,replaceTableData:e}){const i=(o,l)=>{var h,f;const u=l.getRow().getData(),{courtName:d,scheduledDate:p}=u;if(d&&p){const m=(f=(h=ot.getTournament())==null?void 0:h.tournamentRecord)==null?void 0:f.tournamentId,g=`/${Ps}/${m}/${dy}/${p}`;It.router.navigate(g)}},n=()=>e(),r=t.some(o=>o.courtName),a=(o,l)=>fP(o,l,n),s=o=>{const l=document.createElement("div");l.className="has-text-warning-dark",l.innerHTML="Select participant";const c=({event:d,...p})=>{fP(d,o,n,p)};return o.getValue().participantName&&Ww(c)(o,l)};return[{cellClick:(o,l)=>l.getRow().toggleSelect(),titleFormatter:"rowSelection",formatter:"rowSelection",headerSort:!1,responsive:!1,hozAlign:pi,width:5},{formatter:"responsiveCollapse",headerSort:!1,resizable:!1,hozAlign:mi,minWidth:50,width:50},{headerMenu:xm({duration:"Duration",complete:"Complete"}),formatter:"rownum",headerSort:!1,hozAlign:pi,width:55},{title:"Flight",visible:!1,minWidth:150,field:"flight",widthGrow:1},{cellClick:i,field:"scheduledDate",title:"Date",width:110},{cellClick:i,visible:!!r,field:"courtName",title:"Court",width:100},{cellClick:i,field:"scheduleTime",headerSort:!1,visible:!1,title:"Time",width:70},{formatter:s,cellClick:a,sorter:NT,responsive:!1,title:"Side 1",minWidth:180,field:"side1",widthGrow:1},{formatter:s,cellClick:a,sorter:NT,responsive:!1,title:"Side 2",minWidth:180,field:"side2",widthGrow:1},{cellClick:upt(e),formatter:FY,sorter:WEe,field:"scoreDetail",responsive:!1,title:"Score",width:140},{sorter:_Ee,formatter:kEe,field:"competitiveProfile",responsive:!1,title:"Profile",visible:!1,width:140},{title:"<div class='fa-solid fa-check' style='color: green' />",formatter:"tickCross",field:"complete",hozAlign:pi,tooltip:!1,width:40},{field:"matchUp.matchUpStatus",title:"Status",width:150},{title:"<div class='fa-solid fa-clock' style='color: blue' />",headerSort:!1,field:"duration",visible:!1,width:70},{cellClick:(o,l)=>$Y({pointerEvent:o,...l.getData()}),formatter:av,responsive:!1,headerSort:!1,hozAlign:oi,widthGrow:0,width:50}]}const{TEAM:ppt}=pl,eie=t=>{var A,N,k,O,$;const{potentialParticipants:e,structureName:i,matchUpType:n,roundNumber:r,matchUpId:a,roundName:s,schedule:o,eventId:l,drawId:c,sides:u,...d}=t,{scheduledDate:p,scheduleTime:h,courtName:f}=o||{},m=F=>{var V;return((V=F.person)==null?void 0:V.standardFamilyName)||F.participantName},g=(e==null?void 0:e.map(F=>({participantName:F.map(m).filter(Boolean).join(" or ")})))||[],v=((A=u==null?void 0:u[0])==null?void 0:A.participant)||g.shift(),y=((N=u==null?void 0:u[1])==null?void 0:N.participant)||g.shift(),b={participantName:v==null?void 0:v.participantName,sex:(k=v==null?void 0:v.person)==null?void 0:k.sex,participant:v},I={participantName:y==null?void 0:y.participantName,sex:(O=y==null?void 0:y.person)==null?void 0:O.sex,participant:y},T=u.flatMap(({participant:F})=>{var V;return(V=F==null?void 0:F.individualParticipantIds)!=null&&V.length?F.individualParticipantIds:F==null?void 0:F.participantId}).filter(Boolean),w=d.winningSide===1&&"side1"||d.winningSide===2&&"side2"||void 0,S=!!d.winningSide,U=!!(d.winningSide||d.readyToScore),P=($=d.score)==null?void 0:$.scoreStringSide1,E=u.flatMap(F=>{var j,B,z;const V=(j=F.participant)==null?void 0:j.person;return V?[V.standardGivenName,V.standardFamilyName]:(z=(B=F.participant)==null?void 0:B.individualParticipants)==null?void 0:z.map(({person:W})=>[W.standardGivenName,W.standardFamilyName])}).filter(Boolean).join(" ").toLowerCase(),R=GDe([E,v==null?void 0:v.participantName,y==null?void 0:y.participantName].filter(Boolean).join(" ")).toLowerCase(),C=t.collectionId?ppt:n,M=t.competitiveness?{competitiveness:t.competitiveness}:t.competitiveProfile,_={score:P,matchUpStatus:t.matchUpStatus,readyToScore:U,complete:S,winningSide:w};return{matchUpStatus:t.matchUpStatus,individualParticipantIds:T,flight:t.drawName,competitiveProfile:M,structureName:i,scheduledDate:p,readyToScore:U,scheduleTime:h,matchUpType:n,scoreDetail:_,winningSide:w,roundNumber:r,searchText:R,courtName:f,eventType:C,matchUpId:a,roundName:s,complete:S,eventId:l,matchUp:t,drawId:c,side1:b,side2:I,score:P}},{CONTAINER:hpt}=Qr;async function yPe({eventId:t,drawId:e,structureId:i,matchUps:n,eventData:r}){let a,s,o,l;const c=()=>{var U,P;const y={withISO2:!0,withScaleValues:!0},b={withCompetitiveness:!0},I=ot.getEventData({eventId:t,contextProfile:b,participantsProfile:y}).eventData,T=(U=I==null?void 0:I.drawsData)==null?void 0:U.find(E=>E.drawId===e);s=(P=T==null?void 0:T.structures)==null?void 0:P.find(E=>E.structureId===i),l=(s==null?void 0:s.structureType)===hpt;const w=s!=null&&s.roundMatchUps?Object.values((s==null?void 0:s.roundMatchUps)||{}).flat():[],S=w.flatMap(E=>E.tieMatchUps||[]);return S.length&&w.push(...S),w.filter(({matchUpStatus:E})=>E!=="BYE").filter(({sides:E})=>!o||E.find(R=>{var C,M;return(M=(C=R.participant)==null?void 0:C.participantName)==null?void 0:M.toLowerCase().includes(o==null?void 0:o.toLowerCase())}))};n||(n=c()),r&&n.forEach(y=>y.eventName=r.eventInfo.eventName);const u=()=>n.map(eie),d=()=>c().map(eie),p=y=>{y!=null&&y.participantFilter&&(o=y.participantFilter),a.replaceData(d())},h=u(),f=dpt({data:h,replaceTableData:p}),m=l?["roundName","structureName"]:["roundName"];return(y=>{km({anchorId:Vh});const b=document.getElementById(Vh);a=new As(b,{groupHeader:[lpt,I=>I],headerSortElement:rf(["complete","duration","score"]),responsiveLayoutCollapseStartOpen:!1,height:window.innerHeight*.85,responsiveLayout:"collapse",placeholder:"No matches",layout:"fitColumns",reactiveData:!0,index:"matchUpId",groupBy:m,columns:f,data:y})})(h),qY({structure:s,drawId:e,existingView:QS,callback:({refresh:y,view:b}={})=>{H2(),b?Jr({eventId:t,drawId:e,structureId:i,renderDraw:!0,view:b}):vP({eventId:t,drawId:e,structureId:i,redraw:y,roundsView:b})}}),HY({eventId:t,drawId:e,structureId:i,updateDisplay:p}),{table:a,replaceTableData:p}}function IN({eventId:t,renderDraw:e}={}){const i=document.getElementById(Dfe),n=document.getElementById(Sfe),r=document.getElementById(Vh),a=document.getElementById(Efe);a&&(a.style.display=t||e?"":xt),i&&(i.style.display=t&&!e?"":xt),n&&(n.style.display=t||e?xt:""),r&&(r.style.display=e?"":xt)}function fpt({eventId:t,drawId:e,headerElement:i}){const{event:n,drawDefinition:r}=ot.getEvent({eventId:t,drawId:e});return n&&r?(i.innerHTML=n.eventName,{success:!0}):{}}const bPe=t=>({drawDefinition:e,scaleValues:i})=>{var h,f,m,g,v,y,b;const{drawId:n,drawName:r,drawType:a,entries:s,matchUpFormat:o,tieFormat:l}=e,c=ot.getPublishState({drawId:n}).publishState,u=(h=c==null?void 0:c.status)==null?void 0:h.published,d=(f=s==null?void 0:s.filter(({entryStatus:I})=>I!=="WITHDRAWN"))==null?void 0:f.length,p=(m=ot.getAssignedParticipantIds({drawDefinition:e}).assignedParticipantIds)==null?void 0:m.filter(Boolean);return{entries:(p==null?void 0:p.length)??d??0,matchUpFormat:o,tieFormat:l,utrAvg:(v=(g=i==null?void 0:i.ratingsStats)==null?void 0:g.UTR)==null?void 0:v.avg,wtnAvg:(b=(y=i==null?void 0:i.ratingsStats)==null?void 0:y.WTN)==null?void 0:b.avg,published:u,drawName:r,drawType:a,eventId:t,drawId:n}},{MAIN:tie}=Qr;function IPe({event:t,scaleValues:e}){var m,g,v;const{drawDefinitions:i=[],eventName:n,entries:r,eventId:a}=t,s=ot.allEventMatchUps({inContext:!0,eventId:a}).matchUps,o=rL.getPublishState({event:t}).publishState,l=i.length,c=((m=r.filter(({entryStage:y=tie,entryStatus:b})=>Ak(tie).includes(`${y}.${b}`)))==null?void 0:m.length)||0,u=(s==null?void 0:s.length)||0,d=((g=s==null?void 0:s.filter(({winningSide:y,schedule:b})=>!y&&(b==null?void 0:b.scheduledTime)))==null?void 0:g.length)||0,p=((v=s.filter(({winningSide:y})=>y))==null?void 0:v.length)||0,h=i.map(y=>{var b;return bPe(a)({drawDefinition:y,scaleValues:(b=e==null?void 0:e.draws)==null?void 0:b[y.drawId]})}),f=[n].concat(i.map(({drawName:y})=>y||"")).join(" ").toLowerCase();return{published:o==null?void 0:o.status.published,scheduledMatchUpsCount:d,completedMatchUpsCount:p,matchUpsCount:u,entriesCount:c,drawsCount:l,searchText:f,drawDefs:h,eventId:a,event:t}}function wPe({eventRow:t,drawsTable:e,drawIds:i}){e.deleteRow(i);const n=t==null?void 0:t.getData();if(n){const r=ot.allEventMatchUps({eventId:n.eventId,inContext:!1}).matchUps;n.drawDefs=n.drawDefs.filter(a=>!i.includes(a.drawId)),n.matchUpsCount=(r==null?void 0:r.length)||0,n.drawsCount-=i.length}}const SPe=t=>(e,i)=>{const n=i.getRow().getData(),r=n.published?[n.drawId]:void 0,a=n.published?void 0:[n.drawId],o=[{method:o1e,params:{eventId:n.eventId,drawIdsToRemove:r,drawIdsToAdd:a,eventDataParams:{participantsProfile:{withScaleValues:!0},pressureRating:!0,refreshResults:!0}}}];ii({methods:o,callback:c=>{var u;if(c!=null&&c.success){i.getRow().update({published:!n.published});const d=t.getData().eventId,p=ot.getPublishState({eventId:d}).publishState,h=(u=p==null?void 0:p.status)==null?void 0:u.published;t.update({published:h})}else Jt({message:c.error.message,intent:"is-danger"})}})},TPe=t=>t.getValue()?'<i class="fa-solid fa-eye" style="color: blue">':'<i class="fa-solid fa-eye-slash" style="color: red">';function UPe(t){var _,A;const{eventId:e,drawId:i,callback:n}=t,r=(_=ot.findExtension({name:jv.DISPLAY,discover:!0,eventId:e,drawId:i}).extension)==null?void 0:_.value,a=(r==null?void 0:r.admin)??r,s=["Wimbledon","French","ITF"],o="saveDisplaySettings",l={compositionName:(a==null?void 0:a.compositionName)??((A=Zi.composition)==null?void 0:A.compositionName)??"Australian",configuration:(a==null?void 0:a.configuration)??{},composition:void 0,inputs:void 0},c=_i.dateTime.extractDate(new Date().toISOString()),u="drawId",p=[{onlineResources:[{link:"https://www.google.com",label:"Google"}],venueName:"Club Courts",venueAbbreviation:"CC",startTime:"08:00",endTime:"20:00",courtsCount:6,venueId:"venueId"}],h=[{eventName:"WTN 14-19 SINGLES",category:{ratingType:"WTN",ratingMin:14,ratingMax:19.99},drawId:u,generate:!0,drawSize:4}],f=[{scheduleDate:c,venues:[{rounds:[{drawId:u,winnerFinishingPositionRange:"1-2"}],venueId:p[0].venueId}]}],m={withScaleValues:!0},g=zC.generateTournamentRecord({scheduleCompletedMatchUps:!0,completeAllMatchUps:!0,participantsProfile:m,autoSchedule:!0,schedulingProfile:f,venueProfiles:p,drawProfiles:h,startDate:c}).tournamentRecord,y=CC.allTournamentMatchUps({tournamentRecord:g}).matchUps.find(N=>N.matchUpType==="SINGLES"),b=document.createElement("div");b.style.maxWidth="500px";const I=document.createElement("div");b.appendChild(I);const T=({compositionName:N,configuration:k})=>{Ys(I),l.composition=fk[N],l.composition.configuration.flags=void 0,Object.assign(l.composition.configuration,k),l.composition.genderColor=!0,l.composition.compositionName=N;const O=KUe({isLucky:!0,composition:l.composition,matchUp:y});I.appendChild(O)};T(l);const w=Object.keys(fk).filter(N=>N!=="Night").map(N=>({selected:N===l.compositionName,label:N,value:N})),S=l.configuration.participantDetail,U=[{label:"None",value:"NONE",selected:!S},{label:"Address",value:"ADDRESS",selected:S==="ADDRESS"},{label:"Team",value:"TEAM",selected:S==="TEAM"}],P=()=>{l.compositionName=l.inputs.composition.value,l.configuration.scheduleInfo=!s.includes(l.compositionName)&&l.inputs.showSchedule.checked,l.configuration.participantDetail=l.inputs.detail.value,T(l)},E=[{options:w,label:"Composition",field:"composition",onChange:P},{controlVisible:!s.includes(l.compositionName),checked:l.configuration.scheduleInfo,controlId:"scheduleToggle",label:"Show Schedule",field:"showSchedule",id:"showSchedule",checkbox:!0,onChange:P},{options:U,label:"Detail",field:"detail",onChange:P}],R=document.createElement("div");b.appendChild(R);const C=[{onChange:({e:N})=>{const k=!s.includes(N.target.value),O=document.getElementById("scheduleToggle");O.style.display=k?"block":xt},control:"composition"}];l.inputs=Sr(R,E,C),er({title:"Edit display settings",buttons:[{label:"Cancel",intent:xt,close:!0},{label:"Save",id:o,intent:"is-info",close:!0,onClick:()=>{var V,j;const N=()=>{},O={value:{...(j=(V=ot.findExtension({name:jv.DISPLAY,discover:!0,eventId:e,drawId:i}))==null?void 0:V.extension)==null?void 0:j.value,compositionName:l.composition.compositionName,configuration:l.configuration},name:jv.DISPLAY};ii({methods:[{method:i?bZe:TZe,params:{eventId:e,drawId:i,extension:O}}],callback:N}),Ot(n)&&n(l.composition),Zi.composition=l.composition}}],content:b})}const mpt=t=>(e,i)=>{const n=Array.from(document.querySelectorAll(".tippy-content"));if(n.length){n.forEach(h=>h.remove());return}const r=e.target.getElementsByClassName("fa-ellipsis-vertical")[0],a=i.getRow(),s=a==null?void 0:a.getData(),{published:o,drawId:l,eventId:c}=s;Ic({items:[{onClick:()=>UPe({drawId:s.drawId}),text:"Display settings"},{text:o?"Unpublish":"Publish",onClick:()=>{SPe(t)(e,i)}},{onClick:()=>{G2({eventId:c,drawIds:[l],callback:f=>{var m;f.success||(m=f.error)!=null&&m.message&&Jt({message:f.error.message,intent:"is-danger"}),wPe({eventRow:t,drawsTable:i.getTable(),drawIds:[l]})}})},text:"Delete"},{text:"Edit"}],target:r||e.target,config:{placement:Ap}})};function gpt(t,e){const i=(a,s)=>{const{eventId:o,drawId:l}=s.getRow().getData();Jr({eventId:o,drawId:l,renderDraw:!0})},n=t.find(a=>a.utrAvg),r=t.find(a=>a.wtnAvg);return[{cellClick:(a,s)=>s.getRow().toggleSelect(),titleFormatter:"rowSelection",formatter:"rowSelection",headerSort:!1,responsive:!1,hozAlign:pi,width:5},{headerMenu:xm({entries:"Entries",wtnAvg:"WTN avg",utrAvg:"UTR avg"}),headerSort:!1,formatter:"rownum",hozAlign:mi,width:55},{title:'<i class="fa-solid fa-eye"></i>',cellClick:SPe(e),formatter:TPe,headerSort:!1,field:"published",width:55},{title:"Draw Name",field:vI,cellClick:i},{title:"Draw Type",field:vh,cellClick:i},{title:'<div class="event_icon opponents_header" />',field:"entries",width:50},{visible:!!r,field:"wtnAvg",title:PE,width:80},{visible:!!n,field:"utrAvg",title:yI,width:80},{cellClick:mpt(e),formatter:av,responsive:!1,headerSort:!1,hozAlign:oi}]}const vpt=t=>e=>{const i=document.createElement("div"),n=document.createElement("div");n.className="tableControl",n.style.marginBottom="1em";const r=e.getData().drawDefs;i.appendChild(n);const a=document.createElement("div");a.style.backgroundColor="white";const s="1px solid #333";a.style.border=s,a.style.width="99%",i.style.borderBotom=s,i.style.boxSizing="border-box",i.style.borderTop=s,i.style.paddingLeft="10px",i.className=dL,i.style.display=xt,i.appendChild(a),e.getElement().appendChild(i);const o=gpt(r,e),l=new As(a,{headerSortElement:rf(["entries"]),placeholder:"No draws",layout:"fitColumns",index:"drawId",maxHeight:400,columns:o,data:r});l.on("scrollVertical",wd);const c=e.getData().event,u=c.eventId;t(u,l);const d=()=>{const g=l.getSelectedData().map(({drawId:y})=>y);l.deselectRow(),G2({eventId:u,drawIds:g,callback:y=>{var b;if(!y.success){(b=y.error)!=null&&b.message&&Jt({message:y.error.message,intent:"is-danger"});return}wPe({eventRow:e,drawsTable:l,drawIds:g})}})},p=m=>{var g;if(m.success){l==null||l.addRow(bPe(u)({drawDefinition:m.drawDefinition}));const v=e==null?void 0:e.getData();if(a.style.display="",v)if(!v.matchUpsCount)Jr({eventId:u,drawId:(g=m.drawDefinition)==null?void 0:g.drawId,renderDraw:!0});else{const y=ot.allDrawMatchUps({drawId:m.drawDefinition.drawId,inContext:!1,eventId:u}).matchUps;v.matchUpsCount+=(y==null?void 0:y.length)||0,v.drawsCount+=1}}},h=({success:m,eventUpdates:g})=>{if(m){const v=e==null?void 0:e.getData();Object.assign(v.event,g),e.update(v)}};Io({table:l,target:n,items:[{onClick:d,label:"Delete selected",intent:"is-danger",stateChange:!0,location:fa},{onClick:()=>Jr({eventId:u}),label:"View entries",intent:"is-info",location:pi},{onClick:()=>tPe({eventId:u}),id:"editAvoidances",label:"Avoidances",location:pi},{onClick:()=>_2({event:c,callback:h}),label:"Edit event",location:oi},{onClick:()=>kT({eventId:u,callback:p}),intent:"is-primary",label:"Add draw",location:oi}]})},DPe=t=>(e,i)=>{const n=i.getRow().getData(),r=n.eventId,a=!n.published,s=n.published?YZe:o1e;t.get(r).getRows().forEach(u=>u.update({published:a})),ii({methods:[{method:s,params:{eventDataParams:{participantsProfile:{withScaleValues:!0},pressureRating:!0,refreshResults:!0},eventId:r}}],callback:u=>{u!=null&&u.success?i.getRow().update({published:!n.published}):Jt({message:u.error.message,intent:"is-danger"})}})};function EPe(t){const{eventIds:e,callback:i}=t,n=e.length>1?"Delete Events":"Delete Event";let r;const a=()=>{const u={auditReason:r.eventDeletionReason.value};ii({methods:[{method:AZe,params:{eventIds:e,auditData:u}}],callback:i})},s=[{text:"Please provide a reason for event deletion."},{placeholder:"Explanation",field:"eventDeletionReason",validator:xT(5),error:"Five word minimum",autocomplete:"on",focus:!0},{text:"This action cannot be undone!"}],l=[{control:"eventDeletionReason",onInput:({inputs:u})=>{const d=u.eventDeletionReason.value,p=xT(5)(d),h=document.getElementById("deleteEvent");h&&(h.disabled=!p)}}];er({title:n,content:u=>r=Sr(u,s,l),buttons:[{label:"Cancel",intent:xt,close:!0},{label:"Delete",id:"deleteEvent",disabled:!0,intent:"is-danger",close:!0,onClick:a}]})}const ypt=t=>(e,i)=>{const n=Array.from(document.querySelectorAll(".tippy-content"));if(n.length){n.forEach(h=>h.remove());return}const r=e.target.getElementsByClassName("fa-ellipsis-vertical")[0],a=i.getRow().getData(),s=i.getRow(),o=s==null?void 0:s.getData(),l=o==null?void 0:o.published,c=({success:h,eventUpdates:f})=>{h&&(Object.assign(o.event,f),s.update(o))};Ic({items:[{onClick:()=>UPe({eventId:a.eventId}),text:"Display settings"},{text:l?"Unpublish":"Publish",onClick:()=>{DPe(t)(e,i)}},{onClick:()=>{const h=[a.eventId];return EPe({eventIds:h,callback:m=>{const g=i.getTable();m.success&&(g==null||g.deleteRow(h))}})},text:"Delete"},{onClick:()=>_2({event:a.event,callback:c}),text:"Edit"}],target:r||e.target,config:{placement:Ap}})};function bpt(t){const e=(n,r)=>{n.stopPropagation();const a=r.getRow().getData().eventId;Jr({eventId:a})},i=(n,r)=>{rI(n,r)};return[{cellClick:(n,r)=>r.getRow().toggleSelect(),titleFormatter:"rowSelection",formatter:"rowSelection",headerSort:!1,hozAlign:pi,width:5},{headerMenu:xm({completedMatchUpsCount:"Completed MatchUps",scheduledMatchUpsCount:"Scheduled MatchUps",entriesCount:"Accepted entries",matchUpsCount:"Total matches",drawsCount:"Number of draws",published:"Published"}),formatter:"rownum",headerSort:!1,hozAlign:mi,width:55},{title:'<i class="fa-solid fa-eye"></i>',cellClick:DPe(t),formatter:TPe,headerSort:!1,field:"published",width:55},{field:"event.eventName",cellClick:i,title:"Event",minWidth:200,visible:!0,widthGrow:3},{field:"event.eventType",title:"Type",visible:!0},{field:"event.gender",title:"Gender",visible:!0},{title:'<div class="event_icon drawsize_header" />',headerTooltip:"Number of Draws",cellClick:rI,headerHozAlign:mi,field:"drawsCount",hozAlign:mi,headerSort:!0,visible:!0,width:45},{title:'<div class="event_icon opponents_header" />',headerTooltip:"Accepted Entries",headerHozAlign:mi,field:"entriesCount",cellClick:e,hozAlign:mi,headerSort:!0,visible:!0,width:50},{title:'<div class="event_icon matches_header" />',headerTooltip:"Total MatchUps",headerHozAlign:mi,field:"matchUpsCount",hozAlign:mi,headerSort:!0,visible:!0,width:50},{title:'<div class="event_icon time_header" />',headerTooltip:"Scheduled MatchUps",field:"scheduledMatchUpsCount",headerHozAlign:mi,hozAlign:mi,headerSort:!0,visible:!0,width:50},{title:'<div class="event_icon rank_header" />',headerTooltip:"Completed MatchUps",field:"completedMatchUpsCount",headerHozAlign:mi,hozAlign:mi,headerSort:!0,visible:!0,width:50},{cellClick:rI,formatter:MY,responsive:!1,headerSort:!1,hozAlign:oi,field:"isOpen",width:20},{cellClick:ypt(t),formatter:av,responsive:!1,headerSort:!1,hozAlign:oi,width:20}]}function Ipt(){let t;const e=new Map,i=(o,l)=>{e.has(o)||e.set(o,l)},n=()=>{var l;const o=ot.getEvents({withScaleValues:!0});return(l=o==null?void 0:o.events)==null?void 0:l.map(c=>{var u;return IPe({event:c,scaleValues:(u=o.eventScaleValues)==null?void 0:u[c.eventId]})})},r=()=>{t.replaceData(n())},a=bpt(e);return(o=>{var u;km({anchorId:UE});const l=document.getElementById(UE),c=(u=jl(l,"section"))==null?void 0:u.querySelector(".tabHeader");c!=null&&c.innerHTML&&(c.innerHTML=`Events (${o.length})`),t=new As(l,{columnDefaults:{},headerSortElement:rf(["scheduledMatchUpsCount","completedMatchUpsCount","matchUpsCount","entriesCount","drawsCount"]),rowFormatter:vpt(i),height:window.innerHeight*.8,placeholder:"No events",layout:"fitColumns",reactiveData:!0,index:"eventId",columns:a,data:o}),t.on("scrollVertical",wd),t.on("dataChanged",d=>{c&&(c.innerHTML=`Events (${d.length})`)}),t.on("dataFiltered",(d,p)=>{c&&(c.innerHTML=`Events (${p.length})`)})})(n()),{table:t,replaceTableData:r}}function wpt(){var u,d,p;const t=(u=ot.getPublishState().publishState)==null?void 0:u.tournament,{table:e}=Ipt(),i=h=>{if(h!=null&&h.event){const f=IPe({event:h.event});e==null||e.updateOrAddData([f])}},n=zw(e),r=()=>{const h=e==null?void 0:e.getSelectedData().map(({eventId:m})=>m);return EPe({eventIds:h,callback:m=>m.success&&(e==null?void 0:e.deleteRow(h))})},a=h=>h?"Unpublish":"Publish",s=h=>`${a(h)} OOP`,o=h=>{var f,m;if(h!=null&&h.success){const g=(f=ot.getPublishState().publishState)==null?void 0:f.tournament,v=document.getElementById("oopButton");v.innerText=s((m=g==null?void 0:g.orderOfPlay)==null?void 0:m.published),v.classList.toggle("is-primary")}},l=[{onClick:r,label:"Delete selected",intent:"is-danger",stateChange:!0,location:fa},{onKeyDown:h=>h.keyCode===8&&h.target.value.length===1&&n(""),onChange:h=>n(h.target.value),onKeyUp:h=>n(h.target.value),clearSearch:()=>n(""),placeholder:"Search events",location:pi,search:!0},{onClick:()=>Spt(o),label:s((d=t==null?void 0:t.orderOfPlay)==null?void 0:d.published),intent:(p=t==null?void 0:t.orderOfPlay)!=null&&p.published?"is-primary":"",id:"oopButton",location:oi},{onClick:()=>_2({callback:i}),label:"Add event",location:oi}],c=document.getElementById(p5);Io({table:e,target:c,items:l})}function Spt(t){var a,s;const e=(a=ot.getPublishState().publishState)==null?void 0:a.tournament,r=[{method:((s=e==null?void 0:e.orderOfPlay)==null?void 0:s.published)?"unPublishOrderOfPlay":"publishOrderOfPlay"}];ii({methods:r,callback:t})}function Tpt(t){var s;const{eventId:e,drawId:i,structureId:n,renderDraw:r,roundsView:a="roundsColumns"}=t;if(VY(hh),M2(),H2(),e||i){const o=document.getElementById(UE),l=(s=jl(o,"section"))==null?void 0:s.querySelector(".tabHeader");i&&r?fpt({eventId:e,drawId:i,headerElement:l}).success?(a===QS?yPe({eventId:e,drawId:i,structureId:n,roundsView:a}):a===JS?vPe({eventId:e,drawId:i,structureId:n,roundsView:a}):vP({eventId:e,drawId:i,structureId:n,redraw:!0,roundsView:a}),IN({renderDraw:r})):(Bte({eventId:e,drawId:i}),IN({eventId:e})):(Bte({eventId:e,drawId:i,headerElement:l}),IN({eventId:e}))}else wpt(),IN({eventId:e})}function Upt({callback:t}){var p,h;let e,i=!1;const n=ot.getTournament().tournamentRecord,r=(h=(p=n==null?void 0:n.onlineResources)==null?void 0:p.find(({name:f,resourceType:m})=>f==="tournamentImage"&&m==="URL"))==null?void 0:h.identifier,a=()=>{const f=document.getElementById("tournamentImagePreview");f.style.display=xt,s(!0)},s=f=>{const m=document.getElementById("createButton"),g=f?!1:!i&&e.tournamentImage.value;m.disabled=g},o=()=>{s(!1),i=!1;const f=document.getElementById("tournamentImagePreview");f.onload=()=>(i=!0)&&s(),f.src=e.tournamentImage.value,f.style.display=""},l=f=>e=Sr(f,[{onKeyUp:m=>m.key==="Enter"&&o(),onChange:()=>e.tournamentImage.value?o():a(),label:"Web address of online image",value:r,placeholder:"Image URL",field:"tournamentImage",autocomplete:"off"}]),c=document.createElement("div");l(c);const u=document.createElement("img");u.id="tournamentImagePreview",u.onload=()=>i=!0,r&&(u.src=r),u.style.width="100%",c.appendChild(u),er({title:"Tournament image",content:c,buttons:[{label:"Cancel",intent:"none",close:!0},{onClick:()=>{const f=e.tournamentImage.value;ii({methods:[{method:UZe,params:{onlineResource:{resourceSubType:"IMAGE",name:"tournamentImage",resourceType:"URL",identifier:f}}}],callback:v=>{v.success&&(Jt({message:"Tournament image updated",intent:"is-success"}),Ot(t)&&t(f))}})},intent:"is-primary",id:"createButton",disabled:!0,label:"Save",close:!0}]})}var PPe=typeof global=="object"&&global&&global.Object===Object&&global,Dpt=typeof self=="object"&&self&&self.Object===Object&&self,Om=PPe||Dpt||Function("return this")(),Cy=Om.Symbol,CPe=Object.prototype,Ept=CPe.hasOwnProperty,Ppt=CPe.toString,V1=Cy?Cy.toStringTag:void 0;function Cpt(t){var e=Ept.call(t,V1),i=t[V1];try{t[V1]=void 0;var n=!0}catch{}var r=Ppt.call(t);return n&&(e?t[V1]=i:delete t[V1]),r}var Rpt=Object.prototype,Mpt=Rpt.toString;function Npt(t){return Mpt.call(t)}var Apt="[object Null]",_pt="[object Undefined]",iie=Cy?Cy.toStringTag:void 0;function h1(t){return t==null?t===void 0?_pt:Apt:iie&&iie in Object(t)?Cpt(t):Npt(t)}function Ag(t){return t!=null&&typeof t=="object"}var xI=Array.isArray;function cb(t){var e=typeof t;return t!=null&&(e=="object"||e=="function")}function RPe(t){return t}var kpt="[object AsyncFunction]",xpt="[object Function]",Opt="[object GeneratorFunction]",Lpt="[object Proxy]";function WY(t){if(!cb(t))return!1;var e=h1(t);return e==xpt||e==Opt||e==kpt||e==Lpt}var GB=Om["__core-js_shared__"],nie=function(){var t=/[^.]+$/.exec(GB&&GB.keys&&GB.keys.IE_PROTO||"");return t?"Symbol(src)_1."+t:""}();function Fpt(t){return!!nie&&nie in t}var $pt=Function.prototype,Bpt=$pt.toString;function Yw(t){if(t!=null){try{return Bpt.call(t)}catch{}try{return t+""}catch{}}return""}var Vpt=/[\\^$.*+?()[\]{}|]/g,jpt=/^\[object .+?Constructor\]$/,Gpt=Function.prototype,Hpt=Object.prototype,zpt=Gpt.toString,qpt=Hpt.hasOwnProperty,Wpt=RegExp("^"+zpt.call(qpt).replace(Vpt,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function Ypt(t){if(!cb(t)||Fpt(t))return!1;var e=WY(t)?Wpt:jpt;return e.test(Yw(t))}function Kpt(t,e){return t==null?void 0:t[e]}function Kw(t,e){var i=Kpt(t,e);return Ypt(i)?i:void 0}var MH=Kw(Om,"WeakMap"),rie=Object.create,Zpt=function(){function t(){}return function(e){if(!cb(e))return{};if(rie)return rie(e);t.prototype=e;var i=new t;return t.prototype=void 0,i}}();function Xpt(t,e,i){switch(i.length){case 0:return t.call(e);case 1:return t.call(e,i[0]);case 2:return t.call(e,i[0],i[1]);case 3:return t.call(e,i[0],i[1],i[2])}return t.apply(e,i)}function MPe(t,e){var i=-1,n=t.length;for(e||(e=Array(n));++i<n;)e[i]=t[i];return e}var Jpt=800,Qpt=16,eht=Date.now;function tht(t){var e=0,i=0;return function(){var n=eht(),r=Qpt-(n-i);if(i=n,r>0){if(++e>=Jpt)return arguments[0]}else e=0;return t.apply(void 0,arguments)}}function iht(t){return function(){return t}}var kk=function(){try{var t=Kw(Object,"defineProperty");return t({},"",{}),t}catch{}}(),nht=kk?function(t,e){return kk(t,"toString",{configurable:!0,enumerable:!1,value:iht(e),writable:!0})}:RPe,rht=tht(nht);function aht(t,e){for(var i=-1,n=t==null?0:t.length;++i<n&&e(t[i],i,t)!==!1;);return t}var sht=9007199254740991,oht=/^(?:0|[1-9]\d*)$/;function NPe(t,e){var i=typeof t;return e=e??sht,!!e&&(i=="number"||i!="symbol"&&oht.test(t))&&t>-1&&t%1==0&&t<e}function YY(t,e,i){e=="__proto__"&&kk?kk(t,e,{configurable:!0,enumerable:!0,value:i,writable:!0}):t[e]=i}function DM(t,e){return t===e||t!==t&&e!==e}var lht=Object.prototype,cht=lht.hasOwnProperty;function APe(t,e,i){var n=t[e];(!(cht.call(t,e)&&DM(n,i))||i===void 0&&!(e in t))&&YY(t,e,i)}function EM(t,e,i,n){var r=!i;i||(i={});for(var a=-1,s=e.length;++a<s;){var o=e[a],l=void 0;l===void 0&&(l=t[o]),r?YY(i,o,l):APe(i,o,l)}return i}var aie=Math.max;function uht(t,e,i){return e=aie(e===void 0?t.length-1:e,0),function(){for(var n=arguments,r=-1,a=aie(n.length-e,0),s=Array(a);++r<a;)s[r]=n[e+r];r=-1;for(var o=Array(e+1);++r<e;)o[r]=n[r];return o[e]=i(s),Xpt(t,this,o)}}function dht(t,e){return rht(uht(t,e,RPe),t+"")}var pht=9007199254740991;function _Pe(t){return typeof t=="number"&&t>-1&&t%1==0&&t<=pht}function z2(t){return t!=null&&_Pe(t.length)&&!WY(t)}function hht(t,e,i){if(!cb(i))return!1;var n=typeof e;return(n=="number"?z2(i)&&NPe(e,i.length):n=="string"&&e in i)?DM(i[e],t):!1}function fht(t){return dht(function(e,i){var n=-1,r=i.length,a=r>1?i[r-1]:void 0,s=r>2?i[2]:void 0;for(a=t.length>3&&typeof a=="function"?(r--,a):void 0,s&&hht(i[0],i[1],s)&&(a=r<3?void 0:a,r=1),e=Object(e);++n<r;){var o=i[n];o&&t(e,o,n,a)}return e})}var mht=Object.prototype;function KY(t){var e=t&&t.constructor,i=typeof e=="function"&&e.prototype||mht;return t===i}function ght(t,e){for(var i=-1,n=Array(t);++i<t;)n[i]=e(i);return n}var vht="[object Arguments]";function sie(t){return Ag(t)&&h1(t)==vht}var kPe=Object.prototype,yht=kPe.hasOwnProperty,bht=kPe.propertyIsEnumerable,NH=sie(function(){return arguments}())?sie:function(t){return Ag(t)&&yht.call(t,"callee")&&!bht.call(t,"callee")};function Iht(){return!1}var xPe=typeof exports=="object"&&exports&&!exports.nodeType&&exports,oie=xPe&&typeof module=="object"&&module&&!module.nodeType&&module,wht=oie&&oie.exports===xPe,lie=wht?Om.Buffer:void 0,Sht=lie?lie.isBuffer:void 0,yP=Sht||Iht,Tht="[object Arguments]",Uht="[object Array]",Dht="[object Boolean]",Eht="[object Date]",Pht="[object Error]",Cht="[object Function]",Rht="[object Map]",Mht="[object Number]",Nht="[object Object]",Aht="[object RegExp]",_ht="[object Set]",kht="[object String]",xht="[object WeakMap]",Oht="[object ArrayBuffer]",Lht="[object DataView]",Fht="[object Float32Array]",$ht="[object Float64Array]",Bht="[object Int8Array]",Vht="[object Int16Array]",jht="[object Int32Array]",Ght="[object Uint8Array]",Hht="[object Uint8ClampedArray]",zht="[object Uint16Array]",qht="[object Uint32Array]",Oa={};Oa[Fht]=Oa[$ht]=Oa[Bht]=Oa[Vht]=Oa[jht]=Oa[Ght]=Oa[Hht]=Oa[zht]=Oa[qht]=!0;Oa[Tht]=Oa[Uht]=Oa[Oht]=Oa[Dht]=Oa[Lht]=Oa[Eht]=Oa[Pht]=Oa[Cht]=Oa[Rht]=Oa[Mht]=Oa[Nht]=Oa[Aht]=Oa[_ht]=Oa[kht]=Oa[xht]=!1;function Wht(t){return Ag(t)&&_Pe(t.length)&&!!Oa[h1(t)]}function ZY(t){return function(e){return t(e)}}var OPe=typeof exports=="object"&&exports&&!exports.nodeType&&exports,_D=OPe&&typeof module=="object"&&module&&!module.nodeType&&module,Yht=_D&&_D.exports===OPe,HB=Yht&&PPe.process,OT=function(){try{var t=_D&&_D.require&&_D.require("util").types;return t||HB&&HB.binding&&HB.binding("util")}catch{}}(),cie=OT&&OT.isTypedArray,XY=cie?ZY(cie):Wht,Kht=Object.prototype,Zht=Kht.hasOwnProperty;function LPe(t,e){var i=xI(t),n=!i&&NH(t),r=!i&&!n&&yP(t),a=!i&&!n&&!r&&XY(t),s=i||n||r||a,o=s?ght(t.length,String):[],l=o.length;for(var c in t)(e||Zht.call(t,c))&&!(s&&(c=="length"||r&&(c=="offset"||c=="parent")||a&&(c=="buffer"||c=="byteLength"||c=="byteOffset")||NPe(c,l)))&&o.push(c);return o}function FPe(t,e){return function(i){return t(e(i))}}var Xht=FPe(Object.keys,Object),Jht=Object.prototype,Qht=Jht.hasOwnProperty;function eft(t){if(!KY(t))return Xht(t);var e=[];for(var i in Object(t))Qht.call(t,i)&&i!="constructor"&&e.push(i);return e}function JY(t){return z2(t)?LPe(t):eft(t)}function tft(t){var e=[];if(t!=null)for(var i in Object(t))e.push(i);return e}var ift=Object.prototype,nft=ift.hasOwnProperty;function rft(t){if(!cb(t))return tft(t);var e=KY(t),i=[];for(var n in t)n=="constructor"&&(e||!nft.call(t,n))||i.push(n);return i}function PM(t){return z2(t)?LPe(t,!0):rft(t)}var bP=Kw(Object,"create");function aft(){this.__data__=bP?bP(null):{},this.size=0}function sft(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e}var oft="__lodash_hash_undefined__",lft=Object.prototype,cft=lft.hasOwnProperty;function uft(t){var e=this.__data__;if(bP){var i=e[t];return i===oft?void 0:i}return cft.call(e,t)?e[t]:void 0}var dft=Object.prototype,pft=dft.hasOwnProperty;function hft(t){var e=this.__data__;return bP?e[t]!==void 0:pft.call(e,t)}var fft="__lodash_hash_undefined__";function mft(t,e){var i=this.__data__;return this.size+=this.has(t)?0:1,i[t]=bP&&e===void 0?fft:e,this}function OI(t){var e=-1,i=t==null?0:t.length;for(this.clear();++e<i;){var n=t[e];this.set(n[0],n[1])}}OI.prototype.clear=aft;OI.prototype.delete=sft;OI.prototype.get=uft;OI.prototype.has=hft;OI.prototype.set=mft;function gft(){this.__data__=[],this.size=0}function q2(t,e){for(var i=t.length;i--;)if(DM(t[i][0],e))return i;return-1}var vft=Array.prototype,yft=vft.splice;function bft(t){var e=this.__data__,i=q2(e,t);if(i<0)return!1;var n=e.length-1;return i==n?e.pop():yft.call(e,i,1),--this.size,!0}function Ift(t){var e=this.__data__,i=q2(e,t);return i<0?void 0:e[i][1]}function wft(t){return q2(this.__data__,t)>-1}function Sft(t,e){var i=this.__data__,n=q2(i,t);return n<0?(++this.size,i.push([t,e])):i[n][1]=e,this}function ov(t){var e=-1,i=t==null?0:t.length;for(this.clear();++e<i;){var n=t[e];this.set(n[0],n[1])}}ov.prototype.clear=gft;ov.prototype.delete=bft;ov.prototype.get=Ift;ov.prototype.has=wft;ov.prototype.set=Sft;var IP=Kw(Om,"Map");function Tft(){this.size=0,this.__data__={hash:new OI,map:new(IP||ov),string:new OI}}function Uft(t){var e=typeof t;return e=="string"||e=="number"||e=="symbol"||e=="boolean"?t!=="__proto__":t===null}function W2(t,e){var i=t.__data__;return Uft(e)?i[typeof e=="string"?"string":"hash"]:i.map}function Dft(t){var e=W2(this,t).delete(t);return this.size-=e?1:0,e}function Eft(t){return W2(this,t).get(t)}function Pft(t){return W2(this,t).has(t)}function Cft(t,e){var i=W2(this,t),n=i.size;return i.set(t,e),this.size+=i.size==n?0:1,this}function Zw(t){var e=-1,i=t==null?0:t.length;for(this.clear();++e<i;){var n=t[e];this.set(n[0],n[1])}}Zw.prototype.clear=Tft;Zw.prototype.delete=Dft;Zw.prototype.get=Eft;Zw.prototype.has=Pft;Zw.prototype.set=Cft;function $Pe(t,e){for(var i=-1,n=e.length,r=t.length;++i<n;)t[r+i]=e[i];return t}var QY=FPe(Object.getPrototypeOf,Object),Rft="[object Object]",Mft=Function.prototype,Nft=Object.prototype,BPe=Mft.toString,Aft=Nft.hasOwnProperty,_ft=BPe.call(Object);function kft(t){if(!Ag(t)||h1(t)!=Rft)return!1;var e=QY(t);if(e===null)return!0;var i=Aft.call(e,"constructor")&&e.constructor;return typeof i=="function"&&i instanceof i&&BPe.call(i)==_ft}function xft(){this.__data__=new ov,this.size=0}function Oft(t){var e=this.__data__,i=e.delete(t);return this.size=e.size,i}function Lft(t){return this.__data__.get(t)}function Fft(t){return this.__data__.has(t)}var $ft=200;function Bft(t,e){var i=this.__data__;if(i instanceof ov){var n=i.__data__;if(!IP||n.length<$ft-1)return n.push([t,e]),this.size=++i.size,this;i=this.__data__=new Zw(n)}return i.set(t,e),this.size=i.size,this}function Ff(t){var e=this.__data__=new ov(t);this.size=e.size}Ff.prototype.clear=xft;Ff.prototype.delete=Oft;Ff.prototype.get=Lft;Ff.prototype.has=Fft;Ff.prototype.set=Bft;function Vft(t,e){return t&&EM(e,JY(e),t)}function jft(t,e){return t&&EM(e,PM(e),t)}var VPe=typeof exports=="object"&&exports&&!exports.nodeType&&exports,uie=VPe&&typeof module=="object"&&module&&!module.nodeType&&module,Gft=uie&&uie.exports===VPe,die=Gft?Om.Buffer:void 0,pie=die?die.allocUnsafe:void 0;function jPe(t,e){if(e)return t.slice();var i=t.length,n=pie?pie(i):new t.constructor(i);return t.copy(n),n}function Hft(t,e){for(var i=-1,n=t==null?0:t.length,r=0,a=[];++i<n;){var s=t[i];e(s,i,t)&&(a[r++]=s)}return a}function GPe(){return[]}var zft=Object.prototype,qft=zft.propertyIsEnumerable,hie=Object.getOwnPropertySymbols,eK=hie?function(t){return t==null?[]:(t=Object(t),Hft(hie(t),function(e){return qft.call(t,e)}))}:GPe;function Wft(t,e){return EM(t,eK(t),e)}var Yft=Object.getOwnPropertySymbols,HPe=Yft?function(t){for(var e=[];t;)$Pe(e,eK(t)),t=QY(t);return e}:GPe;function Kft(t,e){return EM(t,HPe(t),e)}function zPe(t,e,i){var n=e(t);return xI(t)?n:$Pe(n,i(t))}function AH(t){return zPe(t,JY,eK)}function Zft(t){return zPe(t,PM,HPe)}var _H=Kw(Om,"DataView"),kH=Kw(Om,"Promise"),xH=Kw(Om,"Set"),fie="[object Map]",Xft="[object Object]",mie="[object Promise]",gie="[object Set]",vie="[object WeakMap]",yie="[object DataView]",Jft=Yw(_H),Qft=Yw(IP),emt=Yw(kH),tmt=Yw(xH),imt=Yw(MH),fh=h1;(_H&&fh(new _H(new ArrayBuffer(1)))!=yie||IP&&fh(new IP)!=fie||kH&&fh(kH.resolve())!=mie||xH&&fh(new xH)!=gie||MH&&fh(new MH)!=vie)&&(fh=function(t){var e=h1(t),i=e==Xft?t.constructor:void 0,n=i?Yw(i):"";if(n)switch(n){case Jft:return yie;case Qft:return fie;case emt:return mie;case tmt:return gie;case imt:return vie}return e});var nmt=Object.prototype,rmt=nmt.hasOwnProperty;function amt(t){var e=t.length,i=new t.constructor(e);return e&&typeof t[0]=="string"&&rmt.call(t,"index")&&(i.index=t.index,i.input=t.input),i}var xk=Om.Uint8Array;function tK(t){var e=new t.constructor(t.byteLength);return new xk(e).set(new xk(t)),e}function smt(t,e){var i=e?tK(t.buffer):t.buffer;return new t.constructor(i,t.byteOffset,t.byteLength)}var omt=/\w*$/;function lmt(t){var e=new t.constructor(t.source,omt.exec(t));return e.lastIndex=t.lastIndex,e}var bie=Cy?Cy.prototype:void 0,Iie=bie?bie.valueOf:void 0;function cmt(t){return Iie?Object(Iie.call(t)):{}}function qPe(t,e){var i=e?tK(t.buffer):t.buffer;return new t.constructor(i,t.byteOffset,t.length)}var umt="[object Boolean]",dmt="[object Date]",pmt="[object Map]",hmt="[object Number]",fmt="[object RegExp]",mmt="[object Set]",gmt="[object String]",vmt="[object Symbol]",ymt="[object ArrayBuffer]",bmt="[object DataView]",Imt="[object Float32Array]",wmt="[object Float64Array]",Smt="[object Int8Array]",Tmt="[object Int16Array]",Umt="[object Int32Array]",Dmt="[object Uint8Array]",Emt="[object Uint8ClampedArray]",Pmt="[object Uint16Array]",Cmt="[object Uint32Array]";function Rmt(t,e,i){var n=t.constructor;switch(e){case ymt:return tK(t);case umt:case dmt:return new n(+t);case bmt:return smt(t,i);case Imt:case wmt:case Smt:case Tmt:case Umt:case Dmt:case Emt:case Pmt:case Cmt:return qPe(t,i);case pmt:return new n;case hmt:case gmt:return new n(t);case fmt:return lmt(t);case mmt:return new n;case vmt:return cmt(t)}}function WPe(t){return typeof t.constructor=="function"&&!KY(t)?Zpt(QY(t)):{}}var Mmt="[object Map]";function Nmt(t){return Ag(t)&&fh(t)==Mmt}var wie=OT&&OT.isMap,Amt=wie?ZY(wie):Nmt,_mt="[object Set]";function kmt(t){return Ag(t)&&fh(t)==_mt}var Sie=OT&&OT.isSet,xmt=Sie?ZY(Sie):kmt,Omt=1,Lmt=2,Fmt=4,YPe="[object Arguments]",$mt="[object Array]",Bmt="[object Boolean]",Vmt="[object Date]",jmt="[object Error]",KPe="[object Function]",Gmt="[object GeneratorFunction]",Hmt="[object Map]",zmt="[object Number]",ZPe="[object Object]",qmt="[object RegExp]",Wmt="[object Set]",Ymt="[object String]",Kmt="[object Symbol]",Zmt="[object WeakMap]",Xmt="[object ArrayBuffer]",Jmt="[object DataView]",Qmt="[object Float32Array]",egt="[object Float64Array]",tgt="[object Int8Array]",igt="[object Int16Array]",ngt="[object Int32Array]",rgt="[object Uint8Array]",agt="[object Uint8ClampedArray]",sgt="[object Uint16Array]",ogt="[object Uint32Array]",Ta={};Ta[YPe]=Ta[$mt]=Ta[Xmt]=Ta[Jmt]=Ta[Bmt]=Ta[Vmt]=Ta[Qmt]=Ta[egt]=Ta[tgt]=Ta[igt]=Ta[ngt]=Ta[Hmt]=Ta[zmt]=Ta[ZPe]=Ta[qmt]=Ta[Wmt]=Ta[Ymt]=Ta[Kmt]=Ta[rgt]=Ta[agt]=Ta[sgt]=Ta[ogt]=!0;Ta[jmt]=Ta[KPe]=Ta[Zmt]=!1;function PA(t,e,i,n,r,a){var s,o=e&Omt,l=e&Lmt,c=e&Fmt;if(s!==void 0)return s;if(!cb(t))return t;var u=xI(t);if(u){if(s=amt(t),!o)return MPe(t,s)}else{var d=fh(t),p=d==KPe||d==Gmt;if(yP(t))return jPe(t,o);if(d==ZPe||d==YPe||p&&!r){if(s=l||p?{}:WPe(t),!o)return l?Kft(t,jft(s,t)):Wft(t,Vft(s,t))}else{if(!Ta[d])return r?t:{};s=Rmt(t,d,o)}}a||(a=new Ff);var h=a.get(t);if(h)return h;a.set(t,s),xmt(t)?t.forEach(function(g){s.add(PA(g,e,i,g,t,a))}):Amt(t)&&t.forEach(function(g,v){s.set(v,PA(g,e,i,v,t,a))});var f=c?l?Zft:AH:l?PM:JY,m=u?void 0:f(t);return aht(m||t,function(g,v){m&&(v=g,g=t[v]),APe(s,v,PA(g,e,i,v,t,a))}),s}var lgt=1,cgt=4;function SS(t){return PA(t,lgt|cgt)}var ugt="__lodash_hash_undefined__";function dgt(t){return this.__data__.set(t,ugt),this}function pgt(t){return this.__data__.has(t)}function Ok(t){var e=-1,i=t==null?0:t.length;for(this.__data__=new Zw;++e<i;)this.add(t[e])}Ok.prototype.add=Ok.prototype.push=dgt;Ok.prototype.has=pgt;function hgt(t,e){for(var i=-1,n=t==null?0:t.length;++i<n;)if(e(t[i],i,t))return!0;return!1}function fgt(t,e){return t.has(e)}var mgt=1,ggt=2;function XPe(t,e,i,n,r,a){var s=i&mgt,o=t.length,l=e.length;if(o!=l&&!(s&&l>o))return!1;var c=a.get(t),u=a.get(e);if(c&&u)return c==e&&u==t;var d=-1,p=!0,h=i&ggt?new Ok:void 0;for(a.set(t,e),a.set(e,t);++d<o;){var f=t[d],m=e[d];if(n)var g=s?n(m,f,d,e,t,a):n(f,m,d,t,e,a);if(g!==void 0){if(g)continue;p=!1;break}if(h){if(!hgt(e,function(v,y){if(!fgt(h,y)&&(f===v||r(f,v,i,n,a)))return h.push(y)})){p=!1;break}}else if(!(f===m||r(f,m,i,n,a))){p=!1;break}}return a.delete(t),a.delete(e),p}function vgt(t){var e=-1,i=Array(t.size);return t.forEach(function(n,r){i[++e]=[r,n]}),i}function ygt(t){var e=-1,i=Array(t.size);return t.forEach(function(n){i[++e]=n}),i}var bgt=1,Igt=2,wgt="[object Boolean]",Sgt="[object Date]",Tgt="[object Error]",Ugt="[object Map]",Dgt="[object Number]",Egt="[object RegExp]",Pgt="[object Set]",Cgt="[object String]",Rgt="[object Symbol]",Mgt="[object ArrayBuffer]",Ngt="[object DataView]",Tie=Cy?Cy.prototype:void 0,zB=Tie?Tie.valueOf:void 0;function Agt(t,e,i,n,r,a,s){switch(i){case Ngt:if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)return!1;t=t.buffer,e=e.buffer;case Mgt:return!(t.byteLength!=e.byteLength||!a(new xk(t),new xk(e)));case wgt:case Sgt:case Dgt:return DM(+t,+e);case Tgt:return t.name==e.name&&t.message==e.message;case Egt:case Cgt:return t==e+"";case Ugt:var o=vgt;case Pgt:var l=n&bgt;if(o||(o=ygt),t.size!=e.size&&!l)return!1;var c=s.get(t);if(c)return c==e;n|=Igt,s.set(t,e);var u=XPe(o(t),o(e),n,r,a,s);return s.delete(t),u;case Rgt:if(zB)return zB.call(t)==zB.call(e)}return!1}var _gt=1,kgt=Object.prototype,xgt=kgt.hasOwnProperty;function Ogt(t,e,i,n,r,a){var s=i&_gt,o=AH(t),l=o.length,c=AH(e),u=c.length;if(l!=u&&!s)return!1;for(var d=l;d--;){var p=o[d];if(!(s?p in e:xgt.call(e,p)))return!1}var h=a.get(t),f=a.get(e);if(h&&f)return h==e&&f==t;var m=!0;a.set(t,e),a.set(e,t);for(var g=s;++d<l;){p=o[d];var v=t[p],y=e[p];if(n)var b=s?n(y,v,p,e,t,a):n(v,y,p,t,e,a);if(!(b===void 0?v===y||r(v,y,i,n,a):b)){m=!1;break}g||(g=p=="constructor")}if(m&&!g){var I=t.constructor,T=e.constructor;I!=T&&"constructor"in t&&"constructor"in e&&!(typeof I=="function"&&I instanceof I&&typeof T=="function"&&T instanceof T)&&(m=!1)}return a.delete(t),a.delete(e),m}var Lgt=1,Uie="[object Arguments]",Die="[object Array]",wN="[object Object]",Fgt=Object.prototype,Eie=Fgt.hasOwnProperty;function $gt(t,e,i,n,r,a){var s=xI(t),o=xI(e),l=s?Die:fh(t),c=o?Die:fh(e);l=l==Uie?wN:l,c=c==Uie?wN:c;var u=l==wN,d=c==wN,p=l==c;if(p&&yP(t)){if(!yP(e))return!1;s=!0,u=!1}if(p&&!u)return a||(a=new Ff),s||XY(t)?XPe(t,e,i,n,r,a):Agt(t,e,l,i,n,r,a);if(!(i&Lgt)){var h=u&&Eie.call(t,"__wrapped__"),f=d&&Eie.call(e,"__wrapped__");if(h||f){var m=h?t.value():t,g=f?e.value():e;return a||(a=new Ff),r(m,g,i,n,a)}}return p?(a||(a=new Ff),Ogt(t,e,i,n,r,a)):!1}function JPe(t,e,i,n,r){return t===e?!0:t==null||e==null||!Ag(t)&&!Ag(e)?t!==t&&e!==e:$gt(t,e,i,n,JPe,r)}function Bgt(t){return function(e,i,n){for(var r=-1,a=Object(e),s=n(e),o=s.length;o--;){var l=s[++r];if(i(a[l],l,a)===!1)break}return e}}var Vgt=Bgt();function OH(t,e,i){(i!==void 0&&!DM(t[e],i)||i===void 0&&!(e in t))&&YY(t,e,i)}function jgt(t){return Ag(t)&&z2(t)}function LH(t,e){if(!(e==="constructor"&&typeof t[e]=="function")&&e!="__proto__")return t[e]}function Ggt(t){return EM(t,PM(t))}function Hgt(t,e,i,n,r,a,s){var o=LH(t,i),l=LH(e,i),c=s.get(l);if(c){OH(t,i,c);return}var u=a?a(o,l,i+"",t,e,s):void 0,d=u===void 0;if(d){var p=xI(l),h=!p&&yP(l),f=!p&&!h&&XY(l);u=l,p||h||f?xI(o)?u=o:jgt(o)?u=MPe(o):h?(d=!1,u=jPe(l,!0)):f?(d=!1,u=qPe(l,!0)):u=[]:kft(l)||NH(l)?(u=o,NH(o)?u=Ggt(o):(!cb(o)||WY(o))&&(u=WPe(l))):d=!1}d&&(s.set(l,u),r(u,l,n,a,s),s.delete(l)),OH(t,i,u)}function QPe(t,e,i,n,r){t!==e&&Vgt(e,function(a,s){if(r||(r=new Ff),cb(a))Hgt(t,e,s,i,QPe,n,r);else{var o=n?n(LH(t,s),a,s+"",t,e,r):void 0;o===void 0&&(o=a),OH(t,s,o)}},PM)}function iK(t,e){return JPe(t,e)}var Yv=fht(function(t,e,i){QPe(t,e,i)}),Ci=(t=>(t[t.TYPE=3]="TYPE",t[t.LEVEL=12]="LEVEL",t[t.ATTRIBUTE=13]="ATTRIBUTE",t[t.BLOT=14]="BLOT",t[t.INLINE=7]="INLINE",t[t.BLOCK=11]="BLOCK",t[t.BLOCK_BLOT=10]="BLOCK_BLOT",t[t.INLINE_BLOT=6]="INLINE_BLOT",t[t.BLOCK_ATTRIBUTE=9]="BLOCK_ATTRIBUTE",t[t.INLINE_ATTRIBUTE=5]="INLINE_ATTRIBUTE",t[t.ANY=15]="ANY",t))(Ci||{});class hm{constructor(e,i,n={}){this.attrName=e,this.keyName=i;const r=Ci.TYPE&Ci.ATTRIBUTE;this.scope=n.scope!=null?n.scope&Ci.LEVEL|r:Ci.ATTRIBUTE,n.whitelist!=null&&(this.whitelist=n.whitelist)}static keys(e){return Array.from(e.attributes).map(i=>i.name)}add(e,i){return this.canAdd(e,i)?(e.setAttribute(this.keyName,i),!0):!1}canAdd(e,i){return this.whitelist==null?!0:typeof i=="string"?this.whitelist.indexOf(i.replace(/["']/g,""))>-1:this.whitelist.indexOf(i)>-1}remove(e){e.removeAttribute(this.keyName)}value(e){const i=e.getAttribute(this.keyName);return this.canAdd(e,i)&&i?i:""}}class TS extends Error{constructor(e){e="[Parchment] "+e,super(e),this.message=e,this.name=this.constructor.name}}const eCe=class FH{constructor(){this.attributes={},this.classes={},this.tags={},this.types={}}static find(e,i=!1){if(e==null)return null;if(this.blots.has(e))return this.blots.get(e)||null;if(i){let n=null;try{n=e.parentNode}catch{return null}return this.find(n,i)}return null}create(e,i,n){const r=this.query(i);if(r==null)throw new TS(`Unable to create ${i} blot`);const a=r,s=i instanceof Node||i.nodeType===Node.TEXT_NODE?i:a.create(n),o=new a(e,s,n);return FH.blots.set(o.domNode,o),o}find(e,i=!1){return FH.find(e,i)}query(e,i=Ci.ANY){let n;return typeof e=="string"?n=this.types[e]||this.attributes[e]:e instanceof Text||e.nodeType===Node.TEXT_NODE?n=this.types.text:typeof e=="number"?e&Ci.LEVEL&Ci.BLOCK?n=this.types.block:e&Ci.LEVEL&Ci.INLINE&&(n=this.types.inline):e instanceof Element&&((e.getAttribute("class")||"").split(/\s+/).some(r=>(n=this.classes[r],!!n)),n=n||this.tags[e.tagName]),n==null?null:"scope"in n&&i&Ci.LEVEL&n.scope&&i&Ci.TYPE&n.scope?n:null}register(...e){return e.map(i=>{const n="blotName"in i,r="attrName"in i;if(!n&&!r)throw new TS("Invalid definition");if(n&&i.blotName==="abstract")throw new TS("Cannot register abstract class");const a=n?i.blotName:r?i.attrName:void 0;return this.types[a]=i,r?typeof i.keyName=="string"&&(this.attributes[i.keyName]=i):n&&(i.className&&(this.classes[i.className]=i),i.tagName&&(Array.isArray(i.tagName)?i.tagName=i.tagName.map(s=>s.toUpperCase()):i.tagName=i.tagName.toUpperCase(),(Array.isArray(i.tagName)?i.tagName:[i.tagName]).forEach(s=>{(this.tags[s]==null||i.className==null)&&(this.tags[s]=i)}))),i})}};eCe.blots=new WeakMap;let LT=eCe;function Pie(t,e){return(t.getAttribute("class")||"").split(/\s+/).filter(i=>i.indexOf(`${e}-`)===0)}class zgt extends hm{static keys(e){return(e.getAttribute("class")||"").split(/\s+/).map(i=>i.split("-").slice(0,-1).join("-"))}add(e,i){return this.canAdd(e,i)?(this.remove(e),e.classList.add(`${this.keyName}-${i}`),!0):!1}remove(e){Pie(e,this.keyName).forEach(i=>{e.classList.remove(i)}),e.classList.length===0&&e.removeAttribute("class")}value(e){const i=(Pie(e,this.keyName)[0]||"").slice(this.keyName.length+1);return this.canAdd(e,i)?i:""}}const sf=zgt;function qB(t){const e=t.split("-"),i=e.slice(1).map(n=>n[0].toUpperCase()+n.slice(1)).join("");return e[0]+i}class qgt extends hm{static keys(e){return(e.getAttribute("style")||"").split(";").map(i=>i.split(":")[0].trim())}add(e,i){return this.canAdd(e,i)?(e.style[qB(this.keyName)]=i,!0):!1}remove(e){e.style[qB(this.keyName)]="",e.getAttribute("style")||e.removeAttribute("style")}value(e){const i=e.style[qB(this.keyName)];return this.canAdd(e,i)?i:""}}const ub=qgt;class Wgt{constructor(e){this.attributes={},this.domNode=e,this.build()}attribute(e,i){i?e.add(this.domNode,i)&&(e.value(this.domNode)!=null?this.attributes[e.attrName]=e:delete this.attributes[e.attrName]):(e.remove(this.domNode),delete this.attributes[e.attrName])}build(){this.attributes={};const e=LT.find(this.domNode);if(e==null)return;const i=hm.keys(this.domNode),n=sf.keys(this.domNode),r=ub.keys(this.domNode);i.concat(n).concat(r).forEach(a=>{const s=e.scroll.query(a,Ci.ATTRIBUTE);s instanceof hm&&(this.attributes[s.attrName]=s)})}copy(e){Object.keys(this.attributes).forEach(i=>{const n=this.attributes[i].value(this.domNode);e.format(i,n)})}move(e){this.copy(e),Object.keys(this.attributes).forEach(i=>{this.attributes[i].remove(this.domNode)}),this.attributes={}}values(){return Object.keys(this.attributes).reduce((e,i)=>(e[i]=this.attributes[i].value(this.domNode),e),{})}}const Y2=Wgt,tCe=class{constructor(e,i){this.scroll=e,this.domNode=i,LT.blots.set(i,this),this.prev=null,this.next=null}static create(e){if(this.tagName==null)throw new TS("Blot definition missing tagName");let i,n;return Array.isArray(this.tagName)?(typeof e=="string"?(n=e.toUpperCase(),parseInt(n,10).toString()===n&&(n=parseInt(n,10))):typeof e=="number"&&(n=e),typeof n=="number"?i=document.createElement(this.tagName[n-1]):n&&this.tagName.indexOf(n)>-1?i=document.createElement(n):i=document.createElement(this.tagName[0])):i=document.createElement(this.tagName),this.className&&i.classList.add(this.className),i}get statics(){return this.constructor}attach(){}clone(){const e=this.domNode.cloneNode(!1);return this.scroll.create(e)}detach(){this.parent!=null&&this.parent.removeChild(this),LT.blots.delete(this.domNode)}deleteAt(e,i){this.isolate(e,i).remove()}formatAt(e,i,n,r){const a=this.isolate(e,i);if(this.scroll.query(n,Ci.BLOT)!=null&&r)a.wrap(n,r);else if(this.scroll.query(n,Ci.ATTRIBUTE)!=null){const s=this.scroll.create(this.statics.scope);a.wrap(s),s.format(n,r)}}insertAt(e,i,n){const r=n==null?this.scroll.create("text",i):this.scroll.create(i,n),a=this.split(e);this.parent.insertBefore(r,a||void 0)}isolate(e,i){const n=this.split(e);if(n==null)throw new Error("Attempt to isolate at end");return n.split(i),n}length(){return 1}offset(e=this.parent){return this.parent==null||this===e?0:this.parent.children.offset(this)+this.parent.offset(e)}optimize(e){this.statics.requiredContainer&&!(this.parent instanceof this.statics.requiredContainer)&&this.wrap(this.statics.requiredContainer.blotName)}remove(){this.domNode.parentNode!=null&&this.domNode.parentNode.removeChild(this.domNode),this.detach()}replaceWith(e,i){const n=typeof e=="string"?this.scroll.create(e,i):e;return this.parent!=null&&(this.parent.insertBefore(n,this.next||void 0),this.remove()),n}split(e,i){return e===0?this:this.next}update(e,i){}wrap(e,i){const n=typeof e=="string"?this.scroll.create(e,i):e;if(this.parent!=null&&this.parent.insertBefore(n,this.next||void 0),typeof n.appendChild!="function")throw new TS(`Cannot wrap ${e}`);return n.appendChild(this),n}};tCe.blotName="abstract";let iCe=tCe;const nCe=class extends iCe{static value(e){return!0}index(e,i){return this.domNode===e||this.domNode.compareDocumentPosition(e)&Node.DOCUMENT_POSITION_CONTAINED_BY?Math.min(i,1):-1}position(e,i){let n=Array.from(this.parent.domNode.childNodes).indexOf(this.domNode);return e>0&&(n+=1),[this.parent.domNode,n]}value(){return{[this.statics.blotName]:this.statics.value(this.domNode)||!0}}};nCe.scope=Ci.INLINE_BLOT;let Ygt=nCe;const Yl=Ygt;class Kgt{constructor(){this.head=null,this.tail=null,this.length=0}append(...e){if(this.insertBefore(e[0],null),e.length>1){const i=e.slice(1);this.append(...i)}}at(e){const i=this.iterator();let n=i();for(;n&&e>0;)e-=1,n=i();return n}contains(e){const i=this.iterator();let n=i();for(;n;){if(n===e)return!0;n=i()}return!1}indexOf(e){const i=this.iterator();let n=i(),r=0;for(;n;){if(n===e)return r;r+=1,n=i()}return-1}insertBefore(e,i){e!=null&&(this.remove(e),e.next=i,i!=null?(e.prev=i.prev,i.prev!=null&&(i.prev.next=e),i.prev=e,i===this.head&&(this.head=e)):this.tail!=null?(this.tail.next=e,e.prev=this.tail,this.tail=e):(e.prev=null,this.head=this.tail=e),this.length+=1)}offset(e){let i=0,n=this.head;for(;n!=null;){if(n===e)return i;i+=n.length(),n=n.next}return-1}remove(e){this.contains(e)&&(e.prev!=null&&(e.prev.next=e.next),e.next!=null&&(e.next.prev=e.prev),e===this.head&&(this.head=e.next),e===this.tail&&(this.tail=e.prev),this.length-=1)}iterator(e=this.head){return()=>{const i=e;return e!=null&&(e=e.next),i}}find(e,i=!1){const n=this.iterator();let r=n();for(;r;){const a=r.length();if(e<a||i&&e===a&&(r.next==null||r.next.length()!==0))return[r,e];e-=a,r=n()}return[null,0]}forEach(e){const i=this.iterator();let n=i();for(;n;)e(n),n=i()}forEachAt(e,i,n){if(i<=0)return;const[r,a]=this.find(e);let s=e-a;const o=this.iterator(r);let l=o();for(;l&&s<e+i;){const c=l.length();e>s?n(l,e-s,Math.min(i,s+c-e)):n(l,0,Math.min(c,e+i-s)),s+=c,l=o()}}map(e){return this.reduce((i,n)=>(i.push(e(n)),i),[])}reduce(e,i){const n=this.iterator();let r=n();for(;r;)i=e(i,r),r=n();return i}}function Cie(t,e){const i=e.find(t);if(i)return i;try{return e.create(t)}catch{const n=e.create(Ci.INLINE);return Array.from(t.childNodes).forEach(r=>{n.domNode.appendChild(r)}),t.parentNode&&t.parentNode.replaceChild(n.domNode,t),n.attach(),n}}const rCe=class Uv extends iCe{constructor(e,i){super(e,i),this.uiNode=null,this.build()}appendChild(e){this.insertBefore(e)}attach(){super.attach(),this.children.forEach(e=>{e.attach()})}attachUI(e){this.uiNode!=null&&this.uiNode.remove(),this.uiNode=e,Uv.uiClass&&this.uiNode.classList.add(Uv.uiClass),this.uiNode.setAttribute("contenteditable","false"),this.domNode.insertBefore(this.uiNode,this.domNode.firstChild)}build(){this.children=new Kgt,Array.from(this.domNode.childNodes).filter(e=>e!==this.uiNode).reverse().forEach(e=>{try{const i=Cie(e,this.scroll);this.insertBefore(i,this.children.head||void 0)}catch(i){if(i instanceof TS)return;throw i}})}deleteAt(e,i){if(e===0&&i===this.length())return this.remove();this.children.forEachAt(e,i,(n,r,a)=>{n.deleteAt(r,a)})}descendant(e,i=0){const[n,r]=this.children.find(i);return e.blotName==null&&e(n)||e.blotName!=null&&n instanceof e?[n,r]:n instanceof Uv?n.descendant(e,r):[null,-1]}descendants(e,i=0,n=Number.MAX_VALUE){let r=[],a=n;return this.children.forEachAt(i,n,(s,o,l)=>{(e.blotName==null&&e(s)||e.blotName!=null&&s instanceof e)&&r.push(s),s instanceof Uv&&(r=r.concat(s.descendants(e,o,a))),a-=l}),r}detach(){this.children.forEach(e=>{e.detach()}),super.detach()}enforceAllowedChildren(){let e=!1;this.children.forEach(i=>{e||this.statics.allowedChildren.some(n=>i instanceof n)||(i.statics.scope===Ci.BLOCK_BLOT?(i.next!=null&&this.splitAfter(i),i.prev!=null&&this.splitAfter(i.prev),i.parent.unwrap(),e=!0):i instanceof Uv?i.unwrap():i.remove())})}formatAt(e,i,n,r){this.children.forEachAt(e,i,(a,s,o)=>{a.formatAt(s,o,n,r)})}insertAt(e,i,n){const[r,a]=this.children.find(e);if(r)r.insertAt(a,i,n);else{const s=n==null?this.scroll.create("text",i):this.scroll.create(i,n);this.appendChild(s)}}insertBefore(e,i){e.parent!=null&&e.parent.children.remove(e);let n=null;this.children.insertBefore(e,i||null),e.parent=this,i!=null&&(n=i.domNode),(this.domNode.parentNode!==e.domNode||this.domNode.nextSibling!==n)&&this.domNode.insertBefore(e.domNode,n),e.attach()}length(){return this.children.reduce((e,i)=>e+i.length(),0)}moveChildren(e,i){this.children.forEach(n=>{e.insertBefore(n,i)})}optimize(e){if(super.optimize(e),this.enforceAllowedChildren(),this.uiNode!=null&&this.uiNode!==this.domNode.firstChild&&this.domNode.insertBefore(this.uiNode,this.domNode.firstChild),this.children.length===0)if(this.statics.defaultChild!=null){const i=this.scroll.create(this.statics.defaultChild.blotName);this.appendChild(i)}else this.remove()}path(e,i=!1){const[n,r]=this.children.find(e,i),a=[[this,e]];return n instanceof Uv?a.concat(n.path(r,i)):(n!=null&&a.push([n,r]),a)}removeChild(e){this.children.remove(e)}replaceWith(e,i){const n=typeof e=="string"?this.scroll.create(e,i):e;return n instanceof Uv&&this.moveChildren(n),super.replaceWith(n)}split(e,i=!1){if(!i){if(e===0)return this;if(e===this.length())return this.next}const n=this.clone();return this.parent&&this.parent.insertBefore(n,this.next||void 0),this.children.forEachAt(e,this.length(),(r,a,s)=>{const o=r.split(a,i);o!=null&&n.appendChild(o)}),n}splitAfter(e){const i=this.clone();for(;e.next!=null;)i.appendChild(e.next);return this.parent&&this.parent.insertBefore(i,this.next||void 0),i}unwrap(){this.parent&&this.moveChildren(this.parent,this.next||void 0),this.remove()}update(e,i){const n=[],r=[];e.forEach(a=>{a.target===this.domNode&&a.type==="childList"&&(n.push(...a.addedNodes),r.push(...a.removedNodes))}),r.forEach(a=>{if(a.parentNode!=null&&a.tagName!=="IFRAME"&&document.body.compareDocumentPosition(a)&Node.DOCUMENT_POSITION_CONTAINED_BY)return;const s=this.scroll.find(a);s!=null&&(s.domNode.parentNode==null||s.domNode.parentNode===this.domNode)&&s.detach()}),n.filter(a=>a.parentNode===this.domNode&&a!==this.uiNode).sort((a,s)=>a===s?0:a.compareDocumentPosition(s)&Node.DOCUMENT_POSITION_FOLLOWING?1:-1).forEach(a=>{let s=null;a.nextSibling!=null&&(s=this.scroll.find(a.nextSibling));const o=Cie(a,this.scroll);(o.next!==s||o.next==null)&&(o.parent!=null&&o.parent.removeChild(this),this.insertBefore(o,s||void 0))}),this.enforceAllowedChildren()}};rCe.uiClass="";let Zgt=rCe;const Ah=Zgt;function Xgt(t,e){if(Object.keys(t).length!==Object.keys(e).length)return!1;for(const i in t)if(t[i]!==e[i])return!1;return!0}const z0=class q0 extends Ah{static create(e){return super.create(e)}static formats(e,i){const n=i.query(q0.blotName);if(!(n!=null&&e.tagName===n.tagName)){if(typeof this.tagName=="string")return!0;if(Array.isArray(this.tagName))return e.tagName.toLowerCase()}}constructor(e,i){super(e,i),this.attributes=new Y2(this.domNode)}format(e,i){if(e===this.statics.blotName&&!i)this.children.forEach(n=>{n instanceof q0||(n=n.wrap(q0.blotName,!0)),this.attributes.copy(n)}),this.unwrap();else{const n=this.scroll.query(e,Ci.INLINE);if(n==null)return;n instanceof hm?this.attributes.attribute(n,i):i&&(e!==this.statics.blotName||this.formats()[e]!==i)&&this.replaceWith(e,i)}}formats(){const e=this.attributes.values(),i=this.statics.formats(this.domNode,this.scroll);return i!=null&&(e[this.statics.blotName]=i),e}formatAt(e,i,n,r){this.formats()[n]!=null||this.scroll.query(n,Ci.ATTRIBUTE)?this.isolate(e,i).format(n,r):super.formatAt(e,i,n,r)}optimize(e){super.optimize(e);const i=this.formats();if(Object.keys(i).length===0)return this.unwrap();const n=this.next;n instanceof q0&&n.prev===this&&Xgt(i,n.formats())&&(n.moveChildren(this),n.remove())}replaceWith(e,i){const n=super.replaceWith(e,i);return this.attributes.copy(n),n}update(e,i){super.update(e,i),e.some(n=>n.target===this.domNode&&n.type==="attributes")&&this.attributes.build()}wrap(e,i){const n=super.wrap(e,i);return n instanceof q0&&this.attributes.move(n),n}};z0.allowedChildren=[z0,Yl],z0.blotName="inline",z0.scope=Ci.INLINE_BLOT,z0.tagName="SPAN";let Jgt=z0;const nK=Jgt,W0=class $H extends Ah{static create(e){return super.create(e)}static formats(e,i){const n=i.query($H.blotName);if(!(n!=null&&e.tagName===n.tagName)){if(typeof this.tagName=="string")return!0;if(Array.isArray(this.tagName))return e.tagName.toLowerCase()}}constructor(e,i){super(e,i),this.attributes=new Y2(this.domNode)}format(e,i){const n=this.scroll.query(e,Ci.BLOCK);n!=null&&(n instanceof hm?this.attributes.attribute(n,i):e===this.statics.blotName&&!i?this.replaceWith($H.blotName):i&&(e!==this.statics.blotName||this.formats()[e]!==i)&&this.replaceWith(e,i))}formats(){const e=this.attributes.values(),i=this.statics.formats(this.domNode,this.scroll);return i!=null&&(e[this.statics.blotName]=i),e}formatAt(e,i,n,r){this.scroll.query(n,Ci.BLOCK)!=null?this.format(n,r):super.formatAt(e,i,n,r)}insertAt(e,i,n){if(n==null||this.scroll.query(i,Ci.INLINE)!=null)super.insertAt(e,i,n);else{const r=this.split(e);if(r!=null){const a=this.scroll.create(i,n);r.parent.insertBefore(a,r)}else throw new Error("Attempt to insertAt after block boundaries")}}replaceWith(e,i){const n=super.replaceWith(e,i);return this.attributes.copy(n),n}update(e,i){super.update(e,i),e.some(n=>n.target===this.domNode&&n.type==="attributes")&&this.attributes.build()}};W0.blotName="block",W0.scope=Ci.BLOCK_BLOT,W0.tagName="P",W0.allowedChildren=[nK,W0,Yl];let Qgt=W0;const wP=Qgt,BH=class extends Ah{checkMerge(){return this.next!==null&&this.next.statics.blotName===this.statics.blotName}deleteAt(e,i){super.deleteAt(e,i),this.enforceAllowedChildren()}formatAt(e,i,n,r){super.formatAt(e,i,n,r),this.enforceAllowedChildren()}insertAt(e,i,n){super.insertAt(e,i,n),this.enforceAllowedChildren()}optimize(e){super.optimize(e),this.children.length>0&&this.next!=null&&this.checkMerge()&&(this.next.moveChildren(this),this.next.remove())}};BH.blotName="container",BH.scope=Ci.BLOCK_BLOT;let evt=BH;const K2=evt;class tvt extends Yl{static formats(e,i){}format(e,i){super.formatAt(0,this.length(),e,i)}formatAt(e,i,n,r){e===0&&i===this.length()?this.format(n,r):super.formatAt(e,i,n,r)}formats(){return this.statics.formats(this.domNode,this.scroll)}}const Gd=tvt,ivt={attributes:!0,characterData:!0,characterDataOldValue:!0,childList:!0,subtree:!0},nvt=100,Y0=class extends Ah{constructor(e,i){super(null,i),this.registry=e,this.scroll=this,this.build(),this.observer=new MutationObserver(n=>{this.update(n)}),this.observer.observe(this.domNode,ivt),this.attach()}create(e,i){return this.registry.create(this,e,i)}find(e,i=!1){const n=this.registry.find(e,i);return n?n.scroll===this?n:i?this.find(n.scroll.domNode.parentNode,!0):null:null}query(e,i=Ci.ANY){return this.registry.query(e,i)}register(...e){return this.registry.register(...e)}build(){this.scroll!=null&&super.build()}detach(){super.detach(),this.observer.disconnect()}deleteAt(e,i){this.update(),e===0&&i===this.length()?this.children.forEach(n=>{n.remove()}):super.deleteAt(e,i)}formatAt(e,i,n,r){this.update(),super.formatAt(e,i,n,r)}insertAt(e,i,n){this.update(),super.insertAt(e,i,n)}optimize(e=[],i={}){super.optimize(i);const n=i.mutationsMap||new WeakMap;let r=Array.from(this.observer.takeRecords());for(;r.length>0;)e.push(r.pop());const a=(l,c=!0)=>{l==null||l===this||l.domNode.parentNode!=null&&(n.has(l.domNode)||n.set(l.domNode,[]),c&&a(l.parent))},s=l=>{n.has(l.domNode)&&(l instanceof Ah&&l.children.forEach(s),n.delete(l.domNode),l.optimize(i))};let o=e;for(let l=0;o.length>0;l+=1){if(l>=nvt)throw new Error("[Parchment] Maximum optimize iterations reached");for(o.forEach(c=>{const u=this.find(c.target,!0);u!=null&&(u.domNode===c.target&&(c.type==="childList"?(a(this.find(c.previousSibling,!1)),Array.from(c.addedNodes).forEach(d=>{const p=this.find(d,!1);a(p,!1),p instanceof Ah&&p.children.forEach(h=>{a(h,!1)})})):c.type==="attributes"&&a(u.prev)),a(u))}),this.children.forEach(s),o=Array.from(this.observer.takeRecords()),r=o.slice();r.length>0;)e.push(r.pop())}}update(e,i={}){e=e||this.observer.takeRecords();const n=new WeakMap;e.map(r=>{const a=this.find(r.target,!0);return a==null?null:n.has(a.domNode)?(n.get(a.domNode).push(r),null):(n.set(a.domNode,[r]),a)}).forEach(r=>{r!=null&&r!==this&&n.has(r.domNode)&&r.update(n.get(r.domNode)||[],i)}),i.mutationsMap=n,n.has(this.domNode)&&super.update(n.get(this.domNode),i),this.optimize(e,i)}};Y0.blotName="scroll",Y0.defaultChild=wP,Y0.allowedChildren=[wP,K2],Y0.scope=Ci.BLOCK_BLOT,Y0.tagName="DIV";let rvt=Y0;const rK=rvt,VH=class aCe extends Yl{static create(e){return document.createTextNode(e)}static value(e){return e.data}constructor(e,i){super(e,i),this.text=this.statics.value(this.domNode)}deleteAt(e,i){this.domNode.data=this.text=this.text.slice(0,e)+this.text.slice(e+i)}index(e,i){return this.domNode===e?i:-1}insertAt(e,i,n){n==null?(this.text=this.text.slice(0,e)+i+this.text.slice(e),this.domNode.data=this.text):super.insertAt(e,i,n)}length(){return this.text.length}optimize(e){super.optimize(e),this.text=this.statics.value(this.domNode),this.text.length===0?this.remove():this.next instanceof aCe&&this.next.prev===this&&(this.insertAt(this.length(),this.next.value()),this.next.remove())}position(e,i=!1){return[this.domNode,e]}split(e,i=!1){if(!i){if(e===0)return this;if(e===this.length())return this.next}const n=this.scroll.create(this.domNode.splitText(e));return this.parent.insertBefore(n,this.next||void 0),this.text=this.statics.value(this.domNode),n}update(e,i){e.some(n=>n.type==="characterData"&&n.target===this.domNode)&&(this.text=this.statics.value(this.domNode))}value(){return this.text}};VH.blotName="text",VH.scope=Ci.INLINE_BLOT;let avt=VH;const Lk=avt,svt=Object.freeze(Object.defineProperty({__proto__:null,Attributor:hm,AttributorStore:Y2,BlockBlot:wP,ClassAttributor:sf,ContainerBlot:K2,EmbedBlot:Gd,InlineBlot:nK,LeafBlot:Yl,ParentBlot:Ah,Registry:LT,Scope:Ci,ScrollBlot:rK,StyleAttributor:ub,TextBlot:Lk},Symbol.toStringTag,{value:"Module"}));var jH={exports:{}},Td=-1,Bc=1,ko=0;function SP(t,e,i,n,r){if(t===e)return t?[[ko,t]]:[];if(i!=null){var a=mvt(t,e,i);if(a)return a}var s=aK(t,e),o=t.substring(0,s);t=t.substring(s),e=e.substring(s),s=Z2(t,e);var l=t.substring(t.length-s);t=t.substring(0,t.length-s),e=e.substring(0,e.length-s);var c=ovt(t,e);return o&&c.unshift([ko,o]),l&&c.push([ko,l]),sK(c,r),n&&uvt(c),c}function ovt(t,e){var i;if(!t)return[[Bc,e]];if(!e)return[[Td,t]];var n=t.length>e.length?t:e,r=t.length>e.length?e:t,a=n.indexOf(r);if(a!==-1)return i=[[Bc,n.substring(0,a)],[ko,r],[Bc,n.substring(a+r.length)]],t.length>e.length&&(i[0][0]=i[2][0]=Td),i;if(r.length===1)return[[Td,t],[Bc,e]];var s=cvt(t,e);if(s){var o=s[0],l=s[1],c=s[2],u=s[3],d=s[4],p=SP(o,c),h=SP(l,u);return p.concat([[ko,d]],h)}return lvt(t,e)}function lvt(t,e){for(var i=t.length,n=e.length,r=Math.ceil((i+n)/2),a=r,s=2*r,o=new Array(s),l=new Array(s),c=0;c<s;c++)o[c]=-1,l[c]=-1;o[a+1]=0,l[a+1]=0;for(var u=i-n,d=u%2!==0,p=0,h=0,f=0,m=0,g=0;g<r;g++){for(var v=-g+p;v<=g-h;v+=2){var y=a+v,b;v===-g||v!==g&&o[y-1]<o[y+1]?b=o[y+1]:b=o[y-1]+1;for(var I=b-v;b<i&&I<n&&t.charAt(b)===e.charAt(I);)b++,I++;if(o[y]=b,b>i)h+=2;else if(I>n)p+=2;else if(d){var T=a+u-v;if(T>=0&&T<s&&l[T]!==-1){var w=i-l[T];if(b>=w)return Rie(t,e,b,I)}}}for(var S=-g+f;S<=g-m;S+=2){var T=a+S,w;S===-g||S!==g&&l[T-1]<l[T+1]?w=l[T+1]:w=l[T-1]+1;for(var U=w-S;w<i&&U<n&&t.charAt(i-w-1)===e.charAt(n-U-1);)w++,U++;if(l[T]=w,w>i)m+=2;else if(U>n)f+=2;else if(!d){var y=a+u-S;if(y>=0&&y<s&&o[y]!==-1){var b=o[y],I=a+b-y;if(w=i-w,b>=w)return Rie(t,e,b,I)}}}}return[[Td,t],[Bc,e]]}function Rie(t,e,i,n){var r=t.substring(0,i),a=e.substring(0,n),s=t.substring(i),o=e.substring(n),l=SP(r,a),c=SP(s,o);return l.concat(c)}function aK(t,e){if(!t||!e||t.charAt(0)!==e.charAt(0))return 0;for(var i=0,n=Math.min(t.length,e.length),r=n,a=0;i<r;)t.substring(a,r)==e.substring(a,r)?(i=r,a=i):n=r,r=Math.floor((n-i)/2+i);return sCe(t.charCodeAt(r-1))&&r--,r}function Mie(t,e){var i=t.length,n=e.length;if(i==0||n==0)return 0;i>n?t=t.substring(i-n):i<n&&(e=e.substring(0,i));var r=Math.min(i,n);if(t==e)return r;for(var a=0,s=1;;){var o=t.substring(r-s),l=e.indexOf(o);if(l==-1)return a;s+=l,(l==0||t.substring(r-s)==e.substring(0,s))&&(a=s,s++)}}function Z2(t,e){if(!t||!e||t.slice(-1)!==e.slice(-1))return 0;for(var i=0,n=Math.min(t.length,e.length),r=n,a=0;i<r;)t.substring(t.length-r,t.length-a)==e.substring(e.length-r,e.length-a)?(i=r,a=i):n=r,r=Math.floor((n-i)/2+i);return oCe(t.charCodeAt(t.length-r))&&r--,r}function cvt(t,e){var i=t.length>e.length?t:e,n=t.length>e.length?e:t;if(i.length<4||n.length*2<i.length)return null;function r(h,f,m){for(var g=h.substring(m,m+Math.floor(h.length/4)),v=-1,y="",b,I,T,w;(v=f.indexOf(g,v+1))!==-1;){var S=aK(h.substring(m),f.substring(v)),U=Z2(h.substring(0,m),f.substring(0,v));y.length<U+S&&(y=f.substring(v-U,v)+f.substring(v,v+S),b=h.substring(0,m-U),I=h.substring(m+S),T=f.substring(0,v-U),w=f.substring(v+S))}return y.length*2>=h.length?[b,I,T,w,y]:null}var a=r(i,n,Math.ceil(i.length/4)),s=r(i,n,Math.ceil(i.length/2)),o;if(!a&&!s)return null;s?a?o=a[4].length>s[4].length?a:s:o=s:o=a;var l,c,u,d;t.length>e.length?(l=o[0],c=o[1],u=o[2],d=o[3]):(u=o[0],d=o[1],l=o[2],c=o[3]);var p=o[4];return[l,c,u,d,p]}function uvt(t){for(var e=!1,i=[],n=0,r=null,a=0,s=0,o=0,l=0,c=0;a<t.length;)t[a][0]==ko?(i[n++]=a,s=l,o=c,l=0,c=0,r=t[a][1]):(t[a][0]==Bc?l+=t[a][1].length:c+=t[a][1].length,r&&r.length<=Math.max(s,o)&&r.length<=Math.max(l,c)&&(t.splice(i[n-1],0,[Td,r]),t[i[n-1]+1][0]=Bc,n--,n--,a=n>0?i[n-1]:-1,s=0,o=0,l=0,c=0,r=null,e=!0)),a++;for(e&&sK(t),hvt(t),a=1;a<t.length;){if(t[a-1][0]==Td&&t[a][0]==Bc){var u=t[a-1][1],d=t[a][1],p=Mie(u,d),h=Mie(d,u);p>=h?(p>=u.length/2||p>=d.length/2)&&(t.splice(a,0,[ko,d.substring(0,p)]),t[a-1][1]=u.substring(0,u.length-p),t[a+1][1]=d.substring(p),a++):(h>=u.length/2||h>=d.length/2)&&(t.splice(a,0,[ko,u.substring(0,h)]),t[a-1][0]=Bc,t[a-1][1]=d.substring(0,d.length-h),t[a+1][0]=Td,t[a+1][1]=u.substring(h),a++),a++}a++}}var Nie=/[^a-zA-Z0-9]/,Aie=/\s/,_ie=/[\r\n]/,dvt=/\n\r?\n$/,pvt=/^\r?\n\r?\n/;function hvt(t){function e(h,f){if(!h||!f)return 6;var m=h.charAt(h.length-1),g=f.charAt(0),v=m.match(Nie),y=g.match(Nie),b=v&&m.match(Aie),I=y&&g.match(Aie),T=b&&m.match(_ie),w=I&&g.match(_ie),S=T&&h.match(dvt),U=w&&f.match(pvt);return S||U?5:T||w?4:v&&!b&&I?3:b||I?2:v||y?1:0}for(var i=1;i<t.length-1;){if(t[i-1][0]==ko&&t[i+1][0]==ko){var n=t[i-1][1],r=t[i][1],a=t[i+1][1],s=Z2(n,r);if(s){var o=r.substring(r.length-s);n=n.substring(0,n.length-s),r=o+r.substring(0,r.length-s),a=o+a}for(var l=n,c=r,u=a,d=e(n,r)+e(r,a);r.charAt(0)===a.charAt(0);){n+=r.charAt(0),r=r.substring(1)+a.charAt(0),a=a.substring(1);var p=e(n,r)+e(r,a);p>=d&&(d=p,l=n,c=r,u=a)}t[i-1][1]!=l&&(l?t[i-1][1]=l:(t.splice(i-1,1),i--),t[i][1]=c,u?t[i+1][1]=u:(t.splice(i+1,1),i--))}i++}}function sK(t,e){t.push([ko,""]);for(var i=0,n=0,r=0,a="",s="",o;i<t.length;){if(i<t.length-1&&!t[i][1]){t.splice(i,1);continue}switch(t[i][0]){case Bc:r++,s+=t[i][1],i++;break;case Td:n++,a+=t[i][1],i++;break;case ko:var l=i-r-n-1;if(e){if(l>=0&&cCe(t[l][1])){var c=t[l][1].slice(-1);if(t[l][1]=t[l][1].slice(0,-1),a=c+a,s=c+s,!t[l][1]){t.splice(l,1),i--;var u=l-1;t[u]&&t[u][0]===Bc&&(r++,s=t[u][1]+s,u--),t[u]&&t[u][0]===Td&&(n++,a=t[u][1]+a,u--),l=u}}if(lCe(t[i][1])){var c=t[i][1].charAt(0);t[i][1]=t[i][1].slice(1),a+=c,s+=c}}if(i<t.length-1&&!t[i][1]){t.splice(i,1);break}if(a.length>0||s.length>0){a.length>0&&s.length>0&&(o=aK(s,a),o!==0&&(l>=0?t[l][1]+=s.substring(0,o):(t.splice(0,0,[ko,s.substring(0,o)]),i++),s=s.substring(o),a=a.substring(o)),o=Z2(s,a),o!==0&&(t[i][1]=s.substring(s.length-o)+t[i][1],s=s.substring(0,s.length-o),a=a.substring(0,a.length-o)));var d=r+n;a.length===0&&s.length===0?(t.splice(i-d,d),i=i-d):a.length===0?(t.splice(i-d,d,[Bc,s]),i=i-d+1):s.length===0?(t.splice(i-d,d,[Td,a]),i=i-d+1):(t.splice(i-d,d,[Td,a],[Bc,s]),i=i-d+2)}i!==0&&t[i-1][0]===ko?(t[i-1][1]+=t[i][1],t.splice(i,1)):i++,r=0,n=0,a="",s="";break}}t[t.length-1][1]===""&&t.pop();var p=!1;for(i=1;i<t.length-1;)t[i-1][0]===ko&&t[i+1][0]===ko&&(t[i][1].substring(t[i][1].length-t[i-1][1].length)===t[i-1][1]?(t[i][1]=t[i-1][1]+t[i][1].substring(0,t[i][1].length-t[i-1][1].length),t[i+1][1]=t[i-1][1]+t[i+1][1],t.splice(i-1,1),p=!0):t[i][1].substring(0,t[i+1][1].length)==t[i+1][1]&&(t[i-1][1]+=t[i+1][1],t[i][1]=t[i][1].substring(t[i+1][1].length)+t[i+1][1],t.splice(i+1,1),p=!0)),i++;p&&sK(t,e)}function sCe(t){return t>=55296&&t<=56319}function oCe(t){return t>=56320&&t<=57343}function lCe(t){return oCe(t.charCodeAt(0))}function cCe(t){return sCe(t.charCodeAt(t.length-1))}function fvt(t){for(var e=[],i=0;i<t.length;i++)t[i][1].length>0&&e.push(t[i]);return e}function WB(t,e,i,n){return cCe(t)||lCe(n)?null:fvt([[ko,t],[Td,e],[Bc,i],[ko,n]])}function mvt(t,e,i){var n=typeof i=="number"?{index:i,length:0}:i.oldRange,r=typeof i=="number"?null:i.newRange,a=t.length,s=e.length;if(n.length===0&&(r===null||r.length===0)){var o=n.index,l=t.slice(0,o),c=t.slice(o),u=r?r.index:null;e:{var d=o+s-a;if(u!==null&&u!==d||d<0||d>s)break e;var p=e.slice(0,d),h=e.slice(d);if(h!==c)break e;var f=Math.min(o,d),m=l.slice(0,f),g=p.slice(0,f);if(m!==g)break e;var v=l.slice(f),y=p.slice(f);return WB(m,v,y,c)}e:{if(u!==null&&u!==o)break e;var b=o,p=e.slice(0,b),h=e.slice(b);if(p!==l)break e;var I=Math.min(a-b,s-b),T=c.slice(c.length-I),w=h.slice(h.length-I);if(T!==w)break e;var v=c.slice(0,c.length-I),y=h.slice(0,h.length-I);return WB(l,v,y,T)}}if(n.length>0&&r&&r.length===0)e:{var m=t.slice(0,n.index),T=t.slice(n.index+n.length),f=m.length,I=T.length;if(s<f+I)break e;var g=e.slice(0,f),w=e.slice(s-I);if(m!==g||T!==w)break e;var v=t.slice(f,a-I),y=e.slice(f,s-I);return WB(m,v,y,T)}return null}function X2(t,e,i,n){return SP(t,e,i,n,!0)}X2.INSERT=Bc;X2.DELETE=Td;X2.EQUAL=ko;var gvt=X2,Fk={exports:{}};Fk.exports;(function(t,e){var i=200,n="__lodash_hash_undefined__",r=9007199254740991,a="[object Arguments]",s="[object Array]",o="[object Boolean]",l="[object Date]",c="[object Error]",u="[object Function]",d="[object GeneratorFunction]",p="[object Map]",h="[object Number]",f="[object Object]",m="[object Promise]",g="[object RegExp]",v="[object Set]",y="[object String]",b="[object Symbol]",I="[object WeakMap]",T="[object ArrayBuffer]",w="[object DataView]",S="[object Float32Array]",U="[object Float64Array]",P="[object Int8Array]",E="[object Int16Array]",R="[object Int32Array]",C="[object Uint8Array]",M="[object Uint8ClampedArray]",_="[object Uint16Array]",A="[object Uint32Array]",N=/[\\^$.*+?()[\]{}|]/g,k=/\w*$/,O=/^\[object .+?Constructor\]$/,$=/^(?:0|[1-9]\d*)$/,F={};F[a]=F[s]=F[T]=F[w]=F[o]=F[l]=F[S]=F[U]=F[P]=F[E]=F[R]=F[p]=F[h]=F[f]=F[g]=F[v]=F[y]=F[b]=F[C]=F[M]=F[_]=F[A]=!0,F[c]=F[u]=F[I]=!1;var V=typeof dp=="object"&&dp&&dp.Object===Object&&dp,j=typeof self=="object"&&self&&self.Object===Object&&self,B=V||j||Function("return this")(),z=e&&!e.nodeType&&e,W=z&&!0&&t&&!t.nodeType&&t,Z=W&&W.exports===z;function K(ee,ye){return ee.set(ye[0],ye[1]),ee}function Q(ee,ye){return ee.add(ye),ee}function J(ee,ye){for(var _e=-1,ft=ee?ee.length:0;++_e<ft&&ye(ee[_e],_e,ee)!==!1;);return ee}function se(ee,ye){for(var _e=-1,ft=ye.length,Wi=ee.length;++_e<ft;)ee[Wi+_e]=ye[_e];return ee}function ie(ee,ye,_e,ft){for(var Wi=-1,bi=ee?ee.length:0;++Wi<bi;)_e=ye(_e,ee[Wi],Wi,ee);return _e}function ce(ee,ye){for(var _e=-1,ft=Array(ee);++_e<ee;)ft[_e]=ye(_e);return ft}function oe(ee,ye){return ee==null?void 0:ee[ye]}function te(ee){var ye=!1;if(ee!=null&&typeof ee.toString!="function")try{ye=!!(ee+"")}catch{}return ye}function le(ee){var ye=-1,_e=Array(ee.size);return ee.forEach(function(ft,Wi){_e[++ye]=[Wi,ft]}),_e}function ne(ee,ye){return function(_e){return ee(ye(_e))}}function me(ee){var ye=-1,_e=Array(ee.size);return ee.forEach(function(ft){_e[++ye]=ft}),_e}var be=Array.prototype,Se=Function.prototype,we=Object.prototype,ze=B["__core-js_shared__"],Qe=function(){var ee=/[^.]+$/.exec(ze&&ze.keys&&ze.keys.IE_PROTO||"");return ee?"Symbol(src)_1."+ee:""}(),ke=Se.toString,yt=we.hasOwnProperty,lt=we.toString,Ct=RegExp("^"+ke.call(yt).replace(N,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Nt=Z?B.Buffer:void 0,Ce=B.Symbol,Ge=B.Uint8Array,$e=ne(Object.getPrototypeOf,Object),at=Object.create,ct=we.propertyIsEnumerable,Vt=be.splice,Me=Object.getOwnPropertySymbols,De=Nt?Nt.isBuffer:void 0,Je=ne(Object.keys,Object),St=Mo(B,"DataView"),bt=Mo(B,"Map"),Ie=Mo(B,"Promise"),Ue=Mo(B,"Set"),Oe=Mo(B,"WeakMap"),Ee=Mo(Object,"create"),Xe=Vs(St),Et=Vs(bt),Fe=Vs(Ie),ht=Vs(Ue),ti=Vs(Oe),Ke=Ce?Ce.prototype:void 0,zt=Ke?Ke.valueOf:void 0;function mt(ee){var ye=-1,_e=ee?ee.length:0;for(this.clear();++ye<_e;){var ft=ee[ye];this.set(ft[0],ft[1])}}function Tt(){this.__data__=Ee?Ee(null):{}}function Ut(ee){return this.has(ee)&&delete this.__data__[ee]}function zi(ee){var ye=this.__data__;if(Ee){var _e=ye[ee];return _e===n?void 0:_e}return yt.call(ye,ee)?ye[ee]:void 0}function gi(ee){var ye=this.__data__;return Ee?ye[ee]!==void 0:yt.call(ye,ee)}function Dt(ee,ye){var _e=this.__data__;return _e[ee]=Ee&&ye===void 0?n:ye,this}mt.prototype.clear=Tt,mt.prototype.delete=Ut,mt.prototype.get=zi,mt.prototype.has=gi,mt.prototype.set=Dt;function Ui(ee){var ye=-1,_e=ee?ee.length:0;for(this.clear();++ye<_e;){var ft=ee[ye];this.set(ft[0],ft[1])}}function Cr(){this.__data__=[]}function nn(ee){var ye=this.__data__,_e=Js(ye,ee);if(_e<0)return!1;var ft=ye.length-1;return _e==ft?ye.pop():Vt.call(ye,_e,1),!0}function tr(ee){var ye=this.__data__,_e=Js(ye,ee);return _e<0?void 0:ye[_e][1]}function lr(ee){return Js(this.__data__,ee)>-1}function Xa(ee,ye){var _e=this.__data__,ft=Js(_e,ee);return ft<0?_e.push([ee,ye]):_e[ft][1]=ye,this}Ui.prototype.clear=Cr,Ui.prototype.delete=nn,Ui.prototype.get=tr,Ui.prototype.has=lr,Ui.prototype.set=Xa;function Gr(ee){var ye=-1,_e=ee?ee.length:0;for(this.clear();++ye<_e;){var ft=ee[ye];this.set(ft[0],ft[1])}}function hl(){this.__data__={hash:new mt,map:new(bt||Ui),string:new mt}}function Xp(ee){return Ko(this,ee).delete(ee)}function Tc(ee){return Ko(this,ee).get(ee)}function uf(ee){return Ko(this,ee).has(ee)}function zd(ee,ye){return Ko(this,ee).set(ee,ye),this}Gr.prototype.clear=hl,Gr.prototype.delete=Xp,Gr.prototype.get=Tc,Gr.prototype.has=uf,Gr.prototype.set=zd;function An(ee){this.__data__=new Ui(ee)}function Uc(){this.__data__=new Ui}function Xs(ee){return this.__data__.delete(ee)}function pu(ee){return this.__data__.get(ee)}function hu(ee){return this.__data__.has(ee)}function fl(ee,ye){var _e=this.__data__;if(_e instanceof Ui){var ft=_e.__data__;if(!bt||ft.length<i-1)return ft.push([ee,ye]),this;_e=this.__data__=new Gr(ft)}return _e.set(ee,ye),this}An.prototype.clear=Uc,An.prototype.delete=Xs,An.prototype.get=pu,An.prototype.has=hu,An.prototype.set=fl;function Co(ee,ye){var _e=Ds(ee)||Bi(ee)?ce(ee.length,String):[],ft=_e.length,Wi=!!ft;for(var bi in ee)yt.call(ee,bi)&&!(Wi&&(bi=="length"||Pc(bi,ft)))&&_e.push(bi);return _e}function Dc(ee,ye,_e){var ft=ee[ye];(!(yt.call(ee,ye)&&vl(ft,_e))||_e===void 0&&!(ye in ee))&&(ee[ye]=_e)}function Js(ee,ye){for(var _e=ee.length;_e--;)if(vl(ee[_e][0],ye))return _e;return-1}function Fs(ee,ye){return ee&&cd(ye,yl(ye),ee)}function Ec(ee,ye,_e,ft,Wi,bi,Wn){var li;if(ft&&(li=bi?ft(ee,Wi,bi,Wn):ft(ee)),li!==void 0)return li;if(!js(ee))return ee;var Qa=Ds(ee);if(Qa){if(li=Qp(ee),!ye)return pf(ee,li)}else{var Un=gl(ee),wa=Un==u||Un==d;if(hf(ee))return on(ee,ye);if(Un==f||Un==a||wa&&!bi){if(te(ee))return bi?ee:{};if(li=Gl(wa?{}:ee),!ye)return $s(ee,Fs(li,ee))}else{if(!F[Un])return bi?ee:{};li=Bs(ee,Un,Ec,ye)}}Wn||(Wn=new An);var Gs=Wn.get(ee);if(Gs)return Gs;if(Wn.set(ee,li),!Qa)var es=_e?qr(ee):yl(ee);return J(es||ee,function(ka,ts){es&&(ts=ka,ka=ee[ts]),Dc(li,ts,Ec(ka,ye,_e,ft,ts,ee,Wn))}),li}function df(ee){return js(ee)?at(ee):{}}function nt(ee,ye,_e){var ft=ye(ee);return Ds(ee)?ft:se(ft,_e(ee))}function Wt(ee){return lt.call(ee)}function $i(ee){if(!js(ee)||Hl(ee))return!1;var ye=Qs(ee)||te(ee)?Ct:O;return ye.test(Vs(ee))}function Ja(ee){if(!Wd(ee))return Je(ee);var ye=[];for(var _e in Object(ee))yt.call(ee,_e)&&_e!="constructor"&&ye.push(_e);return ye}function on(ee,ye){if(ye)return ee.slice();var _e=new ee.constructor(ee.length);return ee.copy(_e),_e}function Yo(ee){var ye=new ee.constructor(ee.byteLength);return new Ge(ye).set(new Ge(ee)),ye}function ml(ee,ye){var _e=ye?Yo(ee.buffer):ee.buffer;return new ee.constructor(_e,ee.byteOffset,ee.byteLength)}function qi(ee,ye,_e){var ft=ye?_e(le(ee),!0):le(ee);return ie(ft,K,new ee.constructor)}function zr(ee){var ye=new ee.constructor(ee.source,k.exec(ee));return ye.lastIndex=ee.lastIndex,ye}function Jp(ee,ye,_e){var ft=ye?_e(me(ee),!0):me(ee);return ie(ft,Q,new ee.constructor)}function ld(ee){return zt?Object(zt.call(ee)):{}}function Ro(ee,ye){var _e=ye?Yo(ee.buffer):ee.buffer;return new ee.constructor(_e,ee.byteOffset,ee.length)}function pf(ee,ye){var _e=-1,ft=ee.length;for(ye||(ye=Array(ft));++_e<ft;)ye[_e]=ee[_e];return ye}function cd(ee,ye,_e,ft){_e||(_e={});for(var Wi=-1,bi=ye.length;++Wi<bi;){var Wn=ye[Wi],li=void 0;Dc(_e,Wn,li===void 0?ee[Wn]:li)}return _e}function $s(ee,ye){return cd(ee,ln(ee),ye)}function qr(ee){return nt(ee,yl,ln)}function Ko(ee,ye){var _e=ee.__data__;return qd(ye)?_e[typeof ye=="string"?"string":"hash"]:_e.map}function Mo(ee,ye){var _e=oe(ee,ye);return $i(_e)?_e:void 0}var ln=Me?ne(Me,Object):_a,gl=Wt;(St&&gl(new St(new ArrayBuffer(1)))!=w||bt&&gl(new bt)!=p||Ie&&gl(Ie.resolve())!=m||Ue&&gl(new Ue)!=v||Oe&&gl(new Oe)!=I)&&(gl=function(ee){var ye=lt.call(ee),_e=ye==f?ee.constructor:void 0,ft=_e?Vs(_e):void 0;if(ft)switch(ft){case Xe:return w;case Et:return p;case Fe:return m;case ht:return v;case ti:return I}return ye});function Qp(ee){var ye=ee.length,_e=ee.constructor(ye);return ye&&typeof ee[0]=="string"&&yt.call(ee,"index")&&(_e.index=ee.index,_e.input=ee.input),_e}function Gl(ee){return typeof ee.constructor=="function"&&!Wd(ee)?df($e(ee)):{}}function Bs(ee,ye,_e,ft){var Wi=ee.constructor;switch(ye){case T:return Yo(ee);case o:case l:return new Wi(+ee);case w:return ml(ee,ft);case S:case U:case P:case E:case R:case C:case M:case _:case A:return Ro(ee,ft);case p:return qi(ee,ft,_e);case h:case y:return new Wi(ee);case g:return zr(ee);case v:return Jp(ee,ft,_e);case b:return ld(ee)}}function Pc(ee,ye){return ye=ye??r,!!ye&&(typeof ee=="number"||$.test(ee))&&ee>-1&&ee%1==0&&ee<ye}function qd(ee){var ye=typeof ee;return ye=="string"||ye=="number"||ye=="symbol"||ye=="boolean"?ee!=="__proto__":ee===null}function Hl(ee){return!!Qe&&Qe in ee}function Wd(ee){var ye=ee&&ee.constructor,_e=typeof ye=="function"&&ye.prototype||we;return ee===_e}function Vs(ee){if(ee!=null){try{return ke.call(ee)}catch{}try{return ee+""}catch{}}return""}function ha(ee){return Ec(ee,!0,!0)}function vl(ee,ye){return ee===ye||ee!==ee&&ye!==ye}function Bi(ee){return Cc(ee)&&yt.call(ee,"callee")&&(!ct.call(ee,"callee")||lt.call(ee)==a)}var Ds=Array.isArray;function cr(ee){return ee!=null&&Yd(ee.length)&&!Qs(ee)}function Cc(ee){return Kd(ee)&&cr(ee)}var hf=De||fu;function Qs(ee){var ye=js(ee)?lt.call(ee):"";return ye==u||ye==d}function Yd(ee){return typeof ee=="number"&&ee>-1&&ee%1==0&&ee<=r}function js(ee){var ye=typeof ee;return!!ee&&(ye=="object"||ye=="function")}function Kd(ee){return!!ee&&typeof ee=="object"}function yl(ee){return cr(ee)?Co(ee):Ja(ee)}function _a(){return[]}function fu(){return!1}t.exports=ha})(Fk,Fk.exports);var uCe=Fk.exports,$k={exports:{}};$k.exports;(function(t,e){var i=200,n="__lodash_hash_undefined__",r=1,a=2,s=9007199254740991,o="[object Arguments]",l="[object Array]",c="[object AsyncFunction]",u="[object Boolean]",d="[object Date]",p="[object Error]",h="[object Function]",f="[object GeneratorFunction]",m="[object Map]",g="[object Number]",v="[object Null]",y="[object Object]",b="[object Promise]",I="[object Proxy]",T="[object RegExp]",w="[object Set]",S="[object String]",U="[object Symbol]",P="[object Undefined]",E="[object WeakMap]",R="[object ArrayBuffer]",C="[object DataView]",M="[object Float32Array]",_="[object Float64Array]",A="[object Int8Array]",N="[object Int16Array]",k="[object Int32Array]",O="[object Uint8Array]",$="[object Uint8ClampedArray]",F="[object Uint16Array]",V="[object Uint32Array]",j=/[\\^$.*+?()[\]{}|]/g,B=/^\[object .+?Constructor\]$/,z=/^(?:0|[1-9]\d*)$/,W={};W[M]=W[_]=W[A]=W[N]=W[k]=W[O]=W[$]=W[F]=W[V]=!0,W[o]=W[l]=W[R]=W[u]=W[C]=W[d]=W[p]=W[h]=W[m]=W[g]=W[y]=W[T]=W[w]=W[S]=W[E]=!1;var Z=typeof dp=="object"&&dp&&dp.Object===Object&&dp,K=typeof self=="object"&&self&&self.Object===Object&&self,Q=Z||K||Function("return this")(),J=e&&!e.nodeType&&e,se=J&&!0&&t&&!t.nodeType&&t,ie=se&&se.exports===J,ce=ie&&Z.process,oe=function(){try{return ce&&ce.binding&&ce.binding("util")}catch{}}(),te=oe&&oe.isTypedArray;function le(ee,ye){for(var _e=-1,ft=ee==null?0:ee.length,Wi=0,bi=[];++_e<ft;){var Wn=ee[_e];ye(Wn,_e,ee)&&(bi[Wi++]=Wn)}return bi}function ne(ee,ye){for(var _e=-1,ft=ye.length,Wi=ee.length;++_e<ft;)ee[Wi+_e]=ye[_e];return ee}function me(ee,ye){for(var _e=-1,ft=ee==null?0:ee.length;++_e<ft;)if(ye(ee[_e],_e,ee))return!0;return!1}function be(ee,ye){for(var _e=-1,ft=Array(ee);++_e<ee;)ft[_e]=ye(_e);return ft}function Se(ee){return function(ye){return ee(ye)}}function we(ee,ye){return ee.has(ye)}function ze(ee,ye){return ee==null?void 0:ee[ye]}function Qe(ee){var ye=-1,_e=Array(ee.size);return ee.forEach(function(ft,Wi){_e[++ye]=[Wi,ft]}),_e}function ke(ee,ye){return function(_e){return ee(ye(_e))}}function yt(ee){var ye=-1,_e=Array(ee.size);return ee.forEach(function(ft){_e[++ye]=ft}),_e}var lt=Array.prototype,Ct=Function.prototype,Nt=Object.prototype,Ce=Q["__core-js_shared__"],Ge=Ct.toString,$e=Nt.hasOwnProperty,at=function(){var ee=/[^.]+$/.exec(Ce&&Ce.keys&&Ce.keys.IE_PROTO||"");return ee?"Symbol(src)_1."+ee:""}(),ct=Nt.toString,Vt=RegExp("^"+Ge.call($e).replace(j,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Me=ie?Q.Buffer:void 0,De=Q.Symbol,Je=Q.Uint8Array,St=Nt.propertyIsEnumerable,bt=lt.splice,Ie=De?De.toStringTag:void 0,Ue=Object.getOwnPropertySymbols,Oe=Me?Me.isBuffer:void 0,Ee=ke(Object.keys,Object),Xe=ln(Q,"DataView"),Et=ln(Q,"Map"),Fe=ln(Q,"Promise"),ht=ln(Q,"Set"),ti=ln(Q,"WeakMap"),Ke=ln(Object,"create"),zt=Vs(Xe),mt=Vs(Et),Tt=Vs(Fe),Ut=Vs(ht),zi=Vs(ti),gi=De?De.prototype:void 0,Dt=gi?gi.valueOf:void 0;function Ui(ee){var ye=-1,_e=ee==null?0:ee.length;for(this.clear();++ye<_e;){var ft=ee[ye];this.set(ft[0],ft[1])}}function Cr(){this.__data__=Ke?Ke(null):{},this.size=0}function nn(ee){var ye=this.has(ee)&&delete this.__data__[ee];return this.size-=ye?1:0,ye}function tr(ee){var ye=this.__data__;if(Ke){var _e=ye[ee];return _e===n?void 0:_e}return $e.call(ye,ee)?ye[ee]:void 0}function lr(ee){var ye=this.__data__;return Ke?ye[ee]!==void 0:$e.call(ye,ee)}function Xa(ee,ye){var _e=this.__data__;return this.size+=this.has(ee)?0:1,_e[ee]=Ke&&ye===void 0?n:ye,this}Ui.prototype.clear=Cr,Ui.prototype.delete=nn,Ui.prototype.get=tr,Ui.prototype.has=lr,Ui.prototype.set=Xa;function Gr(ee){var ye=-1,_e=ee==null?0:ee.length;for(this.clear();++ye<_e;){var ft=ee[ye];this.set(ft[0],ft[1])}}function hl(){this.__data__=[],this.size=0}function Xp(ee){var ye=this.__data__,_e=on(ye,ee);if(_e<0)return!1;var ft=ye.length-1;return _e==ft?ye.pop():bt.call(ye,_e,1),--this.size,!0}function Tc(ee){var ye=this.__data__,_e=on(ye,ee);return _e<0?void 0:ye[_e][1]}function uf(ee){return on(this.__data__,ee)>-1}function zd(ee,ye){var _e=this.__data__,ft=on(_e,ee);return ft<0?(++this.size,_e.push([ee,ye])):_e[ft][1]=ye,this}Gr.prototype.clear=hl,Gr.prototype.delete=Xp,Gr.prototype.get=Tc,Gr.prototype.has=uf,Gr.prototype.set=zd;function An(ee){var ye=-1,_e=ee==null?0:ee.length;for(this.clear();++ye<_e;){var ft=ee[ye];this.set(ft[0],ft[1])}}function Uc(){this.size=0,this.__data__={hash:new Ui,map:new(Et||Gr),string:new Ui}}function Xs(ee){var ye=Mo(this,ee).delete(ee);return this.size-=ye?1:0,ye}function pu(ee){return Mo(this,ee).get(ee)}function hu(ee){return Mo(this,ee).has(ee)}function fl(ee,ye){var _e=Mo(this,ee),ft=_e.size;return _e.set(ee,ye),this.size+=_e.size==ft?0:1,this}An.prototype.clear=Uc,An.prototype.delete=Xs,An.prototype.get=pu,An.prototype.has=hu,An.prototype.set=fl;function Co(ee){var ye=-1,_e=ee==null?0:ee.length;for(this.__data__=new An;++ye<_e;)this.add(ee[ye])}function Dc(ee){return this.__data__.set(ee,n),this}function Js(ee){return this.__data__.has(ee)}Co.prototype.add=Co.prototype.push=Dc,Co.prototype.has=Js;function Fs(ee){var ye=this.__data__=new Gr(ee);this.size=ye.size}function Ec(){this.__data__=new Gr,this.size=0}function df(ee){var ye=this.__data__,_e=ye.delete(ee);return this.size=ye.size,_e}function nt(ee){return this.__data__.get(ee)}function Wt(ee){return this.__data__.has(ee)}function $i(ee,ye){var _e=this.__data__;if(_e instanceof Gr){var ft=_e.__data__;if(!Et||ft.length<i-1)return ft.push([ee,ye]),this.size=++_e.size,this;_e=this.__data__=new An(ft)}return _e.set(ee,ye),this.size=_e.size,this}Fs.prototype.clear=Ec,Fs.prototype.delete=df,Fs.prototype.get=nt,Fs.prototype.has=Wt,Fs.prototype.set=$i;function Ja(ee,ye){var _e=Bi(ee),ft=!_e&&vl(ee),Wi=!_e&&!ft&&cr(ee),bi=!_e&&!ft&&!Wi&&Kd(ee),Wn=_e||ft||Wi||bi,li=Wn?be(ee.length,String):[],Qa=li.length;for(var Un in ee)$e.call(ee,Un)&&!(Wn&&(Un=="length"||Wi&&(Un=="offset"||Un=="parent")||bi&&(Un=="buffer"||Un=="byteLength"||Un=="byteOffset")||Bs(Un,Qa)))&&li.push(Un);return li}function on(ee,ye){for(var _e=ee.length;_e--;)if(ha(ee[_e][0],ye))return _e;return-1}function Yo(ee,ye,_e){var ft=ye(ee);return Bi(ee)?ft:ne(ft,_e(ee))}function ml(ee){return ee==null?ee===void 0?P:v:Ie&&Ie in Object(ee)?gl(ee):Wd(ee)}function qi(ee){return js(ee)&&ml(ee)==o}function zr(ee,ye,_e,ft,Wi){return ee===ye?!0:ee==null||ye==null||!js(ee)&&!js(ye)?ee!==ee&&ye!==ye:Jp(ee,ye,_e,ft,zr,Wi)}function Jp(ee,ye,_e,ft,Wi,bi){var Wn=Bi(ee),li=Bi(ye),Qa=Wn?l:Gl(ee),Un=li?l:Gl(ye);Qa=Qa==o?y:Qa,Un=Un==o?y:Un;var wa=Qa==y,Gs=Un==y,es=Qa==Un;if(es&&cr(ee)){if(!cr(ye))return!1;Wn=!0,wa=!1}if(es&&!wa)return bi||(bi=new Fs),Wn||Kd(ee)?cd(ee,ye,_e,ft,Wi,bi):$s(ee,ye,Qa,_e,ft,Wi,bi);if(!(_e&r)){var ka=wa&&$e.call(ee,"__wrapped__"),ts=Gs&&$e.call(ye,"__wrapped__");if(ka||ts){var zl=ka?ee.value():ee,mu=ts?ye.value():ye;return bi||(bi=new Fs),Wi(zl,mu,_e,ft,bi)}}return es?(bi||(bi=new Fs),qr(ee,ye,_e,ft,Wi,bi)):!1}function ld(ee){if(!Yd(ee)||qd(ee))return!1;var ye=hf(ee)?Vt:B;return ye.test(Vs(ee))}function Ro(ee){return js(ee)&&Qs(ee.length)&&!!W[ml(ee)]}function pf(ee){if(!Hl(ee))return Ee(ee);var ye=[];for(var _e in Object(ee))$e.call(ee,_e)&&_e!="constructor"&&ye.push(_e);return ye}function cd(ee,ye,_e,ft,Wi,bi){var Wn=_e&r,li=ee.length,Qa=ye.length;if(li!=Qa&&!(Wn&&Qa>li))return!1;var Un=bi.get(ee);if(Un&&bi.get(ye))return Un==ye;var wa=-1,Gs=!0,es=_e&a?new Co:void 0;for(bi.set(ee,ye),bi.set(ye,ee);++wa<li;){var ka=ee[wa],ts=ye[wa];if(ft)var zl=Wn?ft(ts,ka,wa,ye,ee,bi):ft(ka,ts,wa,ee,ye,bi);if(zl!==void 0){if(zl)continue;Gs=!1;break}if(es){if(!me(ye,function(mu,eh){if(!we(es,eh)&&(ka===mu||Wi(ka,mu,_e,ft,bi)))return es.push(eh)})){Gs=!1;break}}else if(!(ka===ts||Wi(ka,ts,_e,ft,bi))){Gs=!1;break}}return bi.delete(ee),bi.delete(ye),Gs}function $s(ee,ye,_e,ft,Wi,bi,Wn){switch(_e){case C:if(ee.byteLength!=ye.byteLength||ee.byteOffset!=ye.byteOffset)return!1;ee=ee.buffer,ye=ye.buffer;case R:return!(ee.byteLength!=ye.byteLength||!bi(new Je(ee),new Je(ye)));case u:case d:case g:return ha(+ee,+ye);case p:return ee.name==ye.name&&ee.message==ye.message;case T:case S:return ee==ye+"";case m:var li=Qe;case w:var Qa=ft&r;if(li||(li=yt),ee.size!=ye.size&&!Qa)return!1;var Un=Wn.get(ee);if(Un)return Un==ye;ft|=a,Wn.set(ee,ye);var wa=cd(li(ee),li(ye),ft,Wi,bi,Wn);return Wn.delete(ee),wa;case U:if(Dt)return Dt.call(ee)==Dt.call(ye)}return!1}function qr(ee,ye,_e,ft,Wi,bi){var Wn=_e&r,li=Ko(ee),Qa=li.length,Un=Ko(ye),wa=Un.length;if(Qa!=wa&&!Wn)return!1;for(var Gs=Qa;Gs--;){var es=li[Gs];if(!(Wn?es in ye:$e.call(ye,es)))return!1}var ka=bi.get(ee);if(ka&&bi.get(ye))return ka==ye;var ts=!0;bi.set(ee,ye),bi.set(ye,ee);for(var zl=Wn;++Gs<Qa;){es=li[Gs];var mu=ee[es],eh=ye[es];if(ft)var th=Wn?ft(eh,mu,es,ye,ee,bi):ft(mu,eh,es,ee,ye,bi);if(!(th===void 0?mu===eh||Wi(mu,eh,_e,ft,bi):th)){ts=!1;break}zl||(zl=es=="constructor")}if(ts&&!zl){var ff=ee.constructor,No=ye.constructor;ff!=No&&"constructor"in ee&&"constructor"in ye&&!(typeof ff=="function"&&ff instanceof ff&&typeof No=="function"&&No instanceof No)&&(ts=!1)}return bi.delete(ee),bi.delete(ye),ts}function Ko(ee){return Yo(ee,yl,Qp)}function Mo(ee,ye){var _e=ee.__data__;return Pc(ye)?_e[typeof ye=="string"?"string":"hash"]:_e.map}function ln(ee,ye){var _e=ze(ee,ye);return ld(_e)?_e:void 0}function gl(ee){var ye=$e.call(ee,Ie),_e=ee[Ie];try{ee[Ie]=void 0;var ft=!0}catch{}var Wi=ct.call(ee);return ft&&(ye?ee[Ie]=_e:delete ee[Ie]),Wi}var Qp=Ue?function(ee){return ee==null?[]:(ee=Object(ee),le(Ue(ee),function(ye){return St.call(ee,ye)}))}:_a,Gl=ml;(Xe&&Gl(new Xe(new ArrayBuffer(1)))!=C||Et&&Gl(new Et)!=m||Fe&&Gl(Fe.resolve())!=b||ht&&Gl(new ht)!=w||ti&&Gl(new ti)!=E)&&(Gl=function(ee){var ye=ml(ee),_e=ye==y?ee.constructor:void 0,ft=_e?Vs(_e):"";if(ft)switch(ft){case zt:return C;case mt:return m;case Tt:return b;case Ut:return w;case zi:return E}return ye});function Bs(ee,ye){return ye=ye??s,!!ye&&(typeof ee=="number"||z.test(ee))&&ee>-1&&ee%1==0&&ee<ye}function Pc(ee){var ye=typeof ee;return ye=="string"||ye=="number"||ye=="symbol"||ye=="boolean"?ee!=="__proto__":ee===null}function qd(ee){return!!at&&at in ee}function Hl(ee){var ye=ee&&ee.constructor,_e=typeof ye=="function"&&ye.prototype||Nt;return ee===_e}function Wd(ee){return ct.call(ee)}function Vs(ee){if(ee!=null){try{return Ge.call(ee)}catch{}try{return ee+""}catch{}}return""}function ha(ee,ye){return ee===ye||ee!==ee&&ye!==ye}var vl=qi(function(){return arguments}())?qi:function(ee){return js(ee)&&$e.call(ee,"callee")&&!St.call(ee,"callee")},Bi=Array.isArray;function Ds(ee){return ee!=null&&Qs(ee.length)&&!hf(ee)}var cr=Oe||fu;function Cc(ee,ye){return zr(ee,ye)}function hf(ee){if(!Yd(ee))return!1;var ye=ml(ee);return ye==h||ye==f||ye==c||ye==I}function Qs(ee){return typeof ee=="number"&&ee>-1&&ee%1==0&&ee<=s}function Yd(ee){var ye=typeof ee;return ee!=null&&(ye=="object"||ye=="function")}function js(ee){return ee!=null&&typeof ee=="object"}var Kd=te?Se(te):Ro;function yl(ee){return Ds(ee)?Ja(ee):pf(ee)}function _a(){return[]}function fu(){return!1}t.exports=Cc})($k,$k.exports);var dCe=$k.exports,oK={};Object.defineProperty(oK,"__esModule",{value:!0});const vvt=uCe,yvt=dCe;var GH;(function(t){function e(a={},s={},o=!1){typeof a!="object"&&(a={}),typeof s!="object"&&(s={});let l=vvt(s);o||(l=Object.keys(l).reduce((c,u)=>(l[u]!=null&&(c[u]=l[u]),c),{}));for(const c in a)a[c]!==void 0&&s[c]===void 0&&(l[c]=a[c]);return Object.keys(l).length>0?l:void 0}t.compose=e;function i(a={},s={}){typeof a!="object"&&(a={}),typeof s!="object"&&(s={});const o=Object.keys(a).concat(Object.keys(s)).reduce((l,c)=>(yvt(a[c],s[c])||(l[c]=s[c]===void 0?null:s[c]),l),{});return Object.keys(o).length>0?o:void 0}t.diff=i;function n(a={},s={}){a=a||{};const o=Object.keys(s).reduce((l,c)=>(s[c]!==a[c]&&a[c]!==void 0&&(l[c]=s[c]),l),{});return Object.keys(a).reduce((l,c)=>(a[c]!==s[c]&&s[c]===void 0&&(l[c]=null),l),o)}t.invert=n;function r(a,s,o=!1){if(typeof a!="object")return s;if(typeof s!="object")return;if(!o)return s;const l=Object.keys(s).reduce((c,u)=>(a[u]===void 0&&(c[u]=s[u]),c),{});return Object.keys(l).length>0?l:void 0}t.transform=r})(GH||(GH={}));oK.default=GH;var J2={};Object.defineProperty(J2,"__esModule",{value:!0});var HH;(function(t){function e(i){return typeof i.delete=="number"?i.delete:typeof i.retain=="number"?i.retain:typeof i.retain=="object"&&i.retain!==null?1:typeof i.insert=="string"?i.insert.length:1}t.length=e})(HH||(HH={}));J2.default=HH;var lK={};Object.defineProperty(lK,"__esModule",{value:!0});const kie=J2;class bvt{constructor(e){this.ops=e,this.index=0,this.offset=0}hasNext(){return this.peekLength()<1/0}next(e){e||(e=1/0);const i=this.ops[this.index];if(i){const n=this.offset,r=kie.default.length(i);if(e>=r-n?(e=r-n,this.index+=1,this.offset=0):this.offset+=e,typeof i.delete=="number")return{delete:e};{const a={};return i.attributes&&(a.attributes=i.attributes),typeof i.retain=="number"?a.retain=e:typeof i.retain=="object"&&i.retain!==null?a.retain=i.retain:typeof i.insert=="string"?a.insert=i.insert.substr(n,e):a.insert=i.insert,a}}else return{retain:1/0}}peek(){return this.ops[this.index]}peekLength(){return this.ops[this.index]?kie.default.length(this.ops[this.index])-this.offset:1/0}peekType(){const e=this.ops[this.index];return e?typeof e.delete=="number"?"delete":typeof e.retain=="number"||typeof e.retain=="object"&&e.retain!==null?"retain":"insert":"retain"}rest(){if(this.hasNext()){if(this.offset===0)return this.ops.slice(this.index);{const e=this.offset,i=this.index,n=this.next(),r=this.ops.slice(this.index);return this.offset=e,this.index=i,[n].concat(r)}}else return[]}}lK.default=bvt;(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.AttributeMap=e.OpIterator=e.Op=void 0;const i=gvt,n=uCe,r=dCe,a=oK;e.AttributeMap=a.default;const s=J2;e.Op=s.default;const o=lK;e.OpIterator=o.default;const l="\0",c=(d,p)=>{if(typeof d!="object"||d===null)throw new Error(`cannot retain a ${typeof d}`);if(typeof p!="object"||p===null)throw new Error(`cannot retain a ${typeof p}`);const h=Object.keys(d)[0];if(!h||h!==Object.keys(p)[0])throw new Error(`embed types not matched: ${h} != ${Object.keys(p)[0]}`);return[h,d[h],p[h]]};class u{constructor(p){Array.isArray(p)?this.ops=p:p!=null&&Array.isArray(p.ops)?this.ops=p.ops:this.ops=[]}static registerEmbed(p,h){this.handlers[p]=h}static unregisterEmbed(p){delete this.handlers[p]}static getHandler(p){const h=this.handlers[p];if(!h)throw new Error(`no handlers for embed type "${p}"`);return h}insert(p,h){const f={};return typeof p=="string"&&p.length===0?this:(f.insert=p,h!=null&&typeof h=="object"&&Object.keys(h).length>0&&(f.attributes=h),this.push(f))}delete(p){return p<=0?this:this.push({delete:p})}retain(p,h){if(typeof p=="number"&&p<=0)return this;const f={retain:p};return h!=null&&typeof h=="object"&&Object.keys(h).length>0&&(f.attributes=h),this.push(f)}push(p){let h=this.ops.length,f=this.ops[h-1];if(p=n(p),typeof f=="object"){if(typeof p.delete=="number"&&typeof f.delete=="number")return this.ops[h-1]={delete:f.delete+p.delete},this;if(typeof f.delete=="number"&&p.insert!=null&&(h-=1,f=this.ops[h-1],typeof f!="object"))return this.ops.unshift(p),this;if(r(p.attributes,f.attributes)){if(typeof p.insert=="string"&&typeof f.insert=="string")return this.ops[h-1]={insert:f.insert+p.insert},typeof p.attributes=="object"&&(this.ops[h-1].attributes=p.attributes),this;if(typeof p.retain=="number"&&typeof f.retain=="number")return this.ops[h-1]={retain:f.retain+p.retain},typeof p.attributes=="object"&&(this.ops[h-1].attributes=p.attributes),this}}return h===this.ops.length?this.ops.push(p):this.ops.splice(h,0,p),this}chop(){const p=this.ops[this.ops.length-1];return p&&typeof p.retain=="number"&&!p.attributes&&this.ops.pop(),this}filter(p){return this.ops.filter(p)}forEach(p){this.ops.forEach(p)}map(p){return this.ops.map(p)}partition(p){const h=[],f=[];return this.forEach(m=>{(p(m)?h:f).push(m)}),[h,f]}reduce(p,h){return this.ops.reduce(p,h)}changeLength(){return this.reduce((p,h)=>h.insert?p+s.default.length(h):h.delete?p-h.delete:p,0)}length(){return this.reduce((p,h)=>p+s.default.length(h),0)}slice(p=0,h=1/0){const f=[],m=new o.default(this.ops);let g=0;for(;g<h&&m.hasNext();){let v;g<p?v=m.next(p-g):(v=m.next(h-g),f.push(v)),g+=s.default.length(v)}return new u(f)}compose(p){const h=new o.default(this.ops),f=new o.default(p.ops),m=[],g=f.peek();if(g!=null&&typeof g.retain=="number"&&g.attributes==null){let y=g.retain;for(;h.peekType()==="insert"&&h.peekLength()<=y;)y-=h.peekLength(),m.push(h.next());g.retain-y>0&&f.next(g.retain-y)}const v=new u(m);for(;h.hasNext()||f.hasNext();)if(f.peekType()==="insert")v.push(f.next());else if(h.peekType()==="delete")v.push(h.next());else{const y=Math.min(h.peekLength(),f.peekLength()),b=h.next(y),I=f.next(y);if(I.retain){const T={};if(typeof b.retain=="number")T.retain=typeof I.retain=="number"?y:I.retain;else if(typeof I.retain=="number")b.retain==null?T.insert=b.insert:T.retain=b.retain;else{const S=b.retain==null?"insert":"retain",[U,P,E]=c(b[S],I.retain),R=u.getHandler(U);T[S]={[U]:R.compose(P,E,S==="retain")}}const w=a.default.compose(b.attributes,I.attributes,typeof b.retain=="number");if(w&&(T.attributes=w),v.push(T),!f.hasNext()&&r(v.ops[v.ops.length-1],T)){const S=new u(h.rest());return v.concat(S).chop()}}else typeof I.delete=="number"&&(typeof b.retain=="number"||typeof b.retain=="object"&&b.retain!==null)&&v.push(I)}return v.chop()}concat(p){const h=new u(this.ops.slice());return p.ops.length>0&&(h.push(p.ops[0]),h.ops=h.ops.concat(p.ops.slice(1))),h}diff(p,h){if(this.ops===p.ops)return new u;const f=[this,p].map(b=>b.map(I=>{if(I.insert!=null)return typeof I.insert=="string"?I.insert:l;const T=b===p?"on":"with";throw new Error("diff() called "+T+" non-document")}).join("")),m=new u,g=i(f[0],f[1],h,!0),v=new o.default(this.ops),y=new o.default(p.ops);return g.forEach(b=>{let I=b[1].length;for(;I>0;){let T=0;switch(b[0]){case i.INSERT:T=Math.min(y.peekLength(),I),m.push(y.next(T));break;case i.DELETE:T=Math.min(I,v.peekLength()),v.next(T),m.delete(T);break;case i.EQUAL:T=Math.min(v.peekLength(),y.peekLength(),I);const w=v.next(T),S=y.next(T);r(w.insert,S.insert)?m.retain(T,a.default.diff(w.attributes,S.attributes)):m.push(S).delete(T);break}I-=T}}),m.chop()}eachLine(p,h=`
`){const f=new o.default(this.ops);let m=new u,g=0;for(;f.hasNext();){if(f.peekType()!=="insert")return;const v=f.peek(),y=s.default.length(v)-f.peekLength(),b=typeof v.insert=="string"?v.insert.indexOf(h,y)-y:-1;if(b<0)m.push(f.next());else if(b>0)m.push(f.next(b));else{if(p(m,f.next(1).attributes||{},g)===!1)return;g+=1,m=new u}}m.length()>0&&p(m,{},g)}invert(p){const h=new u;return this.reduce((f,m)=>{if(m.insert)h.delete(s.default.length(m));else{if(typeof m.retain=="number"&&m.attributes==null)return h.retain(m.retain),f+m.retain;if(m.delete||typeof m.retain=="number"){const g=m.delete||m.retain;return p.slice(f,f+g).forEach(y=>{m.delete?h.push(y):m.retain&&m.attributes&&h.retain(s.default.length(y),a.default.invert(m.attributes,y.attributes))}),f+g}else if(typeof m.retain=="object"&&m.retain!==null){const g=p.slice(f,f+1),v=new o.default(g.ops).next(),[y,b,I]=c(m.retain,v.insert),T=u.getHandler(y);return h.retain({[y]:T.invert(b,I)},a.default.invert(m.attributes,v.attributes)),f+1}}return f},0),h.chop()}transform(p,h=!1){if(h=!!h,typeof p=="number")return this.transformPosition(p,h);const f=p,m=new o.default(this.ops),g=new o.default(f.ops),v=new u;for(;m.hasNext()||g.hasNext();)if(m.peekType()==="insert"&&(h||g.peekType()!=="insert"))v.retain(s.default.length(m.next()));else if(g.peekType()==="insert")v.push(g.next());else{const y=Math.min(m.peekLength(),g.peekLength()),b=m.next(y),I=g.next(y);if(b.delete)continue;if(I.delete)v.push(I);else{const T=b.retain,w=I.retain;let S=typeof w=="object"&&w!==null?w:y;if(typeof T=="object"&&T!==null&&typeof w=="object"&&w!==null){const U=Object.keys(T)[0];if(U===Object.keys(w)[0]){const P=u.getHandler(U);P&&(S={[U]:P.transform(T[U],w[U],h)})}}v.retain(S,a.default.transform(b.attributes,I.attributes,h))}}return v.chop()}transformPosition(p,h=!1){h=!!h;const f=new o.default(this.ops);let m=0;for(;f.hasNext()&&m<=p;){const g=f.peekLength(),v=f.peekType();if(f.next(),v==="delete"){p-=Math.min(g,p-m);continue}else v==="insert"&&(m<p||!h)&&(p+=g);m+=g}return p}}u.Op=s.default,u.OpIterator=o.default,u.AttributeMap=a.default,u.handlers={},e.default=u,t.exports=u,t.exports.default=u})(jH,jH.exports);var hp=jH.exports;const Di=eR(hp);class of extends Gd{static value(){}optimize(){(this.prev||this.next)&&this.remove()}length(){return 0}value(){return""}}of.blotName="break";of.tagName="BR";let Kh=class extends Lk{};function Q2(t){return t.replace(/[&<>"']/g,e=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"})[e])}const If=class If extends nK{static compare(e,i){const n=If.order.indexOf(e),r=If.order.indexOf(i);return n>=0||r>=0?n-r:e===i?0:e<i?-1:1}formatAt(e,i,n,r){if(If.compare(this.statics.blotName,n)<0&&this.scroll.query(n,Ci.BLOT)){const a=this.isolate(e,i);r&&a.wrap(n,r)}else super.formatAt(e,i,n,r)}optimize(e){if(super.optimize(e),this.parent instanceof If&&If.compare(this.statics.blotName,this.parent.statics.blotName)>0){const i=this.parent.isolate(this.offset(),this.length());this.moveChildren(i),i.wrap(this)}}};et(If,"allowedChildren",[If,of,Gd,Kh]),et(If,"order",["cursor","inline","link","underline","strike","italic","bold","script","code"]);let fm=If;const xie=1;class Rl extends wP{constructor(){super(...arguments);et(this,"cache",{})}delta(){return this.cache.delta==null&&(this.cache.delta=pCe(this)),this.cache.delta}deleteAt(i,n){super.deleteAt(i,n),this.cache={}}formatAt(i,n,r,a){n<=0||(this.scroll.query(r,Ci.BLOCK)?i+n===this.length()&&this.format(r,a):super.formatAt(i,Math.min(n,this.length()-i-1),r,a),this.cache={})}insertAt(i,n,r){if(r!=null){super.insertAt(i,n,r),this.cache={};return}if(n.length===0)return;const a=n.split(`
`),s=a.shift();s.length>0&&(i<this.length()-1||this.children.tail==null?super.insertAt(Math.min(i,this.length()-1),s):this.children.tail.insertAt(this.children.tail.length(),s),this.cache={});let o=this;a.reduce((l,c)=>(o=o.split(l,!0),o.insertAt(0,c),c.length),i+s.length)}insertBefore(i,n){const{head:r}=this.children;super.insertBefore(i,n),r instanceof of&&r.remove(),this.cache={}}length(){return this.cache.length==null&&(this.cache.length=super.length()+xie),this.cache.length}moveChildren(i,n){super.moveChildren(i,n),this.cache={}}optimize(i){super.optimize(i),this.cache={}}path(i){return super.path(i,!0)}removeChild(i){super.removeChild(i),this.cache={}}split(i){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(n&&(i===0||i>=this.length()-xie)){const a=this.clone();return i===0?(this.parent.insertBefore(a,this),this):(this.parent.insertBefore(a,this.next),a)}const r=super.split(i,n);return this.cache={},r}}Rl.blotName="block";Rl.tagName="P";Rl.defaultChild=of;Rl.allowedChildren=[of,fm,Gd,Kh];class lp extends Gd{attach(){super.attach(),this.attributes=new Y2(this.domNode)}delta(){return new Di().insert(this.value(),{...this.formats(),...this.attributes.values()})}format(e,i){const n=this.scroll.query(e,Ci.BLOCK_ATTRIBUTE);n!=null&&this.attributes.attribute(n,i)}formatAt(e,i,n,r){this.format(n,r)}insertAt(e,i,n){if(n!=null){super.insertAt(e,i,n);return}const r=i.split(`
`),a=r.pop(),s=r.map(l=>{const c=this.scroll.create(Rl.blotName);return c.insertAt(0,l),c}),o=this.split(e);s.forEach(l=>{this.parent.insertBefore(l,o)}),a&&this.parent.insertBefore(this.scroll.create("text",a),o)}}lp.scope=Ci.BLOCK_BLOT;function pCe(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return t.descendants(Yl).reduce((i,n)=>n.length()===0?i:i.insert(n.value(),sp(n,{},e)),new Di).insert(`
`,sp(t))}function sp(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;return t==null||("formats"in t&&typeof t.formats=="function"&&(e={...e,...t.formats()},i&&delete e["code-token"]),t.parent==null||t.parent.statics.blotName==="scroll"||t.parent.statics.scope!==t.statics.scope)?e:sp(t.parent,e,i)}const ip=class ip extends Gd{static value(){}constructor(e,i,n){super(e,i),this.selection=n,this.textNode=document.createTextNode(ip.CONTENTS),this.domNode.appendChild(this.textNode),this.savedLength=0}detach(){this.parent!=null&&this.parent.removeChild(this)}format(e,i){if(this.savedLength!==0){super.format(e,i);return}let n=this,r=0;for(;n!=null&&n.statics.scope!==Ci.BLOCK_BLOT;)r+=n.offset(n.parent),n=n.parent;n!=null&&(this.savedLength=ip.CONTENTS.length,n.optimize(),n.formatAt(r,ip.CONTENTS.length,e,i),this.savedLength=0)}index(e,i){return e===this.textNode?0:super.index(e,i)}length(){return this.savedLength}position(){return[this.textNode,this.textNode.data.length]}remove(){super.remove(),this.parent=null}restore(){if(this.selection.composing||this.parent==null)return null;const e=this.selection.getNativeRange();for(;this.domNode.lastChild!=null&&this.domNode.lastChild!==this.textNode;)this.domNode.parentNode.insertBefore(this.domNode.lastChild,this.domNode);const i=this.prev instanceof Kh?this.prev:null,n=i?i.length():0,r=this.next instanceof Kh?this.next:null,a=r?r.text:"",{textNode:s}=this,o=s.data.split(ip.CONTENTS).join("");s.data=ip.CONTENTS;let l;if(i)l=i,(o||r)&&(i.insertAt(i.length(),o+a),r&&r.remove());else if(r)l=r,r.insertAt(0,o);else{const c=document.createTextNode(o);l=this.scroll.create(c),this.parent.insertBefore(l,this)}if(this.remove(),e){const c=(p,h)=>i&&p===i.domNode?h:p===s?n+h-1:r&&p===r.domNode?n+o.length+h:null,u=c(e.start.node,e.start.offset),d=c(e.end.node,e.end.offset);if(u!==null&&d!==null)return{startNode:l.domNode,startOffset:u,endNode:l.domNode,endOffset:d}}return null}update(e,i){if(e.some(n=>n.type==="characterData"&&n.target===this.textNode)){const n=this.restore();n&&(i.range=n)}}optimize(e){super.optimize(e);let{parent:i}=this;for(;i;){if(i.domNode.tagName==="A"){this.savedLength=ip.CONTENTS.length,i.isolate(this.offset(i),this.length()).unwrap(),this.savedLength=0;break}i=i.parent}}value(){return""}};et(ip,"blotName","cursor"),et(ip,"className","ql-cursor"),et(ip,"tagName","span"),et(ip,"CONTENTS","\uFEFF");let FT=ip;var hCe={exports:{}};(function(t){var e=Object.prototype.hasOwnProperty,i="~";function n(){}Object.create&&(n.prototype=Object.create(null),new n().__proto__||(i=!1));function r(l,c,u){this.fn=l,this.context=c,this.once=u||!1}function a(l,c,u,d,p){if(typeof u!="function")throw new TypeError("The listener must be a function");var h=new r(u,d||l,p),f=i?i+c:c;return l._events[f]?l._events[f].fn?l._events[f]=[l._events[f],h]:l._events[f].push(h):(l._events[f]=h,l._eventsCount++),l}function s(l,c){--l._eventsCount===0?l._events=new n:delete l._events[c]}function o(){this._events=new n,this._eventsCount=0}o.prototype.eventNames=function(){var c=[],u,d;if(this._eventsCount===0)return c;for(d in u=this._events)e.call(u,d)&&c.push(i?d.slice(1):d);return Object.getOwnPropertySymbols?c.concat(Object.getOwnPropertySymbols(u)):c},o.prototype.listeners=function(c){var u=i?i+c:c,d=this._events[u];if(!d)return[];if(d.fn)return[d.fn];for(var p=0,h=d.length,f=new Array(h);p<h;p++)f[p]=d[p].fn;return f},o.prototype.listenerCount=function(c){var u=i?i+c:c,d=this._events[u];return d?d.fn?1:d.length:0},o.prototype.emit=function(c,u,d,p,h,f){var m=i?i+c:c;if(!this._events[m])return!1;var g=this._events[m],v=arguments.length,y,b;if(g.fn){switch(g.once&&this.removeListener(c,g.fn,void 0,!0),v){case 1:return g.fn.call(g.context),!0;case 2:return g.fn.call(g.context,u),!0;case 3:return g.fn.call(g.context,u,d),!0;case 4:return g.fn.call(g.context,u,d,p),!0;case 5:return g.fn.call(g.context,u,d,p,h),!0;case 6:return g.fn.call(g.context,u,d,p,h,f),!0}for(b=1,y=new Array(v-1);b<v;b++)y[b-1]=arguments[b];g.fn.apply(g.context,y)}else{var I=g.length,T;for(b=0;b<I;b++)switch(g[b].once&&this.removeListener(c,g[b].fn,void 0,!0),v){case 1:g[b].fn.call(g[b].context);break;case 2:g[b].fn.call(g[b].context,u);break;case 3:g[b].fn.call(g[b].context,u,d);break;case 4:g[b].fn.call(g[b].context,u,d,p);break;default:if(!y)for(T=1,y=new Array(v-1);T<v;T++)y[T-1]=arguments[T];g[b].fn.apply(g[b].context,y)}}return!0},o.prototype.on=function(c,u,d){return a(this,c,u,d,!1)},o.prototype.once=function(c,u,d){return a(this,c,u,d,!0)},o.prototype.removeListener=function(c,u,d,p){var h=i?i+c:c;if(!this._events[h])return this;if(!u)return s(this,h),this;var f=this._events[h];if(f.fn)f.fn===u&&(!p||f.once)&&(!d||f.context===d)&&s(this,h);else{for(var m=0,g=[],v=f.length;m<v;m++)(f[m].fn!==u||p&&!f[m].once||d&&f[m].context!==d)&&g.push(f[m]);g.length?this._events[h]=g.length===1?g[0]:g:s(this,h)}return this},o.prototype.removeAllListeners=function(c){var u;return c?(u=i?i+c:c,this._events[u]&&s(this,u)):(this._events=new n,this._eventsCount=0),this},o.prototype.off=o.prototype.removeListener,o.prototype.addListener=o.prototype.on,o.prefixed=i,o.EventEmitter=o,t.exports=o})(hCe);var Ivt=hCe.exports;const wvt=eR(Ivt),zH=new WeakMap,qH=["error","warn","log","info"];let WH="warn";function fCe(t){if(WH&&qH.indexOf(t)<=qH.indexOf(WH)){for(var e=arguments.length,i=new Array(e>1?e-1:0),n=1;n<e;n++)i[n-1]=arguments[n];console[t](...i)}}function lv(t){return qH.reduce((e,i)=>(e[i]=fCe.bind(console,i,t),e),{})}lv.level=t=>{WH=t};fCe.level=lv.level;const YB=lv("quill:events"),Svt=["selectionchange","mousedown","mouseup","click"];Svt.forEach(t=>{document.addEventListener(t,function(){for(var e=arguments.length,i=new Array(e),n=0;n<e;n++)i[n]=arguments[n];Array.from(document.querySelectorAll(".ql-container")).forEach(r=>{const a=zH.get(r);a&&a.emitter&&a.emitter.handleDOM(...i)})})});class yi extends wvt{constructor(){super(),this.domListeners={},this.on("error",YB.error)}emit(){for(var e=arguments.length,i=new Array(e),n=0;n<e;n++)i[n]=arguments[n];return YB.log.call(YB,...i),super.emit(...i)}handleDOM(e){for(var i=arguments.length,n=new Array(i>1?i-1:0),r=1;r<i;r++)n[r-1]=arguments[r];(this.domListeners[e.type]||[]).forEach(a=>{let{node:s,handler:o}=a;(e.target===s||s.contains(e.target))&&o(e,...n)})}listenDOM(e,i,n){this.domListeners[e]||(this.domListeners[e]=[]),this.domListeners[e].push({node:i,handler:n})}}et(yi,"events",{EDITOR_CHANGE:"editor-change",SCROLL_BEFORE_UPDATE:"scroll-before-update",SCROLL_BLOT_MOUNT:"scroll-blot-mount",SCROLL_BLOT_UNMOUNT:"scroll-blot-unmount",SCROLL_OPTIMIZE:"scroll-optimize",SCROLL_UPDATE:"scroll-update",SCROLL_EMBED_UPDATE:"scroll-embed-update",SELECTION_CHANGE:"selection-change",TEXT_CHANGE:"text-change",COMPOSITION_BEFORE_START:"composition-before-start",COMPOSITION_START:"composition-start",COMPOSITION_BEFORE_END:"composition-before-end",COMPOSITION_END:"composition-end"}),et(yi,"sources",{API:"api",SILENT:"silent",USER:"user"});const KB=lv("quill:selection");class LI{constructor(e){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;this.index=e,this.length=i}}class Tvt{constructor(e,i){this.emitter=i,this.scroll=e,this.composing=!1,this.mouseDown=!1,this.root=this.scroll.domNode,this.cursor=this.scroll.create("cursor",this),this.savedRange=new LI(0,0),this.lastRange=this.savedRange,this.lastNative=null,this.handleComposition(),this.handleDragging(),this.emitter.listenDOM("selectionchange",document,()=>{!this.mouseDown&&!this.composing&&setTimeout(this.update.bind(this,yi.sources.USER),1)}),this.emitter.on(yi.events.SCROLL_BEFORE_UPDATE,()=>{if(!this.hasFocus())return;const n=this.getNativeRange();n!=null&&n.start.node!==this.cursor.textNode&&this.emitter.once(yi.events.SCROLL_UPDATE,(r,a)=>{try{this.root.contains(n.start.node)&&this.root.contains(n.end.node)&&this.setNativeRange(n.start.node,n.start.offset,n.end.node,n.end.offset);const s=a.some(o=>o.type==="characterData"||o.type==="childList"||o.type==="attributes"&&o.target===this.root);this.update(s?yi.sources.SILENT:r)}catch{}})}),this.emitter.on(yi.events.SCROLL_OPTIMIZE,(n,r)=>{if(r.range){const{startNode:a,startOffset:s,endNode:o,endOffset:l}=r.range;this.setNativeRange(a,s,o,l),this.update(yi.sources.SILENT)}}),this.update(yi.sources.SILENT)}handleComposition(){this.emitter.on(yi.events.COMPOSITION_BEFORE_START,()=>{this.composing=!0}),this.emitter.on(yi.events.COMPOSITION_END,()=>{if(this.composing=!1,this.cursor.parent){const e=this.cursor.restore();if(!e)return;setTimeout(()=>{this.setNativeRange(e.startNode,e.startOffset,e.endNode,e.endOffset)},1)}})}handleDragging(){this.emitter.listenDOM("mousedown",document.body,()=>{this.mouseDown=!0}),this.emitter.listenDOM("mouseup",document.body,()=>{this.mouseDown=!1,this.update(yi.sources.USER)})}focus(){this.hasFocus()||(this.root.focus({preventScroll:!0}),this.setRange(this.savedRange))}format(e,i){this.scroll.update();const n=this.getNativeRange();if(!(n==null||!n.native.collapsed||this.scroll.query(e,Ci.BLOCK))){if(n.start.node!==this.cursor.textNode){const r=this.scroll.find(n.start.node,!1);if(r==null)return;if(r instanceof Yl){const a=r.split(n.start.offset);r.parent.insertBefore(this.cursor,a)}else r.insertBefore(this.cursor,n.start.node);this.cursor.attach()}this.cursor.format(e,i),this.scroll.optimize(),this.setNativeRange(this.cursor.textNode,this.cursor.textNode.data.length),this.update()}}getBounds(e){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;const n=this.scroll.length();e=Math.min(e,n-1),i=Math.min(e+i,n-1)-e;let r,[a,s]=this.scroll.leaf(e);if(a==null)return null;if(i>0&&s===a.length()){const[u]=this.scroll.leaf(e+1);if(u){const[d]=this.scroll.line(e),[p]=this.scroll.line(e+1);d===p&&(a=u,s=0)}}[r,s]=a.position(s,!0);const o=document.createRange();if(i>0)return o.setStart(r,s),[a,s]=this.scroll.leaf(e+i),a==null?null:([r,s]=a.position(s,!0),o.setEnd(r,s),o.getBoundingClientRect());let l="left",c;if(r instanceof Text){if(!r.data.length)return null;s<r.data.length?(o.setStart(r,s),o.setEnd(r,s+1)):(o.setStart(r,s-1),o.setEnd(r,s),l="right"),c=o.getBoundingClientRect()}else{if(!(a.domNode instanceof Element))return null;c=a.domNode.getBoundingClientRect(),s>0&&(l="right")}return{bottom:c.top+c.height,height:c.height,left:c[l],right:c[l],top:c.top,width:0}}getNativeRange(){const e=document.getSelection();if(e==null||e.rangeCount<=0)return null;const i=e.getRangeAt(0);if(i==null)return null;const n=this.normalizeNative(i);return KB.info("getNativeRange",n),n}getRange(){const e=this.scroll.domNode;if("isConnected"in e&&!e.isConnected)return[null,null];const i=this.getNativeRange();return i==null?[null,null]:[this.normalizedToRange(i),i]}hasFocus(){return document.activeElement===this.root||document.activeElement!=null&&ZB(this.root,document.activeElement)}normalizedToRange(e){const i=[[e.start.node,e.start.offset]];e.native.collapsed||i.push([e.end.node,e.end.offset]);const n=i.map(s=>{const[o,l]=s,c=this.scroll.find(o,!0),u=c.offset(this.scroll);return l===0?u:c instanceof Yl?u+c.index(o,l):u+c.length()}),r=Math.min(Math.max(...n),this.scroll.length()-1),a=Math.min(r,...n);return new LI(a,r-a)}normalizeNative(e){if(!ZB(this.root,e.startContainer)||!e.collapsed&&!ZB(this.root,e.endContainer))return null;const i={start:{node:e.startContainer,offset:e.startOffset},end:{node:e.endContainer,offset:e.endOffset},native:e};return[i.start,i.end].forEach(n=>{let{node:r,offset:a}=n;for(;!(r instanceof Text)&&r.childNodes.length>0;)if(r.childNodes.length>a)r=r.childNodes[a],a=0;else if(r.childNodes.length===a)r=r.lastChild,r instanceof Text?a=r.data.length:r.childNodes.length>0?a=r.childNodes.length:a=r.childNodes.length+1;else break;n.node=r,n.offset=a}),i}rangeToNative(e){const i=this.scroll.length(),n=(r,a)=>{r=Math.min(i-1,r);const[s,o]=this.scroll.leaf(r);return s?s.position(o,a):[null,-1]};return[...n(e.index,!1),...n(e.index+e.length,!0)]}setNativeRange(e,i){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:e,r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:i,a=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!1;if(KB.info("setNativeRange",e,i,n,r),e!=null&&(this.root.parentNode==null||e.parentNode==null||n.parentNode==null))return;const s=document.getSelection();if(s!=null)if(e!=null){this.hasFocus()||this.root.focus({preventScroll:!0});const{native:o}=this.getNativeRange()||{};if(o==null||a||e!==o.startContainer||i!==o.startOffset||n!==o.endContainer||r!==o.endOffset){e instanceof Element&&e.tagName==="BR"&&(i=Array.from(e.parentNode.childNodes).indexOf(e),e=e.parentNode),n instanceof Element&&n.tagName==="BR"&&(r=Array.from(n.parentNode.childNodes).indexOf(n),n=n.parentNode);const l=document.createRange();l.setStart(e,i),l.setEnd(n,r),s.removeAllRanges(),s.addRange(l)}}else s.removeAllRanges(),this.root.blur()}setRange(e){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:yi.sources.API;if(typeof i=="string"&&(n=i,i=!1),KB.info("setRange",e),e!=null){const r=this.rangeToNative(e);this.setNativeRange(...r,i)}else this.setNativeRange(null);this.update(n)}update(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:yi.sources.USER;const i=this.lastRange,[n,r]=this.getRange();if(this.lastRange=n,this.lastNative=r,this.lastRange!=null&&(this.savedRange=this.lastRange),!iK(i,this.lastRange)){if(!this.composing&&r!=null&&r.native.collapsed&&r.start.node!==this.cursor.textNode){const s=this.cursor.restore();s&&this.setNativeRange(s.startNode,s.startOffset,s.endNode,s.endOffset)}const a=[yi.events.SELECTION_CHANGE,SS(this.lastRange),SS(i),e];this.emitter.emit(yi.events.EDITOR_CHANGE,...a),e!==yi.sources.SILENT&&this.emitter.emit(...a)}}}function ZB(t,e){try{e.parentNode}catch{return!1}return t.contains(e)}const Uvt=/^[ -~]*$/;class Dvt{constructor(e){this.scroll=e,this.delta=this.getDelta()}applyDelta(e){this.scroll.update();let i=this.scroll.length();this.scroll.batchStart();const n=Oie(e),r=new Di;return Pvt(n.ops.slice()).reduce((s,o)=>{const l=hp.Op.length(o);let c=o.attributes||{},u=!1,d=!1;if(o.insert!=null){if(r.retain(l),typeof o.insert=="string"){const f=o.insert;d=!f.endsWith(`
`)&&(i<=s||!!this.scroll.descendant(lp,s)[0]),this.scroll.insertAt(s,f);const[m,g]=this.scroll.line(s);let v=Yv({},sp(m));if(m instanceof Rl){const[y]=m.descendant(Yl,g);y&&(v=Yv(v,sp(y)))}c=hp.AttributeMap.diff(v,c)||{}}else if(typeof o.insert=="object"){const f=Object.keys(o.insert)[0];if(f==null)return s;const m=this.scroll.query(f,Ci.INLINE)!=null;if(m)(i<=s||this.scroll.descendant(lp,s)[0])&&(d=!0);else if(s>0){const[g,v]=this.scroll.descendant(Yl,s-1);g instanceof Kh?g.value()[v]!==`
`&&(u=!0):g instanceof Gd&&g.statics.scope===Ci.INLINE_BLOT&&(u=!0)}if(this.scroll.insertAt(s,f,o.insert[f]),m){const[g]=this.scroll.descendant(Yl,s);if(g){const v=Yv({},sp(g));c=hp.AttributeMap.diff(v,c)||{}}}}i+=l}else if(r.push(o),o.retain!==null&&typeof o.retain=="object"){const f=Object.keys(o.retain)[0];if(f==null)return s;this.scroll.updateEmbedAt(s,f,o.retain[f])}Object.keys(c).forEach(f=>{this.scroll.formatAt(s,l,f,c[f])});const p=u?1:0,h=d?1:0;return i+=p+h,r.retain(p),r.delete(h),s+l+p+h},0),r.reduce((s,o)=>typeof o.delete=="number"?(this.scroll.deleteAt(s,o.delete),s):s+hp.Op.length(o),0),this.scroll.batchEnd(),this.scroll.optimize(),this.update(n)}deleteText(e,i){return this.scroll.deleteAt(e,i),this.update(new Di().retain(e).delete(i))}formatLine(e,i){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};this.scroll.update(),Object.keys(n).forEach(a=>{this.scroll.lines(e,Math.max(i,1)).forEach(s=>{s.format(a,n[a])})}),this.scroll.optimize();const r=new Di().retain(e).retain(i,SS(n));return this.update(r)}formatText(e,i){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.keys(n).forEach(a=>{this.scroll.formatAt(e,i,a,n[a])});const r=new Di().retain(e).retain(i,SS(n));return this.update(r)}getContents(e,i){return this.delta.slice(e,e+i)}getDelta(){return this.scroll.lines().reduce((e,i)=>e.concat(i.delta()),new Di)}getFormat(e){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=[],r=[];i===0?this.scroll.path(e).forEach(o=>{const[l]=o;l instanceof Rl?n.push(l):l instanceof Yl&&r.push(l)}):(n=this.scroll.lines(e,i),r=this.scroll.descendants(Yl,e,i));const[a,s]=[n,r].map(o=>{const l=o.shift();if(l==null)return{};let c=sp(l);for(;Object.keys(c).length>0;){const u=o.shift();if(u==null)return c;c=Evt(sp(u),c)}return c});return{...a,...s}}getHTML(e,i){const[n,r]=this.scroll.line(e);if(n){const a=n.length();return n.length()>=r+i&&!(r===0&&i===a)?TP(n,r,i,!0):TP(this.scroll,e,i,!0)}return""}getText(e,i){return this.getContents(e,i).filter(n=>typeof n.insert=="string").map(n=>n.insert).join("")}insertContents(e,i){const n=Oie(i),r=new Di().retain(e).concat(n);return this.scroll.insertContents(e,n),this.update(r)}insertEmbed(e,i,n){return this.scroll.insertAt(e,i,n),this.update(new Di().retain(e).insert({[i]:n}))}insertText(e,i){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return i=i.replace(/\r\n/g,`
`).replace(/\r/g,`
`),this.scroll.insertAt(e,i),Object.keys(n).forEach(r=>{this.scroll.formatAt(e,i.length,r,n[r])}),this.update(new Di().retain(e).insert(i,SS(n)))}isBlank(){if(this.scroll.children.length===0)return!0;if(this.scroll.children.length>1)return!1;const e=this.scroll.children.head;if((e==null?void 0:e.statics.blotName)!==Rl.blotName)return!1;const i=e;return i.children.length>1?!1:i.children.head instanceof of}removeFormat(e,i){const n=this.getText(e,i),[r,a]=this.scroll.line(e+i);let s=0,o=new Di;r!=null&&(s=r.length()-a,o=r.delta().slice(a,a+s-1).insert(`
`));const c=this.getContents(e,i+s).diff(new Di().insert(n).concat(o)),u=new Di().retain(e).concat(c);return this.applyDelta(u)}update(e){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:void 0;const r=this.delta;if(i.length===1&&i[0].type==="characterData"&&i[0].target.data.match(Uvt)&&this.scroll.find(i[0].target)){const a=this.scroll.find(i[0].target),s=sp(a),o=a.offset(this.scroll),l=i[0].oldValue.replace(FT.CONTENTS,""),c=new Di().insert(l),u=new Di().insert(a.value()),d=n&&{oldRange:Lie(n.oldRange,-o),newRange:Lie(n.newRange,-o)};e=new Di().retain(o).concat(c.diff(u,d)).reduce((h,f)=>f.insert?h.insert(f.insert,s):h.push(f),new Di),this.delta=r.compose(e)}else this.delta=this.getDelta(),(!e||!iK(r.compose(e),this.delta))&&(e=r.diff(this.delta,n));return e}}function K0(t,e,i){if(t.length===0){const[h]=XB(i.pop());return e<=0?`</li></${h}>`:`</li></${h}>${K0([],e-1,i)}`}const[{child:n,offset:r,length:a,indent:s,type:o},...l]=t,[c,u]=XB(o);if(s>e)return i.push(o),s===e+1?`<${c}><li${u}>${TP(n,r,a)}${K0(l,s,i)}`:`<${c}><li>${K0(t,e+1,i)}`;const d=i[i.length-1];if(s===e&&o===d)return`</li><li${u}>${TP(n,r,a)}${K0(l,s,i)}`;const[p]=XB(i.pop());return`</li></${p}>${K0(t,e-1,i)}`}function TP(t,e,i){let n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;if("html"in t&&typeof t.html=="function")return t.html(e,i);if(t instanceof Kh)return Q2(t.value().slice(e,e+i));if(t instanceof Ah){if(t.statics.blotName==="list-container"){const c=[];return t.children.forEachAt(e,i,(u,d,p)=>{const h="formats"in u&&typeof u.formats=="function"?u.formats():{};c.push({child:u,offset:d,length:p,indent:h.indent||0,type:h.list})}),K0(c,-1,[])}const r=[];if(t.children.forEachAt(e,i,(c,u,d)=>{r.push(TP(c,u,d))}),n||t.statics.blotName==="list")return r.join("");const{outerHTML:a,innerHTML:s}=t.domNode,[o,l]=a.split(`>${s}<`);return o==="<table"?`<table style="border: 1px solid #000;">${r.join("")}<${l}`:`${o}>${r.join("")}<${l}`}return t.domNode instanceof Element?t.domNode.outerHTML:""}function Evt(t,e){return Object.keys(e).reduce((i,n)=>{if(t[n]==null)return i;const r=e[n];return r===t[n]?i[n]=r:Array.isArray(r)?r.indexOf(t[n])<0?i[n]=r.concat([t[n]]):i[n]=r:i[n]=[r,t[n]],i},{})}function XB(t){const e=t==="ordered"?"ol":"ul";switch(t){case"checked":return[e,' data-list="checked"'];case"unchecked":return[e,' data-list="unchecked"'];default:return[e,""]}}function Oie(t){return t.reduce((e,i)=>{if(typeof i.insert=="string"){const n=i.insert.replace(/\r\n/g,`
`).replace(/\r/g,`
`);return e.insert(n,i.attributes)}return e.push(i)},new Di)}function Lie(t,e){let{index:i,length:n}=t;return new LI(i+e,n)}function Pvt(t){const e=[];return t.forEach(i=>{typeof i.insert=="string"?i.insert.split(`
`).forEach((r,a)=>{a&&e.push({insert:`
`,attributes:i.attributes}),r&&e.push({insert:r,attributes:i.attributes})}):e.push(i)}),e}class lf{constructor(e){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.quill=e,this.options=i}}et(lf,"DEFAULTS",{});const SN="\uFEFF";class cK extends Gd{constructor(e,i){super(e,i),this.contentNode=document.createElement("span"),this.contentNode.setAttribute("contenteditable","false"),Array.from(this.domNode.childNodes).forEach(n=>{this.contentNode.appendChild(n)}),this.leftGuard=document.createTextNode(SN),this.rightGuard=document.createTextNode(SN),this.domNode.appendChild(this.leftGuard),this.domNode.appendChild(this.contentNode),this.domNode.appendChild(this.rightGuard)}index(e,i){return e===this.leftGuard?0:e===this.rightGuard?1:super.index(e,i)}restore(e){let i=null,n;const r=e.data.split(SN).join("");if(e===this.leftGuard)if(this.prev instanceof Kh){const a=this.prev.length();this.prev.insertAt(a,r),i={startNode:this.prev.domNode,startOffset:a+r.length}}else n=document.createTextNode(r),this.parent.insertBefore(this.scroll.create(n),this),i={startNode:n,startOffset:r.length};else e===this.rightGuard&&(this.next instanceof Kh?(this.next.insertAt(0,r),i={startNode:this.next.domNode,startOffset:r.length}):(n=document.createTextNode(r),this.parent.insertBefore(this.scroll.create(n),this.next),i={startNode:n,startOffset:r.length}));return e.data=SN,i}update(e,i){e.forEach(n=>{if(n.type==="characterData"&&(n.target===this.leftGuard||n.target===this.rightGuard)){const r=this.restore(n.target);r&&(i.range=r)}})}}class Cvt{constructor(e,i){et(this,"isComposing",!1);this.scroll=e,this.emitter=i,this.setupListeners()}setupListeners(){this.scroll.domNode.addEventListener("compositionstart",e=>{this.isComposing||this.handleCompositionStart(e)}),this.scroll.domNode.addEventListener("compositionend",e=>{this.isComposing&&queueMicrotask(()=>{this.handleCompositionEnd(e)})})}handleCompositionStart(e){const i=e.target instanceof Node?this.scroll.find(e.target,!0):null;i&&!(i instanceof cK)&&(this.emitter.emit(yi.events.COMPOSITION_BEFORE_START,e),this.scroll.batchStart(),this.emitter.emit(yi.events.COMPOSITION_START,e),this.isComposing=!0)}handleCompositionEnd(e){this.emitter.emit(yi.events.COMPOSITION_BEFORE_END,e),this.scroll.batchEnd(),this.emitter.emit(yi.events.COMPOSITION_END,e),this.isComposing=!1}}const HD=class HD{constructor(e,i){et(this,"modules",{});this.quill=e,this.options=i}init(){Object.keys(this.options.modules).forEach(e=>{this.modules[e]==null&&this.addModule(e)})}addModule(e){const i=this.quill.constructor.import(`modules/${e}`);return this.modules[e]=new i(this.quill,this.options.modules[e]||{}),this.modules[e]}};et(HD,"DEFAULTS",{modules:{}}),et(HD,"themes",{default:HD});let $T=HD;const Rvt=t=>t.parentElement||t.getRootNode().host||null,Mvt=t=>{const e=t.getBoundingClientRect(),i="offsetWidth"in t&&Math.abs(e.width)/t.offsetWidth||1,n="offsetHeight"in t&&Math.abs(e.height)/t.offsetHeight||1;return{top:e.top,right:e.left+t.clientWidth*i,bottom:e.top+t.clientHeight*n,left:e.left}},TN=t=>{const e=parseInt(t,10);return Number.isNaN(e)?0:e},Fie=(t,e,i,n,r,a)=>t<i&&e>n?0:t<i?-(i-t+r):e>n?e-t>n-i?t+r-i:e-n+a:0,Nvt=(t,e)=>{var a,s,o;const i=t.ownerDocument;let n=e,r=t;for(;r;){const l=r===i.body,c=l?{top:0,right:((a=window.visualViewport)==null?void 0:a.width)??i.documentElement.clientWidth,bottom:((s=window.visualViewport)==null?void 0:s.height)??i.documentElement.clientHeight,left:0}:Mvt(r),u=getComputedStyle(r),d=Fie(n.left,n.right,c.left,c.right,TN(u.scrollPaddingLeft),TN(u.scrollPaddingRight)),p=Fie(n.top,n.bottom,c.top,c.bottom,TN(u.scrollPaddingTop),TN(u.scrollPaddingBottom));if(d||p)if(l)(o=i.defaultView)==null||o.scrollBy(d,p);else{const{scrollLeft:h,scrollTop:f}=r;p&&(r.scrollTop+=p),d&&(r.scrollLeft+=d);const m=r.scrollLeft-h,g=r.scrollTop-f;n={left:n.left-m,top:n.top-g,right:n.right-m,bottom:n.bottom-g}}r=l||u.position==="fixed"?null:Rvt(r)}},Avt=100,_vt=["block","break","cursor","inline","scroll","text"],kvt=(t,e,i)=>{const n=new LT;return _vt.forEach(r=>{const a=e.query(r);a&&n.register(a)}),t.forEach(r=>{let a=e.query(r);a||i.error(`Cannot register "${r}" specified in "formats" config. Are you sure it was registered?`);let s=0;for(;a;)if(n.register(a),a="blotName"in a?a.requiredContainer??null:null,s+=1,s>Avt){i.error(`Cycle detected in registering blot requiredContainer: "${r}"`);break}}),n},US=lv("quill"),UN=new LT;Ah.uiClass="ql-ui";const oh=class oh{static debug(e){e===!0&&(e="log"),lv.level(e)}static find(e){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;return zH.get(e)||UN.find(e,i)}static import(e){return this.imports[e]==null&&US.error(`Cannot import ${e}. Are you sure it was registered?`),this.imports[e]}static register(){if(typeof(arguments.length<=0?void 0:arguments[0])!="string"){const e=arguments.length<=0?void 0:arguments[0],i=!!(!(arguments.length<=1)&&arguments[1]),n="attrName"in e?e.attrName:e.blotName;typeof n=="string"?this.register(`formats/${n}`,e,i):Object.keys(e).forEach(r=>{this.register(r,e[r],i)})}else{const e=arguments.length<=0?void 0:arguments[0],i=arguments.length<=1?void 0:arguments[1],n=!!(!(arguments.length<=2)&&arguments[2]);this.imports[e]!=null&&!n&&US.warn(`Overwriting ${e} with`,i),this.imports[e]=i,(e.startsWith("blots/")||e.startsWith("formats/"))&&i&&typeof i!="boolean"&&i.blotName!=="abstract"&&UN.register(i),typeof i.register=="function"&&i.register(UN)}}constructor(e){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(this.options=xvt(e,i),this.container=this.options.container,this.container==null){US.error("Invalid Quill container",e);return}this.options.debug&&oh.debug(this.options.debug);const n=this.container.innerHTML.trim();this.container.classList.add("ql-container"),this.container.innerHTML="",zH.set(this.container,this),this.root=this.addContainer("ql-editor"),this.root.classList.add("ql-blank"),this.emitter=new yi;const r=rK.blotName,a=this.options.registry.query(r);if(!a||!("blotName"in a))throw new Error(`Cannot initialize Quill without "${r}" blot`);if(this.scroll=new a(this.options.registry,this.root,{emitter:this.emitter}),this.editor=new Dvt(this.scroll),this.selection=new Tvt(this.scroll,this.emitter),this.composition=new Cvt(this.scroll,this.emitter),this.theme=new this.options.theme(this,this.options),this.keyboard=this.theme.addModule("keyboard"),this.clipboard=this.theme.addModule("clipboard"),this.history=this.theme.addModule("history"),this.uploader=this.theme.addModule("uploader"),this.theme.addModule("input"),this.theme.addModule("uiNode"),this.theme.init(),this.emitter.on(yi.events.EDITOR_CHANGE,s=>{s===yi.events.TEXT_CHANGE&&this.root.classList.toggle("ql-blank",this.editor.isBlank())}),this.emitter.on(yi.events.SCROLL_UPDATE,(s,o)=>{const l=this.selection.lastRange,[c]=this.selection.getRange(),u=l&&c?{oldRange:l,newRange:c}:void 0;ah.call(this,()=>this.editor.update(null,o,u),s)}),this.emitter.on(yi.events.SCROLL_EMBED_UPDATE,(s,o)=>{const l=this.selection.lastRange,[c]=this.selection.getRange(),u=l&&c?{oldRange:l,newRange:c}:void 0;ah.call(this,()=>{const d=new Di().retain(s.offset(this)).retain({[s.statics.blotName]:o});return this.editor.update(d,[],u)},oh.sources.USER)}),n){const s=this.clipboard.convert({html:`${n}<p><br></p>`,text:`
`});this.setContents(s)}this.history.clear(),this.options.placeholder&&this.root.setAttribute("data-placeholder",this.options.placeholder),this.options.readOnly&&this.disable(),this.allowReadOnlyEdits=!1}addContainer(e){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;if(typeof e=="string"){const n=e;e=document.createElement("div"),e.classList.add(n)}return this.container.insertBefore(e,i),e}blur(){this.selection.setRange(null)}deleteText(e,i,n){return[e,i,,n]=Hm(e,i,n),ah.call(this,()=>this.editor.deleteText(e,i),n,e,-1*i)}disable(){this.enable(!1)}editReadOnly(e){this.allowReadOnlyEdits=!0;const i=e();return this.allowReadOnlyEdits=!1,i}enable(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;this.scroll.enable(e),this.container.classList.toggle("ql-disabled",!e)}focus(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.selection.focus(),e.preventScroll||this.scrollSelectionIntoView()}format(e,i){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:yi.sources.API;return ah.call(this,()=>{const r=this.getSelection(!0);let a=new Di;if(r==null)return a;if(this.scroll.query(e,Ci.BLOCK))a=this.editor.formatLine(r.index,r.length,{[e]:i});else{if(r.length===0)return this.selection.format(e,i),a;a=this.editor.formatText(r.index,r.length,{[e]:i})}return this.setSelection(r,yi.sources.SILENT),a},n)}formatLine(e,i,n,r,a){let s;return[e,i,s,a]=Hm(e,i,n,r,a),ah.call(this,()=>this.editor.formatLine(e,i,s),a,e,0)}formatText(e,i,n,r,a){let s;return[e,i,s,a]=Hm(e,i,n,r,a),ah.call(this,()=>this.editor.formatText(e,i,s),a,e,0)}getBounds(e){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=null;if(typeof e=="number"?n=this.selection.getBounds(e,i):n=this.selection.getBounds(e.index,e.length),!n)return null;const r=this.container.getBoundingClientRect();return{bottom:n.bottom-r.top,height:n.height,left:n.left-r.left,right:n.right-r.left,top:n.top-r.top,width:n.width}}getContents(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.getLength()-e;return[e,i]=Hm(e,i),this.editor.getContents(e,i)}getFormat(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.getSelection(!0),i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return typeof e=="number"?this.editor.getFormat(e,i):this.editor.getFormat(e.index,e.length)}getIndex(e){return e.offset(this.scroll)}getLength(){return this.scroll.length()}getLeaf(e){return this.scroll.leaf(e)}getLine(e){return this.scroll.line(e)}getLines(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Number.MAX_VALUE;return typeof e!="number"?this.scroll.lines(e.index,e.length):this.scroll.lines(e,i)}getModule(e){return this.theme.modules[e]}getSelection(){return(arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1)&&this.focus(),this.update(),this.selection.getRange()[0]}getSemanticHTML(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,i=arguments.length>1?arguments[1]:void 0;return typeof e=="number"&&(i=i??this.getLength()-e),[e,i]=Hm(e,i),this.editor.getHTML(e,i)}getText(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,i=arguments.length>1?arguments[1]:void 0;return typeof e=="number"&&(i=i??this.getLength()-e),[e,i]=Hm(e,i),this.editor.getText(e,i)}hasFocus(){return this.selection.hasFocus()}insertEmbed(e,i,n){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:oh.sources.API;return ah.call(this,()=>this.editor.insertEmbed(e,i,n),r,e)}insertText(e,i,n,r,a){let s;return[e,,s,a]=Hm(e,0,n,r,a),ah.call(this,()=>this.editor.insertText(e,i,s),a,e,i.length)}isEnabled(){return this.scroll.isEnabled()}off(){return this.emitter.off(...arguments)}on(){return this.emitter.on(...arguments)}once(){return this.emitter.once(...arguments)}removeFormat(e,i,n){return[e,i,,n]=Hm(e,i,n),ah.call(this,()=>this.editor.removeFormat(e,i),n,e)}scrollRectIntoView(e){Nvt(this.root,e)}scrollIntoView(){console.warn("Quill#scrollIntoView() has been deprecated and will be removed in the near future. Please use Quill#scrollSelectionIntoView() instead."),this.scrollSelectionIntoView()}scrollSelectionIntoView(){const e=this.selection.lastRange,i=e&&this.selection.getBounds(e.index,e.length);i&&this.scrollRectIntoView(i)}setContents(e){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:yi.sources.API;return ah.call(this,()=>{e=new Di(e);const n=this.getLength(),r=this.editor.deleteText(0,n),a=this.editor.insertContents(0,e),s=this.editor.deleteText(this.getLength()-1,1);return r.compose(a).compose(s)},i)}setSelection(e,i,n){e==null?this.selection.setRange(null,i||oh.sources.API):([e,i,,n]=Hm(e,i,n),this.selection.setRange(new LI(Math.max(0,e),i),n),n!==yi.sources.SILENT&&this.scrollSelectionIntoView())}setText(e){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:yi.sources.API;const n=new Di().insert(e);return this.setContents(n,i)}update(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:yi.sources.USER;const i=this.scroll.update(e);return this.selection.update(e),i}updateContents(e){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:yi.sources.API;return ah.call(this,()=>(e=new Di(e),this.editor.applyDelta(e)),i,!0)}};et(oh,"DEFAULTS",{bounds:null,modules:{clipboard:!0,keyboard:!0,history:!0,uploader:!0},placeholder:"",readOnly:!1,registry:UN,theme:"default"}),et(oh,"events",yi.events),et(oh,"sources",yi.sources),et(oh,"version","2.0.2"),et(oh,"imports",{delta:Di,parchment:svt,"core/module":lf,"core/theme":$T});let wt=oh;function $ie(t){return typeof t=="string"?document.querySelector(t):t}function JB(t){return Object.entries(t??{}).reduce((e,i)=>{let[n,r]=i;return{...e,[n]:r===!0?{}:r}},{})}function Bie(t){return Object.fromEntries(Object.entries(t).filter(e=>e[1]!==void 0))}function xvt(t,e){const i=$ie(t);if(!i)throw new Error("Invalid Quill container");const r=!e.theme||e.theme===wt.DEFAULTS.theme?$T:wt.import(`themes/${e.theme}`);if(!r)throw new Error(`Invalid theme ${e.theme}. Did you register it?`);const{modules:a,...s}=wt.DEFAULTS,{modules:o,...l}=r.DEFAULTS;let c=JB(e.modules);c!=null&&c.toolbar&&c.toolbar.constructor!==Object&&(c={...c,toolbar:{container:c.toolbar}});const u=Yv({},JB(a),JB(o),c),d={...s,...Bie(l),...Bie(e)};let p=e.registry;return p?e.formats&&US.warn('Ignoring "formats" option because "registry" is specified'):p=e.formats?kvt(e.formats,d.registry,US):d.registry,{...d,registry:p,container:i,theme:r,modules:Object.entries(u).reduce((h,f)=>{let[m,g]=f;if(!g)return h;const v=wt.import(`modules/${m}`);return v==null?(US.error(`Cannot load ${m} module. Are you sure you registered it?`),h):{...h,[m]:Yv({},v.DEFAULTS||{},g)}},{}),bounds:$ie(d.bounds)}}function ah(t,e,i,n){if(!this.isEnabled()&&e===yi.sources.USER&&!this.allowReadOnlyEdits)return new Di;let r=i==null?null:this.getSelection();const a=this.editor.delta,s=t();if(r!=null&&(i===!0&&(i=r.index),n==null?r=Vie(r,s,e):n!==0&&(r=Vie(r,i,n,e)),this.setSelection(r,yi.sources.SILENT)),s.length()>0){const o=[yi.events.TEXT_CHANGE,s,a,e];this.emitter.emit(yi.events.EDITOR_CHANGE,...o),e!==yi.sources.SILENT&&this.emitter.emit(...o)}return s}function Hm(t,e,i,n,r){let a={};return typeof t.index=="number"&&typeof t.length=="number"?typeof e!="number"?(r=n,n=i,i=e,e=t.length,t=t.index):(e=t.length,t=t.index):typeof e!="number"&&(r=n,n=i,i=e,e=0),typeof i=="object"?(a=i,r=n):typeof i=="string"&&(n!=null?a[i]=n:r=i),r=r||yi.sources.API,[t,e,a,r]}function Vie(t,e,i,n){const r=typeof i=="number"?i:0;if(t==null)return null;let a,s;return e&&typeof e.transformPosition=="function"?[a,s]=[t.index,t.index+t.length].map(o=>e.transformPosition(o,n!==yi.sources.USER)):[a,s]=[t.index,t.index+t.length].map(o=>o<e||o===e&&n===yi.sources.USER?o:r>=0?o+r:Math.max(e,o+r)),new LI(a,s-a)}class Xw extends K2{}function jie(t){return t instanceof Rl||t instanceof lp}function Gie(t){return typeof t.updateContent=="function"}class Z0 extends rK{constructor(e,i,n){let{emitter:r}=n;super(e,i),this.emitter=r,this.batch=!1,this.optimize(),this.enable(),this.domNode.addEventListener("dragstart",a=>this.handleDragStart(a))}batchStart(){Array.isArray(this.batch)||(this.batch=[])}batchEnd(){if(!this.batch)return;const e=this.batch;this.batch=!1,this.update(e)}emitMount(e){this.emitter.emit(yi.events.SCROLL_BLOT_MOUNT,e)}emitUnmount(e){this.emitter.emit(yi.events.SCROLL_BLOT_UNMOUNT,e)}emitEmbedUpdate(e,i){this.emitter.emit(yi.events.SCROLL_EMBED_UPDATE,e,i)}deleteAt(e,i){const[n,r]=this.line(e),[a]=this.line(e+i);if(super.deleteAt(e,i),a!=null&&n!==a&&r>0){if(n instanceof lp||a instanceof lp){this.optimize();return}const s=a.children.head instanceof of?null:a.children.head;n.moveChildren(a,s),n.remove()}this.optimize()}enable(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;this.domNode.setAttribute("contenteditable",e?"true":"false")}formatAt(e,i,n,r){super.formatAt(e,i,n,r),this.optimize()}insertAt(e,i,n){if(e>=this.length())if(n==null||this.scroll.query(i,Ci.BLOCK)==null){const r=this.scroll.create(this.statics.defaultChild.blotName);this.appendChild(r),n==null&&i.endsWith(`
`)?r.insertAt(0,i.slice(0,-1),n):r.insertAt(0,i,n)}else{const r=this.scroll.create(i,n);this.appendChild(r)}else super.insertAt(e,i,n);this.optimize()}insertBefore(e,i){if(e.statics.scope===Ci.INLINE_BLOT){const n=this.scroll.create(this.statics.defaultChild.blotName);n.appendChild(e),super.insertBefore(n,i)}else super.insertBefore(e,i)}insertContents(e,i){const n=this.deltaToRenderBlocks(i.concat(new Di().insert(`
`))),r=n.pop();if(r==null)return;this.batchStart();const a=n.shift();if(a){const l=a.type==="block"&&(a.delta.length()===0||!this.descendant(lp,e)[0]&&e<this.length()),c=a.type==="block"?a.delta:new Di().insert({[a.key]:a.value});QB(this,e,c);const u=a.type==="block"?1:0,d=e+c.length()+u;l&&this.insertAt(d-1,`
`);const p=sp(this.line(e)[0]),h=hp.AttributeMap.diff(p,a.attributes)||{};Object.keys(h).forEach(f=>{this.formatAt(d-1,1,f,h[f])}),e=d}let[s,o]=this.children.find(e);if(n.length&&(s&&(s=s.split(o),o=0),n.forEach(l=>{if(l.type==="block"){const c=this.createBlock(l.attributes,s||void 0);QB(c,0,l.delta)}else{const c=this.create(l.key,l.value);this.insertBefore(c,s||void 0),Object.keys(l.attributes).forEach(u=>{c.format(u,l.attributes[u])})}})),r.type==="block"&&r.delta.length()){const l=s?s.offset(s.scroll)+o:this.length();QB(this,l,r.delta)}this.batchEnd(),this.optimize()}isEnabled(){return this.domNode.getAttribute("contenteditable")==="true"}leaf(e){const i=this.path(e).pop();if(!i)return[null,-1];const[n,r]=i;return n instanceof Yl?[n,r]:[null,-1]}line(e){return e===this.length()?this.line(e-1):this.descendant(jie,e)}lines(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Number.MAX_VALUE;const n=(r,a,s)=>{let o=[],l=s;return r.children.forEachAt(a,s,(c,u,d)=>{jie(c)?o.push(c):c instanceof K2&&(o=o.concat(n(c,u,l))),l-=d}),o};return n(this,e,i)}optimize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.batch||(super.optimize(e,i),e.length>0&&this.emitter.emit(yi.events.SCROLL_OPTIMIZE,e,i))}path(e){return super.path(e).slice(1)}remove(){}update(e){if(this.batch){Array.isArray(e)&&(this.batch=this.batch.concat(e));return}let i=yi.sources.USER;typeof e=="string"&&(i=e),Array.isArray(e)||(e=this.observer.takeRecords()),e=e.filter(n=>{let{target:r}=n;const a=this.find(r,!0);return a&&!Gie(a)}),e.length>0&&this.emitter.emit(yi.events.SCROLL_BEFORE_UPDATE,i,e),super.update(e.concat([])),e.length>0&&this.emitter.emit(yi.events.SCROLL_UPDATE,i,e)}updateEmbedAt(e,i,n){const[r]=this.descendant(a=>a instanceof lp,e);r&&r.statics.blotName===i&&Gie(r)&&r.updateContent(n)}handleDragStart(e){e.preventDefault()}deltaToRenderBlocks(e){const i=[];let n=new Di;return e.forEach(r=>{const a=r==null?void 0:r.insert;if(a)if(typeof a=="string"){const s=a.split(`
`);s.slice(0,-1).forEach(l=>{n.insert(l,r.attributes),i.push({type:"block",delta:n,attributes:r.attributes??{}}),n=new Di});const o=s[s.length-1];o&&n.insert(o,r.attributes)}else{const s=Object.keys(a)[0];if(!s)return;this.query(s,Ci.INLINE)?n.push(r):(n.length()&&i.push({type:"block",delta:n,attributes:{}}),n=new Di,i.push({type:"blockEmbed",key:s,value:a[s],attributes:r.attributes??{}}))}}),n.length()&&i.push({type:"block",delta:n,attributes:{}}),i}createBlock(e,i){let n;const r={};Object.entries(e).forEach(o=>{let[l,c]=o;this.query(l,Ci.BLOCK&Ci.BLOT)!=null?n=l:r[l]=c});const a=this.create(n||this.statics.defaultChild.blotName,n?e[n]:void 0);this.insertBefore(a,i||void 0);const s=a.length();return Object.entries(r).forEach(o=>{let[l,c]=o;a.formatAt(0,s,l,c)}),a}}et(Z0,"blotName","scroll"),et(Z0,"className","ql-editor"),et(Z0,"tagName","DIV"),et(Z0,"defaultChild",Rl),et(Z0,"allowedChildren",[Rl,lp,Xw]);function QB(t,e,i){i.reduce((n,r)=>{const a=hp.Op.length(r);let s=r.attributes||{};if(r.insert!=null){if(typeof r.insert=="string"){const o=r.insert;t.insertAt(n,o);const[l]=t.descendant(Yl,n),c=sp(l);s=hp.AttributeMap.diff(c,s)||{}}else if(typeof r.insert=="object"){const o=Object.keys(r.insert)[0];if(o==null)return n;if(t.insertAt(n,o,r.insert[o]),t.scroll.query(o,Ci.INLINE)!=null){const[c]=t.descendant(Yl,n),u=sp(c);s=hp.AttributeMap.diff(u,s)||{}}}}return Object.keys(s).forEach(o=>{t.formatAt(n,a,o,s[o])}),n+a},e)}const uK={scope:Ci.BLOCK,whitelist:["right","center","justify"]},Ovt=new hm("align","align",uK),mCe=new sf("align","ql-align",uK),gCe=new ub("align","text-align",uK);class vCe extends ub{value(e){let i=super.value(e);return i.startsWith("rgb(")?(i=i.replace(/^[^\d]+/,"").replace(/[^\d]+$/,""),`#${i.split(",").map(r=>`00${parseInt(r,10).toString(16)}`.slice(-2)).join("")}`):i}}const Lvt=new sf("color","ql-color",{scope:Ci.INLINE}),dK=new vCe("color","color",{scope:Ci.INLINE}),Fvt=new sf("background","ql-bg",{scope:Ci.INLINE}),pK=new vCe("background","background-color",{scope:Ci.INLINE});class Jw extends Xw{static create(e){const i=super.create(e);return i.setAttribute("spellcheck","false"),i}code(e,i){return this.children.map(n=>n.length()<=1?"":n.domNode.innerText).join(`
`).slice(e,e+i)}html(e,i){return`<pre>
${Q2(this.code(e,i))}
</pre>`}}class Ql extends Rl{static register(){wt.register(Jw)}}et(Ql,"TAB","  ");class hK extends fm{}hK.blotName="code";hK.tagName="CODE";Ql.blotName="code-block";Ql.className="ql-code-block";Ql.tagName="DIV";Jw.blotName="code-block-container";Jw.className="ql-code-block-container";Jw.tagName="DIV";Jw.allowedChildren=[Ql];Ql.allowedChildren=[Kh,of,FT];Ql.requiredContainer=Jw;const fK={scope:Ci.BLOCK,whitelist:["rtl"]},yCe=new hm("direction","dir",fK),bCe=new sf("direction","ql-direction",fK),ICe=new ub("direction","direction",fK),wCe={scope:Ci.INLINE,whitelist:["serif","monospace"]},SCe=new sf("font","ql-font",wCe);class $vt extends ub{value(e){return super.value(e).replace(/["']/g,"")}}const TCe=new $vt("font","font-family",wCe),UCe=new sf("size","ql-size",{scope:Ci.INLINE,whitelist:["small","large","huge"]}),DCe=new ub("size","font-size",{scope:Ci.INLINE,whitelist:["10px","18px","32px"]}),Bvt=lv("quill:keyboard"),Vvt=/Mac/i.test(navigator.platform)?"metaKey":"ctrlKey";class e$ extends lf{static match(e,i){return["altKey","ctrlKey","metaKey","shiftKey"].some(n=>!!i[n]!==e[n]&&i[n]!==null)?!1:i.key===e.key||i.key===e.which}constructor(e,i){super(e,i),this.bindings={},Object.keys(this.options.bindings).forEach(n=>{this.options.bindings[n]&&this.addBinding(this.options.bindings[n])}),this.addBinding({key:"Enter",shiftKey:null},this.handleEnter),this.addBinding({key:"Enter",metaKey:null,ctrlKey:null,altKey:null},()=>{}),/Firefox/i.test(navigator.userAgent)?(this.addBinding({key:"Backspace"},{collapsed:!0},this.handleBackspace),this.addBinding({key:"Delete"},{collapsed:!0},this.handleDelete)):(this.addBinding({key:"Backspace"},{collapsed:!0,prefix:/^.?$/},this.handleBackspace),this.addBinding({key:"Delete"},{collapsed:!0,suffix:/^.?$/},this.handleDelete)),this.addBinding({key:"Backspace"},{collapsed:!1},this.handleDeleteRange),this.addBinding({key:"Delete"},{collapsed:!1},this.handleDeleteRange),this.addBinding({key:"Backspace",altKey:null,ctrlKey:null,metaKey:null,shiftKey:null},{collapsed:!0,offset:0},this.handleBackspace),this.listen()}addBinding(e){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const r=Gvt(e);if(r==null){Bvt.warn("Attempted to add invalid keyboard binding",r);return}typeof i=="function"&&(i={handler:i}),typeof n=="function"&&(n={handler:n}),(Array.isArray(r.key)?r.key:[r.key]).forEach(s=>{const o={...r,key:s,...i,...n};this.bindings[o.key]=this.bindings[o.key]||[],this.bindings[o.key].push(o)})}listen(){this.quill.root.addEventListener("keydown",e=>{if(e.defaultPrevented||e.isComposing||e.keyCode===229&&(e.key==="Enter"||e.key==="Backspace"))return;const r=(this.bindings[e.key]||[]).concat(this.bindings[e.which]||[]).filter(v=>e$.match(e,v));if(r.length===0)return;const a=wt.find(e.target,!0);if(a&&a.scroll!==this.quill.scroll)return;const s=this.quill.getSelection();if(s==null||!this.quill.hasFocus())return;const[o,l]=this.quill.getLine(s.index),[c,u]=this.quill.getLeaf(s.index),[d,p]=s.length===0?[c,u]:this.quill.getLeaf(s.index+s.length),h=c instanceof Lk?c.value().slice(0,u):"",f=d instanceof Lk?d.value().slice(p):"",m={collapsed:s.length===0,empty:s.length===0&&o.length()<=1,format:this.quill.getFormat(s),line:o,offset:l,prefix:h,suffix:f,event:e};r.some(v=>{if(v.collapsed!=null&&v.collapsed!==m.collapsed||v.empty!=null&&v.empty!==m.empty||v.offset!=null&&v.offset!==m.offset)return!1;if(Array.isArray(v.format)){if(v.format.every(y=>m.format[y]==null))return!1}else if(typeof v.format=="object"&&!Object.keys(v.format).every(y=>v.format[y]===!0?m.format[y]!=null:v.format[y]===!1?m.format[y]==null:iK(v.format[y],m.format[y])))return!1;return v.prefix!=null&&!v.prefix.test(m.prefix)||v.suffix!=null&&!v.suffix.test(m.suffix)?!1:v.handler.call(this,s,m,v)!==!0})&&e.preventDefault()})}handleBackspace(e,i){const n=/[\uD800-\uDBFF][\uDC00-\uDFFF]$/.test(i.prefix)?2:1;if(e.index===0||this.quill.getLength()<=1)return;let r={};const[a]=this.quill.getLine(e.index);let s=new Di().retain(e.index-n).delete(n);if(i.offset===0){const[o]=this.quill.getLine(e.index-1);if(o&&!(o.statics.blotName==="block"&&o.length()<=1)){const c=a.formats(),u=this.quill.getFormat(e.index-1,1);if(r=hp.AttributeMap.diff(c,u)||{},Object.keys(r).length>0){const d=new Di().retain(e.index+a.length()-2).retain(1,r);s=s.compose(d)}}}this.quill.updateContents(s,wt.sources.USER),this.quill.focus()}handleDelete(e,i){const n=/^[\uD800-\uDBFF][\uDC00-\uDFFF]/.test(i.suffix)?2:1;if(e.index>=this.quill.getLength()-n)return;let r={};const[a]=this.quill.getLine(e.index);let s=new Di().retain(e.index).delete(n);if(i.offset>=a.length()-1){const[o]=this.quill.getLine(e.index+1);if(o){const l=a.formats(),c=this.quill.getFormat(e.index,1);r=hp.AttributeMap.diff(l,c)||{},Object.keys(r).length>0&&(s=s.retain(o.length()-1).retain(1,r))}}this.quill.updateContents(s,wt.sources.USER),this.quill.focus()}handleDeleteRange(e){mK({range:e,quill:this.quill}),this.quill.focus()}handleEnter(e,i){const n=Object.keys(i.format).reduce((a,s)=>(this.quill.scroll.query(s,Ci.BLOCK)&&!Array.isArray(i.format[s])&&(a[s]=i.format[s]),a),{}),r=new Di().retain(e.index).delete(e.length).insert(`
`,n);this.quill.updateContents(r,wt.sources.USER),this.quill.setSelection(e.index+1,wt.sources.SILENT),this.quill.focus()}}const jvt={bindings:{bold:eV("bold"),italic:eV("italic"),underline:eV("underline"),indent:{key:"Tab",format:["blockquote","indent","list"],handler(t,e){return e.collapsed&&e.offset!==0?!0:(this.quill.format("indent","+1",wt.sources.USER),!1)}},outdent:{key:"Tab",shiftKey:!0,format:["blockquote","indent","list"],handler(t,e){return e.collapsed&&e.offset!==0?!0:(this.quill.format("indent","-1",wt.sources.USER),!1)}},"outdent backspace":{key:"Backspace",collapsed:!0,shiftKey:null,metaKey:null,ctrlKey:null,altKey:null,format:["indent","list"],offset:0,handler(t,e){e.format.indent!=null?this.quill.format("indent","-1",wt.sources.USER):e.format.list!=null&&this.quill.format("list",!1,wt.sources.USER)}},"indent code-block":Hie(!0),"outdent code-block":Hie(!1),"remove tab":{key:"Tab",shiftKey:!0,collapsed:!0,prefix:/\t$/,handler(t){this.quill.deleteText(t.index-1,1,wt.sources.USER)}},tab:{key:"Tab",handler(t,e){if(e.format.table)return!0;this.quill.history.cutoff();const i=new Di().retain(t.index).delete(t.length).insert("	");return this.quill.updateContents(i,wt.sources.USER),this.quill.history.cutoff(),this.quill.setSelection(t.index+1,wt.sources.SILENT),!1}},"blockquote empty enter":{key:"Enter",collapsed:!0,format:["blockquote"],empty:!0,handler(){this.quill.format("blockquote",!1,wt.sources.USER)}},"list empty enter":{key:"Enter",collapsed:!0,format:["list"],empty:!0,handler(t,e){const i={list:!1};e.format.indent&&(i.indent=!1),this.quill.formatLine(t.index,t.length,i,wt.sources.USER)}},"checklist enter":{key:"Enter",collapsed:!0,format:{list:"checked"},handler(t){const[e,i]=this.quill.getLine(t.index),n={...e.formats(),list:"checked"},r=new Di().retain(t.index).insert(`
`,n).retain(e.length()-i-1).retain(1,{list:"unchecked"});this.quill.updateContents(r,wt.sources.USER),this.quill.setSelection(t.index+1,wt.sources.SILENT),this.quill.scrollSelectionIntoView()}},"header enter":{key:"Enter",collapsed:!0,format:["header"],suffix:/^$/,handler(t,e){const[i,n]=this.quill.getLine(t.index),r=new Di().retain(t.index).insert(`
`,e.format).retain(i.length()-n-1).retain(1,{header:null});this.quill.updateContents(r,wt.sources.USER),this.quill.setSelection(t.index+1,wt.sources.SILENT),this.quill.scrollSelectionIntoView()}},"table backspace":{key:"Backspace",format:["table"],collapsed:!0,offset:0,handler(){}},"table delete":{key:"Delete",format:["table"],collapsed:!0,suffix:/^$/,handler(){}},"table enter":{key:"Enter",shiftKey:null,format:["table"],handler(t){const e=this.quill.getModule("table");if(e){const[i,n,r,a]=e.getTable(t),s=Hvt(i,n,r,a);if(s==null)return;let o=i.offset();if(s<0){const l=new Di().retain(o).insert(`
`);this.quill.updateContents(l,wt.sources.USER),this.quill.setSelection(t.index+1,t.length,wt.sources.SILENT)}else if(s>0){o+=i.length();const l=new Di().retain(o).insert(`
`);this.quill.updateContents(l,wt.sources.USER),this.quill.setSelection(o,wt.sources.USER)}}}},"table tab":{key:"Tab",shiftKey:null,format:["table"],handler(t,e){const{event:i,line:n}=e,r=n.offset(this.quill.scroll);i.shiftKey?this.quill.setSelection(r-1,wt.sources.USER):this.quill.setSelection(r+n.length(),wt.sources.USER)}},"list autofill":{key:" ",shiftKey:null,collapsed:!0,format:{"code-block":!1,blockquote:!1,table:!1},prefix:/^\s*?(\d+\.|-|\*|\[ ?\]|\[x\])$/,handler(t,e){if(this.quill.scroll.query("list")==null)return!0;const{length:i}=e.prefix,[n,r]=this.quill.getLine(t.index);if(r>i)return!0;let a;switch(e.prefix.trim()){case"[]":case"[ ]":a="unchecked";break;case"[x]":a="checked";break;case"-":case"*":a="bullet";break;default:a="ordered"}this.quill.insertText(t.index," ",wt.sources.USER),this.quill.history.cutoff();const s=new Di().retain(t.index-r).delete(i+1).retain(n.length()-2-r).retain(1,{list:a});return this.quill.updateContents(s,wt.sources.USER),this.quill.history.cutoff(),this.quill.setSelection(t.index-i,wt.sources.SILENT),!1}},"code exit":{key:"Enter",collapsed:!0,format:["code-block"],prefix:/^$/,suffix:/^\s*$/,handler(t){const[e,i]=this.quill.getLine(t.index);let n=2,r=e;for(;r!=null&&r.length()<=1&&r.formats()["code-block"];)if(r=r.prev,n-=1,n<=0){const a=new Di().retain(t.index+e.length()-i-2).retain(1,{"code-block":null}).delete(1);return this.quill.updateContents(a,wt.sources.USER),this.quill.setSelection(t.index-1,wt.sources.SILENT),!1}return!0}},"embed left":DN("ArrowLeft",!1),"embed left shift":DN("ArrowLeft",!0),"embed right":DN("ArrowRight",!1),"embed right shift":DN("ArrowRight",!0),"table down":zie(!1),"table up":zie(!0)}};e$.DEFAULTS=jvt;function Hie(t){return{key:"Tab",shiftKey:!t,format:{"code-block":!0},handler(e,i){let{event:n}=i;const r=this.quill.scroll.query("code-block"),{TAB:a}=r;if(e.length===0&&!n.shiftKey){this.quill.insertText(e.index,a,wt.sources.USER),this.quill.setSelection(e.index+a.length,wt.sources.SILENT);return}const s=e.length===0?this.quill.getLines(e.index,1):this.quill.getLines(e);let{index:o,length:l}=e;s.forEach((c,u)=>{t?(c.insertAt(0,a),u===0?o+=a.length:l+=a.length):c.domNode.textContent.startsWith(a)&&(c.deleteAt(0,a.length),u===0?o-=a.length:l-=a.length)}),this.quill.update(wt.sources.USER),this.quill.setSelection(o,l,wt.sources.SILENT)}}}function DN(t,e){return{key:t,shiftKey:e,altKey:null,[t==="ArrowLeft"?"prefix":"suffix"]:/^$/,handler(n){let{index:r}=n;t==="ArrowRight"&&(r+=n.length+1);const[a]=this.quill.getLeaf(r);return a instanceof Gd?(t==="ArrowLeft"?e?this.quill.setSelection(n.index-1,n.length+1,wt.sources.USER):this.quill.setSelection(n.index-1,wt.sources.USER):e?this.quill.setSelection(n.index,n.length+1,wt.sources.USER):this.quill.setSelection(n.index+n.length+1,wt.sources.USER),!1):!0}}}function eV(t){return{key:t[0],shortKey:!0,handler(e,i){this.quill.format(t,!i.format[t],wt.sources.USER)}}}function zie(t){return{key:t?"ArrowUp":"ArrowDown",collapsed:!0,format:["table"],handler(e,i){const n=t?"prev":"next",r=i.line,a=r.parent[n];if(a!=null){if(a.statics.blotName==="table-row"){let s=a.children.head,o=r;for(;o.prev!=null;)o=o.prev,s=s.next;const l=s.offset(this.quill.scroll)+Math.min(i.offset,s.length()-1);this.quill.setSelection(l,0,wt.sources.USER)}}else{const s=r.table()[n];s!=null&&(t?this.quill.setSelection(s.offset(this.quill.scroll)+s.length()-1,0,wt.sources.USER):this.quill.setSelection(s.offset(this.quill.scroll),0,wt.sources.USER))}return!1}}}function Gvt(t){if(typeof t=="string"||typeof t=="number")t={key:t};else if(typeof t=="object")t=SS(t);else return null;return t.shortKey&&(t[Vvt]=t.shortKey,delete t.shortKey),t}function mK(t){let{quill:e,range:i}=t;const n=e.getLines(i);let r={};if(n.length>1){const a=n[0].formats(),s=n[n.length-1].formats();r=hp.AttributeMap.diff(s,a)||{}}e.deleteText(i,wt.sources.USER),Object.keys(r).length>0&&e.formatLine(i.index,1,r,wt.sources.USER),e.setSelection(i.index,wt.sources.SILENT)}function Hvt(t,e,i,n){return e.prev==null&&e.next==null?i.prev==null&&i.next==null?n===0?-1:1:i.prev==null?-1:1:e.prev==null?-1:e.next==null?1:null}const zvt=/font-weight:\s*normal/,qvt=["P","OL","UL"],qie=t=>t&&qvt.includes(t.tagName),Wvt=t=>{Array.from(t.querySelectorAll("br")).filter(e=>qie(e.previousElementSibling)&&qie(e.nextElementSibling)).forEach(e=>{var i;(i=e.parentNode)==null||i.removeChild(e)})},Yvt=t=>{Array.from(t.querySelectorAll('b[style*="font-weight"]')).filter(e=>{var i;return(i=e.getAttribute("style"))==null?void 0:i.match(zvt)}).forEach(e=>{var n;const i=t.createDocumentFragment();i.append(...e.childNodes),(n=e.parentNode)==null||n.replaceChild(i,e)})};function Kvt(t){t.querySelector('[id^="docs-internal-guid-"]')&&(Yvt(t),Wvt(t))}const Zvt=/\bmso-list:[^;]*ignore/i,Xvt=/\bmso-list:[^;]*\bl(\d+)/i,Jvt=/\bmso-list:[^;]*\blevel(\d+)/i,Qvt=(t,e)=>{const i=t.getAttribute("style"),n=i==null?void 0:i.match(Xvt);if(!n)return null;const r=Number(n[1]),a=i==null?void 0:i.match(Jvt),s=a?Number(a[1]):1,o=new RegExp(`@list l${r}:level${s}\\s*\\{[^\\}]*mso-level-number-format:\\s*([\\w-]+)`,"i"),l=e.match(o),c=l&&l[1]==="bullet"?"bullet":"ordered";return{id:r,indent:s,type:c,element:t}},eyt=t=>{var s,o;const e=Array.from(t.querySelectorAll("[style*=mso-list]")),i=[],n=[];e.forEach(l=>{(l.getAttribute("style")||"").match(Zvt)?i.push(l):n.push(l)}),i.forEach(l=>{var c;return(c=l.parentNode)==null?void 0:c.removeChild(l)});const r=t.documentElement.innerHTML,a=n.map(l=>Qvt(l,r)).filter(l=>l);for(;a.length;){const l=[];let c=a.shift();for(;c;)l.push(c),c=a.length&&((s=a[0])==null?void 0:s.element)===c.element.nextElementSibling&&a[0].id===c.id?a.shift():null;const u=document.createElement("ul");l.forEach(h=>{const f=document.createElement("li");f.setAttribute("data-list",h.type),h.indent>1&&f.setAttribute("class",`ql-indent-${h.indent-1}`),f.innerHTML=h.element.innerHTML,u.appendChild(f)});const d=(o=l[0])==null?void 0:o.element,{parentNode:p}=d??{};d&&(p==null||p.replaceChild(u,d)),l.slice(1).forEach(h=>{let{element:f}=h;p==null||p.removeChild(f)})}};function tyt(t){t.documentElement.getAttribute("xmlns:w")==="urn:schemas-microsoft-com:office:word"&&eyt(t)}const iyt=[tyt,Kvt],nyt=t=>{t.documentElement&&iyt.forEach(e=>{e(t)})},ryt=lv("quill:clipboard"),ayt=[[Node.TEXT_NODE,vyt],[Node.TEXT_NODE,Yie],["br",uyt],[Node.ELEMENT_NODE,Yie],[Node.ELEMENT_NODE,cyt],[Node.ELEMENT_NODE,lyt],[Node.ELEMENT_NODE,myt],["li",hyt],["ol, ul",fyt],["pre",dyt],["tr",gyt],["b",tV("bold")],["i",tV("italic")],["strike",tV("strike")],["style",pyt]],syt=[Ovt,yCe].reduce((t,e)=>(t[e.keyName]=e,t),{}),Wie=[gCe,pK,dK,ICe,TCe,DCe].reduce((t,e)=>(t[e.keyName]=e,t),{});class ECe extends lf{constructor(e,i){super(e,i),this.quill.root.addEventListener("copy",n=>this.onCaptureCopy(n,!1)),this.quill.root.addEventListener("cut",n=>this.onCaptureCopy(n,!0)),this.quill.root.addEventListener("paste",this.onCapturePaste.bind(this)),this.matchers=[],ayt.concat(this.options.matchers??[]).forEach(n=>{let[r,a]=n;this.addMatcher(r,a)})}addMatcher(e,i){this.matchers.push([e,i])}convert(e){let{html:i,text:n}=e,r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(r[Ql.blotName])return new Di().insert(n||"",{[Ql.blotName]:r[Ql.blotName]});if(!i)return new Di().insert(n||"",r);const a=this.convertHTML(i);return CM(a,`
`)&&(a.ops[a.ops.length-1].attributes==null||r.table)?a.compose(new Di().retain(a.length()-1).delete(1)):a}normalizeHTML(e){nyt(e)}convertHTML(e){const i=new DOMParser().parseFromString(e,"text/html");this.normalizeHTML(i);const n=i.body,r=new WeakMap,[a,s]=this.prepareMatching(n,r);return gK(this.quill.scroll,n,a,s,r)}dangerouslyPasteHTML(e,i){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:wt.sources.API;if(typeof e=="string"){const r=this.convert({html:e,text:""});this.quill.setContents(r,i),this.quill.setSelection(0,wt.sources.SILENT)}else{const r=this.convert({html:i,text:""});this.quill.updateContents(new Di().retain(e).concat(r),n),this.quill.setSelection(e+r.length(),wt.sources.SILENT)}}onCaptureCopy(e){var s,o;let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(e.defaultPrevented)return;e.preventDefault();const[n]=this.quill.selection.getRange();if(n==null)return;const{html:r,text:a}=this.onCopy(n,i);(s=e.clipboardData)==null||s.setData("text/plain",a),(o=e.clipboardData)==null||o.setData("text/html",r),i&&mK({range:n,quill:this.quill})}normalizeURIList(e){return e.split(/\r?\n/).filter(i=>i[0]!=="#").join(`
`)}onCapturePaste(e){var s,o,l,c,u;if(e.defaultPrevented||!this.quill.isEnabled())return;e.preventDefault();const i=this.quill.getSelection(!0);if(i==null)return;const n=(s=e.clipboardData)==null?void 0:s.getData("text/html");let r=(o=e.clipboardData)==null?void 0:o.getData("text/plain");if(!n&&!r){const d=(l=e.clipboardData)==null?void 0:l.getData("text/uri-list");d&&(r=this.normalizeURIList(d))}const a=Array.from(((c=e.clipboardData)==null?void 0:c.files)||[]);if(!n&&a.length>0){this.quill.uploader.upload(i,a);return}if(n&&a.length>0){const d=new DOMParser().parseFromString(n,"text/html");if(d.body.childElementCount===1&&((u=d.body.firstElementChild)==null?void 0:u.tagName)==="IMG"){this.quill.uploader.upload(i,a);return}}this.onPaste(i,{html:n,text:r})}onCopy(e){const i=this.quill.getText(e);return{html:this.quill.getSemanticHTML(e),text:i}}onPaste(e,i){let{text:n,html:r}=i;const a=this.quill.getFormat(e.index),s=this.convert({text:n,html:r},a);ryt.log("onPaste",s,{text:n,html:r});const o=new Di().retain(e.index).delete(e.length).concat(s);this.quill.updateContents(o,wt.sources.USER),this.quill.setSelection(o.length()-e.length,wt.sources.SILENT),this.quill.scrollSelectionIntoView()}prepareMatching(e,i){const n=[],r=[];return this.matchers.forEach(a=>{const[s,o]=a;switch(s){case Node.TEXT_NODE:r.push(o);break;case Node.ELEMENT_NODE:n.push(o);break;default:Array.from(e.querySelectorAll(s)).forEach(l=>{if(i.has(l)){const c=i.get(l);c==null||c.push(o)}else i.set(l,[o])});break}}),[n,r]}}et(ECe,"DEFAULTS",{matchers:[]});function Qw(t,e,i,n){return n.query(e)?t.reduce((r,a)=>{if(!a.insert)return r;if(a.attributes&&a.attributes[e])return r.push(a);const s=i?{[e]:i}:{};return r.insert(a.insert,{...s,...a.attributes})},new Di):t}function CM(t,e){let i="";for(let n=t.ops.length-1;n>=0&&i.length<e.length;--n){const r=t.ops[n];if(typeof r.insert!="string")break;i=r.insert+i}return i.slice(-1*e.length)===e}function $v(t,e){if(!(t instanceof Element))return!1;const i=e.query(t);return i&&i.prototype instanceof Gd?!1:["address","article","blockquote","canvas","dd","div","dl","dt","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","header","iframe","li","main","nav","ol","output","p","pre","section","table","td","tr","ul","video"].includes(t.tagName.toLowerCase())}function oyt(t,e){return t.previousElementSibling&&t.nextElementSibling&&!$v(t.previousElementSibling,e)&&!$v(t.nextElementSibling,e)}const EN=new WeakMap;function PCe(t){return t==null?!1:(EN.has(t)||(t.tagName==="PRE"?EN.set(t,!0):EN.set(t,PCe(t.parentNode))),EN.get(t))}function gK(t,e,i,n,r){return e.nodeType===e.TEXT_NODE?n.reduce((a,s)=>s(e,a,t),new Di):e.nodeType===e.ELEMENT_NODE?Array.from(e.childNodes||[]).reduce((a,s)=>{let o=gK(t,s,i,n,r);return s.nodeType===e.ELEMENT_NODE&&(o=i.reduce((l,c)=>c(s,l,t),o),o=(r.get(s)||[]).reduce((l,c)=>c(s,l,t),o)),a.concat(o)},new Di):new Di}function tV(t){return(e,i,n)=>Qw(i,t,!0,n)}function lyt(t,e,i){const n=hm.keys(t),r=sf.keys(t),a=ub.keys(t),s={};return n.concat(r).concat(a).forEach(o=>{let l=i.query(o,Ci.ATTRIBUTE);l!=null&&(s[l.attrName]=l.value(t),s[l.attrName])||(l=syt[o],l!=null&&(l.attrName===o||l.keyName===o)&&(s[l.attrName]=l.value(t)||void 0),l=Wie[o],l!=null&&(l.attrName===o||l.keyName===o)&&(l=Wie[o],s[l.attrName]=l.value(t)||void 0))}),Object.entries(s).reduce((o,l)=>{let[c,u]=l;return Qw(o,c,u,i)},e)}function cyt(t,e,i){const n=i.query(t);if(n==null)return e;if(n.prototype instanceof Gd){const r={},a=n.value(t);if(a!=null)return r[n.blotName]=a,new Di().insert(r,n.formats(t,i))}else if(n.prototype instanceof wP&&!CM(e,`
`)&&e.insert(`
`),"blotName"in n&&"formats"in n&&typeof n.formats=="function")return Qw(e,n.blotName,n.formats(t,i),i);return e}function uyt(t,e){return CM(e,`
`)||e.insert(`
`),e}function dyt(t,e,i){const n=i.query("code-block"),r=n&&"formats"in n&&typeof n.formats=="function"?n.formats(t,i):!0;return Qw(e,"code-block",r,i)}function pyt(){return new Di}function hyt(t,e,i){const n=i.query(t);if(n==null||n.blotName!=="list"||!CM(e,`
`))return e;let r=-1,a=t.parentNode;for(;a!=null;)["OL","UL"].includes(a.tagName)&&(r+=1),a=a.parentNode;return r<=0?e:e.reduce((s,o)=>o.insert?o.attributes&&typeof o.attributes.indent=="number"?s.push(o):s.insert(o.insert,{indent:r,...o.attributes||{}}):s,new Di)}function fyt(t,e,i){const n=t;let r=n.tagName==="OL"?"ordered":"bullet";const a=n.getAttribute("data-checked");return a&&(r=a==="true"?"checked":"unchecked"),Qw(e,"list",r,i)}function Yie(t,e,i){if(!CM(e,`
`)){if($v(t,i)&&(t.childNodes.length>0||t instanceof HTMLParagraphElement))return e.insert(`
`);if(e.length()>0&&t.nextSibling){let n=t.nextSibling;for(;n!=null;){if($v(n,i))return e.insert(`
`);const r=i.query(n);if(r&&r.prototype instanceof lp)return e.insert(`
`);n=n.firstChild}}}return e}function myt(t,e,i){var a;const n={},r=t.style||{};return r.fontStyle==="italic"&&(n.italic=!0),r.textDecoration==="underline"&&(n.underline=!0),r.textDecoration==="line-through"&&(n.strike=!0),((a=r.fontWeight)!=null&&a.startsWith("bold")||parseInt(r.fontWeight,10)>=700)&&(n.bold=!0),e=Object.entries(n).reduce((s,o)=>{let[l,c]=o;return Qw(s,l,c,i)},e),parseFloat(r.textIndent||0)>0?new Di().insert("	").concat(e):e}function gyt(t,e,i){var r,a;const n=((r=t.parentElement)==null?void 0:r.tagName)==="TABLE"?t.parentElement:(a=t.parentElement)==null?void 0:a.parentElement;if(n!=null){const o=Array.from(n.querySelectorAll("tr")).indexOf(t)+1;return Qw(e,"table",o,i)}return e}function vyt(t,e,i){var r;let n=t.data;if(((r=t.parentElement)==null?void 0:r.tagName)==="O:P")return e.insert(n.trim());if(!PCe(t)){if(n.trim().length===0&&n.includes(`
`)&&!oyt(t,i))return e;const a=(s,o)=>{const l=o.replace(/[^\u00a0]/g,"");return l.length<1&&s?" ":l};n=n.replace(/\r\n/g," ").replace(/\n/g," "),n=n.replace(/\s\s+/g,a.bind(a,!0)),(t.previousSibling==null&&t.parentElement!=null&&$v(t.parentElement,i)||t.previousSibling instanceof Element&&$v(t.previousSibling,i))&&(n=n.replace(/^\s+/,a.bind(a,!1))),(t.nextSibling==null&&t.parentElement!=null&&$v(t.parentElement,i)||t.nextSibling instanceof Element&&$v(t.nextSibling,i))&&(n=n.replace(/\s+$/,a.bind(a,!1)))}return e.insert(n)}class CCe extends lf{constructor(i,n){super(i,n);et(this,"lastRecorded",0);et(this,"ignoreChange",!1);et(this,"stack",{undo:[],redo:[]});et(this,"currentRange",null);this.quill.on(wt.events.EDITOR_CHANGE,(r,a,s,o)=>{r===wt.events.SELECTION_CHANGE?a&&o!==wt.sources.SILENT&&(this.currentRange=a):r===wt.events.TEXT_CHANGE&&(this.ignoreChange||(!this.options.userOnly||o===wt.sources.USER?this.record(a,s):this.transform(a)),this.currentRange=YH(this.currentRange,a))}),this.quill.keyboard.addBinding({key:"z",shortKey:!0},this.undo.bind(this)),this.quill.keyboard.addBinding({key:["z","Z"],shortKey:!0,shiftKey:!0},this.redo.bind(this)),/Win/i.test(navigator.platform)&&this.quill.keyboard.addBinding({key:"y",shortKey:!0},this.redo.bind(this)),this.quill.root.addEventListener("beforeinput",r=>{r.inputType==="historyUndo"?(this.undo(),r.preventDefault()):r.inputType==="historyRedo"&&(this.redo(),r.preventDefault())})}change(i,n){if(this.stack[i].length===0)return;const r=this.stack[i].pop();if(!r)return;const a=this.quill.getContents(),s=r.delta.invert(a);this.stack[n].push({delta:s,range:YH(r.range,s)}),this.lastRecorded=0,this.ignoreChange=!0,this.quill.updateContents(r.delta,wt.sources.USER),this.ignoreChange=!1,this.restoreSelection(r)}clear(){this.stack={undo:[],redo:[]}}cutoff(){this.lastRecorded=0}record(i,n){if(i.ops.length===0)return;this.stack.redo=[];let r=i.invert(n),a=this.currentRange;const s=Date.now();if(this.lastRecorded+this.options.delay>s&&this.stack.undo.length>0){const o=this.stack.undo.pop();o&&(r=r.compose(o.delta),a=o.range)}else this.lastRecorded=s;r.length()!==0&&(this.stack.undo.push({delta:r,range:a}),this.stack.undo.length>this.options.maxStack&&this.stack.undo.shift())}redo(){this.change("redo","undo")}transform(i){Kie(this.stack.undo,i),Kie(this.stack.redo,i)}undo(){this.change("undo","redo")}restoreSelection(i){if(i.range)this.quill.setSelection(i.range,wt.sources.USER);else{const n=byt(this.quill.scroll,i.delta);this.quill.setSelection(n,wt.sources.USER)}}}et(CCe,"DEFAULTS",{delay:1e3,maxStack:100,userOnly:!1});function Kie(t,e){let i=e;for(let n=t.length-1;n>=0;n-=1){const r=t[n];t[n]={delta:i.transform(r.delta,!0),range:r.range&&YH(r.range,i)},i=r.delta.transform(i),t[n].delta.length()===0&&t.splice(n,1)}}function yyt(t,e){const i=e.ops[e.ops.length-1];return i==null?!1:i.insert!=null?typeof i.insert=="string"&&i.insert.endsWith(`
`):i.attributes!=null?Object.keys(i.attributes).some(n=>t.query(n,Ci.BLOCK)!=null):!1}function byt(t,e){const i=e.reduce((r,a)=>r+(a.delete||0),0);let n=e.length()-i;return yyt(t,e)&&(n-=1),n}function YH(t,e){if(!t)return t;const i=e.transformPosition(t.index),n=e.transformPosition(t.index+t.length);return{index:i,length:n-i}}class RCe extends lf{constructor(e,i){super(e,i),e.root.addEventListener("drop",n=>{var s;n.preventDefault();let r=null;if(document.caretRangeFromPoint)r=document.caretRangeFromPoint(n.clientX,n.clientY);else if(document.caretPositionFromPoint){const o=document.caretPositionFromPoint(n.clientX,n.clientY);r=document.createRange(),r.setStart(o.offsetNode,o.offset),r.setEnd(o.offsetNode,o.offset)}const a=r&&e.selection.normalizeNative(r);if(a){const o=e.selection.normalizedToRange(a);(s=n.dataTransfer)!=null&&s.files&&this.upload(o,n.dataTransfer.files)}})}upload(e,i){const n=[];Array.from(i).forEach(r=>{var a;r&&((a=this.options.mimetypes)!=null&&a.includes(r.type))&&n.push(r)}),n.length>0&&this.options.handler.call(this,e,n)}}RCe.DEFAULTS={mimetypes:["image/png","image/jpeg"],handler(t,e){if(!this.quill.scroll.query("image"))return;const i=e.map(n=>new Promise(r=>{const a=new FileReader;a.onload=()=>{r(a.result)},a.readAsDataURL(n)}));Promise.all(i).then(n=>{const r=n.reduce((a,s)=>a.insert({image:s}),new Di().retain(t.index).delete(t.length));this.quill.updateContents(r,yi.sources.USER),this.quill.setSelection(t.index+n.length,yi.sources.SILENT)})}};const Iyt=["insertText","insertReplacementText"];class wyt extends lf{constructor(e,i){super(e,i),e.root.addEventListener("beforeinput",n=>{this.handleBeforeInput(n)}),/Android/i.test(navigator.userAgent)||e.on(wt.events.COMPOSITION_BEFORE_START,()=>{this.handleCompositionStart()})}deleteRange(e){mK({range:e,quill:this.quill})}replaceText(e){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";if(e.length===0)return!1;if(i){const n=this.quill.getFormat(e.index,1);this.deleteRange(e),this.quill.updateContents(new Di().retain(e.index).insert(i,n),wt.sources.USER)}else this.deleteRange(e);return this.quill.setSelection(e.index+i.length,0,wt.sources.SILENT),!0}handleBeforeInput(e){if(this.quill.composition.isComposing||e.defaultPrevented||!Iyt.includes(e.inputType))return;const i=e.getTargetRanges?e.getTargetRanges()[0]:null;if(!i||i.collapsed===!0)return;const n=Syt(e);if(n==null)return;const r=this.quill.selection.normalizeNative(i),a=r?this.quill.selection.normalizedToRange(r):null;a&&this.replaceText(a,n)&&e.preventDefault()}handleCompositionStart(){const e=this.quill.getSelection();e&&this.replaceText(e)}}function Syt(t){var e;return typeof t.data=="string"?t.data:(e=t.dataTransfer)!=null&&e.types.includes("text/plain")?t.dataTransfer.getData("text/plain"):null}const Tyt=/Mac/i.test(navigator.platform),Uyt=100,Dyt=t=>!!(t.key==="ArrowLeft"||t.key==="ArrowRight"||t.key==="ArrowUp"||t.key==="ArrowDown"||t.key==="Home"||Tyt&&t.key==="a"&&t.ctrlKey===!0);class Eyt extends lf{constructor(i,n){super(i,n);et(this,"isListening",!1);et(this,"selectionChangeDeadline",0);this.handleArrowKeys(),this.handleNavigationShortcuts()}handleArrowKeys(){this.quill.keyboard.addBinding({key:["ArrowLeft","ArrowRight"],offset:0,shiftKey:null,handler(i,n){let{line:r,event:a}=n;if(!(r instanceof Ah)||!r.uiNode)return!0;const s=getComputedStyle(r.domNode).direction==="rtl";return s&&a.key!=="ArrowRight"||!s&&a.key!=="ArrowLeft"?!0:(this.quill.setSelection(i.index-1,i.length+(a.shiftKey?1:0),wt.sources.USER),!1)}})}handleNavigationShortcuts(){this.quill.root.addEventListener("keydown",i=>{!i.defaultPrevented&&Dyt(i)&&this.ensureListeningToSelectionChange()})}ensureListeningToSelectionChange(){if(this.selectionChangeDeadline=Date.now()+Uyt,this.isListening)return;this.isListening=!0;const i=()=>{this.isListening=!1,Date.now()<=this.selectionChangeDeadline&&this.handleSelectionChange()};document.addEventListener("selectionchange",i,{once:!0})}handleSelectionChange(){const i=document.getSelection();if(!i)return;const n=i.getRangeAt(0);if(n.collapsed!==!0||n.startOffset!==0)return;const r=this.quill.scroll.find(n.startContainer);if(!(r instanceof Ah)||!r.uiNode)return;const a=document.createRange();a.setStartAfter(r.uiNode),a.setEndAfter(r.uiNode),i.removeAllRanges(),i.addRange(a)}}wt.register({"blots/block":Rl,"blots/block/embed":lp,"blots/break":of,"blots/container":Xw,"blots/cursor":FT,"blots/embed":cK,"blots/inline":fm,"blots/scroll":Z0,"blots/text":Kh,"modules/clipboard":ECe,"modules/history":CCe,"modules/keyboard":e$,"modules/uploader":RCe,"modules/input":wyt,"modules/uiNode":Eyt});class Pyt extends sf{add(e,i){let n=0;if(i==="+1"||i==="-1"){const r=this.value(e)||0;n=i==="+1"?r+1:r-1}else typeof i=="number"&&(n=i);return n===0?(this.remove(e),!0):super.add(e,n.toString())}canAdd(e,i){return super.canAdd(e,i)||super.canAdd(e,parseInt(i,10))}value(e){return parseInt(super.value(e),10)||void 0}}const Cyt=new Pyt("indent","ql-indent",{scope:Ci.BLOCK,whitelist:[1,2,3,4,5,6,7,8]});class KH extends Rl{}et(KH,"blotName","blockquote"),et(KH,"tagName","blockquote");var AN;let Ryt=(AN=class extends Rl{static formats(e){return this.tagName.indexOf(e.tagName)+1}},et(AN,"blotName","header"),et(AN,"tagName",["H1","H2","H3","H4","H5","H6"]),AN);class RM extends Xw{}RM.blotName="list-container";RM.tagName="OL";class MM extends Rl{static create(e){const i=super.create();return i.setAttribute("data-list",e),i}static formats(e){return e.getAttribute("data-list")||void 0}static register(){wt.register(RM)}constructor(e,i){super(e,i);const n=i.ownerDocument.createElement("span"),r=a=>{if(!e.isEnabled())return;const s=this.statics.formats(i,e);s==="checked"?(this.format("list","unchecked"),a.preventDefault()):s==="unchecked"&&(this.format("list","checked"),a.preventDefault())};n.addEventListener("mousedown",r),n.addEventListener("touchstart",r),this.attachUI(n)}format(e,i){e===this.statics.blotName&&i?this.domNode.setAttribute("data-list",i):super.format(e,i)}}MM.blotName="list";MM.tagName="LI";RM.allowedChildren=[MM];MM.requiredContainer=RM;class UP extends fm{static create(){return super.create()}static formats(){return!0}optimize(e){super.optimize(e),this.domNode.tagName!==this.statics.tagName[0]&&this.replaceWith(this.statics.blotName)}}et(UP,"blotName","bold"),et(UP,"tagName",["STRONG","B"]);class ZH extends UP{}et(ZH,"blotName","italic"),et(ZH,"tagName",["EM","I"]);class Bv extends fm{static create(e){const i=super.create(e);return i.setAttribute("href",this.sanitize(e)),i.setAttribute("rel","noopener noreferrer"),i.setAttribute("target","_blank"),i}static formats(e){return e.getAttribute("href")}static sanitize(e){return MCe(e,this.PROTOCOL_WHITELIST)?e:this.SANITIZED_URL}format(e,i){e!==this.statics.blotName||!i?super.format(e,i):this.domNode.setAttribute("href",this.constructor.sanitize(i))}}et(Bv,"blotName","link"),et(Bv,"tagName","A"),et(Bv,"SANITIZED_URL","about:blank"),et(Bv,"PROTOCOL_WHITELIST",["http","https","mailto","tel","sms"]);function MCe(t,e){const i=document.createElement("a");i.href=t;const n=i.href.slice(0,i.href.indexOf(":"));return e.indexOf(n)>-1}class XH extends fm{static create(e){return e==="super"?document.createElement("sup"):e==="sub"?document.createElement("sub"):super.create(e)}static formats(e){if(e.tagName==="SUB")return"sub";if(e.tagName==="SUP")return"super"}}et(XH,"blotName","script"),et(XH,"tagName",["SUB","SUP"]);class JH extends UP{}et(JH,"blotName","strike"),et(JH,"tagName",["S","STRIKE"]);class QH extends fm{}et(QH,"blotName","underline"),et(QH,"tagName","U");class CA extends cK{static create(e){if(window.katex==null)throw new Error("Formula module requires KaTeX.");const i=super.create(e);return typeof e=="string"&&(window.katex.render(e,i,{throwOnError:!1,errorColor:"#f00"}),i.setAttribute("data-value",e)),i}static value(e){return e.getAttribute("data-value")}html(){const{formula:e}=this.value();return`<span>${e}</span>`}}et(CA,"blotName","formula"),et(CA,"className","ql-formula"),et(CA,"tagName","SPAN");const Zie=["alt","height","width"];var _N;let Myt=(_N=class extends Gd{static create(e){const i=super.create(e);return typeof e=="string"&&i.setAttribute("src",this.sanitize(e)),i}static formats(e){return Zie.reduce((i,n)=>(e.hasAttribute(n)&&(i[n]=e.getAttribute(n)),i),{})}static match(e){return/\.(jpe?g|gif|png)$/.test(e)||/^data:image\/.+;base64/.test(e)}static sanitize(e){return MCe(e,["http","https","data"])?e:"//:0"}static value(e){return e.getAttribute("src")}format(e,i){Zie.indexOf(e)>-1?i?this.domNode.setAttribute(e,i):this.domNode.removeAttribute(e):super.format(e,i)}},et(_N,"blotName","image"),et(_N,"tagName","IMG"),_N);const Xie=["height","width"];class RA extends lp{static create(e){const i=super.create(e);return i.setAttribute("frameborder","0"),i.setAttribute("allowfullscreen","true"),i.setAttribute("src",this.sanitize(e)),i}static formats(e){return Xie.reduce((i,n)=>(e.hasAttribute(n)&&(i[n]=e.getAttribute(n)),i),{})}static sanitize(e){return Bv.sanitize(e)}static value(e){return e.getAttribute("src")}format(e,i){Xie.indexOf(e)>-1?i?this.domNode.setAttribute(e,i):this.domNode.removeAttribute(e):super.format(e,i)}html(){const{video:e}=this.value();return`<a href="${e}">${e}</a>`}}et(RA,"blotName","video"),et(RA,"className","ql-video"),et(RA,"tagName","IFRAME");const iD=new sf("code-token","hljs",{scope:Ci.INLINE});class _g extends fm{static formats(e,i){for(;e!=null&&e!==i.domNode;){if(e.classList&&e.classList.contains(Ql.className))return super.formats(e,i);e=e.parentNode}}constructor(e,i,n){super(e,i,n),iD.add(this.domNode,n)}format(e,i){e!==_g.blotName?super.format(e,i):i?iD.add(this.domNode,i):(iD.remove(this.domNode),this.domNode.classList.remove(this.statics.className))}optimize(){super.optimize(...arguments),iD.value(this.domNode)||this.unwrap()}}_g.blotName="code-token";_g.className="ql-token";class op extends Ql{static create(e){const i=super.create(e);return typeof e=="string"&&i.setAttribute("data-language",e),i}static formats(e){return e.getAttribute("data-language")||"plain"}static register(){}format(e,i){e===this.statics.blotName&&i?this.domNode.setAttribute("data-language",i):super.format(e,i)}replaceWith(e,i){return this.formatAt(0,this.length(),_g.blotName,!1),super.replaceWith(e,i)}}class kD extends Jw{attach(){super.attach(),this.forceNext=!1,this.scroll.emitMount(this)}format(e,i){e===op.blotName&&(this.forceNext=!0,this.children.forEach(n=>{n.format(e,i)}))}formatAt(e,i,n,r){n===op.blotName&&(this.forceNext=!0),super.formatAt(e,i,n,r)}highlight(e){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(this.children.head==null)return;const r=`${Array.from(this.domNode.childNodes).filter(s=>s!==this.uiNode).map(s=>s.textContent).join(`
`)}
`,a=op.formats(this.children.head.domNode);if(i||this.forceNext||this.cachedText!==r){if(r.trim().length>0||this.cachedText==null){const s=this.children.reduce((l,c)=>l.concat(pCe(c,!1)),new Di),o=e(r,a);s.diff(o).reduce((l,c)=>{let{retain:u,attributes:d}=c;return u?(d&&Object.keys(d).forEach(p=>{[op.blotName,_g.blotName].includes(p)&&this.formatAt(l,u,p,d[p])}),l+u):l},0)}this.cachedText=r,this.forceNext=!1}}html(e,i){const[n]=this.children.find(e);return`<pre data-language="${n?op.formats(n.domNode):"plain"}">
${Q2(this.code(e,i))}
</pre>`}optimize(e){if(super.optimize(e),this.parent!=null&&this.children.head!=null&&this.uiNode!=null){const i=op.formats(this.children.head.domNode);i!==this.uiNode.value&&(this.uiNode.value=i)}}}kD.allowedChildren=[op];op.requiredContainer=kD;op.allowedChildren=[_g,FT,Kh,of];const Nyt=(t,e,i)=>{if(typeof t.versionString=="string"){const n=t.versionString.split(".")[0];if(parseInt(n,10)>=11)return t.highlight(i,{language:e}).value}return t.highlight(e,i).value};class NCe extends lf{static register(){wt.register(_g,!0),wt.register(op,!0),wt.register(kD,!0)}constructor(e,i){if(super(e,i),this.options.hljs==null)throw new Error("Syntax module requires highlight.js. Please include the library on the page before Quill.");this.languages=this.options.languages.reduce((n,r)=>{let{key:a}=r;return n[a]=!0,n},{}),this.highlightBlot=this.highlightBlot.bind(this),this.initListener(),this.initTimer()}initListener(){this.quill.on(wt.events.SCROLL_BLOT_MOUNT,e=>{if(!(e instanceof kD))return;const i=this.quill.root.ownerDocument.createElement("select");this.options.languages.forEach(n=>{let{key:r,label:a}=n;const s=i.ownerDocument.createElement("option");s.textContent=a,s.setAttribute("value",r),i.appendChild(s)}),i.addEventListener("change",()=>{e.format(op.blotName,i.value),this.quill.root.focus(),this.highlight(e,!0)}),e.uiNode==null&&(e.attachUI(i),e.children.head&&(i.value=op.formats(e.children.head.domNode)))})}initTimer(){let e=null;this.quill.on(wt.events.SCROLL_OPTIMIZE,()=>{e&&clearTimeout(e),e=setTimeout(()=>{this.highlight(),e=null},this.options.interval)})}highlight(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(this.quill.selection.composing)return;this.quill.update(wt.sources.USER);const n=this.quill.getSelection();(e==null?this.quill.scroll.descendants(kD):[e]).forEach(a=>{a.highlight(this.highlightBlot,i)}),this.quill.update(wt.sources.SILENT),n!=null&&this.quill.setSelection(n,wt.sources.SILENT)}highlightBlot(e){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"plain";if(i=this.languages[i]?i:"plain",i==="plain")return Q2(e).split(`
`).reduce((r,a,s)=>(s!==0&&r.insert(`
`,{[Ql.blotName]:i}),r.insert(a)),new Di);const n=this.quill.root.ownerDocument.createElement("div");return n.classList.add(Ql.className),n.innerHTML=Nyt(this.options.hljs,i,e),gK(this.quill.scroll,n,[(r,a)=>{const s=iD.value(r);return s?a.compose(new Di().retain(a.length(),{[_g.blotName]:s})):a}],[(r,a)=>r.data.split(`
`).reduce((s,o,l)=>(l!==0&&s.insert(`
`,{[Ql.blotName]:i}),s.insert(o)),a)],new WeakMap)}}NCe.DEFAULTS={hljs:window.hljs,interval:1e3,languages:[{key:"plain",label:"Plain"},{key:"bash",label:"Bash"},{key:"cpp",label:"C++"},{key:"cs",label:"C#"},{key:"css",label:"CSS"},{key:"diff",label:"Diff"},{key:"xml",label:"HTML/XML"},{key:"java",label:"Java"},{key:"javascript",label:"JavaScript"},{key:"markdown",label:"Markdown"},{key:"php",label:"PHP"},{key:"python",label:"Python"},{key:"ruby",label:"Ruby"},{key:"sql",label:"SQL"}]};const zD=class zD extends Rl{static create(e){const i=super.create();return e?i.setAttribute("data-row",e):i.setAttribute("data-row",vK()),i}static formats(e){if(e.hasAttribute("data-row"))return e.getAttribute("data-row")}cellOffset(){return this.parent?this.parent.children.indexOf(this):-1}format(e,i){e===zD.blotName&&i?this.domNode.setAttribute("data-row",i):super.format(e,i)}row(){return this.parent}rowOffset(){return this.row()?this.row().rowOffset():-1}table(){return this.row()&&this.row().table()}};et(zD,"blotName","table"),et(zD,"tagName","TD");let mh=zD;class kg extends Xw{checkMerge(){if(super.checkMerge()&&this.next.children.head!=null){const e=this.children.head.formats(),i=this.children.tail.formats(),n=this.next.children.head.formats(),r=this.next.children.tail.formats();return e.table===i.table&&e.table===n.table&&e.table===r.table}return!1}optimize(e){super.optimize(e),this.children.forEach(i=>{if(i.next==null)return;const n=i.formats(),r=i.next.formats();if(n.table!==r.table){const a=this.splitAfter(i);a&&a.optimize(),this.prev&&this.prev.optimize()}})}rowOffset(){return this.parent?this.parent.children.indexOf(this):-1}table(){return this.parent&&this.parent.parent}}et(kg,"blotName","table-row"),et(kg,"tagName","TR");class $f extends Xw{}et($f,"blotName","table-body"),et($f,"tagName","TBODY");class BT extends Xw{balanceCells(){const e=this.descendants(kg),i=e.reduce((n,r)=>Math.max(r.children.length,n),0);e.forEach(n=>{new Array(i-n.children.length).fill(0).forEach(()=>{let r;n.children.head!=null&&(r=mh.formats(n.children.head.domNode));const a=this.scroll.create(mh.blotName,r);n.appendChild(a),a.optimize()})})}cells(e){return this.rows().map(i=>i.children.at(e))}deleteColumn(e){const[i]=this.descendant($f);i==null||i.children.head==null||i.children.forEach(n=>{const r=n.children.at(e);r!=null&&r.remove()})}insertColumn(e){const[i]=this.descendant($f);i==null||i.children.head==null||i.children.forEach(n=>{const r=n.children.at(e),a=mh.formats(n.children.head.domNode),s=this.scroll.create(mh.blotName,a);n.insertBefore(s,r)})}insertRow(e){const[i]=this.descendant($f);if(i==null||i.children.head==null)return;const n=vK(),r=this.scroll.create(kg.blotName);i.children.head.children.forEach(()=>{const s=this.scroll.create(mh.blotName,n);r.appendChild(s)});const a=i.children.at(e);i.insertBefore(r,a)}rows(){const e=this.children.head;return e==null?[]:e.children.map(i=>i)}}et(BT,"blotName","table-container"),et(BT,"tagName","TABLE");BT.allowedChildren=[$f];$f.requiredContainer=BT;$f.allowedChildren=[kg];kg.requiredContainer=$f;kg.allowedChildren=[mh];mh.requiredContainer=kg;function vK(){return`row-${Math.random().toString(36).slice(2,6)}`}class Ayt extends lf{static register(){wt.register(mh),wt.register(kg),wt.register($f),wt.register(BT)}constructor(){super(...arguments),this.listenBalanceCells()}balanceTables(){this.quill.scroll.descendants(BT).forEach(e=>{e.balanceCells()})}deleteColumn(){const[e,,i]=this.getTable();i!=null&&(e.deleteColumn(i.cellOffset()),this.quill.update(wt.sources.USER))}deleteRow(){const[,e]=this.getTable();e!=null&&(e.remove(),this.quill.update(wt.sources.USER))}deleteTable(){const[e]=this.getTable();if(e==null)return;const i=e.offset();e.remove(),this.quill.update(wt.sources.USER),this.quill.setSelection(i,wt.sources.SILENT)}getTable(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.quill.getSelection();if(e==null)return[null,null,null,-1];const[i,n]=this.quill.getLine(e.index);if(i==null||i.statics.blotName!==mh.blotName)return[null,null,null,-1];const r=i.parent;return[r.parent.parent,r,i,n]}insertColumn(e){const i=this.quill.getSelection();if(!i)return;const[n,r,a]=this.getTable(i);if(a==null)return;const s=a.cellOffset();n.insertColumn(s+e),this.quill.update(wt.sources.USER);let o=r.rowOffset();e===0&&(o+=1),this.quill.setSelection(i.index+o,i.length,wt.sources.SILENT)}insertColumnLeft(){this.insertColumn(0)}insertColumnRight(){this.insertColumn(1)}insertRow(e){const i=this.quill.getSelection();if(!i)return;const[n,r,a]=this.getTable(i);if(a==null)return;const s=r.rowOffset();n.insertRow(s+e),this.quill.update(wt.sources.USER),e>0?this.quill.setSelection(i,wt.sources.SILENT):this.quill.setSelection(i.index+r.children.length,i.length,wt.sources.SILENT)}insertRowAbove(){this.insertRow(0)}insertRowBelow(){this.insertRow(1)}insertTable(e,i){const n=this.quill.getSelection();if(n==null)return;const r=new Array(e).fill(0).reduce(a=>{const s=new Array(i).fill(`
`).join("");return a.insert(s,{table:vK()})},new Di().retain(n.index));this.quill.updateContents(r,wt.sources.USER),this.quill.setSelection(n.index,wt.sources.SILENT),this.balanceTables()}listenBalanceCells(){this.quill.on(wt.events.SCROLL_OPTIMIZE,e=>{e.some(i=>["TD","TR","TBODY","TABLE"].includes(i.target.tagName)?(this.quill.once(wt.events.TEXT_CHANGE,(n,r,a)=>{a===wt.sources.USER&&this.balanceTables()}),!0):!1)})}}const Jie=lv("quill:toolbar");let yK=class extends lf{constructor(e,i){var n,r;if(super(e,i),Array.isArray(this.options.container)){const a=document.createElement("div");a.setAttribute("role","toolbar"),_yt(a,this.options.container),(r=(n=e.container)==null?void 0:n.parentNode)==null||r.insertBefore(a,e.container),this.container=a}else typeof this.options.container=="string"?this.container=document.querySelector(this.options.container):this.container=this.options.container;if(!(this.container instanceof HTMLElement)){Jie.error("Container required for toolbar",this.options);return}this.container.classList.add("ql-toolbar"),this.controls=[],this.handlers={},this.options.handlers&&Object.keys(this.options.handlers).forEach(a=>{var o;const s=(o=this.options.handlers)==null?void 0:o[a];s&&this.addHandler(a,s)}),Array.from(this.container.querySelectorAll("button, select")).forEach(a=>{this.attach(a)}),this.quill.on(wt.events.EDITOR_CHANGE,()=>{const[a]=this.quill.selection.getRange();this.update(a)})}addHandler(e,i){this.handlers[e]=i}attach(e){let i=Array.from(e.classList).find(r=>r.indexOf("ql-")===0);if(!i)return;if(i=i.slice(3),e.tagName==="BUTTON"&&e.setAttribute("type","button"),this.handlers[i]==null&&this.quill.scroll.query(i)==null){Jie.warn("ignoring attaching to nonexistent format",i,e);return}const n=e.tagName==="SELECT"?"change":"click";e.addEventListener(n,r=>{let a;if(e.tagName==="SELECT"){if(e.selectedIndex<0)return;const o=e.options[e.selectedIndex];o.hasAttribute("selected")?a=!1:a=o.value||!1}else e.classList.contains("ql-active")?a=!1:a=e.value||!e.hasAttribute("value"),r.preventDefault();this.quill.focus();const[s]=this.quill.selection.getRange();if(this.handlers[i]!=null)this.handlers[i].call(this,a);else if(this.quill.scroll.query(i).prototype instanceof Gd){if(a=prompt(`Enter ${i}`),!a)return;this.quill.updateContents(new Di().retain(s.index).delete(s.length).insert({[i]:a}),wt.sources.USER)}else this.quill.format(i,a,wt.sources.USER);this.update(s)}),this.controls.push([i,e])}update(e){const i=e==null?{}:this.quill.getFormat(e);this.controls.forEach(n=>{const[r,a]=n;if(a.tagName==="SELECT"){let s=null;if(e==null)s=null;else if(i[r]==null)s=a.querySelector("option[selected]");else if(!Array.isArray(i[r])){let o=i[r];typeof o=="string"&&(o=o.replace(/"/g,'\\"')),s=a.querySelector(`option[value="${o}"]`)}s==null?(a.value="",a.selectedIndex=-1):s.selected=!0}else if(e==null)a.classList.remove("ql-active"),a.setAttribute("aria-pressed","false");else if(a.hasAttribute("value")){const s=i[r],o=s===a.getAttribute("value")||s!=null&&s.toString()===a.getAttribute("value")||s==null&&!a.getAttribute("value");a.classList.toggle("ql-active",o),a.setAttribute("aria-pressed",o.toString())}else{const s=i[r]!=null;a.classList.toggle("ql-active",s),a.setAttribute("aria-pressed",s.toString())}})}};yK.DEFAULTS={};function Qie(t,e,i){const n=document.createElement("button");n.setAttribute("type","button"),n.classList.add(`ql-${e}`),n.setAttribute("aria-pressed","false"),i!=null?(n.value=i,n.setAttribute("aria-label",`${e}: ${i}`)):n.setAttribute("aria-label",e),t.appendChild(n)}function _yt(t,e){Array.isArray(e[0])||(e=[e]),e.forEach(i=>{const n=document.createElement("span");n.classList.add("ql-formats"),i.forEach(r=>{if(typeof r=="string")Qie(n,r);else{const a=Object.keys(r)[0],s=r[a];Array.isArray(s)?kyt(n,a,s):Qie(n,a,s)}}),t.appendChild(n)})}function kyt(t,e,i){const n=document.createElement("select");n.classList.add(`ql-${e}`),i.forEach(r=>{const a=document.createElement("option");r!==!1?a.setAttribute("value",String(r)):a.setAttribute("selected","selected"),n.appendChild(a)}),t.appendChild(n)}yK.DEFAULTS={container:null,handlers:{clean(){const t=this.quill.getSelection();if(t!=null)if(t.length===0){const e=this.quill.getFormat();Object.keys(e).forEach(i=>{this.quill.scroll.query(i,Ci.INLINE)!=null&&this.quill.format(i,!1,wt.sources.USER)})}else this.quill.removeFormat(t.index,t.length,wt.sources.USER)},direction(t){const{align:e}=this.quill.getFormat();t==="rtl"&&e==null?this.quill.format("align","right",wt.sources.USER):!t&&e==="right"&&this.quill.format("align",!1,wt.sources.USER),this.quill.format("direction",t,wt.sources.USER)},indent(t){const e=this.quill.getSelection(),i=this.quill.getFormat(e),n=parseInt(i.indent||0,10);if(t==="+1"||t==="-1"){let r=t==="+1"?1:-1;i.direction==="rtl"&&(r*=-1),this.quill.format("indent",n+r,wt.sources.USER)}},link(t){t===!0&&(t=prompt("Enter link URL:")),this.quill.format("link",t,wt.sources.USER)},list(t){const e=this.quill.getSelection(),i=this.quill.getFormat(e);t==="check"?i.list==="checked"||i.list==="unchecked"?this.quill.format("list",!1,wt.sources.USER):this.quill.format("list","unchecked",wt.sources.USER):this.quill.format("list",t,wt.sources.USER)}}};const xyt='<svg viewbox="0 0 18 18"><line class="ql-stroke" x1="3" x2="15" y1="9" y2="9"/><line class="ql-stroke" x1="3" x2="13" y1="14" y2="14"/><line class="ql-stroke" x1="3" x2="9" y1="4" y2="4"/></svg>',Oyt='<svg viewbox="0 0 18 18"><line class="ql-stroke" x1="15" x2="3" y1="9" y2="9"/><line class="ql-stroke" x1="14" x2="4" y1="14" y2="14"/><line class="ql-stroke" x1="12" x2="6" y1="4" y2="4"/></svg>',Lyt='<svg viewbox="0 0 18 18"><line class="ql-stroke" x1="15" x2="3" y1="9" y2="9"/><line class="ql-stroke" x1="15" x2="5" y1="14" y2="14"/><line class="ql-stroke" x1="15" x2="9" y1="4" y2="4"/></svg>',Fyt='<svg viewbox="0 0 18 18"><line class="ql-stroke" x1="15" x2="3" y1="9" y2="9"/><line class="ql-stroke" x1="15" x2="3" y1="14" y2="14"/><line class="ql-stroke" x1="15" x2="3" y1="4" y2="4"/></svg>',$yt='<svg viewbox="0 0 18 18"><g class="ql-fill ql-color-label"><polygon points="6 6.868 6 6 5 6 5 7 5.942 7 6 6.868"/><rect height="1" width="1" x="4" y="4"/><polygon points="6.817 5 6 5 6 6 6.38 6 6.817 5"/><rect height="1" width="1" x="2" y="6"/><rect height="1" width="1" x="3" y="5"/><rect height="1" width="1" x="4" y="7"/><polygon points="4 11.439 4 11 3 11 3 12 3.755 12 4 11.439"/><rect height="1" width="1" x="2" y="12"/><rect height="1" width="1" x="2" y="9"/><rect height="1" width="1" x="2" y="15"/><polygon points="4.63 10 4 10 4 11 4.192 11 4.63 10"/><rect height="1" width="1" x="3" y="8"/><path d="M10.832,4.2L11,4.582V4H10.708A1.948,1.948,0,0,1,10.832,4.2Z"/><path d="M7,4.582L7.168,4.2A1.929,1.929,0,0,1,7.292,4H7V4.582Z"/><path d="M8,13H7.683l-0.351.8a1.933,1.933,0,0,1-.124.2H8V13Z"/><rect height="1" width="1" x="12" y="2"/><rect height="1" width="1" x="11" y="3"/><path d="M9,3H8V3.282A1.985,1.985,0,0,1,9,3Z"/><rect height="1" width="1" x="2" y="3"/><rect height="1" width="1" x="6" y="2"/><rect height="1" width="1" x="3" y="2"/><rect height="1" width="1" x="5" y="3"/><rect height="1" width="1" x="9" y="2"/><rect height="1" width="1" x="15" y="14"/><polygon points="13.447 10.174 13.469 10.225 13.472 10.232 13.808 11 14 11 14 10 13.37 10 13.447 10.174"/><rect height="1" width="1" x="13" y="7"/><rect height="1" width="1" x="15" y="5"/><rect height="1" width="1" x="14" y="6"/><rect height="1" width="1" x="15" y="8"/><rect height="1" width="1" x="14" y="9"/><path d="M3.775,14H3v1H4V14.314A1.97,1.97,0,0,1,3.775,14Z"/><rect height="1" width="1" x="14" y="3"/><polygon points="12 6.868 12 6 11.62 6 12 6.868"/><rect height="1" width="1" x="15" y="2"/><rect height="1" width="1" x="12" y="5"/><rect height="1" width="1" x="13" y="4"/><polygon points="12.933 9 13 9 13 8 12.495 8 12.933 9"/><rect height="1" width="1" x="9" y="14"/><rect height="1" width="1" x="8" y="15"/><path d="M6,14.926V15H7V14.316A1.993,1.993,0,0,1,6,14.926Z"/><rect height="1" width="1" x="5" y="15"/><path d="M10.668,13.8L10.317,13H10v1h0.792A1.947,1.947,0,0,1,10.668,13.8Z"/><rect height="1" width="1" x="11" y="15"/><path d="M14.332,12.2a1.99,1.99,0,0,1,.166.8H15V12H14.245Z"/><rect height="1" width="1" x="14" y="15"/><rect height="1" width="1" x="15" y="11"/></g><polyline class="ql-stroke" points="5.5 13 9 5 12.5 13"/><line class="ql-stroke" x1="11.63" x2="6.38" y1="11" y2="11"/></svg>',Byt='<svg viewbox="0 0 18 18"><rect class="ql-fill ql-stroke" height="3" width="3" x="4" y="5"/><rect class="ql-fill ql-stroke" height="3" width="3" x="11" y="5"/><path class="ql-even ql-fill ql-stroke" d="M7,8c0,4.031-3,5-3,5"/><path class="ql-even ql-fill ql-stroke" d="M14,8c0,4.031-3,5-3,5"/></svg>',Vyt='<svg viewbox="0 0 18 18"><path class="ql-stroke" d="M5,4H9.5A2.5,2.5,0,0,1,12,6.5v0A2.5,2.5,0,0,1,9.5,9H5A0,0,0,0,1,5,9V4A0,0,0,0,1,5,4Z"/><path class="ql-stroke" d="M5,9h5.5A2.5,2.5,0,0,1,13,11.5v0A2.5,2.5,0,0,1,10.5,14H5a0,0,0,0,1,0,0V9A0,0,0,0,1,5,9Z"/></svg>',jyt='<svg class="" viewbox="0 0 18 18"><line class="ql-stroke" x1="5" x2="13" y1="3" y2="3"/><line class="ql-stroke" x1="6" x2="9.35" y1="12" y2="3"/><line class="ql-stroke" x1="11" x2="15" y1="11" y2="15"/><line class="ql-stroke" x1="15" x2="11" y1="11" y2="15"/><rect class="ql-fill" height="1" rx="0.5" ry="0.5" width="7" x="2" y="14"/></svg>',ene='<svg viewbox="0 0 18 18"><polyline class="ql-even ql-stroke" points="5 7 3 9 5 11"/><polyline class="ql-even ql-stroke" points="13 7 15 9 13 11"/><line class="ql-stroke" x1="10" x2="8" y1="5" y2="13"/></svg>',Gyt='<svg viewbox="0 0 18 18"><line class="ql-color-label ql-stroke ql-transparent" x1="3" x2="15" y1="15" y2="15"/><polyline class="ql-stroke" points="5.5 11 9 3 12.5 11"/><line class="ql-stroke" x1="11.63" x2="6.38" y1="9" y2="9"/></svg>',Hyt='<svg viewbox="0 0 18 18"><polygon class="ql-stroke ql-fill" points="3 11 5 9 3 7 3 11"/><line class="ql-stroke ql-fill" x1="15" x2="11" y1="4" y2="4"/><path class="ql-fill" d="M11,3a3,3,0,0,0,0,6h1V3H11Z"/><rect class="ql-fill" height="11" width="1" x="11" y="4"/><rect class="ql-fill" height="11" width="1" x="13" y="4"/></svg>',zyt='<svg viewbox="0 0 18 18"><polygon class="ql-stroke ql-fill" points="15 12 13 10 15 8 15 12"/><line class="ql-stroke ql-fill" x1="9" x2="5" y1="4" y2="4"/><path class="ql-fill" d="M5,3A3,3,0,0,0,5,9H6V3H5Z"/><rect class="ql-fill" height="11" width="1" x="5" y="4"/><rect class="ql-fill" height="11" width="1" x="7" y="4"/></svg>',qyt='<svg viewbox="0 0 18 18"><path class="ql-fill" d="M11.759,2.482a2.561,2.561,0,0,0-3.53.607A7.656,7.656,0,0,0,6.8,6.2C6.109,9.188,5.275,14.677,4.15,14.927a1.545,1.545,0,0,0-1.3-.933A0.922,0.922,0,0,0,2,15.036S1.954,16,4.119,16s3.091-2.691,3.7-5.553c0.177-.826.36-1.726,0.554-2.6L8.775,6.2c0.381-1.421.807-2.521,1.306-2.676a1.014,1.014,0,0,0,1.02.56A0.966,0.966,0,0,0,11.759,2.482Z"/><rect class="ql-fill" height="1.6" rx="0.8" ry="0.8" width="5" x="5.15" y="6.2"/><path class="ql-fill" d="M13.663,12.027a1.662,1.662,0,0,1,.266-0.276q0.193,0.069.456,0.138a2.1,2.1,0,0,0,.535.069,1.075,1.075,0,0,0,.767-0.3,1.044,1.044,0,0,0,.314-0.8,0.84,0.84,0,0,0-.238-0.619,0.8,0.8,0,0,0-.594-0.239,1.154,1.154,0,0,0-.781.3,4.607,4.607,0,0,0-.781,1q-0.091.15-.218,0.346l-0.246.38c-0.068-.288-0.137-0.582-0.212-0.885-0.459-1.847-2.494-.984-2.941-0.8-0.482.2-.353,0.647-0.094,0.529a0.869,0.869,0,0,1,1.281.585c0.217,0.751.377,1.436,0.527,2.038a5.688,5.688,0,0,1-.362.467,2.69,2.69,0,0,1-.264.271q-0.221-.08-0.471-0.147a2.029,2.029,0,0,0-.522-0.066,1.079,1.079,0,0,0-.768.3A1.058,1.058,0,0,0,9,15.131a0.82,0.82,0,0,0,.832.852,1.134,1.134,0,0,0,.787-0.3,5.11,5.11,0,0,0,.776-0.993q0.141-.219.215-0.34c0.046-.076.122-0.194,0.223-0.346a2.786,2.786,0,0,0,.918,1.726,2.582,2.582,0,0,0,2.376-.185c0.317-.181.212-0.565,0-0.494A0.807,0.807,0,0,1,14.176,15a5.159,5.159,0,0,1-.913-2.446l0,0Q13.487,12.24,13.663,12.027Z"/></svg>',Wyt='<svg viewBox="0 0 18 18"><path class="ql-fill" d="M10,4V14a1,1,0,0,1-2,0V10H3v4a1,1,0,0,1-2,0V4A1,1,0,0,1,3,4V8H8V4a1,1,0,0,1,2,0Zm6.06787,9.209H14.98975V7.59863a.54085.54085,0,0,0-.605-.60547h-.62744a1.01119,1.01119,0,0,0-.748.29688L11.645,8.56641a.5435.5435,0,0,0-.022.8584l.28613.30762a.53861.53861,0,0,0,.84717.0332l.09912-.08789a1.2137,1.2137,0,0,0,.2417-.35254h.02246s-.01123.30859-.01123.60547V13.209H12.041a.54085.54085,0,0,0-.605.60547v.43945a.54085.54085,0,0,0,.605.60547h4.02686a.54085.54085,0,0,0,.605-.60547v-.43945A.54085.54085,0,0,0,16.06787,13.209Z"/></svg>',Yyt='<svg viewBox="0 0 18 18"><path class="ql-fill" d="M16.73975,13.81445v.43945a.54085.54085,0,0,1-.605.60547H11.855a.58392.58392,0,0,1-.64893-.60547V14.0127c0-2.90527,3.39941-3.42187,3.39941-4.55469a.77675.77675,0,0,0-.84717-.78125,1.17684,1.17684,0,0,0-.83594.38477c-.2749.26367-.561.374-.85791.13184l-.4292-.34082c-.30811-.24219-.38525-.51758-.1543-.81445a2.97155,2.97155,0,0,1,2.45361-1.17676,2.45393,2.45393,0,0,1,2.68408,2.40918c0,2.45312-3.1792,2.92676-3.27832,3.93848h2.79443A.54085.54085,0,0,1,16.73975,13.81445ZM9,3A.99974.99974,0,0,0,8,4V8H3V4A1,1,0,0,0,1,4V14a1,1,0,0,0,2,0V10H8v4a1,1,0,0,0,2,0V4A.99974.99974,0,0,0,9,3Z"/></svg>',Kyt='<svg viewBox="0 0 18 18"><path class="ql-fill" d="M16.65186,12.30664a2.6742,2.6742,0,0,1-2.915,2.68457,3.96592,3.96592,0,0,1-2.25537-.6709.56007.56007,0,0,1-.13232-.83594L11.64648,13c.209-.34082.48389-.36328.82471-.1543a2.32654,2.32654,0,0,0,1.12256.33008c.71484,0,1.12207-.35156,1.12207-.78125,0-.61523-.61621-.86816-1.46338-.86816H13.2085a.65159.65159,0,0,1-.68213-.41895l-.05518-.10937a.67114.67114,0,0,1,.14307-.78125l.71533-.86914a8.55289,8.55289,0,0,1,.68213-.7373V8.58887a3.93913,3.93913,0,0,1-.748.05469H11.9873a.54085.54085,0,0,1-.605-.60547V7.59863a.54085.54085,0,0,1,.605-.60547h3.75146a.53773.53773,0,0,1,.60547.59375v.17676a1.03723,1.03723,0,0,1-.27539.748L14.74854,10.0293A2.31132,2.31132,0,0,1,16.65186,12.30664ZM9,3A.99974.99974,0,0,0,8,4V8H3V4A1,1,0,0,0,1,4V14a1,1,0,0,0,2,0V10H8v4a1,1,0,0,0,2,0V4A.99974.99974,0,0,0,9,3Z"/></svg>',Zyt='<svg viewBox="0 0 18 18"><path class="ql-fill" d="M10,4V14a1,1,0,0,1-2,0V10H3v4a1,1,0,0,1-2,0V4A1,1,0,0,1,3,4V8H8V4a1,1,0,0,1,2,0Zm7.05371,7.96582v.38477c0,.39648-.165.60547-.46191.60547h-.47314v1.29785a.54085.54085,0,0,1-.605.60547h-.69336a.54085.54085,0,0,1-.605-.60547V12.95605H11.333a.5412.5412,0,0,1-.60547-.60547v-.15332a1.199,1.199,0,0,1,.22021-.748l2.56348-4.05957a.7819.7819,0,0,1,.72607-.39648h1.27637a.54085.54085,0,0,1,.605.60547v3.7627h.33008A.54055.54055,0,0,1,17.05371,11.96582ZM14.28125,8.7207h-.022a4.18969,4.18969,0,0,1-.38525.81348l-1.188,1.80469v.02246h1.5293V9.60059A7.04058,7.04058,0,0,1,14.28125,8.7207Z"/></svg>',Xyt='<svg viewBox="0 0 18 18"><path class="ql-fill" d="M16.74023,12.18555a2.75131,2.75131,0,0,1-2.91553,2.80566,3.908,3.908,0,0,1-2.25537-.68164.54809.54809,0,0,1-.13184-.8252L11.73438,13c.209-.34082.48389-.36328.8252-.1543a2.23757,2.23757,0,0,0,1.1001.33008,1.01827,1.01827,0,0,0,1.1001-.96777c0-.61621-.53906-.97949-1.25439-.97949a2.15554,2.15554,0,0,0-.64893.09961,1.15209,1.15209,0,0,1-.814.01074l-.12109-.04395a.64116.64116,0,0,1-.45117-.71484l.231-3.00391a.56666.56666,0,0,1,.62744-.583H15.541a.54085.54085,0,0,1,.605.60547v.43945a.54085.54085,0,0,1-.605.60547H13.41748l-.04395.72559a1.29306,1.29306,0,0,1-.04395.30859h.022a2.39776,2.39776,0,0,1,.57227-.07715A2.53266,2.53266,0,0,1,16.74023,12.18555ZM9,3A.99974.99974,0,0,0,8,4V8H3V4A1,1,0,0,0,1,4V14a1,1,0,0,0,2,0V10H8v4a1,1,0,0,0,2,0V4A.99974.99974,0,0,0,9,3Z"/></svg>',Jyt='<svg viewBox="0 0 18 18"><path class="ql-fill" d="M14.51758,9.64453a1.85627,1.85627,0,0,0-1.24316.38477H13.252a1.73532,1.73532,0,0,1,1.72754-1.4082,2.66491,2.66491,0,0,1,.5498.06641c.35254.05469.57227.01074.70508-.40723l.16406-.5166a.53393.53393,0,0,0-.373-.75977,4.83723,4.83723,0,0,0-1.17773-.14258c-2.43164,0-3.7627,2.17773-3.7627,4.43359,0,2.47559,1.60645,3.69629,3.19043,3.69629A2.70585,2.70585,0,0,0,16.96,12.19727,2.43861,2.43861,0,0,0,14.51758,9.64453Zm-.23047,3.58691c-.67187,0-1.22168-.81445-1.22168-1.45215,0-.47363.30762-.583.72559-.583.96875,0,1.27734.59375,1.27734,1.12207A.82182.82182,0,0,1,14.28711,13.23145ZM10,4V14a1,1,0,0,1-2,0V10H3v4a1,1,0,0,1-2,0V4A1,1,0,0,1,3,4V8H8V4a1,1,0,0,1,2,0Z"/></svg>',Qyt='<svg viewbox="0 0 18 18"><line class="ql-stroke" x1="7" x2="13" y1="4" y2="4"/><line class="ql-stroke" x1="5" x2="11" y1="14" y2="14"/><line class="ql-stroke" x1="8" x2="10" y1="14" y2="4"/></svg>',ebt='<svg viewbox="0 0 18 18"><rect class="ql-stroke" height="10" width="12" x="3" y="4"/><circle class="ql-fill" cx="6" cy="7" r="1"/><polyline class="ql-even ql-fill" points="5 12 5 11 7 9 8 10 11 7 13 9 13 12 5 12"/></svg>',tbt='<svg viewbox="0 0 18 18"><line class="ql-stroke" x1="3" x2="15" y1="14" y2="14"/><line class="ql-stroke" x1="3" x2="15" y1="4" y2="4"/><line class="ql-stroke" x1="9" x2="15" y1="9" y2="9"/><polyline class="ql-fill ql-stroke" points="3 7 3 11 5 9 3 7"/></svg>',ibt='<svg viewbox="0 0 18 18"><line class="ql-stroke" x1="3" x2="15" y1="14" y2="14"/><line class="ql-stroke" x1="3" x2="15" y1="4" y2="4"/><line class="ql-stroke" x1="9" x2="15" y1="9" y2="9"/><polyline class="ql-stroke" points="5 7 5 11 3 9 5 7"/></svg>',nbt='<svg viewbox="0 0 18 18"><line class="ql-stroke" x1="7" x2="11" y1="7" y2="11"/><path class="ql-even ql-stroke" d="M8.9,4.577a3.476,3.476,0,0,1,.36,4.679A3.476,3.476,0,0,1,4.577,8.9C3.185,7.5,2.035,6.4,4.217,4.217S7.5,3.185,8.9,4.577Z"/><path class="ql-even ql-stroke" d="M13.423,9.1a3.476,3.476,0,0,0-4.679-.36,3.476,3.476,0,0,0,.36,4.679c1.392,1.392,2.5,2.542,4.679.36S14.815,10.5,13.423,9.1Z"/></svg>',rbt='<svg viewbox="0 0 18 18"><line class="ql-stroke" x1="6" x2="15" y1="4" y2="4"/><line class="ql-stroke" x1="6" x2="15" y1="9" y2="9"/><line class="ql-stroke" x1="6" x2="15" y1="14" y2="14"/><line class="ql-stroke" x1="3" x2="3" y1="4" y2="4"/><line class="ql-stroke" x1="3" x2="3" y1="9" y2="9"/><line class="ql-stroke" x1="3" x2="3" y1="14" y2="14"/></svg>',abt='<svg class="" viewbox="0 0 18 18"><line class="ql-stroke" x1="9" x2="15" y1="4" y2="4"/><polyline class="ql-stroke" points="3 4 4 5 6 3"/><line class="ql-stroke" x1="9" x2="15" y1="14" y2="14"/><polyline class="ql-stroke" points="3 14 4 15 6 13"/><line class="ql-stroke" x1="9" x2="15" y1="9" y2="9"/><polyline class="ql-stroke" points="3 9 4 10 6 8"/></svg>',sbt='<svg viewbox="0 0 18 18"><line class="ql-stroke" x1="7" x2="15" y1="4" y2="4"/><line class="ql-stroke" x1="7" x2="15" y1="9" y2="9"/><line class="ql-stroke" x1="7" x2="15" y1="14" y2="14"/><line class="ql-stroke ql-thin" x1="2.5" x2="4.5" y1="5.5" y2="5.5"/><path class="ql-fill" d="M3.5,6A0.5,0.5,0,0,1,3,5.5V3.085l-0.276.138A0.5,0.5,0,0,1,2.053,3c-0.124-.247-0.023-0.324.224-0.447l1-.5A0.5,0.5,0,0,1,4,2.5v3A0.5,0.5,0,0,1,3.5,6Z"/><path class="ql-stroke ql-thin" d="M4.5,10.5h-2c0-.234,1.85-1.076,1.85-2.234A0.959,0.959,0,0,0,2.5,8.156"/><path class="ql-stroke ql-thin" d="M2.5,14.846a0.959,0.959,0,0,0,1.85-.109A0.7,0.7,0,0,0,3.75,14a0.688,0.688,0,0,0,.6-0.736,0.959,0.959,0,0,0-1.85-.109"/></svg>',obt='<svg viewbox="0 0 18 18"><path class="ql-fill" d="M15.5,15H13.861a3.858,3.858,0,0,0,1.914-2.975,1.8,1.8,0,0,0-1.6-1.751A1.921,1.921,0,0,0,12.021,11.7a0.50013,0.50013,0,1,0,.957.291h0a0.914,0.914,0,0,1,1.053-.725,0.81,0.81,0,0,1,.744.762c0,1.076-1.16971,1.86982-1.93971,2.43082A1.45639,1.45639,0,0,0,12,15.5a0.5,0.5,0,0,0,.5.5h3A0.5,0.5,0,0,0,15.5,15Z"/><path class="ql-fill" d="M9.65,5.241a1,1,0,0,0-1.409.108L6,7.964,3.759,5.349A1,1,0,0,0,2.192,6.59178Q2.21541,6.6213,2.241,6.649L4.684,9.5,2.241,12.35A1,1,0,0,0,3.71,13.70722q0.02557-.02768.049-0.05722L6,11.036,8.241,13.65a1,1,0,1,0,1.567-1.24277Q9.78459,12.3777,9.759,12.35L7.316,9.5,9.759,6.651A1,1,0,0,0,9.65,5.241Z"/></svg>',lbt='<svg viewbox="0 0 18 18"><path class="ql-fill" d="M15.5,7H13.861a4.015,4.015,0,0,0,1.914-2.975,1.8,1.8,0,0,0-1.6-1.751A1.922,1.922,0,0,0,12.021,3.7a0.5,0.5,0,1,0,.957.291,0.917,0.917,0,0,1,1.053-.725,0.81,0.81,0,0,1,.744.762c0,1.077-1.164,1.925-1.934,2.486A1.423,1.423,0,0,0,12,7.5a0.5,0.5,0,0,0,.5.5h3A0.5,0.5,0,0,0,15.5,7Z"/><path class="ql-fill" d="M9.651,5.241a1,1,0,0,0-1.41.108L6,7.964,3.759,5.349a1,1,0,1,0-1.519,1.3L4.683,9.5,2.241,12.35a1,1,0,1,0,1.519,1.3L6,11.036,8.241,13.65a1,1,0,0,0,1.519-1.3L7.317,9.5,9.759,6.651A1,1,0,0,0,9.651,5.241Z"/></svg>',cbt='<svg viewbox="0 0 18 18"><line class="ql-stroke ql-thin" x1="15.5" x2="2.5" y1="8.5" y2="9.5"/><path class="ql-fill" d="M9.007,8C6.542,7.791,6,7.519,6,6.5,6,5.792,7.283,5,9,5c1.571,0,2.765.679,2.969,1.309a1,1,0,0,0,1.9-.617C13.356,4.106,11.354,3,9,3,6.2,3,4,4.538,4,6.5a3.2,3.2,0,0,0,.5,1.843Z"/><path class="ql-fill" d="M8.984,10C11.457,10.208,12,10.479,12,11.5c0,0.708-1.283,1.5-3,1.5-1.571,0-2.765-.679-2.969-1.309a1,1,0,1,0-1.9.617C4.644,13.894,6.646,15,9,15c2.8,0,5-1.538,5-3.5a3.2,3.2,0,0,0-.5-1.843Z"/></svg>',ubt='<svg viewbox="0 0 18 18"><rect class="ql-stroke" height="12" width="12" x="3" y="3"/><rect class="ql-fill" height="2" width="3" x="5" y="5"/><rect class="ql-fill" height="2" width="4" x="9" y="5"/><g class="ql-fill ql-transparent"><rect height="2" width="3" x="5" y="8"/><rect height="2" width="4" x="9" y="8"/><rect height="2" width="3" x="5" y="11"/><rect height="2" width="4" x="9" y="11"/></g></svg>',dbt='<svg viewbox="0 0 18 18"><path class="ql-stroke" d="M5,3V9a4.012,4.012,0,0,0,4,4H9a4.012,4.012,0,0,0,4-4V3"/><rect class="ql-fill" height="1" rx="0.5" ry="0.5" width="12" x="3" y="15"/></svg>',pbt='<svg viewbox="0 0 18 18"><rect class="ql-stroke" height="12" width="12" x="3" y="3"/><rect class="ql-fill" height="12" width="1" x="5" y="3"/><rect class="ql-fill" height="12" width="1" x="12" y="3"/><rect class="ql-fill" height="2" width="8" x="5" y="8"/><rect class="ql-fill" height="1" width="3" x="3" y="5"/><rect class="ql-fill" height="1" width="3" x="3" y="7"/><rect class="ql-fill" height="1" width="3" x="3" y="10"/><rect class="ql-fill" height="1" width="3" x="3" y="12"/><rect class="ql-fill" height="1" width="3" x="12" y="5"/><rect class="ql-fill" height="1" width="3" x="12" y="7"/><rect class="ql-fill" height="1" width="3" x="12" y="10"/><rect class="ql-fill" height="1" width="3" x="12" y="12"/></svg>',DP={align:{"":xyt,center:Oyt,right:Lyt,justify:Fyt},background:$yt,blockquote:Byt,bold:Vyt,clean:jyt,code:ene,"code-block":ene,color:Gyt,direction:{"":Hyt,rtl:zyt},formula:qyt,header:{1:Wyt,2:Yyt,3:Kyt,4:Zyt,5:Xyt,6:Jyt},italic:Qyt,image:ebt,indent:{"+1":tbt,"-1":ibt},link:nbt,list:{bullet:rbt,check:abt,ordered:sbt},script:{sub:obt,super:lbt},strike:cbt,table:ubt,underline:dbt,video:pbt},hbt='<svg viewbox="0 0 18 18"><polygon class="ql-stroke" points="7 11 9 13 11 11 7 11"/><polygon class="ql-stroke" points="7 7 9 5 11 7 7 7"/></svg>';let tne=0;function ine(t,e){t.setAttribute(e,`${t.getAttribute(e)!=="true"}`)}class t${constructor(e){this.select=e,this.container=document.createElement("span"),this.buildPicker(),this.select.style.display="none",this.select.parentNode.insertBefore(this.container,this.select),this.label.addEventListener("mousedown",()=>{this.togglePicker()}),this.label.addEventListener("keydown",i=>{switch(i.key){case"Enter":this.togglePicker();break;case"Escape":this.escape(),i.preventDefault();break}}),this.select.addEventListener("change",this.update.bind(this))}togglePicker(){this.container.classList.toggle("ql-expanded"),ine(this.label,"aria-expanded"),ine(this.options,"aria-hidden")}buildItem(e){const i=document.createElement("span");i.tabIndex="0",i.setAttribute("role","button"),i.classList.add("ql-picker-item");const n=e.getAttribute("value");return n&&i.setAttribute("data-value",n),e.textContent&&i.setAttribute("data-label",e.textContent),i.addEventListener("click",()=>{this.selectItem(i,!0)}),i.addEventListener("keydown",r=>{switch(r.key){case"Enter":this.selectItem(i,!0),r.preventDefault();break;case"Escape":this.escape(),r.preventDefault();break}}),i}buildLabel(){const e=document.createElement("span");return e.classList.add("ql-picker-label"),e.innerHTML=hbt,e.tabIndex="0",e.setAttribute("role","button"),e.setAttribute("aria-expanded","false"),this.container.appendChild(e),e}buildOptions(){const e=document.createElement("span");e.classList.add("ql-picker-options"),e.setAttribute("aria-hidden","true"),e.tabIndex="-1",e.id=`ql-picker-options-${tne}`,tne+=1,this.label.setAttribute("aria-controls",e.id),this.options=e,Array.from(this.select.options).forEach(i=>{const n=this.buildItem(i);e.appendChild(n),i.selected===!0&&this.selectItem(n)}),this.container.appendChild(e)}buildPicker(){Array.from(this.select.attributes).forEach(e=>{this.container.setAttribute(e.name,e.value)}),this.container.classList.add("ql-picker"),this.label=this.buildLabel(),this.buildOptions()}escape(){this.close(),setTimeout(()=>this.label.focus(),1)}close(){this.container.classList.remove("ql-expanded"),this.label.setAttribute("aria-expanded","false"),this.options.setAttribute("aria-hidden","true")}selectItem(e){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;const n=this.container.querySelector(".ql-selected");e!==n&&(n!=null&&n.classList.remove("ql-selected"),e!=null&&(e.classList.add("ql-selected"),this.select.selectedIndex=Array.from(e.parentNode.children).indexOf(e),e.hasAttribute("data-value")?this.label.setAttribute("data-value",e.getAttribute("data-value")):this.label.removeAttribute("data-value"),e.hasAttribute("data-label")?this.label.setAttribute("data-label",e.getAttribute("data-label")):this.label.removeAttribute("data-label"),i&&(this.select.dispatchEvent(new Event("change")),this.close())))}update(){let e;if(this.select.selectedIndex>-1){const n=this.container.querySelector(".ql-picker-options").children[this.select.selectedIndex];e=this.select.options[this.select.selectedIndex],this.selectItem(n)}else this.selectItem(null);const i=e!=null&&e!==this.select.querySelector("option[selected]");this.label.classList.toggle("ql-active",i)}}class ACe extends t${constructor(e,i){super(e),this.label.innerHTML=i,this.container.classList.add("ql-color-picker"),Array.from(this.container.querySelectorAll(".ql-picker-item")).slice(0,7).forEach(n=>{n.classList.add("ql-primary")})}buildItem(e){const i=super.buildItem(e);return i.style.backgroundColor=e.getAttribute("value")||"",i}selectItem(e,i){super.selectItem(e,i);const n=this.label.querySelector(".ql-color-label"),r=e&&e.getAttribute("data-value")||"";n&&(n.tagName==="line"?n.style.stroke=r:n.style.fill=r)}}class _Ce extends t${constructor(e,i){super(e),this.container.classList.add("ql-icon-picker"),Array.from(this.container.querySelectorAll(".ql-picker-item")).forEach(n=>{n.innerHTML=i[n.getAttribute("data-value")||""]}),this.defaultItem=this.container.querySelector(".ql-selected"),this.selectItem(this.defaultItem)}selectItem(e,i){super.selectItem(e,i);const n=e||this.defaultItem;if(n!=null){if(this.label.innerHTML===n.innerHTML)return;this.label.innerHTML=n.innerHTML}}}const fbt=t=>{const{overflowY:e}=getComputedStyle(t,null);return e!=="visible"&&e!=="clip"};class kCe{constructor(e,i){this.quill=e,this.boundsContainer=i||document.body,this.root=e.addContainer("ql-tooltip"),this.root.innerHTML=this.constructor.TEMPLATE,fbt(this.quill.root)&&this.quill.root.addEventListener("scroll",()=>{this.root.style.marginTop=`${-1*this.quill.root.scrollTop}px`}),this.hide()}hide(){this.root.classList.add("ql-hidden")}position(e){const i=e.left+e.width/2-this.root.offsetWidth/2,n=e.bottom+this.quill.root.scrollTop;this.root.style.left=`${i}px`,this.root.style.top=`${n}px`,this.root.classList.remove("ql-flip");const r=this.boundsContainer.getBoundingClientRect(),a=this.root.getBoundingClientRect();let s=0;if(a.right>r.right&&(s=r.right-a.right,this.root.style.left=`${i+s}px`),a.left<r.left&&(s=r.left-a.left,this.root.style.left=`${i+s}px`),a.bottom>r.bottom){const o=a.bottom-a.top,l=e.bottom-e.top+o;this.root.style.top=`${n-l}px`,this.root.classList.add("ql-flip")}return s}show(){this.root.classList.remove("ql-editing"),this.root.classList.remove("ql-hidden")}}const mbt=[!1,"center","right","justify"],gbt=["#000000","#e60000","#ff9900","#ffff00","#008a00","#0066cc","#9933ff","#ffffff","#facccc","#ffebcc","#ffffcc","#cce8cc","#cce0f5","#ebd6ff","#bbbbbb","#f06666","#ffc266","#ffff66","#66b966","#66a3e0","#c285ff","#888888","#a10000","#b26b00","#b2b200","#006100","#0047b2","#6b24b2","#444444","#5c0000","#663d00","#666600","#003700","#002966","#3d1466"],vbt=[!1,"serif","monospace"],ybt=["1","2","3",!1],bbt=["small",!1,"large","huge"];class NM extends $T{constructor(e,i){super(e,i);const n=r=>{if(!document.body.contains(e.root)){document.body.removeEventListener("click",n);return}this.tooltip!=null&&!this.tooltip.root.contains(r.target)&&document.activeElement!==this.tooltip.textbox&&!this.quill.hasFocus()&&this.tooltip.hide(),this.pickers!=null&&this.pickers.forEach(a=>{a.container.contains(r.target)||a.close()})};e.emitter.listenDOM("click",document.body,n)}addModule(e){const i=super.addModule(e);return e==="toolbar"&&this.extendToolbar(i),i}buildButtons(e,i){Array.from(e).forEach(n=>{(n.getAttribute("class")||"").split(/\s+/).forEach(a=>{if(a.startsWith("ql-")&&(a=a.slice(3),i[a]!=null))if(a==="direction")n.innerHTML=i[a][""]+i[a].rtl;else if(typeof i[a]=="string")n.innerHTML=i[a];else{const s=n.value||"";s!=null&&i[a][s]&&(n.innerHTML=i[a][s])}})})}buildPickers(e,i){this.pickers=Array.from(e).map(r=>{if(r.classList.contains("ql-align")&&(r.querySelector("option")==null&&j1(r,mbt),typeof i.align=="object"))return new _Ce(r,i.align);if(r.classList.contains("ql-background")||r.classList.contains("ql-color")){const a=r.classList.contains("ql-background")?"background":"color";return r.querySelector("option")==null&&j1(r,gbt,a==="background"?"#ffffff":"#000000"),new ACe(r,i[a])}return r.querySelector("option")==null&&(r.classList.contains("ql-font")?j1(r,vbt):r.classList.contains("ql-header")?j1(r,ybt):r.classList.contains("ql-size")&&j1(r,bbt)),new t$(r)});const n=()=>{this.pickers.forEach(r=>{r.update()})};this.quill.on(yi.events.EDITOR_CHANGE,n)}}NM.DEFAULTS=Yv({},$T.DEFAULTS,{modules:{toolbar:{handlers:{formula(){this.quill.theme.tooltip.edit("formula")},image(){let t=this.container.querySelector("input.ql-image[type=file]");t==null&&(t=document.createElement("input"),t.setAttribute("type","file"),t.setAttribute("accept",this.quill.uploader.options.mimetypes.join(", ")),t.classList.add("ql-image"),t.addEventListener("change",()=>{const e=this.quill.getSelection(!0);this.quill.uploader.upload(e,t.files),t.value=""}),this.container.appendChild(t)),t.click()},video(){this.quill.theme.tooltip.edit("video")}}}}});class xCe extends kCe{constructor(e,i){super(e,i),this.textbox=this.root.querySelector('input[type="text"]'),this.listen()}listen(){this.textbox.addEventListener("keydown",e=>{e.key==="Enter"?(this.save(),e.preventDefault()):e.key==="Escape"&&(this.cancel(),e.preventDefault())})}cancel(){this.hide(),this.restoreFocus()}edit(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"link",i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;if(this.root.classList.remove("ql-hidden"),this.root.classList.add("ql-editing"),this.textbox==null)return;i!=null?this.textbox.value=i:e!==this.root.getAttribute("data-mode")&&(this.textbox.value="");const n=this.quill.getBounds(this.quill.selection.savedRange);n!=null&&this.position(n),this.textbox.select(),this.textbox.setAttribute("placeholder",this.textbox.getAttribute(`data-${e}`)||""),this.root.setAttribute("data-mode",e)}restoreFocus(){this.quill.focus({preventScroll:!0})}save(){let{value:e}=this.textbox;switch(this.root.getAttribute("data-mode")){case"link":{const{scrollTop:i}=this.quill.root;this.linkRange?(this.quill.formatText(this.linkRange,"link",e,yi.sources.USER),delete this.linkRange):(this.restoreFocus(),this.quill.format("link",e,yi.sources.USER)),this.quill.root.scrollTop=i;break}case"video":e=Ibt(e);case"formula":{if(!e)break;const i=this.quill.getSelection(!0);if(i!=null){const n=i.index+i.length;this.quill.insertEmbed(n,this.root.getAttribute("data-mode"),e,yi.sources.USER),this.root.getAttribute("data-mode")==="formula"&&this.quill.insertText(n+1," ",yi.sources.USER),this.quill.setSelection(n+2,yi.sources.USER)}break}}this.textbox.value="",this.hide()}}function Ibt(t){let e=t.match(/^(?:(https?):\/\/)?(?:(?:www|m)\.)?youtube\.com\/watch.*v=([a-zA-Z0-9_-]+)/)||t.match(/^(?:(https?):\/\/)?(?:(?:www|m)\.)?youtu\.be\/([a-zA-Z0-9_-]+)/);return e?`${e[1]||"https"}://www.youtube.com/embed/${e[2]}?showinfo=0`:(e=t.match(/^(?:(https?):\/\/)?(?:www\.)?vimeo\.com\/(\d+)/))?`${e[1]||"https"}://player.vimeo.com/video/${e[2]}/`:t}function j1(t,e){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;e.forEach(n=>{const r=document.createElement("option");n===i?r.setAttribute("selected","selected"):r.setAttribute("value",String(n)),t.appendChild(r)})}const wbt=[["bold","italic","link"],[{header:1},{header:2},"blockquote"]];class OCe extends xCe{constructor(e,i){super(e,i),this.quill.on(yi.events.EDITOR_CHANGE,(n,r,a,s)=>{if(n===yi.events.SELECTION_CHANGE)if(r!=null&&r.length>0&&s===yi.sources.USER){this.show(),this.root.style.left="0px",this.root.style.width="",this.root.style.width=`${this.root.offsetWidth}px`;const o=this.quill.getLines(r.index,r.length);if(o.length===1){const l=this.quill.getBounds(r);l!=null&&this.position(l)}else{const l=o[o.length-1],c=this.quill.getIndex(l),u=Math.min(l.length()-1,r.index+r.length-c),d=this.quill.getBounds(new LI(c,u));d!=null&&this.position(d)}}else document.activeElement!==this.textbox&&this.quill.hasFocus()&&this.hide()})}listen(){super.listen(),this.root.querySelector(".ql-close").addEventListener("click",()=>{this.root.classList.remove("ql-editing")}),this.quill.on(yi.events.SCROLL_OPTIMIZE,()=>{setTimeout(()=>{if(this.root.classList.contains("ql-hidden"))return;const e=this.quill.getSelection();if(e!=null){const i=this.quill.getBounds(e);i!=null&&this.position(i)}},1)})}cancel(){this.show()}position(e){const i=super.position(e),n=this.root.querySelector(".ql-tooltip-arrow");return n.style.marginLeft="",i!==0&&(n.style.marginLeft=`${-1*i-n.offsetWidth/2}px`),i}}et(OCe,"TEMPLATE",['<span class="ql-tooltip-arrow"></span>','<div class="ql-tooltip-editor">','<input type="text" data-formula="e=mc^2" data-link="https://quilljs.com" data-video="Embed URL">','<a class="ql-close"></a>',"</div>"].join(""));class LCe extends NM{constructor(e,i){i.modules.toolbar!=null&&i.modules.toolbar.container==null&&(i.modules.toolbar.container=wbt),super(e,i),this.quill.container.classList.add("ql-bubble")}extendToolbar(e){this.tooltip=new OCe(this.quill,this.options.bounds),e.container!=null&&(this.tooltip.root.appendChild(e.container),this.buildButtons(e.container.querySelectorAll("button"),DP),this.buildPickers(e.container.querySelectorAll("select"),DP))}}LCe.DEFAULTS=Yv({},NM.DEFAULTS,{modules:{toolbar:{handlers:{link(t){t?this.quill.theme.tooltip.edit():this.quill.format("link",!1,wt.sources.USER)}}}}});const Sbt=[[{header:["1","2","3",!1]}],["bold","italic","underline","link"],[{list:"ordered"},{list:"bullet"}],["clean"]];class FCe extends xCe{constructor(){super(...arguments);et(this,"preview",this.root.querySelector("a.ql-preview"))}listen(){super.listen(),this.root.querySelector("a.ql-action").addEventListener("click",i=>{this.root.classList.contains("ql-editing")?this.save():this.edit("link",this.preview.textContent),i.preventDefault()}),this.root.querySelector("a.ql-remove").addEventListener("click",i=>{if(this.linkRange!=null){const n=this.linkRange;this.restoreFocus(),this.quill.formatText(n,"link",!1,yi.sources.USER),delete this.linkRange}i.preventDefault(),this.hide()}),this.quill.on(yi.events.SELECTION_CHANGE,(i,n,r)=>{if(i!=null){if(i.length===0&&r===yi.sources.USER){const[a,s]=this.quill.scroll.descendant(Bv,i.index);if(a!=null){this.linkRange=new LI(i.index-s,a.length());const o=Bv.formats(a.domNode);this.preview.textContent=o,this.preview.setAttribute("href",o),this.show();const l=this.quill.getBounds(this.linkRange);l!=null&&this.position(l);return}}else delete this.linkRange;this.hide()}})}show(){super.show(),this.root.removeAttribute("data-mode")}}et(FCe,"TEMPLATE",['<a class="ql-preview" rel="noopener noreferrer" target="_blank" href="about:blank"></a>','<input type="text" data-formula="e=mc^2" data-link="https://quilljs.com" data-video="Embed URL">','<a class="ql-action"></a>','<a class="ql-remove"></a>'].join(""));class $Ce extends NM{constructor(e,i){i.modules.toolbar!=null&&i.modules.toolbar.container==null&&(i.modules.toolbar.container=Sbt),super(e,i),this.quill.container.classList.add("ql-snow")}extendToolbar(e){e.container!=null&&(e.container.classList.add("ql-snow"),this.buildButtons(e.container.querySelectorAll("button"),DP),this.buildPickers(e.container.querySelectorAll("select"),DP),this.tooltip=new FCe(this.quill,this.options.bounds),e.container.querySelector(".ql-link")&&this.quill.keyboard.addBinding({key:"k",shortKey:!0},(i,n)=>{e.handlers.link.call(e,!n.format.link)}))}}$Ce.DEFAULTS=Yv({},NM.DEFAULTS,{modules:{toolbar:{handlers:{link(t){if(t){const e=this.quill.getSelection();if(e==null||e.length===0)return;let i=this.quill.getText(e);/^\S+@\S+\.\S+$/.test(i)&&i.indexOf("mailto:")!==0&&(i=`mailto:${i}`);const{tooltip:n}=this.quill.theme;n.edit("link",i)}else this.quill.format("link",!1,wt.sources.USER)}}}}});wt.register({"attributors/attribute/direction":yCe,"attributors/class/align":mCe,"attributors/class/background":Fvt,"attributors/class/color":Lvt,"attributors/class/direction":bCe,"attributors/class/font":SCe,"attributors/class/size":UCe,"attributors/style/align":gCe,"attributors/style/background":pK,"attributors/style/color":dK,"attributors/style/direction":ICe,"attributors/style/font":TCe,"attributors/style/size":DCe},!0);wt.register({"formats/align":mCe,"formats/direction":bCe,"formats/indent":Cyt,"formats/background":pK,"formats/color":dK,"formats/font":SCe,"formats/size":UCe,"formats/blockquote":KH,"formats/code-block":Ql,"formats/header":Ryt,"formats/list":MM,"formats/bold":UP,"formats/code":hK,"formats/italic":ZH,"formats/link":Bv,"formats/script":XH,"formats/strike":JH,"formats/underline":QH,"formats/formula":CA,"formats/image":Myt,"formats/video":RA,"modules/syntax":NCe,"modules/table":Ayt,"modules/toolbar":yK,"themes/bubble":LCe,"themes/snow":$Ce,"ui/icons":DP,"ui/picker":t$,"ui/icon-picker":_Ce,"ui/color-picker":ACe,"ui/tooltip":kCe},!0);function Tbt({controlAnchor:t}){const e={editing:!1};return Io({target:t,items:[{label:"Tournament image",onClick:Upt,id:"tournamentImage",location:oi,intent:"none"},{label:"Edit overview",onClick:()=>{var s;const r=document.getElementById("editOverview");r.innerHTML=e.editing?"Edit overview":"Save overview";const a=document.getElementById("notes");if(e.editing){a.previousElementSibling.remove(),a.style.border="none";const o=a.querySelector(".ql-editor"),c=((s=o==null?void 0:o.innerText)==null?void 0:s.replace(`
`,""))?o.innerHTML:"";Ys(a),a.innerHTML=c,ii({methods:[{method:WZe,params:{notes:c}}]})}else{a.style.border=".5px solid",a.style.borderTop="";const o=new wt("#notes",{modules:{toolbar:[[{header:[1,2,3,4,5,6,!1]}],[{font:[]}],["bold","italic","underline"],[{color:[]},{background:[]}],[{list:"ordered"},{list:"bullet"}],[{align:[]}],["blockquote","code-block","link","video"],["clean"]]},theme:"snow"});It.quill=o}e.editing=!e.editing},id:"editOverview",location:oi,intent:"none"}]}).elements}function Ubt({tournamentName:t}){var s;const e=document.getElementById(PU);e.style.minHeight=`${window.innerHeight*.9}px`,Ys(e);const i=document.createElement("div");i.style.fontWeight="bold",i.className="block",i.innerHTML=Zi.device.isMobile?t??"Tournament overview":"Tournament overview",e.appendChild(i);const n=document.createElement("div");e.appendChild(n);const r=(s=ot.getTournament().tournamentRecord)==null?void 0:s.notes,a=document.createElement("div");a.className="ql-container ql-snow",a.style.border="none",a.innerHTML=r??"",a.id="notes",e.appendChild(a),Tbt({controlAnchor:n})}let VT;function i$(t){PN(dD,t),PN(TE,t),PN(Bh,t),PN(uL,t);const e=document.getElementById("trnynav"),i=document.getElementById("dnav");[dD,Bh].includes(t)?(e.style.display=t===dD?"":xt,i.style.display=""):i.style.display=xt}function PN(t,e){const i=t===e,n=document.getElementById(t);n&&(n.style.display=i?"flex":"none")}const iV=()=>{const t=document.getElementById("dnav");t.style.display=xt,VT=TE,i$(TE)},Dbt=t=>{VT=t,i$(dD)},Ebt=()=>{const t=document.getElementById("pageTitle");t&&(t.innerHTML="<div class='tmx-title'>Tournaments</div>"),VT=Bh,i$(VT)},Pbt=()=>{VT=uL,i$(VT)};function Cbt({config:t}={}){const{tournamentRecord:e}=ot.getTournament();(e==null?void 0:e.tournamentId)===t.tournamentId?BCe(t):(It.ee.emit(eDe,It.tournamentId),jc.findTournament(t.tournamentId).then(i=>ez({tournamentRecord:i,config:t})))}function nV({config:t}){Dbt(Ps),fct(),VY(t.selectedTab),BCe(t)}function BCe(t){var i;const{selectedTab:e=Qf}=t;xfe(e)&&(e===Qf&&prt({participantView:t.participantView}),e===dy&&NEe({scheduledDate:t.scheduledDate}),e===PU&&Ubt({tournamentName:(i=ot.getTournamentInfo().tournamentInfo)==null?void 0:i.tournamentName}),e===hh&&Tpt(t),e===X4&&lct(),e===J4&&Cct())}function ez({tournamentRecord:t,config:e}){var s,o,l;const i=Xc(),n=(i==null?void 0:i.provider)||(It==null?void 0:It.provider),r=()=>{Jt({message:"Tournament not found",onClose:()=>{It.router.navigate("/tournaments")},intent:"is-warning",pauseOnHover:!0})},a=c=>{var d,p;const u=(p=(d=c==null?void 0:c.data)==null?void 0:d.tournamentRecords)==null?void 0:p[e.tournamentId];u?(ot.setState(u),nV({config:e})):r()};if(n){const c=()=>{t?(ot.setState(t),nV({config:e})):r()};if(e.tournamentId){if((l=(o=(s=t==null?void 0:t.timeItems)==null?void 0:s.find(({itemType:d})=>d==="TMX"))==null?void 0:o.itemValue)==null?void 0:l.offline)return c();vL({tournamentId:e.tournamentId}).then(a,c)}}else ot.setState(t),nV({config:e})}const nne={addDrawDefinition:t=>os("addDrawDefinition",t),addMatchUps:t=>os("addMatchUps",t),addParticipants:t=>os("addParticipants",t),addVenue:t=>os("addVenue",t),deletedDrawIds:t=>os("deletedDrawIds",t),deletedMatchUpIds:t=>os("deletedMatchUpIds",t),deleteVenue:t=>os("deleteVenue",t),modifyDrawDefinition:t=>os("modifyDrawDefinition",t),modifyDrawEntries:t=>os("modifyDrawEntries",t),modifyEventEntries:t=>os("modifyEventEntries",t),modifyMatchUp:t=>os("modifyMatchUp",t),modifyParticipants:t=>os("modifyParticipants",t),modifyPositionAssignments:t=>os("modifyPositionAssignments",t),modifySeedAssignments:t=>os("modifySeedAssignments",t),modifyVenue:t=>os("modifyVenue",t),publishEvent:t=>os("publishEvent",t),publishEventSeeding:t=>os("publishEventSeeding",t),publishOrderOfPlay:t=>os("publishOrderOfPlay",t),unPublishEvent:t=>os("unPublishEvent",t),unPublishEventSeeding:t=>os("unPublishEventSeeding",t),unPublishOrderOfPlay:t=>os("unPublishOrderOfPlay",t),updateInContextMatchUp:t=>os("updateInContextMatchUp",t),modifyTournamentDetail:t=>os("modifyTournamentDetail",t)};function os(t,e){var i,n,r;return typeof((n=(i=window.dev)==null?void 0:i.subs)==null?void 0:n[t])=="function"?window.dev.subs[t](e):(window.dev.allSubscriptions||((r=window.dev.subs)==null?void 0:r[t]))&&console.log(t,e)}function VCe(){if(!window.dev)console.log("%c dev initialized","color: yellow"),window.dev={};else return;const t=()=>console.log("set window.socketURL for messaging"),e=r=>{var s;if(!Array.isArray(r)){Jt({message:"missing methods array",intent:"is-danger"});return}((s=ot.getTournament().tournamentRecord)==null?void 0:s.tournamentId)?ii({methods:r,callback:l=>{var c;if(l!=null&&l.success){Jt({message:"success",intent:"is-success"});const u=ot.getTournament().tournamentRecord;ez({tournamentRecord:u,config:{selectedTab:Ps}})}else Jt({message:((c=l==null?void 0:l.error)==null?void 0:c.message)??"error",intent:"is-danger"}),console.log({result:l})}}):Jt({message:"missing tournament",intent:"is-danger"})},i=r=>{vL({tournamentId:r}).then(a=>{var s,o;if(a!=null&&a.error)console.log({error:a.error});else{const l=(o=(s=a==null?void 0:a.data)==null?void 0:s.tournamentRecords)==null?void 0:o[r];l&&ez({tournamentRecord:l,config:{selectedTab:Ps}})}})},n=Object.assign({},...Object.keys(nne).map(r=>({[r]:!1})));CN({getProviders:RE,getProvider:r=>RE().then(a=>{var s;return console.log((s=a==null?void 0:a.data)==null?void 0:s.providers.find(o=>o.value.organisationName.toLowerCase().includes(r.toLowerCase())))}),getTournament:()=>{var r;return(r=ot.getTournament())==null?void 0:r.tournamentRecord},getContext:uS.getDevContext,tournamentEngine:ot,context:uS.setDevContext,generateMockTournament:Mbt,modifyTournament:e,fetchTournament:i,sendTournament:mD,getLoginState:Xc,getUsers:cme,factory:fj,baseApi:nu,dayjs:PY,help:t,subs:n}),CN({connectSocket:gDe,disconnectSocket:A2,emitTmx:EY}),CN({tmx2db:jc,load:Rbt,exportTournamentRecord:git}),CN({env:Zi,tournamentContext:It}),uS.setSubscriptions({subscriptions:nne})}function CN(t){if(Up(window.dev))try{Object.keys(t).forEach(e=>window.dev[e]=t[e])}catch{console.log("production environment")}}function Rbt(t){if(typeof t=="object"){const e=t.tournamentRecord||t;(e==null?void 0:e.tournamentId)&&jCe(e)}}function Mbt(t){const{tournamentRecord:e,error:i}=zC.generateTournamentRecord(t);i?console.log({error:i}):jCe(e)}function jCe(t){const e=t==null?void 0:t.tournamentId;QUe({tournamentRecord:t,callback:()=>It.router.navigate(`/${Ps}/${e}`)})}class nD extends Error{}nD.prototype.name="InvalidTokenError";function Nbt(t){return decodeURIComponent(atob(t).replace(/(.)/g,(e,i)=>{let n=i.charCodeAt(0).toString(16).toUpperCase();return n.length<2&&(n="0"+n),"%"+n}))}function Abt(t){let e=t.replace(/-/g,"+").replace(/_/g,"/");switch(e.length%4){case 0:break;case 2:e+="==";break;case 3:e+="=";break;default:throw new Error("base64 string is not of the correct length")}try{return Nbt(e)}catch{return atob(e)}}function _bt(t,e){if(typeof t!="string")throw new nD("Invalid token specified: must be a string");e||(e={});const i=e.header===!0?0:1,n=t.split(".")[i];if(typeof n!="string")throw new nD(`Invalid token specified: missing part #${i+1}`);let r;try{r=Abt(n)}catch(a){throw new nD(`Invalid token specified: invalid base64 for part #${i+1} (${a.message})`)}try{return JSON.parse(r)}catch(a){throw new nD(`Invalid token specified: invalid json for part #${i+1} (${a.message})`)}}function GCe(t){var r,a;if(!t||t==="undefined"){TDe();return}let e;try{e=_bt(t)}catch{XUe();return}const i=new Date;return(e==null?void 0:e.exp)<i.getTime()/1e3?bK():(((r=e==null?void 0:e.permissions)!=null&&r.includes("devMode")||(a=e==null?void 0:e.roles)!=null&&a.includes("develope"))&&VCe(),e)}function rne(t){var m;const{callback:e,provider:i}=t||{},n=(m=i==null?void 0:i.onlineResources)==null?void 0:m.find(g=>g.name==="providerImage"&&g.resourceType==="URL"&&g.resourceSubType==="IMAGE");let r,a;const s=i||{},o=()=>{const g=document.getElementById("providerImagePreview");g.style.display=xt},l=()=>{c({inputs:r}),a=!1;const g=document.getElementById("providerImagePreview");g.onload=()=>(a=!0)&&c({inputs:r}),g.src=r.tournamentImage.value,g.style.display=""},c=({inputs:g})=>{const v=(a||!g.tournamentImage.value||a===void 0)&&Wr(10)(g.providerName.value)&&Wr(3)(g.providerAbbr.value)&&(!g.providerId.value.length||Wr(36)(g.providerId.value)),y=document.getElementById("createButton");y&&(y.disabled=!v)},u=[{control:"providerAbbr",onInput:c},{control:"providerName",onInput:c},{control:"providerId",onInput:c}],d=g=>{var v,y;return r=Sr(g,[{value:s.organisationName,placeholder:"Provider name",validator:Wr(10),label:"Provider Name",field:"providerName",autocomplete:"off"},{value:s.organisationAbbreviation,placeholder:"Abbreviation",validator:Wr(3),label:"Abbreviation",field:"providerAbbr",autocomplete:"off"},{placeholder:"NOT REQUIRED - automatically generated",value:((v=t==null?void 0:t.provider)==null?void 0:v.organisationId)??"",disabled:(y=t==null?void 0:t.provider)==null?void 0:y.organisationId,label:"Provider ID",autocomplete:"off",field:"providerId"},{onKeyUp:b=>b.key==="Enter"&&l(),onChange:()=>r.tournamentImage.value?l():o(),label:"Web address of online image",value:n==null?void 0:n.identifier,placeholder:"Image URL",field:"tournamentImage",autocomplete:"off"}],u)},p=document.createElement("div");d(p);const h=document.createElement("img");h.id="providerImagePreview",h.style.width="100%",p.appendChild(h);const f=()=>{var T;const g=r.providerAbbr.value,v=r.providerName.value,y=((T=t==null?void 0:t.provider)==null?void 0:T.organisationId)||r.providerId.value||_i.UUID(),b={organisationAbbreviation:g,organisationName:v,organisationId:y};if(a){const S={resourceSubType:"IMAGE",name:"providerImage",resourceType:"URL",identifier:r.tournamentImage.value};b.onlineResources=[S]}const I=w=>Ot(e)&&e(w);t!=null&&t.provider?Rje({provider:b}).then(I,w=>console.log({err:w})):Cje({provider:b}).then(I,w=>console.log({err:w}))};er({title:"Create provider",content:p,buttons:[{label:"Cancel",intent:"none",close:!0},{label:t!=null&&t.provider?"Update":"Create",onClick:f,id:"createButton",intent:"is-info",disabled:!0,close:!0}]}),n&&setTimeout(l,400)}function HCe(){let t;er({title:"Settings",content:n=>t=Sr(n,[{options:[{text:"WTN",field:"wtn",checked:Zi.activeScale===PE},{text:"UTR",field:"utr",checked:Zi.activeScale===yI}],onClick:r=>console.log({x:r}),label:"Active rating",field:"activeRating",id:"activeRating",radio:!0},{label:"Save local copies",checked:Zi.saveLocal,field:"saveLocal",id:"saveLocal",checkbox:!0}]),buttons:[{label:"Cancel",intent:"none",close:!0},{label:"Save",intent:"is-primary",onClick:()=>{const n=t.wtn.checked?PE:yI;Zi.saveLocal=t.saveLocal.checked,Nk(n)},close:!0}]})}function kbt(t){const e=document.getElementById(t);e&&e.addEventListener("click",HCe)}const Bk=t=>t.match(/^[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,}$/i);async function xbt(t,e){return nu.post("/auth/login",{password:e,email:t})}async function Obt(t,e,i,n,r){return nu.post("/auth/invite",{permissions:n,providerId:e,services:r,email:t,roles:i})}async function Lbt(t,e,i,n){return nu.post("/auth/register",{firstName:t,lastName:e,password:i,code:n})}function Fbt(t,e=[]){const n=[{value:{organisationName:"None"},key:""},...e].map(({key:f,value:m})=>({label:m==null?void 0:m.organisationName,value:f}));let r;const a={providerId:""},s=f=>a.providerId=f,l=[{onInput:({inputs:f})=>{const m=f.email.value,g=Bk(m),v=document.getElementById("inviteUser");v&&(v.disabled=!g)},control:"email"}],c=f=>r=Sr(f,[{iconLeft:"fa-regular fa-envelope",placeholder:"valid@email.com",validator:Bk,autocomplete:"off",label:"Email",field:"email"},{text:"Roles",header:!0},{label:"Client",field:"client",checkbox:!0,width:"50%",id:"client",fieldPair:{label:"Director",field:"director",id:"director",checkbox:!0}},{label:"Admin",checkbox:!0,field:"admin",width:"50%",id:"admin",fieldPair:{label:"Official",field:"official",id:"official",checkbox:!0}},{label:"Scoring",field:"score",width:"50%",id:"score",checkbox:!0,fieldPair:{label:"Developer",field:"developer",id:"developer",checkbox:!0}},{label:"Generate",field:"generate",checkbox:!0,id:"generate"},{typeAhead:{list:n,callback:s},value:a.providerId||"",placeholder:"None",field:"providerId",label:"Provider"},{text:"Permissions",header:!0},{label:"Delete Tournaments",field:"deleteTournament",checkbox:!0,id:"delete"},{field:"editTennisId",label:"Edit WTID",id:"editTennisId",checkbox:!0},{label:"Dev mode",field:"devMode",checkbox:!0,id:"devmode"},{text:"Services",header:!0},{label:"Tournament Profiles (fetch)",field:"tournamentProfile",id:"tournamentProfile",checkbox:!0}],l),u=["client","admin","score","developer","generate","director","official"],d=["devMode","editTennisId","deleteTournament"],p=["tournamentProfile"];er({title:"Invite user",content:c,buttons:[{label:"Cancel",intent:"none",close:!0},{label:"Invite",intent:"is-primary",id:"inviteUser",disabled:!0,onClick:()=>{var I;const f=r.email.value,m=a.providerId||((I=r.providerId)==null?void 0:I.value),g=d.map(T=>r[T].checked&&T).filter(Boolean),v=p.map(T=>r[T].checked&&T).filter(Boolean),y=u.map(T=>r[T].checked&&T).filter(Boolean),b=T=>Ot(t)&&t(T);Obt(f,m,y,g,v).then(b,T=>console.log({err:T}))},close:!0}]})}function $bt(t){let e;const n=[{onInput:({inputs:s})=>{const o=s.email.value,l=Bk(o),c=document.getElementById("loginButton");c&&(c.disabled=!l)},control:"email"}];er({title:"Log in",content:s=>e=Sr(s,[{iconLeft:"fa-regular fa-envelope",placeholder:"valid@email.com",validator:Bk,autocomplete:"email",label:"Email",field:"email"},{placeholder:"minimum 8 characters",autocomplete:"current-password",iconLeft:"fa-solid fa-lock",label:"Password",field:"password",type:"password"}],n),buttons:[{label:"Cancel",intent:"none",close:!0},{onClick:()=>{const s=e.email.value,o=e.password.value,l=c=>{!c&&bK(),(c==null?void 0:c.status)===200&&jbt({data:c.data,callback:t})};xbt(s,o).then(l,c=>console.log({err:c}))},intent:"is-primary",id:"loginButton",disabled:!0,label:"Login",close:!0}]})}function Bbt(t){navigator.clipboard.writeText(t).then(()=>Jt({message:"Copied to clipboard",intent:"is-success"})).catch(a=>Jt({message:a,intent:"is-danger"}));let e=document.createElement("input");e.style.opacity=0,e.setAttribute("id","c2c"),e.setAttribute("type","text"),e.setAttribute("value",t);let i=document.body.appendChild(e),n=document.createElement("button");n.style.display="none",n.setAttribute("data-copytarget","#c2c"),n.addEventListener("click",Vbt,!0);let r=document.body.appendChild(n);r.click(),r.remove(),i.remove()}function Vbt(t){let i=t.target.dataset.copytarget,n=i?document.querySelector(i):null;if(n!=null&&n.select){n.select();try{document.execCommand("copy"),n.blur()}catch{alert("please press Ctrl/Cmd+C to copy")}}}function n$(t){var r;const e=document.getElementById("login"),i=It==null?void 0:It.provider,n=(r=t==null?void 0:t.roles)==null?void 0:r.includes(cL);t?e.style.color=i&&"red"||n&&"green"||"blue":e.style.color=""}function Xc(){const t=JUe(),e=GCe(t);return e&&n$(e),e}function bK(){XUe(),TDe(),A2(),It.provider=void 0,It.router.navigate(`/${Bh}/logout`),n$(!1)}function jbt({data:t,callback:e}){var r,a;const i=GCe(t.token),n=(r=ot.getTournament().tournamentRecord)==null?void 0:r.tournamentId;i&&(cZe(t.token),Jt({intent:"is-success",message:"Log in successful"}),A2(),n||ot.reset(),n$(i),Ot(e)?e():n||It.router.navigate(`/${Bh}/${(a=i.provider)==null?void 0:a.organisationAbbreviation}`))}function Gbt(){RE().then(({data:t})=>{var i;const e=(i=t==null?void 0:t.providers)==null?void 0:i.map(({value:n})=>({onClick:()=>{It.provider=n,It.router.navigate(`/${Bh}/${n.organisationAbbreviation}`)},participantName:n.organisationName}));e&&uY({title:"Select Provider",options:e,selectionLimit:1})})}function Hbt(){cme().then(({data:t})=>{var i;const e=(i=t==null?void 0:t.users)==null?void 0:i.map(({value:n})=>({participantName:`${n.firstName} ${n.lastName} (${n.email})`,onClick:()=>Aje(n).then(()=>Jt({message:"User removed"}))}));e&&uY({title:"Select User",options:e,selectionLimit:1})})}function zbt(){It.provider=void 0,It.router.navigate(`/${Bh}/superadmin`)}function ane(t){const e=document.getElementById(t),i=n=>{var r;return Jt({intent:"is-danger",message:((r=n==null?void 0:n.data)==null?void 0:r.message)||"Error"})};if(e){const n=a=>{const s=a==null?void 0:a.data.inviteCode;if(s){const o=`${window.location.origin}${window.location.pathname}/#/${yfe}/${s}`;Bbt(o),console.log({inviteCode:s,inviteURL:o})}else i(a)},r=a=>setTimeout(()=>rne({provider:a}),200);e.addEventListener("click",()=>{var u,d;const a=Xc(),s=(u=a==null?void 0:a.roles)==null?void 0:u.includes(cL),o=(d=a==null?void 0:a.roles)==null?void 0:d.includes(gfe),l=It==null?void 0:It.provider;Ic({target:e,title:"Authorization",items:[{onClick:()=>Jt({message:"TBD: Registration Modal"}),text:"Register",hide:a},{onClick:()=>$bt(),hide:a,text:"Log in"},{style:"text-decoration: line-through;",hide:!s||!l,onClick:zbt,text:"Impersonate"},{hide:!s||l,onClick:Gbt,text:"Impersonate"},{onClick:rne,text:"Create provider",hide:!s},{onClick:()=>oZe({callback:r}),text:"Edit provider",hide:!s},{onClick:Hbt,text:"Remove user",hide:!s},{onClick:()=>RE().then(({data:p})=>Fbt(n,p==null?void 0:p.providers),i),hide:!s&&!l,text:"Invite User"},{text:"Log out",hide:!a,onClick:bK},{hide:!o,divider:!0},{onClick:mit,heading:"Actions",hide:!o},{divider:!0},{onClick:HCe,heading:"Settings"}]})})}}/*!
 * EventEmitter v5.2.6 - git.io/ee
 * Unlicense - http://unlicense.org/
 * Oliver Caldwell - https://oli.me.uk/
 * @preserve
 */const qbt=function(){function t(){}let e=t.prototype;function i(a,s){let o=a.length;for(;o--;)if(a[o].listener===s)return o;return-1}function n(a){return function(){return this[a].apply(this,arguments)}}e.getListeners=function(s){let o=this._getEvents(),l,c;if(s instanceof RegExp){l={};for(c in o)o.hasOwnProperty(c)&&s.test(c)&&(l[c]=o[c])}else l=o[s]||(o[s]=[]);return l},e.flattenListeners=function(s){let o=[],l;for(l=0;l<s.length;l+=1)o.push(s[l].listener);return o},e.getListenersAsObject=function(s){let o=this.getListeners(s),l;return o instanceof Array&&(l={},l[s]=o),l||o};function r(a){return typeof a=="function"||a instanceof RegExp?!0:a&&typeof a=="object"?r(a.listener):!1}return e.addListener=function(s,o){if(!r(o))throw new TypeError("listener must be a function");let l=this.getListenersAsObject(s),c=typeof o=="object",u;for(u in l)l.hasOwnProperty(u)&&i(l[u],o)===-1&&l[u].push(c?o:{listener:o,once:!1});return this},e.on=n("addListener"),e.addOnceListener=function(s,o){return this.addListener(s,{listener:o,once:!0})},e.once=n("addOnceListener"),e.defineEvent=function(s){return this.getListeners(s),this},e.defineEvents=function(s){for(let o=0;o<s.length;o+=1)this.defineEvent(s[o]);return this},e.removeListener=function(s,o){let l=this.getListenersAsObject(s),c,u;for(u in l)l.hasOwnProperty(u)&&(c=i(l[u],o),c!==-1&&l[u].splice(c,1));return this},e.off=n("removeListener"),e.addListeners=function(s,o){return this.manipulateListeners(!1,s,o)},e.removeListeners=function(s,o){return this.manipulateListeners(!0,s,o)},e.manipulateListeners=function(s,o,l){let c,u,d=s?this.removeListener:this.addListener,p=s?this.removeListeners:this.addListeners;if(typeof o=="object"&&!(o instanceof RegExp))for(c in o)o.hasOwnProperty(c)&&(u=o[c])&&(typeof u=="function"?d.call(this,c,u):p.call(this,c,u));else for(c=l.length;c--;)d.call(this,o,l[c]);return this},e.removeEvent=function(s){let o=typeof s,l=this._getEvents(),c;if(o==="string")delete l[s];else if(s instanceof RegExp)for(c in l)l.hasOwnProperty(c)&&s.test(c)&&delete l[c];else delete this._events;return this},e.removeAllListeners=n("removeEvent"),e.emitEvent=function(s,o){let l=this.getListenersAsObject(s),c,u,d,p,h;for(p in l)if(l.hasOwnProperty(p))for(c=l[p].slice(0),d=0;d<c.length;d++)u=c[d],u.once===!0&&this.removeListener(s,u.listener),h=u.listener.apply(this,o||[]),h===this._getOnceReturnValue()&&this.removeListener(s,u.listener);return this},e.trigger=n("emitEvent"),e.emit=function(s){let o=Array.prototype.slice.call(arguments,1);return this.emitEvent(s,o)},e.setOnceReturnValue=function(s){return this._onceReturnValue=s,this},e._getOnceReturnValue=function(){return this.hasOwnProperty("_onceReturnValue")?this._onceReturnValue:!0},e._getEvents=function(){return this._events||(this._events={})},t}();function sne(){try{return window}catch{return}}const zCe=()=>sne().dev&&typeof sne().dev=="object";function Wbt(){document.oncontextmenu=()=>!1,window.addEventListener("contextmenu",t=>{t.preventDefault()},!1),window.packageEntry={updateReady:FBe},window.onunhandledrejection=t=>{if(zCe())return;t.preventDefault();const e=t.reason,i=e&&(e.stack||e);i&&i.indexOf("blocked")>0?($Be(),console.warn("popup blocked")):console.warn("Unhandled rejection:",e&&(e.stack||e))}}/*!
* tabbable 6.2.0
* @license MIT, https://github.com/focus-trap/tabbable/blob/master/LICENSE
*/var qCe=["input:not([inert])","select:not([inert])","textarea:not([inert])","a[href]:not([inert])","button:not([inert])","[tabindex]:not(slot):not([inert])","audio[controls]:not([inert])","video[controls]:not([inert])",'[contenteditable]:not([contenteditable="false"]):not([inert])',"details>summary:first-of-type:not([inert])","details:not([inert])"],Vk=qCe.join(","),WCe=typeof Element>"u",FI=WCe?function(){}:Element.prototype.matches||Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector,jk=!WCe&&Element.prototype.getRootNode?function(t){var e;return t==null||(e=t.getRootNode)===null||e===void 0?void 0:e.call(t)}:function(t){return t==null?void 0:t.ownerDocument},Gk=function t(e,i){var n;i===void 0&&(i=!0);var r=e==null||(n=e.getAttribute)===null||n===void 0?void 0:n.call(e,"inert"),a=r===""||r==="true",s=a||i&&e&&t(e.parentNode);return s},Ybt=function(e){var i,n=e==null||(i=e.getAttribute)===null||i===void 0?void 0:i.call(e,"contenteditable");return n===""||n==="true"},YCe=function(e,i,n){if(Gk(e))return[];var r=Array.prototype.slice.apply(e.querySelectorAll(Vk));return i&&FI.call(e,Vk)&&r.unshift(e),r=r.filter(n),r},KCe=function t(e,i,n){for(var r=[],a=Array.from(e);a.length;){var s=a.shift();if(!Gk(s,!1))if(s.tagName==="SLOT"){var o=s.assignedElements(),l=o.length?o:s.children,c=t(l,!0,n);n.flatten?r.push.apply(r,c):r.push({scopeParent:s,candidates:c})}else{var u=FI.call(s,Vk);u&&n.filter(s)&&(i||!e.includes(s))&&r.push(s);var d=s.shadowRoot||typeof n.getShadowRoot=="function"&&n.getShadowRoot(s),p=!Gk(d,!1)&&(!n.shadowRootFilter||n.shadowRootFilter(s));if(d&&p){var h=t(d===!0?s.children:d.children,!0,n);n.flatten?r.push.apply(r,h):r.push({scopeParent:s,candidates:h})}else a.unshift.apply(a,s.children)}}return r},ZCe=function(e){return!isNaN(parseInt(e.getAttribute("tabindex"),10))},Db=function(e){if(!e)throw new Error("No node provided");return e.tabIndex<0&&(/^(AUDIO|VIDEO|DETAILS)$/.test(e.tagName)||Ybt(e))&&!ZCe(e)?0:e.tabIndex},Kbt=function(e,i){var n=Db(e);return n<0&&i&&!ZCe(e)?0:n},Zbt=function(e,i){return e.tabIndex===i.tabIndex?e.documentOrder-i.documentOrder:e.tabIndex-i.tabIndex},XCe=function(e){return e.tagName==="INPUT"},Xbt=function(e){return XCe(e)&&e.type==="hidden"},Jbt=function(e){var i=e.tagName==="DETAILS"&&Array.prototype.slice.apply(e.children).some(function(n){return n.tagName==="SUMMARY"});return i},Qbt=function(e,i){for(var n=0;n<e.length;n++)if(e[n].checked&&e[n].form===i)return e[n]},eIt=function(e){if(!e.name)return!0;var i=e.form||jk(e),n=function(o){return i.querySelectorAll('input[type="radio"][name="'+o+'"]')},r;if(typeof window<"u"&&typeof window.CSS<"u"&&typeof window.CSS.escape=="function")r=n(window.CSS.escape(e.name));else try{r=n(e.name)}catch(s){return console.error("Looks like you have a radio button with a name attribute containing invalid CSS selector characters and need the CSS.escape polyfill: %s",s.message),!1}var a=Qbt(r,e.form);return!a||a===e},tIt=function(e){return XCe(e)&&e.type==="radio"},iIt=function(e){return tIt(e)&&!eIt(e)},nIt=function(e){var i,n=e&&jk(e),r=(i=n)===null||i===void 0?void 0:i.host,a=!1;if(n&&n!==e){var s,o,l;for(a=!!((s=r)!==null&&s!==void 0&&(o=s.ownerDocument)!==null&&o!==void 0&&o.contains(r)||e!=null&&(l=e.ownerDocument)!==null&&l!==void 0&&l.contains(e));!a&&r;){var c,u,d;n=jk(r),r=(c=n)===null||c===void 0?void 0:c.host,a=!!((u=r)!==null&&u!==void 0&&(d=u.ownerDocument)!==null&&d!==void 0&&d.contains(r))}}return a},one=function(e){var i=e.getBoundingClientRect(),n=i.width,r=i.height;return n===0&&r===0},rIt=function(e,i){var n=i.displayCheck,r=i.getShadowRoot;if(getComputedStyle(e).visibility==="hidden")return!0;var a=FI.call(e,"details>summary:first-of-type"),s=a?e.parentElement:e;if(FI.call(s,"details:not([open]) *"))return!0;if(!n||n==="full"||n==="legacy-full"){if(typeof r=="function"){for(var o=e;e;){var l=e.parentElement,c=jk(e);if(l&&!l.shadowRoot&&r(l)===!0)return one(e);e.assignedSlot?e=e.assignedSlot:!l&&c!==e.ownerDocument?e=c.host:e=l}e=o}if(nIt(e))return!e.getClientRects().length;if(n!=="legacy-full")return!0}else if(n==="non-zero-area")return one(e);return!1},aIt=function(e){if(/^(INPUT|BUTTON|SELECT|TEXTAREA)$/.test(e.tagName))for(var i=e.parentElement;i;){if(i.tagName==="FIELDSET"&&i.disabled){for(var n=0;n<i.children.length;n++){var r=i.children.item(n);if(r.tagName==="LEGEND")return FI.call(i,"fieldset[disabled] *")?!0:!r.contains(e)}return!0}i=i.parentElement}return!1},Hk=function(e,i){return!(i.disabled||Gk(i)||Xbt(i)||rIt(i,e)||Jbt(i)||aIt(i))},tz=function(e,i){return!(iIt(i)||Db(i)<0||!Hk(e,i))},sIt=function(e){var i=parseInt(e.getAttribute("tabindex"),10);return!!(isNaN(i)||i>=0)},oIt=function t(e){var i=[],n=[];return e.forEach(function(r,a){var s=!!r.scopeParent,o=s?r.scopeParent:r,l=Kbt(o,s),c=s?t(r.candidates):o;l===0?s?i.push.apply(i,c):i.push(o):n.push({documentOrder:a,tabIndex:l,item:r,isScope:s,content:c})}),n.sort(Zbt).reduce(function(r,a){return a.isScope?r.push.apply(r,a.content):r.push(a.content),r},[]).concat(i)},lIt=function(e,i){i=i||{};var n;return i.getShadowRoot?n=KCe([e],i.includeContainer,{filter:tz.bind(null,i),flatten:!1,getShadowRoot:i.getShadowRoot,shadowRootFilter:sIt}):n=YCe(e,i.includeContainer,tz.bind(null,i)),oIt(n)},cIt=function(e,i){i=i||{};var n;return i.getShadowRoot?n=KCe([e],i.includeContainer,{filter:Hk.bind(null,i),flatten:!0,getShadowRoot:i.getShadowRoot}):n=YCe(e,i.includeContainer,Hk.bind(null,i)),n},k0=function(e,i){if(i=i||{},!e)throw new Error("No node provided");return FI.call(e,Vk)===!1?!1:tz(i,e)},uIt=qCe.concat("iframe").join(","),rV=function(e,i){if(i=i||{},!e)throw new Error("No node provided");return FI.call(e,uIt)===!1?!1:Hk(i,e)};/*!
* focus-trap 7.5.4
* @license MIT, https://github.com/focus-trap/focus-trap/blob/master/LICENSE
*/function lne(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),i.push.apply(i,n)}return i}function cne(t){for(var e=1;e<arguments.length;e++){var i=arguments[e]!=null?arguments[e]:{};e%2?lne(Object(i),!0).forEach(function(n){dIt(t,n,i[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):lne(Object(i)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(i,n))})}return t}function dIt(t,e,i){return e=hIt(e),e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function pIt(t,e){if(typeof t!="object"||t===null)return t;var i=t[Symbol.toPrimitive];if(i!==void 0){var n=i.call(t,e||"default");if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function hIt(t){var e=pIt(t,"string");return typeof e=="symbol"?e:String(e)}var une={activateTrap:function(e,i){if(e.length>0){var n=e[e.length-1];n!==i&&n.pause()}var r=e.indexOf(i);r===-1||e.splice(r,1),e.push(i)},deactivateTrap:function(e,i){var n=e.indexOf(i);n!==-1&&e.splice(n,1),e.length>0&&e[e.length-1].unpause()}},fIt=function(e){return e.tagName&&e.tagName.toLowerCase()==="input"&&typeof e.select=="function"},mIt=function(e){return(e==null?void 0:e.key)==="Escape"||(e==null?void 0:e.key)==="Esc"||(e==null?void 0:e.keyCode)===27},xD=function(e){return(e==null?void 0:e.key)==="Tab"||(e==null?void 0:e.keyCode)===9},gIt=function(e){return xD(e)&&!e.shiftKey},vIt=function(e){return xD(e)&&e.shiftKey},dne=function(e){return setTimeout(e,0)},pne=function(e,i){var n=-1;return e.every(function(r,a){return i(r)?(n=a,!1):!0}),n},G1=function(e){for(var i=arguments.length,n=new Array(i>1?i-1:0),r=1;r<i;r++)n[r-1]=arguments[r];return typeof e=="function"?e.apply(void 0,n):e},RN=function(e){return e.target.shadowRoot&&typeof e.composedPath=="function"?e.composedPath()[0]:e.target},yIt=[],bIt=function(e,i){var n=document,r=yIt,a=cne({returnFocusOnDeactivate:!0,escapeDeactivates:!0,delayInitialFocus:!0,isKeyForward:gIt,isKeyBackward:vIt},i),s={containers:[],containerGroups:[],tabbableGroups:[],nodeFocusedBeforeActivation:null,mostRecentlyFocusedNode:null,active:!1,paused:!1,delayInitialFocusTimer:void 0,recentNavEvent:void 0},o,l=function(C,M,_){return C&&C[M]!==void 0?C[M]:a[_||M]},c=function(C,M){var _=typeof(M==null?void 0:M.composedPath)=="function"?M.composedPath():void 0;return s.containerGroups.findIndex(function(A){var N=A.container,k=A.tabbableNodes;return N.contains(C)||(_==null?void 0:_.includes(N))||k.find(function(O){return O===C})})},u=function(C){var M=a[C];if(typeof M=="function"){for(var _=arguments.length,A=new Array(_>1?_-1:0),N=1;N<_;N++)A[N-1]=arguments[N];M=M.apply(void 0,A)}if(M===!0&&(M=void 0),!M){if(M===void 0||M===!1)return M;throw new Error("`".concat(C,"` was specified but was not a node, or did not return a node"))}var k=M;if(typeof M=="string"&&(k=n.querySelector(M),!k))throw new Error("`".concat(C,"` as selector refers to no known node"));return k},d=function(){var C=u("initialFocus");if(C===!1)return!1;if(C===void 0||!rV(C,a.tabbableOptions))if(c(n.activeElement)>=0)C=n.activeElement;else{var M=s.tabbableGroups[0],_=M&&M.firstTabbableNode;C=_||u("fallbackFocus")}if(!C)throw new Error("Your focus-trap needs to have at least one focusable element");return C},p=function(){if(s.containerGroups=s.containers.map(function(C){var M=lIt(C,a.tabbableOptions),_=cIt(C,a.tabbableOptions),A=M.length>0?M[0]:void 0,N=M.length>0?M[M.length-1]:void 0,k=_.find(function(F){return k0(F)}),O=_.slice().reverse().find(function(F){return k0(F)}),$=!!M.find(function(F){return Db(F)>0});return{container:C,tabbableNodes:M,focusableNodes:_,posTabIndexesFound:$,firstTabbableNode:A,lastTabbableNode:N,firstDomTabbableNode:k,lastDomTabbableNode:O,nextTabbableNode:function(V){var j=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,B=M.indexOf(V);return B<0?j?_.slice(_.indexOf(V)+1).find(function(z){return k0(z)}):_.slice(0,_.indexOf(V)).reverse().find(function(z){return k0(z)}):M[B+(j?1:-1)]}}}),s.tabbableGroups=s.containerGroups.filter(function(C){return C.tabbableNodes.length>0}),s.tabbableGroups.length<=0&&!u("fallbackFocus"))throw new Error("Your focus-trap must have at least one container with at least one tabbable node in it at all times");if(s.containerGroups.find(function(C){return C.posTabIndexesFound})&&s.containerGroups.length>1)throw new Error("At least one node with a positive tabindex was found in one of your focus-trap's multiple containers. Positive tabindexes are only supported in single-container focus-traps.")},h=function R(C){var M=C.activeElement;if(M)return M.shadowRoot&&M.shadowRoot.activeElement!==null?R(M.shadowRoot):M},f=function R(C){if(C!==!1&&C!==h(document)){if(!C||!C.focus){R(d());return}C.focus({preventScroll:!!a.preventScroll}),s.mostRecentlyFocusedNode=C,fIt(C)&&C.select()}},m=function(C){var M=u("setReturnFocus",C);return M||(M===!1?!1:C)},g=function(C){var M=C.target,_=C.event,A=C.isBackward,N=A===void 0?!1:A;M=M||RN(_),p();var k=null;if(s.tabbableGroups.length>0){var O=c(M,_),$=O>=0?s.containerGroups[O]:void 0;if(O<0)N?k=s.tabbableGroups[s.tabbableGroups.length-1].lastTabbableNode:k=s.tabbableGroups[0].firstTabbableNode;else if(N){var F=pne(s.tabbableGroups,function(Z){var K=Z.firstTabbableNode;return M===K});if(F<0&&($.container===M||rV(M,a.tabbableOptions)&&!k0(M,a.tabbableOptions)&&!$.nextTabbableNode(M,!1))&&(F=O),F>=0){var V=F===0?s.tabbableGroups.length-1:F-1,j=s.tabbableGroups[V];k=Db(M)>=0?j.lastTabbableNode:j.lastDomTabbableNode}else xD(_)||(k=$.nextTabbableNode(M,!1))}else{var B=pne(s.tabbableGroups,function(Z){var K=Z.lastTabbableNode;return M===K});if(B<0&&($.container===M||rV(M,a.tabbableOptions)&&!k0(M,a.tabbableOptions)&&!$.nextTabbableNode(M))&&(B=O),B>=0){var z=B===s.tabbableGroups.length-1?0:B+1,W=s.tabbableGroups[z];k=Db(M)>=0?W.firstTabbableNode:W.firstDomTabbableNode}else xD(_)||(k=$.nextTabbableNode(M))}}else k=u("fallbackFocus");return k},v=function(C){var M=RN(C);if(!(c(M,C)>=0)){if(G1(a.clickOutsideDeactivates,C)){o.deactivate({returnFocus:a.returnFocusOnDeactivate});return}G1(a.allowOutsideClick,C)||C.preventDefault()}},y=function(C){var M=RN(C),_=c(M,C)>=0;if(_||M instanceof Document)_&&(s.mostRecentlyFocusedNode=M);else{C.stopImmediatePropagation();var A,N=!0;if(s.mostRecentlyFocusedNode)if(Db(s.mostRecentlyFocusedNode)>0){var k=c(s.mostRecentlyFocusedNode),O=s.containerGroups[k].tabbableNodes;if(O.length>0){var $=O.findIndex(function(F){return F===s.mostRecentlyFocusedNode});$>=0&&(a.isKeyForward(s.recentNavEvent)?$+1<O.length&&(A=O[$+1],N=!1):$-1>=0&&(A=O[$-1],N=!1))}}else s.containerGroups.some(function(F){return F.tabbableNodes.some(function(V){return Db(V)>0})})||(N=!1);else N=!1;N&&(A=g({target:s.mostRecentlyFocusedNode,isBackward:a.isKeyBackward(s.recentNavEvent)})),f(A||s.mostRecentlyFocusedNode||d())}s.recentNavEvent=void 0},b=function(C){var M=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;s.recentNavEvent=C;var _=g({event:C,isBackward:M});_&&(xD(C)&&C.preventDefault(),f(_))},I=function(C){if(mIt(C)&&G1(a.escapeDeactivates,C)!==!1){C.preventDefault(),o.deactivate();return}(a.isKeyForward(C)||a.isKeyBackward(C))&&b(C,a.isKeyBackward(C))},T=function(C){var M=RN(C);c(M,C)>=0||G1(a.clickOutsideDeactivates,C)||G1(a.allowOutsideClick,C)||(C.preventDefault(),C.stopImmediatePropagation())},w=function(){if(s.active)return une.activateTrap(r,o),s.delayInitialFocusTimer=a.delayInitialFocus?dne(function(){f(d())}):f(d()),n.addEventListener("focusin",y,!0),n.addEventListener("mousedown",v,{capture:!0,passive:!1}),n.addEventListener("touchstart",v,{capture:!0,passive:!1}),n.addEventListener("click",T,{capture:!0,passive:!1}),n.addEventListener("keydown",I,{capture:!0,passive:!1}),o},S=function(){if(s.active)return n.removeEventListener("focusin",y,!0),n.removeEventListener("mousedown",v,!0),n.removeEventListener("touchstart",v,!0),n.removeEventListener("click",T,!0),n.removeEventListener("keydown",I,!0),o},U=function(C){var M=C.some(function(_){var A=Array.from(_.removedNodes);return A.some(function(N){return N===s.mostRecentlyFocusedNode})});M&&f(d())},P=typeof window<"u"&&"MutationObserver"in window?new MutationObserver(U):void 0,E=function(){P&&(P.disconnect(),s.active&&!s.paused&&s.containers.map(function(C){P.observe(C,{subtree:!0,childList:!0})}))};return o={get active(){return s.active},get paused(){return s.paused},activate:function(C){if(s.active)return this;var M=l(C,"onActivate"),_=l(C,"onPostActivate"),A=l(C,"checkCanFocusTrap");A||p(),s.active=!0,s.paused=!1,s.nodeFocusedBeforeActivation=n.activeElement,M==null||M();var N=function(){A&&p(),w(),E(),_==null||_()};return A?(A(s.containers.concat()).then(N,N),this):(N(),this)},deactivate:function(C){if(!s.active)return this;var M=cne({onDeactivate:a.onDeactivate,onPostDeactivate:a.onPostDeactivate,checkCanReturnFocus:a.checkCanReturnFocus},C);clearTimeout(s.delayInitialFocusTimer),s.delayInitialFocusTimer=void 0,S(),s.active=!1,s.paused=!1,E(),une.deactivateTrap(r,o);var _=l(M,"onDeactivate"),A=l(M,"onPostDeactivate"),N=l(M,"checkCanReturnFocus"),k=l(M,"returnFocus","returnFocusOnDeactivate");_==null||_();var O=function(){dne(function(){k&&f(m(s.nodeFocusedBeforeActivation)),A==null||A()})};return k&&N?(N(m(s.nodeFocusedBeforeActivation)).then(O,O),this):(O(),this)},pause:function(C){if(s.paused||!s.active)return this;var M=l(C,"onPause"),_=l(C,"onPostPause");return s.paused=!0,M==null||M(),S(),E(),_==null||_(),this},unpause:function(C){if(!s.paused||!s.active)return this;var M=l(C,"onUnpause"),_=l(C,"onPostUnpause");return s.paused=!1,M==null||M(),p(),w(),E(),_==null||_(),this},updateContainerElements:function(C){var M=[].concat(C).filter(Boolean);return s.containers=M.map(function(_){return typeof _=="string"?n.querySelector(_):_}),s.active&&p(),E(),this}},o.updateContainerElements(e),o};const IIt=()=>{const t={selectorTrigger:"[data-drawer-trigger]",selectorTarget:"[data-drawer-target]",selectorClose:"[data-drawer-close]",leftAlignment:"drawer--left",visibleClass:"is-visible",activeClass:"is-active",speedClose:350,speedOpen:50},e={};let i=!1,n,r;const a=mfe;let s;const o=I=>r=I,l=()=>{Ot(r)&&r()&&(r=void 0);const I=document.getElementById(a);I.classList.remove(t.visibleClass),document.documentElement.style.overflow="",setTimeout(function(){n?(I.classList.add(t.visibleClass),document.documentElement.style.overflow="hidden",Ot(n==null?void 0:n.callback)&&n.callback()):(I.classList.remove(t.activeClass),i=!1),n=!1,s==null||s.deactivate()},t.speedClose)},c=I=>{const T=document.getElementById(a);T.classList.contains(t.leftAlignment)||T.classList.add(t.leftAlignment),m(T,!1,I)},u=I=>{const T=document.getElementById(a);T.classList.remove(t.leftAlignment),m(T,!1,I)},d=I=>{const w=document.getElementById(a).querySelector(".drawer__title");w&&(w.innerHTML=I)},p=I=>{const w=document.getElementById(a).querySelector(".drawer__footer");w&&(Ys(w),Ot(I)?e.footer=I(w,l):w.innerHTML=I||"")},h=I=>{const w=document.getElementById(a).querySelector(".drawer__content");w&&(Ys(w),Ot(I)?e.content=I(w,l):w.innerHTML=I)},f=I=>{const w=document.getElementById(a).querySelector(".drawer__wrapper");w.style.width=I},m=(I,T,w)=>{i=!0,I.classList.add(t.activeClass),document.documentElement.style.overflow="hidden",T&&(s=bIt(I),s.activate()),Ot(w)&&w(),setTimeout(function(){I.classList.add(t.visibleClass)},t.speedOpen)},g=({title:I,content:T,side:w,width:S,footer:U,callback:P,onClose:E}={})=>{if(T&&h(T),E&&o(E),I&&d(I),S&&f(S),p(U),i)n={callback:P};else if(w){if(w===oi)return u(P);if(w===pi)return c(P)}else{const R=document.getElementById(a);m(R,U,P)}},v=function(I,T){let w=T.parentNode;for(;w;){if(w===I)return!0;w=w.parentNode}return!1},y=function(I){const T=I.target,w=document.querySelector(".drawer__wrapper");(!v(w,T)||T.classList.contains("drawer__close"))&&l()},b=I=>{(I.key==="Escape"||I.keyCode===27)&&l()};return document.addEventListener("click",y,!1),document.addEventListener("keydown",b,!1),{settings:t,open:g,close:l,setTitle:d,setContent:h,setFooter:p,attributes:e}},hne=t=>/^(?=.*?[A-Z])(?=.*?[a-z])(?=.*?[0-9])(?=.*?[#?!@$%^&*-]).{8,12}$/.test(t);function wIt(t){let e;const i=o=>o===e.password.value,r=[{onInput:({inputs:o})=>{const l=document.getElementById("registerButton");l&&(i(o.passwordConfirm.value)&&hne(o.password.value)&&Wr(2)(o.givenName.value)&&Wr(2)(o.lastName.value)?l.removeAttribute("disabled"):l.setAttribute("disabled",""))},control:"passwordConfirm"}];er({title:"Register",content:o=>e=Sr(o,[{error:"First name must be at least 2 characters long",iconLeft:"fa-regular fa-user",validator:Wr(2),placeholder:"First name",autocomplete:"off",label:"First Name",field:"givenName"},{error:"Last name must be at least 2 characters long",validator:Wr(2),placeholder:"Last name",autocomplete:"off",label:"Last name",field:"lastName"},{error:"Must contain upper/lower, number, and special character",placeholder:"minimum 8 characters",iconLeft:"fa-solid fa-lock",validator:hne,autocomplete:"off",label:"Password",field:"password",type:"password"},{placeholder:"minimum 8 characters",error:"Passwords do not match",iconLeft:"fa-solid fa-lock",label:"Re-enter Password",validator:i,field:"passwordConfirm",autocomplete:"off",type:"password"}],r),buttons:[{label:"Cancel",intent:"none",close:!0},{onClick:()=>{var f;const o=e.lastName.value,l=e.givenName.value,c=e.password.value,u=(f=t==null?void 0:t.data)==null?void 0:f.inviteKey,d=()=>{Jt({message:"Success",intent:"is-success "})},p=m=>{Jt({message:m==null?void 0:m.message,intent:"is-danger"})},h=m=>{var g;(m==null?void 0:m.status)===200&&((g=m==null?void 0:m.data)!=null&&g.success)?d():p(m==null?void 0:m.data)};Lbt(l,o,c,u).then(h,p)},intent:"is-primary",id:"registerButton",label:"Register",disabled:!0,close:!0}],onClose:()=>It.router.navigate("/")})}function SIt(){const{tournamentRecord:t}=ot.getTournament();t&&(It.ee.emit(eDe,t.tournamentId),ot.reset())}function fne(){M2(),Ebt(),KBe(),SIt(),Q1e()}function La(){}const TIt=t=>t;function JCe(t){return t()}function mne(){return Object.create(null)}function wc(t){t.forEach(JCe)}function Dn(t){return typeof t=="function"}function Sc(t,e){return t!=t?e==e:t!==e||t&&typeof t=="object"||typeof t=="function"}function UIt(t){return Object.keys(t).length===0}function IK(t,...e){if(t==null){for(const n of e)n(void 0);return La}const i=t.subscribe(...e);return i.unsubscribe?()=>i.unsubscribe():i}function zk(t){let e;return IK(t,i=>e=i)(),e}function gt(t,e,i){t.$$.on_destroy.push(IK(e,i))}function Ur(t,e,i){return t.set(i),e}function Ry(t){return t&&Dn(t.destroy)?t.destroy:La}const DIt=typeof window<"u"?window:typeof globalThis<"u"?globalThis:global;function Hr(t,e){t.appendChild(e)}function Pr(t,e,i){t.insertBefore(e,i||null)}function Ir(t){t.parentNode&&t.parentNode.removeChild(t)}function e0(t,e){for(let i=0;i<t.length;i+=1)t[i]&&t[i].d(e)}function fr(t){return document.createElement(t)}function AM(t){return document.createTextNode(t)}function Wl(){return AM(" ")}function Lm(){return AM("")}function dr(t,e,i,n){return t.addEventListener(e,i,n),()=>t.removeEventListener(e,i,n)}function qk(t){return function(e){return e.stopPropagation(),t.call(this,e)}}function At(t,e,i){i==null?t.removeAttribute(e):t.getAttribute(e)!==i&&t.setAttribute(e,i)}function EIt(t){return Array.from(t.childNodes)}function QCe(t,e){e=""+e,t.data!==e&&(t.data=e)}function gne(t,e,i,n){i==null?t.style.removeProperty(e):t.style.setProperty(e,i,"")}function jT(t,e){return new t(e)}let EP;function OD(t){EP=t}function f1(){if(!EP)throw new Error("Function called outside component initialization");return EP}function PIt(t){f1().$$.before_update.push(t)}function CIt(t){f1().$$.on_mount.push(t)}function eRe(t){f1().$$.after_update.push(t)}function RIt(t,e){return f1().$$.context.set(t,e),e}function Hd(t){return f1().$$.context.get(t)}function r$(t,e){const i=t.$$.callbacks[e.type];i&&i.slice().forEach(n=>n.call(this,e))}const X0=[],mm=[];let DS=[];const vne=[],tRe=Promise.resolve();let iz=!1;function iRe(){iz||(iz=!0,tRe.then(nRe))}function a$(){return iRe(),tRe}function nz(t){DS.push(t)}const aV=new Set;let x0=0;function nRe(){if(x0!==0)return;const t=EP;do{try{for(;x0<X0.length;){const e=X0[x0];x0++,OD(e),MIt(e.$$)}}catch(e){throw X0.length=0,x0=0,e}for(OD(null),X0.length=0,x0=0;mm.length;)mm.pop()();for(let e=0;e<DS.length;e+=1){const i=DS[e];aV.has(i)||(aV.add(i),i())}DS.length=0}while(X0.length);for(;vne.length;)vne.pop()();iz=!1,aV.clear(),OD(t)}function MIt(t){if(t.fragment!==null){t.update(),wc(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(nz)}}function NIt(t){const e=[],i=[];DS.forEach(n=>t.indexOf(n)===-1?e.push(n):i.push(n)),i.forEach(n=>n()),DS=e}const MA=new Set;let Ab;function Kl(){Ab={r:0,c:[],p:Ab}}function Zl(){Ab.r||wc(Ab.c),Ab=Ab.p}function Oi(t,e){t&&t.i&&(MA.delete(t),t.i(e))}function vn(t,e,i,n){if(t&&t.o){if(MA.has(t))return;MA.add(t),Ab.c.push(()=>{MA.delete(t),n&&(i&&t.d(1),n())}),t.o(e)}else n&&n()}function ao(t){return(t==null?void 0:t.length)!==void 0?t:Array.from(t)}function rz(t,e){vn(t,1,1,()=>{e.delete(t.key)})}function az(t,e,i,n,r,a,s,o,l,c,u,d){let p=t.length,h=a.length,f=p;const m={};for(;f--;)m[t[f].key]=f;const g=[],v=new Map,y=new Map,b=[];for(f=h;f--;){const S=d(r,a,f),U=i(S);let P=s.get(U);P?b.push(()=>P.p(S,e)):(P=c(U,S),P.c()),v.set(U,g[f]=P),U in m&&y.set(U,Math.abs(f-m[U]))}const I=new Set,T=new Set;function w(S){Oi(S,1),S.m(o,u),s.set(S.key,S),u=S.first,h--}for(;p&&h;){const S=g[h-1],U=t[p-1],P=S.key,E=U.key;S===U?(u=S.first,p--,h--):v.has(E)?!s.has(P)||I.has(P)?w(S):T.has(E)?p--:y.get(P)>y.get(E)?(T.add(P),w(S)):(I.add(E),p--):(l(U,s),p--)}for(;p--;){const S=t[p];v.has(S.key)||l(S,s)}for(;h;)w(g[h-1]);return wc(b),g}function Ns(t){t&&t.c()}function fs(t,e,i){const{fragment:n,after_update:r}=t.$$;n&&n.m(e,i),nz(()=>{const a=t.$$.on_mount.map(JCe).filter(Dn);t.$$.on_destroy?t.$$.on_destroy.push(...a):wc(a),t.$$.on_mount=[]}),r.forEach(nz)}function rs(t,e){const i=t.$$;i.fragment!==null&&(NIt(i.after_update),wc(i.on_destroy),i.fragment&&i.fragment.d(e),i.on_destroy=i.fragment=null,i.ctx=[])}function AIt(t,e){t.$$.dirty[0]===-1&&(X0.push(t),iRe(),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function uu(t,e,i,n,r,a,s=null,o=[-1]){const l=EP;OD(t);const c=t.$$={fragment:null,ctx:[],props:a,update:La,not_equal:r,bound:mne(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(l?l.$$.context:[])),callbacks:mne(),dirty:o,skip_bound:!1,root:e.target||l.$$.root};s&&s(c.root);let u=!1;if(c.ctx=i?i(t,e.props||{},(d,p,...h)=>{const f=h.length?h[0]:p;return c.ctx&&r(c.ctx[d],c.ctx[d]=f)&&(!c.skip_bound&&c.bound[d]&&c.bound[d](f),u&&AIt(t,d)),p}):[],c.update(),u=!0,wc(c.before_update),c.fragment=n?n(c.ctx):!1,e.target){if(e.hydrate){const d=EIt(e.target);c.fragment&&c.fragment.l(d),d.forEach(Ir)}else c.fragment&&c.fragment.c();e.intro&&Oi(t.$$.fragment),fs(t,e.target,e.anchor),nRe()}OD(l)}class du{constructor(){et(this,"$$");et(this,"$$set")}$destroy(){rs(this,1),this.$destroy=La}$on(e,i){if(!Dn(i))return La;const n=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return n.push(i),()=>{const r=n.indexOf(i);r!==-1&&n.splice(r,1)}}$set(e){this.$$set&&!UIt(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}const O0=[];function rRe(t,e){return{subscribe:Qo(t,e).subscribe}}function Qo(t,e=La){let i;const n=new Set;function r(o){if(Sc(t,o)&&(t=o,i)){const l=!O0.length;for(const c of n)c[1](),O0.push(c,t);if(l){for(let c=0;c<O0.length;c+=2)O0[c][0](O0[c+1]);O0.length=0}}}function a(o){r(o(t))}function s(o,l=La){const c=[o,l];return n.add(c),n.size===1&&(i=e(r,a)||La),o(t),()=>{n.delete(c),n.size===0&&i&&(i(),i=null)}}return{set:r,update:a,subscribe:s}}function cf(t,e,i){const n=!Array.isArray(t),r=n?[t]:t;if(!r.every(Boolean))throw new Error("derived() expects stores as input, got a falsy value");const a=e.length<2;return rRe(i,(s,o)=>{let l=!1;const c=[];let u=0,d=La;const p=()=>{if(u)return;d();const f=e(n?c[0]:c,s,o);a?s(f):d=Dn(f)?f:La},h=r.map((f,m)=>IK(f,g=>{c[m]=g,u&=~(1<<m),l&&p()},()=>{u|=1<<m}));return l=!0,p(),function(){wc(h),d(),l=!1}})}function Wk(t){return function(e){return e.key==="Enter"||e.key===" "&&!e.preventDefault()?t.call(this,e):void 0}}function t0(t,e){let i={update(n){typeof n=="string"?t.innerText=n:n!=null&&n.domNodes?t.replaceChildren(...n.domNodes):n!=null&&n.html&&(t.innerHTML=n.html)}};return i.update(e),i}function _It(t,e){const i=n=>{t&&!t.contains(n.target)&&t.dispatchEvent(new CustomEvent(e+"outside",{detail:{jsEvent:n}}))};return document.addEventListener(e,i,!0),{destroy(){document.removeEventListener(e,i,!0)}}}const kIt=86400;function $I(t=void 0){return t!==void 0?t instanceof Date?bne(t):LIt(t):bne(new Date)}function kv(t){if(typeof t=="number")t={seconds:t};else if(typeof t=="string"){let i=0,n=2;for(let r of t.split(":",3))i+=parseInt(r,10)*Math.pow(60,n--);t={seconds:i}}else t instanceof Date&&(t={hours:t.getUTCHours(),minutes:t.getUTCMinutes(),seconds:t.getUTCSeconds()});let e=t.weeks||t.week||0;return{years:t.years||t.year||0,months:t.months||t.month||0,days:e*7+(t.days||t.day||0),seconds:(t.hours||t.hour||0)*60*60+(t.minutes||t.minute||0)*60+(t.seconds||t.second||0),inWeeks:!!e}}function ma(t){return new Date(t.getTime())}function eg(t,e,i=1){t.setUTCFullYear(t.getUTCFullYear()+i*e.years);let n=t.getUTCMonth()+i*e.months;for(t.setUTCMonth(n),n%=12,n<0&&(n+=12);t.getUTCMonth()!==n;)GT(t);return t.setUTCDate(t.getUTCDate()+i*e.days),t.setUTCSeconds(t.getUTCSeconds()+i*e.seconds),t}function aRe(t,e,i=1){return eg(t,e,-i)}function gm(t,e=1){return t.setUTCDate(t.getUTCDate()+e),t}function GT(t,e=1){return gm(t,-e)}function vm(t){return t.setUTCHours(0,0,0,0),t}function Vc(t){return new Date(t.getUTCFullYear(),t.getUTCMonth(),t.getUTCDate(),t.getUTCHours(),t.getUTCMinutes(),t.getUTCSeconds())}function Tp(t,e=19){return t.toISOString().substring(0,e)}function cp(t,...e){return e.every(i=>t.getTime()===i.getTime())}function xIt(t,e){let i=e-t.getUTCDay();return t.setUTCDate(t.getUTCDate()+(i>=0?i:i+7)),t}function sRe(t,e){let i=e-t.getUTCDay();return t.setUTCDate(t.getUTCDate()+(i<=0?i:i-7)),t}function yne(t){return typeof t=="string"&&t.length<=10}function OIt(t,e){return t.setUTCHours(e.getUTCHours(),e.getUTCMinutes(),e.getUTCSeconds(),0),t}function oRe(t,e){return eg(t,e),t}function lRe(t,e,i){if(aRe(t,e),i.length&&i.length<7)for(;i.includes(t.getUTCDay());)GT(t);return t}function bne(t){return new Date(Date.UTC(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours(),t.getMinutes(),t.getSeconds()))}function LIt(t){const e=t.match(/\d+/g);return new Date(Date.UTC(Number(e[0]),Number(e[1])-1,Number(e[2]),Number(e[3]||0),Number(e[4]||0),Number(e[5]||0)))}function wK(t,e,i){i.update(n=>n.set(e,t))}function Ine(t){wc(t),t.clear()}function cRe(t,e,i){e??(e=t),i.has(e)||i.set(e,setTimeout(()=>{i.delete(e),t()}))}function i0(...t){return Object.assign(...t)}function bh(t){return Object.keys(t)}function J0(...t){return Math.min(...t)}function Eb(...t){return Math.max(...t)}function FIt(){return Symbol("ec")}function uRe(t){return Array.isArray(t)}function dRe(t,e,i,n=[]){let r=document.createElement(t);r.className=e,typeof i=="string"?r.innerText=i:i.domNodes?r.replaceChildren(...i.domNodes):i.html&&(r.innerHTML=i.html);for(let a of n)r.setAttribute(...a);return r}function $It(t){return t.scrollHeight>t.clientHeight}function Kv(t){return t.getBoundingClientRect()}function HT(t,e){for(;e--;)t=t.parentElement;return t}function MN(t){return Kv(t).height}let SK=FIt();function BIt(t,e){t[SK]=e}function VIt(t){return!!(t!=null&&t[SK])}function LD(t){return t[SK]}function ES(t,e,i=document){for(let n of i.elementsFromPoint(t,e)){if(VIt(n))return n;if(n.shadowRoot){let r=ES(t,e,n.shadowRoot);if(r)return r}}return null}function jIt(t,e,i,n){return{type:t,title:e,currentStart:i.start,currentEnd:i.end,activeStart:n.start,activeEnd:n.end,calendar:void 0}}function md(t){return t=i0({},t),t.currentStart=Vc(t.currentStart),t.currentEnd=Vc(t.currentEnd),t.activeStart=Vc(t.activeStart),t.activeEnd=Vc(t.activeEnd),t}function sz(t){return t.startsWith("list")}function sV(t){return t.includes("Timeline")}let GIt=1;function Yk(t){return t.map(e=>{let i={id:"id"in e?String(e.id):`{generated-${GIt++}}`,resourceIds:oV(e,"resourceId").map(String),allDay:e.allDay??(yne(e.start)&&yne(e.end)),start:$I(e.start),end:$I(e.end),title:e.title??"",editable:e.editable,startEditable:e.startEditable,durationEditable:e.durationEditable,display:e.display??"auto",extendedProps:e.extendedProps??{},backgroundColor:e.backgroundColor??e.color,textColor:e.textColor,classNames:oV(e,"className"),styles:oV(e,"style")};if(i.allDay){vm(i.start);let n=ma(i.end);vm(i.end),(!cp(i.end,n)||cp(i.end,i.start))&&gm(i.end)}return i})}function oV(t,e){let i=t[e+"s"]??t[e]??[];return uRe(i)?i:[i]}function HIt(t){return t.map(e=>({events:e.events,url:e.url&&e.url.trimEnd("&")||"",method:e.method&&e.method.toUpperCase()||"GET",extraParams:e.extraParams||{}}))}function oz(t,e,i){return{start:t.start>e?t.start:e,end:t.end<i?t.end:i,event:t}}function zIt(t){t.sort((e,i)=>e.start-i.start||i.event.allDay-e.event.allDay)}function qIt(t,e,i,n,r,a){let s=r.formatRange(t.start,e&&t.event.display!=="pointer"?OIt(ma(t.start),t.end):t.start),o;if(i&&(o=Dn(i)?i({event:gh(t.event),timeText:s,view:md(a)}):i),o===void 0){let l;switch(t.event.display){case"background":l=[];break;case"pointer":l=[wne(s,t,n)];break;default:l=[...t.event.allDay?[]:[wne(s,t,n)],dRe("h4",n.eventTitle,t.event.title)]}o={domNodes:l}}return[s,o]}function wne(t,e,i){return dRe("time",i.eventTime,t,[["datetime",Tp(e.start)]])}function WIt(t,e,i){let n=e.classNames;return t&&(Dn(t)&&(t=t({event:gh(e),view:md(i)})),n=[...uRe(t)?t:[t],...n]),n}function gh(t){return pRe(t,Vc)}function Sne(t){return pRe(t,ma)}function pRe(t,e){return t=i0({},t),t.start=e(t.start),t.end=e(t.end),t}function lV(t,e){let i={};if(t.length){zIt(t);let n;for(let r of t){let a=[],s=vm(ma(r.start));for(;r.end>s;){if(!e.includes(s.getUTCDay())&&(a.push(ma(s)),a.length>1)){let o=s.getTime();i[o]?i[o].chunks.push(r):i[o]={sorted:!1,chunks:[r]}}gm(s)}if(a.length){r.date=a[0],r.days=a.length,r.dates=a,r.start<a[0]&&(r.start=a[0]);let o=gm(ma(a.at(-1)));r.end>o&&(r.end=o)}else r.date=vm(ma(r.start)),r.days=1,r.dates=[r.date];n&&cp(n.date,r.date)&&(r.prev=n),n=r}}return i}function YIt(t,e,i){t.top=0,t.prev&&(t.top=t.prev.bottom+1),t.bottom=t.top+i;let n=1,r=t.date.getTime();if(e[r]){e[r].sorted||(e[r].chunks.sort((a,s)=>a.top-s.top),e[r].sorted=!0);for(let a of e[r].chunks)if(t.top<a.bottom&&t.bottom>a.top){let s=a.bottom-t.top+1;n+=s,t.top+=s,t.bottom+=s}}return n}function hRe(t,e){var n;t.length=e.length;let i=[];for(let r of t)i.push((n=r==null?void 0:r.reposition)==null?void 0:n.call(r));return i}function Tne(t,e,i,n){return t.start<i&&t.end>e&&n===void 0}function zT(t){return KIt(t)||ZIt(t)||XIt(t)}function PP(t){return t==="background"}function KIt(t){return t==="preview"}function ZIt(t){return t==="ghost"}function XIt(t){return t==="pointer"}function JIt(t){return QIt(t,"month")}function QIt(t,e){return{...t,next:"Next "+e,prev:"Previous "+e}}function ewt(t){return e=>({...e,view:t})}function twt(t){return t.map(e=>({id:String(e.id),title:e.title||"",eventBackgroundColor:e.eventBackgroundColor,eventTextColor:e.eventTextColor}))}function iwt(t,e){var i;return(i=fRe(t,e))==null?void 0:i.eventBackgroundColor}function nwt(t,e){var i;return(i=fRe(t,e))==null?void 0:i.eventTextColor}function fRe(t,e){return e.find(i=>t.resourceIds.includes(i.id))}function FD(t,e){return cf([t,e],([i,n])=>{let r=Dn(n)?{format:n}:new Intl.DateTimeFormat(i,n);return{format:a=>r.format(Vc(a))}})}function Une(t,e){return cf([t,e],([i,n])=>{let r;if(Dn(n))r=n;else{let a=new Intl.DateTimeFormat(i,n);r=(s,o)=>{if(s<=o)return a.formatRange(s,o);{let l=a.formatRangeToParts(o,s),c="",u=["startRange","endRange"],d=[!1,!1];for(let p of l){let h=u.indexOf(p.source);h>=0?d[h]||(c+=rwt(u[1-h],l),d[h]=!0):c+=p.value}return c}}}return{formatRange:(a,s)=>r(Vc(a),Vc(s))}})}function rwt(t,e){let i="";for(let n of e)n.source==t&&(i+=n.value);return i}function awt(t){var i;let e={allDayContent:void 0,allDaySlot:!0,buttonText:{today:"today"},customButtons:{},date:new Date,datesSet:void 0,dayHeaderFormat:{weekday:"short",month:"numeric",day:"numeric"},dayHeaderAriaLabelFormat:{dateStyle:"full"},displayEventEnd:!0,duration:{weeks:1},events:[],eventAllUpdated:void 0,eventBackgroundColor:void 0,eventTextColor:void 0,eventClassNames:void 0,eventClick:void 0,eventColor:void 0,eventContent:void 0,eventDidMount:void 0,eventMouseEnter:void 0,eventMouseLeave:void 0,eventSources:[],eventTimeFormat:{hour:"numeric",minute:"2-digit"},filterResourcesWithEvents:!1,firstDay:0,flexibleSlotTimeLimits:!1,headerToolbar:{start:"title",center:"",end:"today prev,next"},height:void 0,hiddenDays:[],highlightedDates:[],lazyFetching:!0,loading:void 0,locale:void 0,nowIndicator:!1,resourceLabelContent:void 0,resourceLabelDidMount:void 0,resources:[],selectable:!1,scrollTime:"06:00:00",slotDuration:"00:30:00",slotEventOverlap:!0,slotHeight:24,slotLabelFormat:{hour:"numeric",minute:"2-digit"},slotMaxTime:"24:00:00",slotMinTime:"00:00:00",slotWidth:72,theme:{allDay:"ec-all-day",active:"ec-active",bgEvent:"ec-bg-event",bgEvents:"ec-bg-events",body:"ec-body",button:"ec-button",buttonGroup:"ec-button-group",calendar:"ec",compact:"ec-compact",content:"ec-content",day:"ec-day",dayHead:"ec-day-head",days:"ec-days",event:"ec-event",eventBody:"ec-event-body",eventTime:"ec-event-time",eventTitle:"ec-event-title",events:"ec-events",extra:"ec-extra",handle:"ec-handle",header:"ec-header",hiddenScroll:"ec-hidden-scroll",highlight:"ec-highlight",icon:"ec-icon",line:"ec-line",lines:"ec-lines",nowIndicator:"ec-now-indicator",otherMonth:"ec-other-month",resource:"ec-resource",sidebar:"ec-sidebar",sidebarTitle:"ec-sidebar-title",today:"ec-today",time:"ec-time",title:"ec-title",toolbar:"ec-toolbar",view:"",weekdays:["ec-sun","ec-mon","ec-tue","ec-wed","ec-thu","ec-fri","ec-sat"],withScroll:"ec-with-scroll"},titleFormat:{year:"numeric",month:"short",day:"numeric"},view:void 0,viewDidMount:void 0,views:{}};for(let n of t)(i=n.createOptions)==null||i.call(n,e);return e}function swt(t){var i;let e={date:n=>vm($I(n)),duration:kv,events:Yk,eventSources:HIt,hiddenDays:n=>[...new Set(n)],highlightedDates:n=>n.map(r=>vm($I(r))),resources:twt,scrollTime:kv,slotDuration:kv,slotMaxTime:kv,slotMinTime:kv};for(let n of t)(i=n.createParsers)==null||i.call(n,e);return e}function owt(t,e){let i=[];for(let n of bh(t))t[n]!==e[n]&&i.push([n,t[n]]);return i0(e,t),i}function lwt(t){return cf(t.view,e=>e==null?void 0:e.startsWith("dayGrid"))}function cwt(t){return cf([t._currentRange,t.firstDay,t.slotMaxTime,t._dayGrid],([e,i,n,r])=>{let a=ma(e.start),s=ma(e.end);if(r)sRe(a,i),xIt(s,i);else if(n.days||n.seconds>kIt){eg(GT(s),n);let o=GT(ma(s));o<a&&(a=o)}return{start:a,end:s}})}function uwt(t){return cf([t.date,t.duration,t.firstDay],([e,i,n])=>{let r=ma(e),a;return i.months?r.setUTCDate(1):i.inWeeks&&sRe(r,n),a=eg(ma(r),i),{start:r,end:a}})}function dwt(t){return cf([t._activeRange,t.hiddenDays],([e,i])=>{let n=[],r=vm(ma(e.start)),a=vm(ma(e.end));for(;r<a;)i.includes(r.getUTCDay())||n.push(ma(r)),gm(r);return!n.length&&i.length&&i.length<7&&(t.date.update(s=>{for(;i.includes(s.getUTCDay());)gm(s);return s}),n=zk(t._viewDates)),n})}function pwt(t){return cf([t.date,t._activeRange,t._intlTitle,t._dayGrid],([e,i,n,r])=>r?n.formatRange(e,e):n.formatRange(i.start,GT(ma(i.end))))}function hwt(t){return cf([t.view,t._viewTitle,t._currentRange,t._activeRange],e=>jIt(...e))}function fwt(t){let e=Qo([]),i,n=0,r={};return cf([t.events,t.eventSources,t._activeRange,t._fetchedRange,t.lazyFetching,t.loading],(a,s)=>wK(()=>{let[o,l,c,u,d,p]=a;if(!l.length){s(o);return}if(!u.start||u.start>c.start||u.end<c.end||!d){i&&i.abort(),i=new AbortController,Dn(p)&&!n&&p(!0);let h=()=>{--n===0&&Dn(p)&&p(!1)},f=[],m=b=>h(),g=b=>{f=f.concat(Yk(b)),s(f),h()},v=Tp(c.start),y=Tp(c.end);for(let b of l){if(Dn(b.events)){let I=b.events({start:Vc(c.start),end:Vc(c.end),startStr:v,endStr:y},g,m);I!==void 0&&Promise.resolve(I).then(g,m)}else{let I=Dn(b.extraParams)?b.extraParams():i0({},b.extraParams);I.start=v,I.end=y,I=new URLSearchParams(I);let T=b.url,w={},S;["GET","HEAD"].includes(b.method)?T+=(T.includes("?")?"&":"?")+I:(w["content-type"]="application/x-www-form-urlencoded;charset=UTF-8",S=String(I)),fetch(T,{method:b.method,headers:w,body:S,signal:i.signal,credentials:"same-origin"}).then(U=>U.json()).then(g).catch(m)}++n}u.start=c.start,u.end=c.end}},r,t._queue),[]).subscribe(e.set),e}function mwt(){return rRe($I(),t=>{let e=setInterval(()=>{t($I())},1e3);return()=>clearInterval(e)})}function gwt(t){return cf(t._now,e=>vm(ma(e)))}class vwt{constructor(e,i){var s,o;e=e||[];let n=awt(e),r=swt(e);n=lz(n,r),i=lz(i,r);for(let[l,c]of Object.entries(n))this[l]=Qo(c);this._queue=Qo(new Map),this._queue2=Qo(new Map),this._tasks=new Map,this._auxiliary=Qo([]),this._dayGrid=lwt(this),this._currentRange=uwt(this),this._activeRange=cwt(this),this._fetchedRange=Qo({start:void 0,end:void 0}),this._events=fwt(this),this._now=mwt(),this._today=gwt(this),this._intlEventTime=Une(this.locale,this.eventTimeFormat),this._intlSlotLabel=FD(this.locale,this.slotLabelFormat),this._intlDayHeader=FD(this.locale,this.dayHeaderFormat),this._intlDayHeaderAL=FD(this.locale,this.dayHeaderAriaLabelFormat),this._intlTitle=Une(this.locale,this.titleFormat),this._bodyEl=Qo(void 0),this._scrollable=Qo(!1),this._viewTitle=pwt(this),this._viewDates=dwt(this),this._view=hwt(this),this._viewComponent=Qo(void 0),this._interaction=Qo({}),this._iEvents=Qo([null,null]),this._iClasses=Qo(TIt),this._iClass=Qo(void 0),this._set=(l,c)=>{cz(l,this)&&(r[l]&&(c=r[l](c)),this[l].set(c))},this._get=l=>cz(l,this)?zk(this[l]):void 0;for(let l of e)(s=l.createStores)==null||s.call(l,this);i.view&&this.view.set(i.view);let a=new Set([...bh(n.views),...bh(i.views??{})]);for(let l of a){let c=Dne(n,n.views[l]??{}),u=Dne(c,i,((o=i.views)==null?void 0:o[l])??{}),d=u.component;ywt(u,this);for(let p of bh(u)){let{set:h,_set:f=h,...m}=this[p];this[p]={set:["buttonText","theme"].includes(p)?g=>{if(Dn(g)){let v=g(c[p]);u[p]=v,h(h===f?v:g)}else u[p]=g,h(g)}:g=>{u[p]=g,h(g)},_set:f,...m}}this.view.subscribe(p=>{if(p===l){this._viewComponent.set(d),Dn(u.viewDidMount)&&a$().then(()=>u.viewDidMount(zk(this._view)));for(let h of bh(u))this[h]._set(u[h])}})}}}function lz(t,e){let i={...t};for(let n of bh(e))n in i&&(i[n]=e[n](i[n]));if(t.views){i.views={};for(let n of bh(t.views))i.views[n]=lz(t.views[n],e)}return i}function Dne(...t){let e={};for(let i of t){let n={};for(let r of["buttonText","theme"])Dn(i[r])&&(n[r]=i[r](e[r]));e={...e,...i,...n}}return e}function ywt(t,e){bh(t).filter(i=>!cz(i,e)||i=="view").forEach(i=>delete t[i])}function cz(t,e){return e.hasOwnProperty(t)&&t[0]!=="_"}function Ene(t,e,i){const n=t.slice();return n[25]=e[i],n}function bwt(t){let e,i=t[5][t[25]]+"",n,r,a,s;function o(){return t[22](t[25])}return{c(){e=fr("button"),n=AM(i),At(e,"class",r=t[3].button+(t[7]===t[25]?" "+t[3].active:"")+" ec-"+t[25])},m(l,c){Pr(l,e,c),Hr(e,n),a||(s=dr(e,"click",o),a=!0)},p(l,c){t=l,c&33&&i!==(i=t[5][t[25]]+"")&&QCe(n,i),c&137&&r!==(r=t[3].button+(t[7]===t[25]?" "+t[3].active:"")+" ec-"+t[25])&&At(e,"class",r)},d(l){l&&Ir(e),a=!1,s()}}}function Iwt(t){let e,i,n,r,a;return{c(){e=fr("button"),At(e,"class",i=t[3].button+" ec-"+t[25]+(t[6][t[25]].active?" "+t[3].active:""))},m(s,o){Pr(s,e,o),r||(a=[dr(e,"click",function(){Dn(t[6][t[25]].click)&&t[6][t[25]].click.apply(this,arguments)}),Ry(n=t0.call(null,e,t[6][t[25]].text))],r=!0)},p(s,o){t=s,o&73&&i!==(i=t[3].button+" ec-"+t[25]+(t[6][t[25]].active?" "+t[3].active:""))&&At(e,"class",i),n&&Dn(n.update)&&o&65&&n.update.call(null,t[6][t[25]].text)},d(s){s&&Ir(e),r=!1,wc(a)}}}function wwt(t){let e,i=t[5][t[25]]+"",n,r,a,s;return{c(){e=fr("button"),n=AM(i),At(e,"class",r=t[3].button+" ec-"+t[25]),e.disabled=t[1]},m(o,l){Pr(o,e,l),Hr(e,n),a||(s=dr(e,"click",t[21]),a=!0)},p(o,l){l&33&&i!==(i=o[5][o[25]]+"")&&QCe(n,i),l&9&&r!==(r=o[3].button+" ec-"+o[25])&&At(e,"class",r),l&2&&(e.disabled=o[1])},d(o){o&&Ir(e),a=!1,s()}}}function Swt(t){let e,i,n,r,a,s,o,l;return{c(){e=fr("button"),i=fr("i"),At(i,"class",n=t[3].icon+" ec-"+t[25]),At(e,"class",r=t[3].button+" ec-"+t[25]),At(e,"aria-label",a=t[5].next),At(e,"title",s=t[5].next)},m(c,u){Pr(c,e,u),Hr(e,i),o||(l=dr(e,"click",t[19]),o=!0)},p(c,u){u&9&&n!==(n=c[3].icon+" ec-"+c[25])&&At(i,"class",n),u&9&&r!==(r=c[3].button+" ec-"+c[25])&&At(e,"class",r),u&32&&a!==(a=c[5].next)&&At(e,"aria-label",a),u&32&&s!==(s=c[5].next)&&At(e,"title",s)},d(c){c&&Ir(e),o=!1,l()}}}function Twt(t){let e,i,n,r,a,s,o,l;return{c(){e=fr("button"),i=fr("i"),At(i,"class",n=t[3].icon+" ec-"+t[25]),At(e,"class",r=t[3].button+" ec-"+t[25]),At(e,"aria-label",a=t[5].prev),At(e,"title",s=t[5].prev)},m(c,u){Pr(c,e,u),Hr(e,i),o||(l=dr(e,"click",t[18]),o=!0)},p(c,u){u&9&&n!==(n=c[3].icon+" ec-"+c[25])&&At(i,"class",n),u&9&&r!==(r=c[3].button+" ec-"+c[25])&&At(e,"class",r),u&32&&a!==(a=c[5].prev)&&At(e,"aria-label",a),u&32&&s!==(s=c[5].prev)&&At(e,"title",s)},d(c){c&&Ir(e),o=!1,l()}}}function Uwt(t){let e,i,n,r,a;return{c(){e=fr("h2"),At(e,"class",i=t[3].title)},m(s,o){Pr(s,e,o),r||(a=Ry(n=t0.call(null,e,t[4])),r=!0)},p(s,o){o&8&&i!==(i=s[3].title)&&At(e,"class",i),n&&Dn(n.update)&&o&16&&n.update.call(null,s[4])},d(s){s&&Ir(e),r=!1,a()}}}function Pne(t){let e;function i(a,s){if(a[25]=="title")return Uwt;if(a[25]=="prev")return Twt;if(a[25]=="next")return Swt;if(a[25]=="today")return wwt;if(a[6][a[25]])return Iwt;if(a[25]!="")return bwt}let n=i(t),r=n&&n(t);return{c(){r&&r.c(),e=Lm()},m(a,s){r&&r.m(a,s),Pr(a,e,s)},p(a,s){n===(n=i(a))&&r?r.p(a,s):(r&&r.d(1),r=n&&n(a),r&&(r.c(),r.m(e.parentNode,e)))},d(a){a&&Ir(e),r&&r.d(a)}}}function Dwt(t){let e,i=ao(t[0]),n=[];for(let r=0;r<i.length;r+=1)n[r]=Pne(Ene(t,i,r));return{c(){for(let r=0;r<n.length;r+=1)n[r].c();e=Lm()},m(r,a){for(let s=0;s<n.length;s+=1)n[s]&&n[s].m(r,a);Pr(r,e,a)},p(r,[a]){if(a&917759){i=ao(r[0]);let s;for(s=0;s<i.length;s+=1){const o=Ene(r,i,s);n[s]?n[s].p(o,a):(n[s]=Pne(o),n[s].c(),n[s].m(e.parentNode,e))}for(;s<n.length;s+=1)n[s].d(1);n.length=i.length}},i:La,o:La,d(r){r&&Ir(e),e0(n,r)}}}function Ewt(t,e,i){let n,r,a,s,o,l,c,u,d,{buttons:p}=e,{_currentRange:h,_viewTitle:f,buttonText:m,customButtons:g,date:v,duration:y,hiddenDays:b,theme:I,view:T}=Hd("state");gt(t,h,C=>i(20,s=C)),gt(t,f,C=>i(4,l=C)),gt(t,m,C=>i(5,c=C)),gt(t,g,C=>i(6,u=C)),gt(t,v,C=>i(2,r=C)),gt(t,y,C=>i(23,n=C)),gt(t,b,C=>i(24,a=C)),gt(t,I,C=>i(3,o=C)),gt(t,T,C=>i(7,d=C));let w=vm($I()),S;function U(){Ur(v,r=lRe(r,n,a),r)}function P(){Ur(v,r=oRe(r,n),r)}const E=()=>Ur(v,r=ma(w),r),R=C=>Ur(T,d=C,d);return t.$$set=C=>{"buttons"in C&&i(0,p=C.buttons)},t.$$.update=()=>{t.$$.dirty&1048576&&i(1,S=w>=s.start&&w<s.end||null)},[p,S,r,o,l,c,u,d,h,f,m,g,v,y,b,I,T,w,U,P,s,E,R]}class mRe extends du{constructor(e){super(),uu(this,e,Ewt,Dwt,Sc,{buttons:0})}}function Cne(t,e,i){const n=t.slice();return n[5]=e[i],n}function Rne(t,e,i){const n=t.slice();return n[8]=e[i],n}function Pwt(t){let e,i;return e=new mRe({props:{buttons:t[8]}}),{c(){Ns(e.$$.fragment)},m(n,r){fs(e,n,r),i=!0},p(n,r){const a={};r&1&&(a.buttons=n[8]),e.$set(a)},i(n){i||(Oi(e.$$.fragment,n),i=!0)},o(n){vn(e.$$.fragment,n),i=!1},d(n){rs(e,n)}}}function Cwt(t){let e,i,n,r;return i=new mRe({props:{buttons:t[8]}}),{c(){e=fr("div"),Ns(i.$$.fragment),At(e,"class",n=t[1].buttonGroup)},m(a,s){Pr(a,e,s),fs(i,e,null),r=!0},p(a,s){const o={};s&1&&(o.buttons=a[8]),i.$set(o),(!r||s&2&&n!==(n=a[1].buttonGroup))&&At(e,"class",n)},i(a){r||(Oi(i.$$.fragment,a),r=!0)},o(a){vn(i.$$.fragment,a),r=!1},d(a){a&&Ir(e),rs(i)}}}function Mne(t){let e,i,n,r;const a=[Cwt,Pwt],s=[];function o(l,c){return l[8].length>1?0:1}return e=o(t),i=s[e]=a[e](t),{c(){i.c(),n=Lm()},m(l,c){s[e].m(l,c),Pr(l,n,c),r=!0},p(l,c){let u=e;e=o(l),e===u?s[e].p(l,c):(Kl(),vn(s[u],1,1,()=>{s[u]=null}),Zl(),i=s[e],i?i.p(l,c):(i=s[e]=a[e](l),i.c()),Oi(i,1),i.m(n.parentNode,n))},i(l){r||(Oi(i),r=!0)},o(l){vn(i),r=!1},d(l){l&&Ir(n),s[e].d(l)}}}function Nne(t){let e,i,n,r,a=ao(t[0][t[5]]),s=[];for(let l=0;l<a.length;l+=1)s[l]=Mne(Rne(t,a,l));const o=l=>vn(s[l],1,1,()=>{s[l]=null});return{c(){e=fr("div");for(let l=0;l<s.length;l+=1)s[l].c();i=Wl(),At(e,"class",n="ec-"+t[5])},m(l,c){Pr(l,e,c);for(let u=0;u<s.length;u+=1)s[u]&&s[u].m(e,null);Hr(e,i),r=!0},p(l,c){if(c&3){a=ao(l[0][l[5]]);let u;for(u=0;u<a.length;u+=1){const d=Rne(l,a,u);s[u]?(s[u].p(d,c),Oi(s[u],1)):(s[u]=Mne(d),s[u].c(),Oi(s[u],1),s[u].m(e,i))}for(Kl(),u=a.length;u<s.length;u+=1)o(u);Zl()}(!r||c&1&&n!==(n="ec-"+l[5]))&&At(e,"class",n)},i(l){if(!r){for(let c=0;c<a.length;c+=1)Oi(s[c]);r=!0}},o(l){s=s.filter(Boolean);for(let c=0;c<s.length;c+=1)vn(s[c]);r=!1},d(l){l&&Ir(e),e0(s,l)}}}function Rwt(t){let e,i,n,r=ao(bh(t[0])),a=[];for(let o=0;o<r.length;o+=1)a[o]=Nne(Cne(t,r,o));const s=o=>vn(a[o],1,1,()=>{a[o]=null});return{c(){e=fr("nav");for(let o=0;o<a.length;o+=1)a[o].c();At(e,"class",i=t[1].toolbar)},m(o,l){Pr(o,e,l);for(let c=0;c<a.length;c+=1)a[c]&&a[c].m(e,null);n=!0},p(o,[l]){if(l&3){r=ao(bh(o[0]));let c;for(c=0;c<r.length;c+=1){const u=Cne(o,r,c);a[c]?(a[c].p(u,l),Oi(a[c],1)):(a[c]=Nne(u),a[c].c(),Oi(a[c],1),a[c].m(e,null))}for(Kl(),c=r.length;c<a.length;c+=1)s(c);Zl()}(!n||l&2&&i!==(i=o[1].toolbar))&&At(e,"class",i)},i(o){if(!n){for(let l=0;l<r.length;l+=1)Oi(a[l]);n=!0}},o(o){a=a.filter(Boolean);for(let l=0;l<a.length;l+=1)vn(a[l]);n=!1},d(o){o&&Ir(e),e0(a,o)}}}function Mwt(t,e,i){let n,r,{headerToolbar:a,theme:s}=Hd("state");gt(t,a,l=>i(4,n=l)),gt(t,s,l=>i(1,r=l));let o={start:[],center:[],end:[]};return t.$$.update=()=>{if(t.$$.dirty&17)for(let l of bh(o))i(0,o[l]=n[l].split(" ").map(c=>c.split(",")),o)},[o,r,a,s,n]}class Nwt extends du{constructor(e){super(),uu(this,e,Mwt,Rwt,Sc,{})}}function Ane(t,e,i){const n=t.slice();return n[11]=e[i],n}function _ne(t){let e,i,n;var r=t[11];function a(s,o){return{}}return r&&(e=jT(r,a())),{c(){e&&Ns(e.$$.fragment),i=Lm()},m(s,o){e&&fs(e,s,o),Pr(s,i,o),n=!0},p(s,o){if(o&1&&r!==(r=s[11])){if(e){Kl();const l=e;vn(l.$$.fragment,1,0,()=>{rs(l,1)}),Zl()}r?(e=jT(r,a()),Ns(e.$$.fragment),Oi(e.$$.fragment,1),fs(e,i.parentNode,i)):e=null}},i(s){n||(e&&Oi(e.$$.fragment,s),n=!0)},o(s){e&&vn(e.$$.fragment,s),n=!1},d(s){s&&Ir(i),e&&rs(e,s)}}}function Awt(t){let e,i,n=ao(t[0]),r=[];for(let s=0;s<n.length;s+=1)r[s]=_ne(Ane(t,n,s));const a=s=>vn(r[s],1,1,()=>{r[s]=null});return{c(){for(let s=0;s<r.length;s+=1)r[s].c();e=Lm()},m(s,o){for(let l=0;l<r.length;l+=1)r[l]&&r[l].m(s,o);Pr(s,e,o),i=!0},p(s,[o]){if(o&1){n=ao(s[0]);let l;for(l=0;l<n.length;l+=1){const c=Ane(s,n,l);r[l]?(r[l].p(c,o),Oi(r[l],1)):(r[l]=_ne(c),r[l].c(),Oi(r[l],1),r[l].m(e.parentNode,e))}for(Kl(),l=n.length;l<r.length;l+=1)a(l);Zl()}},i(s){if(!i){for(let o=0;o<n.length;o+=1)Oi(r[o]);i=!0}},o(s){r=r.filter(Boolean);for(let o=0;o<r.length;o+=1)vn(r[o]);i=!1},d(s){s&&Ir(e),e0(r,s)}}}function _wt(t,e,i){let n,r,a,s,{datesSet:o,_auxiliary:l,_activeRange:c,_queue:u,_view:d}=Hd("state");gt(t,o,f=>i(7,r=f)),gt(t,l,f=>i(0,s=f)),gt(t,c,f=>i(5,a=f)),gt(t,d,f=>i(6,n=f));let p={};function h(f){Dn(r)&&wK(()=>r({start:Vc(f.start),end:Vc(f.end),startStr:Tp(f.start),endStr:Tp(f.end),view:md(n)}),p,u)}return t.$$.update=()=>{t.$$.dirty&32&&h(a)},[s,o,l,c,d,a]}let kwt=class extends du{constructor(e){super(),uu(this,e,_wt,Awt,Sc,{})}};function xwt(t){let e,i,n,r,a,s,o,l,c,u,d;i=new Nwt({});var p=t[5];function h(f,m){return{}}return p&&(r=jT(p,h())),l=new kwt({}),{c(){e=fr("div"),Ns(i.$$.fragment),n=Wl(),r&&Ns(r.$$.fragment),o=Wl(),Ns(l.$$.fragment),At(e,"class",a=t[1].calendar+" "+t[1].view+(t[0]?" "+t[1].withScroll:"")+(t[2]?" "+t[1][t[2]]:"")),At(e,"role",s=sz(t[4])?"list":"table"),gne(e,"height",t[3])},m(f,m){Pr(f,e,m),fs(i,e,null),Hr(e,n),r&&fs(r,e,null),Pr(f,o,m),fs(l,f,m),c=!0,u||(d=dr(window,"resize",t[20]),u=!0)},p(f,m){if(m[0]&32&&p!==(p=f[5])){if(r){Kl();const g=r;vn(g.$$.fragment,1,0,()=>{rs(g,1)}),Zl()}p?(r=jT(p,h()),Ns(r.$$.fragment),Oi(r.$$.fragment,1),fs(r,e,null)):r=null}(!c||m[0]&7&&a!==(a=f[1].calendar+" "+f[1].view+(f[0]?" "+f[1].withScroll:"")+(f[2]?" "+f[1][f[2]]:"")))&&At(e,"class",a),(!c||m[0]&16&&s!==(s=sz(f[4])?"list":"table"))&&At(e,"role",s),m[0]&8&&gne(e,"height",f[3])},i(f){c||(Oi(i.$$.fragment,f),r&&Oi(r.$$.fragment,f),Oi(l.$$.fragment,f),c=!0)},o(f){vn(i.$$.fragment,f),r&&vn(r.$$.fragment,f),vn(l.$$.fragment,f),c=!1},d(f){f&&(Ir(e),Ir(o)),rs(i),r&&rs(r),rs(l,f),u=!1,d()}}}function Owt(t,e,i){let n,r,a,s,o,l,c,u,d,p,h,f,m,g,{plugins:v=[]}=e,{options:y={}}=e,b=f1(),I=new vwt(v,y);RIt("state",I);let{_viewComponent:T,_bodyEl:w,_interaction:S,_iClass:U,_events:P,_queue:E,_queue2:R,_tasks:C,_scrollable:M,date:_,duration:A,hiddenDays:N,height:k,theme:O,view:$}=I;gt(t,T,ne=>i(5,g=ne)),gt(t,w,ne=>i(37,n=ne)),gt(t,S,ne=>i(43,u=ne)),gt(t,U,ne=>i(2,h=ne)),gt(t,P,ne=>i(44,d=ne)),gt(t,E,ne=>i(39,s=ne)),gt(t,R,ne=>i(38,a=ne)),gt(t,M,ne=>i(0,r=ne)),gt(t,_,ne=>i(42,c=ne)),gt(t,A,ne=>i(41,l=ne)),gt(t,N,ne=>i(40,o=ne)),gt(t,k,ne=>i(3,f=ne)),gt(t,O,ne=>i(1,p=ne)),gt(t,$,ne=>i(4,m=ne));let F={...y};function V(ne,me){return I._set(ne,me),this}function j(ne){let me=I._get(ne);return me instanceof Date?Vc(me):me}function B(){return I._fetchedRange.set({start:void 0,end:void 0}),this}function z(){return d.map(gh)}function W(ne){for(let me of d)if(me.id==ne)return gh(me);return null}function Z(ne){return ne=Yk([ne])[0],d.push(ne),P.set(d),ne}function K(ne){for(let me of d)if(me.id==ne.id)return ne=Yk([ne])[0],i0(me,ne),P.set(d),ne;return null}function Q(ne){let me=d.findIndex(be=>be.id==ne);return me>=0&&(d.splice(me,1),P.set(d)),this}function J(){return md(zk(I._view))}function se(){var ne;return(ne=u.action)==null||ne.unselect(),this}function ie(ne,me){let be=ES(ne,me);if(be){let Se=LD(be)(ne,me);return Se.date=Vc(Se.date),Se}return null}function ce(){rs(b,!0)}function oe(){return Ur(_,c=oRe(c,l),c),this}function te(){return Ur(_,c=lRe(c,l,o),c),this}PIt(()=>{Ine(s)}),eRe(()=>{Ine(a),cRe(le,null,C)});function le(){n&&Ur(M,r=$It(n),r)}return t.$$set=ne=>{"plugins"in ne&&i(21,v=ne.plugins),"options"in ne&&i(22,y=ne.options)},t.$$.update=()=>{if(t.$$.dirty[0]&4194304)for(let[ne,me]of owt(y,F))V(ne,me)},[r,p,h,f,m,g,T,w,S,U,P,E,R,M,_,A,N,k,O,$,le,v,y,V,j,B,z,W,Z,K,Q,J,se,ie,ce,oe,te]}class Lwt extends du{constructor(e){super(),uu(this,e,Owt,xwt,Sc,{plugins:21,options:22,setOption:23,getOption:24,refetchEvents:25,getEvents:26,getEventById:27,addEvent:28,updateEvent:29,removeEventById:30,getView:31,unselect:32,dateFromPoint:33,destroy:34,next:35,prev:36},null,[-1,-1])}get setOption(){return this.$$.ctx[23]}get getOption(){return this.$$.ctx[24]}get refetchEvents(){return this.$$.ctx[25]}get getEvents(){return this.$$.ctx[26]}get getEventById(){return this.$$.ctx[27]}get addEvent(){return this.$$.ctx[28]}get updateEvent(){return this.$$.ctx[29]}get removeEventById(){return this.$$.ctx[30]}get getView(){return this.$$.ctx[31]}get unselect(){return this.$$.ctx[32]}get dateFromPoint(){return this.$$.ctx[33]}get destroy(){return this.$$.ctx[34]}get next(){return this.$$.ctx[35]}get prev(){return this.$$.ctx[36]}}let cV=!1;function Fwt(t){cV||(cV=!0,window.requestAnimationFrame(()=>{t(),cV=!1}))}function kne(t,e,i){return Eb(e,J0(i,t))}const{window:bv}=DIt;function $wt(t){let e,i;return{c:La,m(n,r){e||(i=[dr(bv,"pointermove",t[33]),dr(bv,"pointerup",t[34]),dr(bv,"pointercancel",t[34]),dr(bv,"scroll",t[0]),dr(bv,"selectstart",NA(t[35])),dr(bv,"contextmenu",function(){Dn(NA(t[43]))&&NA(t[43]).apply(this,arguments)}),dr(bv,"touchstart",t[36]),dr(bv,"touchmove",t[42],{passive:!1})],e=!0)},p(n,r){t=n},i:La,o:La,d(n){e=!1,wc(i)}}}const xne=1,One=2,Lne=3,uV=4,NN=5;function Fne(t){return t.isPrimary&&(t.pointerType!=="mouse"||t.buttons&1)}function NA(t){return e=>{t()&&e.preventDefault()}}function Bwt(t,e,i){let n,r,a,s,o,l,c,u,d,p,h,f,m,g,v,y,b,I,T,w,S,U,P,E,R,C,M,_,A,N,k,{_iEvents:O,_iClass:$,_events:F,_view:V,_dayGrid:j,_draggable:B,_bodyEl:z,dateClick:W,dragScroll:Z,datesAboveResources:K,eventDragMinDistance:Q,eventDragStart:J,eventDragStop:se,eventDrop:ie,eventLongPressDelay:ce,eventResizeStart:oe,eventResizeStop:te,eventResize:le,longPressDelay:ne,selectable:me,select:be,selectBackgroundColor:Se,selectLongPressDelay:we,selectMinDistance:ze,slotDuration:Qe,slotHeight:ke,slotWidth:yt,unselect:lt,unselectAuto:Ct,unselectCancel:Nt,view:Ce}=Hd("state");gt(t,O,nt=>i(72,s=nt)),gt(t,$,nt=>i(76,u=nt)),gt(t,F,nt=>i(71,a=nt)),gt(t,V,nt=>i(69,n=nt)),gt(t,j,nt=>i(74,l=nt)),gt(t,B,nt=>i(99,k=nt)),gt(t,z,nt=>i(96,_=nt)),gt(t,W,nt=>i(77,d=nt)),gt(t,Z,nt=>i(87,T=nt)),gt(t,K,nt=>i(95,M=nt)),gt(t,Q,nt=>i(90,U=nt)),gt(t,J,nt=>i(88,w=nt)),gt(t,se,nt=>i(80,f=nt)),gt(t,ie,nt=>i(78,p=nt)),gt(t,ce,nt=>i(93,R=nt)),gt(t,oe,nt=>i(89,S=nt)),gt(t,te,nt=>i(81,m=nt)),gt(t,le,nt=>i(79,h=nt)),gt(t,ne,nt=>i(92,E=nt)),gt(t,me,nt=>i(98,N=nt)),gt(t,be,nt=>i(82,g=nt)),gt(t,Se,nt=>i(73,o=nt)),gt(t,we,nt=>i(94,C=nt)),gt(t,ze,nt=>i(91,P=nt)),gt(t,Qe,nt=>i(97,A=nt)),gt(t,ke,nt=>i(86,I=nt)),gt(t,yt,nt=>i(85,b=nt)),gt(t,lt,nt=>i(70,r=nt)),gt(t,Ct,nt=>i(84,y=nt)),gt(t,Nt,nt=>i(83,v=nt)),gt(t,Ce,nt=>i(75,c=nt));let Ge,$e,at,ct,Vt,Me,De,Je,St,bt,Ie,Ue,Oe,Ee,Xe,Et,Fe,ht,ti,Ke,zt,mt,Tt,Ut,zi,gi;function Dt(nt,Wt,$i,Ja,on){Ge||(Ge=Fne(Wt)?$i?One:k(nt)?xne:NN:NN,Co()&&(at=nt,nn(Wt),Ja&&(Vt=Ja),on&&(gi=on),ti=$i?$i=="x"?"resizingX":"resizingY":"dragging",$i&&(Ke=ma(at.start),ht?(Ke.setUTCHours(at.end.getUTCHours(),at.end.getUTCMinutes(),at.end.getUTCSeconds(),0),Ke<at.start&&gm(Ke)):eg(Ke,A)),tr(Wt)))}function Ui(nt){Ge||(Ge=Fne(nt)?N&&!sz(c)?Lne:uV:NN,Co()&&(nn(nt),ti="selecting",zt=ht?kv({day:1}):A,at={allDay:ht,start:Vt,end:eg(ma(Vt),zt),resourceIds:De?[De.id]:[]},tr(nt)))}function Cr(){Ge||(Ge=NN)}function nn(nt){window.getSelection().removeAllRanges(),St=Ie=nt.clientX,bt=Ue=nt.clientY;let Wt=ES(Ie,Ue);({allDay:ht,date:Vt,resource:De}=LD(Wt)(Ie,Ue)),sV(c)?Oe=Xe=_:(Oe=HT(Wt,De?4:3),Xe=HT(Wt,De&&(Xs()||M)?2:1)),Xp(),nt.pointerType!=="mouse"&&i(1,Ut=setTimeout(()=>{Ge&&($e=!0,tr(nt))},(fl()?C:R)??E))}function tr(nt){if($e||nt&&nt.pointerType==="mouse"&&Uc()>=(fl()?P:U)){$e=!0,Dc(nt),Ur($,u=ti,u),s[0]||(fl()?uf():Tc(nt,pu()?S:w));let Wt=hl();if(Wt){let $i;({allDay:$i,date:Me,resource:Je}=LD(Wt)(Ie,Ue)),$i===ht&&(Fe=kv((Me-Vt)/1e3),Ur(O,s[0].end=eg(ma(at.end),Fe),s),pu()?s[0].end<Ke&&(Ur(O,s[0].end=Ke,s),Fe=kv((Ke-at.end)/1e3)):fl()?s[0].end<at.end?(Ur(O,s[0].start=aRe(s[0].end,zt),s),Ur(O,s[0].end=at.end,s)):Ur(O,s[0].start=at.start,s):(Ur(O,s[0].start=eg(ma(at.start),Fe),s),De&&(Ur(O,s[0].resourceIds=at.resourceIds.filter(Ja=>Ja!==De.id),s),s[0].resourceIds.push(Je.id))))}}if(T){let Wt=I*2,$i=b;Fwt(()=>{Oe&&(Ue<Wt&&window.scrollBy(0,Eb(-10,(Ue-Wt)/3)),Ue<Ee.top+Wt&&(Oe.scrollTop+=Eb(-10,(Ue-Ee.top-Wt)/3)),Ue>window.innerHeight-Wt&&window.scrollBy(0,J0(10,(Ue-window.innerHeight+Wt)/3)),Ue>Ee.bottom-Wt&&(Oe.scrollTop+=J0(10,(Ue-Ee.bottom+Wt)/3)),sV(c)&&(Ie<Ee.left+$i&&(Oe.scrollLeft+=Eb(-10,(Ie-Ee.left-$i)/3)),Ie>Ee.right-$i&&(Oe.scrollLeft+=J0(10,(Ie-Ee.right+$i)/3))))})}}function lr(){Co()&&(Xp(),tr())}function Xa(nt){Co()&&nt.isPrimary&&(Ie=nt.clientX,Ue=nt.clientY,tr(nt))}function Gr(nt){if(mt&&y&&!(v&&nt.target.closest(v))&&Dc(nt),Ge&&nt.isPrimary){if($e)if(fl()){if(mt=!0,Dn(g)){let{start:Wt,end:$i}=gh(s[0]);g({start:Wt,end:$i,startStr:Tp(s[0].start),endStr:Tp(s[0].end),allDay:ht,jsEvent:nt,view:md(n),resource:De})}}else{at.display=ct;let Wt=pu()?m:f;Dn(Wt)&&Wt({event:gh(at),jsEvent:nt,view:md(n)});let $i=Sne(at);if(An(at,s[0]),zd(),Wt=pu()?h:p,Dn(Wt)){let Ja=at,on;pu()?on={endDelta:Fe}:on={delta:Fe,oldResource:De!==Je?De:void 0,newResource:De!==Je?Je:void 0},Wt(i0(on,{event:gh(at),oldEvent:gh($i),jsEvent:nt,view:md(n),revert(){An(Ja,$i)}}))}}else if((hu()||fl())&&Dn(d)&&!Tt){Ie=nt.clientX,Ue=nt.clientY;let Wt=ES(Ie,Ue);if(Wt){let{allDay:$i,date:Ja,resource:on}=LD(Wt)(Ie,Ue);d({allDay:$i,date:Vc(Ja),dateStr:Tp(Ja),dayEl:Wt,jsEvent:nt,view:md(n),resource:on})}}$e=!1,Ge=St=bt=Ie=Ue=at=ct=Vt=Me=De=Je=Fe=ht=Ur($,u=Ke=zt=gi=void 0,u),Oe=Xe=Ee=Et=void 0,Ut&&(clearTimeout(Ut),i(1,Ut=void 0))}Tt=!1}function hl(){return ES(kne(Ie,zi[0],zi[1]),kne(Ue,zi[2],zi[3]))}function Xp(){Ee=Kv(Oe),Et=Kv(Xe),zi=[Eb(0,Et.left+(sV(c)?1:l?0:8)),J0(document.documentElement.clientWidth,Et.left+Xe.clientWidth)-2,Eb(0,Ee.top),J0(document.documentElement.clientHeight,Ee.top+Oe.clientHeight)-2]}function Tc(nt,Wt){Dn(Wt)&&Wt({event:gh(at),jsEvent:nt,view:md(n)}),ct=at.display,at.display="preview",Ur(O,s[0]=Sne(at),s),gi!==void 0&&Ur(O,s[0]._margin=gi,s),at.display="ghost",F.set(a)}function uf(){Ur(O,s[0]={id:"{select}",allDay:at.allDay,start:at.start,title:"",display:"preview",extendedProps:{},backgroundColor:o,resourceIds:at.resourceIds,classNames:[],styles:[]},s)}function zd(){Ur(O,s[0]=null,s)}function An(nt,Wt){nt.start=Wt.start,nt.end=Wt.end,nt.resourceIds=Wt.resourceIds,F.set(a)}function Uc(){return Math.sqrt(Math.pow(Ie-St,2)+Math.pow(Ue-bt,2))}function Xs(){return Ge===xne}function pu(){return Ge===One}function hu(){return Ge===uV}function fl(){return Ge===Lne}function Co(){return Ge&&Ge<uV}function Dc(nt){mt&&(mt=!1,zd(),Dn(r)&&r({jsEvent:nt,view:md(n)}))}function Js(){Tt=!0}V.subscribe(Dc);function Fs(nt){if(Co()){let Wt=nt.target,$i=[],Ja=()=>wc($i);$i.push(dr(Wt,"touchmove",NA(()=>$e))),$i.push(dr(Wt,"touchend",Ja)),$i.push(dr(Wt,"touchcancel",Ja))}}function Ec(nt){r$.call(this,t,nt)}return[lr,Ut,O,$,F,V,j,B,z,W,Z,K,Q,J,se,ie,ce,oe,te,le,ne,me,be,Se,we,ze,Qe,ke,yt,lt,Ct,Nt,Ce,Xa,Gr,Co,Fs,Dt,Ui,Cr,Dc,Js,Ec,()=>Ut]}class Vwt extends du{constructor(e){super(),uu(this,e,Bwt,$wt,Sc,{drag:37,select:38,noAction:39,handleScroll:0,unselect:40,noClick:41},null,[-1,-1,-1,-1])}get drag(){return this.$$.ctx[37]}get select(){return this.$$.ctx[38]}get noAction(){return this.$$.ctx[39]}get handleScroll(){return this.$$.ctx[0]}get unselect(){return this.$$.ctx[40]}get noClick(){return this.$$.ctx[41]}}function jwt(t){let e,i;return{c:La,m(n,r){e||(i=[dr(window,"pointermove",t[3]),dr(window,"scroll",t[0])],e=!0)},p:La,i:La,o:La,d(n){e=!1,wc(i)}}}function $ne(t){return t.isPrimary&&t.pointerType==="mouse"}function Gwt(t,e,i){let n,r,{_iEvents:a,slotDuration:s}=Hd("state");gt(t,a,m=>i(5,n=m)),gt(t,s,m=>i(8,r=m));let o=0,l=0;function c(m){$ne(m)&&f()}function u(){let m=ES(o,l);if(m){let{allDay:g,date:v,resource:y}=LD(m)(o,l),b=g?2:1;n[b]||h(b),Ur(a,n[b].start=v,n),Ur(a,n[b].end=eg(ma(v),r),n),Ur(a,n[b].resourceIds=y?[y.id]:[],n)}}function d(){u()}function p(m){$ne(m)&&(o=m.clientX,l=m.clientY,u())}function h(m){Ur(a,n[m]={id:"{pointer}",title:"",display:"pointer",extendedProps:{},backgroundColor:"transparent",classNames:[],styles:[]},n)}function f(){Ur(a,n[1]=null,n),Ur(a,n[2]=null,n)}return t.$$.update=()=>{t.$$.dirty&32&&n[0]&&f()},[d,a,s,p,c,n]}class Hwt extends du{constructor(e){super(),uu(this,e,Gwt,jwt,Sc,{leave:4,handleScroll:0})}get leave(){return this.$$.ctx[4]}get handleScroll(){return this.$$.ctx[0]}}function Bne(t){let e,i,n,r;return{c(){e=fr("div"),At(e,"class",i=t[1].resizer)},m(a,s){Pr(a,e,s),n||(r=dr(e,"pointerdown",t[8]),n=!0)},p(a,s){s&2&&i!==(i=a[1].resizer)&&At(e,"class",i)},d(a){a&&Ir(e),n=!1,r()}}}function zwt(t){let e,i=t[0]&&Bne(t);return{c(){i&&i.c(),e=Lm()},m(n,r){i&&i.m(n,r),Pr(n,e,r)},p(n,[r]){n[0]?i?i.p(n,r):(i=Bne(n),i.c(),i.m(e.parentNode,e)):i&&(i.d(1),i=null)},i:La,o:La,d(n){n&&Ir(e),i&&i.d(n)}}}function qwt(t,e,i){let n,r,a,{event:s}=e,{theme:o,eventDurationEditable:l,editable:c}=Hd("state");gt(t,o,p=>i(1,a=p)),gt(t,l,p=>i(7,r=p)),gt(t,c,p=>i(6,n=p));let u;function d(p){r$.call(this,t,p)}return t.$$set=p=>{"event"in p&&i(5,s=p.event)},t.$$.update=()=>{t.$$.dirty&224&&i(0,u=!PP(s.display)&&!zT(s.display)&&((s.durationEditable??r)||(s.editable??n)))},[u,a,o,l,c,s,n,r,d]}class Wwt extends du{constructor(e){super(),uu(this,e,qwt,zwt,Sc,{event:5})}}function Vne(t){let e,i,n={};return e=new Hwt({props:n}),t[16](e),{c(){Ns(e.$$.fragment)},m(r,a){fs(e,r,a),i=!0},p(r,a){const s={};e.$set(s)},i(r){i||(Oi(e.$$.fragment,r),i=!0)},o(r){vn(e.$$.fragment,r),i=!1},d(r){t[16](null),rs(e,r)}}}function Ywt(t){let e,i,n,r,a={};e=new Vwt({props:a}),t[15](e);let s=t[1]&&Vne(t);return{c(){Ns(e.$$.fragment),i=Wl(),s&&s.c(),n=Lm()},m(o,l){fs(e,o,l),Pr(o,i,l),s&&s.m(o,l),Pr(o,n,l),r=!0},p(o,[l]){const c={};e.$set(c),o[1]?s?(s.p(o,l),l&2&&Oi(s,1)):(s=Vne(o),s.c(),Oi(s,1),s.m(n.parentNode,n)):s&&(Kl(),vn(s,1,1,()=>{s=null}),Zl())},i(o){r||(Oi(e.$$.fragment,o),Oi(s),r=!0)},o(o){vn(e.$$.fragment,o),vn(s),r=!1},d(o){o&&(Ir(i),Ir(n)),t[15](null),rs(e,o),s&&s.d(o)}}}function Kwt(t,e,i){let n,r,a,s,o,l,c,u,{theme:d,editable:p,eventStartEditable:h,eventDurationEditable:f,pointer:m,_bodyEl:g,_interaction:v,_iClasses:y,_draggable:b}=Hd("state");gt(t,d,S=>i(11,a=S)),gt(t,p,S=>i(13,l=S)),gt(t,h,S=>i(14,c=S)),gt(t,m,S=>i(1,u=S)),gt(t,g,S=>i(10,r=S)),gt(t,v,S=>i(0,n=S)),gt(t,y,S=>i(17,o=S)),gt(t,b,S=>i(12,s=S)),Ur(v,n.resizer=Wwt,n);function I(){var S;for(let U of Object.values(n))(S=U==null?void 0:U.handleScroll)==null||S.call(U)}function T(S){mm[S?"unshift":"push"](()=>{n.action=S,v.set(n)})}function w(S){mm[S?"unshift":"push"](()=>{n.pointer=S,v.set(n)})}return t.$$.update=()=>{t.$$.dirty&24576&&Ur(b,s=S=>(S.startEditable??c)||(S.editable??l),s),t.$$.dirty&6144&&Ur(y,o=(S,U)=>{let{display:P}=U;return zT(P)?[a[P]]:!PP(P)&&s(U)?[a.draggable]:[]},o),t.$$.dirty&1024&&r&&dr(r,"scroll",I)},[n,u,d,p,h,m,g,v,y,b,r,a,s,l,c,T,w]}class Zwt extends du{constructor(e){super(),uu(this,e,Kwt,Ywt,Sc,{})}}var Xwt={createOptions(t){t.dateClick=void 0,t.dragScroll=!0,t.editable=!1,t.eventDragMinDistance=5,t.eventDragStart=void 0,t.eventDragStop=void 0,t.eventDrop=void 0,t.eventDurationEditable=!0,t.eventLongPressDelay=void 0,t.eventResizeStart=void 0,t.eventResizeStop=void 0,t.eventResize=void 0,t.eventStartEditable=!0,t.longPressDelay=1e3,t.pointer=!1,t.select=void 0,t.selectBackgroundColor=void 0,t.selectLongPressDelay=void 0,t.selectMinDistance=5,t.unselect=void 0,t.unselectAuto=!0,t.unselectCancel="",t.theme.draggable="ec-draggable",t.theme.ghost="ec-ghost",t.theme.preview="ec-preview",t.theme.pointer="ec-pointer",t.theme.resizer="ec-resizer",t.theme.dragging="ec-dragging",t.theme.resizingY="ec-resizing-y",t.theme.resizingX="ec-resizing-x",t.theme.selecting="ec-selecting"},createStores(t){t._draggable=Qo(La),t._auxiliary.update(e=>[...e,Zwt])}};function Jwt(t){return cf([t.date,t.firstDay,t.hiddenDays],([e,i,n])=>{let r=[],a=ma(e),s=7;for(;a.getUTCDay()!==i&&s;)GT(a),--s;for(let o=0;o<7;++o)n.includes(a.getUTCDay())||r.push(ma(a)),gm(a);return r})}function jne(t,e,i){const n=t.slice();return n[8]=e[i],n}function Gne(t){let e,i,n,r,a,s,o,l;return{c(){var c;e=fr("div"),i=fr("span"),a=Wl(),At(i,"aria-label",n=t[2].format(t[8])),At(e,"class",s=t[0].day+" "+((c=t[0].weekdays)==null?void 0:c[t[8].getUTCDay()])),At(e,"role","columnheader")},m(c,u){Pr(c,e,u),Hr(e,i),Hr(e,a),o||(l=Ry(r=t0.call(null,i,t[3].format(t[8]))),o=!0)},p(c,u){var d;t=c,u&6&&n!==(n=t[2].format(t[8]))&&At(i,"aria-label",n),r&&Dn(r.update)&&u&10&&r.update.call(null,t[3].format(t[8])),u&3&&s!==(s=t[0].day+" "+((d=t[0].weekdays)==null?void 0:d[t[8].getUTCDay()]))&&At(e,"class",s)},d(c){c&&Ir(e),o=!1,l()}}}function Qwt(t){let e,i,n,r,a,s,o,l=ao(t[1]),c=[];for(let u=0;u<l.length;u+=1)c[u]=Gne(jne(t,l,u));return{c(){e=fr("div"),i=fr("div");for(let u=0;u<c.length;u+=1)c[u].c();r=Wl(),a=fr("div"),At(i,"class",n=t[0].days),At(i,"role","row"),At(a,"class",s=t[0].hiddenScroll),At(e,"class",o=t[0].header)},m(u,d){Pr(u,e,d),Hr(e,i);for(let p=0;p<c.length;p+=1)c[p]&&c[p].m(i,null);Hr(e,r),Hr(e,a)},p(u,[d]){if(d&15){l=ao(u[1]);let p;for(p=0;p<l.length;p+=1){const h=jne(u,l,p);c[p]?c[p].p(h,d):(c[p]=Gne(h),c[p].c(),c[p].m(i,null))}for(;p<c.length;p+=1)c[p].d(1);c.length=l.length}d&1&&n!==(n=u[0].days)&&At(i,"class",n),d&1&&s!==(s=u[0].hiddenScroll)&&At(a,"class",s),d&1&&o!==(o=u[0].header)&&At(e,"class",o)},i:La,o:La,d(u){u&&Ir(e),e0(c,u)}}}function e0t(t,e,i){let n,r,a,s,{theme:o,_intlDayHeader:l,_intlDayHeaderAL:c,_days:u}=Hd("state");return gt(t,o,d=>i(0,n=d)),gt(t,l,d=>i(3,s=d)),gt(t,c,d=>i(2,a=d)),gt(t,u,d=>i(1,r=d)),[n,r,a,s,o,l,c,u]}class t0t extends du{constructor(e){super(),uu(this,e,e0t,Qwt,Sc,{})}}function i0t(t){let e,i,n,r,a,s,o,l,c,u,d;var p=t[8].resizer;function h(f,m){return{props:{event:f[0]}}}return p&&(s=jT(p,h(t)),s.$on("pointerdown",function(){Dn(t[32](t[8],"x"))&&t[32](t[8],"x").apply(this,arguments)})),{c(){e=fr("article"),i=fr("div"),a=Wl(),s&&Ns(s.$$.fragment),At(i,"class",n=t[2].eventBody),At(e,"class",t[4]),At(e,"style",t[5]),At(e,"role",o=t[7]?"button":void 0),At(e,"tabindex",l=t[7]?0:void 0)},m(f,m){Pr(f,e,m),Hr(e,i),Hr(e,a),s&&fs(s,e,null),t[51](e),c=!0,u||(d=[Ry(r=t0.call(null,i,t[6])),dr(e,"click",function(){Dn(t[7]||void 0)&&(t[7]||void 0).apply(this,arguments)}),dr(e,"keydown",function(){Dn(t[7]&&Wk(t[7]))&&(t[7]&&Wk(t[7])).apply(this,arguments)}),dr(e,"mouseenter",function(){Dn(t[31](t[9],t[1]))&&t[31](t[9],t[1]).apply(this,arguments)}),dr(e,"mouseleave",function(){Dn(t[31](t[10],t[1]))&&t[31](t[10],t[1]).apply(this,arguments)}),dr(e,"pointerdown",function(){Dn(!zT(t[1])&&t[32](t[8]))&&(!zT(t[1])&&t[32](t[8])).apply(this,arguments)})],u=!0)},p(f,m){if(t=f,(!c||m[0]&4&&n!==(n=t[2].eventBody))&&At(i,"class",n),r&&Dn(r.update)&&m[0]&64&&r.update.call(null,t[6]),m[0]&256&&p!==(p=t[8].resizer)){if(s){Kl();const g=s;vn(g.$$.fragment,1,0,()=>{rs(g,1)}),Zl()}p?(s=jT(p,h(t)),s.$on("pointerdown",function(){Dn(t[32](t[8],"x"))&&t[32](t[8],"x").apply(this,arguments)}),Ns(s.$$.fragment),Oi(s.$$.fragment,1),fs(s,e,null)):s=null}else if(p){const g={};m[0]&1&&(g.event=t[0]),s.$set(g)}(!c||m[0]&16)&&At(e,"class",t[4]),(!c||m[0]&32)&&At(e,"style",t[5]),(!c||m[0]&128&&o!==(o=t[7]?"button":void 0))&&At(e,"role",o),(!c||m[0]&128&&l!==(l=t[7]?0:void 0))&&At(e,"tabindex",l)},i(f){c||(s&&Oi(s.$$.fragment,f),c=!0)},o(f){s&&vn(s.$$.fragment,f),c=!1},d(f){f&&Ir(e),s&&rs(s),t[51](null),u=!1,wc(d)}}}function n0t(t,e,i){let n,r,a,s,o,l,c,u,d,p,h,f,m,g,v,y,b,I,T,w,{chunk:S}=e,{longChunks:U={}}=e,{inPopup:P=!1}=e,{dates:E=[]}=e,{dayMaxEvents:R,displayEventEnd:C,eventAllUpdated:M,eventBackgroundColor:_,eventTextColor:A,eventClick:N,eventColor:k,eventContent:O,eventClassNames:$,eventDidMount:F,eventMouseEnter:V,eventMouseLeave:j,resources:B,theme:z,_view:W,_intlEventTime:Z,_interaction:K,_iClasses:Q,_hiddenEvents:J,_popupDate:se,_tasks:ie}=Hd("state");gt(t,R,Ce=>i(54,a=Ce)),gt(t,C,Ce=>i(44,f=Ce)),gt(t,M,Ce=>i(56,c=Ce)),gt(t,_,Ce=>i(50,I=Ce)),gt(t,A,Ce=>i(47,v=Ce)),gt(t,N,Ce=>i(40,n=Ce)),gt(t,k,Ce=>i(49,b=Ce)),gt(t,O,Ce=>i(43,h=Ce)),gt(t,$,Ce=>i(45,m=Ce)),gt(t,F,Ce=>i(57,u=Ce)),gt(t,V,Ce=>i(9,T=Ce)),gt(t,j,Ce=>i(10,w=Ce)),gt(t,B,Ce=>i(48,y=Ce)),gt(t,z,Ce=>i(2,p=Ce)),gt(t,W,Ce=>i(41,l=Ce)),gt(t,Z,Ce=>i(42,d=Ce)),gt(t,K,Ce=>i(8,o=Ce)),gt(t,Q,Ce=>i(46,g=Ce)),gt(t,J,Ce=>i(53,r=Ce)),gt(t,se,Ce=>i(55,s=Ce));let ce,oe,te,le,ne,me,be=1,Se=!1,we,ze;CIt(()=>{Dn(u)&&u({event:gh(oe),timeText:me,el:ce,view:md(l)})}),eRe(()=>{Dn(c)&&!zT(we)&&cRe(()=>c({view:md(l)}),"eau",ie)});function Qe(Ce,Ge){return!zT(Ge)&&Dn(Ce)?$e=>Ce({event:gh(oe),el:ce,jsEvent:$e,view:md(l)}):void 0}function ke(Ce,Ge){return Ce.action?$e=>o.action.drag(oe,$e,Ge,P?s:null,[Kv(ce).top-Kv(HT(ce,1)).top,E]):void 0}function yt(){ce&&(i(38,be=YIt(S,U,MN(ce))),a===!0?lt():i(39,Se=!1))}function lt(){let Ce=HT(ce,2),Ge=MN(Ce)-MN(Ce.firstElementChild)-Ct(Ce);i(39,Se=S.bottom>Ge);let $e=!1;for(let at of S.dates){let ct=r[at.getTime()];if(ct){let Vt=ct.size;Se?ct.add(S.event):ct.delete(S.event),Vt!==ct.size&&($e=!0)}}$e&&J.set(r)}function Ct(Ce){let Ge=0;for(let $e=0;$e<S.days&&(Ge=Eb(Ge,MN(Ce.lastElementChild)),Ce=Ce.nextElementSibling,!!Ce);++$e);return Ge}function Nt(Ce){mm[Ce?"unshift":"push"](()=>{ce=Ce,i(3,ce)})}return t.$$set=Ce=>{"chunk"in Ce&&i(33,S=Ce.chunk),"longChunks"in Ce&&i(34,U=Ce.longChunks),"inPopup"in Ce&&i(35,P=Ce.inPopup),"dates"in Ce&&i(36,E=Ce.dates)},t.$$.update=()=>{if(t.$$.dirty[1]&4&&i(0,oe=S.event),t.$$.dirty[0]&39|t.$$.dirty[1]&1033604){i(1,we=oe.display);let Ce=oe.backgroundColor||iwt(oe,y)||I||b,Ge=oe.textColor||nwt(oe,y)||v;if(PP(we))i(5,le=`width:calc(${S.days*100}% + ${S.days-1}px);`);else{let $e=be;if(oe._margin){let[at,ct]=oe._margin;S.date>=ct[0]&&S.date<=ct.at(-1)&&($e=at)}i(5,le=`width:calc(${S.days*100}% + ${(S.days-1)*7}px);margin-top:${$e}px;`)}Ce&&i(5,le+=`background-color:${Ce};`),Ge&&i(5,le+=`color:${Ge};`),Se&&i(5,le+="visibility:hidden;"),i(5,le+=oe.styles.join(";")),i(4,te=[PP(we)?p.bgEvent:p.event,...g([],oe),...WIt(m,oe,l)].join(" "))}t.$$.dirty[0]&4|t.$$.dirty[1]&15364&&i(6,[me,ne]=qIt(S,f,h,p,d,l),ne),t.$$.dirty[0]&2|t.$$.dirty[1]&512&&i(7,ze=Qe(n,we))},[oe,we,p,ce,te,le,ne,ze,o,T,w,R,C,M,_,A,N,k,O,$,F,V,j,B,z,W,Z,K,Q,J,se,Qe,ke,S,U,P,E,yt,be,Se,n,l,d,h,f,m,g,v,y,b,I,Nt]}let _M=class extends du{constructor(e){super(),uu(this,e,n0t,i0t,Sc,{chunk:33,longChunks:34,inPopup:35,dates:36,reposition:37},null,[-1,-1])}get reposition(){return this.$$.ctx[37]}};function Hne(t,e,i){const n=t.slice();return n[20]=e[i],n}function zne(t,e){let i,n,r;return n=new _M({props:{chunk:e[20],inPopup:!0}}),{key:t,first:null,c(){i=Lm(),Ns(n.$$.fragment),this.first=i},m(a,s){Pr(a,i,s),fs(n,a,s),r=!0},p(a,s){e=a;const o={};s&1&&(o.chunk=e[20]),n.$set(o)},i(a){r||(Oi(n.$$.fragment,a),r=!0)},o(a){vn(n.$$.fragment,a),r=!1},d(a){a&&Ir(i),rs(n,a)}}}function r0t(t){let e,i,n,r,a,s,o,l,c,u,d,p,h=[],f=new Map,m,g,v,y,b,I=ao(t[0]);const T=w=>w[20].event;for(let w=0;w<I.length;w+=1){let S=Hne(t,I,w),U=T(S);f.set(U,h[w]=zne(U,S))}return{c(){e=fr("div"),i=fr("div"),n=fr("time"),s=Wl(),o=fr("a"),l=AM("×"),d=Wl(),p=fr("div");for(let w=0;w<h.length;w+=1)h[w].c();At(n,"datetime",r=Tp(t[3],10)),At(o,"role","button"),At(o,"tabindex","0"),At(o,"aria-label",c=t[6].close),At(i,"class",u=t[4].dayHead),At(p,"class",m=t[4].events),At(e,"class",g=t[4].popup),At(e,"style",t[2])},m(w,S){Pr(w,e,S),Hr(e,i),Hr(i,n),Hr(i,s),Hr(i,o),Hr(o,l),Hr(e,d),Hr(e,p);for(let U=0;U<h.length;U+=1)h[U]&&h[U].m(p,null);t[16](e),v=!0,y||(b=[Ry(a=t0.call(null,n,t[5].format(t[3]))),dr(o,"click",qk(t[13])),dr(o,"keydown",Wk(t[13])),Ry(_It.call(null,e,"pointerdown")),dr(e,"pointerdown",qk(t[15])),dr(e,"pointerdownoutside",t[14])],y=!0)},p(w,[S]){(!v||S&8&&r!==(r=Tp(w[3],10)))&&At(n,"datetime",r),a&&Dn(a.update)&&S&40&&a.update.call(null,w[5].format(w[3])),(!v||S&64&&c!==(c=w[6].close))&&At(o,"aria-label",c),(!v||S&16&&u!==(u=w[4].dayHead))&&At(i,"class",u),S&1&&(I=ao(w[0]),Kl(),h=az(h,S,T,1,w,I,f,p,rz,zne,null,Hne),Zl()),(!v||S&16&&m!==(m=w[4].events))&&At(p,"class",m),(!v||S&16&&g!==(g=w[4].popup))&&At(e,"class",g),(!v||S&4)&&At(e,"style",w[2])},i(w){if(!v){for(let S=0;S<I.length;S+=1)Oi(h[S]);v=!0}},o(w){for(let S=0;S<h.length;S+=1)vn(h[S]);v=!1},d(w){w&&Ir(e);for(let S=0;S<h.length;S+=1)h[S].d();t[16](null),y=!1,wc(b)}}}function a0t(t,e,i){let n,r,a,s,o,l,{buttonText:c,theme:u,_interaction:d,_intlDayPopover:p,_popupDate:h,_popupChunks:f}=Hd("state");gt(t,c,S=>i(6,l=S)),gt(t,u,S=>i(4,s=S)),gt(t,d,S=>i(17,n=S)),gt(t,p,S=>i(5,o=S)),gt(t,h,S=>i(3,r=S)),gt(t,f,S=>i(0,a=S));let m,g="";function v(){let S=HT(m,1),U=HT(S,3),P=Kv(m),E=Kv(S),R=Kv(U);i(2,g="");let C;if(P.width>=R.width){C=R.left-E.left;let _=E.right-R.right;i(2,g+=`right:${_}px;`)}else C=(E.width-P.width)/2,E.left+C<R.left?C=R.left-E.left:E.left+C+P.width>R.right&&(C=R.right-E.left-P.width);i(2,g+=`left:${C}px;`);let M;if(P.height>=R.height){M=R.top-E.top;let _=E.bottom-R.bottom;i(2,g+=`bottom:${_}px;`)}else M=(E.height-P.height)/2,E.top+M<R.top?M=R.top-E.top:E.top+M+P.height>R.bottom&&(M=R.bottom-E.top-P.height);i(2,g+=`top:${M}px;`)}function y(){m&&(i(2,g=""),a$().then(()=>{a.length?v():b()}))}function b(S){Ur(h,r=null,r)}function I(S){var U;b(),(U=n.action)==null||U.noClick()}function T(S){r$.call(this,t,S)}function w(S){mm[S?"unshift":"push"](()=>{m=S,i(1,m)})}return t.$$.update=()=>{t.$$.dirty&1&&a&&y()},[a,m,g,r,s,o,l,c,u,d,p,h,f,b,I,T,w]}class s0t extends du{constructor(e){super(),uu(this,e,a0t,r0t,Sc,{})}}function qne(t,e,i){const n=t.slice();return n[44]=e[i],n[45]=e,n[46]=i,n}function Wne(t,e,i){const n=t.slice();return n[44]=e[i],n}function Yne(t,e){let i,n,r;return n=new _M({props:{chunk:e[44]}}),{key:t,first:null,c(){i=Lm(),Ns(n.$$.fragment),this.first=i},m(a,s){Pr(a,i,s),fs(n,a,s),r=!0},p(a,s){e=a;const o={};s[0]&256&&(o.chunk=e[44]),n.$set(o)},i(a){r||(Oi(n.$$.fragment,a),r=!0)},o(a){vn(n.$$.fragment,a),r=!1},d(a){a&&Ir(i),rs(n,a)}}}function Kne(t){let e,i,n,r;return i=new _M({props:{chunk:t[2][2]}}),{c(){e=fr("div"),Ns(i.$$.fragment),At(e,"class",n=t[14].events)},m(a,s){Pr(a,e,s),fs(i,e,null),r=!0},p(a,s){const o={};s[0]&4&&(o.chunk=a[2][2]),i.$set(o),(!r||s[0]&16384&&n!==(n=a[14].events))&&At(e,"class",n)},i(a){r||(Oi(i.$$.fragment,a),r=!0)},o(a){vn(i.$$.fragment,a),r=!1},d(a){a&&Ir(e),rs(i)}}}function Zne(t){let e,i,n,r;return i=new _M({props:{chunk:t[2][0]}}),{c(){e=fr("div"),Ns(i.$$.fragment),At(e,"class",n=t[14].events+" "+t[14].preview)},m(a,s){Pr(a,e,s),fs(i,e,null),r=!0},p(a,s){const o={};s[0]&4&&(o.chunk=a[2][0]),i.$set(o),(!r||s[0]&16384&&n!==(n=a[14].events+" "+a[14].preview))&&At(e,"class",n)},i(a){r||(Oi(i.$$.fragment,a),r=!0)},o(a){vn(i.$$.fragment,a),r=!1},d(a){a&&Ir(e),rs(i)}}}function Xne(t,e){let i,n,r=e[46],a;const s=()=>e[38](n,r),o=()=>e[38](null,r);let l={chunk:e[44],longChunks:e[1],dates:e[3]};return n=new _M({props:l}),s(),{key:t,first:null,c(){i=Lm(),Ns(n.$$.fragment),this.first=i},m(c,u){Pr(c,i,u),fs(n,c,u),a=!0},p(c,u){e=c,r!==e[46]&&(o(),r=e[46],s());const d={};u[0]&32&&(d.chunk=e[44]),u[0]&2&&(d.longChunks=e[1]),u[0]&8&&(d.dates=e[3]),n.$set(d)},i(c){a||(Oi(n.$$.fragment,c),a=!0)},o(c){vn(n.$$.fragment,c),a=!1},d(c){c&&Ir(i),o(),rs(n,c)}}}function Jne(t){let e,i;return e=new s0t({}),{c(){Ns(e.$$.fragment)},m(n,r){fs(e,n,r),i=!0},i(n){i||(Oi(e.$$.fragment,n),i=!0)},o(n){vn(e.$$.fragment,n),i=!1},d(n){rs(e,n)}}}function Qne(t){let e,i,n,r;return{c(){e=fr("a"),At(e,"role","button"),At(e,"tabindex","0"),At(e,"aria-haspopup","true")},m(a,s){Pr(a,e,s),n||(r=[dr(e,"click",qk(t[27])),dr(e,"keydown",Wk(t[27])),dr(e,"pointerdown",qk(t[37])),Ry(i=t0.call(null,e,t[12]))],n=!0)},p(a,s){i&&Dn(i.update)&&s[0]&4096&&i.update.call(null,a[12])},d(a){a&&Ir(e),n=!1,wc(r)}}}function o0t(t){let e,i,n,r,a,s,o,l=[],c=new Map,u,d,p=t[2][2]&&cp(t[2][2].date,t[0]),h,f=t[2][0]&&cp(t[2][0].date,t[0]),m,g,v=[],y=new Map,b,I,T,w,S,U,P,E,R,C=ao(t[8]);const M=F=>F[44].event;for(let F=0;F<C.length;F+=1){let V=Wne(t,C,F),j=M(V);c.set(j,l[F]=Yne(j,V))}let _=p&&Kne(t),A=f&&Zne(t),N=ao(t[5]);const k=F=>F[44].event;for(let F=0;F<N.length;F+=1){let V=qne(t,N,F),j=k(V);y.set(j,v[F]=Xne(j,V))}let O=t[7]&&Jne(),$=t[6].size&&Qne(t);return{c(){var F;e=fr("div"),i=fr("time"),s=Wl(),o=fr("div");for(let V=0;V<l.length;V+=1)l[V].c();d=Wl(),_&&_.c(),h=Wl(),A&&A.c(),m=Wl(),g=fr("div");for(let V=0;V<v.length;V+=1)v[V].c();I=Wl(),O&&O.c(),T=Wl(),w=fr("div"),$&&$.c(),At(i,"class",n=t[14].dayHead),At(i,"datetime",r=Tp(t[0],10)),At(o,"class",u=t[14].bgEvents),At(g,"class",b=t[14].events),At(w,"class",S=t[14].dayFoot),At(e,"class",U=t[14].day+" "+((F=t[14].weekdays)==null?void 0:F[t[0].getUTCDay()])+(t[9]?" "+t[14].today:"")+(t[10]?" "+t[14].otherMonth:"")+(t[11]?" "+t[14].highlight:"")),At(e,"role","cell")},m(F,V){Pr(F,e,V),Hr(e,i),Hr(e,s),Hr(e,o);for(let j=0;j<l.length;j+=1)l[j]&&l[j].m(o,null);Hr(e,d),_&&_.m(e,null),Hr(e,h),A&&A.m(e,null),Hr(e,m),Hr(e,g);for(let j=0;j<v.length;j+=1)v[j]&&v[j].m(g,null);Hr(e,I),O&&O.m(e,null),Hr(e,T),Hr(e,w),$&&$.m(w,null),t[39](e),P=!0,E||(R=[Ry(a=t0.call(null,i,t[16].format(t[0]))),dr(e,"pointerleave",function(){var j,B;Dn((j=t[15].pointer)==null?void 0:j.leave)&&((B=t[15].pointer)==null||B.leave.apply(this,arguments))}),dr(e,"pointerdown",function(){var j,B;Dn((j=t[15].action)==null?void 0:j.select)&&((B=t[15].action)==null||B.select.apply(this,arguments))})],E=!0)},p(F,V){var j;t=F,(!P||V[0]&16384&&n!==(n=t[14].dayHead))&&At(i,"class",n),(!P||V[0]&1&&r!==(r=Tp(t[0],10)))&&At(i,"datetime",r),a&&Dn(a.update)&&V[0]&65537&&a.update.call(null,t[16].format(t[0])),V[0]&256&&(C=ao(t[8]),Kl(),l=az(l,V,M,1,t,C,c,o,rz,Yne,null,Wne),Zl()),(!P||V[0]&16384&&u!==(u=t[14].bgEvents))&&At(o,"class",u),V[0]&5&&(p=t[2][2]&&cp(t[2][2].date,t[0])),p?_?(_.p(t,V),V[0]&5&&Oi(_,1)):(_=Kne(t),_.c(),Oi(_,1),_.m(e,h)):_&&(Kl(),vn(_,1,1,()=>{_=null}),Zl()),V[0]&5&&(f=t[2][0]&&cp(t[2][0].date,t[0])),f?A?(A.p(t,V),V[0]&5&&Oi(A,1)):(A=Zne(t),A.c(),Oi(A,1),A.m(e,m)):A&&(Kl(),vn(A,1,1,()=>{A=null}),Zl()),V[0]&8234&&(N=ao(t[5]),Kl(),v=az(v,V,k,1,t,N,y,g,rz,Xne,null,qne),Zl()),(!P||V[0]&16384&&b!==(b=t[14].events))&&At(g,"class",b),t[7]?O?V[0]&128&&Oi(O,1):(O=Jne(),O.c(),Oi(O,1),O.m(e,T)):O&&(Kl(),vn(O,1,1,()=>{O=null}),Zl()),t[6].size?$?$.p(t,V):($=Qne(t),$.c(),$.m(w,null)):$&&($.d(1),$=null),(!P||V[0]&16384&&S!==(S=t[14].dayFoot))&&At(w,"class",S),(!P||V[0]&19969&&U!==(U=t[14].day+" "+((j=t[14].weekdays)==null?void 0:j[t[0].getUTCDay()])+(t[9]?" "+t[14].today:"")+(t[10]?" "+t[14].otherMonth:"")+(t[11]?" "+t[14].highlight:"")))&&At(e,"class",U)},i(F){if(!P){for(let V=0;V<C.length;V+=1)Oi(l[V]);Oi(_),Oi(A);for(let V=0;V<N.length;V+=1)Oi(v[V]);Oi(O),P=!0}},o(F){for(let V=0;V<l.length;V+=1)vn(l[V]);vn(_),vn(A);for(let V=0;V<v.length;V+=1)vn(v[V]);vn(O),P=!1},d(F){F&&Ir(e);for(let V=0;V<l.length;V+=1)l[V].d();_&&_.d(),A&&A.d();for(let V=0;V<v.length;V+=1)v[V].d();O&&O.d(),$&&$.d(),t[39](null),E=!1,wc(R)}}}function l0t(t,e,i){let n,r,a,s,o,l,c,u,d,p,{date:h}=e,{chunks:f}=e,{bgChunks:m}=e,{longChunks:g}=e,{iChunks:v=[]}=e,{dates:y}=e,{date:b,dayMaxEvents:I,highlightedDates:T,moreLinkContent:w,theme:S,_hiddenEvents:U,_intlDayCell:P,_popupDate:E,_popupChunks:R,_today:C,_interaction:M,_queue:_}=Hd("state");gt(t,b,ie=>i(35,l=ie)),gt(t,T,ie=>i(34,o=ie)),gt(t,w,ie=>i(32,a=ie)),gt(t,S,ie=>i(14,u=ie)),gt(t,U,ie=>i(33,s=ie)),gt(t,P,ie=>i(16,p=ie)),gt(t,E,ie=>i(31,r=ie)),gt(t,R,ie=>i(40,n=ie)),gt(t,C,ie=>i(36,c=ie)),gt(t,M,ie=>i(15,d=ie));let A,N,k,O,$,F,V=new Set,j="",B,z=[];function W(){Ur(E,r=h,r)}function Z(){var oe;let ie=gm(ma(h)),ce=N.concat(((oe=g[h.getTime()])==null?void 0:oe.chunks)||[]);Ur(R,n=ce.map(te=>i0({},te,oz(te.event,h,ie),{days:1,dates:[h]})).sort((te,le)=>te.top-le.top),n)}function K(){hRe(z,N)}function Q(ie){r$.call(this,t,ie)}function J(ie,ce){mm[ie?"unshift":"push"](()=>{z[ce]=ie,i(13,z)})}function se(ie){mm[ie?"unshift":"push"](()=>{A=ie,i(4,A)})}return t.$$set=ie=>{"date"in ie&&i(0,h=ie.date),"chunks"in ie&&i(28,f=ie.chunks),"bgChunks"in ie&&i(29,m=ie.bgChunks),"longChunks"in ie&&i(1,g=ie.longChunks),"iChunks"in ie&&i(2,v=ie.iChunks),"dates"in ie&&i(3,y=ie.dates)},t.$$.update=()=>{if(t.$$.dirty[0]&805306465){i(5,N=[]),i(8,k=m.filter(ie=>cp(ie.date,h))),V.clear(),i(6,V),i(29,m),i(0,h),i(28,f),i(5,N);for(let ie of f)cp(ie.date,h)&&N.push(ie)}if(t.$$.dirty[0]&65&&Ur(U,s[h.getTime()]=V,s),t.$$.dirty[0]&1|t.$$.dirty[1]&32&&i(9,O=cp(h,c)),t.$$.dirty[0]&1|t.$$.dirty[1]&24&&(i(10,$=h.getUTCMonth()!==l.getUTCMonth()),i(11,F=o.some(ie=>cp(ie,h)))),t.$$.dirty[0]&64|t.$$.dirty[1]&6&&s&&V.size){let ie="+"+V.size+" more";a?i(12,j=Dn(a)?a({num:V.size,text:ie}):a):i(12,j=ie)}t.$$.dirty[0]&1|t.$$.dirty[1]&1&&i(7,B=r&&cp(h,r)),t.$$.dirty[0]&162&&B&&g&&N&&a$().then(Z),t.$$.dirty[0]&17&&A&&BIt(A,()=>({allDay:!0,date:h,resource:void 0,dayEl:A}))},[h,g,v,y,A,N,V,B,k,O,$,F,j,z,u,d,p,b,T,w,S,U,P,E,R,C,M,W,f,m,K,r,a,s,o,l,c,Q,J,se]}class c0t extends du{constructor(e){super(),uu(this,e,l0t,o0t,Sc,{date:0,chunks:28,bgChunks:29,longChunks:1,iChunks:2,dates:3,reposition:30},null,[-1,-1])}get reposition(){return this.$$.ctx[30]}}function ere(t,e,i){const n=t.slice();return n[22]=e[i],n[23]=e,n[24]=i,n}function tre(t){let e,i=t[24],n;const r=()=>t[19](e,i),a=()=>t[19](null,i);let s={date:t[22],chunks:t[1],bgChunks:t[2],longChunks:t[3],iChunks:t[4],dates:t[0]};return e=new c0t({props:s}),r(),{c(){Ns(e.$$.fragment)},m(o,l){fs(e,o,l),n=!0},p(o,l){i!==o[24]&&(a(),i=o[24],r());const c={};l&1&&(c.date=o[22]),l&2&&(c.chunks=o[1]),l&4&&(c.bgChunks=o[2]),l&8&&(c.longChunks=o[3]),l&16&&(c.iChunks=o[4]),l&1&&(c.dates=o[0]),e.$set(c)},i(o){n||(Oi(e.$$.fragment,o),n=!0)},o(o){vn(e.$$.fragment,o),n=!1},d(o){a(),rs(e,o)}}}function u0t(t){let e,i,n,r,a,s=ao(t[0]),o=[];for(let c=0;c<s.length;c+=1)o[c]=tre(ere(t,s,c));const l=c=>vn(o[c],1,1,()=>{o[c]=null});return{c(){e=fr("div");for(let c=0;c<o.length;c+=1)o[c].c();At(e,"class",i=t[6].days),At(e,"role","row")},m(c,u){Pr(c,e,u);for(let d=0;d<o.length;d+=1)o[d]&&o[d].m(e,null);n=!0,r||(a=dr(window,"resize",t[12]),r=!0)},p(c,[u]){if(u&63){s=ao(c[0]);let d;for(d=0;d<s.length;d+=1){const p=ere(c,s,d);o[d]?(o[d].p(p,u),Oi(o[d],1)):(o[d]=tre(p),o[d].c(),Oi(o[d],1),o[d].m(e,null))}for(Kl(),d=s.length;d<o.length;d+=1)l(d);Zl()}(!n||u&64&&i!==(i=c[6].days))&&At(e,"class",i)},i(c){if(!n){for(let u=0;u<s.length;u+=1)Oi(o[u]);n=!0}},o(c){o=o.filter(Boolean);for(let u=0;u<o.length;u+=1)vn(o[u]);n=!1},d(c){c&&Ir(e),e0(o,c),r=!1,a()}}}function d0t(t,e,i){let n,r,a,s,o,{dates:l}=e,{_events:c,_iEvents:u,_queue2:d,_hiddenEvents:p,hiddenDays:h,theme:f}=Hd("state");gt(t,c,P=>i(18,s=P)),gt(t,u,P=>i(17,a=P)),gt(t,p,P=>i(15,n=P)),gt(t,h,P=>i(16,r=P)),gt(t,f,P=>i(6,o=P));let m,g,v,y=[],b,I,T=[],w={};function S(){wK(()=>hRe(T,l),w,d)}function U(P,E){mm[P?"unshift":"push"](()=>{T[E]=P,i(5,T)})}return t.$$set=P=>{"dates"in P&&i(0,l=P.dates)},t.$$.update=()=>{if(t.$$.dirty&1&&(i(13,b=l[0]),i(14,I=gm(ma(l.at(-1))))),t.$$.dirty&352262){i(1,m=[]),i(2,g=[]);for(let P of s)if(Tne(P,b,I)){let E=oz(P,b,I);PP(P.display)?P.allDay&&g.push(E):m.push(E)}lV(g,r),i(3,v=lV(m,r)),S()}t.$$.dirty&221184&&i(4,y=a.map(P=>{let E;return P&&Tne(P,b,I)?(E=oz(P,b,I),lV([E],r)):E=null,E})),t.$$.dirty&32768&&n&&a$().then(S)},[l,m,g,v,y,T,o,c,u,p,h,f,S,b,I,n,r,a,s,U]}class p0t extends du{constructor(e){super(),uu(this,e,d0t,u0t,Sc,{dates:0})}}function ire(t,e,i){const n=t.slice();return n[15]=e[i],n}function nre(t){let e,i;return e=new p0t({props:{dates:t[15]}}),{c(){Ns(e.$$.fragment)},m(n,r){fs(e,n,r),i=!0},p(n,r){const a={};r&1&&(a.dates=n[15]),e.$set(a)},i(n){i||(Oi(e.$$.fragment,n),i=!0)},o(n){vn(e.$$.fragment,n),i=!1},d(n){rs(e,n)}}}function h0t(t){let e,i,n,r,a,s=ao(t[0]),o=[];for(let c=0;c<s.length;c+=1)o[c]=nre(ire(t,s,c));const l=c=>vn(o[c],1,1,()=>{o[c]=null});return{c(){e=fr("div"),i=fr("div");for(let c=0;c<o.length;c+=1)o[c].c();At(i,"class",n=t[2].content),At(e,"class",r=t[2].body+(t[1]===!0?" "+t[2].uniform:""))},m(c,u){Pr(c,e,u),Hr(e,i);for(let d=0;d<o.length;d+=1)o[d]&&o[d].m(i,null);t[13](e),a=!0},p(c,[u]){if(u&1){s=ao(c[0]);let d;for(d=0;d<s.length;d+=1){const p=ire(c,s,d);o[d]?(o[d].p(p,u),Oi(o[d],1)):(o[d]=nre(p),o[d].c(),Oi(o[d],1),o[d].m(i,null))}for(Kl(),d=s.length;d<o.length;d+=1)l(d);Zl()}(!a||u&4&&n!==(n=c[2].content))&&At(i,"class",n),(!a||u&6&&r!==(r=c[2].body+(c[1]===!0?" "+c[2].uniform:"")))&&At(e,"class",r)},i(c){if(!a){for(let u=0;u<s.length;u+=1)Oi(o[u]);a=!0}},o(c){o=o.filter(Boolean);for(let u=0;u<o.length;u+=1)vn(o[u]);a=!1},d(c){c&&Ir(e),e0(o,c),t[13](null)}}}function f0t(t,e,i){let n,r,a,s,o,l,{_bodyEl:c,_viewDates:u,_hiddenEvents:d,dayMaxEvents:p,hiddenDays:h,theme:f}=Hd("state");gt(t,c,y=>i(3,l=y)),gt(t,u,y=>i(11,n=y)),gt(t,d,y=>i(14,a=y)),gt(t,p,y=>i(1,r=y)),gt(t,h,y=>i(12,s=y)),gt(t,f,y=>i(2,o=y));let m,g;function v(y){mm[y?"unshift":"push"](()=>{l=y,c.set(l)})}return t.$$.update=()=>{if(t.$$.dirty&7171){i(0,m=[]),i(10,g=7-s.length),Ur(d,a={},a);for(let y=0;y<n.length/g;++y){let b=[];for(let I=0;I<g;++I)b.push(n[y*g+I]);m.push(b)}}},[m,r,o,l,c,u,d,p,h,f,g,n,s,v]}class m0t extends du{constructor(e){super(),uu(this,e,f0t,h0t,Sc,{})}}function g0t(t){let e,i,n,r;return e=new t0t({}),n=new m0t({}),{c(){Ns(e.$$.fragment),i=Wl(),Ns(n.$$.fragment)},m(a,s){fs(e,a,s),Pr(a,i,s),fs(n,a,s),r=!0},p:La,i(a){r||(Oi(e.$$.fragment,a),Oi(n.$$.fragment,a),r=!0)},o(a){vn(e.$$.fragment,a),vn(n.$$.fragment,a),r=!1},d(a){a&&Ir(i),rs(e,a),rs(n,a)}}}class v0t extends du{constructor(e){super(),uu(this,e,null,g0t,Sc,{})}}var y0t={createOptions(t){t.dayMaxEvents=!1,t.dayCellFormat={day:"numeric"},t.dayPopoverFormat={month:"long",day:"numeric",year:"numeric"},t.moreLinkContent=void 0,t.buttonText.dayGridMonth="month",t.buttonText.close="Close",t.theme.uniform="ec-uniform",t.theme.dayFoot="ec-day-foot",t.theme.popup="ec-popup",t.view="dayGridMonth",t.views.dayGridMonth={buttonText:JIt,component:v0t,dayHeaderFormat:{weekday:"short"},dayHeaderAriaLabelFormat:{weekday:"long"},displayEventEnd:!1,duration:{months:1},theme:ewt("ec-day-grid ec-month-view"),titleFormat:{year:"numeric",month:"long"}}},createStores(t){t._days=Jwt(t),t._intlDayCell=FD(t.locale,t.dayCellFormat),t._intlDayPopover=FD(t.locale,t.dayPopoverFormat),t._hiddenEvents=Qo({}),t._popupDate=Qo(null),t._popupChunks=Qo([])}};let AA;function b0t(){var i;const t=Xc(),e=(i=t==null?void 0:t.provider)==null?void 0:i.organisationId;if(e){const n=r=>{r!=null&&r.calendar?dV(r.calendar):jc.findAllTournaments().then(dV)};jc.findProvider(e).then(n)}else jc.findAllTournaments().then(dV)}function dV(t){const e=document.getElementById(uL);return AA&&Ys(e),Pbt(),AA=new Lwt({target:e,props:{plugins:[y0t,Xwt],options:{view:"dayGridMonth",height:"800px",headerToolbar:{start:"prev,next",center:"title",end:""},buttonText:i=>(i.resourceTimeGridWeek="resources",i),resources:[{id:1,title:"Resource A"},{id:2,title:"Resource B"}],scrollTime:"09:00:00",events:w0t(t),eventClick:I0t,eventMouseEnter:S0t,views:{},dayMaxEvents:!0,nowIndicator:!0,selectable:!0}}}),{...qC,calendar:AA}}function I0t({event:t}){if(t.id){AA.destroy();const e=t.id;ot.reset();const i=`/${Ps}/${e}`;It.router.navigate(i)}}function w0t(t){const e=i=>i==null?void 0:i.split("T")[0];return t.map(i=>({title:i.tournamentName,start:e(i.startDate),end:e(i.endDate),extendedProps:{tournamentId:i.tournamentId},resourceIds:[i.tournamentId],id:i.tournamentId,color:"#FE6B64"}))}function S0t({event:t,jsEvent:e}){Mg(e.target,{content:t.title,showOnCreate:!0,arrow:!0})}var T0t=/([:*])(\w+)/g,U0t="([^/]+)",D0t=/\*/g,E0t="?(?:.*)",P0t=/\/\?/g,C0t="/?([^/]+|)",R0t="(?:/^|^)",M0t="";function gRe(t){return t===void 0&&(t="/"),UK()?location.pathname+location.search+location.hash:t}function ls(t){return t.replace(/\/+$/,"").replace(/^\/+/,"")}function Kk(t){return typeof t=="string"}function N0t(t){return typeof t=="function"}function Zk(t){return t&&t.indexOf("#")>=0&&t.split("#").pop()||""}function A0t(t,e){return e.length===0||!t?null:t.slice(1,t.length).reduce(function(i,n,r){return i===null&&(i={}),i[e[r]]=decodeURIComponent(n),i},null)}function Xk(t){var e=ls(t).split(/\?(.*)?$/);return[ls(e[0]),e.slice(1).join("")]}function TK(t){for(var e={},i=t.split("&"),n=0;n<i.length;n++){var r=i[n].split("=");if(r[0]!==""){var a=decodeURIComponent(r[0]);e[a]?(Array.isArray(e[a])||(e[a]=[e[a]]),e[a].push(decodeURIComponent(r[1]||""))):e[a]=decodeURIComponent(r[1]||"")}}return e}function vRe(t,e){var i=Xk(ls(t.currentLocationPath)),n=i[0],r=i[1],a=r===""?null:TK(r),s=[],o;if(Kk(e.path)){if(o=R0t+ls(e.path).replace(T0t,function(d,p,h){return s.push(h),U0t}).replace(D0t,E0t).replace(P0t,C0t)+"$",ls(e.path)===""&&ls(n)==="")return{url:n,queryString:r,hashString:Zk(t.to),route:e,data:null,params:a}}else o=e.path;var l=new RegExp(o,M0t),c=n.match(l);if(c){var u=Kk(e.path)?A0t(c,s):c.groups?c.groups:c.slice(1);return{url:ls(n.replace(new RegExp("^"+t.instance.root),"")),queryString:r,hashString:Zk(t.to),route:e,data:u,params:a}}return!1}function yRe(){return!!(typeof window<"u"&&window.history&&window.history.pushState)}function n0(t,e){return typeof t[e]>"u"||t[e]===!0}function _0t(t){if(!t)return{};var e=t.split(","),i={},n;return e.forEach(function(r){var a=r.split(":").map(function(s){return s.replace(/(^ +| +$)/g,"")});switch(a[0]){case"historyAPIMethod":i.historyAPIMethod=a[1];break;case"resolveOptionsStrategy":n||(n={}),n.strategy=a[1];break;case"resolveOptionsHash":n||(n={}),n.hash=a[1]==="true";break;case"updateBrowserURL":case"callHandler":case"updateState":case"force":i[a[0]]=a[1]==="true";break}}),n&&(i.resolveOptions=n),i}function UK(){return typeof window<"u"}function k0t(t,e){return t===void 0&&(t=[]),e===void 0&&(e={}),t.filter(function(i){return i}).forEach(function(i){["before","after","already","leave"].forEach(function(n){i[n]&&(e[n]||(e[n]=[]),e[n].push(i[n]))})}),e}function Nf(t,e,i){var n=e||{},r=0;(function a(){if(!t[r]){i&&i(n);return}Array.isArray(t[r])?(t.splice.apply(t,[r,1].concat(t[r][0](n)?t[r][1]:t[r][2])),a()):t[r](n,function(s){typeof s>"u"||s===!0?(r+=1,a()):i&&i(n)})})()}Nf.if=function(t,e,i){return Array.isArray(e)||(e=[e]),Array.isArray(i)||(i=[i]),[t,e,i]};function rre(t,e){typeof t.currentLocationPath>"u"&&(t.currentLocationPath=t.to=gRe(t.instance.root)),t.currentLocationPath=t.instance._checkForAHash(t.currentLocationPath),e()}function pV(t,e){for(var i=0;i<t.instance.routes.length;i++){var n=t.instance.routes[i],r=vRe(t,n);if(r&&(t.matches||(t.matches=[]),t.matches.push(r),t.resolveOptions.strategy==="ONE")){e();return}}e()}function x0t(t,e){t.navigateOptions&&(typeof t.navigateOptions.shouldResolve<"u"&&console.warn('"shouldResolve" is deprecated. Please check the documentation.'),typeof t.navigateOptions.silent<"u"&&console.warn('"silent" is deprecated. Please check the documentation.')),e()}function O0t(t,e){t.navigateOptions.force===!0?(t.instance._setCurrent([t.instance._pathToMatchObject(t.to)]),e(!1)):e()}var are=UK(),L0t=yRe();function F0t(t,e){if(n0(t.navigateOptions,"updateBrowserURL")){var i=("/"+t.to).replace(/\/\//g,"/"),n=are&&t.resolveOptions&&t.resolveOptions.hash===!0;L0t?(history[t.navigateOptions.historyAPIMethod||"pushState"](t.navigateOptions.stateObj||{},t.navigateOptions.title||"",n?"#"+i:i),location&&location.hash&&(t.instance.__freezeListening=!0,setTimeout(function(){if(!n){var r=location.hash;location.hash="",location.hash=r}t.instance.__freezeListening=!1},1))):are&&(window.location.href=t.to)}e()}function bRe(t,e){var i=t.instance;if(!i.lastResolved()){e();return}Nf(i.lastResolved().map(function(n){return function(r,a){if(!n.route.hooks||!n.route.hooks.leave){a();return}var s=!1,o=t.instance.matchLocation(n.route.path,t.currentLocationPath,!1);if(n.route.path!=="*")s=!o;else{var l=t.matches?t.matches.find(function(c){return n.route.path===c.route.path}):!1;s=!l}if(n0(t.navigateOptions,"callHooks")&&s){Nf(n.route.hooks.leave.map(function(c){return function(u,d){return c(function(p){p===!1?t.instance.__markAsClean(t):d()},t.matches&&t.matches.length>0?t.matches.length===1?t.matches[0]:t.matches:void 0)}}).concat([function(){return a()}]));return}else a()}}),{},function(){return e()})}function $0t(t,e){t.match.route.hooks&&t.match.route.hooks.before&&n0(t.navigateOptions,"callHooks")?Nf(t.match.route.hooks.before.map(function(i){return function(r,a){return i(function(s){s===!1?t.instance.__markAsClean(t):a()},t.match)}}).concat([function(){return e()}])):e()}function B0t(t,e){n0(t.navigateOptions,"callHandler")&&t.match.route.handler(t.match),t.instance.updatePageLinks(),e()}function V0t(t,e){t.match.route.hooks&&t.match.route.hooks.after&&n0(t.navigateOptions,"callHooks")&&t.match.route.hooks.after.forEach(function(i){return i(t.match)}),e()}function j0t(t,e){var i=t.instance.lastResolved();if(i&&i[0]&&i[0].route===t.match.route&&i[0].url===t.match.url&&i[0].queryString===t.match.queryString){i.forEach(function(n){n.route.hooks&&n.route.hooks.already&&n0(t.navigateOptions,"callHooks")&&n.route.hooks.already.forEach(function(r){return r(t.match)})}),e(!1);return}e()}function G0t(t,e){var i=t.instance._notFoundRoute;if(i){t.notFoundHandled=!0;var n=Xk(t.currentLocationPath),r=n[0],a=n[1],s=Zk(t.to);i.path=ls(r);var o={url:i.path,queryString:a,hashString:s,data:null,route:i,params:a!==""?TK(a):null};t.matches=[o],t.match=o}e()}function H0t(t,e){(!t.resolveOptions||t.resolveOptions.noMatchWarning===!1||typeof t.resolveOptions.noMatchWarning>"u")&&console.warn('Navigo: "'+t.currentLocationPath+`" didn't match any of the registered routes.`),e()}function z0t(t,e){t.instance._setCurrent(null),e()}function IRe(t,e){n0(t.navigateOptions,"updateState")&&t.instance._setCurrent(t.matches),e()}var wRe=[j0t,$0t,B0t,V0t],sre=[bRe,G0t,Nf.if(function(t){var e=t.notFoundHandled;return e},wRe.concat([IRe]),[H0t,z0t])];function uz(){return uz=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])}return t},uz.apply(this,arguments)}function ore(t,e){var i=0;function n(){if(i===t.matches.length){IRe(t,e);return}Nf(wRe,uz({},t,{match:t.matches[i]}),function(){i+=1,n()})}bRe(t,n)}function hV(t){t.instance.__markAsClean(t)}function dz(){return dz=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])}return t},dz.apply(this,arguments)}var lre="[data-navigo]";function q0t(t,e){var i=e||{strategy:"ONE",hash:!1,noMatchWarning:!1,linksSelector:lre},n=this,r="/",a=null,s=[],o=!1,l,c=yRe(),u=UK();t?r=ls(t):console.warn('Navigo requires a root path in its constructor. If not provided will use "/" as default.');function d(F){return F.indexOf("#")>=0&&(i.hash===!0?F=F.split("#")[1]||"/":F=F.split("#")[0]),F}function p(F){return ls(r+"/"+ls(F))}function h(F,V,j,B){return F=Kk(F)?p(F):F,{name:B||ls(String(F)),path:F,handler:V,hooks:k0t(j)}}function f(F,V,j){var B=this;return typeof F=="object"&&!(F instanceof RegExp)?(Object.keys(F).forEach(function(z){if(typeof F[z]=="function")B.on(z,F[z]);else{var W=F[z],Z=W.uses,K=W.as,Q=W.hooks;s.push(h(z,Z,[l,Q],K))}}),this):(typeof F=="function"&&(j=V,V=F,F=r),s.push(h(F,V,[l,j])),this)}function m(F,V){if(n.__dirty){n.__waiting.push(function(){return n.resolve(F,V)});return}else n.__dirty=!0;F=F?ls(r)+"/"+ls(F):void 0;var j={instance:n,to:F,currentLocationPath:F,navigateOptions:{},resolveOptions:dz({},i,V)};return Nf([rre,pV,Nf.if(function(B){var z=B.matches;return z&&z.length>0},ore,sre)],j,hV),j.matches?j.matches:!1}function g(F,V){if(n.__dirty){n.__waiting.push(function(){return n.navigate(F,V)});return}else n.__dirty=!0;F=ls(r)+"/"+ls(F);var j={instance:n,to:F,navigateOptions:V||{},resolveOptions:V&&V.resolveOptions?V.resolveOptions:i,currentLocationPath:d(F)};Nf([x0t,O0t,pV,Nf.if(function(B){var z=B.matches;return z&&z.length>0},ore,sre),F0t,hV],j,hV)}function v(F,V,j){var B=R(F,V);return B!==null?(g(B.replace(new RegExp("^/?"+r),""),j),!0):!1}function y(F){return this.routes=s=s.filter(function(V){return Kk(F)?ls(V.path)!==ls(F):N0t(F)?F!==V.handler:String(V.path)!==String(F)}),this}function b(){c&&(this.__popstateListener=function(){n.__freezeListening||m()},window.addEventListener("popstate",this.__popstateListener))}function I(){this.routes=s=[],c&&window.removeEventListener("popstate",this.__popstateListener),this.destroyed=o=!0}function T(F,V){return n._notFoundRoute=h("*",F,[l,V],"__NOT_FOUND__"),this}function w(){if(u)return S().forEach(function(F){if(F.getAttribute("data-navigo")==="false"||F.getAttribute("target")==="_blank"){F.hasListenerAttached&&F.removeEventListener("click",F.navigoHandler);return}F.hasListenerAttached||(F.hasListenerAttached=!0,F.navigoHandler=function(V){if((V.ctrlKey||V.metaKey)&&V.target.tagName.toLowerCase()==="a")return!1;var j=F.getAttribute("href");if(typeof j>"u"||j===null)return!1;if(j.match(/^(http|https)/)&&typeof URL<"u")try{var B=new URL(j);j=B.pathname+B.search}catch{}var z=_0t(F.getAttribute("data-navigo-options"));o||(V.preventDefault(),V.stopPropagation(),n.navigate(ls(j),z))},F.addEventListener("click",F.navigoHandler))}),n}function S(){return u?[].slice.call(document.querySelectorAll(i.linksSelector||lre)):[]}function U(F){return"/"+r+"/"+ls(F)}function P(F){return l=F,this}function E(){return a}function R(F,V,j){var B=s.find(function(Z){return Z.name===F}),z=null;if(B){if(z=B.path,V)for(var W in V)z=z.replace(":"+W,V[W]);z=z.match(/^\//)?z:"/"+z}return z&&j&&!j.includeRoot&&(z=z.replace(new RegExp("^/"+r),"")),z}function C(F){return F.getAttribute("href")}function M(F){var V=Xk(ls(F)),j=V[0],B=V[1],z=B===""?null:TK(B),W=Zk(F),Z=h(j,function(){},[l],j);return{url:j,queryString:B,hashString:W,route:Z,data:null,params:z}}function _(){return M(ls(gRe(r)).replace(new RegExp("^"+r),""))}function A(F){var V={instance:n,currentLocationPath:F,to:F,navigateOptions:{},resolveOptions:i};return pV(V,function(){}),V.matches?V.matches:!1}function N(F,V,j){typeof V<"u"&&(typeof j>"u"||j)&&(V=p(V));var B={instance:n,to:V,currentLocationPath:V};rre(B,function(){}),typeof F=="string"&&(F=typeof j>"u"||j?p(F):F);var z=vRe(B,{name:String(F),path:F,handler:function(){},hooks:{}});return z||!1}function k(F,V,j){return typeof V=="string"&&(V=O(V)),V?(V.hooks[F]||(V.hooks[F]=[]),V.hooks[F].push(j),function(){V.hooks[F]=V.hooks[F].filter(function(B){return B!==j})}):(console.warn("Route doesn't exists: "+V),function(){})}function O(F){return typeof F=="string"?s.find(function(V){return V.name===p(F)}):s.find(function(V){return V.handler===F})}function $(F){F.instance.__dirty=!1,F.instance.__waiting.length>0&&F.instance.__waiting.shift()()}this.root=r,this.routes=s,this.destroyed=o,this.current=a,this.__freezeListening=!1,this.__waiting=[],this.__dirty=!1,this.__markAsClean=$,this.on=f,this.off=y,this.resolve=m,this.navigate=g,this.navigateByName=v,this.destroy=I,this.notFound=T,this.updatePageLinks=w,this.link=U,this.hooks=P,this.extractGETParameters=function(F){return Xk(d(F))},this.lastResolved=E,this.generate=R,this.getLinkPath=C,this.match=A,this.matchLocation=N,this.getCurrentLocation=_,this.addBeforeHook=k.bind(this,"before"),this.addAfterHook=k.bind(this,"after"),this.addAlreadyHook=k.bind(this,"already"),this.addLeaveHook=k.bind(this,"leave"),this.getRoute=O,this._pathToMatchObject=M,this._clean=ls,this._checkForAHash=d,this._setCurrent=function(F){return a=n.current=F},b.call(this),w.call(this)}function W0t(){const e=new q0t("/",{hash:!0});It.router=e;const i=({selectedTab:n,renderDraw:r,data:a})=>{M2(),Cbt({config:{selectedTab:n,renderDraw:r,...a}})};return e.on(`/${Ps}/:tournamentId`,({data:n})=>{i({data:n})}),e.on(`/${Ps}/:tournamentId/overview`,({data:n})=>{i({data:n,selectedTab:PU})}),e.on(`/${Ps}/:tournamentId/${wb}/:eventId`,({data:n})=>{i({selectedTab:hh,data:n})}),e.on(`/${Ps}/:tournamentId/${wb}/:eventId/${z1}/:drawId`,({data:n})=>{i({selectedTab:hh,renderDraw:!0,data:n})}),e.on(`/${Ps}/:tournamentId/${wb}/:eventId/${z1}/:drawId/${gj}/:roundsView`,({data:n})=>{i({selectedTab:hh,renderDraw:!0,data:n})}),e.on(`/${Ps}/:tournamentId/${wb}/:eventId/${z1}/:drawId/${mj}/:structureId`,({data:n})=>{i({selectedTab:hh,renderDraw:!0,data:n})}),e.on(`/${Ps}/:tournamentId/${wb}/:eventId/${z1}/:drawId/${mj}/:structureId/${gj}/:roundsView`,({data:n})=>{i({selectedTab:hh,renderDraw:!0,data:n})}),e.on(`/${Ps}/:tournamentId/${wb}/:eventId/${vfe}/:drawId`,({data:n})=>{i({selectedTab:hh,data:n})}),e.on(`/${Ps}/:tournamentId/${Qf}/:participantView`,({data:n})=>{i({selectedTab:Qf,data:n})}),e.on(`/${Ps}/:tournamentId/${dy}/:scheduledDate`,({data:n})=>{i({selectedTab:dy,data:n})}),e.on(`/${Ps}/:tournamentId/:selectedTab`,({data:n})=>{i({data:n})}),e.on(`/${Bh}/:uuid`,fne),e.on(`/${Bh}`,fne),e.on(`/${yfe}/:inviteKey`,wIt),e.on("/calendar",b0t),e.on("/actionKey/:key",({data:n})=>{n.key,e.navigate("/"),iV()}),e.on("/",()=>{iV()}),e.notFound(()=>{e.navigate("/"),iV()}),e.resolve(),{success:!0}}function Y0t(){return new Promise((t,e)=>{Q0t();const i=()=>{t()};Z0t().then(i,e)})}const K0t=t=>(...e)=>zCe()?t(...e):t(...e).catch(i=>console.log(i));function Z0t(){return new Promise((t,e)=>{new Promise((n,r)=>K0t(jc.initDB)().then(t,X0t).then(n,r)).then(t,e)})}function X0t(){It.modal.inform({message:'<h2>Database Upgraded</h2><div style="margin: 1em;">Please Close Browser and Re-launch</div>'})}function J0t(t){const e=r=>Object.keys(r).map(a=>r[a]).join(""),i=e(t);Zi.messages.reduce((r,a)=>e(a)===i?!0:r,!1)||Zi.messages.push(t)}function Q0t(){It.ee.addListener(dtt,tDe),It.ee.addListener("addMessage",J0t)}const eSt=""+new URL("dragmatch-Va2U120p.png",import.meta.url).href;function fV(){aSt(),Wbt(),iSt(),YBe(),ane("login"),ane("burger"),kbt("config"),Array.prototype.toSorted||(Array.prototype.toSorted=function(t){return this.slice().sort(t)}),It.drawer=IIt(),Y0t().then(tSt,t=>console.log({err:t}))}function tSt(){console.log("%c TMX ready","color: lightgreen"),VCe(),sSt(),document.getElementById(TE).onclick=()=>It.router.navigate(`/${Bh}`),W0t(),jlt()}function iSt(){It.dragMatch=new Image,It.dragMatch.src=eSt,It.ee=new qbt}const nSt="ResizeObserver loop limit exceeded",rSt="ResizeObserver loop completed with undelivered notifications.";function aSt(){Zi.device=lSt();const t=ot.version();console.log(`%cversion: ${iY}`,"color: lightblue"),console.log(`%cfactory: ${t}`,"color: lightblue"),oSt()}function sSt(){const t=Uo.topicConstants;uS.setSubscriptions({subscriptions:{[t.MODIFY_MATCHUP]:e=>{var n;const i=(n=e.matchUp)==null?void 0:n.matchUpId;It.matchUpsToBroadcast.push(i),Zi.devNotes&&console.log("MODIFY_MATCHUP",e)}}})}function oSt(){window.addEventListener("error",t=>{if([nSt,rSt].includes(t.message)){const e=document.getElementById("webpack-dev-server-client-overlay-div"),i=document.getElementById("webpack-dev-server-client-overlay");i&&i.setAttribute("style","display: none"),e&&e.setAttribute("style","display: none")}})}function lSt(){let t=cSt();return{isStandalone:t&&"standalone"in t&&t.standalone,isIDevice:t&&/iphone|ipod|ipad/i.test(t.userAgent),isIpad:t&&/iPad/i.test(t.userAgent),isWindows:t&&/indows/i.test(t.userAgent),isMobile:t&&/Mobi/.test(t.userAgent)}}function cSt(){try{return navigator||window.navigator}catch{return}}if(window.attachEvent)window.attachEvent("onload",fV);else if(window.onload){const t=window.onload,e=i=>{t(i),fV()};window.onload=e}else window.onload=fV;zBe();WBe();
//# sourceMappingURL=index-Bh-HI2Dk.js.map
